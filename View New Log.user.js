// ==UserScript==
// @name         View New Log
// @namespace    https://support.concurcompleat.com/Logs/
// @updateURL    https://github.com/thambley/compleat-tampermonkey/raw/main/View%20New%20Log.user.js
// @version      0.23
// @description  View formatted log text
// @author       thambley@tlcorporate.com
// @match        https://support.concurcompleat.com/Logs*
// @match        https://support.concurcompleat.com/logs*
// @grant        unsafeWindow
// ==/UserScript==

(function () {
  'use strict';

  var htmlContent = 'PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbiI+DQoNCjxoZWFkPg0KICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCIgLz4NCiAgPHRpdGxlPmxvZyB0byBodG1sIHVwbG9hZDwvdGl0bGU+DQogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy9sb2ctdG8taHRtbC5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+DQogIDxzdHlsZT4NCiAgICBib2R5IHsNCiAgICAgIGZvbnQtZmFtaWx5OiBzYW5zLXNlcmlmOw0KICAgICAgZm9udC1zaXplOiAxMnB4Ow0KICAgICAgbWFyZ2luOiAwcHg7DQogICAgfQ0KDQogICAgLmNvbnRhaW5lciB7DQogICAgICBtaW4taGVpZ2h0OiA1MHB4Ow0KICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtZmxleDsNCiAgICAgIGZsZXgtd3JhcDogd3JhcDsNCiAgICAgIGZsZXgtZGlyZWN0aW9uOiByb3c7DQogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtc3RhcnQ7DQogICAgICBhbGlnbi1pdGVtczogYXV0bzsNCiAgICAgIGFsaWduLWNvbnRlbnQ6IGNlbnRlcjsNCiAgICB9DQoNCiAgICAuY29udGFpbmVyOmFmdGVyIHsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgLypjb250ZW50OiAiIGludmlzaWJsZSBub2RlICI7Ki8NCiAgICAgIGZsZXg6IDk5OSA5OTkgYXV0bzsNCiAgICB9DQoNCiAgICAuaXRlbSB7DQogICAgICBmbGV4OiAwIDAgYXV0bzsNCiAgICAgIG1hcmdpbjogNXB4Ow0KICAgIH0NCg0KICAgIC5wYWdlZGl2IHsNCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHdoaXRlOw0KICAgIH0NCg0KICAgIC5pbmZvIHsNCiAgICAgIGRpc3BsYXk6IHRhYmxlLWNlbGw7DQogICAgICBwYWRkaW5nOiA1cHg7DQogICAgfQ0KDQogICAgLmhpZGRlbiB7DQogICAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7DQogICAgfQ0KDQogICAgLmluZm9MYWJlbCB7DQogICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgIHBhZGRpbmc6IDVweDsNCiAgICB9DQoNCiAgICAjZGF0YSB7DQogICAgICBjbGVhcjogYm90aDsNCiAgICAgIG92ZXJmbG93OiBhdXRvOw0KICAgICAgd2lkdGg6IDEwMCU7DQogICAgfQ0KDQogICAgLnN1Ym1pdF9idG4gew0KICAgICAgYm9yZGVyLXJhZGl1czogMjAwcHg7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgIGZvbnQtc2l6ZTogMS4wZW07DQogICAgICBmb250LWZhbWlseTogJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsNCiAgICAgIGxpbmUtaGVpZ2h0OiAxMnB4Ow0KICAgICAgbWFyZ2luLXJpZ2h0OiAzcHg7DQogICAgICBwYWRkaW5nOiA3cHggMTZweCA2cHg7DQogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjODM4YTkwOw0KICAgICAgYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgIzgzOGE5MCwgIzQxNDU0OSk7DQogICAgICB0ZXh0LXNoYWRvdzogIzAwMCAwIDFweCAwOw0KICAgICAgYm94LXNoYWRvdzogMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4xKSwgMCAxcHggMCAwcHggcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpIGluc2V0Ow0KICAgICAgYm9yZGVyOiBzb2xpZCAxcHggIzQ4NGU1MzsNCiAgICAgIGJvcmRlci1jb2xvcjogIzQ4NGU1MzsNCiAgICAgIGJvcmRlci10b3AtY29sb3I6ICM2MTZhNzE7DQogICAgICBib3JkZXItcmlnaHQtY29sb3I6ICM0ODRlNTM7DQogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjMzYzYjNmOw0KICAgICAgYm9yZGVyLWxlZnQtY29sb3I6ICM0ODRlNTM7DQogICAgICBjb2xvcjogI2VmZWZlZjsNCiAgICAgIGN1cnNvcjogcG9pbnRlcg0KICAgIH0NCg0KICAgIC5yZXNldF9idG4gew0KICAgICAgYm9yZGVyLXJhZGl1czogMjAwcHg7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgIGZvbnQtc2l6ZTogMS4wZW07DQogICAgICBmb250LWZhbWlseTogJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsNCiAgICAgIGxpbmUtaGVpZ2h0OiAxMnB4Ow0KICAgICAgbWFyZ2luLXJpZ2h0OiAzcHg7DQogICAgICBwYWRkaW5nOiA3cHggMTZweCA2cHg7DQogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGOw0KICAgICAgYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgI2ZmZiwgI0U3RTdFNyk7DQogICAgICBib3gtc2hhZG93OiAwIDFweCAxcHggcmdiYSgwLCAwLCAwLCAwLjEpLCAwIDFweCAwIDAgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjgpIGluc2V0Ow0KICAgICAgYm9yZGVyOiBzb2xpZCAxcHggI2M3YzdjNzsNCiAgICAgIGJvcmRlci1jb2xvcjogI2M3YzdjNzsNCiAgICAgIGJvcmRlci10b3AtY29sb3I6ICNkM2QzZDM7DQogICAgICBib3JkZXItcmlnaHQtY29sb3I6ICNjN2M3Yzc7DQogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjYzJjMmMyOw0KICAgICAgYm9yZGVyLWxlZnQtY29sb3I6ICNjN2M3Yzc7DQogICAgICB0ZXh0LXNoYWRvdzogI2ZmZiAwIDFweCAwOw0KICAgICAgY29sb3I6ICM1RTY0NjkNCiAgICB9DQogIDwvc3R5bGU+DQogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy9zZWFyY2guY3NzIiByZWw9InN0eWxlc2hlZXQiIHR5cGU9InRleHQvY3NzIiAvPi0tPg0KICA8c3R5bGU+DQogICAgZm9ybSNzZWFyY2ggLnNlYXJjaF9mb3JtX2ZpZWxkIHsNCiAgICAgIG1hcmdpbi1ib3R0b206IDEwcHg7DQogICAgICBjbGVhcjogYm90aA0KICAgIH0NCg0KICAgIGZvcm0jc2VhcmNoIGlucHV0W3R5cGU9dGV4dF0sDQogICAgZm9ybSNzZWFyY2ggaW5wdXRbdHlwZT1lbWFpbF0sDQogICAgZm9ybSNzZWFyY2ggaW5wdXRbdHlwZT1udW1iZXJdLA0KICAgIGZvcm0jc2VhcmNoIGlucHV0W3R5cGU9dXJsXSwNCiAgICBmb3JtI3NlYXJjaCBpbnB1dFt0eXBlPXRlbF0sDQogICAgZm9ybSNzZWFyY2ggaW5wdXRbdHlwZT1kYXRlXSwNCiAgICBmb3JtI3NlYXJjaCBpbnB1dFt0eXBlPXRpbWVdLA0KICAgIGZvcm0jc2VhcmNoIHRleHRhcmVhIHsNCiAgICAgIC8qIHdpZHRoOiBjYWxjKDgwJSAtIDIycHgpOyovDQogICAgICBib3JkZXI6IDFweCBzb2xpZCAjYzlkMGQ2Ow0KICAgICAgYm9yZGVyLXJhZGl1czogM3B4Ow0KICAgICAgZm9udC1zaXplOiAwLjk1ZW07DQogICAgICBmb250LWZhbWlseTogJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsNCiAgICAgIG91dGxpbmU6IG5vbmU7DQogICAgICBwYWRkaW5nOiA4cHggMTBweCA3cHgNCiAgICB9DQoNCiAgICBmb3JtI3NlYXJjaCAuYnV0dG9ucyB7DQogICAgICBtYXJnaW4tdG9wOiAxNXB4DQogICAgfQ0KDQogICAgZm9ybSNzZWFyY2ggc2VsZWN0IHsNCiAgICAgIHdpZHRoOiAyNDBweA0KICAgIH0NCiAgPC9zdHlsZT4NCiAgPCEtLTxsaW5rIGhyZWY9InN0eWxlc2hlZXRzL2ZpbHRlci5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+DQogIDxzdHlsZT4NCiAgICBmb3JtI2ZpbHRlciAuZmlsdGVyX2Zvcm1fZmllbGQgew0KICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDsNCiAgICAgIGNsZWFyOiBib3RoDQogICAgfQ0KDQogICAgZm9ybSNmaWx0ZXIgaW5wdXRbdHlwZT10ZXh0XSwNCiAgICBmb3JtI2ZpbHRlciBpbnB1dFt0eXBlPWVtYWlsXSwNCiAgICBmb3JtI2ZpbHRlciBpbnB1dFt0eXBlPW51bWJlcl0sDQogICAgZm9ybSNmaWx0ZXIgaW5wdXRbdHlwZT11cmxdLA0KICAgIGZvcm0jZmlsdGVyIGlucHV0W3R5cGU9dGVsXSwNCiAgICBmb3JtI2ZpbHRlciBpbnB1dFt0eXBlPWRhdGVdLA0KICAgIGZvcm0jZmlsdGVyIGlucHV0W3R5cGU9dGltZV0sDQogICAgZm9ybSNmaWx0ZXIgdGV4dGFyZWEgew0KICAgICAgLyogd2lkdGg6IGNhbGMoODAlIC0gMjJweCk7Ki8NCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNjOWQwZDY7DQogICAgICBib3JkZXItcmFkaXVzOiAzcHg7DQogICAgICBmb250LXNpemU6IDAuOTVlbTsNCiAgICAgIGZvbnQtZmFtaWx5OiAnSGVsdmV0aWNhIE5ldWUnLCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOw0KICAgICAgb3V0bGluZTogbm9uZTsNCiAgICAgIHBhZGRpbmc6IDhweCAxMHB4IDdweA0KICAgIH0NCg0KICAgIGZvcm0jZmlsdGVyIC5idXR0b25zIHsNCiAgICAgIG1hcmdpbi10b3A6IDE1cHgNCiAgICB9DQoNCiAgICBmb3JtI2ZpbHRlciBzZWxlY3Qgew0KICAgICAgd2lkdGg6IDI0MHB4DQogICAgfQ0KICA8L3N0eWxlPg0KICA8IS0tPGxpbmsgaHJlZj0ic3R5bGVzaGVldHMvb25vZmYuY3NzIiByZWw9InN0eWxlc2hlZXQiIHR5cGU9InRleHQvY3NzIiAvPi0tPg0KICA8c3R5bGU+DQogICAgLyogaHR0cHM6Ly9wcm90by5pby9mcmVlYmllcy9vbm9mZi8gKi8NCg0KICAgIC5vbm9mZnN3aXRjaCB7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICB3aWR0aDogNzBweDsNCiAgICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAtbW96LXVzZXItc2VsZWN0OiBub25lOw0KICAgICAgLW1zLXVzZXItc2VsZWN0OiBub25lOw0KICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgfQ0KDQogICAgLm9ub2Zmc3dpdGNoLWNoZWNrYm94IHsNCiAgICAgIGRpc3BsYXk6IG5vbmU7DQogICAgfQ0KDQogICAgLm9ub2Zmc3dpdGNoLWxhYmVsIHsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICAgIGJvcmRlcjogMnB4IHNvbGlkICM5OTk5OTk7DQogICAgICBib3JkZXItcmFkaXVzOiAxNXB4Ow0KICAgIH0NCg0KICAgIC5vbm9mZnN3aXRjaC1pbm5lciB7DQogICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgIHdpZHRoOiAyMDAlOw0KICAgICAgbWFyZ2luLWxlZnQ6IC0xMDAlOw0KICAgICAgdHJhbnNpdGlvbjogbWFyZ2luIDAuM3MgZWFzZS1pbiAwczsNCiAgICB9DQoNCiAgICAub25vZmZzd2l0Y2gtaW5uZXI6YmVmb3JlLA0KICAgIC5vbm9mZnN3aXRjaC1pbm5lcjphZnRlciB7DQogICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgIGZsb2F0OiBsZWZ0Ow0KICAgICAgd2lkdGg6IDUwJTsNCiAgICAgIGhlaWdodDogMjVweDsNCiAgICAgIHBhZGRpbmc6IDA7DQogICAgICBsaW5lLWhlaWdodDogMjVweDsNCiAgICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICAgIGNvbG9yOiB3aGl0ZTsNCiAgICAgIGZvbnQtZmFtaWx5OiBUcmVidWNoZXQsIEFyaWFsLCBzYW5zLXNlcmlmOw0KICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIH0NCg0KICAgIC5vbm9mZnN3aXRjaC1pbm5lcjpiZWZvcmUgew0KICAgICAgY29udGVudDogIk9OIjsNCiAgICAgIHBhZGRpbmctbGVmdDogMTBweDsNCiAgICAgIGJhY2tncm91bmQtY29sb3I6ICMzNEE3QzE7DQogICAgICBjb2xvcjogI0ZGRkZGRjsNCiAgICB9DQoNCiAgICAub25vZmZzd2l0Y2gtaW5uZXI6YWZ0ZXIgew0KICAgICAgY29udGVudDogIk9GRiI7DQogICAgICBwYWRkaW5nLXJpZ2h0OiAxMHB4Ow0KICAgICAgYmFja2dyb3VuZC1jb2xvcjogI0VFRUVFRTsNCiAgICAgIGNvbG9yOiAjOTk5OTk5Ow0KICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7DQogICAgfQ0KDQogICAgLm9ub2Zmc3dpdGNoLXN3aXRjaCB7DQogICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgIHdpZHRoOiAxNXB4Ow0KICAgICAgbWFyZ2luOiA1cHg7DQogICAgICBiYWNrZ3JvdW5kOiAjRkZGRkZGOw0KICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgICAgdG9wOiAwOw0KICAgICAgYm90dG9tOiAwOw0KICAgICAgcmlnaHQ6IDQxcHg7DQogICAgICBib3JkZXI6IDJweCBzb2xpZCAjOTk5OTk5Ow0KICAgICAgYm9yZGVyLXJhZGl1czogMTVweDsNCiAgICAgIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2UtaW4gMHM7DQogICAgfQ0KDQogICAgLm9ub2Zmc3dpdGNoLWNoZWNrYm94OmNoZWNrZWQrLm9ub2Zmc3dpdGNoLWxhYmVsIC5vbm9mZnN3aXRjaC1pbm5lciB7DQogICAgICBtYXJnaW4tbGVmdDogMDsNCiAgICB9DQoNCiAgICAub25vZmZzd2l0Y2gtY2hlY2tib3g6Y2hlY2tlZCsub25vZmZzd2l0Y2gtbGFiZWwgLm9ub2Zmc3dpdGNoLXN3aXRjaCB7DQogICAgICByaWdodDogMHB4Ow0KICAgIH0NCiAgPC9zdHlsZT4NCiAgPCEtLTxsaW5rIGhyZWY9InN0eWxlc2hlZXRzL3JhZGlvdG9nZ2xlLmNzcyIgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgLz4tLT4NCiAgPHN0eWxlPg0KICAgIC8qIFRPR0dMRSBTVFlMSU5HICovDQogICAgLnJhZGlvVG9nZ2xlIHsNCiAgICAgIG1hcmdpbjogMCAwIDA7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgZm9udC1zaXplOiAwOw0KICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgIGZsZXgtZmxvdzogcm93IG5vd3JhcDsNCiAgICAgIGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDsNCiAgICAgIGFsaWduLWl0ZW1zOiBzdHJldGNoOw0KDQogICAgICBpbnB1dCB7DQogICAgICAgIHdpZHRoOiAwOw0KICAgICAgICBoZWlnaHQ6IDA7DQogICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgbGVmdDogLTk5OTlweDsNCiAgICAgIH0NCg0KICAgICAgaW5wdXQgKyBsYWJlbCB7DQogICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgcGFkZGluZy1sZWZ0OiAxMHB4Ow0KICAgICAgICBwYWRkaW5nLXJpZ2h0OiAxMHB4Ow0KICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgICAgYm9yZGVyOiBzb2xpZCAycHggIzk5OTk5OTsNCiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRjsNCiAgICAgICAgY29sb3I6ICM5OTk5OTk7DQogICAgICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICAgICAgbGluZS1oZWlnaHQ6IDI1cHg7DQogICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgIGJveC1zaGFkb3c6IDAgMCAwIHJnYmEoMjU1LDI1NSwyNTUsMCk7DQogICAgICAgIHRyYW5zaXRpb246IAlib3JkZXItY29sb3IgLjE1cyBlYXNlLW91dCwNCiAgICAgICAgICAgICAgY29sb3IgLjI1cyBlYXNlLW91dCwNCiAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvciAuMTVzIGVhc2Utb3V0LA0KICAgICAgICAgICAgICBib3gtc2hhZG93IC4xNXMgZWFzZS1vdXQ7DQoNCiAgICAgICAgLyogQUREIFRIRVNFIFBST1BFUlRJRVMgVE8gU1dJVENIIEZST00gQVVUTyBXSURUSCBUTyBGVUxMIFdJRFRIICovDQogICAgICAgIC8qZmxleDogMCAwIDUwJTsgZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7IGFsaWduLWl0ZW1zOiBjZW50ZXI7Ki8NCiAgICAgICAgLyogLS0tLS0gKi8NCg0KICAgICAgICAmOmZpcnN0LW9mLXR5cGUgew0KICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDE1cHggMCAwIDE1cHg7DQogICAgICAgICAgYm9yZGVyLXJpZ2h0OiBub25lOw0KICAgICAgICB9DQoNCiAgICAgICAgJjpsYXN0LW9mLXR5cGUgew0KICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDAgMTVweCAxNXB4IDA7DQogICAgICAgICAgYm9yZGVyLWxlZnQ6IG5vbmU7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgaW5wdXQ6aG92ZXIgKyBsYWJlbCB7DQogICAgICAgIGJvcmRlci1jb2xvcjogIzk5OTk5OTsNCiAgICAgIH0NCg0KICAgICAgaW5wdXQ6Y2hlY2tlZCArIGxhYmVsIHsNCiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzM0QTdDMTsNCiAgICAgICAgY29sb3I6ICNGRkY7DQogICAgICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoIzY2QjNGQiwgLjUpOw0KICAgICAgICBib3JkZXItY29sb3I6ICM5OTk5OTk7DQogICAgICAgIHotaW5kZXg6IDE7DQogICAgICB9DQoNCiAgICAgIGlucHV0OmZvY3VzICsgbGFiZWwgew0KICAgICAgICBvdXRsaW5lOiBkb3R0ZWQgMXB4ICNDQ0M7DQogICAgICAgIG91dGxpbmUtb2Zmc2V0OiAuNDVyZW07DQogICAgICB9DQoNCiAgICAgIEBtZWRpYSAobWF4LXdpZHRoOiA4MDBweCkgew0KICAgICAgICBpbnB1dCArIGxhYmVsIHsNCiAgICAgICAgICBwYWRkaW5nOiAuNzVyZW0gLjI1cmVtOw0KICAgICAgICAgIGZsZXg6IDAgMCA1MCU7DQogICAgICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICA8L3N0eWxlPg0KICA8IS0taHR0cDovL3d3dy5saXN0anMuY29tLy0tPg0KICA8IS0tPGxpbmsgaHJlZj0ic3R5bGVzaGVldHMvbGlzdC5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+DQogIDxzdHlsZT4NCiAgICAvKiB0YWJsZXMgKi8NCiAgICB0YWJsZS5saXN0YWJsZSB0cjpob3ZlciB0ZCB7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjJmMmYyOw0KICAgIH0NCg0KICAgIHRhYmxlLmxpc3RhYmxlIHRkLA0KICAgIHRhYmxlLmxpc3RhYmxlIHRoIHsNCiAgICAgIHBhZGRpbmc6IDVweDsNCiAgICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOw0KICAgIH0NCg0KICAgIHRhYmxlLmxpc3RhYmxlIHsNCiAgICAgIGJhY2tncm91bmQtY29sb3I6IGJsYWNrOw0KICAgIH0NCg0KICAgIHRkLnRleHQgew0KICAgICAgd2hpdGUtc3BhY2U6IHByZTsNCiAgICAgIGZvbnQtZmFtaWx5OiBjb3VyaWVyIG5ldzsNCiAgICB9DQoNCiAgICAucGFnaW5hdGlvbiBsaSB7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBwYWRkaW5nOiA1cHg7DQogICAgfQ0KDQogICAgLnBhZ2luYXRpb24gbGkuYWN0aXZlIHsNCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIGJsYWNrOw0KICAgICAgYm9yZGVyLXJhZGl1czogNnB4Ow0KICAgIH0NCg0KICAgIC5wYWdpbmF0aW9uIGxpIGEucGFnZSB7DQogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgIGNvbG9yOiBibGFjazsNCiAgICB9DQoNCiAgICAuc2VhcmNoIHsNCiAgICAgIGJvcmRlcjogc29saWQgMXB4ICNjY2M7DQogICAgICBib3JkZXItcmFkaXVzOiA1cHg7DQogICAgICBwYWRkaW5nOiA3cHggMTRweDsNCiAgICAgIG1hcmdpbi10b3A6IDEwcHgNCiAgICB9DQoNCiAgICB0YWJsZS5zb3J0YWJsZSB0aGVhZCB0ciAuc29ydCB7DQogICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEZRQUpBSUFBQUNNdE1QLy8veUg1QkFFQUFBRUFMQUFBQUFBVkFBa0FBQUlYakkrQXl3bmFZbmhVTW9xdDNnWlhQbVZnOTR5SlZRQUFPdz09KTsNCiAgICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7DQogICAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgcmlnaHQ7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICBwYWRkaW5nLXJpZ2h0OiAyMHB4Ow0KICAgIH0NCg0KICAgIHRhYmxlLnNvcnRhYmxlIHRoZWFkIHRyIC5hc2Mgew0KICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEZRQUVBSUFBQUNNdE1QLy8veUg1QkFFQUFBRUFMQUFBQUFBVkFBUUFBQUlOakIrZ0MralAycHRuMFdza0xRQTcpOw0KICAgIH0NCg0KICAgIHRhYmxlLnNvcnRhYmxlIHRoZWFkIHRyIC5kZXNjIHsNCiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhGUUFFQUlBQUFDTXRNUC8vL3lINUJBRUFBQUVBTEFBQUFBQVZBQVFBQUFJTmpJOEJ5YTJ3bklOVU1vcFpBUUE3KTsNCiAgICB9DQoNCiAgICB0YWJsZS5zb3J0YWJsZSB0aGVhZCB0ciAuYXNjLA0KICAgIHRhYmxlLnNvcnRhYmxlIHRoZWFkIHRyIC5kZXNjIHsNCiAgICAgIGJhY2tncm91bmQtY29sb3I6ICM4ZGJkZDg7DQogICAgfQ0KICA8L3N0eWxlPg0KICA8IS0tPHNjcmlwdCBzcmM9ImphdmFzY3JpcHRzL2xpc3QuanMiPjwvc2NyaXB0Pi0tPg0KICA8c2NyaXB0Pg0KICAvLyBMaXN0LmpzIHYxLjMuMCAoaHR0cDovL3d3dy5saXN0anMuY29tKSBieSBKb25ueSBTdHLDtm1iZXJnIChodHRwOi8vamF2dmUuY29tKQ0KKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT0iZnVuY3Rpb24iJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIrbysiJyIpO3Rocm93IGYuY29kZT0iTU9EVUxFX05PVF9GT1VORCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT0iZnVuY3Rpb24iJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSh7MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQooZnVuY3Rpb24oIHdpbmRvdywgdW5kZWZpbmVkICkgew0KInVzZSBzdHJpY3QiOw0KDQp2YXIgZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQsDQogIGdldEJ5Q2xhc3MgPSByZXF1aXJlKCcuL3NyYy91dGlscy9nZXQtYnktY2xhc3MnKSwNCiAgZXh0ZW5kID0gcmVxdWlyZSgnLi9zcmMvdXRpbHMvZXh0ZW5kJyksDQogIGluZGV4T2YgPSByZXF1aXJlKCcuL3NyYy91dGlscy9pbmRleC1vZicpLA0KICBldmVudHMgPSByZXF1aXJlKCcuL3NyYy91dGlscy9ldmVudHMnKSwNCiAgdG9TdHJpbmcgPSByZXF1aXJlKCcuL3NyYy91dGlscy90by1zdHJpbmcnKSwNCiAgbmF0dXJhbFNvcnQgPSByZXF1aXJlKCcuL3NyYy91dGlscy9uYXR1cmFsLXNvcnQnKSwNCiAgY2xhc3NlcyA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL2NsYXNzZXMnKSwNCiAgZ2V0QXR0cmlidXRlID0gcmVxdWlyZSgnLi9zcmMvdXRpbHMvZ2V0LWF0dHJpYnV0ZScpLA0KICB0b0FycmF5ID0gcmVxdWlyZSgnLi9zcmMvdXRpbHMvdG8tYXJyYXknKTsNCg0KdmFyIExpc3QgPSBmdW5jdGlvbihpZCwgb3B0aW9ucywgdmFsdWVzKSB7DQoNCiAgdmFyIHNlbGYgPSB0aGlzLA0KICAgIGluaXQsDQogICAgSXRlbSA9IHJlcXVpcmUoJy4vc3JjL2l0ZW0nKShzZWxmKSwNCiAgICBhZGRBc3luYyA9IHJlcXVpcmUoJy4vc3JjL2FkZC1hc3luYycpKHNlbGYpOw0KDQogIGluaXQgPSB7DQogICAgc3RhcnQ6IGZ1bmN0aW9uKCkgew0KICAgICAgc2VsZi5saXN0Q2xhc3MgICAgICA9ICJsaXN0IjsNCiAgICAgIHNlbGYuc2VhcmNoQ2xhc3MgICAgPSAic2VhcmNoIjsNCiAgICAgIHNlbGYuc29ydENsYXNzICAgICAgPSAic29ydCI7DQogICAgICBzZWxmLnBhZ2UgICAgICAgICAgID0gMTAwMDA7DQogICAgICBzZWxmLmkgICAgICAgICAgICAgID0gMTsNCiAgICAgIHNlbGYuaXRlbXMgICAgICAgICAgPSBbXTsNCiAgICAgIHNlbGYudmlzaWJsZUl0ZW1zICAgPSBbXTsNCiAgICAgIHNlbGYubWF0Y2hpbmdJdGVtcyAgPSBbXTsNCiAgICAgIHNlbGYuc2VhcmNoZWQgICAgICAgPSBmYWxzZTsNCiAgICAgIHNlbGYuZmlsdGVyZWQgICAgICAgPSBmYWxzZTsNCiAgICAgIHNlbGYuc2VhcmNoQ29sdW1ucyAgPSB1bmRlZmluZWQ7DQogICAgICBzZWxmLmhhbmRsZXJzICAgICAgID0geyAndXBkYXRlZCc6IFtdIH07DQogICAgICBzZWxmLnBsdWdpbnMgICAgICAgID0ge307DQogICAgICBzZWxmLnZhbHVlTmFtZXMgICAgID0gW107DQogICAgICBzZWxmLnV0aWxzICAgICAgICAgID0gew0KICAgICAgICBnZXRCeUNsYXNzOiBnZXRCeUNsYXNzLA0KICAgICAgICBleHRlbmQ6IGV4dGVuZCwNCiAgICAgICAgaW5kZXhPZjogaW5kZXhPZiwNCiAgICAgICAgZXZlbnRzOiBldmVudHMsDQogICAgICAgIHRvU3RyaW5nOiB0b1N0cmluZywNCiAgICAgICAgbmF0dXJhbFNvcnQ6IG5hdHVyYWxTb3J0LA0KICAgICAgICBjbGFzc2VzOiBjbGFzc2VzLA0KICAgICAgICBnZXRBdHRyaWJ1dGU6IGdldEF0dHJpYnV0ZSwNCiAgICAgICAgdG9BcnJheTogdG9BcnJheQ0KICAgICAgfTsNCg0KICAgICAgc2VsZi51dGlscy5leHRlbmQoc2VsZiwgb3B0aW9ucyk7DQoNCiAgICAgIHNlbGYubGlzdENvbnRhaW5lciA9ICh0eXBlb2YoaWQpID09PSAnc3RyaW5nJykgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkgOiBpZDsNCiAgICAgIGlmICghc2VsZi5saXN0Q29udGFpbmVyKSB7IHJldHVybjsgfQ0KICAgICAgc2VsZi5saXN0ICAgICAgID0gZ2V0QnlDbGFzcyhzZWxmLmxpc3RDb250YWluZXIsIHNlbGYubGlzdENsYXNzLCB0cnVlKTsNCg0KICAgICAgc2VsZi5wYXJzZSAgICAgID0gcmVxdWlyZSgnLi9zcmMvcGFyc2UnKShzZWxmKTsNCiAgICAgIHNlbGYudGVtcGxhdGVyICA9IHJlcXVpcmUoJy4vc3JjL3RlbXBsYXRlcicpKHNlbGYpOw0KICAgICAgc2VsZi5zZWFyY2ggICAgID0gcmVxdWlyZSgnLi9zcmMvc2VhcmNoJykoc2VsZik7DQogICAgICBzZWxmLmZpbHRlciAgICAgPSByZXF1aXJlKCcuL3NyYy9maWx0ZXInKShzZWxmKTsNCiAgICAgIHNlbGYuc29ydCAgICAgICA9IHJlcXVpcmUoJy4vc3JjL3NvcnQnKShzZWxmKTsNCg0KICAgICAgdGhpcy5oYW5kbGVycygpOw0KICAgICAgdGhpcy5pdGVtcygpOw0KICAgICAgc2VsZi51cGRhdGUoKTsNCiAgICAgIHRoaXMucGx1Z2lucygpOw0KICAgIH0sDQogICAgaGFuZGxlcnM6IGZ1bmN0aW9uKCkgew0KICAgICAgZm9yICh2YXIgaGFuZGxlciBpbiBzZWxmLmhhbmRsZXJzKSB7DQogICAgICAgIGlmIChzZWxmW2hhbmRsZXJdKSB7DQogICAgICAgICAgc2VsZi5vbihoYW5kbGVyLCBzZWxmW2hhbmRsZXJdKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgaXRlbXM6IGZ1bmN0aW9uKCkgew0KICAgICAgc2VsZi5wYXJzZShzZWxmLmxpc3QpOw0KICAgICAgaWYgKHZhbHVlcyAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHNlbGYuYWRkKHZhbHVlcyk7DQogICAgICB9DQogICAgfSwNCiAgICBwbHVnaW5zOiBmdW5jdGlvbigpIHsNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5wbHVnaW5zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIHZhciBwbHVnaW4gPSBzZWxmLnBsdWdpbnNbaV07DQogICAgICAgIHNlbGZbcGx1Z2luLm5hbWVdID0gcGx1Z2luOw0KICAgICAgICBwbHVnaW4uaW5pdChzZWxmLCBMaXN0KTsNCiAgICAgIH0NCiAgICB9DQogIH07DQoNCiAgLyoNCiAgKiBSZS1wYXJzZSB0aGUgTGlzdCwgdXNlIGlmIGh0bWwgaGF2ZSBjaGFuZ2VkDQogICovDQogIHRoaXMucmVJbmRleCA9IGZ1bmN0aW9uKCkgew0KICAgIHNlbGYuaXRlbXMgICAgICAgICAgPSBbXTsNCiAgICBzZWxmLnZpc2libGVJdGVtcyAgID0gW107DQogICAgc2VsZi5tYXRjaGluZ0l0ZW1zICA9IFtdOw0KICAgIHNlbGYuc2VhcmNoZWQgICAgICAgPSBmYWxzZTsNCiAgICBzZWxmLmZpbHRlcmVkICAgICAgID0gZmFsc2U7DQogICAgc2VsZi5wYXJzZShzZWxmLmxpc3QpOw0KICB9Ow0KDQogIHRoaXMudG9KU09OID0gZnVuY3Rpb24oKSB7DQogICAgdmFyIGpzb24gPSBbXTsNCiAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBzZWxmLml0ZW1zLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsNCiAgICAgIGpzb24ucHVzaChzZWxmLml0ZW1zW2ldLnZhbHVlcygpKTsNCiAgICB9DQogICAgcmV0dXJuIGpzb247DQogIH07DQoNCg0KICAvKg0KICAqIEFkZCBvYmplY3QgdG8gbGlzdA0KICAqLw0KICB0aGlzLmFkZCA9IGZ1bmN0aW9uKHZhbHVlcywgY2FsbGJhY2spIHsNCiAgICBpZiAodmFsdWVzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBpZiAoY2FsbGJhY2spIHsNCiAgICAgIGFkZEFzeW5jKHZhbHVlcywgY2FsbGJhY2spOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICB2YXIgYWRkZWQgPSBbXSwNCiAgICAgIG5vdENyZWF0ZSA9IGZhbHNlOw0KICAgIGlmICh2YWx1ZXNbMF0gPT09IHVuZGVmaW5lZCl7DQogICAgICB2YWx1ZXMgPSBbdmFsdWVzXTsNCiAgICB9DQogICAgZm9yICh2YXIgaSA9IDAsIGlsID0gdmFsdWVzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsNCiAgICAgIHZhciBpdGVtID0gbnVsbDsNCiAgICAgIG5vdENyZWF0ZSA9IChzZWxmLml0ZW1zLmxlbmd0aCA+IHNlbGYucGFnZSkgPyB0cnVlIDogZmFsc2U7DQogICAgICBpdGVtID0gbmV3IEl0ZW0odmFsdWVzW2ldLCB1bmRlZmluZWQsIG5vdENyZWF0ZSk7DQogICAgICBzZWxmLml0ZW1zLnB1c2goaXRlbSk7DQogICAgICBhZGRlZC5wdXNoKGl0ZW0pOw0KICAgIH0NCiAgICBzZWxmLnVwZGF0ZSgpOw0KICAgIHJldHVybiBhZGRlZDsNCiAgfTsNCg0KCXRoaXMuc2hvdyA9IGZ1bmN0aW9uKGksIHBhZ2UpIHsNCgkJdGhpcy5pID0gaTsNCgkJdGhpcy5wYWdlID0gcGFnZTsNCgkJc2VsZi51cGRhdGUoKTsNCiAgICByZXR1cm4gc2VsZjsNCgl9Ow0KDQogIC8qIFJlbW92ZXMgb2JqZWN0IGZyb20gbGlzdC4NCiAgKiBMb29wcyB0aHJvdWdoIHRoZSBsaXN0IGFuZCByZW1vdmVzIG9iamVjdHMgd2hlcmUNCiAgKiBwcm9wZXJ0eSAidmFsdWVuYW1lIiA9PT0gdmFsdWUNCiAgKi8NCiAgdGhpcy5yZW1vdmUgPSBmdW5jdGlvbih2YWx1ZU5hbWUsIHZhbHVlLCBvcHRpb25zKSB7DQogICAgdmFyIGZvdW5kID0gMDsNCiAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBzZWxmLml0ZW1zLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsNCiAgICAgIGlmIChzZWxmLml0ZW1zW2ldLnZhbHVlcygpW3ZhbHVlTmFtZV0gPT0gdmFsdWUpIHsNCiAgICAgICAgc2VsZi50ZW1wbGF0ZXIucmVtb3ZlKHNlbGYuaXRlbXNbaV0sIG9wdGlvbnMpOw0KICAgICAgICBzZWxmLml0ZW1zLnNwbGljZShpLDEpOw0KICAgICAgICBpbC0tOw0KICAgICAgICBpLS07DQogICAgICAgIGZvdW5kKys7DQogICAgICB9DQogICAgfQ0KICAgIHNlbGYudXBkYXRlKCk7DQogICAgcmV0dXJuIGZvdW5kOw0KICB9Ow0KDQogIC8qIEdldHMgdGhlIG9iamVjdHMgaW4gdGhlIGxpc3Qgd2hpY2gNCiAgKiBwcm9wZXJ0eSAidmFsdWVOYW1lIiA9PT0gdmFsdWUNCiAgKi8NCiAgdGhpcy5nZXQgPSBmdW5jdGlvbih2YWx1ZU5hbWUsIHZhbHVlKSB7DQogICAgdmFyIG1hdGNoZWRJdGVtcyA9IFtdOw0KICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IHNlbGYuaXRlbXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zW2ldOw0KICAgICAgaWYgKGl0ZW0udmFsdWVzKClbdmFsdWVOYW1lXSA9PSB2YWx1ZSkgew0KICAgICAgICBtYXRjaGVkSXRlbXMucHVzaChpdGVtKTsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG1hdGNoZWRJdGVtczsNCiAgfTsNCg0KICAvKg0KICAqIEdldCBzaXplIG9mIHRoZSBsaXN0DQogICovDQogIHRoaXMuc2l6ZSA9IGZ1bmN0aW9uKCkgew0KICAgIHJldHVybiBzZWxmLml0ZW1zLmxlbmd0aDsNCiAgfTsNCg0KICAvKg0KICAqIFJlbW92ZXMgYWxsIGl0ZW1zIGZyb20gdGhlIGxpc3QNCiAgKi8NCiAgdGhpcy5jbGVhciA9IGZ1bmN0aW9uKCkgew0KICAgIHNlbGYudGVtcGxhdGVyLmNsZWFyKCk7DQogICAgc2VsZi5pdGVtcyA9IFtdOw0KICAgIHJldHVybiBzZWxmOw0KICB9Ow0KDQogIHRoaXMub24gPSBmdW5jdGlvbihldmVudCwgY2FsbGJhY2spIHsNCiAgICBzZWxmLmhhbmRsZXJzW2V2ZW50XS5wdXNoKGNhbGxiYWNrKTsNCiAgICByZXR1cm4gc2VsZjsNCiAgfTsNCg0KICB0aGlzLm9mZiA9IGZ1bmN0aW9uKGV2ZW50LCBjYWxsYmFjaykgew0KICAgIHZhciBlID0gc2VsZi5oYW5kbGVyc1tldmVudF07DQogICAgdmFyIGluZGV4ID0gaW5kZXhPZihlLCBjYWxsYmFjayk7DQogICAgaWYgKGluZGV4ID4gLTEpIHsNCiAgICAgIGUuc3BsaWNlKGluZGV4LCAxKTsNCiAgICB9DQogICAgcmV0dXJuIHNlbGY7DQogIH07DQoNCiAgdGhpcy50cmlnZ2VyID0gZnVuY3Rpb24oZXZlbnQpIHsNCiAgICB2YXIgaSA9IHNlbGYuaGFuZGxlcnNbZXZlbnRdLmxlbmd0aDsNCiAgICB3aGlsZShpLS0pIHsNCiAgICAgIHNlbGYuaGFuZGxlcnNbZXZlbnRdW2ldKHNlbGYpOw0KICAgIH0NCiAgICByZXR1cm4gc2VsZjsNCiAgfTsNCg0KICB0aGlzLnJlc2V0ID0gew0KICAgIGZpbHRlcjogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgaXMgPSBzZWxmLml0ZW1zLA0KICAgICAgICBpbCA9IGlzLmxlbmd0aDsNCiAgICAgIHdoaWxlIChpbC0tKSB7DQogICAgICAgIGlzW2lsXS5maWx0ZXJlZCA9IGZhbHNlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHNlbGY7DQogICAgfSwNCiAgICBzZWFyY2g6IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIGlzID0gc2VsZi5pdGVtcywNCiAgICAgICAgaWwgPSBpcy5sZW5ndGg7DQogICAgICB3aGlsZSAoaWwtLSkgew0KICAgICAgICBpc1tpbF0uZm91bmQgPSBmYWxzZTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBzZWxmOw0KICAgIH0NCiAgfTsNCg0KICB0aGlzLnVwZGF0ZSA9IGZ1bmN0aW9uKCkgew0KICAgIHZhciBpcyA9IHNlbGYuaXRlbXMsDQoJCQlpbCA9IGlzLmxlbmd0aDsNCg0KICAgIHNlbGYudmlzaWJsZUl0ZW1zID0gW107DQogICAgc2VsZi5tYXRjaGluZ0l0ZW1zID0gW107DQogICAgc2VsZi50ZW1wbGF0ZXIuY2xlYXIoKTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlsOyBpKyspIHsNCiAgICAgIGlmIChpc1tpXS5tYXRjaGluZygpICYmICgoc2VsZi5tYXRjaGluZ0l0ZW1zLmxlbmd0aCsxKSA+PSBzZWxmLmkgJiYgc2VsZi52aXNpYmxlSXRlbXMubGVuZ3RoIDwgc2VsZi5wYWdlKSkgew0KICAgICAgICBpc1tpXS5zaG93KCk7DQogICAgICAgIHNlbGYudmlzaWJsZUl0ZW1zLnB1c2goaXNbaV0pOw0KICAgICAgICBzZWxmLm1hdGNoaW5nSXRlbXMucHVzaChpc1tpXSk7DQogICAgICB9IGVsc2UgaWYgKGlzW2ldLm1hdGNoaW5nKCkpIHsNCiAgICAgICAgc2VsZi5tYXRjaGluZ0l0ZW1zLnB1c2goaXNbaV0pOw0KICAgICAgICBpc1tpXS5oaWRlKCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBpc1tpXS5oaWRlKCk7DQogICAgICB9DQogICAgfQ0KICAgIHNlbGYudHJpZ2dlcigndXBkYXRlZCcpOw0KICAgIHJldHVybiBzZWxmOw0KICB9Ow0KDQogIGluaXQuc3RhcnQoKTsNCn07DQoNCg0KLy8gQU1EIHN1cHBvcnQNCmlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsNCiAgZGVmaW5lKGZ1bmN0aW9uICgpIHsgcmV0dXJuIExpc3Q7IH0pOw0KfQ0KbW9kdWxlLmV4cG9ydHMgPSBMaXN0Ow0Kd2luZG93Lkxpc3QgPSBMaXN0Ow0KDQp9KSh3aW5kb3cpOw0KDQp9LHsiLi9zcmMvYWRkLWFzeW5jIjoyLCIuL3NyYy9maWx0ZXIiOjMsIi4vc3JjL2l0ZW0iOjQsIi4vc3JjL3BhcnNlIjo1LCIuL3NyYy9zZWFyY2giOjYsIi4vc3JjL3NvcnQiOjcsIi4vc3JjL3RlbXBsYXRlciI6OCwiLi9zcmMvdXRpbHMvY2xhc3NlcyI6OSwiLi9zcmMvdXRpbHMvZXZlbnRzIjoxMCwiLi9zcmMvdXRpbHMvZXh0ZW5kIjoxMSwiLi9zcmMvdXRpbHMvZ2V0LWF0dHJpYnV0ZSI6MTIsIi4vc3JjL3V0aWxzL2dldC1ieS1jbGFzcyI6MTMsIi4vc3JjL3V0aWxzL2luZGV4LW9mIjoxNCwiLi9zcmMvdXRpbHMvbmF0dXJhbC1zb3J0IjoxNSwiLi9zcmMvdXRpbHMvdG8tYXJyYXkiOjE2LCIuL3NyYy91dGlscy90by1zdHJpbmciOjE3fV0sMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGxpc3QpIHsNCiAgdmFyIGFkZEFzeW5jID0gZnVuY3Rpb24odmFsdWVzLCBjYWxsYmFjaywgaXRlbXMpIHsNCiAgICB2YXIgdmFsdWVzVG9BZGQgPSB2YWx1ZXMuc3BsaWNlKDAsIDUwKTsNCiAgICBpdGVtcyA9IGl0ZW1zIHx8IFtdOw0KICAgIGl0ZW1zID0gaXRlbXMuY29uY2F0KGxpc3QuYWRkKHZhbHVlc1RvQWRkKSk7DQogICAgaWYgKHZhbHVlcy5sZW5ndGggPiAwKSB7DQogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICBhZGRBc3luYyh2YWx1ZXMsIGNhbGxiYWNrLCBpdGVtcyk7DQogICAgICB9LCAxKTsNCiAgICB9IGVsc2Ugew0KICAgICAgbGlzdC51cGRhdGUoKTsNCiAgICAgIGNhbGxiYWNrKGl0ZW1zKTsNCiAgICB9DQogIH07DQogIHJldHVybiBhZGRBc3luYzsNCn07DQoNCn0se31dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihsaXN0KSB7DQoNCiAgLy8gQWRkIGhhbmRsZXJzDQogIGxpc3QuaGFuZGxlcnMuZmlsdGVyU3RhcnQgPSBsaXN0LmhhbmRsZXJzLmZpbHRlclN0YXJ0IHx8IFtdOw0KICBsaXN0LmhhbmRsZXJzLmZpbHRlckNvbXBsZXRlID0gbGlzdC5oYW5kbGVycy5maWx0ZXJDb21wbGV0ZSB8fCBbXTsNCg0KICByZXR1cm4gZnVuY3Rpb24oZmlsdGVyRnVuY3Rpb24pIHsNCiAgICBsaXN0LnRyaWdnZXIoJ2ZpbHRlclN0YXJ0Jyk7DQogICAgbGlzdC5pID0gMTsgLy8gUmVzZXQgcGFnaW5nDQogICAgbGlzdC5yZXNldC5maWx0ZXIoKTsNCiAgICBpZiAoZmlsdGVyRnVuY3Rpb24gPT09IHVuZGVmaW5lZCkgew0KICAgICAgbGlzdC5maWx0ZXJlZCA9IGZhbHNlOw0KICAgIH0gZWxzZSB7DQogICAgICBsaXN0LmZpbHRlcmVkID0gdHJ1ZTsNCiAgICAgIHZhciBpcyA9IGxpc3QuaXRlbXM7DQogICAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBpcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICAgIHZhciBpdGVtID0gaXNbaV07DQogICAgICAgIGlmIChmaWx0ZXJGdW5jdGlvbihpdGVtKSkgew0KICAgICAgICAgIGl0ZW0uZmlsdGVyZWQgPSB0cnVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGl0ZW0uZmlsdGVyZWQgPSBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICBsaXN0LnVwZGF0ZSgpOw0KICAgIGxpc3QudHJpZ2dlcignZmlsdGVyQ29tcGxldGUnKTsNCiAgICByZXR1cm4gbGlzdC52aXNpYmxlSXRlbXM7DQogIH07DQp9Ow0KDQp9LHt9XSw0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obGlzdCkgew0KICByZXR1cm4gZnVuY3Rpb24oaW5pdFZhbHVlcywgZWxlbWVudCwgbm90Q3JlYXRlKSB7DQogICAgdmFyIGl0ZW0gPSB0aGlzOw0KDQogICAgdGhpcy5fdmFsdWVzID0ge307DQoNCiAgICB0aGlzLmZvdW5kID0gZmFsc2U7IC8vIFNob3cgaWYgbGlzdC5zZWFyY2hlZCA9PSB0cnVlIGFuZCB0aGlzLmZvdW5kID09IHRydWUNCiAgICB0aGlzLmZpbHRlcmVkID0gZmFsc2U7Ly8gU2hvdyBpZiBsaXN0LmZpbHRlcmVkID09IHRydWUgYW5kIHRoaXMuZmlsdGVyZWQgPT0gdHJ1ZQ0KDQogICAgdmFyIGluaXQgPSBmdW5jdGlvbihpbml0VmFsdWVzLCBlbGVtZW50LCBub3RDcmVhdGUpIHsNCiAgICAgIGlmIChlbGVtZW50ID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgaWYgKG5vdENyZWF0ZSkgew0KICAgICAgICAgIGl0ZW0udmFsdWVzKGluaXRWYWx1ZXMsIG5vdENyZWF0ZSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaXRlbS52YWx1ZXMoaW5pdFZhbHVlcyk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGl0ZW0uZWxtID0gZWxlbWVudDsNCiAgICAgICAgdmFyIHZhbHVlcyA9IGxpc3QudGVtcGxhdGVyLmdldChpdGVtLCBpbml0VmFsdWVzKTsNCiAgICAgICAgaXRlbS52YWx1ZXModmFsdWVzKTsNCiAgICAgIH0NCiAgICB9Ow0KDQogICAgdGhpcy52YWx1ZXMgPSBmdW5jdGlvbihuZXdWYWx1ZXMsIG5vdENyZWF0ZSkgew0KICAgICAgaWYgKG5ld1ZhbHVlcyAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgIGZvcih2YXIgbmFtZSBpbiBuZXdWYWx1ZXMpIHsNCiAgICAgICAgICBpdGVtLl92YWx1ZXNbbmFtZV0gPSBuZXdWYWx1ZXNbbmFtZV07DQogICAgICAgIH0NCiAgICAgICAgaWYgKG5vdENyZWF0ZSAhPT0gdHJ1ZSkgew0KICAgICAgICAgIGxpc3QudGVtcGxhdGVyLnNldChpdGVtLCBpdGVtLnZhbHVlcygpKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGl0ZW0uX3ZhbHVlczsNCiAgICAgIH0NCiAgICB9Ow0KDQogICAgdGhpcy5zaG93ID0gZnVuY3Rpb24oKSB7DQogICAgICBsaXN0LnRlbXBsYXRlci5zaG93KGl0ZW0pOw0KICAgIH07DQoNCiAgICB0aGlzLmhpZGUgPSBmdW5jdGlvbigpIHsNCiAgICAgIGxpc3QudGVtcGxhdGVyLmhpZGUoaXRlbSk7DQogICAgfTsNCg0KICAgIHRoaXMubWF0Y2hpbmcgPSBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiAoDQogICAgICAgIChsaXN0LmZpbHRlcmVkICYmIGxpc3Quc2VhcmNoZWQgJiYgaXRlbS5mb3VuZCAmJiBpdGVtLmZpbHRlcmVkKSB8fA0KICAgICAgICAobGlzdC5maWx0ZXJlZCAmJiAhbGlzdC5zZWFyY2hlZCAmJiBpdGVtLmZpbHRlcmVkKSB8fA0KICAgICAgICAoIWxpc3QuZmlsdGVyZWQgJiYgbGlzdC5zZWFyY2hlZCAmJiBpdGVtLmZvdW5kKSB8fA0KICAgICAgICAoIWxpc3QuZmlsdGVyZWQgJiYgIWxpc3Quc2VhcmNoZWQpDQogICAgICApOw0KICAgIH07DQoNCiAgICB0aGlzLnZpc2libGUgPSBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiAoaXRlbS5lbG0gJiYgKGl0ZW0uZWxtLnBhcmVudE5vZGUgPT0gbGlzdC5saXN0KSkgPyB0cnVlIDogZmFsc2U7DQogICAgfTsNCg0KICAgIGluaXQoaW5pdFZhbHVlcywgZWxlbWVudCwgbm90Q3JlYXRlKTsNCiAgfTsNCn07DQoNCn0se31dLDU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihsaXN0KSB7DQoNCiAgdmFyIEl0ZW0gPSByZXF1aXJlKCcuL2l0ZW0nKShsaXN0KTsNCg0KICB2YXIgZ2V0Q2hpbGRyZW4gPSBmdW5jdGlvbihwYXJlbnQpIHsNCiAgICB2YXIgbm9kZXMgPSBwYXJlbnQuY2hpbGROb2RlcywNCiAgICAgIGl0ZW1zID0gW107DQogICAgZm9yICh2YXIgaSA9IDAsIGlsID0gbm9kZXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgLy8gT25seSB0ZXh0bm9kZXMgaGF2ZSBhIGRhdGEgYXR0cmlidXRlDQogICAgICBpZiAobm9kZXNbaV0uZGF0YSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIGl0ZW1zLnB1c2gobm9kZXNbaV0pOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gaXRlbXM7DQogIH07DQoNCiAgdmFyIHBhcnNlID0gZnVuY3Rpb24oaXRlbUVsZW1lbnRzLCB2YWx1ZU5hbWVzKSB7DQogICAgZm9yICh2YXIgaSA9IDAsIGlsID0gaXRlbUVsZW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsNCiAgICAgIGxpc3QuaXRlbXMucHVzaChuZXcgSXRlbSh2YWx1ZU5hbWVzLCBpdGVtRWxlbWVudHNbaV0pKTsNCiAgICB9DQogIH07DQogIHZhciBwYXJzZUFzeW5jID0gZnVuY3Rpb24oaXRlbUVsZW1lbnRzLCB2YWx1ZU5hbWVzKSB7DQogICAgdmFyIGl0ZW1zVG9JbmRleCA9IGl0ZW1FbGVtZW50cy5zcGxpY2UoMCwgNTApOyAvLyBUT0RPOiBJZiA8IDEwMCBpdGVtcywgd2hhdCBoYXBwZW5zIGluIElFIGV0Yz8NCiAgICBwYXJzZShpdGVtc1RvSW5kZXgsIHZhbHVlTmFtZXMpOw0KICAgIGlmIChpdGVtRWxlbWVudHMubGVuZ3RoID4gMCkgew0KICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgcGFyc2VBc3luYyhpdGVtRWxlbWVudHMsIHZhbHVlTmFtZXMpOw0KICAgICAgfSwgMSk7DQogICAgfSBlbHNlIHsNCiAgICAgIGxpc3QudXBkYXRlKCk7DQogICAgICBsaXN0LnRyaWdnZXIoJ3BhcnNlQ29tcGxldGUnKTsNCiAgICB9DQogIH07DQoNCiAgbGlzdC5oYW5kbGVycy5wYXJzZUNvbXBsZXRlID0gbGlzdC5oYW5kbGVycy5wYXJzZUNvbXBsZXRlIHx8IFtdOw0KDQogIHJldHVybiBmdW5jdGlvbigpIHsNCiAgICB2YXIgaXRlbXNUb0luZGV4ID0gZ2V0Q2hpbGRyZW4obGlzdC5saXN0KSwNCiAgICAgIHZhbHVlTmFtZXMgPSBsaXN0LnZhbHVlTmFtZXM7DQoNCiAgICBpZiAobGlzdC5pbmRleEFzeW5jKSB7DQogICAgICBwYXJzZUFzeW5jKGl0ZW1zVG9JbmRleCwgdmFsdWVOYW1lcyk7DQogICAgfSBlbHNlIHsNCiAgICAgIHBhcnNlKGl0ZW1zVG9JbmRleCwgdmFsdWVOYW1lcyk7DQogICAgfQ0KICB9Ow0KfTsNCg0KfSx7Ii4vaXRlbSI6NH1dLDY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihsaXN0KSB7DQogIHZhciBpdGVtLA0KICAgIHRleHQsDQogICAgY29sdW1ucywNCiAgICBzZWFyY2hTdHJpbmcsDQogICAgY3VzdG9tU2VhcmNoOw0KDQogIHZhciBwcmVwYXJlID0gew0KICAgIHJlc2V0TGlzdDogZnVuY3Rpb24oKSB7DQogICAgICBsaXN0LmkgPSAxOw0KICAgICAgbGlzdC50ZW1wbGF0ZXIuY2xlYXIoKTsNCiAgICAgIGN1c3RvbVNlYXJjaCA9IHVuZGVmaW5lZDsNCiAgICB9LA0KICAgIHNldE9wdGlvbnM6IGZ1bmN0aW9uKGFyZ3MpIHsNCiAgICAgIGlmIChhcmdzLmxlbmd0aCA9PSAyICYmIGFyZ3NbMV0gaW5zdGFuY2VvZiBBcnJheSkgew0KICAgICAgICBjb2x1bW5zID0gYXJnc1sxXTsNCiAgICAgIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPT0gMiAmJiB0eXBlb2YoYXJnc1sxXSkgPT0gImZ1bmN0aW9uIikgew0KICAgICAgICBjb2x1bW5zID0gdW5kZWZpbmVkOw0KICAgICAgICBjdXN0b21TZWFyY2ggPSBhcmdzWzFdOw0KICAgICAgfSBlbHNlIGlmIChhcmdzLmxlbmd0aCA9PSAzKSB7DQogICAgICAgIGNvbHVtbnMgPSBhcmdzWzFdOw0KICAgICAgICBjdXN0b21TZWFyY2ggPSBhcmdzWzJdOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29sdW1ucyA9IHVuZGVmaW5lZDsNCiAgICAgIH0NCiAgICB9LA0KICAgIHNldENvbHVtbnM6IGZ1bmN0aW9uKCkgew0KICAgICAgaWYgKGxpc3QuaXRlbXMubGVuZ3RoID09PSAwKSByZXR1cm47DQogICAgICBpZiAoY29sdW1ucyA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIGNvbHVtbnMgPSAobGlzdC5zZWFyY2hDb2x1bW5zID09PSB1bmRlZmluZWQpID8gcHJlcGFyZS50b0FycmF5KGxpc3QuaXRlbXNbMF0udmFsdWVzKCkpIDogbGlzdC5zZWFyY2hDb2x1bW5zOw0KICAgICAgfQ0KICAgIH0sDQogICAgc2V0U2VhcmNoU3RyaW5nOiBmdW5jdGlvbihzKSB7DQogICAgICBzID0gbGlzdC51dGlscy50b1N0cmluZyhzKS50b0xvd2VyQ2FzZSgpOw0KICAgICAgcyA9IHMucmVwbGFjZSgvWy1bXF17fSgpKis/LixcXF4kfCNdL2csICJcXCQmIik7IC8vIEVzY2FwZSByZWd1bGFyIGV4cHJlc3Npb24gY2hhcmFjdGVycw0KICAgICAgc2VhcmNoU3RyaW5nID0gczsNCiAgICB9LA0KICAgIHRvQXJyYXk6IGZ1bmN0aW9uKHZhbHVlcykgew0KICAgICAgdmFyIHRtcENvbHVtbiA9IFtdOw0KICAgICAgZm9yICh2YXIgbmFtZSBpbiB2YWx1ZXMpIHsNCiAgICAgICAgdG1wQ29sdW1uLnB1c2gobmFtZSk7DQogICAgICB9DQogICAgICByZXR1cm4gdG1wQ29sdW1uOw0KICAgIH0NCiAgfTsNCiAgdmFyIHNlYXJjaCA9IHsNCiAgICBsaXN0OiBmdW5jdGlvbigpIHsNCiAgICAgIGZvciAodmFyIGsgPSAwLCBrbCA9IGxpc3QuaXRlbXMubGVuZ3RoOyBrIDwga2w7IGsrKykgew0KICAgICAgICBzZWFyY2guaXRlbShsaXN0Lml0ZW1zW2tdKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGl0ZW06IGZ1bmN0aW9uKGl0ZW0pIHsNCiAgICAgIGl0ZW0uZm91bmQgPSBmYWxzZTsNCiAgICAgIGZvciAodmFyIGogPSAwLCBqbCA9IGNvbHVtbnMubGVuZ3RoOyBqIDwgamw7IGorKykgew0KICAgICAgICBpZiAoc2VhcmNoLnZhbHVlcyhpdGVtLnZhbHVlcygpLCBjb2x1bW5zW2pdKSkgew0KICAgICAgICAgIGl0ZW0uZm91bmQgPSB0cnVlOw0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgdmFsdWVzOiBmdW5jdGlvbih2YWx1ZXMsIGNvbHVtbikgew0KICAgICAgaWYgKHZhbHVlcy5oYXNPd25Qcm9wZXJ0eShjb2x1bW4pKSB7DQogICAgICAgIHRleHQgPSBsaXN0LnV0aWxzLnRvU3RyaW5nKHZhbHVlc1tjb2x1bW5dKS50b0xvd2VyQ2FzZSgpOw0KICAgICAgICBpZiAoKHNlYXJjaFN0cmluZyAhPT0gIiIpICYmICh0ZXh0LnNlYXJjaChzZWFyY2hTdHJpbmcpID4gLTEpKSB7DQogICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9LA0KICAgIHJlc2V0OiBmdW5jdGlvbigpIHsNCiAgICAgIGxpc3QucmVzZXQuc2VhcmNoKCk7DQogICAgICBsaXN0LnNlYXJjaGVkID0gZmFsc2U7DQogICAgfQ0KICB9Ow0KDQogIHZhciBzZWFyY2hNZXRob2QgPSBmdW5jdGlvbihzdHIpIHsNCiAgICBsaXN0LnRyaWdnZXIoJ3NlYXJjaFN0YXJ0Jyk7DQoNCiAgICBwcmVwYXJlLnJlc2V0TGlzdCgpOw0KICAgIHByZXBhcmUuc2V0U2VhcmNoU3RyaW5nKHN0cik7DQogICAgcHJlcGFyZS5zZXRPcHRpb25zKGFyZ3VtZW50cyk7IC8vIHN0ciwgY29sc3xzZWFyY2hGdW5jdGlvbiwgc2VhcmNoRnVuY3Rpb24NCiAgICBwcmVwYXJlLnNldENvbHVtbnMoKTsNCg0KICAgIGlmIChzZWFyY2hTdHJpbmcgPT09ICIiICkgew0KICAgICAgc2VhcmNoLnJlc2V0KCk7DQogICAgfSBlbHNlIHsNCiAgICAgIGxpc3Quc2VhcmNoZWQgPSB0cnVlOw0KICAgICAgaWYgKGN1c3RvbVNlYXJjaCkgew0KICAgICAgICBjdXN0b21TZWFyY2goc2VhcmNoU3RyaW5nLCBjb2x1bW5zKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHNlYXJjaC5saXN0KCk7DQogICAgICB9DQogICAgfQ0KDQogICAgbGlzdC51cGRhdGUoKTsNCiAgICBsaXN0LnRyaWdnZXIoJ3NlYXJjaENvbXBsZXRlJyk7DQogICAgcmV0dXJuIGxpc3QudmlzaWJsZUl0ZW1zOw0KICB9Ow0KDQogIGxpc3QuaGFuZGxlcnMuc2VhcmNoU3RhcnQgPSBsaXN0LmhhbmRsZXJzLnNlYXJjaFN0YXJ0IHx8IFtdOw0KICBsaXN0LmhhbmRsZXJzLnNlYXJjaENvbXBsZXRlID0gbGlzdC5oYW5kbGVycy5zZWFyY2hDb21wbGV0ZSB8fCBbXTsNCg0KICBsaXN0LnV0aWxzLmV2ZW50cy5iaW5kKGxpc3QudXRpbHMuZ2V0QnlDbGFzcyhsaXN0Lmxpc3RDb250YWluZXIsIGxpc3Quc2VhcmNoQ2xhc3MpLCAna2V5dXAnLCBmdW5jdGlvbihlKSB7DQogICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudCwgLy8gSUUgaGF2ZSBzcmNFbGVtZW50DQogICAgICBhbHJlYWR5Q2xlYXJlZCA9ICh0YXJnZXQudmFsdWUgPT09ICIiICYmICFsaXN0LnNlYXJjaGVkKTsNCiAgICBpZiAoIWFscmVhZHlDbGVhcmVkKSB7IC8vIElmIG9uaW5wdXQgYWxyZWFkeSBoYXZlIHJlc2V0dGVkIHRoZSBsaXN0LCBkbyBub3RoaW5nDQogICAgICBzZWFyY2hNZXRob2QodGFyZ2V0LnZhbHVlKTsNCiAgICB9DQogIH0pOw0KDQogIC8vIFVzZWQgdG8gZGV0ZWN0IGNsaWNrIG9uIEhUTUw1IGNsZWFyIGJ1dHRvbg0KICBsaXN0LnV0aWxzLmV2ZW50cy5iaW5kKGxpc3QudXRpbHMuZ2V0QnlDbGFzcyhsaXN0Lmxpc3RDb250YWluZXIsIGxpc3Quc2VhcmNoQ2xhc3MpLCAnaW5wdXQnLCBmdW5jdGlvbihlKSB7DQogICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDsNCiAgICBpZiAodGFyZ2V0LnZhbHVlID09PSAiIikgew0KICAgICAgc2VhcmNoTWV0aG9kKCcnKTsNCiAgICB9DQogIH0pOw0KDQogIHJldHVybiBzZWFyY2hNZXRob2Q7DQp9Ow0KDQp9LHt9XSw3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obGlzdCkgew0KICBsaXN0LnNvcnRGdW5jdGlvbiA9IGxpc3Quc29ydEZ1bmN0aW9uIHx8IGZ1bmN0aW9uKGl0ZW1BLCBpdGVtQiwgb3B0aW9ucykgew0KICAgIG9wdGlvbnMuZGVzYyA9IG9wdGlvbnMub3JkZXIgPT0gImRlc2MiID8gdHJ1ZSA6IGZhbHNlOyAvLyBOYXR1cmFsIHNvcnQgdXNlcyB0aGlzIGZvcm1hdA0KICAgIHJldHVybiBsaXN0LnV0aWxzLm5hdHVyYWxTb3J0KGl0ZW1BLnZhbHVlcygpW29wdGlvbnMudmFsdWVOYW1lXSwgaXRlbUIudmFsdWVzKClbb3B0aW9ucy52YWx1ZU5hbWVdLCBvcHRpb25zKTsNCiAgfTsNCg0KICB2YXIgYnV0dG9ucyA9IHsNCiAgICBlbHM6IHVuZGVmaW5lZCwNCiAgICBjbGVhcjogZnVuY3Rpb24oKSB7DQogICAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBidXR0b25zLmVscy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICAgIGxpc3QudXRpbHMuY2xhc3NlcyhidXR0b25zLmVsc1tpXSkucmVtb3ZlKCdhc2MnKTsNCiAgICAgICAgbGlzdC51dGlscy5jbGFzc2VzKGJ1dHRvbnMuZWxzW2ldKS5yZW1vdmUoJ2Rlc2MnKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGdldE9yZGVyOiBmdW5jdGlvbihidG4pIHsNCiAgICAgIHZhciBwcmVkZWZpbmVkT3JkZXIgPSBsaXN0LnV0aWxzLmdldEF0dHJpYnV0ZShidG4sICdkYXRhLW9yZGVyJyk7DQogICAgICBpZiAocHJlZGVmaW5lZE9yZGVyID09ICJhc2MiIHx8IHByZWRlZmluZWRPcmRlciA9PSAiZGVzYyIpIHsNCiAgICAgICAgcmV0dXJuIHByZWRlZmluZWRPcmRlcjsNCiAgICAgIH0gZWxzZSBpZiAobGlzdC51dGlscy5jbGFzc2VzKGJ0bikuaGFzKCdkZXNjJykpIHsNCiAgICAgICAgcmV0dXJuICJhc2MiOw0KICAgICAgfSBlbHNlIGlmIChsaXN0LnV0aWxzLmNsYXNzZXMoYnRuKS5oYXMoJ2FzYycpKSB7DQogICAgICAgIHJldHVybiAiZGVzYyI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gImFzYyI7DQogICAgICB9DQogICAgfSwNCiAgICBnZXRJblNlbnNpdGl2ZTogZnVuY3Rpb24oYnRuLCBvcHRpb25zKSB7DQogICAgICB2YXIgaW5zZW5zaXRpdmUgPSBsaXN0LnV0aWxzLmdldEF0dHJpYnV0ZShidG4sICdkYXRhLWluc2Vuc2l0aXZlJyk7DQogICAgICBpZiAoaW5zZW5zaXRpdmUgPT09ICJmYWxzZSIpIHsNCiAgICAgICAgb3B0aW9ucy5pbnNlbnNpdGl2ZSA9IGZhbHNlOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgb3B0aW9ucy5pbnNlbnNpdGl2ZSA9IHRydWU7DQogICAgICB9DQogICAgfSwNCiAgICBzZXRPcmRlcjogZnVuY3Rpb24ob3B0aW9ucykgew0KICAgICAgZm9yICh2YXIgaSA9IDAsIGlsID0gYnV0dG9ucy5lbHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgICB2YXIgYnRuID0gYnV0dG9ucy5lbHNbaV07DQogICAgICAgIGlmIChsaXN0LnV0aWxzLmdldEF0dHJpYnV0ZShidG4sICdkYXRhLXNvcnQnKSAhPT0gb3B0aW9ucy52YWx1ZU5hbWUpIHsNCiAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgcHJlZGVmaW5lZE9yZGVyID0gbGlzdC51dGlscy5nZXRBdHRyaWJ1dGUoYnRuLCAnZGF0YS1vcmRlcicpOw0KICAgICAgICBpZiAocHJlZGVmaW5lZE9yZGVyID09ICJhc2MiIHx8IHByZWRlZmluZWRPcmRlciA9PSAiZGVzYyIpIHsNCiAgICAgICAgICBpZiAocHJlZGVmaW5lZE9yZGVyID09IG9wdGlvbnMub3JkZXIpIHsNCiAgICAgICAgICAgIGxpc3QudXRpbHMuY2xhc3NlcyhidG4pLmFkZChvcHRpb25zLm9yZGVyKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbGlzdC51dGlscy5jbGFzc2VzKGJ0bikuYWRkKG9wdGlvbnMub3JkZXIpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9Ow0KICB2YXIgc29ydCA9IGZ1bmN0aW9uKCkgew0KICAgIGxpc3QudHJpZ2dlcignc29ydFN0YXJ0Jyk7DQogICAgdmFyIG9wdGlvbnMgPSB7fTsNCg0KICAgIHZhciB0YXJnZXQgPSBhcmd1bWVudHNbMF0uY3VycmVudFRhcmdldCB8fCBhcmd1bWVudHNbMF0uc3JjRWxlbWVudCB8fCB1bmRlZmluZWQ7DQoNCiAgICBpZiAodGFyZ2V0KSB7DQogICAgICBvcHRpb25zLnZhbHVlTmFtZSA9IGxpc3QudXRpbHMuZ2V0QXR0cmlidXRlKHRhcmdldCwgJ2RhdGEtc29ydCcpOw0KICAgICAgYnV0dG9ucy5nZXRJblNlbnNpdGl2ZSh0YXJnZXQsIG9wdGlvbnMpOw0KICAgICAgb3B0aW9ucy5vcmRlciA9IGJ1dHRvbnMuZ2V0T3JkZXIodGFyZ2V0KTsNCiAgICB9IGVsc2Ugew0KICAgICAgb3B0aW9ucyA9IGFyZ3VtZW50c1sxXSB8fCBvcHRpb25zOw0KICAgICAgb3B0aW9ucy52YWx1ZU5hbWUgPSBhcmd1bWVudHNbMF07DQogICAgICBvcHRpb25zLm9yZGVyID0gb3B0aW9ucy5vcmRlciB8fCAiYXNjIjsNCiAgICAgIG9wdGlvbnMuaW5zZW5zaXRpdmUgPSAodHlwZW9mIG9wdGlvbnMuaW5zZW5zaXRpdmUgPT0gInVuZGVmaW5lZCIpID8gdHJ1ZSA6IG9wdGlvbnMuaW5zZW5zaXRpdmU7DQogICAgfQ0KICAgIGJ1dHRvbnMuY2xlYXIoKTsNCiAgICBidXR0b25zLnNldE9yZGVyKG9wdGlvbnMpOw0KDQogICAgb3B0aW9ucy5zb3J0RnVuY3Rpb24gPSBvcHRpb25zLnNvcnRGdW5jdGlvbiB8fCBsaXN0LnNvcnRGdW5jdGlvbjsNCiAgICBsaXN0Lml0ZW1zLnNvcnQoZnVuY3Rpb24oYSwgYikgew0KICAgICAgdmFyIG11bHQgPSAob3B0aW9ucy5vcmRlciA9PT0gJ2Rlc2MnKSA/IC0xIDogMTsNCiAgICAgIHJldHVybiAob3B0aW9ucy5zb3J0RnVuY3Rpb24oYSwgYiwgb3B0aW9ucykgKiBtdWx0KTsNCiAgICB9KTsNCiAgICBsaXN0LnVwZGF0ZSgpOw0KICAgIGxpc3QudHJpZ2dlcignc29ydENvbXBsZXRlJyk7DQogIH07DQoNCiAgLy8gQWRkIGhhbmRsZXJzDQogIGxpc3QuaGFuZGxlcnMuc29ydFN0YXJ0ID0gbGlzdC5oYW5kbGVycy5zb3J0U3RhcnQgfHwgW107DQogIGxpc3QuaGFuZGxlcnMuc29ydENvbXBsZXRlID0gbGlzdC5oYW5kbGVycy5zb3J0Q29tcGxldGUgfHwgW107DQoNCiAgYnV0dG9ucy5lbHMgPSBsaXN0LnV0aWxzLmdldEJ5Q2xhc3MobGlzdC5saXN0Q29udGFpbmVyLCBsaXN0LnNvcnRDbGFzcyk7DQogIGxpc3QudXRpbHMuZXZlbnRzLmJpbmQoYnV0dG9ucy5lbHMsICdjbGljaycsIHNvcnQpOw0KICBsaXN0Lm9uKCdzZWFyY2hTdGFydCcsIGJ1dHRvbnMuY2xlYXIpOw0KICBsaXN0Lm9uKCdmaWx0ZXJTdGFydCcsIGJ1dHRvbnMuY2xlYXIpOw0KDQogIHJldHVybiBzb3J0Ow0KfTsNCg0KfSx7fV0sODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQp2YXIgVGVtcGxhdGVyID0gZnVuY3Rpb24obGlzdCkgew0KICB2YXIgaXRlbVNvdXJjZSwNCiAgICB0ZW1wbGF0ZXIgPSB0aGlzOw0KDQogIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7DQogICAgaXRlbVNvdXJjZSA9IHRlbXBsYXRlci5nZXRJdGVtU291cmNlKGxpc3QuaXRlbSk7DQogICAgaWYgKGl0ZW1Tb3VyY2UpIHsNCiAgICAgIGl0ZW1Tb3VyY2UgPSB0ZW1wbGF0ZXIuY2xlYXJTb3VyY2VJdGVtKGl0ZW1Tb3VyY2UsIGxpc3QudmFsdWVOYW1lcyk7DQogICAgfQ0KICB9Ow0KDQogIHRoaXMuY2xlYXJTb3VyY2VJdGVtID0gZnVuY3Rpb24oZWwsIHZhbHVlTmFtZXMpIHsNCiAgICBmb3IodmFyIGkgPSAwLCBpbCA9IHZhbHVlTmFtZXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgdmFyIGVsbTsNCiAgICAgIGlmICh2YWx1ZU5hbWVzW2ldLmRhdGEpIHsNCiAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpsID0gdmFsdWVOYW1lc1tpXS5kYXRhLmxlbmd0aDsgaiA8IGpsOyBqKyspIHsNCiAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtJyt2YWx1ZU5hbWVzW2ldLmRhdGFbal0sICcnKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICh2YWx1ZU5hbWVzW2ldLmF0dHIgJiYgdmFsdWVOYW1lc1tpXS5uYW1lKSB7DQogICAgICAgIGVsbSA9IGxpc3QudXRpbHMuZ2V0QnlDbGFzcyhlbCwgdmFsdWVOYW1lc1tpXS5uYW1lLCB0cnVlKTsNCiAgICAgICAgaWYgKGVsbSkgew0KICAgICAgICAgIGVsbS5zZXRBdHRyaWJ1dGUodmFsdWVOYW1lc1tpXS5hdHRyLCAiIik7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGVsbSA9IGxpc3QudXRpbHMuZ2V0QnlDbGFzcyhlbCwgdmFsdWVOYW1lc1tpXSwgdHJ1ZSk7DQogICAgICAgIGlmIChlbG0pIHsNCiAgICAgICAgICBlbG0uaW5uZXJIVE1MID0gIiI7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGVsbSA9IHVuZGVmaW5lZDsNCiAgICB9DQogICAgcmV0dXJuIGVsOw0KICB9Ow0KDQogIHRoaXMuZ2V0SXRlbVNvdXJjZSA9IGZ1bmN0aW9uKGl0ZW0pIHsNCiAgICBpZiAoaXRlbSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICB2YXIgbm9kZXMgPSBsaXN0Lmxpc3QuY2hpbGROb2RlcywNCiAgICAgICAgaXRlbXMgPSBbXTsNCg0KICAgICAgZm9yICh2YXIgaSA9IDAsIGlsID0gbm9kZXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgICAvLyBPbmx5IHRleHRub2RlcyBoYXZlIGEgZGF0YSBhdHRyaWJ1dGUNCiAgICAgICAgaWYgKG5vZGVzW2ldLmRhdGEgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgIHJldHVybiBub2Rlc1tpXS5jbG9uZU5vZGUodHJ1ZSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9IGVsc2UgaWYgKC88dHJbXHM+XS9nLmV4ZWMoaXRlbSkpIHsNCiAgICAgIHZhciB0Ym9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3Rib2R5Jyk7DQogICAgICB0Ym9keS5pbm5lckhUTUwgPSBpdGVtOw0KICAgICAgcmV0dXJuIHRib2R5LmZpcnN0Q2hpbGQ7DQogICAgfSBlbHNlIGlmIChpdGVtLmluZGV4T2YoIjwiKSAhPT0gLTEpIHsNCiAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgICAgIGRpdi5pbm5lckhUTUwgPSBpdGVtOw0KICAgICAgcmV0dXJuIGRpdi5maXJzdENoaWxkOw0KICAgIH0gZWxzZSB7DQogICAgICB2YXIgc291cmNlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobGlzdC5pdGVtKTsNCiAgICAgIGlmIChzb3VyY2UpIHsNCiAgICAgICAgcmV0dXJuIHNvdXJjZTsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgfTsNCg0KICB0aGlzLmdldCA9IGZ1bmN0aW9uKGl0ZW0sIHZhbHVlTmFtZXMpIHsNCiAgICB0ZW1wbGF0ZXIuY3JlYXRlKGl0ZW0pOw0KICAgIHZhciB2YWx1ZXMgPSB7fTsNCiAgICBmb3IodmFyIGkgPSAwLCBpbCA9IHZhbHVlTmFtZXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgdmFyIGVsbTsNCiAgICAgIGlmICh2YWx1ZU5hbWVzW2ldLmRhdGEpIHsNCiAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpsID0gdmFsdWVOYW1lc1tpXS5kYXRhLmxlbmd0aDsgaiA8IGpsOyBqKyspIHsNCiAgICAgICAgICB2YWx1ZXNbdmFsdWVOYW1lc1tpXS5kYXRhW2pdXSA9IGxpc3QudXRpbHMuZ2V0QXR0cmlidXRlKGl0ZW0uZWxtLCAnZGF0YS0nK3ZhbHVlTmFtZXNbaV0uZGF0YVtqXSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAodmFsdWVOYW1lc1tpXS5hdHRyICYmIHZhbHVlTmFtZXNbaV0ubmFtZSkgew0KICAgICAgICBlbG0gPSBsaXN0LnV0aWxzLmdldEJ5Q2xhc3MoaXRlbS5lbG0sIHZhbHVlTmFtZXNbaV0ubmFtZSwgdHJ1ZSk7DQogICAgICAgIHZhbHVlc1t2YWx1ZU5hbWVzW2ldLm5hbWVdID0gZWxtID8gbGlzdC51dGlscy5nZXRBdHRyaWJ1dGUoZWxtLCB2YWx1ZU5hbWVzW2ldLmF0dHIpIDogIiI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBlbG0gPSBsaXN0LnV0aWxzLmdldEJ5Q2xhc3MoaXRlbS5lbG0sIHZhbHVlTmFtZXNbaV0sIHRydWUpOw0KICAgICAgICB2YWx1ZXNbdmFsdWVOYW1lc1tpXV0gPSBlbG0gPyBlbG0uaW5uZXJIVE1MIDogIiI7DQogICAgICB9DQogICAgICBlbG0gPSB1bmRlZmluZWQ7DQogICAgfQ0KICAgIHJldHVybiB2YWx1ZXM7DQogIH07DQoNCiAgdGhpcy5zZXQgPSBmdW5jdGlvbihpdGVtLCB2YWx1ZXMpIHsNCiAgICB2YXIgZ2V0VmFsdWVOYW1lID0gZnVuY3Rpb24obmFtZSkgew0KICAgICAgZm9yICh2YXIgaSA9IDAsIGlsID0gbGlzdC52YWx1ZU5hbWVzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsNCiAgICAgICAgaWYgKGxpc3QudmFsdWVOYW1lc1tpXS5kYXRhKSB7DQogICAgICAgICAgdmFyIGRhdGEgPSBsaXN0LnZhbHVlTmFtZXNbaV0uZGF0YTsNCiAgICAgICAgICBmb3IgKHZhciBqID0gMCwgamwgPSBkYXRhLmxlbmd0aDsgaiA8IGpsOyBqKyspIHsNCiAgICAgICAgICAgIGlmIChkYXRhW2pdID09PSBuYW1lKSB7DQogICAgICAgICAgICAgIHJldHVybiB7IGRhdGE6IG5hbWUgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSBpZiAobGlzdC52YWx1ZU5hbWVzW2ldLmF0dHIgJiYgbGlzdC52YWx1ZU5hbWVzW2ldLm5hbWUgJiYgbGlzdC52YWx1ZU5hbWVzW2ldLm5hbWUgPT0gbmFtZSkgew0KICAgICAgICAgIHJldHVybiBsaXN0LnZhbHVlTmFtZXNbaV07DQogICAgICAgIH0gZWxzZSBpZiAobGlzdC52YWx1ZU5hbWVzW2ldID09PSBuYW1lKSB7DQogICAgICAgICAgcmV0dXJuIG5hbWU7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9Ow0KICAgIHZhciBzZXRWYWx1ZSA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7DQogICAgICB2YXIgZWxtOw0KICAgICAgdmFyIHZhbHVlTmFtZSA9IGdldFZhbHVlTmFtZShuYW1lKTsNCiAgICAgIGlmICghdmFsdWVOYW1lKQ0KICAgICAgICByZXR1cm47DQogICAgICBpZiAodmFsdWVOYW1lLmRhdGEpIHsNCiAgICAgICAgaXRlbS5lbG0uc2V0QXR0cmlidXRlKCdkYXRhLScrdmFsdWVOYW1lLmRhdGEsIHZhbHVlKTsNCiAgICAgIH0gZWxzZSBpZiAodmFsdWVOYW1lLmF0dHIgJiYgdmFsdWVOYW1lLm5hbWUpIHsNCiAgICAgICAgZWxtID0gbGlzdC51dGlscy5nZXRCeUNsYXNzKGl0ZW0uZWxtLCB2YWx1ZU5hbWUubmFtZSwgdHJ1ZSk7DQogICAgICAgIGlmIChlbG0pIHsNCiAgICAgICAgICBlbG0uc2V0QXR0cmlidXRlKHZhbHVlTmFtZS5hdHRyLCB2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGVsbSA9IGxpc3QudXRpbHMuZ2V0QnlDbGFzcyhpdGVtLmVsbSwgdmFsdWVOYW1lLCB0cnVlKTsNCiAgICAgICAgaWYgKGVsbSkgew0KICAgICAgICAgIGVsbS5pbm5lckhUTUwgPSB2YWx1ZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgZWxtID0gdW5kZWZpbmVkOw0KICAgIH07DQogICAgaWYgKCF0ZW1wbGF0ZXIuY3JlYXRlKGl0ZW0pKSB7DQogICAgICBmb3IodmFyIHYgaW4gdmFsdWVzKSB7DQogICAgICAgIGlmICh2YWx1ZXMuaGFzT3duUHJvcGVydHkodikpIHsNCiAgICAgICAgICBzZXRWYWx1ZSh2LCB2YWx1ZXNbdl0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9Ow0KDQogIHRoaXMuY3JlYXRlID0gZnVuY3Rpb24oaXRlbSkgew0KICAgIGlmIChpdGVtLmVsbSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIGlmIChpdGVtU291cmNlID09PSB1bmRlZmluZWQpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcigiVGhlIGxpc3QgbmVlZCB0byBoYXZlIGF0IGxpc3Qgb25lIGl0ZW0gb24gaW5pdCBvdGhlcndpc2UgeW91J2xsIGhhdmUgdG8gYWRkIGEgdGVtcGxhdGUuIik7DQogICAgfQ0KICAgIC8qIElmIGl0ZW0gc291cmNlIGRvZXMgbm90IGV4aXN0cywgdXNlIHRoZSBmaXJzdCBpdGVtIGluIGxpc3QgYXMNCiAgICBzb3VyY2UgZm9yIG5ldyBpdGVtcyAqLw0KICAgIHZhciBuZXdJdGVtID0gaXRlbVNvdXJjZS5jbG9uZU5vZGUodHJ1ZSk7DQogICAgbmV3SXRlbS5yZW1vdmVBdHRyaWJ1dGUoJ2lkJyk7DQogICAgaXRlbS5lbG0gPSBuZXdJdGVtOw0KICAgIHRlbXBsYXRlci5zZXQoaXRlbSwgaXRlbS52YWx1ZXMoKSk7DQogICAgcmV0dXJuIHRydWU7DQogIH07DQogIHRoaXMucmVtb3ZlID0gZnVuY3Rpb24oaXRlbSkgew0KICAgIGlmIChpdGVtLmVsbS5wYXJlbnROb2RlID09PSBsaXN0Lmxpc3QpIHsNCiAgICAgIGxpc3QubGlzdC5yZW1vdmVDaGlsZChpdGVtLmVsbSk7DQogICAgfQ0KICB9Ow0KICB0aGlzLnNob3cgPSBmdW5jdGlvbihpdGVtKSB7DQogICAgdGVtcGxhdGVyLmNyZWF0ZShpdGVtKTsNCiAgICBsaXN0Lmxpc3QuYXBwZW5kQ2hpbGQoaXRlbS5lbG0pOw0KICB9Ow0KICB0aGlzLmhpZGUgPSBmdW5jdGlvbihpdGVtKSB7DQogICAgaWYgKGl0ZW0uZWxtICE9PSB1bmRlZmluZWQgJiYgaXRlbS5lbG0ucGFyZW50Tm9kZSA9PT0gbGlzdC5saXN0KSB7DQogICAgICBsaXN0Lmxpc3QucmVtb3ZlQ2hpbGQoaXRlbS5lbG0pOw0KICAgIH0NCiAgfTsNCiAgdGhpcy5jbGVhciA9IGZ1bmN0aW9uKCkgew0KICAgIC8qIC5pbm5lckhUTUwgPSAnJzsgZnVja3MgdXAgSUUgKi8NCiAgICBpZiAobGlzdC5saXN0Lmhhc0NoaWxkTm9kZXMoKSkgew0KICAgICAgd2hpbGUgKGxpc3QubGlzdC5jaGlsZE5vZGVzLmxlbmd0aCA+PSAxKQ0KICAgICAgew0KICAgICAgICBsaXN0Lmxpc3QucmVtb3ZlQ2hpbGQobGlzdC5saXN0LmZpcnN0Q2hpbGQpOw0KICAgICAgfQ0KICAgIH0NCiAgfTsNCg0KICBpbml0KCk7DQp9Ow0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGxpc3QpIHsNCiAgcmV0dXJuIG5ldyBUZW1wbGF0ZXIobGlzdCk7DQp9Ow0KDQp9LHt9XSw5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCi8qKg0KICogTW9kdWxlIGRlcGVuZGVuY2llcy4NCiAqLw0KDQp2YXIgaW5kZXggPSByZXF1aXJlKCcuL2luZGV4LW9mJyk7DQoNCi8qKg0KICogV2hpdGVzcGFjZSByZWdleHAuDQogKi8NCg0KdmFyIHJlID0gL1xzKy87DQoNCi8qKg0KICogdG9TdHJpbmcgcmVmZXJlbmNlLg0KICovDQoNCnZhciB0b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7DQoNCi8qKg0KICogV3JhcCBgZWxgIGluIGEgYENsYXNzTGlzdGAuDQogKg0KICogQHBhcmFtIHtFbGVtZW50fSBlbA0KICogQHJldHVybiB7Q2xhc3NMaXN0fQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGVsKXsNCiAgcmV0dXJuIG5ldyBDbGFzc0xpc3QoZWwpOw0KfTsNCg0KLyoqDQogKiBJbml0aWFsaXplIGEgbmV3IENsYXNzTGlzdCBmb3IgYGVsYC4NCiAqDQogKiBAcGFyYW0ge0VsZW1lbnR9IGVsDQogKiBAYXBpIHByaXZhdGUNCiAqLw0KDQpmdW5jdGlvbiBDbGFzc0xpc3QoZWwpIHsNCiAgaWYgKCFlbCB8fCAhZWwubm9kZVR5cGUpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoJ0EgRE9NIGVsZW1lbnQgcmVmZXJlbmNlIGlzIHJlcXVpcmVkJyk7DQogIH0NCiAgdGhpcy5lbCA9IGVsOw0KICB0aGlzLmxpc3QgPSBlbC5jbGFzc0xpc3Q7DQp9DQoNCi8qKg0KICogQWRkIGNsYXNzIGBuYW1lYCBpZiBub3QgYWxyZWFkeSBwcmVzZW50Lg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lDQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCkNsYXNzTGlzdC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24obmFtZSl7DQogIC8vIGNsYXNzTGlzdA0KICBpZiAodGhpcy5saXN0KSB7DQogICAgdGhpcy5saXN0LmFkZChuYW1lKTsNCiAgICByZXR1cm4gdGhpczsNCiAgfQ0KDQogIC8vIGZhbGxiYWNrDQogIHZhciBhcnIgPSB0aGlzLmFycmF5KCk7DQogIHZhciBpID0gaW5kZXgoYXJyLCBuYW1lKTsNCiAgaWYgKCF+aSkgYXJyLnB1c2gobmFtZSk7DQogIHRoaXMuZWwuY2xhc3NOYW1lID0gYXJyLmpvaW4oJyAnKTsNCiAgcmV0dXJuIHRoaXM7DQp9Ow0KDQovKioNCiAqIFJlbW92ZSBjbGFzcyBgbmFtZWAgd2hlbiBwcmVzZW50LCBvcg0KICogcGFzcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byByZW1vdmUNCiAqIGFueSB3aGljaCBtYXRjaC4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ3xSZWdFeHB9IG5hbWUNCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAqIEBhcGkgcHVibGljDQogKi8NCg0KQ2xhc3NMaXN0LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihuYW1lKXsNCiAgaWYgKCdbb2JqZWN0IFJlZ0V4cF0nID09IHRvU3RyaW5nLmNhbGwobmFtZSkpIHsNCiAgICByZXR1cm4gdGhpcy5yZW1vdmVNYXRjaGluZyhuYW1lKTsNCiAgfQ0KDQogIC8vIGNsYXNzTGlzdA0KICBpZiAodGhpcy5saXN0KSB7DQogICAgdGhpcy5saXN0LnJlbW92ZShuYW1lKTsNCiAgICByZXR1cm4gdGhpczsNCiAgfQ0KDQogIC8vIGZhbGxiYWNrDQogIHZhciBhcnIgPSB0aGlzLmFycmF5KCk7DQogIHZhciBpID0gaW5kZXgoYXJyLCBuYW1lKTsNCiAgaWYgKH5pKSBhcnIuc3BsaWNlKGksIDEpOw0KICB0aGlzLmVsLmNsYXNzTmFtZSA9IGFyci5qb2luKCcgJyk7DQogIHJldHVybiB0aGlzOw0KfTsNCg0KLyoqDQogKiBSZW1vdmUgYWxsIGNsYXNzZXMgbWF0Y2hpbmcgYHJlYC4NCiAqDQogKiBAcGFyYW0ge1JlZ0V4cH0gcmUNCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAqIEBhcGkgcHJpdmF0ZQ0KICovDQoNCkNsYXNzTGlzdC5wcm90b3R5cGUucmVtb3ZlTWF0Y2hpbmcgPSBmdW5jdGlvbihyZSl7DQogIHZhciBhcnIgPSB0aGlzLmFycmF5KCk7DQogIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7DQogICAgaWYgKHJlLnRlc3QoYXJyW2ldKSkgew0KICAgICAgdGhpcy5yZW1vdmUoYXJyW2ldKTsNCiAgICB9DQogIH0NCiAgcmV0dXJuIHRoaXM7DQp9Ow0KDQovKioNCiAqIFRvZ2dsZSBjbGFzcyBgbmFtZWAsIGNhbiBmb3JjZSBzdGF0ZSB2aWEgYGZvcmNlYC4NCiAqDQogKiBGb3IgYnJvd3NlcnMgdGhhdCBzdXBwb3J0IGNsYXNzTGlzdCwgYnV0IGRvIG5vdCBzdXBwb3J0IGBmb3JjZWAgeWV0LA0KICogdGhlIG1pc3Rha2Ugd2lsbCBiZSBkZXRlY3RlZCBhbmQgY29ycmVjdGVkLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lDQogKiBAcGFyYW0ge0Jvb2xlYW59IGZvcmNlDQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCkNsYXNzTGlzdC5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24obmFtZSwgZm9yY2Upew0KICAvLyBjbGFzc0xpc3QNCiAgaWYgKHRoaXMubGlzdCkgew0KICAgIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGZvcmNlKSB7DQogICAgICBpZiAoZm9yY2UgIT09IHRoaXMubGlzdC50b2dnbGUobmFtZSwgZm9yY2UpKSB7DQogICAgICAgIHRoaXMubGlzdC50b2dnbGUobmFtZSk7IC8vIHRvZ2dsZSBhZ2FpbiB0byBjb3JyZWN0DQogICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgIHRoaXMubGlzdC50b2dnbGUobmFtZSk7DQogICAgfQ0KICAgIHJldHVybiB0aGlzOw0KICB9DQoNCiAgLy8gZmFsbGJhY2sNCiAgaWYgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZm9yY2UpIHsNCiAgICBpZiAoIWZvcmNlKSB7DQogICAgICB0aGlzLnJlbW92ZShuYW1lKTsNCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5hZGQobmFtZSk7DQogICAgfQ0KICB9IGVsc2Ugew0KICAgIGlmICh0aGlzLmhhcyhuYW1lKSkgew0KICAgICAgdGhpcy5yZW1vdmUobmFtZSk7DQogICAgfSBlbHNlIHsNCiAgICAgIHRoaXMuYWRkKG5hbWUpOw0KICAgIH0NCiAgfQ0KDQogIHJldHVybiB0aGlzOw0KfTsNCg0KLyoqDQogKiBSZXR1cm4gYW4gYXJyYXkgb2YgY2xhc3Nlcy4NCiAqDQogKiBAcmV0dXJuIHtBcnJheX0NCiAqIEBhcGkgcHVibGljDQogKi8NCg0KQ2xhc3NMaXN0LnByb3RvdHlwZS5hcnJheSA9IGZ1bmN0aW9uKCl7DQogIHZhciBjbGFzc05hbWUgPSB0aGlzLmVsLmdldEF0dHJpYnV0ZSgnY2xhc3MnKSB8fCAnJzsNCiAgdmFyIHN0ciA9IGNsYXNzTmFtZS5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpOw0KICB2YXIgYXJyID0gc3RyLnNwbGl0KHJlKTsNCiAgaWYgKCcnID09PSBhcnJbMF0pIGFyci5zaGlmdCgpOw0KICByZXR1cm4gYXJyOw0KfTsNCg0KLyoqDQogKiBDaGVjayBpZiBjbGFzcyBgbmFtZWAgaXMgcHJlc2VudC4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQ0KICogQHJldHVybiB7Q2xhc3NMaXN0fQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpDbGFzc0xpc3QucHJvdG90eXBlLmhhcyA9DQpDbGFzc0xpc3QucHJvdG90eXBlLmNvbnRhaW5zID0gZnVuY3Rpb24obmFtZSl7DQogIHJldHVybiB0aGlzLmxpc3QgPyB0aGlzLmxpc3QuY29udGFpbnMobmFtZSkgOiAhISB+aW5kZXgodGhpcy5hcnJheSgpLCBuYW1lKTsNCn07DQoNCn0seyIuL2luZGV4LW9mIjoxNH1dLDEwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCnZhciBiaW5kID0gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIgPyAnYWRkRXZlbnRMaXN0ZW5lcicgOiAnYXR0YWNoRXZlbnQnLA0KICAgIHVuYmluZCA9IHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyID8gJ3JlbW92ZUV2ZW50TGlzdGVuZXInIDogJ2RldGFjaEV2ZW50JywNCiAgICBwcmVmaXggPSBiaW5kICE9PSAnYWRkRXZlbnRMaXN0ZW5lcicgPyAnb24nIDogJycsDQogICAgdG9BcnJheSA9IHJlcXVpcmUoJy4vdG8tYXJyYXknKTsNCg0KLyoqDQogKiBCaW5kIGBlbGAgZXZlbnQgYHR5cGVgIHRvIGBmbmAuDQogKg0KICogQHBhcmFtIHtFbGVtZW50fSBlbCwgTm9kZUxpc3QsIEhUTUxDb2xsZWN0aW9uIG9yIEFycmF5DQogKiBAcGFyYW0ge1N0cmluZ30gdHlwZQ0KICogQHBhcmFtIHtGdW5jdGlvbn0gZm4NCiAqIEBwYXJhbSB7Qm9vbGVhbn0gY2FwdHVyZQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpleHBvcnRzLmJpbmQgPSBmdW5jdGlvbihlbCwgdHlwZSwgZm4sIGNhcHR1cmUpew0KICBlbCA9IHRvQXJyYXkoZWwpOw0KICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBlbC5sZW5ndGg7IGkrKyApIHsNCiAgICBlbFtpXVtiaW5kXShwcmVmaXggKyB0eXBlLCBmbiwgY2FwdHVyZSB8fCBmYWxzZSk7DQogIH0NCn07DQoNCi8qKg0KICogVW5iaW5kIGBlbGAgZXZlbnQgYHR5cGVgJ3MgY2FsbGJhY2sgYGZuYC4NCiAqDQogKiBAcGFyYW0ge0VsZW1lbnR9IGVsLCBOb2RlTGlzdCwgSFRNTENvbGxlY3Rpb24gb3IgQXJyYXkNCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbg0KICogQHBhcmFtIHtCb29sZWFufSBjYXB0dXJlDQogKiBAYXBpIHB1YmxpYw0KICovDQoNCmV4cG9ydHMudW5iaW5kID0gZnVuY3Rpb24oZWwsIHR5cGUsIGZuLCBjYXB0dXJlKXsNCiAgZWwgPSB0b0FycmF5KGVsKTsNCiAgZm9yICggdmFyIGkgPSAwOyBpIDwgZWwubGVuZ3RoOyBpKysgKSB7DQogICAgZWxbaV1bdW5iaW5kXShwcmVmaXggKyB0eXBlLCBmbiwgY2FwdHVyZSB8fCBmYWxzZSk7DQogIH0NCn07DQoNCn0seyIuL3RvLWFycmF5IjoxNn1dLDExOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCi8qDQogKiBTb3VyY2U6IGh0dHBzOi8vZ2l0aHViLmNvbS9zZWdtZW50aW8vZXh0ZW5kDQogKi8NCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBleHRlbmQgKG9iamVjdCkgew0KICAgIC8vIFRha2VzIGFuIHVubGltaXRlZCBudW1iZXIgb2YgZXh0ZW5kZXJzLg0KICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsNCg0KICAgIC8vIEZvciBlYWNoIGV4dGVuZGVyLCBjb3B5IHRoZWlyIHByb3BlcnRpZXMgb24gb3VyIG9iamVjdC4NCiAgICBmb3IgKHZhciBpID0gMCwgc291cmNlOyBzb3VyY2UgPSBhcmdzW2ldOyBpKyspIHsNCiAgICAgICAgaWYgKCFzb3VyY2UpIGNvbnRpbnVlOw0KICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzb3VyY2UpIHsNCiAgICAgICAgICAgIG9iamVjdFtwcm9wZXJ0eV0gPSBzb3VyY2VbcHJvcGVydHldOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcmV0dXJuIG9iamVjdDsNCn07DQoNCn0se31dLDEyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCi8qKg0KICogQSBjcm9zcy1icm93c2VyIGltcGxlbWVudGF0aW9uIG9mIGdldEF0dHJpYnV0ZS4NCiAqIFNvdXJjZSBmb3VuZCBoZXJlOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8zNzU1MzQzLzM2MTMzNyB3cml0dGVuIGJ5IFZpdmluIFBhbGlhdGgNCiAqDQogKiBSZXR1cm4gdGhlIHZhbHVlIGZvciBgYXR0cmAgYXQgYGVsZW1lbnRgLg0KICoNCiAqIEBwYXJhbSB7RWxlbWVudH0gZWwNCiAqIEBwYXJhbSB7U3RyaW5nfSBhdHRyDQogKiBAYXBpIHB1YmxpYw0KICovDQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZWwsIGF0dHIpIHsNCiAgdmFyIHJlc3VsdCA9IChlbC5nZXRBdHRyaWJ1dGUgJiYgZWwuZ2V0QXR0cmlidXRlKGF0dHIpKSB8fCBudWxsOw0KICBpZiggIXJlc3VsdCApIHsNCiAgICB2YXIgYXR0cnMgPSBlbC5hdHRyaWJ1dGVzOw0KICAgIHZhciBsZW5ndGggPSBhdHRycy5sZW5ndGg7DQogICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7DQogICAgICBpZiAoYXR0cltpXSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgIGlmKGF0dHJbaV0ubm9kZU5hbWUgPT09IGF0dHIpIHsNCiAgICAgICAgICByZXN1bHQgPSBhdHRyW2ldLm5vZGVWYWx1ZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KICByZXR1cm4gcmVzdWx0Ow0KfTsNCg0KfSx7fV0sMTM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyoqDQogKiBBIGNyb3NzLWJyb3dzZXIgaW1wbGVtZW50YXRpb24gb2YgZ2V0RWxlbWVudHNCeUNsYXNzLg0KICogSGVhdmlseSBiYXNlZCBvbiBEdXN0aW4gRGlheidzIGZ1bmN0aW9uOiBodHRwOi8vZHVzdGluZGlhei5jb20vZ2V0ZWxlbWVudHNieWNsYXNzLg0KICoNCiAqIEZpbmQgYWxsIGVsZW1lbnRzIHdpdGggY2xhc3MgYGNsYXNzTmFtZWAgaW5zaWRlIGBjb250YWluZXJgLg0KICogVXNlIGBzaW5nbGUgPSB0cnVlYCB0byBpbmNyZWFzZSBwZXJmb3JtYW5jZSBpbiBvbGRlciBicm93c2Vycw0KICogd2hlbiBvbmx5IG9uZSBlbGVtZW50IGlzIG5lZWRlZC4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gY2xhc3NOYW1lDQogKiBAcGFyYW0ge0VsZW1lbnR9IGNvbnRhaW5lcg0KICogQHBhcmFtIHtCb29sZWFufSBzaW5nbGUNCiAqIEBhcGkgcHVibGljDQogKi8NCg0KbW9kdWxlLmV4cG9ydHMgPSAoZnVuY3Rpb24oKSB7DQogIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uKGNvbnRhaW5lciwgY2xhc3NOYW1lLCBzaW5nbGUpIHsNCiAgICAgIGlmIChzaW5nbGUpIHsNCiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSlbMF07DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gY29udGFpbmVyLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoY2xhc3NOYW1lKTsNCiAgICAgIH0NCiAgICB9Ow0KICB9IGVsc2UgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24oY29udGFpbmVyLCBjbGFzc05hbWUsIHNpbmdsZSkgew0KICAgICAgY2xhc3NOYW1lID0gJy4nICsgY2xhc3NOYW1lOw0KICAgICAgaWYgKHNpbmdsZSkgew0KICAgICAgICByZXR1cm4gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoY2xhc3NOYW1lKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbChjbGFzc05hbWUpOw0KICAgICAgfQ0KICAgIH07DQogIH0gZWxzZSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uKGNvbnRhaW5lciwgY2xhc3NOYW1lLCBzaW5nbGUpIHsNCiAgICAgIHZhciBjbGFzc0VsZW1lbnRzID0gW10sDQogICAgICAgIHRhZyA9ICcqJzsNCiAgICAgIGlmIChjb250YWluZXIgPT09IG51bGwpIHsNCiAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQ7DQogICAgICB9DQogICAgICB2YXIgZWxzID0gY29udGFpbmVyLmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZyk7DQogICAgICB2YXIgZWxzTGVuID0gZWxzLmxlbmd0aDsNCiAgICAgIHZhciBwYXR0ZXJuID0gbmV3IFJlZ0V4cCgiKF58XFxzKSIrY2xhc3NOYW1lKyIoXFxzfCQpIik7DQogICAgICBmb3IgKHZhciBpID0gMCwgaiA9IDA7IGkgPCBlbHNMZW47IGkrKykgew0KICAgICAgICBpZiAoIHBhdHRlcm4udGVzdChlbHNbaV0uY2xhc3NOYW1lKSApIHsNCiAgICAgICAgICBpZiAoc2luZ2xlKSB7DQogICAgICAgICAgICByZXR1cm4gZWxzW2ldOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjbGFzc0VsZW1lbnRzW2pdID0gZWxzW2ldOw0KICAgICAgICAgICAgaisrOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIGNsYXNzRWxlbWVudHM7DQogICAgfTsNCiAgfQ0KfSkoKTsNCg0KfSx7fV0sMTQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KdmFyIGluZGV4T2YgPSBbXS5pbmRleE9mOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGFyciwgb2JqKXsNCiAgaWYgKGluZGV4T2YpIHJldHVybiBhcnIuaW5kZXhPZihvYmopOw0KICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7ICsraSkgew0KICAgIGlmIChhcnJbaV0gPT09IG9iaikgcmV0dXJuIGk7DQogIH0NCiAgcmV0dXJuIC0xOw0KfTsNCg0KfSx7fV0sMTU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyoNCiAqIE5hdHVyYWwgU29ydCBhbGdvcml0aG0gZm9yIEphdmFzY3JpcHQgLSBWZXJzaW9uIDAuOC4xIC0gUmVsZWFzZWQgdW5kZXIgTUlUIGxpY2Vuc2UNCiAqIEF1dGhvcjogSmltIFBhbG1lciAoYmFzZWQgb24gY2h1bmtpbmcgaWRlYSBmcm9tIERhdmUgS29lbGxlKQ0KICovDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGEsIGIsIG9wdHMpIHsNCiAgICB2YXIgcmUgPSAvKF4oWytcLV0/XGQrKD86XC5cZCopPyg/OltlRV1bK1wtXT9cZCspPyg/PVxEfFxzfCQpKXxeMHhbXGRhLWZBLUZdKyR8XGQrKS9nLA0KICAgICAgICBzcmUgPSAvXlxzK3xccyskL2csICAgLy8gdHJpbSBwcmUtcG9zdCB3aGl0ZXNwYWNlDQogICAgICAgIHNucmUgPSAvXHMrL2csICAgICAgICAvLyBub3JtYWxpemUgYWxsIHdoaXRlc3BhY2UgdG8gc2luZ2xlICcgJyBjaGFyYWN0ZXINCiAgICAgICAgZHJlID0gLyheKFtcdyBdKyw/W1x3IF0rKT9bXHcgXSssP1tcdyBdK1xkKzpcZCsoOlxkKyk/W1x3IF0/fF5cZHsxLDR9W1wvXC1dXGR7MSw0fVtcL1wtXVxkezEsNH18Xlx3KywgXHcrIFxkKywgXGR7NH0pLywNCiAgICAgICAgaHJlID0gL14weFswLTlhLWZdKyQvaSwNCiAgICAgICAgb3JlID0gL14wLywNCiAgICAgICAgb3B0aW9ucyA9IG9wdHMgfHwge30sDQogICAgICAgIGkgPSBmdW5jdGlvbihzKSB7DQogICAgICAgICAgICByZXR1cm4gKG9wdGlvbnMuaW5zZW5zaXRpdmUgJiYgKCcnICsgcykudG9Mb3dlckNhc2UoKSB8fCAnJyArIHMpLnJlcGxhY2Uoc3JlLCAnJyk7DQogICAgICAgIH0sDQogICAgICAgIC8vIGNvbnZlcnQgYWxsIHRvIHN0cmluZ3Mgc3RyaXAgd2hpdGVzcGFjZQ0KICAgICAgICB4ID0gaShhKSwNCiAgICAgICAgeSA9IGkoYiksDQogICAgICAgIC8vIGNodW5rL3Rva2VuaXplDQogICAgICAgIHhOID0geC5yZXBsYWNlKHJlLCAnXDAkMVwwJykucmVwbGFjZSgvXDAkLywnJykucmVwbGFjZSgvXlwwLywnJykuc3BsaXQoJ1wwJyksDQogICAgICAgIHlOID0geS5yZXBsYWNlKHJlLCAnXDAkMVwwJykucmVwbGFjZSgvXDAkLywnJykucmVwbGFjZSgvXlwwLywnJykuc3BsaXQoJ1wwJyksDQogICAgICAgIC8vIG51bWVyaWMsIGhleCBvciBkYXRlIGRldGVjdGlvbg0KICAgICAgICB4RCA9IHBhcnNlSW50KHgubWF0Y2goaHJlKSwgMTYpIHx8ICh4Ti5sZW5ndGggIT09IDEgJiYgRGF0ZS5wYXJzZSh4KSksDQogICAgICAgIHlEID0gcGFyc2VJbnQoeS5tYXRjaChocmUpLCAxNikgfHwgeEQgJiYgeS5tYXRjaChkcmUpICYmIERhdGUucGFyc2UoeSkgfHwgbnVsbCwNCiAgICAgICAgbm9ybUNodW5rID0gZnVuY3Rpb24ocywgbCkgew0KICAgICAgICAgICAvLyBub3JtYWxpemUgc3BhY2VzOyBmaW5kIGZsb2F0cyBub3Qgc3RhcnRpbmcgd2l0aCAnMCcsIHN0cmluZyBvciAwIGlmIG5vdCBkZWZpbmVkIChDbGludCBQcmllc3QpDQogICAgICAgICAgIHJldHVybiAoIXMubWF0Y2gob3JlKSB8fCBsID09IDEpICYmIHBhcnNlRmxvYXQocykgfHwgcy5yZXBsYWNlKHNucmUsICcgJykucmVwbGFjZShzcmUsICcnKSB8fCAwOw0KICAgICAgICB9LA0KICAgICAgICBvRnhOY0wsIG9GeU5jTDsNCiAgIC8vIGZpcnN0IHRyeSBhbmQgc29ydCBIZXggY29kZXMgb3IgRGF0ZXMNCiAgIGlmICh5RCkgew0KICAgICAgIGlmICh4RCA8IHlEKSB7IHJldHVybiAtMTsgfQ0KICAgICAgIGVsc2UgaWYgKHhEID4geUQpIHsgcmV0dXJuIDE7IH0NCiAgIH0NCiAgIC8vIG5hdHVyYWwgc29ydGluZyB0aHJvdWdoIHNwbGl0IG51bWVyaWMgc3RyaW5ncyBhbmQgZGVmYXVsdCBzdHJpbmdzDQogICBmb3IodmFyIGNMb2MgPSAwLCB4TmwgPSB4Ti5sZW5ndGgsIHlObCA9IHlOLmxlbmd0aCwgbnVtUyA9IE1hdGgubWF4KHhObCwgeU5sKTsgY0xvYyA8IG51bVM7IGNMb2MrKykgew0KICAgICAgIG9GeE5jTCA9IG5vcm1DaHVuayh4TltjTG9jXSB8fCAnJywgeE5sKTsNCiAgICAgICBvRnlOY0wgPSBub3JtQ2h1bmsoeU5bY0xvY10gfHwgJycsIHlObCk7DQogICAgICAgLy8gaGFuZGxlIG51bWVyaWMgdnMgc3RyaW5nIGNvbXBhcmlzb24gLSBudW1iZXIgPCBzdHJpbmcgLSAoS3lsZSBBZGFtcykNCiAgICAgICBpZiAoaXNOYU4ob0Z4TmNMKSAhPT0gaXNOYU4ob0Z5TmNMKSkgew0KICAgICAgICAgICByZXR1cm4gaXNOYU4ob0Z4TmNMKSA/IDEgOiAtMTsNCiAgICAgICB9DQogICAgICAgLy8gaWYgdW5pY29kZSB1c2UgbG9jYWxlIGNvbXBhcmlzb24NCiAgICAgICBpZiAoL1teXHgwMC1ceDgwXS8udGVzdChvRnhOY0wgKyBvRnlOY0wpICYmIG9GeE5jTC5sb2NhbGVDb21wYXJlKSB7DQogICAgICAgICAgIHZhciBjb21wID0gb0Z4TmNMLmxvY2FsZUNvbXBhcmUob0Z5TmNMKTsNCiAgICAgICAgICAgcmV0dXJuIGNvbXAgLyBNYXRoLmFicyhjb21wKTsNCiAgICAgICB9DQogICAgICAgaWYgKG9GeE5jTCA8IG9GeU5jTCkgeyByZXR1cm4gLTE7IH0NCiAgICAgICBlbHNlIGlmIChvRnhOY0wgPiBvRnlOY0wpIHsgcmV0dXJuIDE7IH0NCiAgIH0NCiAgICByZXR1cm4gMDsNCn07DQoNCn0se31dLDE2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCi8qKg0KICogU291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vdGltb3hsZXkvdG8tYXJyYXkNCiAqDQogKiBDb252ZXJ0IGFuIGFycmF5LWxpa2Ugb2JqZWN0IGludG8gYW4gYEFycmF5YC4NCiAqIElmIGBjb2xsZWN0aW9uYCBpcyBhbHJlYWR5IGFuIGBBcnJheWAsIHRoZW4gd2lsbCByZXR1cm4gYSBjbG9uZSBvZiBgY29sbGVjdGlvbmAuDQogKg0KICogQHBhcmFtIHtBcnJheSB8IE1peGVkfSBjb2xsZWN0aW9uIEFuIGBBcnJheWAgb3IgYXJyYXktbGlrZSBvYmplY3QgdG8gY29udmVydCBlLmcuIGBhcmd1bWVudHNgIG9yIGBOb2RlTGlzdGANCiAqIEByZXR1cm4ge0FycmF5fSBOYWl2ZSBjb252ZXJzaW9uIG9mIGBjb2xsZWN0aW9uYCB0byBhIG5ldyBgQXJyYXlgLg0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIHRvQXJyYXkoY29sbGVjdGlvbikgew0KICBpZiAodHlwZW9mIGNvbGxlY3Rpb24gPT09ICd1bmRlZmluZWQnKSByZXR1cm4gW107DQogIGlmIChjb2xsZWN0aW9uID09PSBudWxsKSByZXR1cm4gW251bGxdOw0KICBpZiAoY29sbGVjdGlvbiA9PT0gd2luZG93KSByZXR1cm4gW3dpbmRvd107DQogIGlmICh0eXBlb2YgY29sbGVjdGlvbiA9PT0gJ3N0cmluZycpIHJldHVybiBbY29sbGVjdGlvbl07DQogIGlmIChpc0FycmF5KGNvbGxlY3Rpb24pKSByZXR1cm4gY29sbGVjdGlvbjsNCiAgaWYgKHR5cGVvZiBjb2xsZWN0aW9uLmxlbmd0aCAhPSAnbnVtYmVyJykgcmV0dXJuIFtjb2xsZWN0aW9uXTsNCiAgaWYgKHR5cGVvZiBjb2xsZWN0aW9uID09PSAnZnVuY3Rpb24nICYmIGNvbGxlY3Rpb24gaW5zdGFuY2VvZiBGdW5jdGlvbikgcmV0dXJuIFtjb2xsZWN0aW9uXTsNCg0KICB2YXIgYXJyID0gW107DQogIGZvciAodmFyIGkgPSAwOyBpIDwgY29sbGVjdGlvbi5sZW5ndGg7IGkrKykgew0KICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoY29sbGVjdGlvbiwgaSkgfHwgaSBpbiBjb2xsZWN0aW9uKSB7DQogICAgICBhcnIucHVzaChjb2xsZWN0aW9uW2ldKTsNCiAgICB9DQogIH0NCiAgaWYgKCFhcnIubGVuZ3RoKSByZXR1cm4gW107DQogIHJldHVybiBhcnI7DQp9Ow0KDQpmdW5jdGlvbiBpc0FycmF5KGFycikgew0KICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGFycikgPT09ICJbb2JqZWN0IEFycmF5XSI7DQp9DQoNCn0se31dLDE3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ocykgew0KICBzID0gKHMgPT09IHVuZGVmaW5lZCkgPyAiIiA6IHM7DQogIHMgPSAocyA9PT0gbnVsbCkgPyAiIiA6IHM7DQogIHMgPSBzLnRvU3RyaW5nKCk7DQogIHJldHVybiBzOw0KfTsNCg0KfSx7fV19LHt9LFsxXSk7DQoNCiAgPC9zY3JpcHQ+DQogIDxzY3JpcHQ+DQogIDsoZnVuY3Rpb24oKXsNCg0KLyoqDQogKiBSZXF1aXJlIHRoZSBnaXZlbiBwYXRoLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoDQogKiBAcmV0dXJuIHtPYmplY3R9IGV4cG9ydHMNCiAqIEBhcGkgcHVibGljDQogKi8NCg0KZnVuY3Rpb24gcmVxdWlyZShwYXRoLCBwYXJlbnQsIG9yaWcpIHsNCiAgdmFyIHJlc29sdmVkID0gcmVxdWlyZS5yZXNvbHZlKHBhdGgpOw0KDQogIC8vIGxvb2t1cCBmYWlsZWQNCiAgaWYgKG51bGwgPT0gcmVzb2x2ZWQpIHsNCiAgICBvcmlnID0gb3JpZyB8fCBwYXRoOw0KICAgIHBhcmVudCA9IHBhcmVudCB8fCAncm9vdCc7DQogICAgdmFyIGVyciA9IG5ldyBFcnJvcignRmFpbGVkIHRvIHJlcXVpcmUgIicgKyBvcmlnICsgJyIgZnJvbSAiJyArIHBhcmVudCArICciJyk7DQogICAgZXJyLnBhdGggPSBvcmlnOw0KICAgIGVyci5wYXJlbnQgPSBwYXJlbnQ7DQogICAgZXJyLnJlcXVpcmUgPSB0cnVlOw0KICAgIHRocm93IGVycjsNCiAgfQ0KDQogIHZhciBtb2R1bGUgPSByZXF1aXJlLm1vZHVsZXNbcmVzb2x2ZWRdOw0KDQogIC8vIHBlcmZvcm0gcmVhbCByZXF1aXJlKCkNCiAgLy8gYnkgaW52b2tpbmcgdGhlIG1vZHVsZSdzDQogIC8vIHJlZ2lzdGVyZWQgZnVuY3Rpb24NCiAgaWYgKCFtb2R1bGUuX3Jlc29sdmluZyAmJiAhbW9kdWxlLmV4cG9ydHMpIHsNCiAgICB2YXIgbW9kID0ge307DQogICAgbW9kLmV4cG9ydHMgPSB7fTsNCiAgICBtb2QuY2xpZW50ID0gbW9kLmNvbXBvbmVudCA9IHRydWU7DQogICAgbW9kdWxlLl9yZXNvbHZpbmcgPSB0cnVlOw0KICAgIG1vZHVsZS5jYWxsKHRoaXMsIG1vZC5leHBvcnRzLCByZXF1aXJlLnJlbGF0aXZlKHJlc29sdmVkKSwgbW9kKTsNCiAgICBkZWxldGUgbW9kdWxlLl9yZXNvbHZpbmc7DQogICAgbW9kdWxlLmV4cG9ydHMgPSBtb2QuZXhwb3J0czsNCiAgfQ0KDQogIHJldHVybiBtb2R1bGUuZXhwb3J0czsNCn0NCg0KLyoqDQogKiBSZWdpc3RlcmVkIG1vZHVsZXMuDQogKi8NCg0KcmVxdWlyZS5tb2R1bGVzID0ge307DQoNCi8qKg0KICogUmVnaXN0ZXJlZCBhbGlhc2VzLg0KICovDQoNCnJlcXVpcmUuYWxpYXNlcyA9IHt9Ow0KDQovKioNCiAqIFJlc29sdmUgYHBhdGhgLg0KICoNCiAqIExvb2t1cDoNCiAqDQogKiAgIC0gUEFUSC9pbmRleC5qcw0KICogICAtIFBBVEguanMNCiAqICAgLSBQQVRIDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IHBhdGgNCiAqIEByZXR1cm4ge1N0cmluZ30gcGF0aCBvciBudWxsDQogKiBAYXBpIHByaXZhdGUNCiAqLw0KDQpyZXF1aXJlLnJlc29sdmUgPSBmdW5jdGlvbihwYXRoKSB7DQogIGlmIChwYXRoLmNoYXJBdCgwKSA9PT0gJy8nKSBwYXRoID0gcGF0aC5zbGljZSgxKTsNCg0KICB2YXIgcGF0aHMgPSBbDQogICAgcGF0aCwNCiAgICBwYXRoICsgJy5qcycsDQogICAgcGF0aCArICcuanNvbicsDQogICAgcGF0aCArICcvaW5kZXguanMnLA0KICAgIHBhdGggKyAnL2luZGV4Lmpzb24nDQogIF07DQoNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRocy5sZW5ndGg7IGkrKykgew0KICAgIHZhciBwYXRoID0gcGF0aHNbaV07DQogICAgaWYgKHJlcXVpcmUubW9kdWxlcy5oYXNPd25Qcm9wZXJ0eShwYXRoKSkgcmV0dXJuIHBhdGg7DQogICAgaWYgKHJlcXVpcmUuYWxpYXNlcy5oYXNPd25Qcm9wZXJ0eShwYXRoKSkgcmV0dXJuIHJlcXVpcmUuYWxpYXNlc1twYXRoXTsNCiAgfQ0KfTsNCg0KLyoqDQogKiBOb3JtYWxpemUgYHBhdGhgIHJlbGF0aXZlIHRvIHRoZSBjdXJyZW50IHBhdGguDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IGN1cnINCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoDQogKiBAcmV0dXJuIHtTdHJpbmd9DQogKiBAYXBpIHByaXZhdGUNCiAqLw0KDQpyZXF1aXJlLm5vcm1hbGl6ZSA9IGZ1bmN0aW9uKGN1cnIsIHBhdGgpIHsNCiAgdmFyIHNlZ3MgPSBbXTsNCg0KICBpZiAoJy4nICE9IHBhdGguY2hhckF0KDApKSByZXR1cm4gcGF0aDsNCg0KICBjdXJyID0gY3Vyci5zcGxpdCgnLycpOw0KICBwYXRoID0gcGF0aC5zcGxpdCgnLycpOw0KDQogIGZvciAodmFyIGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7ICsraSkgew0KICAgIGlmICgnLi4nID09IHBhdGhbaV0pIHsNCiAgICAgIGN1cnIucG9wKCk7DQogICAgfSBlbHNlIGlmICgnLicgIT0gcGF0aFtpXSAmJiAnJyAhPSBwYXRoW2ldKSB7DQogICAgICBzZWdzLnB1c2gocGF0aFtpXSk7DQogICAgfQ0KICB9DQoNCiAgcmV0dXJuIGN1cnIuY29uY2F0KHNlZ3MpLmpvaW4oJy8nKTsNCn07DQoNCi8qKg0KICogUmVnaXN0ZXIgbW9kdWxlIGF0IGBwYXRoYCB3aXRoIGNhbGxiYWNrIGBkZWZpbml0aW9uYC4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gcGF0aA0KICogQHBhcmFtIHtGdW5jdGlvbn0gZGVmaW5pdGlvbg0KICogQGFwaSBwcml2YXRlDQogKi8NCg0KcmVxdWlyZS5yZWdpc3RlciA9IGZ1bmN0aW9uKHBhdGgsIGRlZmluaXRpb24pIHsNCiAgcmVxdWlyZS5tb2R1bGVzW3BhdGhdID0gZGVmaW5pdGlvbjsNCn07DQoNCi8qKg0KICogQWxpYXMgYSBtb2R1bGUgZGVmaW5pdGlvbi4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gZnJvbQ0KICogQHBhcmFtIHtTdHJpbmd9IHRvDQogKiBAYXBpIHByaXZhdGUNCiAqLw0KDQpyZXF1aXJlLmFsaWFzID0gZnVuY3Rpb24oZnJvbSwgdG8pIHsNCiAgaWYgKCFyZXF1aXJlLm1vZHVsZXMuaGFzT3duUHJvcGVydHkoZnJvbSkpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBhbGlhcyAiJyArIGZyb20gKyAnIiwgaXQgZG9lcyBub3QgZXhpc3QnKTsNCiAgfQ0KICByZXF1aXJlLmFsaWFzZXNbdG9dID0gZnJvbTsNCn07DQoNCi8qKg0KICogUmV0dXJuIGEgcmVxdWlyZSBmdW5jdGlvbiByZWxhdGl2ZSB0byB0aGUgYHBhcmVudGAgcGF0aC4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gcGFyZW50DQogKiBAcmV0dXJuIHtGdW5jdGlvbn0NCiAqIEBhcGkgcHJpdmF0ZQ0KICovDQoNCnJlcXVpcmUucmVsYXRpdmUgPSBmdW5jdGlvbihwYXJlbnQpIHsNCiAgdmFyIHAgPSByZXF1aXJlLm5vcm1hbGl6ZShwYXJlbnQsICcuLicpOw0KDQogIC8qKg0KICAgKiBsYXN0SW5kZXhPZiBoZWxwZXIuDQogICAqLw0KDQogIGZ1bmN0aW9uIGxhc3RJbmRleE9mKGFyciwgb2JqKSB7DQogICAgdmFyIGkgPSBhcnIubGVuZ3RoOw0KICAgIHdoaWxlIChpLS0pIHsNCiAgICAgIGlmIChhcnJbaV0gPT09IG9iaikgcmV0dXJuIGk7DQogICAgfQ0KICAgIHJldHVybiAtMTsNCiAgfQ0KDQogIC8qKg0KICAgKiBUaGUgcmVsYXRpdmUgcmVxdWlyZSgpIGl0c2VsZi4NCiAgICovDQoNCiAgZnVuY3Rpb24gbG9jYWxSZXF1aXJlKHBhdGgpIHsNCiAgICB2YXIgcmVzb2x2ZWQgPSBsb2NhbFJlcXVpcmUucmVzb2x2ZShwYXRoKTsNCiAgICByZXR1cm4gcmVxdWlyZShyZXNvbHZlZCwgcGFyZW50LCBwYXRoKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBSZXNvbHZlIHJlbGF0aXZlIHRvIHRoZSBwYXJlbnQuDQogICAqLw0KDQogIGxvY2FsUmVxdWlyZS5yZXNvbHZlID0gZnVuY3Rpb24ocGF0aCkgew0KICAgIHZhciBjID0gcGF0aC5jaGFyQXQoMCk7DQogICAgaWYgKCcvJyA9PSBjKSByZXR1cm4gcGF0aC5zbGljZSgxKTsNCiAgICBpZiAoJy4nID09IGMpIHJldHVybiByZXF1aXJlLm5vcm1hbGl6ZShwLCBwYXRoKTsNCg0KICAgIC8vIHJlc29sdmUgZGVwcyBieSByZXR1cm5pbmcNCiAgICAvLyB0aGUgZGVwIGluIHRoZSBuZWFyZXN0ICJkZXBzIg0KICAgIC8vIGRpcmVjdG9yeQ0KICAgIHZhciBzZWdzID0gcGFyZW50LnNwbGl0KCcvJyk7DQogICAgdmFyIGkgPSBsYXN0SW5kZXhPZihzZWdzLCAnZGVwcycpICsgMTsNCiAgICBpZiAoIWkpIGkgPSAwOw0KICAgIHBhdGggPSBzZWdzLnNsaWNlKDAsIGkgKyAxKS5qb2luKCcvJykgKyAnL2RlcHMvJyArIHBhdGg7DQogICAgcmV0dXJuIHBhdGg7DQogIH07DQoNCiAgLyoqDQogICAqIENoZWNrIGlmIG1vZHVsZSBpcyBkZWZpbmVkIGF0IGBwYXRoYC4NCiAgICovDQoNCiAgbG9jYWxSZXF1aXJlLmV4aXN0cyA9IGZ1bmN0aW9uKHBhdGgpIHsNCiAgICByZXR1cm4gcmVxdWlyZS5tb2R1bGVzLmhhc093blByb3BlcnR5KGxvY2FsUmVxdWlyZS5yZXNvbHZlKHBhdGgpKTsNCiAgfTsNCg0KICByZXR1cm4gbG9jYWxSZXF1aXJlOw0KfTsNCnJlcXVpcmUucmVnaXN0ZXIoImNvbXBvbmVudC1jbGFzc2VzL2luZGV4LmpzIiwgZnVuY3Rpb24oZXhwb3J0cywgcmVxdWlyZSwgbW9kdWxlKXsNCi8qKg0KICogTW9kdWxlIGRlcGVuZGVuY2llcy4NCiAqLw0KDQp2YXIgaW5kZXggPSByZXF1aXJlKCdpbmRleG9mJyk7DQoNCi8qKg0KICogV2hpdGVzcGFjZSByZWdleHAuDQogKi8NCg0KdmFyIHJlID0gL1xzKy87DQoNCi8qKg0KICogdG9TdHJpbmcgcmVmZXJlbmNlLg0KICovDQoNCnZhciB0b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7DQoNCi8qKg0KICogV3JhcCBgZWxgIGluIGEgYENsYXNzTGlzdGAuDQogKg0KICogQHBhcmFtIHtFbGVtZW50fSBlbA0KICogQHJldHVybiB7Q2xhc3NMaXN0fQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGVsKXsNCiAgcmV0dXJuIG5ldyBDbGFzc0xpc3QoZWwpOw0KfTsNCg0KLyoqDQogKiBJbml0aWFsaXplIGEgbmV3IENsYXNzTGlzdCBmb3IgYGVsYC4NCiAqDQogKiBAcGFyYW0ge0VsZW1lbnR9IGVsDQogKiBAYXBpIHByaXZhdGUNCiAqLw0KDQpmdW5jdGlvbiBDbGFzc0xpc3QoZWwpIHsNCiAgaWYgKCFlbCkgdGhyb3cgbmV3IEVycm9yKCdBIERPTSBlbGVtZW50IHJlZmVyZW5jZSBpcyByZXF1aXJlZCcpOw0KICB0aGlzLmVsID0gZWw7DQogIHRoaXMubGlzdCA9IGVsLmNsYXNzTGlzdDsNCn0NCg0KLyoqDQogKiBBZGQgY2xhc3MgYG5hbWVgIGlmIG5vdCBhbHJlYWR5IHByZXNlbnQuDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IG5hbWUNCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAqIEBhcGkgcHVibGljDQogKi8NCg0KQ2xhc3NMaXN0LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihuYW1lKXsNCiAgLy8gY2xhc3NMaXN0DQogIGlmICh0aGlzLmxpc3QpIHsNCiAgICB0aGlzLmxpc3QuYWRkKG5hbWUpOw0KICAgIHJldHVybiB0aGlzOw0KICB9DQoNCiAgLy8gZmFsbGJhY2sNCiAgdmFyIGFyciA9IHRoaXMuYXJyYXkoKTsNCiAgdmFyIGkgPSBpbmRleChhcnIsIG5hbWUpOw0KICBpZiAoIX5pKSBhcnIucHVzaChuYW1lKTsNCiAgdGhpcy5lbC5jbGFzc05hbWUgPSBhcnIuam9pbignICcpOw0KICByZXR1cm4gdGhpczsNCn07DQoNCi8qKg0KICogUmVtb3ZlIGNsYXNzIGBuYW1lYCB3aGVuIHByZXNlbnQsIG9yDQogKiBwYXNzIGEgcmVndWxhciBleHByZXNzaW9uIHRvIHJlbW92ZQ0KICogYW55IHdoaWNoIG1hdGNoLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfFJlZ0V4cH0gbmFtZQ0KICogQHJldHVybiB7Q2xhc3NMaXN0fQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpDbGFzc0xpc3QucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKG5hbWUpew0KICBpZiAoJ1tvYmplY3QgUmVnRXhwXScgPT0gdG9TdHJpbmcuY2FsbChuYW1lKSkgew0KICAgIHJldHVybiB0aGlzLnJlbW92ZU1hdGNoaW5nKG5hbWUpOw0KICB9DQoNCiAgLy8gY2xhc3NMaXN0DQogIGlmICh0aGlzLmxpc3QpIHsNCiAgICB0aGlzLmxpc3QucmVtb3ZlKG5hbWUpOw0KICAgIHJldHVybiB0aGlzOw0KICB9DQoNCiAgLy8gZmFsbGJhY2sNCiAgdmFyIGFyciA9IHRoaXMuYXJyYXkoKTsNCiAgdmFyIGkgPSBpbmRleChhcnIsIG5hbWUpOw0KICBpZiAofmkpIGFyci5zcGxpY2UoaSwgMSk7DQogIHRoaXMuZWwuY2xhc3NOYW1lID0gYXJyLmpvaW4oJyAnKTsNCiAgcmV0dXJuIHRoaXM7DQp9Ow0KDQovKioNCiAqIFJlbW92ZSBhbGwgY2xhc3NlcyBtYXRjaGluZyBgcmVgLg0KICoNCiAqIEBwYXJhbSB7UmVnRXhwfSByZQ0KICogQHJldHVybiB7Q2xhc3NMaXN0fQ0KICogQGFwaSBwcml2YXRlDQogKi8NCg0KQ2xhc3NMaXN0LnByb3RvdHlwZS5yZW1vdmVNYXRjaGluZyA9IGZ1bmN0aW9uKHJlKXsNCiAgdmFyIGFyciA9IHRoaXMuYXJyYXkoKTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsNCiAgICBpZiAocmUudGVzdChhcnJbaV0pKSB7DQogICAgICB0aGlzLnJlbW92ZShhcnJbaV0pOw0KICAgIH0NCiAgfQ0KICByZXR1cm4gdGhpczsNCn07DQoNCi8qKg0KICogVG9nZ2xlIGNsYXNzIGBuYW1lYCwgY2FuIGZvcmNlIHN0YXRlIHZpYSBgZm9yY2VgLg0KICoNCiAqIEZvciBicm93c2VycyB0aGF0IHN1cHBvcnQgY2xhc3NMaXN0LCBidXQgZG8gbm90IHN1cHBvcnQgYGZvcmNlYCB5ZXQsDQogKiB0aGUgbWlzdGFrZSB3aWxsIGJlIGRldGVjdGVkIGFuZCBjb3JyZWN0ZWQuDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IG5hbWUNCiAqIEBwYXJhbSB7Qm9vbGVhbn0gZm9yY2UNCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAqIEBhcGkgcHVibGljDQogKi8NCg0KQ2xhc3NMaXN0LnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbihuYW1lLCBmb3JjZSl7DQogIC8vIGNsYXNzTGlzdA0KICBpZiAodGhpcy5saXN0KSB7DQogICAgaWYgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZm9yY2UpIHsNCiAgICAgIGlmIChmb3JjZSAhPT0gdGhpcy5saXN0LnRvZ2dsZShuYW1lLCBmb3JjZSkpIHsNCiAgICAgICAgdGhpcy5saXN0LnRvZ2dsZShuYW1lKTsgLy8gdG9nZ2xlIGFnYWluIHRvIGNvcnJlY3QNCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5saXN0LnRvZ2dsZShuYW1lKTsNCiAgICB9DQogICAgcmV0dXJuIHRoaXM7DQogIH0NCg0KICAvLyBmYWxsYmFjaw0KICBpZiAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBmb3JjZSkgew0KICAgIGlmICghZm9yY2UpIHsNCiAgICAgIHRoaXMucmVtb3ZlKG5hbWUpOw0KICAgIH0gZWxzZSB7DQogICAgICB0aGlzLmFkZChuYW1lKTsNCiAgICB9DQogIH0gZWxzZSB7DQogICAgaWYgKHRoaXMuaGFzKG5hbWUpKSB7DQogICAgICB0aGlzLnJlbW92ZShuYW1lKTsNCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5hZGQobmFtZSk7DQogICAgfQ0KICB9DQoNCiAgcmV0dXJuIHRoaXM7DQp9Ow0KDQovKioNCiAqIFJldHVybiBhbiBhcnJheSBvZiBjbGFzc2VzLg0KICoNCiAqIEByZXR1cm4ge0FycmF5fQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpDbGFzc0xpc3QucHJvdG90eXBlLmFycmF5ID0gZnVuY3Rpb24oKXsNCiAgdmFyIHN0ciA9IHRoaXMuZWwuY2xhc3NOYW1lLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyk7DQogIHZhciBhcnIgPSBzdHIuc3BsaXQocmUpOw0KICBpZiAoJycgPT09IGFyclswXSkgYXJyLnNoaWZ0KCk7DQogIHJldHVybiBhcnI7DQp9Ow0KDQovKioNCiAqIENoZWNrIGlmIGNsYXNzIGBuYW1lYCBpcyBwcmVzZW50Lg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lDQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCkNsYXNzTGlzdC5wcm90b3R5cGUuaGFzID0NCkNsYXNzTGlzdC5wcm90b3R5cGUuY29udGFpbnMgPSBmdW5jdGlvbihuYW1lKXsNCiAgcmV0dXJuIHRoaXMubGlzdA0KICAgID8gdGhpcy5saXN0LmNvbnRhaW5zKG5hbWUpDQogICAgOiAhISB+aW5kZXgodGhpcy5hcnJheSgpLCBuYW1lKTsNCn07DQoNCn0pOw0KcmVxdWlyZS5yZWdpc3RlcigiY29tcG9uZW50LWV2ZW50L2luZGV4LmpzIiwgZnVuY3Rpb24oZXhwb3J0cywgcmVxdWlyZSwgbW9kdWxlKXsNCnZhciBiaW5kID0gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIgPyAnYWRkRXZlbnRMaXN0ZW5lcicgOiAnYXR0YWNoRXZlbnQnLA0KICAgIHVuYmluZCA9IHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyID8gJ3JlbW92ZUV2ZW50TGlzdGVuZXInIDogJ2RldGFjaEV2ZW50JywNCiAgICBwcmVmaXggPSBiaW5kICE9PSAnYWRkRXZlbnRMaXN0ZW5lcicgPyAnb24nIDogJyc7DQoNCi8qKg0KICogQmluZCBgZWxgIGV2ZW50IGB0eXBlYCB0byBgZm5gLg0KICoNCiAqIEBwYXJhbSB7RWxlbWVudH0gZWwNCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbg0KICogQHBhcmFtIHtCb29sZWFufSBjYXB0dXJlDQogKiBAcmV0dXJuIHtGdW5jdGlvbn0NCiAqIEBhcGkgcHVibGljDQogKi8NCg0KZXhwb3J0cy5iaW5kID0gZnVuY3Rpb24oZWwsIHR5cGUsIGZuLCBjYXB0dXJlKXsNCiAgZWxbYmluZF0ocHJlZml4ICsgdHlwZSwgZm4sIGNhcHR1cmUgfHwgZmFsc2UpOw0KICByZXR1cm4gZm47DQp9Ow0KDQovKioNCiAqIFVuYmluZCBgZWxgIGV2ZW50IGB0eXBlYCdzIGNhbGxiYWNrIGBmbmAuDQogKg0KICogQHBhcmFtIHtFbGVtZW50fSBlbA0KICogQHBhcmFtIHtTdHJpbmd9IHR5cGUNCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuDQogKiBAcGFyYW0ge0Jvb2xlYW59IGNhcHR1cmUNCiAqIEByZXR1cm4ge0Z1bmN0aW9ufQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpleHBvcnRzLnVuYmluZCA9IGZ1bmN0aW9uKGVsLCB0eXBlLCBmbiwgY2FwdHVyZSl7DQogIGVsW3VuYmluZF0ocHJlZml4ICsgdHlwZSwgZm4sIGNhcHR1cmUgfHwgZmFsc2UpOw0KICByZXR1cm4gZm47DQp9Ow0KfSk7DQpyZXF1aXJlLnJlZ2lzdGVyKCJjb21wb25lbnQtaW5kZXhvZi9pbmRleC5qcyIsIGZ1bmN0aW9uKGV4cG9ydHMsIHJlcXVpcmUsIG1vZHVsZSl7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGFyciwgb2JqKXsNCiAgaWYgKGFyci5pbmRleE9mKSByZXR1cm4gYXJyLmluZGV4T2Yob2JqKTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyArK2kpIHsNCiAgICBpZiAoYXJyW2ldID09PSBvYmopIHJldHVybiBpOw0KICB9DQogIHJldHVybiAtMTsNCn07DQp9KTsNCnJlcXVpcmUucmVnaXN0ZXIoImxpc3QucGFnaW5hdGlvbi5qcy9pbmRleC5qcyIsIGZ1bmN0aW9uKGV4cG9ydHMsIHJlcXVpcmUsIG1vZHVsZSl7DQp2YXIgY2xhc3NlcyA9IHJlcXVpcmUoJ2NsYXNzZXMnKSwNCiAgICBldmVudHMgPSByZXF1aXJlKCdldmVudCcpOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsNCg0KICAgIHZhciBwYWdpbmdMaXN0LA0KICAgICAgICBsaXN0Ow0KDQogICAgdmFyIHJlZnJlc2ggPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdmFyIGl0ZW0sDQogICAgICAgICAgICBsID0gbGlzdC5tYXRjaGluZ0l0ZW1zLmxlbmd0aCwNCiAgICAgICAgICAgIGluZGV4ID0gbGlzdC5pLA0KICAgICAgICAgICAgcGFnZSA9IGxpc3QucGFnZSwNCiAgICAgICAgICAgIHBhZ2VzID0gTWF0aC5jZWlsKGwgLyBwYWdlKSwNCiAgICAgICAgICAgIGN1cnJlbnRQYWdlID0gTWF0aC5jZWlsKChpbmRleCAvIHBhZ2UpKSwNCiAgICAgICAgICAgIGlubmVyV2luZG93ID0gb3B0aW9ucy5pbm5lcldpbmRvdyB8fCAyLA0KICAgICAgICAgICAgbGVmdCA9IG9wdGlvbnMubGVmdCB8fCBvcHRpb25zLm91dGVyV2luZG93IHx8IDAsDQogICAgICAgICAgICByaWdodCA9IG9wdGlvbnMucmlnaHQgfHwgb3B0aW9ucy5vdXRlcldpbmRvdyB8fCAwOw0KDQogICAgICAgIHJpZ2h0ID0gcGFnZXMgLSByaWdodDsNCg0KICAgICAgICBwYWdpbmdMaXN0LmNsZWFyKCk7DQogICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IHBhZ2VzOyBpKyspIHsNCiAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSAoY3VycmVudFBhZ2UgPT09IGkpID8gImFjdGl2ZSIgOiAiIjsNCg0KICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhpLCBsZWZ0LCByaWdodCwgY3VycmVudFBhZ2UsIChjdXJyZW50UGFnZSAtIGlubmVyV2luZG93KSwgKGN1cnJlbnRQYWdlICsgaW5uZXJXaW5kb3cpLCBjbGFzc05hbWUpOw0KDQogICAgICAgICAgICBpZiAoaXMubnVtYmVyKGksIGxlZnQsIHJpZ2h0LCBjdXJyZW50UGFnZSwgaW5uZXJXaW5kb3cpKSB7DQogICAgICAgICAgICAgICAgaXRlbSA9IHBhZ2luZ0xpc3QuYWRkKHsNCiAgICAgICAgICAgICAgICAgICAgcGFnZTogaSwNCiAgICAgICAgICAgICAgICAgICAgZG90dGVkOiBmYWxzZQ0KICAgICAgICAgICAgICAgIH0pWzBdOw0KICAgICAgICAgICAgICAgIGlmIChjbGFzc05hbWUpIHsNCiAgICAgICAgICAgICAgICAgICAgY2xhc3NlcyhpdGVtLmVsbSkuYWRkKGNsYXNzTmFtZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGFkZEV2ZW50KGl0ZW0uZWxtLCBpLCBwYWdlKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXMuZG90dGVkKGksIGxlZnQsIHJpZ2h0LCBjdXJyZW50UGFnZSwgaW5uZXJXaW5kb3csIHBhZ2luZ0xpc3Quc2l6ZSgpKSkgew0KICAgICAgICAgICAgICAgIGl0ZW0gPSBwYWdpbmdMaXN0LmFkZCh7DQogICAgICAgICAgICAgICAgICAgIHBhZ2U6ICIuLi4iLA0KICAgICAgICAgICAgICAgICAgICBkb3R0ZWQ6IHRydWUNCiAgICAgICAgICAgICAgICB9KVswXTsNCiAgICAgICAgICAgICAgICBjbGFzc2VzKGl0ZW0uZWxtKS5hZGQoImRpc2FibGVkIik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgdmFyIGlzID0gew0KICAgICAgICBudW1iZXI6IGZ1bmN0aW9uKGksIGxlZnQsIHJpZ2h0LCBjdXJyZW50UGFnZSwgaW5uZXJXaW5kb3cpIHsNCiAgICAgICAgICAgcmV0dXJuIHRoaXMubGVmdChpLCBsZWZ0KSB8fCB0aGlzLnJpZ2h0KGksIHJpZ2h0KSB8fCB0aGlzLmlubmVyV2luZG93KGksIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdyk7DQogICAgICAgIH0sDQogICAgICAgIGxlZnQ6IGZ1bmN0aW9uKGksIGxlZnQpIHsNCiAgICAgICAgICAgIHJldHVybiAoaSA8PSBsZWZ0KTsNCiAgICAgICAgfSwNCiAgICAgICAgcmlnaHQ6IGZ1bmN0aW9uKGksIHJpZ2h0KSB7DQogICAgICAgICAgICByZXR1cm4gKGkgPiByaWdodCk7DQogICAgICAgIH0sDQogICAgICAgIGlubmVyV2luZG93OiBmdW5jdGlvbihpLCBjdXJyZW50UGFnZSwgaW5uZXJXaW5kb3cpIHsNCiAgICAgICAgICAgIHJldHVybiAoIGkgPj0gKGN1cnJlbnRQYWdlIC0gaW5uZXJXaW5kb3cpICYmIGkgPD0gKGN1cnJlbnRQYWdlICsgaW5uZXJXaW5kb3cpKTsNCiAgICAgICAgfSwNCiAgICAgICAgZG90dGVkOiBmdW5jdGlvbihpLCBsZWZ0LCByaWdodCwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93LCBjdXJyZW50UGFnZUl0ZW0pIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmRvdHRlZExlZnQoaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdykgfHwgKHRoaXMuZG90dGVkUmlnaHQoaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdywgY3VycmVudFBhZ2VJdGVtKSk7DQogICAgICAgIH0sDQogICAgICAgIGRvdHRlZExlZnQ6IGZ1bmN0aW9uKGksIGxlZnQsIHJpZ2h0LCBjdXJyZW50UGFnZSwgaW5uZXJXaW5kb3cpIHsNCiAgICAgICAgICAgIHJldHVybiAoKGkgPT0gKGxlZnQgKyAxKSkgJiYgIXRoaXMuaW5uZXJXaW5kb3coaSwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93KSAmJiAhdGhpcy5yaWdodChpLCByaWdodCkpOw0KICAgICAgICB9LA0KICAgICAgICBkb3R0ZWRSaWdodDogZnVuY3Rpb24oaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdywgY3VycmVudFBhZ2VJdGVtKSB7DQogICAgICAgICAgICBpZiAocGFnaW5nTGlzdC5pdGVtc1tjdXJyZW50UGFnZUl0ZW0tMV0udmFsdWVzKCkuZG90dGVkKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gKChpID09IChyaWdodCkpICYmICF0aGlzLmlubmVyV2luZG93KGksIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdykgJiYgIXRoaXMucmlnaHQoaSwgcmlnaHQpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICB2YXIgYWRkRXZlbnQgPSBmdW5jdGlvbihlbG0sIGksIHBhZ2UpIHsNCiAgICAgICBldmVudHMuYmluZChlbG0sICdjbGljaycsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICBsaXN0LnNob3coKGktMSkqcGFnZSArIDEsIHBhZ2UpOw0KICAgICAgIH0pOw0KICAgIH07DQoNCiAgICByZXR1cm4gew0KICAgICAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRMaXN0KSB7DQogICAgICAgICAgICBsaXN0ID0gcGFyZW50TGlzdDsNCiAgICAgICAgICAgIHBhZ2luZ0xpc3QgPSBuZXcgTGlzdChsaXN0Lmxpc3RDb250YWluZXIuaWQsIHsNCiAgICAgICAgICAgICAgICBsaXN0Q2xhc3M6IG9wdGlvbnMucGFnaW5hdGlvbkNsYXNzIHx8ICdwYWdpbmF0aW9uJywNCiAgICAgICAgICAgICAgICBpdGVtOiAiPGxpPjxhIGNsYXNzPSdwYWdlJyBocmVmPSdqYXZhc2NyaXB0OmZ1bmN0aW9uIFooKXtaPVwiXCJ9WigpJz48L2E+PC9saT4iLA0KICAgICAgICAgICAgICAgIHZhbHVlTmFtZXM6IFsncGFnZScsICdkb3R0ZWQnXSwNCiAgICAgICAgICAgICAgICBzZWFyY2hDbGFzczogJ3BhZ2luYXRpb24tc2VhcmNoLXRoYXQtaXMtbm90LXN1cHBvc2VkLXRvLWV4aXN0JywNCiAgICAgICAgICAgICAgICBzb3J0Q2xhc3M6ICdwYWdpbmF0aW9uLXNvcnQtdGhhdC1pcy1ub3Qtc3VwcG9zZWQtdG8tZXhpc3QnDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGxpc3Qub24oJ3VwZGF0ZWQnLCByZWZyZXNoKTsNCiAgICAgICAgICAgIHJlZnJlc2goKTsNCiAgICAgICAgfSwNCiAgICAgICAgbmFtZTogb3B0aW9ucy5uYW1lIHx8ICJwYWdpbmF0aW9uIg0KICAgIH07DQp9Ow0KDQp9KTsNCg0KDQoNCg0KDQoNCnJlcXVpcmUuYWxpYXMoImNvbXBvbmVudC1jbGFzc2VzL2luZGV4LmpzIiwgImxpc3QucGFnaW5hdGlvbi5qcy9kZXBzL2NsYXNzZXMvaW5kZXguanMiKTsNCnJlcXVpcmUuYWxpYXMoImNvbXBvbmVudC1jbGFzc2VzL2luZGV4LmpzIiwgImNsYXNzZXMvaW5kZXguanMiKTsNCnJlcXVpcmUuYWxpYXMoImNvbXBvbmVudC1pbmRleG9mL2luZGV4LmpzIiwgImNvbXBvbmVudC1jbGFzc2VzL2RlcHMvaW5kZXhvZi9pbmRleC5qcyIpOw0KDQpyZXF1aXJlLmFsaWFzKCJjb21wb25lbnQtZXZlbnQvaW5kZXguanMiLCAibGlzdC5wYWdpbmF0aW9uLmpzL2RlcHMvZXZlbnQvaW5kZXguanMiKTsNCnJlcXVpcmUuYWxpYXMoImNvbXBvbmVudC1ldmVudC9pbmRleC5qcyIsICJldmVudC9pbmRleC5qcyIpOw0KDQpyZXF1aXJlLmFsaWFzKCJjb21wb25lbnQtaW5kZXhvZi9pbmRleC5qcyIsICJsaXN0LnBhZ2luYXRpb24uanMvZGVwcy9pbmRleG9mL2luZGV4LmpzIik7DQpyZXF1aXJlLmFsaWFzKCJjb21wb25lbnQtaW5kZXhvZi9pbmRleC5qcyIsICJpbmRleG9mL2luZGV4LmpzIik7DQoNCnJlcXVpcmUuYWxpYXMoImxpc3QucGFnaW5hdGlvbi5qcy9pbmRleC5qcyIsICJsaXN0LnBhZ2luYXRpb24uanMvaW5kZXguanMiKTtpZiAodHlwZW9mIGV4cG9ydHMgPT0gIm9iamVjdCIpIHsNCiAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJsaXN0LnBhZ2luYXRpb24uanMiKTsNCn0gZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQpIHsNCiAgZGVmaW5lKGZ1bmN0aW9uKCl7IHJldHVybiByZXF1aXJlKCJsaXN0LnBhZ2luYXRpb24uanMiKTsgfSk7DQp9IGVsc2Ugew0KICB0aGlzWyJMaXN0UGFnaW5hdGlvbiJdID0gcmVxdWlyZSgibGlzdC5wYWdpbmF0aW9uLmpzIik7DQp9fSkoKTsNCiAgPC9zY3JpcHQ+DQogIDwhLS1odHRwOi8vd3d3Lm1lbnVjb29sLmNvbS90YWJiZWQtY29udGVudC0tPg0KICA8IS0tPGxpbmsgaHJlZj0ic3R5bGVzaGVldHMvdGFiY29udGVudC5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+DQogIDxzdHlsZT4NCiAgICAvKiBUYWIgQ29udGVudCAtIG1lbnVjb29sLmNvbSAqLw0KICAgIHVsLnRhYnMgew0KICAgICAgcGFkZGluZzogMTRweCAwIDhweDsNCiAgICAgIG1hcmdpbjogMDsNCiAgICAgIGZvbnQtc2l6ZTogMDsNCiAgICAgIGxpc3Qtc3R5bGUtdHlwZTogbm9uZTsNCiAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICAvKnNldCB0byBsZWZ0LCBjZW50ZXIsIG9yIHJpZ2h0IHRvIGFsaWduIHRoZSB0YWJzIGFzIGRlc2lyZWQqLw0KICAgICAgYmFja2dyb3VuZDogI0RERERFMzsNCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNDQ0M7DQogICAgICBib3JkZXItYm90dG9tOiBub25lOw0KICAgICAgYm9yZGVyLXJhZGl1czogMnB4IDJweCAwIDA7DQogICAgICBwYWRkaW5nLWxlZnQ6IDEwcHg7DQogICAgICAvKiBPZmZzZXQgb2YgdGhlIGZpcnN0IHRhYiAqLw0KICAgIH0NCg0KICAgIHVsLnRhYnMgbGkgew0KICAgICAgZGlzcGxheTogaW5saW5lOw0KICAgICAgbWFyZ2luOiAwOw0KICAgICAgbWFyZ2luLXJpZ2h0OiAycHg7DQogICAgICAvKmRpc3RhbmNlIGJldHdlZW4gdGFicyovDQogICAgICBmb250OiBub3JtYWwgMTJweCBWZXJkYW5hOw0KICAgIH0NCg0KICAgIHVsLnRhYnMgbGkgYSB7DQogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICBwYWRkaW5nOiA4cHggMjJweDsNCiAgICAgIGNvbG9yOiAjMDAwOw0KICAgICAgYm9yZGVyLXJhZGl1czogM3B4IDNweCAwIDA7DQogICAgICBvdXRsaW5lOiBub25lOw0KICAgIH0NCg0KICAgIHVsLnRhYnMgbGkgYTpob3ZlciB7DQogICAgICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTsNCiAgICAgIGNvbG9yOiAjMDAwOw0KICAgIH0NCg0KICAgIHVsLnRhYnMgbGkuc2VsZWN0ZWQgYSB7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICB0b3A6IDBweDsNCiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgYmFja2dyb3VuZDogI0ZGRjsNCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNBQUE7DQogICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI0ZGRjsNCiAgICAgIGNvbG9yOiAjMDAwOw0KICAgIH0NCg0KICAgIHVsLnRhYnMgbGkuc2VsZWN0ZWQgYTpob3ZlciwNCiAgICB1bC50YWJzIGxpLnNlbGVjdGVkIGE6aG92ZXIgew0KICAgICAgdGV4dC1kZWNvcmF0aW9uOiBub25lOw0KICAgIH0NCg0KICAgIGRpdi50YWJjb250ZW50cyB7DQogICAgICBib3JkZXI6IDFweCBzb2xpZCAjQ0NDOw0KICAgICAgcGFkZGluZzogMTVweDsNCiAgICAgIGJvcmRlci10b3AtY29sb3I6ICNBQUE7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGOw0KICAgICAgYm9yZGVyLXJhZGl1czogMCAwIDJweCAycHg7DQogICAgfQ0KICA8L3N0eWxlPg0KICA8IS0tPHNjcmlwdCBzcmM9ImphdmFzY3JpcHRzL3RhYmNvbnRlbnQuanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+LS0+DQogIDxzY3JpcHQ+DQogICAgLyogaHR0cDovL3d3dy5tZW51Y29vbC5jb20vdGFiYmVkLWNvbnRlbnQgRnJlZSB0byB1c2UuIHYyMDEzLjcuNiAqLw0KICAgIChmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgcHJldmVudERlZmF1bHQgPSBmdW5jdGlvbiAoZXZ0KSB7DQogICAgICAgIGlmIChldnQgJiYgZXZ0LnN0b3BQcm9wYWdhdGlvbikgew0KICAgICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZXZ0ICYmIGV2dC5wcmV2ZW50RGVmYXVsdCkgew0KICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgICBhZGRFdmVudCA9IGZ1bmN0aW9uIChlbGVtLCBldmVudE5hbWUsIGZuKSB7DQogICAgICAgICAgaWYgKGVsZW0uYWRkRXZlbnRMaXN0ZW5lcikgew0KICAgICAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZm4sIGZhbHNlKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgZWxlbS5hdHRhY2hFdmVudCgib24iICsgZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgIC8vIHNldCB0aGUgdGhpcyBwb2ludGVyIHNhbWUgYXMgYWRkRXZlbnRMaXN0ZW5lciB3aGVuIGZuIGlzIGNhbGxlZA0KICAgICAgICAgICAgICByZXR1cm4gKGZuLmNhbGwoZWxlbSwgd2luZG93LmV2ZW50KSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGhhc0NsYXNzID0gZnVuY3Rpb24gKGVsZW0sIGNsYXNzTmFtZSkgew0KICAgICAgICAgIHZhciBjbGFzc1BhdHRlcm4gPSBuZXcgUmVnRXhwKCIoXnwgKSIgKyBjbGFzc05hbWUgKyAiKCB8JCkiKTsNCiAgICAgICAgICByZXR1cm4gY2xhc3NQYXR0ZXJuLnRlc3QoZWxlbS5jbGFzc05hbWUpID8gdHJ1ZSA6IGZhbHNlOw0KICAgICAgICB9LA0KICAgICAgICBhZGRDbGFzcyA9IGZ1bmN0aW9uIChlbGVtLCBjbGFzc05hbWUsIGZpcnN0KSB7DQogICAgICAgICAgaWYgKCFoYXNDbGFzcyhlbGVtLCBjbGFzc05hbWUpKSB7DQogICAgICAgICAgICBpZiAoZWxlbS5jbGFzc05hbWUgPT0gIiIpIHsNCiAgICAgICAgICAgICAgZWxlbS5jbGFzc05hbWUgPSBjbGFzc05hbWU7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGZpcnN0KSB7DQogICAgICAgICAgICAgIGVsZW0uY2xhc3NOYW1lID0gY2xhc3NOYW1lICsgIiAiICsgZWxlbS5jbGFzc05hbWU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBlbGVtLmNsYXNzTmFtZSArPSAiICIgKyBjbGFzc05hbWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICByZW1vdmVDbGFzcyA9IGZ1bmN0aW9uIChlbGVtLCBjbGFzc05hbWUpIHsNCiAgICAgICAgICB2YXIgY2xhc3NQYXR0ZXJuID0gbmV3IFJlZ0V4cCgiKF58ICkiICsgY2xhc3NOYW1lICsgIiggfCQpIik7DQogICAgICAgICAgZWxlbS5jbGFzc05hbWUgPSBlbGVtLmNsYXNzTmFtZS5yZXBsYWNlKGNsYXNzUGF0dGVybiwgIiQxIik7DQogICAgICAgICAgZWxlbS5jbGFzc05hbWUgPSBlbGVtLmNsYXNzTmFtZS5yZXBsYWNlKC8gJC8sICIiKQ0KICAgICAgICB9LA0KICAgICAgICBwYWdlTmFtZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICB2YXIgcGF0aCA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTsNCiAgICAgICAgICB2YXIgbGFzdFBhcnQgPSAnJzsNCiAgICAgICAgICBpZiAocGF0aC5pbmRleE9mKCIvIikgIT0gLTEpIHsNCiAgICAgICAgICAgIHBhdGhQYXJ0cyA9IHBhdGguc3BsaXQoIi8iKS5maWx0ZXIocGFydCA9PiBwYXJ0Lmxlbmd0aCA+IDApOw0KICAgICAgICAgICAgbGFzdFBhcnQgPSBwYXRoUGFydHNbcGF0aFBhcnRzLmxlbmd0aCAtIDFdIHx8ICJyb290IjsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbGFzdFBhcnQgPSBwYXRoIHx8ICJyb290IjsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKGxhc3RQYXJ0LmluZGV4T2YoIi4iKSAhPSAtMSkgew0KICAgICAgICAgICAgbGFzdFBhcnQgPSBsYXN0UGFydC5zdWJzdHJpbmcoMCwgbGFzdFBhcnQuaW5kZXhPZigiLiIpKTsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKGxhc3RQYXJ0Lmxlbmd0aCA+IDIwKSB7DQogICAgICAgICAgICBsYXN0UGFydCA9IGxhc3RQYXJ0LnN1YnN0cmluZyhsYXN0UGFydC5sZW5ndGggLSAxOSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiBsYXN0UGFydDsNCiAgICAgICAgfSwNCiAgICAgICAgY29va2llTmFtZSA9ICJtaSIgKyBwYWdlTmFtZSgpLA0KICAgICAgICBUYWJHcm91cCA9IGZ1bmN0aW9uIChlbGVtLCBpbmRleCkgew0KICAgICAgICAgIHRoaXMuaW5pdChlbGVtLCBpbmRleCkNCiAgICAgICAgfTsNCiAgICAgIFRhYkdyb3VwLnByb3RvdHlwZSA9IHsNCiAgICAgICAgbG9hZFNlbGVjdGVkVGFiOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgdmFyIGNvb2tpZVBhdHRlcm4gPSBuZXcgUmVnRXhwKGNvb2tpZU5hbWUgKyB0aGlzLmluZGV4ICsgIj0oXFxkKykiKSwNCiAgICAgICAgICAgIGNvb2tpZU1hdGNoID0gZG9jdW1lbnQuY29va2llLm1hdGNoKGNvb2tpZVBhdHRlcm4pOw0KICAgICAgICAgIHJldHVybiBjb29raWVNYXRjaCA/IGNvb2tpZU1hdGNoWzFdIDogdGhpcy5nZXRTZWxlY3RlZEluZGV4KCkNCiAgICAgICAgfSwNCiAgICAgICAgZ2V0U2VsZWN0ZWRJbmRleDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHZhciBjID0gdGhpcy50YWJzLmxlbmd0aDsNCiAgICAgICAgICBmb3IgKHZhciBiID0gMDsgYiA8IGM7IGIrKykgew0KICAgICAgICAgICAgaWYgKGhhc0NsYXNzKHRoaXMudGFic1tiXS5wYXJlbnROb2RlLCAic2VsZWN0ZWQiKSkgew0KICAgICAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0sDQogICAgICAgIHNlbGVjdFRhYjogZnVuY3Rpb24gKHRhYkxpbmssIHVwZGF0ZUNvb2tpZSkgew0KICAgICAgICAgIHZhciB0YXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJMaW5rLnRhcmdldElkKTsNCiAgICAgICAgICBpZiAoIXRhcmdldCkgcmV0dXJuOw0KICAgICAgICAgIHRoaXMuc2hvd1RhYih0YXJnZXQpOw0KICAgICAgICAgIGZvciAodmFyIGEgPSAwOyBhIDwgdGhpcy50YWJzLmxlbmd0aDsgYSsrKQ0KICAgICAgICAgICAgaWYgKHRoaXMudGFic1thXSA9PSB0YWJMaW5rKSB7DQogICAgICAgICAgICAgIGFkZENsYXNzKHRhYkxpbmsucGFyZW50Tm9kZSwgInNlbGVjdGVkIik7DQogICAgICAgICAgICAgIGlmICh1cGRhdGVDb29raWUgJiYgdGhpcy5kYXRhUGVyc2lzdCkgew0KICAgICAgICAgICAgICAgIHRoaXMuc3RvcmVTZWxlY3RlZFRhYih0aGlzLmluZGV4LCBhKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3ModGhpcy50YWJzW2FdLnBhcmVudE5vZGUsICJzZWxlY3RlZCIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBzdG9yZVNlbGVjdGVkVGFiOiBmdW5jdGlvbiAodGFiR3JvdXBJbmRleCwgdGFiSW5kZXgpIHsNCiAgICAgICAgICBkb2N1bWVudC5jb29raWUgPSBjb29raWVOYW1lICsgdGFiR3JvdXBJbmRleCArICI9IiArIHRhYkluZGV4ICsgIjsgcGF0aD0vIg0KICAgICAgICB9LA0KICAgICAgICBzaG93VGFiOiBmdW5jdGlvbiAodGFyZ2V0KSB7DQogICAgICAgICAgZm9yICh2YXIgYSA9IDA7IGEgPCB0aGlzLnRhcmdldHMubGVuZ3RoOyBhKyspIHsNCiAgICAgICAgICAgIHRoaXMudGFyZ2V0c1thXS5zdHlsZS5kaXNwbGF5ID0gdGhpcy50YXJnZXRzW2FdLmlkID09IHRhcmdldC5pZCA/ICJibG9jayIgOiAibm9uZSI7DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBpbml0VGFiczogZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHRoaXMudGFyZ2V0cyA9IFtdOw0KICAgICAgICAgIHZhciB0YWJHcm91cCA9IHRoaXM7DQogICAgICAgICAgZm9yICh2YXIgYSA9IDA7IGEgPCB0aGlzLnRhYnMubGVuZ3RoOyBhKyspIHsNCiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnRhYnNbYV0udGFyZ2V0SWQpOw0KICAgICAgICAgICAgaWYgKHRhcmdldCkgew0KICAgICAgICAgICAgICB0aGlzLnRhcmdldHMucHVzaCh0YXJnZXQpOw0KICAgICAgICAgICAgICBhZGRFdmVudCh0aGlzLnRhYnNbYV0sICJjbGljayIsIGZ1bmN0aW9uIChldnQpIHsNCiAgICAgICAgICAgICAgICB2YXIgdGFiTGluayA9IHRoaXM7DQogICAgICAgICAgICAgICAgaWYgKHRhYkxpbmsgPT09IHdpbmRvdykgew0KICAgICAgICAgICAgICAgICAgdGFiTGluayA9IHdpbmRvdy5ldmVudC5zcmNFbGVtZW50Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0YWJHcm91cC5zZWxlY3RUYWIodGFiTGluaywgMSk7DQogICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQoZXZ0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBpbml0OiBmdW5jdGlvbiAoZWxlbSwgaW5kZXgpIHsNCiAgICAgICAgICB0aGlzLmluZGV4ID0gaW5kZXg7DQogICAgICAgICAgdGhpcy50YWJzID0gW107DQogICAgICAgICAgdmFyIGxpbmtzID0gZWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYSIpLA0KICAgICAgICAgICAgYW5jaG9yUGF0dGVybiA9IC8jKFteP10rKS87DQogICAgICAgICAgZm9yIChjID0gMDsgYyA8IGxpbmtzLmxlbmd0aDsgYysrKSB7DQogICAgICAgICAgICB2YXIgdGFiTGluayA9IGxpbmtzW2NdOw0KICAgICAgICAgICAgdmFyIGhyZWYgPSB0YWJMaW5rLmdldEF0dHJpYnV0ZSgiaHJlZiIpOw0KICAgICAgICAgICAgaWYgKGhyZWYuaW5kZXhPZigiIyIpID09IC0xKSB7DQogICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgdmFyIGFuY2hvck1hdGNoID0gaHJlZi5tYXRjaChhbmNob3JQYXR0ZXJuKTsNCiAgICAgICAgICAgICAgaWYgKGFuY2hvck1hdGNoKSB7DQogICAgICAgICAgICAgICAgaHJlZiA9IGFuY2hvck1hdGNoWzFdOw0KICAgICAgICAgICAgICAgIHRhYkxpbmsudGFyZ2V0SWQgPSBocmVmOw0KICAgICAgICAgICAgICAgIHRoaXMudGFicy5wdXNoKHRhYkxpbmspOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIHZhciBkYXRhUGVyc2lzdCA9IGVsZW0uZ2V0QXR0cmlidXRlKCJkYXRhLXBlcnNpc3QiKSB8fCAiIjsNCiAgICAgICAgICB0aGlzLmRhdGFQZXJzaXN0ID0gZGF0YVBlcnNpc3QudG9Mb3dlckNhc2UoKSA9PSAidHJ1ZSIgPyAxIDogMDsNCiAgICAgICAgICB0aGlzLmluaXRUYWJzKCk7DQogICAgICAgICAgdGhpcy5pbml0U2VsZWN0ZWRUYWIoKQ0KICAgICAgICB9LA0KICAgICAgICBpbml0U2VsZWN0ZWRUYWI6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICB2YXIgc2VsZWN0ZWRUYWJJbmRleCA9IHRoaXMuZGF0YVBlcnNpc3QgPyBwYXJzZUludCh0aGlzLmxvYWRTZWxlY3RlZFRhYigpKSA6IHRoaXMuZ2V0U2VsZWN0ZWRJbmRleCgpOw0KICAgICAgICAgIGlmIChzZWxlY3RlZFRhYkluZGV4ID49IHRoaXMudGFicy5sZW5ndGgpIHsNCiAgICAgICAgICAgIHNlbGVjdGVkVGFiSW5kZXggPSAwOw0KICAgICAgICAgIH0NCiAgICAgICAgICB0aGlzLnNlbGVjdFRhYih0aGlzLnRhYnNbc2VsZWN0ZWRUYWJJbmRleF0sIDApOw0KICAgICAgICB9DQogICAgICB9Ow0KICAgICAgdmFyIHRhYkdyb3VwcyA9IFtdLA0KICAgICAgICBkb2N1bWVudFJlYWR5ID0gZnVuY3Rpb24gKGZ1bmMpIHsNCiAgICAgICAgICB2YXIgc3RhcnRpbmcgPSBmYWxzZTsNCg0KICAgICAgICAgIGZ1bmN0aW9uIHN0YXJ0RnVuYygpIHsNCiAgICAgICAgICAgIGlmIChzdGFydGluZykgcmV0dXJuOw0KICAgICAgICAgICAgc3RhcnRpbmcgPSB0cnVlOw0KICAgICAgICAgICAgc2V0VGltZW91dChmdW5jLCA0KQ0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgew0KICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIHN0YXJ0RnVuYywgZmFsc2UpOw0KICAgICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQuYXR0YWNoRXZlbnQpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgIHZhciB0b3BsZXZlbCA9IHdpbmRvdy5mcmFtZUVsZW1lbnQgPT0gbnVsbDsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgfQ0KICAgICAgICAgICAgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCAmJiB0b3BsZXZlbCkgew0KICAgICAgICAgICAgICBmdW5jdGlvbiBkb1Njcm9sbENoZWNrKCkgew0KICAgICAgICAgICAgICAgIGlmIChzdGFydGluZykgcmV0dXJuOw0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwoImxlZnQiKTsNCiAgICAgICAgICAgICAgICAgIHN0YXJ0RnVuYygpDQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChkb1Njcm9sbENoZWNrLCAxMCkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgZG9TY3JvbGxDaGVjaygpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBkb2N1bWVudC5hdHRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiICYmIHN0YXJ0RnVuYygpDQogICAgICAgICAgICB9KQ0KICAgICAgICAgIH0NCiAgICAgICAgICBhZGRFdmVudCh3aW5kb3csICJsb2FkIiwgc3RhcnRGdW5jKQ0KICAgICAgICB9LA0KICAgICAgICBpbml0VGFiR3JvdXBzID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHZhciBwb3NzaWJsZVRhYkdyb3VwcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ1bCIpLA0KICAgICAgICAgICAgZSA9IHBvc3NpYmxlVGFiR3JvdXBzLmxlbmd0aDsNCiAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgZTsgYysrKSB7DQogICAgICAgICAgICBpZiAoaGFzQ2xhc3MocG9zc2libGVUYWJHcm91cHNbY10sICJ0YWJzIikpIHsNCiAgICAgICAgICAgICAgdGFiR3JvdXBzLnB1c2gobmV3IFRhYkdyb3VwKHBvc3NpYmxlVGFiR3JvdXBzW2NdLCBjKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgZG9jdW1lbnRSZWFkeShpbml0VGFiR3JvdXBzKTsNCiAgICAgIHJldHVybiB7fQ0KICAgIH0pKCkNCg0KICA8L3NjcmlwdD4NCiAgPCEtLVhNTCBGb3JtYXR0ZXItLT4NCiAgPCEtLTxzY3JpcHQgc3JjPSJqYXZhc2NyaXB0cy94bWwtZm9ybWF0dGVyLmpzIj48L3NjcmlwdD4tLT4NCiAgPHNjcmlwdD4NCiAgICByZXF1aXJlID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gcihlLCBuLCB0KSB7IGZ1bmN0aW9uIG8oaSwgZikgeyBpZiAoIW5baV0pIHsgaWYgKCFlW2ldKSB7IHZhciBjID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgcmVxdWlyZSAmJiByZXF1aXJlOyBpZiAoIWYgJiYgYykgcmV0dXJuIGMoaSwgITApOyBpZiAodSkgcmV0dXJuIHUoaSwgITApOyB2YXIgYSA9IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciICsgaSArICInIik7IHRocm93IGEuY29kZSA9ICJNT0RVTEVfTk9UX0ZPVU5EIiwgYSB9IHZhciBwID0gbltpXSA9IHsgZXhwb3J0czoge30gfTsgZVtpXVswXS5jYWxsKHAuZXhwb3J0cywgZnVuY3Rpb24gKHIpIHsgdmFyIG4gPSBlW2ldWzFdW3JdOyByZXR1cm4gbyhuIHx8IHIpIH0sIHAsIHAuZXhwb3J0cywgciwgZSwgbiwgdCkgfSByZXR1cm4gbltpXS5leHBvcnRzIH0gZm9yICh2YXIgdSA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHJlcXVpcmUgJiYgcmVxdWlyZSwgaSA9IDA7IGkgPCB0Lmxlbmd0aDsgaSsrKW8odFtpXSk7IHJldHVybiBvIH0gcmV0dXJuIHIgfSkoKSh7DQogIDE6IFtmdW5jdGlvbiAocmVxdWlyZSwgbW9kdWxlLCBleHBvcnRzKSB7DQogICAgInVzZSBzdHJpY3QiOw0KDQogICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9DQogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9DQogICAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQ0KICAgIGZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7IHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOyByZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7IHZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSwgcmVzdWx0OyBpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgeyB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOyByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOyB9IGVsc2UgeyByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOyB9OyB9DQogICAgZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IGVsc2UgaWYgKGNhbGwgIT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9DQogICAgZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7IGlmIChzZWxmID09PSB2b2lkIDApIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfQ0KICAgIGZ1bmN0aW9uIF93cmFwTmF0aXZlU3VwZXIoQ2xhc3MpIHsgdmFyIF9jYWNoZSA9IHR5cGVvZiBNYXAgPT09ICJmdW5jdGlvbiIgPyBuZXcgTWFwKCkgOiB1bmRlZmluZWQ7IF93cmFwTmF0aXZlU3VwZXIgPSBmdW5jdGlvbiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKSB7IGlmIChDbGFzcyA9PT0gbnVsbCB8fCAhX2lzTmF0aXZlRnVuY3Rpb24oQ2xhc3MpKSByZXR1cm4gQ2xhc3M7IGlmICh0eXBlb2YgQ2xhc3MgIT09ICJmdW5jdGlvbiIpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBpZiAodHlwZW9mIF9jYWNoZSAhPT0gInVuZGVmaW5lZCIpIHsgaWYgKF9jYWNoZS5oYXMoQ2xhc3MpKSByZXR1cm4gX2NhY2hlLmdldChDbGFzcyk7IF9jYWNoZS5zZXQoQ2xhc3MsIFdyYXBwZXIpOyB9IGZ1bmN0aW9uIFdyYXBwZXIoKSB7IHJldHVybiBfY29uc3RydWN0KENsYXNzLCBhcmd1bWVudHMsIF9nZXRQcm90b3R5cGVPZih0aGlzKS5jb25zdHJ1Y3Rvcik7IH0gV3JhcHBlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKENsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogV3JhcHBlciwgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihXcmFwcGVyLCBDbGFzcyk7IH07IHJldHVybiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKTsgfQ0KICAgIGZ1bmN0aW9uIF9jb25zdHJ1Y3QoUGFyZW50LCBhcmdzLCBDbGFzcykgeyBpZiAoX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpKSB7IF9jb25zdHJ1Y3QgPSBSZWZsZWN0LmNvbnN0cnVjdDsgfSBlbHNlIHsgX2NvbnN0cnVjdCA9IGZ1bmN0aW9uIF9jb25zdHJ1Y3QoUGFyZW50LCBhcmdzLCBDbGFzcykgeyB2YXIgYSA9IFtudWxsXTsgYS5wdXNoLmFwcGx5KGEsIGFyZ3MpOyB2YXIgQ29uc3RydWN0b3IgPSBGdW5jdGlvbi5iaW5kLmFwcGx5KFBhcmVudCwgYSk7IHZhciBpbnN0YW5jZSA9IG5ldyBDb25zdHJ1Y3RvcigpOyBpZiAoQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihpbnN0YW5jZSwgQ2xhc3MucHJvdG90eXBlKTsgcmV0dXJuIGluc3RhbmNlOyB9OyB9IHJldHVybiBfY29uc3RydWN0LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7IH0NCiAgICBmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgeyBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkgcmV0dXJuIGZhbHNlOyBpZiAoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSkgcmV0dXJuIGZhbHNlOyBpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKSByZXR1cm4gdHJ1ZTsgdHJ5IHsgQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbiAoKSB7IH0pKTsgcmV0dXJuIHRydWU7IH0gY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlOyB9IH0NCiAgICBmdW5jdGlvbiBfaXNOYXRpdmVGdW5jdGlvbihmbikgeyByZXR1cm4gRnVuY3Rpb24udG9TdHJpbmcuY2FsbChmbikuaW5kZXhPZigiW25hdGl2ZSBjb2RlXSIpICE9PSAtMTsgfQ0KICAgIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9DQogICAgZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQ0KICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgICAgIHZhbHVlOiB0cnVlDQogICAgfSk7DQogICAgZXhwb3J0cy5QYXJzaW5nRXJyb3IgPSB2b2lkIDA7DQogICAgdmFyIFBhcnNpbmdFcnJvciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Vycm9yKSB7DQogICAgICBfaW5oZXJpdHMoUGFyc2luZ0Vycm9yLCBfRXJyb3IpOw0KICAgICAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihQYXJzaW5nRXJyb3IpOw0KICAgICAgZnVuY3Rpb24gUGFyc2luZ0Vycm9yKG1lc3NhZ2UsIGNhdXNlKSB7DQogICAgICAgIHZhciBfdGhpczsNCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBhcnNpbmdFcnJvcik7DQogICAgICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbWVzc2FnZSk7DQogICAgICAgIF90aGlzLmNhdXNlID0gY2F1c2U7DQogICAgICAgIHJldHVybiBfdGhpczsNCiAgICAgIH0NCiAgICAgIHJldHVybiBQYXJzaW5nRXJyb3I7DQoNCiAgICB9KCAvKiNfX1BVUkVfXyovX3dyYXBOYXRpdmVTdXBlcihFcnJvcikpOw0KICAgIGV4cG9ydHMuUGFyc2luZ0Vycm9yID0gUGFyc2luZ0Vycm9yOw0KICAgIHZhciBwYXJzaW5nU3RhdGU7DQoNCiAgICBmdW5jdGlvbiBuZXh0Q2hpbGQoKSB7DQogICAgICByZXR1cm4gZWxlbWVudChmYWxzZSkgfHwgdGV4dCgpIHx8IGNvbW1lbnQoKSB8fCBjZGF0YSgpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG5leHRSb290Q2hpbGQoKSB7DQogICAgICBtYXRjaCgvXHMqLyk7DQogICAgICByZXR1cm4gZWxlbWVudCh0cnVlKSB8fCBjb21tZW50KCkgfHwgZG9jdHlwZSgpIHx8IHByb2Nlc3NpbmdJbnN0cnVjdGlvbihmYWxzZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcGFyc2VEb2N1bWVudCgpIHsNCiAgICAgIHZhciBkZWNsYXJhdGlvbiA9IHByb2Nlc3NpbmdJbnN0cnVjdGlvbih0cnVlKTsNCiAgICAgIHZhciBjaGlsZHJlbiA9IFtdOw0KICAgICAgdmFyIGRvY3VtZW50Um9vdE5vZGU7DQogICAgICB2YXIgY2hpbGQgPSBuZXh0Um9vdENoaWxkKCk7DQogICAgICB3aGlsZSAoY2hpbGQpIHsNCiAgICAgICAgaWYgKGNoaWxkLm5vZGUudHlwZSA9PT0gJ0VsZW1lbnQnKSB7DQogICAgICAgICAgaWYgKGRvY3VtZW50Um9vdE5vZGUpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRm91bmQgbXVsdGlwbGUgcm9vdCBub2RlcycpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBkb2N1bWVudFJvb3ROb2RlID0gY2hpbGQubm9kZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWNoaWxkLmV4Y2x1ZGVkKSB7DQogICAgICAgICAgY2hpbGRyZW4ucHVzaChjaGlsZC5ub2RlKTsNCiAgICAgICAgfQ0KICAgICAgICBjaGlsZCA9IG5leHRSb290Q2hpbGQoKTsNCiAgICAgIH0NCiAgICAgIGlmICghZG9jdW1lbnRSb290Tm9kZSkgew0KICAgICAgICB0aHJvdyBuZXcgUGFyc2luZ0Vycm9yKCdGYWlsZWQgdG8gcGFyc2UgWE1MJywgJ1Jvb3QgRWxlbWVudCBub3QgZm91bmQnKTsNCiAgICAgIH0NCiAgICAgIGlmIChwYXJzaW5nU3RhdGUueG1sLmxlbmd0aCAhPT0gMCkgew0KICAgICAgICB0aHJvdyBuZXcgUGFyc2luZ0Vycm9yKCdGYWlsZWQgdG8gcGFyc2UgWE1MJywgJ05vdCBXZWxsLUZvcm1lZCBYTUwnKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiB7DQogICAgICAgIGRlY2xhcmF0aW9uOiBkZWNsYXJhdGlvbiA/IGRlY2xhcmF0aW9uLm5vZGUgOiBudWxsLA0KICAgICAgICByb290OiBkb2N1bWVudFJvb3ROb2RlLA0KICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4NCiAgICAgIH07DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcHJvY2Vzc2luZ0luc3RydWN0aW9uKG1hdGNoRGVjbGFyYXRpb24pIHsNCiAgICAgIHZhciBtID0gbWF0Y2hEZWNsYXJhdGlvbiA/IG1hdGNoKC9ePFw/KHhtbClccyovKSA6IG1hdGNoKC9ePFw/KFtcdy06Ll0rKVxzKi8pOw0KICAgICAgaWYgKCFtKSByZXR1cm47DQogICAgICAvLyB0YWcNCiAgICAgIHZhciBub2RlID0gew0KICAgICAgICBuYW1lOiBtWzFdLA0KICAgICAgICB0eXBlOiAnUHJvY2Vzc2luZ0luc3RydWN0aW9uJywNCiAgICAgICAgYXR0cmlidXRlczoge30NCiAgICAgIH07DQogICAgICAvLyBhdHRyaWJ1dGVzDQogICAgICB3aGlsZSAoIShlb3MoKSB8fCBpcygnPz4nKSkpIHsNCiAgICAgICAgdmFyIGF0dHIgPSBhdHRyaWJ1dGUoKTsNCiAgICAgICAgaWYgKGF0dHIpIHsNCiAgICAgICAgICBub2RlLmF0dHJpYnV0ZXNbYXR0ci5uYW1lXSA9IGF0dHIudmFsdWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBtYXRjaCgvXD8+Lyk7DQogICAgICByZXR1cm4gew0KICAgICAgICBleGNsdWRlZDogbWF0Y2hEZWNsYXJhdGlvbiA/IGZhbHNlIDogcGFyc2luZ1N0YXRlLm9wdGlvbnMuZmlsdGVyKG5vZGUpID09PSBmYWxzZSwNCiAgICAgICAgbm9kZTogbm9kZQ0KICAgICAgfTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBlbGVtZW50KG1hdGNoUm9vdCkgew0KICAgICAgdmFyIG0gPSBtYXRjaCgvXjwoW14/ITwvPlxzXSspXHMqLyk7DQogICAgICBpZiAoIW0pIHJldHVybjsNCiAgICAgIC8vIG5hbWUNCiAgICAgIHZhciBub2RlID0gew0KICAgICAgICB0eXBlOiAnRWxlbWVudCcsDQogICAgICAgIG5hbWU6IG1bMV0sDQogICAgICAgIGF0dHJpYnV0ZXM6IHt9LA0KICAgICAgICBjaGlsZHJlbjogW10NCiAgICAgIH07DQogICAgICB2YXIgZXhjbHVkZWQgPSBtYXRjaFJvb3QgPyBmYWxzZSA6IHBhcnNpbmdTdGF0ZS5vcHRpb25zLmZpbHRlcihub2RlKSA9PT0gZmFsc2U7DQogICAgICAvLyBhdHRyaWJ1dGVzDQogICAgICB3aGlsZSAoIShlb3MoKSB8fCBpcygnPicpIHx8IGlzKCc/PicpIHx8IGlzKCcvPicpKSkgew0KICAgICAgICB2YXIgYXR0ciA9IGF0dHJpYnV0ZSgpOw0KICAgICAgICBpZiAoYXR0cikgew0KICAgICAgICAgIG5vZGUuYXR0cmlidXRlc1thdHRyLm5hbWVdID0gYXR0ci52YWx1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8vIHNlbGYgY2xvc2luZyB0YWcNCiAgICAgIGlmIChtYXRjaCgvXlxzKlwvPi8pKSB7DQogICAgICAgIG5vZGUuY2hpbGRyZW4gPSBudWxsOw0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgIGV4Y2x1ZGVkOiBleGNsdWRlZCwNCiAgICAgICAgICBub2RlOiBub2RlDQogICAgICAgIH07DQogICAgICB9DQogICAgICBtYXRjaCgvXD8/Pi8pOw0KICAgICAgLy8gY2hpbGRyZW4NCiAgICAgIHZhciBjaGlsZCA9IG5leHRDaGlsZCgpOw0KICAgICAgd2hpbGUgKGNoaWxkKSB7DQogICAgICAgIGlmICghY2hpbGQuZXhjbHVkZWQpIHsNCiAgICAgICAgICBub2RlLmNoaWxkcmVuLnB1c2goY2hpbGQubm9kZSk7DQogICAgICAgIH0NCiAgICAgICAgY2hpbGQgPSBuZXh0Q2hpbGQoKTsNCiAgICAgIH0NCiAgICAgIC8vIGNsb3NpbmcNCiAgICAgIGlmIChwYXJzaW5nU3RhdGUub3B0aW9ucy5zdHJpY3RNb2RlKSB7DQogICAgICAgIHZhciBjbG9zaW5nVGFnID0gIjwvIi5jb25jYXQobm9kZS5uYW1lLCAiPiIpOw0KICAgICAgICBpZiAocGFyc2luZ1N0YXRlLnhtbC5zdGFydHNXaXRoKGNsb3NpbmdUYWcpKSB7DQogICAgICAgICAgcGFyc2luZ1N0YXRlLnhtbCA9IHBhcnNpbmdTdGF0ZS54bWwuc2xpY2UoY2xvc2luZ1RhZy5sZW5ndGgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRocm93IG5ldyBQYXJzaW5nRXJyb3IoJ0ZhaWxlZCB0byBwYXJzZSBYTUwnLCAiQ2xvc2luZyB0YWcgbm90IG1hdGNoaW5nIFwiIi5jb25jYXQoY2xvc2luZ1RhZywgIlwiIikpOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBtYXRjaCgvXjxcL1xzKltcdy06Llx1MDBDMC1cdTAwRkZdKz4vKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiB7DQogICAgICAgIGV4Y2x1ZGVkOiBleGNsdWRlZCwNCiAgICAgICAgbm9kZTogbm9kZQ0KICAgICAgfTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBkb2N0eXBlKCkgew0KICAgICAgdmFyIG0gPSBtYXRjaCgvXjwhRE9DVFlQRVxzK1xTK1xzK1NZU1RFTVtePl0qPi8pIHx8IG1hdGNoKC9ePCFET0NUWVBFXHMrXFMrXHMrUFVCTElDW14+XSo+LykgfHwgbWF0Y2goL148IURPQ1RZUEVccytcUytccytcW1teXF1dKl0+Lyk7DQogICAgICBpZiAobSkgew0KICAgICAgICB2YXIgbm9kZSA9IHsNCiAgICAgICAgICB0eXBlOiAnRG9jdW1lbnRUeXBlJywNCiAgICAgICAgICBjb250ZW50OiBtWzBdDQogICAgICAgIH07DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgZXhjbHVkZWQ6IHBhcnNpbmdTdGF0ZS5vcHRpb25zLmZpbHRlcihub2RlKSA9PT0gZmFsc2UsDQogICAgICAgICAgbm9kZTogbm9kZQ0KICAgICAgICB9Ow0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNkYXRhKCkgew0KICAgICAgaWYgKHBhcnNpbmdTdGF0ZS54bWwuc3RhcnRzV2l0aCgnPCFbQ0RBVEFbJykpIHsNCiAgICAgICAgdmFyIGVuZFBvc2l0aW9uU3RhcnQgPSBwYXJzaW5nU3RhdGUueG1sLmluZGV4T2YoJ11dPicpOw0KICAgICAgICBpZiAoZW5kUG9zaXRpb25TdGFydCA+IC0xKSB7DQogICAgICAgICAgdmFyIGVuZFBvc2l0aW9uRmluaXNoID0gZW5kUG9zaXRpb25TdGFydCArIDM7DQogICAgICAgICAgdmFyIG5vZGUgPSB7DQogICAgICAgICAgICB0eXBlOiAnQ0RBVEEnLA0KICAgICAgICAgICAgY29udGVudDogcGFyc2luZ1N0YXRlLnhtbC5zdWJzdHJpbmcoMCwgZW5kUG9zaXRpb25GaW5pc2gpDQogICAgICAgICAgfTsNCiAgICAgICAgICBwYXJzaW5nU3RhdGUueG1sID0gcGFyc2luZ1N0YXRlLnhtbC5zbGljZShlbmRQb3NpdGlvbkZpbmlzaCk7DQogICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIGV4Y2x1ZGVkOiBwYXJzaW5nU3RhdGUub3B0aW9ucy5maWx0ZXIobm9kZSkgPT09IGZhbHNlLA0KICAgICAgICAgICAgbm9kZTogbm9kZQ0KICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjb21tZW50KCkgew0KICAgICAgdmFyIG0gPSBtYXRjaCgvXjwhLS1bXHNcU10qPy0tPi8pOw0KICAgICAgaWYgKG0pIHsNCiAgICAgICAgdmFyIG5vZGUgPSB7DQogICAgICAgICAgdHlwZTogJ0NvbW1lbnQnLA0KICAgICAgICAgIGNvbnRlbnQ6IG1bMF0NCiAgICAgICAgfTsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICBleGNsdWRlZDogcGFyc2luZ1N0YXRlLm9wdGlvbnMuZmlsdGVyKG5vZGUpID09PSBmYWxzZSwNCiAgICAgICAgICBub2RlOiBub2RlDQogICAgICAgIH07DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdGV4dCgpIHsNCiAgICAgIHZhciBtID0gbWF0Y2goL14oW148XSspLyk7DQogICAgICBpZiAobSkgew0KICAgICAgICB2YXIgbm9kZSA9IHsNCiAgICAgICAgICB0eXBlOiAnVGV4dCcsDQogICAgICAgICAgY29udGVudDogbVsxXQ0KICAgICAgICB9Ow0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgIGV4Y2x1ZGVkOiBwYXJzaW5nU3RhdGUub3B0aW9ucy5maWx0ZXIobm9kZSkgPT09IGZhbHNlLA0KICAgICAgICAgIG5vZGU6IG5vZGUNCiAgICAgICAgfTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhdHRyaWJ1dGUoKSB7DQogICAgICB2YXIgbSA9IG1hdGNoKC8oW149XSspXHMqPVxzKigiW14iXSoifCdbXiddKid8W14+XHNdKylccyovKTsNCiAgICAgIGlmIChtKSB7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgbmFtZTogbVsxXS50cmltKCksDQogICAgICAgICAgdmFsdWU6IHN0cmlwUXVvdGVzKG1bMl0udHJpbSgpKQ0KICAgICAgICB9Ow0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHN0cmlwUXVvdGVzKHZhbCkgew0KICAgICAgcmV0dXJuIHZhbC5yZXBsYWNlKC9eWyciXXxbJyJdJC9nLCAnJyk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogTWF0Y2ggYHJlYCBhbmQgYWR2YW5jZSB0aGUgc3RyaW5nLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIG1hdGNoKHJlKSB7DQogICAgICB2YXIgbSA9IHBhcnNpbmdTdGF0ZS54bWwubWF0Y2gocmUpOw0KICAgICAgaWYgKG0pIHsNCiAgICAgICAgcGFyc2luZ1N0YXRlLnhtbCA9IHBhcnNpbmdTdGF0ZS54bWwuc2xpY2UobVswXS5sZW5ndGgpOw0KICAgICAgICByZXR1cm4gbTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBFbmQtb2Ytc291cmNlLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGVvcygpIHsNCiAgICAgIHJldHVybiAwID09PSBwYXJzaW5nU3RhdGUueG1sLmxlbmd0aDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVjayBmb3IgYHByZWZpeGAuDQogICAgICovDQogICAgZnVuY3Rpb24gaXMocHJlZml4KSB7DQogICAgICByZXR1cm4gMCA9PT0gcGFyc2luZ1N0YXRlLnhtbC5pbmRleE9mKHByZWZpeCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUGFyc2UgdGhlIGdpdmVuIFhNTCBzdHJpbmcgaW50byBhbiBvYmplY3QuDQogICAgICovDQogICAgZnVuY3Rpb24gcGFyc2VYbWwoeG1sKSB7DQogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307DQogICAgICB4bWwgPSB4bWwudHJpbSgpOw0KICAgICAgdmFyIGZpbHRlciA9IG9wdGlvbnMuZmlsdGVyIHx8IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9Ow0KICAgICAgcGFyc2luZ1N0YXRlID0gew0KICAgICAgICB4bWw6IHhtbCwNCiAgICAgICAgb3B0aW9uczogT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zKSwgew0KICAgICAgICAgIGZpbHRlcjogZmlsdGVyLA0KICAgICAgICAgIHN0cmljdE1vZGU6IG9wdGlvbnMuc3RyaWN0TW9kZSA9PT0gdHJ1ZQ0KICAgICAgICB9KQ0KICAgICAgfTsNCiAgICAgIHJldHVybiBwYXJzZURvY3VtZW50KCk7DQogICAgfQ0KICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiAodHlwZW9mIGV4cG9ydHMgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGV4cG9ydHMpKSA9PT0gJ29iamVjdCcpIHsNCiAgICAgIG1vZHVsZS5leHBvcnRzID0gcGFyc2VYbWw7DQogICAgfQ0KICAgIGV4cG9ydHNbImRlZmF1bHQiXSA9IHBhcnNlWG1sOw0KICB9LCB7fV0sICJ4bWwtZm9ybWF0dGVyIjogW2Z1bmN0aW9uIChyZXF1aXJlLCBtb2R1bGUsIGV4cG9ydHMpIHsNCiAgICAidXNlIHN0cmljdCI7DQoNCiAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyAiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiOyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0NCiAgICB2YXIgX19pbXBvcnREZWZhdWx0ID0gdm9pZCAwICYmICh2b2lkIDApLl9faW1wb3J0RGVmYXVsdCB8fCBmdW5jdGlvbiAobW9kKSB7DQogICAgICByZXR1cm4gbW9kICYmIG1vZC5fX2VzTW9kdWxlID8gbW9kIDogew0KICAgICAgICAiZGVmYXVsdCI6IG1vZA0KICAgICAgfTsNCiAgICB9Ow0KICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgICAgIHZhbHVlOiB0cnVlDQogICAgfSk7DQogICAgdmFyIHhtbF9wYXJzZXJfeG9fMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKCJ4bWwtcGFyc2VyLXhvIikpOw0KDQogICAgZnVuY3Rpb24gbmV3TGluZShzdGF0ZSkgew0KICAgICAgaWYgKCFzdGF0ZS5vcHRpb25zLmluZGVudGF0aW9uICYmICFzdGF0ZS5vcHRpb25zLmxpbmVTZXBhcmF0b3IpIHJldHVybjsNCiAgICAgIHN0YXRlLmNvbnRlbnQgKz0gc3RhdGUub3B0aW9ucy5saW5lU2VwYXJhdG9yOw0KICAgICAgdmFyIGk7DQogICAgICBmb3IgKGkgPSAwOyBpIDwgc3RhdGUubGV2ZWw7IGkrKykgew0KICAgICAgICBzdGF0ZS5jb250ZW50ICs9IHN0YXRlLm9wdGlvbnMuaW5kZW50YXRpb247DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gaW5kZW50KHN0YXRlKSB7DQogICAgICBzdGF0ZS5jb250ZW50ID0gc3RhdGUuY29udGVudC5yZXBsYWNlKC8gKyQvLCAnJyk7DQogICAgICB2YXIgaTsNCiAgICAgIGZvciAoaSA9IDA7IGkgPCBzdGF0ZS5sZXZlbDsgaSsrKSB7DQogICAgICAgIHN0YXRlLmNvbnRlbnQgKz0gc3RhdGUub3B0aW9ucy5pbmRlbnRhdGlvbjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhcHBlbmRDb250ZW50KHN0YXRlLCBjb250ZW50KSB7DQogICAgICBzdGF0ZS5jb250ZW50ICs9IGNvbnRlbnQ7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcHJvY2Vzc05vZGUobm9kZSwgc3RhdGUsIHByZXNlcnZlU3BhY2UpIHsNCiAgICAgIGlmICh0eXBlb2Ygbm9kZS5jb250ZW50ID09PSAnc3RyaW5nJykgew0KICAgICAgICBwcm9jZXNzQ29udGVudChub2RlLmNvbnRlbnQsIHN0YXRlLCBwcmVzZXJ2ZVNwYWNlKTsNCiAgICAgIH0gZWxzZSBpZiAobm9kZS50eXBlID09PSAnRWxlbWVudCcpIHsNCiAgICAgICAgcHJvY2Vzc0VsZW1lbnROb2RlKG5vZGUsIHN0YXRlLCBwcmVzZXJ2ZVNwYWNlKTsNCiAgICAgIH0gZWxzZSBpZiAobm9kZS50eXBlID09PSAnUHJvY2Vzc2luZ0luc3RydWN0aW9uJykgew0KICAgICAgICBwcm9jZXNzUHJvY2Vzc2luZ0ludHJ1Y3Rpb24obm9kZSwgc3RhdGUpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIG5vZGUgdHlwZTogJyArIG5vZGUudHlwZSk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcHJvY2Vzc0NvbnRlbnQoY29udGVudCwgc3RhdGUsIHByZXNlcnZlU3BhY2UpIHsNCiAgICAgIGlmICghcHJlc2VydmVTcGFjZSkgew0KICAgICAgICB2YXIgdHJpbW1lZENvbnRlbnQgPSBjb250ZW50LnRyaW0oKTsNCiAgICAgICAgaWYgKHN0YXRlLm9wdGlvbnMubGluZVNlcGFyYXRvcikgew0KICAgICAgICAgIGNvbnRlbnQgPSB0cmltbWVkQ29udGVudDsNCiAgICAgICAgfSBlbHNlIGlmICh0cmltbWVkQ29udGVudC5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICBjb250ZW50ID0gdHJpbW1lZENvbnRlbnQ7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGlmIChjb250ZW50Lmxlbmd0aCA+IDApIHsNCiAgICAgICAgaWYgKCFwcmVzZXJ2ZVNwYWNlICYmIHN0YXRlLmNvbnRlbnQubGVuZ3RoID4gMCkgew0KICAgICAgICAgIG5ld0xpbmUoc3RhdGUpOw0KICAgICAgICB9DQogICAgICAgIGFwcGVuZENvbnRlbnQoc3RhdGUsIGNvbnRlbnQpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGlzUGF0aE1hdGNoaW5nSWdub3JlZFBhdGhzKHBhdGgsIGlnbm9yZWRQYXRocykgew0KICAgICAgdmFyIGZ1bGxQYXRoID0gJy8nICsgcGF0aC5qb2luKCcvJyk7DQogICAgICB2YXIgcGF0aExhc3RQYXJ0ID0gcGF0aFtwYXRoLmxlbmd0aCAtIDFdOw0KICAgICAgcmV0dXJuIGlnbm9yZWRQYXRocy5pbmNsdWRlcyhwYXRoTGFzdFBhcnQpIHx8IGlnbm9yZWRQYXRocy5pbmNsdWRlcyhmdWxsUGF0aCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcHJvY2Vzc0VsZW1lbnROb2RlKG5vZGUsIHN0YXRlLCBwcmVzZXJ2ZVNwYWNlKSB7DQogICAgICBzdGF0ZS5wYXRoLnB1c2gobm9kZS5uYW1lKTsNCiAgICAgIGlmICghcHJlc2VydmVTcGFjZSAmJiBzdGF0ZS5jb250ZW50Lmxlbmd0aCA+IDApIHsNCiAgICAgICAgbmV3TGluZShzdGF0ZSk7DQogICAgICB9DQogICAgICBhcHBlbmRDb250ZW50KHN0YXRlLCAnPCcgKyBub2RlLm5hbWUpOw0KICAgICAgcHJvY2Vzc0F0dHJpYnV0ZXMoc3RhdGUsIG5vZGUuYXR0cmlidXRlcyk7DQogICAgICBpZiAobm9kZS5jaGlsZHJlbiA9PT0gbnVsbCB8fCBzdGF0ZS5vcHRpb25zLmZvcmNlU2VsZkNsb3NpbmdFbXB0eVRhZyAmJiBub2RlLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICB2YXIgc2VsZkNsb3NpbmdOb2RlQ2xvc2luZ1RhZyA9IHN0YXRlLm9wdGlvbnMud2hpdGVTcGFjZUF0RW5kT2ZTZWxmY2xvc2luZ1RhZyA/ICcgLz4nIDogJy8+JzsNCiAgICAgICAgLy8gc2VsZi1jbG9zaW5nIG5vZGUNCiAgICAgICAgYXBwZW5kQ29udGVudChzdGF0ZSwgc2VsZkNsb3NpbmdOb2RlQ2xvc2luZ1RhZyk7DQogICAgICB9IGVsc2UgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7DQogICAgICAgIC8vIGVtcHR5IG5vZGUNCiAgICAgICAgYXBwZW5kQ29udGVudChzdGF0ZSwgJz48LycgKyBub2RlLm5hbWUgKyAnPicpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdmFyIG5vZGVDaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW47DQogICAgICAgIGFwcGVuZENvbnRlbnQoc3RhdGUsICc+Jyk7DQogICAgICAgIHN0YXRlLmxldmVsKys7DQogICAgICAgIHZhciBub2RlUHJlc2VydmVTcGFjZSA9IG5vZGUuYXR0cmlidXRlc1sneG1sOnNwYWNlJ10gPT09ICdwcmVzZXJ2ZSc7DQogICAgICAgIHZhciBpZ25vcmVkUGF0aCA9IGZhbHNlOw0KICAgICAgICBpZiAoIW5vZGVQcmVzZXJ2ZVNwYWNlICYmIHN0YXRlLm9wdGlvbnMuaWdub3JlZFBhdGhzKSB7DQogICAgICAgICAgaWdub3JlZFBhdGggPSBpc1BhdGhNYXRjaGluZ0lnbm9yZWRQYXRocyhzdGF0ZS5wYXRoLCBzdGF0ZS5vcHRpb25zLmlnbm9yZWRQYXRocyk7DQogICAgICAgICAgbm9kZVByZXNlcnZlU3BhY2UgPSBpZ25vcmVkUGF0aDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW5vZGVQcmVzZXJ2ZVNwYWNlICYmIHN0YXRlLm9wdGlvbnMuY29sbGFwc2VDb250ZW50KSB7DQogICAgICAgICAgdmFyIGNvbnRhaW5zVGV4dE5vZGVzID0gZmFsc2U7DQogICAgICAgICAgdmFyIGNvbnRhaW5zVGV4dE5vZGVzV2l0aExpbmVCcmVha3MgPSBmYWxzZTsNCiAgICAgICAgICB2YXIgY29udGFpbnNOb25UZXh0Tm9kZXMgPSBmYWxzZTsNCiAgICAgICAgICBub2RlQ2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQsIGluZGV4KSB7DQogICAgICAgICAgICBpZiAoY2hpbGQudHlwZSA9PT0gJ1RleHQnKSB7DQogICAgICAgICAgICAgIGlmIChjaGlsZC5jb250ZW50LmluY2x1ZGVzKCdcbicpKSB7DQogICAgICAgICAgICAgICAgY29udGFpbnNUZXh0Tm9kZXNXaXRoTGluZUJyZWFrcyA9IHRydWU7DQogICAgICAgICAgICAgICAgY2hpbGQuY29udGVudCA9IGNoaWxkLmNvbnRlbnQudHJpbSgpOw0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKChpbmRleCA9PT0gMCB8fCBpbmRleCA9PT0gbm9kZUNoaWxkcmVuLmxlbmd0aCAtIDEpICYmICFwcmVzZXJ2ZVNwYWNlKSB7DQogICAgICAgICAgICAgICAgaWYgKGNoaWxkLmNvbnRlbnQudHJpbSgpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHRleHQgbm9kZSBpcyBhdCB0aGUgc3RhcnQgb3IgZW5kIGFuZCBpcyBlbXB0eSwgaXQgc2hvdWxkIGJlIGlnbm9yZWQgd2hlbiBmb3JtYXR0aW5nDQogICAgICAgICAgICAgICAgICBjaGlsZC5jb250ZW50ID0gJyc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChjaGlsZC5jb250ZW50LnRyaW0oKS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgY29udGFpbnNUZXh0Tm9kZXMgPSB0cnVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2UgaWYgKGNoaWxkLnR5cGUgPT09ICdDREFUQScpIHsNCiAgICAgICAgICAgICAgY29udGFpbnNUZXh0Tm9kZXMgPSB0cnVlOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgY29udGFpbnNOb25UZXh0Tm9kZXMgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICAgIGlmIChjb250YWluc1RleHROb2RlcyAmJiAoIWNvbnRhaW5zTm9uVGV4dE5vZGVzIHx8ICFjb250YWluc1RleHROb2Rlc1dpdGhMaW5lQnJlYWtzKSkgew0KICAgICAgICAgICAgbm9kZVByZXNlcnZlU3BhY2UgPSB0cnVlOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBub2RlQ2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHsNCiAgICAgICAgICBwcm9jZXNzTm9kZShjaGlsZCwgc3RhdGUsIHByZXNlcnZlU3BhY2UgfHwgbm9kZVByZXNlcnZlU3BhY2UpOw0KICAgICAgICB9KTsNCiAgICAgICAgc3RhdGUubGV2ZWwtLTsNCiAgICAgICAgaWYgKCFwcmVzZXJ2ZVNwYWNlICYmICFub2RlUHJlc2VydmVTcGFjZSkgew0KICAgICAgICAgIG5ld0xpbmUoc3RhdGUpOw0KICAgICAgICB9DQogICAgICAgIGlmIChpZ25vcmVkUGF0aCkgew0KICAgICAgICAgIGluZGVudChzdGF0ZSk7DQogICAgICAgIH0NCiAgICAgICAgYXBwZW5kQ29udGVudChzdGF0ZSwgJzwvJyArIG5vZGUubmFtZSArICc+Jyk7DQogICAgICB9DQogICAgICBzdGF0ZS5wYXRoLnBvcCgpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHByb2Nlc3NBdHRyaWJ1dGVzKHN0YXRlLCBhdHRyaWJ1dGVzKSB7DQogICAgICBPYmplY3Qua2V5cyhhdHRyaWJ1dGVzKS5mb3JFYWNoKGZ1bmN0aW9uIChhdHRyKSB7DQogICAgICAgIHZhciBlc2NhcGVkID0gYXR0cmlidXRlc1thdHRyXS5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsNCiAgICAgICAgYXBwZW5kQ29udGVudChzdGF0ZSwgJyAnICsgYXR0ciArICc9IicgKyBlc2NhcGVkICsgJyInKTsNCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHByb2Nlc3NQcm9jZXNzaW5nSW50cnVjdGlvbihub2RlLCBzdGF0ZSkgew0KICAgICAgaWYgKHN0YXRlLmNvbnRlbnQubGVuZ3RoID4gMCkgew0KICAgICAgICBuZXdMaW5lKHN0YXRlKTsNCiAgICAgIH0NCiAgICAgIGFwcGVuZENvbnRlbnQoc3RhdGUsICc8PycgKyBub2RlLm5hbWUpOw0KICAgICAgcHJvY2Vzc0F0dHJpYnV0ZXMoc3RhdGUsIG5vZGUuYXR0cmlidXRlcyk7DQogICAgICBhcHBlbmRDb250ZW50KHN0YXRlLCAnPz4nKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDb252ZXJ0cyB0aGUgZ2l2ZW4gWE1MIGludG8gaHVtYW4gcmVhZGFibGUgZm9ybWF0Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGZvcm1hdFhtbCh4bWwpIHsNCiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsNCiAgICAgIG9wdGlvbnMuaW5kZW50YXRpb24gPSAnaW5kZW50YXRpb24nIGluIG9wdGlvbnMgPyBvcHRpb25zLmluZGVudGF0aW9uIDogJyAgICAnOw0KICAgICAgb3B0aW9ucy5jb2xsYXBzZUNvbnRlbnQgPSBvcHRpb25zLmNvbGxhcHNlQ29udGVudCA9PT0gdHJ1ZTsNCiAgICAgIG9wdGlvbnMubGluZVNlcGFyYXRvciA9ICdsaW5lU2VwYXJhdG9yJyBpbiBvcHRpb25zID8gb3B0aW9ucy5saW5lU2VwYXJhdG9yIDogJ1xyXG4nOw0KICAgICAgb3B0aW9ucy53aGl0ZVNwYWNlQXRFbmRPZlNlbGZjbG9zaW5nVGFnID0gb3B0aW9ucy53aGl0ZVNwYWNlQXRFbmRPZlNlbGZjbG9zaW5nVGFnID09PSB0cnVlOw0KICAgICAgb3B0aW9ucy50aHJvd09uRmFpbHVyZSA9IG9wdGlvbnMudGhyb3dPbkZhaWx1cmUgIT09IGZhbHNlOw0KICAgICAgdHJ5IHsNCiAgICAgICAgdmFyIHBhcnNlZFhtbCA9ICgwLCB4bWxfcGFyc2VyX3hvXzFbImRlZmF1bHQiXSkoeG1sLCB7DQogICAgICAgICAgZmlsdGVyOiBvcHRpb25zLmZpbHRlciwNCiAgICAgICAgICBzdHJpY3RNb2RlOiBvcHRpb25zLnN0cmljdE1vZGUNCiAgICAgICAgfSk7DQogICAgICAgIHZhciBzdGF0ZSA9IHsNCiAgICAgICAgICBjb250ZW50OiAnJywNCiAgICAgICAgICBsZXZlbDogMCwNCiAgICAgICAgICBvcHRpb25zOiBvcHRpb25zLA0KICAgICAgICAgIHBhdGg6IFtdDQogICAgICAgIH07DQogICAgICAgIGlmIChwYXJzZWRYbWwuZGVjbGFyYXRpb24pIHsNCiAgICAgICAgICBwcm9jZXNzUHJvY2Vzc2luZ0ludHJ1Y3Rpb24ocGFyc2VkWG1sLmRlY2xhcmF0aW9uLCBzdGF0ZSk7DQogICAgICAgIH0NCiAgICAgICAgcGFyc2VkWG1sLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7DQogICAgICAgICAgcHJvY2Vzc05vZGUoY2hpbGQsIHN0YXRlLCBmYWxzZSk7DQogICAgICAgIH0pOw0KICAgICAgICBpZiAoIW9wdGlvbnMubGluZVNlcGFyYXRvcikgew0KICAgICAgICAgIHJldHVybiBzdGF0ZS5jb250ZW50Ow0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzdGF0ZS5jb250ZW50LnJlcGxhY2UoL1xyXG4vZywgJ1xuJykucmVwbGFjZSgvXG4vZywgb3B0aW9ucy5saW5lU2VwYXJhdG9yKTsNCiAgICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICBpZiAob3B0aW9ucy50aHJvd09uRmFpbHVyZSkgew0KICAgICAgICAgIHRocm93IGVycjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4geG1sOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZvcm1hdFhtbC5taW5pZnkgPSBmdW5jdGlvbiAoeG1sKSB7DQogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307DQogICAgICByZXR1cm4gZm9ybWF0WG1sKHhtbCwgT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zKSwgew0KICAgICAgICBpbmRlbnRhdGlvbjogJycsDQogICAgICAgIGxpbmVTZXBhcmF0b3I6ICcnDQogICAgICB9KSk7DQogICAgfTsNCg0KICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiAodHlwZW9mIGV4cG9ydHMgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKGV4cG9ydHMpKSA9PT0gJ29iamVjdCcpIHsNCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZm9ybWF0WG1sOw0KICAgIH0NCg0KICAgIGV4cG9ydHNbImRlZmF1bHQiXSA9IGZvcm1hdFhtbDsNCiAgfSwgeyAieG1sLXBhcnNlci14byI6IDEgfV0NCn0sIHt9LCBbXSk7DQoNCiAgPC9zY3JpcHQ+DQogIDwhLS1odHRwczovL2ZsYXRwaWNrci5qcy5vcmcvLS0+DQogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy9mbGF0cGlja3IuY3NzIiByZWw9InN0eWxlc2hlZXQiIHR5cGU9InRleHQvY3NzIiAvPi0tPg0KICA8c3R5bGU+DQogICAgLmZsYXRwaWNrci1jYWxlbmRhciB7DQogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICAgIG9wYWNpdHk6IDA7DQogICAgICBkaXNwbGF5OiBub25lOw0KICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgdmlzaWJpbGl0eTogaGlkZGVuOw0KICAgICAgcGFkZGluZzogMDsNCiAgICAgIC13ZWJraXQtYW5pbWF0aW9uOiBub25lOw0KICAgICAgYW5pbWF0aW9uOiBub25lOw0KICAgICAgZGlyZWN0aW9uOiBsdHI7DQogICAgICBib3JkZXI6IDA7DQogICAgICBmb250LXNpemU6IDE0cHg7DQogICAgICBsaW5lLWhlaWdodDogMjRweDsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDVweDsNCiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgIHdpZHRoOiAzMDcuODc1cHg7DQogICAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgLW1zLXRvdWNoLWFjdGlvbjogbWFuaXB1bGF0aW9uOw0KICAgICAgdG91Y2gtYWN0aW9uOiBtYW5pcHVsYXRpb247DQogICAgICBiYWNrZ3JvdW5kOiAjZmZmOw0KICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiAxcHggMCAwICNlNmU2ZTYsIC0xcHggMCAwICNlNmU2ZTYsIDAgMXB4IDAgI2U2ZTZlNiwgMCAtMXB4IDAgI2U2ZTZlNiwgMCAzcHggMTNweCByZ2JhKDAsIDAsIDAsIDAuMDgpOw0KICAgICAgYm94LXNoYWRvdzogMXB4IDAgMCAjZTZlNmU2LCAtMXB4IDAgMCAjZTZlNmU2LCAwIDFweCAwICNlNmU2ZTYsIDAgLTFweCAwICNlNmU2ZTYsIDAgM3B4IDEzcHggcmdiYSgwLCAwLCAwLCAwLjA4KTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLm9wZW4sDQogICAgLmZsYXRwaWNrci1jYWxlbmRhci5pbmxpbmUgew0KICAgICAgb3BhY2l0eTogMTsNCiAgICAgIG1heC1oZWlnaHQ6IDY0MHB4Ow0KICAgICAgdmlzaWJpbGl0eTogdmlzaWJsZTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLm9wZW4gew0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgei1pbmRleDogOTk5OTk7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhci5hbmltYXRlLm9wZW4gew0KICAgICAgLXdlYmtpdC1hbmltYXRpb246IGZwRmFkZUluRG93biAzMDBtcyBjdWJpYy1iZXppZXIoMC4yMywgMSwgMC4zMiwgMSk7DQogICAgICBhbmltYXRpb246IGZwRmFkZUluRG93biAzMDBtcyBjdWJpYy1iZXppZXIoMC4yMywgMSwgMC4zMiwgMSk7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhci5pbmxpbmUgew0KICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICB0b3A6IDJweDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLnN0YXRpYyB7DQogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgICB0b3A6IGNhbGMoMTAwJSArIDJweCk7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhci5zdGF0aWMub3BlbiB7DQogICAgICB6LWluZGV4OiA5OTk7DQogICAgICBkaXNwbGF5OiBibG9jazsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLm11bHRpTW9udGggLmZsYXRwaWNrci1kYXlzIC5kYXlDb250YWluZXI6bnRoLWNoaWxkKG4rMSkgLmZsYXRwaWNrci1kYXkuaW5SYW5nZTpudGgtY2hpbGQoN24rNykgew0KICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiBub25lICFpbXBvcnRhbnQ7DQogICAgICBib3gtc2hhZG93OiBub25lICFpbXBvcnRhbnQ7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhci5tdWx0aU1vbnRoIC5mbGF0cGlja3ItZGF5cyAuZGF5Q29udGFpbmVyOm50aC1jaGlsZChuKzIpIC5mbGF0cGlja3ItZGF5LmluUmFuZ2U6bnRoLWNoaWxkKDduKzEpIHsNCiAgICAgIC13ZWJraXQtYm94LXNoYWRvdzogLTJweCAwIDAgI2U2ZTZlNiwgNXB4IDAgMCAjZTZlNmU2Ow0KICAgICAgYm94LXNoYWRvdzogLTJweCAwIDAgI2U2ZTZlNiwgNXB4IDAgMCAjZTZlNmU2Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIgLmhhc1dlZWtzIC5kYXlDb250YWluZXIsDQogICAgLmZsYXRwaWNrci1jYWxlbmRhciAuaGFzVGltZSAuZGF5Q29udGFpbmVyIHsNCiAgICAgIGJvcmRlci1ib3R0b206IDA7DQogICAgICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMDsNCiAgICAgIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDA7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhciAuaGFzV2Vla3MgLmRheUNvbnRhaW5lciB7DQogICAgICBib3JkZXItbGVmdDogMDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLnNob3dUaW1lSW5wdXQuaGFzVGltZSAuZmxhdHBpY2tyLXRpbWUgew0KICAgICAgaGVpZ2h0OiA0MHB4Ow0KICAgICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlNmU2ZTY7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhci5ub0NhbGVuZGFyLmhhc1RpbWUgLmZsYXRwaWNrci10aW1lIHsNCiAgICAgIGhlaWdodDogYXV0bzsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyOmJlZm9yZSwNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyOmFmdGVyIHsNCiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7DQogICAgICBib3JkZXI6IHNvbGlkIHRyYW5zcGFyZW50Ow0KICAgICAgY29udGVudDogJyc7DQogICAgICBoZWlnaHQ6IDA7DQogICAgICB3aWR0aDogMDsNCiAgICAgIGxlZnQ6IDIycHg7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhci5yaWdodE1vc3Q6YmVmb3JlLA0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIucmlnaHRNb3N0OmFmdGVyIHsNCiAgICAgIGxlZnQ6IGF1dG87DQogICAgICByaWdodDogMjJweDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyOmJlZm9yZSB7DQogICAgICBib3JkZXItd2lkdGg6IDVweDsNCiAgICAgIG1hcmdpbjogMCAtNXB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXI6YWZ0ZXIgew0KICAgICAgYm9yZGVyLXdpZHRoOiA0cHg7DQogICAgICBtYXJnaW46IDAgLTRweDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmFycm93VG9wOmJlZm9yZSwNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmFycm93VG9wOmFmdGVyIHsNCiAgICAgIGJvdHRvbTogMTAwJTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmFycm93VG9wOmJlZm9yZSB7DQogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjZTZlNmU2Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dUb3A6YWZ0ZXIgew0KICAgICAgYm9yZGVyLWJvdHRvbS1jb2xvcjogI2ZmZjsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmFycm93Qm90dG9tOmJlZm9yZSwNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmFycm93Qm90dG9tOmFmdGVyIHsNCiAgICAgIHRvcDogMTAwJTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmFycm93Qm90dG9tOmJlZm9yZSB7DQogICAgICBib3JkZXItdG9wLWNvbG9yOiAjZTZlNmU2Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dCb3R0b206YWZ0ZXIgew0KICAgICAgYm9yZGVyLXRvcC1jb2xvcjogI2ZmZjsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyOmZvY3VzIHsNCiAgICAgIG91dGxpbmU6IDA7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci13cmFwcGVyIHsNCiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLW1vbnRocyB7DQogICAgICBkaXNwbGF5OiAtd2Via2l0LWJveDsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtZmxleDsNCiAgICAgIGRpc3BsYXk6IC1tcy1mbGV4Ym94Ow0KICAgICAgZGlzcGxheTogZmxleDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLW1vbnRoIHsNCiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50Ow0KICAgICAgY29sb3I6IHJnYmEoMCwgMCwgMCwgMC45KTsNCiAgICAgIGZpbGw6IHJnYmEoMCwgMCwgMCwgMC45KTsNCiAgICAgIGhlaWdodDogMjhweDsNCiAgICAgIGxpbmUtaGVpZ2h0OiAxOw0KICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgICAgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIC1tb3otdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAtbXMtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICB1c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAtd2Via2l0LWJveC1mbGV4OiAxOw0KICAgICAgLXdlYmtpdC1mbGV4OiAxOw0KICAgICAgLW1zLWZsZXg6IDE7DQogICAgICBmbGV4OiAxOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItcHJldi1tb250aCwNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLW5leHQtbW9udGggew0KICAgICAgdGV4dC1kZWNvcmF0aW9uOiBub25lOw0KICAgICAgY3Vyc29yOiBwb2ludGVyOw0KICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgICAgdG9wOiAwcHg7DQogICAgICBsaW5lLWhlaWdodDogMTZweDsNCiAgICAgIGhlaWdodDogMjhweDsNCiAgICAgIHBhZGRpbmc6IDEwcHg7DQogICAgICB6LWluZGV4OiAzOw0KICAgICAgY29sb3I6IHJnYmEoMCwgMCwgMCwgMC45KTsNCiAgICAgIGZpbGw6IHJnYmEoMCwgMCwgMCwgMC45KTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGguZGlzYWJsZWQsDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoLmRpc2FibGVkIHsNCiAgICAgIGRpc3BsYXk6IG5vbmU7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1wcmV2LW1vbnRoIGksDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoIGkgew0KICAgICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItcHJldi1tb250aC5mbGF0cGlja3ItcHJldi1tb250aCwNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLW5leHQtbW9udGguZmxhdHBpY2tyLXByZXYtbW9udGggew0KICAgICAgLyoNCiAgICAgIC8qcnRsOmJlZ2luOmlnbm9yZSovDQogICAgICAvKg0KICAgICAgKi8NCiAgICAgIGxlZnQ6IDA7DQogICAgICAvKg0KICAgICAgLypydGw6ZW5kOmlnbm9yZSovDQogICAgICAvKg0KICAgICAgKi8NCiAgICB9DQoNCiAgICAvKg0KICAgICAgLypydGw6YmVnaW46aWdub3JlKi8NCiAgICAvKg0KICAgICAgLypydGw6ZW5kOmlnbm9yZSovDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1wcmV2LW1vbnRoLmZsYXRwaWNrci1uZXh0LW1vbnRoLA0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aC5mbGF0cGlja3ItbmV4dC1tb250aCB7DQogICAgICAvKg0KICAgICAgLypydGw6YmVnaW46aWdub3JlKi8NCiAgICAgIC8qDQogICAgICAqLw0KICAgICAgcmlnaHQ6IDA7DQogICAgICAvKg0KICAgICAgLypydGw6ZW5kOmlnbm9yZSovDQogICAgICAvKg0KICAgICAgKi8NCiAgICB9DQoNCiAgICAvKg0KICAgICAgLypydGw6YmVnaW46aWdub3JlKi8NCiAgICAvKg0KICAgICAgLypydGw6ZW5kOmlnbm9yZSovDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1wcmV2LW1vbnRoOmhvdmVyLA0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aDpob3ZlciB7DQogICAgICBjb2xvcjogIzk1OWVhOTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGg6aG92ZXIgc3ZnLA0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aDpob3ZlciBzdmcgew0KICAgICAgZmlsbDogI2Y2NDc0NzsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGggc3ZnLA0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aCBzdmcgew0KICAgICAgd2lkdGg6IDE0cHg7DQogICAgICBoZWlnaHQ6IDE0cHg7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1wcmV2LW1vbnRoIHN2ZyBwYXRoLA0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aCBzdmcgcGF0aCB7DQogICAgICAtd2Via2l0LXRyYW5zaXRpb246IGZpbGwgMC4xczsNCiAgICAgIHRyYW5zaXRpb246IGZpbGwgMC4xczsNCiAgICAgIGZpbGw6IGluaGVyaXQ7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciB7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICBoZWlnaHQ6IGF1dG87DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBpbnB1dCwNCiAgICAubnVtSW5wdXRXcmFwcGVyIHNwYW4gew0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIH0NCg0KICAgIC5udW1JbnB1dFdyYXBwZXIgaW5wdXQgew0KICAgICAgd2lkdGg6IDEwMCU7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBpbnB1dDo6LW1zLWNsZWFyIHsNCiAgICAgIGRpc3BsYXk6IG5vbmU7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBzcGFuIHsNCiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgIHJpZ2h0OiAwOw0KICAgICAgd2lkdGg6IDE0cHg7DQogICAgICBwYWRkaW5nOiAwIDRweCAwIDJweDsNCiAgICAgIGhlaWdodDogNTAlOw0KICAgICAgbGluZS1oZWlnaHQ6IDUwJTsNCiAgICAgIG9wYWNpdHk6IDA7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDU3LCA1NywgNTcsIDAuMTUpOw0KICAgICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIHNwYW46aG92ZXIgew0KICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjEpOw0KICAgIH0NCg0KICAgIC5udW1JbnB1dFdyYXBwZXIgc3BhbjphY3RpdmUgew0KICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjIpOw0KICAgIH0NCg0KICAgIC5udW1JbnB1dFdyYXBwZXIgc3BhbjphZnRlciB7DQogICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgIGNvbnRlbnQ6ICIiOw0KICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIH0NCg0KICAgIC5udW1JbnB1dFdyYXBwZXIgc3Bhbi5hcnJvd1VwIHsNCiAgICAgIHRvcDogMDsNCiAgICAgIGJvcmRlci1ib3R0b206IDA7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93VXA6YWZ0ZXIgew0KICAgICAgYm9yZGVyLWxlZnQ6IDRweCBzb2xpZCB0cmFuc3BhcmVudDsNCiAgICAgIGJvcmRlci1yaWdodDogNHB4IHNvbGlkIHRyYW5zcGFyZW50Ow0KICAgICAgYm9yZGVyLWJvdHRvbTogNHB4IHNvbGlkIHJnYmEoNTcsIDU3LCA1NywgMC42KTsNCiAgICAgIHRvcDogMjYlOw0KICAgIH0NCg0KICAgIC5udW1JbnB1dFdyYXBwZXIgc3Bhbi5hcnJvd0Rvd24gew0KICAgICAgdG9wOiA1MCU7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93RG93bjphZnRlciB7DQogICAgICBib3JkZXItbGVmdDogNHB4IHNvbGlkIHRyYW5zcGFyZW50Ow0KICAgICAgYm9yZGVyLXJpZ2h0OiA0cHggc29saWQgdHJhbnNwYXJlbnQ7DQogICAgICBib3JkZXItdG9wOiA0cHggc29saWQgcmdiYSg1NywgNTcsIDU3LCAwLjYpOw0KICAgICAgdG9wOiA0MCU7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBzcGFuIHN2ZyB7DQogICAgICB3aWR0aDogaW5oZXJpdDsNCiAgICAgIGhlaWdodDogYXV0bzsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIHNwYW4gc3ZnIHBhdGggew0KICAgICAgZmlsbDogcmdiYSgwLCAwLCAwLCAwLjUpOw0KICAgIH0NCg0KICAgIC5udW1JbnB1dFdyYXBwZXI6aG92ZXIgew0KICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjA1KTsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyOmhvdmVyIHNwYW4gew0KICAgICAgb3BhY2l0eTogMTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggew0KICAgICAgZm9udC1zaXplOiAxMzUlOw0KICAgICAgbGluZS1oZWlnaHQ6IGluaGVyaXQ7DQogICAgICBmb250LXdlaWdodDogMzAwOw0KICAgICAgY29sb3I6IGluaGVyaXQ7DQogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgICB3aWR0aDogNzUlOw0KICAgICAgbGVmdDogMTIuNSU7DQogICAgICBwYWRkaW5nOiA2LjE2cHggMCAwIDA7DQogICAgICBsaW5lLWhlaWdodDogMTsNCiAgICAgIGhlaWdodDogMjhweDsNCiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwcHgsIDBweCwgMHB4KTsNCiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMHB4LCAwcHgsIDBweCk7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jdXJyZW50LW1vbnRoIHNwYW4uY3VyLW1vbnRoIHsNCiAgICAgIGZvbnQtZmFtaWx5OiBpbmhlcml0Ow0KICAgICAgZm9udC13ZWlnaHQ6IDcwMDsNCiAgICAgIGNvbG9yOiBpbmhlcml0Ow0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgbWFyZ2luLWxlZnQ6IDAuNWNoOw0KICAgICAgcGFkZGluZzogMDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggc3Bhbi5jdXItbW9udGg6aG92ZXIgew0KICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjA1KTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggLm51bUlucHV0V3JhcHBlciB7DQogICAgICB3aWR0aDogNmNoOw0KICAgICAgd2lkdGg6IDdjaFwwOw0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY3VycmVudC1tb250aCAubnVtSW5wdXRXcmFwcGVyIHNwYW4uYXJyb3dVcDphZnRlciB7DQogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuOSk7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jdXJyZW50LW1vbnRoIC5udW1JbnB1dFdyYXBwZXIgc3Bhbi5hcnJvd0Rvd246YWZ0ZXIgew0KICAgICAgYm9yZGVyLXRvcC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwLjkpOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY3VycmVudC1tb250aCBpbnB1dC5jdXIteWVhciB7DQogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBjb2xvcjogaW5oZXJpdDsNCiAgICAgIGN1cnNvcjogdGV4dDsNCiAgICAgIHBhZGRpbmc6IDAgMCAwIDAuNWNoOw0KICAgICAgbWFyZ2luOiAwOw0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgZm9udC1zaXplOiBpbmhlcml0Ow0KICAgICAgZm9udC1mYW1pbHk6IGluaGVyaXQ7DQogICAgICBmb250LXdlaWdodDogMzAwOw0KICAgICAgbGluZS1oZWlnaHQ6IGluaGVyaXQ7DQogICAgICBoZWlnaHQ6IGF1dG87DQogICAgICBib3JkZXI6IDA7DQogICAgICBib3JkZXItcmFkaXVzOiAwOw0KICAgICAgdmVydGljYWwtYWxpZ246IGluaXRpYWw7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jdXJyZW50LW1vbnRoIGlucHV0LmN1ci15ZWFyOmZvY3VzIHsNCiAgICAgIG91dGxpbmU6IDA7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jdXJyZW50LW1vbnRoIGlucHV0LmN1ci15ZWFyW2Rpc2FibGVkXSwNCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggaW5wdXQuY3VyLXllYXJbZGlzYWJsZWRdOmhvdmVyIHsNCiAgICAgIGZvbnQtc2l6ZTogMTAwJTsNCiAgICAgIGNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNSk7DQogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3Itd2Vla2RheXMgew0KICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7DQogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgd2lkdGg6IDEwMCU7DQogICAgICBkaXNwbGF5OiAtd2Via2l0LWJveDsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtZmxleDsNCiAgICAgIGRpc3BsYXk6IC1tcy1mbGV4Ym94Ow0KICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgIC13ZWJraXQtYm94LWFsaWduOiBjZW50ZXI7DQogICAgICAtd2Via2l0LWFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICAtbXMtZmxleC1hbGlnbjogY2VudGVyOw0KICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgIGhlaWdodDogMjhweDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXdlZWtkYXlzIC5mbGF0cGlja3Itd2Vla2RheWNvbnRhaW5lciB7DQogICAgICBkaXNwbGF5OiAtd2Via2l0LWJveDsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtZmxleDsNCiAgICAgIGRpc3BsYXk6IC1tcy1mbGV4Ym94Ow0KICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgIC13ZWJraXQtYm94LWZsZXg6IDE7DQogICAgICAtd2Via2l0LWZsZXg6IDE7DQogICAgICAtbXMtZmxleDogMTsNCiAgICAgIGZsZXg6IDE7DQogICAgfQ0KDQogICAgc3Bhbi5mbGF0cGlja3Itd2Vla2RheSB7DQogICAgICBjdXJzb3I6IGRlZmF1bHQ7DQogICAgICBmb250LXNpemU6IDkwJTsNCiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50Ow0KICAgICAgY29sb3I6IHJnYmEoMCwgMCwgMCwgMC41NCk7DQogICAgICBsaW5lLWhlaWdodDogMTsNCiAgICAgIG1hcmdpbjogMDsNCiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgLXdlYmtpdC1ib3gtZmxleDogMTsNCiAgICAgIC13ZWJraXQtZmxleDogMTsNCiAgICAgIC1tcy1mbGV4OiAxOw0KICAgICAgZmxleDogMTsNCiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkZXI7DQogICAgfQ0KDQogICAgLmRheUNvbnRhaW5lciwNCiAgICAuZmxhdHBpY2tyLXdlZWtzIHsNCiAgICAgIHBhZGRpbmc6IDFweCAwIDAgMDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWRheXMgew0KICAgICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtYm94Ow0KICAgICAgZGlzcGxheTogLXdlYmtpdC1mbGV4Ow0KICAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgLXdlYmtpdC1ib3gtYWxpZ246IHN0YXJ0Ow0KICAgICAgLXdlYmtpdC1hbGlnbi1pdGVtczogZmxleC1zdGFydDsNCiAgICAgIC1tcy1mbGV4LWFsaWduOiBzdGFydDsNCiAgICAgIGFsaWduLWl0ZW1zOiBmbGV4LXN0YXJ0Ow0KICAgICAgd2lkdGg6IDMwNy44NzVweDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWRheXM6Zm9jdXMgew0KICAgICAgb3V0bGluZTogMDsNCiAgICB9DQoNCiAgICAuZGF5Q29udGFpbmVyIHsNCiAgICAgIHBhZGRpbmc6IDA7DQogICAgICBvdXRsaW5lOiAwOw0KICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgIHdpZHRoOiAzMDcuODc1cHg7DQogICAgICBtaW4td2lkdGg6IDMwNy44NzVweDsNCiAgICAgIG1heC13aWR0aDogMzA3Ljg3NXB4Ow0KICAgICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgIGRpc3BsYXk6IC1tcy1mbGV4Ym94Ow0KICAgICAgZGlzcGxheTogLXdlYmtpdC1ib3g7DQogICAgICBkaXNwbGF5OiAtd2Via2l0LWZsZXg7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgLXdlYmtpdC1mbGV4LXdyYXA6IHdyYXA7DQogICAgICBmbGV4LXdyYXA6IHdyYXA7DQogICAgICAtbXMtZmxleC13cmFwOiB3cmFwOw0KICAgICAgLW1zLWZsZXgtcGFjazoganVzdGlmeTsNCiAgICAgIC13ZWJraXQtanVzdGlmeS1jb250ZW50OiBzcGFjZS1hcm91bmQ7DQogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWFyb3VuZDsNCiAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwcHgsIDBweCwgMHB4KTsNCiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMHB4LCAwcHgsIDBweCk7DQogICAgICBvcGFjaXR5OiAxOw0KICAgIH0NCg0KICAgIC5kYXlDb250YWluZXIrLmRheUNvbnRhaW5lciB7DQogICAgICAtd2Via2l0LWJveC1zaGFkb3c6IC0xcHggMCAwICNlNmU2ZTY7DQogICAgICBib3gtc2hhZG93OiAtMXB4IDAgMCAjZTZlNmU2Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5IHsNCiAgICAgIGJhY2tncm91bmQ6IG5vbmU7DQogICAgICBib3JkZXI6IDFweCBzb2xpZCB0cmFuc3BhcmVudDsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDE1MHB4Ow0KICAgICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIGNvbG9yOiAjMzkzOTM5Ow0KICAgICAgY3Vyc29yOiBwb2ludGVyOw0KICAgICAgZm9udC13ZWlnaHQ6IDQwMDsNCiAgICAgIHdpZHRoOiAxNC4yODU3MTQzJTsNCiAgICAgIC13ZWJraXQtZmxleC1iYXNpczogMTQuMjg1NzE0MyU7DQogICAgICAtbXMtZmxleC1wcmVmZXJyZWQtc2l6ZTogMTQuMjg1NzE0MyU7DQogICAgICBmbGV4LWJhc2lzOiAxNC4yODU3MTQzJTsNCiAgICAgIG1heC13aWR0aDogMzlweDsNCiAgICAgIGhlaWdodDogMzlweDsNCiAgICAgIGxpbmUtaGVpZ2h0OiAzOXB4Ow0KICAgICAgbWFyZ2luOiAwOw0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgICAgLXdlYmtpdC1ib3gtcGFjazogY2VudGVyOw0KICAgICAgLXdlYmtpdC1qdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICAgIC1tcy1mbGV4LXBhY2s6IGNlbnRlcjsNCiAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5LmluUmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkucHJldk1vbnRoRGF5LmluUmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkubmV4dE1vbnRoRGF5LmluUmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkudG9kYXkuaW5SYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5wcmV2TW9udGhEYXkudG9kYXkuaW5SYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5uZXh0TW9udGhEYXkudG9kYXkuaW5SYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheTpob3ZlciwNCiAgICAuZmxhdHBpY2tyLWRheS5wcmV2TW9udGhEYXk6aG92ZXIsDQogICAgLmZsYXRwaWNrci1kYXkubmV4dE1vbnRoRGF5OmhvdmVyLA0KICAgIC5mbGF0cGlja3ItZGF5OmZvY3VzLA0KICAgIC5mbGF0cGlja3ItZGF5LnByZXZNb250aERheTpmb2N1cywNCiAgICAuZmxhdHBpY2tyLWRheS5uZXh0TW9udGhEYXk6Zm9jdXMgew0KICAgICAgY3Vyc29yOiBwb2ludGVyOw0KICAgICAgb3V0bGluZTogMDsNCiAgICAgIGJhY2tncm91bmQ6ICNlNmU2ZTY7DQogICAgICBib3JkZXItY29sb3I6ICNlNmU2ZTY7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkudG9kYXkgew0KICAgICAgYm9yZGVyLWNvbG9yOiAjOTU5ZWE5Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5LnRvZGF5OmhvdmVyLA0KICAgIC5mbGF0cGlja3ItZGF5LnRvZGF5OmZvY3VzIHsNCiAgICAgIGJvcmRlci1jb2xvcjogIzk1OWVhOTsNCiAgICAgIGJhY2tncm91bmQ6ICM5NTllYTk7DQogICAgICBjb2xvcjogI2ZmZjsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZCwNCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5LnNlbGVjdGVkLmluUmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuc3RhcnRSYW5nZS5pblJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlLmluUmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuc2VsZWN0ZWQ6Zm9jdXMsDQogICAgLmZsYXRwaWNrci1kYXkuc3RhcnRSYW5nZTpmb2N1cywNCiAgICAuZmxhdHBpY2tyLWRheS5lbmRSYW5nZTpmb2N1cywNCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZDpob3ZlciwNCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlOmhvdmVyLA0KICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlOmhvdmVyLA0KICAgIC5mbGF0cGlja3ItZGF5LnNlbGVjdGVkLnByZXZNb250aERheSwNCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlLnByZXZNb250aERheSwNCiAgICAuZmxhdHBpY2tyLWRheS5lbmRSYW5nZS5wcmV2TW9udGhEYXksDQogICAgLmZsYXRwaWNrci1kYXkuc2VsZWN0ZWQubmV4dE1vbnRoRGF5LA0KICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2UubmV4dE1vbnRoRGF5LA0KICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlLm5leHRNb250aERheSB7DQogICAgICBiYWNrZ3JvdW5kOiAjNTY5ZmY3Ow0KICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiBub25lOw0KICAgICAgYm94LXNoYWRvdzogbm9uZTsNCiAgICAgIGNvbG9yOiAjZmZmOw0KICAgICAgYm9yZGVyLWNvbG9yOiAjNTY5ZmY3Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5LnNlbGVjdGVkLnN0YXJ0UmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuc3RhcnRSYW5nZS5zdGFydFJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlLnN0YXJ0UmFuZ2Ugew0KICAgICAgYm9yZGVyLXJhZGl1czogNTBweCAwIDAgNTBweDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZC5lbmRSYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlLmVuZFJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlLmVuZFJhbmdlIHsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDAgNTBweCA1MHB4IDA7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuc2VsZWN0ZWQuc3RhcnRSYW5nZSsuZW5kUmFuZ2U6bm90KDpudGgtY2hpbGQoN24rMSkpLA0KICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2Uuc3RhcnRSYW5nZSsuZW5kUmFuZ2U6bm90KDpudGgtY2hpbGQoN24rMSkpLA0KICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlLnN0YXJ0UmFuZ2UrLmVuZFJhbmdlOm5vdCg6bnRoLWNoaWxkKDduKzEpKSB7DQogICAgICAtd2Via2l0LWJveC1zaGFkb3c6IC0xMHB4IDAgMCAjNTY5ZmY3Ow0KICAgICAgYm94LXNoYWRvdzogLTEwcHggMCAwICM1NjlmZjc7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuc2VsZWN0ZWQuc3RhcnRSYW5nZS5lbmRSYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlLnN0YXJ0UmFuZ2UuZW5kUmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2Uuc3RhcnRSYW5nZS5lbmRSYW5nZSB7DQogICAgICBib3JkZXItcmFkaXVzOiA1MHB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5LmluUmFuZ2Ugew0KICAgICAgYm9yZGVyLXJhZGl1czogMDsNCiAgICAgIC13ZWJraXQtYm94LXNoYWRvdzogLTVweCAwIDAgI2U2ZTZlNiwgNXB4IDAgMCAjZTZlNmU2Ow0KICAgICAgYm94LXNoYWRvdzogLTVweCAwIDAgI2U2ZTZlNiwgNXB4IDAgMCAjZTZlNmU2Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5LmRpc2FibGVkLA0KICAgIC5mbGF0cGlja3ItZGF5LmRpc2FibGVkOmhvdmVyLA0KICAgIC5mbGF0cGlja3ItZGF5LnByZXZNb250aERheSwNCiAgICAuZmxhdHBpY2tyLWRheS5uZXh0TW9udGhEYXksDQogICAgLmZsYXRwaWNrci1kYXkubm90QWxsb3dlZCwNCiAgICAuZmxhdHBpY2tyLWRheS5ub3RBbGxvd2VkLnByZXZNb250aERheSwNCiAgICAuZmxhdHBpY2tyLWRheS5ub3RBbGxvd2VkLm5leHRNb250aERheSB7DQogICAgICBjb2xvcjogcmdiYSg1NywgNTcsIDU3LCAwLjMpOw0KICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7DQogICAgICBib3JkZXItY29sb3I6IHRyYW5zcGFyZW50Ow0KICAgICAgY3Vyc29yOiBkZWZhdWx0Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5LmRpc2FibGVkLA0KICAgIC5mbGF0cGlja3ItZGF5LmRpc2FibGVkOmhvdmVyIHsNCiAgICAgIGN1cnNvcjogbm90LWFsbG93ZWQ7DQogICAgICBjb2xvcjogcmdiYSg1NywgNTcsIDU3LCAwLjEpOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5LndlZWsuc2VsZWN0ZWQgew0KICAgICAgYm9yZGVyLXJhZGl1czogMDsNCiAgICAgIC13ZWJraXQtYm94LXNoYWRvdzogLTVweCAwIDAgIzU2OWZmNywgNXB4IDAgMCAjNTY5ZmY3Ow0KICAgICAgYm94LXNoYWRvdzogLTVweCAwIDAgIzU2OWZmNywgNXB4IDAgMCAjNTY5ZmY3Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5LmhpZGRlbiB7DQogICAgICB2aXNpYmlsaXR5OiBoaWRkZW47DQogICAgfQ0KDQogICAgLnJhbmdlTW9kZSAuZmxhdHBpY2tyLWRheSB7DQogICAgICBtYXJnaW4tdG9wOiAxcHg7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci13ZWVrd3JhcHBlciB7DQogICAgICBmbG9hdDogbGVmdDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXdlZWt3cmFwcGVyIC5mbGF0cGlja3Itd2Vla3Mgew0KICAgICAgcGFkZGluZzogMCAxMnB4Ow0KICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiAxcHggMCAwICNlNmU2ZTY7DQogICAgICBib3gtc2hhZG93OiAxcHggMCAwICNlNmU2ZTY7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci13ZWVrd3JhcHBlciAuZmxhdHBpY2tyLXdlZWtkYXkgew0KICAgICAgZmxvYXQ6IG5vbmU7DQogICAgICB3aWR0aDogMTAwJTsNCiAgICAgIGxpbmUtaGVpZ2h0OiAyOHB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3Itd2Vla3dyYXBwZXIgc3Bhbi5mbGF0cGlja3ItZGF5LA0KICAgIC5mbGF0cGlja3Itd2Vla3dyYXBwZXIgc3Bhbi5mbGF0cGlja3ItZGF5OmhvdmVyIHsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgd2lkdGg6IDEwMCU7DQogICAgICBtYXgtd2lkdGg6IG5vbmU7DQogICAgICBjb2xvcjogcmdiYSg1NywgNTcsIDU3LCAwLjMpOw0KICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7DQogICAgICBjdXJzb3I6IGRlZmF1bHQ7DQogICAgICBib3JkZXI6IG5vbmU7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1pbm5lckNvbnRhaW5lciB7DQogICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtYm94Ow0KICAgICAgZGlzcGxheTogLXdlYmtpdC1mbGV4Ow0KICAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1yQ29udGFpbmVyIHsNCiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgIHBhZGRpbmc6IDA7DQogICAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZSB7DQogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICBvdXRsaW5lOiAwOw0KICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICBoZWlnaHQ6IDA7DQogICAgICBsaW5lLWhlaWdodDogNDBweDsNCiAgICAgIG1heC1oZWlnaHQ6IDQwcHg7DQogICAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtYm94Ow0KICAgICAgZGlzcGxheTogLXdlYmtpdC1mbGV4Ow0KICAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZTphZnRlciB7DQogICAgICBjb250ZW50OiAiIjsNCiAgICAgIGRpc3BsYXk6IHRhYmxlOw0KICAgICAgY2xlYXI6IGJvdGg7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lIC5udW1JbnB1dFdyYXBwZXIgew0KICAgICAgLXdlYmtpdC1ib3gtZmxleDogMTsNCiAgICAgIC13ZWJraXQtZmxleDogMTsNCiAgICAgIC1tcy1mbGV4OiAxOw0KICAgICAgZmxleDogMTsNCiAgICAgIHdpZHRoOiA0MCU7DQogICAgICBoZWlnaHQ6IDQwcHg7DQogICAgICBmbG9hdDogbGVmdDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXRpbWUgLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93VXA6YWZ0ZXIgew0KICAgICAgYm9yZGVyLWJvdHRvbS1jb2xvcjogIzM5MzkzOTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXRpbWUgLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93RG93bjphZnRlciB7DQogICAgICBib3JkZXItdG9wLWNvbG9yOiAjMzkzOTM5Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZS5oYXNTZWNvbmRzIC5udW1JbnB1dFdyYXBwZXIgew0KICAgICAgd2lkdGg6IDI2JTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXRpbWUudGltZTI0aHIgLm51bUlucHV0V3JhcHBlciB7DQogICAgICB3aWR0aDogNDklOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dCB7DQogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICAgIC13ZWJraXQtYm94LXNoYWRvdzogbm9uZTsNCiAgICAgIGJveC1zaGFkb3c6IG5vbmU7DQogICAgICBib3JkZXI6IDA7DQogICAgICBib3JkZXItcmFkaXVzOiAwOw0KICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgbWFyZ2luOiAwOw0KICAgICAgcGFkZGluZzogMDsNCiAgICAgIGhlaWdodDogaW5oZXJpdDsNCiAgICAgIGxpbmUtaGVpZ2h0OiBpbmhlcml0Ow0KICAgICAgY29sb3I6ICMzOTM5Mzk7DQogICAgICBmb250LXNpemU6IDE0cHg7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dC5mbGF0cGlja3ItaG91ciB7DQogICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXRpbWUgaW5wdXQuZmxhdHBpY2tyLW1pbnV0ZSwNCiAgICAuZmxhdHBpY2tyLXRpbWUgaW5wdXQuZmxhdHBpY2tyLXNlY29uZCB7DQogICAgICBmb250LXdlaWdodDogNDAwOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dDpmb2N1cyB7DQogICAgICBvdXRsaW5lOiAwOw0KICAgICAgYm9yZGVyOiAwOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZSAuZmxhdHBpY2tyLXRpbWUtc2VwYXJhdG9yLA0KICAgIC5mbGF0cGlja3ItdGltZSAuZmxhdHBpY2tyLWFtLXBtIHsNCiAgICAgIGhlaWdodDogaW5oZXJpdDsNCiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgIGxpbmUtaGVpZ2h0OiBpbmhlcml0Ow0KICAgICAgY29sb3I6ICMzOTM5Mzk7DQogICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgIHdpZHRoOiAyJTsNCiAgICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAtbW96LXVzZXItc2VsZWN0OiBub25lOw0KICAgICAgLW1zLXVzZXItc2VsZWN0OiBub25lOw0KICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAtd2Via2l0LWFsaWduLXNlbGY6IGNlbnRlcjsNCiAgICAgIC1tcy1mbGV4LWl0ZW0tYWxpZ246IGNlbnRlcjsNCiAgICAgIGFsaWduLXNlbGY6IGNlbnRlcjsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXRpbWUgLmZsYXRwaWNrci1hbS1wbSB7DQogICAgICBvdXRsaW5lOiAwOw0KICAgICAgd2lkdGg6IDE4JTsNCiAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgIGZvbnQtd2VpZ2h0OiA0MDA7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lIGlucHV0OmhvdmVyLA0KICAgIC5mbGF0cGlja3ItdGltZSAuZmxhdHBpY2tyLWFtLXBtOmhvdmVyLA0KICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dDpmb2N1cywNCiAgICAuZmxhdHBpY2tyLXRpbWUgLmZsYXRwaWNrci1hbS1wbTpmb2N1cyB7DQogICAgICBiYWNrZ3JvdW5kOiAjZjNmM2YzOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItaW5wdXRbcmVhZG9ubHldIHsNCiAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICB9DQoNCiAgICBALXdlYmtpdC1rZXlmcmFtZXMgZnBGYWRlSW5Eb3duIHsNCiAgICAgIGZyb20gew0KICAgICAgICBvcGFjaXR5OiAwOw0KICAgICAgICAtd2Via2l0LXRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgLTIwcHgsIDApOw0KICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIC0yMHB4LCAwKTsNCiAgICAgIH0NCg0KICAgICAgdG8gew0KICAgICAgICBvcGFjaXR5OiAxOw0KICAgICAgICAtd2Via2l0LXRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgMCwgMCk7DQogICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgMCwgMCk7DQogICAgICB9DQogICAgfQ0KDQogICAgQGtleWZyYW1lcyBmcEZhZGVJbkRvd24gew0KICAgICAgZnJvbSB7DQogICAgICAgIG9wYWNpdHk6IDA7DQogICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAtMjBweCwgMCk7DQogICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgLTIwcHgsIDApOw0KICAgICAgfQ0KDQogICAgICB0byB7DQogICAgICAgIG9wYWNpdHk6IDE7DQogICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAwLCAwKTsNCiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAwLCAwKTsNCiAgICAgIH0NCiAgICB9DQogIDwvc3R5bGU+DQogIDwhLS08c2NyaXB0IHNyYz0iamF2YXNjcmlwdHMvZmxhdHBpY2tyLmpzIiB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPjwvc2NyaXB0Pi0tPg0KICA8c2NyaXB0Pg0KICAvKiBmbGF0cGlja3IgdjQuNS4wLCBAbGljZW5zZSBNSVQgKi8NCihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7DQogICAgdHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnID8gbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCkgOg0KICAgIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShmYWN0b3J5KSA6DQogICAgKGdsb2JhbC5mbGF0cGlja3IgPSBmYWN0b3J5KCkpOw0KfSh0aGlzLCAoZnVuY3Rpb24gKCkgeyAndXNlIHN0cmljdCc7DQoNCiAgICB2YXIgcGFkID0gZnVuY3Rpb24gcGFkKG51bWJlcikgew0KICAgICAgcmV0dXJuICgiMCIgKyBudW1iZXIpLnNsaWNlKC0yKTsNCiAgICB9Ow0KICAgIHZhciBpbnQgPSBmdW5jdGlvbiBpbnQoYm9vbCkgew0KICAgICAgcmV0dXJuIGJvb2wgPT09IHRydWUgPyAxIDogMDsNCiAgICB9Ow0KICAgIGZ1bmN0aW9uIGRlYm91bmNlKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkgew0KICAgICAgaWYgKGltbWVkaWF0ZSA9PT0gdm9pZCAwKSB7DQogICAgICAgIGltbWVkaWF0ZSA9IGZhbHNlOw0KICAgICAgfQ0KDQogICAgICB2YXIgdGltZW91dDsNCiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBjb250ZXh0ID0gdGhpcywNCiAgICAgICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7DQogICAgICAgIHRpbWVvdXQgIT09IG51bGwgJiYgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOw0KICAgICAgICB0aW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHRpbWVvdXQgPSBudWxsOw0KICAgICAgICAgIGlmICghaW1tZWRpYXRlKSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOw0KICAgICAgICB9LCB3YWl0KTsNCiAgICAgICAgaWYgKGltbWVkaWF0ZSAmJiAhdGltZW91dCkgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsNCiAgICAgIH07DQogICAgfQ0KICAgIHZhciBhcnJheWlmeSA9IGZ1bmN0aW9uIGFycmF5aWZ5KG9iaikgew0KICAgICAgcmV0dXJuIG9iaiBpbnN0YW5jZW9mIEFycmF5ID8gb2JqIDogW29ial07DQogICAgfTsNCg0KICAgIHZhciBkb19ub3RoaW5nID0gZnVuY3Rpb24gZG9fbm90aGluZygpIHsNCiAgICAgIHJldHVybiB1bmRlZmluZWQ7DQogICAgfTsNCg0KICAgIHZhciBtb250aFRvU3RyID0gZnVuY3Rpb24gbW9udGhUb1N0cihtb250aE51bWJlciwgc2hvcnRoYW5kLCBsb2NhbGUpIHsNCiAgICAgIHJldHVybiBsb2NhbGUubW9udGhzW3Nob3J0aGFuZCA/ICJzaG9ydGhhbmQiIDogImxvbmdoYW5kIl1bbW9udGhOdW1iZXJdOw0KICAgIH07DQogICAgdmFyIHJldkZvcm1hdCA9IHsNCiAgICAgIEQ6IGRvX25vdGhpbmcsDQogICAgICBGOiBmdW5jdGlvbiBGKGRhdGVPYmosIG1vbnRoTmFtZSwgbG9jYWxlKSB7DQogICAgICAgIGRhdGVPYmouc2V0TW9udGgobG9jYWxlLm1vbnRocy5sb25naGFuZC5pbmRleE9mKG1vbnRoTmFtZSkpOw0KICAgICAgfSwNCiAgICAgIEc6IGZ1bmN0aW9uIEcoZGF0ZU9iaiwgaG91cikgew0KICAgICAgICBkYXRlT2JqLnNldEhvdXJzKHBhcnNlRmxvYXQoaG91cikpOw0KICAgICAgfSwNCiAgICAgIEg6IGZ1bmN0aW9uIEgoZGF0ZU9iaiwgaG91cikgew0KICAgICAgICBkYXRlT2JqLnNldEhvdXJzKHBhcnNlRmxvYXQoaG91cikpOw0KICAgICAgfSwNCiAgICAgIEo6IGZ1bmN0aW9uIEooZGF0ZU9iaiwgZGF5KSB7DQogICAgICAgIGRhdGVPYmouc2V0RGF0ZShwYXJzZUZsb2F0KGRheSkpOw0KICAgICAgfSwNCiAgICAgIEs6IGZ1bmN0aW9uIEsoZGF0ZU9iaiwgYW1QTSwgbG9jYWxlKSB7DQogICAgICAgIGRhdGVPYmouc2V0SG91cnMoZGF0ZU9iai5nZXRIb3VycygpICUgMTIgKyAxMiAqIGludChuZXcgUmVnRXhwKGxvY2FsZS5hbVBNWzFdLCAiaSIpLnRlc3QoYW1QTSkpKTsNCiAgICAgIH0sDQogICAgICBNOiBmdW5jdGlvbiBNKGRhdGVPYmosIHNob3J0TW9udGgsIGxvY2FsZSkgew0KICAgICAgICBkYXRlT2JqLnNldE1vbnRoKGxvY2FsZS5tb250aHMuc2hvcnRoYW5kLmluZGV4T2Yoc2hvcnRNb250aCkpOw0KICAgICAgfSwNCiAgICAgIFM6IGZ1bmN0aW9uIFMoZGF0ZU9iaiwgc2Vjb25kcykgew0KICAgICAgICBkYXRlT2JqLnNldFNlY29uZHMocGFyc2VGbG9hdChzZWNvbmRzKSk7DQogICAgICB9LA0KICAgICAgVTogZnVuY3Rpb24gVShfLCB1bml4U2Vjb25kcykgew0KICAgICAgICByZXR1cm4gbmV3IERhdGUocGFyc2VGbG9hdCh1bml4U2Vjb25kcykgKiAxMDAwKTsNCiAgICAgIH0sDQogICAgICBXOiBmdW5jdGlvbiBXKGRhdGVPYmosIHdlZWtOdW0pIHsNCiAgICAgICAgdmFyIHdlZWtOdW1iZXIgPSBwYXJzZUludCh3ZWVrTnVtKTsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGVPYmouZ2V0RnVsbFllYXIoKSwgMCwgMiArICh3ZWVrTnVtYmVyIC0gMSkgKiA3LCAwLCAwLCAwLCAwKTsNCiAgICAgIH0sDQogICAgICBZOiBmdW5jdGlvbiBZKGRhdGVPYmosIHllYXIpIHsNCiAgICAgICAgZGF0ZU9iai5zZXRGdWxsWWVhcihwYXJzZUZsb2F0KHllYXIpKTsNCiAgICAgIH0sDQogICAgICBaOiBmdW5jdGlvbiBaKF8sIElTT0RhdGUpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKElTT0RhdGUpOw0KICAgICAgfSwNCiAgICAgIGQ6IGZ1bmN0aW9uIGQoZGF0ZU9iaiwgZGF5KSB7DQogICAgICAgIGRhdGVPYmouc2V0RGF0ZShwYXJzZUZsb2F0KGRheSkpOw0KICAgICAgfSwNCiAgICAgIGg6IGZ1bmN0aW9uIGgoZGF0ZU9iaiwgaG91cikgew0KICAgICAgICBkYXRlT2JqLnNldEhvdXJzKHBhcnNlRmxvYXQoaG91cikpOw0KICAgICAgfSwNCiAgICAgIGk6IGZ1bmN0aW9uIGkoZGF0ZU9iaiwgbWludXRlcykgew0KICAgICAgICBkYXRlT2JqLnNldE1pbnV0ZXMocGFyc2VGbG9hdChtaW51dGVzKSk7DQogICAgICB9LA0KICAgICAgajogZnVuY3Rpb24gaihkYXRlT2JqLCBkYXkpIHsNCiAgICAgICAgZGF0ZU9iai5zZXREYXRlKHBhcnNlRmxvYXQoZGF5KSk7DQogICAgICB9LA0KICAgICAgbDogZG9fbm90aGluZywNCiAgICAgIG06IGZ1bmN0aW9uIG0oZGF0ZU9iaiwgbW9udGgpIHsNCiAgICAgICAgZGF0ZU9iai5zZXRNb250aChwYXJzZUZsb2F0KG1vbnRoKSAtIDEpOw0KICAgICAgfSwNCiAgICAgIG46IGZ1bmN0aW9uIG4oZGF0ZU9iaiwgbW9udGgpIHsNCiAgICAgICAgZGF0ZU9iai5zZXRNb250aChwYXJzZUZsb2F0KG1vbnRoKSAtIDEpOw0KICAgICAgfSwNCiAgICAgIHM6IGZ1bmN0aW9uIHMoZGF0ZU9iaiwgc2Vjb25kcykgew0KICAgICAgICBkYXRlT2JqLnNldFNlY29uZHMocGFyc2VGbG9hdChzZWNvbmRzKSk7DQogICAgICB9LA0KICAgICAgdzogZG9fbm90aGluZywNCiAgICAgIHk6IGZ1bmN0aW9uIHkoZGF0ZU9iaiwgeWVhcikgew0KICAgICAgICBkYXRlT2JqLnNldEZ1bGxZZWFyKDIwMDAgKyBwYXJzZUZsb2F0KHllYXIpKTsNCiAgICAgIH0NCiAgICB9Ow0KICAgIHZhciB0b2tlblJlZ2V4ID0gew0KICAgICAgRDogIihcXHcrKSIsDQogICAgICBGOiAiKFxcdyspIiwNCiAgICAgIEc6ICIoXFxkXFxkfFxcZCkiLA0KICAgICAgSDogIihcXGRcXGR8XFxkKSIsDQogICAgICBKOiAiKFxcZFxcZHxcXGQpXFx3KyIsDQogICAgICBLOiAiIiwNCiAgICAgIE06ICIoXFx3KykiLA0KICAgICAgUzogIihcXGRcXGR8XFxkKSIsDQogICAgICBVOiAiKC4rKSIsDQogICAgICBXOiAiKFxcZFxcZHxcXGQpIiwNCiAgICAgIFk6ICIoXFxkezR9KSIsDQogICAgICBaOiAiKC4rKSIsDQogICAgICBkOiAiKFxcZFxcZHxcXGQpIiwNCiAgICAgIGg6ICIoXFxkXFxkfFxcZCkiLA0KICAgICAgaTogIihcXGRcXGR8XFxkKSIsDQogICAgICBqOiAiKFxcZFxcZHxcXGQpIiwNCiAgICAgIGw6ICIoXFx3KykiLA0KICAgICAgbTogIihcXGRcXGR8XFxkKSIsDQogICAgICBuOiAiKFxcZFxcZHxcXGQpIiwNCiAgICAgIHM6ICIoXFxkXFxkfFxcZCkiLA0KICAgICAgdzogIihcXGRcXGR8XFxkKSIsDQogICAgICB5OiAiKFxcZHsyfSkiDQogICAgfTsNCiAgICB2YXIgZm9ybWF0cyA9IHsNCiAgICAgIFo6IGZ1bmN0aW9uIFooZGF0ZSkgew0KICAgICAgICByZXR1cm4gZGF0ZS50b0lTT1N0cmluZygpOw0KICAgICAgfSwNCiAgICAgIEQ6IGZ1bmN0aW9uIEQoZGF0ZSwgbG9jYWxlLCBvcHRpb25zKSB7DQogICAgICAgIHJldHVybiBsb2NhbGUud2Vla2RheXMuc2hvcnRoYW5kW2Zvcm1hdHMudyhkYXRlLCBsb2NhbGUsIG9wdGlvbnMpXTsNCiAgICAgIH0sDQogICAgICBGOiBmdW5jdGlvbiBGKGRhdGUsIGxvY2FsZSwgb3B0aW9ucykgew0KICAgICAgICByZXR1cm4gbW9udGhUb1N0cihmb3JtYXRzLm4oZGF0ZSwgbG9jYWxlLCBvcHRpb25zKSAtIDEsIGZhbHNlLCBsb2NhbGUpOw0KICAgICAgfSwNCiAgICAgIEc6IGZ1bmN0aW9uIEcoZGF0ZSwgbG9jYWxlLCBvcHRpb25zKSB7DQogICAgICAgIHJldHVybiBwYWQoZm9ybWF0cy5oKGRhdGUsIGxvY2FsZSwgb3B0aW9ucykpOw0KICAgICAgfSwNCiAgICAgIEg6IGZ1bmN0aW9uIEgoZGF0ZSkgew0KICAgICAgICByZXR1cm4gcGFkKGRhdGUuZ2V0SG91cnMoKSk7DQogICAgICB9LA0KICAgICAgSjogZnVuY3Rpb24gSihkYXRlLCBsb2NhbGUpIHsNCiAgICAgICAgcmV0dXJuIGxvY2FsZS5vcmRpbmFsICE9PSB1bmRlZmluZWQgPyBkYXRlLmdldERhdGUoKSArIGxvY2FsZS5vcmRpbmFsKGRhdGUuZ2V0RGF0ZSgpKSA6IGRhdGUuZ2V0RGF0ZSgpOw0KICAgICAgfSwNCiAgICAgIEs6IGZ1bmN0aW9uIEsoZGF0ZSwgbG9jYWxlKSB7DQogICAgICAgIHJldHVybiBsb2NhbGUuYW1QTVtpbnQoZGF0ZS5nZXRIb3VycygpID4gMTEpXTsNCiAgICAgIH0sDQogICAgICBNOiBmdW5jdGlvbiBNKGRhdGUsIGxvY2FsZSkgew0KICAgICAgICByZXR1cm4gbW9udGhUb1N0cihkYXRlLmdldE1vbnRoKCksIHRydWUsIGxvY2FsZSk7DQogICAgICB9LA0KICAgICAgUzogZnVuY3Rpb24gUyhkYXRlKSB7DQogICAgICAgIHJldHVybiBwYWQoZGF0ZS5nZXRTZWNvbmRzKCkpOw0KICAgICAgfSwNCiAgICAgIFU6IGZ1bmN0aW9uIFUoZGF0ZSkgew0KICAgICAgICByZXR1cm4gZGF0ZS5nZXRUaW1lKCkgLyAxMDAwOw0KICAgICAgfSwNCiAgICAgIFc6IGZ1bmN0aW9uIFcoZGF0ZSwgXywgb3B0aW9ucykgew0KICAgICAgICByZXR1cm4gb3B0aW9ucy5nZXRXZWVrKGRhdGUpOw0KICAgICAgfSwNCiAgICAgIFk6IGZ1bmN0aW9uIFkoZGF0ZSkgew0KICAgICAgICByZXR1cm4gZGF0ZS5nZXRGdWxsWWVhcigpOw0KICAgICAgfSwNCiAgICAgIGQ6IGZ1bmN0aW9uIGQoZGF0ZSkgew0KICAgICAgICByZXR1cm4gcGFkKGRhdGUuZ2V0RGF0ZSgpKTsNCiAgICAgIH0sDQogICAgICBoOiBmdW5jdGlvbiBoKGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIGRhdGUuZ2V0SG91cnMoKSAlIDEyID8gZGF0ZS5nZXRIb3VycygpICUgMTIgOiAxMjsNCiAgICAgIH0sDQogICAgICBpOiBmdW5jdGlvbiBpKGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIHBhZChkYXRlLmdldE1pbnV0ZXMoKSk7DQogICAgICB9LA0KICAgICAgajogZnVuY3Rpb24gaihkYXRlKSB7DQogICAgICAgIHJldHVybiBkYXRlLmdldERhdGUoKTsNCiAgICAgIH0sDQogICAgICBsOiBmdW5jdGlvbiBsKGRhdGUsIGxvY2FsZSkgew0KICAgICAgICByZXR1cm4gbG9jYWxlLndlZWtkYXlzLmxvbmdoYW5kW2RhdGUuZ2V0RGF5KCldOw0KICAgICAgfSwNCiAgICAgIG06IGZ1bmN0aW9uIG0oZGF0ZSkgew0KICAgICAgICByZXR1cm4gcGFkKGRhdGUuZ2V0TW9udGgoKSArIDEpOw0KICAgICAgfSwNCiAgICAgIG46IGZ1bmN0aW9uIG4oZGF0ZSkgew0KICAgICAgICByZXR1cm4gZGF0ZS5nZXRNb250aCgpICsgMTsNCiAgICAgIH0sDQogICAgICBzOiBmdW5jdGlvbiBzKGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIGRhdGUuZ2V0U2Vjb25kcygpOw0KICAgICAgfSwNCiAgICAgIHc6IGZ1bmN0aW9uIHcoZGF0ZSkgew0KICAgICAgICByZXR1cm4gZGF0ZS5nZXREYXkoKTsNCiAgICAgIH0sDQogICAgICB5OiBmdW5jdGlvbiB5KGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIFN0cmluZyhkYXRlLmdldEZ1bGxZZWFyKCkpLnN1YnN0cmluZygyKTsNCiAgICAgIH0NCiAgICB9Ow0KDQogICAgdmFyIGVuZ2xpc2ggPSB7DQogICAgICB3ZWVrZGF5czogew0KICAgICAgICBzaG9ydGhhbmQ6IFsiU3VuIiwgIk1vbiIsICJUdWUiLCAiV2VkIiwgIlRodSIsICJGcmkiLCAiU2F0Il0sDQogICAgICAgIGxvbmdoYW5kOiBbIlN1bmRheSIsICJNb25kYXkiLCAiVHVlc2RheSIsICJXZWRuZXNkYXkiLCAiVGh1cnNkYXkiLCAiRnJpZGF5IiwgIlNhdHVyZGF5Il0NCiAgICAgIH0sDQogICAgICBtb250aHM6IHsNCiAgICAgICAgc2hvcnRoYW5kOiBbIkphbiIsICJGZWIiLCAiTWFyIiwgIkFwciIsICJNYXkiLCAiSnVuIiwgIkp1bCIsICJBdWciLCAiU2VwIiwgIk9jdCIsICJOb3YiLCAiRGVjIl0sDQogICAgICAgIGxvbmdoYW5kOiBbIkphbnVhcnkiLCAiRmVicnVhcnkiLCAiTWFyY2giLCAiQXByaWwiLCAiTWF5IiwgIkp1bmUiLCAiSnVseSIsICJBdWd1c3QiLCAiU2VwdGVtYmVyIiwgIk9jdG9iZXIiLCAiTm92ZW1iZXIiLCAiRGVjZW1iZXIiXQ0KICAgICAgfSwNCiAgICAgIGRheXNJbk1vbnRoOiBbMzEsIDI4LCAzMSwgMzAsIDMxLCAzMCwgMzEsIDMxLCAzMCwgMzEsIDMwLCAzMV0sDQogICAgICBmaXJzdERheU9mV2VlazogMCwNCiAgICAgIG9yZGluYWw6IGZ1bmN0aW9uIG9yZGluYWwobnRoKSB7DQogICAgICAgIHZhciBzID0gbnRoICUgMTAwOw0KICAgICAgICBpZiAocyA+IDMgJiYgcyA8IDIxKSByZXR1cm4gInRoIjsNCg0KICAgICAgICBzd2l0Y2ggKHMgJSAxMCkgew0KICAgICAgICAgIGNhc2UgMToNCiAgICAgICAgICAgIHJldHVybiAic3QiOw0KDQogICAgICAgICAgY2FzZSAyOg0KICAgICAgICAgICAgcmV0dXJuICJuZCI7DQoNCiAgICAgICAgICBjYXNlIDM6DQogICAgICAgICAgICByZXR1cm4gInJkIjsNCg0KICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICByZXR1cm4gInRoIjsNCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgIHJhbmdlU2VwYXJhdG9yOiAiIHRvICIsDQogICAgICB3ZWVrQWJicmV2aWF0aW9uOiAiV2siLA0KICAgICAgc2Nyb2xsVGl0bGU6ICJTY3JvbGwgdG8gaW5jcmVtZW50IiwNCiAgICAgIHRvZ2dsZVRpdGxlOiAiQ2xpY2sgdG8gdG9nZ2xlIiwNCiAgICAgIGFtUE06IFsiQU0iLCAiUE0iXSwNCiAgICAgIHllYXJBcmlhTGFiZWw6ICJZZWFyIg0KICAgIH07DQoNCiAgICB2YXIgY3JlYXRlRGF0ZUZvcm1hdHRlciA9IGZ1bmN0aW9uIGNyZWF0ZURhdGVGb3JtYXR0ZXIoX3JlZikgew0KICAgICAgdmFyIF9yZWYkY29uZmlnID0gX3JlZi5jb25maWcsDQogICAgICAgICAgY29uZmlnID0gX3JlZiRjb25maWcgPT09IHZvaWQgMCA/IGRlZmF1bHRzIDogX3JlZiRjb25maWcsDQogICAgICAgICAgX3JlZiRsMTBuID0gX3JlZi5sMTBuLA0KICAgICAgICAgIGwxMG4gPSBfcmVmJGwxMG4gPT09IHZvaWQgMCA/IGVuZ2xpc2ggOiBfcmVmJGwxMG47DQogICAgICByZXR1cm4gZnVuY3Rpb24gKGRhdGVPYmosIGZybXQsIG92ZXJyaWRlTG9jYWxlKSB7DQogICAgICAgIGlmIChjb25maWcuZm9ybWF0RGF0ZSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gY29uZmlnLmZvcm1hdERhdGUoZGF0ZU9iaiwgZnJtdCk7DQogICAgICAgIHZhciBsb2NhbGUgPSBvdmVycmlkZUxvY2FsZSB8fCBsMTBuOw0KICAgICAgICByZXR1cm4gZnJtdC5zcGxpdCgiIikubWFwKGZ1bmN0aW9uIChjLCBpLCBhcnIpIHsNCiAgICAgICAgICByZXR1cm4gZm9ybWF0c1tjXSAmJiBhcnJbaSAtIDFdICE9PSAiXFwiID8gZm9ybWF0c1tjXShkYXRlT2JqLCBsb2NhbGUsIGNvbmZpZykgOiBjICE9PSAiXFwiID8gYyA6ICIiOw0KICAgICAgICB9KS5qb2luKCIiKTsNCiAgICAgIH07DQogICAgfTsNCiAgICB2YXIgY3JlYXRlRGF0ZVBhcnNlciA9IGZ1bmN0aW9uIGNyZWF0ZURhdGVQYXJzZXIoX3JlZjIpIHsNCiAgICAgIHZhciBfcmVmMiRjb25maWcgPSBfcmVmMi5jb25maWcsDQogICAgICAgICAgY29uZmlnID0gX3JlZjIkY29uZmlnID09PSB2b2lkIDAgPyBkZWZhdWx0cyA6IF9yZWYyJGNvbmZpZywNCiAgICAgICAgICBfcmVmMiRsMTBuID0gX3JlZjIubDEwbiwNCiAgICAgICAgICBsMTBuID0gX3JlZjIkbDEwbiA9PT0gdm9pZCAwID8gZW5nbGlzaCA6IF9yZWYyJGwxMG47DQogICAgICByZXR1cm4gZnVuY3Rpb24gKGRhdGUsIGdpdmVuRm9ybWF0LCB0aW1lbGVzcykgew0KICAgICAgICBpZiAoZGF0ZSAhPT0gMCAmJiAhZGF0ZSkgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICAgICAgdmFyIHBhcnNlZERhdGU7DQogICAgICAgIHZhciBkYXRlX29yaWcgPSBkYXRlOw0KICAgICAgICBpZiAoZGF0ZSBpbnN0YW5jZW9mIERhdGUpIHBhcnNlZERhdGUgPSBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSk7ZWxzZSBpZiAodHlwZW9mIGRhdGUgIT09ICJzdHJpbmciICYmIGRhdGUudG9GaXhlZCAhPT0gdW5kZWZpbmVkKSBwYXJzZWREYXRlID0gbmV3IERhdGUoZGF0ZSk7ZWxzZSBpZiAodHlwZW9mIGRhdGUgPT09ICJzdHJpbmciKSB7DQogICAgICAgICAgdmFyIGZvcm1hdCA9IGdpdmVuRm9ybWF0IHx8IChjb25maWcgfHwgZGVmYXVsdHMpLmRhdGVGb3JtYXQ7DQogICAgICAgICAgdmFyIGRhdGVzdHIgPSBTdHJpbmcoZGF0ZSkudHJpbSgpOw0KDQogICAgICAgICAgaWYgKGRhdGVzdHIgPT09ICJ0b2RheSIpIHsNCiAgICAgICAgICAgIHBhcnNlZERhdGUgPSBuZXcgRGF0ZSgpOw0KICAgICAgICAgICAgdGltZWxlc3MgPSB0cnVlOw0KICAgICAgICAgIH0gZWxzZSBpZiAoL1okLy50ZXN0KGRhdGVzdHIpIHx8IC9HTVQkLy50ZXN0KGRhdGVzdHIpKSBwYXJzZWREYXRlID0gbmV3IERhdGUoZGF0ZSk7ZWxzZSBpZiAoY29uZmlnICYmIGNvbmZpZy5wYXJzZURhdGUpIHBhcnNlZERhdGUgPSBjb25maWcucGFyc2VEYXRlKGRhdGUsIGZvcm1hdCk7ZWxzZSB7DQogICAgICAgICAgICBwYXJzZWREYXRlID0gIWNvbmZpZyB8fCAhY29uZmlnLm5vQ2FsZW5kYXIgPyBuZXcgRGF0ZShuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCksIDAsIDEsIDAsIDAsIDAsIDApIDogbmV3IERhdGUobmV3IERhdGUoKS5zZXRIb3VycygwLCAwLCAwLCAwKSk7DQogICAgICAgICAgICB2YXIgbWF0Y2hlZCwNCiAgICAgICAgICAgICAgICBvcHMgPSBbXTsNCg0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG1hdGNoSW5kZXggPSAwLCByZWdleFN0ciA9ICIiOyBpIDwgZm9ybWF0Lmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgIHZhciB0b2tlbiA9IGZvcm1hdFtpXTsNCiAgICAgICAgICAgICAgdmFyIGlzQmFja1NsYXNoID0gdG9rZW4gPT09ICJcXCI7DQogICAgICAgICAgICAgIHZhciBlc2NhcGVkID0gZm9ybWF0W2kgLSAxXSA9PT0gIlxcIiB8fCBpc0JhY2tTbGFzaDsNCg0KICAgICAgICAgICAgICBpZiAodG9rZW5SZWdleFt0b2tlbl0gJiYgIWVzY2FwZWQpIHsNCiAgICAgICAgICAgICAgICByZWdleFN0ciArPSB0b2tlblJlZ2V4W3Rva2VuXTsNCiAgICAgICAgICAgICAgICB2YXIgbWF0Y2ggPSBuZXcgUmVnRXhwKHJlZ2V4U3RyKS5leGVjKGRhdGUpOw0KDQogICAgICAgICAgICAgICAgaWYgKG1hdGNoICYmIChtYXRjaGVkID0gdHJ1ZSkpIHsNCiAgICAgICAgICAgICAgICAgIG9wc1t0b2tlbiAhPT0gIlkiID8gInB1c2giIDogInVuc2hpZnQiXSh7DQogICAgICAgICAgICAgICAgICAgIGZuOiByZXZGb3JtYXRbdG9rZW5dLA0KICAgICAgICAgICAgICAgICAgICB2YWw6IG1hdGNoWysrbWF0Y2hJbmRleF0NCiAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSBlbHNlIGlmICghaXNCYWNrU2xhc2gpIHJlZ2V4U3RyICs9ICIuIjsNCg0KICAgICAgICAgICAgICBvcHMuZm9yRWFjaChmdW5jdGlvbiAoX3JlZjMpIHsNCiAgICAgICAgICAgICAgICB2YXIgZm4gPSBfcmVmMy5mbiwNCiAgICAgICAgICAgICAgICAgICAgdmFsID0gX3JlZjMudmFsOw0KICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZWREYXRlID0gZm4ocGFyc2VkRGF0ZSwgdmFsLCBsMTBuKSB8fCBwYXJzZWREYXRlOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcGFyc2VkRGF0ZSA9IG1hdGNoZWQgPyBwYXJzZWREYXRlIDogdW5kZWZpbmVkOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmICghKHBhcnNlZERhdGUgaW5zdGFuY2VvZiBEYXRlICYmICFpc05hTihwYXJzZWREYXRlLmdldFRpbWUoKSkpKSB7DQogICAgICAgICAgY29uZmlnLmVycm9ySGFuZGxlcihuZXcgRXJyb3IoIkludmFsaWQgZGF0ZSBwcm92aWRlZDogIiArIGRhdGVfb3JpZykpOw0KICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAodGltZWxlc3MgPT09IHRydWUpIHBhcnNlZERhdGUuc2V0SG91cnMoMCwgMCwgMCwgMCk7DQogICAgICAgIHJldHVybiBwYXJzZWREYXRlOw0KICAgICAgfTsNCiAgICB9Ow0KICAgIGZ1bmN0aW9uIGNvbXBhcmVEYXRlcyhkYXRlMSwgZGF0ZTIsIHRpbWVsZXNzKSB7DQogICAgICBpZiAodGltZWxlc3MgPT09IHZvaWQgMCkgew0KICAgICAgICB0aW1lbGVzcyA9IHRydWU7DQogICAgICB9DQoNCiAgICAgIGlmICh0aW1lbGVzcyAhPT0gZmFsc2UpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUxLmdldFRpbWUoKSkuc2V0SG91cnMoMCwgMCwgMCwgMCkgLSBuZXcgRGF0ZShkYXRlMi5nZXRUaW1lKCkpLnNldEhvdXJzKDAsIDAsIDAsIDApOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gZGF0ZTEuZ2V0VGltZSgpIC0gZGF0ZTIuZ2V0VGltZSgpOw0KICAgIH0NCiAgICB2YXIgZ2V0V2VlayA9IGZ1bmN0aW9uIGdldFdlZWsoZ2l2ZW5EYXRlKSB7DQogICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGdpdmVuRGF0ZS5nZXRUaW1lKCkpOw0KICAgICAgZGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKTsNCiAgICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIDMgLSAoZGF0ZS5nZXREYXkoKSArIDYpICUgNyk7DQogICAgICB2YXIgd2VlazEgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIDAsIDQpOw0KICAgICAgcmV0dXJuIDEgKyBNYXRoLnJvdW5kKCgoZGF0ZS5nZXRUaW1lKCkgLSB3ZWVrMS5nZXRUaW1lKCkpIC8gODY0MDAwMDAgLSAzICsgKHdlZWsxLmdldERheSgpICsgNikgJSA3KSAvIDcpOw0KICAgIH07DQogICAgdmFyIGlzQmV0d2VlbiA9IGZ1bmN0aW9uIGlzQmV0d2Vlbih0cywgdHMxLCB0czIpIHsNCiAgICAgIHJldHVybiB0cyA+IE1hdGgubWluKHRzMSwgdHMyKSAmJiB0cyA8IE1hdGgubWF4KHRzMSwgdHMyKTsNCiAgICB9Ow0KICAgIHZhciBkdXJhdGlvbiA9IHsNCiAgICAgIERBWTogODY0MDAwMDANCiAgICB9Ow0KDQogICAgdmFyIGRlZmF1bHRzID0gew0KICAgICAgX2Rpc2FibGU6IFtdLA0KICAgICAgX2VuYWJsZTogW10sDQogICAgICBhbGxvd0lucHV0OiBmYWxzZSwNCiAgICAgIGFsdEZvcm1hdDogIkYgaiwgWSIsDQogICAgICBhbHRJbnB1dDogZmFsc2UsDQogICAgICBhbHRJbnB1dENsYXNzOiAiZm9ybS1jb250cm9sIGlucHV0IiwNCiAgICAgIGFuaW1hdGU6IHR5cGVvZiB3aW5kb3cgPT09ICJvYmplY3QiICYmIHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIk1TSUUiKSA9PT0gLTEsDQogICAgICBhcmlhRGF0ZUZvcm1hdDogIkYgaiwgWSIsDQogICAgICBjbGlja09wZW5zOiB0cnVlLA0KICAgICAgY2xvc2VPblNlbGVjdDogdHJ1ZSwNCiAgICAgIGNvbmp1bmN0aW9uOiAiLCAiLA0KICAgICAgZGF0ZUZvcm1hdDogIlktbS1kIiwNCiAgICAgIGRlZmF1bHRIb3VyOiAxMiwNCiAgICAgIGRlZmF1bHRNaW51dGU6IDAsDQogICAgICBkZWZhdWx0U2Vjb25kczogMCwNCiAgICAgIGRpc2FibGU6IFtdLA0KICAgICAgZGlzYWJsZU1vYmlsZTogZmFsc2UsDQogICAgICBlbmFibGU6IFtdLA0KICAgICAgZW5hYmxlU2Vjb25kczogZmFsc2UsDQogICAgICBlbmFibGVUaW1lOiBmYWxzZSwNCiAgICAgIGVycm9ySGFuZGxlcjogZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGVycikgew0KICAgICAgICByZXR1cm4gdHlwZW9mIGNvbnNvbGUgIT09ICJ1bmRlZmluZWQiICYmIGNvbnNvbGUud2FybihlcnIpOw0KICAgICAgfSwNCiAgICAgIGdldFdlZWs6IGdldFdlZWssDQogICAgICBob3VySW5jcmVtZW50OiAxLA0KICAgICAgaWdub3JlZEZvY3VzRWxlbWVudHM6IFtdLA0KICAgICAgaW5saW5lOiBmYWxzZSwNCiAgICAgIGxvY2FsZTogImRlZmF1bHQiLA0KICAgICAgbWludXRlSW5jcmVtZW50OiA1LA0KICAgICAgbW9kZTogInNpbmdsZSIsDQogICAgICBuZXh0QXJyb3c6ICI8c3ZnIHZlcnNpb249JzEuMScgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB4bWxuczp4bGluaz0naHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluaycgdmlld0JveD0nMCAwIDE3IDE3Jz48Zz48L2c+PHBhdGggZD0nTTEzLjIwNyA4LjQ3MmwtNy44NTQgNy44NTQtMC43MDctMC43MDcgNy4xNDYtNy4xNDYtNy4xNDYtNy4xNDggMC43MDctMC43MDcgNy44NTQgNy44NTR6JyAvPjwvc3ZnPiIsDQogICAgICBub0NhbGVuZGFyOiBmYWxzZSwNCiAgICAgIG5vdzogbmV3IERhdGUoKSwNCiAgICAgIG9uQ2hhbmdlOiBbXSwNCiAgICAgIG9uQ2xvc2U6IFtdLA0KICAgICAgb25EYXlDcmVhdGU6IFtdLA0KICAgICAgb25EZXN0cm95OiBbXSwNCiAgICAgIG9uS2V5RG93bjogW10sDQogICAgICBvbk1vbnRoQ2hhbmdlOiBbXSwNCiAgICAgIG9uT3BlbjogW10sDQogICAgICBvblBhcnNlQ29uZmlnOiBbXSwNCiAgICAgIG9uUmVhZHk6IFtdLA0KICAgICAgb25WYWx1ZVVwZGF0ZTogW10sDQogICAgICBvblllYXJDaGFuZ2U6IFtdLA0KICAgICAgb25QcmVDYWxlbmRhclBvc2l0aW9uOiBbXSwNCiAgICAgIHBsdWdpbnM6IFtdLA0KICAgICAgcG9zaXRpb246ICJhdXRvIiwNCiAgICAgIHBvc2l0aW9uRWxlbWVudDogdW5kZWZpbmVkLA0KICAgICAgcHJldkFycm93OiAiPHN2ZyB2ZXJzaW9uPScxLjEnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycgeG1sbnM6eGxpbms9J2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnIHZpZXdCb3g9JzAgMCAxNyAxNyc+PGc+PC9nPjxwYXRoIGQ9J001LjIwNyA4LjQ3MWw3LjE0NiA3LjE0Ny0wLjcwNyAwLjcwNy03Ljg1My03Ljg1NCA3Ljg1NC03Ljg1MyAwLjcwNyAwLjcwNy03LjE0NyA3LjE0NnonIC8+PC9zdmc+IiwNCiAgICAgIHNob3J0aGFuZEN1cnJlbnRNb250aDogZmFsc2UsDQogICAgICBzaG93TW9udGhzOiAxLA0KICAgICAgc3RhdGljOiBmYWxzZSwNCiAgICAgIHRpbWVfMjRocjogZmFsc2UsDQogICAgICB3ZWVrTnVtYmVyczogZmFsc2UsDQogICAgICB3cmFwOiBmYWxzZQ0KICAgIH07DQoNCiAgICBmdW5jdGlvbiB0b2dnbGVDbGFzcyhlbGVtLCBjbGFzc05hbWUsIGJvb2wpIHsNCiAgICAgIGlmIChib29sID09PSB0cnVlKSByZXR1cm4gZWxlbS5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7DQogICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTsNCiAgICB9DQogICAgZnVuY3Rpb24gY3JlYXRlRWxlbWVudCh0YWcsIGNsYXNzTmFtZSwgY29udGVudCkgew0KICAgICAgdmFyIGUgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpOw0KICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lIHx8ICIiOw0KICAgICAgY29udGVudCA9IGNvbnRlbnQgfHwgIiI7DQogICAgICBlLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTsNCiAgICAgIGlmIChjb250ZW50ICE9PSB1bmRlZmluZWQpIGUudGV4dENvbnRlbnQgPSBjb250ZW50Ow0KICAgICAgcmV0dXJuIGU7DQogICAgfQ0KICAgIGZ1bmN0aW9uIGNsZWFyTm9kZShub2RlKSB7DQogICAgICB3aGlsZSAobm9kZS5maXJzdENoaWxkKSB7DQogICAgICAgIG5vZGUucmVtb3ZlQ2hpbGQobm9kZS5maXJzdENoaWxkKTsNCiAgICAgIH0NCiAgICB9DQogICAgZnVuY3Rpb24gZmluZFBhcmVudChub2RlLCBjb25kaXRpb24pIHsNCiAgICAgIGlmIChjb25kaXRpb24obm9kZSkpIHJldHVybiBub2RlO2Vsc2UgaWYgKG5vZGUucGFyZW50Tm9kZSkgcmV0dXJuIGZpbmRQYXJlbnQobm9kZS5wYXJlbnROb2RlLCBjb25kaXRpb24pOw0KICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICB9DQogICAgZnVuY3Rpb24gY3JlYXRlTnVtYmVySW5wdXQoaW5wdXRDbGFzc05hbWUsIG9wdHMpIHsNCiAgICAgIHZhciB3cmFwcGVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgIm51bUlucHV0V3JhcHBlciIpLA0KICAgICAgICAgIG51bUlucHV0ID0gY3JlYXRlRWxlbWVudCgiaW5wdXQiLCAibnVtSW5wdXQgIiArIGlucHV0Q2xhc3NOYW1lKSwNCiAgICAgICAgICBhcnJvd1VwID0gY3JlYXRlRWxlbWVudCgic3BhbiIsICJhcnJvd1VwIiksDQogICAgICAgICAgYXJyb3dEb3duID0gY3JlYXRlRWxlbWVudCgic3BhbiIsICJhcnJvd0Rvd24iKTsNCiAgICAgIG51bUlucHV0LnR5cGUgPSAidGV4dCI7DQogICAgICBudW1JbnB1dC5wYXR0ZXJuID0gIlxcZCoiOw0KICAgICAgaWYgKG9wdHMgIT09IHVuZGVmaW5lZCkgZm9yICh2YXIga2V5IGluIG9wdHMpIHsNCiAgICAgICAgbnVtSW5wdXQuc2V0QXR0cmlidXRlKGtleSwgb3B0c1trZXldKTsNCiAgICAgIH0NCiAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQobnVtSW5wdXQpOw0KICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChhcnJvd1VwKTsNCiAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoYXJyb3dEb3duKTsNCiAgICAgIHJldHVybiB3cmFwcGVyOw0KICAgIH0NCg0KICAgIGlmICh0eXBlb2YgT2JqZWN0LmFzc2lnbiAhPT0gImZ1bmN0aW9uIikgew0KICAgICAgT2JqZWN0LmFzc2lnbiA9IGZ1bmN0aW9uICh0YXJnZXQpIHsNCiAgICAgICAgaWYgKCF0YXJnZXQpIHsNCiAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCBjb252ZXJ0IHVuZGVmaW5lZCBvciBudWxsIHRvIG9iamVjdCIpOw0KICAgICAgICB9DQoNCiAgICAgICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiA+IDEgPyBfbGVuIC0gMSA6IDApLCBfa2V5ID0gMTsgX2tleSA8IF9sZW47IF9rZXkrKykgew0KICAgICAgICAgIGFyZ3NbX2tleSAtIDFdID0gYXJndW1lbnRzW19rZXldOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoKSB7DQogICAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3NbX2ldOw0KDQogICAgICAgICAgaWYgKHNvdXJjZSkgew0KICAgICAgICAgICAgT2JqZWN0LmtleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldFtrZXldID0gc291cmNlW2tleV07DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3MubGVuZ3RoOyBfaSsrKSB7DQogICAgICAgICAgX2xvb3AoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB0YXJnZXQ7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIHZhciBERUJPVU5DRURfQ0hBTkdFX01TID0gMzAwOw0KDQogICAgZnVuY3Rpb24gRmxhdHBpY2tySW5zdGFuY2UoZWxlbWVudCwgaW5zdGFuY2VDb25maWcpIHsNCiAgICAgIHZhciBzZWxmID0gew0KICAgICAgICBjb25maWc6IE9iamVjdC5hc3NpZ24oe30sIGZsYXRwaWNrci5kZWZhdWx0Q29uZmlnKSwNCiAgICAgICAgbDEwbjogZW5nbGlzaA0KICAgICAgfTsNCiAgICAgIHNlbGYucGFyc2VEYXRlID0gY3JlYXRlRGF0ZVBhcnNlcih7DQogICAgICAgIGNvbmZpZzogc2VsZi5jb25maWcsDQogICAgICAgIGwxMG46IHNlbGYubDEwbg0KICAgICAgfSk7DQogICAgICBzZWxmLl9oYW5kbGVycyA9IFtdOw0KICAgICAgc2VsZi5fYmluZCA9IGJpbmQ7DQogICAgICBzZWxmLl9zZXRIb3Vyc0Zyb21EYXRlID0gc2V0SG91cnNGcm9tRGF0ZTsNCiAgICAgIHNlbGYuX3Bvc2l0aW9uQ2FsZW5kYXIgPSBwb3NpdGlvbkNhbGVuZGFyOw0KICAgICAgc2VsZi5jaGFuZ2VNb250aCA9IGNoYW5nZU1vbnRoOw0KICAgICAgc2VsZi5jaGFuZ2VZZWFyID0gY2hhbmdlWWVhcjsNCiAgICAgIHNlbGYuY2xlYXIgPSBjbGVhcjsNCiAgICAgIHNlbGYuY2xvc2UgPSBjbG9zZTsNCiAgICAgIHNlbGYuX2NyZWF0ZUVsZW1lbnQgPSBjcmVhdGVFbGVtZW50Ow0KICAgICAgc2VsZi5kZXN0cm95ID0gZGVzdHJveTsNCiAgICAgIHNlbGYuaXNFbmFibGVkID0gaXNFbmFibGVkOw0KICAgICAgc2VsZi5qdW1wVG9EYXRlID0ganVtcFRvRGF0ZTsNCiAgICAgIHNlbGYub3BlbiA9IG9wZW47DQogICAgICBzZWxmLnJlZHJhdyA9IHJlZHJhdzsNCiAgICAgIHNlbGYuc2V0ID0gc2V0Ow0KICAgICAgc2VsZi5zZXREYXRlID0gc2V0RGF0ZTsNCiAgICAgIHNlbGYudG9nZ2xlID0gdG9nZ2xlOw0KDQogICAgICBmdW5jdGlvbiBzZXR1cEhlbHBlckZ1bmN0aW9ucygpIHsNCiAgICAgICAgc2VsZi51dGlscyA9IHsNCiAgICAgICAgICBnZXREYXlzSW5Nb250aDogZnVuY3Rpb24gZ2V0RGF5c0luTW9udGgobW9udGgsIHlyKSB7DQogICAgICAgICAgICBpZiAobW9udGggPT09IHZvaWQgMCkgew0KICAgICAgICAgICAgICBtb250aCA9IHNlbGYuY3VycmVudE1vbnRoOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoeXIgPT09IHZvaWQgMCkgew0KICAgICAgICAgICAgICB5ciA9IHNlbGYuY3VycmVudFllYXI7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChtb250aCA9PT0gMSAmJiAoeXIgJSA0ID09PSAwICYmIHlyICUgMTAwICE9PSAwIHx8IHlyICUgNDAwID09PSAwKSkgcmV0dXJuIDI5Ow0KICAgICAgICAgICAgcmV0dXJuIHNlbGYubDEwbi5kYXlzSW5Nb250aFttb250aF07DQogICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBpbml0KCkgew0KICAgICAgICBzZWxmLmVsZW1lbnQgPSBzZWxmLmlucHV0ID0gZWxlbWVudDsNCiAgICAgICAgc2VsZi5pc09wZW4gPSBmYWxzZTsNCiAgICAgICAgcGFyc2VDb25maWcoKTsNCiAgICAgICAgc2V0dXBMb2NhbGUoKTsNCiAgICAgICAgc2V0dXBJbnB1dHMoKTsNCiAgICAgICAgc2V0dXBEYXRlcygpOw0KICAgICAgICBzZXR1cEhlbHBlckZ1bmN0aW9ucygpOw0KICAgICAgICBpZiAoIXNlbGYuaXNNb2JpbGUpIGJ1aWxkKCk7DQogICAgICAgIGJpbmRFdmVudHMoKTsNCg0KICAgICAgICBpZiAoc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCB8fCBzZWxmLmNvbmZpZy5ub0NhbGVuZGFyKSB7DQogICAgICAgICAgaWYgKHNlbGYuY29uZmlnLmVuYWJsZVRpbWUpIHsNCiAgICAgICAgICAgIHNldEhvdXJzRnJvbURhdGUoc2VsZi5jb25maWcubm9DYWxlbmRhciA/IHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqIHx8IHNlbGYuY29uZmlnLm1pbkRhdGUgOiB1bmRlZmluZWQpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIHVwZGF0ZVZhbHVlKGZhbHNlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHNldENhbGVuZGFyV2lkdGgoKTsNCiAgICAgICAgc2VsZi5zaG93VGltZUlucHV0ID0gc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA+IDAgfHwgc2VsZi5jb25maWcubm9DYWxlbmRhcjsNCiAgICAgICAgdmFyIGlzU2FmYXJpID0gL14oKD8hY2hyb21lfGFuZHJvaWQpLikqc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTsNCg0KICAgICAgICBpZiAoIXNlbGYuaXNNb2JpbGUgJiYgaXNTYWZhcmkpIHsNCiAgICAgICAgICBwb3NpdGlvbkNhbGVuZGFyKCk7DQogICAgICAgIH0NCg0KICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uUmVhZHkiKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gYmluZFRvSW5zdGFuY2UoZm4pIHsNCiAgICAgICAgcmV0dXJuIGZuLmJpbmQoc2VsZik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHNldENhbGVuZGFyV2lkdGgoKSB7DQogICAgICAgIHZhciBjb25maWcgPSBzZWxmLmNvbmZpZzsNCiAgICAgICAgaWYgKGNvbmZpZy53ZWVrTnVtYmVycyA9PT0gZmFsc2UgJiYgY29uZmlnLnNob3dNb250aHMgPT09IDEpIHJldHVybjtlbHNlIGlmIChjb25maWcubm9DYWxlbmRhciAhPT0gdHJ1ZSkgew0KICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7DQogICAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KDQogICAgICAgICAgICBpZiAoc2VsZi5kYXlzQ29udGFpbmVyICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgdmFyIGRheXNXaWR0aCA9IChzZWxmLmRheXMub2Zmc2V0V2lkdGggKyAxKSAqIGNvbmZpZy5zaG93TW9udGhzOw0KICAgICAgICAgICAgICBzZWxmLmRheXNDb250YWluZXIuc3R5bGUud2lkdGggPSBkYXlzV2lkdGggKyAicHgiOw0KICAgICAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLndpZHRoID0gZGF5c1dpZHRoICsgKHNlbGYud2Vla1dyYXBwZXIgIT09IHVuZGVmaW5lZCA/IHNlbGYud2Vla1dyYXBwZXIub2Zmc2V0V2lkdGggOiAwKSArICJweCI7DQogICAgICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuc3R5bGUucmVtb3ZlUHJvcGVydHkoInZpc2liaWxpdHkiKTsNCiAgICAgICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgiZGlzcGxheSIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZVRpbWUoZSkgew0KICAgICAgICBpZiAoc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOw0KICAgICAgICBpZiAoZSAhPT0gdW5kZWZpbmVkICYmIGUudHlwZSAhPT0gImJsdXIiKSB0aW1lV3JhcHBlcihlKTsNCiAgICAgICAgc2V0SG91cnNGcm9tSW5wdXRzKCk7DQogICAgICAgIHVwZGF0ZVZhbHVlKCk7DQoNCiAgICAgICAgc2VsZi5fZGVib3VuY2VkQ2hhbmdlKCk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGFtcG0ybWlsaXRhcnkoaG91ciwgYW1QTSkgew0KICAgICAgICByZXR1cm4gaG91ciAlIDEyICsgMTIgKiBpbnQoYW1QTSA9PT0gc2VsZi5sMTBuLmFtUE1bMV0pOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBtaWxpdGFyeTJhbXBtKGhvdXIpIHsNCiAgICAgICAgc3dpdGNoIChob3VyICUgMjQpIHsNCiAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgY2FzZSAxMjoNCiAgICAgICAgICAgIHJldHVybiAxMjsNCg0KICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICByZXR1cm4gaG91ciAlIDEyOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHNldEhvdXJzRnJvbUlucHV0cygpIHsNCiAgICAgICAgaWYgKHNlbGYuaG91ckVsZW1lbnQgPT09IHVuZGVmaW5lZCB8fCBzZWxmLm1pbnV0ZUVsZW1lbnQgPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KICAgICAgICB2YXIgaG91cnMgPSAocGFyc2VJbnQoc2VsZi5ob3VyRWxlbWVudC52YWx1ZS5zbGljZSgtMiksIDEwKSB8fCAwKSAlIDI0LA0KICAgICAgICAgICAgbWludXRlcyA9IChwYXJzZUludChzZWxmLm1pbnV0ZUVsZW1lbnQudmFsdWUsIDEwKSB8fCAwKSAlIDYwLA0KICAgICAgICAgICAgc2Vjb25kcyA9IHNlbGYuc2Vjb25kRWxlbWVudCAhPT0gdW5kZWZpbmVkID8gKHBhcnNlSW50KHNlbGYuc2Vjb25kRWxlbWVudC52YWx1ZSwgMTApIHx8IDApICUgNjAgOiAwOw0KDQogICAgICAgIGlmIChzZWxmLmFtUE0gIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgIGhvdXJzID0gYW1wbTJtaWxpdGFyeShob3Vycywgc2VsZi5hbVBNLnRleHRDb250ZW50KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBsaW1pdE1pbkhvdXJzID0gc2VsZi5jb25maWcubWluVGltZSAhPT0gdW5kZWZpbmVkIHx8IHNlbGYuY29uZmlnLm1pbkRhdGUgJiYgc2VsZi5taW5EYXRlSGFzVGltZSAmJiBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiAmJiBjb21wYXJlRGF0ZXMoc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmosIHNlbGYuY29uZmlnLm1pbkRhdGUsIHRydWUpID09PSAwOw0KICAgICAgICB2YXIgbGltaXRNYXhIb3VycyA9IHNlbGYuY29uZmlnLm1heFRpbWUgIT09IHVuZGVmaW5lZCB8fCBzZWxmLmNvbmZpZy5tYXhEYXRlICYmIHNlbGYubWF4RGF0ZUhhc1RpbWUgJiYgc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogJiYgY29tcGFyZURhdGVzKHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqLCBzZWxmLmNvbmZpZy5tYXhEYXRlLCB0cnVlKSA9PT0gMDsNCg0KICAgICAgICBpZiAobGltaXRNYXhIb3Vycykgew0KICAgICAgICAgIHZhciBtYXhUaW1lID0gc2VsZi5jb25maWcubWF4VGltZSAhPT0gdW5kZWZpbmVkID8gc2VsZi5jb25maWcubWF4VGltZSA6IHNlbGYuY29uZmlnLm1heERhdGU7DQogICAgICAgICAgaG91cnMgPSBNYXRoLm1pbihob3VycywgbWF4VGltZS5nZXRIb3VycygpKTsNCiAgICAgICAgICBpZiAoaG91cnMgPT09IG1heFRpbWUuZ2V0SG91cnMoKSkgbWludXRlcyA9IE1hdGgubWluKG1pbnV0ZXMsIG1heFRpbWUuZ2V0TWludXRlcygpKTsNCiAgICAgICAgICBpZiAobWludXRlcyA9PT0gbWF4VGltZS5nZXRNaW51dGVzKCkpIHNlY29uZHMgPSBNYXRoLm1pbihzZWNvbmRzLCBtYXhUaW1lLmdldFNlY29uZHMoKSk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAobGltaXRNaW5Ib3Vycykgew0KICAgICAgICAgIHZhciBtaW5UaW1lID0gc2VsZi5jb25maWcubWluVGltZSAhPT0gdW5kZWZpbmVkID8gc2VsZi5jb25maWcubWluVGltZSA6IHNlbGYuY29uZmlnLm1pbkRhdGU7DQogICAgICAgICAgaG91cnMgPSBNYXRoLm1heChob3VycywgbWluVGltZS5nZXRIb3VycygpKTsNCiAgICAgICAgICBpZiAoaG91cnMgPT09IG1pblRpbWUuZ2V0SG91cnMoKSkgbWludXRlcyA9IE1hdGgubWF4KG1pbnV0ZXMsIG1pblRpbWUuZ2V0TWludXRlcygpKTsNCiAgICAgICAgICBpZiAobWludXRlcyA9PT0gbWluVGltZS5nZXRNaW51dGVzKCkpIHNlY29uZHMgPSBNYXRoLm1heChzZWNvbmRzLCBtaW5UaW1lLmdldFNlY29uZHMoKSk7DQogICAgICAgIH0NCg0KICAgICAgICBzZXRIb3Vycyhob3VycywgbWludXRlcywgc2Vjb25kcyk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHNldEhvdXJzRnJvbURhdGUoZGF0ZU9iaikgew0KICAgICAgICB2YXIgZGF0ZSA9IGRhdGVPYmogfHwgc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmo7DQogICAgICAgIGlmIChkYXRlKSBzZXRIb3VycyhkYXRlLmdldEhvdXJzKCksIGRhdGUuZ2V0TWludXRlcygpLCBkYXRlLmdldFNlY29uZHMoKSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHNldERlZmF1bHRIb3VycygpIHsNCiAgICAgICAgdmFyIGhvdXJzID0gc2VsZi5jb25maWcuZGVmYXVsdEhvdXI7DQogICAgICAgIHZhciBtaW51dGVzID0gc2VsZi5jb25maWcuZGVmYXVsdE1pbnV0ZTsNCiAgICAgICAgdmFyIHNlY29uZHMgPSBzZWxmLmNvbmZpZy5kZWZhdWx0U2Vjb25kczsNCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcubWluRGF0ZSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgdmFyIG1pbl9ociA9IHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0SG91cnMoKTsNCiAgICAgICAgICB2YXIgbWluX21pbnV0ZXMgPSBzZWxmLmNvbmZpZy5taW5EYXRlLmdldE1pbnV0ZXMoKTsNCiAgICAgICAgICBob3VycyA9IE1hdGgubWF4KGhvdXJzLCBtaW5faHIpOw0KICAgICAgICAgIGlmIChob3VycyA9PT0gbWluX2hyKSBtaW51dGVzID0gTWF0aC5tYXgobWluX21pbnV0ZXMsIG1pbnV0ZXMpOw0KICAgICAgICAgIGlmIChob3VycyA9PT0gbWluX2hyICYmIG1pbnV0ZXMgPT09IG1pbl9taW51dGVzKSBzZWNvbmRzID0gc2VsZi5jb25maWcubWluRGF0ZS5nZXRTZWNvbmRzKCk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcubWF4RGF0ZSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgdmFyIG1heF9ociA9IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0SG91cnMoKTsNCiAgICAgICAgICB2YXIgbWF4X21pbnV0ZXMgPSBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldE1pbnV0ZXMoKTsNCiAgICAgICAgICBob3VycyA9IE1hdGgubWluKGhvdXJzLCBtYXhfaHIpOw0KICAgICAgICAgIGlmIChob3VycyA9PT0gbWF4X2hyKSBtaW51dGVzID0gTWF0aC5taW4obWF4X21pbnV0ZXMsIG1pbnV0ZXMpOw0KICAgICAgICAgIGlmIChob3VycyA9PT0gbWF4X2hyICYmIG1pbnV0ZXMgPT09IG1heF9taW51dGVzKSBzZWNvbmRzID0gc2VsZi5jb25maWcubWF4RGF0ZS5nZXRTZWNvbmRzKCk7DQogICAgICAgIH0NCg0KICAgICAgICBzZXRIb3Vycyhob3VycywgbWludXRlcywgc2Vjb25kcyk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHNldEhvdXJzKGhvdXJzLCBtaW51dGVzLCBzZWNvbmRzKSB7DQogICAgICAgIGlmIChzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmouc2V0SG91cnMoaG91cnMgJSAyNCwgbWludXRlcywgc2Vjb25kcyB8fCAwLCAwKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICghc2VsZi5ob3VyRWxlbWVudCB8fCAhc2VsZi5taW51dGVFbGVtZW50IHx8IHNlbGYuaXNNb2JpbGUpIHJldHVybjsNCiAgICAgICAgc2VsZi5ob3VyRWxlbWVudC52YWx1ZSA9IHBhZCghc2VsZi5jb25maWcudGltZV8yNGhyID8gKDEyICsgaG91cnMpICUgMTIgKyAxMiAqIGludChob3VycyAlIDEyID09PSAwKSA6IGhvdXJzKTsNCiAgICAgICAgc2VsZi5taW51dGVFbGVtZW50LnZhbHVlID0gcGFkKG1pbnV0ZXMpOw0KICAgICAgICBpZiAoc2VsZi5hbVBNICE9PSB1bmRlZmluZWQpIHNlbGYuYW1QTS50ZXh0Q29udGVudCA9IHNlbGYubDEwbi5hbVBNW2ludChob3VycyA+PSAxMildOw0KICAgICAgICBpZiAoc2VsZi5zZWNvbmRFbGVtZW50ICE9PSB1bmRlZmluZWQpIHNlbGYuc2Vjb25kRWxlbWVudC52YWx1ZSA9IHBhZChzZWNvbmRzKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gb25ZZWFySW5wdXQoZXZlbnQpIHsNCiAgICAgICAgdmFyIHllYXIgPSBwYXJzZUludChldmVudC50YXJnZXQudmFsdWUpICsgKGV2ZW50LmRlbHRhIHx8IDApOw0KDQogICAgICAgIGlmICh5ZWFyIC8gMTAwMCA+IDEgfHwgZXZlbnQua2V5ID09PSAiRW50ZXIiICYmICEvW15cZF0vLnRlc3QoeWVhci50b1N0cmluZygpKSkgew0KICAgICAgICAgIGNoYW5nZVllYXIoeWVhcik7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gYmluZChlbGVtZW50LCBldmVudCwgaGFuZGxlciwgb3B0aW9ucykgew0KICAgICAgICBpZiAoZXZlbnQgaW5zdGFuY2VvZiBBcnJheSkgcmV0dXJuIGV2ZW50LmZvckVhY2goZnVuY3Rpb24gKGV2KSB7DQogICAgICAgICAgcmV0dXJuIGJpbmQoZWxlbWVudCwgZXYsIGhhbmRsZXIsIG9wdGlvbnMpOw0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKGVsZW1lbnQgaW5zdGFuY2VvZiBBcnJheSkgcmV0dXJuIGVsZW1lbnQuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHsNCiAgICAgICAgICByZXR1cm4gYmluZChlbCwgZXZlbnQsIGhhbmRsZXIsIG9wdGlvbnMpOw0KICAgICAgICB9KTsNCiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBoYW5kbGVyLCBvcHRpb25zKTsNCg0KICAgICAgICBzZWxmLl9oYW5kbGVycy5wdXNoKHsNCiAgICAgICAgICBlbGVtZW50OiBlbGVtZW50LA0KICAgICAgICAgIGV2ZW50OiBldmVudCwNCiAgICAgICAgICBoYW5kbGVyOiBoYW5kbGVyLA0KICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIG9uQ2xpY2soaGFuZGxlcikgew0KICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGV2dCkgew0KICAgICAgICAgIGV2dC53aGljaCA9PT0gMSAmJiBoYW5kbGVyKGV2dCk7DQogICAgICAgIH07DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHRyaWdnZXJDaGFuZ2UoKSB7DQogICAgICAgIHRyaWdnZXJFdmVudCgib25DaGFuZ2UiKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gYmluZEV2ZW50cygpIHsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLndyYXApIHsNCiAgICAgICAgICBbIm9wZW4iLCAiY2xvc2UiLCAidG9nZ2xlIiwgImNsZWFyIl0uZm9yRWFjaChmdW5jdGlvbiAoZXZ0KSB7DQogICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKHNlbGYuZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbZGF0YS0iICsgZXZ0ICsgIl0iKSwgZnVuY3Rpb24gKGVsKSB7DQogICAgICAgICAgICAgIHJldHVybiBiaW5kKGVsLCAiY2xpY2siLCBzZWxmW2V2dF0pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5pc01vYmlsZSkgew0KICAgICAgICAgIHNldHVwTW9iaWxlKCk7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGRlYm91bmNlZFJlc2l6ZSA9IGRlYm91bmNlKG9uUmVzaXplLCA1MCk7DQogICAgICAgIHNlbGYuX2RlYm91bmNlZENoYW5nZSA9IGRlYm91bmNlKHRyaWdnZXJDaGFuZ2UsIERFQk9VTkNFRF9DSEFOR0VfTVMpOw0KICAgICAgICBpZiAoc2VsZi5kYXlzQ29udGFpbmVyICYmICEvaVBob25lfGlQYWR8aVBvZC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIGJpbmQoc2VsZi5kYXlzQ29udGFpbmVyLCAibW91c2VvdmVyIiwgZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIikgb25Nb3VzZU92ZXIoZS50YXJnZXQpOw0KICAgICAgICB9KTsNCiAgICAgICAgYmluZCh3aW5kb3cuZG9jdW1lbnQuYm9keSwgImtleWRvd24iLCBvbktleURvd24pOw0KICAgICAgICBpZiAoIXNlbGYuY29uZmlnLnN0YXRpYykgYmluZChzZWxmLl9pbnB1dCwgImtleWRvd24iLCBvbktleURvd24pOw0KICAgICAgICBpZiAoIXNlbGYuY29uZmlnLmlubGluZSAmJiAhc2VsZi5jb25maWcuc3RhdGljKSBiaW5kKHdpbmRvdywgInJlc2l6ZSIsIGRlYm91bmNlZFJlc2l6ZSk7DQogICAgICAgIGlmICh3aW5kb3cub250b3VjaHN0YXJ0ICE9PSB1bmRlZmluZWQpIGJpbmQod2luZG93LmRvY3VtZW50LCAiY2xpY2siLCBkb2N1bWVudENsaWNrKTtlbHNlIGJpbmQod2luZG93LmRvY3VtZW50LCAibW91c2Vkb3duIiwgb25DbGljayhkb2N1bWVudENsaWNrKSk7DQogICAgICAgIGJpbmQod2luZG93LmRvY3VtZW50LCAiZm9jdXMiLCBkb2N1bWVudENsaWNrLCB7DQogICAgICAgICAgY2FwdHVyZTogdHJ1ZQ0KICAgICAgICB9KTsNCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcuY2xpY2tPcGVucyA9PT0gdHJ1ZSkgew0KICAgICAgICAgIGJpbmQoc2VsZi5faW5wdXQsICJmb2N1cyIsIHNlbGYub3Blbik7DQogICAgICAgICAgYmluZChzZWxmLl9pbnB1dCwgIm1vdXNlZG93biIsIG9uQ2xpY2soc2VsZi5vcGVuKSk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5kYXlzQ29udGFpbmVyICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICBiaW5kKHNlbGYubW9udGhOYXYsICJtb3VzZWRvd24iLCBvbkNsaWNrKG9uTW9udGhOYXZDbGljaykpOw0KICAgICAgICAgIGJpbmQoc2VsZi5tb250aE5hdiwgWyJrZXl1cCIsICJpbmNyZW1lbnQiXSwgb25ZZWFySW5wdXQpOw0KICAgICAgICAgIGJpbmQoc2VsZi5kYXlzQ29udGFpbmVyLCAibW91c2Vkb3duIiwgb25DbGljayhzZWxlY3REYXRlKSk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi50aW1lQ29udGFpbmVyICE9PSB1bmRlZmluZWQgJiYgc2VsZi5taW51dGVFbGVtZW50ICE9PSB1bmRlZmluZWQgJiYgc2VsZi5ob3VyRWxlbWVudCAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgdmFyIHNlbFRleHQgPSBmdW5jdGlvbiBzZWxUZXh0KGUpIHsNCiAgICAgICAgICAgIHJldHVybiBlLnRhcmdldC5zZWxlY3QoKTsNCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgYmluZChzZWxmLnRpbWVDb250YWluZXIsIFsiaW5jcmVtZW50Il0sIHVwZGF0ZVRpbWUpOw0KICAgICAgICAgIGJpbmQoc2VsZi50aW1lQ29udGFpbmVyLCAiYmx1ciIsIHVwZGF0ZVRpbWUsIHsNCiAgICAgICAgICAgIGNhcHR1cmU6IHRydWUNCiAgICAgICAgICB9KTsNCiAgICAgICAgICBiaW5kKHNlbGYudGltZUNvbnRhaW5lciwgIm1vdXNlZG93biIsIG9uQ2xpY2sodGltZUluY3JlbWVudCkpOw0KICAgICAgICAgIGJpbmQoW3NlbGYuaG91ckVsZW1lbnQsIHNlbGYubWludXRlRWxlbWVudF0sIFsiZm9jdXMiLCAiY2xpY2siXSwgc2VsVGV4dCk7DQogICAgICAgICAgaWYgKHNlbGYuc2Vjb25kRWxlbWVudCAhPT0gdW5kZWZpbmVkKSBiaW5kKHNlbGYuc2Vjb25kRWxlbWVudCwgImZvY3VzIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuc2Vjb25kRWxlbWVudCAmJiBzZWxmLnNlY29uZEVsZW1lbnQuc2VsZWN0KCk7DQogICAgICAgICAgfSk7DQoNCiAgICAgICAgICBpZiAoc2VsZi5hbVBNICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIGJpbmQoc2VsZi5hbVBNLCAibW91c2Vkb3duIiwgb25DbGljayhmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgICB1cGRhdGVUaW1lKGUpOw0KICAgICAgICAgICAgICB0cmlnZ2VyQ2hhbmdlKCk7DQogICAgICAgICAgICB9KSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGp1bXBUb0RhdGUoanVtcERhdGUpIHsNCiAgICAgICAgdmFyIGp1bXBUbyA9IGp1bXBEYXRlICE9PSB1bmRlZmluZWQgPyBzZWxmLnBhcnNlRGF0ZShqdW1wRGF0ZSkgOiBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiB8fCAoc2VsZi5jb25maWcubWluRGF0ZSAmJiBzZWxmLmNvbmZpZy5taW5EYXRlID4gc2VsZi5ub3cgPyBzZWxmLmNvbmZpZy5taW5EYXRlIDogc2VsZi5jb25maWcubWF4RGF0ZSAmJiBzZWxmLmNvbmZpZy5tYXhEYXRlIDwgc2VsZi5ub3cgPyBzZWxmLmNvbmZpZy5tYXhEYXRlIDogc2VsZi5ub3cpOw0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgaWYgKGp1bXBUbyAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBzZWxmLmN1cnJlbnRZZWFyID0ganVtcFRvLmdldEZ1bGxZZWFyKCk7DQogICAgICAgICAgICBzZWxmLmN1cnJlbnRNb250aCA9IGp1bXBUby5nZXRNb250aCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgIGUubWVzc2FnZSA9ICJJbnZhbGlkIGRhdGUgc3VwcGxpZWQ6ICIgKyBqdW1wVG87DQogICAgICAgICAgc2VsZi5jb25maWcuZXJyb3JIYW5kbGVyKGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgc2VsZi5yZWRyYXcoKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gdGltZUluY3JlbWVudChlKSB7DQogICAgICAgIGlmICh+ZS50YXJnZXQuY2xhc3NOYW1lLmluZGV4T2YoImFycm93IikpIGluY3JlbWVudE51bUlucHV0KGUsIGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiYXJyb3dVcCIpID8gMSA6IC0xKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gaW5jcmVtZW50TnVtSW5wdXQoZSwgZGVsdGEsIGlucHV0RWxlbSkgew0KICAgICAgICB2YXIgdGFyZ2V0ID0gZSAmJiBlLnRhcmdldDsNCiAgICAgICAgdmFyIGlucHV0ID0gaW5wdXRFbGVtIHx8IHRhcmdldCAmJiB0YXJnZXQucGFyZW50Tm9kZSAmJiB0YXJnZXQucGFyZW50Tm9kZS5maXJzdENoaWxkOw0KICAgICAgICB2YXIgZXZlbnQgPSBjcmVhdGVFdmVudCgiaW5jcmVtZW50Iik7DQogICAgICAgIGV2ZW50LmRlbHRhID0gZGVsdGE7DQogICAgICAgIGlucHV0ICYmIGlucHV0LmRpc3BhdGNoRXZlbnQoZXZlbnQpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBidWlsZCgpIHsNCiAgICAgICAgdmFyIGZyYWdtZW50ID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCiAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3ItY2FsZW5kYXIiKTsNCiAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci50YWJJbmRleCA9IC0xOw0KDQogICAgICAgIGlmICghc2VsZi5jb25maWcubm9DYWxlbmRhcikgew0KICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGJ1aWxkTW9udGhOYXYoKSk7DQogICAgICAgICAgc2VsZi5pbm5lckNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3ItaW5uZXJDb250YWluZXIiKTsNCg0KICAgICAgICAgIGlmIChzZWxmLmNvbmZpZy53ZWVrTnVtYmVycykgew0KICAgICAgICAgICAgdmFyIF9idWlsZFdlZWtzID0gYnVpbGRXZWVrcygpLA0KICAgICAgICAgICAgICAgIHdlZWtXcmFwcGVyID0gX2J1aWxkV2Vla3Mud2Vla1dyYXBwZXIsDQogICAgICAgICAgICAgICAgd2Vla051bWJlcnMgPSBfYnVpbGRXZWVrcy53ZWVrTnVtYmVyczsNCg0KICAgICAgICAgICAgc2VsZi5pbm5lckNvbnRhaW5lci5hcHBlbmRDaGlsZCh3ZWVrV3JhcHBlcik7DQogICAgICAgICAgICBzZWxmLndlZWtOdW1iZXJzID0gd2Vla051bWJlcnM7DQogICAgICAgICAgICBzZWxmLndlZWtXcmFwcGVyID0gd2Vla1dyYXBwZXI7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgc2VsZi5yQ29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci1yQ29udGFpbmVyIik7DQogICAgICAgICAgc2VsZi5yQ29udGFpbmVyLmFwcGVuZENoaWxkKGJ1aWxkV2Vla2RheXMoKSk7DQoNCiAgICAgICAgICBpZiAoIXNlbGYuZGF5c0NvbnRhaW5lcikgew0KICAgICAgICAgICAgc2VsZi5kYXlzQ29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci1kYXlzIik7DQogICAgICAgICAgICBzZWxmLmRheXNDb250YWluZXIudGFiSW5kZXggPSAtMTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBidWlsZERheXMoKTsNCiAgICAgICAgICBzZWxmLnJDb250YWluZXIuYXBwZW5kQ2hpbGQoc2VsZi5kYXlzQ29udGFpbmVyKTsNCiAgICAgICAgICBzZWxmLmlubmVyQ29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGYuckNvbnRhaW5lcik7DQogICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoc2VsZi5pbm5lckNvbnRhaW5lcik7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcuZW5hYmxlVGltZSkgew0KICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGJ1aWxkVGltZSgpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRvZ2dsZUNsYXNzKHNlbGYuY2FsZW5kYXJDb250YWluZXIsICJyYW5nZU1vZGUiLCBzZWxmLmNvbmZpZy5tb2RlID09PSAicmFuZ2UiKTsNCiAgICAgICAgdG9nZ2xlQ2xhc3Moc2VsZi5jYWxlbmRhckNvbnRhaW5lciwgImFuaW1hdGUiLCBzZWxmLmNvbmZpZy5hbmltYXRlID09PSB0cnVlKTsNCiAgICAgICAgdG9nZ2xlQ2xhc3Moc2VsZi5jYWxlbmRhckNvbnRhaW5lciwgIm11bHRpTW9udGgiLCBzZWxmLmNvbmZpZy5zaG93TW9udGhzID4gMSk7DQogICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpOw0KICAgICAgICB2YXIgY3VzdG9tQXBwZW5kID0gc2VsZi5jb25maWcuYXBwZW5kVG8gIT09IHVuZGVmaW5lZCAmJiBzZWxmLmNvbmZpZy5hcHBlbmRUby5ub2RlVHlwZSAhPT0gdW5kZWZpbmVkOw0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5pbmxpbmUgfHwgc2VsZi5jb25maWcuc3RhdGljKSB7DQogICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKHNlbGYuY29uZmlnLmlubGluZSA/ICJpbmxpbmUiIDogInN0YXRpYyIpOw0KDQogICAgICAgICAgaWYgKHNlbGYuY29uZmlnLmlubGluZSkgew0KICAgICAgICAgICAgaWYgKCFjdXN0b21BcHBlbmQgJiYgc2VsZi5lbGVtZW50LnBhcmVudE5vZGUpIHNlbGYuZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzZWxmLmNhbGVuZGFyQ29udGFpbmVyLCBzZWxmLl9pbnB1dC5uZXh0U2libGluZyk7ZWxzZSBpZiAoc2VsZi5jb25maWcuYXBwZW5kVG8gIT09IHVuZGVmaW5lZCkgc2VsZi5jb25maWcuYXBwZW5kVG8uYXBwZW5kQ2hpbGQoc2VsZi5jYWxlbmRhckNvbnRhaW5lcik7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgaWYgKHNlbGYuY29uZmlnLnN0YXRpYykgew0KICAgICAgICAgICAgdmFyIHdyYXBwZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLXdyYXBwZXIiKTsNCiAgICAgICAgICAgIGlmIChzZWxmLmVsZW1lbnQucGFyZW50Tm9kZSkgc2VsZi5lbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHdyYXBwZXIsIHNlbGYuZWxlbWVudCk7DQogICAgICAgICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKHNlbGYuZWxlbWVudCk7DQogICAgICAgICAgICBpZiAoc2VsZi5hbHRJbnB1dCkgd3JhcHBlci5hcHBlbmRDaGlsZChzZWxmLmFsdElucHV0KTsNCiAgICAgICAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoc2VsZi5jYWxlbmRhckNvbnRhaW5lcik7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCFzZWxmLmNvbmZpZy5zdGF0aWMgJiYgIXNlbGYuY29uZmlnLmlubGluZSkgKHNlbGYuY29uZmlnLmFwcGVuZFRvICE9PSB1bmRlZmluZWQgPyBzZWxmLmNvbmZpZy5hcHBlbmRUbyA6IHdpbmRvdy5kb2N1bWVudC5ib2R5KS5hcHBlbmRDaGlsZChzZWxmLmNhbGVuZGFyQ29udGFpbmVyKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gY3JlYXRlRGF5KGNsYXNzTmFtZSwgZGF0ZSwgZGF5TnVtYmVyLCBpKSB7DQogICAgICAgIHZhciBkYXRlSXNFbmFibGVkID0gaXNFbmFibGVkKGRhdGUsIHRydWUpLA0KICAgICAgICAgICAgZGF5RWxlbWVudCA9IGNyZWF0ZUVsZW1lbnQoInNwYW4iLCAiZmxhdHBpY2tyLWRheSAiICsgY2xhc3NOYW1lLCBkYXRlLmdldERhdGUoKS50b1N0cmluZygpKTsNCiAgICAgICAgZGF5RWxlbWVudC5kYXRlT2JqID0gZGF0ZTsNCiAgICAgICAgZGF5RWxlbWVudC4kaSA9IGk7DQogICAgICAgIGRheUVsZW1lbnQuc2V0QXR0cmlidXRlKCJhcmlhLWxhYmVsIiwgc2VsZi5mb3JtYXREYXRlKGRhdGUsIHNlbGYuY29uZmlnLmFyaWFEYXRlRm9ybWF0KSk7DQoNCiAgICAgICAgaWYgKGNsYXNzTmFtZS5pbmRleE9mKCJoaWRkZW4iKSA9PT0gLTEgJiYgY29tcGFyZURhdGVzKGRhdGUsIHNlbGYubm93KSA9PT0gMCkgew0KICAgICAgICAgIHNlbGYudG9kYXlEYXRlRWxlbSA9IGRheUVsZW1lbnQ7DQogICAgICAgICAgZGF5RWxlbWVudC5jbGFzc0xpc3QuYWRkKCJ0b2RheSIpOw0KICAgICAgICAgIGRheUVsZW1lbnQuc2V0QXR0cmlidXRlKCJhcmlhLWN1cnJlbnQiLCAiZGF0ZSIpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGRhdGVJc0VuYWJsZWQpIHsNCiAgICAgICAgICBkYXlFbGVtZW50LnRhYkluZGV4ID0gLTE7DQoNCiAgICAgICAgICBpZiAoaXNEYXRlU2VsZWN0ZWQoZGF0ZSkpIHsNCiAgICAgICAgICAgIGRheUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgic2VsZWN0ZWQiKTsNCiAgICAgICAgICAgIHNlbGYuc2VsZWN0ZWREYXRlRWxlbSA9IGRheUVsZW1lbnQ7DQoNCiAgICAgICAgICAgIGlmIChzZWxmLmNvbmZpZy5tb2RlID09PSAicmFuZ2UiKSB7DQogICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKGRheUVsZW1lbnQsICJzdGFydFJhbmdlIiwgc2VsZi5zZWxlY3RlZERhdGVzWzBdICYmIGNvbXBhcmVEYXRlcyhkYXRlLCBzZWxmLnNlbGVjdGVkRGF0ZXNbMF0sIHRydWUpID09PSAwKTsNCiAgICAgICAgICAgICAgdG9nZ2xlQ2xhc3MoZGF5RWxlbWVudCwgImVuZFJhbmdlIiwgc2VsZi5zZWxlY3RlZERhdGVzWzFdICYmIGNvbXBhcmVEYXRlcyhkYXRlLCBzZWxmLnNlbGVjdGVkRGF0ZXNbMV0sIHRydWUpID09PSAwKTsNCiAgICAgICAgICAgICAgaWYgKGNsYXNzTmFtZSA9PT0gIm5leHRNb250aERheSIpIGRheUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgiaW5SYW5nZSIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBkYXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoImRpc2FibGVkIik7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIikgew0KICAgICAgICAgIGlmIChpc0RhdGVJblJhbmdlKGRhdGUpICYmICFpc0RhdGVTZWxlY3RlZChkYXRlKSkgZGF5RWxlbWVudC5jbGFzc0xpc3QuYWRkKCJpblJhbmdlIik7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi53ZWVrTnVtYmVycyAmJiBzZWxmLmNvbmZpZy5zaG93TW9udGhzID09PSAxICYmIGNsYXNzTmFtZSAhPT0gInByZXZNb250aERheSIgJiYgZGF5TnVtYmVyICUgNyA9PT0gMSkgew0KICAgICAgICAgIHNlbGYud2Vla051bWJlcnMuaW5zZXJ0QWRqYWNlbnRIVE1MKCJiZWZvcmVlbmQiLCAiPHNwYW4gY2xhc3M9J2ZsYXRwaWNrci1kYXknPiIgKyBzZWxmLmNvbmZpZy5nZXRXZWVrKGRhdGUpICsgIjwvc3Bhbj4iKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRyaWdnZXJFdmVudCgib25EYXlDcmVhdGUiLCBkYXlFbGVtZW50KTsNCiAgICAgICAgcmV0dXJuIGRheUVsZW1lbnQ7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGZvY3VzT25EYXlFbGVtKHRhcmdldE5vZGUpIHsNCiAgICAgICAgdGFyZ2V0Tm9kZS5mb2N1cygpOw0KICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIikgb25Nb3VzZU92ZXIodGFyZ2V0Tm9kZSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGdldEZpcnN0QXZhaWxhYmxlRGF5KGRlbHRhKSB7DQogICAgICAgIHZhciBzdGFydE1vbnRoID0gZGVsdGEgPiAwID8gMCA6IHNlbGYuY29uZmlnLnNob3dNb250aHMgLSAxOw0KICAgICAgICB2YXIgZW5kTW9udGggPSBkZWx0YSA+IDAgPyBzZWxmLmNvbmZpZy5zaG93TW9udGhzIDogLTE7DQoNCiAgICAgICAgZm9yICh2YXIgbSA9IHN0YXJ0TW9udGg7IG0gIT0gZW5kTW9udGg7IG0gKz0gZGVsdGEpIHsNCiAgICAgICAgICB2YXIgbW9udGggPSBzZWxmLmRheXNDb250YWluZXIuY2hpbGRyZW5bbV07DQogICAgICAgICAgdmFyIHN0YXJ0SW5kZXggPSBkZWx0YSA+IDAgPyAwIDogbW9udGguY2hpbGRyZW4ubGVuZ3RoIC0gMTsNCiAgICAgICAgICB2YXIgZW5kSW5kZXggPSBkZWx0YSA+IDAgPyBtb250aC5jaGlsZHJlbi5sZW5ndGggOiAtMTsNCg0KICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydEluZGV4OyBpICE9IGVuZEluZGV4OyBpICs9IGRlbHRhKSB7DQogICAgICAgICAgICB2YXIgYyA9IG1vbnRoLmNoaWxkcmVuW2ldOw0KICAgICAgICAgICAgaWYgKGMuY2xhc3NOYW1lLmluZGV4T2YoImhpZGRlbiIpID09PSAtMSAmJiBpc0VuYWJsZWQoYy5kYXRlT2JqKSkgcmV0dXJuIGM7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gZ2V0TmV4dEF2YWlsYWJsZURheShjdXJyZW50LCBkZWx0YSkgew0KICAgICAgICB2YXIgZ2l2ZW5Nb250aCA9IGN1cnJlbnQuY2xhc3NOYW1lLmluZGV4T2YoIk1vbnRoIikgPT09IC0xID8gY3VycmVudC5kYXRlT2JqLmdldE1vbnRoKCkgOiBzZWxmLmN1cnJlbnRNb250aDsNCiAgICAgICAgdmFyIGVuZE1vbnRoID0gZGVsdGEgPiAwID8gc2VsZi5jb25maWcuc2hvd01vbnRocyA6IC0xOw0KICAgICAgICB2YXIgbG9vcERlbHRhID0gZGVsdGEgPiAwID8gMSA6IC0xOw0KDQogICAgICAgIGZvciAodmFyIG0gPSBnaXZlbk1vbnRoIC0gc2VsZi5jdXJyZW50TW9udGg7IG0gIT0gZW5kTW9udGg7IG0gKz0gbG9vcERlbHRhKSB7DQogICAgICAgICAgdmFyIG1vbnRoID0gc2VsZi5kYXlzQ29udGFpbmVyLmNoaWxkcmVuW21dOw0KICAgICAgICAgIHZhciBzdGFydEluZGV4ID0gZ2l2ZW5Nb250aCAtIHNlbGYuY3VycmVudE1vbnRoID09PSBtID8gY3VycmVudC4kaSArIGRlbHRhIDogZGVsdGEgPCAwID8gbW9udGguY2hpbGRyZW4ubGVuZ3RoIC0gMSA6IDA7DQogICAgICAgICAgdmFyIG51bU1vbnRoRGF5cyA9IG1vbnRoLmNoaWxkcmVuLmxlbmd0aDsNCg0KICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydEluZGV4OyBpID49IDAgJiYgaSA8IG51bU1vbnRoRGF5cyAmJiBpICE9IChkZWx0YSA+IDAgPyBudW1Nb250aERheXMgOiAtMSk7IGkgKz0gbG9vcERlbHRhKSB7DQogICAgICAgICAgICB2YXIgYyA9IG1vbnRoLmNoaWxkcmVuW2ldOw0KICAgICAgICAgICAgaWYgKGMuY2xhc3NOYW1lLmluZGV4T2YoImhpZGRlbiIpID09PSAtMSAmJiBpc0VuYWJsZWQoYy5kYXRlT2JqKSAmJiBNYXRoLmFicyhjdXJyZW50LiRpIC0gaSkgPj0gTWF0aC5hYnMoZGVsdGEpKSByZXR1cm4gZm9jdXNPbkRheUVsZW0oYyk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgc2VsZi5jaGFuZ2VNb250aChsb29wRGVsdGEpOw0KICAgICAgICBmb2N1c09uRGF5KGdldEZpcnN0QXZhaWxhYmxlRGF5KGxvb3BEZWx0YSksIDApOw0KICAgICAgICByZXR1cm4gdW5kZWZpbmVkOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBmb2N1c09uRGF5KGN1cnJlbnQsIG9mZnNldCkgew0KICAgICAgICB2YXIgZGF5Rm9jdXNlZCA9IGlzSW5WaWV3KGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpOw0KICAgICAgICB2YXIgc3RhcnRFbGVtID0gY3VycmVudCAhPT0gdW5kZWZpbmVkID8gY3VycmVudCA6IGRheUZvY3VzZWQgPyBkb2N1bWVudC5hY3RpdmVFbGVtZW50IDogc2VsZi5zZWxlY3RlZERhdGVFbGVtICE9PSB1bmRlZmluZWQgJiYgaXNJblZpZXcoc2VsZi5zZWxlY3RlZERhdGVFbGVtKSA/IHNlbGYuc2VsZWN0ZWREYXRlRWxlbSA6IHNlbGYudG9kYXlEYXRlRWxlbSAhPT0gdW5kZWZpbmVkICYmIGlzSW5WaWV3KHNlbGYudG9kYXlEYXRlRWxlbSkgPyBzZWxmLnRvZGF5RGF0ZUVsZW0gOiBnZXRGaXJzdEF2YWlsYWJsZURheShvZmZzZXQgPiAwID8gMSA6IC0xKTsNCiAgICAgICAgaWYgKHN0YXJ0RWxlbSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gc2VsZi5faW5wdXQuZm9jdXMoKTsNCiAgICAgICAgaWYgKCFkYXlGb2N1c2VkKSByZXR1cm4gZm9jdXNPbkRheUVsZW0oc3RhcnRFbGVtKTsNCiAgICAgICAgZ2V0TmV4dEF2YWlsYWJsZURheShzdGFydEVsZW0sIG9mZnNldCk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGJ1aWxkTW9udGhEYXlzKHllYXIsIG1vbnRoKSB7DQogICAgICAgIHZhciBmaXJzdE9mTW9udGggPSAobmV3IERhdGUoeWVhciwgbW9udGgsIDEpLmdldERheSgpIC0gc2VsZi5sMTBuLmZpcnN0RGF5T2ZXZWVrICsgNykgJSA3Ow0KICAgICAgICB2YXIgcHJldk1vbnRoRGF5cyA9IHNlbGYudXRpbHMuZ2V0RGF5c0luTW9udGgoKG1vbnRoIC0gMSArIDEyKSAlIDEyKTsNCiAgICAgICAgdmFyIGRheXNJbk1vbnRoID0gc2VsZi51dGlscy5nZXREYXlzSW5Nb250aChtb250aCksDQogICAgICAgICAgICBkYXlzID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwNCiAgICAgICAgICAgIGlzTXVsdGlNb250aCA9IHNlbGYuY29uZmlnLnNob3dNb250aHMgPiAxLA0KICAgICAgICAgICAgcHJldk1vbnRoRGF5Q2xhc3MgPSBpc011bHRpTW9udGggPyAicHJldk1vbnRoRGF5IGhpZGRlbiIgOiAicHJldk1vbnRoRGF5IiwNCiAgICAgICAgICAgIG5leHRNb250aERheUNsYXNzID0gaXNNdWx0aU1vbnRoID8gIm5leHRNb250aERheSBoaWRkZW4iIDogIm5leHRNb250aERheSI7DQogICAgICAgIHZhciBkYXlOdW1iZXIgPSBwcmV2TW9udGhEYXlzICsgMSAtIGZpcnN0T2ZNb250aCwNCiAgICAgICAgICAgIGRheUluZGV4ID0gMDsNCg0KICAgICAgICBmb3IgKDsgZGF5TnVtYmVyIDw9IHByZXZNb250aERheXM7IGRheU51bWJlcisrLCBkYXlJbmRleCsrKSB7DQogICAgICAgICAgZGF5cy5hcHBlbmRDaGlsZChjcmVhdGVEYXkocHJldk1vbnRoRGF5Q2xhc3MsIG5ldyBEYXRlKHllYXIsIG1vbnRoIC0gMSwgZGF5TnVtYmVyKSwgZGF5TnVtYmVyLCBkYXlJbmRleCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgZm9yIChkYXlOdW1iZXIgPSAxOyBkYXlOdW1iZXIgPD0gZGF5c0luTW9udGg7IGRheU51bWJlcisrLCBkYXlJbmRleCsrKSB7DQogICAgICAgICAgZGF5cy5hcHBlbmRDaGlsZChjcmVhdGVEYXkoIiIsIG5ldyBEYXRlKHllYXIsIG1vbnRoLCBkYXlOdW1iZXIpLCBkYXlOdW1iZXIsIGRheUluZGV4KSk7DQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKHZhciBkYXlOdW0gPSBkYXlzSW5Nb250aCArIDE7IGRheU51bSA8PSA0MiAtIGZpcnN0T2ZNb250aCAmJiAoc2VsZi5jb25maWcuc2hvd01vbnRocyA9PT0gMSB8fCBkYXlJbmRleCAlIDcgIT09IDApOyBkYXlOdW0rKywgZGF5SW5kZXgrKykgew0KICAgICAgICAgIGRheXMuYXBwZW5kQ2hpbGQoY3JlYXRlRGF5KG5leHRNb250aERheUNsYXNzLCBuZXcgRGF0ZSh5ZWFyLCBtb250aCArIDEsIGRheU51bSAlIGRheXNJbk1vbnRoKSwgZGF5TnVtLCBkYXlJbmRleCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGRheUNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJkYXlDb250YWluZXIiKTsNCiAgICAgICAgZGF5Q29udGFpbmVyLmFwcGVuZENoaWxkKGRheXMpOw0KICAgICAgICByZXR1cm4gZGF5Q29udGFpbmVyOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBidWlsZERheXMoKSB7DQogICAgICAgIGlmIChzZWxmLmRheXNDb250YWluZXIgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGNsZWFyTm9kZShzZWxmLmRheXNDb250YWluZXIpOw0KICAgICAgICBpZiAoc2VsZi53ZWVrTnVtYmVycykgY2xlYXJOb2RlKHNlbGYud2Vla051bWJlcnMpOw0KICAgICAgICB2YXIgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCg0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuY29uZmlnLnNob3dNb250aHM7IGkrKykgew0KICAgICAgICAgIHZhciBkID0gbmV3IERhdGUoc2VsZi5jdXJyZW50WWVhciwgc2VsZi5jdXJyZW50TW9udGgsIDEpOw0KICAgICAgICAgIGQuc2V0TW9udGgoc2VsZi5jdXJyZW50TW9udGggKyBpKTsNCiAgICAgICAgICBmcmFnLmFwcGVuZENoaWxkKGJ1aWxkTW9udGhEYXlzKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpKSk7DQogICAgICAgIH0NCg0KICAgICAgICBzZWxmLmRheXNDb250YWluZXIuYXBwZW5kQ2hpbGQoZnJhZyk7DQogICAgICAgIHNlbGYuZGF5cyA9IHNlbGYuZGF5c0NvbnRhaW5lci5maXJzdENoaWxkOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBidWlsZE1vbnRoKCkgew0KICAgICAgICB2YXIgY29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci1tb250aCIpOw0KICAgICAgICB2YXIgbW9udGhOYXZGcmFnbWVudCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7DQogICAgICAgIHZhciBtb250aEVsZW1lbnQgPSBjcmVhdGVFbGVtZW50KCJzcGFuIiwgImN1ci1tb250aCIpOw0KICAgICAgICBtb250aEVsZW1lbnQudGl0bGUgPSBzZWxmLmwxMG4uc2Nyb2xsVGl0bGU7DQogICAgICAgIHZhciB5ZWFySW5wdXQgPSBjcmVhdGVOdW1iZXJJbnB1dCgiY3VyLXllYXIiLCB7DQogICAgICAgICAgdGFiaW5kZXg6ICItMSINCiAgICAgICAgfSk7DQogICAgICAgIHZhciB5ZWFyRWxlbWVudCA9IHllYXJJbnB1dC5jaGlsZE5vZGVzWzBdOw0KICAgICAgICB5ZWFyRWxlbWVudC50aXRsZSA9IHNlbGYubDEwbi5zY3JvbGxUaXRsZTsNCiAgICAgICAgeWVhckVsZW1lbnQuc2V0QXR0cmlidXRlKCJhcmlhLWxhYmVsIiwgc2VsZi5sMTBuLnllYXJBcmlhTGFiZWwpOw0KICAgICAgICBpZiAoc2VsZi5jb25maWcubWluRGF0ZSkgeWVhckVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLW1pbiIsIHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpKTsNCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcubWF4RGF0ZSkgew0KICAgICAgICAgIHllYXJFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1tYXgiLCBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKSk7DQogICAgICAgICAgeWVhckVsZW1lbnQuZGlzYWJsZWQgPSAhIXNlbGYuY29uZmlnLm1pbkRhdGUgJiYgc2VsZi5jb25maWcubWluRGF0ZS5nZXRGdWxsWWVhcigpID09PSBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldEZ1bGxZZWFyKCk7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgY3VycmVudE1vbnRoID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci1jdXJyZW50LW1vbnRoIik7DQogICAgICAgIGN1cnJlbnRNb250aC5hcHBlbmRDaGlsZChtb250aEVsZW1lbnQpOw0KICAgICAgICBjdXJyZW50TW9udGguYXBwZW5kQ2hpbGQoeWVhcklucHV0KTsNCiAgICAgICAgbW9udGhOYXZGcmFnbWVudC5hcHBlbmRDaGlsZChjdXJyZW50TW9udGgpOw0KICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobW9udGhOYXZGcmFnbWVudCk7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgY29udGFpbmVyOiBjb250YWluZXIsDQogICAgICAgICAgeWVhckVsZW1lbnQ6IHllYXJFbGVtZW50LA0KICAgICAgICAgIG1vbnRoRWxlbWVudDogbW9udGhFbGVtZW50DQogICAgICAgIH07DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGJ1aWxkTW9udGhzKCkgew0KICAgICAgICBjbGVhck5vZGUoc2VsZi5tb250aE5hdik7DQogICAgICAgIHNlbGYubW9udGhOYXYuYXBwZW5kQ2hpbGQoc2VsZi5wcmV2TW9udGhOYXYpOw0KDQogICAgICAgIGZvciAodmFyIG0gPSBzZWxmLmNvbmZpZy5zaG93TW9udGhzOyBtLS07KSB7DQogICAgICAgICAgdmFyIG1vbnRoID0gYnVpbGRNb250aCgpOw0KICAgICAgICAgIHNlbGYueWVhckVsZW1lbnRzLnB1c2gobW9udGgueWVhckVsZW1lbnQpOw0KICAgICAgICAgIHNlbGYubW9udGhFbGVtZW50cy5wdXNoKG1vbnRoLm1vbnRoRWxlbWVudCk7DQogICAgICAgICAgc2VsZi5tb250aE5hdi5hcHBlbmRDaGlsZChtb250aC5jb250YWluZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgc2VsZi5tb250aE5hdi5hcHBlbmRDaGlsZChzZWxmLm5leHRNb250aE5hdik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGJ1aWxkTW9udGhOYXYoKSB7DQogICAgICAgIHNlbGYubW9udGhOYXYgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLW1vbnRocyIpOw0KICAgICAgICBzZWxmLnllYXJFbGVtZW50cyA9IFtdOw0KICAgICAgICBzZWxmLm1vbnRoRWxlbWVudHMgPSBbXTsNCiAgICAgICAgc2VsZi5wcmV2TW9udGhOYXYgPSBjcmVhdGVFbGVtZW50KCJzcGFuIiwgImZsYXRwaWNrci1wcmV2LW1vbnRoIik7DQogICAgICAgIHNlbGYucHJldk1vbnRoTmF2LmlubmVySFRNTCA9IHNlbGYuY29uZmlnLnByZXZBcnJvdzsNCiAgICAgICAgc2VsZi5uZXh0TW9udGhOYXYgPSBjcmVhdGVFbGVtZW50KCJzcGFuIiwgImZsYXRwaWNrci1uZXh0LW1vbnRoIik7DQogICAgICAgIHNlbGYubmV4dE1vbnRoTmF2LmlubmVySFRNTCA9IHNlbGYuY29uZmlnLm5leHRBcnJvdzsNCiAgICAgICAgYnVpbGRNb250aHMoKTsNCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYsICJfaGlkZVByZXZNb250aEFycm93Iiwgew0KICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX19oaWRlUHJldk1vbnRoQXJyb3c7DQogICAgICAgICAgfSwNCiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChib29sKSB7DQogICAgICAgICAgICBpZiAoc2VsZi5fX2hpZGVQcmV2TW9udGhBcnJvdyAhPT0gYm9vbCkgew0KICAgICAgICAgICAgICB0b2dnbGVDbGFzcyhzZWxmLnByZXZNb250aE5hdiwgImRpc2FibGVkIiwgYm9vbCk7DQogICAgICAgICAgICAgIHNlbGYuX19oaWRlUHJldk1vbnRoQXJyb3cgPSBib29sOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLCAiX2hpZGVOZXh0TW9udGhBcnJvdyIsIHsNCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9faGlkZU5leHRNb250aEFycm93Ow0KICAgICAgICAgIH0sDQogICAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoYm9vbCkgew0KICAgICAgICAgICAgaWYgKHNlbGYuX19oaWRlTmV4dE1vbnRoQXJyb3cgIT09IGJvb2wpIHsNCiAgICAgICAgICAgICAgdG9nZ2xlQ2xhc3Moc2VsZi5uZXh0TW9udGhOYXYsICJkaXNhYmxlZCIsIGJvb2wpOw0KICAgICAgICAgICAgICBzZWxmLl9faGlkZU5leHRNb250aEFycm93ID0gYm9vbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBzZWxmLmN1cnJlbnRZZWFyRWxlbWVudCA9IHNlbGYueWVhckVsZW1lbnRzWzBdOw0KICAgICAgICB1cGRhdGVOYXZpZ2F0aW9uQ3VycmVudE1vbnRoKCk7DQogICAgICAgIHJldHVybiBzZWxmLm1vbnRoTmF2Ow0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBidWlsZFRpbWUoKSB7DQogICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuY2xhc3NMaXN0LmFkZCgiaGFzVGltZSIpOw0KICAgICAgICBpZiAoc2VsZi5jb25maWcubm9DYWxlbmRhcikgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJub0NhbGVuZGFyIik7DQogICAgICAgIHNlbGYudGltZUNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3ItdGltZSIpOw0KICAgICAgICBzZWxmLnRpbWVDb250YWluZXIudGFiSW5kZXggPSAtMTsNCiAgICAgICAgdmFyIHNlcGFyYXRvciA9IGNyZWF0ZUVsZW1lbnQoInNwYW4iLCAiZmxhdHBpY2tyLXRpbWUtc2VwYXJhdG9yIiwgIjoiKTsNCiAgICAgICAgdmFyIGhvdXJJbnB1dCA9IGNyZWF0ZU51bWJlcklucHV0KCJmbGF0cGlja3ItaG91ciIpOw0KICAgICAgICBzZWxmLmhvdXJFbGVtZW50ID0gaG91cklucHV0LmNoaWxkTm9kZXNbMF07DQogICAgICAgIHZhciBtaW51dGVJbnB1dCA9IGNyZWF0ZU51bWJlcklucHV0KCJmbGF0cGlja3ItbWludXRlIik7DQogICAgICAgIHNlbGYubWludXRlRWxlbWVudCA9IG1pbnV0ZUlucHV0LmNoaWxkTm9kZXNbMF07DQogICAgICAgIHNlbGYuaG91ckVsZW1lbnQudGFiSW5kZXggPSBzZWxmLm1pbnV0ZUVsZW1lbnQudGFiSW5kZXggPSAtMTsNCiAgICAgICAgc2VsZi5ob3VyRWxlbWVudC52YWx1ZSA9IHBhZChzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiA/IHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqLmdldEhvdXJzKCkgOiBzZWxmLmNvbmZpZy50aW1lXzI0aHIgPyBzZWxmLmNvbmZpZy5kZWZhdWx0SG91ciA6IG1pbGl0YXJ5MmFtcG0oc2VsZi5jb25maWcuZGVmYXVsdEhvdXIpKTsNCiAgICAgICAgc2VsZi5taW51dGVFbGVtZW50LnZhbHVlID0gcGFkKHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqID8gc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmouZ2V0TWludXRlcygpIDogc2VsZi5jb25maWcuZGVmYXVsdE1pbnV0ZSk7DQogICAgICAgIHNlbGYuaG91ckVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLXN0ZXAiLCBzZWxmLmNvbmZpZy5ob3VySW5jcmVtZW50LnRvU3RyaW5nKCkpOw0KICAgICAgICBzZWxmLm1pbnV0ZUVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLXN0ZXAiLCBzZWxmLmNvbmZpZy5taW51dGVJbmNyZW1lbnQudG9TdHJpbmcoKSk7DQogICAgICAgIHNlbGYuaG91ckVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLW1pbiIsIHNlbGYuY29uZmlnLnRpbWVfMjRociA/ICIwIiA6ICIxIik7DQogICAgICAgIHNlbGYuaG91ckVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLW1heCIsIHNlbGYuY29uZmlnLnRpbWVfMjRociA/ICIyMyIgOiAiMTIiKTsNCiAgICAgICAgc2VsZi5taW51dGVFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1taW4iLCAiMCIpOw0KICAgICAgICBzZWxmLm1pbnV0ZUVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLW1heCIsICI1OSIpOw0KICAgICAgICBzZWxmLnRpbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoaG91cklucHV0KTsNCiAgICAgICAgc2VsZi50aW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKHNlcGFyYXRvcik7DQogICAgICAgIHNlbGYudGltZUNvbnRhaW5lci5hcHBlbmRDaGlsZChtaW51dGVJbnB1dCk7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy50aW1lXzI0aHIpIHNlbGYudGltZUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJ0aW1lMjRociIpOw0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5lbmFibGVTZWNvbmRzKSB7DQogICAgICAgICAgc2VsZi50aW1lQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoImhhc1NlY29uZHMiKTsNCiAgICAgICAgICB2YXIgc2Vjb25kSW5wdXQgPSBjcmVhdGVOdW1iZXJJbnB1dCgiZmxhdHBpY2tyLXNlY29uZCIpOw0KICAgICAgICAgIHNlbGYuc2Vjb25kRWxlbWVudCA9IHNlY29uZElucHV0LmNoaWxkTm9kZXNbMF07DQogICAgICAgICAgc2VsZi5zZWNvbmRFbGVtZW50LnZhbHVlID0gcGFkKHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqID8gc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmouZ2V0U2Vjb25kcygpIDogc2VsZi5jb25maWcuZGVmYXVsdFNlY29uZHMpOw0KICAgICAgICAgIHNlbGYuc2Vjb25kRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtc3RlcCIsIHNlbGYubWludXRlRWxlbWVudC5nZXRBdHRyaWJ1dGUoImRhdGEtc3RlcCIpKTsNCiAgICAgICAgICBzZWxmLnNlY29uZEVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLW1pbiIsIHNlbGYubWludXRlRWxlbWVudC5nZXRBdHRyaWJ1dGUoImRhdGEtbWluIikpOw0KICAgICAgICAgIHNlbGYuc2Vjb25kRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtbWF4Iiwgc2VsZi5taW51dGVFbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS1tYXgiKSk7DQogICAgICAgICAgc2VsZi50aW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKGNyZWF0ZUVsZW1lbnQoInNwYW4iLCAiZmxhdHBpY2tyLXRpbWUtc2VwYXJhdG9yIiwgIjoiKSk7DQogICAgICAgICAgc2VsZi50aW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKHNlY29uZElucHV0KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICghc2VsZi5jb25maWcudGltZV8yNGhyKSB7DQogICAgICAgICAgc2VsZi5hbVBNID0gY3JlYXRlRWxlbWVudCgic3BhbiIsICJmbGF0cGlja3ItYW0tcG0iLCBzZWxmLmwxMG4uYW1QTVtpbnQoKHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqID8gc2VsZi5ob3VyRWxlbWVudC52YWx1ZSA6IHNlbGYuY29uZmlnLmRlZmF1bHRIb3VyKSA+IDExKV0pOw0KICAgICAgICAgIHNlbGYuYW1QTS50aXRsZSA9IHNlbGYubDEwbi50b2dnbGVUaXRsZTsNCiAgICAgICAgICBzZWxmLmFtUE0udGFiSW5kZXggPSAtMTsNCiAgICAgICAgICBzZWxmLnRpbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoc2VsZi5hbVBNKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBzZWxmLnRpbWVDb250YWluZXI7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGJ1aWxkV2Vla2RheXMoKSB7DQogICAgICAgIGlmICghc2VsZi53ZWVrZGF5Q29udGFpbmVyKSBzZWxmLndlZWtkYXlDb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLXdlZWtkYXlzIik7ZWxzZSBjbGVhck5vZGUoc2VsZi53ZWVrZGF5Q29udGFpbmVyKTsNCg0KICAgICAgICBmb3IgKHZhciBpID0gc2VsZi5jb25maWcuc2hvd01vbnRoczsgaS0tOykgew0KICAgICAgICAgIHZhciBjb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLXdlZWtkYXljb250YWluZXIiKTsNCiAgICAgICAgICBzZWxmLndlZWtkYXlDb250YWluZXIuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHVwZGF0ZVdlZWtkYXlzKCk7DQogICAgICAgIHJldHVybiBzZWxmLndlZWtkYXlDb250YWluZXI7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZVdlZWtkYXlzKCkgew0KICAgICAgICB2YXIgZmlyc3REYXlPZldlZWsgPSBzZWxmLmwxMG4uZmlyc3REYXlPZldlZWs7DQogICAgICAgIHZhciB3ZWVrZGF5cyA9IHNlbGYubDEwbi53ZWVrZGF5cy5zaG9ydGhhbmQuY29uY2F0KCk7DQoNCiAgICAgICAgaWYgKGZpcnN0RGF5T2ZXZWVrID4gMCAmJiBmaXJzdERheU9mV2VlayA8IHdlZWtkYXlzLmxlbmd0aCkgew0KICAgICAgICAgIHdlZWtkYXlzID0gd2Vla2RheXMuc3BsaWNlKGZpcnN0RGF5T2ZXZWVrLCB3ZWVrZGF5cy5sZW5ndGgpLmNvbmNhdCh3ZWVrZGF5cy5zcGxpY2UoMCwgZmlyc3REYXlPZldlZWspKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAodmFyIGkgPSBzZWxmLmNvbmZpZy5zaG93TW9udGhzOyBpLS07KSB7DQogICAgICAgICAgc2VsZi53ZWVrZGF5Q29udGFpbmVyLmNoaWxkcmVuW2ldLmlubmVySFRNTCA9ICJcbiAgICAgIDxzcGFuIGNsYXNzPWZsYXRwaWNrci13ZWVrZGF5PlxuICAgICAgICAiICsgd2Vla2RheXMuam9pbigiPC9zcGFuPjxzcGFuIGNsYXNzPWZsYXRwaWNrci13ZWVrZGF5PiIpICsgIlxuICAgICAgPC9zcGFuPlxuICAgICAgIjsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBidWlsZFdlZWtzKCkgew0KICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoImhhc1dlZWtzIik7DQogICAgICAgIHZhciB3ZWVrV3JhcHBlciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3Itd2Vla3dyYXBwZXIiKTsNCiAgICAgICAgd2Vla1dyYXBwZXIuYXBwZW5kQ2hpbGQoY3JlYXRlRWxlbWVudCgic3BhbiIsICJmbGF0cGlja3Itd2Vla2RheSIsIHNlbGYubDEwbi53ZWVrQWJicmV2aWF0aW9uKSk7DQogICAgICAgIHZhciB3ZWVrTnVtYmVycyA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3Itd2Vla3MiKTsNCiAgICAgICAgd2Vla1dyYXBwZXIuYXBwZW5kQ2hpbGQod2Vla051bWJlcnMpOw0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgIHdlZWtXcmFwcGVyOiB3ZWVrV3JhcHBlciwNCiAgICAgICAgICB3ZWVrTnVtYmVyczogd2Vla051bWJlcnMNCiAgICAgICAgfTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gY2hhbmdlTW9udGgodmFsdWUsIGlzX29mZnNldCkgew0KICAgICAgICBpZiAoaXNfb2Zmc2V0ID09PSB2b2lkIDApIHsNCiAgICAgICAgICBpc19vZmZzZXQgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGRlbHRhID0gaXNfb2Zmc2V0ID8gdmFsdWUgOiB2YWx1ZSAtIHNlbGYuY3VycmVudE1vbnRoOw0KICAgICAgICBpZiAoZGVsdGEgPCAwICYmIHNlbGYuX2hpZGVQcmV2TW9udGhBcnJvdyA9PT0gdHJ1ZSB8fCBkZWx0YSA+IDAgJiYgc2VsZi5faGlkZU5leHRNb250aEFycm93ID09PSB0cnVlKSByZXR1cm47DQogICAgICAgIHNlbGYuY3VycmVudE1vbnRoICs9IGRlbHRhOw0KDQogICAgICAgIGlmIChzZWxmLmN1cnJlbnRNb250aCA8IDAgfHwgc2VsZi5jdXJyZW50TW9udGggPiAxMSkgew0KICAgICAgICAgIHNlbGYuY3VycmVudFllYXIgKz0gc2VsZi5jdXJyZW50TW9udGggPiAxMSA/IDEgOiAtMTsNCiAgICAgICAgICBzZWxmLmN1cnJlbnRNb250aCA9IChzZWxmLmN1cnJlbnRNb250aCArIDEyKSAlIDEyOw0KICAgICAgICAgIHRyaWdnZXJFdmVudCgib25ZZWFyQ2hhbmdlIik7DQogICAgICAgIH0NCg0KICAgICAgICBidWlsZERheXMoKTsNCiAgICAgICAgdHJpZ2dlckV2ZW50KCJvbk1vbnRoQ2hhbmdlIik7DQogICAgICAgIHVwZGF0ZU5hdmlnYXRpb25DdXJyZW50TW9udGgoKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gY2xlYXIodHJpZ2dlckNoYW5nZUV2ZW50KSB7DQogICAgICAgIGlmICh0cmlnZ2VyQ2hhbmdlRXZlbnQgPT09IHZvaWQgMCkgew0KICAgICAgICAgIHRyaWdnZXJDaGFuZ2VFdmVudCA9IHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICBzZWxmLmlucHV0LnZhbHVlID0gIiI7DQogICAgICAgIGlmIChzZWxmLmFsdElucHV0ICE9PSB1bmRlZmluZWQpIHNlbGYuYWx0SW5wdXQudmFsdWUgPSAiIjsNCiAgICAgICAgaWYgKHNlbGYubW9iaWxlSW5wdXQgIT09IHVuZGVmaW5lZCkgc2VsZi5tb2JpbGVJbnB1dC52YWx1ZSA9ICIiOw0KICAgICAgICBzZWxmLnNlbGVjdGVkRGF0ZXMgPSBbXTsNCiAgICAgICAgc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogPSB1bmRlZmluZWQ7DQogICAgICAgIHNlbGYuc2hvd1RpbWVJbnB1dCA9IGZhbHNlOw0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5lbmFibGVUaW1lID09PSB0cnVlKSB7DQogICAgICAgICAgc2V0RGVmYXVsdEhvdXJzKCk7DQogICAgICAgIH0NCg0KICAgICAgICBzZWxmLnJlZHJhdygpOw0KICAgICAgICBpZiAodHJpZ2dlckNoYW5nZUV2ZW50KSB0cmlnZ2VyRXZlbnQoIm9uQ2hhbmdlIik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGNsb3NlKCkgew0KICAgICAgICBzZWxmLmlzT3BlbiA9IGZhbHNlOw0KDQogICAgICAgIGlmICghc2VsZi5pc01vYmlsZSkgew0KICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgib3BlbiIpOw0KDQogICAgICAgICAgc2VsZi5faW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgiYWN0aXZlIik7DQogICAgICAgIH0NCg0KICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uQ2xvc2UiKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gZGVzdHJveSgpIHsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnICE9PSB1bmRlZmluZWQpIHRyaWdnZXJFdmVudCgib25EZXN0cm95Iik7DQoNCiAgICAgICAgZm9yICh2YXIgaSA9IHNlbGYuX2hhbmRsZXJzLmxlbmd0aDsgaS0tOykgew0KICAgICAgICAgIHZhciBoID0gc2VsZi5faGFuZGxlcnNbaV07DQogICAgICAgICAgaC5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoaC5ldmVudCwgaC5oYW5kbGVyLCBoLm9wdGlvbnMpOw0KICAgICAgICB9DQoNCiAgICAgICAgc2VsZi5faGFuZGxlcnMgPSBbXTsNCg0KICAgICAgICBpZiAoc2VsZi5tb2JpbGVJbnB1dCkgew0KICAgICAgICAgIGlmIChzZWxmLm1vYmlsZUlucHV0LnBhcmVudE5vZGUpIHNlbGYubW9iaWxlSW5wdXQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzZWxmLm1vYmlsZUlucHV0KTsNCiAgICAgICAgICBzZWxmLm1vYmlsZUlucHV0ID0gdW5kZWZpbmVkOw0KICAgICAgICB9IGVsc2UgaWYgKHNlbGYuY2FsZW5kYXJDb250YWluZXIgJiYgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5wYXJlbnROb2RlKSBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2VsZi5jYWxlbmRhckNvbnRhaW5lcik7DQoNCiAgICAgICAgaWYgKHNlbGYuYWx0SW5wdXQpIHsNCiAgICAgICAgICBzZWxmLmlucHV0LnR5cGUgPSAidGV4dCI7DQogICAgICAgICAgaWYgKHNlbGYuYWx0SW5wdXQucGFyZW50Tm9kZSkgc2VsZi5hbHRJbnB1dC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNlbGYuYWx0SW5wdXQpOw0KICAgICAgICAgIGRlbGV0ZSBzZWxmLmFsdElucHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYuaW5wdXQpIHsNCiAgICAgICAgICBzZWxmLmlucHV0LnR5cGUgPSBzZWxmLmlucHV0Ll90eXBlOw0KICAgICAgICAgIHNlbGYuaW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgiZmxhdHBpY2tyLWlucHV0Iik7DQogICAgICAgICAgc2VsZi5pbnB1dC5yZW1vdmVBdHRyaWJ1dGUoInJlYWRvbmx5Iik7DQogICAgICAgICAgc2VsZi5pbnB1dC52YWx1ZSA9ICIiOw0KICAgICAgICB9DQoNCiAgICAgICAgWyJfc2hvd1RpbWVJbnB1dCIsICJsYXRlc3RTZWxlY3RlZERhdGVPYmoiLCAiX2hpZGVOZXh0TW9udGhBcnJvdyIsICJfaGlkZVByZXZNb250aEFycm93IiwgIl9faGlkZU5leHRNb250aEFycm93IiwgIl9faGlkZVByZXZNb250aEFycm93IiwgImlzTW9iaWxlIiwgImlzT3BlbiIsICJzZWxlY3RlZERhdGVFbGVtIiwgIm1pbkRhdGVIYXNUaW1lIiwgIm1heERhdGVIYXNUaW1lIiwgImRheXMiLCAiZGF5c0NvbnRhaW5lciIsICJfaW5wdXQiLCAiX3Bvc2l0aW9uRWxlbWVudCIsICJpbm5lckNvbnRhaW5lciIsICJyQ29udGFpbmVyIiwgIm1vbnRoTmF2IiwgInRvZGF5RGF0ZUVsZW0iLCAiY2FsZW5kYXJDb250YWluZXIiLCAid2Vla2RheUNvbnRhaW5lciIsICJwcmV2TW9udGhOYXYiLCAibmV4dE1vbnRoTmF2IiwgImN1cnJlbnRNb250aEVsZW1lbnQiLCAiY3VycmVudFllYXJFbGVtZW50IiwgIm5hdmlnYXRpb25DdXJyZW50TW9udGgiLCAic2VsZWN0ZWREYXRlRWxlbSIsICJjb25maWciXS5mb3JFYWNoKGZ1bmN0aW9uIChrKSB7DQogICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGRlbGV0ZSBzZWxmW2tdOw0KICAgICAgICAgIH0gY2F0Y2ggKF8pIHt9DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBpc0NhbGVuZGFyRWxlbShlbGVtKSB7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5hcHBlbmRUbyAmJiBzZWxmLmNvbmZpZy5hcHBlbmRUby5jb250YWlucyhlbGVtKSkgcmV0dXJuIHRydWU7DQogICAgICAgIHJldHVybiBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLmNvbnRhaW5zKGVsZW0pOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBkb2N1bWVudENsaWNrKGUpIHsNCiAgICAgICAgaWYgKHNlbGYuaXNPcGVuICYmICFzZWxmLmNvbmZpZy5pbmxpbmUpIHsNCiAgICAgICAgICB2YXIgaXNDYWxlbmRhckVsZW1lbnQgPSBpc0NhbGVuZGFyRWxlbShlLnRhcmdldCk7DQogICAgICAgICAgdmFyIGlzSW5wdXQgPSBlLnRhcmdldCA9PT0gc2VsZi5pbnB1dCB8fCBlLnRhcmdldCA9PT0gc2VsZi5hbHRJbnB1dCB8fCBzZWxmLmVsZW1lbnQuY29udGFpbnMoZS50YXJnZXQpIHx8IGUucGF0aCAmJiBlLnBhdGguaW5kZXhPZiAmJiAofmUucGF0aC5pbmRleE9mKHNlbGYuaW5wdXQpIHx8IH5lLnBhdGguaW5kZXhPZihzZWxmLmFsdElucHV0KSk7DQogICAgICAgICAgdmFyIGxvc3RGb2N1cyA9IGUudHlwZSA9PT0gImJsdXIiID8gaXNJbnB1dCAmJiBlLnJlbGF0ZWRUYXJnZXQgJiYgIWlzQ2FsZW5kYXJFbGVtKGUucmVsYXRlZFRhcmdldCkgOiAhaXNJbnB1dCAmJiAhaXNDYWxlbmRhckVsZW1lbnQ7DQogICAgICAgICAgdmFyIGlzSWdub3JlZCA9ICFzZWxmLmNvbmZpZy5pZ25vcmVkRm9jdXNFbGVtZW50cy5zb21lKGZ1bmN0aW9uIChlbGVtKSB7DQogICAgICAgICAgICByZXR1cm4gZWxlbS5jb250YWlucyhlLnRhcmdldCk7DQogICAgICAgICAgfSk7DQoNCiAgICAgICAgICBpZiAobG9zdEZvY3VzICYmIGlzSWdub3JlZCkgew0KICAgICAgICAgICAgc2VsZi5jbG9zZSgpOw0KDQogICAgICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIiAmJiBzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID09PSAxKSB7DQogICAgICAgICAgICAgIHNlbGYuY2xlYXIoZmFsc2UpOw0KICAgICAgICAgICAgICBzZWxmLnJlZHJhdygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBjaGFuZ2VZZWFyKG5ld1llYXIpIHsNCiAgICAgICAgaWYgKCFuZXdZZWFyIHx8IHNlbGYuY29uZmlnLm1pbkRhdGUgJiYgbmV3WWVhciA8IHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0RnVsbFllYXIoKSB8fCBzZWxmLmNvbmZpZy5tYXhEYXRlICYmIG5ld1llYXIgPiBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldEZ1bGxZZWFyKCkpIHJldHVybjsNCiAgICAgICAgdmFyIG5ld1llYXJOdW0gPSBuZXdZZWFyLA0KICAgICAgICAgICAgaXNOZXdZZWFyID0gc2VsZi5jdXJyZW50WWVhciAhPT0gbmV3WWVhck51bTsNCiAgICAgICAgc2VsZi5jdXJyZW50WWVhciA9IG5ld1llYXJOdW0gfHwgc2VsZi5jdXJyZW50WWVhcjsNCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcubWF4RGF0ZSAmJiBzZWxmLmN1cnJlbnRZZWFyID09PSBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldEZ1bGxZZWFyKCkpIHsNCiAgICAgICAgICBzZWxmLmN1cnJlbnRNb250aCA9IE1hdGgubWluKHNlbGYuY29uZmlnLm1heERhdGUuZ2V0TW9udGgoKSwgc2VsZi5jdXJyZW50TW9udGgpOw0KICAgICAgICB9IGVsc2UgaWYgKHNlbGYuY29uZmlnLm1pbkRhdGUgJiYgc2VsZi5jdXJyZW50WWVhciA9PT0gc2VsZi5jb25maWcubWluRGF0ZS5nZXRGdWxsWWVhcigpKSB7DQogICAgICAgICAgc2VsZi5jdXJyZW50TW9udGggPSBNYXRoLm1heChzZWxmLmNvbmZpZy5taW5EYXRlLmdldE1vbnRoKCksIHNlbGYuY3VycmVudE1vbnRoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChpc05ld1llYXIpIHsNCiAgICAgICAgICBzZWxmLnJlZHJhdygpOw0KICAgICAgICAgIHRyaWdnZXJFdmVudCgib25ZZWFyQ2hhbmdlIik7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gaXNFbmFibGVkKGRhdGUsIHRpbWVsZXNzKSB7DQogICAgICAgIGlmICh0aW1lbGVzcyA9PT0gdm9pZCAwKSB7DQogICAgICAgICAgdGltZWxlc3MgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGRhdGVUb0NoZWNrID0gc2VsZi5wYXJzZURhdGUoZGF0ZSwgdW5kZWZpbmVkLCB0aW1lbGVzcyk7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5taW5EYXRlICYmIGRhdGVUb0NoZWNrICYmIGNvbXBhcmVEYXRlcyhkYXRlVG9DaGVjaywgc2VsZi5jb25maWcubWluRGF0ZSwgdGltZWxlc3MgIT09IHVuZGVmaW5lZCA/IHRpbWVsZXNzIDogIXNlbGYubWluRGF0ZUhhc1RpbWUpIDwgMCB8fCBzZWxmLmNvbmZpZy5tYXhEYXRlICYmIGRhdGVUb0NoZWNrICYmIGNvbXBhcmVEYXRlcyhkYXRlVG9DaGVjaywgc2VsZi5jb25maWcubWF4RGF0ZSwgdGltZWxlc3MgIT09IHVuZGVmaW5lZCA/IHRpbWVsZXNzIDogIXNlbGYubWF4RGF0ZUhhc1RpbWUpID4gMCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICBpZiAoc2VsZi5jb25maWcuZW5hYmxlLmxlbmd0aCA9PT0gMCAmJiBzZWxmLmNvbmZpZy5kaXNhYmxlLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHRydWU7DQogICAgICAgIGlmIChkYXRlVG9DaGVjayA9PT0gdW5kZWZpbmVkKSByZXR1cm4gZmFsc2U7DQogICAgICAgIHZhciBib29sID0gc2VsZi5jb25maWcuZW5hYmxlLmxlbmd0aCA+IDAsDQogICAgICAgICAgICBhcnJheSA9IGJvb2wgPyBzZWxmLmNvbmZpZy5lbmFibGUgOiBzZWxmLmNvbmZpZy5kaXNhYmxlOw0KDQogICAgICAgIGZvciAodmFyIGkgPSAwLCBkOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICBkID0gYXJyYXlbaV07DQogICAgICAgICAgaWYgKHR5cGVvZiBkID09PSAiZnVuY3Rpb24iICYmIGQoZGF0ZVRvQ2hlY2spKSByZXR1cm4gYm9vbDtlbHNlIGlmIChkIGluc3RhbmNlb2YgRGF0ZSAmJiBkYXRlVG9DaGVjayAhPT0gdW5kZWZpbmVkICYmIGQuZ2V0VGltZSgpID09PSBkYXRlVG9DaGVjay5nZXRUaW1lKCkpIHJldHVybiBib29sO2Vsc2UgaWYgKHR5cGVvZiBkID09PSAic3RyaW5nIiAmJiBkYXRlVG9DaGVjayAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICB2YXIgcGFyc2VkID0gc2VsZi5wYXJzZURhdGUoZCwgdW5kZWZpbmVkLCB0cnVlKTsNCiAgICAgICAgICAgIHJldHVybiBwYXJzZWQgJiYgcGFyc2VkLmdldFRpbWUoKSA9PT0gZGF0ZVRvQ2hlY2suZ2V0VGltZSgpID8gYm9vbCA6ICFib29sOw0KICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGQgPT09ICJvYmplY3QiICYmIGRhdGVUb0NoZWNrICE9PSB1bmRlZmluZWQgJiYgZC5mcm9tICYmIGQudG8gJiYgZGF0ZVRvQ2hlY2suZ2V0VGltZSgpID49IGQuZnJvbS5nZXRUaW1lKCkgJiYgZGF0ZVRvQ2hlY2suZ2V0VGltZSgpIDw9IGQudG8uZ2V0VGltZSgpKSByZXR1cm4gYm9vbDsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAhYm9vbDsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gaXNJblZpZXcoZWxlbSkgew0KICAgICAgICBpZiAoc2VsZi5kYXlzQ29udGFpbmVyICE9PSB1bmRlZmluZWQpIHJldHVybiBlbGVtLmNsYXNzTmFtZS5pbmRleE9mKCJoaWRkZW4iKSA9PT0gLTEgJiYgc2VsZi5kYXlzQ29udGFpbmVyLmNvbnRhaW5zKGVsZW0pOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIG9uS2V5RG93bihlKSB7DQogICAgICAgIHZhciBpc0lucHV0ID0gZS50YXJnZXQgPT09IHNlbGYuX2lucHV0Ow0KICAgICAgICB2YXIgYWxsb3dJbnB1dCA9IHNlbGYuY29uZmlnLmFsbG93SW5wdXQ7DQogICAgICAgIHZhciBhbGxvd0tleWRvd24gPSBzZWxmLmlzT3BlbiAmJiAoIWFsbG93SW5wdXQgfHwgIWlzSW5wdXQpOw0KICAgICAgICB2YXIgYWxsb3dJbmxpbmVLZXlkb3duID0gc2VsZi5jb25maWcuaW5saW5lICYmIGlzSW5wdXQgJiYgIWFsbG93SW5wdXQ7DQoNCiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMgJiYgaXNJbnB1dCkgew0KICAgICAgICAgIGlmIChhbGxvd0lucHV0KSB7DQogICAgICAgICAgICBzZWxmLnNldERhdGUoc2VsZi5faW5wdXQudmFsdWUsIHRydWUsIGUudGFyZ2V0ID09PSBzZWxmLmFsdElucHV0ID8gc2VsZi5jb25maWcuYWx0Rm9ybWF0IDogc2VsZi5jb25maWcuZGF0ZUZvcm1hdCk7DQogICAgICAgICAgICByZXR1cm4gZS50YXJnZXQuYmx1cigpOw0KICAgICAgICAgIH0gZWxzZSBzZWxmLm9wZW4oKTsNCiAgICAgICAgfSBlbHNlIGlmIChpc0NhbGVuZGFyRWxlbShlLnRhcmdldCkgfHwgYWxsb3dLZXlkb3duIHx8IGFsbG93SW5saW5lS2V5ZG93bikgew0KICAgICAgICAgIHZhciBpc1RpbWVPYmogPSAhIXNlbGYudGltZUNvbnRhaW5lciAmJiBzZWxmLnRpbWVDb250YWluZXIuY29udGFpbnMoZS50YXJnZXQpOw0KDQogICAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHsNCiAgICAgICAgICAgIGNhc2UgMTM6DQogICAgICAgICAgICAgIGlmIChpc1RpbWVPYmopIHVwZGF0ZVRpbWUoKTtlbHNlIHNlbGVjdERhdGUoZSk7DQogICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIDI3Og0KICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgIGZvY3VzQW5kQ2xvc2UoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgODoNCiAgICAgICAgICAgIGNhc2UgNDY6DQogICAgICAgICAgICAgIGlmIChpc0lucHV0ICYmICFzZWxmLmNvbmZpZy5hbGxvd0lucHV0KSB7DQogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgICAgIHNlbGYuY2xlYXIoKTsNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIDM3Og0KICAgICAgICAgICAgY2FzZSAzOToNCiAgICAgICAgICAgICAgaWYgKCFpc1RpbWVPYmopIHsNCiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQoNCiAgICAgICAgICAgICAgICBpZiAoc2VsZi5kYXlzQ29udGFpbmVyICE9PSB1bmRlZmluZWQgJiYgKGFsbG93SW5wdXQgPT09IGZhbHNlIHx8IGlzSW5WaWV3KGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpKSkgew0KICAgICAgICAgICAgICAgICAgdmFyIF9kZWx0YSA9IGUua2V5Q29kZSA9PT0gMzkgPyAxIDogLTE7DQoNCiAgICAgICAgICAgICAgICAgIGlmICghZS5jdHJsS2V5KSBmb2N1c09uRGF5KHVuZGVmaW5lZCwgX2RlbHRhKTtlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY2hhbmdlTW9udGgoX2RlbHRhKTsNCiAgICAgICAgICAgICAgICAgICAgZm9jdXNPbkRheShnZXRGaXJzdEF2YWlsYWJsZURheSgxKSwgMCk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlbGYuaG91ckVsZW1lbnQpIHNlbGYuaG91ckVsZW1lbnQuZm9jdXMoKTsNCg0KICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSAzODoNCiAgICAgICAgICAgIGNhc2UgNDA6DQogICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgdmFyIGRlbHRhID0gZS5rZXlDb2RlID09PSA0MCA/IDEgOiAtMTsNCg0KICAgICAgICAgICAgICBpZiAoc2VsZi5kYXlzQ29udGFpbmVyKSB7DQogICAgICAgICAgICAgICAgaWYgKGUuY3RybEtleSkgew0KICAgICAgICAgICAgICAgICAgY2hhbmdlWWVhcihzZWxmLmN1cnJlbnRZZWFyIC0gZGVsdGEpOw0KICAgICAgICAgICAgICAgICAgZm9jdXNPbkRheShnZXRGaXJzdEF2YWlsYWJsZURheSgxKSwgMCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghaXNUaW1lT2JqKSBmb2N1c09uRGF5KHVuZGVmaW5lZCwgZGVsdGEgKiA3KTsNCiAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZWxmLmNvbmZpZy5lbmFibGVUaW1lKSB7DQogICAgICAgICAgICAgICAgaWYgKCFpc1RpbWVPYmogJiYgc2VsZi5ob3VyRWxlbWVudCkgc2VsZi5ob3VyRWxlbWVudC5mb2N1cygpOw0KICAgICAgICAgICAgICAgIHVwZGF0ZVRpbWUoZSk7DQoNCiAgICAgICAgICAgICAgICBzZWxmLl9kZWJvdW5jZWRDaGFuZ2UoKTsNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIDk6DQogICAgICAgICAgICAgIGlmICghaXNUaW1lT2JqKSBicmVhazsNCiAgICAgICAgICAgICAgdmFyIGVsZW1zID0gW3NlbGYuaG91ckVsZW1lbnQsIHNlbGYubWludXRlRWxlbWVudCwgc2VsZi5zZWNvbmRFbGVtZW50LCBzZWxmLmFtUE1dLmZpbHRlcihmdW5jdGlvbiAoeCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB4Ow0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgdmFyIGkgPSBlbGVtcy5pbmRleE9mKGUudGFyZ2V0KTsNCg0KICAgICAgICAgICAgICBpZiAoaSAhPT0gLTEpIHsNCiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZWxlbXNbaSArIChlLnNoaWZ0S2V5ID8gLTEgOiAxKV07DQoNCiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0ICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgICAgIHRhcmdldC5mb2N1cygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5hbVBNICE9PSB1bmRlZmluZWQgJiYgZS50YXJnZXQgPT09IHNlbGYuYW1QTSkgew0KICAgICAgICAgIHN3aXRjaCAoZS5rZXkpIHsNCiAgICAgICAgICAgIGNhc2Ugc2VsZi5sMTBuLmFtUE1bMF0uY2hhckF0KDApOg0KICAgICAgICAgICAgY2FzZSBzZWxmLmwxMG4uYW1QTVswXS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKToNCiAgICAgICAgICAgICAgc2VsZi5hbVBNLnRleHRDb250ZW50ID0gc2VsZi5sMTBuLmFtUE1bMF07DQogICAgICAgICAgICAgIHNldEhvdXJzRnJvbUlucHV0cygpOw0KICAgICAgICAgICAgICB1cGRhdGVWYWx1ZSgpOw0KICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBzZWxmLmwxMG4uYW1QTVsxXS5jaGFyQXQoMCk6DQogICAgICAgICAgICBjYXNlIHNlbGYubDEwbi5hbVBNWzFdLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpOg0KICAgICAgICAgICAgICBzZWxmLmFtUE0udGV4dENvbnRlbnQgPSBzZWxmLmwxMG4uYW1QTVsxXTsNCiAgICAgICAgICAgICAgc2V0SG91cnNGcm9tSW5wdXRzKCk7DQogICAgICAgICAgICAgIHVwZGF0ZVZhbHVlKCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHRyaWdnZXJFdmVudCgib25LZXlEb3duIiwgZSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIG9uTW91c2VPdmVyKGVsZW0pIHsNCiAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggIT09IDEgfHwgIWVsZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCJmbGF0cGlja3ItZGF5IikgfHwgZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoImRpc2FibGVkIikpIHJldHVybjsNCiAgICAgICAgdmFyIGhvdmVyRGF0ZSA9IGVsZW0uZGF0ZU9iai5nZXRUaW1lKCksDQogICAgICAgICAgICBpbml0aWFsRGF0ZSA9IHNlbGYucGFyc2VEYXRlKHNlbGYuc2VsZWN0ZWREYXRlc1swXSwgdW5kZWZpbmVkLCB0cnVlKS5nZXRUaW1lKCksDQogICAgICAgICAgICByYW5nZVN0YXJ0RGF0ZSA9IE1hdGgubWluKGhvdmVyRGF0ZSwgc2VsZi5zZWxlY3RlZERhdGVzWzBdLmdldFRpbWUoKSksDQogICAgICAgICAgICByYW5nZUVuZERhdGUgPSBNYXRoLm1heChob3ZlckRhdGUsIHNlbGYuc2VsZWN0ZWREYXRlc1swXS5nZXRUaW1lKCkpOw0KICAgICAgICB2YXIgY29udGFpbnNEaXNhYmxlZCA9IGZhbHNlOw0KICAgICAgICB2YXIgbWluUmFuZ2UgPSAwLA0KICAgICAgICAgICAgbWF4UmFuZ2UgPSAwOw0KDQogICAgICAgIGZvciAodmFyIHQgPSByYW5nZVN0YXJ0RGF0ZTsgdCA8IHJhbmdlRW5kRGF0ZTsgdCArPSBkdXJhdGlvbi5EQVkpIHsNCiAgICAgICAgICBpZiAoIWlzRW5hYmxlZChuZXcgRGF0ZSh0KSwgdHJ1ZSkpIHsNCiAgICAgICAgICAgIGNvbnRhaW5zRGlzYWJsZWQgPSBjb250YWluc0Rpc2FibGVkIHx8IHQgPiByYW5nZVN0YXJ0RGF0ZSAmJiB0IDwgcmFuZ2VFbmREYXRlOw0KICAgICAgICAgICAgaWYgKHQgPCBpbml0aWFsRGF0ZSAmJiAoIW1pblJhbmdlIHx8IHQgPiBtaW5SYW5nZSkpIG1pblJhbmdlID0gdDtlbHNlIGlmICh0ID4gaW5pdGlhbERhdGUgJiYgKCFtYXhSYW5nZSB8fCB0IDwgbWF4UmFuZ2UpKSBtYXhSYW5nZSA9IHQ7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBzZWxmLmNvbmZpZy5zaG93TW9udGhzOyBtKyspIHsNCiAgICAgICAgICB2YXIgbW9udGggPSBzZWxmLmRheXNDb250YWluZXIuY2hpbGRyZW5bbV07DQogICAgICAgICAgdmFyIHByZXZNb250aCA9IHNlbGYuZGF5c0NvbnRhaW5lci5jaGlsZHJlblttIC0gMV07DQoNCiAgICAgICAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcChpLCBsKSB7DQogICAgICAgICAgICB2YXIgZGF5RWxlbSA9IG1vbnRoLmNoaWxkcmVuW2ldLA0KICAgICAgICAgICAgICAgIGRhdGUgPSBkYXlFbGVtLmRhdGVPYmo7DQogICAgICAgICAgICB2YXIgdGltZXN0YW1wID0gZGF0ZS5nZXRUaW1lKCk7DQogICAgICAgICAgICB2YXIgb3V0T2ZSYW5nZSA9IG1pblJhbmdlID4gMCAmJiB0aW1lc3RhbXAgPCBtaW5SYW5nZSB8fCBtYXhSYW5nZSA+IDAgJiYgdGltZXN0YW1wID4gbWF4UmFuZ2U7DQoNCiAgICAgICAgICAgIGlmIChvdXRPZlJhbmdlKSB7DQogICAgICAgICAgICAgIGRheUVsZW0uY2xhc3NMaXN0LmFkZCgibm90QWxsb3dlZCIpOw0KICAgICAgICAgICAgICBbImluUmFuZ2UiLCAic3RhcnRSYW5nZSIsICJlbmRSYW5nZSJdLmZvckVhY2goZnVuY3Rpb24gKGMpIHsNCiAgICAgICAgICAgICAgICBkYXlFbGVtLmNsYXNzTGlzdC5yZW1vdmUoYyk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICByZXR1cm4gImNvbnRpbnVlIjsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGFpbnNEaXNhYmxlZCAmJiAhb3V0T2ZSYW5nZSkgcmV0dXJuICJjb250aW51ZSI7DQoNCiAgICAgICAgICAgIFsic3RhcnRSYW5nZSIsICJpblJhbmdlIiwgImVuZFJhbmdlIiwgIm5vdEFsbG93ZWQiXS5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7DQogICAgICAgICAgICAgIGRheUVsZW0uY2xhc3NMaXN0LnJlbW92ZShjKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKGhvdmVyRGF0ZSA8IHNlbGYuc2VsZWN0ZWREYXRlc1swXS5nZXRUaW1lKCkgPyAic3RhcnRSYW5nZSIgOiAiZW5kUmFuZ2UiKTsNCg0KICAgICAgICAgICAgaWYgKG1vbnRoLmNvbnRhaW5zKGVsZW0pIHx8ICEobSA+IDAgJiYgcHJldk1vbnRoICYmIHByZXZNb250aC5sYXN0Q2hpbGQuZGF0ZU9iai5nZXRUaW1lKCkgPj0gdGltZXN0YW1wKSkgew0KICAgICAgICAgICAgICBpZiAoaW5pdGlhbERhdGUgPCBob3ZlckRhdGUgJiYgdGltZXN0YW1wID09PSBpbml0aWFsRGF0ZSkgZGF5RWxlbS5jbGFzc0xpc3QuYWRkKCJzdGFydFJhbmdlIik7ZWxzZSBpZiAoaW5pdGlhbERhdGUgPiBob3ZlckRhdGUgJiYgdGltZXN0YW1wID09PSBpbml0aWFsRGF0ZSkgZGF5RWxlbS5jbGFzc0xpc3QuYWRkKCJlbmRSYW5nZSIpOw0KICAgICAgICAgICAgICBpZiAodGltZXN0YW1wID49IG1pblJhbmdlICYmIChtYXhSYW5nZSA9PT0gMCB8fCB0aW1lc3RhbXAgPD0gbWF4UmFuZ2UpICYmIGlzQmV0d2Vlbih0aW1lc3RhbXAsIGluaXRpYWxEYXRlLCBob3ZlckRhdGUpKSBkYXlFbGVtLmNsYXNzTGlzdC5hZGQoImluUmFuZ2UiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBtb250aC5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsNCiAgICAgICAgICAgIHZhciBfcmV0ID0gX2xvb3AoaSwgbCk7DQoNCiAgICAgICAgICAgIGlmIChfcmV0ID09PSAiY29udGludWUiKSBjb250aW51ZTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gb25SZXNpemUoKSB7DQogICAgICAgIGlmIChzZWxmLmlzT3BlbiAmJiAhc2VsZi5jb25maWcuc3RhdGljICYmICFzZWxmLmNvbmZpZy5pbmxpbmUpIHBvc2l0aW9uQ2FsZW5kYXIoKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gb3BlbihlLCBwb3NpdGlvbkVsZW1lbnQpIHsNCiAgICAgICAgaWYgKHBvc2l0aW9uRWxlbWVudCA9PT0gdm9pZCAwKSB7DQogICAgICAgICAgcG9zaXRpb25FbGVtZW50ID0gc2VsZi5faW5wdXQ7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5pc01vYmlsZSA9PT0gdHJ1ZSkgew0KICAgICAgICAgIGlmIChlKSB7DQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBlLnRhcmdldCAmJiBlLnRhcmdldC5ibHVyKCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBzZWxmLm1vYmlsZUlucHV0ICE9PSB1bmRlZmluZWQgJiYgc2VsZi5tb2JpbGVJbnB1dC5mb2N1cygpOw0KICAgICAgICAgIH0sIDApOw0KICAgICAgICAgIHRyaWdnZXJFdmVudCgib25PcGVuIik7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYuX2lucHV0LmRpc2FibGVkIHx8IHNlbGYuY29uZmlnLmlubGluZSkgcmV0dXJuOw0KICAgICAgICB2YXIgd2FzT3BlbiA9IHNlbGYuaXNPcGVuOw0KICAgICAgICBzZWxmLmlzT3BlbiA9IHRydWU7DQoNCiAgICAgICAgaWYgKCF3YXNPcGVuKSB7DQogICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJvcGVuIik7DQoNCiAgICAgICAgICBzZWxmLl9pbnB1dC5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsNCg0KICAgICAgICAgIHRyaWdnZXJFdmVudCgib25PcGVuIik7DQogICAgICAgICAgcG9zaXRpb25DYWxlbmRhcihwb3NpdGlvbkVsZW1lbnQpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmVuYWJsZVRpbWUgPT09IHRydWUgJiYgc2VsZi5jb25maWcubm9DYWxlbmRhciA9PT0gdHJ1ZSkgew0KICAgICAgICAgIGlmIChzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICBzZWxmLnNldERhdGUoc2VsZi5jb25maWcubWluRGF0ZSAhPT0gdW5kZWZpbmVkID8gbmV3IERhdGUoc2VsZi5jb25maWcubWluRGF0ZS5nZXRUaW1lKCkpIDogbmV3IERhdGUoKSwgZmFsc2UpOw0KICAgICAgICAgICAgc2V0RGVmYXVsdEhvdXJzKCk7DQogICAgICAgICAgICB1cGRhdGVWYWx1ZSgpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmIChzZWxmLmNvbmZpZy5hbGxvd0lucHV0ID09PSBmYWxzZSAmJiAoZSA9PT0gdW5kZWZpbmVkIHx8ICFzZWxmLnRpbWVDb250YWluZXIuY29udGFpbnMoZS5yZWxhdGVkVGFyZ2V0KSkpIHsNCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICByZXR1cm4gc2VsZi5ob3VyRWxlbWVudC5zZWxlY3QoKTsNCiAgICAgICAgICAgIH0sIDUwKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gbWluTWF4RGF0ZVNldHRlcih0eXBlKSB7DQogICAgICAgIHJldHVybiBmdW5jdGlvbiAoZGF0ZSkgew0KICAgICAgICAgIHZhciBkYXRlT2JqID0gc2VsZi5jb25maWdbIl8iICsgdHlwZSArICJEYXRlIl0gPSBzZWxmLnBhcnNlRGF0ZShkYXRlLCBzZWxmLmNvbmZpZy5kYXRlRm9ybWF0KTsNCiAgICAgICAgICB2YXIgaW52ZXJzZURhdGVPYmogPSBzZWxmLmNvbmZpZ1siXyIgKyAodHlwZSA9PT0gIm1pbiIgPyAibWF4IiA6ICJtaW4iKSArICJEYXRlIl07DQoNCiAgICAgICAgICBpZiAoZGF0ZU9iaiAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBzZWxmW3R5cGUgPT09ICJtaW4iID8gIm1pbkRhdGVIYXNUaW1lIiA6ICJtYXhEYXRlSGFzVGltZSJdID0gZGF0ZU9iai5nZXRIb3VycygpID4gMCB8fCBkYXRlT2JqLmdldE1pbnV0ZXMoKSA+IDAgfHwgZGF0ZU9iai5nZXRTZWNvbmRzKCkgPiAwOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmIChzZWxmLnNlbGVjdGVkRGF0ZXMpIHsNCiAgICAgICAgICAgIHNlbGYuc2VsZWN0ZWREYXRlcyA9IHNlbGYuc2VsZWN0ZWREYXRlcy5maWx0ZXIoZnVuY3Rpb24gKGQpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGlzRW5hYmxlZChkKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgaWYgKCFzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoICYmIHR5cGUgPT09ICJtaW4iKSBzZXRIb3Vyc0Zyb21EYXRlKGRhdGVPYmopOw0KICAgICAgICAgICAgdXBkYXRlVmFsdWUoKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpZiAoc2VsZi5kYXlzQ29udGFpbmVyKSB7DQogICAgICAgICAgICByZWRyYXcoKTsNCiAgICAgICAgICAgIGlmIChkYXRlT2JqICE9PSB1bmRlZmluZWQpIHNlbGYuY3VycmVudFllYXJFbGVtZW50W3R5cGVdID0gZGF0ZU9iai5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCk7ZWxzZSBzZWxmLmN1cnJlbnRZZWFyRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUodHlwZSk7DQogICAgICAgICAgICBzZWxmLmN1cnJlbnRZZWFyRWxlbWVudC5kaXNhYmxlZCA9ICEhaW52ZXJzZURhdGVPYmogJiYgZGF0ZU9iaiAhPT0gdW5kZWZpbmVkICYmIGludmVyc2VEYXRlT2JqLmdldEZ1bGxZZWFyKCkgPT09IGRhdGVPYmouZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHBhcnNlQ29uZmlnKCkgew0KICAgICAgICB2YXIgYm9vbE9wdHMgPSBbIndyYXAiLCAid2Vla051bWJlcnMiLCAiYWxsb3dJbnB1dCIsICJjbGlja09wZW5zIiwgInRpbWVfMjRociIsICJlbmFibGVUaW1lIiwgIm5vQ2FsZW5kYXIiLCAiYWx0SW5wdXQiLCAic2hvcnRoYW5kQ3VycmVudE1vbnRoIiwgImlubGluZSIsICJzdGF0aWMiLCAiZW5hYmxlU2Vjb25kcyIsICJkaXNhYmxlTW9iaWxlIl07DQogICAgICAgIHZhciBob29rcyA9IFsib25DaGFuZ2UiLCAib25DbG9zZSIsICJvbkRheUNyZWF0ZSIsICJvbkRlc3Ryb3kiLCAib25LZXlEb3duIiwgIm9uTW9udGhDaGFuZ2UiLCAib25PcGVuIiwgIm9uUGFyc2VDb25maWciLCAib25SZWFkeSIsICJvblZhbHVlVXBkYXRlIiwgIm9uWWVhckNoYW5nZSIsICJvblByZUNhbGVuZGFyUG9zaXRpb24iXTsNCiAgICAgICAgdmFyIHVzZXJDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBpbnN0YW5jZUNvbmZpZywgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShlbGVtZW50LmRhdGFzZXQgfHwge30pKSk7DQogICAgICAgIHZhciBmb3JtYXRzJCQxID0ge307DQogICAgICAgIHNlbGYuY29uZmlnLnBhcnNlRGF0ZSA9IHVzZXJDb25maWcucGFyc2VEYXRlOw0KICAgICAgICBzZWxmLmNvbmZpZy5mb3JtYXREYXRlID0gdXNlckNvbmZpZy5mb3JtYXREYXRlOw0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5jb25maWcsICJlbmFibGUiLCB7DQogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcuX2VuYWJsZTsNCiAgICAgICAgICB9LA0KICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGRhdGVzKSB7DQogICAgICAgICAgICBzZWxmLmNvbmZpZy5fZW5hYmxlID0gcGFyc2VEYXRlUnVsZXMoZGF0ZXMpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLmNvbmZpZywgImRpc2FibGUiLCB7DQogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcuX2Rpc2FibGU7DQogICAgICAgICAgfSwNCiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChkYXRlcykgew0KICAgICAgICAgICAgc2VsZi5jb25maWcuX2Rpc2FibGUgPSBwYXJzZURhdGVSdWxlcyhkYXRlcyk7DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgdmFyIHRpbWVNb2RlID0gdXNlckNvbmZpZy5tb2RlID09PSAidGltZSI7DQoNCiAgICAgICAgaWYgKCF1c2VyQ29uZmlnLmRhdGVGb3JtYXQgJiYgKHVzZXJDb25maWcuZW5hYmxlVGltZSB8fCB0aW1lTW9kZSkpIHsNCiAgICAgICAgICBmb3JtYXRzJCQxLmRhdGVGb3JtYXQgPSB1c2VyQ29uZmlnLm5vQ2FsZW5kYXIgfHwgdGltZU1vZGUgPyAiSDppIiArICh1c2VyQ29uZmlnLmVuYWJsZVNlY29uZHMgPyAiOlMiIDogIiIpIDogZmxhdHBpY2tyLmRlZmF1bHRDb25maWcuZGF0ZUZvcm1hdCArICIgSDppIiArICh1c2VyQ29uZmlnLmVuYWJsZVNlY29uZHMgPyAiOlMiIDogIiIpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHVzZXJDb25maWcuYWx0SW5wdXQgJiYgKHVzZXJDb25maWcuZW5hYmxlVGltZSB8fCB0aW1lTW9kZSkgJiYgIXVzZXJDb25maWcuYWx0Rm9ybWF0KSB7DQogICAgICAgICAgZm9ybWF0cyQkMS5hbHRGb3JtYXQgPSB1c2VyQ29uZmlnLm5vQ2FsZW5kYXIgfHwgdGltZU1vZGUgPyAiaDppIiArICh1c2VyQ29uZmlnLmVuYWJsZVNlY29uZHMgPyAiOlMgSyIgOiAiIEsiKSA6IGZsYXRwaWNrci5kZWZhdWx0Q29uZmlnLmFsdEZvcm1hdCArICgiIGg6aSIgKyAodXNlckNvbmZpZy5lbmFibGVTZWNvbmRzID8gIjpTIiA6ICIiKSArICIgSyIpOw0KICAgICAgICB9DQoNCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYuY29uZmlnLCAibWluRGF0ZSIsIHsNCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5fbWluRGF0ZTsNCiAgICAgICAgICB9LA0KICAgICAgICAgIHNldDogbWluTWF4RGF0ZVNldHRlcigibWluIikNCiAgICAgICAgfSk7DQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLmNvbmZpZywgIm1heERhdGUiLCB7DQogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcuX21heERhdGU7DQogICAgICAgICAgfSwNCiAgICAgICAgICBzZXQ6IG1pbk1heERhdGVTZXR0ZXIoIm1heCIpDQogICAgICAgIH0pOw0KDQogICAgICAgIHZhciBtaW5NYXhUaW1lU2V0dGVyID0gZnVuY3Rpb24gbWluTWF4VGltZVNldHRlcih0eXBlKSB7DQogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWwpIHsNCiAgICAgICAgICAgIHNlbGYuY29uZmlnW3R5cGUgPT09ICJtaW4iID8gIl9taW5UaW1lIiA6ICJfbWF4VGltZSJdID0gc2VsZi5wYXJzZURhdGUodmFsLCAiSDppIik7DQogICAgICAgICAgfTsNCiAgICAgICAgfTsNCg0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5jb25maWcsICJtaW5UaW1lIiwgew0KICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLl9taW5UaW1lOw0KICAgICAgICAgIH0sDQogICAgICAgICAgc2V0OiBtaW5NYXhUaW1lU2V0dGVyKCJtaW4iKQ0KICAgICAgICB9KTsNCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYuY29uZmlnLCAibWF4VGltZSIsIHsNCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5fbWF4VGltZTsNCiAgICAgICAgICB9LA0KICAgICAgICAgIHNldDogbWluTWF4VGltZVNldHRlcigibWF4IikNCiAgICAgICAgfSk7DQoNCiAgICAgICAgaWYgKHVzZXJDb25maWcubW9kZSA9PT0gInRpbWUiKSB7DQogICAgICAgICAgc2VsZi5jb25maWcubm9DYWxlbmRhciA9IHRydWU7DQogICAgICAgICAgc2VsZi5jb25maWcuZW5hYmxlVGltZSA9IHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICBPYmplY3QuYXNzaWduKHNlbGYuY29uZmlnLCBmb3JtYXRzJCQxLCB1c2VyQ29uZmlnKTsNCg0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJvb2xPcHRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgc2VsZi5jb25maWdbYm9vbE9wdHNbaV1dID0gc2VsZi5jb25maWdbYm9vbE9wdHNbaV1dID09PSB0cnVlIHx8IHNlbGYuY29uZmlnW2Jvb2xPcHRzW2ldXSA9PT0gInRydWUiOw0KICAgICAgICB9DQoNCiAgICAgICAgZm9yICh2YXIgX2kgPSBob29rcy5sZW5ndGg7IF9pLS07KSB7DQogICAgICAgICAgaWYgKHNlbGYuY29uZmlnW2hvb2tzW19pXV0gIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgc2VsZi5jb25maWdbaG9va3NbX2ldXSA9IGFycmF5aWZ5KHNlbGYuY29uZmlnW2hvb2tzW19pXV0gfHwgW10pLm1hcChiaW5kVG9JbnN0YW5jZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgc2VsZi5pc01vYmlsZSA9ICFzZWxmLmNvbmZpZy5kaXNhYmxlTW9iaWxlICYmICFzZWxmLmNvbmZpZy5pbmxpbmUgJiYgc2VsZi5jb25maWcubW9kZSA9PT0gInNpbmdsZSIgJiYgIXNlbGYuY29uZmlnLmRpc2FibGUubGVuZ3RoICYmICFzZWxmLmNvbmZpZy5lbmFibGUubGVuZ3RoICYmICFzZWxmLmNvbmZpZy53ZWVrTnVtYmVycyAmJiAvQW5kcm9pZHx3ZWJPU3xpUGhvbmV8aVBhZHxpUG9kfEJsYWNrQmVycnl8SUVNb2JpbGV8T3BlcmEgTWluaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7DQoNCiAgICAgICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgc2VsZi5jb25maWcucGx1Z2lucy5sZW5ndGg7IF9pMisrKSB7DQogICAgICAgICAgdmFyIHBsdWdpbkNvbmYgPSBzZWxmLmNvbmZpZy5wbHVnaW5zW19pMl0oc2VsZikgfHwge307DQoNCiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gcGx1Z2luQ29uZikgew0KICAgICAgICAgICAgaWYgKH5ob29rcy5pbmRleE9mKGtleSkpIHsNCiAgICAgICAgICAgICAgc2VsZi5jb25maWdba2V5XSA9IGFycmF5aWZ5KHBsdWdpbkNvbmZba2V5XSkubWFwKGJpbmRUb0luc3RhbmNlKS5jb25jYXQoc2VsZi5jb25maWdba2V5XSk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB1c2VyQ29uZmlnW2tleV0gPT09ICJ1bmRlZmluZWQiKSBzZWxmLmNvbmZpZ1trZXldID0gcGx1Z2luQ29uZltrZXldOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHRyaWdnZXJFdmVudCgib25QYXJzZUNvbmZpZyIpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzZXR1cExvY2FsZSgpIHsNCiAgICAgICAgaWYgKHR5cGVvZiBzZWxmLmNvbmZpZy5sb2NhbGUgIT09ICJvYmplY3QiICYmIHR5cGVvZiBmbGF0cGlja3IubDEwbnNbc2VsZi5jb25maWcubG9jYWxlXSA9PT0gInVuZGVmaW5lZCIpIHNlbGYuY29uZmlnLmVycm9ySGFuZGxlcihuZXcgRXJyb3IoImZsYXRwaWNrcjogaW52YWxpZCBsb2NhbGUgIiArIHNlbGYuY29uZmlnLmxvY2FsZSkpOw0KICAgICAgICBzZWxmLmwxMG4gPSBPYmplY3QuYXNzaWduKHt9LCBmbGF0cGlja3IubDEwbnMuZGVmYXVsdCwgdHlwZW9mIHNlbGYuY29uZmlnLmxvY2FsZSA9PT0gIm9iamVjdCIgPyBzZWxmLmNvbmZpZy5sb2NhbGUgOiBzZWxmLmNvbmZpZy5sb2NhbGUgIT09ICJkZWZhdWx0IiA/IGZsYXRwaWNrci5sMTBuc1tzZWxmLmNvbmZpZy5sb2NhbGVdIDogdW5kZWZpbmVkKTsNCiAgICAgICAgdG9rZW5SZWdleC5LID0gIigiICsgc2VsZi5sMTBuLmFtUE1bMF0gKyAifCIgKyBzZWxmLmwxMG4uYW1QTVsxXSArICJ8IiArIHNlbGYubDEwbi5hbVBNWzBdLnRvTG93ZXJDYXNlKCkgKyAifCIgKyBzZWxmLmwxMG4uYW1QTVsxXS50b0xvd2VyQ2FzZSgpICsgIikiOw0KICAgICAgICBzZWxmLmZvcm1hdERhdGUgPSBjcmVhdGVEYXRlRm9ybWF0dGVyKHNlbGYpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBwb3NpdGlvbkNhbGVuZGFyKGN1c3RvbVBvc2l0aW9uRWxlbWVudCkgew0KICAgICAgICBpZiAoc2VsZi5jYWxlbmRhckNvbnRhaW5lciA9PT0gdW5kZWZpbmVkKSByZXR1cm47DQogICAgICAgIHRyaWdnZXJFdmVudCgib25QcmVDYWxlbmRhclBvc2l0aW9uIik7DQogICAgICAgIHZhciBwb3NpdGlvbkVsZW1lbnQgPSBjdXN0b21Qb3NpdGlvbkVsZW1lbnQgfHwgc2VsZi5fcG9zaXRpb25FbGVtZW50Ow0KICAgICAgICB2YXIgY2FsZW5kYXJIZWlnaHQgPSBBcnJheS5wcm90b3R5cGUucmVkdWNlLmNhbGwoc2VsZi5jYWxlbmRhckNvbnRhaW5lci5jaGlsZHJlbiwgZnVuY3Rpb24gKGFjYywgY2hpbGQpIHsNCiAgICAgICAgICByZXR1cm4gYWNjICsgY2hpbGQub2Zmc2V0SGVpZ2h0Ow0KICAgICAgICB9LCAwKSwNCiAgICAgICAgICAgIGNhbGVuZGFyV2lkdGggPSBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLm9mZnNldFdpZHRoLA0KICAgICAgICAgICAgY29uZmlnUG9zID0gc2VsZi5jb25maWcucG9zaXRpb24uc3BsaXQoIiAiKSwNCiAgICAgICAgICAgIGNvbmZpZ1Bvc1ZlcnRpY2FsID0gY29uZmlnUG9zWzBdLA0KICAgICAgICAgICAgY29uZmlnUG9zSG9yaXpvbnRhbCA9IGNvbmZpZ1Bvcy5sZW5ndGggPiAxID8gY29uZmlnUG9zWzFdIDogbnVsbCwNCiAgICAgICAgICAgIGlucHV0Qm91bmRzID0gcG9zaXRpb25FbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLA0KICAgICAgICAgICAgZGlzdGFuY2VGcm9tQm90dG9tID0gd2luZG93LmlubmVySGVpZ2h0IC0gaW5wdXRCb3VuZHMuYm90dG9tLA0KICAgICAgICAgICAgc2hvd09uVG9wID0gY29uZmlnUG9zVmVydGljYWwgPT09ICJhYm92ZSIgfHwgY29uZmlnUG9zVmVydGljYWwgIT09ICJiZWxvdyIgJiYgZGlzdGFuY2VGcm9tQm90dG9tIDwgY2FsZW5kYXJIZWlnaHQgJiYgaW5wdXRCb3VuZHMudG9wID4gY2FsZW5kYXJIZWlnaHQ7DQogICAgICAgIHZhciB0b3AgPSB3aW5kb3cucGFnZVlPZmZzZXQgKyBpbnB1dEJvdW5kcy50b3AgKyAoIXNob3dPblRvcCA/IHBvc2l0aW9uRWxlbWVudC5vZmZzZXRIZWlnaHQgKyAyIDogLWNhbGVuZGFySGVpZ2h0IC0gMik7DQogICAgICAgIHRvZ2dsZUNsYXNzKHNlbGYuY2FsZW5kYXJDb250YWluZXIsICJhcnJvd1RvcCIsICFzaG93T25Ub3ApOw0KICAgICAgICB0b2dnbGVDbGFzcyhzZWxmLmNhbGVuZGFyQ29udGFpbmVyLCAiYXJyb3dCb3R0b20iLCBzaG93T25Ub3ApOw0KICAgICAgICBpZiAoc2VsZi5jb25maWcuaW5saW5lKSByZXR1cm47DQogICAgICAgIHZhciBsZWZ0ID0gd2luZG93LnBhZ2VYT2Zmc2V0ICsgaW5wdXRCb3VuZHMubGVmdCAtIChjb25maWdQb3NIb3Jpem9udGFsICE9IG51bGwgJiYgY29uZmlnUG9zSG9yaXpvbnRhbCA9PT0gImNlbnRlciIgPyAoY2FsZW5kYXJXaWR0aCAtIGlucHV0Qm91bmRzLndpZHRoKSAvIDIgOiAwKTsNCiAgICAgICAgdmFyIHJpZ2h0ID0gd2luZG93LmRvY3VtZW50LmJvZHkub2Zmc2V0V2lkdGggLSBpbnB1dEJvdW5kcy5yaWdodDsNCiAgICAgICAgdmFyIHJpZ2h0TW9zdCA9IGxlZnQgKyBjYWxlbmRhcldpZHRoID4gd2luZG93LmRvY3VtZW50LmJvZHkub2Zmc2V0V2lkdGg7DQogICAgICAgIHRvZ2dsZUNsYXNzKHNlbGYuY2FsZW5kYXJDb250YWluZXIsICJyaWdodE1vc3QiLCByaWdodE1vc3QpOw0KICAgICAgICBpZiAoc2VsZi5jb25maWcuc3RhdGljKSByZXR1cm47DQogICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuc3R5bGUudG9wID0gdG9wICsgInB4IjsNCg0KICAgICAgICBpZiAoIXJpZ2h0TW9zdCkgew0KICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuc3R5bGUubGVmdCA9IGxlZnQgKyAicHgiOw0KICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuc3R5bGUucmlnaHQgPSAiYXV0byI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gImF1dG8iOw0KICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuc3R5bGUucmlnaHQgPSByaWdodCArICJweCI7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gcmVkcmF3KCkgew0KICAgICAgICBpZiAoc2VsZi5jb25maWcubm9DYWxlbmRhciB8fCBzZWxmLmlzTW9iaWxlKSByZXR1cm47DQogICAgICAgIHVwZGF0ZU5hdmlnYXRpb25DdXJyZW50TW9udGgoKTsNCiAgICAgICAgYnVpbGREYXlzKCk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGZvY3VzQW5kQ2xvc2UoKSB7DQogICAgICAgIHNlbGYuX2lucHV0LmZvY3VzKCk7DQoNCiAgICAgICAgaWYgKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIk1TSUUiKSAhPT0gLTEgfHwgbmF2aWdhdG9yLm1zTWF4VG91Y2hQb2ludHMgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgIHNldFRpbWVvdXQoc2VsZi5jbG9zZSwgMCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgc2VsZi5jbG9zZSgpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHNlbGVjdERhdGUoZSkgew0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQoNCiAgICAgICAgdmFyIGlzU2VsZWN0YWJsZSA9IGZ1bmN0aW9uIGlzU2VsZWN0YWJsZShkYXkpIHsNCiAgICAgICAgICByZXR1cm4gZGF5LmNsYXNzTGlzdCAmJiBkYXkuY2xhc3NMaXN0LmNvbnRhaW5zKCJmbGF0cGlja3ItZGF5IikgJiYgIWRheS5jbGFzc0xpc3QuY29udGFpbnMoImRpc2FibGVkIikgJiYgIWRheS5jbGFzc0xpc3QuY29udGFpbnMoIm5vdEFsbG93ZWQiKTsNCiAgICAgICAgfTsNCg0KICAgICAgICB2YXIgdCA9IGZpbmRQYXJlbnQoZS50YXJnZXQsIGlzU2VsZWN0YWJsZSk7DQogICAgICAgIGlmICh0ID09PSB1bmRlZmluZWQpIHJldHVybjsNCiAgICAgICAgdmFyIHRhcmdldCA9IHQ7DQogICAgICAgIHZhciBzZWxlY3RlZERhdGUgPSBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiA9IG5ldyBEYXRlKHRhcmdldC5kYXRlT2JqLmdldFRpbWUoKSk7DQogICAgICAgIHZhciBzaG91bGRDaGFuZ2VNb250aCA9IChzZWxlY3RlZERhdGUuZ2V0TW9udGgoKSA8IHNlbGYuY3VycmVudE1vbnRoIHx8IHNlbGVjdGVkRGF0ZS5nZXRNb250aCgpID4gc2VsZi5jdXJyZW50TW9udGggKyBzZWxmLmNvbmZpZy5zaG93TW9udGhzIC0gMSkgJiYgc2VsZi5jb25maWcubW9kZSAhPT0gInJhbmdlIjsNCiAgICAgICAgc2VsZi5zZWxlY3RlZERhdGVFbGVtID0gdGFyZ2V0Ow0KICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInNpbmdsZSIpIHNlbGYuc2VsZWN0ZWREYXRlcyA9IFtzZWxlY3RlZERhdGVdO2Vsc2UgaWYgKHNlbGYuY29uZmlnLm1vZGUgPT09ICJtdWx0aXBsZSIpIHsNCiAgICAgICAgICB2YXIgc2VsZWN0ZWRJbmRleCA9IGlzRGF0ZVNlbGVjdGVkKHNlbGVjdGVkRGF0ZSk7DQogICAgICAgICAgaWYgKHNlbGVjdGVkSW5kZXgpIHNlbGYuc2VsZWN0ZWREYXRlcy5zcGxpY2UocGFyc2VJbnQoc2VsZWN0ZWRJbmRleCksIDEpO2Vsc2Ugc2VsZi5zZWxlY3RlZERhdGVzLnB1c2goc2VsZWN0ZWREYXRlKTsNCiAgICAgICAgfSBlbHNlIGlmIChzZWxmLmNvbmZpZy5tb2RlID09PSAicmFuZ2UiKSB7DQogICAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPT09IDIpIHNlbGYuY2xlYXIoZmFsc2UpOw0KICAgICAgICAgIHNlbGYuc2VsZWN0ZWREYXRlcy5wdXNoKHNlbGVjdGVkRGF0ZSk7DQogICAgICAgICAgaWYgKGNvbXBhcmVEYXRlcyhzZWxlY3RlZERhdGUsIHNlbGYuc2VsZWN0ZWREYXRlc1swXSwgdHJ1ZSkgIT09IDApIHNlbGYuc2VsZWN0ZWREYXRlcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7DQogICAgICAgICAgICByZXR1cm4gYS5nZXRUaW1lKCkgLSBiLmdldFRpbWUoKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBzZXRIb3Vyc0Zyb21JbnB1dHMoKTsNCg0KICAgICAgICBpZiAoc2hvdWxkQ2hhbmdlTW9udGgpIHsNCiAgICAgICAgICB2YXIgaXNOZXdZZWFyID0gc2VsZi5jdXJyZW50WWVhciAhPT0gc2VsZWN0ZWREYXRlLmdldEZ1bGxZZWFyKCk7DQogICAgICAgICAgc2VsZi5jdXJyZW50WWVhciA9IHNlbGVjdGVkRGF0ZS5nZXRGdWxsWWVhcigpOw0KICAgICAgICAgIHNlbGYuY3VycmVudE1vbnRoID0gc2VsZWN0ZWREYXRlLmdldE1vbnRoKCk7DQogICAgICAgICAgaWYgKGlzTmV3WWVhcikgdHJpZ2dlckV2ZW50KCJvblllYXJDaGFuZ2UiKTsNCiAgICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uTW9udGhDaGFuZ2UiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHVwZGF0ZU5hdmlnYXRpb25DdXJyZW50TW9udGgoKTsNCiAgICAgICAgYnVpbGREYXlzKCk7DQogICAgICAgIHNldERlZmF1bHRIb3VycygpOw0KICAgICAgICB1cGRhdGVWYWx1ZSgpOw0KICAgICAgICBpZiAoc2VsZi5jb25maWcuZW5hYmxlVGltZSkgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgcmV0dXJuIHNlbGYuc2hvd1RpbWVJbnB1dCA9IHRydWU7DQogICAgICAgIH0sIDUwKTsNCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIikgew0KICAgICAgICAgIGlmIChzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID09PSAxKSB7DQogICAgICAgICAgICBvbk1vdXNlT3Zlcih0YXJnZXQpOw0KICAgICAgICAgIH0gZWxzZSB1cGRhdGVOYXZpZ2F0aW9uQ3VycmVudE1vbnRoKCk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIXNob3VsZENoYW5nZU1vbnRoICYmIHNlbGYuY29uZmlnLm1vZGUgIT09ICJyYW5nZSIgJiYgc2VsZi5jb25maWcuc2hvd01vbnRocyA9PT0gMSkgZm9jdXNPbkRheUVsZW0odGFyZ2V0KTtlbHNlIHNlbGYuc2VsZWN0ZWREYXRlRWxlbSAmJiBzZWxmLnNlbGVjdGVkRGF0ZUVsZW0uZm9jdXMoKTsNCiAgICAgICAgaWYgKHNlbGYuaG91ckVsZW1lbnQgIT09IHVuZGVmaW5lZCkgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgcmV0dXJuIHNlbGYuaG91ckVsZW1lbnQgIT09IHVuZGVmaW5lZCAmJiBzZWxmLmhvdXJFbGVtZW50LnNlbGVjdCgpOw0KICAgICAgICB9LCA0NTEpOw0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5jbG9zZU9uU2VsZWN0KSB7DQogICAgICAgICAgdmFyIHNpbmdsZSA9IHNlbGYuY29uZmlnLm1vZGUgPT09ICJzaW5nbGUiICYmICFzZWxmLmNvbmZpZy5lbmFibGVUaW1lOw0KICAgICAgICAgIHZhciByYW5nZSA9IHNlbGYuY29uZmlnLm1vZGUgPT09ICJyYW5nZSIgJiYgc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA9PT0gMiAmJiAhc2VsZi5jb25maWcuZW5hYmxlVGltZTsNCg0KICAgICAgICAgIGlmIChzaW5nbGUgfHwgcmFuZ2UpIHsNCiAgICAgICAgICAgIGZvY3VzQW5kQ2xvc2UoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICB0cmlnZ2VyQ2hhbmdlKCk7DQogICAgICB9DQoNCiAgICAgIHZhciBDQUxMQkFDS1MgPSB7DQogICAgICAgIGxvY2FsZTogW3NldHVwTG9jYWxlLCB1cGRhdGVXZWVrZGF5c10sDQogICAgICAgIHNob3dNb250aHM6IFtidWlsZE1vbnRocywgc2V0Q2FsZW5kYXJXaWR0aCwgYnVpbGRXZWVrZGF5c10NCiAgICAgIH07DQoNCiAgICAgIGZ1bmN0aW9uIHNldChvcHRpb24sIHZhbHVlKSB7DQogICAgICAgIGlmIChvcHRpb24gIT09IG51bGwgJiYgdHlwZW9mIG9wdGlvbiA9PT0gIm9iamVjdCIpIE9iamVjdC5hc3NpZ24oc2VsZi5jb25maWcsIG9wdGlvbik7ZWxzZSB7DQogICAgICAgICAgc2VsZi5jb25maWdbb3B0aW9uXSA9IHZhbHVlOw0KICAgICAgICAgIGlmIChDQUxMQkFDS1Nbb3B0aW9uXSAhPT0gdW5kZWZpbmVkKSBDQUxMQkFDS1Nbb3B0aW9uXS5mb3JFYWNoKGZ1bmN0aW9uICh4KSB7DQogICAgICAgICAgICByZXR1cm4geCgpOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIHNlbGYucmVkcmF3KCk7DQogICAgICAgIGp1bXBUb0RhdGUoKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gc2V0U2VsZWN0ZWREYXRlKGlucHV0RGF0ZSwgZm9ybWF0KSB7DQogICAgICAgIHZhciBkYXRlcyA9IFtdOw0KICAgICAgICBpZiAoaW5wdXREYXRlIGluc3RhbmNlb2YgQXJyYXkpIGRhdGVzID0gaW5wdXREYXRlLm1hcChmdW5jdGlvbiAoZCkgew0KICAgICAgICAgIHJldHVybiBzZWxmLnBhcnNlRGF0ZShkLCBmb3JtYXQpOw0KICAgICAgICB9KTtlbHNlIGlmIChpbnB1dERhdGUgaW5zdGFuY2VvZiBEYXRlIHx8IHR5cGVvZiBpbnB1dERhdGUgPT09ICJudW1iZXIiKSBkYXRlcyA9IFtzZWxmLnBhcnNlRGF0ZShpbnB1dERhdGUsIGZvcm1hdCldO2Vsc2UgaWYgKHR5cGVvZiBpbnB1dERhdGUgPT09ICJzdHJpbmciKSB7DQogICAgICAgICAgc3dpdGNoIChzZWxmLmNvbmZpZy5tb2RlKSB7DQogICAgICAgICAgICBjYXNlICJzaW5nbGUiOg0KICAgICAgICAgICAgY2FzZSAidGltZSI6DQogICAgICAgICAgICAgIGRhdGVzID0gW3NlbGYucGFyc2VEYXRlKGlucHV0RGF0ZSwgZm9ybWF0KV07DQogICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlICJtdWx0aXBsZSI6DQogICAgICAgICAgICAgIGRhdGVzID0gaW5wdXREYXRlLnNwbGl0KHNlbGYuY29uZmlnLmNvbmp1bmN0aW9uKS5tYXAoZnVuY3Rpb24gKGRhdGUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5wYXJzZURhdGUoZGF0ZSwgZm9ybWF0KTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlICJyYW5nZSI6DQogICAgICAgICAgICAgIGRhdGVzID0gaW5wdXREYXRlLnNwbGl0KHNlbGYubDEwbi5yYW5nZVNlcGFyYXRvcikubWFwKGZ1bmN0aW9uIChkYXRlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucGFyc2VEYXRlKGRhdGUsIGZvcm1hdCk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugc2VsZi5jb25maWcuZXJyb3JIYW5kbGVyKG5ldyBFcnJvcigiSW52YWxpZCBkYXRlIHN1cHBsaWVkOiAiICsgSlNPTi5zdHJpbmdpZnkoaW5wdXREYXRlKSkpOw0KICAgICAgICBzZWxmLnNlbGVjdGVkRGF0ZXMgPSBkYXRlcy5maWx0ZXIoZnVuY3Rpb24gKGQpIHsNCiAgICAgICAgICByZXR1cm4gZCBpbnN0YW5jZW9mIERhdGUgJiYgaXNFbmFibGVkKGQsIGZhbHNlKTsNCiAgICAgICAgfSk7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tb2RlID09PSAicmFuZ2UiKSBzZWxmLnNlbGVjdGVkRGF0ZXMuc29ydChmdW5jdGlvbiAoYSwgYikgew0KICAgICAgICAgIHJldHVybiBhLmdldFRpbWUoKSAtIGIuZ2V0VGltZSgpOw0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gc2V0RGF0ZShkYXRlLCB0cmlnZ2VyQ2hhbmdlLCBmb3JtYXQpIHsNCiAgICAgICAgaWYgKHRyaWdnZXJDaGFuZ2UgPT09IHZvaWQgMCkgew0KICAgICAgICAgIHRyaWdnZXJDaGFuZ2UgPSBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChmb3JtYXQgPT09IHZvaWQgMCkgew0KICAgICAgICAgIGZvcm1hdCA9IHNlbGYuY29uZmlnLmRhdGVGb3JtYXQ7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoZGF0ZSAhPT0gMCAmJiAhZGF0ZSB8fCBkYXRlIGluc3RhbmNlb2YgQXJyYXkgJiYgZGF0ZS5sZW5ndGggPT09IDApIHJldHVybiBzZWxmLmNsZWFyKHRyaWdnZXJDaGFuZ2UpOw0KICAgICAgICBzZXRTZWxlY3RlZERhdGUoZGF0ZSwgZm9ybWF0KTsNCiAgICAgICAgc2VsZi5zaG93VGltZUlucHV0ID0gc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA+IDA7DQogICAgICAgIHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqID0gc2VsZi5zZWxlY3RlZERhdGVzWzBdOw0KICAgICAgICBzZWxmLnJlZHJhdygpOw0KICAgICAgICBqdW1wVG9EYXRlKCk7DQogICAgICAgIHNldEhvdXJzRnJvbURhdGUoKTsNCiAgICAgICAgdXBkYXRlVmFsdWUodHJpZ2dlckNoYW5nZSk7DQogICAgICAgIGlmICh0cmlnZ2VyQ2hhbmdlKSB0cmlnZ2VyRXZlbnQoIm9uQ2hhbmdlIik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHBhcnNlRGF0ZVJ1bGVzKGFycikgew0KICAgICAgICByZXR1cm4gYXJyLnNsaWNlKCkubWFwKGZ1bmN0aW9uIChydWxlKSB7DQogICAgICAgICAgaWYgKHR5cGVvZiBydWxlID09PSAic3RyaW5nIiB8fCB0eXBlb2YgcnVsZSA9PT0gIm51bWJlciIgfHwgcnVsZSBpbnN0YW5jZW9mIERhdGUpIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLnBhcnNlRGF0ZShydWxlLCB1bmRlZmluZWQsIHRydWUpOw0KICAgICAgICAgIH0gZWxzZSBpZiAocnVsZSAmJiB0eXBlb2YgcnVsZSA9PT0gIm9iamVjdCIgJiYgcnVsZS5mcm9tICYmIHJ1bGUudG8pIHJldHVybiB7DQogICAgICAgICAgICBmcm9tOiBzZWxmLnBhcnNlRGF0ZShydWxlLmZyb20sIHVuZGVmaW5lZCksDQogICAgICAgICAgICB0bzogc2VsZi5wYXJzZURhdGUocnVsZS50bywgdW5kZWZpbmVkKQ0KICAgICAgICAgIH07DQoNCiAgICAgICAgICByZXR1cm4gcnVsZTsNCiAgICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uICh4KSB7DQogICAgICAgICAgcmV0dXJuIHg7DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzZXR1cERhdGVzKCkgew0KICAgICAgICBzZWxmLnNlbGVjdGVkRGF0ZXMgPSBbXTsNCiAgICAgICAgc2VsZi5ub3cgPSBzZWxmLnBhcnNlRGF0ZShzZWxmLmNvbmZpZy5ub3cpIHx8IG5ldyBEYXRlKCk7DQogICAgICAgIHZhciBwcmVsb2FkZWREYXRlID0gc2VsZi5jb25maWcuZGVmYXVsdERhdGUgfHwgKHNlbGYuaW5wdXQucGxhY2Vob2xkZXIubGVuZ3RoID4gMCAmJiBzZWxmLmlucHV0LnZhbHVlID09PSBzZWxmLmlucHV0LnBsYWNlaG9sZGVyID8gbnVsbCA6IHNlbGYuaW5wdXQudmFsdWUpOw0KICAgICAgICBpZiAocHJlbG9hZGVkRGF0ZSkgc2V0U2VsZWN0ZWREYXRlKHByZWxvYWRlZERhdGUsIHNlbGYuY29uZmlnLmRhdGVGb3JtYXQpOw0KICAgICAgICB2YXIgaW5pdGlhbERhdGUgPSBzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID4gMCA/IHNlbGYuc2VsZWN0ZWREYXRlc1swXSA6IHNlbGYuY29uZmlnLm1pbkRhdGUgJiYgc2VsZi5jb25maWcubWluRGF0ZS5nZXRUaW1lKCkgPiBzZWxmLm5vdy5nZXRUaW1lKCkgPyBzZWxmLmNvbmZpZy5taW5EYXRlIDogc2VsZi5jb25maWcubWF4RGF0ZSAmJiBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldFRpbWUoKSA8IHNlbGYubm93LmdldFRpbWUoKSA/IHNlbGYuY29uZmlnLm1heERhdGUgOiBzZWxmLm5vdzsNCiAgICAgICAgc2VsZi5jdXJyZW50WWVhciA9IGluaXRpYWxEYXRlLmdldEZ1bGxZZWFyKCk7DQogICAgICAgIHNlbGYuY3VycmVudE1vbnRoID0gaW5pdGlhbERhdGUuZ2V0TW9udGgoKTsNCiAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPiAwKSBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiA9IHNlbGYuc2VsZWN0ZWREYXRlc1swXTsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1pblRpbWUgIT09IHVuZGVmaW5lZCkgc2VsZi5jb25maWcubWluVGltZSA9IHNlbGYucGFyc2VEYXRlKHNlbGYuY29uZmlnLm1pblRpbWUsICJIOmkiKTsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1heFRpbWUgIT09IHVuZGVmaW5lZCkgc2VsZi5jb25maWcubWF4VGltZSA9IHNlbGYucGFyc2VEYXRlKHNlbGYuY29uZmlnLm1heFRpbWUsICJIOmkiKTsNCiAgICAgICAgc2VsZi5taW5EYXRlSGFzVGltZSA9ICEhc2VsZi5jb25maWcubWluRGF0ZSAmJiAoc2VsZi5jb25maWcubWluRGF0ZS5nZXRIb3VycygpID4gMCB8fCBzZWxmLmNvbmZpZy5taW5EYXRlLmdldE1pbnV0ZXMoKSA+IDAgfHwgc2VsZi5jb25maWcubWluRGF0ZS5nZXRTZWNvbmRzKCkgPiAwKTsNCiAgICAgICAgc2VsZi5tYXhEYXRlSGFzVGltZSA9ICEhc2VsZi5jb25maWcubWF4RGF0ZSAmJiAoc2VsZi5jb25maWcubWF4RGF0ZS5nZXRIb3VycygpID4gMCB8fCBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldE1pbnV0ZXMoKSA+IDAgfHwgc2VsZi5jb25maWcubWF4RGF0ZS5nZXRTZWNvbmRzKCkgPiAwKTsNCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYsICJzaG93VGltZUlucHV0Iiwgew0KICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Nob3dUaW1lSW5wdXQ7DQogICAgICAgICAgfSwNCiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChib29sKSB7DQogICAgICAgICAgICBzZWxmLl9zaG93VGltZUlucHV0ID0gYm9vbDsNCiAgICAgICAgICAgIGlmIChzZWxmLmNhbGVuZGFyQ29udGFpbmVyKSB0b2dnbGVDbGFzcyhzZWxmLmNhbGVuZGFyQ29udGFpbmVyLCAic2hvd1RpbWVJbnB1dCIsIGJvb2wpOw0KICAgICAgICAgICAgc2VsZi5pc09wZW4gJiYgcG9zaXRpb25DYWxlbmRhcigpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHNldHVwSW5wdXRzKCkgew0KICAgICAgICBzZWxmLmlucHV0ID0gc2VsZi5jb25maWcud3JhcCA/IGVsZW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtaW5wdXRdIikgOiBlbGVtZW50Ow0KDQogICAgICAgIGlmICghc2VsZi5pbnB1dCkgew0KICAgICAgICAgIHNlbGYuY29uZmlnLmVycm9ySGFuZGxlcihuZXcgRXJyb3IoIkludmFsaWQgaW5wdXQgZWxlbWVudCBzcGVjaWZpZWQiKSk7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgc2VsZi5pbnB1dC5fdHlwZSA9IHNlbGYuaW5wdXQudHlwZTsNCiAgICAgICAgc2VsZi5pbnB1dC50eXBlID0gInRleHQiOw0KICAgICAgICBzZWxmLmlucHV0LmNsYXNzTGlzdC5hZGQoImZsYXRwaWNrci1pbnB1dCIpOw0KICAgICAgICBzZWxmLl9pbnB1dCA9IHNlbGYuaW5wdXQ7DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmFsdElucHV0KSB7DQogICAgICAgICAgc2VsZi5hbHRJbnB1dCA9IGNyZWF0ZUVsZW1lbnQoc2VsZi5pbnB1dC5ub2RlTmFtZSwgc2VsZi5pbnB1dC5jbGFzc05hbWUgKyAiICIgKyBzZWxmLmNvbmZpZy5hbHRJbnB1dENsYXNzKTsNCiAgICAgICAgICBzZWxmLl9pbnB1dCA9IHNlbGYuYWx0SW5wdXQ7DQogICAgICAgICAgc2VsZi5hbHRJbnB1dC5wbGFjZWhvbGRlciA9IHNlbGYuaW5wdXQucGxhY2Vob2xkZXI7DQogICAgICAgICAgc2VsZi5hbHRJbnB1dC5kaXNhYmxlZCA9IHNlbGYuaW5wdXQuZGlzYWJsZWQ7DQogICAgICAgICAgc2VsZi5hbHRJbnB1dC5yZXF1aXJlZCA9IHNlbGYuaW5wdXQucmVxdWlyZWQ7DQogICAgICAgICAgc2VsZi5hbHRJbnB1dC50YWJJbmRleCA9IHNlbGYuaW5wdXQudGFiSW5kZXg7DQogICAgICAgICAgc2VsZi5hbHRJbnB1dC50eXBlID0gInRleHQiOw0KICAgICAgICAgIHNlbGYuaW5wdXQuc2V0QXR0cmlidXRlKCJ0eXBlIiwgImhpZGRlbiIpOw0KICAgICAgICAgIGlmICghc2VsZi5jb25maWcuc3RhdGljICYmIHNlbGYuaW5wdXQucGFyZW50Tm9kZSkgc2VsZi5pbnB1dC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzZWxmLmFsdElucHV0LCBzZWxmLmlucHV0Lm5leHRTaWJsaW5nKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICghc2VsZi5jb25maWcuYWxsb3dJbnB1dCkgc2VsZi5faW5wdXQuc2V0QXR0cmlidXRlKCJyZWFkb25seSIsICJyZWFkb25seSIpOw0KICAgICAgICBzZWxmLl9wb3NpdGlvbkVsZW1lbnQgPSBzZWxmLmNvbmZpZy5wb3NpdGlvbkVsZW1lbnQgfHwgc2VsZi5faW5wdXQ7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHNldHVwTW9iaWxlKCkgew0KICAgICAgICB2YXIgaW5wdXRUeXBlID0gc2VsZi5jb25maWcuZW5hYmxlVGltZSA/IHNlbGYuY29uZmlnLm5vQ2FsZW5kYXIgPyAidGltZSIgOiAiZGF0ZXRpbWUtbG9jYWwiIDogImRhdGUiOw0KICAgICAgICBzZWxmLm1vYmlsZUlucHV0ID0gY3JlYXRlRWxlbWVudCgiaW5wdXQiLCBzZWxmLmlucHV0LmNsYXNzTmFtZSArICIgZmxhdHBpY2tyLW1vYmlsZSIpOw0KICAgICAgICBzZWxmLm1vYmlsZUlucHV0LnN0ZXAgPSBzZWxmLmlucHV0LmdldEF0dHJpYnV0ZSgic3RlcCIpIHx8ICJhbnkiOw0KICAgICAgICBzZWxmLm1vYmlsZUlucHV0LnRhYkluZGV4ID0gMTsNCiAgICAgICAgc2VsZi5tb2JpbGVJbnB1dC50eXBlID0gaW5wdXRUeXBlOw0KICAgICAgICBzZWxmLm1vYmlsZUlucHV0LmRpc2FibGVkID0gc2VsZi5pbnB1dC5kaXNhYmxlZDsNCiAgICAgICAgc2VsZi5tb2JpbGVJbnB1dC5yZXF1aXJlZCA9IHNlbGYuaW5wdXQucmVxdWlyZWQ7DQogICAgICAgIHNlbGYubW9iaWxlSW5wdXQucGxhY2Vob2xkZXIgPSBzZWxmLmlucHV0LnBsYWNlaG9sZGVyOw0KICAgICAgICBzZWxmLm1vYmlsZUZvcm1hdFN0ciA9IGlucHV0VHlwZSA9PT0gImRhdGV0aW1lLWxvY2FsIiA/ICJZLW0tZFxcVEg6aTpTIiA6IGlucHV0VHlwZSA9PT0gImRhdGUiID8gIlktbS1kIiA6ICJIOmk6UyI7DQoNCiAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgc2VsZi5tb2JpbGVJbnB1dC5kZWZhdWx0VmFsdWUgPSBzZWxmLm1vYmlsZUlucHV0LnZhbHVlID0gc2VsZi5mb3JtYXREYXRlKHNlbGYuc2VsZWN0ZWREYXRlc1swXSwgc2VsZi5tb2JpbGVGb3JtYXRTdHIpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1pbkRhdGUpIHNlbGYubW9iaWxlSW5wdXQubWluID0gc2VsZi5mb3JtYXREYXRlKHNlbGYuY29uZmlnLm1pbkRhdGUsICJZLW0tZCIpOw0KICAgICAgICBpZiAoc2VsZi5jb25maWcubWF4RGF0ZSkgc2VsZi5tb2JpbGVJbnB1dC5tYXggPSBzZWxmLmZvcm1hdERhdGUoc2VsZi5jb25maWcubWF4RGF0ZSwgIlktbS1kIik7DQogICAgICAgIHNlbGYuaW5wdXQudHlwZSA9ICJoaWRkZW4iOw0KICAgICAgICBpZiAoc2VsZi5hbHRJbnB1dCAhPT0gdW5kZWZpbmVkKSBzZWxmLmFsdElucHV0LnR5cGUgPSAiaGlkZGVuIjsNCg0KICAgICAgICB0cnkgew0KICAgICAgICAgIGlmIChzZWxmLmlucHV0LnBhcmVudE5vZGUpIHNlbGYuaW5wdXQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsZi5tb2JpbGVJbnB1dCwgc2VsZi5pbnB1dC5uZXh0U2libGluZyk7DQogICAgICAgIH0gY2F0Y2ggKF9hKSB7fQ0KDQogICAgICAgIGJpbmQoc2VsZi5tb2JpbGVJbnB1dCwgImNoYW5nZSIsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgc2VsZi5zZXREYXRlKGUudGFyZ2V0LnZhbHVlLCBmYWxzZSwgc2VsZi5tb2JpbGVGb3JtYXRTdHIpOw0KICAgICAgICAgIHRyaWdnZXJFdmVudCgib25DaGFuZ2UiKTsNCiAgICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uQ2xvc2UiKTsNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHRvZ2dsZShlKSB7DQogICAgICAgIGlmIChzZWxmLmlzT3BlbiA9PT0gdHJ1ZSkgcmV0dXJuIHNlbGYuY2xvc2UoKTsNCiAgICAgICAgc2VsZi5vcGVuKGUpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiB0cmlnZ2VyRXZlbnQoZXZlbnQsIGRhdGEpIHsNCiAgICAgICAgdmFyIGhvb2tzID0gc2VsZi5jb25maWdbZXZlbnRdOw0KDQogICAgICAgIGlmIChob29rcyAhPT0gdW5kZWZpbmVkICYmIGhvb2tzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaG9va3NbaV0gJiYgaSA8IGhvb2tzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBob29rc1tpXShzZWxmLnNlbGVjdGVkRGF0ZXMsIHNlbGYuaW5wdXQudmFsdWUsIHNlbGYsIGRhdGEpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChldmVudCA9PT0gIm9uQ2hhbmdlIikgew0KICAgICAgICAgIHNlbGYuaW5wdXQuZGlzcGF0Y2hFdmVudChjcmVhdGVFdmVudCgiY2hhbmdlIikpOw0KICAgICAgICAgIHNlbGYuaW5wdXQuZGlzcGF0Y2hFdmVudChjcmVhdGVFdmVudCgiaW5wdXQiKSk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gY3JlYXRlRXZlbnQobmFtZSkgew0KICAgICAgICB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJFdmVudCIpOw0KICAgICAgICBlLmluaXRFdmVudChuYW1lLCB0cnVlLCB0cnVlKTsNCiAgICAgICAgcmV0dXJuIGU7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGlzRGF0ZVNlbGVjdGVkKGRhdGUpIHsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICBpZiAoY29tcGFyZURhdGVzKHNlbGYuc2VsZWN0ZWREYXRlc1tpXSwgZGF0ZSkgPT09IDApIHJldHVybiAiIiArIGk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGlzRGF0ZUluUmFuZ2UoZGF0ZSkgew0KICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSAhPT0gInJhbmdlIiB8fCBzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoIDwgMikgcmV0dXJuIGZhbHNlOw0KICAgICAgICByZXR1cm4gY29tcGFyZURhdGVzKGRhdGUsIHNlbGYuc2VsZWN0ZWREYXRlc1swXSkgPj0gMCAmJiBjb21wYXJlRGF0ZXMoZGF0ZSwgc2VsZi5zZWxlY3RlZERhdGVzWzFdKSA8PSAwOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiB1cGRhdGVOYXZpZ2F0aW9uQ3VycmVudE1vbnRoKCkgew0KICAgICAgICBpZiAoc2VsZi5jb25maWcubm9DYWxlbmRhciB8fCBzZWxmLmlzTW9iaWxlIHx8ICFzZWxmLm1vbnRoTmF2KSByZXR1cm47DQogICAgICAgIHNlbGYueWVhckVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKHllYXJFbGVtZW50LCBpKSB7DQogICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZShzZWxmLmN1cnJlbnRZZWFyLCBzZWxmLmN1cnJlbnRNb250aCwgMSk7DQogICAgICAgICAgZC5zZXRNb250aChzZWxmLmN1cnJlbnRNb250aCArIGkpOw0KICAgICAgICAgIHNlbGYubW9udGhFbGVtZW50c1tpXS50ZXh0Q29udGVudCA9IG1vbnRoVG9TdHIoZC5nZXRNb250aCgpLCBzZWxmLmNvbmZpZy5zaG9ydGhhbmRDdXJyZW50TW9udGgsIHNlbGYubDEwbikgKyAiICI7DQogICAgICAgICAgeWVhckVsZW1lbnQudmFsdWUgPSBkLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKTsNCiAgICAgICAgfSk7DQogICAgICAgIHNlbGYuX2hpZGVQcmV2TW9udGhBcnJvdyA9IHNlbGYuY29uZmlnLm1pbkRhdGUgIT09IHVuZGVmaW5lZCAmJiAoc2VsZi5jdXJyZW50WWVhciA9PT0gc2VsZi5jb25maWcubWluRGF0ZS5nZXRGdWxsWWVhcigpID8gc2VsZi5jdXJyZW50TW9udGggPD0gc2VsZi5jb25maWcubWluRGF0ZS5nZXRNb250aCgpIDogc2VsZi5jdXJyZW50WWVhciA8IHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0RnVsbFllYXIoKSk7DQogICAgICAgIHNlbGYuX2hpZGVOZXh0TW9udGhBcnJvdyA9IHNlbGYuY29uZmlnLm1heERhdGUgIT09IHVuZGVmaW5lZCAmJiAoc2VsZi5jdXJyZW50WWVhciA9PT0gc2VsZi5jb25maWcubWF4RGF0ZS5nZXRGdWxsWWVhcigpID8gc2VsZi5jdXJyZW50TW9udGggKyAxID4gc2VsZi5jb25maWcubWF4RGF0ZS5nZXRNb250aCgpIDogc2VsZi5jdXJyZW50WWVhciA+IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0RnVsbFllYXIoKSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlKHRyaWdnZXJDaGFuZ2UpIHsNCiAgICAgICAgaWYgKHRyaWdnZXJDaGFuZ2UgPT09IHZvaWQgMCkgew0KICAgICAgICAgIHRyaWdnZXJDaGFuZ2UgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPT09IDApIHJldHVybiBzZWxmLmNsZWFyKHRyaWdnZXJDaGFuZ2UpOw0KDQogICAgICAgIGlmIChzZWxmLm1vYmlsZUlucHV0ICE9PSB1bmRlZmluZWQgJiYgc2VsZi5tb2JpbGVGb3JtYXRTdHIpIHsNCiAgICAgICAgICBzZWxmLm1vYmlsZUlucHV0LnZhbHVlID0gc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogIT09IHVuZGVmaW5lZCA/IHNlbGYuZm9ybWF0RGF0ZShzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiwgc2VsZi5tb2JpbGVGb3JtYXRTdHIpIDogIiI7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgam9pbkNoYXIgPSBzZWxmLmNvbmZpZy5tb2RlICE9PSAicmFuZ2UiID8gc2VsZi5jb25maWcuY29uanVuY3Rpb24gOiBzZWxmLmwxMG4ucmFuZ2VTZXBhcmF0b3I7DQogICAgICAgIHNlbGYuaW5wdXQudmFsdWUgPSBzZWxmLnNlbGVjdGVkRGF0ZXMubWFwKGZ1bmN0aW9uIChkT2JqKSB7DQogICAgICAgICAgcmV0dXJuIHNlbGYuZm9ybWF0RGF0ZShkT2JqLCBzZWxmLmNvbmZpZy5kYXRlRm9ybWF0KTsNCiAgICAgICAgfSkuam9pbihqb2luQ2hhcik7DQoNCiAgICAgICAgaWYgKHNlbGYuYWx0SW5wdXQgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgIHNlbGYuYWx0SW5wdXQudmFsdWUgPSBzZWxmLnNlbGVjdGVkRGF0ZXMubWFwKGZ1bmN0aW9uIChkT2JqKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5mb3JtYXREYXRlKGRPYmosIHNlbGYuY29uZmlnLmFsdEZvcm1hdCk7DQogICAgICAgICAgfSkuam9pbihqb2luQ2hhcik7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAodHJpZ2dlckNoYW5nZSAhPT0gZmFsc2UpIHRyaWdnZXJFdmVudCgib25WYWx1ZVVwZGF0ZSIpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBvbk1vbnRoTmF2Q2xpY2soZSkgew0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIHZhciBpc1ByZXZNb250aCA9IHNlbGYucHJldk1vbnRoTmF2LmNvbnRhaW5zKGUudGFyZ2V0KTsNCiAgICAgICAgdmFyIGlzTmV4dE1vbnRoID0gc2VsZi5uZXh0TW9udGhOYXYuY29udGFpbnMoZS50YXJnZXQpOw0KDQogICAgICAgIGlmIChpc1ByZXZNb250aCB8fCBpc05leHRNb250aCkgew0KICAgICAgICAgIGNoYW5nZU1vbnRoKGlzUHJldk1vbnRoID8gLTEgOiAxKTsNCiAgICAgICAgfSBlbHNlIGlmIChzZWxmLnllYXJFbGVtZW50cy5pbmRleE9mKGUudGFyZ2V0KSA+PSAwKSB7DQogICAgICAgICAgZS50YXJnZXQuc2VsZWN0KCk7DQogICAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJhcnJvd1VwIikpIHsNCiAgICAgICAgICBzZWxmLmNoYW5nZVllYXIoc2VsZi5jdXJyZW50WWVhciArIDEpOw0KICAgICAgICB9IGVsc2UgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiYXJyb3dEb3duIikpIHsNCiAgICAgICAgICBzZWxmLmNoYW5nZVllYXIoc2VsZi5jdXJyZW50WWVhciAtIDEpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHRpbWVXcmFwcGVyKGUpIHsNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICB2YXIgaXNLZXlEb3duID0gZS50eXBlID09PSAia2V5ZG93biIsDQogICAgICAgICAgICBpbnB1dCA9IGUudGFyZ2V0Ow0KDQogICAgICAgIGlmIChzZWxmLmFtUE0gIT09IHVuZGVmaW5lZCAmJiBlLnRhcmdldCA9PT0gc2VsZi5hbVBNKSB7DQogICAgICAgICAgc2VsZi5hbVBNLnRleHRDb250ZW50ID0gc2VsZi5sMTBuLmFtUE1baW50KHNlbGYuYW1QTS50ZXh0Q29udGVudCA9PT0gc2VsZi5sMTBuLmFtUE1bMF0pXTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBtaW4gPSBwYXJzZUZsb2F0KGlucHV0LmdldEF0dHJpYnV0ZSgiZGF0YS1taW4iKSksDQogICAgICAgICAgICBtYXggPSBwYXJzZUZsb2F0KGlucHV0LmdldEF0dHJpYnV0ZSgiZGF0YS1tYXgiKSksDQogICAgICAgICAgICBzdGVwID0gcGFyc2VGbG9hdChpbnB1dC5nZXRBdHRyaWJ1dGUoImRhdGEtc3RlcCIpKSwNCiAgICAgICAgICAgIGN1clZhbHVlID0gcGFyc2VJbnQoaW5wdXQudmFsdWUsIDEwKSwNCiAgICAgICAgICAgIGRlbHRhID0gZS5kZWx0YSB8fCAoaXNLZXlEb3duID8gZS53aGljaCA9PT0gMzggPyAxIDogLTEgOiAwKTsNCiAgICAgICAgdmFyIG5ld1ZhbHVlID0gY3VyVmFsdWUgKyBzdGVwICogZGVsdGE7DQoNCiAgICAgICAgaWYgKHR5cGVvZiBpbnB1dC52YWx1ZSAhPT0gInVuZGVmaW5lZCIgJiYgaW5wdXQudmFsdWUubGVuZ3RoID09PSAyKSB7DQogICAgICAgICAgdmFyIGlzSG91ckVsZW0gPSBpbnB1dCA9PT0gc2VsZi5ob3VyRWxlbWVudCwNCiAgICAgICAgICAgICAgaXNNaW51dGVFbGVtID0gaW5wdXQgPT09IHNlbGYubWludXRlRWxlbWVudDsNCg0KICAgICAgICAgIGlmIChuZXdWYWx1ZSA8IG1pbikgew0KICAgICAgICAgICAgbmV3VmFsdWUgPSBtYXggKyBuZXdWYWx1ZSArIGludCghaXNIb3VyRWxlbSkgKyAoaW50KGlzSG91ckVsZW0pICYmIGludCghc2VsZi5hbVBNKSk7DQogICAgICAgICAgICBpZiAoaXNNaW51dGVFbGVtKSBpbmNyZW1lbnROdW1JbnB1dCh1bmRlZmluZWQsIC0xLCBzZWxmLmhvdXJFbGVtZW50KTsNCiAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbHVlID4gbWF4KSB7DQogICAgICAgICAgICBuZXdWYWx1ZSA9IGlucHV0ID09PSBzZWxmLmhvdXJFbGVtZW50ID8gbmV3VmFsdWUgLSBtYXggLSBpbnQoIXNlbGYuYW1QTSkgOiBtaW47DQogICAgICAgICAgICBpZiAoaXNNaW51dGVFbGVtKSBpbmNyZW1lbnROdW1JbnB1dCh1bmRlZmluZWQsIDEsIHNlbGYuaG91ckVsZW1lbnQpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmIChzZWxmLmFtUE0gJiYgaXNIb3VyRWxlbSAmJiAoc3RlcCA9PT0gMSA/IG5ld1ZhbHVlICsgY3VyVmFsdWUgPT09IDIzIDogTWF0aC5hYnMobmV3VmFsdWUgLSBjdXJWYWx1ZSkgPiBzdGVwKSkgew0KICAgICAgICAgICAgc2VsZi5hbVBNLnRleHRDb250ZW50ID0gc2VsZi5sMTBuLmFtUE1baW50KHNlbGYuYW1QTS50ZXh0Q29udGVudCA9PT0gc2VsZi5sMTBuLmFtUE1bMF0pXTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpbnB1dC52YWx1ZSA9IHBhZChuZXdWYWx1ZSk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgaW5pdCgpOw0KICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gX2ZsYXRwaWNrcihub2RlTGlzdCwgY29uZmlnKSB7DQogICAgICB2YXIgbm9kZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChub2RlTGlzdCk7DQogICAgICB2YXIgaW5zdGFuY2VzID0gW107DQoNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgdmFyIG5vZGUgPSBub2Rlc1tpXTsNCg0KICAgICAgICB0cnkgew0KICAgICAgICAgIGlmIChub2RlLmdldEF0dHJpYnV0ZSgiZGF0YS1mcC1vbWl0IikgIT09IG51bGwpIGNvbnRpbnVlOw0KDQogICAgICAgICAgaWYgKG5vZGUuX2ZsYXRwaWNrciAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBub2RlLl9mbGF0cGlja3IuZGVzdHJveSgpOw0KDQogICAgICAgICAgICBub2RlLl9mbGF0cGlja3IgPSB1bmRlZmluZWQ7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgbm9kZS5fZmxhdHBpY2tyID0gRmxhdHBpY2tySW5zdGFuY2Uobm9kZSwgY29uZmlnIHx8IHt9KTsNCiAgICAgICAgICBpbnN0YW5jZXMucHVzaChub2RlLl9mbGF0cGlja3IpOw0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgY29uc29sZS5lcnJvcihlKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICByZXR1cm4gaW5zdGFuY2VzLmxlbmd0aCA9PT0gMSA/IGluc3RhbmNlc1swXSA6IGluc3RhbmNlczsNCiAgICB9DQoNCiAgICBpZiAodHlwZW9mIEhUTUxFbGVtZW50ICE9PSAidW5kZWZpbmVkIikgew0KICAgICAgSFRNTENvbGxlY3Rpb24ucHJvdG90eXBlLmZsYXRwaWNrciA9IE5vZGVMaXN0LnByb3RvdHlwZS5mbGF0cGlja3IgPSBmdW5jdGlvbiAoY29uZmlnKSB7DQogICAgICAgIHJldHVybiBfZmxhdHBpY2tyKHRoaXMsIGNvbmZpZyk7DQogICAgICB9Ow0KDQogICAgICBIVE1MRWxlbWVudC5wcm90b3R5cGUuZmxhdHBpY2tyID0gZnVuY3Rpb24gKGNvbmZpZykgew0KICAgICAgICByZXR1cm4gX2ZsYXRwaWNrcihbdGhpc10sIGNvbmZpZyk7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIHZhciBmbGF0cGlja3IgPSBmdW5jdGlvbiBmbGF0cGlja3Ioc2VsZWN0b3IsIGNvbmZpZykgew0KICAgICAgaWYgKHNlbGVjdG9yIGluc3RhbmNlb2YgTm9kZUxpc3QpIHJldHVybiBfZmxhdHBpY2tyKHNlbGVjdG9yLCBjb25maWcpO2Vsc2UgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIpIHJldHVybiBfZmxhdHBpY2tyKHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSwgY29uZmlnKTsNCiAgICAgIHJldHVybiBfZmxhdHBpY2tyKFtzZWxlY3Rvcl0sIGNvbmZpZyk7DQogICAgfTsNCg0KICAgIGZsYXRwaWNrci5kZWZhdWx0Q29uZmlnID0gZGVmYXVsdHM7DQogICAgZmxhdHBpY2tyLmwxMG5zID0gew0KICAgICAgZW46IE9iamVjdC5hc3NpZ24oe30sIGVuZ2xpc2gpLA0KICAgICAgZGVmYXVsdDogT2JqZWN0LmFzc2lnbih7fSwgZW5nbGlzaCkNCiAgICB9Ow0KDQogICAgZmxhdHBpY2tyLmxvY2FsaXplID0gZnVuY3Rpb24gKGwxMG4pIHsNCiAgICAgIGZsYXRwaWNrci5sMTBucy5kZWZhdWx0ID0gT2JqZWN0LmFzc2lnbih7fSwgZmxhdHBpY2tyLmwxMG5zLmRlZmF1bHQsIGwxMG4pOw0KICAgIH07DQoNCiAgICBmbGF0cGlja3Iuc2V0RGVmYXVsdHMgPSBmdW5jdGlvbiAoY29uZmlnKSB7DQogICAgICBmbGF0cGlja3IuZGVmYXVsdENvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIGZsYXRwaWNrci5kZWZhdWx0Q29uZmlnLCBjb25maWcpOw0KICAgIH07DQoNCiAgICBmbGF0cGlja3IucGFyc2VEYXRlID0gY3JlYXRlRGF0ZVBhcnNlcih7fSk7DQogICAgZmxhdHBpY2tyLmZvcm1hdERhdGUgPSBjcmVhdGVEYXRlRm9ybWF0dGVyKHt9KTsNCiAgICBmbGF0cGlja3IuY29tcGFyZURhdGVzID0gY29tcGFyZURhdGVzOw0KDQogICAgaWYgKHR5cGVvZiBqUXVlcnkgIT09ICJ1bmRlZmluZWQiKSB7DQogICAgICBqUXVlcnkuZm4uZmxhdHBpY2tyID0gZnVuY3Rpb24gKGNvbmZpZykgew0KICAgICAgICByZXR1cm4gX2ZsYXRwaWNrcih0aGlzLCBjb25maWcpOw0KICAgICAgfTsNCiAgICB9DQoNCiAgICBEYXRlLnByb3RvdHlwZS5mcF9pbmNyID0gZnVuY3Rpb24gKGRheXMpIHsNCiAgICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLmdldEZ1bGxZZWFyKCksIHRoaXMuZ2V0TW9udGgoKSwgdGhpcy5nZXREYXRlKCkgKyAodHlwZW9mIGRheXMgPT09ICJzdHJpbmciID8gcGFyc2VJbnQoZGF5cywgMTApIDogZGF5cykpOw0KICAgIH07DQoNCiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIpIHsNCiAgICAgIHdpbmRvdy5mbGF0cGlja3IgPSBmbGF0cGlja3I7DQogICAgfQ0KDQogICAgcmV0dXJuIGZsYXRwaWNrcjsNCg0KfSkpKTsNCjwvc2NyaXB0Pg0KICA8IS0taHR0cHM6Ly9qb3NodWFqb2huc29uLmNvLnVrL0Nob2ljZXMvLS0+DQogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy9jaG9pY2VzLmNzcyIgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgLz4tLT4NCiAgPHN0eWxlPg0KICAgIC8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KPSAgICAgICAgICAgIENob2ljZXMgICAgICAgICAgICA9DQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCi5jaG9pY2VzIHsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KICBtYXJnaW4tYm90dG9tOiAyNHB4Ow0KICBmb250LXNpemU6IDEycHg7DQp9DQoNCi5jaG9pY2VzOmZvY3VzIHsNCiAgb3V0bGluZTogbm9uZTsNCn0NCg0KLmNob2ljZXM6bGFzdC1jaGlsZCB7DQogIG1hcmdpbi1ib3R0b206IDA7DQp9DQoNCi5jaG9pY2VzLmlzLWRpc2FibGVkIC5jaG9pY2VzX19pbm5lciwNCi5jaG9pY2VzLmlzLWRpc2FibGVkIC5jaG9pY2VzX19pbnB1dCB7DQogIGJhY2tncm91bmQtY29sb3I6ICNFQUVBRUE7DQogIGN1cnNvcjogbm90LWFsbG93ZWQ7DQogIHVzZXItc2VsZWN0OiBub25lOw0KfQ0KDQouY2hvaWNlcy5pcy1kaXNhYmxlZCAuY2hvaWNlc19faXRlbSB7DQogIGN1cnNvcjogbm90LWFsbG93ZWQ7DQp9DQoNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXSB7DQogIGN1cnNvcjogcG9pbnRlcjsNCn0NCg0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdIC5jaG9pY2VzX19pbm5lciB7DQogIHBhZGRpbmctYm90dG9tOiA3LjVweDsNCn0NCg0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdIC5jaG9pY2VzX19pbnB1dCB7DQogIGRpc3BsYXk6IGJsb2NrOw0KICB3aWR0aDogMTAwJTsNCiAgcGFkZGluZzogMTBweDsNCiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNEREREREQ7DQogIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7DQogIG1hcmdpbjogMDsNCn0NCg0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdIC5jaG9pY2VzX19idXR0b24gew0KICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTWpFaUlHaGxhV2RvZEQwaU1qRWlJSFpwWlhkQ2IzZzlJakFnTUNBeU1TQXlNU0lnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JajQ4WnlCbWFXeHNQU0lqTURBd0lpQm1hV3hzTFhKMWJHVTlJbVYyWlc1dlpHUWlQanh3WVhSb0lHUTlJazB5TGpVNU1pNHdORFJzTVRndU16WTBJREU0TGpNMk5DMHlMalUwT0NBeUxqVTBPRXd1TURRMElESXVOVGt5ZWlJdlBqeHdZWFJvSUdROUlrMHdJREU0TGpNMk5Fd3hPQzR6TmpRZ01Hd3lMalUwT0NBeUxqVTBPRXd5TGpVME9DQXlNQzQ1TVRKNklpOCtQQzluUGp3dmMzWm5QZz09KTsNCiAgcGFkZGluZzogMDsNCiAgYmFja2dyb3VuZC1zaXplOiA4cHg7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgdG9wOiA1MCU7DQogIHJpZ2h0OiAwOw0KICBtYXJnaW4tdG9wOiAtMTBweDsNCiAgbWFyZ2luLXJpZ2h0OiAyNXB4Ow0KICBoZWlnaHQ6IDIwcHg7DQogIHdpZHRoOiAyMHB4Ow0KICBib3JkZXItcmFkaXVzOiAxMGVtOw0KICBvcGFjaXR5OiAuNTsNCn0NCg0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdIC5jaG9pY2VzX19idXR0b246aG92ZXIsDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0gLmNob2ljZXNfX2J1dHRvbjpmb2N1cyB7DQogIG9wYWNpdHk6IDE7DQp9DQoNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXSAuY2hvaWNlc19fYnV0dG9uOmZvY3VzIHsNCiAgYm94LXNoYWRvdzogMHB4IDBweCAwcHggMnB4ICMwMEJDRDQ7DQp9DQoNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXTphZnRlciB7DQogIGNvbnRlbnQ6ICIiOw0KICBoZWlnaHQ6IDA7DQogIHdpZHRoOiAwOw0KICBib3JkZXItc3R5bGU6IHNvbGlkOw0KICBib3JkZXItY29sb3I6ICMzMzMzMzMgdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQ7DQogIGJvcmRlci13aWR0aDogNXB4Ow0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHJpZ2h0OiAxMS41cHg7DQogIHRvcDogNTAlOw0KICBtYXJnaW4tdG9wOiAtMi41cHg7DQogIHBvaW50ZXItZXZlbnRzOiBub25lOw0KfQ0KDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0uaXMtb3BlbjphZnRlciB7DQogIGJvcmRlci1jb2xvcjogdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQgIzMzMzMzMyB0cmFuc3BhcmVudDsNCiAgbWFyZ2luLXRvcDogLTcuNXB4Ow0KfQ0KDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl1bZGlyPSJydGwiXTphZnRlciB7DQogIGxlZnQ6IDExLjVweDsNCiAgcmlnaHQ6IGF1dG87DQp9DQoNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXVtkaXI9InJ0bCJdIC5jaG9pY2VzX19idXR0b24gew0KICByaWdodDogYXV0bzsNCiAgbGVmdDogMDsNCiAgbWFyZ2luLWxlZnQ6IDI1cHg7DQogIG1hcmdpbi1yaWdodDogMDsNCn0NCg0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW11bHRpcGxlIl0gLmNob2ljZXNfX2lubmVyLA0KLmNob2ljZXNbZGF0YS10eXBlKj0idGV4dCJdIC5jaG9pY2VzX19pbm5lciB7DQogIGN1cnNvcjogdGV4dDsNCn0NCg0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW11bHRpcGxlIl0gLmNob2ljZXNfX2J1dHRvbiwNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InRleHQiXSAuY2hvaWNlc19fYnV0dG9uIHsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogIG1hcmdpbi10b3A6IDA7DQogIG1hcmdpbi1yaWdodDogLTRweDsNCiAgbWFyZ2luLWJvdHRvbTogMDsNCiAgbWFyZ2luLWxlZnQ6IDhweDsNCiAgcGFkZGluZy1sZWZ0OiAxNnB4Ow0KICBib3JkZXItbGVmdDogMXB4IHNvbGlkICMwMDhmYTE7DQogIGJhY2tncm91bmQtaW1hZ2U6IHVybChkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNakVpSUdobGFXZG9kRDBpTWpFaUlIWnBaWGRDYjNnOUlqQWdNQ0F5TVNBeU1TSWdlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREF2YzNabklqNDhaeUJtYVd4c1BTSWpSa1pHSWlCbWFXeHNMWEoxYkdVOUltVjJaVzV2WkdRaVBqeHdZWFJvSUdROUlrMHlMalU1TWk0d05EUnNNVGd1TXpZMElERTRMak0yTkMweUxqVTBPQ0F5TGpVME9Fd3VNRFEwSURJdU5Ua3llaUl2UGp4d1lYUm9JR1E5SWswd0lERTRMak0yTkV3eE9DNHpOalFnTUd3eUxqVTBPQ0F5TGpVME9Fd3lMalUwT0NBeU1DNDVNVEo2SWk4K1BDOW5Qand2YzNablBnPT0pOw0KICBiYWNrZ3JvdW5kLXNpemU6IDhweDsNCiAgd2lkdGg6IDhweDsNCiAgbGluZS1oZWlnaHQ6IDE7DQogIG9wYWNpdHk6IC43NTsNCiAgYm9yZGVyLXJhZGl1czogMDsNCn0NCg0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW11bHRpcGxlIl0gLmNob2ljZXNfX2J1dHRvbjpob3ZlciwNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1tdWx0aXBsZSJdIC5jaG9pY2VzX19idXR0b246Zm9jdXMsDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJ0ZXh0Il0gLmNob2ljZXNfX2J1dHRvbjpob3ZlciwNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InRleHQiXSAuY2hvaWNlc19fYnV0dG9uOmZvY3VzIHsNCiAgb3BhY2l0eTogMTsNCn0NCg0KLmNob2ljZXNfX2lubmVyIHsNCiAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KICB3aWR0aDogMTAwJTsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZjlmOTsNCiAgcGFkZGluZzogNy41cHggNy41cHggMy43NXB4Ow0KICBib3JkZXI6IDFweCBzb2xpZCAjREREREREOw0KICBib3JkZXItcmFkaXVzOiAyLjVweDsNCiAgZm9udC1zaXplOiAxMnB4Ow0KICBtaW4taGVpZ2h0OiAyNHB4Ow0KICBvdmVyZmxvdzogaGlkZGVuOw0KfQ0KDQouaXMtZm9jdXNlZCAuY2hvaWNlc19faW5uZXIsDQouaXMtb3BlbiAuY2hvaWNlc19faW5uZXIgew0KICBib3JkZXItY29sb3I6ICNiN2I3Yjc7DQp9DQoNCi5pcy1vcGVuIC5jaG9pY2VzX19pbm5lciB7DQogIGJvcmRlci1yYWRpdXM6IDIuNXB4IDIuNXB4IDAgMDsNCn0NCg0KLmlzLWZsaXBwZWQuaXMtb3BlbiAuY2hvaWNlc19faW5uZXIgew0KICBib3JkZXItcmFkaXVzOiAwIDAgMi41cHggMi41cHg7DQp9DQoNCi5jaG9pY2VzX19saXN0IHsNCiAgbWFyZ2luOiAwOw0KICBwYWRkaW5nLWxlZnQ6IDA7DQogIGxpc3Qtc3R5bGU6IG5vbmU7DQp9DQoNCi5jaG9pY2VzX19saXN0LS1zaW5nbGUgew0KICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogIHBhZGRpbmc6IDRweCAxNnB4IDRweCA0cHg7DQogIHdpZHRoOiAxMDAlOw0KfQ0KDQpbZGlyPSJydGwiXSAuY2hvaWNlc19fbGlzdC0tc2luZ2xlIHsNCiAgcGFkZGluZy1yaWdodDogNHB4Ow0KICBwYWRkaW5nLWxlZnQ6IDE2cHg7DQp9DQoNCi5jaG9pY2VzX19saXN0LS1zaW5nbGUgLmNob2ljZXNfX2l0ZW0gew0KICB3aWR0aDogMTAwJTsNCn0NCg0KLmNob2ljZXNfX2xpc3QtLW11bHRpcGxlIHsNCiAgZGlzcGxheTogaW5saW5lOw0KfQ0KDQouY2hvaWNlc19fbGlzdC0tbXVsdGlwbGUgLmNob2ljZXNfX2l0ZW0gew0KICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7DQogIGJvcmRlci1yYWRpdXM6IDIwcHg7DQogIHBhZGRpbmc6IDRweCAxMHB4Ow0KICBmb250LXNpemU6IDEycHg7DQogIGZvbnQtd2VpZ2h0OiA1MDA7DQogIG1hcmdpbi1yaWdodDogMy43NXB4Ow0KICBtYXJnaW4tYm90dG9tOiAzLjc1cHg7DQogIGJhY2tncm91bmQtY29sb3I6ICMwMEJDRDQ7DQogIGJvcmRlcjogMXB4IHNvbGlkICMwMGE1YmI7DQogIGNvbG9yOiAjRkZGRkZGOw0KICB3b3JkLWJyZWFrOiBicmVhay1hbGw7DQp9DQoNCi5jaG9pY2VzX19saXN0LS1tdWx0aXBsZSAuY2hvaWNlc19faXRlbVtkYXRhLWRlbGV0YWJsZV0gew0KICBwYWRkaW5nLXJpZ2h0OiA1cHg7DQp9DQoNCltkaXI9InJ0bCJdIC5jaG9pY2VzX19saXN0LS1tdWx0aXBsZSAuY2hvaWNlc19faXRlbSB7DQogIG1hcmdpbi1yaWdodDogMDsNCiAgbWFyZ2luLWxlZnQ6IDMuNzVweDsNCn0NCg0KLmNob2ljZXNfX2xpc3QtLW11bHRpcGxlIC5jaG9pY2VzX19pdGVtLmlzLWhpZ2hsaWdodGVkIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogIzAwYTViYjsNCiAgYm9yZGVyOiAxcHggc29saWQgIzAwOGZhMTsNCn0NCg0KLmlzLWRpc2FibGVkIC5jaG9pY2VzX19saXN0LS1tdWx0aXBsZSAuY2hvaWNlc19faXRlbSB7DQogIGJhY2tncm91bmQtY29sb3I6ICNhYWFhYWE7DQogIGJvcmRlcjogMXB4IHNvbGlkICM5MTkxOTE7DQp9DQoNCi5jaG9pY2VzX19saXN0LS1kcm9wZG93biB7DQogIGRpc3BsYXk6IG5vbmU7DQogIHotaW5kZXg6IDE7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgd2lkdGg6IDEwMCU7DQogIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7DQogIGJvcmRlcjogMXB4IHNvbGlkICNEREREREQ7DQogIHRvcDogMTAwJTsNCiAgbWFyZ2luLXRvcDogLTFweDsNCiAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMi41cHg7DQogIGJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiAyLjVweDsNCiAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgd29yZC1icmVhazogYnJlYWstYWxsOw0KfQ0KDQouY2hvaWNlc19fbGlzdC0tZHJvcGRvd24uaXMtYWN0aXZlIHsNCiAgZGlzcGxheTogYmxvY2s7DQp9DQoNCi5pcy1vcGVuIC5jaG9pY2VzX19saXN0LS1kcm9wZG93biB7DQogIGJvcmRlci1jb2xvcjogI2I3YjdiNzsNCn0NCg0KLmlzLWZsaXBwZWQgLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIHsNCiAgdG9wOiBhdXRvOw0KICBib3R0b206IDEwMCU7DQogIG1hcmdpbi10b3A6IDA7DQogIG1hcmdpbi1ib3R0b206IC0xcHg7DQogIGJvcmRlci1yYWRpdXM6IC4yNXJlbSAuMjVyZW0gMCAwOw0KfQ0KDQouY2hvaWNlc19fbGlzdC0tZHJvcGRvd24gLmNob2ljZXNfX2xpc3Qgew0KICBwb3NpdGlvbjogcmVsYXRpdmU7DQogIG1heC1oZWlnaHQ6IDMwMHB4Ow0KICBvdmVyZmxvdzogYXV0bzsNCiAgLXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6IHRvdWNoOw0KICB3aWxsLWNoYW5nZTogc2Nyb2xsLXBvc2l0aW9uOw0KfQ0KDQouY2hvaWNlc19fbGlzdC0tZHJvcGRvd24gLmNob2ljZXNfX2l0ZW0gew0KICBwb3NpdGlvbjogcmVsYXRpdmU7DQogIHBhZGRpbmc6IDEwcHg7DQogIGZvbnQtc2l6ZTogMTJweDsNCn0NCg0KW2Rpcj0icnRsIl0gLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19pdGVtIHsNCiAgdGV4dC1hbGlnbjogcmlnaHQ7DQp9DQoNCkBtZWRpYSAobWluLXdpZHRoOiA2NDBweCkgew0KICAuY2hvaWNlc19fbGlzdC0tZHJvcGRvd24gLmNob2ljZXNfX2l0ZW0tLXNlbGVjdGFibGUgew0KICAgIHBhZGRpbmctcmlnaHQ6IDEwMHB4Ow0KICB9DQoNCiAgLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19pdGVtLS1zZWxlY3RhYmxlOmFmdGVyIHsNCiAgICBjb250ZW50OiBhdHRyKGRhdGEtc2VsZWN0LXRleHQpOw0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBvcGFjaXR5OiAwOw0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICByaWdodDogMTBweDsNCiAgICB0b3A6IDUwJTsNCiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTUwJSk7DQogIH0NCg0KICBbZGlyPSJydGwiXSAuY2hvaWNlc19fbGlzdC0tZHJvcGRvd24gLmNob2ljZXNfX2l0ZW0tLXNlbGVjdGFibGUgew0KICAgIHRleHQtYWxpZ246IHJpZ2h0Ow0KICAgIHBhZGRpbmctbGVmdDogMTAwcHg7DQogICAgcGFkZGluZy1yaWdodDogMTBweDsNCiAgfQ0KDQogIFtkaXI9InJ0bCJdIC5jaG9pY2VzX19saXN0LS1kcm9wZG93biAuY2hvaWNlc19faXRlbS0tc2VsZWN0YWJsZTphZnRlciB7DQogICAgcmlnaHQ6IGF1dG87DQogICAgbGVmdDogMTBweDsNCiAgfQ0KfQ0KDQouY2hvaWNlc19fbGlzdC0tZHJvcGRvd24gLmNob2ljZXNfX2l0ZW0tLXNlbGVjdGFibGUuaXMtaGlnaGxpZ2h0ZWQgew0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjJmMmYyOw0KfQ0KDQouY2hvaWNlc19fbGlzdC0tZHJvcGRvd24gLmNob2ljZXNfX2l0ZW0tLXNlbGVjdGFibGUuaXMtaGlnaGxpZ2h0ZWQ6YWZ0ZXIgew0KICBvcGFjaXR5OiAuNTsNCn0NCg0KLmNob2ljZXNfX2l0ZW0gew0KICBjdXJzb3I6IGRlZmF1bHQ7DQp9DQoNCi5jaG9pY2VzX19pdGVtLS1zZWxlY3RhYmxlIHsNCiAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KDQouY2hvaWNlc19faXRlbS0tZGlzYWJsZWQgew0KICBjdXJzb3I6IG5vdC1hbGxvd2VkOw0KICB1c2VyLXNlbGVjdDogbm9uZTsNCiAgb3BhY2l0eTogLjU7DQp9DQoNCi5jaG9pY2VzX19oZWFkaW5nIHsNCiAgZm9udC13ZWlnaHQ6IDYwMDsNCiAgZm9udC1zaXplOiAxMnB4Ow0KICBwYWRkaW5nOiAxMHB4Ow0KICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2Y3ZjdmNzsNCiAgY29sb3I6IGdyYXk7DQp9DQoNCi5jaG9pY2VzX19idXR0b24gew0KICB0ZXh0LWluZGVudDogLTk5OTlweDsNCiAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOw0KICBhcHBlYXJhbmNlOiBub25lOw0KICBib3JkZXI6IDA7DQogIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50Ow0KICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0Ow0KICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7DQogIGN1cnNvcjogcG9pbnRlcjsNCn0NCg0KLmNob2ljZXNfX2J1dHRvbjpmb2N1cyB7DQogIG91dGxpbmU6IG5vbmU7DQp9DQoNCi5jaG9pY2VzX19pbnB1dCB7DQogIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOw0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjlmOWY5Ow0KICBmb250LXNpemU6IDEycHg7DQogIG1hcmdpbi1ib3R0b206IDVweDsNCiAgYm9yZGVyOiAwOw0KICBib3JkZXItcmFkaXVzOiAwOw0KICBtYXgtd2lkdGg6IDEwMCU7DQogIHBhZGRpbmc6IDRweCAwIDRweCAycHg7DQp9DQoNCi5jaG9pY2VzX19pbnB1dDpmb2N1cyB7DQogIG91dGxpbmU6IDA7DQp9DQoNCltkaXI9InJ0bCJdIC5jaG9pY2VzX19pbnB1dCB7DQogIHBhZGRpbmctcmlnaHQ6IDJweDsNCiAgcGFkZGluZy1sZWZ0OiAwOw0KfQ0KDQouY2hvaWNlc19fcGxhY2Vob2xkZXIgew0KICBvcGFjaXR5OiAuNTsNCn0NCg0KLmNob2ljZXNfX2lucHV0LmlzLWhpZGRlbiwNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXSAuY2hvaWNlc19faW5wdXQuaXMtaGlkZGVuLA0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW11bHRpcGxlIl0gLmNob2ljZXNfX2lucHV0LmlzLWhpZGRlbiB7DQogIGRpc3BsYXk6IG5vbmU7DQp9DQoNCi8qPT09PT0gIEVuZCBvZiBDaG9pY2VzICA9PT09PT0qLw0KDQogIDwvc3R5bGU+DQogIDxzY3JpcHQ+DQogIC8qISBjaG9pY2VzLmpzIHY0LjEuMiB8IChjKSAyMDE4IEpvc2ggSm9obnNvbiB8IGh0dHBzOi8vZ2l0aHViLmNvbS9qc2hqb2huc29uL0Nob2ljZXMjcmVhZG1lICovDQooZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkgew0KICAgLy9Db21tb25KUzINCglpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpDQoJCW1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOw0KICAgLy9BTUQNCgllbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkNCgkJZGVmaW5lKFtdLCBmYWN0b3J5KTsNCiAgIC8vQ29tbW9uSlMNCgllbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JykNCgkJZXhwb3J0c1siQ2hvaWNlcyJdID0gZmFjdG9yeSgpOw0KICAgLy9XaW5kb3cNCgllbHNlDQoJCXJvb3RbIkNob2ljZXMiXSA9IGZhY3RvcnkoKTsNCn0pKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyA/IHNlbGYgOiB0aGlzLCBmdW5jdGlvbigpIHsNCnJldHVybiAvKioqKioqLyAoZnVuY3Rpb24obW9kdWxlcykgeyAvLyB3ZWJwYWNrQm9vdHN0cmFwDQovKioqKioqLyAJLy8gVGhlIG1vZHVsZSBjYWNoZQ0KLyoqKioqKi8gCXZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307DQovKioqKioqLw0KLyoqKioqKi8gCS8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uDQovKioqKioqLyAJZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgew0KLyoqKioqKi8NCi8qKioqKiovIAkJLy8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlDQovKioqKioqLyAJCWlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7DQovKioqKioqLyAJCQlyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0czsNCi8qKioqKiovIAkJfQ0KLyoqKioqKi8gCQkvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKQ0KLyoqKioqKi8gCQl2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7DQovKioqKioqLyAJCQlpOiBtb2R1bGVJZCwNCi8qKioqKiovIAkJCWw6IGZhbHNlLA0KLyoqKioqKi8gCQkJZXhwb3J0czoge30NCi8qKioqKiovIAkJfTsNCi8qKioqKiovDQovKioqKioqLyAJCS8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvbg0KLyoqKioqKi8gCQltb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTsNCi8qKioqKiovDQovKioqKioqLyAJCS8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWQNCi8qKioqKiovIAkJbW9kdWxlLmwgPSB0cnVlOw0KLyoqKioqKi8NCi8qKioqKiovIAkJLy8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGUNCi8qKioqKiovIAkJcmV0dXJuIG1vZHVsZS5leHBvcnRzOw0KLyoqKioqKi8gCX0NCi8qKioqKiovDQovKioqKioqLw0KLyoqKioqKi8gCS8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pDQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlczsNCi8qKioqKiovDQovKioqKioqLyAJLy8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGUNCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzOw0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHMNCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHsNCi8qKioqKiovIAkJaWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkgew0KLyoqKioqKi8gCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsNCi8qKioqKiovIAkJCQljb25maWd1cmFibGU6IGZhbHNlLA0KLyoqKioqKi8gCQkJCWVudW1lcmFibGU6IHRydWUsDQovKioqKioqLyAJCQkJZ2V0OiBnZXR0ZXINCi8qKioqKiovIAkJCX0pOw0KLyoqKioqKi8gCQl9DQovKioqKioqLyAJfTsNCi8qKioqKiovDQovKioqKioqLyAJLy8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXMNCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHsNCi8qKioqKiovIAkJdmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/DQovKioqKioqLyAJCQlmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOg0KLyoqKioqKi8gCQkJZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTsNCi8qKioqKiovIAkJX193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpOw0KLyoqKioqKi8gCQlyZXR1cm4gZ2V0dGVyOw0KLyoqKioqKi8gCX07DQovKioqKioqLw0KLyoqKioqKi8gCS8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbA0KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTsNCi8qKioqKiovDQovKioqKioqLyAJLy8gX193ZWJwYWNrX3B1YmxpY19wYXRoX18NCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSAiL3B1YmxpYy9hc3NldHMvc2NyaXB0cy8iOw0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHMNCi8qKioqKiovIAlyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAzNyk7DQovKioqKioqLyB9KQ0KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCi8qKioqKiovIChbDQovKiAwICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBzdG9yZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjYpKCd3a3MnKTsNCnZhciB1aWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzKTsNCnZhciBTeW1ib2wgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpLlN5bWJvbDsNCnZhciBVU0VfU1lNQk9MID0gdHlwZW9mIFN5bWJvbCA9PSAnZnVuY3Rpb24nOw0KDQp2YXIgJGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChuYW1lKSB7DQogIHJldHVybiBzdG9yZVtuYW1lXSB8fCAoc3RvcmVbbmFtZV0gPQ0KICAgIFVTRV9TWU1CT0wgJiYgU3ltYm9sW25hbWVdIHx8IChVU0VfU1lNQk9MID8gU3ltYm9sIDogdWlkKSgnU3ltYm9sLicgKyBuYW1lKSk7DQp9Ow0KDQokZXhwb3J0cy5zdG9yZSA9IHN0b3JlOw0KDQoNCi8qKiovIH0pLA0KLyogMSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQovKiBlc2xpbnQtZGlzYWJsZSAqLw0KDQp2YXIgZ2V0UmFuZG9tTnVtYmVyID0gZXhwb3J0cy5nZXRSYW5kb21OdW1iZXIgPSBmdW5jdGlvbiBnZXRSYW5kb21OdW1iZXIobWluLCBtYXgpIHsNCiAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4pICsgbWluKTsNCn07DQoNCnZhciBnZW5lcmF0ZUNoYXJzID0gZXhwb3J0cy5nZW5lcmF0ZUNoYXJzID0gZnVuY3Rpb24gZ2VuZXJhdGVDaGFycyhsZW5ndGgpIHsNCiAgdmFyIGNoYXJzID0gJyc7DQoNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgew0KICAgIHZhciByYW5kb21DaGFyID0gZ2V0UmFuZG9tTnVtYmVyKDAsIDM2KTsNCiAgICBjaGFycyArPSByYW5kb21DaGFyLnRvU3RyaW5nKDM2KTsNCiAgfQ0KDQogIHJldHVybiBjaGFyczsNCn07DQoNCnZhciBnZW5lcmF0ZUlkID0gZXhwb3J0cy5nZW5lcmF0ZUlkID0gZnVuY3Rpb24gZ2VuZXJhdGVJZChlbGVtZW50LCBwcmVmaXgpIHsNCiAgdmFyIGlkID0gZWxlbWVudC5pZCB8fCBlbGVtZW50Lm5hbWUgJiYgZWxlbWVudC5uYW1lICsgJy0nICsgZ2VuZXJhdGVDaGFycygyKSB8fCBnZW5lcmF0ZUNoYXJzKDQpOw0KICBpZCA9IGlkLnJlcGxhY2UoLyg6fFwufFxbfFxdfCwpL2csICcnKTsNCiAgaWQgPSBwcmVmaXggKyAnLScgKyBpZDsNCg0KICByZXR1cm4gaWQ7DQp9Ow0KDQp2YXIgZ2V0VHlwZSA9IGV4cG9ydHMuZ2V0VHlwZSA9IGZ1bmN0aW9uIGdldFR5cGUob2JqKSB7DQogIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKS5zbGljZSg4LCAtMSk7DQp9Ow0KDQp2YXIgaXNUeXBlID0gZXhwb3J0cy5pc1R5cGUgPSBmdW5jdGlvbiBpc1R5cGUodHlwZSwgb2JqKSB7DQogIHZhciBjbGFzID0gZ2V0VHlwZShvYmopOw0KICByZXR1cm4gb2JqICE9PSB1bmRlZmluZWQgJiYgb2JqICE9PSBudWxsICYmIGNsYXMgPT09IHR5cGU7DQp9Ow0KDQp2YXIgaXNFbGVtZW50ID0gZXhwb3J0cy5pc0VsZW1lbnQgPSBmdW5jdGlvbiBpc0VsZW1lbnQoZWxlbWVudCkgew0KICByZXR1cm4gZWxlbWVudCBpbnN0YW5jZW9mIEVsZW1lbnQ7DQp9Ow0KDQp2YXIgZXh0ZW5kID0gZXhwb3J0cy5leHRlbmQgPSBmdW5jdGlvbiBleHRlbmQoKSB7DQogIHZhciBleHRlbmRlZCA9IHt9Ow0KICB2YXIgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsNCg0KICAvKioNCiAgICogTWVyZ2Ugb25lIG9iamVjdCBpbnRvIGFub3RoZXINCiAgICogQHBhcmFtICB7T2JqZWN0fSBvYmogIE9iamVjdCB0byBtZXJnZSBpbnRvIGV4dGVuZGVkIG9iamVjdA0KICAgKi8NCiAgdmFyIG1lcmdlID0gZnVuY3Rpb24gbWVyZ2Uob2JqKSB7DQogICAgZm9yICh2YXIgcHJvcCBpbiBvYmopIHsNCiAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkgew0KICAgICAgICAvLyBJZiBkZWVwIG1lcmdlIGFuZCBwcm9wZXJ0eSBpcyBhbiBvYmplY3QsIG1lcmdlIHByb3BlcnRpZXMNCiAgICAgICAgaWYgKGlzVHlwZSgnT2JqZWN0Jywgb2JqW3Byb3BdKSkgew0KICAgICAgICAgIGV4dGVuZGVkW3Byb3BdID0gZXh0ZW5kKHRydWUsIGV4dGVuZGVkW3Byb3BdLCBvYmpbcHJvcF0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGV4dGVuZGVkW3Byb3BdID0gb2JqW3Byb3BdOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9Ow0KDQogIC8vIExvb3AgdGhyb3VnaCBlYWNoIHBhc3NlZCBhcmd1bWVudA0KICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7DQogICAgLy8gc3RvcmUgYXJndW1lbnQgYXQgcG9zaXRpb24gaQ0KICAgIHZhciBvYmogPSBhcmd1bWVudHNbaV07DQoNCiAgICAvLyBJZiB3ZSBhcmUgaW4gZmFjdCBkZWFsaW5nIHdpdGggYW4gb2JqZWN0LCBtZXJnZSBpdC4NCiAgICBpZiAoaXNUeXBlKCdPYmplY3QnLCBvYmopKSB7DQogICAgICBtZXJnZShvYmopOw0KICAgIH0NCiAgfQ0KDQogIHJldHVybiBleHRlbmRlZDsNCn07DQoNCnZhciB3cmFwID0gZXhwb3J0cy53cmFwID0gZnVuY3Rpb24gd3JhcChlbGVtZW50LCB3cmFwcGVyKSB7DQogIHdyYXBwZXIgPSB3cmFwcGVyIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICBpZiAoZWxlbWVudC5uZXh0U2libGluZykgew0KICAgIGVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUod3JhcHBlciwgZWxlbWVudC5uZXh0U2libGluZyk7DQogIH0gZWxzZSB7DQogICAgZWxlbWVudC5wYXJlbnROb2RlLmFwcGVuZENoaWxkKHdyYXBwZXIpOw0KICB9DQogIHJldHVybiB3cmFwcGVyLmFwcGVuZENoaWxkKGVsZW1lbnQpOw0KfTsNCg0KdmFyIGZpbmRBbmNlc3RvciA9IGV4cG9ydHMuZmluZEFuY2VzdG9yID0gZnVuY3Rpb24gZmluZEFuY2VzdG9yKGVsLCBjbHMpIHsNCiAgd2hpbGUgKChlbCA9IGVsLnBhcmVudEVsZW1lbnQpICYmICFlbC5jbGFzc0xpc3QuY29udGFpbnMoY2xzKSkge30NCiAgcmV0dXJuIGVsOw0KfTsNCg0KdmFyIGZpbmRBbmNlc3RvckJ5QXR0ck5hbWUgPSBleHBvcnRzLmZpbmRBbmNlc3RvckJ5QXR0ck5hbWUgPSBmdW5jdGlvbiBmaW5kQW5jZXN0b3JCeUF0dHJOYW1lKGVsLCBhdHRyKSB7DQogIHZhciB0YXJnZXQgPSBlbDsNCg0KICB3aGlsZSAodGFyZ2V0KSB7DQogICAgaWYgKHRhcmdldC5oYXNBdHRyaWJ1dGUoYXR0cikpIHsNCiAgICAgIHJldHVybiB0YXJnZXQ7DQogICAgfQ0KDQogICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQ7DQogIH0NCg0KICByZXR1cm4gbnVsbDsNCn07DQoNCnZhciBnZXRBZGphY2VudEVsID0gZXhwb3J0cy5nZXRBZGphY2VudEVsID0gZnVuY3Rpb24gZ2V0QWRqYWNlbnRFbChzdGFydEVsLCBjbGFzc05hbWUpIHsNCiAgdmFyIGRpcmVjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogMTsNCg0KICBpZiAoIXN0YXJ0RWwgfHwgIWNsYXNzTmFtZSkgcmV0dXJuOw0KDQogIHZhciBwYXJlbnQgPSBzdGFydEVsLnBhcmVudE5vZGUucGFyZW50Tm9kZTsNCiAgdmFyIGNoaWxkcmVuID0gQXJyYXkuZnJvbShwYXJlbnQucXVlcnlTZWxlY3RvckFsbChjbGFzc05hbWUpKTsNCg0KICB2YXIgc3RhcnRQb3MgPSBjaGlsZHJlbi5pbmRleE9mKHN0YXJ0RWwpOw0KICB2YXIgb3BlcmF0b3JEaXJlY3Rpb24gPSBkaXJlY3Rpb24gPiAwID8gMSA6IC0xOw0KDQogIHJldHVybiBjaGlsZHJlbltzdGFydFBvcyArIG9wZXJhdG9yRGlyZWN0aW9uXTsNCn07DQoNCnZhciBpc1Njcm9sbGVkSW50b1ZpZXcgPSBleHBvcnRzLmlzU2Nyb2xsZWRJbnRvVmlldyA9IGZ1bmN0aW9uIGlzU2Nyb2xsZWRJbnRvVmlldyhlbCwgcGFyZW50KSB7DQogIHZhciBkaXJlY3Rpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IDE7DQoNCiAgaWYgKCFlbCkgcmV0dXJuOw0KDQogIHZhciBpc1Zpc2libGUgPSB2b2lkIDA7DQoNCiAgaWYgKGRpcmVjdGlvbiA+IDApIHsNCiAgICAvLyBJbiB2aWV3IGZyb20gYm90dG9tDQogICAgaXNWaXNpYmxlID0gcGFyZW50LnNjcm9sbFRvcCArIHBhcmVudC5vZmZzZXRIZWlnaHQgPj0gZWwub2Zmc2V0VG9wICsgZWwub2Zmc2V0SGVpZ2h0Ow0KICB9IGVsc2Ugew0KICAgIC8vIEluIHZpZXcgZnJvbSB0b3ANCiAgICBpc1Zpc2libGUgPSBlbC5vZmZzZXRUb3AgPj0gcGFyZW50LnNjcm9sbFRvcDsNCiAgfQ0KDQogIHJldHVybiBpc1Zpc2libGU7DQp9Ow0KDQp2YXIgc3RyaXBIVE1MID0gZXhwb3J0cy5zdHJpcEhUTUwgPSBmdW5jdGlvbiBzdHJpcEhUTUwoaHRtbCkgew0KICByZXR1cm4gaHRtbC5yZXBsYWNlKC8mL2csICcmYW1wOycpLnJlcGxhY2UoLz4vZywgJyZydDsnKS5yZXBsYWNlKC88L2csICcmbHQ7JykucmVwbGFjZSgvIi9nLCAnJnF1b3Q7Jyk7DQp9Ow0KDQp2YXIgc3RyVG9FbCA9IGV4cG9ydHMuc3RyVG9FbCA9IGZ1bmN0aW9uICgpIHsNCiAgdmFyIHRtcEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIHJldHVybiBmdW5jdGlvbiAoc3RyKSB7DQogICAgdmFyIGNsZWFuZWRJbnB1dCA9IHN0ci50cmltKCk7DQogICAgdmFyIHIgPSB2b2lkIDA7DQogICAgdG1wRWwuaW5uZXJIVE1MID0gY2xlYW5lZElucHV0Ow0KICAgIHIgPSB0bXBFbC5jaGlsZHJlblswXTsNCg0KICAgIHdoaWxlICh0bXBFbC5maXJzdENoaWxkKSB7DQogICAgICB0bXBFbC5yZW1vdmVDaGlsZCh0bXBFbC5maXJzdENoaWxkKTsNCiAgICB9DQoNCiAgICByZXR1cm4gcjsNCiAgfTsNCn0oKTsNCg0KLyoqDQogKiBEZXRlcm1pbmVzIHRoZSB3aWR0aCBvZiBhIHBhc3NlZCBpbnB1dCBiYXNlZCBvbiBpdHMgdmFsdWUgYW5kIHBhc3Nlcw0KICogaXQgdG8gdGhlIHN1cHBsaWVkIGNhbGxiYWNrIGZ1bmN0aW9uLg0KICovDQp2YXIgY2FsY1dpZHRoT2ZJbnB1dCA9IGV4cG9ydHMuY2FsY1dpZHRoT2ZJbnB1dCA9IGZ1bmN0aW9uIGNhbGNXaWR0aE9mSW5wdXQoaW5wdXQsIGNhbGxiYWNrKSB7DQogIHZhciB2YWx1ZSA9IGlucHV0LnZhbHVlIHx8IGlucHV0LnBsYWNlaG9sZGVyOw0KICB2YXIgd2lkdGggPSBpbnB1dC5vZmZzZXRXaWR0aDsNCg0KICBpZiAodmFsdWUpIHsNCiAgICB2YXIgdGVzdEVsID0gc3RyVG9FbCgnPHNwYW4+JyArIHN0cmlwSFRNTCh2YWx1ZSkgKyAnPC9zcGFuPicpOw0KICAgIHRlc3RFbC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7DQogICAgdGVzdEVsLnN0eWxlLnBhZGRpbmcgPSAnMCc7DQogICAgdGVzdEVsLnN0eWxlLnRvcCA9ICctOTk5OXB4JzsNCiAgICB0ZXN0RWwuc3R5bGUubGVmdCA9ICctOTk5OXB4JzsNCiAgICB0ZXN0RWwuc3R5bGUud2lkdGggPSAnYXV0byc7DQogICAgdGVzdEVsLnN0eWxlLndoaXRlU3BhY2UgPSAncHJlJzsNCg0KICAgIGlmIChkb2N1bWVudC5ib2R5LmNvbnRhaW5zKGlucHV0KSAmJiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSkgew0KICAgICAgdmFyIGlucHV0U3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShpbnB1dCk7DQoNCiAgICAgIGlmIChpbnB1dFN0eWxlKSB7DQogICAgICAgIHRlc3RFbC5zdHlsZS5mb250U2l6ZSA9IGlucHV0U3R5bGUuZm9udFNpemU7DQogICAgICAgIHRlc3RFbC5zdHlsZS5mb250RmFtaWx5ID0gaW5wdXRTdHlsZS5mb250RmFtaWx5Ow0KICAgICAgICB0ZXN0RWwuc3R5bGUuZm9udFdlaWdodCA9IGlucHV0U3R5bGUuZm9udFdlaWdodDsNCiAgICAgICAgdGVzdEVsLnN0eWxlLmZvbnRTdHlsZSA9IGlucHV0U3R5bGUuZm9udFN0eWxlOw0KICAgICAgICB0ZXN0RWwuc3R5bGUubGV0dGVyU3BhY2luZyA9IGlucHV0U3R5bGUubGV0dGVyU3BhY2luZzsNCiAgICAgICAgdGVzdEVsLnN0eWxlLnRleHRUcmFuc2Zvcm0gPSBpbnB1dFN0eWxlLnRleHRUcmFuc2Zvcm07DQogICAgICAgIHRlc3RFbC5zdHlsZS5wYWRkaW5nID0gaW5wdXRTdHlsZS5wYWRkaW5nOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGVzdEVsKTsNCg0KICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7DQogICAgICBpZiAodmFsdWUgJiYgdGVzdEVsLm9mZnNldFdpZHRoICE9PSBpbnB1dC5vZmZzZXRXaWR0aCkgew0KICAgICAgICB3aWR0aCA9IHRlc3RFbC5vZmZzZXRXaWR0aCArIDQ7DQogICAgICB9DQoNCiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGVzdEVsKTsNCg0KICAgICAgY2FsbGJhY2suY2FsbCh1bmRlZmluZWQsIHdpZHRoICsgJ3B4Jyk7DQogICAgfSk7DQogIH0gZWxzZSB7DQogICAgY2FsbGJhY2suY2FsbCh1bmRlZmluZWQsIHdpZHRoICsgJ3B4Jyk7DQogIH0NCn07DQoNCnZhciBzb3J0QnlBbHBoYSA9IGV4cG9ydHMuc29ydEJ5QWxwaGEgPSBmdW5jdGlvbiBzb3J0QnlBbHBoYShhLCBiKSB7DQogIHZhciBsYWJlbEEgPSAoYS5sYWJlbCB8fCBhLnZhbHVlKS50b0xvd2VyQ2FzZSgpOw0KICB2YXIgbGFiZWxCID0gKGIubGFiZWwgfHwgYi52YWx1ZSkudG9Mb3dlckNhc2UoKTsNCg0KICBpZiAobGFiZWxBIDwgbGFiZWxCKSB7DQogICAgcmV0dXJuIC0xOw0KICB9DQoNCiAgaWYgKGxhYmVsQSA+IGxhYmVsQikgew0KICAgIHJldHVybiAxOw0KICB9DQoNCiAgcmV0dXJuIDA7DQp9Ow0KDQp2YXIgc29ydEJ5U2NvcmUgPSBleHBvcnRzLnNvcnRCeVNjb3JlID0gZnVuY3Rpb24gc29ydEJ5U2NvcmUoYSwgYikgew0KICByZXR1cm4gYS5zY29yZSAtIGIuc2NvcmU7DQp9Ow0KDQp2YXIgZGlzcGF0Y2hFdmVudCA9IGV4cG9ydHMuZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uIGRpc3BhdGNoRXZlbnQoZWxlbWVudCwgdHlwZSkgew0KICB2YXIgY3VzdG9tQXJncyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogbnVsbDsNCg0KICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQodHlwZSwgew0KICAgIGRldGFpbDogY3VzdG9tQXJncywNCiAgICBidWJibGVzOiB0cnVlLA0KICAgIGNhbmNlbGFibGU6IHRydWUNCiAgfSk7DQoNCiAgcmV0dXJuIGVsZW1lbnQuZGlzcGF0Y2hFdmVudChldmVudCk7DQp9Ow0KDQp2YXIgcmVnZXhGaWx0ZXIgPSBleHBvcnRzLnJlZ2V4RmlsdGVyID0gZnVuY3Rpb24gcmVnZXhGaWx0ZXIodmFsdWUsIHJlZ2V4KSB7DQogIGlmICghdmFsdWUgfHwgIXJlZ2V4KSB7DQogICAgcmV0dXJuIGZhbHNlOw0KICB9DQoNCiAgdmFyIGV4cHJlc3Npb24gPSBuZXcgUmVnRXhwKHJlZ2V4LnNvdXJjZSwgJ2knKTsNCiAgcmV0dXJuIGV4cHJlc3Npb24udGVzdCh2YWx1ZSk7DQp9Ow0KDQp2YXIgZ2V0V2luZG93SGVpZ2h0ID0gZXhwb3J0cy5nZXRXaW5kb3dIZWlnaHQgPSBmdW5jdGlvbiBnZXRXaW5kb3dIZWlnaHQoKSB7DQogIHZhciBib2R5ID0gZG9jdW1lbnQuYm9keTsNCiAgdmFyIGh0bWwgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7DQogIHJldHVybiBNYXRoLm1heChib2R5LnNjcm9sbEhlaWdodCwgYm9keS5vZmZzZXRIZWlnaHQsIGh0bWwuY2xpZW50SGVpZ2h0LCBodG1sLnNjcm9sbEhlaWdodCwgaHRtbC5vZmZzZXRIZWlnaHQpOw0KfTsNCg0KdmFyIHJlZHVjZVRvVmFsdWVzID0gZXhwb3J0cy5yZWR1Y2VUb1ZhbHVlcyA9IGZ1bmN0aW9uIHJlZHVjZVRvVmFsdWVzKGl0ZW1zKSB7DQogIHZhciBrZXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICd2YWx1ZSc7DQoNCiAgdmFyIHZhbHVlcyA9IGl0ZW1zLnJlZHVjZShmdW5jdGlvbiAocHJldiwgY3VycmVudCkgew0KICAgIHByZXYucHVzaChjdXJyZW50W2tleV0pOw0KICAgIHJldHVybiBwcmV2Ow0KICB9LCBbXSk7DQoNCiAgcmV0dXJuIHZhbHVlczsNCn07DQoNCnZhciBmZXRjaEZyb21PYmplY3QgPSBleHBvcnRzLmZldGNoRnJvbU9iamVjdCA9IGZ1bmN0aW9uIGZldGNoRnJvbU9iamVjdChvYmplY3QsIHBhdGgpIHsNCiAgdmFyIGluZGV4ID0gcGF0aC5pbmRleE9mKCcuJyk7DQoNCiAgaWYgKGluZGV4ID4gLTEpIHsNCiAgICByZXR1cm4gZmV0Y2hGcm9tT2JqZWN0KG9iamVjdFtwYXRoLnN1YnN0cmluZygwLCBpbmRleCldLCBwYXRoLnN1YnN0cihpbmRleCArIDEpKTsNCiAgfQ0KDQogIHJldHVybiBvYmplY3RbcGF0aF07DQp9Ow0KDQp2YXIgaXNJRTExID0gZXhwb3J0cy5pc0lFMTEgPSBmdW5jdGlvbiBpc0lFMTEoKSB7DQogIHJldHVybiAhIShuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9UcmlkZW50LykgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvcnZbIDpdMTEvKSk7DQp9Ow0KDQp2YXIgZXhpc3RzSW5BcnJheSA9IGV4cG9ydHMuZXhpc3RzSW5BcnJheSA9IGZ1bmN0aW9uIGV4aXN0c0luQXJyYXkoYXJyYXksIHZhbHVlKSB7DQogIHZhciBrZXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICd2YWx1ZSc7DQogIHJldHVybiBhcnJheS5zb21lKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgaWYgKGlzVHlwZSgnU3RyaW5nJywgdmFsdWUpKSB7DQogICAgICByZXR1cm4gaXRlbVtrZXldID09PSB2YWx1ZS50cmltKCk7DQogICAgfQ0KDQogICAgcmV0dXJuIGl0ZW1ba2V5XSA9PT0gdmFsdWU7DQogIH0pOw0KfTsNCg0KdmFyIGNsb25lT2JqZWN0ID0gZXhwb3J0cy5jbG9uZU9iamVjdCA9IGZ1bmN0aW9uIGNsb25lT2JqZWN0KG9iaikgew0KICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTsNCn07DQoNCnZhciBkb0tleXNNYXRjaCA9IGV4cG9ydHMuZG9LZXlzTWF0Y2ggPSBmdW5jdGlvbiBkb0tleXNNYXRjaChhLCBiKSB7DQogIHZhciBhS2V5cyA9IE9iamVjdC5rZXlzKGEpLnNvcnQoKTsNCiAgdmFyIGJLZXlzID0gT2JqZWN0LmtleXMoYikuc29ydCgpOw0KICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoYUtleXMpID09PSBKU09OLnN0cmluZ2lmeShiS2V5cyk7DQp9Ow0KDQovKioqLyB9KSwNCi8qIDIgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KdmFyIGNvcmUgPSBtb2R1bGUuZXhwb3J0cyA9IHsgdmVyc2lvbjogJzIuNS43JyB9Ow0KaWYgKHR5cGVvZiBfX2UgPT0gJ251bWJlcicpIF9fZSA9IGNvcmU7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5kZWYNCg0KDQovKioqLyB9KSwNCi8qIDMgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KLy8gaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMvaXNzdWVzLzg2I2lzc3VlY29tbWVudC0xMTU3NTkwMjgNCnZhciBnbG9iYWwgPSBtb2R1bGUuZXhwb3J0cyA9IHR5cGVvZiB3aW5kb3cgIT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93Lk1hdGggPT0gTWF0aA0KICA/IHdpbmRvdyA6IHR5cGVvZiBzZWxmICE9ICd1bmRlZmluZWQnICYmIHNlbGYuTWF0aCA9PSBNYXRoID8gc2VsZg0KICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tbmV3LWZ1bmMNCiAgOiBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOw0KaWYgKHR5cGVvZiBfX2cgPT0gJ251bWJlcicpIF9fZyA9IGdsb2JhbDsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bmRlZg0KDQoNCi8qKiovIH0pLA0KLyogNCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgZFAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOw0KdmFyIGNyZWF0ZURlc2MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTsNCm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCkgPyBmdW5jdGlvbiAob2JqZWN0LCBrZXksIHZhbHVlKSB7DQogIHJldHVybiBkUC5mKG9iamVjdCwga2V5LCBjcmVhdGVEZXNjKDEsIHZhbHVlKSk7DQp9IDogZnVuY3Rpb24gKG9iamVjdCwga2V5LCB2YWx1ZSkgew0KICBvYmplY3Rba2V5XSA9IHZhbHVlOw0KICByZXR1cm4gb2JqZWN0Ow0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDUgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KZXhwb3J0cy5TQ1JPTExJTkdfU1BFRUQgPSBleHBvcnRzLktFWV9DT0RFUyA9IGV4cG9ydHMuQUNUSU9OX1RZUEVTID0gZXhwb3J0cy5FVkVOVFMgPSBleHBvcnRzLkRFRkFVTFRfQ09ORklHID0gZXhwb3J0cy5ERUZBVUxUX0NMQVNTTkFNRVMgPSB1bmRlZmluZWQ7DQoNCnZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOw0KDQp2YXIgREVGQVVMVF9DTEFTU05BTUVTID0gZXhwb3J0cy5ERUZBVUxUX0NMQVNTTkFNRVMgPSB7DQogIGNvbnRhaW5lck91dGVyOiAnY2hvaWNlcycsDQogIGNvbnRhaW5lcklubmVyOiAnY2hvaWNlc19faW5uZXInLA0KICBpbnB1dDogJ2Nob2ljZXNfX2lucHV0JywNCiAgaW5wdXRDbG9uZWQ6ICdjaG9pY2VzX19pbnB1dC0tY2xvbmVkJywNCiAgbGlzdDogJ2Nob2ljZXNfX2xpc3QnLA0KICBsaXN0SXRlbXM6ICdjaG9pY2VzX19saXN0LS1tdWx0aXBsZScsDQogIGxpc3RTaW5nbGU6ICdjaG9pY2VzX19saXN0LS1zaW5nbGUnLA0KICBsaXN0RHJvcGRvd246ICdjaG9pY2VzX19saXN0LS1kcm9wZG93bicsDQogIGl0ZW06ICdjaG9pY2VzX19pdGVtJywNCiAgaXRlbVNlbGVjdGFibGU6ICdjaG9pY2VzX19pdGVtLS1zZWxlY3RhYmxlJywNCiAgaXRlbURpc2FibGVkOiAnY2hvaWNlc19faXRlbS0tZGlzYWJsZWQnLA0KICBpdGVtQ2hvaWNlOiAnY2hvaWNlc19faXRlbS0tY2hvaWNlJywNCiAgcGxhY2Vob2xkZXI6ICdjaG9pY2VzX19wbGFjZWhvbGRlcicsDQogIGdyb3VwOiAnY2hvaWNlc19fZ3JvdXAnLA0KICBncm91cEhlYWRpbmc6ICdjaG9pY2VzX19oZWFkaW5nJywNCiAgYnV0dG9uOiAnY2hvaWNlc19fYnV0dG9uJywNCiAgYWN0aXZlU3RhdGU6ICdpcy1hY3RpdmUnLA0KICBmb2N1c1N0YXRlOiAnaXMtZm9jdXNlZCcsDQogIG9wZW5TdGF0ZTogJ2lzLW9wZW4nLA0KICBkaXNhYmxlZFN0YXRlOiAnaXMtZGlzYWJsZWQnLA0KICBoaWdobGlnaHRlZFN0YXRlOiAnaXMtaGlnaGxpZ2h0ZWQnLA0KICBoaWRkZW5TdGF0ZTogJ2lzLWhpZGRlbicsDQogIGZsaXBwZWRTdGF0ZTogJ2lzLWZsaXBwZWQnLA0KICBsb2FkaW5nU3RhdGU6ICdpcy1sb2FkaW5nJywNCiAgbm9SZXN1bHRzOiAnaGFzLW5vLXJlc3VsdHMnLA0KICBub0Nob2ljZXM6ICdoYXMtbm8tY2hvaWNlcycNCn07DQoNCnZhciBERUZBVUxUX0NPTkZJRyA9IGV4cG9ydHMuREVGQVVMVF9DT05GSUcgPSB7DQogIGl0ZW1zOiBbXSwNCiAgY2hvaWNlczogW10sDQogIHNpbGVudDogZmFsc2UsDQogIHJlbmRlckNob2ljZUxpbWl0OiAtMSwNCiAgbWF4SXRlbUNvdW50OiAtMSwNCiAgYWRkSXRlbXM6IHRydWUsDQogIHJlbW92ZUl0ZW1zOiB0cnVlLA0KICByZW1vdmVJdGVtQnV0dG9uOiBmYWxzZSwNCiAgZWRpdEl0ZW1zOiBmYWxzZSwNCiAgZHVwbGljYXRlSXRlbXNBbGxvd2VkOiB0cnVlLA0KICBkZWxpbWl0ZXI6ICcsJywNCiAgcGFzdGU6IHRydWUsDQogIHNlYXJjaEVuYWJsZWQ6IHRydWUsDQogIHNlYXJjaENob2ljZXM6IHRydWUsDQogIHNlYXJjaEZsb29yOiAxLA0KICBzZWFyY2hSZXN1bHRMaW1pdDogNCwNCiAgc2VhcmNoRmllbGRzOiBbJ2xhYmVsJywgJ3ZhbHVlJ10sDQogIHBvc2l0aW9uOiAnYXV0bycsDQogIHJlc2V0U2Nyb2xsUG9zaXRpb246IHRydWUsDQogIHJlZ2V4RmlsdGVyOiBudWxsLA0KICBzaG91bGRTb3J0OiB0cnVlLA0KICBzaG91bGRTb3J0SXRlbXM6IGZhbHNlLA0KICBzb3J0Rm46IF91dGlscy5zb3J0QnlBbHBoYSwNCiAgcGxhY2Vob2xkZXI6IHRydWUsDQogIHBsYWNlaG9sZGVyVmFsdWU6IG51bGwsDQogIHNlYXJjaFBsYWNlaG9sZGVyVmFsdWU6IG51bGwsDQogIHByZXBlbmRWYWx1ZTogbnVsbCwNCiAgYXBwZW5kVmFsdWU6IG51bGwsDQogIHJlbmRlclNlbGVjdGVkQ2hvaWNlczogJ2F1dG8nLA0KICBsb2FkaW5nVGV4dDogJ0xvYWRpbmcuLi4nLA0KICBub1Jlc3VsdHNUZXh0OiAnTm8gcmVzdWx0cyBmb3VuZCcsDQogIG5vQ2hvaWNlc1RleHQ6ICdObyBjaG9pY2VzIHRvIGNob29zZSBmcm9tJywNCiAgaXRlbVNlbGVjdFRleHQ6ICdQcmVzcyB0byBzZWxlY3QnLA0KICB1bmlxdWVJdGVtVGV4dDogJ09ubHkgdW5pcXVlIHZhbHVlcyBjYW4gYmUgYWRkZWQnLA0KICBhZGRJdGVtVGV4dDogZnVuY3Rpb24gYWRkSXRlbVRleHQodmFsdWUpIHsNCiAgICByZXR1cm4gJ1ByZXNzIEVudGVyIHRvIGFkZCA8Yj4iJyArICgwLCBfdXRpbHMuc3RyaXBIVE1MKSh2YWx1ZSkgKyAnIjwvYj4nOw0KICB9LA0KICBtYXhJdGVtVGV4dDogZnVuY3Rpb24gbWF4SXRlbVRleHQobWF4SXRlbUNvdW50KSB7DQogICAgcmV0dXJuICdPbmx5ICcgKyBtYXhJdGVtQ291bnQgKyAnIHZhbHVlcyBjYW4gYmUgYWRkZWQnOw0KICB9LA0KICBpdGVtQ29tcGFyZXI6IGZ1bmN0aW9uIGl0ZW1Db21wYXJlcihjaG9pY2UsIGl0ZW0pIHsNCiAgICByZXR1cm4gY2hvaWNlID09PSBpdGVtOw0KICB9LA0KICBmdXNlT3B0aW9uczogew0KICAgIGluY2x1ZGVTY29yZTogdHJ1ZQ0KICB9LA0KICBjYWxsYmFja09uSW5pdDogbnVsbCwNCiAgY2FsbGJhY2tPbkNyZWF0ZVRlbXBsYXRlczogbnVsbCwNCiAgY2xhc3NOYW1lczogREVGQVVMVF9DTEFTU05BTUVTDQp9Ow0KDQp2YXIgRVZFTlRTID0gZXhwb3J0cy5FVkVOVFMgPSB7DQogIHNob3dEcm9wZG93bjogJ3Nob3dEcm9wZG93bicsDQogIGhpZGVEcm9wZG93bjogJ2hpZGVEcm9wZG93bicsDQogIGNoYW5nZTogJ2NoYW5nZScsDQogIGNob2ljZTogJ2Nob2ljZScsDQogIHNlYXJjaDogJ3NlYXJjaCcsDQogIGFkZEl0ZW06ICdhZGRJdGVtJywNCiAgcmVtb3ZlSXRlbTogJ3JlbW92ZUl0ZW0nLA0KICBoaWdobGlnaHRJdGVtOiAnaGlnaGxpZ2h0SXRlbScsDQogIGhpZ2hsaWdodENob2ljZTogJ2hpZ2hsaWdodENob2ljZScNCn07DQoNCnZhciBBQ1RJT05fVFlQRVMgPSBleHBvcnRzLkFDVElPTl9UWVBFUyA9IHsNCiAgQUREX0NIT0lDRTogJ0FERF9DSE9JQ0UnLA0KICBGSUxURVJfQ0hPSUNFUzogJ0ZJTFRFUl9DSE9JQ0VTJywNCiAgQUNUSVZBVEVfQ0hPSUNFUzogJ0FDVElWQVRFX0NIT0lDRVMnLA0KICBDTEVBUl9DSE9JQ0VTOiAnQ0xFQVJfQ0hPSUNFUycsDQogIEFERF9HUk9VUDogJ0FERF9HUk9VUCcsDQogIEFERF9JVEVNOiAnQUREX0lURU0nLA0KICBSRU1PVkVfSVRFTTogJ1JFTU9WRV9JVEVNJywNCiAgSElHSExJR0hUX0lURU06ICdISUdITElHSFRfSVRFTScsDQogIENMRUFSX0FMTDogJ0NMRUFSX0FMTCcNCn07DQoNCnZhciBLRVlfQ09ERVMgPSBleHBvcnRzLktFWV9DT0RFUyA9IHsNCiAgQkFDS19LRVk6IDQ2LA0KICBERUxFVEVfS0VZOiA4LA0KICBFTlRFUl9LRVk6IDEzLA0KICBBX0tFWTogNjUsDQogIEVTQ19LRVk6IDI3LA0KICBVUF9LRVk6IDM4LA0KICBET1dOX0tFWTogNDAsDQogIFBBR0VfVVBfS0VZOiAzMywNCiAgUEFHRV9ET1dOX0tFWTogMzQNCn07DQoNCnZhciBTQ1JPTExJTkdfU1BFRUQgPSBleHBvcnRzLlNDUk9MTElOR19TUEVFRCA9IDQ7DQoNCi8qKiovIH0pLA0KLyogNiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsNCnZhciBjb3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKTsNCnZhciBoaWRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTsNCnZhciByZWRlZmluZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjQpOw0KdmFyIGN0eCA9IF9fd2VicGFja19yZXF1aXJlX18oMTQpOw0KdmFyIFBST1RPVFlQRSA9ICdwcm90b3R5cGUnOw0KDQp2YXIgJGV4cG9ydCA9IGZ1bmN0aW9uICh0eXBlLCBuYW1lLCBzb3VyY2UpIHsNCiAgdmFyIElTX0ZPUkNFRCA9IHR5cGUgJiAkZXhwb3J0LkY7DQogIHZhciBJU19HTE9CQUwgPSB0eXBlICYgJGV4cG9ydC5HOw0KICB2YXIgSVNfU1RBVElDID0gdHlwZSAmICRleHBvcnQuUzsNCiAgdmFyIElTX1BST1RPID0gdHlwZSAmICRleHBvcnQuUDsNCiAgdmFyIElTX0JJTkQgPSB0eXBlICYgJGV4cG9ydC5COw0KICB2YXIgdGFyZ2V0ID0gSVNfR0xPQkFMID8gZ2xvYmFsIDogSVNfU1RBVElDID8gZ2xvYmFsW25hbWVdIHx8IChnbG9iYWxbbmFtZV0gPSB7fSkgOiAoZ2xvYmFsW25hbWVdIHx8IHt9KVtQUk9UT1RZUEVdOw0KICB2YXIgZXhwb3J0cyA9IElTX0dMT0JBTCA/IGNvcmUgOiBjb3JlW25hbWVdIHx8IChjb3JlW25hbWVdID0ge30pOw0KICB2YXIgZXhwUHJvdG8gPSBleHBvcnRzW1BST1RPVFlQRV0gfHwgKGV4cG9ydHNbUFJPVE9UWVBFXSA9IHt9KTsNCiAgdmFyIGtleSwgb3duLCBvdXQsIGV4cDsNCiAgaWYgKElTX0dMT0JBTCkgc291cmNlID0gbmFtZTsNCiAgZm9yIChrZXkgaW4gc291cmNlKSB7DQogICAgLy8gY29udGFpbnMgaW4gbmF0aXZlDQogICAgb3duID0gIUlTX0ZPUkNFRCAmJiB0YXJnZXQgJiYgdGFyZ2V0W2tleV0gIT09IHVuZGVmaW5lZDsNCiAgICAvLyBleHBvcnQgbmF0aXZlIG9yIHBhc3NlZA0KICAgIG91dCA9IChvd24gPyB0YXJnZXQgOiBzb3VyY2UpW2tleV07DQogICAgLy8gYmluZCB0aW1lcnMgdG8gZ2xvYmFsIGZvciBjYWxsIGZyb20gZXhwb3J0IGNvbnRleHQNCiAgICBleHAgPSBJU19CSU5EICYmIG93biA/IGN0eChvdXQsIGdsb2JhbCkgOiBJU19QUk9UTyAmJiB0eXBlb2Ygb3V0ID09ICdmdW5jdGlvbicgPyBjdHgoRnVuY3Rpb24uY2FsbCwgb3V0KSA6IG91dDsNCiAgICAvLyBleHRlbmQgZ2xvYmFsDQogICAgaWYgKHRhcmdldCkgcmVkZWZpbmUodGFyZ2V0LCBrZXksIG91dCwgdHlwZSAmICRleHBvcnQuVSk7DQogICAgLy8gZXhwb3J0DQogICAgaWYgKGV4cG9ydHNba2V5XSAhPSBvdXQpIGhpZGUoZXhwb3J0cywga2V5LCBleHApOw0KICAgIGlmIChJU19QUk9UTyAmJiBleHBQcm90b1trZXldICE9IG91dCkgZXhwUHJvdG9ba2V5XSA9IG91dDsNCiAgfQ0KfTsNCmdsb2JhbC5jb3JlID0gY29yZTsNCi8vIHR5cGUgYml0bWFwDQokZXhwb3J0LkYgPSAxOyAgIC8vIGZvcmNlZA0KJGV4cG9ydC5HID0gMjsgICAvLyBnbG9iYWwNCiRleHBvcnQuUyA9IDQ7ICAgLy8gc3RhdGljDQokZXhwb3J0LlAgPSA4OyAgIC8vIHByb3RvDQokZXhwb3J0LkIgPSAxNjsgIC8vIGJpbmQNCiRleHBvcnQuVyA9IDMyOyAgLy8gd3JhcA0KJGV4cG9ydC5VID0gNjQ7ICAvLyBzYWZlDQokZXhwb3J0LlIgPSAxMjg7IC8vIHJlYWwgcHJvdG8gbWV0aG9kIGZvciBgbGlicmFyeWANCm1vZHVsZS5leHBvcnRzID0gJGV4cG9ydDsNCg0KDQovKioqLyB9KSwNCi8qIDcgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsNCnZhciBJRThfRE9NX0RFRklORSA9IF9fd2VicGFja19yZXF1aXJlX18oNDQpOw0KdmFyIHRvUHJpbWl0aXZlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NSk7DQp2YXIgZFAgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7DQoNCmV4cG9ydHMuZiA9IF9fd2VicGFja19yZXF1aXJlX18oMTApID8gT2JqZWN0LmRlZmluZVByb3BlcnR5IDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoTywgUCwgQXR0cmlidXRlcykgew0KICBhbk9iamVjdChPKTsNCiAgUCA9IHRvUHJpbWl0aXZlKFAsIHRydWUpOw0KICBhbk9iamVjdChBdHRyaWJ1dGVzKTsNCiAgaWYgKElFOF9ET01fREVGSU5FKSB0cnkgew0KICAgIHJldHVybiBkUChPLCBQLCBBdHRyaWJ1dGVzKTsNCiAgfSBjYXRjaCAoZSkgeyAvKiBlbXB0eSAqLyB9DQogIGlmICgnZ2V0JyBpbiBBdHRyaWJ1dGVzIHx8ICdzZXQnIGluIEF0dHJpYnV0ZXMpIHRocm93IFR5cGVFcnJvcignQWNjZXNzb3JzIG5vdCBzdXBwb3J0ZWQhJyk7DQogIGlmICgndmFsdWUnIGluIEF0dHJpYnV0ZXMpIE9bUF0gPSBBdHRyaWJ1dGVzLnZhbHVlOw0KICByZXR1cm4gTzsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA4ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOSk7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgew0KICBpZiAoIWlzT2JqZWN0KGl0KSkgdGhyb3cgVHlwZUVycm9yKGl0ICsgJyBpcyBub3QgYW4gb2JqZWN0IScpOw0KICByZXR1cm4gaXQ7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogOSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgew0KICByZXR1cm4gdHlwZW9mIGl0ID09PSAnb2JqZWN0JyA/IGl0ICE9PSBudWxsIDogdHlwZW9mIGl0ID09PSAnZnVuY3Rpb24nOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDEwICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIFRoYW5rJ3MgSUU4IGZvciBoaXMgZnVubnkgZGVmaW5lUHJvcGVydHkNCm1vZHVsZS5leHBvcnRzID0gIV9fd2VicGFja19yZXF1aXJlX18oMjIpKGZ1bmN0aW9uICgpIHsNCiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgJ2EnLCB7IGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gNzsgfSB9KS5hICE9IDc7DQp9KTsNCg0KDQovKioqLyB9KSwNCi8qIDExICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCnZhciBoYXNPd25Qcm9wZXJ0eSA9IHt9Lmhhc093blByb3BlcnR5Ow0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQsIGtleSkgew0KICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChpdCwga2V5KTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAxMiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChiaXRtYXAsIHZhbHVlKSB7DQogIHJldHVybiB7DQogICAgZW51bWVyYWJsZTogIShiaXRtYXAgJiAxKSwNCiAgICBjb25maWd1cmFibGU6ICEoYml0bWFwICYgMiksDQogICAgd3JpdGFibGU6ICEoYml0bWFwICYgNCksDQogICAgdmFsdWU6IHZhbHVlDQogIH07DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMTMgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KdmFyIGlkID0gMDsNCnZhciBweCA9IE1hdGgucmFuZG9tKCk7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXkpIHsNCiAgcmV0dXJuICdTeW1ib2woJy5jb25jYXQoa2V5ID09PSB1bmRlZmluZWQgPyAnJyA6IGtleSwgJylfJywgKCsraWQgKyBweCkudG9TdHJpbmcoMzYpKTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAxNCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyBvcHRpb25hbCAvIHNpbXBsZSBjb250ZXh0IGJpbmRpbmcNCnZhciBhRnVuY3Rpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2KTsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGZuLCB0aGF0LCBsZW5ndGgpIHsNCiAgYUZ1bmN0aW9uKGZuKTsNCiAgaWYgKHRoYXQgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGZuOw0KICBzd2l0Y2ggKGxlbmd0aCkgew0KICAgIGNhc2UgMTogcmV0dXJuIGZ1bmN0aW9uIChhKSB7DQogICAgICByZXR1cm4gZm4uY2FsbCh0aGF0LCBhKTsNCiAgICB9Ow0KICAgIGNhc2UgMjogcmV0dXJuIGZ1bmN0aW9uIChhLCBiKSB7DQogICAgICByZXR1cm4gZm4uY2FsbCh0aGF0LCBhLCBiKTsNCiAgICB9Ow0KICAgIGNhc2UgMzogcmV0dXJuIGZ1bmN0aW9uIChhLCBiLCBjKSB7DQogICAgICByZXR1cm4gZm4uY2FsbCh0aGF0LCBhLCBiLCBjKTsNCiAgICB9Ow0KICB9DQogIHJldHVybiBmdW5jdGlvbiAoLyogLi4uYXJncyAqLykgew0KICAgIHJldHVybiBmbi5hcHBseSh0aGF0LCBhcmd1bWVudHMpOw0KICB9Ow0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDE1ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCnZhciB0b1N0cmluZyA9IHt9LnRvU3RyaW5nOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgew0KICByZXR1cm4gdG9TdHJpbmcuY2FsbChpdCkuc2xpY2UoOCwgLTEpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDE2ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIDcuMS4xMyBUb09iamVjdChhcmd1bWVudCkNCnZhciBkZWZpbmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNyk7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgew0KICByZXR1cm4gT2JqZWN0KGRlZmluZWQoaXQpKTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAxNyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQovLyA3LjIuMSBSZXF1aXJlT2JqZWN0Q29lcmNpYmxlKGFyZ3VtZW50KQ0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsNCiAgaWYgKGl0ID09IHVuZGVmaW5lZCkgdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBjYWxsIG1ldGhvZCBvbiAgIiArIGl0KTsNCiAgcmV0dXJuIGl0Ow0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDE4ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIDcuMS4xNSBUb0xlbmd0aA0KdmFyIHRvSW50ZWdlciA9IF9fd2VicGFja19yZXF1aXJlX18oMTkpOw0KdmFyIG1pbiA9IE1hdGgubWluOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsNCiAgcmV0dXJuIGl0ID4gMCA/IG1pbih0b0ludGVnZXIoaXQpLCAweDFmZmZmZmZmZmZmZmZmKSA6IDA7IC8vIHBvdygyLCA1MykgLSAxID09IDkwMDcxOTkyNTQ3NDA5OTENCn07DQoNCg0KLyoqKi8gfSksDQovKiAxOSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQovLyA3LjEuNCBUb0ludGVnZXINCnZhciBjZWlsID0gTWF0aC5jZWlsOw0KdmFyIGZsb29yID0gTWF0aC5mbG9vcjsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7DQogIHJldHVybiBpc05hTihpdCA9ICtpdCkgPyAwIDogKGl0ID4gMCA/IGZsb29yIDogY2VpbCkoaXQpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDIwICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCm1vZHVsZS5leHBvcnRzID0ge307DQoNCg0KLyoqKi8gfSksDQovKiAyMSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgc2hhcmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNikoJ2tleXMnKTsNCnZhciB1aWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzKTsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSkgew0KICByZXR1cm4gc2hhcmVkW2tleV0gfHwgKHNoYXJlZFtrZXldID0gdWlkKGtleSkpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDIyICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGV4ZWMpIHsNCiAgdHJ5IHsNCiAgICByZXR1cm4gISFleGVjKCk7DQogIH0gY2F0Y2ggKGUpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDIzICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOSk7DQp2YXIgZG9jdW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpLmRvY3VtZW50Ow0KLy8gdHlwZW9mIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgaXMgJ29iamVjdCcgaW4gb2xkIElFDQp2YXIgaXMgPSBpc09iamVjdChkb2N1bWVudCkgJiYgaXNPYmplY3QoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCk7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgew0KICByZXR1cm4gaXMgPyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGl0KSA6IHt9Ow0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDI0ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOw0KdmFyIGhpZGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpOw0KdmFyIGhhcyA9IF9fd2VicGFja19yZXF1aXJlX18oMTEpOw0KdmFyIFNSQyA9IF9fd2VicGFja19yZXF1aXJlX18oMTMpKCdzcmMnKTsNCnZhciBUT19TVFJJTkcgPSAndG9TdHJpbmcnOw0KdmFyICR0b1N0cmluZyA9IEZ1bmN0aW9uW1RPX1NUUklOR107DQp2YXIgVFBMID0gKCcnICsgJHRvU3RyaW5nKS5zcGxpdChUT19TVFJJTkcpOw0KDQpfX3dlYnBhY2tfcmVxdWlyZV9fKDIpLmluc3BlY3RTb3VyY2UgPSBmdW5jdGlvbiAoaXQpIHsNCiAgcmV0dXJuICR0b1N0cmluZy5jYWxsKGl0KTsNCn07DQoNCihtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChPLCBrZXksIHZhbCwgc2FmZSkgew0KICB2YXIgaXNGdW5jdGlvbiA9IHR5cGVvZiB2YWwgPT0gJ2Z1bmN0aW9uJzsNCiAgaWYgKGlzRnVuY3Rpb24pIGhhcyh2YWwsICduYW1lJykgfHwgaGlkZSh2YWwsICduYW1lJywga2V5KTsNCiAgaWYgKE9ba2V5XSA9PT0gdmFsKSByZXR1cm47DQogIGlmIChpc0Z1bmN0aW9uKSBoYXModmFsLCBTUkMpIHx8IGhpZGUodmFsLCBTUkMsIE9ba2V5XSA/ICcnICsgT1trZXldIDogVFBMLmpvaW4oU3RyaW5nKGtleSkpKTsNCiAgaWYgKE8gPT09IGdsb2JhbCkgew0KICAgIE9ba2V5XSA9IHZhbDsNCiAgfSBlbHNlIGlmICghc2FmZSkgew0KICAgIGRlbGV0ZSBPW2tleV07DQogICAgaGlkZShPLCBrZXksIHZhbCk7DQogIH0gZWxzZSBpZiAoT1trZXldKSB7DQogICAgT1trZXldID0gdmFsOw0KICB9IGVsc2Ugew0KICAgIGhpZGUoTywga2V5LCB2YWwpOw0KICB9DQovLyBhZGQgZmFrZSBGdW5jdGlvbiN0b1N0cmluZyBmb3IgY29ycmVjdCB3b3JrIHdyYXBwZWQgbWV0aG9kcyAvIGNvbnN0cnVjdG9ycyB3aXRoIG1ldGhvZHMgbGlrZSBMb0Rhc2ggaXNOYXRpdmUNCn0pKEZ1bmN0aW9uLnByb3RvdHlwZSwgVE9fU1RSSU5HLCBmdW5jdGlvbiB0b1N0cmluZygpIHsNCiAgcmV0dXJuIHR5cGVvZiB0aGlzID09ICdmdW5jdGlvbicgJiYgdGhpc1tTUkNdIHx8ICR0b1N0cmluZy5jYWxsKHRoaXMpOw0KfSk7DQoNCg0KLyoqKi8gfSksDQovKiAyNSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyBmYWxsYmFjayBmb3Igbm9uLWFycmF5LWxpa2UgRVMzIGFuZCBub24tZW51bWVyYWJsZSBvbGQgVjggc3RyaW5ncw0KdmFyIGNvZiA9IF9fd2VicGFja19yZXF1aXJlX18oMTUpOw0KLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXByb3RvdHlwZS1idWlsdGlucw0KbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QoJ3onKS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgwKSA/IE9iamVjdCA6IGZ1bmN0aW9uIChpdCkgew0KICByZXR1cm4gY29mKGl0KSA9PSAnU3RyaW5nJyA/IGl0LnNwbGl0KCcnKSA6IE9iamVjdChpdCk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMjYgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIGNvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOw0KdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7DQp2YXIgU0hBUkVEID0gJ19fY29yZS1qc19zaGFyZWRfXyc7DQp2YXIgc3RvcmUgPSBnbG9iYWxbU0hBUkVEXSB8fCAoZ2xvYmFsW1NIQVJFRF0gPSB7fSk7DQoNCihtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7DQogIHJldHVybiBzdG9yZVtrZXldIHx8IChzdG9yZVtrZXldID0gdmFsdWUgIT09IHVuZGVmaW5lZCA/IHZhbHVlIDoge30pOw0KfSkoJ3ZlcnNpb25zJywgW10pLnB1c2goew0KICB2ZXJzaW9uOiBjb3JlLnZlcnNpb24sDQogIG1vZGU6IF9fd2VicGFja19yZXF1aXJlX18oMjcpID8gJ3B1cmUnIDogJ2dsb2JhbCcsDQogIGNvcHlyaWdodDogJ8KpIDIwMTggRGVuaXMgUHVzaGthcmV2ICh6bG9pcm9jay5ydSknDQp9KTsNCg0KDQovKioqLyB9KSwNCi8qIDI3ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCm1vZHVsZS5leHBvcnRzID0gZmFsc2U7DQoNCg0KLyoqKi8gfSksDQovKiAyOCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyAyMi4xLjMuMzEgQXJyYXkucHJvdG90eXBlW0BAdW5zY29wYWJsZXNdDQp2YXIgVU5TQ09QQUJMRVMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApKCd1bnNjb3BhYmxlcycpOw0KdmFyIEFycmF5UHJvdG8gPSBBcnJheS5wcm90b3R5cGU7DQppZiAoQXJyYXlQcm90b1tVTlNDT1BBQkxFU10gPT0gdW5kZWZpbmVkKSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpKEFycmF5UHJvdG8sIFVOU0NPUEFCTEVTLCB7fSk7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXkpIHsNCiAgQXJyYXlQcm90b1tVTlNDT1BBQkxFU11ba2V5XSA9IHRydWU7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMjkgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gdG8gaW5kZXhlZCBvYmplY3QsIHRvT2JqZWN0IHdpdGggZmFsbGJhY2sgZm9yIG5vbi1hcnJheS1saWtlIEVTMyBzdHJpbmdzDQp2YXIgSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjUpOw0KdmFyIGRlZmluZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3KTsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7DQogIHJldHVybiBJT2JqZWN0KGRlZmluZWQoaXQpKTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAzMCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyBmYWxzZSAtPiBBcnJheSNpbmRleE9mDQovLyB0cnVlICAtPiBBcnJheSNpbmNsdWRlcw0KdmFyIHRvSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjkpOw0KdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOCk7DQp2YXIgdG9BYnNvbHV0ZUluZGV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MCk7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChJU19JTkNMVURFUykgew0KICByZXR1cm4gZnVuY3Rpb24gKCR0aGlzLCBlbCwgZnJvbUluZGV4KSB7DQogICAgdmFyIE8gPSB0b0lPYmplY3QoJHRoaXMpOw0KICAgIHZhciBsZW5ndGggPSB0b0xlbmd0aChPLmxlbmd0aCk7DQogICAgdmFyIGluZGV4ID0gdG9BYnNvbHV0ZUluZGV4KGZyb21JbmRleCwgbGVuZ3RoKTsNCiAgICB2YXIgdmFsdWU7DQogICAgLy8gQXJyYXkjaW5jbHVkZXMgdXNlcyBTYW1lVmFsdWVaZXJvIGVxdWFsaXR5IGFsZ29yaXRobQ0KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUNCiAgICBpZiAoSVNfSU5DTFVERVMgJiYgZWwgIT0gZWwpIHdoaWxlIChsZW5ndGggPiBpbmRleCkgew0KICAgICAgdmFsdWUgPSBPW2luZGV4KytdOw0KICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZQ0KICAgICAgaWYgKHZhbHVlICE9IHZhbHVlKSByZXR1cm4gdHJ1ZTsNCiAgICAvLyBBcnJheSNpbmRleE9mIGlnbm9yZXMgaG9sZXMsIEFycmF5I2luY2x1ZGVzIC0gbm90DQogICAgfSBlbHNlIGZvciAoO2xlbmd0aCA+IGluZGV4OyBpbmRleCsrKSBpZiAoSVNfSU5DTFVERVMgfHwgaW5kZXggaW4gTykgew0KICAgICAgaWYgKE9baW5kZXhdID09PSBlbCkgcmV0dXJuIElTX0lOQ0xVREVTIHx8IGluZGV4IHx8IDA7DQogICAgfSByZXR1cm4gIUlTX0lOQ0xVREVTICYmIC0xOw0KICB9Ow0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDMxICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCi8vIElFIDgtIGRvbid0IGVudW0gYnVnIGtleXMNCm1vZHVsZS5leHBvcnRzID0gKA0KICAnY29uc3RydWN0b3IsaGFzT3duUHJvcGVydHksaXNQcm90b3R5cGVPZixwcm9wZXJ0eUlzRW51bWVyYWJsZSx0b0xvY2FsZVN0cmluZyx0b1N0cmluZyx2YWx1ZU9mJw0KKS5zcGxpdCgnLCcpOw0KDQoNCi8qKiovIH0pLA0KLyogMzIgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIGRlZiA9IF9fd2VicGFja19yZXF1aXJlX18oNykuZjsNCnZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKTsNCnZhciBUQUcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApKCd0b1N0cmluZ1RhZycpOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwgdGFnLCBzdGF0KSB7DQogIGlmIChpdCAmJiAhaGFzKGl0ID0gc3RhdCA/IGl0IDogaXQucHJvdG90eXBlLCBUQUcpKSBkZWYoaXQsIFRBRywgeyBjb25maWd1cmFibGU6IHRydWUsIHZhbHVlOiB0YWcgfSk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMzMgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KT2JqZWN0LmRlZmluZVByb3BlcnR5KF9fd2VicGFja19leHBvcnRzX18sICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsNCg0KLy8gRVhURVJOQUwgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2ZyZWVHbG9iYWwuanMNCnZhciBfZnJlZUdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oNzQpOw0KDQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX3Jvb3QuanMNCg0KDQovKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYHNlbGZgLiAqLw0KdmFyIGZyZWVTZWxmID0gdHlwZW9mIHNlbGYgPT0gJ29iamVjdCcgJiYgc2VsZiAmJiBzZWxmLk9iamVjdCA9PT0gT2JqZWN0ICYmIHNlbGY7DQoNCi8qKiBVc2VkIGFzIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0LiAqLw0KdmFyIHJvb3QgPSBfZnJlZUdsb2JhbFsiYSIgLyogZGVmYXVsdCAqL10gfHwgZnJlZVNlbGYgfHwgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTsNCg0KLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgX3Jvb3QgPSAocm9vdCk7DQoNCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fU3ltYm9sLmpzDQoNCg0KLyoqIEJ1aWx0LWluIHZhbHVlIHJlZmVyZW5jZXMuICovDQp2YXIgU3ltYm9sID0gX3Jvb3QuU3ltYm9sOw0KDQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBfU3ltYm9sID0gKFN5bWJvbCk7DQoNCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fZ2V0UmF3VGFnLmpzDQoNCg0KLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqLw0KdmFyIG9iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTsNCg0KLyoqIFVzZWQgdG8gY2hlY2sgb2JqZWN0cyBmb3Igb3duIHByb3BlcnRpZXMuICovDQp2YXIgX2dldFJhd1RhZ19oYXNPd25Qcm9wZXJ0eSA9IG9iamVjdFByb3RvLmhhc093blByb3BlcnR5Ow0KDQovKioNCiAqIFVzZWQgdG8gcmVzb2x2ZSB0aGUNCiAqIFtgdG9TdHJpbmdUYWdgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3QucHJvdG90eXBlLnRvc3RyaW5nKQ0KICogb2YgdmFsdWVzLg0KICovDQp2YXIgbmF0aXZlT2JqZWN0VG9TdHJpbmcgPSBvYmplY3RQcm90by50b1N0cmluZzsNCg0KLyoqIEJ1aWx0LWluIHZhbHVlIHJlZmVyZW5jZXMuICovDQp2YXIgc3ltVG9TdHJpbmdUYWcgPSBfU3ltYm9sID8gX1N5bWJvbC50b1N0cmluZ1RhZyA6IHVuZGVmaW5lZDsNCg0KLyoqDQogKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VHZXRUYWdgIHdoaWNoIGlnbm9yZXMgYFN5bWJvbC50b1N0cmluZ1RhZ2AgdmFsdWVzLg0KICoNCiAqIEBwcml2YXRlDQogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBxdWVyeS4NCiAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHJhdyBgdG9TdHJpbmdUYWdgLg0KICovDQpmdW5jdGlvbiBnZXRSYXdUYWcodmFsdWUpIHsNCiAgdmFyIGlzT3duID0gX2dldFJhd1RhZ19oYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBzeW1Ub1N0cmluZ1RhZyksDQogICAgICB0YWcgPSB2YWx1ZVtzeW1Ub1N0cmluZ1RhZ107DQoNCiAgdHJ5IHsNCiAgICB2YWx1ZVtzeW1Ub1N0cmluZ1RhZ10gPSB1bmRlZmluZWQ7DQogICAgdmFyIHVubWFza2VkID0gdHJ1ZTsNCiAgfSBjYXRjaCAoZSkge30NCg0KICB2YXIgcmVzdWx0ID0gbmF0aXZlT2JqZWN0VG9TdHJpbmcuY2FsbCh2YWx1ZSk7DQogIGlmICh1bm1hc2tlZCkgew0KICAgIGlmIChpc093bikgew0KICAgICAgdmFsdWVbc3ltVG9TdHJpbmdUYWddID0gdGFnOw0KICAgIH0gZWxzZSB7DQogICAgICBkZWxldGUgdmFsdWVbc3ltVG9TdHJpbmdUYWddOw0KICAgIH0NCiAgfQ0KICByZXR1cm4gcmVzdWx0Ow0KfQ0KDQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBfZ2V0UmF3VGFnID0gKGdldFJhd1RhZyk7DQoNCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fb2JqZWN0VG9TdHJpbmcuanMNCi8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi8NCnZhciBfb2JqZWN0VG9TdHJpbmdfb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOw0KDQovKioNCiAqIFVzZWQgdG8gcmVzb2x2ZSB0aGUNCiAqIFtgdG9TdHJpbmdUYWdgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3QucHJvdG90eXBlLnRvc3RyaW5nKQ0KICogb2YgdmFsdWVzLg0KICovDQp2YXIgX29iamVjdFRvU3RyaW5nX25hdGl2ZU9iamVjdFRvU3RyaW5nID0gX29iamVjdFRvU3RyaW5nX29iamVjdFByb3RvLnRvU3RyaW5nOw0KDQovKioNCiAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBzdHJpbmcgdXNpbmcgYE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmdgLg0KICoNCiAqIEBwcml2YXRlDQogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0Lg0KICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgY29udmVydGVkIHN0cmluZy4NCiAqLw0KZnVuY3Rpb24gb2JqZWN0VG9TdHJpbmcodmFsdWUpIHsNCiAgcmV0dXJuIF9vYmplY3RUb1N0cmluZ19uYXRpdmVPYmplY3RUb1N0cmluZy5jYWxsKHZhbHVlKTsNCn0NCg0KLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgX29iamVjdFRvU3RyaW5nID0gKG9iamVjdFRvU3RyaW5nKTsNCg0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19iYXNlR2V0VGFnLmpzDQoNCg0KDQoNCi8qKiBgT2JqZWN0I3RvU3RyaW5nYCByZXN1bHQgcmVmZXJlbmNlcy4gKi8NCnZhciBudWxsVGFnID0gJ1tvYmplY3QgTnVsbF0nLA0KICAgIHVuZGVmaW5lZFRhZyA9ICdbb2JqZWN0IFVuZGVmaW5lZF0nOw0KDQovKiogQnVpbHQtaW4gdmFsdWUgcmVmZXJlbmNlcy4gKi8NCnZhciBfYmFzZUdldFRhZ19zeW1Ub1N0cmluZ1RhZyA9IF9TeW1ib2wgPyBfU3ltYm9sLnRvU3RyaW5nVGFnIDogdW5kZWZpbmVkOw0KDQovKioNCiAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBnZXRUYWdgIHdpdGhvdXQgZmFsbGJhY2tzIGZvciBidWdneSBlbnZpcm9ubWVudHMuDQogKg0KICogQHByaXZhdGUNCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHF1ZXJ5Lg0KICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgYHRvU3RyaW5nVGFnYC4NCiAqLw0KZnVuY3Rpb24gYmFzZUdldFRhZyh2YWx1ZSkgew0KICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgIHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkVGFnIDogbnVsbFRhZzsNCiAgfQ0KICByZXR1cm4gKF9iYXNlR2V0VGFnX3N5bVRvU3RyaW5nVGFnICYmIF9iYXNlR2V0VGFnX3N5bVRvU3RyaW5nVGFnIGluIE9iamVjdCh2YWx1ZSkpDQogICAgPyBfZ2V0UmF3VGFnKHZhbHVlKQ0KICAgIDogX29iamVjdFRvU3RyaW5nKHZhbHVlKTsNCn0NCg0KLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgX2Jhc2VHZXRUYWcgPSAoYmFzZUdldFRhZyk7DQoNCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fb3ZlckFyZy5qcw0KLyoqDQogKiBDcmVhdGVzIGEgdW5hcnkgZnVuY3Rpb24gdGhhdCBpbnZva2VzIGBmdW5jYCB3aXRoIGl0cyBhcmd1bWVudCB0cmFuc2Zvcm1lZC4NCiAqDQogKiBAcHJpdmF0ZQ0KICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gd3JhcC4NCiAqIEBwYXJhbSB7RnVuY3Rpb259IHRyYW5zZm9ybSBUaGUgYXJndW1lbnQgdHJhbnNmb3JtLg0KICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uDQogKi8NCmZ1bmN0aW9uIG92ZXJBcmcoZnVuYywgdHJhbnNmb3JtKSB7DQogIHJldHVybiBmdW5jdGlvbihhcmcpIHsNCiAgICByZXR1cm4gZnVuYyh0cmFuc2Zvcm0oYXJnKSk7DQogIH07DQp9DQoNCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIF9vdmVyQXJnID0gKG92ZXJBcmcpOw0KDQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2dldFByb3RvdHlwZS5qcw0KDQoNCi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLw0KdmFyIGdldFByb3RvdHlwZSA9IF9vdmVyQXJnKE9iamVjdC5nZXRQcm90b3R5cGVPZiwgT2JqZWN0KTsNCg0KLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgX2dldFByb3RvdHlwZSA9IChnZXRQcm90b3R5cGUpOw0KDQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvaXNPYmplY3RMaWtlLmpzDQovKioNCiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLiBBIHZhbHVlIGlzIG9iamVjdC1saWtlIGlmIGl0J3Mgbm90IGBudWxsYA0KICogYW5kIGhhcyBhIGB0eXBlb2ZgIHJlc3VsdCBvZiAib2JqZWN0Ii4NCiAqDQogKiBAc3RhdGljDQogKiBAbWVtYmVyT2YgXw0KICogQHNpbmNlIDQuMC4wDQogKiBAY2F0ZWdvcnkgTGFuZw0KICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suDQogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBvYmplY3QtbGlrZSwgZWxzZSBgZmFsc2VgLg0KICogQGV4YW1wbGUNCiAqDQogKiBfLmlzT2JqZWN0TGlrZSh7fSk7DQogKiAvLyA9PiB0cnVlDQogKg0KICogXy5pc09iamVjdExpa2UoWzEsIDIsIDNdKTsNCiAqIC8vID0+IHRydWUNCiAqDQogKiBfLmlzT2JqZWN0TGlrZShfLm5vb3ApOw0KICogLy8gPT4gZmFsc2UNCiAqDQogKiBfLmlzT2JqZWN0TGlrZShudWxsKTsNCiAqIC8vID0+IGZhbHNlDQogKi8NCmZ1bmN0aW9uIGlzT2JqZWN0TGlrZSh2YWx1ZSkgew0KICByZXR1cm4gdmFsdWUgIT0gbnVsbCAmJiB0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCc7DQp9DQoNCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGxvZGFzaF9lc19pc09iamVjdExpa2UgPSAoaXNPYmplY3RMaWtlKTsNCg0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL2lzUGxhaW5PYmplY3QuanMNCg0KDQoNCg0KLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqLw0KdmFyIG9iamVjdFRhZyA9ICdbb2JqZWN0IE9iamVjdF0nOw0KDQovKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovDQp2YXIgZnVuY1Byb3RvID0gRnVuY3Rpb24ucHJvdG90eXBlLA0KICAgIGlzUGxhaW5PYmplY3Rfb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOw0KDQovKiogVXNlZCB0byByZXNvbHZlIHRoZSBkZWNvbXBpbGVkIHNvdXJjZSBvZiBmdW5jdGlvbnMuICovDQp2YXIgZnVuY1RvU3RyaW5nID0gZnVuY1Byb3RvLnRvU3RyaW5nOw0KDQovKiogVXNlZCB0byBjaGVjayBvYmplY3RzIGZvciBvd24gcHJvcGVydGllcy4gKi8NCnZhciBpc1BsYWluT2JqZWN0X2hhc093blByb3BlcnR5ID0gaXNQbGFpbk9iamVjdF9vYmplY3RQcm90by5oYXNPd25Qcm9wZXJ0eTsNCg0KLyoqIFVzZWQgdG8gaW5mZXIgdGhlIGBPYmplY3RgIGNvbnN0cnVjdG9yLiAqLw0KdmFyIG9iamVjdEN0b3JTdHJpbmcgPSBmdW5jVG9TdHJpbmcuY2FsbChPYmplY3QpOw0KDQovKioNCiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgcGxhaW4gb2JqZWN0LCB0aGF0IGlzLCBhbiBvYmplY3QgY3JlYXRlZCBieSB0aGUNCiAqIGBPYmplY3RgIGNvbnN0cnVjdG9yIG9yIG9uZSB3aXRoIGEgYFtbUHJvdG90eXBlXV1gIG9mIGBudWxsYC4NCiAqDQogKiBAc3RhdGljDQogKiBAbWVtYmVyT2YgXw0KICogQHNpbmNlIDAuOC4wDQogKiBAY2F0ZWdvcnkgTGFuZw0KICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suDQogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHBsYWluIG9iamVjdCwgZWxzZSBgZmFsc2VgLg0KICogQGV4YW1wbGUNCiAqDQogKiBmdW5jdGlvbiBGb28oKSB7DQogKiAgIHRoaXMuYSA9IDE7DQogKiB9DQogKg0KICogXy5pc1BsYWluT2JqZWN0KG5ldyBGb28pOw0KICogLy8gPT4gZmFsc2UNCiAqDQogKiBfLmlzUGxhaW5PYmplY3QoWzEsIDIsIDNdKTsNCiAqIC8vID0+IGZhbHNlDQogKg0KICogXy5pc1BsYWluT2JqZWN0KHsgJ3gnOiAwLCAneSc6IDAgfSk7DQogKiAvLyA9PiB0cnVlDQogKg0KICogXy5pc1BsYWluT2JqZWN0KE9iamVjdC5jcmVhdGUobnVsbCkpOw0KICogLy8gPT4gdHJ1ZQ0KICovDQpmdW5jdGlvbiBpc1BsYWluT2JqZWN0KHZhbHVlKSB7DQogIGlmICghbG9kYXNoX2VzX2lzT2JqZWN0TGlrZSh2YWx1ZSkgfHwgX2Jhc2VHZXRUYWcodmFsdWUpICE9IG9iamVjdFRhZykgew0KICAgIHJldHVybiBmYWxzZTsNCiAgfQ0KICB2YXIgcHJvdG8gPSBfZ2V0UHJvdG90eXBlKHZhbHVlKTsNCiAgaWYgKHByb3RvID09PSBudWxsKSB7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCiAgdmFyIEN0b3IgPSBpc1BsYWluT2JqZWN0X2hhc093blByb3BlcnR5LmNhbGwocHJvdG8sICdjb25zdHJ1Y3RvcicpICYmIHByb3RvLmNvbnN0cnVjdG9yOw0KICByZXR1cm4gdHlwZW9mIEN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBDdG9yIGluc3RhbmNlb2YgQ3RvciAmJg0KICAgIGZ1bmNUb1N0cmluZy5jYWxsKEN0b3IpID09IG9iamVjdEN0b3JTdHJpbmc7DQp9DQoNCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGxvZGFzaF9lc19pc1BsYWluT2JqZWN0ID0gKGlzUGxhaW5PYmplY3QpOw0KDQovLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3N5bWJvbC1vYnNlcnZhYmxlL2VzL2luZGV4LmpzDQp2YXIgZXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc1KTsNCg0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVkdXgvZXMvY3JlYXRlU3RvcmUuanMNCg0KDQoNCi8qKg0KICogVGhlc2UgYXJlIHByaXZhdGUgYWN0aW9uIHR5cGVzIHJlc2VydmVkIGJ5IFJlZHV4Lg0KICogRm9yIGFueSB1bmtub3duIGFjdGlvbnMsIHlvdSBtdXN0IHJldHVybiB0aGUgY3VycmVudCBzdGF0ZS4NCiAqIElmIHRoZSBjdXJyZW50IHN0YXRlIGlzIHVuZGVmaW5lZCwgeW91IG11c3QgcmV0dXJuIHRoZSBpbml0aWFsIHN0YXRlLg0KICogRG8gbm90IHJlZmVyZW5jZSB0aGVzZSBhY3Rpb24gdHlwZXMgZGlyZWN0bHkgaW4geW91ciBjb2RlLg0KICovDQp2YXIgQWN0aW9uVHlwZXMgPSB7DQogIElOSVQ6ICdAQHJlZHV4L0lOSVQnDQoNCiAgLyoqDQogICAqIENyZWF0ZXMgYSBSZWR1eCBzdG9yZSB0aGF0IGhvbGRzIHRoZSBzdGF0ZSB0cmVlLg0KICAgKiBUaGUgb25seSB3YXkgdG8gY2hhbmdlIHRoZSBkYXRhIGluIHRoZSBzdG9yZSBpcyB0byBjYWxsIGBkaXNwYXRjaCgpYCBvbiBpdC4NCiAgICoNCiAgICogVGhlcmUgc2hvdWxkIG9ubHkgYmUgYSBzaW5nbGUgc3RvcmUgaW4geW91ciBhcHAuIFRvIHNwZWNpZnkgaG93IGRpZmZlcmVudA0KICAgKiBwYXJ0cyBvZiB0aGUgc3RhdGUgdHJlZSByZXNwb25kIHRvIGFjdGlvbnMsIHlvdSBtYXkgY29tYmluZSBzZXZlcmFsIHJlZHVjZXJzDQogICAqIGludG8gYSBzaW5nbGUgcmVkdWNlciBmdW5jdGlvbiBieSB1c2luZyBgY29tYmluZVJlZHVjZXJzYC4NCiAgICoNCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcmVkdWNlciBBIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgbmV4dCBzdGF0ZSB0cmVlLCBnaXZlbg0KICAgKiB0aGUgY3VycmVudCBzdGF0ZSB0cmVlIGFuZCB0aGUgYWN0aW9uIHRvIGhhbmRsZS4NCiAgICoNCiAgICogQHBhcmFtIHthbnl9IFtwcmVsb2FkZWRTdGF0ZV0gVGhlIGluaXRpYWwgc3RhdGUuIFlvdSBtYXkgb3B0aW9uYWxseSBzcGVjaWZ5IGl0DQogICAqIHRvIGh5ZHJhdGUgdGhlIHN0YXRlIGZyb20gdGhlIHNlcnZlciBpbiB1bml2ZXJzYWwgYXBwcywgb3IgdG8gcmVzdG9yZSBhDQogICAqIHByZXZpb3VzbHkgc2VyaWFsaXplZCB1c2VyIHNlc3Npb24uDQogICAqIElmIHlvdSB1c2UgYGNvbWJpbmVSZWR1Y2Vyc2AgdG8gcHJvZHVjZSB0aGUgcm9vdCByZWR1Y2VyIGZ1bmN0aW9uLCB0aGlzIG11c3QgYmUNCiAgICogYW4gb2JqZWN0IHdpdGggdGhlIHNhbWUgc2hhcGUgYXMgYGNvbWJpbmVSZWR1Y2Vyc2Aga2V5cy4NCiAgICoNCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2VuaGFuY2VyXSBUaGUgc3RvcmUgZW5oYW5jZXIuIFlvdSBtYXkgb3B0aW9uYWxseSBzcGVjaWZ5IGl0DQogICAqIHRvIGVuaGFuY2UgdGhlIHN0b3JlIHdpdGggdGhpcmQtcGFydHkgY2FwYWJpbGl0aWVzIHN1Y2ggYXMgbWlkZGxld2FyZSwNCiAgICogdGltZSB0cmF2ZWwsIHBlcnNpc3RlbmNlLCBldGMuIFRoZSBvbmx5IHN0b3JlIGVuaGFuY2VyIHRoYXQgc2hpcHMgd2l0aCBSZWR1eA0KICAgKiBpcyBgYXBwbHlNaWRkbGV3YXJlKClgLg0KICAgKg0KICAgKiBAcmV0dXJucyB7U3RvcmV9IEEgUmVkdXggc3RvcmUgdGhhdCBsZXRzIHlvdSByZWFkIHRoZSBzdGF0ZSwgZGlzcGF0Y2ggYWN0aW9ucw0KICAgKiBhbmQgc3Vic2NyaWJlIHRvIGNoYW5nZXMuDQogICAqLw0KfTtmdW5jdGlvbiBjcmVhdGVTdG9yZV9jcmVhdGVTdG9yZShyZWR1Y2VyLCBwcmVsb2FkZWRTdGF0ZSwgZW5oYW5jZXIpIHsNCiAgdmFyIF9yZWYyOw0KDQogIGlmICh0eXBlb2YgcHJlbG9hZGVkU3RhdGUgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGVuaGFuY2VyID09PSAndW5kZWZpbmVkJykgew0KICAgIGVuaGFuY2VyID0gcHJlbG9hZGVkU3RhdGU7DQogICAgcHJlbG9hZGVkU3RhdGUgPSB1bmRlZmluZWQ7DQogIH0NCg0KICBpZiAodHlwZW9mIGVuaGFuY2VyICE9PSAndW5kZWZpbmVkJykgew0KICAgIGlmICh0eXBlb2YgZW5oYW5jZXIgIT09ICdmdW5jdGlvbicpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcignRXhwZWN0ZWQgdGhlIGVuaGFuY2VyIHRvIGJlIGEgZnVuY3Rpb24uJyk7DQogICAgfQ0KDQogICAgcmV0dXJuIGVuaGFuY2VyKGNyZWF0ZVN0b3JlX2NyZWF0ZVN0b3JlKShyZWR1Y2VyLCBwcmVsb2FkZWRTdGF0ZSk7DQogIH0NCg0KICBpZiAodHlwZW9mIHJlZHVjZXIgIT09ICdmdW5jdGlvbicpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIHRoZSByZWR1Y2VyIHRvIGJlIGEgZnVuY3Rpb24uJyk7DQogIH0NCg0KICB2YXIgY3VycmVudFJlZHVjZXIgPSByZWR1Y2VyOw0KICB2YXIgY3VycmVudFN0YXRlID0gcHJlbG9hZGVkU3RhdGU7DQogIHZhciBjdXJyZW50TGlzdGVuZXJzID0gW107DQogIHZhciBuZXh0TGlzdGVuZXJzID0gY3VycmVudExpc3RlbmVyczsNCiAgdmFyIGlzRGlzcGF0Y2hpbmcgPSBmYWxzZTsNCg0KICBmdW5jdGlvbiBlbnN1cmVDYW5NdXRhdGVOZXh0TGlzdGVuZXJzKCkgew0KICAgIGlmIChuZXh0TGlzdGVuZXJzID09PSBjdXJyZW50TGlzdGVuZXJzKSB7DQogICAgICBuZXh0TGlzdGVuZXJzID0gY3VycmVudExpc3RlbmVycy5zbGljZSgpOw0KICAgIH0NCiAgfQ0KDQogIC8qKg0KICAgKiBSZWFkcyB0aGUgc3RhdGUgdHJlZSBtYW5hZ2VkIGJ5IHRoZSBzdG9yZS4NCiAgICoNCiAgICogQHJldHVybnMge2FueX0gVGhlIGN1cnJlbnQgc3RhdGUgdHJlZSBvZiB5b3VyIGFwcGxpY2F0aW9uLg0KICAgKi8NCiAgZnVuY3Rpb24gZ2V0U3RhdGUoKSB7DQogICAgcmV0dXJuIGN1cnJlbnRTdGF0ZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBZGRzIGEgY2hhbmdlIGxpc3RlbmVyLiBJdCB3aWxsIGJlIGNhbGxlZCBhbnkgdGltZSBhbiBhY3Rpb24gaXMgZGlzcGF0Y2hlZCwNCiAgICogYW5kIHNvbWUgcGFydCBvZiB0aGUgc3RhdGUgdHJlZSBtYXkgcG90ZW50aWFsbHkgaGF2ZSBjaGFuZ2VkLiBZb3UgbWF5IHRoZW4NCiAgICogY2FsbCBgZ2V0U3RhdGUoKWAgdG8gcmVhZCB0aGUgY3VycmVudCBzdGF0ZSB0cmVlIGluc2lkZSB0aGUgY2FsbGJhY2suDQogICAqDQogICAqIFlvdSBtYXkgY2FsbCBgZGlzcGF0Y2goKWAgZnJvbSBhIGNoYW5nZSBsaXN0ZW5lciwgd2l0aCB0aGUgZm9sbG93aW5nDQogICAqIGNhdmVhdHM6DQogICAqDQogICAqIDEuIFRoZSBzdWJzY3JpcHRpb25zIGFyZSBzbmFwc2hvdHRlZCBqdXN0IGJlZm9yZSBldmVyeSBgZGlzcGF0Y2goKWAgY2FsbC4NCiAgICogSWYgeW91IHN1YnNjcmliZSBvciB1bnN1YnNjcmliZSB3aGlsZSB0aGUgbGlzdGVuZXJzIGFyZSBiZWluZyBpbnZva2VkLCB0aGlzDQogICAqIHdpbGwgbm90IGhhdmUgYW55IGVmZmVjdCBvbiB0aGUgYGRpc3BhdGNoKClgIHRoYXQgaXMgY3VycmVudGx5IGluIHByb2dyZXNzLg0KICAgKiBIb3dldmVyLCB0aGUgbmV4dCBgZGlzcGF0Y2goKWAgY2FsbCwgd2hldGhlciBuZXN0ZWQgb3Igbm90LCB3aWxsIHVzZSBhIG1vcmUNCiAgICogcmVjZW50IHNuYXBzaG90IG9mIHRoZSBzdWJzY3JpcHRpb24gbGlzdC4NCiAgICoNCiAgICogMi4gVGhlIGxpc3RlbmVyIHNob3VsZCBub3QgZXhwZWN0IHRvIHNlZSBhbGwgc3RhdGUgY2hhbmdlcywgYXMgdGhlIHN0YXRlDQogICAqIG1pZ2h0IGhhdmUgYmVlbiB1cGRhdGVkIG11bHRpcGxlIHRpbWVzIGR1cmluZyBhIG5lc3RlZCBgZGlzcGF0Y2goKWAgYmVmb3JlDQogICAqIHRoZSBsaXN0ZW5lciBpcyBjYWxsZWQuIEl0IGlzLCBob3dldmVyLCBndWFyYW50ZWVkIHRoYXQgYWxsIHN1YnNjcmliZXJzDQogICAqIHJlZ2lzdGVyZWQgYmVmb3JlIHRoZSBgZGlzcGF0Y2goKWAgc3RhcnRlZCB3aWxsIGJlIGNhbGxlZCB3aXRoIHRoZSBsYXRlc3QNCiAgICogc3RhdGUgYnkgdGhlIHRpbWUgaXQgZXhpdHMuDQogICAqDQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGxpc3RlbmVyIEEgY2FsbGJhY2sgdG8gYmUgaW52b2tlZCBvbiBldmVyeSBkaXNwYXRjaC4NCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBBIGZ1bmN0aW9uIHRvIHJlbW92ZSB0aGlzIGNoYW5nZSBsaXN0ZW5lci4NCiAgICovDQogIGZ1bmN0aW9uIHN1YnNjcmliZShsaXN0ZW5lcikgew0KICAgIGlmICh0eXBlb2YgbGlzdGVuZXIgIT09ICdmdW5jdGlvbicpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcignRXhwZWN0ZWQgbGlzdGVuZXIgdG8gYmUgYSBmdW5jdGlvbi4nKTsNCiAgICB9DQoNCiAgICB2YXIgaXNTdWJzY3JpYmVkID0gdHJ1ZTsNCg0KICAgIGVuc3VyZUNhbk11dGF0ZU5leHRMaXN0ZW5lcnMoKTsNCiAgICBuZXh0TGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOw0KDQogICAgcmV0dXJuIGZ1bmN0aW9uIHVuc3Vic2NyaWJlKCkgew0KICAgICAgaWYgKCFpc1N1YnNjcmliZWQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICBpc1N1YnNjcmliZWQgPSBmYWxzZTsNCg0KICAgICAgZW5zdXJlQ2FuTXV0YXRlTmV4dExpc3RlbmVycygpOw0KICAgICAgdmFyIGluZGV4ID0gbmV4dExpc3RlbmVycy5pbmRleE9mKGxpc3RlbmVyKTsNCiAgICAgIG5leHRMaXN0ZW5lcnMuc3BsaWNlKGluZGV4LCAxKTsNCiAgICB9Ow0KICB9DQoNCiAgLyoqDQogICAqIERpc3BhdGNoZXMgYW4gYWN0aW9uLiBJdCBpcyB0aGUgb25seSB3YXkgdG8gdHJpZ2dlciBhIHN0YXRlIGNoYW5nZS4NCiAgICoNCiAgICogVGhlIGByZWR1Y2VyYCBmdW5jdGlvbiwgdXNlZCB0byBjcmVhdGUgdGhlIHN0b3JlLCB3aWxsIGJlIGNhbGxlZCB3aXRoIHRoZQ0KICAgKiBjdXJyZW50IHN0YXRlIHRyZWUgYW5kIHRoZSBnaXZlbiBgYWN0aW9uYC4gSXRzIHJldHVybiB2YWx1ZSB3aWxsDQogICAqIGJlIGNvbnNpZGVyZWQgdGhlICoqbmV4dCoqIHN0YXRlIG9mIHRoZSB0cmVlLCBhbmQgdGhlIGNoYW5nZSBsaXN0ZW5lcnMNCiAgICogd2lsbCBiZSBub3RpZmllZC4NCiAgICoNCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb25seSBzdXBwb3J0cyBwbGFpbiBvYmplY3QgYWN0aW9ucy4gSWYgeW91IHdhbnQgdG8NCiAgICogZGlzcGF0Y2ggYSBQcm9taXNlLCBhbiBPYnNlcnZhYmxlLCBhIHRodW5rLCBvciBzb21ldGhpbmcgZWxzZSwgeW91IG5lZWQgdG8NCiAgICogd3JhcCB5b3VyIHN0b3JlIGNyZWF0aW5nIGZ1bmN0aW9uIGludG8gdGhlIGNvcnJlc3BvbmRpbmcgbWlkZGxld2FyZS4gRm9yDQogICAqIGV4YW1wbGUsIHNlZSB0aGUgZG9jdW1lbnRhdGlvbiBmb3IgdGhlIGByZWR1eC10aHVua2AgcGFja2FnZS4gRXZlbiB0aGUNCiAgICogbWlkZGxld2FyZSB3aWxsIGV2ZW50dWFsbHkgZGlzcGF0Y2ggcGxhaW4gb2JqZWN0IGFjdGlvbnMgdXNpbmcgdGhpcyBtZXRob2QuDQogICAqDQogICAqIEBwYXJhbSB7T2JqZWN0fSBhY3Rpb24gQSBwbGFpbiBvYmplY3QgcmVwcmVzZW50aW5nIOKAnHdoYXQgY2hhbmdlZOKAnS4gSXQgaXMNCiAgICogYSBnb29kIGlkZWEgdG8ga2VlcCBhY3Rpb25zIHNlcmlhbGl6YWJsZSBzbyB5b3UgY2FuIHJlY29yZCBhbmQgcmVwbGF5IHVzZXINCiAgICogc2Vzc2lvbnMsIG9yIHVzZSB0aGUgdGltZSB0cmF2ZWxsaW5nIGByZWR1eC1kZXZ0b29sc2AuIEFuIGFjdGlvbiBtdXN0IGhhdmUNCiAgICogYSBgdHlwZWAgcHJvcGVydHkgd2hpY2ggbWF5IG5vdCBiZSBgdW5kZWZpbmVkYC4gSXQgaXMgYSBnb29kIGlkZWEgdG8gdXNlDQogICAqIHN0cmluZyBjb25zdGFudHMgZm9yIGFjdGlvbiB0eXBlcy4NCiAgICoNCiAgICogQHJldHVybnMge09iamVjdH0gRm9yIGNvbnZlbmllbmNlLCB0aGUgc2FtZSBhY3Rpb24gb2JqZWN0IHlvdSBkaXNwYXRjaGVkLg0KICAgKg0KICAgKiBOb3RlIHRoYXQsIGlmIHlvdSB1c2UgYSBjdXN0b20gbWlkZGxld2FyZSwgaXQgbWF5IHdyYXAgYGRpc3BhdGNoKClgIHRvDQogICAqIHJldHVybiBzb21ldGhpbmcgZWxzZSAoZm9yIGV4YW1wbGUsIGEgUHJvbWlzZSB5b3UgY2FuIGF3YWl0KS4NCiAgICovDQogIGZ1bmN0aW9uIGRpc3BhdGNoKGFjdGlvbikgew0KICAgIGlmICghbG9kYXNoX2VzX2lzUGxhaW5PYmplY3QoYWN0aW9uKSkgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCdBY3Rpb25zIG11c3QgYmUgcGxhaW4gb2JqZWN0cy4gJyArICdVc2UgY3VzdG9tIG1pZGRsZXdhcmUgZm9yIGFzeW5jIGFjdGlvbnMuJyk7DQogICAgfQ0KDQogICAgaWYgKHR5cGVvZiBhY3Rpb24udHlwZSA9PT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcignQWN0aW9ucyBtYXkgbm90IGhhdmUgYW4gdW5kZWZpbmVkICJ0eXBlIiBwcm9wZXJ0eS4gJyArICdIYXZlIHlvdSBtaXNzcGVsbGVkIGEgY29uc3RhbnQ/Jyk7DQogICAgfQ0KDQogICAgaWYgKGlzRGlzcGF0Y2hpbmcpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcignUmVkdWNlcnMgbWF5IG5vdCBkaXNwYXRjaCBhY3Rpb25zLicpOw0KICAgIH0NCg0KICAgIHRyeSB7DQogICAgICBpc0Rpc3BhdGNoaW5nID0gdHJ1ZTsNCiAgICAgIGN1cnJlbnRTdGF0ZSA9IGN1cnJlbnRSZWR1Y2VyKGN1cnJlbnRTdGF0ZSwgYWN0aW9uKTsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgaXNEaXNwYXRjaGluZyA9IGZhbHNlOw0KICAgIH0NCg0KICAgIHZhciBsaXN0ZW5lcnMgPSBjdXJyZW50TGlzdGVuZXJzID0gbmV4dExpc3RlbmVyczsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykgew0KICAgICAgdmFyIGxpc3RlbmVyID0gbGlzdGVuZXJzW2ldOw0KICAgICAgbGlzdGVuZXIoKTsNCiAgICB9DQoNCiAgICByZXR1cm4gYWN0aW9uOw0KICB9DQoNCiAgLyoqDQogICAqIFJlcGxhY2VzIHRoZSByZWR1Y2VyIGN1cnJlbnRseSB1c2VkIGJ5IHRoZSBzdG9yZSB0byBjYWxjdWxhdGUgdGhlIHN0YXRlLg0KICAgKg0KICAgKiBZb3UgbWlnaHQgbmVlZCB0aGlzIGlmIHlvdXIgYXBwIGltcGxlbWVudHMgY29kZSBzcGxpdHRpbmcgYW5kIHlvdSB3YW50IHRvDQogICAqIGxvYWQgc29tZSBvZiB0aGUgcmVkdWNlcnMgZHluYW1pY2FsbHkuIFlvdSBtaWdodCBhbHNvIG5lZWQgdGhpcyBpZiB5b3UNCiAgICogaW1wbGVtZW50IGEgaG90IHJlbG9hZGluZyBtZWNoYW5pc20gZm9yIFJlZHV4Lg0KICAgKg0KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBuZXh0UmVkdWNlciBUaGUgcmVkdWNlciBmb3IgdGhlIHN0b3JlIHRvIHVzZSBpbnN0ZWFkLg0KICAgKiBAcmV0dXJucyB7dm9pZH0NCiAgICovDQogIGZ1bmN0aW9uIHJlcGxhY2VSZWR1Y2VyKG5leHRSZWR1Y2VyKSB7DQogICAgaWYgKHR5cGVvZiBuZXh0UmVkdWNlciAhPT0gJ2Z1bmN0aW9uJykgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCB0aGUgbmV4dFJlZHVjZXIgdG8gYmUgYSBmdW5jdGlvbi4nKTsNCiAgICB9DQoNCiAgICBjdXJyZW50UmVkdWNlciA9IG5leHRSZWR1Y2VyOw0KICAgIGRpc3BhdGNoKHsgdHlwZTogQWN0aW9uVHlwZXMuSU5JVCB9KTsNCiAgfQ0KDQogIC8qKg0KICAgKiBJbnRlcm9wZXJhYmlsaXR5IHBvaW50IGZvciBvYnNlcnZhYmxlL3JlYWN0aXZlIGxpYnJhcmllcy4NCiAgICogQHJldHVybnMge29ic2VydmFibGV9IEEgbWluaW1hbCBvYnNlcnZhYmxlIG9mIHN0YXRlIGNoYW5nZXMuDQogICAqIEZvciBtb3JlIGluZm9ybWF0aW9uLCBzZWUgdGhlIG9ic2VydmFibGUgcHJvcG9zYWw6DQogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLW9ic2VydmFibGUNCiAgICovDQogIGZ1bmN0aW9uIG9ic2VydmFibGUoKSB7DQogICAgdmFyIF9yZWY7DQoNCiAgICB2YXIgb3V0ZXJTdWJzY3JpYmUgPSBzdWJzY3JpYmU7DQogICAgcmV0dXJuIF9yZWYgPSB7DQogICAgICAvKioNCiAgICAgICAqIFRoZSBtaW5pbWFsIG9ic2VydmFibGUgc3Vic2NyaXB0aW9uIG1ldGhvZC4NCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYnNlcnZlciBBbnkgb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgYXMgYW4gb2JzZXJ2ZXIuDQogICAgICAgKiBUaGUgb2JzZXJ2ZXIgb2JqZWN0IHNob3VsZCBoYXZlIGEgYG5leHRgIG1ldGhvZC4NCiAgICAgICAqIEByZXR1cm5zIHtzdWJzY3JpcHRpb259IEFuIG9iamVjdCB3aXRoIGFuIGB1bnN1YnNjcmliZWAgbWV0aG9kIHRoYXQgY2FuDQogICAgICAgKiBiZSB1c2VkIHRvIHVuc3Vic2NyaWJlIHRoZSBvYnNlcnZhYmxlIGZyb20gdGhlIHN0b3JlLCBhbmQgcHJldmVudCBmdXJ0aGVyDQogICAgICAgKiBlbWlzc2lvbiBvZiB2YWx1ZXMgZnJvbSB0aGUgb2JzZXJ2YWJsZS4NCiAgICAgICAqLw0KICAgICAgc3Vic2NyaWJlOiBmdW5jdGlvbiBzdWJzY3JpYmUob2JzZXJ2ZXIpIHsNCiAgICAgICAgaWYgKHR5cGVvZiBvYnNlcnZlciAhPT0gJ29iamVjdCcpIHsNCiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCB0aGUgb2JzZXJ2ZXIgdG8gYmUgYW4gb2JqZWN0LicpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gb2JzZXJ2ZVN0YXRlKCkgew0KICAgICAgICAgIGlmIChvYnNlcnZlci5uZXh0KSB7DQogICAgICAgICAgICBvYnNlcnZlci5uZXh0KGdldFN0YXRlKCkpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIG9ic2VydmVTdGF0ZSgpOw0KICAgICAgICB2YXIgdW5zdWJzY3JpYmUgPSBvdXRlclN1YnNjcmliZShvYnNlcnZlU3RhdGUpOw0KICAgICAgICByZXR1cm4geyB1bnN1YnNjcmliZTogdW5zdWJzY3JpYmUgfTsNCiAgICAgIH0NCiAgICB9LCBfcmVmW2VzWyJhIiAvKiBkZWZhdWx0ICovXV0gPSBmdW5jdGlvbiAoKSB7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9LCBfcmVmOw0KICB9DQoNCiAgLy8gV2hlbiBhIHN0b3JlIGlzIGNyZWF0ZWQsIGFuICJJTklUIiBhY3Rpb24gaXMgZGlzcGF0Y2hlZCBzbyB0aGF0IGV2ZXJ5DQogIC8vIHJlZHVjZXIgcmV0dXJucyB0aGVpciBpbml0aWFsIHN0YXRlLiBUaGlzIGVmZmVjdGl2ZWx5IHBvcHVsYXRlcw0KICAvLyB0aGUgaW5pdGlhbCBzdGF0ZSB0cmVlLg0KICBkaXNwYXRjaCh7IHR5cGU6IEFjdGlvblR5cGVzLklOSVQgfSk7DQoNCiAgcmV0dXJuIF9yZWYyID0gew0KICAgIGRpc3BhdGNoOiBkaXNwYXRjaCwNCiAgICBzdWJzY3JpYmU6IHN1YnNjcmliZSwNCiAgICBnZXRTdGF0ZTogZ2V0U3RhdGUsDQogICAgcmVwbGFjZVJlZHVjZXI6IHJlcGxhY2VSZWR1Y2VyDQogIH0sIF9yZWYyW2VzWyJhIiAvKiBkZWZhdWx0ICovXV0gPSBvYnNlcnZhYmxlLCBfcmVmMjsNCn0NCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlZHV4L2VzL3V0aWxzL3dhcm5pbmcuanMNCi8qKg0KICogUHJpbnRzIGEgd2FybmluZyBpbiB0aGUgY29uc29sZSBpZiBpdCBleGlzdHMuDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IG1lc3NhZ2UgVGhlIHdhcm5pbmcgbWVzc2FnZS4NCiAqIEByZXR1cm5zIHt2b2lkfQ0KICovDQpmdW5jdGlvbiB3YXJuaW5nX3dhcm5pbmcobWVzc2FnZSkgew0KICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovDQogIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGNvbnNvbGUuZXJyb3IgPT09ICdmdW5jdGlvbicpIHsNCiAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UpOw0KICB9DQogIC8qIGVzbGludC1lbmFibGUgbm8tY29uc29sZSAqLw0KICB0cnkgew0KICAgIC8vIFRoaXMgZXJyb3Igd2FzIHRocm93biBhcyBhIGNvbnZlbmllbmNlIHNvIHRoYXQgaWYgeW91IGVuYWJsZQ0KICAgIC8vICJicmVhayBvbiBhbGwgZXhjZXB0aW9ucyIgaW4geW91ciBjb25zb2xlLA0KICAgIC8vIGl0IHdvdWxkIHBhdXNlIHRoZSBleGVjdXRpb24gYXQgdGhpcyBsaW5lLg0KICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsNCiAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1lbXB0eSAqLw0KICB9IGNhdGNoIChlKSB7fQ0KICAvKiBlc2xpbnQtZW5hYmxlIG5vLWVtcHR5ICovDQp9DQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWR1eC9lcy9jb21iaW5lUmVkdWNlcnMuanMNCg0KDQoNCg0KZnVuY3Rpb24gZ2V0VW5kZWZpbmVkU3RhdGVFcnJvck1lc3NhZ2Uoa2V5LCBhY3Rpb24pIHsNCiAgdmFyIGFjdGlvblR5cGUgPSBhY3Rpb24gJiYgYWN0aW9uLnR5cGU7DQogIHZhciBhY3Rpb25OYW1lID0gYWN0aW9uVHlwZSAmJiAnIicgKyBhY3Rpb25UeXBlLnRvU3RyaW5nKCkgKyAnIicgfHwgJ2FuIGFjdGlvbic7DQoNCiAgcmV0dXJuICdHaXZlbiBhY3Rpb24gJyArIGFjdGlvbk5hbWUgKyAnLCByZWR1Y2VyICInICsga2V5ICsgJyIgcmV0dXJuZWQgdW5kZWZpbmVkLiAnICsgJ1RvIGlnbm9yZSBhbiBhY3Rpb24sIHlvdSBtdXN0IGV4cGxpY2l0bHkgcmV0dXJuIHRoZSBwcmV2aW91cyBzdGF0ZS4gJyArICdJZiB5b3Ugd2FudCB0aGlzIHJlZHVjZXIgdG8gaG9sZCBubyB2YWx1ZSwgeW91IGNhbiByZXR1cm4gbnVsbCBpbnN0ZWFkIG9mIHVuZGVmaW5lZC4nOw0KfQ0KDQpmdW5jdGlvbiBnZXRVbmV4cGVjdGVkU3RhdGVTaGFwZVdhcm5pbmdNZXNzYWdlKGlucHV0U3RhdGUsIHJlZHVjZXJzLCBhY3Rpb24sIHVuZXhwZWN0ZWRLZXlDYWNoZSkgew0KICB2YXIgcmVkdWNlcktleXMgPSBPYmplY3Qua2V5cyhyZWR1Y2Vycyk7DQogIHZhciBhcmd1bWVudE5hbWUgPSBhY3Rpb24gJiYgYWN0aW9uLnR5cGUgPT09IEFjdGlvblR5cGVzLklOSVQgPyAncHJlbG9hZGVkU3RhdGUgYXJndW1lbnQgcGFzc2VkIHRvIGNyZWF0ZVN0b3JlJyA6ICdwcmV2aW91cyBzdGF0ZSByZWNlaXZlZCBieSB0aGUgcmVkdWNlcic7DQoNCiAgaWYgKHJlZHVjZXJLZXlzLmxlbmd0aCA9PT0gMCkgew0KICAgIHJldHVybiAnU3RvcmUgZG9lcyBub3QgaGF2ZSBhIHZhbGlkIHJlZHVjZXIuIE1ha2Ugc3VyZSB0aGUgYXJndW1lbnQgcGFzc2VkICcgKyAndG8gY29tYmluZVJlZHVjZXJzIGlzIGFuIG9iamVjdCB3aG9zZSB2YWx1ZXMgYXJlIHJlZHVjZXJzLic7DQogIH0NCg0KICBpZiAoIWxvZGFzaF9lc19pc1BsYWluT2JqZWN0KGlucHV0U3RhdGUpKSB7DQogICAgcmV0dXJuICdUaGUgJyArIGFyZ3VtZW50TmFtZSArICcgaGFzIHVuZXhwZWN0ZWQgdHlwZSBvZiAiJyArIHt9LnRvU3RyaW5nLmNhbGwoaW5wdXRTdGF0ZSkubWF0Y2goL1xzKFthLXp8QS1aXSspLylbMV0gKyAnIi4gRXhwZWN0ZWQgYXJndW1lbnQgdG8gYmUgYW4gb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyAnICsgKCdrZXlzOiAiJyArIHJlZHVjZXJLZXlzLmpvaW4oJyIsICInKSArICciJyk7DQogIH0NCg0KICB2YXIgdW5leHBlY3RlZEtleXMgPSBPYmplY3Qua2V5cyhpbnB1dFN0YXRlKS5maWx0ZXIoZnVuY3Rpb24gKGtleSkgew0KICAgIHJldHVybiAhcmVkdWNlcnMuaGFzT3duUHJvcGVydHkoa2V5KSAmJiAhdW5leHBlY3RlZEtleUNhY2hlW2tleV07DQogIH0pOw0KDQogIHVuZXhwZWN0ZWRLZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkgew0KICAgIHVuZXhwZWN0ZWRLZXlDYWNoZVtrZXldID0gdHJ1ZTsNCiAgfSk7DQoNCiAgaWYgKHVuZXhwZWN0ZWRLZXlzLmxlbmd0aCA+IDApIHsNCiAgICByZXR1cm4gJ1VuZXhwZWN0ZWQgJyArICh1bmV4cGVjdGVkS2V5cy5sZW5ndGggPiAxID8gJ2tleXMnIDogJ2tleScpICsgJyAnICsgKCciJyArIHVuZXhwZWN0ZWRLZXlzLmpvaW4oJyIsICInKSArICciIGZvdW5kIGluICcgKyBhcmd1bWVudE5hbWUgKyAnLiAnKSArICdFeHBlY3RlZCB0byBmaW5kIG9uZSBvZiB0aGUga25vd24gcmVkdWNlciBrZXlzIGluc3RlYWQ6ICcgKyAoJyInICsgcmVkdWNlcktleXMuam9pbignIiwgIicpICsgJyIuIFVuZXhwZWN0ZWQga2V5cyB3aWxsIGJlIGlnbm9yZWQuJyk7DQogIH0NCn0NCg0KZnVuY3Rpb24gYXNzZXJ0UmVkdWNlclNoYXBlKHJlZHVjZXJzKSB7DQogIE9iamVjdC5rZXlzKHJlZHVjZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsNCiAgICB2YXIgcmVkdWNlciA9IHJlZHVjZXJzW2tleV07DQogICAgdmFyIGluaXRpYWxTdGF0ZSA9IHJlZHVjZXIodW5kZWZpbmVkLCB7IHR5cGU6IEFjdGlvblR5cGVzLklOSVQgfSk7DQoNCiAgICBpZiAodHlwZW9mIGluaXRpYWxTdGF0ZSA9PT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcignUmVkdWNlciAiJyArIGtleSArICciIHJldHVybmVkIHVuZGVmaW5lZCBkdXJpbmcgaW5pdGlhbGl6YXRpb24uICcgKyAnSWYgdGhlIHN0YXRlIHBhc3NlZCB0byB0aGUgcmVkdWNlciBpcyB1bmRlZmluZWQsIHlvdSBtdXN0ICcgKyAnZXhwbGljaXRseSByZXR1cm4gdGhlIGluaXRpYWwgc3RhdGUuIFRoZSBpbml0aWFsIHN0YXRlIG1heSAnICsgJ25vdCBiZSB1bmRlZmluZWQuIElmIHlvdSBkb25cJ3Qgd2FudCB0byBzZXQgYSB2YWx1ZSBmb3IgdGhpcyByZWR1Y2VyLCAnICsgJ3lvdSBjYW4gdXNlIG51bGwgaW5zdGVhZCBvZiB1bmRlZmluZWQuJyk7DQogICAgfQ0KDQogICAgdmFyIHR5cGUgPSAnQEByZWR1eC9QUk9CRV9VTktOT1dOX0FDVElPTl8nICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpLnNwbGl0KCcnKS5qb2luKCcuJyk7DQogICAgaWYgKHR5cGVvZiByZWR1Y2VyKHVuZGVmaW5lZCwgeyB0eXBlOiB0eXBlIH0pID09PSAndW5kZWZpbmVkJykgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZWR1Y2VyICInICsga2V5ICsgJyIgcmV0dXJuZWQgdW5kZWZpbmVkIHdoZW4gcHJvYmVkIHdpdGggYSByYW5kb20gdHlwZS4gJyArICgnRG9uXCd0IHRyeSB0byBoYW5kbGUgJyArIEFjdGlvblR5cGVzLklOSVQgKyAnIG9yIG90aGVyIGFjdGlvbnMgaW4gInJlZHV4LyoiICcpICsgJ25hbWVzcGFjZS4gVGhleSBhcmUgY29uc2lkZXJlZCBwcml2YXRlLiBJbnN0ZWFkLCB5b3UgbXVzdCByZXR1cm4gdGhlICcgKyAnY3VycmVudCBzdGF0ZSBmb3IgYW55IHVua25vd24gYWN0aW9ucywgdW5sZXNzIGl0IGlzIHVuZGVmaW5lZCwgJyArICdpbiB3aGljaCBjYXNlIHlvdSBtdXN0IHJldHVybiB0aGUgaW5pdGlhbCBzdGF0ZSwgcmVnYXJkbGVzcyBvZiB0aGUgJyArICdhY3Rpb24gdHlwZS4gVGhlIGluaXRpYWwgc3RhdGUgbWF5IG5vdCBiZSB1bmRlZmluZWQsIGJ1dCBjYW4gYmUgbnVsbC4nKTsNCiAgICB9DQogIH0pOw0KfQ0KDQovKioNCiAqIFR1cm5zIGFuIG9iamVjdCB3aG9zZSB2YWx1ZXMgYXJlIGRpZmZlcmVudCByZWR1Y2VyIGZ1bmN0aW9ucywgaW50byBhIHNpbmdsZQ0KICogcmVkdWNlciBmdW5jdGlvbi4gSXQgd2lsbCBjYWxsIGV2ZXJ5IGNoaWxkIHJlZHVjZXIsIGFuZCBnYXRoZXIgdGhlaXIgcmVzdWx0cw0KICogaW50byBhIHNpbmdsZSBzdGF0ZSBvYmplY3QsIHdob3NlIGtleXMgY29ycmVzcG9uZCB0byB0aGUga2V5cyBvZiB0aGUgcGFzc2VkDQogKiByZWR1Y2VyIGZ1bmN0aW9ucy4NCiAqDQogKiBAcGFyYW0ge09iamVjdH0gcmVkdWNlcnMgQW4gb2JqZWN0IHdob3NlIHZhbHVlcyBjb3JyZXNwb25kIHRvIGRpZmZlcmVudA0KICogcmVkdWNlciBmdW5jdGlvbnMgdGhhdCBuZWVkIHRvIGJlIGNvbWJpbmVkIGludG8gb25lLiBPbmUgaGFuZHkgd2F5IHRvIG9idGFpbg0KICogaXQgaXMgdG8gdXNlIEVTNiBgaW1wb3J0ICogYXMgcmVkdWNlcnNgIHN5bnRheC4gVGhlIHJlZHVjZXJzIG1heSBuZXZlciByZXR1cm4NCiAqIHVuZGVmaW5lZCBmb3IgYW55IGFjdGlvbi4gSW5zdGVhZCwgdGhleSBzaG91bGQgcmV0dXJuIHRoZWlyIGluaXRpYWwgc3RhdGUNCiAqIGlmIHRoZSBzdGF0ZSBwYXNzZWQgdG8gdGhlbSB3YXMgdW5kZWZpbmVkLCBhbmQgdGhlIGN1cnJlbnQgc3RhdGUgZm9yIGFueQ0KICogdW5yZWNvZ25pemVkIGFjdGlvbi4NCiAqDQogKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgcmVkdWNlciBmdW5jdGlvbiB0aGF0IGludm9rZXMgZXZlcnkgcmVkdWNlciBpbnNpZGUgdGhlDQogKiBwYXNzZWQgb2JqZWN0LCBhbmQgYnVpbGRzIGEgc3RhdGUgb2JqZWN0IHdpdGggdGhlIHNhbWUgc2hhcGUuDQogKi8NCmZ1bmN0aW9uIGNvbWJpbmVSZWR1Y2VycyhyZWR1Y2Vycykgew0KICB2YXIgcmVkdWNlcktleXMgPSBPYmplY3Qua2V5cyhyZWR1Y2Vycyk7DQogIHZhciBmaW5hbFJlZHVjZXJzID0ge307DQogIGZvciAodmFyIGkgPSAwOyBpIDwgcmVkdWNlcktleXMubGVuZ3RoOyBpKyspIHsNCiAgICB2YXIga2V5ID0gcmVkdWNlcktleXNbaV07DQoNCiAgICBpZiAoZmFsc2UpIHsNCiAgICAgIGlmICh0eXBlb2YgcmVkdWNlcnNba2V5XSA9PT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgd2FybmluZygnTm8gcmVkdWNlciBwcm92aWRlZCBmb3Iga2V5ICInICsga2V5ICsgJyInKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAodHlwZW9mIHJlZHVjZXJzW2tleV0gPT09ICdmdW5jdGlvbicpIHsNCiAgICAgIGZpbmFsUmVkdWNlcnNba2V5XSA9IHJlZHVjZXJzW2tleV07DQogICAgfQ0KICB9DQogIHZhciBmaW5hbFJlZHVjZXJLZXlzID0gT2JqZWN0LmtleXMoZmluYWxSZWR1Y2Vycyk7DQoNCiAgdmFyIHVuZXhwZWN0ZWRLZXlDYWNoZSA9IHZvaWQgMDsNCiAgaWYgKGZhbHNlKSB7DQogICAgdW5leHBlY3RlZEtleUNhY2hlID0ge307DQogIH0NCg0KICB2YXIgc2hhcGVBc3NlcnRpb25FcnJvciA9IHZvaWQgMDsNCiAgdHJ5IHsNCiAgICBhc3NlcnRSZWR1Y2VyU2hhcGUoZmluYWxSZWR1Y2Vycyk7DQogIH0gY2F0Y2ggKGUpIHsNCiAgICBzaGFwZUFzc2VydGlvbkVycm9yID0gZTsNCiAgfQ0KDQogIHJldHVybiBmdW5jdGlvbiBjb21iaW5hdGlvbigpIHsNCiAgICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9Ow0KICAgIHZhciBhY3Rpb24gPSBhcmd1bWVudHNbMV07DQoNCiAgICBpZiAoc2hhcGVBc3NlcnRpb25FcnJvcikgew0KICAgICAgdGhyb3cgc2hhcGVBc3NlcnRpb25FcnJvcjsNCiAgICB9DQoNCiAgICBpZiAoZmFsc2UpIHsNCiAgICAgIHZhciB3YXJuaW5nTWVzc2FnZSA9IGdldFVuZXhwZWN0ZWRTdGF0ZVNoYXBlV2FybmluZ01lc3NhZ2Uoc3RhdGUsIGZpbmFsUmVkdWNlcnMsIGFjdGlvbiwgdW5leHBlY3RlZEtleUNhY2hlKTsNCiAgICAgIGlmICh3YXJuaW5nTWVzc2FnZSkgew0KICAgICAgICB3YXJuaW5nKHdhcm5pbmdNZXNzYWdlKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICB2YXIgaGFzQ2hhbmdlZCA9IGZhbHNlOw0KICAgIHZhciBuZXh0U3RhdGUgPSB7fTsNCiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgZmluYWxSZWR1Y2VyS2V5cy5sZW5ndGg7IF9pKyspIHsNCiAgICAgIHZhciBfa2V5ID0gZmluYWxSZWR1Y2VyS2V5c1tfaV07DQogICAgICB2YXIgcmVkdWNlciA9IGZpbmFsUmVkdWNlcnNbX2tleV07DQogICAgICB2YXIgcHJldmlvdXNTdGF0ZUZvcktleSA9IHN0YXRlW19rZXldOw0KICAgICAgdmFyIG5leHRTdGF0ZUZvcktleSA9IHJlZHVjZXIocHJldmlvdXNTdGF0ZUZvcktleSwgYWN0aW9uKTsNCiAgICAgIGlmICh0eXBlb2YgbmV4dFN0YXRlRm9yS2V5ID09PSAndW5kZWZpbmVkJykgew0KICAgICAgICB2YXIgZXJyb3JNZXNzYWdlID0gZ2V0VW5kZWZpbmVkU3RhdGVFcnJvck1lc3NhZ2UoX2tleSwgYWN0aW9uKTsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZSk7DQogICAgICB9DQogICAgICBuZXh0U3RhdGVbX2tleV0gPSBuZXh0U3RhdGVGb3JLZXk7DQogICAgICBoYXNDaGFuZ2VkID0gaGFzQ2hhbmdlZCB8fCBuZXh0U3RhdGVGb3JLZXkgIT09IHByZXZpb3VzU3RhdGVGb3JLZXk7DQogICAgfQ0KICAgIHJldHVybiBoYXNDaGFuZ2VkID8gbmV4dFN0YXRlIDogc3RhdGU7DQogIH07DQp9DQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWR1eC9lcy9iaW5kQWN0aW9uQ3JlYXRvcnMuanMNCmZ1bmN0aW9uIGJpbmRBY3Rpb25DcmVhdG9yKGFjdGlvbkNyZWF0b3IsIGRpc3BhdGNoKSB7DQogIHJldHVybiBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIGRpc3BhdGNoKGFjdGlvbkNyZWF0b3IuYXBwbHkodW5kZWZpbmVkLCBhcmd1bWVudHMpKTsNCiAgfTsNCn0NCg0KLyoqDQogKiBUdXJucyBhbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGFyZSBhY3Rpb24gY3JlYXRvcnMsIGludG8gYW4gb2JqZWN0IHdpdGggdGhlDQogKiBzYW1lIGtleXMsIGJ1dCB3aXRoIGV2ZXJ5IGZ1bmN0aW9uIHdyYXBwZWQgaW50byBhIGBkaXNwYXRjaGAgY2FsbCBzbyB0aGV5DQogKiBtYXkgYmUgaW52b2tlZCBkaXJlY3RseS4gVGhpcyBpcyBqdXN0IGEgY29udmVuaWVuY2UgbWV0aG9kLCBhcyB5b3UgY2FuIGNhbGwNCiAqIGBzdG9yZS5kaXNwYXRjaChNeUFjdGlvbkNyZWF0b3JzLmRvU29tZXRoaW5nKCkpYCB5b3Vyc2VsZiBqdXN0IGZpbmUuDQogKg0KICogRm9yIGNvbnZlbmllbmNlLCB5b3UgY2FuIGFsc28gcGFzcyBhIHNpbmdsZSBmdW5jdGlvbiBhcyB0aGUgZmlyc3QgYXJndW1lbnQsDQogKiBhbmQgZ2V0IGEgZnVuY3Rpb24gaW4gcmV0dXJuLg0KICoNCiAqIEBwYXJhbSB7RnVuY3Rpb258T2JqZWN0fSBhY3Rpb25DcmVhdG9ycyBBbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGFyZSBhY3Rpb24NCiAqIGNyZWF0b3IgZnVuY3Rpb25zLiBPbmUgaGFuZHkgd2F5IHRvIG9idGFpbiBpdCBpcyB0byB1c2UgRVM2IGBpbXBvcnQgKiBhc2ANCiAqIHN5bnRheC4gWW91IG1heSBhbHNvIHBhc3MgYSBzaW5nbGUgZnVuY3Rpb24uDQogKg0KICogQHBhcmFtIHtGdW5jdGlvbn0gZGlzcGF0Y2ggVGhlIGBkaXNwYXRjaGAgZnVuY3Rpb24gYXZhaWxhYmxlIG9uIHlvdXIgUmVkdXgNCiAqIHN0b3JlLg0KICoNCiAqIEByZXR1cm5zIHtGdW5jdGlvbnxPYmplY3R9IFRoZSBvYmplY3QgbWltaWNraW5nIHRoZSBvcmlnaW5hbCBvYmplY3QsIGJ1dCB3aXRoDQogKiBldmVyeSBhY3Rpb24gY3JlYXRvciB3cmFwcGVkIGludG8gdGhlIGBkaXNwYXRjaGAgY2FsbC4gSWYgeW91IHBhc3NlZCBhDQogKiBmdW5jdGlvbiBhcyBgYWN0aW9uQ3JlYXRvcnNgLCB0aGUgcmV0dXJuIHZhbHVlIHdpbGwgYWxzbyBiZSBhIHNpbmdsZQ0KICogZnVuY3Rpb24uDQogKi8NCmZ1bmN0aW9uIGJpbmRBY3Rpb25DcmVhdG9ycyhhY3Rpb25DcmVhdG9ycywgZGlzcGF0Y2gpIHsNCiAgaWYgKHR5cGVvZiBhY3Rpb25DcmVhdG9ycyA9PT0gJ2Z1bmN0aW9uJykgew0KICAgIHJldHVybiBiaW5kQWN0aW9uQ3JlYXRvcihhY3Rpb25DcmVhdG9ycywgZGlzcGF0Y2gpOw0KICB9DQoNCiAgaWYgKHR5cGVvZiBhY3Rpb25DcmVhdG9ycyAhPT0gJ29iamVjdCcgfHwgYWN0aW9uQ3JlYXRvcnMgPT09IG51bGwpIHsNCiAgICB0aHJvdyBuZXcgRXJyb3IoJ2JpbmRBY3Rpb25DcmVhdG9ycyBleHBlY3RlZCBhbiBvYmplY3Qgb3IgYSBmdW5jdGlvbiwgaW5zdGVhZCByZWNlaXZlZCAnICsgKGFjdGlvbkNyZWF0b3JzID09PSBudWxsID8gJ251bGwnIDogdHlwZW9mIGFjdGlvbkNyZWF0b3JzKSArICcuICcgKyAnRGlkIHlvdSB3cml0ZSAiaW1wb3J0IEFjdGlvbkNyZWF0b3JzIGZyb20iIGluc3RlYWQgb2YgImltcG9ydCAqIGFzIEFjdGlvbkNyZWF0b3JzIGZyb20iPycpOw0KICB9DQoNCiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhhY3Rpb25DcmVhdG9ycyk7DQogIHZhciBib3VuZEFjdGlvbkNyZWF0b3JzID0ge307DQogIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgew0KICAgIHZhciBrZXkgPSBrZXlzW2ldOw0KICAgIHZhciBhY3Rpb25DcmVhdG9yID0gYWN0aW9uQ3JlYXRvcnNba2V5XTsNCiAgICBpZiAodHlwZW9mIGFjdGlvbkNyZWF0b3IgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgIGJvdW5kQWN0aW9uQ3JlYXRvcnNba2V5XSA9IGJpbmRBY3Rpb25DcmVhdG9yKGFjdGlvbkNyZWF0b3IsIGRpc3BhdGNoKTsNCiAgICB9DQogIH0NCiAgcmV0dXJuIGJvdW5kQWN0aW9uQ3JlYXRvcnM7DQp9DQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWR1eC9lcy9jb21wb3NlLmpzDQovKioNCiAqIENvbXBvc2VzIHNpbmdsZS1hcmd1bWVudCBmdW5jdGlvbnMgZnJvbSByaWdodCB0byBsZWZ0LiBUaGUgcmlnaHRtb3N0DQogKiBmdW5jdGlvbiBjYW4gdGFrZSBtdWx0aXBsZSBhcmd1bWVudHMgYXMgaXQgcHJvdmlkZXMgdGhlIHNpZ25hdHVyZSBmb3INCiAqIHRoZSByZXN1bHRpbmcgY29tcG9zaXRlIGZ1bmN0aW9uLg0KICoNCiAqIEBwYXJhbSB7Li4uRnVuY3Rpb259IGZ1bmNzIFRoZSBmdW5jdGlvbnMgdG8gY29tcG9zZS4NCiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBmdW5jdGlvbiBvYnRhaW5lZCBieSBjb21wb3NpbmcgdGhlIGFyZ3VtZW50IGZ1bmN0aW9ucw0KICogZnJvbSByaWdodCB0byBsZWZ0LiBGb3IgZXhhbXBsZSwgY29tcG9zZShmLCBnLCBoKSBpcyBpZGVudGljYWwgdG8gZG9pbmcNCiAqICguLi5hcmdzKSA9PiBmKGcoaCguLi5hcmdzKSkpLg0KICovDQoNCmZ1bmN0aW9uIGNvbXBvc2UoKSB7DQogIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBmdW5jcyA9IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgew0KICAgIGZ1bmNzW19rZXldID0gYXJndW1lbnRzW19rZXldOw0KICB9DQoNCiAgaWYgKGZ1bmNzLmxlbmd0aCA9PT0gMCkgew0KICAgIHJldHVybiBmdW5jdGlvbiAoYXJnKSB7DQogICAgICByZXR1cm4gYXJnOw0KICAgIH07DQogIH0NCg0KICBpZiAoZnVuY3MubGVuZ3RoID09PSAxKSB7DQogICAgcmV0dXJuIGZ1bmNzWzBdOw0KICB9DQoNCiAgcmV0dXJuIGZ1bmNzLnJlZHVjZShmdW5jdGlvbiAoYSwgYikgew0KICAgIHJldHVybiBmdW5jdGlvbiAoKSB7DQogICAgICByZXR1cm4gYShiLmFwcGx5KHVuZGVmaW5lZCwgYXJndW1lbnRzKSk7DQogICAgfTsNCiAgfSk7DQp9DQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWR1eC9lcy9hcHBseU1pZGRsZXdhcmUuanMNCnZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07DQoNCg0KDQovKioNCiAqIENyZWF0ZXMgYSBzdG9yZSBlbmhhbmNlciB0aGF0IGFwcGxpZXMgbWlkZGxld2FyZSB0byB0aGUgZGlzcGF0Y2ggbWV0aG9kDQogKiBvZiB0aGUgUmVkdXggc3RvcmUuIFRoaXMgaXMgaGFuZHkgZm9yIGEgdmFyaWV0eSBvZiB0YXNrcywgc3VjaCBhcyBleHByZXNzaW5nDQogKiBhc3luY2hyb25vdXMgYWN0aW9ucyBpbiBhIGNvbmNpc2UgbWFubmVyLCBvciBsb2dnaW5nIGV2ZXJ5IGFjdGlvbiBwYXlsb2FkLg0KICoNCiAqIFNlZSBgcmVkdXgtdGh1bmtgIHBhY2thZ2UgYXMgYW4gZXhhbXBsZSBvZiB0aGUgUmVkdXggbWlkZGxld2FyZS4NCiAqDQogKiBCZWNhdXNlIG1pZGRsZXdhcmUgaXMgcG90ZW50aWFsbHkgYXN5bmNocm9ub3VzLCB0aGlzIHNob3VsZCBiZSB0aGUgZmlyc3QNCiAqIHN0b3JlIGVuaGFuY2VyIGluIHRoZSBjb21wb3NpdGlvbiBjaGFpbi4NCiAqDQogKiBOb3RlIHRoYXQgZWFjaCBtaWRkbGV3YXJlIHdpbGwgYmUgZ2l2ZW4gdGhlIGBkaXNwYXRjaGAgYW5kIGBnZXRTdGF0ZWAgZnVuY3Rpb25zDQogKiBhcyBuYW1lZCBhcmd1bWVudHMuDQogKg0KICogQHBhcmFtIHsuLi5GdW5jdGlvbn0gbWlkZGxld2FyZXMgVGhlIG1pZGRsZXdhcmUgY2hhaW4gdG8gYmUgYXBwbGllZC4NCiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBzdG9yZSBlbmhhbmNlciBhcHBseWluZyB0aGUgbWlkZGxld2FyZS4NCiAqLw0KZnVuY3Rpb24gYXBwbHlNaWRkbGV3YXJlKCkgew0KICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgbWlkZGxld2FyZXMgPSBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsNCiAgICBtaWRkbGV3YXJlc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTsNCiAgfQ0KDQogIHJldHVybiBmdW5jdGlvbiAoY3JlYXRlU3RvcmUpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24gKHJlZHVjZXIsIHByZWxvYWRlZFN0YXRlLCBlbmhhbmNlcikgew0KICAgICAgdmFyIHN0b3JlID0gY3JlYXRlU3RvcmUocmVkdWNlciwgcHJlbG9hZGVkU3RhdGUsIGVuaGFuY2VyKTsNCiAgICAgIHZhciBfZGlzcGF0Y2ggPSBzdG9yZS5kaXNwYXRjaDsNCiAgICAgIHZhciBjaGFpbiA9IFtdOw0KDQogICAgICB2YXIgbWlkZGxld2FyZUFQSSA9IHsNCiAgICAgICAgZ2V0U3RhdGU6IHN0b3JlLmdldFN0YXRlLA0KICAgICAgICBkaXNwYXRjaDogZnVuY3Rpb24gZGlzcGF0Y2goYWN0aW9uKSB7DQogICAgICAgICAgcmV0dXJuIF9kaXNwYXRjaChhY3Rpb24pOw0KICAgICAgICB9DQogICAgICB9Ow0KICAgICAgY2hhaW4gPSBtaWRkbGV3YXJlcy5tYXAoZnVuY3Rpb24gKG1pZGRsZXdhcmUpIHsNCiAgICAgICAgcmV0dXJuIG1pZGRsZXdhcmUobWlkZGxld2FyZUFQSSk7DQogICAgICB9KTsNCiAgICAgIF9kaXNwYXRjaCA9IGNvbXBvc2UuYXBwbHkodW5kZWZpbmVkLCBjaGFpbikoc3RvcmUuZGlzcGF0Y2gpOw0KDQogICAgICByZXR1cm4gX2V4dGVuZHMoe30sIHN0b3JlLCB7DQogICAgICAgIGRpc3BhdGNoOiBfZGlzcGF0Y2gNCiAgICAgIH0pOw0KICAgIH07DQogIH07DQp9DQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWR1eC9lcy9pbmRleC5qcw0KLyogY29uY2F0ZWQgaGFybW9ueSByZWV4cG9ydCAqL19fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiY3JlYXRlU3RvcmUiLCBmdW5jdGlvbigpIHsgcmV0dXJuIGNyZWF0ZVN0b3JlX2NyZWF0ZVN0b3JlOyB9KTsNCi8qIGNvbmNhdGVkIGhhcm1vbnkgcmVleHBvcnQgKi9fX3dlYnBhY2tfcmVxdWlyZV9fLmQoX193ZWJwYWNrX2V4cG9ydHNfXywgImNvbWJpbmVSZWR1Y2VycyIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gY29tYmluZVJlZHVjZXJzOyB9KTsNCi8qIGNvbmNhdGVkIGhhcm1vbnkgcmVleHBvcnQgKi9fX3dlYnBhY2tfcmVxdWlyZV9fLmQoX193ZWJwYWNrX2V4cG9ydHNfXywgImJpbmRBY3Rpb25DcmVhdG9ycyIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gYmluZEFjdGlvbkNyZWF0b3JzOyB9KTsNCi8qIGNvbmNhdGVkIGhhcm1vbnkgcmVleHBvcnQgKi9fX3dlYnBhY2tfcmVxdWlyZV9fLmQoX193ZWJwYWNrX2V4cG9ydHNfXywgImFwcGx5TWlkZGxld2FyZSIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gYXBwbHlNaWRkbGV3YXJlOyB9KTsNCi8qIGNvbmNhdGVkIGhhcm1vbnkgcmVleHBvcnQgKi9fX3dlYnBhY2tfcmVxdWlyZV9fLmQoX193ZWJwYWNrX2V4cG9ydHNfXywgImNvbXBvc2UiLCBmdW5jdGlvbigpIHsgcmV0dXJuIGNvbXBvc2U7IH0pOw0KDQoNCg0KDQoNCg0KDQovKg0KKiBUaGlzIGlzIGEgZHVtbXkgZnVuY3Rpb24gdG8gY2hlY2sgaWYgdGhlIGZ1bmN0aW9uIG5hbWUgaGFzIGJlZW4gYWx0ZXJlZCBieSBtaW5pZmljYXRpb24uDQoqIElmIHRoZSBmdW5jdGlvbiBoYXMgYmVlbiBtaW5pZmllZCBhbmQgTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJywgd2FybiB0aGUgdXNlci4NCiovDQpmdW5jdGlvbiBpc0NydXNoZWQoKSB7fQ0KDQppZiAoZmFsc2UpIHsNCiAgd2FybmluZygnWW91IGFyZSBjdXJyZW50bHkgdXNpbmcgbWluaWZpZWQgY29kZSBvdXRzaWRlIG9mIE5PREVfRU5WID09PSBcJ3Byb2R1Y3Rpb25cJy4gJyArICdUaGlzIG1lYW5zIHRoYXQgeW91IGFyZSBydW5uaW5nIGEgc2xvd2VyIGRldmVsb3BtZW50IGJ1aWxkIG9mIFJlZHV4LiAnICsgJ1lvdSBjYW4gdXNlIGxvb3NlLWVudmlmeSAoaHR0cHM6Ly9naXRodWIuY29tL3plcnRvc2gvbG9vc2UtZW52aWZ5KSBmb3IgYnJvd3NlcmlmeSAnICsgJ29yIERlZmluZVBsdWdpbiBmb3Igd2VicGFjayAoaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMDAzMDAzMSkgJyArICd0byBlbnN1cmUgeW91IGhhdmUgdGhlIGNvcnJlY3QgY29kZSBmb3IgeW91ciBwcm9kdWN0aW9uIGJ1aWxkLicpOw0KfQ0KDQoNCg0KLyoqKi8gfSksDQovKiAzNCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQp2YXIgZzsNCg0KLy8gVGhpcyB3b3JrcyBpbiBub24tc3RyaWN0IG1vZGUNCmcgPSAoZnVuY3Rpb24oKSB7DQoJcmV0dXJuIHRoaXM7DQp9KSgpOw0KDQp0cnkgew0KCS8vIFRoaXMgd29ya3MgaWYgZXZhbCBpcyBhbGxvd2VkIChzZWUgQ1NQKQ0KCWcgPSBnIHx8IEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCkgfHwgKDEsZXZhbCkoInRoaXMiKTsNCn0gY2F0Y2goZSkgew0KCS8vIFRoaXMgd29ya3MgaWYgdGhlIHdpbmRvdyByZWZlcmVuY2UgaXMgYXZhaWxhYmxlDQoJaWYodHlwZW9mIHdpbmRvdyA9PT0gIm9iamVjdCIpDQoJCWcgPSB3aW5kb3c7DQp9DQoNCi8vIGcgY2FuIHN0aWxsIGJlIHVuZGVmaW5lZCwgYnV0IG5vdGhpbmcgdG8gZG8gYWJvdXQgaXQuLi4NCi8vIFdlIHJldHVybiB1bmRlZmluZWQsIGluc3RlYWQgb2Ygbm90aGluZyBoZXJlLCBzbyBpdCdzDQovLyBlYXNpZXIgdG8gaGFuZGxlIHRoaXMgY2FzZS4gaWYoIWdsb2JhbCkgeyAuLi59DQoNCm1vZHVsZS5leHBvcnRzID0gZzsNCg0KDQovKioqLyB9KSwNCi8qIDM1ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCg0KdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7DQoNCnZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOw0KDQpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0NCg0KdmFyIFdyYXBwZWRFbGVtZW50ID0gZnVuY3Rpb24gKCkgew0KICBmdW5jdGlvbiBXcmFwcGVkRWxlbWVudChfcmVmKSB7DQogICAgdmFyIGVsZW1lbnQgPSBfcmVmLmVsZW1lbnQsDQogICAgICAgIGNsYXNzTmFtZXMgPSBfcmVmLmNsYXNzTmFtZXM7DQoNCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgV3JhcHBlZEVsZW1lbnQpOw0KDQogICAgT2JqZWN0LmFzc2lnbih0aGlzLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIGNsYXNzTmFtZXM6IGNsYXNzTmFtZXMgfSk7DQoNCiAgICBpZiAoISgwLCBfdXRpbHMuaXNFbGVtZW50KShlbGVtZW50KSkgew0KICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignSW52YWxpZCBlbGVtZW50IHBhc3NlZCcpOw0KICAgIH0NCg0KICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlOw0KICB9DQoNCiAgX2NyZWF0ZUNsYXNzKFdyYXBwZWRFbGVtZW50LCBbew0KICAgIGtleTogJ2NvbmNlYWwnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBjb25jZWFsKCkgew0KICAgICAgLy8gSGlkZSBwYXNzZWQgaW5wdXQNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuY2xhc3NOYW1lcy5pbnB1dCk7DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLmNsYXNzTmFtZXMuaGlkZGVuU3RhdGUpOw0KDQogICAgICAvLyBSZW1vdmUgZWxlbWVudCBmcm9tIHRhYiBpbmRleA0KICAgICAgdGhpcy5lbGVtZW50LnRhYkluZGV4ID0gJy0xJzsNCg0KICAgICAgLy8gQmFja3VwIG9yaWdpbmFsIHN0eWxlcyBpZiBhbnkNCiAgICAgIHZhciBvcmlnU3R5bGUgPSB0aGlzLmVsZW1lbnQuZ2V0QXR0cmlidXRlKCdzdHlsZScpOw0KDQogICAgICBpZiAob3JpZ1N0eWxlKSB7DQogICAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtY2hvaWNlLW9yaWctc3R5bGUnLCBvcmlnU3R5bGUpOw0KICAgICAgfQ0KDQogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7DQogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWNob2ljZScsICdhY3RpdmUnKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdyZXZlYWwnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiByZXZlYWwoKSB7DQogICAgICAvLyBSZWluc3RhdGUgcGFzc2VkIGVsZW1lbnQNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2xhc3NOYW1lcy5pbnB1dCk7DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmNsYXNzTmFtZXMuaGlkZGVuU3RhdGUpOw0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgndGFiaW5kZXgnKTsNCg0KICAgICAgLy8gUmVjb3ZlciBvcmlnaW5hbCBzdHlsZXMgaWYgYW55DQogICAgICB2YXIgb3JpZ1N0eWxlID0gdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1jaG9pY2Utb3JpZy1zdHlsZScpOw0KDQogICAgICBpZiAob3JpZ1N0eWxlKSB7DQogICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtY2hvaWNlLW9yaWctc3R5bGUnKTsNCiAgICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBvcmlnU3R5bGUpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTsNCiAgICAgIH0NCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJyk7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdkYXRhLWNob2ljZScpOw0KDQogICAgICAvLyBSZS1hc3NpZ24gdmFsdWVzIC0gdGhpcyBpcyB3ZWlyZCwgSSBrbm93DQogICAgICB0aGlzLmVsZW1lbnQudmFsdWUgPSB0aGlzLmVsZW1lbnQudmFsdWU7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnZW5hYmxlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZW5hYmxlKCkgew0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTsNCiAgICAgIHRoaXMuZWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlOw0KICAgICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnZGlzYWJsZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2FibGUoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTsNCiAgICAgIHRoaXMuZWxlbWVudC5kaXNhYmxlZCA9IHRydWU7DQogICAgICB0aGlzLmlzRGlzYWJsZWQgPSB0cnVlOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3RyaWdnZXJFdmVudCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHRyaWdnZXJFdmVudChldmVudFR5cGUsIGRhdGEpIHsNCiAgICAgICgwLCBfdXRpbHMuZGlzcGF0Y2hFdmVudCkodGhpcy5lbGVtZW50LCBldmVudFR5cGUsIGRhdGEpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3ZhbHVlJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQudmFsdWU7DQogICAgfQ0KICB9XSk7DQoNCiAgcmV0dXJuIFdyYXBwZWRFbGVtZW50Ow0KfSgpOw0KDQpleHBvcnRzLmRlZmF1bHQgPSBXcmFwcGVkRWxlbWVudDsNCg0KLyoqKi8gfSksDQovKiAzNiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQpleHBvcnRzLlRFTVBMQVRFUyA9IHVuZGVmaW5lZDsNCg0KdmFyIF9jbGFzc25hbWVzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4OSk7DQoNCnZhciBfY2xhc3NuYW1lczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jbGFzc25hbWVzKTsNCg0KdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7DQoNCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9DQoNCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9DQoNCnZhciBURU1QTEFURVMgPSBleHBvcnRzLlRFTVBMQVRFUyA9IHsNCiAgY29udGFpbmVyT3V0ZXI6IGZ1bmN0aW9uIGNvbnRhaW5lck91dGVyKGdsb2JhbENsYXNzZXMsIGRpcmVjdGlvbiwgaXNTZWxlY3RFbGVtZW50LCBpc1NlbGVjdE9uZUVsZW1lbnQsIHNlYXJjaEVuYWJsZWQsIHBhc3NlZEVsZW1lbnRUeXBlKSB7DQogICAgdmFyIHRhYkluZGV4ID0gaXNTZWxlY3RPbmVFbGVtZW50ID8gJ3RhYmluZGV4PSIwIicgOiAnJzsNCiAgICB2YXIgcm9sZSA9IGlzU2VsZWN0RWxlbWVudCA/ICdyb2xlPSJsaXN0Ym94IicgOiAnJzsNCiAgICB2YXIgYXJpYUF1dG9Db21wbGV0ZSA9ICcnOw0KDQogICAgaWYgKGlzU2VsZWN0RWxlbWVudCAmJiBzZWFyY2hFbmFibGVkKSB7DQogICAgICByb2xlID0gJ3JvbGU9ImNvbWJvYm94Iic7DQogICAgICBhcmlhQXV0b0NvbXBsZXRlID0gJ2FyaWEtYXV0b2NvbXBsZXRlPSJsaXN0Iic7DQogICAgfQ0KDQogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPGRpdlxuICAgICAgICBjbGFzcz0iJyArIGdsb2JhbENsYXNzZXMuY29udGFpbmVyT3V0ZXIgKyAnIlxuICAgICAgICBkYXRhLXR5cGU9IicgKyBwYXNzZWRFbGVtZW50VHlwZSArICciXG4gICAgICAgICcgKyByb2xlICsgJ1xuICAgICAgICAnICsgdGFiSW5kZXggKyAnXG4gICAgICAgICcgKyBhcmlhQXV0b0NvbXBsZXRlICsgJ1xuICAgICAgICBhcmlhLWhhc3BvcHVwPSJ0cnVlIlxuICAgICAgICBhcmlhLWV4cGFuZGVkPSJmYWxzZSJcbiAgICAgICAgZGlyPSInICsgZGlyZWN0aW9uICsgJyJcbiAgICAgICAgPlxuICAgICAgPC9kaXY+XG4gICAgJyk7DQogIH0sDQogIGNvbnRhaW5lcklubmVyOiBmdW5jdGlvbiBjb250YWluZXJJbm5lcihnbG9iYWxDbGFzc2VzKSB7DQogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPGRpdiBjbGFzcz0iJyArIGdsb2JhbENsYXNzZXMuY29udGFpbmVySW5uZXIgKyAnIj48L2Rpdj5cbiAgICAnKTsNCiAgfSwNCiAgaXRlbUxpc3Q6IGZ1bmN0aW9uIGl0ZW1MaXN0KGdsb2JhbENsYXNzZXMsIGlzU2VsZWN0T25lRWxlbWVudCkgew0KICAgIHZhciBfY2xhc3NOYW1lczsNCg0KICAgIHZhciBsb2NhbENsYXNzZXMgPSAoMCwgX2NsYXNzbmFtZXMyLmRlZmF1bHQpKGdsb2JhbENsYXNzZXMubGlzdCwgKF9jbGFzc05hbWVzID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lcywgZ2xvYmFsQ2xhc3Nlcy5saXN0U2luZ2xlLCBpc1NlbGVjdE9uZUVsZW1lbnQpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXMsIGdsb2JhbENsYXNzZXMubGlzdEl0ZW1zLCAhaXNTZWxlY3RPbmVFbGVtZW50KSwgX2NsYXNzTmFtZXMpKTsNCg0KICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXYgY2xhc3M9IicgKyBsb2NhbENsYXNzZXMgKyAnIj48L2Rpdj5cbiAgICAnKTsNCiAgfSwNCiAgcGxhY2Vob2xkZXI6IGZ1bmN0aW9uIHBsYWNlaG9sZGVyKGdsb2JhbENsYXNzZXMsIHZhbHVlKSB7DQogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPGRpdiBjbGFzcz0iJyArIGdsb2JhbENsYXNzZXMucGxhY2Vob2xkZXIgKyAnIj5cbiAgICAgICAgJyArIHZhbHVlICsgJ1xuICAgICAgPC9kaXY+XG4gICAgJyk7DQogIH0sDQogIGl0ZW06IGZ1bmN0aW9uIGl0ZW0oZ2xvYmFsQ2xhc3NlcywgZGF0YSwgcmVtb3ZlSXRlbUJ1dHRvbikgew0KICAgIHZhciBfY2xhc3NOYW1lczI7DQoNCiAgICB2YXIgYXJpYVNlbGVjdGVkID0gZGF0YS5hY3RpdmUgPyAnYXJpYS1zZWxlY3RlZD0idHJ1ZSInIDogJyc7DQogICAgdmFyIGFyaWFEaXNhYmxlZCA9IGRhdGEuZGlzYWJsZWQgPyAnYXJpYS1kaXNhYmxlZD0idHJ1ZSInIDogJyc7DQoNCiAgICB2YXIgbG9jYWxDbGFzc2VzID0gKDAsIF9jbGFzc25hbWVzMi5kZWZhdWx0KShnbG9iYWxDbGFzc2VzLml0ZW0sIChfY2xhc3NOYW1lczIgPSB7fSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzMiwgZ2xvYmFsQ2xhc3Nlcy5oaWdobGlnaHRlZFN0YXRlLCBkYXRhLmhpZ2hsaWdodGVkKSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzMiwgZ2xvYmFsQ2xhc3Nlcy5pdGVtU2VsZWN0YWJsZSwgIWRhdGEuaGlnaGxpZ2h0ZWQpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXMyLCBnbG9iYWxDbGFzc2VzLnBsYWNlaG9sZGVyLCBkYXRhLnBsYWNlaG9sZGVyKSwgX2NsYXNzTmFtZXMyKSk7DQoNCiAgICBpZiAocmVtb3ZlSXRlbUJ1dHRvbikgew0KICAgICAgdmFyIF9jbGFzc05hbWVzMzsNCg0KICAgICAgbG9jYWxDbGFzc2VzID0gKDAsIF9jbGFzc25hbWVzMi5kZWZhdWx0KShnbG9iYWxDbGFzc2VzLml0ZW0sIChfY2xhc3NOYW1lczMgPSB7fSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzMywgZ2xvYmFsQ2xhc3Nlcy5oaWdobGlnaHRlZFN0YXRlLCBkYXRhLmhpZ2hsaWdodGVkKSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzMywgZ2xvYmFsQ2xhc3Nlcy5pdGVtU2VsZWN0YWJsZSwgIWRhdGEuZGlzYWJsZWQpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXMzLCBnbG9iYWxDbGFzc2VzLnBsYWNlaG9sZGVyLCBkYXRhLnBsYWNlaG9sZGVyKSwgX2NsYXNzTmFtZXMzKSk7DQoNCiAgICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzPSInICsgbG9jYWxDbGFzc2VzICsgJyJcbiAgICAgICAgICBkYXRhLWl0ZW1cbiAgICAgICAgICBkYXRhLWlkPSInICsgZGF0YS5pZCArICciXG4gICAgICAgICAgZGF0YS12YWx1ZT0iJyArIGRhdGEudmFsdWUgKyAnIlxuICAgICAgICAgIGRhdGEtZGVsZXRhYmxlXG4gICAgICAgICAgJyArIGFyaWFTZWxlY3RlZCArICdcbiAgICAgICAgICAnICsgYXJpYURpc2FibGVkICsgJ1xuICAgICAgICAgID5cbiAgICAgICAgICAnICsgZGF0YS5sYWJlbCArICc8IS0tXG4gICAgICAgLS0+PGJ1dHRvblxuICAgICAgICAgICAgdHlwZT0iYnV0dG9uIlxuICAgICAgICAgICAgY2xhc3M9IicgKyBnbG9iYWxDbGFzc2VzLmJ1dHRvbiArICciXG4gICAgICAgICAgICBkYXRhLWJ1dHRvblxuICAgICAgICAgICAgYXJpYS1sYWJlbD0iUmVtb3ZlIGl0ZW06IFwnJyArIGRhdGEudmFsdWUgKyAnXCciXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICBSZW1vdmUgaXRlbVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICcpOw0KICAgIH0NCg0KICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9IicgKyBsb2NhbENsYXNzZXMgKyAnIlxuICAgICAgICBkYXRhLWl0ZW1cbiAgICAgICAgZGF0YS1pZD0iJyArIGRhdGEuaWQgKyAnIlxuICAgICAgICBkYXRhLXZhbHVlPSInICsgZGF0YS52YWx1ZSArICciXG4gICAgICAgICcgKyBhcmlhU2VsZWN0ZWQgKyAnXG4gICAgICAgICcgKyBhcmlhRGlzYWJsZWQgKyAnXG4gICAgICAgID5cbiAgICAgICAgJyArIGRhdGEubGFiZWwgKyAnXG4gICAgICA8L2Rpdj5cbiAgICAnKTsNCiAgfSwNCiAgY2hvaWNlTGlzdDogZnVuY3Rpb24gY2hvaWNlTGlzdChnbG9iYWxDbGFzc2VzLCBpc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICB2YXIgYXJpYU11bHRpU2VsZWN0YWJsZSA9ICFpc1NlbGVjdE9uZUVsZW1lbnQgPyAnYXJpYS1tdWx0aXNlbGVjdGFibGU9InRydWUiJyA6ICcnOw0KDQogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPGRpdlxuICAgICAgICBjbGFzcz0iJyArIGdsb2JhbENsYXNzZXMubGlzdCArICciXG4gICAgICAgIGRpcj0ibHRyIlxuICAgICAgICByb2xlPSJsaXN0Ym94IlxuICAgICAgICAnICsgYXJpYU11bHRpU2VsZWN0YWJsZSArICdcbiAgICAgICAgPlxuICAgICAgPC9kaXY+XG4gICAgJyk7DQogIH0sDQogIGNob2ljZUdyb3VwOiBmdW5jdGlvbiBjaG9pY2VHcm91cChnbG9iYWxDbGFzc2VzLCBkYXRhKSB7DQogICAgdmFyIGFyaWFEaXNhYmxlZCA9IGRhdGEuZGlzYWJsZWQgPyAnYXJpYS1kaXNhYmxlZD0idHJ1ZSInIDogJyc7DQogICAgdmFyIGxvY2FsQ2xhc3NlcyA9ICgwLCBfY2xhc3NuYW1lczIuZGVmYXVsdCkoZ2xvYmFsQ2xhc3Nlcy5ncm91cCwgX2RlZmluZVByb3BlcnR5KHt9LCBnbG9iYWxDbGFzc2VzLml0ZW1EaXNhYmxlZCwgZGF0YS5kaXNhYmxlZCkpOw0KDQogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPGRpdlxuICAgICAgICBjbGFzcz0iJyArIGxvY2FsQ2xhc3NlcyArICciXG4gICAgICAgIGRhdGEtZ3JvdXBcbiAgICAgICAgZGF0YS1pZD0iJyArIGRhdGEuaWQgKyAnIlxuICAgICAgICBkYXRhLXZhbHVlPSInICsgZGF0YS52YWx1ZSArICciXG4gICAgICAgIHJvbGU9Imdyb3VwIlxuICAgICAgICAnICsgYXJpYURpc2FibGVkICsgJ1xuICAgICAgICA+XG4gICAgICAgIDxkaXYgY2xhc3M9IicgKyBnbG9iYWxDbGFzc2VzLmdyb3VwSGVhZGluZyArICciPicgKyBkYXRhLnZhbHVlICsgJzwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgJyk7DQogIH0sDQogIGNob2ljZTogZnVuY3Rpb24gY2hvaWNlKGdsb2JhbENsYXNzZXMsIGRhdGEsIGl0ZW1TZWxlY3RUZXh0KSB7DQogICAgdmFyIF9jbGFzc05hbWVzNTsNCg0KICAgIHZhciByb2xlID0gZGF0YS5ncm91cElkID4gMCA/ICdyb2xlPSJ0cmVlaXRlbSInIDogJ3JvbGU9Im9wdGlvbiInOw0KICAgIHZhciBsb2NhbENsYXNzZXMgPSAoMCwgX2NsYXNzbmFtZXMyLmRlZmF1bHQpKGdsb2JhbENsYXNzZXMuaXRlbSwgZ2xvYmFsQ2xhc3Nlcy5pdGVtQ2hvaWNlLCAoX2NsYXNzTmFtZXM1ID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczUsIGdsb2JhbENsYXNzZXMuaXRlbURpc2FibGVkLCBkYXRhLmRpc2FibGVkKSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzNSwgZ2xvYmFsQ2xhc3Nlcy5pdGVtU2VsZWN0YWJsZSwgIWRhdGEuZGlzYWJsZWQpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXM1LCBnbG9iYWxDbGFzc2VzLnBsYWNlaG9sZGVyLCBkYXRhLnBsYWNlaG9sZGVyKSwgX2NsYXNzTmFtZXM1KSk7DQoNCiAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzPSInICsgbG9jYWxDbGFzc2VzICsgJyJcbiAgICAgICAgZGF0YS1zZWxlY3QtdGV4dD0iJyArIGl0ZW1TZWxlY3RUZXh0ICsgJyJcbiAgICAgICAgZGF0YS1jaG9pY2VcbiAgICAgICAgZGF0YS1pZD0iJyArIGRhdGEuaWQgKyAnIlxuICAgICAgICBkYXRhLXZhbHVlPSInICsgZGF0YS52YWx1ZSArICciXG4gICAgICAgICcgKyAoZGF0YS5kaXNhYmxlZCA/ICdkYXRhLWNob2ljZS1kaXNhYmxlZCBhcmlhLWRpc2FibGVkPSJ0cnVlIicgOiAnZGF0YS1jaG9pY2Utc2VsZWN0YWJsZScpICsgJ1xuICAgICAgICBpZD0iJyArIGRhdGEuZWxlbWVudElkICsgJyJcbiAgICAgICAgJyArIHJvbGUgKyAnXG4gICAgICAgID5cbiAgICAgICAgJyArIGRhdGEubGFiZWwgKyAnXG4gICAgICA8L2Rpdj5cbiAgICAnKTsNCiAgfSwNCiAgaW5wdXQ6IGZ1bmN0aW9uIGlucHV0KGdsb2JhbENsYXNzZXMpIHsNCiAgICB2YXIgbG9jYWxDbGFzc2VzID0gKDAsIF9jbGFzc25hbWVzMi5kZWZhdWx0KShnbG9iYWxDbGFzc2VzLmlucHV0LCBnbG9iYWxDbGFzc2VzLmlucHV0Q2xvbmVkKTsNCg0KICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxpbnB1dFxuICAgICAgICB0eXBlPSJ0ZXh0IlxuICAgICAgICBjbGFzcz0iJyArIGxvY2FsQ2xhc3NlcyArICciXG4gICAgICAgIGF1dG9jb21wbGV0ZT0ib2ZmIlxuICAgICAgICBhdXRvY2FwaXRhbGl6ZT0ib2ZmIlxuICAgICAgICBzcGVsbGNoZWNrPSJmYWxzZSJcbiAgICAgICAgcm9sZT0idGV4dGJveCJcbiAgICAgICAgYXJpYS1hdXRvY29tcGxldGU9Imxpc3QiXG4gICAgICAgID5cbiAgICAnKTsNCiAgfSwNCiAgZHJvcGRvd246IGZ1bmN0aW9uIGRyb3Bkb3duKGdsb2JhbENsYXNzZXMpIHsNCiAgICB2YXIgbG9jYWxDbGFzc2VzID0gKDAsIF9jbGFzc25hbWVzMi5kZWZhdWx0KShnbG9iYWxDbGFzc2VzLmxpc3QsIGdsb2JhbENsYXNzZXMubGlzdERyb3Bkb3duKTsNCg0KICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9IicgKyBsb2NhbENsYXNzZXMgKyAnIlxuICAgICAgICBhcmlhLWV4cGFuZGVkPSJmYWxzZSJcbiAgICAgICAgPlxuICAgICAgPC9kaXY+XG4gICAgJyk7DQogIH0sDQogIG5vdGljZTogZnVuY3Rpb24gbm90aWNlKGdsb2JhbENsYXNzZXMsIGxhYmVsKSB7DQogICAgdmFyIF9jbGFzc05hbWVzNjsNCg0KICAgIHZhciB0eXBlID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAnJzsNCg0KICAgIHZhciBsb2NhbENsYXNzZXMgPSAoMCwgX2NsYXNzbmFtZXMyLmRlZmF1bHQpKGdsb2JhbENsYXNzZXMuaXRlbSwgZ2xvYmFsQ2xhc3Nlcy5pdGVtQ2hvaWNlLCAoX2NsYXNzTmFtZXM2ID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczYsIGdsb2JhbENsYXNzZXMubm9SZXN1bHRzLCB0eXBlID09PSAnbm8tcmVzdWx0cycpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXM2LCBnbG9iYWxDbGFzc2VzLm5vQ2hvaWNlcywgdHlwZSA9PT0gJ25vLWNob2ljZXMnKSwgX2NsYXNzTmFtZXM2KSk7DQoNCiAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICA8ZGl2IGNsYXNzPSInICsgbG9jYWxDbGFzc2VzICsgJyI+XG4gICAgICAgICcgKyBsYWJlbCArICdcbiAgICAgIDwvZGl2PlxuICAgICcpOw0KICB9LA0KICBvcHRpb246IGZ1bmN0aW9uIG9wdGlvbihkYXRhKSB7DQogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPG9wdGlvbiB2YWx1ZT0iJyArIGRhdGEudmFsdWUgKyAnIiAnICsgKGRhdGEuYWN0aXZlID8gJ3NlbGVjdGVkJyA6ICcnKSArICcgJyArIChkYXRhLmRpc2FibGVkID8gJ2Rpc2FibGVkJyA6ICcnKSArICc+JyArIGRhdGEubGFiZWwgKyAnPC9vcHRpb24+XG4gICAgJyk7DQogIH0NCn07DQoNCmV4cG9ydHMuZGVmYXVsdCA9IFRFTVBMQVRFUzsNCg0KLyoqKi8gfSksDQovKiAzNyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQptb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMzgpOw0KDQoNCi8qKiovIH0pLA0KLyogMzggKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOw0KDQp2YXIgX2Z1c2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM5KTsNCg0KdmFyIF9mdXNlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2Z1c2UpOw0KDQp2YXIgX2RlZXBtZXJnZSA9IF9fd2VicGFja19yZXF1aXJlX18oNDApOw0KDQp2YXIgX2RlZXBtZXJnZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9kZWVwbWVyZ2UpOw0KDQpfX3dlYnBhY2tfcmVxdWlyZV9fKDQxKTsNCg0KdmFyIF9zdG9yZTIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDczKTsNCg0KdmFyIF9zdG9yZTMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9zdG9yZTIpOw0KDQp2YXIgX2NvbXBvbmVudHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgyKTsNCg0KdmFyIF9jb25zdGFudHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOw0KDQp2YXIgX3RlbXBsYXRlcyA9IF9fd2VicGFja19yZXF1aXJlX18oMzYpOw0KDQp2YXIgX2Nob2ljZXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkwKTsNCg0KdmFyIF9pdGVtcyA9IF9fd2VicGFja19yZXF1aXJlX18oOTEpOw0KDQp2YXIgX2dyb3VwcyA9IF9fd2VicGFja19yZXF1aXJlX18oOTIpOw0KDQp2YXIgX21pc2MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkzKTsNCg0KdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7DQoNCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9DQoNCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9DQoNCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gZWxzZSB7IHJldHVybiBBcnJheS5mcm9tKGFycik7IH0gfQ0KDQpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0NCg0KLyoqDQogKiBDaG9pY2VzDQogKiBAYXV0aG9yIEpvc2ggSm9obnNvbjxqb3NoQGpvc2h1YWpvaG5zb24uY28udWs+DQogKi8NCnZhciBDaG9pY2VzID0gZnVuY3Rpb24gKCkgew0KICBmdW5jdGlvbiBDaG9pY2VzKCkgew0KICAgIHZhciBlbGVtZW50ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAnW2RhdGEtY2hvaWNlXSc7DQogICAgdmFyIHVzZXJDb25maWcgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9Ow0KDQogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENob2ljZXMpOw0KDQogICAgaWYgKCgwLCBfdXRpbHMuaXNUeXBlKSgnU3RyaW5nJywgZWxlbWVudCkpIHsNCiAgICAgIHZhciBlbGVtZW50cyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChlbGVtZW50KSk7DQoNCiAgICAgIC8vIElmIHRoZXJlIGFyZSBtdWx0aXBsZSBlbGVtZW50cywgY3JlYXRlIGEgbmV3IGluc3RhbmNlDQogICAgICAvLyBmb3IgZWFjaCBlbGVtZW50IGJlc2lkZXMgdGhlIGZpcnN0IG9uZSAoYXMgdGhhdCBhbHJlYWR5IGhhcyBhbiBpbnN0YW5jZSkNCiAgICAgIGlmIChlbGVtZW50cy5sZW5ndGggPiAxKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9nZW5lcmF0ZUluc3RhbmNlcyhlbGVtZW50cywgdXNlckNvbmZpZyk7DQogICAgICB9DQogICAgfQ0KDQogICAgdGhpcy5jb25maWcgPSBfZGVlcG1lcmdlMi5kZWZhdWx0LmFsbChbX2NvbnN0YW50cy5ERUZBVUxUX0NPTkZJRywgQ2hvaWNlcy51c2VyRGVmYXVsdHMsIHVzZXJDb25maWddKTsNCg0KICAgIGlmICghKDAsIF91dGlscy5kb0tleXNNYXRjaCkodGhpcy5jb25maWcsIF9jb25zdGFudHMuREVGQVVMVF9DT05GSUcpKSB7DQogICAgICBjb25zb2xlLndhcm4oJ1Vua25vd24gY29uZmlnIG9wdGlvbihzKSBwYXNzZWQnKTsNCiAgICB9DQoNCiAgICBpZiAoIVsnYXV0bycsICdhbHdheXMnXS5pbmNsdWRlcyh0aGlzLmNvbmZpZy5yZW5kZXJTZWxlY3RlZENob2ljZXMpKSB7DQogICAgICB0aGlzLmNvbmZpZy5yZW5kZXJTZWxlY3RlZENob2ljZXMgPSAnYXV0byc7DQogICAgfQ0KDQogICAgLy8gUmV0cmlldmUgdHJpZ2dlcmluZyBlbGVtZW50IChpLmUuIGVsZW1lbnQgd2l0aCAnZGF0YS1jaG9pY2UnIHRyaWdnZXIpDQogICAgdmFyIHBhc3NlZEVsZW1lbnQgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ1N0cmluZycsIGVsZW1lbnQpID8gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbGVtZW50KSA6IGVsZW1lbnQ7DQoNCiAgICBpZiAoIXBhc3NlZEVsZW1lbnQpIHsNCiAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKCdDb3VsZCBub3QgZmluZCBwYXNzZWQgZWxlbWVudCBvciBwYXNzZWQgZWxlbWVudCB3YXMgb2YgYW4gaW52YWxpZCB0eXBlJyk7DQogICAgfQ0KDQogICAgdGhpcy5faXNUZXh0RWxlbWVudCA9IHBhc3NlZEVsZW1lbnQudHlwZSA9PT0gJ3RleHQnOw0KICAgIHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCA9IHBhc3NlZEVsZW1lbnQudHlwZSA9PT0gJ3NlbGVjdC1vbmUnOw0KICAgIHRoaXMuX2lzU2VsZWN0TXVsdGlwbGVFbGVtZW50ID0gcGFzc2VkRWxlbWVudC50eXBlID09PSAnc2VsZWN0LW11bHRpcGxlJzsNCiAgICB0aGlzLl9pc1NlbGVjdEVsZW1lbnQgPSB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQgfHwgdGhpcy5faXNTZWxlY3RNdWx0aXBsZUVsZW1lbnQ7DQoNCiAgICBpZiAodGhpcy5faXNUZXh0RWxlbWVudCkgew0KICAgICAgdGhpcy5wYXNzZWRFbGVtZW50ID0gbmV3IF9jb21wb25lbnRzLldyYXBwZWRJbnB1dCh7DQogICAgICAgIGVsZW1lbnQ6IHBhc3NlZEVsZW1lbnQsDQogICAgICAgIGNsYXNzTmFtZXM6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMsDQogICAgICAgIGRlbGltaXRlcjogdGhpcy5jb25maWcuZGVsaW1pdGVyDQogICAgICB9KTsNCiAgICB9IGVsc2UgaWYgKHRoaXMuX2lzU2VsZWN0RWxlbWVudCkgew0KICAgICAgdGhpcy5wYXNzZWRFbGVtZW50ID0gbmV3IF9jb21wb25lbnRzLldyYXBwZWRTZWxlY3Qoew0KICAgICAgICBlbGVtZW50OiBwYXNzZWRFbGVtZW50LA0KICAgICAgICBjbGFzc05hbWVzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzDQogICAgICB9KTsNCiAgICB9DQoNCiAgICBpZiAoIXBhc3NlZEVsZW1lbnQpIHsNCiAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKCdQYXNzZWQgZWxlbWVudCB3YXMgb2YgYW4gaW52YWxpZCB0eXBlJyk7DQogICAgfQ0KDQogICAgaWYgKHRoaXMuY29uZmlnLnNob3VsZFNvcnRJdGVtcyA9PT0gdHJ1ZSAmJiB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQgJiYgIXRoaXMuY29uZmlnLnNpbGVudCkgew0KICAgICAgY29uc29sZS53YXJuKCJzaG91bGRTb3J0RWxlbWVudHM6IFR5cGUgb2YgcGFzc2VkIGVsZW1lbnQgaXMgJ3NlbGVjdC1vbmUnLCBmYWxsaW5nIGJhY2sgdG8gZmFsc2UuIik7DQogICAgfQ0KDQogICAgdGhpcy5pbml0aWFsaXNlZCA9IGZhbHNlOw0KDQogICAgdGhpcy5fc3RvcmUgPSBuZXcgX3N0b3JlMy5kZWZhdWx0KHRoaXMucmVuZGVyKTsNCiAgICB0aGlzLl9pbml0aWFsU3RhdGUgPSB7fTsNCiAgICB0aGlzLl9jdXJyZW50U3RhdGUgPSB7fTsNCiAgICB0aGlzLl9wcmV2U3RhdGUgPSB7fTsNCiAgICB0aGlzLl9jdXJyZW50VmFsdWUgPSAnJzsNCiAgICB0aGlzLl9jYW5TZWFyY2ggPSB0aGlzLmNvbmZpZy5zZWFyY2hFbmFibGVkOw0KICAgIHRoaXMuX2lzU2Nyb2xsaW5nT25JZSA9IGZhbHNlOw0KICAgIHRoaXMuX2hpZ2hsaWdodFBvc2l0aW9uID0gMDsNCiAgICB0aGlzLl93YXNUYXAgPSB0cnVlOw0KICAgIHRoaXMuX3BsYWNlaG9sZGVyVmFsdWUgPSB0aGlzLl9nZW5lcmF0ZVBsYWNlaG9sZGVyVmFsdWUoKTsNCiAgICB0aGlzLl9iYXNlSWQgPSAoMCwgX3V0aWxzLmdlbmVyYXRlSWQpKHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LCAnY2hvaWNlcy0nKTsNCiAgICB0aGlzLl9kaXJlY3Rpb24gPSB0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RpcicpIHx8ICdsdHInOw0KICAgIHRoaXMuX2lkTmFtZXMgPSB7DQogICAgICBpdGVtQ2hvaWNlOiAnaXRlbS1jaG9pY2UnDQogICAgfTsNCiAgICAvLyBBc3NpZ24gcHJlc2V0IGNob2ljZXMgZnJvbSBwYXNzZWQgb2JqZWN0DQogICAgdGhpcy5fcHJlc2V0Q2hvaWNlcyA9IHRoaXMuY29uZmlnLmNob2ljZXM7DQogICAgLy8gQXNzaWduIHByZXNldCBpdGVtcyBmcm9tIHBhc3NlZCBvYmplY3QgZmlyc3QNCiAgICB0aGlzLl9wcmVzZXRJdGVtcyA9IHRoaXMuY29uZmlnLml0ZW1zOw0KICAgIC8vIFRoZW4gYWRkIGFueSB2YWx1ZXMgcGFzc2VkIGZyb20gYXR0cmlidXRlDQogICAgaWYgKHRoaXMucGFzc2VkRWxlbWVudC52YWx1ZSkgew0KICAgICAgdGhpcy5fcHJlc2V0SXRlbXMgPSB0aGlzLl9wcmVzZXRJdGVtcy5jb25jYXQodGhpcy5wYXNzZWRFbGVtZW50LnZhbHVlLnNwbGl0KHRoaXMuY29uZmlnLmRlbGltaXRlcikpOw0KICAgIH0NCg0KICAgIHRoaXMuX3JlbmRlciA9IHRoaXMuX3JlbmRlci5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uRm9jdXMgPSB0aGlzLl9vbkZvY3VzLmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25CbHVyID0gdGhpcy5fb25CbHVyLmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25LZXlVcCA9IHRoaXMuX29uS2V5VXAuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbktleURvd24gPSB0aGlzLl9vbktleURvd24uYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbkNsaWNrID0gdGhpcy5fb25DbGljay5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uVG91Y2hNb3ZlID0gdGhpcy5fb25Ub3VjaE1vdmUuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vblRvdWNoRW5kID0gdGhpcy5fb25Ub3VjaEVuZC5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uTW91c2VEb3duID0gdGhpcy5fb25Nb3VzZURvd24uYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbk1vdXNlT3ZlciA9IHRoaXMuX29uTW91c2VPdmVyLmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25Gb3JtUmVzZXQgPSB0aGlzLl9vbkZvcm1SZXNldC5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uQUtleSA9IHRoaXMuX29uQUtleS5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uRW50ZXJLZXkgPSB0aGlzLl9vbkVudGVyS2V5LmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25Fc2NhcGVLZXkgPSB0aGlzLl9vbkVzY2FwZUtleS5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uRGlyZWN0aW9uS2V5ID0gdGhpcy5fb25EaXJlY3Rpb25LZXkuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbkRlbGV0ZUtleSA9IHRoaXMuX29uRGVsZXRlS2V5LmJpbmQodGhpcyk7DQoNCiAgICAvLyBJZiBlbGVtZW50IGhhcyBhbHJlYWR5IGJlZW4gaW5pdGlhbGlzZWQgd2l0aCBDaG9pY2VzLCBmYWlsIHNpbGVudGx5DQogICAgaWYgKHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1jaG9pY2UnKSA9PT0gJ2FjdGl2ZScpIHsNCiAgICAgIGNvbnNvbGUud2FybignVHJ5aW5nIHRvIGluaXRpYWxpc2UgQ2hvaWNlcyBvbiBlbGVtZW50IGFscmVhZHkgaW5pdGlhbGlzZWQnKTsNCiAgICB9DQoNCiAgICAvLyBMZXQncyBnbw0KICAgIHRoaXMuaW5pdCgpOw0KICB9DQoNCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICA9ICAgICAgICAgICAgUHVibGljIGZ1bmN0aW9ucyAgICAgICAgICAgID0NCiAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQogIF9jcmVhdGVDbGFzcyhDaG9pY2VzLCBbew0KICAgIGtleTogJ2luaXQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0KCkgew0KICAgICAgaWYgKHRoaXMuaW5pdGlhbGlzZWQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB0aGlzLl9jcmVhdGVUZW1wbGF0ZXMoKTsNCiAgICAgIHRoaXMuX2NyZWF0ZUVsZW1lbnRzKCk7DQogICAgICB0aGlzLl9jcmVhdGVTdHJ1Y3R1cmUoKTsNCg0KICAgICAgLy8gU2V0IGluaXRpYWwgc3RhdGUgKFdlIG5lZWQgdG8gY2xvbmUgdGhlIHN0YXRlIGJlY2F1c2Ugc29tZSByZWR1Y2Vycw0KICAgICAgLy8gbW9kaWZ5IHRoZSBpbm5lciBvYmplY3RzIHByb3BlcnRpZXMgaW4gdGhlIHN0YXRlKSDwn6SiDQogICAgICB0aGlzLl9pbml0aWFsU3RhdGUgPSAoMCwgX3V0aWxzLmNsb25lT2JqZWN0KSh0aGlzLl9zdG9yZS5zdGF0ZSk7DQogICAgICB0aGlzLl9zdG9yZS5zdWJzY3JpYmUodGhpcy5fcmVuZGVyKTsNCiAgICAgIHRoaXMuX3JlbmRlcigpOw0KICAgICAgdGhpcy5fYWRkRXZlbnRMaXN0ZW5lcnMoKTsNCg0KICAgICAgdmFyIHNob3VsZERpc2FibGUgPSAhdGhpcy5jb25maWcuYWRkSXRlbXMgfHwgdGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpOw0KDQogICAgICBpZiAoc2hvdWxkRGlzYWJsZSkgew0KICAgICAgICB0aGlzLmRpc2FibGUoKTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5pbml0aWFsaXNlZCA9IHRydWU7DQoNCiAgICAgIHZhciBjYWxsYmFja09uSW5pdCA9IHRoaXMuY29uZmlnLmNhbGxiYWNrT25Jbml0Ow0KICAgICAgLy8gUnVuIGNhbGxiYWNrIGlmIGl0IGlzIGEgZnVuY3Rpb24NCg0KICAgICAgaWYgKGNhbGxiYWNrT25Jbml0ICYmICgwLCBfdXRpbHMuaXNUeXBlKSgnRnVuY3Rpb24nLCBjYWxsYmFja09uSW5pdCkpIHsNCiAgICAgICAgY2FsbGJhY2tPbkluaXQuY2FsbCh0aGlzKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdkZXN0cm95JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHsNCiAgICAgIGlmICghdGhpcy5pbml0aWFsaXNlZCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHRoaXMuX3JlbW92ZUV2ZW50TGlzdGVuZXJzKCk7DQogICAgICB0aGlzLnBhc3NlZEVsZW1lbnQucmV2ZWFsKCk7DQogICAgICB0aGlzLmNvbnRhaW5lck91dGVyLnVud3JhcCh0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudCk7DQoNCiAgICAgIGlmICh0aGlzLl9pc1NlbGVjdEVsZW1lbnQpIHsNCiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50Lm9wdGlvbnMgPSB0aGlzLl9wcmVzZXRDaG9pY2VzOw0KICAgICAgfQ0KDQogICAgICB0aGlzLmNsZWFyU3RvcmUoKTsNCg0KICAgICAgdGhpcy5jb25maWcudGVtcGxhdGVzID0gbnVsbDsNCiAgICAgIHRoaXMuaW5pdGlhbGlzZWQgPSBmYWxzZTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdlbmFibGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBlbmFibGUoKSB7DQogICAgICBpZiAodGhpcy5wYXNzZWRFbGVtZW50LmlzRGlzYWJsZWQpIHsNCiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LmVuYWJsZSgpOw0KICAgICAgfQ0KDQogICAgICBpZiAodGhpcy5jb250YWluZXJPdXRlci5pc0Rpc2FibGVkKSB7DQogICAgICAgIHRoaXMuX2FkZEV2ZW50TGlzdGVuZXJzKCk7DQogICAgICAgIHRoaXMuaW5wdXQuZW5hYmxlKCk7DQogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZW5hYmxlKCk7DQogICAgICB9DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2Rpc2FibGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNhYmxlKCkgew0KICAgICAgaWYgKCF0aGlzLnBhc3NlZEVsZW1lbnQuaXNEaXNhYmxlZCkgew0KICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQuZGlzYWJsZSgpOw0KICAgICAgfQ0KDQogICAgICBpZiAoIXRoaXMuY29udGFpbmVyT3V0ZXIuaXNEaXNhYmxlZCkgew0KICAgICAgICB0aGlzLl9yZW1vdmVFdmVudExpc3RlbmVycygpOw0KICAgICAgICB0aGlzLmlucHV0LmRpc2FibGUoKTsNCiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5kaXNhYmxlKCk7DQogICAgICB9DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2hpZ2hsaWdodEl0ZW0nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBoaWdobGlnaHRJdGVtKGl0ZW0pIHsNCiAgICAgIHZhciBydW5FdmVudCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdHJ1ZTsNCg0KICAgICAgaWYgKCFpdGVtKSB7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICB2YXIgaWQgPSBpdGVtLmlkLA0KICAgICAgICAgIF9pdGVtJGdyb3VwSWQgPSBpdGVtLmdyb3VwSWQsDQogICAgICAgICAgZ3JvdXBJZCA9IF9pdGVtJGdyb3VwSWQgPT09IHVuZGVmaW5lZCA/IC0xIDogX2l0ZW0kZ3JvdXBJZCwNCiAgICAgICAgICBfaXRlbSR2YWx1ZSA9IGl0ZW0udmFsdWUsDQogICAgICAgICAgdmFsdWUgPSBfaXRlbSR2YWx1ZSA9PT0gdW5kZWZpbmVkID8gJycgOiBfaXRlbSR2YWx1ZSwNCiAgICAgICAgICBfaXRlbSRsYWJlbCA9IGl0ZW0ubGFiZWwsDQogICAgICAgICAgbGFiZWwgPSBfaXRlbSRsYWJlbCA9PT0gdW5kZWZpbmVkID8gJycgOiBfaXRlbSRsYWJlbDsNCg0KICAgICAgdmFyIGdyb3VwID0gZ3JvdXBJZCA+PSAwID8gdGhpcy5fc3RvcmUuZ2V0R3JvdXBCeUlkKGdyb3VwSWQpIDogbnVsbDsNCg0KICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9pdGVtcy5oaWdobGlnaHRJdGVtKShpZCwgdHJ1ZSkpOw0KDQogICAgICBpZiAocnVuRXZlbnQpIHsNCiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5oaWdobGlnaHRJdGVtLCB7DQogICAgICAgICAgaWQ6IGlkLA0KICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICBsYWJlbDogbGFiZWwsDQogICAgICAgICAgZ3JvdXBWYWx1ZTogZ3JvdXAgJiYgZ3JvdXAudmFsdWUgPyBncm91cC52YWx1ZSA6IG51bGwNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3VuaGlnaGxpZ2h0SXRlbScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHVuaGlnaGxpZ2h0SXRlbShpdGVtKSB7DQogICAgICBpZiAoIWl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHZhciBpZCA9IGl0ZW0uaWQsDQogICAgICAgICAgX2l0ZW0kZ3JvdXBJZDIgPSBpdGVtLmdyb3VwSWQsDQogICAgICAgICAgZ3JvdXBJZCA9IF9pdGVtJGdyb3VwSWQyID09PSB1bmRlZmluZWQgPyAtMSA6IF9pdGVtJGdyb3VwSWQyLA0KICAgICAgICAgIF9pdGVtJHZhbHVlMiA9IGl0ZW0udmFsdWUsDQogICAgICAgICAgdmFsdWUgPSBfaXRlbSR2YWx1ZTIgPT09IHVuZGVmaW5lZCA/ICcnIDogX2l0ZW0kdmFsdWUyLA0KICAgICAgICAgIF9pdGVtJGxhYmVsMiA9IGl0ZW0ubGFiZWwsDQogICAgICAgICAgbGFiZWwgPSBfaXRlbSRsYWJlbDIgPT09IHVuZGVmaW5lZCA/ICcnIDogX2l0ZW0kbGFiZWwyOw0KDQogICAgICB2YXIgZ3JvdXAgPSBncm91cElkID49IDAgPyB0aGlzLl9zdG9yZS5nZXRHcm91cEJ5SWQoZ3JvdXBJZCkgOiBudWxsOw0KDQogICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX2l0ZW1zLmhpZ2hsaWdodEl0ZW0pKGlkLCBmYWxzZSkpOw0KICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5oaWdobGlnaHRJdGVtLCB7DQogICAgICAgIGlkOiBpZCwNCiAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICBsYWJlbDogbGFiZWwsDQogICAgICAgIGdyb3VwVmFsdWU6IGdyb3VwICYmIGdyb3VwLnZhbHVlID8gZ3JvdXAudmFsdWUgOiBudWxsDQogICAgICB9KTsNCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnaGlnaGxpZ2h0QWxsJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gaGlnaGxpZ2h0QWxsKCkgew0KICAgICAgdmFyIF90aGlzID0gdGhpczsNCg0KICAgICAgdGhpcy5fc3RvcmUuaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICByZXR1cm4gX3RoaXMuaGlnaGxpZ2h0SXRlbShpdGVtKTsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAndW5oaWdobGlnaHRBbGwnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiB1bmhpZ2hsaWdodEFsbCgpIHsNCiAgICAgIHZhciBfdGhpczIgPSB0aGlzOw0KDQogICAgICB0aGlzLl9zdG9yZS5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgIHJldHVybiBfdGhpczIudW5oaWdobGlnaHRJdGVtKGl0ZW0pOw0KICAgICAgfSk7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdyZW1vdmVBY3RpdmVJdGVtc0J5VmFsdWUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVBY3RpdmVJdGVtc0J5VmFsdWUodmFsdWUpIHsNCiAgICAgIHZhciBfdGhpczMgPSB0aGlzOw0KDQogICAgICB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtcy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWUgPT09IHZhbHVlOw0KICAgICAgfSkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICByZXR1cm4gX3RoaXMzLl9yZW1vdmVJdGVtKGl0ZW0pOw0KICAgICAgfSk7DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3JlbW92ZUFjdGl2ZUl0ZW1zJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlQWN0aXZlSXRlbXMoZXhjbHVkZWRJZCkgew0KICAgICAgdmFyIF90aGlzNCA9IHRoaXM7DQoNCiAgICAgIHRoaXMuX3N0b3JlLmFjdGl2ZUl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoX3JlZikgew0KICAgICAgICB2YXIgaWQgPSBfcmVmLmlkOw0KICAgICAgICByZXR1cm4gaWQgIT09IGV4Y2x1ZGVkSWQ7DQogICAgICB9KS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgIHJldHVybiBfdGhpczQuX3JlbW92ZUl0ZW0oaXRlbSk7DQogICAgICB9KTsNCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAncmVtb3ZlSGlnaGxpZ2h0ZWRJdGVtcycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUhpZ2hsaWdodGVkSXRlbXMoKSB7DQogICAgICB2YXIgX3RoaXM1ID0gdGhpczsNCg0KICAgICAgdmFyIHJ1bkV2ZW50ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBmYWxzZTsNCg0KICAgICAgdGhpcy5fc3RvcmUuaGlnaGxpZ2h0ZWRBY3RpdmVJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgIF90aGlzNS5fcmVtb3ZlSXRlbShpdGVtKTsNCiAgICAgICAgLy8gSWYgdGhpcyBhY3Rpb24gd2FzIHBlcmZvcm1lZCBieSB0aGUgdXNlcg0KICAgICAgICAvLyB0cmlnZ2VyIHRoZSBldmVudA0KICAgICAgICBpZiAocnVuRXZlbnQpIHsNCiAgICAgICAgICBfdGhpczUuX3RyaWdnZXJDaGFuZ2UoaXRlbS52YWx1ZSk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdzaG93RHJvcGRvd24nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzaG93RHJvcGRvd24ocHJldmVudElucHV0Rm9jdXMpIHsNCiAgICAgIHZhciBfdGhpczYgPSB0aGlzOw0KDQogICAgICBpZiAodGhpcy5kcm9wZG93bi5pc0FjdGl2ZSkgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgX3RoaXM2LmRyb3Bkb3duLnNob3coKTsNCiAgICAgICAgX3RoaXM2LmNvbnRhaW5lck91dGVyLm9wZW4oX3RoaXM2LmRyb3Bkb3duLmRpc3RhbmNlRnJvbVRvcFdpbmRvdygpKTsNCg0KICAgICAgICBpZiAoIXByZXZlbnRJbnB1dEZvY3VzICYmIF90aGlzNi5fY2FuU2VhcmNoKSB7DQogICAgICAgICAgX3RoaXM2LmlucHV0LmZvY3VzKCk7DQogICAgICAgIH0NCg0KICAgICAgICBfdGhpczYucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMuc2hvd0Ryb3Bkb3duLCB7fSk7DQogICAgICB9KTsNCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnaGlkZURyb3Bkb3duJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gaGlkZURyb3Bkb3duKHByZXZlbnRJbnB1dEJsdXIpIHsNCiAgICAgIHZhciBfdGhpczcgPSB0aGlzOw0KDQogICAgICBpZiAoIXRoaXMuZHJvcGRvd24uaXNBY3RpdmUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7DQogICAgICAgIF90aGlzNy5kcm9wZG93bi5oaWRlKCk7DQogICAgICAgIF90aGlzNy5jb250YWluZXJPdXRlci5jbG9zZSgpOw0KDQogICAgICAgIGlmICghcHJldmVudElucHV0Qmx1ciAmJiBfdGhpczcuX2NhblNlYXJjaCkgew0KICAgICAgICAgIF90aGlzNy5pbnB1dC5yZW1vdmVBY3RpdmVEZXNjZW5kYW50KCk7DQogICAgICAgICAgX3RoaXM3LmlucHV0LmJsdXIoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIF90aGlzNy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5oaWRlRHJvcGRvd24sIHt9KTsNCiAgICAgIH0pOw0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICd0b2dnbGVEcm9wZG93bicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHRvZ2dsZURyb3Bkb3duKCkgew0KICAgICAgdGhpcy5kcm9wZG93bi5pc0FjdGl2ZSA/IHRoaXMuaGlkZURyb3Bkb3duKCkgOiB0aGlzLnNob3dEcm9wZG93bigpOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnZ2V0VmFsdWUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSgpIHsNCiAgICAgIHZhciB2YWx1ZU9ubHkgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IGZhbHNlOw0KDQogICAgICB2YXIgdmFsdWVzID0gdGhpcy5fc3RvcmUuYWN0aXZlSXRlbXMucmVkdWNlKGZ1bmN0aW9uIChzZWxlY3RlZEl0ZW1zLCBpdGVtKSB7DQogICAgICAgIHZhciBpdGVtVmFsdWUgPSB2YWx1ZU9ubHkgPyBpdGVtLnZhbHVlIDogaXRlbTsNCiAgICAgICAgc2VsZWN0ZWRJdGVtcy5wdXNoKGl0ZW1WYWx1ZSk7DQogICAgICAgIHJldHVybiBzZWxlY3RlZEl0ZW1zOw0KICAgICAgfSwgW10pOw0KDQogICAgICByZXR1cm4gdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50ID8gdmFsdWVzWzBdIDogdmFsdWVzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3NldFZhbHVlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VmFsdWUoYXJncykgew0KICAgICAgdmFyIF90aGlzOCA9IHRoaXM7DQoNCiAgICAgIGlmICghdGhpcy5pbml0aWFsaXNlZCkgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShhcmdzKSkuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIF90aGlzOC5fc2V0Q2hvaWNlT3JJdGVtKHZhbHVlKTsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnc2V0Q2hvaWNlQnlWYWx1ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNldENob2ljZUJ5VmFsdWUodmFsdWUpIHsNCiAgICAgIHZhciBfdGhpczkgPSB0aGlzOw0KDQogICAgICBpZiAoIXRoaXMuaW5pdGlhbGlzZWQgfHwgdGhpcy5faXNUZXh0RWxlbWVudCkgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgLy8gSWYgb25seSBvbmUgdmFsdWUgaGFzIGJlZW4gcGFzc2VkLCBjb252ZXJ0IHRvIGFycmF5DQogICAgICB2YXIgY2hvaWNlVmFsdWUgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ0FycmF5JywgdmFsdWUpID8gdmFsdWUgOiBbdmFsdWVdOw0KDQogICAgICAvLyBMb29wIHRocm91Z2ggZWFjaCB2YWx1ZSBhbmQNCiAgICAgIGNob2ljZVZhbHVlLmZvckVhY2goZnVuY3Rpb24gKHZhbCkgew0KICAgICAgICByZXR1cm4gX3RoaXM5Ll9maW5kQW5kU2VsZWN0Q2hvaWNlQnlWYWx1ZSh2YWwpOw0KICAgICAgfSk7DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3NldENob2ljZXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDaG9pY2VzKCkgew0KICAgICAgdmFyIGNob2ljZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOw0KICAgICAgdmFyIHZhbHVlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAnJzsNCg0KICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOw0KDQogICAgICB2YXIgbGFiZWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICcnOw0KICAgICAgdmFyIHJlcGxhY2VDaG9pY2VzID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiBmYWxzZTsNCg0KICAgICAgaWYgKCF0aGlzLl9pc1NlbGVjdEVsZW1lbnQgfHwgIWNob2ljZXMubGVuZ3RoIHx8ICF2YWx1ZSkgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgLy8gQ2xlYXIgY2hvaWNlcyBpZiBuZWVkZWQNCiAgICAgIGlmIChyZXBsYWNlQ2hvaWNlcykgew0KICAgICAgICB0aGlzLl9jbGVhckNob2ljZXMoKTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5jb250YWluZXJPdXRlci5yZW1vdmVMb2FkaW5nU3RhdGUoKTsNCiAgICAgIHZhciBhZGRHcm91cHNBbmRDaG9pY2VzID0gZnVuY3Rpb24gYWRkR3JvdXBzQW5kQ2hvaWNlcyhncm91cE9yQ2hvaWNlKSB7DQogICAgICAgIGlmIChncm91cE9yQ2hvaWNlLmNob2ljZXMpIHsNCiAgICAgICAgICBfdGhpczEwLl9hZGRHcm91cCh7DQogICAgICAgICAgICBncm91cDogZ3JvdXBPckNob2ljZSwNCiAgICAgICAgICAgIGlkOiBncm91cE9yQ2hvaWNlLmlkIHx8IG51bGwsDQogICAgICAgICAgICB2YWx1ZUtleTogdmFsdWUsDQogICAgICAgICAgICBsYWJlbEtleTogbGFiZWwNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBfdGhpczEwLl9hZGRDaG9pY2Uoew0KICAgICAgICAgICAgdmFsdWU6IGdyb3VwT3JDaG9pY2VbdmFsdWVdLA0KICAgICAgICAgICAgbGFiZWw6IGdyb3VwT3JDaG9pY2VbbGFiZWxdLA0KICAgICAgICAgICAgaXNTZWxlY3RlZDogZ3JvdXBPckNob2ljZS5zZWxlY3RlZCwNCiAgICAgICAgICAgIGlzRGlzYWJsZWQ6IGdyb3VwT3JDaG9pY2UuZGlzYWJsZWQsDQogICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBncm91cE9yQ2hvaWNlLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgICBwbGFjZWhvbGRlcjogZ3JvdXBPckNob2ljZS5wbGFjZWhvbGRlcg0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9Ow0KDQogICAgICBjaG9pY2VzLmZvckVhY2goYWRkR3JvdXBzQW5kQ2hvaWNlcyk7DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2NsZWFyU3RvcmUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhclN0b3JlKCkgew0KICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9taXNjLmNsZWFyQWxsKSgpKTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2NsZWFySW5wdXQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhcklucHV0KCkgew0KICAgICAgdmFyIHNob3VsZFNldElucHV0V2lkdGggPSAhdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50Ow0KICAgICAgdGhpcy5pbnB1dC5jbGVhcihzaG91bGRTZXRJbnB1dFdpZHRoKTsNCg0KICAgICAgaWYgKCF0aGlzLl9pc1RleHRFbGVtZW50ICYmIHRoaXMuX2NhblNlYXJjaCkgew0KICAgICAgICB0aGlzLl9pc1NlYXJjaGluZyA9IGZhbHNlOw0KICAgICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX2Nob2ljZXMuYWN0aXZhdGVDaG9pY2VzKSh0cnVlKSk7DQogICAgICB9DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2FqYXgnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBhamF4KGZuKSB7DQogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7DQoNCiAgICAgIGlmICghdGhpcy5pbml0aWFsaXNlZCB8fCAhdGhpcy5faXNTZWxlY3RFbGVtZW50IHx8ICFmbikgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIF90aGlzMTEuX2hhbmRsZUxvYWRpbmdTdGF0ZSh0cnVlKTsNCiAgICAgIH0pOw0KICAgICAgZm4odGhpcy5fYWpheENhbGxiYWNrKCkpOw0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQoNCiAgICAvKiA9PT09PSAgRW5kIG9mIFB1YmxpYyBmdW5jdGlvbnMgID09PT09PSAqLw0KDQogICAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogICAgPSAgICAgICAgICAgICAgICBQcml2YXRlIGZ1bmN0aW9ucyAgICAgICAgICAgID0NCiAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KICB9LCB7DQogICAga2V5OiAnX3JlbmRlcicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW5kZXIoKSB7DQogICAgICB0aGlzLl9jdXJyZW50U3RhdGUgPSB0aGlzLl9zdG9yZS5zdGF0ZTsNCg0KICAgICAgdmFyIHN0YXRlQ2hhbmdlZCA9IHRoaXMuX2N1cnJlbnRTdGF0ZS5jaG9pY2VzICE9PSB0aGlzLl9wcmV2U3RhdGUuY2hvaWNlcyB8fCB0aGlzLl9jdXJyZW50U3RhdGUuZ3JvdXBzICE9PSB0aGlzLl9wcmV2U3RhdGUuZ3JvdXBzIHx8IHRoaXMuX2N1cnJlbnRTdGF0ZS5pdGVtcyAhPT0gdGhpcy5fcHJldlN0YXRlLml0ZW1zOw0KICAgICAgdmFyIHNob3VsZFJlbmRlckNob2ljZXMgPSB0aGlzLl9pc1NlbGVjdEVsZW1lbnQ7DQogICAgICB2YXIgc2hvdWxkUmVuZGVySXRlbXMgPSB0aGlzLl9jdXJyZW50U3RhdGUuaXRlbXMgIT09IHRoaXMuX3ByZXZTdGF0ZS5pdGVtczsNCg0KICAgICAgaWYgKCFzdGF0ZUNoYW5nZWQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICBpZiAoc2hvdWxkUmVuZGVyQ2hvaWNlcykgew0KICAgICAgICB0aGlzLl9yZW5kZXJDaG9pY2VzKCk7DQogICAgICB9DQoNCiAgICAgIGlmIChzaG91bGRSZW5kZXJJdGVtcykgew0KICAgICAgICB0aGlzLl9yZW5kZXJJdGVtcygpOw0KICAgICAgfQ0KDQogICAgICB0aGlzLl9wcmV2U3RhdGUgPSB0aGlzLl9jdXJyZW50U3RhdGU7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX3JlbmRlckNob2ljZXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVuZGVyQ2hvaWNlcygpIHsNCiAgICAgIHZhciBfdGhpczEyID0gdGhpczsNCg0KICAgICAgdmFyIF9zdG9yZSA9IHRoaXMuX3N0b3JlLA0KICAgICAgICAgIGFjdGl2ZUdyb3VwcyA9IF9zdG9yZS5hY3RpdmVHcm91cHMsDQogICAgICAgICAgYWN0aXZlQ2hvaWNlcyA9IF9zdG9yZS5hY3RpdmVDaG9pY2VzOw0KDQogICAgICB2YXIgY2hvaWNlTGlzdEZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KDQogICAgICB0aGlzLmNob2ljZUxpc3QuY2xlYXIoKTsNCg0KICAgICAgaWYgKHRoaXMuY29uZmlnLnJlc2V0U2Nyb2xsUG9zaXRpb24pIHsNCiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICByZXR1cm4gX3RoaXMxMi5jaG9pY2VMaXN0LnNjcm9sbFRvVG9wKCk7DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICAvLyBJZiB3ZSBoYXZlIGdyb3VwZWQgb3B0aW9ucw0KICAgICAgaWYgKGFjdGl2ZUdyb3Vwcy5sZW5ndGggPj0gMSAmJiAhdGhpcy5faXNTZWFyY2hpbmcpIHsNCiAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIHBsYWNlaG9sZGVyIGNob2ljZSBhbG9uZyB3aXRoIGdyb3Vwcw0KICAgICAgICB2YXIgYWN0aXZlUGxhY2Vob2xkZXJzID0gYWN0aXZlQ2hvaWNlcy5maWx0ZXIoZnVuY3Rpb24gKGFjdGl2ZUNob2ljZSkgew0KICAgICAgICAgIHJldHVybiBhY3RpdmVDaG9pY2UucGxhY2Vob2xkZXIgPT09IHRydWUgJiYgYWN0aXZlQ2hvaWNlLmdyb3VwSWQgPT09IC0xOw0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKGFjdGl2ZVBsYWNlaG9sZGVycy5sZW5ndGggPj0gMSkgew0KICAgICAgICAgIGNob2ljZUxpc3RGcmFnbWVudCA9IHRoaXMuX2NyZWF0ZUNob2ljZXNGcmFnbWVudChhY3RpdmVQbGFjZWhvbGRlcnMsIGNob2ljZUxpc3RGcmFnbWVudCk7DQogICAgICAgIH0NCiAgICAgICAgY2hvaWNlTGlzdEZyYWdtZW50ID0gdGhpcy5fY3JlYXRlR3JvdXBzRnJhZ21lbnQoYWN0aXZlR3JvdXBzLCBhY3RpdmVDaG9pY2VzLCBjaG9pY2VMaXN0RnJhZ21lbnQpOw0KICAgICAgfSBlbHNlIGlmIChhY3RpdmVDaG9pY2VzLmxlbmd0aCA+PSAxKSB7DQogICAgICAgIGNob2ljZUxpc3RGcmFnbWVudCA9IHRoaXMuX2NyZWF0ZUNob2ljZXNGcmFnbWVudChhY3RpdmVDaG9pY2VzLCBjaG9pY2VMaXN0RnJhZ21lbnQpOw0KICAgICAgfQ0KDQogICAgICAvLyBJZiB3ZSBoYXZlIGNob2ljZXMgdG8gc2hvdw0KICAgICAgaWYgKGNob2ljZUxpc3RGcmFnbWVudC5jaGlsZE5vZGVzICYmIGNob2ljZUxpc3RGcmFnbWVudC5jaGlsZE5vZGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgdmFyIGFjdGl2ZUl0ZW1zID0gdGhpcy5fc3RvcmUuYWN0aXZlSXRlbXM7DQogICAgICAgIHZhciBjYW5BZGRJdGVtID0gdGhpcy5fY2FuQWRkSXRlbShhY3RpdmVJdGVtcywgdGhpcy5pbnB1dC52YWx1ZSk7DQoNCiAgICAgICAgLy8gLi4uYW5kIHdlIGNhbiBzZWxlY3QgdGhlbQ0KICAgICAgICBpZiAoY2FuQWRkSXRlbS5yZXNwb25zZSkgew0KICAgICAgICAgIC8vIC4uLmFwcGVuZCB0aGVtIGFuZCBoaWdobGlnaHQgdGhlIGZpcnN0IGNob2ljZQ0KICAgICAgICAgIHRoaXMuY2hvaWNlTGlzdC5hcHBlbmQoY2hvaWNlTGlzdEZyYWdtZW50KTsNCiAgICAgICAgICB0aGlzLl9oaWdobGlnaHRDaG9pY2UoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAvLyAuLi5vdGhlcndpc2Ugc2hvdyBhIG5vdGljZQ0KICAgICAgICAgIHRoaXMuY2hvaWNlTGlzdC5hcHBlbmQodGhpcy5fZ2V0VGVtcGxhdGUoJ25vdGljZScsIGNhbkFkZEl0ZW0ubm90aWNlKSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIE90aGVyd2lzZSBzaG93IGEgbm90aWNlDQogICAgICAgIHZhciBkcm9wZG93bkl0ZW0gPSB2b2lkIDA7DQogICAgICAgIHZhciBub3RpY2UgPSB2b2lkIDA7DQoNCiAgICAgICAgaWYgKHRoaXMuX2lzU2VhcmNoaW5nKSB7DQogICAgICAgICAgbm90aWNlID0gKDAsIF91dGlscy5pc1R5cGUpKCdGdW5jdGlvbicsIHRoaXMuY29uZmlnLm5vUmVzdWx0c1RleHQpID8gdGhpcy5jb25maWcubm9SZXN1bHRzVGV4dCgpIDogdGhpcy5jb25maWcubm9SZXN1bHRzVGV4dDsNCg0KICAgICAgICAgIGRyb3Bkb3duSXRlbSA9IHRoaXMuX2dldFRlbXBsYXRlKCdub3RpY2UnLCBub3RpY2UsICduby1yZXN1bHRzJyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbm90aWNlID0gKDAsIF91dGlscy5pc1R5cGUpKCdGdW5jdGlvbicsIHRoaXMuY29uZmlnLm5vQ2hvaWNlc1RleHQpID8gdGhpcy5jb25maWcubm9DaG9pY2VzVGV4dCgpIDogdGhpcy5jb25maWcubm9DaG9pY2VzVGV4dDsNCg0KICAgICAgICAgIGRyb3Bkb3duSXRlbSA9IHRoaXMuX2dldFRlbXBsYXRlKCdub3RpY2UnLCBub3RpY2UsICduby1jaG9pY2VzJyk7DQogICAgICAgIH0NCg0KICAgICAgICB0aGlzLmNob2ljZUxpc3QuYXBwZW5kKGRyb3Bkb3duSXRlbSk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX3JlbmRlckl0ZW1zJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlckl0ZW1zKCkgew0KICAgICAgdmFyIGFjdGl2ZUl0ZW1zID0gdGhpcy5fc3RvcmUuYWN0aXZlSXRlbXMgfHwgW107DQogICAgICB0aGlzLml0ZW1MaXN0LmNsZWFyKCk7DQoNCiAgICAgIC8vIENyZWF0ZSBhIGZyYWdtZW50IHRvIHN0b3JlIG91ciBsaXN0IGl0ZW1zDQogICAgICAvLyAoc28gd2UgZG9uJ3QgaGF2ZSB0byB1cGRhdGUgdGhlIERPTSBmb3IgZWFjaCBpdGVtKQ0KICAgICAgdmFyIGl0ZW1MaXN0RnJhZ21lbnQgPSB0aGlzLl9jcmVhdGVJdGVtc0ZyYWdtZW50KGFjdGl2ZUl0ZW1zKTsNCg0KICAgICAgLy8gSWYgd2UgaGF2ZSBpdGVtcyB0byBhZGQsIGFwcGVuZCB0aGVtDQogICAgICBpZiAoaXRlbUxpc3RGcmFnbWVudC5jaGlsZE5vZGVzKSB7DQogICAgICAgIHRoaXMuaXRlbUxpc3QuYXBwZW5kKGl0ZW1MaXN0RnJhZ21lbnQpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19jcmVhdGVHcm91cHNGcmFnbWVudCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVHcm91cHNGcmFnbWVudChncm91cHMsIGNob2ljZXMsIGZyYWdtZW50KSB7DQogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7DQoNCiAgICAgIHZhciBncm91cEZyYWdtZW50ID0gZnJhZ21lbnQgfHwgZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KICAgICAgdmFyIGdldEdyb3VwQ2hvaWNlcyA9IGZ1bmN0aW9uIGdldEdyb3VwQ2hvaWNlcyhncm91cCkgew0KICAgICAgICByZXR1cm4gY2hvaWNlcy5maWx0ZXIoZnVuY3Rpb24gKGNob2ljZSkgew0KICAgICAgICAgIGlmIChfdGhpczEzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgICAgIHJldHVybiBjaG9pY2UuZ3JvdXBJZCA9PT0gZ3JvdXAuaWQ7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiBjaG9pY2UuZ3JvdXBJZCA9PT0gZ3JvdXAuaWQgJiYgKF90aGlzMTMuY29uZmlnLnJlbmRlclNlbGVjdGVkQ2hvaWNlcyA9PT0gJ2Fsd2F5cycgfHwgIWNob2ljZS5zZWxlY3RlZCk7DQogICAgICAgIH0pOw0KICAgICAgfTsNCg0KICAgICAgLy8gSWYgc29ydGluZyBpcyBlbmFibGVkLCBmaWx0ZXIgZ3JvdXBzDQogICAgICBpZiAodGhpcy5jb25maWcuc2hvdWxkU29ydCkgew0KICAgICAgICBncm91cHMuc29ydCh0aGlzLmNvbmZpZy5zb3J0Rm4pOw0KICAgICAgfQ0KDQogICAgICBncm91cHMuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXApIHsNCiAgICAgICAgdmFyIGdyb3VwQ2hvaWNlcyA9IGdldEdyb3VwQ2hvaWNlcyhncm91cCk7DQogICAgICAgIGlmIChncm91cENob2ljZXMubGVuZ3RoID49IDEpIHsNCiAgICAgICAgICB2YXIgZHJvcGRvd25Hcm91cCA9IF90aGlzMTMuX2dldFRlbXBsYXRlKCdjaG9pY2VHcm91cCcsIGdyb3VwKTsNCiAgICAgICAgICBncm91cEZyYWdtZW50LmFwcGVuZENoaWxkKGRyb3Bkb3duR3JvdXApOw0KICAgICAgICAgIF90aGlzMTMuX2NyZWF0ZUNob2ljZXNGcmFnbWVudChncm91cENob2ljZXMsIGdyb3VwRnJhZ21lbnQsIHRydWUpOw0KICAgICAgICB9DQogICAgICB9KTsNCg0KICAgICAgcmV0dXJuIGdyb3VwRnJhZ21lbnQ7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2NyZWF0ZUNob2ljZXNGcmFnbWVudCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVDaG9pY2VzRnJhZ21lbnQoY2hvaWNlcywgZnJhZ21lbnQpIHsNCiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsNCg0KICAgICAgdmFyIHdpdGhpbkdyb3VwID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBmYWxzZTsNCg0KICAgICAgLy8gQ3JlYXRlIGEgZnJhZ21lbnQgdG8gc3RvcmUgb3VyIGxpc3QgaXRlbXMgKHNvIHdlIGRvbid0IGhhdmUgdG8gdXBkYXRlIHRoZSBET00gZm9yIGVhY2ggaXRlbSkNCiAgICAgIHZhciBjaG9pY2VzRnJhZ21lbnQgPSBmcmFnbWVudCB8fCBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7DQogICAgICB2YXIgX2NvbmZpZyA9IHRoaXMuY29uZmlnLA0KICAgICAgICAgIHJlbmRlclNlbGVjdGVkQ2hvaWNlcyA9IF9jb25maWcucmVuZGVyU2VsZWN0ZWRDaG9pY2VzLA0KICAgICAgICAgIHNlYXJjaFJlc3VsdExpbWl0ID0gX2NvbmZpZy5zZWFyY2hSZXN1bHRMaW1pdCwNCiAgICAgICAgICByZW5kZXJDaG9pY2VMaW1pdCA9IF9jb25maWcucmVuZGVyQ2hvaWNlTGltaXQ7DQoNCiAgICAgIHZhciBmaWx0ZXIgPSB0aGlzLl9pc1NlYXJjaGluZyA/IF91dGlscy5zb3J0QnlTY29yZSA6IHRoaXMuY29uZmlnLnNvcnRGbjsNCiAgICAgIHZhciBhcHBlbmRDaG9pY2UgPSBmdW5jdGlvbiBhcHBlbmRDaG9pY2UoY2hvaWNlKSB7DQogICAgICAgIHZhciBzaG91bGRSZW5kZXIgPSByZW5kZXJTZWxlY3RlZENob2ljZXMgPT09ICdhdXRvJyA/IF90aGlzMTQuX2lzU2VsZWN0T25lRWxlbWVudCB8fCAhY2hvaWNlLnNlbGVjdGVkIDogdHJ1ZTsNCiAgICAgICAgaWYgKHNob3VsZFJlbmRlcikgew0KICAgICAgICAgIHZhciBkcm9wZG93bkl0ZW0gPSBfdGhpczE0Ll9nZXRUZW1wbGF0ZSgnY2hvaWNlJywgY2hvaWNlLCBfdGhpczE0LmNvbmZpZy5pdGVtU2VsZWN0VGV4dCk7DQogICAgICAgICAgY2hvaWNlc0ZyYWdtZW50LmFwcGVuZENoaWxkKGRyb3Bkb3duSXRlbSk7DQogICAgICAgIH0NCiAgICAgIH07DQoNCiAgICAgIHZhciByZW5kZXJlcmFibGVDaG9pY2VzID0gY2hvaWNlczsNCg0KICAgICAgaWYgKHJlbmRlclNlbGVjdGVkQ2hvaWNlcyA9PT0gJ2F1dG8nICYmICF0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgcmVuZGVyZXJhYmxlQ2hvaWNlcyA9IGNob2ljZXMuZmlsdGVyKGZ1bmN0aW9uIChjaG9pY2UpIHsNCiAgICAgICAgICByZXR1cm4gIWNob2ljZS5zZWxlY3RlZDsNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAgIC8vIFNwbGl0IGFycmF5IGludG8gcGxhY2Vob2xkZXJzIGFuZCAibm9ybWFsIiBjaG9pY2VzDQoNCiAgICAgIHZhciBfcmVuZGVyZXJhYmxlQ2hvaWNlcyQgPSByZW5kZXJlcmFibGVDaG9pY2VzLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBjaG9pY2UpIHsNCiAgICAgICAgaWYgKGNob2ljZS5wbGFjZWhvbGRlcikgew0KICAgICAgICAgIGFjYy5wbGFjZWhvbGRlckNob2ljZXMucHVzaChjaG9pY2UpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGFjYy5ub3JtYWxDaG9pY2VzLnB1c2goY2hvaWNlKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gYWNjOw0KICAgICAgfSwgeyBwbGFjZWhvbGRlckNob2ljZXM6IFtdLCBub3JtYWxDaG9pY2VzOiBbXSB9KSwNCiAgICAgICAgICBwbGFjZWhvbGRlckNob2ljZXMgPSBfcmVuZGVyZXJhYmxlQ2hvaWNlcyQucGxhY2Vob2xkZXJDaG9pY2VzLA0KICAgICAgICAgIG5vcm1hbENob2ljZXMgPSBfcmVuZGVyZXJhYmxlQ2hvaWNlcyQubm9ybWFsQ2hvaWNlczsNCg0KICAgICAgLy8gSWYgc29ydGluZyBpcyBlbmFibGVkIG9yIHRoZSB1c2VyIGlzIHNlYXJjaGluZywgZmlsdGVyIGNob2ljZXMNCg0KDQogICAgICBpZiAodGhpcy5jb25maWcuc2hvdWxkU29ydCB8fCB0aGlzLl9pc1NlYXJjaGluZykgew0KICAgICAgICBub3JtYWxDaG9pY2VzLnNvcnQoZmlsdGVyKTsNCiAgICAgIH0NCg0KICAgICAgdmFyIGNob2ljZUxpbWl0ID0gcmVuZGVyZXJhYmxlQ2hvaWNlcy5sZW5ndGg7DQoNCiAgICAgIC8vIFByZXBlbmQgcGxhY2Vob2xlZGVyDQogICAgICB2YXIgc29ydGVkQ2hvaWNlcyA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkocGxhY2Vob2xkZXJDaG9pY2VzKSwgX3RvQ29uc3VtYWJsZUFycmF5KG5vcm1hbENob2ljZXMpKTsNCg0KICAgICAgaWYgKHRoaXMuX2lzU2VhcmNoaW5nKSB7DQogICAgICAgIGNob2ljZUxpbWl0ID0gc2VhcmNoUmVzdWx0TGltaXQ7DQogICAgICB9IGVsc2UgaWYgKHJlbmRlckNob2ljZUxpbWl0ID4gMCAmJiAhd2l0aGluR3JvdXApIHsNCiAgICAgICAgY2hvaWNlTGltaXQgPSByZW5kZXJDaG9pY2VMaW1pdDsNCiAgICAgIH0NCg0KICAgICAgLy8gQWRkIGVhY2ggY2hvaWNlIHRvIGRyb3Bkb3duIHdpdGhpbiByYW5nZQ0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaG9pY2VMaW1pdDsgaSArPSAxKSB7DQogICAgICAgIGlmIChzb3J0ZWRDaG9pY2VzW2ldKSB7DQogICAgICAgICAgYXBwZW5kQ2hvaWNlKHNvcnRlZENob2ljZXNbaV0pOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHJldHVybiBjaG9pY2VzRnJhZ21lbnQ7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2NyZWF0ZUl0ZW1zRnJhZ21lbnQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlSXRlbXNGcmFnbWVudChpdGVtcykgew0KICAgICAgdmFyIF90aGlzMTUgPSB0aGlzOw0KDQogICAgICB2YXIgZnJhZ21lbnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IG51bGw7DQoNCiAgICAgIC8vIENyZWF0ZSBmcmFnbWVudCB0byBhZGQgZWxlbWVudHMgdG8NCiAgICAgIHZhciBfY29uZmlnMiA9IHRoaXMuY29uZmlnLA0KICAgICAgICAgIHNob3VsZFNvcnRJdGVtcyA9IF9jb25maWcyLnNob3VsZFNvcnRJdGVtcywNCiAgICAgICAgICBzb3J0Rm4gPSBfY29uZmlnMi5zb3J0Rm4sDQogICAgICAgICAgcmVtb3ZlSXRlbUJ1dHRvbiA9IF9jb25maWcyLnJlbW92ZUl0ZW1CdXR0b247DQoNCiAgICAgIHZhciBpdGVtTGlzdEZyYWdtZW50ID0gZnJhZ21lbnQgfHwgZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KDQogICAgICAvLyBJZiBzb3J0aW5nIGlzIGVuYWJsZWQsIGZpbHRlciBpdGVtcw0KICAgICAgaWYgKHNob3VsZFNvcnRJdGVtcyAmJiAhdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIGl0ZW1zLnNvcnQoc29ydEZuKTsNCiAgICAgIH0NCg0KICAgICAgaWYgKHRoaXMuX2lzVGV4dEVsZW1lbnQpIHsNCiAgICAgICAgLy8gVXBkYXRlIHRoZSB2YWx1ZSBvZiB0aGUgaGlkZGVuIGlucHV0DQogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC52YWx1ZSA9IGl0ZW1zOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8gVXBkYXRlIHRoZSBvcHRpb25zIG9mIHRoZSBoaWRkZW4gaW5wdXQNCiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50Lm9wdGlvbnMgPSBpdGVtczsNCiAgICAgIH0NCg0KICAgICAgdmFyIGFkZEl0ZW1Ub0ZyYWdtZW50ID0gZnVuY3Rpb24gYWRkSXRlbVRvRnJhZ21lbnQoaXRlbSkgew0KICAgICAgICAvLyBDcmVhdGUgbmV3IGxpc3QgZWxlbWVudA0KICAgICAgICB2YXIgbGlzdEl0ZW0gPSBfdGhpczE1Ll9nZXRUZW1wbGF0ZSgnaXRlbScsIGl0ZW0sIHJlbW92ZUl0ZW1CdXR0b24pOw0KICAgICAgICAvLyBBcHBlbmQgaXQgdG8gbGlzdA0KICAgICAgICBpdGVtTGlzdEZyYWdtZW50LmFwcGVuZENoaWxkKGxpc3RJdGVtKTsNCiAgICAgIH07DQoNCiAgICAgIC8vIEFkZCBlYWNoIGxpc3QgaXRlbSB0byBsaXN0DQogICAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgIHJldHVybiBhZGRJdGVtVG9GcmFnbWVudChpdGVtKTsNCiAgICAgIH0pOw0KDQogICAgICByZXR1cm4gaXRlbUxpc3RGcmFnbWVudDsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfdHJpZ2dlckNoYW5nZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF90cmlnZ2VyQ2hhbmdlKHZhbHVlKSB7DQogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHRoaXMucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMuY2hhbmdlLCB7DQogICAgICAgIHZhbHVlOiB2YWx1ZQ0KICAgICAgfSk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX3NlbGVjdFBsYWNlaG9sZGVyQ2hvaWNlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NlbGVjdFBsYWNlaG9sZGVyQ2hvaWNlKCkgew0KICAgICAgdmFyIHBsYWNlaG9sZGVyQ2hvaWNlID0gdGhpcy5fc3RvcmUucGxhY2Vob2xkZXJDaG9pY2U7DQoNCiAgICAgIGlmIChwbGFjZWhvbGRlckNob2ljZSkgew0KICAgICAgICB0aGlzLl9hZGRJdGVtKHsNCiAgICAgICAgICB2YWx1ZTogcGxhY2Vob2xkZXJDaG9pY2UudmFsdWUsDQogICAgICAgICAgbGFiZWw6IHBsYWNlaG9sZGVyQ2hvaWNlLmxhYmVsLA0KICAgICAgICAgIGNob2ljZUlkOiBwbGFjZWhvbGRlckNob2ljZS5pZCwNCiAgICAgICAgICBncm91cElkOiBwbGFjZWhvbGRlckNob2ljZS5ncm91cElkLA0KICAgICAgICAgIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlckNob2ljZS5wbGFjZWhvbGRlcg0KICAgICAgICB9KTsNCg0KICAgICAgICB0aGlzLl90cmlnZ2VyQ2hhbmdlKHBsYWNlaG9sZGVyQ2hvaWNlLnZhbHVlKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfaGFuZGxlQnV0dG9uQWN0aW9uJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZUJ1dHRvbkFjdGlvbihhY3RpdmVJdGVtcywgZWxlbWVudCkgew0KICAgICAgaWYgKCFhY3RpdmVJdGVtcyB8fCAhZWxlbWVudCB8fCAhdGhpcy5jb25maWcucmVtb3ZlSXRlbXMgfHwgIXRoaXMuY29uZmlnLnJlbW92ZUl0ZW1CdXR0b24pIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB2YXIgaXRlbUlkID0gZWxlbWVudC5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpOw0KICAgICAgdmFyIGl0ZW1Ub1JlbW92ZSA9IGFjdGl2ZUl0ZW1zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIGl0ZW0uaWQgPT09IHBhcnNlSW50KGl0ZW1JZCwgMTApOw0KICAgICAgfSk7DQoNCiAgICAgIC8vIFJlbW92ZSBpdGVtIGFzc29jaWF0ZWQgd2l0aCBidXR0b24NCiAgICAgIHRoaXMuX3JlbW92ZUl0ZW0oaXRlbVRvUmVtb3ZlKTsNCiAgICAgIHRoaXMuX3RyaWdnZXJDaGFuZ2UoaXRlbVRvUmVtb3ZlLnZhbHVlKTsNCg0KICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICB0aGlzLl9zZWxlY3RQbGFjZWhvbGRlckNob2ljZSgpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19oYW5kbGVJdGVtQWN0aW9uJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZUl0ZW1BY3Rpb24oYWN0aXZlSXRlbXMsIGVsZW1lbnQpIHsNCiAgICAgIHZhciBfdGhpczE2ID0gdGhpczsNCg0KICAgICAgdmFyIGhhc1NoaWZ0S2V5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBmYWxzZTsNCg0KICAgICAgaWYgKCFhY3RpdmVJdGVtcyB8fCAhZWxlbWVudCB8fCAhdGhpcy5jb25maWcucmVtb3ZlSXRlbXMgfHwgdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdmFyIHBhc3NlZElkID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTsNCg0KICAgICAgLy8gV2Ugb25seSB3YW50IHRvIHNlbGVjdCBvbmUgaXRlbSB3aXRoIGEgY2xpY2sNCiAgICAgIC8vIHNvIHdlIGRlc2VsZWN0IGFueSBpdGVtcyB0aGF0IGFyZW4ndCB0aGUgdGFyZ2V0DQogICAgICAvLyB1bmxlc3Mgc2hpZnQgaXMgYmVpbmcgcHJlc3NlZA0KICAgICAgYWN0aXZlSXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICBpZiAoaXRlbS5pZCA9PT0gcGFyc2VJbnQocGFzc2VkSWQsIDEwKSAmJiAhaXRlbS5oaWdobGlnaHRlZCkgew0KICAgICAgICAgIF90aGlzMTYuaGlnaGxpZ2h0SXRlbShpdGVtKTsNCiAgICAgICAgfSBlbHNlIGlmICghaGFzU2hpZnRLZXkgJiYgaXRlbS5oaWdobGlnaHRlZCkgew0KICAgICAgICAgIF90aGlzMTYudW5oaWdobGlnaHRJdGVtKGl0ZW0pOw0KICAgICAgICB9DQogICAgICB9KTsNCg0KICAgICAgLy8gRm9jdXMgaW5wdXQgYXMgd2l0aG91dCBmb2N1cywgYSB1c2VyIGNhbm5vdCBkbyBhbnl0aGluZyB3aXRoIGENCiAgICAgIC8vIGhpZ2hsaWdodGVkIGl0ZW0NCiAgICAgIHRoaXMuaW5wdXQuZm9jdXMoKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfaGFuZGxlQ2hvaWNlQWN0aW9uJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZUNob2ljZUFjdGlvbihhY3RpdmVJdGVtcywgZWxlbWVudCkgew0KICAgICAgaWYgKCFhY3RpdmVJdGVtcyB8fCAhZWxlbWVudCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIC8vIElmIHdlIGFyZSBjbGlja2luZyBvbiBhbiBvcHRpb24NCiAgICAgIHZhciBpZCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7DQogICAgICB2YXIgY2hvaWNlID0gdGhpcy5fc3RvcmUuZ2V0Q2hvaWNlQnlJZChpZCk7DQogICAgICB2YXIgcGFzc2VkS2V5Q29kZSA9IGFjdGl2ZUl0ZW1zWzBdICYmIGFjdGl2ZUl0ZW1zWzBdLmtleUNvZGUgPyBhY3RpdmVJdGVtc1swXS5rZXlDb2RlIDogbnVsbDsNCiAgICAgIHZhciBoYXNBY3RpdmVEcm9wZG93biA9IHRoaXMuZHJvcGRvd24uaXNBY3RpdmU7DQoNCiAgICAgIC8vIFVwZGF0ZSBjaG9pY2Uga2V5Q29kZQ0KICAgICAgY2hvaWNlLmtleUNvZGUgPSBwYXNzZWRLZXlDb2RlOw0KDQogICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLmNob2ljZSwgew0KICAgICAgICBjaG9pY2U6IGNob2ljZQ0KICAgICAgfSk7DQoNCiAgICAgIGlmIChjaG9pY2UgJiYgIWNob2ljZS5zZWxlY3RlZCAmJiAhY2hvaWNlLmRpc2FibGVkKSB7DQogICAgICAgIHZhciBjYW5BZGRJdGVtID0gdGhpcy5fY2FuQWRkSXRlbShhY3RpdmVJdGVtcywgY2hvaWNlLnZhbHVlKTsNCg0KICAgICAgICBpZiAoY2FuQWRkSXRlbS5yZXNwb25zZSkgew0KICAgICAgICAgIHRoaXMuX2FkZEl0ZW0oew0KICAgICAgICAgICAgdmFsdWU6IGNob2ljZS52YWx1ZSwNCiAgICAgICAgICAgIGxhYmVsOiBjaG9pY2UubGFiZWwsDQogICAgICAgICAgICBjaG9pY2VJZDogY2hvaWNlLmlkLA0KICAgICAgICAgICAgZ3JvdXBJZDogY2hvaWNlLmdyb3VwSWQsDQogICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBjaG9pY2UuY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBjaG9pY2UucGxhY2Vob2xkZXIsDQogICAgICAgICAgICBrZXlDb2RlOiBjaG9pY2Uua2V5Q29kZQ0KICAgICAgICAgIH0pOw0KDQogICAgICAgICAgdGhpcy5fdHJpZ2dlckNoYW5nZShjaG9pY2UudmFsdWUpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHRoaXMuY2xlYXJJbnB1dCgpOw0KDQogICAgICAvLyBXZSB3b250IHRvIGNsb3NlIHRoZSBkcm9wZG93biBpZiB3ZSBhcmUgZGVhbGluZyB3aXRoIGEgc2luZ2xlIHNlbGVjdCBib3gNCiAgICAgIGlmIChoYXNBY3RpdmVEcm9wZG93biAmJiB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgdGhpcy5oaWRlRHJvcGRvd24odHJ1ZSk7DQogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZm9jdXMoKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfaGFuZGxlQmFja3NwYWNlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZUJhY2tzcGFjZShhY3RpdmVJdGVtcykgew0KICAgICAgaWYgKCF0aGlzLmNvbmZpZy5yZW1vdmVJdGVtcyB8fCAhYWN0aXZlSXRlbXMpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB2YXIgbGFzdEl0ZW0gPSBhY3RpdmVJdGVtc1thY3RpdmVJdGVtcy5sZW5ndGggLSAxXTsNCiAgICAgIHZhciBoYXNIaWdobGlnaHRlZEl0ZW1zID0gYWN0aXZlSXRlbXMuc29tZShmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICByZXR1cm4gaXRlbS5oaWdobGlnaHRlZDsNCiAgICAgIH0pOw0KDQogICAgICAvLyBJZiBlZGl0aW5nIHRoZSBsYXN0IGl0ZW0gaXMgYWxsb3dlZCBhbmQgdGhlcmUgYXJlIG5vdCBvdGhlciBzZWxlY3RlZCBpdGVtcywNCiAgICAgIC8vIHdlIGNhbiBlZGl0IHRoZSBpdGVtIHZhbHVlLiBPdGhlcndpc2UgaWYgd2UgY2FuIHJlbW92ZSBpdGVtcywgcmVtb3ZlIGFsbCBzZWxlY3RlZCBpdGVtcw0KICAgICAgaWYgKHRoaXMuY29uZmlnLmVkaXRJdGVtcyAmJiAhaGFzSGlnaGxpZ2h0ZWRJdGVtcyAmJiBsYXN0SXRlbSkgew0KICAgICAgICB0aGlzLmlucHV0LnZhbHVlID0gbGFzdEl0ZW0udmFsdWU7DQogICAgICAgIHRoaXMuaW5wdXQuc2V0V2lkdGgoKTsNCiAgICAgICAgdGhpcy5fcmVtb3ZlSXRlbShsYXN0SXRlbSk7DQogICAgICAgIHRoaXMuX3RyaWdnZXJDaGFuZ2UobGFzdEl0ZW0udmFsdWUpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaWYgKCFoYXNIaWdobGlnaHRlZEl0ZW1zKSB7DQogICAgICAgICAgLy8gSGlnaGxpZ2h0IGxhc3QgaXRlbSBpZiBub25lIGFscmVhZHkgaGlnaGxpZ2h0ZWQNCiAgICAgICAgICB0aGlzLmhpZ2hsaWdodEl0ZW0obGFzdEl0ZW0sIGZhbHNlKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnJlbW92ZUhpZ2hsaWdodGVkSXRlbXModHJ1ZSk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2hhbmRsZUxvYWRpbmdTdGF0ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVMb2FkaW5nU3RhdGUoKSB7DQogICAgICB2YXIgaXNMb2FkaW5nID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB0cnVlOw0KDQogICAgICB2YXIgcGxhY2Vob2xkZXJJdGVtID0gdGhpcy5pdGVtTGlzdC5nZXRDaGlsZCgnLicgKyB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLnBsYWNlaG9sZGVyKTsNCg0KICAgICAgaWYgKGlzTG9hZGluZykgew0KICAgICAgICB0aGlzLmRpc2FibGUoKTsNCiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5hZGRMb2FkaW5nU3RhdGUoKTsNCg0KICAgICAgICBpZiAodGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgICAgaWYgKCFwbGFjZWhvbGRlckl0ZW0pIHsNCiAgICAgICAgICAgIHBsYWNlaG9sZGVySXRlbSA9IHRoaXMuX2dldFRlbXBsYXRlKCdwbGFjZWhvbGRlcicsIHRoaXMuY29uZmlnLmxvYWRpbmdUZXh0KTsNCiAgICAgICAgICAgIHRoaXMuaXRlbUxpc3QuYXBwZW5kKHBsYWNlaG9sZGVySXRlbSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHBsYWNlaG9sZGVySXRlbS5pbm5lckhUTUwgPSB0aGlzLmNvbmZpZy5sb2FkaW5nVGV4dDsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy5pbnB1dC5wbGFjZWhvbGRlciA9IHRoaXMuY29uZmlnLmxvYWRpbmdUZXh0Ow0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLmVuYWJsZSgpOw0KICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLnJlbW92ZUxvYWRpbmdTdGF0ZSgpOw0KDQogICAgICAgIGlmICh0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgICBwbGFjZWhvbGRlckl0ZW0uaW5uZXJIVE1MID0gdGhpcy5fcGxhY2Vob2xkZXJWYWx1ZSB8fCAnJzsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLmlucHV0LnBsYWNlaG9sZGVyID0gdGhpcy5fcGxhY2Vob2xkZXJWYWx1ZSB8fCAnJzsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19oYW5kbGVTZWFyY2gnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlU2VhcmNoKHZhbHVlKSB7DQogICAgICBpZiAoIXZhbHVlIHx8ICF0aGlzLmlucHV0LmlzRm9jdXNzZWQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB2YXIgY2hvaWNlcyA9IHRoaXMuX3N0b3JlLmNob2ljZXM7DQogICAgICB2YXIgX2NvbmZpZzMgPSB0aGlzLmNvbmZpZywNCiAgICAgICAgICBzZWFyY2hGbG9vciA9IF9jb25maWczLnNlYXJjaEZsb29yLA0KICAgICAgICAgIHNlYXJjaENob2ljZXMgPSBfY29uZmlnMy5zZWFyY2hDaG9pY2VzOw0KDQogICAgICB2YXIgaGFzVW5hY3RpdmVDaG9pY2VzID0gY2hvaWNlcy5zb21lKGZ1bmN0aW9uIChvcHRpb24pIHsNCiAgICAgICAgcmV0dXJuICFvcHRpb24uYWN0aXZlOw0KICAgICAgfSk7DQoNCiAgICAgIC8vIENoZWNrIHRoYXQgd2UgaGF2ZSBhIHZhbHVlIHRvIHNlYXJjaCBhbmQgdGhlIGlucHV0IHdhcyBhbiBhbHBoYW51bWVyaWMgY2hhcmFjdGVyDQogICAgICBpZiAodmFsdWUgJiYgdmFsdWUubGVuZ3RoID49IHNlYXJjaEZsb29yKSB7DQogICAgICAgIHZhciByZXN1bHRDb3VudCA9IHNlYXJjaENob2ljZXMgPyB0aGlzLl9zZWFyY2hDaG9pY2VzKHZhbHVlKSA6IDA7DQogICAgICAgIC8vIFRyaWdnZXIgc2VhcmNoIGV2ZW50DQogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMuc2VhcmNoLCB7DQogICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgIHJlc3VsdENvdW50OiByZXN1bHRDb3VudA0KICAgICAgICB9KTsNCiAgICAgIH0gZWxzZSBpZiAoaGFzVW5hY3RpdmVDaG9pY2VzKSB7DQogICAgICAgIC8vIE90aGVyd2lzZSByZXNldCBjaG9pY2VzIHRvIGFjdGl2ZQ0KICAgICAgICB0aGlzLl9pc1NlYXJjaGluZyA9IGZhbHNlOw0KICAgICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX2Nob2ljZXMuYWN0aXZhdGVDaG9pY2VzKSh0cnVlKSk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2NhbkFkZEl0ZW0nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfY2FuQWRkSXRlbShhY3RpdmVJdGVtcywgdmFsdWUpIHsNCiAgICAgIHZhciBjYW5BZGRJdGVtID0gdHJ1ZTsNCiAgICAgIHZhciBub3RpY2UgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ0Z1bmN0aW9uJywgdGhpcy5jb25maWcuYWRkSXRlbVRleHQpID8gdGhpcy5jb25maWcuYWRkSXRlbVRleHQodmFsdWUpIDogdGhpcy5jb25maWcuYWRkSXRlbVRleHQ7DQoNCiAgICAgIGlmICghdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIHZhciBpc0R1cGxpY2F0ZVZhbHVlID0gKDAsIF91dGlscy5leGlzdHNJbkFycmF5KShhY3RpdmVJdGVtcywgdmFsdWUpOw0KDQogICAgICAgIGlmICh0aGlzLmNvbmZpZy5tYXhJdGVtQ291bnQgPiAwICYmIHRoaXMuY29uZmlnLm1heEl0ZW1Db3VudCA8PSBhY3RpdmVJdGVtcy5sZW5ndGgpIHsNCiAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhIG1heCBlbnRyeSBsaW1pdCBhbmQgd2UgaGF2ZSByZWFjaGVkIHRoYXQgbGltaXQNCiAgICAgICAgICAvLyBkb24ndCB1cGRhdGUNCiAgICAgICAgICBjYW5BZGRJdGVtID0gZmFsc2U7DQogICAgICAgICAgbm90aWNlID0gKDAsIF91dGlscy5pc1R5cGUpKCdGdW5jdGlvbicsIHRoaXMuY29uZmlnLm1heEl0ZW1UZXh0KSA/IHRoaXMuY29uZmlnLm1heEl0ZW1UZXh0KHRoaXMuY29uZmlnLm1heEl0ZW1Db3VudCkgOiB0aGlzLmNvbmZpZy5tYXhJdGVtVGV4dDsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICh0aGlzLmNvbmZpZy5yZWdleEZpbHRlciAmJiB0aGlzLl9pc1RleHRFbGVtZW50ICYmIHRoaXMuY29uZmlnLmFkZEl0ZW1zICYmIGNhbkFkZEl0ZW0pIHsNCiAgICAgICAgICAvLyBJZiBhIHVzZXIgaGFzIHN1cHBsaWVkIGEgcmVndWxhciBleHByZXNzaW9uIGZpbHRlcg0KICAgICAgICAgIC8vIGRldGVybWluZSB3aGV0aGVyIHdlIGNhbiB1cGRhdGUgYmFzZWQgb24gd2hldGhlcg0KICAgICAgICAgIC8vIG91ciByZWd1bGFyIGV4cHJlc3Npb24gcGFzc2VzDQogICAgICAgICAgY2FuQWRkSXRlbSA9ICgwLCBfdXRpbHMucmVnZXhGaWx0ZXIpKHZhbHVlLCB0aGlzLmNvbmZpZy5yZWdleEZpbHRlcik7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIXRoaXMuY29uZmlnLmR1cGxpY2F0ZUl0ZW1zQWxsb3dlZCAmJiBpc0R1cGxpY2F0ZVZhbHVlICYmIGNhbkFkZEl0ZW0pIHsNCiAgICAgICAgICBjYW5BZGRJdGVtID0gZmFsc2U7DQogICAgICAgICAgbm90aWNlID0gKDAsIF91dGlscy5pc1R5cGUpKCdGdW5jdGlvbicsIHRoaXMuY29uZmlnLnVuaXF1ZUl0ZW1UZXh0KSA/IHRoaXMuY29uZmlnLnVuaXF1ZUl0ZW1UZXh0KHZhbHVlKSA6IHRoaXMuY29uZmlnLnVuaXF1ZUl0ZW1UZXh0Ow0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHJldHVybiB7DQogICAgICAgIHJlc3BvbnNlOiBjYW5BZGRJdGVtLA0KICAgICAgICBub3RpY2U6IG5vdGljZQ0KICAgICAgfTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfYWpheENhbGxiYWNrJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FqYXhDYWxsYmFjaygpIHsNCiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsNCg0KICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyZXN1bHRzLCB2YWx1ZSwgbGFiZWwpIHsNCiAgICAgICAgaWYgKCFyZXN1bHRzIHx8ICF2YWx1ZSkgew0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBwYXJzZWRSZXN1bHRzID0gKDAsIF91dGlscy5pc1R5cGUpKCdPYmplY3QnLCByZXN1bHRzKSA/IFtyZXN1bHRzXSA6IHJlc3VsdHM7DQoNCiAgICAgICAgaWYgKHBhcnNlZFJlc3VsdHMgJiYgKDAsIF91dGlscy5pc1R5cGUpKCdBcnJheScsIHBhcnNlZFJlc3VsdHMpICYmIHBhcnNlZFJlc3VsdHMubGVuZ3RoKSB7DQogICAgICAgICAgLy8gUmVtb3ZlIGxvYWRpbmcgc3RhdGVzL3RleHQNCiAgICAgICAgICBfdGhpczE3Ll9oYW5kbGVMb2FkaW5nU3RhdGUoZmFsc2UpOw0KICAgICAgICAgIC8vIEFkZCBlYWNoIHJlc3VsdCBhcyBhIGNob2ljZQ0KICAgICAgICAgIHBhcnNlZFJlc3VsdHMuZm9yRWFjaChmdW5jdGlvbiAocmVzdWx0KSB7DQogICAgICAgICAgICBpZiAocmVzdWx0LmNob2ljZXMpIHsNCiAgICAgICAgICAgICAgX3RoaXMxNy5fYWRkR3JvdXAoew0KICAgICAgICAgICAgICAgIGdyb3VwOiByZXN1bHQsDQogICAgICAgICAgICAgICAgaWQ6IHJlc3VsdC5pZCB8fCBudWxsLA0KICAgICAgICAgICAgICAgIHZhbHVlS2V5OiB2YWx1ZSwNCiAgICAgICAgICAgICAgICBsYWJlbEtleTogbGFiZWwNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBfdGhpczE3Ll9hZGRDaG9pY2Uoew0KICAgICAgICAgICAgICAgIHZhbHVlOiAoMCwgX3V0aWxzLmZldGNoRnJvbU9iamVjdCkocmVzdWx0LCB2YWx1ZSksDQogICAgICAgICAgICAgICAgbGFiZWw6ICgwLCBfdXRpbHMuZmV0Y2hGcm9tT2JqZWN0KShyZXN1bHQsIGxhYmVsKSwNCiAgICAgICAgICAgICAgICBpc1NlbGVjdGVkOiByZXN1bHQuc2VsZWN0ZWQsDQogICAgICAgICAgICAgICAgaXNEaXNhYmxlZDogcmVzdWx0LmRpc2FibGVkLA0KICAgICAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IHJlc3VsdC5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiByZXN1bHQucGxhY2Vob2xkZXINCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQoNCiAgICAgICAgICBpZiAoX3RoaXMxNy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgICAgICBfdGhpczE3Ll9zZWxlY3RQbGFjZWhvbGRlckNob2ljZSgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAvLyBObyByZXN1bHRzLCByZW1vdmUgbG9hZGluZyBzdGF0ZQ0KICAgICAgICAgIF90aGlzMTcuX2hhbmRsZUxvYWRpbmdTdGF0ZShmYWxzZSk7DQogICAgICAgIH0NCiAgICAgIH07DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX3NlYXJjaENob2ljZXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfc2VhcmNoQ2hvaWNlcyh2YWx1ZSkgew0KICAgICAgdmFyIG5ld1ZhbHVlID0gKDAsIF91dGlscy5pc1R5cGUpKCdTdHJpbmcnLCB2YWx1ZSkgPyB2YWx1ZS50cmltKCkgOiB2YWx1ZTsNCiAgICAgIHZhciBjdXJyZW50VmFsdWUgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ1N0cmluZycsIHRoaXMuX2N1cnJlbnRWYWx1ZSkgPyB0aGlzLl9jdXJyZW50VmFsdWUudHJpbSgpIDogdGhpcy5fY3VycmVudFZhbHVlOw0KDQogICAgICBpZiAobmV3VmFsdWUubGVuZ3RoIDwgMSAmJiBuZXdWYWx1ZSA9PT0gY3VycmVudFZhbHVlICsgJyAnKSB7DQogICAgICAgIHJldHVybiAwOw0KICAgICAgfQ0KDQogICAgICAvLyBJZiBuZXcgdmFsdWUgbWF0Y2hlcyB0aGUgZGVzaXJlZCBsZW5ndGggYW5kIGlzIG5vdCB0aGUgc2FtZSBhcyB0aGUgY3VycmVudCB2YWx1ZSB3aXRoIGEgc3BhY2UNCiAgICAgIHZhciBoYXlzdGFjayA9IHRoaXMuX3N0b3JlLnNlYXJjaGFibGVDaG9pY2VzOw0KICAgICAgdmFyIG5lZWRsZSA9IG5ld1ZhbHVlOw0KICAgICAgdmFyIGtleXMgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMuY29uZmlnLnNlYXJjaEZpZWxkcykpOw0KICAgICAgdmFyIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHRoaXMuY29uZmlnLmZ1c2VPcHRpb25zLCB7IGtleXM6IGtleXMgfSk7DQogICAgICB2YXIgZnVzZSA9IG5ldyBfZnVzZTIuZGVmYXVsdChoYXlzdGFjaywgb3B0aW9ucyk7DQogICAgICB2YXIgcmVzdWx0cyA9IGZ1c2Uuc2VhcmNoKG5lZWRsZSk7DQoNCiAgICAgIHRoaXMuX2N1cnJlbnRWYWx1ZSA9IG5ld1ZhbHVlOw0KICAgICAgdGhpcy5faGlnaGxpZ2h0UG9zaXRpb24gPSAwOw0KICAgICAgdGhpcy5faXNTZWFyY2hpbmcgPSB0cnVlOw0KICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9jaG9pY2VzLmZpbHRlckNob2ljZXMpKHJlc3VsdHMpKTsNCg0KICAgICAgcmV0dXJuIHJlc3VsdHMubGVuZ3RoOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19hZGRFdmVudExpc3RlbmVycycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9hZGRFdmVudExpc3RlbmVycygpIHsNCiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5fb25LZXlVcCk7DQogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5fb25LZXlEb3duKTsNCiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fb25DbGljayk7DQogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLl9vblRvdWNoTW92ZSk7DQogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMuX29uVG91Y2hFbmQpOw0KICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5fb25Nb3VzZURvd24pOw0KICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgdGhpcy5fb25Nb3VzZU92ZXIpOw0KDQogICAgICBpZiAodGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX29uRm9jdXMpOw0KICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIHRoaXMuX29uQmx1cik7DQogICAgICB9DQoNCiAgICAgIHRoaXMuaW5wdXQuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX29uRm9jdXMpOw0KICAgICAgdGhpcy5pbnB1dC5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOw0KDQogICAgICBpZiAodGhpcy5pbnB1dC5lbGVtZW50LmZvcm0pIHsNCiAgICAgICAgdGhpcy5pbnB1dC5lbGVtZW50LmZvcm0uYWRkRXZlbnRMaXN0ZW5lcigncmVzZXQnLCB0aGlzLl9vbkZvcm1SZXNldCk7DQogICAgICB9DQoNCiAgICAgIHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcnMoKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfcmVtb3ZlRXZlbnRMaXN0ZW5lcnMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7DQogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMuX29uS2V5VXApOw0KICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX29uS2V5RG93bik7DQogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX29uQ2xpY2spOw0KICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcy5fb25Ub3VjaE1vdmUpOw0KICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLl9vblRvdWNoRW5kKTsNCiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuX29uTW91c2VEb3duKTsNCiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIHRoaXMuX29uTW91c2VPdmVyKTsNCg0KICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9vbkZvY3VzKTsNCiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOw0KICAgICAgfQ0KDQogICAgICB0aGlzLmlucHV0LmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9vbkZvY3VzKTsNCiAgICAgIHRoaXMuaW5wdXQuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5fb25CbHVyKTsNCg0KICAgICAgaWYgKHRoaXMuaW5wdXQuZWxlbWVudC5mb3JtKSB7DQogICAgICAgIHRoaXMuaW5wdXQuZWxlbWVudC5mb3JtLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2V0JywgdGhpcy5fb25Gb3JtUmVzZXQpOw0KICAgICAgfQ0KDQogICAgICB0aGlzLmlucHV0LnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uS2V5RG93bicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbktleURvd24oZXZlbnQpIHsNCiAgICAgIHZhciBfa2V5RG93bkFjdGlvbnM7DQoNCiAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQsDQogICAgICAgICAga2V5Q29kZSA9IGV2ZW50LmtleUNvZGUsDQogICAgICAgICAgY3RybEtleSA9IGV2ZW50LmN0cmxLZXksDQogICAgICAgICAgbWV0YUtleSA9IGV2ZW50Lm1ldGFLZXk7DQoNCg0KICAgICAgaWYgKHRhcmdldCAhPT0gdGhpcy5pbnB1dC5lbGVtZW50ICYmICF0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQuY29udGFpbnModGFyZ2V0KSkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHZhciBhY3RpdmVJdGVtcyA9IHRoaXMuX3N0b3JlLmFjdGl2ZUl0ZW1zOw0KICAgICAgdmFyIGhhc0ZvY3VzZWRJbnB1dCA9IHRoaXMuaW5wdXQuaXNGb2N1c3NlZDsNCiAgICAgIHZhciBoYXNBY3RpdmVEcm9wZG93biA9IHRoaXMuZHJvcGRvd24uaXNBY3RpdmU7DQogICAgICB2YXIgaGFzSXRlbXMgPSB0aGlzLml0ZW1MaXN0Lmhhc0NoaWxkcmVuOw0KICAgICAgdmFyIGtleVN0cmluZyA9IFN0cmluZy5mcm9tQ2hhckNvZGUoa2V5Q29kZSk7DQoNCiAgICAgIHZhciBCQUNLX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkJBQ0tfS0VZLA0KICAgICAgICAgIERFTEVURV9LRVkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5ERUxFVEVfS0VZLA0KICAgICAgICAgIEVOVEVSX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkVOVEVSX0tFWSwNCiAgICAgICAgICBBX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkFfS0VZLA0KICAgICAgICAgIEVTQ19LRVkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5FU0NfS0VZLA0KICAgICAgICAgIFVQX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLlVQX0tFWSwNCiAgICAgICAgICBET1dOX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkRPV05fS0VZLA0KICAgICAgICAgIFBBR0VfVVBfS0VZID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuUEFHRV9VUF9LRVksDQogICAgICAgICAgUEFHRV9ET1dOX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLlBBR0VfRE9XTl9LRVk7DQoNCiAgICAgIHZhciBoYXNDdHJsRG93bktleVByZXNzZWQgPSBjdHJsS2V5IHx8IG1ldGFLZXk7DQoNCiAgICAgIC8vIElmIGEgdXNlciBpcyB0eXBpbmcgYW5kIHRoZSBkcm9wZG93biBpcyBub3QgYWN0aXZlDQogICAgICBpZiAoIXRoaXMuX2lzVGV4dEVsZW1lbnQgJiYgL1thLXpBLVowLTktXyBdLy50ZXN0KGtleVN0cmluZykpIHsNCiAgICAgICAgdGhpcy5zaG93RHJvcGRvd24oKTsNCiAgICAgIH0NCg0KICAgICAgLy8gTWFwIGtleXMgdG8ga2V5IGFjdGlvbnMNCiAgICAgIHZhciBrZXlEb3duQWN0aW9ucyA9IChfa2V5RG93bkFjdGlvbnMgPSB7fSwgX2RlZmluZVByb3BlcnR5KF9rZXlEb3duQWN0aW9ucywgQV9LRVksIHRoaXMuX29uQUtleSksIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIEVOVEVSX0tFWSwgdGhpcy5fb25FbnRlcktleSksIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIEVTQ19LRVksIHRoaXMuX29uRXNjYXBlS2V5KSwgX2RlZmluZVByb3BlcnR5KF9rZXlEb3duQWN0aW9ucywgVVBfS0VZLCB0aGlzLl9vbkRpcmVjdGlvbktleSksIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIFBBR0VfVVBfS0VZLCB0aGlzLl9vbkRpcmVjdGlvbktleSksIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIERPV05fS0VZLCB0aGlzLl9vbkRpcmVjdGlvbktleSksIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIFBBR0VfRE9XTl9LRVksIHRoaXMuX29uRGlyZWN0aW9uS2V5KSwgX2RlZmluZVByb3BlcnR5KF9rZXlEb3duQWN0aW9ucywgREVMRVRFX0tFWSwgdGhpcy5fb25EZWxldGVLZXkpLCBfZGVmaW5lUHJvcGVydHkoX2tleURvd25BY3Rpb25zLCBCQUNLX0tFWSwgdGhpcy5fb25EZWxldGVLZXkpLCBfa2V5RG93bkFjdGlvbnMpOw0KDQogICAgICAvLyBJZiBrZXljb2RlIGhhcyBhIGZ1bmN0aW9uLCBydW4gaXQNCiAgICAgIGlmIChrZXlEb3duQWN0aW9uc1trZXlDb2RlXSkgew0KICAgICAgICBrZXlEb3duQWN0aW9uc1trZXlDb2RlXSh7DQogICAgICAgICAgZXZlbnQ6IGV2ZW50LA0KICAgICAgICAgIHRhcmdldDogdGFyZ2V0LA0KICAgICAgICAgIGtleUNvZGU6IGtleUNvZGUsDQogICAgICAgICAgbWV0YUtleTogbWV0YUtleSwNCiAgICAgICAgICBhY3RpdmVJdGVtczogYWN0aXZlSXRlbXMsDQogICAgICAgICAgaGFzRm9jdXNlZElucHV0OiBoYXNGb2N1c2VkSW5wdXQsDQogICAgICAgICAgaGFzQWN0aXZlRHJvcGRvd246IGhhc0FjdGl2ZURyb3Bkb3duLA0KICAgICAgICAgIGhhc0l0ZW1zOiBoYXNJdGVtcywNCiAgICAgICAgICBoYXNDdHJsRG93bktleVByZXNzZWQ6IGhhc0N0cmxEb3duS2V5UHJlc3NlZA0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25LZXlVcCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbktleVVwKF9yZWYyKSB7DQogICAgICB2YXIgdGFyZ2V0ID0gX3JlZjIudGFyZ2V0LA0KICAgICAgICAgIGtleUNvZGUgPSBfcmVmMi5rZXlDb2RlOw0KDQogICAgICBpZiAodGFyZ2V0ICE9PSB0aGlzLmlucHV0LmVsZW1lbnQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB2YXIgdmFsdWUgPSB0aGlzLmlucHV0LnZhbHVlOw0KICAgICAgdmFyIGFjdGl2ZUl0ZW1zID0gdGhpcy5fc3RvcmUuYWN0aXZlSXRlbXM7DQogICAgICB2YXIgY2FuQWRkSXRlbSA9IHRoaXMuX2NhbkFkZEl0ZW0oYWN0aXZlSXRlbXMsIHZhbHVlKTsNCg0KICAgICAgLy8gV2UgYXJlIHR5cGluZyBpbnRvIGEgdGV4dCBpbnB1dCBhbmQgaGF2ZSBhIHZhbHVlLCB3ZSB3YW50IHRvIHNob3cgYSBkcm9wZG93bg0KICAgICAgLy8gbm90aWNlLiBPdGhlcndpc2UgaGlkZSB0aGUgZHJvcGRvd24NCiAgICAgIGlmICh0aGlzLl9pc1RleHRFbGVtZW50KSB7DQogICAgICAgIGlmICh2YWx1ZSkgew0KICAgICAgICAgIGlmIChjYW5BZGRJdGVtLm5vdGljZSkgew0KICAgICAgICAgICAgdmFyIGRyb3Bkb3duSXRlbSA9IHRoaXMuX2dldFRlbXBsYXRlKCdub3RpY2UnLCBjYW5BZGRJdGVtLm5vdGljZSk7DQogICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmVsZW1lbnQuaW5uZXJIVE1MID0gZHJvcGRvd25JdGVtLm91dGVySFRNTDsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpZiAoY2FuQWRkSXRlbS5yZXNwb25zZSA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgdGhpcy5zaG93RHJvcGRvd24odHJ1ZSk7DQogICAgICAgICAgfSBlbHNlIGlmICghY2FuQWRkSXRlbS5ub3RpY2UpIHsNCiAgICAgICAgICAgIHRoaXMuaGlkZURyb3Bkb3duKHRydWUpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLmhpZGVEcm9wZG93bih0cnVlKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdmFyIGJhY2tLZXkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5CQUNLX0tFWTsNCiAgICAgICAgdmFyIGRlbGV0ZUtleSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkRFTEVURV9LRVk7DQoNCiAgICAgICAgLy8gSWYgdXNlciBoYXMgcmVtb3ZlZCB2YWx1ZS4uLg0KICAgICAgICBpZiAoKGtleUNvZGUgPT09IGJhY2tLZXkgfHwga2V5Q29kZSA9PT0gZGVsZXRlS2V5KSAmJiAhdGFyZ2V0LnZhbHVlKSB7DQogICAgICAgICAgaWYgKCF0aGlzLl9pc1RleHRFbGVtZW50ICYmIHRoaXMuX2lzU2VhcmNoaW5nKSB7DQogICAgICAgICAgICB0aGlzLl9pc1NlYXJjaGluZyA9IGZhbHNlOw0KICAgICAgICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9jaG9pY2VzLmFjdGl2YXRlQ2hvaWNlcykodHJ1ZSkpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jYW5TZWFyY2ggJiYgY2FuQWRkSXRlbS5yZXNwb25zZSkgew0KICAgICAgICAgIHRoaXMuX2hhbmRsZVNlYXJjaCh0aGlzLmlucHV0LnZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICB0aGlzLl9jYW5TZWFyY2ggPSB0aGlzLmNvbmZpZy5zZWFyY2hFbmFibGVkOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbkFLZXknLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25BS2V5KF9yZWYzKSB7DQogICAgICB2YXIgaGFzSXRlbXMgPSBfcmVmMy5oYXNJdGVtcywNCiAgICAgICAgICBoYXNDdHJsRG93bktleVByZXNzZWQgPSBfcmVmMy5oYXNDdHJsRG93bktleVByZXNzZWQ7DQoNCiAgICAgIC8vIElmIENUUkwgKyBBIG9yIENNRCArIEEgaGF2ZSBiZWVuIHByZXNzZWQgYW5kIHRoZXJlIGFyZSBpdGVtcyB0byBzZWxlY3QNCiAgICAgIGlmIChoYXNDdHJsRG93bktleVByZXNzZWQgJiYgaGFzSXRlbXMpIHsNCiAgICAgICAgdGhpcy5fY2FuU2VhcmNoID0gZmFsc2U7DQogICAgICAgIGlmICh0aGlzLmNvbmZpZy5yZW1vdmVJdGVtcyAmJiAhdGhpcy5pbnB1dC52YWx1ZSAmJiB0aGlzLmlucHV0LmVsZW1lbnQgPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHsNCiAgICAgICAgICAvLyBIaWdobGlnaHQgaXRlbXMNCiAgICAgICAgICB0aGlzLmhpZ2hsaWdodEFsbCgpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uRW50ZXJLZXknLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25FbnRlcktleShfcmVmNCkgew0KICAgICAgdmFyIGV2ZW50ID0gX3JlZjQuZXZlbnQsDQogICAgICAgICAgdGFyZ2V0ID0gX3JlZjQudGFyZ2V0LA0KICAgICAgICAgIGFjdGl2ZUl0ZW1zID0gX3JlZjQuYWN0aXZlSXRlbXMsDQogICAgICAgICAgaGFzQWN0aXZlRHJvcGRvd24gPSBfcmVmNC5oYXNBY3RpdmVEcm9wZG93bjsNCiAgICAgIHZhciBlbnRlcktleSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkVOVEVSX0tFWTsNCiAgICAgIC8vIElmIGVudGVyIGtleSBpcyBwcmVzc2VkIGFuZCB0aGUgaW5wdXQgaGFzIGEgdmFsdWUNCg0KICAgICAgaWYgKHRoaXMuX2lzVGV4dEVsZW1lbnQgJiYgdGFyZ2V0LnZhbHVlKSB7DQogICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuaW5wdXQudmFsdWU7DQogICAgICAgIHZhciBjYW5BZGRJdGVtID0gdGhpcy5fY2FuQWRkSXRlbShhY3RpdmVJdGVtcywgdmFsdWUpOw0KDQogICAgICAgIC8vIEFsbCBpcyBnb29kLCBhZGQNCiAgICAgICAgaWYgKGNhbkFkZEl0ZW0ucmVzcG9uc2UpIHsNCiAgICAgICAgICB0aGlzLmhpZGVEcm9wZG93bih0cnVlKTsNCiAgICAgICAgICB0aGlzLl9hZGRJdGVtKHsgdmFsdWU6IHZhbHVlIH0pOw0KICAgICAgICAgIHRoaXMuX3RyaWdnZXJDaGFuZ2UodmFsdWUpOw0KICAgICAgICAgIHRoaXMuY2xlYXJJbnB1dCgpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGlmICh0YXJnZXQuaGFzQXR0cmlidXRlKCdkYXRhLWJ1dHRvbicpKSB7DQogICAgICAgIHRoaXMuX2hhbmRsZUJ1dHRvbkFjdGlvbihhY3RpdmVJdGVtcywgdGFyZ2V0KTsNCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgIH0NCg0KICAgICAgaWYgKGhhc0FjdGl2ZURyb3Bkb3duKSB7DQogICAgICAgIHZhciBoaWdobGlnaHRlZCA9IHRoaXMuZHJvcGRvd24uZ2V0Q2hpbGQoJy4nICsgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5oaWdobGlnaHRlZFN0YXRlKTsNCg0KICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgaGlnaGxpZ2h0ZWQgY2hvaWNlDQogICAgICAgIGlmIChoaWdobGlnaHRlZCkgew0KICAgICAgICAgIC8vIGFkZCBlbnRlciBrZXlDb2RlIHZhbHVlDQogICAgICAgICAgaWYgKGFjdGl2ZUl0ZW1zWzBdKSB7DQogICAgICAgICAgICBhY3RpdmVJdGVtc1swXS5rZXlDb2RlID0gZW50ZXJLZXk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcGFyYW0tcmVhc3NpZ24NCiAgICAgICAgICB9DQogICAgICAgICAgdGhpcy5faGFuZGxlQ2hvaWNlQWN0aW9uKGFjdGl2ZUl0ZW1zLCBoaWdobGlnaHRlZCk7DQogICAgICAgIH0NCg0KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgfSBlbHNlIGlmICh0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgLy8gT3BlbiBzaW5nbGUgc2VsZWN0IGRyb3Bkb3duIGlmIGl0J3Mgbm90IGFjdGl2ZQ0KICAgICAgICB0aGlzLnNob3dEcm9wZG93bigpOw0KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbkVzY2FwZUtleScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkVzY2FwZUtleShfcmVmNSkgew0KICAgICAgdmFyIGhhc0FjdGl2ZURyb3Bkb3duID0gX3JlZjUuaGFzQWN0aXZlRHJvcGRvd247DQoNCiAgICAgIGlmIChoYXNBY3RpdmVEcm9wZG93bikgew0KICAgICAgICB0aGlzLmhpZGVEcm9wZG93bih0cnVlKTsNCiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5mb2N1cygpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbkRpcmVjdGlvbktleScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkRpcmVjdGlvbktleShfcmVmNikgew0KICAgICAgdmFyIGV2ZW50ID0gX3JlZjYuZXZlbnQsDQogICAgICAgICAgaGFzQWN0aXZlRHJvcGRvd24gPSBfcmVmNi5oYXNBY3RpdmVEcm9wZG93biwNCiAgICAgICAgICBrZXlDb2RlID0gX3JlZjYua2V5Q29kZSwNCiAgICAgICAgICBtZXRhS2V5ID0gX3JlZjYubWV0YUtleTsNCiAgICAgIHZhciBkb3duS2V5ID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuRE9XTl9LRVksDQogICAgICAgICAgcGFnZVVwS2V5ID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuUEFHRV9VUF9LRVksDQogICAgICAgICAgcGFnZURvd25LZXkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5QQUdFX0RPV05fS0VZOw0KDQogICAgICAvLyBJZiB1cCBvciBkb3duIGtleSBpcyBwcmVzc2VkLCB0cmF2ZXJzZSB0aHJvdWdoIG9wdGlvbnMNCg0KICAgICAgaWYgKGhhc0FjdGl2ZURyb3Bkb3duIHx8IHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICB0aGlzLnNob3dEcm9wZG93bigpOw0KICAgICAgICB0aGlzLl9jYW5TZWFyY2ggPSBmYWxzZTsNCg0KICAgICAgICB2YXIgZGlyZWN0aW9uSW50ID0ga2V5Q29kZSA9PT0gZG93bktleSB8fCBrZXlDb2RlID09PSBwYWdlRG93bktleSA/IDEgOiAtMTsNCiAgICAgICAgdmFyIHNraXBLZXkgPSBtZXRhS2V5IHx8IGtleUNvZGUgPT09IHBhZ2VEb3duS2V5IHx8IGtleUNvZGUgPT09IHBhZ2VVcEtleTsNCiAgICAgICAgdmFyIHNlbGVjdGFibGVDaG9pY2VJZGVudGlmaWVyID0gJ1tkYXRhLWNob2ljZS1zZWxlY3RhYmxlXSc7DQoNCiAgICAgICAgdmFyIG5leHRFbCA9IHZvaWQgMDsNCiAgICAgICAgaWYgKHNraXBLZXkpIHsNCiAgICAgICAgICBpZiAoZGlyZWN0aW9uSW50ID4gMCkgew0KICAgICAgICAgICAgbmV4dEVsID0gQXJyYXkuZnJvbSh0aGlzLmRyb3Bkb3duLmVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RhYmxlQ2hvaWNlSWRlbnRpZmllcikpLnBvcCgpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBuZXh0RWwgPSB0aGlzLmRyb3Bkb3duLmVsZW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RhYmxlQ2hvaWNlSWRlbnRpZmllcik7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHZhciBjdXJyZW50RWwgPSB0aGlzLmRyb3Bkb3duLmVsZW1lbnQucXVlcnlTZWxlY3RvcignLicgKyB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmhpZ2hsaWdodGVkU3RhdGUpOw0KICAgICAgICAgIGlmIChjdXJyZW50RWwpIHsNCiAgICAgICAgICAgIG5leHRFbCA9ICgwLCBfdXRpbHMuZ2V0QWRqYWNlbnRFbCkoY3VycmVudEVsLCBzZWxlY3RhYmxlQ2hvaWNlSWRlbnRpZmllciwgZGlyZWN0aW9uSW50KTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbmV4dEVsID0gdGhpcy5kcm9wZG93bi5lbGVtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0YWJsZUNob2ljZUlkZW50aWZpZXIpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChuZXh0RWwpIHsNCiAgICAgICAgICAvLyBXZSBwcmV2ZW50IGRlZmF1bHQgdG8gc3RvcCB0aGUgY3Vyc29yIG1vdmluZw0KICAgICAgICAgIC8vIHdoZW4gcHJlc3NpbmcgdGhlIGFycm93DQogICAgICAgICAgaWYgKCEoMCwgX3V0aWxzLmlzU2Nyb2xsZWRJbnRvVmlldykobmV4dEVsLCB0aGlzLmNob2ljZUxpc3QuZWxlbWVudCwgZGlyZWN0aW9uSW50KSkgew0KICAgICAgICAgICAgdGhpcy5jaG9pY2VMaXN0LnNjcm9sbFRvQ2hvaWNlKG5leHRFbCwgZGlyZWN0aW9uSW50KTsNCiAgICAgICAgICB9DQogICAgICAgICAgdGhpcy5faGlnaGxpZ2h0Q2hvaWNlKG5leHRFbCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBQcmV2ZW50IGRlZmF1bHQgdG8gbWFpbnRhaW4gY3Vyc29yIHBvc2l0aW9uIHdoaWxzdA0KICAgICAgICAvLyB0cmF2ZXJzaW5nIGRyb3Bkb3duIG9wdGlvbnMNCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25EZWxldGVLZXknLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25EZWxldGVLZXkoX3JlZjcpIHsNCiAgICAgIHZhciBldmVudCA9IF9yZWY3LmV2ZW50LA0KICAgICAgICAgIHRhcmdldCA9IF9yZWY3LnRhcmdldCwNCiAgICAgICAgICBoYXNGb2N1c2VkSW5wdXQgPSBfcmVmNy5oYXNGb2N1c2VkSW5wdXQsDQogICAgICAgICAgYWN0aXZlSXRlbXMgPSBfcmVmNy5hY3RpdmVJdGVtczsNCg0KICAgICAgLy8gSWYgYmFja3NwYWNlIG9yIGRlbGV0ZSBrZXkgaXMgcHJlc3NlZCBhbmQgdGhlIGlucHV0IGhhcyBubyB2YWx1ZQ0KICAgICAgaWYgKGhhc0ZvY3VzZWRJbnB1dCAmJiAhdGFyZ2V0LnZhbHVlICYmICF0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgdGhpcy5faGFuZGxlQmFja3NwYWNlKGFjdGl2ZUl0ZW1zKTsNCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25Ub3VjaE1vdmUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Ub3VjaE1vdmUoKSB7DQogICAgICBpZiAodGhpcy5fd2FzVGFwID09PSB0cnVlKSB7DQogICAgICAgIHRoaXMuX3dhc1RhcCA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vblRvdWNoRW5kJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uVG91Y2hFbmQoZXZlbnQpIHsNCiAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQgfHwgZXZlbnQudG91Y2hlc1swXS50YXJnZXQ7DQoNCiAgICAgIC8vIElmIGEgdXNlciB0YXBwZWQgd2l0aGluIG91ciBjb250YWluZXIuLi4NCiAgICAgIGlmICh0aGlzLl93YXNUYXAgPT09IHRydWUgJiYgdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmNvbnRhaW5zKHRhcmdldCkpIHsNCiAgICAgICAgLy8gLi4uYW5kIHdlIGFyZW4ndCBkZWFsaW5nIHdpdGggYSBzaW5nbGUgc2VsZWN0IGJveCwgc2hvdyBkcm9wZG93bi9mb2N1cyBpbnB1dA0KDQogICAgICAgIHZhciBjb250YWluZXJXYXNUYXJnZXQgPSB0YXJnZXQgPT09IHRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudCB8fCB0YXJnZXQgPT09IHRoaXMuY29udGFpbmVySW5uZXIuZWxlbWVudDsNCg0KICAgICAgICBpZiAoY29udGFpbmVyV2FzVGFyZ2V0ICYmICF0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgICBpZiAodGhpcy5faXNUZXh0RWxlbWVudCkgew0KICAgICAgICAgICAgLy8gSWYgdGV4dCBlbGVtZW50LCB3ZSBvbmx5IHdhbnQgdG8gZm9jdXMgdGhlIGlucHV0DQogICAgICAgICAgICB0aGlzLmlucHV0LmZvY3VzKCk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIElmIGEgc2VsZWN0IGJveCwgd2Ugd2FudCB0byBzaG93IHRoZSBkcm9wZG93bg0KICAgICAgICAgICAgdGhpcy5zaG93RHJvcGRvd24oKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy8gUHJldmVudHMgZm9jdXMgZXZlbnQgZmlyaW5nDQogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgfQ0KDQogICAgICB0aGlzLl93YXNUYXAgPSB0cnVlOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbk1vdXNlRG93bicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbk1vdXNlRG93bihldmVudCkgew0KICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldCwNCiAgICAgICAgICBzaGlmdEtleSA9IGV2ZW50LnNoaWZ0S2V5Ow0KICAgICAgLy8gSWYgd2UgaGF2ZSBvdXIgbW91c2UgZG93biBvbiB0aGUgc2Nyb2xsYmFyIGFuZCBhcmUgb24gSUUxMS4uLg0KDQogICAgICBpZiAodGFyZ2V0ID09PSB0aGlzLmNob2ljZUxpc3QgJiYgKDAsIF91dGlscy5pc0lFMTEpKCkpIHsNCiAgICAgICAgdGhpcy5faXNTY3JvbGxpbmdPbkllID0gdHJ1ZTsNCiAgICAgIH0NCg0KICAgICAgaWYgKCF0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQuY29udGFpbnModGFyZ2V0KSB8fCB0YXJnZXQgPT09IHRoaXMuaW5wdXQuZWxlbWVudCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHZhciBhY3RpdmVJdGVtcyA9IHRoaXMuX3N0b3JlLmFjdGl2ZUl0ZW1zOw0KICAgICAgdmFyIGhhc1NoaWZ0S2V5ID0gc2hpZnRLZXk7DQoNCiAgICAgIHZhciBidXR0b25UYXJnZXQgPSAoMCwgX3V0aWxzLmZpbmRBbmNlc3RvckJ5QXR0ck5hbWUpKHRhcmdldCwgJ2RhdGEtYnV0dG9uJyk7DQogICAgICB2YXIgaXRlbVRhcmdldCA9ICgwLCBfdXRpbHMuZmluZEFuY2VzdG9yQnlBdHRyTmFtZSkodGFyZ2V0LCAnZGF0YS1pdGVtJyk7DQogICAgICB2YXIgY2hvaWNlVGFyZ2V0ID0gKDAsIF91dGlscy5maW5kQW5jZXN0b3JCeUF0dHJOYW1lKSh0YXJnZXQsICdkYXRhLWNob2ljZScpOw0KDQogICAgICBpZiAoYnV0dG9uVGFyZ2V0KSB7DQogICAgICAgIHRoaXMuX2hhbmRsZUJ1dHRvbkFjdGlvbihhY3RpdmVJdGVtcywgYnV0dG9uVGFyZ2V0KTsNCiAgICAgIH0gZWxzZSBpZiAoaXRlbVRhcmdldCkgew0KICAgICAgICB0aGlzLl9oYW5kbGVJdGVtQWN0aW9uKGFjdGl2ZUl0ZW1zLCBpdGVtVGFyZ2V0LCBoYXNTaGlmdEtleSk7DQogICAgICB9IGVsc2UgaWYgKGNob2ljZVRhcmdldCkgew0KICAgICAgICB0aGlzLl9oYW5kbGVDaG9pY2VBY3Rpb24oYWN0aXZlSXRlbXMsIGNob2ljZVRhcmdldCk7DQogICAgICB9DQoNCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uTW91c2VPdmVyJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uTW91c2VPdmVyKF9yZWY4KSB7DQogICAgICB2YXIgdGFyZ2V0ID0gX3JlZjgudGFyZ2V0Ow0KDQogICAgICB2YXIgdGFyZ2V0V2l0aGluRHJvcGRvd24gPSB0YXJnZXQgPT09IHRoaXMuZHJvcGRvd24gfHwgdGhpcy5kcm9wZG93bi5lbGVtZW50LmNvbnRhaW5zKHRhcmdldCk7DQogICAgICB2YXIgc2hvdWxkSGlnaGxpZ2h0Q2hvaWNlID0gdGFyZ2V0V2l0aGluRHJvcGRvd24gJiYgdGFyZ2V0Lmhhc0F0dHJpYnV0ZSgnZGF0YS1jaG9pY2UnKTsNCg0KICAgICAgaWYgKHNob3VsZEhpZ2hsaWdodENob2ljZSkgew0KICAgICAgICB0aGlzLl9oaWdobGlnaHRDaG9pY2UodGFyZ2V0KTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25DbGljaycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkNsaWNrKF9yZWY5KSB7DQogICAgICB2YXIgdGFyZ2V0ID0gX3JlZjkudGFyZ2V0Ow0KDQogICAgICBpZiAodGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmNvbnRhaW5zKHRhcmdldCkpIHsNCiAgICAgICAgaWYgKCF0aGlzLmRyb3Bkb3duLmlzQWN0aXZlICYmICF0aGlzLmNvbnRhaW5lck91dGVyLmlzRGlzYWJsZWQpIHsNCiAgICAgICAgICBpZiAodGhpcy5faXNUZXh0RWxlbWVudCkgew0KICAgICAgICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT09IHRoaXMuaW5wdXQuZWxlbWVudCkgew0KICAgICAgICAgICAgICB0aGlzLmlucHV0LmZvY3VzKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMuc2hvd0Ryb3Bkb3duKCk7DQogICAgICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLmZvY3VzKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCAmJiB0YXJnZXQgIT09IHRoaXMuaW5wdXQuZWxlbWVudCAmJiAhdGhpcy5kcm9wZG93bi5lbGVtZW50LmNvbnRhaW5zKHRhcmdldCkpIHsNCiAgICAgICAgICB0aGlzLmhpZGVEcm9wZG93bigpOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICB2YXIgaGFzSGlnaGxpZ2h0ZWRJdGVtcyA9IHRoaXMuX3N0b3JlLmhpZ2hsaWdodGVkQWN0aXZlSXRlbXM7DQoNCiAgICAgICAgaWYgKGhhc0hpZ2hsaWdodGVkSXRlbXMpIHsNCiAgICAgICAgICB0aGlzLnVuaGlnaGxpZ2h0QWxsKCk7DQogICAgICAgIH0NCg0KICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLnJlbW92ZUZvY3VzU3RhdGUoKTsNCiAgICAgICAgdGhpcy5oaWRlRHJvcGRvd24odHJ1ZSk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uRm9jdXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Gb2N1cyhfcmVmMTApIHsNCiAgICAgIHZhciBfdGhpczE4ID0gdGhpczsNCg0KICAgICAgdmFyIHRhcmdldCA9IF9yZWYxMC50YXJnZXQ7DQoNCiAgICAgIGlmICghdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmNvbnRhaW5zKHRhcmdldCkpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB2YXIgZm9jdXNBY3Rpb25zID0gew0KICAgICAgICB0ZXh0OiBmdW5jdGlvbiB0ZXh0KCkgew0KICAgICAgICAgIGlmICh0YXJnZXQgPT09IF90aGlzMTguaW5wdXQuZWxlbWVudCkgew0KICAgICAgICAgICAgX3RoaXMxOC5jb250YWluZXJPdXRlci5hZGRGb2N1c1N0YXRlKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICAnc2VsZWN0LW9uZSc6IGZ1bmN0aW9uIHNlbGVjdE9uZSgpIHsNCiAgICAgICAgICBfdGhpczE4LmNvbnRhaW5lck91dGVyLmFkZEZvY3VzU3RhdGUoKTsNCiAgICAgICAgICBpZiAodGFyZ2V0ID09PSBfdGhpczE4LmlucHV0LmVsZW1lbnQpIHsNCiAgICAgICAgICAgIF90aGlzMTguc2hvd0Ryb3Bkb3duKHRydWUpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgJ3NlbGVjdC1tdWx0aXBsZSc6IGZ1bmN0aW9uIHNlbGVjdE11bHRpcGxlKCkgew0KICAgICAgICAgIGlmICh0YXJnZXQgPT09IF90aGlzMTguaW5wdXQuZWxlbWVudCkgew0KICAgICAgICAgICAgX3RoaXMxOC5zaG93RHJvcGRvd24odHJ1ZSk7DQogICAgICAgICAgICAvLyBJZiBlbGVtZW50IGlzIGEgc2VsZWN0IGJveCwgdGhlIGZvY3VzZWQgZWxlbWVudCBpcyB0aGUgY29udGFpbmVyIGFuZCB0aGUgZHJvcGRvd24NCiAgICAgICAgICAgIC8vIGlzbid0IGFscmVhZHkgb3BlbiwgZm9jdXMgYW5kIHNob3cgZHJvcGRvd24NCiAgICAgICAgICAgIF90aGlzMTguY29udGFpbmVyT3V0ZXIuYWRkRm9jdXNTdGF0ZSgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfTsNCg0KICAgICAgZm9jdXNBY3Rpb25zW3RoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LnR5cGVdKCk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uQmx1cicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkJsdXIoX3JlZjExKSB7DQogICAgICB2YXIgX3RoaXMxOSA9IHRoaXM7DQoNCiAgICAgIHZhciB0YXJnZXQgPSBfcmVmMTEudGFyZ2V0Ow0KDQogICAgICAvLyBJZiB0YXJnZXQgaXMgc29tZXRoaW5nIHRoYXQgY29uY2VybnMgdXMNCiAgICAgIGlmICh0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQuY29udGFpbnModGFyZ2V0KSAmJiAhdGhpcy5faXNTY3JvbGxpbmdPbkllKSB7DQogICAgICAgIHZhciBhY3RpdmVJdGVtcyA9IHRoaXMuX3N0b3JlLmFjdGl2ZUl0ZW1zOw0KICAgICAgICB2YXIgaGFzSGlnaGxpZ2h0ZWRJdGVtcyA9IGFjdGl2ZUl0ZW1zLnNvbWUoZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgICByZXR1cm4gaXRlbS5oaWdobGlnaHRlZDsNCiAgICAgICAgfSk7DQogICAgICAgIHZhciBibHVyQWN0aW9ucyA9IHsNCiAgICAgICAgICB0ZXh0OiBmdW5jdGlvbiB0ZXh0KCkgew0KICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gX3RoaXMxOS5pbnB1dC5lbGVtZW50KSB7DQogICAgICAgICAgICAgIF90aGlzMTkuY29udGFpbmVyT3V0ZXIucmVtb3ZlRm9jdXNTdGF0ZSgpOw0KICAgICAgICAgICAgICBpZiAoaGFzSGlnaGxpZ2h0ZWRJdGVtcykgew0KICAgICAgICAgICAgICAgIF90aGlzMTkudW5oaWdobGlnaHRBbGwoKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBfdGhpczE5LmhpZGVEcm9wZG93bih0cnVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9LA0KICAgICAgICAgICdzZWxlY3Qtb25lJzogZnVuY3Rpb24gc2VsZWN0T25lKCkgew0KICAgICAgICAgICAgX3RoaXMxOS5jb250YWluZXJPdXRlci5yZW1vdmVGb2N1c1N0YXRlKCk7DQogICAgICAgICAgICBpZiAodGFyZ2V0ID09PSBfdGhpczE5LmlucHV0LmVsZW1lbnQgfHwgdGFyZ2V0ID09PSBfdGhpczE5LmNvbnRhaW5lck91dGVyLmVsZW1lbnQgJiYgIV90aGlzMTkuX2NhblNlYXJjaCkgew0KICAgICAgICAgICAgICBfdGhpczE5LmhpZGVEcm9wZG93bih0cnVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9LA0KICAgICAgICAgICdzZWxlY3QtbXVsdGlwbGUnOiBmdW5jdGlvbiBzZWxlY3RNdWx0aXBsZSgpIHsNCiAgICAgICAgICAgIGlmICh0YXJnZXQgPT09IF90aGlzMTkuaW5wdXQuZWxlbWVudCkgew0KICAgICAgICAgICAgICBfdGhpczE5LmNvbnRhaW5lck91dGVyLnJlbW92ZUZvY3VzU3RhdGUoKTsNCiAgICAgICAgICAgICAgX3RoaXMxOS5oaWRlRHJvcGRvd24odHJ1ZSk7DQogICAgICAgICAgICAgIGlmIChoYXNIaWdobGlnaHRlZEl0ZW1zKSB7DQogICAgICAgICAgICAgICAgX3RoaXMxOS51bmhpZ2hsaWdodEFsbCgpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIGJsdXJBY3Rpb25zW3RoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LnR5cGVdKCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICAvLyBPbiBJRTExLCBjbGlja2luZyB0aGUgc2NvbGxiYXIgYmx1cnMgb3VyIGlucHV0IGFuZCB0aHVzDQogICAgICAgIC8vIGNsb3NlcyB0aGUgZHJvcGRvd24uIFRvIHN0b3AgdGhpcywgd2UgcmVmb2N1cyBvdXIgaW5wdXQNCiAgICAgICAgLy8gaWYgd2Uga25vdyB3ZSBhcmUgb24gSUUgKmFuZCogYXJlIHNjcm9sbGluZy4NCiAgICAgICAgdGhpcy5faXNTY3JvbGxpbmdPbkllID0gZmFsc2U7DQogICAgICAgIHRoaXMuaW5wdXQuZWxlbWVudC5mb2N1cygpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbkZvcm1SZXNldCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkZvcm1SZXNldCgpIHsNCiAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfbWlzYy5yZXNldFRvKSh0aGlzLl9pbml0aWFsU3RhdGUpKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfaGlnaGxpZ2h0Q2hvaWNlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hpZ2hsaWdodENob2ljZSgpIHsNCiAgICAgIHZhciBfdGhpczIwID0gdGhpczsNCg0KICAgICAgdmFyIGVsID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBudWxsOw0KDQogICAgICB2YXIgY2hvaWNlcyA9IEFycmF5LmZyb20odGhpcy5kcm9wZG93bi5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLWNob2ljZS1zZWxlY3RhYmxlXScpKTsNCg0KICAgICAgaWYgKCFjaG9pY2VzLmxlbmd0aCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHZhciBwYXNzZWRFbCA9IGVsOw0KICAgICAgdmFyIGhpZ2hsaWdodGVkQ2hvaWNlcyA9IEFycmF5LmZyb20odGhpcy5kcm9wZG93bi5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5oaWdobGlnaHRlZFN0YXRlKSk7DQoNCiAgICAgIC8vIFJlbW92ZSBhbnkgaGlnaGxpZ2h0ZWQgY2hvaWNlcw0KICAgICAgaGlnaGxpZ2h0ZWRDaG9pY2VzLmZvckVhY2goZnVuY3Rpb24gKGNob2ljZSkgew0KICAgICAgICBjaG9pY2UuY2xhc3NMaXN0LnJlbW92ZShfdGhpczIwLmNvbmZpZy5jbGFzc05hbWVzLmhpZ2hsaWdodGVkU3RhdGUpOw0KICAgICAgICBjaG9pY2Uuc2V0QXR0cmlidXRlKCdhcmlhLXNlbGVjdGVkJywgJ2ZhbHNlJyk7DQogICAgICB9KTsNCg0KICAgICAgaWYgKHBhc3NlZEVsKSB7DQogICAgICAgIHRoaXMuX2hpZ2hsaWdodFBvc2l0aW9uID0gY2hvaWNlcy5pbmRleE9mKHBhc3NlZEVsKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIEhpZ2hsaWdodCBjaG9pY2UgYmFzZWQgb24gbGFzdCBrbm93biBoaWdobGlnaHQgbG9jYXRpb24NCiAgICAgICAgaWYgKGNob2ljZXMubGVuZ3RoID4gdGhpcy5faGlnaGxpZ2h0UG9zaXRpb24pIHsNCiAgICAgICAgICAvLyBJZiB3ZSBoYXZlIGFuIG9wdGlvbiB0byBoaWdobGlnaHQNCiAgICAgICAgICBwYXNzZWRFbCA9IGNob2ljZXNbdGhpcy5faGlnaGxpZ2h0UG9zaXRpb25dOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIC8vIE90aGVyd2lzZSBoaWdobGlnaHQgdGhlIG9wdGlvbiBiZWZvcmUNCiAgICAgICAgICBwYXNzZWRFbCA9IGNob2ljZXNbY2hvaWNlcy5sZW5ndGggLSAxXTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICghcGFzc2VkRWwpIHsNCiAgICAgICAgICBwYXNzZWRFbCA9IGNob2ljZXNbMF07DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcGFzc2VkRWwuY2xhc3NMaXN0LmFkZCh0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmhpZ2hsaWdodGVkU3RhdGUpOw0KICAgICAgcGFzc2VkRWwuc2V0QXR0cmlidXRlKCdhcmlhLXNlbGVjdGVkJywgJ3RydWUnKTsNCiAgICAgIHRoaXMucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMuaGlnaGxpZ2h0Q2hvaWNlLCB7IGVsOiBwYXNzZWRFbCB9KTsNCg0KICAgICAgaWYgKHRoaXMuZHJvcGRvd24uaXNBY3RpdmUpIHsNCiAgICAgICAgLy8gSUUxMSBpZ25vcmVzIGFyaWEtbGFiZWwgYW5kIGJsb2NrcyB2aXJ0dWFsIGtleWJvYXJkDQogICAgICAgIC8vIGlmIGFyaWEtYWN0aXZlZGVzY2VuZGFudCBpcyBzZXQgd2l0aG91dCBhIGRyb3Bkb3duDQogICAgICAgIHRoaXMuaW5wdXQuc2V0QWN0aXZlRGVzY2VuZGFudChwYXNzZWRFbC5pZCk7DQogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuc2V0QWN0aXZlRGVzY2VuZGFudChwYXNzZWRFbC5pZCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2FkZEl0ZW0nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfYWRkSXRlbShfcmVmMTIpIHsNCiAgICAgIHZhciB2YWx1ZSA9IF9yZWYxMi52YWx1ZSwNCiAgICAgICAgICBfcmVmMTIkbGFiZWwgPSBfcmVmMTIubGFiZWwsDQogICAgICAgICAgbGFiZWwgPSBfcmVmMTIkbGFiZWwgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBfcmVmMTIkbGFiZWwsDQogICAgICAgICAgX3JlZjEyJGNob2ljZUlkID0gX3JlZjEyLmNob2ljZUlkLA0KICAgICAgICAgIGNob2ljZUlkID0gX3JlZjEyJGNob2ljZUlkID09PSB1bmRlZmluZWQgPyAtMSA6IF9yZWYxMiRjaG9pY2VJZCwNCiAgICAgICAgICBfcmVmMTIkZ3JvdXBJZCA9IF9yZWYxMi5ncm91cElkLA0KICAgICAgICAgIGdyb3VwSWQgPSBfcmVmMTIkZ3JvdXBJZCA9PT0gdW5kZWZpbmVkID8gLTEgOiBfcmVmMTIkZ3JvdXBJZCwNCiAgICAgICAgICBfcmVmMTIkY3VzdG9tUHJvcGVydGkgPSBfcmVmMTIuY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzID0gX3JlZjEyJGN1c3RvbVByb3BlcnRpID09PSB1bmRlZmluZWQgPyBudWxsIDogX3JlZjEyJGN1c3RvbVByb3BlcnRpLA0KICAgICAgICAgIF9yZWYxMiRwbGFjZWhvbGRlciA9IF9yZWYxMi5wbGFjZWhvbGRlciwNCiAgICAgICAgICBwbGFjZWhvbGRlciA9IF9yZWYxMiRwbGFjZWhvbGRlciA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmMTIkcGxhY2Vob2xkZXIsDQogICAgICAgICAgX3JlZjEyJGtleUNvZGUgPSBfcmVmMTIua2V5Q29kZSwNCiAgICAgICAgICBrZXlDb2RlID0gX3JlZjEyJGtleUNvZGUgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBfcmVmMTIka2V5Q29kZTsNCg0KICAgICAgdmFyIHBhc3NlZFZhbHVlID0gKDAsIF91dGlscy5pc1R5cGUpKCdTdHJpbmcnLCB2YWx1ZSkgPyB2YWx1ZS50cmltKCkgOiB2YWx1ZTsNCg0KICAgICAgdmFyIHBhc3NlZEtleUNvZGUgPSBrZXlDb2RlOw0KICAgICAgdmFyIHBhc3NlZEN1c3RvbVByb3BlcnRpZXMgPSBjdXN0b21Qcm9wZXJ0aWVzOw0KICAgICAgdmFyIGl0ZW1zID0gdGhpcy5fc3RvcmUuaXRlbXM7DQogICAgICB2YXIgcGFzc2VkTGFiZWwgPSBsYWJlbCB8fCBwYXNzZWRWYWx1ZTsNCiAgICAgIHZhciBwYXNzZWRPcHRpb25JZCA9IHBhcnNlSW50KGNob2ljZUlkLCAxMCkgfHwgLTE7DQogICAgICB2YXIgZ3JvdXAgPSBncm91cElkID49IDAgPyB0aGlzLl9zdG9yZS5nZXRHcm91cEJ5SWQoZ3JvdXBJZCkgOiBudWxsOw0KICAgICAgdmFyIGlkID0gaXRlbXMgPyBpdGVtcy5sZW5ndGggKyAxIDogMTsNCg0KICAgICAgLy8gSWYgYSBwcmVwZW5kZWQgdmFsdWUgaGFzIGJlZW4gcGFzc2VkLCBwcmVwZW5kIGl0DQogICAgICBpZiAodGhpcy5jb25maWcucHJlcGVuZFZhbHVlKSB7DQogICAgICAgIHBhc3NlZFZhbHVlID0gdGhpcy5jb25maWcucHJlcGVuZFZhbHVlICsgcGFzc2VkVmFsdWUudG9TdHJpbmcoKTsNCiAgICAgIH0NCg0KICAgICAgLy8gSWYgYW4gYXBwZW5kZWQgdmFsdWUgaGFzIGJlZW4gcGFzc2VkLCBhcHBlbmQgaXQNCiAgICAgIGlmICh0aGlzLmNvbmZpZy5hcHBlbmRWYWx1ZSkgew0KICAgICAgICBwYXNzZWRWYWx1ZSArPSB0aGlzLmNvbmZpZy5hcHBlbmRWYWx1ZS50b1N0cmluZygpOw0KICAgICAgfQ0KDQogICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX2l0ZW1zLmFkZEl0ZW0pKHsNCiAgICAgICAgdmFsdWU6IHBhc3NlZFZhbHVlLA0KICAgICAgICBsYWJlbDogcGFzc2VkTGFiZWwsDQogICAgICAgIGlkOiBpZCwNCiAgICAgICAgY2hvaWNlSWQ6IHBhc3NlZE9wdGlvbklkLA0KICAgICAgICBncm91cElkOiBncm91cElkLA0KICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBjdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXIsDQogICAgICAgIGtleUNvZGU6IHBhc3NlZEtleUNvZGUNCiAgICAgIH0pKTsNCg0KICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICB0aGlzLnJlbW92ZUFjdGl2ZUl0ZW1zKGlkKTsNCiAgICAgIH0NCg0KICAgICAgLy8gVHJpZ2dlciBjaGFuZ2UgZXZlbnQNCiAgICAgIGlmIChncm91cCAmJiBncm91cC52YWx1ZSkgew0KICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLmFkZEl0ZW0sIHsNCiAgICAgICAgICBpZDogaWQsDQogICAgICAgICAgdmFsdWU6IHBhc3NlZFZhbHVlLA0KICAgICAgICAgIGxhYmVsOiBwYXNzZWRMYWJlbCwNCiAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBwYXNzZWRDdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgIGdyb3VwVmFsdWU6IGdyb3VwLnZhbHVlLA0KICAgICAgICAgIGtleUNvZGU6IHBhc3NlZEtleUNvZGUNCiAgICAgICAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLmFkZEl0ZW0sIHsNCiAgICAgICAgICBpZDogaWQsDQogICAgICAgICAgdmFsdWU6IHBhc3NlZFZhbHVlLA0KICAgICAgICAgIGxhYmVsOiBwYXNzZWRMYWJlbCwNCiAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBwYXNzZWRDdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgIGtleUNvZGU6IHBhc3NlZEtleUNvZGUNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19yZW1vdmVJdGVtJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbW92ZUl0ZW0oaXRlbSkgew0KICAgICAgaWYgKCFpdGVtIHx8ICEoMCwgX3V0aWxzLmlzVHlwZSkoJ09iamVjdCcsIGl0ZW0pKSB7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICB2YXIgaWQgPSBpdGVtLmlkLA0KICAgICAgICAgIHZhbHVlID0gaXRlbS52YWx1ZSwNCiAgICAgICAgICBsYWJlbCA9IGl0ZW0ubGFiZWwsDQogICAgICAgICAgY2hvaWNlSWQgPSBpdGVtLmNob2ljZUlkLA0KICAgICAgICAgIGdyb3VwSWQgPSBpdGVtLmdyb3VwSWQ7DQoNCiAgICAgIHZhciBncm91cCA9IGdyb3VwSWQgPj0gMCA/IHRoaXMuX3N0b3JlLmdldEdyb3VwQnlJZChncm91cElkKSA6IG51bGw7DQoNCiAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfaXRlbXMucmVtb3ZlSXRlbSkoaWQsIGNob2ljZUlkKSk7DQoNCiAgICAgIGlmIChncm91cCAmJiBncm91cC52YWx1ZSkgew0KICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLnJlbW92ZUl0ZW0sIHsNCiAgICAgICAgICBpZDogaWQsDQogICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgIGxhYmVsOiBsYWJlbCwNCiAgICAgICAgICBncm91cFZhbHVlOiBncm91cC52YWx1ZQ0KICAgICAgICB9KTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMucmVtb3ZlSXRlbSwgew0KICAgICAgICAgIGlkOiBpZCwNCiAgICAgICAgICB2YWx1ZTogdmFsdWUsDQogICAgICAgICAgbGFiZWw6IGxhYmVsDQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfYWRkQ2hvaWNlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZENob2ljZShfcmVmMTMpIHsNCiAgICAgIHZhciB2YWx1ZSA9IF9yZWYxMy52YWx1ZSwNCiAgICAgICAgICBfcmVmMTMkbGFiZWwgPSBfcmVmMTMubGFiZWwsDQogICAgICAgICAgbGFiZWwgPSBfcmVmMTMkbGFiZWwgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBfcmVmMTMkbGFiZWwsDQogICAgICAgICAgX3JlZjEzJGlzU2VsZWN0ZWQgPSBfcmVmMTMuaXNTZWxlY3RlZCwNCiAgICAgICAgICBpc1NlbGVjdGVkID0gX3JlZjEzJGlzU2VsZWN0ZWQgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZjEzJGlzU2VsZWN0ZWQsDQogICAgICAgICAgX3JlZjEzJGlzRGlzYWJsZWQgPSBfcmVmMTMuaXNEaXNhYmxlZCwNCiAgICAgICAgICBpc0Rpc2FibGVkID0gX3JlZjEzJGlzRGlzYWJsZWQgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZjEzJGlzRGlzYWJsZWQsDQogICAgICAgICAgX3JlZjEzJGdyb3VwSWQgPSBfcmVmMTMuZ3JvdXBJZCwNCiAgICAgICAgICBncm91cElkID0gX3JlZjEzJGdyb3VwSWQgPT09IHVuZGVmaW5lZCA/IC0xIDogX3JlZjEzJGdyb3VwSWQsDQogICAgICAgICAgX3JlZjEzJGN1c3RvbVByb3BlcnRpID0gX3JlZjEzLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgY3VzdG9tUHJvcGVydGllcyA9IF9yZWYxMyRjdXN0b21Qcm9wZXJ0aSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IF9yZWYxMyRjdXN0b21Qcm9wZXJ0aSwNCiAgICAgICAgICBfcmVmMTMkcGxhY2Vob2xkZXIgPSBfcmVmMTMucGxhY2Vob2xkZXIsDQogICAgICAgICAgcGxhY2Vob2xkZXIgPSBfcmVmMTMkcGxhY2Vob2xkZXIgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZjEzJHBsYWNlaG9sZGVyLA0KICAgICAgICAgIF9yZWYxMyRrZXlDb2RlID0gX3JlZjEzLmtleUNvZGUsDQogICAgICAgICAga2V5Q29kZSA9IF9yZWYxMyRrZXlDb2RlID09PSB1bmRlZmluZWQgPyBudWxsIDogX3JlZjEzJGtleUNvZGU7DQoNCiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnIHx8IHZhbHVlID09PSBudWxsKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgLy8gR2VuZXJhdGUgdW5pcXVlIGlkDQogICAgICB2YXIgY2hvaWNlcyA9IHRoaXMuX3N0b3JlLmNob2ljZXM7DQogICAgICB2YXIgY2hvaWNlTGFiZWwgPSBsYWJlbCB8fCB2YWx1ZTsNCiAgICAgIHZhciBjaG9pY2VJZCA9IGNob2ljZXMgPyBjaG9pY2VzLmxlbmd0aCArIDEgOiAxOw0KICAgICAgdmFyIGNob2ljZUVsZW1lbnRJZCA9IHRoaXMuX2Jhc2VJZCArICctJyArIHRoaXMuX2lkTmFtZXMuaXRlbUNob2ljZSArICctJyArIGNob2ljZUlkOw0KDQogICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX2Nob2ljZXMuYWRkQ2hvaWNlKSh7DQogICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgbGFiZWw6IGNob2ljZUxhYmVsLA0KICAgICAgICBpZDogY2hvaWNlSWQsDQogICAgICAgIGdyb3VwSWQ6IGdyb3VwSWQsDQogICAgICAgIGRpc2FibGVkOiBpc0Rpc2FibGVkLA0KICAgICAgICBlbGVtZW50SWQ6IGNob2ljZUVsZW1lbnRJZCwNCiAgICAgICAgY3VzdG9tUHJvcGVydGllczogY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyLA0KICAgICAgICBrZXlDb2RlOiBrZXlDb2RlDQogICAgICB9KSk7DQoNCiAgICAgIGlmIChpc1NlbGVjdGVkKSB7DQogICAgICAgIHRoaXMuX2FkZEl0ZW0oew0KICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICBsYWJlbDogY2hvaWNlTGFiZWwsDQogICAgICAgICAgY2hvaWNlSWQ6IGNob2ljZUlkLA0KICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyLA0KICAgICAgICAgIGtleUNvZGU6IGtleUNvZGUNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2NsZWFyQ2hvaWNlcycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9jbGVhckNob2ljZXMoKSB7DQogICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX2Nob2ljZXMuY2xlYXJDaG9pY2VzKSgpKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfYWRkR3JvdXAnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfYWRkR3JvdXAoX3JlZjE0KSB7DQogICAgICB2YXIgX3RoaXMyMSA9IHRoaXM7DQoNCiAgICAgIHZhciBncm91cCA9IF9yZWYxNC5ncm91cCwNCiAgICAgICAgICBpZCA9IF9yZWYxNC5pZCwNCiAgICAgICAgICBfcmVmMTQkdmFsdWVLZXkgPSBfcmVmMTQudmFsdWVLZXksDQogICAgICAgICAgdmFsdWVLZXkgPSBfcmVmMTQkdmFsdWVLZXkgPT09IHVuZGVmaW5lZCA/ICd2YWx1ZScgOiBfcmVmMTQkdmFsdWVLZXksDQogICAgICAgICAgX3JlZjE0JGxhYmVsS2V5ID0gX3JlZjE0LmxhYmVsS2V5LA0KICAgICAgICAgIGxhYmVsS2V5ID0gX3JlZjE0JGxhYmVsS2V5ID09PSB1bmRlZmluZWQgPyAnbGFiZWwnIDogX3JlZjE0JGxhYmVsS2V5Ow0KDQogICAgICB2YXIgZ3JvdXBDaG9pY2VzID0gKDAsIF91dGlscy5pc1R5cGUpKCdPYmplY3QnLCBncm91cCkgPyBncm91cC5jaG9pY2VzIDogQXJyYXkuZnJvbShncm91cC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnT1BUSU9OJykpOw0KICAgICAgdmFyIGdyb3VwSWQgPSBpZCB8fCBNYXRoLmZsb29yKG5ldyBEYXRlKCkudmFsdWVPZigpICogTWF0aC5yYW5kb20oKSk7DQogICAgICB2YXIgaXNEaXNhYmxlZCA9IGdyb3VwLmRpc2FibGVkID8gZ3JvdXAuZGlzYWJsZWQgOiBmYWxzZTsNCg0KICAgICAgaWYgKGdyb3VwQ2hvaWNlcykgew0KICAgICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX2dyb3Vwcy5hZGRHcm91cCkoZ3JvdXAubGFiZWwsIGdyb3VwSWQsIHRydWUsIGlzRGlzYWJsZWQpKTsNCg0KICAgICAgICB2YXIgYWRkR3JvdXBDaG9pY2VzID0gZnVuY3Rpb24gYWRkR3JvdXBDaG9pY2VzKGNob2ljZSkgew0KICAgICAgICAgIHZhciBpc09wdERpc2FibGVkID0gY2hvaWNlLmRpc2FibGVkIHx8IGNob2ljZS5wYXJlbnROb2RlICYmIGNob2ljZS5wYXJlbnROb2RlLmRpc2FibGVkOw0KDQogICAgICAgICAgX3RoaXMyMS5fYWRkQ2hvaWNlKHsNCiAgICAgICAgICAgIHZhbHVlOiBjaG9pY2VbdmFsdWVLZXldLA0KICAgICAgICAgICAgbGFiZWw6ICgwLCBfdXRpbHMuaXNUeXBlKSgnT2JqZWN0JywgY2hvaWNlKSA/IGNob2ljZVtsYWJlbEtleV0gOiBjaG9pY2UuaW5uZXJIVE1MLA0KICAgICAgICAgICAgaXNTZWxlY3RlZDogY2hvaWNlLnNlbGVjdGVkLA0KICAgICAgICAgICAgaXNEaXNhYmxlZDogaXNPcHREaXNhYmxlZCwNCiAgICAgICAgICAgIGdyb3VwSWQ6IGdyb3VwSWQsDQogICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBjaG9pY2UuY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBjaG9pY2UucGxhY2Vob2xkZXINCiAgICAgICAgICB9KTsNCiAgICAgICAgfTsNCg0KICAgICAgICBncm91cENob2ljZXMuZm9yRWFjaChhZGRHcm91cENob2ljZXMpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9ncm91cHMuYWRkR3JvdXApKGdyb3VwLmxhYmVsLCBncm91cC5pZCwgZmFsc2UsIGdyb3VwLmRpc2FibGVkKSk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2dldFRlbXBsYXRlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldFRlbXBsYXRlKHRlbXBsYXRlKSB7DQogICAgICB2YXIgX3RlbXBsYXRlcyR0ZW1wbGF0ZTsNCg0KICAgICAgaWYgKCF0ZW1wbGF0ZSkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgIH0NCg0KICAgICAgdmFyIF9jb25maWc0ID0gdGhpcy5jb25maWcsDQogICAgICAgICAgdGVtcGxhdGVzID0gX2NvbmZpZzQudGVtcGxhdGVzLA0KICAgICAgICAgIGNsYXNzTmFtZXMgPSBfY29uZmlnNC5jbGFzc05hbWVzOw0KDQogICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsNCiAgICAgICAgYXJnc1tfa2V5IC0gMV0gPSBhcmd1bWVudHNbX2tleV07DQogICAgICB9DQoNCiAgICAgIHJldHVybiAoX3RlbXBsYXRlcyR0ZW1wbGF0ZSA9IHRlbXBsYXRlc1t0ZW1wbGF0ZV0pLmNhbGwuYXBwbHkoX3RlbXBsYXRlcyR0ZW1wbGF0ZSwgW3RoaXMsIGNsYXNzTmFtZXNdLmNvbmNhdChhcmdzKSk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2NyZWF0ZVRlbXBsYXRlcycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVUZW1wbGF0ZXMoKSB7DQogICAgICB2YXIgY2FsbGJhY2tPbkNyZWF0ZVRlbXBsYXRlcyA9IHRoaXMuY29uZmlnLmNhbGxiYWNrT25DcmVhdGVUZW1wbGF0ZXM7DQoNCiAgICAgIHZhciB1c2VyVGVtcGxhdGVzID0ge307DQoNCiAgICAgIGlmIChjYWxsYmFja09uQ3JlYXRlVGVtcGxhdGVzICYmICgwLCBfdXRpbHMuaXNUeXBlKSgnRnVuY3Rpb24nLCBjYWxsYmFja09uQ3JlYXRlVGVtcGxhdGVzKSkgew0KICAgICAgICB1c2VyVGVtcGxhdGVzID0gY2FsbGJhY2tPbkNyZWF0ZVRlbXBsYXRlcy5jYWxsKHRoaXMsIF91dGlscy5zdHJUb0VsKTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5jb25maWcudGVtcGxhdGVzID0gKDAsIF91dGlscy5leHRlbmQpKF90ZW1wbGF0ZXMuVEVNUExBVEVTLCB1c2VyVGVtcGxhdGVzKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfY3JlYXRlRWxlbWVudHMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlRWxlbWVudHMoKSB7DQogICAgICB0aGlzLmNvbnRhaW5lck91dGVyID0gbmV3IF9jb21wb25lbnRzLkNvbnRhaW5lcih7DQogICAgICAgIGVsZW1lbnQ6IHRoaXMuX2dldFRlbXBsYXRlKCdjb250YWluZXJPdXRlcicsIHRoaXMuX2RpcmVjdGlvbiwgdGhpcy5faXNTZWxlY3RFbGVtZW50LCB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQsIHRoaXMuY29uZmlnLnNlYXJjaEVuYWJsZWQsIHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LnR5cGUpLA0KICAgICAgICBjbGFzc05hbWVzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLA0KICAgICAgICB0eXBlOiB0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC50eXBlLA0KICAgICAgICBwb3NpdGlvbjogdGhpcy5jb25maWcucG9zaXRpb24NCiAgICAgIH0pOw0KDQogICAgICB0aGlzLmNvbnRhaW5lcklubmVyID0gbmV3IF9jb21wb25lbnRzLkNvbnRhaW5lcih7DQogICAgICAgIGVsZW1lbnQ6IHRoaXMuX2dldFRlbXBsYXRlKCdjb250YWluZXJJbm5lcicpLA0KICAgICAgICBjbGFzc05hbWVzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLA0KICAgICAgICB0eXBlOiB0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC50eXBlLA0KICAgICAgICBwb3NpdGlvbjogdGhpcy5jb25maWcucG9zaXRpb24NCiAgICAgIH0pOw0KDQogICAgICB0aGlzLmlucHV0ID0gbmV3IF9jb21wb25lbnRzLklucHV0KHsNCiAgICAgICAgZWxlbWVudDogdGhpcy5fZ2V0VGVtcGxhdGUoJ2lucHV0JyksDQogICAgICAgIGNsYXNzTmFtZXM6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMsDQogICAgICAgIHR5cGU6IHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LnR5cGUNCiAgICAgIH0pOw0KDQogICAgICB0aGlzLmNob2ljZUxpc3QgPSBuZXcgX2NvbXBvbmVudHMuTGlzdCh7DQogICAgICAgIGVsZW1lbnQ6IHRoaXMuX2dldFRlbXBsYXRlKCdjaG9pY2VMaXN0JywgdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KQ0KICAgICAgfSk7DQoNCiAgICAgIHRoaXMuaXRlbUxpc3QgPSBuZXcgX2NvbXBvbmVudHMuTGlzdCh7DQogICAgICAgIGVsZW1lbnQ6IHRoaXMuX2dldFRlbXBsYXRlKCdpdGVtTGlzdCcsIHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkNCiAgICAgIH0pOw0KDQogICAgICB0aGlzLmRyb3Bkb3duID0gbmV3IF9jb21wb25lbnRzLkRyb3Bkb3duKHsNCiAgICAgICAgZWxlbWVudDogdGhpcy5fZ2V0VGVtcGxhdGUoJ2Ryb3Bkb3duJyksDQogICAgICAgIGNsYXNzTmFtZXM6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMsDQogICAgICAgIHR5cGU6IHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LnR5cGUNCiAgICAgIH0pOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19jcmVhdGVTdHJ1Y3R1cmUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlU3RydWN0dXJlKCkgew0KICAgICAgLy8gSGlkZSBvcmlnaW5hbCBlbGVtZW50DQogICAgICB0aGlzLnBhc3NlZEVsZW1lbnQuY29uY2VhbCgpOw0KICAgICAgLy8gV3JhcCBpbnB1dCBpbiBjb250YWluZXIgcHJlc2VydmluZyBET00gb3JkZXJpbmcNCiAgICAgIHRoaXMuY29udGFpbmVySW5uZXIud3JhcCh0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudCk7DQogICAgICAvLyBXcmFwcGVyIGlubmVyIGNvbnRhaW5lciB3aXRoIG91dGVyIGNvbnRhaW5lcg0KICAgICAgdGhpcy5jb250YWluZXJPdXRlci53cmFwKHRoaXMuY29udGFpbmVySW5uZXIuZWxlbWVudCk7DQoNCiAgICAgIGlmICh0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgdGhpcy5pbnB1dC5wbGFjZWhvbGRlciA9IHRoaXMuY29uZmlnLnNlYXJjaFBsYWNlaG9sZGVyVmFsdWUgfHwgJyc7DQogICAgICB9IGVsc2UgaWYgKHRoaXMuX3BsYWNlaG9sZGVyVmFsdWUpIHsNCiAgICAgICAgdGhpcy5pbnB1dC5wbGFjZWhvbGRlciA9IHRoaXMuX3BsYWNlaG9sZGVyVmFsdWU7DQogICAgICAgIHRoaXMuaW5wdXQuc2V0V2lkdGgodHJ1ZSk7DQogICAgICB9DQoNCiAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmNvbnRhaW5lcklubmVyLmVsZW1lbnQpOw0KICAgICAgdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuZHJvcGRvd24uZWxlbWVudCk7DQogICAgICB0aGlzLmNvbnRhaW5lcklubmVyLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5pdGVtTGlzdC5lbGVtZW50KTsNCg0KICAgICAgaWYgKCF0aGlzLl9pc1RleHRFbGVtZW50KSB7DQogICAgICAgIHRoaXMuZHJvcGRvd24uZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmNob2ljZUxpc3QuZWxlbWVudCk7DQogICAgICB9DQoNCiAgICAgIGlmICghdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIHRoaXMuY29udGFpbmVySW5uZXIuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmlucHV0LmVsZW1lbnQpOw0KICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbmZpZy5zZWFyY2hFbmFibGVkKSB7DQogICAgICAgIHRoaXMuZHJvcGRvd24uZWxlbWVudC5pbnNlcnRCZWZvcmUodGhpcy5pbnB1dC5lbGVtZW50LCB0aGlzLmRyb3Bkb3duLmVsZW1lbnQuZmlyc3RDaGlsZCk7DQogICAgICB9DQoNCiAgICAgIGlmICh0aGlzLl9pc1NlbGVjdEVsZW1lbnQpIHsNCiAgICAgICAgdGhpcy5fYWRkUHJlZGVmaW5lZENob2ljZXMoKTsNCiAgICAgIH0gZWxzZSBpZiAodGhpcy5faXNUZXh0RWxlbWVudCkgew0KICAgICAgICB0aGlzLl9hZGRQcmVkZWZpbmVkSXRlbXMoKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfYWRkUHJlZGVmaW5lZENob2ljZXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfYWRkUHJlZGVmaW5lZENob2ljZXMoKSB7DQogICAgICB2YXIgX3RoaXMyMiA9IHRoaXM7DQoNCiAgICAgIHZhciBwYXNzZWRHcm91cHMgPSB0aGlzLnBhc3NlZEVsZW1lbnQub3B0aW9uR3JvdXBzOw0KDQogICAgICB0aGlzLl9oaWdobGlnaHRQb3NpdGlvbiA9IDA7DQogICAgICB0aGlzLl9pc1NlYXJjaGluZyA9IGZhbHNlOw0KDQogICAgICBpZiAocGFzc2VkR3JvdXBzICYmIHBhc3NlZEdyb3Vwcy5sZW5ndGgpIHsNCiAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIHBsYWNlaG9sZGVyIG9wdGlvbg0KICAgICAgICB2YXIgcGxhY2Vob2xkZXJDaG9pY2UgPSB0aGlzLnBhc3NlZEVsZW1lbnQucGxhY2Vob2xkZXJPcHRpb247DQogICAgICAgIGlmIChwbGFjZWhvbGRlckNob2ljZSAmJiBwbGFjZWhvbGRlckNob2ljZS5wYXJlbnROb2RlLnRhZ05hbWUgPT09ICdTRUxFQ1QnKSB7DQogICAgICAgICAgdGhpcy5fYWRkQ2hvaWNlKHsNCiAgICAgICAgICAgIHZhbHVlOiBwbGFjZWhvbGRlckNob2ljZS52YWx1ZSwNCiAgICAgICAgICAgIGxhYmVsOiBwbGFjZWhvbGRlckNob2ljZS5pbm5lckhUTUwsDQogICAgICAgICAgICBpc1NlbGVjdGVkOiBwbGFjZWhvbGRlckNob2ljZS5zZWxlY3RlZCwNCiAgICAgICAgICAgIGlzRGlzYWJsZWQ6IHBsYWNlaG9sZGVyQ2hvaWNlLmRpc2FibGVkLA0KICAgICAgICAgICAgcGxhY2Vob2xkZXI6IHRydWUNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHBhc3NlZEdyb3Vwcy5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkgew0KICAgICAgICAgIHJldHVybiBfdGhpczIyLl9hZGRHcm91cCh7DQogICAgICAgICAgICBncm91cDogZ3JvdXAsDQogICAgICAgICAgICBpZDogZ3JvdXAuaWQgfHwgbnVsbA0KICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHZhciBwYXNzZWRPcHRpb25zID0gdGhpcy5wYXNzZWRFbGVtZW50Lm9wdGlvbnM7DQogICAgICAgIHZhciBmaWx0ZXIgPSB0aGlzLmNvbmZpZy5zb3J0Rm47DQogICAgICAgIHZhciBhbGxDaG9pY2VzID0gdGhpcy5fcHJlc2V0Q2hvaWNlczsNCg0KICAgICAgICAvLyBDcmVhdGUgYXJyYXkgb2Ygb3B0aW9ucyBmcm9tIG9wdGlvbiBlbGVtZW50cw0KICAgICAgICBwYXNzZWRPcHRpb25zLmZvckVhY2goZnVuY3Rpb24gKG8pIHsNCiAgICAgICAgICBhbGxDaG9pY2VzLnB1c2goew0KICAgICAgICAgICAgdmFsdWU6IG8udmFsdWUsDQogICAgICAgICAgICBsYWJlbDogby5pbm5lckhUTUwsDQogICAgICAgICAgICBzZWxlY3RlZDogby5zZWxlY3RlZCwNCiAgICAgICAgICAgIGRpc2FibGVkOiBvLmRpc2FibGVkIHx8IG8ucGFyZW50Tm9kZS5kaXNhYmxlZCwNCiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBvLmhhc0F0dHJpYnV0ZSgncGxhY2Vob2xkZXInKQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBJZiBzb3J0aW5nIGlzIGVuYWJsZWQgb3IgdGhlIHVzZXIgaXMgc2VhcmNoaW5nLCBmaWx0ZXIgY2hvaWNlcw0KICAgICAgICBpZiAodGhpcy5jb25maWcuc2hvdWxkU29ydCkgew0KICAgICAgICAgIGFsbENob2ljZXMuc29ydChmaWx0ZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gRGV0ZXJtaW5lIHdoZXRoZXIgdGhlcmUgaXMgYSBzZWxlY3RlZCBjaG9pY2UNCiAgICAgICAgdmFyIGhhc1NlbGVjdGVkQ2hvaWNlID0gYWxsQ2hvaWNlcy5zb21lKGZ1bmN0aW9uIChjaG9pY2UpIHsNCiAgICAgICAgICByZXR1cm4gY2hvaWNlLnNlbGVjdGVkOw0KICAgICAgICB9KTsNCiAgICAgICAgdmFyIGhhbmRsZUNob2ljZSA9IGZ1bmN0aW9uIGhhbmRsZUNob2ljZShjaG9pY2UsIGluZGV4KSB7DQogICAgICAgICAgdmFyIHZhbHVlID0gY2hvaWNlLnZhbHVlLA0KICAgICAgICAgICAgICBsYWJlbCA9IGNob2ljZS5sYWJlbCwNCiAgICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllcyA9IGNob2ljZS5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgICAgICBwbGFjZWhvbGRlciA9IGNob2ljZS5wbGFjZWhvbGRlcjsNCg0KDQogICAgICAgICAgaWYgKF90aGlzMjIuX2lzU2VsZWN0RWxlbWVudCkgew0KICAgICAgICAgICAgLy8gSWYgdGhlIGNob2ljZSBpcyBhY3R1YWxseSBhIGdyb3VwDQogICAgICAgICAgICBpZiAoY2hvaWNlLmNob2ljZXMpIHsNCiAgICAgICAgICAgICAgX3RoaXMyMi5fYWRkR3JvdXAoew0KICAgICAgICAgICAgICAgIGdyb3VwOiBjaG9pY2UsDQogICAgICAgICAgICAgICAgaWQ6IGNob2ljZS5pZCB8fCBudWxsDQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBzZWxlY3RlZCBjaG9pY2UgYWxyZWFkeSBvciB0aGUgY2hvaWNlIGlzIG5vdA0KICAgICAgICAgICAgICAvLyB0aGUgZmlyc3QgaW4gdGhlIGFycmF5LCBhZGQgZWFjaCBjaG9pY2Ugbm9ybWFsbHkNCiAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIHByZS1zZWxlY3QgdGhlIGZpcnN0IGNob2ljZSBpbiB0aGUgYXJyYXkgaWYgaXQncyBhIHNpbmdsZSBzZWxlY3QNCiAgICAgICAgICAgICAgdmFyIHNob3VsZFByZXNlbGVjdCA9IF90aGlzMjIuX2lzU2VsZWN0T25lRWxlbWVudCAmJiAhaGFzU2VsZWN0ZWRDaG9pY2UgJiYgaW5kZXggPT09IDA7DQogICAgICAgICAgICAgIHZhciBpc1NlbGVjdGVkID0gc2hvdWxkUHJlc2VsZWN0ID8gdHJ1ZSA6IGNob2ljZS5zZWxlY3RlZDsNCiAgICAgICAgICAgICAgdmFyIGlzRGlzYWJsZWQgPSBzaG91bGRQcmVzZWxlY3QgPyBmYWxzZSA6IGNob2ljZS5kaXNhYmxlZDsNCg0KICAgICAgICAgICAgICBfdGhpczIyLl9hZGRDaG9pY2Uoew0KICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICAgICAgICBsYWJlbDogbGFiZWwsDQogICAgICAgICAgICAgICAgaXNTZWxlY3RlZDogaXNTZWxlY3RlZCwNCiAgICAgICAgICAgICAgICBpc0Rpc2FibGVkOiBpc0Rpc2FibGVkLA0KICAgICAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyDQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBfdGhpczIyLl9hZGRDaG9pY2Uoew0KICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsDQogICAgICAgICAgICAgIGxhYmVsOiBsYWJlbCwNCiAgICAgICAgICAgICAgaXNTZWxlY3RlZDogY2hvaWNlLnNlbGVjdGVkLA0KICAgICAgICAgICAgICBpc0Rpc2FibGVkOiBjaG9pY2UuZGlzYWJsZWQsDQogICAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlcg0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8vIEFkZCBlYWNoIGNob2ljZQ0KICAgICAgICBhbGxDaG9pY2VzLmZvckVhY2goZnVuY3Rpb24gKGNob2ljZSwgaW5kZXgpIHsNCiAgICAgICAgICByZXR1cm4gaGFuZGxlQ2hvaWNlKGNob2ljZSwgaW5kZXgpOw0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfYWRkUHJlZGVmaW5lZEl0ZW1zJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZFByZWRlZmluZWRJdGVtcygpIHsNCiAgICAgIHZhciBfdGhpczIzID0gdGhpczsNCg0KICAgICAgdmFyIGhhbmRsZVByZXNldEl0ZW0gPSBmdW5jdGlvbiBoYW5kbGVQcmVzZXRJdGVtKGl0ZW0pIHsNCiAgICAgICAgdmFyIGl0ZW1UeXBlID0gKDAsIF91dGlscy5nZXRUeXBlKShpdGVtKTsNCiAgICAgICAgaWYgKGl0ZW1UeXBlID09PSAnT2JqZWN0JyAmJiBpdGVtLnZhbHVlKSB7DQogICAgICAgICAgX3RoaXMyMy5fYWRkSXRlbSh7DQogICAgICAgICAgICB2YWx1ZTogaXRlbS52YWx1ZSwNCiAgICAgICAgICAgIGxhYmVsOiBpdGVtLmxhYmVsLA0KICAgICAgICAgICAgY2hvaWNlSWQ6IGl0ZW0uaWQsDQogICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBpdGVtLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgICBwbGFjZWhvbGRlcjogaXRlbS5wbGFjZWhvbGRlcg0KICAgICAgICAgIH0pOw0KICAgICAgICB9IGVsc2UgaWYgKGl0ZW1UeXBlID09PSAnU3RyaW5nJykgew0KICAgICAgICAgIF90aGlzMjMuX2FkZEl0ZW0oew0KICAgICAgICAgICAgdmFsdWU6IGl0ZW0NCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfTsNCg0KICAgICAgdGhpcy5fcHJlc2V0SXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICByZXR1cm4gaGFuZGxlUHJlc2V0SXRlbShpdGVtKTsNCiAgICAgIH0pOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19zZXRDaG9pY2VPckl0ZW0nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0Q2hvaWNlT3JJdGVtKGl0ZW0pIHsNCiAgICAgIHZhciBfdGhpczI0ID0gdGhpczsNCg0KICAgICAgdmFyIGl0ZW1UeXBlID0gKDAsIF91dGlscy5nZXRUeXBlKShpdGVtKS50b0xvd2VyQ2FzZSgpOw0KICAgICAgdmFyIGhhbmRsZVR5cGUgPSB7DQogICAgICAgIG9iamVjdDogZnVuY3Rpb24gb2JqZWN0KCkgew0KICAgICAgICAgIGlmICghaXRlbS52YWx1ZSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIElmIHdlIGFyZSBkZWFsaW5nIHdpdGggYSBzZWxlY3QgaW5wdXQsIHdlIG5lZWQgdG8gY3JlYXRlIGFuIG9wdGlvbiBmaXJzdA0KICAgICAgICAgIC8vIHRoYXQgaXMgdGhlbiBzZWxlY3RlZC4gRm9yIHRleHQgaW5wdXRzIHdlIGNhbiBqdXN0IGFkZCBpdGVtcyBub3JtYWxseS4NCiAgICAgICAgICBpZiAoIV90aGlzMjQuX2lzVGV4dEVsZW1lbnQpIHsNCiAgICAgICAgICAgIF90aGlzMjQuX2FkZENob2ljZSh7DQogICAgICAgICAgICAgIHZhbHVlOiBpdGVtLnZhbHVlLA0KICAgICAgICAgICAgICBsYWJlbDogaXRlbS5sYWJlbCwNCiAgICAgICAgICAgICAgaXNTZWxlY3RlZDogdHJ1ZSwNCiAgICAgICAgICAgICAgaXNEaXNhYmxlZDogZmFsc2UsDQogICAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGl0ZW0uY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGl0ZW0ucGxhY2Vob2xkZXINCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBfdGhpczI0Ll9hZGRJdGVtKHsNCiAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0udmFsdWUsDQogICAgICAgICAgICAgIGxhYmVsOiBpdGVtLmxhYmVsLA0KICAgICAgICAgICAgICBjaG9pY2VJZDogaXRlbS5pZCwNCiAgICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllczogaXRlbS5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogaXRlbS5wbGFjZWhvbGRlcg0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBzdHJpbmc6IGZ1bmN0aW9uIHN0cmluZygpIHsNCiAgICAgICAgICBpZiAoIV90aGlzMjQuX2lzVGV4dEVsZW1lbnQpIHsNCiAgICAgICAgICAgIF90aGlzMjQuX2FkZENob2ljZSh7DQogICAgICAgICAgICAgIHZhbHVlOiBpdGVtLA0KICAgICAgICAgICAgICBsYWJlbDogaXRlbSwNCiAgICAgICAgICAgICAgaXNTZWxlY3RlZDogdHJ1ZSwNCiAgICAgICAgICAgICAgaXNEaXNhYmxlZDogZmFsc2UNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBfdGhpczI0Ll9hZGRJdGVtKHsNCiAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfTsNCg0KICAgICAgaGFuZGxlVHlwZVtpdGVtVHlwZV0oKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfZmluZEFuZFNlbGVjdENob2ljZUJ5VmFsdWUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfZmluZEFuZFNlbGVjdENob2ljZUJ5VmFsdWUodmFsKSB7DQogICAgICB2YXIgX3RoaXMyNSA9IHRoaXM7DQoNCiAgICAgIHZhciBjaG9pY2VzID0gdGhpcy5fc3RvcmUuY2hvaWNlczsNCiAgICAgIC8vIENoZWNrICd2YWx1ZScgcHJvcGVydHkgZXhpc3RzIGFuZCB0aGUgY2hvaWNlIGlzbid0IGFscmVhZHkgc2VsZWN0ZWQNCiAgICAgIHZhciBmb3VuZENob2ljZSA9IGNob2ljZXMuZmluZChmdW5jdGlvbiAoY2hvaWNlKSB7DQogICAgICAgIHJldHVybiBfdGhpczI1LmNvbmZpZy5pdGVtQ29tcGFyZXIoY2hvaWNlLnZhbHVlLCB2YWwpOw0KICAgICAgfSk7DQoNCiAgICAgIGlmIChmb3VuZENob2ljZSAmJiAhZm91bmRDaG9pY2Uuc2VsZWN0ZWQpIHsNCiAgICAgICAgdGhpcy5fYWRkSXRlbSh7DQogICAgICAgICAgdmFsdWU6IGZvdW5kQ2hvaWNlLnZhbHVlLA0KICAgICAgICAgIGxhYmVsOiBmb3VuZENob2ljZS5sYWJlbCwNCiAgICAgICAgICBpZDogZm91bmRDaG9pY2UuaWQsDQogICAgICAgICAgZ3JvdXBJZDogZm91bmRDaG9pY2UuZ3JvdXBJZCwNCiAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBmb3VuZENob2ljZS5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgIHBsYWNlaG9sZGVyOiBmb3VuZENob2ljZS5wbGFjZWhvbGRlciwNCiAgICAgICAgICBrZXlDb2RlOiBmb3VuZENob2ljZS5rZXlDb2RlDQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19nZW5lcmF0ZUluc3RhbmNlcycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZW5lcmF0ZUluc3RhbmNlcyhlbGVtZW50cywgY29uZmlnKSB7DQogICAgICByZXR1cm4gZWxlbWVudHMucmVkdWNlKGZ1bmN0aW9uIChpbnN0YW5jZXMsIGVsZW1lbnQpIHsNCiAgICAgICAgaW5zdGFuY2VzLnB1c2gobmV3IENob2ljZXMoZWxlbWVudCwgY29uZmlnKSk7DQogICAgICAgIHJldHVybiBpbnN0YW5jZXM7DQogICAgICB9LCBbdGhpc10pOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19nZW5lcmF0ZVBsYWNlaG9sZGVyVmFsdWUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2VuZXJhdGVQbGFjZWhvbGRlclZhbHVlKCkgew0KICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQoNCiAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5wbGFjZWhvbGRlciA/IHRoaXMuY29uZmlnLnBsYWNlaG9sZGVyVmFsdWUgfHwgdGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQuZ2V0QXR0cmlidXRlKCdwbGFjZWhvbGRlcicpIDogZmFsc2U7DQogICAgfQ0KDQogICAgLyogPT09PT0gIEVuZCBvZiBQcml2YXRlIGZ1bmN0aW9ucyAgPT09PT09ICovDQoNCiAgfV0pOw0KDQogIHJldHVybiBDaG9pY2VzOw0KfSgpOw0KDQpDaG9pY2VzLnVzZXJEZWZhdWx0cyA9IHt9Ow0KLy8gV2UgY2Fubm90IGV4cG9ydCBkZWZhdWx0IGhlcmUgZHVlIHRvIFdlYnBhY2s6IGh0dHBzOi8vZ2l0aHViLmNvbS93ZWJwYWNrL3dlYnBhY2svaXNzdWVzLzM5MjkNCm1vZHVsZS5leHBvcnRzID0gQ2hvaWNlczsNCg0KLyoqKi8gfSksDQovKiAzOSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovKiENCiAqIEZ1c2UuanMgdjMuMi4wIC0gTGlnaHR3ZWlnaHQgZnV6enktc2VhcmNoIChodHRwOi8vZnVzZWpzLmlvKQ0KICoNCiAqIENvcHlyaWdodCAoYykgMjAxMi0yMDE3IEtpcm9sbG9zIFJpc2sgKGh0dHA6Ly9raXJvLm1lKQ0KICogQWxsIFJpZ2h0cyBSZXNlcnZlZC4gQXBhY2hlIFNvZnR3YXJlIExpY2Vuc2UgMi4wDQogKg0KICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKi8NCihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7DQoJaWYodHJ1ZSkNCgkJbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7DQoJZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpDQoJCWRlZmluZSgiRnVzZSIsIFtdLCBmYWN0b3J5KTsNCgllbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JykNCgkJZXhwb3J0c1siRnVzZSJdID0gZmFjdG9yeSgpOw0KCWVsc2UNCgkJcm9vdFsiRnVzZSJdID0gZmFjdG9yeSgpOw0KfSkodGhpcywgZnVuY3Rpb24oKSB7DQpyZXR1cm4gLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcA0KLyoqKioqKi8gCS8vIFRoZSBtb2R1bGUgY2FjaGUNCi8qKioqKiovIAl2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9Ow0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBUaGUgcmVxdWlyZSBmdW5jdGlvbg0KLyoqKioqKi8gCWZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHsNCi8qKioqKiovDQovKioqKioqLyAJCS8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZQ0KLyoqKioqKi8gCQlpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkgew0KLyoqKioqKi8gCQkJcmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7DQovKioqKioqLyAJCX0NCi8qKioqKiovIAkJLy8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSkNCi8qKioqKiovIAkJdmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0gew0KLyoqKioqKi8gCQkJaTogbW9kdWxlSWQsDQovKioqKioqLyAJCQlsOiBmYWxzZSwNCi8qKioqKiovIAkJCWV4cG9ydHM6IHt9DQovKioqKioqLyAJCX07DQovKioqKioqLw0KLyoqKioqKi8gCQkvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb24NCi8qKioqKiovIAkJbW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7DQovKioqKioqLw0KLyoqKioqKi8gCQkvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkDQovKioqKioqLyAJCW1vZHVsZS5sID0gdHJ1ZTsNCi8qKioqKiovDQovKioqKioqLyAJCS8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlDQovKioqKioqLyAJCXJldHVybiBtb2R1bGUuZXhwb3J0czsNCi8qKioqKiovIAl9DQovKioqKioqLw0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKQ0KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7DQovKioqKioqLw0KLyoqKioqKi8gCS8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlDQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlczsNCi8qKioqKiovDQovKioqKioqLyAJLy8gaWRlbnRpdHkgZnVuY3Rpb24gZm9yIGNhbGxpbmcgaGFybW9ueSBpbXBvcnRzIHdpdGggdGhlIGNvcnJlY3QgY29udGV4dA0KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18uaSA9IGZ1bmN0aW9uKHZhbHVlKSB7IHJldHVybiB2YWx1ZTsgfTsNCi8qKioqKiovDQovKioqKioqLyAJLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzDQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7DQovKioqKioqLyAJCWlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHsNCi8qKioqKiovIAkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7DQovKioqKioqLyAJCQkJY29uZmlndXJhYmxlOiBmYWxzZSwNCi8qKioqKiovIAkJCQllbnVtZXJhYmxlOiB0cnVlLA0KLyoqKioqKi8gCQkJCWdldDogZ2V0dGVyDQovKioqKioqLyAJCQl9KTsNCi8qKioqKiovIAkJfQ0KLyoqKioqKi8gCX07DQovKioqKioqLw0KLyoqKioqKi8gCS8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzDQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7DQovKioqKioqLyAJCXZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgPw0KLyoqKioqKi8gCQkJZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDoNCi8qKioqKiovIAkJCWZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07DQovKioqKioqLyAJCV9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTsNCi8qKioqKiovIAkJcmV0dXJuIGdldHRlcjsNCi8qKioqKiovIAl9Ow0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwNCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07DQovKioqKioqLw0KLyoqKioqKi8gCS8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fDQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gIiI7DQovKioqKioqLw0KLyoqKioqKi8gCS8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0cw0KLyoqKioqKi8gCXJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDgpOw0KLyoqKioqKi8gfSkNCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQovKioqKioqLyAoWw0KLyogMCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqKSB7DQogIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJzsNCn07DQoNCi8qKiovIH0pLA0KLyogMSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7DQoNCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQ0KDQp2YXIgYml0YXBSZWdleFNlYXJjaCA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7DQp2YXIgYml0YXBTZWFyY2ggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOw0KdmFyIHBhdHRlcm5BbHBoYWJldCA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7DQoNCnZhciBCaXRhcCA9IGZ1bmN0aW9uICgpIHsNCiAgZnVuY3Rpb24gQml0YXAocGF0dGVybiwgX3JlZikgew0KICAgIHZhciBfcmVmJGxvY2F0aW9uID0gX3JlZi5sb2NhdGlvbiwNCiAgICAgICAgbG9jYXRpb24gPSBfcmVmJGxvY2F0aW9uID09PSB1bmRlZmluZWQgPyAwIDogX3JlZiRsb2NhdGlvbiwNCiAgICAgICAgX3JlZiRkaXN0YW5jZSA9IF9yZWYuZGlzdGFuY2UsDQogICAgICAgIGRpc3RhbmNlID0gX3JlZiRkaXN0YW5jZSA9PT0gdW5kZWZpbmVkID8gMTAwIDogX3JlZiRkaXN0YW5jZSwNCiAgICAgICAgX3JlZiR0aHJlc2hvbGQgPSBfcmVmLnRocmVzaG9sZCwNCiAgICAgICAgdGhyZXNob2xkID0gX3JlZiR0aHJlc2hvbGQgPT09IHVuZGVmaW5lZCA/IDAuNiA6IF9yZWYkdGhyZXNob2xkLA0KICAgICAgICBfcmVmJG1heFBhdHRlcm5MZW5ndGggPSBfcmVmLm1heFBhdHRlcm5MZW5ndGgsDQogICAgICAgIG1heFBhdHRlcm5MZW5ndGggPSBfcmVmJG1heFBhdHRlcm5MZW5ndGggPT09IHVuZGVmaW5lZCA/IDMyIDogX3JlZiRtYXhQYXR0ZXJuTGVuZ3RoLA0KICAgICAgICBfcmVmJGlzQ2FzZVNlbnNpdGl2ZSA9IF9yZWYuaXNDYXNlU2Vuc2l0aXZlLA0KICAgICAgICBpc0Nhc2VTZW5zaXRpdmUgPSBfcmVmJGlzQ2FzZVNlbnNpdGl2ZSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmJGlzQ2FzZVNlbnNpdGl2ZSwNCiAgICAgICAgX3JlZiR0b2tlblNlcGFyYXRvciA9IF9yZWYudG9rZW5TZXBhcmF0b3IsDQogICAgICAgIHRva2VuU2VwYXJhdG9yID0gX3JlZiR0b2tlblNlcGFyYXRvciA9PT0gdW5kZWZpbmVkID8gLyArL2cgOiBfcmVmJHRva2VuU2VwYXJhdG9yLA0KICAgICAgICBfcmVmJGZpbmRBbGxNYXRjaGVzID0gX3JlZi5maW5kQWxsTWF0Y2hlcywNCiAgICAgICAgZmluZEFsbE1hdGNoZXMgPSBfcmVmJGZpbmRBbGxNYXRjaGVzID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkZmluZEFsbE1hdGNoZXMsDQogICAgICAgIF9yZWYkbWluTWF0Y2hDaGFyTGVuZyA9IF9yZWYubWluTWF0Y2hDaGFyTGVuZ3RoLA0KICAgICAgICBtaW5NYXRjaENoYXJMZW5ndGggPSBfcmVmJG1pbk1hdGNoQ2hhckxlbmcgPT09IHVuZGVmaW5lZCA/IDEgOiBfcmVmJG1pbk1hdGNoQ2hhckxlbmc7DQoNCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQml0YXApOw0KDQogICAgdGhpcy5vcHRpb25zID0gew0KICAgICAgbG9jYXRpb246IGxvY2F0aW9uLA0KICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlLA0KICAgICAgdGhyZXNob2xkOiB0aHJlc2hvbGQsDQogICAgICBtYXhQYXR0ZXJuTGVuZ3RoOiBtYXhQYXR0ZXJuTGVuZ3RoLA0KICAgICAgaXNDYXNlU2Vuc2l0aXZlOiBpc0Nhc2VTZW5zaXRpdmUsDQogICAgICB0b2tlblNlcGFyYXRvcjogdG9rZW5TZXBhcmF0b3IsDQogICAgICBmaW5kQWxsTWF0Y2hlczogZmluZEFsbE1hdGNoZXMsDQogICAgICBtaW5NYXRjaENoYXJMZW5ndGg6IG1pbk1hdGNoQ2hhckxlbmd0aA0KICAgIH07DQoNCiAgICB0aGlzLnBhdHRlcm4gPSB0aGlzLm9wdGlvbnMuaXNDYXNlU2Vuc2l0aXZlID8gcGF0dGVybiA6IHBhdHRlcm4udG9Mb3dlckNhc2UoKTsNCg0KICAgIGlmICh0aGlzLnBhdHRlcm4ubGVuZ3RoIDw9IG1heFBhdHRlcm5MZW5ndGgpIHsNCiAgICAgIHRoaXMucGF0dGVybkFscGhhYmV0ID0gcGF0dGVybkFscGhhYmV0KHRoaXMucGF0dGVybik7DQogICAgfQ0KICB9DQoNCiAgX2NyZWF0ZUNsYXNzKEJpdGFwLCBbew0KICAgIGtleTogJ3NlYXJjaCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNlYXJjaCh0ZXh0KSB7DQogICAgICBpZiAoIXRoaXMub3B0aW9ucy5pc0Nhc2VTZW5zaXRpdmUpIHsNCiAgICAgICAgdGV4dCA9IHRleHQudG9Mb3dlckNhc2UoKTsNCiAgICAgIH0NCg0KICAgICAgLy8gRXhhY3QgbWF0Y2gNCiAgICAgIGlmICh0aGlzLnBhdHRlcm4gPT09IHRleHQpIHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICBpc01hdGNoOiB0cnVlLA0KICAgICAgICAgIHNjb3JlOiAwLA0KICAgICAgICAgIG1hdGNoZWRJbmRpY2VzOiBbWzAsIHRleHQubGVuZ3RoIC0gMV1dDQogICAgICAgIH07DQogICAgICB9DQoNCiAgICAgIC8vIFdoZW4gcGF0dGVybiBsZW5ndGggaXMgZ3JlYXRlciB0aGFuIHRoZSBtYWNoaW5lIHdvcmQgbGVuZ3RoLCBqdXN0IGRvIGEgYSByZWdleCBjb21wYXJpc29uDQogICAgICB2YXIgX29wdGlvbnMgPSB0aGlzLm9wdGlvbnMsDQogICAgICAgICAgbWF4UGF0dGVybkxlbmd0aCA9IF9vcHRpb25zLm1heFBhdHRlcm5MZW5ndGgsDQogICAgICAgICAgdG9rZW5TZXBhcmF0b3IgPSBfb3B0aW9ucy50b2tlblNlcGFyYXRvcjsNCg0KICAgICAgaWYgKHRoaXMucGF0dGVybi5sZW5ndGggPiBtYXhQYXR0ZXJuTGVuZ3RoKSB7DQogICAgICAgIHJldHVybiBiaXRhcFJlZ2V4U2VhcmNoKHRleHQsIHRoaXMucGF0dGVybiwgdG9rZW5TZXBhcmF0b3IpOw0KICAgICAgfQ0KDQogICAgICAvLyBPdGhlcndpc2UsIHVzZSBCaXRhcCBhbGdvcml0aG0NCiAgICAgIHZhciBfb3B0aW9uczIgPSB0aGlzLm9wdGlvbnMsDQogICAgICAgICAgbG9jYXRpb24gPSBfb3B0aW9uczIubG9jYXRpb24sDQogICAgICAgICAgZGlzdGFuY2UgPSBfb3B0aW9uczIuZGlzdGFuY2UsDQogICAgICAgICAgdGhyZXNob2xkID0gX29wdGlvbnMyLnRocmVzaG9sZCwNCiAgICAgICAgICBmaW5kQWxsTWF0Y2hlcyA9IF9vcHRpb25zMi5maW5kQWxsTWF0Y2hlcywNCiAgICAgICAgICBtaW5NYXRjaENoYXJMZW5ndGggPSBfb3B0aW9uczIubWluTWF0Y2hDaGFyTGVuZ3RoOw0KDQogICAgICByZXR1cm4gYml0YXBTZWFyY2godGV4dCwgdGhpcy5wYXR0ZXJuLCB0aGlzLnBhdHRlcm5BbHBoYWJldCwgew0KICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sDQogICAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZSwNCiAgICAgICAgdGhyZXNob2xkOiB0aHJlc2hvbGQsDQogICAgICAgIGZpbmRBbGxNYXRjaGVzOiBmaW5kQWxsTWF0Y2hlcywNCiAgICAgICAgbWluTWF0Y2hDaGFyTGVuZ3RoOiBtaW5NYXRjaENoYXJMZW5ndGgNCiAgICAgIH0pOw0KICAgIH0NCiAgfV0pOw0KDQogIHJldHVybiBCaXRhcDsNCn0oKTsNCg0KLy8gbGV0IHggPSBuZXcgQml0YXAoIm9kIG1uIHdhciIsIHt9KQ0KLy8gbGV0IHJlc3VsdCA9IHguc2VhcmNoKCJPbGQgTWFuJ3MgV2FyIikNCi8vIGNvbnNvbGUubG9nKHJlc3VsdCkNCg0KbW9kdWxlLmV4cG9ydHMgPSBCaXRhcDsNCg0KLyoqKi8gfSksDQovKiAyICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQp2YXIgaXNBcnJheSA9IF9fd2VicGFja19yZXF1aXJlX18oMCk7DQoNCnZhciBkZWVwVmFsdWUgPSBmdW5jdGlvbiBkZWVwVmFsdWUob2JqLCBwYXRoLCBsaXN0KSB7DQogIGlmICghcGF0aCkgew0KICAgIC8vIElmIHRoZXJlJ3Mgbm8gcGF0aCBsZWZ0LCB3ZSd2ZSBnb3R0ZW4gdG8gdGhlIG9iamVjdCB3ZSBjYXJlIGFib3V0Lg0KICAgIGxpc3QucHVzaChvYmopOw0KICB9IGVsc2Ugew0KICAgIHZhciBkb3RJbmRleCA9IHBhdGguaW5kZXhPZignLicpOw0KICAgIHZhciBmaXJzdFNlZ21lbnQgPSBwYXRoOw0KICAgIHZhciByZW1haW5pbmcgPSBudWxsOw0KDQogICAgaWYgKGRvdEluZGV4ICE9PSAtMSkgew0KICAgICAgZmlyc3RTZWdtZW50ID0gcGF0aC5zbGljZSgwLCBkb3RJbmRleCk7DQogICAgICByZW1haW5pbmcgPSBwYXRoLnNsaWNlKGRvdEluZGV4ICsgMSk7DQogICAgfQ0KDQogICAgdmFyIHZhbHVlID0gb2JqW2ZpcnN0U2VnbWVudF07DQoNCiAgICBpZiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCkgew0KICAgICAgaWYgKCFyZW1haW5pbmcgJiYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykpIHsNCiAgICAgICAgbGlzdC5wdXNoKHZhbHVlLnRvU3RyaW5nKCkpOw0KICAgICAgfSBlbHNlIGlmIChpc0FycmF5KHZhbHVlKSkgew0KICAgICAgICAvLyBTZWFyY2ggZWFjaCBpdGVtIGluIHRoZSBhcnJheS4NCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHZhbHVlLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAxKSB7DQogICAgICAgICAgZGVlcFZhbHVlKHZhbHVlW2ldLCByZW1haW5pbmcsIGxpc3QpOw0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHJlbWFpbmluZykgew0KICAgICAgICAvLyBBbiBvYmplY3QuIFJlY3Vyc2UgZnVydGhlci4NCiAgICAgICAgZGVlcFZhbHVlKHZhbHVlLCByZW1haW5pbmcsIGxpc3QpOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIHJldHVybiBsaXN0Ow0KfTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqLCBwYXRoKSB7DQogIHJldHVybiBkZWVwVmFsdWUob2JqLCBwYXRoLCBbXSk7DQp9Ow0KDQovKioqLyB9KSwNCi8qIDMgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKCkgew0KICB2YXIgbWF0Y2htYXNrID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTsNCiAgdmFyIG1pbk1hdGNoQ2hhckxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMTsNCg0KICB2YXIgbWF0Y2hlZEluZGljZXMgPSBbXTsNCiAgdmFyIHN0YXJ0ID0gLTE7DQogIHZhciBlbmQgPSAtMTsNCiAgdmFyIGkgPSAwOw0KDQogIGZvciAodmFyIGxlbiA9IG1hdGNobWFzay5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkgew0KICAgIHZhciBtYXRjaCA9IG1hdGNobWFza1tpXTsNCiAgICBpZiAobWF0Y2ggJiYgc3RhcnQgPT09IC0xKSB7DQogICAgICBzdGFydCA9IGk7DQogICAgfSBlbHNlIGlmICghbWF0Y2ggJiYgc3RhcnQgIT09IC0xKSB7DQogICAgICBlbmQgPSBpIC0gMTsNCiAgICAgIGlmIChlbmQgLSBzdGFydCArIDEgPj0gbWluTWF0Y2hDaGFyTGVuZ3RoKSB7DQogICAgICAgIG1hdGNoZWRJbmRpY2VzLnB1c2goW3N0YXJ0LCBlbmRdKTsNCiAgICAgIH0NCiAgICAgIHN0YXJ0ID0gLTE7DQogICAgfQ0KICB9DQoNCiAgLy8gKGktMSAtIHN0YXJ0KSArIDEgPT4gaSAtIHN0YXJ0DQogIGlmIChtYXRjaG1hc2tbaSAtIDFdICYmIGkgLSBzdGFydCA+PSBtaW5NYXRjaENoYXJMZW5ndGgpIHsNCiAgICBtYXRjaGVkSW5kaWNlcy5wdXNoKFtzdGFydCwgaSAtIDFdKTsNCiAgfQ0KDQogIHJldHVybiBtYXRjaGVkSW5kaWNlczsNCn07DQoNCi8qKiovIH0pLA0KLyogNCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAocGF0dGVybikgew0KICB2YXIgbWFzayA9IHt9Ow0KICB2YXIgbGVuID0gcGF0dGVybi5sZW5ndGg7DQoNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkgKz0gMSkgew0KICAgIG1hc2tbcGF0dGVybi5jaGFyQXQoaSldID0gMDsNCiAgfQ0KDQogIGZvciAodmFyIF9pID0gMDsgX2kgPCBsZW47IF9pICs9IDEpIHsNCiAgICBtYXNrW3BhdHRlcm4uY2hhckF0KF9pKV0gfD0gMSA8PCBsZW4gLSBfaSAtIDE7DQogIH0NCg0KICByZXR1cm4gbWFzazsNCn07DQoNCi8qKiovIH0pLA0KLyogNSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KdmFyIFNQRUNJQUxfQ0hBUlNfUkVHRVggPSAvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICh0ZXh0LCBwYXR0ZXJuKSB7DQogIHZhciB0b2tlblNlcGFyYXRvciA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogLyArL2c7DQoNCiAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cChwYXR0ZXJuLnJlcGxhY2UoU1BFQ0lBTF9DSEFSU19SRUdFWCwgJ1xcJCYnKS5yZXBsYWNlKHRva2VuU2VwYXJhdG9yLCAnfCcpKTsNCiAgdmFyIG1hdGNoZXMgPSB0ZXh0Lm1hdGNoKHJlZ2V4KTsNCiAgdmFyIGlzTWF0Y2ggPSAhIW1hdGNoZXM7DQogIHZhciBtYXRjaGVkSW5kaWNlcyA9IFtdOw0KDQogIGlmIChpc01hdGNoKSB7DQogICAgZm9yICh2YXIgaSA9IDAsIG1hdGNoZXNMZW4gPSBtYXRjaGVzLmxlbmd0aDsgaSA8IG1hdGNoZXNMZW47IGkgKz0gMSkgew0KICAgICAgdmFyIG1hdGNoID0gbWF0Y2hlc1tpXTsNCiAgICAgIG1hdGNoZWRJbmRpY2VzLnB1c2goW3RleHQuaW5kZXhPZihtYXRjaCksIG1hdGNoLmxlbmd0aCAtIDFdKTsNCiAgICB9DQogIH0NCg0KICByZXR1cm4gew0KICAgIC8vIFRPRE86IHJldmlzaXQgdGhpcyBzY29yZQ0KICAgIHNjb3JlOiBpc01hdGNoID8gMC41IDogMSwNCiAgICBpc01hdGNoOiBpc01hdGNoLA0KICAgIG1hdGNoZWRJbmRpY2VzOiBtYXRjaGVkSW5kaWNlcw0KICB9Ow0KfTsNCg0KLyoqKi8gfSksDQovKiA2ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChwYXR0ZXJuLCBfcmVmKSB7DQogIHZhciBfcmVmJGVycm9ycyA9IF9yZWYuZXJyb3JzLA0KICAgICAgZXJyb3JzID0gX3JlZiRlcnJvcnMgPT09IHVuZGVmaW5lZCA/IDAgOiBfcmVmJGVycm9ycywNCiAgICAgIF9yZWYkY3VycmVudExvY2F0aW9uID0gX3JlZi5jdXJyZW50TG9jYXRpb24sDQogICAgICBjdXJyZW50TG9jYXRpb24gPSBfcmVmJGN1cnJlbnRMb2NhdGlvbiA9PT0gdW5kZWZpbmVkID8gMCA6IF9yZWYkY3VycmVudExvY2F0aW9uLA0KICAgICAgX3JlZiRleHBlY3RlZExvY2F0aW9uID0gX3JlZi5leHBlY3RlZExvY2F0aW9uLA0KICAgICAgZXhwZWN0ZWRMb2NhdGlvbiA9IF9yZWYkZXhwZWN0ZWRMb2NhdGlvbiA9PT0gdW5kZWZpbmVkID8gMCA6IF9yZWYkZXhwZWN0ZWRMb2NhdGlvbiwNCiAgICAgIF9yZWYkZGlzdGFuY2UgPSBfcmVmLmRpc3RhbmNlLA0KICAgICAgZGlzdGFuY2UgPSBfcmVmJGRpc3RhbmNlID09PSB1bmRlZmluZWQgPyAxMDAgOiBfcmVmJGRpc3RhbmNlOw0KDQogIHZhciBhY2N1cmFjeSA9IGVycm9ycyAvIHBhdHRlcm4ubGVuZ3RoOw0KICB2YXIgcHJveGltaXR5ID0gTWF0aC5hYnMoZXhwZWN0ZWRMb2NhdGlvbiAtIGN1cnJlbnRMb2NhdGlvbik7DQoNCiAgaWYgKCFkaXN0YW5jZSkgew0KICAgIC8vIERvZGdlIGRpdmlkZSBieSB6ZXJvIGVycm9yLg0KICAgIHJldHVybiBwcm94aW1pdHkgPyAxLjAgOiBhY2N1cmFjeTsNCiAgfQ0KDQogIHJldHVybiBhY2N1cmFjeSArIHByb3hpbWl0eSAvIGRpc3RhbmNlOw0KfTsNCg0KLyoqKi8gfSksDQovKiA3ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQp2YXIgYml0YXBTY29yZSA9IF9fd2VicGFja19yZXF1aXJlX18oNik7DQp2YXIgbWF0Y2hlZEluZGljZXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICh0ZXh0LCBwYXR0ZXJuLCBwYXR0ZXJuQWxwaGFiZXQsIF9yZWYpIHsNCiAgdmFyIF9yZWYkbG9jYXRpb24gPSBfcmVmLmxvY2F0aW9uLA0KICAgICAgbG9jYXRpb24gPSBfcmVmJGxvY2F0aW9uID09PSB1bmRlZmluZWQgPyAwIDogX3JlZiRsb2NhdGlvbiwNCiAgICAgIF9yZWYkZGlzdGFuY2UgPSBfcmVmLmRpc3RhbmNlLA0KICAgICAgZGlzdGFuY2UgPSBfcmVmJGRpc3RhbmNlID09PSB1bmRlZmluZWQgPyAxMDAgOiBfcmVmJGRpc3RhbmNlLA0KICAgICAgX3JlZiR0aHJlc2hvbGQgPSBfcmVmLnRocmVzaG9sZCwNCiAgICAgIHRocmVzaG9sZCA9IF9yZWYkdGhyZXNob2xkID09PSB1bmRlZmluZWQgPyAwLjYgOiBfcmVmJHRocmVzaG9sZCwNCiAgICAgIF9yZWYkZmluZEFsbE1hdGNoZXMgPSBfcmVmLmZpbmRBbGxNYXRjaGVzLA0KICAgICAgZmluZEFsbE1hdGNoZXMgPSBfcmVmJGZpbmRBbGxNYXRjaGVzID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkZmluZEFsbE1hdGNoZXMsDQogICAgICBfcmVmJG1pbk1hdGNoQ2hhckxlbmcgPSBfcmVmLm1pbk1hdGNoQ2hhckxlbmd0aCwNCiAgICAgIG1pbk1hdGNoQ2hhckxlbmd0aCA9IF9yZWYkbWluTWF0Y2hDaGFyTGVuZyA9PT0gdW5kZWZpbmVkID8gMSA6IF9yZWYkbWluTWF0Y2hDaGFyTGVuZzsNCg0KICB2YXIgZXhwZWN0ZWRMb2NhdGlvbiA9IGxvY2F0aW9uOw0KICAvLyBTZXQgc3RhcnRpbmcgbG9jYXRpb24gYXQgYmVnaW5uaW5nIHRleHQgYW5kIGluaXRpYWxpemUgdGhlIGFscGhhYmV0Lg0KICB2YXIgdGV4dExlbiA9IHRleHQubGVuZ3RoOw0KICAvLyBIaWdoZXN0IHNjb3JlIGJleW9uZCB3aGljaCB3ZSBnaXZlIHVwLg0KICB2YXIgY3VycmVudFRocmVzaG9sZCA9IHRocmVzaG9sZDsNCiAgLy8gSXMgdGhlcmUgYSBuZWFyYnkgZXhhY3QgbWF0Y2g/IChzcGVlZHVwKQ0KICB2YXIgYmVzdExvY2F0aW9uID0gdGV4dC5pbmRleE9mKHBhdHRlcm4sIGV4cGVjdGVkTG9jYXRpb24pOw0KDQogIHZhciBwYXR0ZXJuTGVuID0gcGF0dGVybi5sZW5ndGg7DQoNCiAgLy8gYSBtYXNrIG9mIHRoZSBtYXRjaGVzDQogIHZhciBtYXRjaE1hc2sgPSBbXTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZXh0TGVuOyBpICs9IDEpIHsNCiAgICBtYXRjaE1hc2tbaV0gPSAwOw0KICB9DQoNCiAgaWYgKGJlc3RMb2NhdGlvbiAhPT0gLTEpIHsNCiAgICB2YXIgc2NvcmUgPSBiaXRhcFNjb3JlKHBhdHRlcm4sIHsNCiAgICAgIGVycm9yczogMCwNCiAgICAgIGN1cnJlbnRMb2NhdGlvbjogYmVzdExvY2F0aW9uLA0KICAgICAgZXhwZWN0ZWRMb2NhdGlvbjogZXhwZWN0ZWRMb2NhdGlvbiwNCiAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZQ0KICAgIH0pOw0KICAgIGN1cnJlbnRUaHJlc2hvbGQgPSBNYXRoLm1pbihzY29yZSwgY3VycmVudFRocmVzaG9sZCk7DQoNCiAgICAvLyBXaGF0IGFib3V0IGluIHRoZSBvdGhlciBkaXJlY3Rpb24/IChzcGVlZCB1cCkNCiAgICBiZXN0TG9jYXRpb24gPSB0ZXh0Lmxhc3RJbmRleE9mKHBhdHRlcm4sIGV4cGVjdGVkTG9jYXRpb24gKyBwYXR0ZXJuTGVuKTsNCg0KICAgIGlmIChiZXN0TG9jYXRpb24gIT09IC0xKSB7DQogICAgICB2YXIgX3Njb3JlID0gYml0YXBTY29yZShwYXR0ZXJuLCB7DQogICAgICAgIGVycm9yczogMCwNCiAgICAgICAgY3VycmVudExvY2F0aW9uOiBiZXN0TG9jYXRpb24sDQogICAgICAgIGV4cGVjdGVkTG9jYXRpb246IGV4cGVjdGVkTG9jYXRpb24sDQogICAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZQ0KICAgICAgfSk7DQogICAgICBjdXJyZW50VGhyZXNob2xkID0gTWF0aC5taW4oX3Njb3JlLCBjdXJyZW50VGhyZXNob2xkKTsNCiAgICB9DQogIH0NCg0KICAvLyBSZXNldCB0aGUgYmVzdCBsb2NhdGlvbg0KICBiZXN0TG9jYXRpb24gPSAtMTsNCg0KICB2YXIgbGFzdEJpdEFyciA9IFtdOw0KICB2YXIgZmluYWxTY29yZSA9IDE7DQogIHZhciBiaW5NYXggPSBwYXR0ZXJuTGVuICsgdGV4dExlbjsNCg0KICB2YXIgbWFzayA9IDEgPDwgcGF0dGVybkxlbiAtIDE7DQoNCiAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IHBhdHRlcm5MZW47IF9pICs9IDEpIHsNCiAgICAvLyBTY2FuIGZvciB0aGUgYmVzdCBtYXRjaDsgZWFjaCBpdGVyYXRpb24gYWxsb3dzIGZvciBvbmUgbW9yZSBlcnJvci4NCiAgICAvLyBSdW4gYSBiaW5hcnkgc2VhcmNoIHRvIGRldGVybWluZSBob3cgZmFyIGZyb20gdGhlIG1hdGNoIGxvY2F0aW9uIHdlIGNhbiBzdHJheQ0KICAgIC8vIGF0IHRoaXMgZXJyb3IgbGV2ZWwuDQogICAgdmFyIGJpbk1pbiA9IDA7DQogICAgdmFyIGJpbk1pZCA9IGJpbk1heDsNCg0KICAgIHdoaWxlIChiaW5NaW4gPCBiaW5NaWQpIHsNCiAgICAgIHZhciBfc2NvcmUzID0gYml0YXBTY29yZShwYXR0ZXJuLCB7DQogICAgICAgIGVycm9yczogX2ksDQogICAgICAgIGN1cnJlbnRMb2NhdGlvbjogZXhwZWN0ZWRMb2NhdGlvbiArIGJpbk1pZCwNCiAgICAgICAgZXhwZWN0ZWRMb2NhdGlvbjogZXhwZWN0ZWRMb2NhdGlvbiwNCiAgICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlDQogICAgICB9KTsNCg0KICAgICAgaWYgKF9zY29yZTMgPD0gY3VycmVudFRocmVzaG9sZCkgew0KICAgICAgICBiaW5NaW4gPSBiaW5NaWQ7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBiaW5NYXggPSBiaW5NaWQ7DQogICAgICB9DQoNCiAgICAgIGJpbk1pZCA9IE1hdGguZmxvb3IoKGJpbk1heCAtIGJpbk1pbikgLyAyICsgYmluTWluKTsNCiAgICB9DQoNCiAgICAvLyBVc2UgdGhlIHJlc3VsdCBmcm9tIHRoaXMgaXRlcmF0aW9uIGFzIHRoZSBtYXhpbXVtIGZvciB0aGUgbmV4dC4NCiAgICBiaW5NYXggPSBiaW5NaWQ7DQoNCiAgICB2YXIgc3RhcnQgPSBNYXRoLm1heCgxLCBleHBlY3RlZExvY2F0aW9uIC0gYmluTWlkICsgMSk7DQogICAgdmFyIGZpbmlzaCA9IGZpbmRBbGxNYXRjaGVzID8gdGV4dExlbiA6IE1hdGgubWluKGV4cGVjdGVkTG9jYXRpb24gKyBiaW5NaWQsIHRleHRMZW4pICsgcGF0dGVybkxlbjsNCg0KICAgIC8vIEluaXRpYWxpemUgdGhlIGJpdCBhcnJheQ0KICAgIHZhciBiaXRBcnIgPSBBcnJheShmaW5pc2ggKyAyKTsNCg0KICAgIGJpdEFycltmaW5pc2ggKyAxXSA9ICgxIDw8IF9pKSAtIDE7DQoNCiAgICBmb3IgKHZhciBqID0gZmluaXNoOyBqID49IHN0YXJ0OyBqIC09IDEpIHsNCiAgICAgIHZhciBjdXJyZW50TG9jYXRpb24gPSBqIC0gMTsNCiAgICAgIHZhciBjaGFyTWF0Y2ggPSBwYXR0ZXJuQWxwaGFiZXRbdGV4dC5jaGFyQXQoY3VycmVudExvY2F0aW9uKV07DQoNCiAgICAgIGlmIChjaGFyTWF0Y2gpIHsNCiAgICAgICAgbWF0Y2hNYXNrW2N1cnJlbnRMb2NhdGlvbl0gPSAxOw0KICAgICAgfQ0KDQogICAgICAvLyBGaXJzdCBwYXNzOiBleGFjdCBtYXRjaA0KICAgICAgYml0QXJyW2pdID0gKGJpdEFycltqICsgMV0gPDwgMSB8IDEpICYgY2hhck1hdGNoOw0KDQogICAgICAvLyBTdWJzZXF1ZW50IHBhc3NlczogZnV6enkgbWF0Y2gNCiAgICAgIGlmIChfaSAhPT0gMCkgew0KICAgICAgICBiaXRBcnJbal0gfD0gKGxhc3RCaXRBcnJbaiArIDFdIHwgbGFzdEJpdEFycltqXSkgPDwgMSB8IDEgfCBsYXN0Qml0QXJyW2ogKyAxXTsNCiAgICAgIH0NCg0KICAgICAgaWYgKGJpdEFycltqXSAmIG1hc2spIHsNCiAgICAgICAgZmluYWxTY29yZSA9IGJpdGFwU2NvcmUocGF0dGVybiwgew0KICAgICAgICAgIGVycm9yczogX2ksDQogICAgICAgICAgY3VycmVudExvY2F0aW9uOiBjdXJyZW50TG9jYXRpb24sDQogICAgICAgICAgZXhwZWN0ZWRMb2NhdGlvbjogZXhwZWN0ZWRMb2NhdGlvbiwNCiAgICAgICAgICBkaXN0YW5jZTogZGlzdGFuY2UNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gVGhpcyBtYXRjaCB3aWxsIGFsbW9zdCBjZXJ0YWlubHkgYmUgYmV0dGVyIHRoYW4gYW55IGV4aXN0aW5nIG1hdGNoLg0KICAgICAgICAvLyBCdXQgY2hlY2sgYW55d2F5Lg0KICAgICAgICBpZiAoZmluYWxTY29yZSA8PSBjdXJyZW50VGhyZXNob2xkKSB7DQogICAgICAgICAgLy8gSW5kZWVkIGl0IGlzDQogICAgICAgICAgY3VycmVudFRocmVzaG9sZCA9IGZpbmFsU2NvcmU7DQogICAgICAgICAgYmVzdExvY2F0aW9uID0gY3VycmVudExvY2F0aW9uOw0KDQogICAgICAgICAgLy8gQWxyZWFkeSBwYXNzZWQgYGxvY2AsIGRvd25oaWxsIGZyb20gaGVyZSBvbiBpbi4NCiAgICAgICAgICBpZiAoYmVzdExvY2F0aW9uIDw9IGV4cGVjdGVkTG9jYXRpb24pIHsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIFdoZW4gcGFzc2luZyBgYmVzdExvY2F0aW9uYCwgZG9uJ3QgZXhjZWVkIG91ciBjdXJyZW50IGRpc3RhbmNlIGZyb20gYGV4cGVjdGVkTG9jYXRpb25gLg0KICAgICAgICAgIHN0YXJ0ID0gTWF0aC5tYXgoMSwgMiAqIGV4cGVjdGVkTG9jYXRpb24gLSBiZXN0TG9jYXRpb24pOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KDQogICAgLy8gTm8gaG9wZSBmb3IgYSAoYmV0dGVyKSBtYXRjaCBhdCBncmVhdGVyIGVycm9yIGxldmVscy4NCiAgICB2YXIgX3Njb3JlMiA9IGJpdGFwU2NvcmUocGF0dGVybiwgew0KICAgICAgZXJyb3JzOiBfaSArIDEsDQogICAgICBjdXJyZW50TG9jYXRpb246IGV4cGVjdGVkTG9jYXRpb24sDQogICAgICBleHBlY3RlZExvY2F0aW9uOiBleHBlY3RlZExvY2F0aW9uLA0KICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlDQogICAgfSk7DQoNCiAgICBpZiAoX3Njb3JlMiA+IGN1cnJlbnRUaHJlc2hvbGQpIHsNCiAgICAgIGJyZWFrOw0KICAgIH0NCg0KICAgIGxhc3RCaXRBcnIgPSBiaXRBcnI7DQogIH0NCg0KICAvLyBDb3VudCBleGFjdCBtYXRjaGVzICh0aG9zZSB3aXRoIGEgc2NvcmUgb2YgMCkgdG8gYmUgImFsbW9zdCIgZXhhY3QNCiAgcmV0dXJuIHsNCiAgICBpc01hdGNoOiBiZXN0TG9jYXRpb24gPj0gMCwNCiAgICBzY29yZTogZmluYWxTY29yZSA9PT0gMCA/IDAuMDAxIDogZmluYWxTY29yZSwNCiAgICBtYXRjaGVkSW5kaWNlczogbWF0Y2hlZEluZGljZXMobWF0Y2hNYXNrLCBtaW5NYXRjaENoYXJMZW5ndGgpDQogIH07DQp9Ow0KDQovKioqLyB9KSwNCi8qIDggKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOw0KDQpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0NCg0KdmFyIEJpdGFwID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsNCnZhciBkZWVwVmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOw0KdmFyIGlzQXJyYXkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApOw0KDQp2YXIgRnVzZSA9IGZ1bmN0aW9uICgpIHsNCiAgZnVuY3Rpb24gRnVzZShsaXN0LCBfcmVmKSB7DQogICAgdmFyIF9yZWYkbG9jYXRpb24gPSBfcmVmLmxvY2F0aW9uLA0KICAgICAgICBsb2NhdGlvbiA9IF9yZWYkbG9jYXRpb24gPT09IHVuZGVmaW5lZCA/IDAgOiBfcmVmJGxvY2F0aW9uLA0KICAgICAgICBfcmVmJGRpc3RhbmNlID0gX3JlZi5kaXN0YW5jZSwNCiAgICAgICAgZGlzdGFuY2UgPSBfcmVmJGRpc3RhbmNlID09PSB1bmRlZmluZWQgPyAxMDAgOiBfcmVmJGRpc3RhbmNlLA0KICAgICAgICBfcmVmJHRocmVzaG9sZCA9IF9yZWYudGhyZXNob2xkLA0KICAgICAgICB0aHJlc2hvbGQgPSBfcmVmJHRocmVzaG9sZCA9PT0gdW5kZWZpbmVkID8gMC42IDogX3JlZiR0aHJlc2hvbGQsDQogICAgICAgIF9yZWYkbWF4UGF0dGVybkxlbmd0aCA9IF9yZWYubWF4UGF0dGVybkxlbmd0aCwNCiAgICAgICAgbWF4UGF0dGVybkxlbmd0aCA9IF9yZWYkbWF4UGF0dGVybkxlbmd0aCA9PT0gdW5kZWZpbmVkID8gMzIgOiBfcmVmJG1heFBhdHRlcm5MZW5ndGgsDQogICAgICAgIF9yZWYkY2FzZVNlbnNpdGl2ZSA9IF9yZWYuY2FzZVNlbnNpdGl2ZSwNCiAgICAgICAgY2FzZVNlbnNpdGl2ZSA9IF9yZWYkY2FzZVNlbnNpdGl2ZSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmJGNhc2VTZW5zaXRpdmUsDQogICAgICAgIF9yZWYkdG9rZW5TZXBhcmF0b3IgPSBfcmVmLnRva2VuU2VwYXJhdG9yLA0KICAgICAgICB0b2tlblNlcGFyYXRvciA9IF9yZWYkdG9rZW5TZXBhcmF0b3IgPT09IHVuZGVmaW5lZCA/IC8gKy9nIDogX3JlZiR0b2tlblNlcGFyYXRvciwNCiAgICAgICAgX3JlZiRmaW5kQWxsTWF0Y2hlcyA9IF9yZWYuZmluZEFsbE1hdGNoZXMsDQogICAgICAgIGZpbmRBbGxNYXRjaGVzID0gX3JlZiRmaW5kQWxsTWF0Y2hlcyA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmJGZpbmRBbGxNYXRjaGVzLA0KICAgICAgICBfcmVmJG1pbk1hdGNoQ2hhckxlbmcgPSBfcmVmLm1pbk1hdGNoQ2hhckxlbmd0aCwNCiAgICAgICAgbWluTWF0Y2hDaGFyTGVuZ3RoID0gX3JlZiRtaW5NYXRjaENoYXJMZW5nID09PSB1bmRlZmluZWQgPyAxIDogX3JlZiRtaW5NYXRjaENoYXJMZW5nLA0KICAgICAgICBfcmVmJGlkID0gX3JlZi5pZCwNCiAgICAgICAgaWQgPSBfcmVmJGlkID09PSB1bmRlZmluZWQgPyBudWxsIDogX3JlZiRpZCwNCiAgICAgICAgX3JlZiRrZXlzID0gX3JlZi5rZXlzLA0KICAgICAgICBrZXlzID0gX3JlZiRrZXlzID09PSB1bmRlZmluZWQgPyBbXSA6IF9yZWYka2V5cywNCiAgICAgICAgX3JlZiRzaG91bGRTb3J0ID0gX3JlZi5zaG91bGRTb3J0LA0KICAgICAgICBzaG91bGRTb3J0ID0gX3JlZiRzaG91bGRTb3J0ID09PSB1bmRlZmluZWQgPyB0cnVlIDogX3JlZiRzaG91bGRTb3J0LA0KICAgICAgICBfcmVmJGdldEZuID0gX3JlZi5nZXRGbiwNCiAgICAgICAgZ2V0Rm4gPSBfcmVmJGdldEZuID09PSB1bmRlZmluZWQgPyBkZWVwVmFsdWUgOiBfcmVmJGdldEZuLA0KICAgICAgICBfcmVmJHNvcnRGbiA9IF9yZWYuc29ydEZuLA0KICAgICAgICBzb3J0Rm4gPSBfcmVmJHNvcnRGbiA9PT0gdW5kZWZpbmVkID8gZnVuY3Rpb24gKGEsIGIpIHsNCiAgICAgIHJldHVybiBhLnNjb3JlIC0gYi5zY29yZTsNCiAgICB9IDogX3JlZiRzb3J0Rm4sDQogICAgICAgIF9yZWYkdG9rZW5pemUgPSBfcmVmLnRva2VuaXplLA0KICAgICAgICB0b2tlbml6ZSA9IF9yZWYkdG9rZW5pemUgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiR0b2tlbml6ZSwNCiAgICAgICAgX3JlZiRtYXRjaEFsbFRva2VucyA9IF9yZWYubWF0Y2hBbGxUb2tlbnMsDQogICAgICAgIG1hdGNoQWxsVG9rZW5zID0gX3JlZiRtYXRjaEFsbFRva2VucyA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmJG1hdGNoQWxsVG9rZW5zLA0KICAgICAgICBfcmVmJGluY2x1ZGVNYXRjaGVzID0gX3JlZi5pbmNsdWRlTWF0Y2hlcywNCiAgICAgICAgaW5jbHVkZU1hdGNoZXMgPSBfcmVmJGluY2x1ZGVNYXRjaGVzID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkaW5jbHVkZU1hdGNoZXMsDQogICAgICAgIF9yZWYkaW5jbHVkZVNjb3JlID0gX3JlZi5pbmNsdWRlU2NvcmUsDQogICAgICAgIGluY2x1ZGVTY29yZSA9IF9yZWYkaW5jbHVkZVNjb3JlID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkaW5jbHVkZVNjb3JlLA0KICAgICAgICBfcmVmJHZlcmJvc2UgPSBfcmVmLnZlcmJvc2UsDQogICAgICAgIHZlcmJvc2UgPSBfcmVmJHZlcmJvc2UgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiR2ZXJib3NlOw0KDQogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEZ1c2UpOw0KDQogICAgdGhpcy5vcHRpb25zID0gew0KICAgICAgbG9jYXRpb246IGxvY2F0aW9uLA0KICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlLA0KICAgICAgdGhyZXNob2xkOiB0aHJlc2hvbGQsDQogICAgICBtYXhQYXR0ZXJuTGVuZ3RoOiBtYXhQYXR0ZXJuTGVuZ3RoLA0KICAgICAgaXNDYXNlU2Vuc2l0aXZlOiBjYXNlU2Vuc2l0aXZlLA0KICAgICAgdG9rZW5TZXBhcmF0b3I6IHRva2VuU2VwYXJhdG9yLA0KICAgICAgZmluZEFsbE1hdGNoZXM6IGZpbmRBbGxNYXRjaGVzLA0KICAgICAgbWluTWF0Y2hDaGFyTGVuZ3RoOiBtaW5NYXRjaENoYXJMZW5ndGgsDQogICAgICBpZDogaWQsDQogICAgICBrZXlzOiBrZXlzLA0KICAgICAgaW5jbHVkZU1hdGNoZXM6IGluY2x1ZGVNYXRjaGVzLA0KICAgICAgaW5jbHVkZVNjb3JlOiBpbmNsdWRlU2NvcmUsDQogICAgICBzaG91bGRTb3J0OiBzaG91bGRTb3J0LA0KICAgICAgZ2V0Rm46IGdldEZuLA0KICAgICAgc29ydEZuOiBzb3J0Rm4sDQogICAgICB2ZXJib3NlOiB2ZXJib3NlLA0KICAgICAgdG9rZW5pemU6IHRva2VuaXplLA0KICAgICAgbWF0Y2hBbGxUb2tlbnM6IG1hdGNoQWxsVG9rZW5zDQogICAgfTsNCg0KICAgIHRoaXMuc2V0Q29sbGVjdGlvbihsaXN0KTsNCiAgfQ0KDQogIF9jcmVhdGVDbGFzcyhGdXNlLCBbew0KICAgIGtleTogJ3NldENvbGxlY3Rpb24nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDb2xsZWN0aW9uKGxpc3QpIHsNCiAgICAgIHRoaXMubGlzdCA9IGxpc3Q7DQogICAgICByZXR1cm4gbGlzdDsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdzZWFyY2gnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzZWFyY2gocGF0dGVybikgew0KICAgICAgdGhpcy5fbG9nKCctLS0tLS0tLS1cblNlYXJjaCBwYXR0ZXJuOiAiJyArIHBhdHRlcm4gKyAnIicpOw0KDQogICAgICB2YXIgX3ByZXBhcmVTZWFyY2hlcnMyID0gdGhpcy5fcHJlcGFyZVNlYXJjaGVycyhwYXR0ZXJuKSwNCiAgICAgICAgICB0b2tlblNlYXJjaGVycyA9IF9wcmVwYXJlU2VhcmNoZXJzMi50b2tlblNlYXJjaGVycywNCiAgICAgICAgICBmdWxsU2VhcmNoZXIgPSBfcHJlcGFyZVNlYXJjaGVyczIuZnVsbFNlYXJjaGVyOw0KDQogICAgICB2YXIgX3NlYXJjaDIgPSB0aGlzLl9zZWFyY2godG9rZW5TZWFyY2hlcnMsIGZ1bGxTZWFyY2hlciksDQogICAgICAgICAgd2VpZ2h0cyA9IF9zZWFyY2gyLndlaWdodHMsDQogICAgICAgICAgcmVzdWx0cyA9IF9zZWFyY2gyLnJlc3VsdHM7DQoNCiAgICAgIHRoaXMuX2NvbXB1dGVTY29yZSh3ZWlnaHRzLCByZXN1bHRzKTsNCg0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5zaG91bGRTb3J0KSB7DQogICAgICAgIHRoaXMuX3NvcnQocmVzdWx0cyk7DQogICAgICB9DQoNCiAgICAgIHJldHVybiB0aGlzLl9mb3JtYXQocmVzdWx0cyk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX3ByZXBhcmVTZWFyY2hlcnMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfcHJlcGFyZVNlYXJjaGVycygpIHsNCiAgICAgIHZhciBwYXR0ZXJuID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAnJzsNCg0KICAgICAgdmFyIHRva2VuU2VhcmNoZXJzID0gW107DQoNCiAgICAgIGlmICh0aGlzLm9wdGlvbnMudG9rZW5pemUpIHsNCiAgICAgICAgLy8gVG9rZW5pemUgb24gdGhlIHNlcGFyYXRvcg0KICAgICAgICB2YXIgdG9rZW5zID0gcGF0dGVybi5zcGxpdCh0aGlzLm9wdGlvbnMudG9rZW5TZXBhcmF0b3IpOw0KICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdG9rZW5zLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAxKSB7DQogICAgICAgICAgdG9rZW5TZWFyY2hlcnMucHVzaChuZXcgQml0YXAodG9rZW5zW2ldLCB0aGlzLm9wdGlvbnMpKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICB2YXIgZnVsbFNlYXJjaGVyID0gbmV3IEJpdGFwKHBhdHRlcm4sIHRoaXMub3B0aW9ucyk7DQoNCiAgICAgIHJldHVybiB7IHRva2VuU2VhcmNoZXJzOiB0b2tlblNlYXJjaGVycywgZnVsbFNlYXJjaGVyOiBmdWxsU2VhcmNoZXIgfTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfc2VhcmNoJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NlYXJjaCgpIHsNCiAgICAgIHZhciB0b2tlblNlYXJjaGVycyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107DQogICAgICB2YXIgZnVsbFNlYXJjaGVyID0gYXJndW1lbnRzWzFdOw0KDQogICAgICB2YXIgbGlzdCA9IHRoaXMubGlzdDsNCiAgICAgIHZhciByZXN1bHRNYXAgPSB7fTsNCiAgICAgIHZhciByZXN1bHRzID0gW107DQoNCiAgICAgIC8vIENoZWNrIHRoZSBmaXJzdCBpdGVtIGluIHRoZSBsaXN0LCBpZiBpdCdzIGEgc3RyaW5nLCB0aGVuIHdlIGFzc3VtZQ0KICAgICAgLy8gdGhhdCBldmVyeSBpdGVtIGluIHRoZSBsaXN0IGlzIGFsc28gYSBzdHJpbmcsIGFuZCB0aHVzIGl0J3MgYSBmbGF0dGVuZWQgYXJyYXkuDQogICAgICBpZiAodHlwZW9mIGxpc3RbMF0gPT09ICdzdHJpbmcnKSB7DQogICAgICAgIC8vIEl0ZXJhdGUgb3ZlciBldmVyeSBpdGVtDQogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBsaXN0Lmxlbmd0aDsgaSA8IGxlbjsgaSArPSAxKSB7DQogICAgICAgICAgdGhpcy5fYW5hbHl6ZSh7DQogICAgICAgICAgICBrZXk6ICcnLA0KICAgICAgICAgICAgdmFsdWU6IGxpc3RbaV0sDQogICAgICAgICAgICByZWNvcmQ6IGksDQogICAgICAgICAgICBpbmRleDogaQ0KICAgICAgICAgIH0sIHsNCiAgICAgICAgICAgIHJlc3VsdE1hcDogcmVzdWx0TWFwLA0KICAgICAgICAgICAgcmVzdWx0czogcmVzdWx0cywNCiAgICAgICAgICAgIHRva2VuU2VhcmNoZXJzOiB0b2tlblNlYXJjaGVycywNCiAgICAgICAgICAgIGZ1bGxTZWFyY2hlcjogZnVsbFNlYXJjaGVyDQogICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4geyB3ZWlnaHRzOiBudWxsLCByZXN1bHRzOiByZXN1bHRzIH07DQogICAgICB9DQoNCiAgICAgIC8vIE90aGVyd2lzZSwgdGhlIGZpcnN0IGl0ZW0gaXMgYW4gT2JqZWN0IChob3BlZnVsbHkpLCBhbmQgdGh1cyB0aGUgc2VhcmNoaW5nDQogICAgICAvLyBpcyBkb25lIG9uIHRoZSB2YWx1ZXMgb2YgdGhlIGtleXMgb2YgZWFjaCBpdGVtLg0KICAgICAgdmFyIHdlaWdodHMgPSB7fTsNCiAgICAgIGZvciAodmFyIF9pID0gMCwgX2xlbiA9IGxpc3QubGVuZ3RoOyBfaSA8IF9sZW47IF9pICs9IDEpIHsNCiAgICAgICAgdmFyIGl0ZW0gPSBsaXN0W19pXTsNCiAgICAgICAgLy8gSXRlcmF0ZSBvdmVyIGV2ZXJ5IGtleQ0KICAgICAgICBmb3IgKHZhciBqID0gMCwga2V5c0xlbiA9IHRoaXMub3B0aW9ucy5rZXlzLmxlbmd0aDsgaiA8IGtleXNMZW47IGogKz0gMSkgew0KICAgICAgICAgIHZhciBrZXkgPSB0aGlzLm9wdGlvbnMua2V5c1tqXTsNCiAgICAgICAgICBpZiAodHlwZW9mIGtleSAhPT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgIHdlaWdodHNba2V5Lm5hbWVdID0gew0KICAgICAgICAgICAgICB3ZWlnaHQ6IDEgLSBrZXkud2VpZ2h0IHx8IDENCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBpZiAoa2V5LndlaWdodCA8PSAwIHx8IGtleS53ZWlnaHQgPiAxKSB7DQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignS2V5IHdlaWdodCBoYXMgdG8gYmUgPiAwIGFuZCA8PSAxJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBrZXkgPSBrZXkubmFtZTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgd2VpZ2h0c1trZXldID0gew0KICAgICAgICAgICAgICB3ZWlnaHQ6IDENCiAgICAgICAgICAgIH07DQogICAgICAgICAgfQ0KDQogICAgICAgICAgdGhpcy5fYW5hbHl6ZSh7DQogICAgICAgICAgICBrZXk6IGtleSwNCiAgICAgICAgICAgIHZhbHVlOiB0aGlzLm9wdGlvbnMuZ2V0Rm4oaXRlbSwga2V5KSwNCiAgICAgICAgICAgIHJlY29yZDogaXRlbSwNCiAgICAgICAgICAgIGluZGV4OiBfaQ0KICAgICAgICAgIH0sIHsNCiAgICAgICAgICAgIHJlc3VsdE1hcDogcmVzdWx0TWFwLA0KICAgICAgICAgICAgcmVzdWx0czogcmVzdWx0cywNCiAgICAgICAgICAgIHRva2VuU2VhcmNoZXJzOiB0b2tlblNlYXJjaGVycywNCiAgICAgICAgICAgIGZ1bGxTZWFyY2hlcjogZnVsbFNlYXJjaGVyDQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHsgd2VpZ2h0czogd2VpZ2h0cywgcmVzdWx0czogcmVzdWx0cyB9Ow0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19hbmFseXplJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FuYWx5emUoX3JlZjIsIF9yZWYzKSB7DQogICAgICB2YXIga2V5ID0gX3JlZjIua2V5LA0KICAgICAgICAgIF9yZWYyJGFycmF5SW5kZXggPSBfcmVmMi5hcnJheUluZGV4LA0KICAgICAgICAgIGFycmF5SW5kZXggPSBfcmVmMiRhcnJheUluZGV4ID09PSB1bmRlZmluZWQgPyAtMSA6IF9yZWYyJGFycmF5SW5kZXgsDQogICAgICAgICAgdmFsdWUgPSBfcmVmMi52YWx1ZSwNCiAgICAgICAgICByZWNvcmQgPSBfcmVmMi5yZWNvcmQsDQogICAgICAgICAgaW5kZXggPSBfcmVmMi5pbmRleDsNCiAgICAgIHZhciBfcmVmMyR0b2tlblNlYXJjaGVycyA9IF9yZWYzLnRva2VuU2VhcmNoZXJzLA0KICAgICAgICAgIHRva2VuU2VhcmNoZXJzID0gX3JlZjMkdG9rZW5TZWFyY2hlcnMgPT09IHVuZGVmaW5lZCA/IFtdIDogX3JlZjMkdG9rZW5TZWFyY2hlcnMsDQogICAgICAgICAgX3JlZjMkZnVsbFNlYXJjaGVyID0gX3JlZjMuZnVsbFNlYXJjaGVyLA0KICAgICAgICAgIGZ1bGxTZWFyY2hlciA9IF9yZWYzJGZ1bGxTZWFyY2hlciA9PT0gdW5kZWZpbmVkID8gW10gOiBfcmVmMyRmdWxsU2VhcmNoZXIsDQogICAgICAgICAgX3JlZjMkcmVzdWx0TWFwID0gX3JlZjMucmVzdWx0TWFwLA0KICAgICAgICAgIHJlc3VsdE1hcCA9IF9yZWYzJHJlc3VsdE1hcCA9PT0gdW5kZWZpbmVkID8ge30gOiBfcmVmMyRyZXN1bHRNYXAsDQogICAgICAgICAgX3JlZjMkcmVzdWx0cyA9IF9yZWYzLnJlc3VsdHMsDQogICAgICAgICAgcmVzdWx0cyA9IF9yZWYzJHJlc3VsdHMgPT09IHVuZGVmaW5lZCA/IFtdIDogX3JlZjMkcmVzdWx0czsNCg0KICAgICAgLy8gQ2hlY2sgaWYgdGhlIHRleHZhbHVldCBjYW4gYmUgc2VhcmNoZWQNCiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdmFyIGV4aXN0cyA9IGZhbHNlOw0KICAgICAgdmFyIGF2ZXJhZ2VTY29yZSA9IC0xOw0KICAgICAgdmFyIG51bVRleHRNYXRjaGVzID0gMDsNCg0KICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgdGhpcy5fbG9nKCdcbktleTogJyArIChrZXkgPT09ICcnID8gJy0nIDoga2V5KSk7DQoNCiAgICAgICAgdmFyIG1haW5TZWFyY2hSZXN1bHQgPSBmdWxsU2VhcmNoZXIuc2VhcmNoKHZhbHVlKTsNCiAgICAgICAgdGhpcy5fbG9nKCdGdWxsIHRleHQ6ICInICsgdmFsdWUgKyAnIiwgc2NvcmU6ICcgKyBtYWluU2VhcmNoUmVzdWx0LnNjb3JlKTsNCg0KICAgICAgICBpZiAodGhpcy5vcHRpb25zLnRva2VuaXplKSB7DQogICAgICAgICAgdmFyIHdvcmRzID0gdmFsdWUuc3BsaXQodGhpcy5vcHRpb25zLnRva2VuU2VwYXJhdG9yKTsNCiAgICAgICAgICB2YXIgc2NvcmVzID0gW107DQoNCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRva2VuU2VhcmNoZXJzLmxlbmd0aDsgaSArPSAxKSB7DQogICAgICAgICAgICB2YXIgdG9rZW5TZWFyY2hlciA9IHRva2VuU2VhcmNoZXJzW2ldOw0KDQogICAgICAgICAgICB0aGlzLl9sb2coJ1xuUGF0dGVybjogIicgKyB0b2tlblNlYXJjaGVyLnBhdHRlcm4gKyAnIicpOw0KDQogICAgICAgICAgICAvLyBsZXQgdG9rZW5TY29yZXMgPSBbXQ0KICAgICAgICAgICAgdmFyIGhhc01hdGNoSW5UZXh0ID0gZmFsc2U7DQoNCiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgd29yZHMubGVuZ3RoOyBqICs9IDEpIHsNCiAgICAgICAgICAgICAgdmFyIHdvcmQgPSB3b3Jkc1tqXTsNCiAgICAgICAgICAgICAgdmFyIHRva2VuU2VhcmNoUmVzdWx0ID0gdG9rZW5TZWFyY2hlci5zZWFyY2god29yZCk7DQogICAgICAgICAgICAgIHZhciBvYmogPSB7fTsNCiAgICAgICAgICAgICAgaWYgKHRva2VuU2VhcmNoUmVzdWx0LmlzTWF0Y2gpIHsNCiAgICAgICAgICAgICAgICBvYmpbd29yZF0gPSB0b2tlblNlYXJjaFJlc3VsdC5zY29yZTsNCiAgICAgICAgICAgICAgICBleGlzdHMgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGhhc01hdGNoSW5UZXh0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBzY29yZXMucHVzaCh0b2tlblNlYXJjaFJlc3VsdC5zY29yZSk7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgb2JqW3dvcmRdID0gMTsNCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5tYXRjaEFsbFRva2Vucykgew0KICAgICAgICAgICAgICAgICAgc2NvcmVzLnB1c2goMSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHRoaXMuX2xvZygnVG9rZW46ICInICsgd29yZCArICciLCBzY29yZTogJyArIG9ialt3b3JkXSk7DQogICAgICAgICAgICAgIC8vIHRva2VuU2NvcmVzLnB1c2gob2JqKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoaGFzTWF0Y2hJblRleHQpIHsNCiAgICAgICAgICAgICAgbnVtVGV4dE1hdGNoZXMgKz0gMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgICBhdmVyYWdlU2NvcmUgPSBzY29yZXNbMF07DQogICAgICAgICAgdmFyIHNjb3Jlc0xlbiA9IHNjb3Jlcy5sZW5ndGg7DQogICAgICAgICAgZm9yICh2YXIgX2kyID0gMTsgX2kyIDwgc2NvcmVzTGVuOyBfaTIgKz0gMSkgew0KICAgICAgICAgICAgYXZlcmFnZVNjb3JlICs9IHNjb3Jlc1tfaTJdOw0KICAgICAgICAgIH0NCiAgICAgICAgICBhdmVyYWdlU2NvcmUgPSBhdmVyYWdlU2NvcmUgLyBzY29yZXNMZW47DQoNCiAgICAgICAgICB0aGlzLl9sb2coJ1Rva2VuIHNjb3JlIGF2ZXJhZ2U6JywgYXZlcmFnZVNjb3JlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBmaW5hbFNjb3JlID0gbWFpblNlYXJjaFJlc3VsdC5zY29yZTsNCiAgICAgICAgaWYgKGF2ZXJhZ2VTY29yZSA+IC0xKSB7DQogICAgICAgICAgZmluYWxTY29yZSA9IChmaW5hbFNjb3JlICsgYXZlcmFnZVNjb3JlKSAvIDI7DQogICAgICAgIH0NCg0KICAgICAgICB0aGlzLl9sb2coJ1Njb3JlIGF2ZXJhZ2U6JywgZmluYWxTY29yZSk7DQoNCiAgICAgICAgdmFyIGNoZWNrVGV4dE1hdGNoZXMgPSB0aGlzLm9wdGlvbnMudG9rZW5pemUgJiYgdGhpcy5vcHRpb25zLm1hdGNoQWxsVG9rZW5zID8gbnVtVGV4dE1hdGNoZXMgPj0gdG9rZW5TZWFyY2hlcnMubGVuZ3RoIDogdHJ1ZTsNCg0KICAgICAgICB0aGlzLl9sb2coJ1xuQ2hlY2sgTWF0Y2hlczogJyArIGNoZWNrVGV4dE1hdGNoZXMpOw0KDQogICAgICAgIC8vIElmIGEgbWF0Y2ggaXMgZm91bmQsIGFkZCB0aGUgaXRlbSB0byA8cmF3UmVzdWx0cz4sIGluY2x1ZGluZyBpdHMgc2NvcmUNCiAgICAgICAgaWYgKChleGlzdHMgfHwgbWFpblNlYXJjaFJlc3VsdC5pc01hdGNoKSAmJiBjaGVja1RleHRNYXRjaGVzKSB7DQogICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGl0ZW0gYWxyZWFkeSBleGlzdHMgaW4gb3VyIHJlc3VsdHMNCiAgICAgICAgICB2YXIgZXhpc3RpbmdSZXN1bHQgPSByZXN1bHRNYXBbaW5kZXhdOw0KICAgICAgICAgIGlmIChleGlzdGluZ1Jlc3VsdCkgew0KICAgICAgICAgICAgLy8gVXNlIHRoZSBsb3dlc3Qgc2NvcmUNCiAgICAgICAgICAgIC8vIGV4aXN0aW5nUmVzdWx0LnNjb3JlLCBiaXRhcFJlc3VsdC5zY29yZQ0KICAgICAgICAgICAgZXhpc3RpbmdSZXN1bHQub3V0cHV0LnB1c2goew0KICAgICAgICAgICAgICBrZXk6IGtleSwNCiAgICAgICAgICAgICAgYXJyYXlJbmRleDogYXJyYXlJbmRleCwNCiAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgICAgICBzY29yZTogZmluYWxTY29yZSwNCiAgICAgICAgICAgICAgbWF0Y2hlZEluZGljZXM6IG1haW5TZWFyY2hSZXN1bHQubWF0Y2hlZEluZGljZXMNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBBZGQgaXQgdG8gdGhlIHJhdyByZXN1bHQgbGlzdA0KICAgICAgICAgICAgcmVzdWx0TWFwW2luZGV4XSA9IHsNCiAgICAgICAgICAgICAgaXRlbTogcmVjb3JkLA0KICAgICAgICAgICAgICBvdXRwdXQ6IFt7DQogICAgICAgICAgICAgICAga2V5OiBrZXksDQogICAgICAgICAgICAgICAgYXJyYXlJbmRleDogYXJyYXlJbmRleCwNCiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsDQogICAgICAgICAgICAgICAgc2NvcmU6IGZpbmFsU2NvcmUsDQogICAgICAgICAgICAgICAgbWF0Y2hlZEluZGljZXM6IG1haW5TZWFyY2hSZXN1bHQubWF0Y2hlZEluZGljZXMNCiAgICAgICAgICAgICAgfV0NCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIHJlc3VsdHMucHVzaChyZXN1bHRNYXBbaW5kZXhdKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAoaXNBcnJheSh2YWx1ZSkpIHsNCiAgICAgICAgZm9yICh2YXIgX2kzID0gMCwgbGVuID0gdmFsdWUubGVuZ3RoOyBfaTMgPCBsZW47IF9pMyArPSAxKSB7DQogICAgICAgICAgdGhpcy5fYW5hbHl6ZSh7DQogICAgICAgICAgICBrZXk6IGtleSwNCiAgICAgICAgICAgIGFycmF5SW5kZXg6IF9pMywNCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVtfaTNdLA0KICAgICAgICAgICAgcmVjb3JkOiByZWNvcmQsDQogICAgICAgICAgICBpbmRleDogaW5kZXgNCiAgICAgICAgICB9LCB7DQogICAgICAgICAgICByZXN1bHRNYXA6IHJlc3VsdE1hcCwNCiAgICAgICAgICAgIHJlc3VsdHM6IHJlc3VsdHMsDQogICAgICAgICAgICB0b2tlblNlYXJjaGVyczogdG9rZW5TZWFyY2hlcnMsDQogICAgICAgICAgICBmdWxsU2VhcmNoZXI6IGZ1bGxTZWFyY2hlcg0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2NvbXB1dGVTY29yZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9jb21wdXRlU2NvcmUod2VpZ2h0cywgcmVzdWx0cykgew0KICAgICAgdGhpcy5fbG9nKCdcblxuQ29tcHV0aW5nIHNjb3JlOlxuJyk7DQoNCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSByZXN1bHRzLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAxKSB7DQogICAgICAgIHZhciBvdXRwdXQgPSByZXN1bHRzW2ldLm91dHB1dDsNCiAgICAgICAgdmFyIHNjb3JlTGVuID0gb3V0cHV0Lmxlbmd0aDsNCg0KICAgICAgICB2YXIgdG90YWxTY29yZSA9IDA7DQogICAgICAgIHZhciBiZXN0U2NvcmUgPSAxOw0KDQogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2NvcmVMZW47IGogKz0gMSkgew0KICAgICAgICAgIHZhciB3ZWlnaHQgPSB3ZWlnaHRzID8gd2VpZ2h0c1tvdXRwdXRbal0ua2V5XS53ZWlnaHQgOiAxOw0KICAgICAgICAgIHZhciBzY29yZSA9IHdlaWdodCA9PT0gMSA/IG91dHB1dFtqXS5zY29yZSA6IG91dHB1dFtqXS5zY29yZSB8fCAwLjAwMTsNCiAgICAgICAgICB2YXIgblNjb3JlID0gc2NvcmUgKiB3ZWlnaHQ7DQoNCiAgICAgICAgICBpZiAod2VpZ2h0ICE9PSAxKSB7DQogICAgICAgICAgICBiZXN0U2NvcmUgPSBNYXRoLm1pbihiZXN0U2NvcmUsIG5TY29yZSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIG91dHB1dFtqXS5uU2NvcmUgPSBuU2NvcmU7DQogICAgICAgICAgICB0b3RhbFNjb3JlICs9IG5TY29yZTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXN1bHRzW2ldLnNjb3JlID0gYmVzdFNjb3JlID09PSAxID8gdG90YWxTY29yZSAvIHNjb3JlTGVuIDogYmVzdFNjb3JlOw0KDQogICAgICAgIHRoaXMuX2xvZyhyZXN1bHRzW2ldKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfc29ydCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9zb3J0KHJlc3VsdHMpIHsNCiAgICAgIHRoaXMuX2xvZygnXG5cblNvcnRpbmcuLi4uJyk7DQogICAgICByZXN1bHRzLnNvcnQodGhpcy5vcHRpb25zLnNvcnRGbik7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2Zvcm1hdCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9mb3JtYXQocmVzdWx0cykgew0KICAgICAgdmFyIGZpbmFsT3V0cHV0ID0gW107DQoNCiAgICAgIHRoaXMuX2xvZygnXG5cbk91dHB1dDpcblxuJywgSlNPTi5zdHJpbmdpZnkocmVzdWx0cykpOw0KDQogICAgICB2YXIgdHJhbnNmb3JtZXJzID0gW107DQoNCiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5jbHVkZU1hdGNoZXMpIHsNCiAgICAgICAgdHJhbnNmb3JtZXJzLnB1c2goZnVuY3Rpb24gKHJlc3VsdCwgZGF0YSkgew0KICAgICAgICAgIHZhciBvdXRwdXQgPSByZXN1bHQub3V0cHV0Ow0KICAgICAgICAgIGRhdGEubWF0Y2hlcyA9IFtdOw0KDQogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IG91dHB1dC5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkgew0KICAgICAgICAgICAgdmFyIGl0ZW0gPSBvdXRwdXRbaV07DQoNCiAgICAgICAgICAgIGlmIChpdGVtLm1hdGNoZWRJbmRpY2VzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdmFyIG9iaiA9IHsNCiAgICAgICAgICAgICAgaW5kaWNlczogaXRlbS5tYXRjaGVkSW5kaWNlcywNCiAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0udmFsdWUNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBpZiAoaXRlbS5rZXkpIHsNCiAgICAgICAgICAgICAgb2JqLmtleSA9IGl0ZW0ua2V5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGl0ZW0uaGFzT3duUHJvcGVydHkoJ2FycmF5SW5kZXgnKSAmJiBpdGVtLmFycmF5SW5kZXggPiAtMSkgew0KICAgICAgICAgICAgICBvYmouYXJyYXlJbmRleCA9IGl0ZW0uYXJyYXlJbmRleDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRhdGEubWF0Y2hlcy5wdXNoKG9iaik7DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pbmNsdWRlU2NvcmUpIHsNCiAgICAgICAgdHJhbnNmb3JtZXJzLnB1c2goZnVuY3Rpb24gKHJlc3VsdCwgZGF0YSkgew0KICAgICAgICAgIGRhdGEuc2NvcmUgPSByZXN1bHQuc2NvcmU7DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcmVzdWx0cy5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkgew0KICAgICAgICB2YXIgcmVzdWx0ID0gcmVzdWx0c1tpXTsNCg0KICAgICAgICBpZiAodGhpcy5vcHRpb25zLmlkKSB7DQogICAgICAgICAgcmVzdWx0Lml0ZW0gPSB0aGlzLm9wdGlvbnMuZ2V0Rm4ocmVzdWx0Lml0ZW0sIHRoaXMub3B0aW9ucy5pZClbMF07DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIXRyYW5zZm9ybWVycy5sZW5ndGgpIHsNCiAgICAgICAgICBmaW5hbE91dHB1dC5wdXNoKHJlc3VsdC5pdGVtKTsNCiAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBkYXRhID0gew0KICAgICAgICAgIGl0ZW06IHJlc3VsdC5pdGVtDQogICAgICAgIH07DQoNCiAgICAgICAgZm9yICh2YXIgaiA9IDAsIF9sZW4yID0gdHJhbnNmb3JtZXJzLmxlbmd0aDsgaiA8IF9sZW4yOyBqICs9IDEpIHsNCiAgICAgICAgICB0cmFuc2Zvcm1lcnNbal0ocmVzdWx0LCBkYXRhKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZpbmFsT3V0cHV0LnB1c2goZGF0YSk7DQogICAgICB9DQoNCiAgICAgIHJldHVybiBmaW5hbE91dHB1dDsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfbG9nJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2xvZygpIHsNCiAgICAgIGlmICh0aGlzLm9wdGlvbnMudmVyYm9zZSkgew0KICAgICAgICB2YXIgX2NvbnNvbGU7DQoNCiAgICAgICAgKF9jb25zb2xlID0gY29uc29sZSkubG9nLmFwcGx5KF9jb25zb2xlLCBhcmd1bWVudHMpOw0KICAgICAgfQ0KICAgIH0NCiAgfV0pOw0KDQogIHJldHVybiBGdXNlOw0KfSgpOw0KDQptb2R1bGUuZXhwb3J0cyA9IEZ1c2U7DQoNCi8qKiovIH0pDQovKioqKioqLyBdKTsNCn0pOw0KLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZnVzZS5qcy5tYXANCg0KLyoqKi8gfSksDQovKiA0MCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQpPYmplY3QuZGVmaW5lUHJvcGVydHkoX193ZWJwYWNrX2V4cG9ydHNfXywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOw0KdmFyIGlzTWVyZ2VhYmxlT2JqZWN0ID0gZnVuY3Rpb24gaXNNZXJnZWFibGVPYmplY3QodmFsdWUpIHsNCglyZXR1cm4gaXNOb25OdWxsT2JqZWN0KHZhbHVlKQ0KCQkmJiAhaXNTcGVjaWFsKHZhbHVlKQ0KfTsNCg0KZnVuY3Rpb24gaXNOb25OdWxsT2JqZWN0KHZhbHVlKSB7DQoJcmV0dXJuICEhdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jw0KfQ0KDQpmdW5jdGlvbiBpc1NwZWNpYWwodmFsdWUpIHsNCgl2YXIgc3RyaW5nVmFsdWUgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpOw0KDQoJcmV0dXJuIHN0cmluZ1ZhbHVlID09PSAnW29iamVjdCBSZWdFeHBdJw0KCQl8fCBzdHJpbmdWYWx1ZSA9PT0gJ1tvYmplY3QgRGF0ZV0nDQoJCXx8IGlzUmVhY3RFbGVtZW50KHZhbHVlKQ0KfQ0KDQovLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlYWN0L2Jsb2IvYjVhYzk2M2ZiNzkxZDEyOThlN2YzOTYyMzYzODNiYzk1NWY5MTZjMS9zcmMvaXNvbW9ycGhpYy9jbGFzc2ljL2VsZW1lbnQvUmVhY3RFbGVtZW50LmpzI0wyMS1MMjUNCnZhciBjYW5Vc2VTeW1ib2wgPSB0eXBlb2YgU3ltYm9sID09PSAnZnVuY3Rpb24nICYmIFN5bWJvbC5mb3I7DQp2YXIgUkVBQ1RfRUxFTUVOVF9UWVBFID0gY2FuVXNlU3ltYm9sID8gU3ltYm9sLmZvcigncmVhY3QuZWxlbWVudCcpIDogMHhlYWM3Ow0KDQpmdW5jdGlvbiBpc1JlYWN0RWxlbWVudCh2YWx1ZSkgew0KCXJldHVybiB2YWx1ZS4kJHR5cGVvZiA9PT0gUkVBQ1RfRUxFTUVOVF9UWVBFDQp9DQoNCmZ1bmN0aW9uIGVtcHR5VGFyZ2V0KHZhbCkgew0KCXJldHVybiBBcnJheS5pc0FycmF5KHZhbCkgPyBbXSA6IHt9DQp9DQoNCmZ1bmN0aW9uIGNsb25lVW5sZXNzT3RoZXJ3aXNlU3BlY2lmaWVkKHZhbHVlLCBvcHRpb25zKSB7DQoJcmV0dXJuIChvcHRpb25zLmNsb25lICE9PSBmYWxzZSAmJiBvcHRpb25zLmlzTWVyZ2VhYmxlT2JqZWN0KHZhbHVlKSkNCgkJPyBkZWVwbWVyZ2UoZW1wdHlUYXJnZXQodmFsdWUpLCB2YWx1ZSwgb3B0aW9ucykNCgkJOiB2YWx1ZQ0KfQ0KDQpmdW5jdGlvbiBkZWZhdWx0QXJyYXlNZXJnZSh0YXJnZXQsIHNvdXJjZSwgb3B0aW9ucykgew0KCXJldHVybiB0YXJnZXQuY29uY2F0KHNvdXJjZSkubWFwKGZ1bmN0aW9uKGVsZW1lbnQpIHsNCgkJcmV0dXJuIGNsb25lVW5sZXNzT3RoZXJ3aXNlU3BlY2lmaWVkKGVsZW1lbnQsIG9wdGlvbnMpDQoJfSkNCn0NCg0KZnVuY3Rpb24gbWVyZ2VPYmplY3QodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpIHsNCgl2YXIgZGVzdGluYXRpb24gPSB7fTsNCglpZiAob3B0aW9ucy5pc01lcmdlYWJsZU9iamVjdCh0YXJnZXQpKSB7DQoJCU9iamVjdC5rZXlzKHRhcmdldCkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsNCgkJCWRlc3RpbmF0aW9uW2tleV0gPSBjbG9uZVVubGVzc090aGVyd2lzZVNwZWNpZmllZCh0YXJnZXRba2V5XSwgb3B0aW9ucyk7DQoJCX0pOw0KCX0NCglPYmplY3Qua2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7DQoJCWlmICghb3B0aW9ucy5pc01lcmdlYWJsZU9iamVjdChzb3VyY2Vba2V5XSkgfHwgIXRhcmdldFtrZXldKSB7DQoJCQlkZXN0aW5hdGlvbltrZXldID0gY2xvbmVVbmxlc3NPdGhlcndpc2VTcGVjaWZpZWQoc291cmNlW2tleV0sIG9wdGlvbnMpOw0KCQl9IGVsc2Ugew0KCQkJZGVzdGluYXRpb25ba2V5XSA9IGRlZXBtZXJnZSh0YXJnZXRba2V5XSwgc291cmNlW2tleV0sIG9wdGlvbnMpOw0KCQl9DQoJfSk7DQoJcmV0dXJuIGRlc3RpbmF0aW9uDQp9DQoNCmZ1bmN0aW9uIGRlZXBtZXJnZSh0YXJnZXQsIHNvdXJjZSwgb3B0aW9ucykgew0KCW9wdGlvbnMgPSBvcHRpb25zIHx8IHt9Ow0KCW9wdGlvbnMuYXJyYXlNZXJnZSA9IG9wdGlvbnMuYXJyYXlNZXJnZSB8fCBkZWZhdWx0QXJyYXlNZXJnZTsNCglvcHRpb25zLmlzTWVyZ2VhYmxlT2JqZWN0ID0gb3B0aW9ucy5pc01lcmdlYWJsZU9iamVjdCB8fCBpc01lcmdlYWJsZU9iamVjdDsNCg0KCXZhciBzb3VyY2VJc0FycmF5ID0gQXJyYXkuaXNBcnJheShzb3VyY2UpOw0KCXZhciB0YXJnZXRJc0FycmF5ID0gQXJyYXkuaXNBcnJheSh0YXJnZXQpOw0KCXZhciBzb3VyY2VBbmRUYXJnZXRUeXBlc01hdGNoID0gc291cmNlSXNBcnJheSA9PT0gdGFyZ2V0SXNBcnJheTsNCg0KCWlmICghc291cmNlQW5kVGFyZ2V0VHlwZXNNYXRjaCkgew0KCQlyZXR1cm4gY2xvbmVVbmxlc3NPdGhlcndpc2VTcGVjaWZpZWQoc291cmNlLCBvcHRpb25zKQ0KCX0gZWxzZSBpZiAoc291cmNlSXNBcnJheSkgew0KCQlyZXR1cm4gb3B0aW9ucy5hcnJheU1lcmdlKHRhcmdldCwgc291cmNlLCBvcHRpb25zKQ0KCX0gZWxzZSB7DQoJCXJldHVybiBtZXJnZU9iamVjdCh0YXJnZXQsIHNvdXJjZSwgb3B0aW9ucykNCgl9DQp9DQoNCmRlZXBtZXJnZS5hbGwgPSBmdW5jdGlvbiBkZWVwbWVyZ2VBbGwoYXJyYXksIG9wdGlvbnMpIHsNCglpZiAoIUFycmF5LmlzQXJyYXkoYXJyYXkpKSB7DQoJCXRocm93IG5ldyBFcnJvcignZmlyc3QgYXJndW1lbnQgc2hvdWxkIGJlIGFuIGFycmF5JykNCgl9DQoNCglyZXR1cm4gYXJyYXkucmVkdWNlKGZ1bmN0aW9uKHByZXYsIG5leHQpIHsNCgkJcmV0dXJuIGRlZXBtZXJnZShwcmV2LCBuZXh0LCBvcHRpb25zKQ0KCX0sIHt9KQ0KfTsNCg0KdmFyIGRlZXBtZXJnZV8xID0gZGVlcG1lcmdlOw0KDQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIF9fd2VicGFja19leHBvcnRzX19bImRlZmF1bHQiXSA9IChkZWVwbWVyZ2VfMSk7DQoNCg0KLyoqKi8gfSksDQovKiA0MSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KX193ZWJwYWNrX3JlcXVpcmVfXyg0Mik7DQoNCl9fd2VicGFja19yZXF1aXJlX18oNTEpOw0KDQpfX3dlYnBhY2tfcmVxdWlyZV9fKDcwKTsNCg0KX193ZWJwYWNrX3JlcXVpcmVfXyg3Mik7DQoNCi8qKiovIH0pLA0KLyogNDIgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KX193ZWJwYWNrX3JlcXVpcmVfXyg0Myk7DQptb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMikuQXJyYXkuZmluZDsNCg0KDQovKioqLyB9KSwNCi8qIDQzICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KLy8gMjIuMS4zLjggQXJyYXkucHJvdG90eXBlLmZpbmQocHJlZGljYXRlLCB0aGlzQXJnID0gdW5kZWZpbmVkKQ0KdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOw0KdmFyICRmaW5kID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NykoNSk7DQp2YXIgS0VZID0gJ2ZpbmQnOw0KdmFyIGZvcmNlZCA9IHRydWU7DQovLyBTaG91bGRuJ3Qgc2tpcCBob2xlcw0KaWYgKEtFWSBpbiBbXSkgQXJyYXkoMSlbS0VZXShmdW5jdGlvbiAoKSB7IGZvcmNlZCA9IGZhbHNlOyB9KTsNCiRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogZm9yY2VkLCAnQXJyYXknLCB7DQogIGZpbmQ6IGZ1bmN0aW9uIGZpbmQoY2FsbGJhY2tmbiAvKiAsIHRoYXQgPSB1bmRlZmluZWQgKi8pIHsNCiAgICByZXR1cm4gJGZpbmQodGhpcywgY2FsbGJhY2tmbiwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpOw0KICB9DQp9KTsNCl9fd2VicGFja19yZXF1aXJlX18oMjgpKEtFWSk7DQoNCg0KLyoqKi8gfSksDQovKiA0NCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQptb2R1bGUuZXhwb3J0cyA9ICFfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXygyMikoZnVuY3Rpb24gKCkgew0KICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KF9fd2VicGFja19yZXF1aXJlX18oMjMpKCdkaXYnKSwgJ2EnLCB7IGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gNzsgfSB9KS5hICE9IDc7DQp9KTsNCg0KDQovKioqLyB9KSwNCi8qIDQ1ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIDcuMS4xIFRvUHJpbWl0aXZlKGlucHV0IFssIFByZWZlcnJlZFR5cGVdKQ0KdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5KTsNCi8vIGluc3RlYWQgb2YgdGhlIEVTNiBzcGVjIHZlcnNpb24sIHdlIGRpZG4ndCBpbXBsZW1lbnQgQEB0b1ByaW1pdGl2ZSBjYXNlDQovLyBhbmQgdGhlIHNlY29uZCBhcmd1bWVudCAtIGZsYWcgLSBwcmVmZXJyZWQgdHlwZSBpcyBhIHN0cmluZw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQsIFMpIHsNCiAgaWYgKCFpc09iamVjdChpdCkpIHJldHVybiBpdDsNCiAgdmFyIGZuLCB2YWw7DQogIGlmIChTICYmIHR5cGVvZiAoZm4gPSBpdC50b1N0cmluZykgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpdCkpKSByZXR1cm4gdmFsOw0KICBpZiAodHlwZW9mIChmbiA9IGl0LnZhbHVlT2YpID09ICdmdW5jdGlvbicgJiYgIWlzT2JqZWN0KHZhbCA9IGZuLmNhbGwoaXQpKSkgcmV0dXJuIHZhbDsNCiAgaWYgKCFTICYmIHR5cGVvZiAoZm4gPSBpdC50b1N0cmluZykgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpdCkpKSByZXR1cm4gdmFsOw0KICB0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDQ2ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7DQogIGlmICh0eXBlb2YgaXQgIT0gJ2Z1bmN0aW9uJykgdGhyb3cgVHlwZUVycm9yKGl0ICsgJyBpcyBub3QgYSBmdW5jdGlvbiEnKTsNCiAgcmV0dXJuIGl0Ow0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDQ3ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIDAgLT4gQXJyYXkjZm9yRWFjaA0KLy8gMSAtPiBBcnJheSNtYXANCi8vIDIgLT4gQXJyYXkjZmlsdGVyDQovLyAzIC0+IEFycmF5I3NvbWUNCi8vIDQgLT4gQXJyYXkjZXZlcnkNCi8vIDUgLT4gQXJyYXkjZmluZA0KLy8gNiAtPiBBcnJheSNmaW5kSW5kZXgNCnZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE0KTsNCnZhciBJT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNSk7DQp2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE2KTsNCnZhciB0b0xlbmd0aCA9IF9fd2VicGFja19yZXF1aXJlX18oMTgpOw0KdmFyIGFzYyA9IF9fd2VicGFja19yZXF1aXJlX18oNDgpOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoVFlQRSwgJGNyZWF0ZSkgew0KICB2YXIgSVNfTUFQID0gVFlQRSA9PSAxOw0KICB2YXIgSVNfRklMVEVSID0gVFlQRSA9PSAyOw0KICB2YXIgSVNfU09NRSA9IFRZUEUgPT0gMzsNCiAgdmFyIElTX0VWRVJZID0gVFlQRSA9PSA0Ow0KICB2YXIgSVNfRklORF9JTkRFWCA9IFRZUEUgPT0gNjsNCiAgdmFyIE5PX0hPTEVTID0gVFlQRSA9PSA1IHx8IElTX0ZJTkRfSU5ERVg7DQogIHZhciBjcmVhdGUgPSAkY3JlYXRlIHx8IGFzYzsNCiAgcmV0dXJuIGZ1bmN0aW9uICgkdGhpcywgY2FsbGJhY2tmbiwgdGhhdCkgew0KICAgIHZhciBPID0gdG9PYmplY3QoJHRoaXMpOw0KICAgIHZhciBzZWxmID0gSU9iamVjdChPKTsNCiAgICB2YXIgZiA9IGN0eChjYWxsYmFja2ZuLCB0aGF0LCAzKTsNCiAgICB2YXIgbGVuZ3RoID0gdG9MZW5ndGgoc2VsZi5sZW5ndGgpOw0KICAgIHZhciBpbmRleCA9IDA7DQogICAgdmFyIHJlc3VsdCA9IElTX01BUCA/IGNyZWF0ZSgkdGhpcywgbGVuZ3RoKSA6IElTX0ZJTFRFUiA/IGNyZWF0ZSgkdGhpcywgMCkgOiB1bmRlZmluZWQ7DQogICAgdmFyIHZhbCwgcmVzOw0KICAgIGZvciAoO2xlbmd0aCA+IGluZGV4OyBpbmRleCsrKSBpZiAoTk9fSE9MRVMgfHwgaW5kZXggaW4gc2VsZikgew0KICAgICAgdmFsID0gc2VsZltpbmRleF07DQogICAgICByZXMgPSBmKHZhbCwgaW5kZXgsIE8pOw0KICAgICAgaWYgKFRZUEUpIHsNCiAgICAgICAgaWYgKElTX01BUCkgcmVzdWx0W2luZGV4XSA9IHJlczsgICAvLyBtYXANCiAgICAgICAgZWxzZSBpZiAocmVzKSBzd2l0Y2ggKFRZUEUpIHsNCiAgICAgICAgICBjYXNlIDM6IHJldHVybiB0cnVlOyAgICAgICAgICAgICAvLyBzb21lDQogICAgICAgICAgY2FzZSA1OiByZXR1cm4gdmFsOyAgICAgICAgICAgICAgLy8gZmluZA0KICAgICAgICAgIGNhc2UgNjogcmV0dXJuIGluZGV4OyAgICAgICAgICAgIC8vIGZpbmRJbmRleA0KICAgICAgICAgIGNhc2UgMjogcmVzdWx0LnB1c2godmFsKTsgICAgICAgIC8vIGZpbHRlcg0KICAgICAgICB9IGVsc2UgaWYgKElTX0VWRVJZKSByZXR1cm4gZmFsc2U7IC8vIGV2ZXJ5DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBJU19GSU5EX0lOREVYID8gLTEgOiBJU19TT01FIHx8IElTX0VWRVJZID8gSVNfRVZFUlkgOiByZXN1bHQ7DQogIH07DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNDggKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gOS40LjIuMyBBcnJheVNwZWNpZXNDcmVhdGUob3JpZ2luYWxBcnJheSwgbGVuZ3RoKQ0KdmFyIHNwZWNpZXNDb25zdHJ1Y3RvciA9IF9fd2VicGFja19yZXF1aXJlX18oNDkpOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgbGVuZ3RoKSB7DQogIHJldHVybiBuZXcgKHNwZWNpZXNDb25zdHJ1Y3RvcihvcmlnaW5hbCkpKGxlbmd0aCk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNDkgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5KTsNCnZhciBpc0FycmF5ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MCk7DQp2YXIgU1BFQ0lFUyA9IF9fd2VicGFja19yZXF1aXJlX18oMCkoJ3NwZWNpZXMnKTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob3JpZ2luYWwpIHsNCiAgdmFyIEM7DQogIGlmIChpc0FycmF5KG9yaWdpbmFsKSkgew0KICAgIEMgPSBvcmlnaW5hbC5jb25zdHJ1Y3RvcjsNCiAgICAvLyBjcm9zcy1yZWFsbSBmYWxsYmFjaw0KICAgIGlmICh0eXBlb2YgQyA9PSAnZnVuY3Rpb24nICYmIChDID09PSBBcnJheSB8fCBpc0FycmF5KEMucHJvdG90eXBlKSkpIEMgPSB1bmRlZmluZWQ7DQogICAgaWYgKGlzT2JqZWN0KEMpKSB7DQogICAgICBDID0gQ1tTUEVDSUVTXTsNCiAgICAgIGlmIChDID09PSBudWxsKSBDID0gdW5kZWZpbmVkOw0KICAgIH0NCiAgfSByZXR1cm4gQyA9PT0gdW5kZWZpbmVkID8gQXJyYXkgOiBDOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDUwICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIDcuMi4yIElzQXJyYXkoYXJndW1lbnQpDQp2YXIgY29mID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNSk7DQptb2R1bGUuZXhwb3J0cyA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gaXNBcnJheShhcmcpIHsNCiAgcmV0dXJuIGNvZihhcmcpID09ICdBcnJheSc7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNTEgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KX193ZWJwYWNrX3JlcXVpcmVfXyg1Mik7DQpfX3dlYnBhY2tfcmVxdWlyZV9fKDYzKTsNCm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKS5BcnJheS5mcm9tOw0KDQoNCi8qKiovIH0pLA0KLyogNTIgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQp2YXIgJGF0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MykodHJ1ZSk7DQoNCi8vIDIxLjEuMy4yNyBTdHJpbmcucHJvdG90eXBlW0BAaXRlcmF0b3JdKCkNCl9fd2VicGFja19yZXF1aXJlX18oNTQpKFN0cmluZywgJ1N0cmluZycsIGZ1bmN0aW9uIChpdGVyYXRlZCkgew0KICB0aGlzLl90ID0gU3RyaW5nKGl0ZXJhdGVkKTsgLy8gdGFyZ2V0DQogIHRoaXMuX2kgPSAwOyAgICAgICAgICAgICAgICAvLyBuZXh0IGluZGV4DQovLyAyMS4xLjUuMi4xICVTdHJpbmdJdGVyYXRvclByb3RvdHlwZSUubmV4dCgpDQp9LCBmdW5jdGlvbiAoKSB7DQogIHZhciBPID0gdGhpcy5fdDsNCiAgdmFyIGluZGV4ID0gdGhpcy5faTsNCiAgdmFyIHBvaW50Ow0KICBpZiAoaW5kZXggPj0gTy5sZW5ndGgpIHJldHVybiB7IHZhbHVlOiB1bmRlZmluZWQsIGRvbmU6IHRydWUgfTsNCiAgcG9pbnQgPSAkYXQoTywgaW5kZXgpOw0KICB0aGlzLl9pICs9IHBvaW50Lmxlbmd0aDsNCiAgcmV0dXJuIHsgdmFsdWU6IHBvaW50LCBkb25lOiBmYWxzZSB9Ow0KfSk7DQoNCg0KLyoqKi8gfSksDQovKiA1MyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgdG9JbnRlZ2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOSk7DQp2YXIgZGVmaW5lZCA9IF9fd2VicGFja19yZXF1aXJlX18oMTcpOw0KLy8gdHJ1ZSAgLT4gU3RyaW5nI2F0DQovLyBmYWxzZSAtPiBTdHJpbmcjY29kZVBvaW50QXQNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKFRPX1NUUklORykgew0KICByZXR1cm4gZnVuY3Rpb24gKHRoYXQsIHBvcykgew0KICAgIHZhciBzID0gU3RyaW5nKGRlZmluZWQodGhhdCkpOw0KICAgIHZhciBpID0gdG9JbnRlZ2VyKHBvcyk7DQogICAgdmFyIGwgPSBzLmxlbmd0aDsNCiAgICB2YXIgYSwgYjsNCiAgICBpZiAoaSA8IDAgfHwgaSA+PSBsKSByZXR1cm4gVE9fU1RSSU5HID8gJycgOiB1bmRlZmluZWQ7DQogICAgYSA9IHMuY2hhckNvZGVBdChpKTsNCiAgICByZXR1cm4gYSA8IDB4ZDgwMCB8fCBhID4gMHhkYmZmIHx8IGkgKyAxID09PSBsIHx8IChiID0gcy5jaGFyQ29kZUF0KGkgKyAxKSkgPCAweGRjMDAgfHwgYiA+IDB4ZGZmZg0KICAgICAgPyBUT19TVFJJTkcgPyBzLmNoYXJBdChpKSA6IGENCiAgICAgIDogVE9fU1RSSU5HID8gcy5zbGljZShpLCBpICsgMikgOiAoYSAtIDB4ZDgwMCA8PCAxMCkgKyAoYiAtIDB4ZGMwMCkgKyAweDEwMDAwOw0KICB9Ow0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDU0ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KdmFyIExJQlJBUlkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI3KTsNCnZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsNCnZhciByZWRlZmluZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjQpOw0KdmFyIGhpZGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpOw0KdmFyIEl0ZXJhdG9ycyA9IF9fd2VicGFja19yZXF1aXJlX18oMjApOw0KdmFyICRpdGVyQ3JlYXRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1NSk7DQp2YXIgc2V0VG9TdHJpbmdUYWcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMyKTsNCnZhciBnZXRQcm90b3R5cGVPZiA9IF9fd2VicGFja19yZXF1aXJlX18oNjIpOw0KdmFyIElURVJBVE9SID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKSgnaXRlcmF0b3InKTsNCnZhciBCVUdHWSA9ICEoW10ua2V5cyAmJiAnbmV4dCcgaW4gW10ua2V5cygpKTsgLy8gU2FmYXJpIGhhcyBidWdneSBpdGVyYXRvcnMgdy9vIGBuZXh0YA0KdmFyIEZGX0lURVJBVE9SID0gJ0BAaXRlcmF0b3InOw0KdmFyIEtFWVMgPSAna2V5cyc7DQp2YXIgVkFMVUVTID0gJ3ZhbHVlcyc7DQoNCnZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoQmFzZSwgTkFNRSwgQ29uc3RydWN0b3IsIG5leHQsIERFRkFVTFQsIElTX1NFVCwgRk9SQ0VEKSB7DQogICRpdGVyQ3JlYXRlKENvbnN0cnVjdG9yLCBOQU1FLCBuZXh0KTsNCiAgdmFyIGdldE1ldGhvZCA9IGZ1bmN0aW9uIChraW5kKSB7DQogICAgaWYgKCFCVUdHWSAmJiBraW5kIGluIHByb3RvKSByZXR1cm4gcHJvdG9ba2luZF07DQogICAgc3dpdGNoIChraW5kKSB7DQogICAgICBjYXNlIEtFWVM6IHJldHVybiBmdW5jdGlvbiBrZXlzKCkgeyByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOyB9Ow0KICAgICAgY2FzZSBWQUxVRVM6IHJldHVybiBmdW5jdGlvbiB2YWx1ZXMoKSB7IHJldHVybiBuZXcgQ29uc3RydWN0b3IodGhpcywga2luZCk7IH07DQogICAgfSByZXR1cm4gZnVuY3Rpb24gZW50cmllcygpIHsgcmV0dXJuIG5ldyBDb25zdHJ1Y3Rvcih0aGlzLCBraW5kKTsgfTsNCiAgfTsNCiAgdmFyIFRBRyA9IE5BTUUgKyAnIEl0ZXJhdG9yJzsNCiAgdmFyIERFRl9WQUxVRVMgPSBERUZBVUxUID09IFZBTFVFUzsNCiAgdmFyIFZBTFVFU19CVUcgPSBmYWxzZTsNCiAgdmFyIHByb3RvID0gQmFzZS5wcm90b3R5cGU7DQogIHZhciAkbmF0aXZlID0gcHJvdG9bSVRFUkFUT1JdIHx8IHByb3RvW0ZGX0lURVJBVE9SXSB8fCBERUZBVUxUICYmIHByb3RvW0RFRkFVTFRdOw0KICB2YXIgJGRlZmF1bHQgPSAkbmF0aXZlIHx8IGdldE1ldGhvZChERUZBVUxUKTsNCiAgdmFyICRlbnRyaWVzID0gREVGQVVMVCA/ICFERUZfVkFMVUVTID8gJGRlZmF1bHQgOiBnZXRNZXRob2QoJ2VudHJpZXMnKSA6IHVuZGVmaW5lZDsNCiAgdmFyICRhbnlOYXRpdmUgPSBOQU1FID09ICdBcnJheScgPyBwcm90by5lbnRyaWVzIHx8ICRuYXRpdmUgOiAkbmF0aXZlOw0KICB2YXIgbWV0aG9kcywga2V5LCBJdGVyYXRvclByb3RvdHlwZTsNCiAgLy8gRml4IG5hdGl2ZQ0KICBpZiAoJGFueU5hdGl2ZSkgew0KICAgIEl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG90eXBlT2YoJGFueU5hdGl2ZS5jYWxsKG5ldyBCYXNlKCkpKTsNCiAgICBpZiAoSXRlcmF0b3JQcm90b3R5cGUgIT09IE9iamVjdC5wcm90b3R5cGUgJiYgSXRlcmF0b3JQcm90b3R5cGUubmV4dCkgew0KICAgICAgLy8gU2V0IEBAdG9TdHJpbmdUYWcgdG8gbmF0aXZlIGl0ZXJhdG9ycw0KICAgICAgc2V0VG9TdHJpbmdUYWcoSXRlcmF0b3JQcm90b3R5cGUsIFRBRywgdHJ1ZSk7DQogICAgICAvLyBmaXggZm9yIHNvbWUgb2xkIGVuZ2luZXMNCiAgICAgIGlmICghTElCUkFSWSAmJiB0eXBlb2YgSXRlcmF0b3JQcm90b3R5cGVbSVRFUkFUT1JdICE9ICdmdW5jdGlvbicpIGhpZGUoSXRlcmF0b3JQcm90b3R5cGUsIElURVJBVE9SLCByZXR1cm5UaGlzKTsNCiAgICB9DQogIH0NCiAgLy8gZml4IEFycmF5I3t2YWx1ZXMsIEBAaXRlcmF0b3J9Lm5hbWUgaW4gVjggLyBGRg0KICBpZiAoREVGX1ZBTFVFUyAmJiAkbmF0aXZlICYmICRuYXRpdmUubmFtZSAhPT0gVkFMVUVTKSB7DQogICAgVkFMVUVTX0JVRyA9IHRydWU7DQogICAgJGRlZmF1bHQgPSBmdW5jdGlvbiB2YWx1ZXMoKSB7IHJldHVybiAkbmF0aXZlLmNhbGwodGhpcyk7IH07DQogIH0NCiAgLy8gRGVmaW5lIGl0ZXJhdG9yDQogIGlmICgoIUxJQlJBUlkgfHwgRk9SQ0VEKSAmJiAoQlVHR1kgfHwgVkFMVUVTX0JVRyB8fCAhcHJvdG9bSVRFUkFUT1JdKSkgew0KICAgIGhpZGUocHJvdG8sIElURVJBVE9SLCAkZGVmYXVsdCk7DQogIH0NCiAgLy8gUGx1ZyBmb3IgbGlicmFyeQ0KICBJdGVyYXRvcnNbTkFNRV0gPSAkZGVmYXVsdDsNCiAgSXRlcmF0b3JzW1RBR10gPSByZXR1cm5UaGlzOw0KICBpZiAoREVGQVVMVCkgew0KICAgIG1ldGhvZHMgPSB7DQogICAgICB2YWx1ZXM6IERFRl9WQUxVRVMgPyAkZGVmYXVsdCA6IGdldE1ldGhvZChWQUxVRVMpLA0KICAgICAga2V5czogSVNfU0VUID8gJGRlZmF1bHQgOiBnZXRNZXRob2QoS0VZUyksDQogICAgICBlbnRyaWVzOiAkZW50cmllcw0KICAgIH07DQogICAgaWYgKEZPUkNFRCkgZm9yIChrZXkgaW4gbWV0aG9kcykgew0KICAgICAgaWYgKCEoa2V5IGluIHByb3RvKSkgcmVkZWZpbmUocHJvdG8sIGtleSwgbWV0aG9kc1trZXldKTsNCiAgICB9IGVsc2UgJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAoQlVHR1kgfHwgVkFMVUVTX0JVRyksIE5BTUUsIG1ldGhvZHMpOw0KICB9DQogIHJldHVybiBtZXRob2RzOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDU1ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KdmFyIGNyZWF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNTYpOw0KdmFyIGRlc2NyaXB0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTsNCnZhciBzZXRUb1N0cmluZ1RhZyA9IF9fd2VicGFja19yZXF1aXJlX18oMzIpOw0KdmFyIEl0ZXJhdG9yUHJvdG90eXBlID0ge307DQoNCi8vIDI1LjEuMi4xLjEgJUl0ZXJhdG9yUHJvdG90eXBlJVtAQGl0ZXJhdG9yXSgpDQpfX3dlYnBhY2tfcmVxdWlyZV9fKDQpKEl0ZXJhdG9yUHJvdG90eXBlLCBfX3dlYnBhY2tfcmVxdWlyZV9fKDApKCdpdGVyYXRvcicpLCBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9KTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIE5BTUUsIG5leHQpIHsNCiAgQ29uc3RydWN0b3IucHJvdG90eXBlID0gY3JlYXRlKEl0ZXJhdG9yUHJvdG90eXBlLCB7IG5leHQ6IGRlc2NyaXB0b3IoMSwgbmV4dCkgfSk7DQogIHNldFRvU3RyaW5nVGFnKENvbnN0cnVjdG9yLCBOQU1FICsgJyBJdGVyYXRvcicpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDU2ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIDE5LjEuMi4yIC8gMTUuMi4zLjUgT2JqZWN0LmNyZWF0ZShPIFssIFByb3BlcnRpZXNdKQ0KdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsNCnZhciBkUHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU3KTsNCnZhciBlbnVtQnVnS2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oMzEpOw0KdmFyIElFX1BST1RPID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMSkoJ0lFX1BST1RPJyk7DQp2YXIgRW1wdHkgPSBmdW5jdGlvbiAoKSB7IC8qIGVtcHR5ICovIH07DQp2YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7DQoNCi8vIENyZWF0ZSBvYmplY3Qgd2l0aCBmYWtlIGBudWxsYCBwcm90b3R5cGU6IHVzZSBpZnJhbWUgT2JqZWN0IHdpdGggY2xlYXJlZCBwcm90b3R5cGUNCnZhciBjcmVhdGVEaWN0ID0gZnVuY3Rpb24gKCkgew0KICAvLyBUaHJhc2gsIHdhc3RlIGFuZCBzb2RvbXk6IElFIEdDIGJ1Zw0KICB2YXIgaWZyYW1lID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMykoJ2lmcmFtZScpOw0KICB2YXIgaSA9IGVudW1CdWdLZXlzLmxlbmd0aDsNCiAgdmFyIGx0ID0gJzwnOw0KICB2YXIgZ3QgPSAnPic7DQogIHZhciBpZnJhbWVEb2N1bWVudDsNCiAgaWZyYW1lLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogIF9fd2VicGFja19yZXF1aXJlX18oNjEpLmFwcGVuZENoaWxkKGlmcmFtZSk7DQogIGlmcmFtZS5zcmMgPSAnamF2YXNjcmlwdDonOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXNjcmlwdC11cmwNCiAgLy8gY3JlYXRlRGljdCA9IGlmcmFtZS5jb250ZW50V2luZG93Lk9iamVjdDsNCiAgLy8gaHRtbC5yZW1vdmVDaGlsZChpZnJhbWUpOw0KICBpZnJhbWVEb2N1bWVudCA9IGlmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50Ow0KICBpZnJhbWVEb2N1bWVudC5vcGVuKCk7DQogIGlmcmFtZURvY3VtZW50LndyaXRlKGx0ICsgJ3NjcmlwdCcgKyBndCArICdkb2N1bWVudC5GPU9iamVjdCcgKyBsdCArICcvc2NyaXB0JyArIGd0KTsNCiAgaWZyYW1lRG9jdW1lbnQuY2xvc2UoKTsNCiAgY3JlYXRlRGljdCA9IGlmcmFtZURvY3VtZW50LkY7DQogIHdoaWxlIChpLS0pIGRlbGV0ZSBjcmVhdGVEaWN0W1BST1RPVFlQRV1bZW51bUJ1Z0tleXNbaV1dOw0KICByZXR1cm4gY3JlYXRlRGljdCgpOw0KfTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QuY3JlYXRlIHx8IGZ1bmN0aW9uIGNyZWF0ZShPLCBQcm9wZXJ0aWVzKSB7DQogIHZhciByZXN1bHQ7DQogIGlmIChPICE9PSBudWxsKSB7DQogICAgRW1wdHlbUFJPVE9UWVBFXSA9IGFuT2JqZWN0KE8pOw0KICAgIHJlc3VsdCA9IG5ldyBFbXB0eSgpOw0KICAgIEVtcHR5W1BST1RPVFlQRV0gPSBudWxsOw0KICAgIC8vIGFkZCAiX19wcm90b19fIiBmb3IgT2JqZWN0LmdldFByb3RvdHlwZU9mIHBvbHlmaWxsDQogICAgcmVzdWx0W0lFX1BST1RPXSA9IE87DQogIH0gZWxzZSByZXN1bHQgPSBjcmVhdGVEaWN0KCk7DQogIHJldHVybiBQcm9wZXJ0aWVzID09PSB1bmRlZmluZWQgPyByZXN1bHQgOiBkUHMocmVzdWx0LCBQcm9wZXJ0aWVzKTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA1NyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgZFAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOw0KdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsNCnZhciBnZXRLZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1OCk7DQoNCm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCkgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyA6IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXMoTywgUHJvcGVydGllcykgew0KICBhbk9iamVjdChPKTsNCiAgdmFyIGtleXMgPSBnZXRLZXlzKFByb3BlcnRpZXMpOw0KICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7DQogIHZhciBpID0gMDsNCiAgdmFyIFA7DQogIHdoaWxlIChsZW5ndGggPiBpKSBkUC5mKE8sIFAgPSBrZXlzW2krK10sIFByb3BlcnRpZXNbUF0pOw0KICByZXR1cm4gTzsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA1OCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyAxOS4xLjIuMTQgLyAxNS4yLjMuMTQgT2JqZWN0LmtleXMoTykNCnZhciAka2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oNTkpOw0KdmFyIGVudW1CdWdLZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMSk7DQoNCm1vZHVsZS5leHBvcnRzID0gT2JqZWN0LmtleXMgfHwgZnVuY3Rpb24ga2V5cyhPKSB7DQogIHJldHVybiAka2V5cyhPLCBlbnVtQnVnS2V5cyk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNTkgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIGhhcyA9IF9fd2VicGFja19yZXF1aXJlX18oMTEpOw0KdmFyIHRvSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjkpOw0KdmFyIGFycmF5SW5kZXhPZiA9IF9fd2VicGFja19yZXF1aXJlX18oMzApKGZhbHNlKTsNCnZhciBJRV9QUk9UTyA9IF9fd2VicGFja19yZXF1aXJlX18oMjEpKCdJRV9QUk9UTycpOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvYmplY3QsIG5hbWVzKSB7DQogIHZhciBPID0gdG9JT2JqZWN0KG9iamVjdCk7DQogIHZhciBpID0gMDsNCiAgdmFyIHJlc3VsdCA9IFtdOw0KICB2YXIga2V5Ow0KICBmb3IgKGtleSBpbiBPKSBpZiAoa2V5ICE9IElFX1BST1RPKSBoYXMoTywga2V5KSAmJiByZXN1bHQucHVzaChrZXkpOw0KICAvLyBEb24ndCBlbnVtIGJ1ZyAmIGhpZGRlbiBrZXlzDQogIHdoaWxlIChuYW1lcy5sZW5ndGggPiBpKSBpZiAoaGFzKE8sIGtleSA9IG5hbWVzW2krK10pKSB7DQogICAgfmFycmF5SW5kZXhPZihyZXN1bHQsIGtleSkgfHwgcmVzdWx0LnB1c2goa2V5KTsNCiAgfQ0KICByZXR1cm4gcmVzdWx0Ow0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDYwICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciB0b0ludGVnZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE5KTsNCnZhciBtYXggPSBNYXRoLm1heDsNCnZhciBtaW4gPSBNYXRoLm1pbjsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGluZGV4LCBsZW5ndGgpIHsNCiAgaW5kZXggPSB0b0ludGVnZXIoaW5kZXgpOw0KICByZXR1cm4gaW5kZXggPCAwID8gbWF4KGluZGV4ICsgbGVuZ3RoLCAwKSA6IG1pbihpbmRleCwgbGVuZ3RoKTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA2MSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgZG9jdW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpLmRvY3VtZW50Ow0KbW9kdWxlLmV4cG9ydHMgPSBkb2N1bWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7DQoNCg0KLyoqKi8gfSksDQovKiA2MiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyAxOS4xLjIuOSAvIDE1LjIuMy4yIE9iamVjdC5nZXRQcm90b3R5cGVPZihPKQ0KdmFyIGhhcyA9IF9fd2VicGFja19yZXF1aXJlX18oMTEpOw0KdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNik7DQp2YXIgSUVfUFJPVE8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxKSgnSUVfUFJPVE8nKTsNCnZhciBPYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7DQoNCm1vZHVsZS5leHBvcnRzID0gT2JqZWN0LmdldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIChPKSB7DQogIE8gPSB0b09iamVjdChPKTsNCiAgaWYgKGhhcyhPLCBJRV9QUk9UTykpIHJldHVybiBPW0lFX1BST1RPXTsNCiAgaWYgKHR5cGVvZiBPLmNvbnN0cnVjdG9yID09ICdmdW5jdGlvbicgJiYgTyBpbnN0YW5jZW9mIE8uY29uc3RydWN0b3IpIHsNCiAgICByZXR1cm4gTy5jb25zdHJ1Y3Rvci5wcm90b3R5cGU7DQogIH0gcmV0dXJuIE8gaW5zdGFuY2VvZiBPYmplY3QgPyBPYmplY3RQcm90byA6IG51bGw7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNjMgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQp2YXIgY3R4ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNCk7DQp2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNik7DQp2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE2KTsNCnZhciBjYWxsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2NCk7DQp2YXIgaXNBcnJheUl0ZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY1KTsNCnZhciB0b0xlbmd0aCA9IF9fd2VicGFja19yZXF1aXJlX18oMTgpOw0KdmFyIGNyZWF0ZVByb3BlcnR5ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Nik7DQp2YXIgZ2V0SXRlckZuID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Nyk7DQoNCiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIV9fd2VicGFja19yZXF1aXJlX18oNjkpKGZ1bmN0aW9uIChpdGVyKSB7IEFycmF5LmZyb20oaXRlcik7IH0pLCAnQXJyYXknLCB7DQogIC8vIDIyLjEuMi4xIEFycmF5LmZyb20oYXJyYXlMaWtlLCBtYXBmbiA9IHVuZGVmaW5lZCwgdGhpc0FyZyA9IHVuZGVmaW5lZCkNCiAgZnJvbTogZnVuY3Rpb24gZnJvbShhcnJheUxpa2UgLyogLCBtYXBmbiA9IHVuZGVmaW5lZCwgdGhpc0FyZyA9IHVuZGVmaW5lZCAqLykgew0KICAgIHZhciBPID0gdG9PYmplY3QoYXJyYXlMaWtlKTsNCiAgICB2YXIgQyA9IHR5cGVvZiB0aGlzID09ICdmdW5jdGlvbicgPyB0aGlzIDogQXJyYXk7DQogICAgdmFyIGFMZW4gPSBhcmd1bWVudHMubGVuZ3RoOw0KICAgIHZhciBtYXBmbiA9IGFMZW4gPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkOw0KICAgIHZhciBtYXBwaW5nID0gbWFwZm4gIT09IHVuZGVmaW5lZDsNCiAgICB2YXIgaW5kZXggPSAwOw0KICAgIHZhciBpdGVyRm4gPSBnZXRJdGVyRm4oTyk7DQogICAgdmFyIGxlbmd0aCwgcmVzdWx0LCBzdGVwLCBpdGVyYXRvcjsNCiAgICBpZiAobWFwcGluZykgbWFwZm4gPSBjdHgobWFwZm4sIGFMZW4gPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkLCAyKTsNCiAgICAvLyBpZiBvYmplY3QgaXNuJ3QgaXRlcmFibGUgb3IgaXQncyBhcnJheSB3aXRoIGRlZmF1bHQgaXRlcmF0b3IgLSB1c2Ugc2ltcGxlIGNhc2UNCiAgICBpZiAoaXRlckZuICE9IHVuZGVmaW5lZCAmJiAhKEMgPT0gQXJyYXkgJiYgaXNBcnJheUl0ZXIoaXRlckZuKSkpIHsNCiAgICAgIGZvciAoaXRlcmF0b3IgPSBpdGVyRm4uY2FsbChPKSwgcmVzdWx0ID0gbmV3IEMoKTsgIShzdGVwID0gaXRlcmF0b3IubmV4dCgpKS5kb25lOyBpbmRleCsrKSB7DQogICAgICAgIGNyZWF0ZVByb3BlcnR5KHJlc3VsdCwgaW5kZXgsIG1hcHBpbmcgPyBjYWxsKGl0ZXJhdG9yLCBtYXBmbiwgW3N0ZXAudmFsdWUsIGluZGV4XSwgdHJ1ZSkgOiBzdGVwLnZhbHVlKTsNCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgbGVuZ3RoID0gdG9MZW5ndGgoTy5sZW5ndGgpOw0KICAgICAgZm9yIChyZXN1bHQgPSBuZXcgQyhsZW5ndGgpOyBsZW5ndGggPiBpbmRleDsgaW5kZXgrKykgew0KICAgICAgICBjcmVhdGVQcm9wZXJ0eShyZXN1bHQsIGluZGV4LCBtYXBwaW5nID8gbWFwZm4oT1tpbmRleF0sIGluZGV4KSA6IE9baW5kZXhdKTsNCiAgICAgIH0NCiAgICB9DQogICAgcmVzdWx0Lmxlbmd0aCA9IGluZGV4Ow0KICAgIHJldHVybiByZXN1bHQ7DQogIH0NCn0pOw0KDQoNCi8qKiovIH0pLA0KLyogNjQgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gY2FsbCBzb21ldGhpbmcgb24gaXRlcmF0b3Igc3RlcCB3aXRoIHNhZmUgY2xvc2luZyBvbiBlcnJvcg0KdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0ZXJhdG9yLCBmbiwgdmFsdWUsIGVudHJpZXMpIHsNCiAgdHJ5IHsNCiAgICByZXR1cm4gZW50cmllcyA/IGZuKGFuT2JqZWN0KHZhbHVlKVswXSwgdmFsdWVbMV0pIDogZm4odmFsdWUpOw0KICAvLyA3LjQuNiBJdGVyYXRvckNsb3NlKGl0ZXJhdG9yLCBjb21wbGV0aW9uKQ0KICB9IGNhdGNoIChlKSB7DQogICAgdmFyIHJldCA9IGl0ZXJhdG9yWydyZXR1cm4nXTsNCiAgICBpZiAocmV0ICE9PSB1bmRlZmluZWQpIGFuT2JqZWN0KHJldC5jYWxsKGl0ZXJhdG9yKSk7DQogICAgdGhyb3cgZTsNCiAgfQ0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDY1ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIGNoZWNrIG9uIGRlZmF1bHQgQXJyYXkgaXRlcmF0b3INCnZhciBJdGVyYXRvcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwKTsNCnZhciBJVEVSQVRPUiA9IF9fd2VicGFja19yZXF1aXJlX18oMCkoJ2l0ZXJhdG9yJyk7DQp2YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsNCiAgcmV0dXJuIGl0ICE9PSB1bmRlZmluZWQgJiYgKEl0ZXJhdG9ycy5BcnJheSA9PT0gaXQgfHwgQXJyYXlQcm90b1tJVEVSQVRPUl0gPT09IGl0KTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA2NiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCnZhciAkZGVmaW5lUHJvcGVydHkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOw0KdmFyIGNyZWF0ZURlc2MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqZWN0LCBpbmRleCwgdmFsdWUpIHsNCiAgaWYgKGluZGV4IGluIG9iamVjdCkgJGRlZmluZVByb3BlcnR5LmYob2JqZWN0LCBpbmRleCwgY3JlYXRlRGVzYygwLCB2YWx1ZSkpOw0KICBlbHNlIG9iamVjdFtpbmRleF0gPSB2YWx1ZTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA2NyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgY2xhc3NvZiA9IF9fd2VicGFja19yZXF1aXJlX18oNjgpOw0KdmFyIElURVJBVE9SID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKSgnaXRlcmF0b3InKTsNCnZhciBJdGVyYXRvcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwKTsNCm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKS5nZXRJdGVyYXRvck1ldGhvZCA9IGZ1bmN0aW9uIChpdCkgew0KICBpZiAoaXQgIT0gdW5kZWZpbmVkKSByZXR1cm4gaXRbSVRFUkFUT1JdDQogICAgfHwgaXRbJ0BAaXRlcmF0b3InXQ0KICAgIHx8IEl0ZXJhdG9yc1tjbGFzc29mKGl0KV07DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNjggKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gZ2V0dGluZyB0YWcgZnJvbSAxOS4xLjMuNiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nKCkNCnZhciBjb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1KTsNCnZhciBUQUcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApKCd0b1N0cmluZ1RhZycpOw0KLy8gRVMzIHdyb25nIGhlcmUNCnZhciBBUkcgPSBjb2YoZnVuY3Rpb24gKCkgeyByZXR1cm4gYXJndW1lbnRzOyB9KCkpID09ICdBcmd1bWVudHMnOw0KDQovLyBmYWxsYmFjayBmb3IgSUUxMSBTY3JpcHQgQWNjZXNzIERlbmllZCBlcnJvcg0KdmFyIHRyeUdldCA9IGZ1bmN0aW9uIChpdCwga2V5KSB7DQogIHRyeSB7DQogICAgcmV0dXJuIGl0W2tleV07DQogIH0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfQ0KfTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsNCiAgdmFyIE8sIFQsIEI7DQogIHJldHVybiBpdCA9PT0gdW5kZWZpbmVkID8gJ1VuZGVmaW5lZCcgOiBpdCA9PT0gbnVsbCA/ICdOdWxsJw0KICAgIC8vIEBAdG9TdHJpbmdUYWcgY2FzZQ0KICAgIDogdHlwZW9mIChUID0gdHJ5R2V0KE8gPSBPYmplY3QoaXQpLCBUQUcpKSA9PSAnc3RyaW5nJyA/IFQNCiAgICAvLyBidWlsdGluVGFnIGNhc2UNCiAgICA6IEFSRyA/IGNvZihPKQ0KICAgIC8vIEVTMyBhcmd1bWVudHMgZmFsbGJhY2sNCiAgICA6IChCID0gY29mKE8pKSA9PSAnT2JqZWN0JyAmJiB0eXBlb2YgTy5jYWxsZWUgPT0gJ2Z1bmN0aW9uJyA/ICdBcmd1bWVudHMnIDogQjsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA2OSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgSVRFUkFUT1IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApKCdpdGVyYXRvcicpOw0KdmFyIFNBRkVfQ0xPU0lORyA9IGZhbHNlOw0KDQp0cnkgew0KICB2YXIgcml0ZXIgPSBbN11bSVRFUkFUT1JdKCk7DQogIHJpdGVyWydyZXR1cm4nXSA9IGZ1bmN0aW9uICgpIHsgU0FGRV9DTE9TSU5HID0gdHJ1ZTsgfTsNCiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXRocm93LWxpdGVyYWwNCiAgQXJyYXkuZnJvbShyaXRlciwgZnVuY3Rpb24gKCkgeyB0aHJvdyAyOyB9KTsNCn0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfQ0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChleGVjLCBza2lwQ2xvc2luZykgew0KICBpZiAoIXNraXBDbG9zaW5nICYmICFTQUZFX0NMT1NJTkcpIHJldHVybiBmYWxzZTsNCiAgdmFyIHNhZmUgPSBmYWxzZTsNCiAgdHJ5IHsNCiAgICB2YXIgYXJyID0gWzddOw0KICAgIHZhciBpdGVyID0gYXJyW0lURVJBVE9SXSgpOw0KICAgIGl0ZXIubmV4dCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHsgZG9uZTogc2FmZSA9IHRydWUgfTsgfTsNCiAgICBhcnJbSVRFUkFUT1JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gaXRlcjsgfTsNCiAgICBleGVjKGFycik7DQogIH0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfQ0KICByZXR1cm4gc2FmZTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA3MCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQpfX3dlYnBhY2tfcmVxdWlyZV9fKDcxKTsNCm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKS5BcnJheS5pbmNsdWRlczsNCg0KDQovKioqLyB9KSwNCi8qIDcxICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KLy8gaHR0cHM6Ly9naXRodWIuY29tL3RjMzkvQXJyYXkucHJvdG90eXBlLmluY2x1ZGVzDQp2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNik7DQp2YXIgJGluY2x1ZGVzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMCkodHJ1ZSk7DQoNCiRleHBvcnQoJGV4cG9ydC5QLCAnQXJyYXknLCB7DQogIGluY2x1ZGVzOiBmdW5jdGlvbiBpbmNsdWRlcyhlbCAvKiAsIGZyb21JbmRleCA9IDAgKi8pIHsNCiAgICByZXR1cm4gJGluY2x1ZGVzKHRoaXMsIGVsLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7DQogIH0NCn0pOw0KDQpfX3dlYnBhY2tfcmVxdWlyZV9fKDI4KSgnaW5jbHVkZXMnKTsNCg0KDQovKioqLyB9KSwNCi8qIDcyICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCi8vIFBvbHlmaWxsIGZvciBjcmVhdGluZyBDdXN0b21FdmVudHMgb24gSUU5LzEwLzExDQoNCi8vIGNvZGUgcHVsbGVkIGZyb206DQovLyBodHRwczovL2dpdGh1Yi5jb20vZDR0b2NjaGluaS9jdXN0b21ldmVudC1wb2x5ZmlsbA0KLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0N1c3RvbUV2ZW50I1BvbHlmaWxsDQoNCnRyeSB7DQogICAgdmFyIGNlID0gbmV3IHdpbmRvdy5DdXN0b21FdmVudCgndGVzdCcpOw0KICAgIGNlLnByZXZlbnREZWZhdWx0KCk7DQogICAgaWYgKGNlLmRlZmF1bHRQcmV2ZW50ZWQgIT09IHRydWUpIHsNCiAgICAgICAgLy8gSUUgaGFzIHByb2JsZW1zIHdpdGggLnByZXZlbnREZWZhdWx0KCkgb24gY3VzdG9tIGV2ZW50cw0KICAgICAgICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzIzMzQ5MTkxDQogICAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IHByZXZlbnQgZGVmYXVsdCcpOw0KICAgIH0NCn0gY2F0Y2goZSkgew0KICB2YXIgQ3VzdG9tRXZlbnQgPSBmdW5jdGlvbihldmVudCwgcGFyYW1zKSB7DQogICAgdmFyIGV2dCwgb3JpZ1ByZXZlbnQ7DQogICAgcGFyYW1zID0gcGFyYW1zIHx8IHsNCiAgICAgIGJ1YmJsZXM6IGZhbHNlLA0KICAgICAgY2FuY2VsYWJsZTogZmFsc2UsDQogICAgICBkZXRhaWw6IHVuZGVmaW5lZA0KICAgIH07DQoNCiAgICBldnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgiQ3VzdG9tRXZlbnQiKTsNCiAgICBldnQuaW5pdEN1c3RvbUV2ZW50KGV2ZW50LCBwYXJhbXMuYnViYmxlcywgcGFyYW1zLmNhbmNlbGFibGUsIHBhcmFtcy5kZXRhaWwpOw0KICAgIG9yaWdQcmV2ZW50ID0gZXZ0LnByZXZlbnREZWZhdWx0Ow0KICAgIGV2dC5wcmV2ZW50RGVmYXVsdCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgIG9yaWdQcmV2ZW50LmNhbGwodGhpcyk7DQogICAgICB0cnkgew0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2RlZmF1bHRQcmV2ZW50ZWQnLCB7DQogICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgfSBjYXRjaChlKSB7DQogICAgICAgIHRoaXMuZGVmYXVsdFByZXZlbnRlZCA9IHRydWU7DQogICAgICB9DQogICAgfTsNCiAgICByZXR1cm4gZXZ0Ow0KICB9Ow0KDQogIEN1c3RvbUV2ZW50LnByb3RvdHlwZSA9IHdpbmRvdy5FdmVudC5wcm90b3R5cGU7DQogIHdpbmRvdy5DdXN0b21FdmVudCA9IEN1c3RvbUV2ZW50OyAvLyBleHBvc2UgZGVmaW5pdGlvbiB0byB3aW5kb3cNCn0NCg0KDQovKioqLyB9KSwNCi8qIDczICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCg0KdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7DQoNCnZhciBfcmVkdXggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMzKTsNCg0KdmFyIF9pbmRleCA9IF9fd2VicGFja19yZXF1aXJlX18oNzgpOw0KDQp2YXIgX2luZGV4MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2luZGV4KTsNCg0KZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0NCg0KZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSBlbHNlIHsgcmV0dXJuIEFycmF5LmZyb20oYXJyKTsgfSB9DQoNCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQ0KDQp2YXIgU3RvcmUgPSBmdW5jdGlvbiAoKSB7DQogIGZ1bmN0aW9uIFN0b3JlKCkgew0KICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTdG9yZSk7DQoNCiAgICB0aGlzLl9zdG9yZSA9ICgwLCBfcmVkdXguY3JlYXRlU3RvcmUpKF9pbmRleDIuZGVmYXVsdCwgd2luZG93LmRldlRvb2xzRXh0ZW5zaW9uID8gd2luZG93LmRldlRvb2xzRXh0ZW5zaW9uKCkgOiB1bmRlZmluZWQpOw0KICB9DQoNCiAgLyoqDQogICAqIFN1YnNjcmliZSBzdG9yZSB0byBmdW5jdGlvbiBjYWxsICh3cmFwcGVkIFJlZHV4IG1ldGhvZCkNCiAgICogQHBhcmFtICB7RnVuY3Rpb259IG9uQ2hhbmdlIEZ1bmN0aW9uIHRvIHRyaWdnZXIgd2hlbiBzdGF0ZSBjaGFuZ2VzDQogICAqIEByZXR1cm4NCiAgICovDQoNCg0KICBfY3JlYXRlQ2xhc3MoU3RvcmUsIFt7DQogICAga2V5OiAnc3Vic2NyaWJlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc3Vic2NyaWJlKG9uQ2hhbmdlKSB7DQogICAgICB0aGlzLl9zdG9yZS5zdWJzY3JpYmUob25DaGFuZ2UpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIERpc3BhdGNoIGV2ZW50IHRvIHN0b3JlICh3cmFwcGVkIFJlZHV4IG1ldGhvZCkNCiAgICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gYWN0aW9uIEFjdGlvbiBmdW5jdGlvbiB0byB0cmlnZ2VyDQogICAgICogQHJldHVybg0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdkaXNwYXRjaCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3BhdGNoKGFjdGlvbikgew0KICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goYWN0aW9uKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgc3RvcmUgb2JqZWN0ICh3cmFwcGluZyBSZWR1eCBtZXRob2QpDQogICAgICogQHJldHVybiB7T2JqZWN0fSBTdGF0ZQ0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdnZXRDaG9pY2VCeUlkJywNCg0KDQogICAgLyoqDQogICAgICogR2V0IHNpbmdsZSBjaG9pY2UgYnkgaXQncyBJRA0KICAgICAqIEByZXR1cm4ge09iamVjdH0gRm91bmQgY2hvaWNlDQogICAgICovDQogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENob2ljZUJ5SWQoaWQpIHsNCiAgICAgIGlmIChpZCkgew0KICAgICAgICB2YXIgY2hvaWNlcyA9IHRoaXMuYWN0aXZlQ2hvaWNlczsNCiAgICAgICAgdmFyIGZvdW5kQ2hvaWNlID0gY2hvaWNlcy5maW5kKGZ1bmN0aW9uIChjaG9pY2UpIHsNCiAgICAgICAgICByZXR1cm4gY2hvaWNlLmlkID09PSBwYXJzZUludChpZCwgMTApOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIGZvdW5kQ2hvaWNlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCBncm91cCBieSBncm91cCBpZA0KICAgICAqIEBwYXJhbSAge051bWJlcn0gaWQgR3JvdXAgSUQNCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9ICAgIEdyb3VwIGRhdGENCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnZ2V0R3JvdXBCeUlkJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0R3JvdXBCeUlkKGlkKSB7DQogICAgICByZXR1cm4gdGhpcy5ncm91cHMuZmluZChmdW5jdGlvbiAoZ3JvdXApIHsNCiAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09PSBwYXJzZUludChpZCwgMTApOw0KICAgICAgfSk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnc3RhdGUnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIHRoaXMuX3N0b3JlLmdldFN0YXRlKCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IGl0ZW1zIGZyb20gc3RvcmUNCiAgICAgKiBAcmV0dXJuIHtBcnJheX0gSXRlbSBvYmplY3RzDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2l0ZW1zJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiB0aGlzLnN0YXRlLml0ZW1zOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCBhY3RpdmUgaXRlbXMgZnJvbSBzdG9yZQ0KICAgICAqIEByZXR1cm4ge0FycmF5fSBJdGVtIG9iamVjdHMNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnYWN0aXZlSXRlbXMnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIHRoaXMuaXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgIHJldHVybiBpdGVtLmFjdGl2ZSA9PT0gdHJ1ZTsNCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCBoaWdobGlnaHRlZCBpdGVtcyBmcm9tIHN0b3JlDQogICAgICogQHJldHVybiB7QXJyYXl9IEl0ZW0gb2JqZWN0cw0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdoaWdobGlnaHRlZEFjdGl2ZUl0ZW1zJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiB0aGlzLml0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICByZXR1cm4gaXRlbS5hY3RpdmUgJiYgaXRlbS5oaWdobGlnaHRlZDsNCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCBjaG9pY2VzIGZyb20gc3RvcmUNCiAgICAgKiBAcmV0dXJuIHtBcnJheX0gT3B0aW9uIG9iamVjdHMNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnY2hvaWNlcycsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gdGhpcy5zdGF0ZS5jaG9pY2VzOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCBhY3RpdmUgY2hvaWNlcyBmcm9tIHN0b3JlDQogICAgICogQHJldHVybiB7QXJyYXl9IE9wdGlvbiBvYmplY3RzDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2FjdGl2ZUNob2ljZXMnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgdmFyIGNob2ljZXMgPSB0aGlzLmNob2ljZXM7DQogICAgICB2YXIgdmFsdWVzID0gY2hvaWNlcy5maWx0ZXIoZnVuY3Rpb24gKGNob2ljZSkgew0KICAgICAgICByZXR1cm4gY2hvaWNlLmFjdGl2ZSA9PT0gdHJ1ZTsNCiAgICAgIH0pOw0KDQogICAgICByZXR1cm4gdmFsdWVzOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCBzZWxlY3RhYmxlIGNob2ljZXMgZnJvbSBzdG9yZQ0KICAgICAqIEByZXR1cm4ge0FycmF5fSBPcHRpb24gb2JqZWN0cw0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdzZWxlY3RhYmxlQ2hvaWNlcycsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gdGhpcy5jaG9pY2VzLmZpbHRlcihmdW5jdGlvbiAoY2hvaWNlKSB7DQogICAgICAgIHJldHVybiBjaG9pY2UuZGlzYWJsZWQgIT09IHRydWU7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgY2hvaWNlcyB0aGF0IGNhbiBiZSBzZWFyY2hlZCAoZXhjbHVkaW5nIHBsYWNlaG9sZGVycykNCiAgICAgKiBAcmV0dXJuIHtBcnJheX0gT3B0aW9uIG9iamVjdHMNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnc2VhcmNoYWJsZUNob2ljZXMnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0YWJsZUNob2ljZXMuZmlsdGVyKGZ1bmN0aW9uIChjaG9pY2UpIHsNCiAgICAgICAgcmV0dXJuIGNob2ljZS5wbGFjZWhvbGRlciAhPT0gdHJ1ZTsNCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCBwbGFjZWhvbGRlciBjaG9pY2UgZnJvbSBzdG9yZQ0KICAgICAqIEByZXR1cm4ge09iamVjdH0gRm91bmQgcGxhY2Vob2xkZXINCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAncGxhY2Vob2xkZXJDaG9pY2UnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5jaG9pY2VzKSkucmV2ZXJzZSgpLmZpbmQoZnVuY3Rpb24gKGNob2ljZSkgew0KICAgICAgICByZXR1cm4gY2hvaWNlLnBsYWNlaG9sZGVyID09PSB0cnVlOw0KICAgICAgfSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IGdyb3VwcyBmcm9tIHN0b3JlDQogICAgICogQHJldHVybiB7QXJyYXl9IEdyb3VwIG9iamVjdHMNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnZ3JvdXBzJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiB0aGlzLnN0YXRlLmdyb3VwczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgYWN0aXZlIGdyb3VwcyBmcm9tIHN0b3JlDQogICAgICogQHJldHVybiB7QXJyYXl9IEdyb3VwIG9iamVjdHMNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnYWN0aXZlR3JvdXBzJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHZhciBncm91cHMgPSB0aGlzLmdyb3VwczsNCiAgICAgIHZhciBjaG9pY2VzID0gdGhpcy5jaG9pY2VzOw0KDQogICAgICByZXR1cm4gZ3JvdXBzLmZpbHRlcihmdW5jdGlvbiAoZ3JvdXApIHsNCiAgICAgICAgdmFyIGlzQWN0aXZlID0gZ3JvdXAuYWN0aXZlID09PSB0cnVlICYmIGdyb3VwLmRpc2FibGVkID09PSBmYWxzZTsNCiAgICAgICAgdmFyIGhhc0FjdGl2ZU9wdGlvbnMgPSBjaG9pY2VzLnNvbWUoZnVuY3Rpb24gKGNob2ljZSkgew0KICAgICAgICAgIHJldHVybiBjaG9pY2UuYWN0aXZlID09PSB0cnVlICYmIGNob2ljZS5kaXNhYmxlZCA9PT0gZmFsc2U7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gaXNBY3RpdmUgJiYgaGFzQWN0aXZlT3B0aW9uczsNCiAgICAgIH0sIFtdKTsNCiAgICB9DQogIH1dKTsNCg0KICByZXR1cm4gU3RvcmU7DQp9KCk7DQoNCmV4cG9ydHMuZGVmYXVsdCA9IFN0b3JlOw0KDQovKioqLyB9KSwNCi8qIDc0ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYGdsb2JhbGAgZnJvbSBOb2RlLmpzLiAqLw0KdmFyIGZyZWVHbG9iYWwgPSB0eXBlb2YgZ2xvYmFsID09ICdvYmplY3QnICYmIGdsb2JhbCAmJiBnbG9iYWwuT2JqZWN0ID09PSBPYmplY3QgJiYgZ2xvYmFsOw0KDQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIF9fd2VicGFja19leHBvcnRzX19bImEiXSA9IChmcmVlR2xvYmFsKTsNCg0KLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18oMzQpKSkNCg0KLyoqKi8gfSksDQovKiA3NSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQovKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24oZ2xvYmFsLCBtb2R1bGUpIHsvKiBoYXJtb255IGltcG9ydCAqLyB2YXIgX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX19wb255ZmlsbF9qc19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3Nyk7DQovKiBnbG9iYWwgd2luZG93ICovDQoNCg0KdmFyIHJvb3Q7DQoNCmlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgcm9vdCA9IHNlbGY7DQp9IGVsc2UgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7DQogIHJvb3QgPSB3aW5kb3c7DQp9IGVsc2UgaWYgKHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnKSB7DQogIHJvb3QgPSBnbG9iYWw7DQp9IGVsc2UgaWYgKHRydWUpIHsNCiAgcm9vdCA9IG1vZHVsZTsNCn0gZWxzZSB7DQogIHJvb3QgPSBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOw0KfQ0KDQp2YXIgcmVzdWx0ID0gT2JqZWN0KF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fcG9ueWZpbGxfanNfX1siYSIgLyogZGVmYXVsdCAqL10pKHJvb3QpOw0KLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyBfX3dlYnBhY2tfZXhwb3J0c19fWyJhIl0gPSAocmVzdWx0KTsNCg0KLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18oMzQpLCBfX3dlYnBhY2tfcmVxdWlyZV9fKDc2KShtb2R1bGUpKSkNCg0KLyoqKi8gfSksDQovKiA3NiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG9yaWdpbmFsTW9kdWxlKSB7DQoJaWYoIW9yaWdpbmFsTW9kdWxlLndlYnBhY2tQb2x5ZmlsbCkgew0KCQl2YXIgbW9kdWxlID0gT2JqZWN0LmNyZWF0ZShvcmlnaW5hbE1vZHVsZSk7DQoJCS8vIG1vZHVsZS5wYXJlbnQgPSB1bmRlZmluZWQgYnkgZGVmYXVsdA0KCQlpZighbW9kdWxlLmNoaWxkcmVuKSBtb2R1bGUuY2hpbGRyZW4gPSBbXTsNCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgImxvYWRlZCIsIHsNCgkJCWVudW1lcmFibGU6IHRydWUsDQoJCQlnZXQ6IGZ1bmN0aW9uKCkgew0KCQkJCXJldHVybiBtb2R1bGUubDsNCgkJCX0NCgkJfSk7DQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShtb2R1bGUsICJpZCIsIHsNCgkJCWVudW1lcmFibGU6IHRydWUsDQoJCQlnZXQ6IGZ1bmN0aW9uKCkgew0KCQkJCXJldHVybiBtb2R1bGUuaTsNCgkJCX0NCgkJfSk7DQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShtb2R1bGUsICJleHBvcnRzIiwgew0KCQkJZW51bWVyYWJsZTogdHJ1ZSwNCgkJfSk7DQoJCW1vZHVsZS53ZWJwYWNrUG9seWZpbGwgPSAxOw0KCX0NCglyZXR1cm4gbW9kdWxlOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDc3ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCi8qIGhhcm1vbnkgZXhwb3J0IChpbW11dGFibGUpICovIF9fd2VicGFja19leHBvcnRzX19bImEiXSA9IHN5bWJvbE9ic2VydmFibGVQb255ZmlsbDsNCmZ1bmN0aW9uIHN5bWJvbE9ic2VydmFibGVQb255ZmlsbChyb290KSB7DQoJdmFyIHJlc3VsdDsNCgl2YXIgU3ltYm9sID0gcm9vdC5TeW1ib2w7DQoNCglpZiAodHlwZW9mIFN5bWJvbCA9PT0gJ2Z1bmN0aW9uJykgew0KCQlpZiAoU3ltYm9sLm9ic2VydmFibGUpIHsNCgkJCXJlc3VsdCA9IFN5bWJvbC5vYnNlcnZhYmxlOw0KCQl9IGVsc2Ugew0KCQkJcmVzdWx0ID0gU3ltYm9sKCdvYnNlcnZhYmxlJyk7DQoJCQlTeW1ib2wub2JzZXJ2YWJsZSA9IHJlc3VsdDsNCgkJfQ0KCX0gZWxzZSB7DQoJCXJlc3VsdCA9ICdAQG9ic2VydmFibGUnOw0KCX0NCg0KCXJldHVybiByZXN1bHQ7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNzggKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KDQp2YXIgX3JlZHV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMyk7DQoNCnZhciBfaXRlbXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc5KTsNCg0KdmFyIF9pdGVtczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pdGVtcyk7DQoNCnZhciBfZ3JvdXBzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4MCk7DQoNCnZhciBfZ3JvdXBzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2dyb3Vwcyk7DQoNCnZhciBfY2hvaWNlcyA9IF9fd2VicGFja19yZXF1aXJlX18oODEpOw0KDQp2YXIgX2Nob2ljZXMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY2hvaWNlcyk7DQoNCnZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOw0KDQpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQ0KDQp2YXIgYXBwUmVkdWNlciA9ICgwLCBfcmVkdXguY29tYmluZVJlZHVjZXJzKSh7DQogIGl0ZW1zOiBfaXRlbXMyLmRlZmF1bHQsDQogIGdyb3VwczogX2dyb3VwczIuZGVmYXVsdCwNCiAgY2hvaWNlczogX2Nob2ljZXMyLmRlZmF1bHQNCn0pOw0KDQp2YXIgcm9vdFJlZHVjZXIgPSBmdW5jdGlvbiByb290UmVkdWNlcihwYXNzZWRTdGF0ZSwgYWN0aW9uKSB7DQogIHZhciBzdGF0ZSA9IHBhc3NlZFN0YXRlOw0KICAvLyBJZiB3ZSBhcmUgY2xlYXJpbmcgYWxsIGl0ZW1zLCBncm91cHMgYW5kIG9wdGlvbnMgd2UgcmVhc3NpZ24NCiAgLy8gc3RhdGUgYW5kIHRoZW4gcGFzcyB0aGF0IHN0YXRlIHRvIG91ciBwcm9wZXIgcmVkdWNlci4gVGhpcyBpc24ndA0KICAvLyBtdXRhdGluZyBvdXIgYWN0dWFsIHN0YXRlDQogIC8vIFNlZTogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMzU2NDE5OTINCiAgaWYgKGFjdGlvbi50eXBlID09PSAnQ0xFQVJfQUxMJykgew0KICAgIHN0YXRlID0gdW5kZWZpbmVkOw0KICB9IGVsc2UgaWYgKGFjdGlvbi50eXBlID09PSAnUkVTRVRfVE8nKSB7DQogICAgcmV0dXJuICgwLCBfdXRpbHMuY2xvbmVPYmplY3QpKGFjdGlvbi5zdGF0ZSk7DQogIH0NCg0KICByZXR1cm4gYXBwUmVkdWNlcihzdGF0ZSwgYWN0aW9uKTsNCn07DQoNCmV4cG9ydHMuZGVmYXVsdCA9IHJvb3RSZWR1Y2VyOw0KDQovKioqLyB9KSwNCi8qIDc5ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCmV4cG9ydHMuZGVmYXVsdCA9IGl0ZW1zOw0KDQpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IGVsc2UgeyByZXR1cm4gQXJyYXkuZnJvbShhcnIpOyB9IH0NCg0KdmFyIGRlZmF1bHRTdGF0ZSA9IGV4cG9ydHMuZGVmYXVsdFN0YXRlID0gW107DQoNCmZ1bmN0aW9uIGl0ZW1zKCkgew0KICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IGRlZmF1bHRTdGF0ZTsNCiAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50c1sxXTsNCg0KICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7DQogICAgY2FzZSAnQUREX0lURU0nOg0KICAgICAgew0KICAgICAgICAvLyBBZGQgb2JqZWN0IHRvIGl0ZW1zIGFycmF5DQogICAgICAgIHZhciBuZXdTdGF0ZSA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoc3RhdGUpLCBbew0KICAgICAgICAgIGlkOiBhY3Rpb24uaWQsDQogICAgICAgICAgY2hvaWNlSWQ6IGFjdGlvbi5jaG9pY2VJZCwNCiAgICAgICAgICBncm91cElkOiBhY3Rpb24uZ3JvdXBJZCwNCiAgICAgICAgICB2YWx1ZTogYWN0aW9uLnZhbHVlLA0KICAgICAgICAgIGxhYmVsOiBhY3Rpb24ubGFiZWwsDQogICAgICAgICAgYWN0aXZlOiB0cnVlLA0KICAgICAgICAgIGhpZ2hsaWdodGVkOiBmYWxzZSwNCiAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBhY3Rpb24uY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICBwbGFjZWhvbGRlcjogYWN0aW9uLnBsYWNlaG9sZGVyIHx8IGZhbHNlLA0KICAgICAgICAgIGtleUNvZGU6IG51bGwNCiAgICAgICAgfV0pOw0KDQogICAgICAgIHJldHVybiBuZXdTdGF0ZS5tYXAoZnVuY3Rpb24gKG9iaikgew0KICAgICAgICAgIHZhciBpdGVtID0gb2JqOw0KICAgICAgICAgIGl0ZW0uaGlnaGxpZ2h0ZWQgPSBmYWxzZTsNCiAgICAgICAgICByZXR1cm4gaXRlbTsNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICBjYXNlICdSRU1PVkVfSVRFTSc6DQogICAgICB7DQogICAgICAgIC8vIFNldCBpdGVtIHRvIGluYWN0aXZlDQogICAgICAgIHJldHVybiBzdGF0ZS5tYXAoZnVuY3Rpb24gKG9iaikgew0KICAgICAgICAgIHZhciBpdGVtID0gb2JqOw0KICAgICAgICAgIGlmIChpdGVtLmlkID09PSBhY3Rpb24uaWQpIHsNCiAgICAgICAgICAgIGl0ZW0uYWN0aXZlID0gZmFsc2U7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiBpdGVtOw0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgIGNhc2UgJ0hJR0hMSUdIVF9JVEVNJzoNCiAgICAgIHsNCiAgICAgICAgcmV0dXJuIHN0YXRlLm1hcChmdW5jdGlvbiAob2JqKSB7DQogICAgICAgICAgdmFyIGl0ZW0gPSBvYmo7DQogICAgICAgICAgaWYgKGl0ZW0uaWQgPT09IGFjdGlvbi5pZCkgew0KICAgICAgICAgICAgaXRlbS5oaWdobGlnaHRlZCA9IGFjdGlvbi5oaWdobGlnaHRlZDsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIGl0ZW07DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgZGVmYXVsdDoNCiAgICAgIHsNCiAgICAgICAgcmV0dXJuIHN0YXRlOw0KICAgICAgfQ0KICB9DQp9DQoNCi8qKiovIH0pLA0KLyogODAgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KZXhwb3J0cy5kZWZhdWx0ID0gZ3JvdXBzOw0KDQpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IGVsc2UgeyByZXR1cm4gQXJyYXkuZnJvbShhcnIpOyB9IH0NCg0KdmFyIGRlZmF1bHRTdGF0ZSA9IGV4cG9ydHMuZGVmYXVsdFN0YXRlID0gW107DQoNCmZ1bmN0aW9uIGdyb3VwcygpIHsNCiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBkZWZhdWx0U3RhdGU7DQogIHZhciBhY3Rpb24gPSBhcmd1bWVudHNbMV07DQoNCiAgc3dpdGNoIChhY3Rpb24udHlwZSkgew0KICAgIGNhc2UgJ0FERF9HUk9VUCc6DQogICAgICB7DQogICAgICAgIHJldHVybiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlKSwgW3sNCiAgICAgICAgICBpZDogYWN0aW9uLmlkLA0KICAgICAgICAgIHZhbHVlOiBhY3Rpb24udmFsdWUsDQogICAgICAgICAgYWN0aXZlOiBhY3Rpb24uYWN0aXZlLA0KICAgICAgICAgIGRpc2FibGVkOiBhY3Rpb24uZGlzYWJsZWQNCiAgICAgICAgfV0pOw0KICAgICAgfQ0KDQogICAgY2FzZSAnQ0xFQVJfQ0hPSUNFUyc6DQogICAgICB7DQogICAgICAgIHJldHVybiBbXTsNCiAgICAgIH0NCg0KICAgIGRlZmF1bHQ6DQogICAgICB7DQogICAgICAgIHJldHVybiBzdGF0ZTsNCiAgICAgIH0NCiAgfQ0KfQ0KDQovKioqLyB9KSwNCi8qIDgxICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCmV4cG9ydHMuZGVmYXVsdCA9IGNob2ljZXM7DQoNCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gZWxzZSB7IHJldHVybiBBcnJheS5mcm9tKGFycik7IH0gfQ0KDQp2YXIgZGVmYXVsdFN0YXRlID0gZXhwb3J0cy5kZWZhdWx0U3RhdGUgPSBbXTsNCg0KZnVuY3Rpb24gY2hvaWNlcygpIHsNCiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBkZWZhdWx0U3RhdGU7DQogIHZhciBhY3Rpb24gPSBhcmd1bWVudHNbMV07DQoNCiAgc3dpdGNoIChhY3Rpb24udHlwZSkgew0KICAgIGNhc2UgJ0FERF9DSE9JQ0UnOg0KICAgICAgew0KICAgICAgICAvKg0KICAgICAgICAgICAgQSBkaXNhYmxlZCBjaG9pY2UgYXBwZWFycyBpbiB0aGUgY2hvaWNlIGRyb3Bkb3duIGJ1dCBjYW5ub3QgYmUgc2VsZWN0ZWQNCiAgICAgICAgICAgIEEgc2VsZWN0ZWQgY2hvaWNlIGhhcyBiZWVuIGFkZGVkIHRvIHRoZSBwYXNzZWQgaW5wdXQncyB2YWx1ZSAoYWRkZWQgYXMgYW4gaXRlbSkNCiAgICAgICAgICAgIEFuIGFjdGl2ZSBjaG9pY2UgYXBwZWFycyB3aXRoaW4gdGhlIGNob2ljZSBkcm9wZG93bg0KICAgICAgICAgKi8NCiAgICAgICAgcmV0dXJuIFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoc3RhdGUpLCBbew0KICAgICAgICAgIGlkOiBhY3Rpb24uaWQsDQogICAgICAgICAgZWxlbWVudElkOiBhY3Rpb24uZWxlbWVudElkLA0KICAgICAgICAgIGdyb3VwSWQ6IGFjdGlvbi5ncm91cElkLA0KICAgICAgICAgIHZhbHVlOiBhY3Rpb24udmFsdWUsDQogICAgICAgICAgbGFiZWw6IGFjdGlvbi5sYWJlbCB8fCBhY3Rpb24udmFsdWUsDQogICAgICAgICAgZGlzYWJsZWQ6IGFjdGlvbi5kaXNhYmxlZCB8fCBmYWxzZSwNCiAgICAgICAgICBzZWxlY3RlZDogZmFsc2UsDQogICAgICAgICAgYWN0aXZlOiB0cnVlLA0KICAgICAgICAgIHNjb3JlOiA5OTk5LA0KICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGFjdGlvbi5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgIHBsYWNlaG9sZGVyOiBhY3Rpb24ucGxhY2Vob2xkZXIgfHwgZmFsc2UsDQogICAgICAgICAga2V5Q29kZTogbnVsbA0KICAgICAgICB9XSk7DQogICAgICB9DQoNCiAgICBjYXNlICdBRERfSVRFTSc6DQogICAgICB7DQogICAgICAgIC8vIElmIGFsbCBjaG9pY2VzIG5lZWQgdG8gYmUgYWN0aXZhdGVkDQogICAgICAgIGlmIChhY3Rpb24uYWN0aXZhdGVPcHRpb25zKSB7DQogICAgICAgICAgcmV0dXJuIHN0YXRlLm1hcChmdW5jdGlvbiAob2JqKSB7DQogICAgICAgICAgICB2YXIgY2hvaWNlID0gb2JqOw0KICAgICAgICAgICAgY2hvaWNlLmFjdGl2ZSA9IGFjdGlvbi5hY3RpdmU7DQogICAgICAgICAgICByZXR1cm4gY2hvaWNlOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gV2hlbiBhbiBpdGVtIGlzIGFkZGVkIGFuZCBpdCBoYXMgYW4gYXNzb2NpYXRlZCBjaG9pY2UsDQogICAgICAgIC8vIHdlIHdhbnQgdG8gZGlzYWJsZSBpdCBzbyBpdCBjYW4ndCBiZSBjaG9zZW4gYWdhaW4NCiAgICAgICAgaWYgKGFjdGlvbi5jaG9pY2VJZCA+IC0xKSB7DQogICAgICAgICAgcmV0dXJuIHN0YXRlLm1hcChmdW5jdGlvbiAob2JqKSB7DQogICAgICAgICAgICB2YXIgY2hvaWNlID0gb2JqOw0KICAgICAgICAgICAgaWYgKGNob2ljZS5pZCA9PT0gcGFyc2VJbnQoYWN0aW9uLmNob2ljZUlkLCAxMCkpIHsNCiAgICAgICAgICAgICAgY2hvaWNlLnNlbGVjdGVkID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBjaG9pY2U7DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gc3RhdGU7DQogICAgICB9DQoNCiAgICBjYXNlICdSRU1PVkVfSVRFTSc6DQogICAgICB7DQogICAgICAgIC8vIFdoZW4gYW4gaXRlbSBpcyByZW1vdmVkIGFuZCBpdCBoYXMgYW4gYXNzb2NpYXRlZCBjaG9pY2UsDQogICAgICAgIC8vIHdlIHdhbnQgdG8gcmUtZW5hYmxlIGl0IHNvIGl0IGNhbiBiZSBjaG9zZW4gYWdhaW4NCiAgICAgICAgaWYgKGFjdGlvbi5jaG9pY2VJZCA+IC0xKSB7DQogICAgICAgICAgcmV0dXJuIHN0YXRlLm1hcChmdW5jdGlvbiAob2JqKSB7DQogICAgICAgICAgICB2YXIgY2hvaWNlID0gb2JqOw0KICAgICAgICAgICAgaWYgKGNob2ljZS5pZCA9PT0gcGFyc2VJbnQoYWN0aW9uLmNob2ljZUlkLCAxMCkpIHsNCiAgICAgICAgICAgICAgY2hvaWNlLnNlbGVjdGVkID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gY2hvaWNlOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHN0YXRlOw0KICAgICAgfQ0KDQogICAgY2FzZSAnRklMVEVSX0NIT0lDRVMnOg0KICAgICAgew0KICAgICAgICByZXR1cm4gc3RhdGUubWFwKGZ1bmN0aW9uIChvYmopIHsNCiAgICAgICAgICB2YXIgY2hvaWNlID0gb2JqOw0KICAgICAgICAgIC8vIFNldCBhY3RpdmUgc3RhdGUgYmFzZWQgb24gd2hldGhlciBjaG9pY2UgaXMNCiAgICAgICAgICAvLyB3aXRoaW4gZmlsdGVyZWQgcmVzdWx0cw0KICAgICAgICAgIGNob2ljZS5hY3RpdmUgPSBhY3Rpb24ucmVzdWx0cy5zb21lKGZ1bmN0aW9uIChfcmVmKSB7DQogICAgICAgICAgICB2YXIgaXRlbSA9IF9yZWYuaXRlbSwNCiAgICAgICAgICAgICAgICBzY29yZSA9IF9yZWYuc2NvcmU7DQoNCiAgICAgICAgICAgIGlmIChpdGVtLmlkID09PSBjaG9pY2UuaWQpIHsNCiAgICAgICAgICAgICAgY2hvaWNlLnNjb3JlID0gc2NvcmU7DQogICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgIH0pOw0KDQogICAgICAgICAgcmV0dXJuIGNob2ljZTsNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICBjYXNlICdBQ1RJVkFURV9DSE9JQ0VTJzoNCiAgICAgIHsNCiAgICAgICAgcmV0dXJuIHN0YXRlLm1hcChmdW5jdGlvbiAob2JqKSB7DQogICAgICAgICAgdmFyIGNob2ljZSA9IG9iajsNCiAgICAgICAgICBjaG9pY2UuYWN0aXZlID0gYWN0aW9uLmFjdGl2ZTsNCiAgICAgICAgICByZXR1cm4gY2hvaWNlOw0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgIGNhc2UgJ0NMRUFSX0NIT0lDRVMnOg0KICAgICAgew0KICAgICAgICByZXR1cm4gZGVmYXVsdFN0YXRlOw0KICAgICAgfQ0KDQogICAgZGVmYXVsdDoNCiAgICAgIHsNCiAgICAgICAgcmV0dXJuIHN0YXRlOw0KICAgICAgfQ0KICB9DQp9DQoNCi8qKiovIH0pLA0KLyogODIgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KZXhwb3J0cy5XcmFwcGVkU2VsZWN0ID0gZXhwb3J0cy5XcmFwcGVkSW5wdXQgPSBleHBvcnRzLkxpc3QgPSBleHBvcnRzLklucHV0ID0gZXhwb3J0cy5Db250YWluZXIgPSBleHBvcnRzLkRyb3Bkb3duID0gdW5kZWZpbmVkOw0KDQp2YXIgX2Ryb3Bkb3duID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4Myk7DQoNCnZhciBfZHJvcGRvd24yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZHJvcGRvd24pOw0KDQp2YXIgX2NvbnRhaW5lciA9IF9fd2VicGFja19yZXF1aXJlX18oODQpOw0KDQp2YXIgX2NvbnRhaW5lcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jb250YWluZXIpOw0KDQp2YXIgX2lucHV0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NSk7DQoNCnZhciBfaW5wdXQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaW5wdXQpOw0KDQp2YXIgX2xpc3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg2KTsNCg0KdmFyIF9saXN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2xpc3QpOw0KDQp2YXIgX3dyYXBwZWRJbnB1dCA9IF9fd2VicGFja19yZXF1aXJlX18oODcpOw0KDQp2YXIgX3dyYXBwZWRJbnB1dDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF93cmFwcGVkSW5wdXQpOw0KDQp2YXIgX3dyYXBwZWRTZWxlY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg4KTsNCg0KdmFyIF93cmFwcGVkU2VsZWN0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3dyYXBwZWRTZWxlY3QpOw0KDQpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQ0KDQpleHBvcnRzLkRyb3Bkb3duID0gX2Ryb3Bkb3duMi5kZWZhdWx0Ow0KZXhwb3J0cy5Db250YWluZXIgPSBfY29udGFpbmVyMi5kZWZhdWx0Ow0KZXhwb3J0cy5JbnB1dCA9IF9pbnB1dDIuZGVmYXVsdDsNCmV4cG9ydHMuTGlzdCA9IF9saXN0Mi5kZWZhdWx0Ow0KZXhwb3J0cy5XcmFwcGVkSW5wdXQgPSBfd3JhcHBlZElucHV0Mi5kZWZhdWx0Ow0KZXhwb3J0cy5XcmFwcGVkU2VsZWN0ID0gX3dyYXBwZWRTZWxlY3QyLmRlZmF1bHQ7DQoNCi8qKiovIH0pLA0KLyogODMgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KDQp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsNCg0KZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9DQoNCnZhciBEcm9wZG93biA9IGZ1bmN0aW9uICgpIHsNCiAgZnVuY3Rpb24gRHJvcGRvd24oX3JlZikgew0KICAgIHZhciBlbGVtZW50ID0gX3JlZi5lbGVtZW50LA0KICAgICAgICB0eXBlID0gX3JlZi50eXBlLA0KICAgICAgICBjbGFzc05hbWVzID0gX3JlZi5jbGFzc05hbWVzOw0KDQogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERyb3Bkb3duKTsNCg0KICAgIE9iamVjdC5hc3NpZ24odGhpcywgeyBlbGVtZW50OiBlbGVtZW50LCB0eXBlOiB0eXBlLCBjbGFzc05hbWVzOiBjbGFzc05hbWVzIH0pOw0KDQogICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlOw0KICB9DQoNCiAgLyoqDQogICAqIERldGVybWluZSBob3cgZmFyIHRoZSB0b3Agb2Ygb3VyIGVsZW1lbnQgaXMgZnJvbQ0KICAgKiB0aGUgdG9wIG9mIHRoZSB3aW5kb3cNCiAgICogQHJldHVybiB7TnVtYmVyfSBWZXJ0aWNhbCBwb3NpdGlvbg0KICAgKi8NCg0KDQogIF9jcmVhdGVDbGFzcyhEcm9wZG93biwgW3sNCiAgICBrZXk6ICdkaXN0YW5jZUZyb21Ub3BXaW5kb3cnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBkaXN0YW5jZUZyb21Ub3BXaW5kb3coKSB7DQogICAgICB0aGlzLmRpbWVuc2lvbnMgPSB0aGlzLmVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICB0aGlzLnBvc2l0aW9uID0gTWF0aC5jZWlsKHRoaXMuZGltZW5zaW9ucy50b3AgKyB3aW5kb3cucGFnZVlPZmZzZXQgKyB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0KTsNCiAgICAgIHJldHVybiB0aGlzLnBvc2l0aW9uOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEZpbmQgZWxlbWVudCB0aGF0IG1hdGNoZXMgcGFzc2VkIHNlbGVjdG9yDQogICAgICogQHJldHVybiB7SFRNTEVsZW1lbnR9DQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2dldENoaWxkJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2hpbGQoc2VsZWN0b3IpIHsNCiAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2hvdyBkcm9wZG93biB0byB1c2VyIGJ5IGFkZGluZyBhY3RpdmUgc3RhdGUgY2xhc3MNCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENsYXNzIGluc3RhbmNlDQogICAgICogQHB1YmxpYw0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdzaG93JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvdygpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuY2xhc3NOYW1lcy5hY3RpdmVTdGF0ZSk7DQogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ3RydWUnKTsNCiAgICAgIHRoaXMuaXNBY3RpdmUgPSB0cnVlOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSGlkZSBkcm9wZG93biBmcm9tIHVzZXINCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENsYXNzIGluc3RhbmNlDQogICAgICogQHB1YmxpYw0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdoaWRlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gaGlkZSgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2xhc3NOYW1lcy5hY3RpdmVTdGF0ZSk7DQogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyk7DQogICAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH1dKTsNCg0KICByZXR1cm4gRHJvcGRvd247DQp9KCk7DQoNCmV4cG9ydHMuZGVmYXVsdCA9IERyb3Bkb3duOw0KDQovKioqLyB9KSwNCi8qIDg0ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCg0KdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7DQoNCnZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOw0KDQpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0NCg0KdmFyIENvbnRhaW5lciA9IGZ1bmN0aW9uICgpIHsNCiAgZnVuY3Rpb24gQ29udGFpbmVyKF9yZWYpIHsNCiAgICB2YXIgZWxlbWVudCA9IF9yZWYuZWxlbWVudCwNCiAgICAgICAgdHlwZSA9IF9yZWYudHlwZSwNCiAgICAgICAgY2xhc3NOYW1lcyA9IF9yZWYuY2xhc3NOYW1lcywNCiAgICAgICAgcG9zaXRpb24gPSBfcmVmLnBvc2l0aW9uOw0KDQogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENvbnRhaW5lcik7DQoNCiAgICBPYmplY3QuYXNzaWduKHRoaXMsIHsgZWxlbWVudDogZWxlbWVudCwgY2xhc3NOYW1lczogY2xhc3NOYW1lcywgdHlwZTogdHlwZSwgcG9zaXRpb246IHBvc2l0aW9uIH0pOw0KDQogICAgdGhpcy5pc09wZW4gPSBmYWxzZTsNCiAgICB0aGlzLmlzRmxpcHBlZCA9IGZhbHNlOw0KICAgIHRoaXMuaXNGb2N1c3NlZCA9IGZhbHNlOw0KICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlOw0KICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7DQoNCiAgICB0aGlzLl9vbkZvY3VzID0gdGhpcy5fb25Gb2N1cy5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uQmx1ciA9IHRoaXMuX29uQmx1ci5iaW5kKHRoaXMpOw0KICB9DQoNCiAgLyoqDQogICAqIEFkZCBldmVudCBsaXN0ZW5lcnMNCiAgICovDQoNCg0KICBfY3JlYXRlQ2xhc3MoQ29udGFpbmVyLCBbew0KICAgIGtleTogJ2FkZEV2ZW50TGlzdGVuZXJzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcnMoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9vbkZvY3VzKTsNCiAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5fb25CbHVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZW1vdmUgZXZlbnQgbGlzdGVuZXJzDQogICAgICovDQoNCiAgICAvKiogKi8NCg0KICB9LCB7DQogICAga2V5OiAncmVtb3ZlRXZlbnRMaXN0ZW5lcnMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVycygpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX29uRm9jdXMpOw0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIERldGVybWluZSB3aGV0aGVyIGNvbnRhaW5lciBzaG91bGQgYmUgZmxpcHBlZA0KICAgICAqIGJhc2VkIG9uIHBhc3NlZCBkcm9wZG93biBwb3NpdGlvbg0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkcm9wZG93blBvcw0KICAgICAqIEByZXR1cm5zDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ3Nob3VsZEZsaXAnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzaG91bGRGbGlwKGRyb3Bkb3duUG9zKSB7DQogICAgICB2YXIgd2luZG93SGVpZ2h0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAoMCwgX3V0aWxzLmdldFdpbmRvd0hlaWdodCkoKTsNCg0KICAgICAgaWYgKGRyb3Bkb3duUG9zID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KDQogICAgICAvLyBJZiBmbGlwIGlzIGVuYWJsZWQgYW5kIHRoZSBkcm9wZG93biBib3R0b20gcG9zaXRpb24gaXMNCiAgICAgIC8vIGdyZWF0ZXIgdGhhbiB0aGUgd2luZG93IGhlaWdodCBmbGlwIHRoZSBkcm9wZG93bi4NCiAgICAgIHZhciBzaG91bGRGbGlwID0gZmFsc2U7DQogICAgICBpZiAodGhpcy5wb3NpdGlvbiA9PT0gJ2F1dG8nKSB7DQogICAgICAgIHNob3VsZEZsaXAgPSBkcm9wZG93blBvcyA+PSB3aW5kb3dIZWlnaHQ7DQogICAgICB9IGVsc2UgaWYgKHRoaXMucG9zaXRpb24gPT09ICd0b3AnKSB7DQogICAgICAgIHNob3VsZEZsaXAgPSB0cnVlOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gc2hvdWxkRmxpcDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZXQgYWN0aXZlIGRlc2NlbmRhbnQgYXR0cmlidXRlDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IGFjdGl2ZURlc2NlbmRhbnQgSUQgb2YgYWN0aXZlIGRlc2NlbmRhbnQNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnc2V0QWN0aXZlRGVzY2VuZGFudCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNldEFjdGl2ZURlc2NlbmRhbnQoYWN0aXZlRGVzY2VuZGFudElEKSB7DQogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWFjdGl2ZWRlc2NlbmRhbnQnLCBhY3RpdmVEZXNjZW5kYW50SUQpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlbW92ZSBhY3RpdmUgZGVzY2VuZGFudCBhdHRyaWJ1dGUNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAncmVtb3ZlQWN0aXZlRGVzY2VuZGFudCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUFjdGl2ZURlc2NlbmRhbnQoKSB7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWFjdGl2ZWRlc2NlbmRhbnQnKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdvcGVuJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gb3Blbihkcm9wZG93blBvcykgew0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5jbGFzc05hbWVzLm9wZW5TdGF0ZSk7DQogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ3RydWUnKTsNCiAgICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTsNCg0KICAgICAgaWYgKHRoaXMuc2hvdWxkRmxpcChkcm9wZG93blBvcykpIHsNCiAgICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5jbGFzc05hbWVzLmZsaXBwZWRTdGF0ZSk7DQogICAgICAgIHRoaXMuaXNGbGlwcGVkID0gdHJ1ZTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdjbG9zZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGNsb3NlKCkgew0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5jbGFzc05hbWVzLm9wZW5TdGF0ZSk7DQogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgJ2ZhbHNlJyk7DQogICAgICB0aGlzLnJlbW92ZUFjdGl2ZURlc2NlbmRhbnQoKTsNCiAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7DQoNCiAgICAgIC8vIEEgZHJvcGRvd24gZmxpcHMgaWYgaXQgZG9lcyBub3QgaGF2ZSBzcGFjZSB3aXRoaW4gdGhlIHBhZ2UNCiAgICAgIGlmICh0aGlzLmlzRmxpcHBlZCkgew0KICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmNsYXNzTmFtZXMuZmxpcHBlZFN0YXRlKTsNCiAgICAgICAgdGhpcy5pc0ZsaXBwZWQgPSBmYWxzZTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdmb2N1cycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGZvY3VzKCkgew0KICAgICAgaWYgKCF0aGlzLmlzRm9jdXNzZWQpIHsNCiAgICAgICAgdGhpcy5lbGVtZW50LmZvY3VzKCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnYWRkRm9jdXNTdGF0ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEZvY3VzU3RhdGUoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLmNsYXNzTmFtZXMuZm9jdXNTdGF0ZSk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAncmVtb3ZlRm9jdXNTdGF0ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUZvY3VzU3RhdGUoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmNsYXNzTmFtZXMuZm9jdXNTdGF0ZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVtb3ZlIGRpc2FibGVkIHN0YXRlDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2VuYWJsZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGVuYWJsZSgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2xhc3NOYW1lcy5kaXNhYmxlZFN0YXRlKTsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtZGlzYWJsZWQnKTsNCiAgICAgIGlmICh0aGlzLnR5cGUgPT09ICdzZWxlY3Qtb25lJykgew0KICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7DQogICAgICB9DQogICAgICB0aGlzLmlzRGlzYWJsZWQgPSBmYWxzZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZXQgZGlzYWJsZWQgc3RhdGUNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnZGlzYWJsZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2FibGUoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLmNsYXNzTmFtZXMuZGlzYWJsZWRTdGF0ZSk7DQogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWRpc2FibGVkJywgJ3RydWUnKTsNCiAgICAgIGlmICh0aGlzLnR5cGUgPT09ICdzZWxlY3Qtb25lJykgew0KICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICctMScpOw0KICAgICAgfQ0KICAgICAgdGhpcy5pc0Rpc2FibGVkID0gdHJ1ZTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICd3cmFwJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gd3JhcChlbGVtZW50KSB7DQogICAgICAoMCwgX3V0aWxzLndyYXApKGVsZW1lbnQsIHRoaXMuZWxlbWVudCk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAndW53cmFwJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gdW53cmFwKGVsZW1lbnQpIHsNCiAgICAgIC8vIE1vdmUgcGFzc2VkIGVsZW1lbnQgb3V0c2lkZSB0aGlzIGVsZW1lbnQNCiAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlbGVtZW50LCB0aGlzLmVsZW1lbnQpOw0KICAgICAgLy8gUmVtb3ZlIHRoaXMgZWxlbWVudA0KICAgICAgdGhpcy5lbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBBZGQgbG9hZGluZyBzdGF0ZSB0byBlbGVtZW50DQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2FkZExvYWRpbmdTdGF0ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZExvYWRpbmdTdGF0ZSgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuY2xhc3NOYW1lcy5sb2FkaW5nU3RhdGUpOw0KICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1idXN5JywgJ3RydWUnKTsNCiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZW1vdmUgbG9hZGluZyBzdGF0ZSBmcm9tIGVsZW1lbnQNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAncmVtb3ZlTG9hZGluZ1N0YXRlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlTG9hZGluZ1N0YXRlKCkgew0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5jbGFzc05hbWVzLmxvYWRpbmdTdGF0ZSk7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWJ1c3knKTsNCiAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2V0IGZvY3Vzc2VkIHN0YXRlDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ19vbkZvY3VzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRm9jdXMoKSB7DQogICAgICB0aGlzLmlzRm9jdXNzZWQgPSB0cnVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlbW92ZSBibHVycmVkIHN0YXRlDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ19vbkJsdXInLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25CbHVyKCkgew0KICAgICAgdGhpcy5pc0ZvY3Vzc2VkID0gZmFsc2U7DQogICAgfQ0KICB9XSk7DQoNCiAgcmV0dXJuIENvbnRhaW5lcjsNCn0oKTsNCg0KZXhwb3J0cy5kZWZhdWx0ID0gQ29udGFpbmVyOw0KDQovKioqLyB9KSwNCi8qIDg1ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCg0KdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7DQoNCnZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOw0KDQpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0NCg0KdmFyIElucHV0ID0gZnVuY3Rpb24gKCkgew0KICBmdW5jdGlvbiBJbnB1dChfcmVmKSB7DQogICAgdmFyIGVsZW1lbnQgPSBfcmVmLmVsZW1lbnQsDQogICAgICAgIHR5cGUgPSBfcmVmLnR5cGUsDQogICAgICAgIGNsYXNzTmFtZXMgPSBfcmVmLmNsYXNzTmFtZXMsDQogICAgICAgIHBsYWNlaG9sZGVyVmFsdWUgPSBfcmVmLnBsYWNlaG9sZGVyVmFsdWU7DQoNCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSW5wdXQpOw0KDQogICAgT2JqZWN0LmFzc2lnbih0aGlzLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIHR5cGU6IHR5cGUsIGNsYXNzTmFtZXM6IGNsYXNzTmFtZXMsIHBsYWNlaG9sZGVyVmFsdWU6IHBsYWNlaG9sZGVyVmFsdWUgfSk7DQoNCiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50Ow0KICAgIHRoaXMuY2xhc3NOYW1lcyA9IGNsYXNzTmFtZXM7DQogICAgdGhpcy5pc0ZvY3Vzc2VkID0gdGhpcy5lbGVtZW50ID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50Ow0KICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlOw0KDQogICAgLy8gQmluZCBldmVudCBsaXN0ZW5lcnMNCiAgICB0aGlzLl9vblBhc3RlID0gdGhpcy5fb25QYXN0ZS5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uSW5wdXQgPSB0aGlzLl9vbklucHV0LmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25Gb2N1cyA9IHRoaXMuX29uRm9jdXMuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbkJsdXIgPSB0aGlzLl9vbkJsdXIuYmluZCh0aGlzKTsNCiAgfQ0KDQogIF9jcmVhdGVDbGFzcyhJbnB1dCwgW3sNCiAgICBrZXk6ICdhZGRFdmVudExpc3RlbmVycycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXJzKCkgew0KICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdGhpcy5fb25JbnB1dCk7DQogICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncGFzdGUnLCB0aGlzLl9vblBhc3RlKTsNCiAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX29uRm9jdXMpOw0KICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOw0KDQogICAgICBpZiAodGhpcy5lbGVtZW50LmZvcm0pIHsNCiAgICAgICAgdGhpcy5lbGVtZW50LmZvcm0uYWRkRXZlbnRMaXN0ZW5lcigncmVzZXQnLCB0aGlzLl9vbkZvcm1SZXNldCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAncmVtb3ZlRXZlbnRMaXN0ZW5lcnMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVycygpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdpbnB1dCcsIHRoaXMuX29uSW5wdXQpOw0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bhc3RlJywgdGhpcy5fb25QYXN0ZSk7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9vbkZvY3VzKTsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5fb25CbHVyKTsNCg0KICAgICAgaWYgKHRoaXMuZWxlbWVudC5mb3JtKSB7DQogICAgICAgIHRoaXMuZWxlbWVudC5mb3JtLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2V0JywgdGhpcy5fb25Gb3JtUmVzZXQpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2VuYWJsZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGVuYWJsZSgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7DQogICAgICB0aGlzLmlzRGlzYWJsZWQgPSBmYWxzZTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdkaXNhYmxlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzYWJsZSgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpOw0KICAgICAgdGhpcy5pc0Rpc2FibGVkID0gdHJ1ZTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdmb2N1cycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGZvY3VzKCkgew0KICAgICAgaWYgKCF0aGlzLmlzRm9jdXNzZWQpIHsNCiAgICAgICAgdGhpcy5lbGVtZW50LmZvY3VzKCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnYmx1cicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGJsdXIoKSB7DQogICAgICBpZiAodGhpcy5pc0ZvY3Vzc2VkKSB7DQogICAgICAgIHRoaXMuZWxlbWVudC5ibHVyKCk7DQogICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2V0IHZhbHVlIG9mIGlucHV0IHRvIGJsYW5rDQogICAgICogQHJldHVybiB7T2JqZWN0fSBDbGFzcyBpbnN0YW5jZQ0KICAgICAqIEBwdWJsaWMNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnY2xlYXInLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhcigpIHsNCiAgICAgIHZhciBzZXRXaWR0aCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogdHJ1ZTsNCg0KICAgICAgaWYgKHRoaXMuZWxlbWVudC52YWx1ZSkgew0KICAgICAgICB0aGlzLmVsZW1lbnQudmFsdWUgPSAnJzsNCiAgICAgIH0NCg0KICAgICAgaWYgKHNldFdpZHRoKSB7DQogICAgICAgIHRoaXMuc2V0V2lkdGgoKTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2V0IHRoZSBjb3JyZWN0IGlucHV0IHdpZHRoIGJhc2VkIG9uIHBsYWNlaG9sZGVyDQogICAgICogdmFsdWUgb3IgaW5wdXQgdmFsdWUNCiAgICAgKiBAcmV0dXJuDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ3NldFdpZHRoJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0V2lkdGgoZW5mb3JjZVdpZHRoKSB7DQogICAgICB2YXIgX3RoaXMgPSB0aGlzOw0KDQogICAgICB2YXIgY2FsbGJhY2sgPSBmdW5jdGlvbiBjYWxsYmFjayh3aWR0aCkgew0KICAgICAgICBfdGhpcy5lbGVtZW50LnN0eWxlLndpZHRoID0gd2lkdGg7DQogICAgICB9Ow0KDQogICAgICBpZiAodGhpcy5fcGxhY2Vob2xkZXJWYWx1ZSkgew0KICAgICAgICAvLyBJZiB0aGVyZSBpcyBhIHBsYWNlaG9sZGVyLCB3ZSBvbmx5IHdhbnQgdG8gc2V0IHRoZSB3aWR0aCBvZiB0aGUgaW5wdXQgd2hlbiBpdCBpcyBhIGdyZWF0ZXINCiAgICAgICAgLy8gbGVuZ3RoIHRoYW4gNzUlIG9mIHRoZSBwbGFjZWhvbGRlci4gVGhpcyBzdG9wcyB0aGUgaW5wdXQganVtcGluZyBhcm91bmQuDQogICAgICAgIHZhciB2YWx1ZUhhc0Rlc2lyZWRMZW5ndGggPSB0aGlzLmVsZW1lbnQudmFsdWUubGVuZ3RoID49IHRoaXMuX3BsYWNlaG9sZGVyVmFsdWUubGVuZ3RoIC8gMS4yNTsNCg0KICAgICAgICBpZiAodGhpcy5lbGVtZW50LnZhbHVlICYmIHZhbHVlSGFzRGVzaXJlZExlbmd0aCB8fCBlbmZvcmNlV2lkdGgpIHsNCiAgICAgICAgICB0aGlzLmNhbGNXaWR0aChjYWxsYmFjayk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIHBsYWNlaG9sZGVyLCByZXNpemUgaW5wdXQgdG8gY29udGVudHMNCiAgICAgICAgdGhpcy5jYWxjV2lkdGgoY2FsbGJhY2spOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2NhbGNXaWR0aCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGNhbGNXaWR0aChjYWxsYmFjaykgew0KICAgICAgcmV0dXJuICgwLCBfdXRpbHMuY2FsY1dpZHRoT2ZJbnB1dCkodGhpcy5lbGVtZW50LCBjYWxsYmFjayk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnc2V0QWN0aXZlRGVzY2VuZGFudCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNldEFjdGl2ZURlc2NlbmRhbnQoYWN0aXZlRGVzY2VuZGFudElEKSB7DQogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWFjdGl2ZWRlc2NlbmRhbnQnLCBhY3RpdmVEZXNjZW5kYW50SUQpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3JlbW92ZUFjdGl2ZURlc2NlbmRhbnQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVBY3RpdmVEZXNjZW5kYW50KCkgew0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1hY3RpdmVkZXNjZW5kYW50Jyk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uSW5wdXQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25JbnB1dCgpIHsNCiAgICAgIGlmICh0aGlzLnR5cGUgIT09ICdzZWxlY3Qtb25lJykgew0KICAgICAgICB0aGlzLnNldFdpZHRoKCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uUGFzdGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25QYXN0ZShldmVudCkgew0KICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDsNCiAgICAgIC8vIERpc2FibGUgcGFzdGluZyBpbnRvIHRoZSBpbnB1dCBpZiBvcHRpb24gaGFzIGJlZW4gc2V0DQoNCiAgICAgIGlmICh0YXJnZXQgPT09IHRoaXMuZWxlbWVudCAmJiB0aGlzLnByZXZlbnRQYXN0ZSkgew0KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbkZvY3VzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRm9jdXMoKSB7DQogICAgICB0aGlzLmlzRm9jdXNzZWQgPSB0cnVlOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbkJsdXInLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25CbHVyKCkgew0KICAgICAgdGhpcy5pc0ZvY3Vzc2VkID0gZmFsc2U7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAncGxhY2Vob2xkZXInLA0KICAgIHNldDogZnVuY3Rpb24gc2V0KHBsYWNlaG9sZGVyKSB7DQogICAgICB0aGlzLmVsZW1lbnQucGxhY2Vob2xkZXIgPSBwbGFjZWhvbGRlcjsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICd2YWx1ZScsDQogICAgc2V0OiBmdW5jdGlvbiBzZXQodmFsdWUpIHsNCiAgICAgIHRoaXMuZWxlbWVudC52YWx1ZSA9ICcnICsgdmFsdWU7DQogICAgfSwNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiAoMCwgX3V0aWxzLnN0cmlwSFRNTCkodGhpcy5lbGVtZW50LnZhbHVlKTsNCiAgICB9DQogIH1dKTsNCg0KICByZXR1cm4gSW5wdXQ7DQp9KCk7DQoNCmV4cG9ydHMuZGVmYXVsdCA9IElucHV0Ow0KDQovKioqLyB9KSwNCi8qIDg2ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCg0KdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7DQoNCnZhciBfY29uc3RhbnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsNCg0KZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9DQoNCnZhciBMaXN0ID0gZnVuY3Rpb24gKCkgew0KICBmdW5jdGlvbiBMaXN0KF9yZWYpIHsNCiAgICB2YXIgZWxlbWVudCA9IF9yZWYuZWxlbWVudDsNCg0KICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBMaXN0KTsNCg0KICAgIE9iamVjdC5hc3NpZ24odGhpcywgeyBlbGVtZW50OiBlbGVtZW50IH0pOw0KDQogICAgdGhpcy5zY3JvbGxQb3MgPSB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wOw0KICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodDsNCiAgICB0aGlzLmhhc0NoaWxkcmVuID0gISF0aGlzLmVsZW1lbnQuY2hpbGRyZW47DQogIH0NCg0KICBfY3JlYXRlQ2xhc3MoTGlzdCwgW3sNCiAgICBrZXk6ICdjbGVhcicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGNsZWFyKCkgew0KICAgICAgdGhpcy5lbGVtZW50LmlubmVySFRNTCA9ICcnOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2FwcGVuZCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGVuZChub2RlKSB7DQogICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQobm9kZSk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnZ2V0Q2hpbGQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDaGlsZChzZWxlY3Rvcikgew0KICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdzY3JvbGxUb1RvcCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNjcm9sbFRvVG9wKCkgew0KICAgICAgdGhpcy5lbGVtZW50LnNjcm9sbFRvcCA9IDA7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnc2Nyb2xsVG9DaG9pY2UnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzY3JvbGxUb0Nob2ljZShjaG9pY2UsIGRpcmVjdGlvbikgew0KICAgICAgdmFyIF90aGlzID0gdGhpczsNCg0KICAgICAgaWYgKCFjaG9pY2UpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB2YXIgZHJvcGRvd25IZWlnaHQgPSB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0Ow0KICAgICAgdmFyIGNob2ljZUhlaWdodCA9IGNob2ljZS5vZmZzZXRIZWlnaHQ7DQogICAgICAvLyBEaXN0YW5jZSBmcm9tIGJvdHRvbSBvZiBlbGVtZW50IHRvIHRvcCBvZiBwYXJlbnQNCiAgICAgIHZhciBjaG9pY2VQb3MgPSBjaG9pY2Uub2Zmc2V0VG9wICsgY2hvaWNlSGVpZ2h0Ow0KICAgICAgLy8gU2Nyb2xsIHBvc2l0aW9uIG9mIGRyb3Bkb3duDQogICAgICB2YXIgY29udGFpbmVyU2Nyb2xsUG9zID0gdGhpcy5lbGVtZW50LnNjcm9sbFRvcCArIGRyb3Bkb3duSGVpZ2h0Ow0KICAgICAgLy8gRGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBjaG9pY2UgYW5kIHNjcm9sbCBwb3NpdGlvbg0KICAgICAgdmFyIGVuZHBvaW50ID0gZGlyZWN0aW9uID4gMCA/IHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgKyBjaG9pY2VQb3MgLSBjb250YWluZXJTY3JvbGxQb3MgOiBjaG9pY2Uub2Zmc2V0VG9wOw0KDQogICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKHRpbWUpIHsNCiAgICAgICAgX3RoaXMuX2FuaW1hdGVTY3JvbGwodGltZSwgZW5kcG9pbnQsIGRpcmVjdGlvbik7DQogICAgICB9KTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfc2Nyb2xsRG93bicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9zY3JvbGxEb3duKHNjcm9sbFBvcywgc3RyZW5ndGgsIGVuZHBvaW50KSB7DQogICAgICB2YXIgZWFzaW5nID0gKGVuZHBvaW50IC0gc2Nyb2xsUG9zKSAvIHN0cmVuZ3RoOw0KICAgICAgdmFyIGRpc3RhbmNlID0gZWFzaW5nID4gMSA/IGVhc2luZyA6IDE7DQoNCiAgICAgIHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgPSBzY3JvbGxQb3MgKyBkaXN0YW5jZTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfc2Nyb2xsVXAnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfc2Nyb2xsVXAoc2Nyb2xsUG9zLCBzdHJlbmd0aCwgZW5kcG9pbnQpIHsNCiAgICAgIHZhciBlYXNpbmcgPSAoc2Nyb2xsUG9zIC0gZW5kcG9pbnQpIC8gc3RyZW5ndGg7DQogICAgICB2YXIgZGlzdGFuY2UgPSBlYXNpbmcgPiAxID8gZWFzaW5nIDogMTsNCg0KICAgICAgdGhpcy5lbGVtZW50LnNjcm9sbFRvcCA9IHNjcm9sbFBvcyAtIGRpc3RhbmNlOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19hbmltYXRlU2Nyb2xsJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FuaW1hdGVTY3JvbGwodGltZSwgZW5kcG9pbnQsIGRpcmVjdGlvbikgew0KICAgICAgdmFyIF90aGlzMiA9IHRoaXM7DQoNCiAgICAgIHZhciBzdHJlbmd0aCA9IF9jb25zdGFudHMuU0NST0xMSU5HX1NQRUVEOw0KICAgICAgdmFyIGNob2ljZUxpc3RTY3JvbGxUb3AgPSB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wOw0KICAgICAgdmFyIGNvbnRpbnVlQW5pbWF0aW9uID0gZmFsc2U7DQoNCiAgICAgIGlmIChkaXJlY3Rpb24gPiAwKSB7DQogICAgICAgIHRoaXMuX3Njcm9sbERvd24oY2hvaWNlTGlzdFNjcm9sbFRvcCwgc3RyZW5ndGgsIGVuZHBvaW50KTsNCg0KICAgICAgICBpZiAoY2hvaWNlTGlzdFNjcm9sbFRvcCA8IGVuZHBvaW50KSB7DQogICAgICAgICAgY29udGludWVBbmltYXRpb24gPSB0cnVlOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLl9zY3JvbGxVcChjaG9pY2VMaXN0U2Nyb2xsVG9wLCBzdHJlbmd0aCwgZW5kcG9pbnQpOw0KDQogICAgICAgIGlmIChjaG9pY2VMaXN0U2Nyb2xsVG9wID4gZW5kcG9pbnQpIHsNCiAgICAgICAgICBjb250aW51ZUFuaW1hdGlvbiA9IHRydWU7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgaWYgKGNvbnRpbnVlQW5pbWF0aW9uKSB7DQogICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7DQogICAgICAgICAgX3RoaXMyLl9hbmltYXRlU2Nyb2xsKHRpbWUsIGVuZHBvaW50LCBkaXJlY3Rpb24pOw0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9DQogIH1dKTsNCg0KICByZXR1cm4gTGlzdDsNCn0oKTsNCg0KZXhwb3J0cy5kZWZhdWx0ID0gTGlzdDsNCg0KLyoqKi8gfSksDQovKiA4NyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQoNCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOw0KDQp2YXIgX2dldCA9IGZ1bmN0aW9uIGdldChvYmplY3QsIHByb3BlcnR5LCByZWNlaXZlcikgeyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgcmV0dXJuIGdldChwYXJlbnQsIHByb3BlcnR5LCByZWNlaXZlcik7IH0gfSBlbHNlIGlmICgidmFsdWUiIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9Ow0KDQp2YXIgX3dyYXBwZWRFbGVtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNSk7DQoNCnZhciBfd3JhcHBlZEVsZW1lbnQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfd3JhcHBlZEVsZW1lbnQpOw0KDQp2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsNCg0KZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0NCg0KZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9DQoNCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikgPyBjYWxsIDogc2VsZjsgfQ0KDQpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQ0KDQp2YXIgV3JhcHBlZElucHV0ID0gZnVuY3Rpb24gKF9XcmFwcGVkRWxlbWVudCkgew0KICBfaW5oZXJpdHMoV3JhcHBlZElucHV0LCBfV3JhcHBlZEVsZW1lbnQpOw0KDQogIGZ1bmN0aW9uIFdyYXBwZWRJbnB1dChfcmVmKSB7DQogICAgdmFyIGVsZW1lbnQgPSBfcmVmLmVsZW1lbnQsDQogICAgICAgIGNsYXNzTmFtZXMgPSBfcmVmLmNsYXNzTmFtZXMsDQogICAgICAgIGRlbGltaXRlciA9IF9yZWYuZGVsaW1pdGVyOw0KDQogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFdyYXBwZWRJbnB1dCk7DQoNCiAgICB2YXIgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoV3JhcHBlZElucHV0Ll9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoV3JhcHBlZElucHV0KSkuY2FsbCh0aGlzLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIGNsYXNzTmFtZXM6IGNsYXNzTmFtZXMgfSkpOw0KDQogICAgX3RoaXMuZGVsaW1pdGVyID0gZGVsaW1pdGVyOw0KICAgIHJldHVybiBfdGhpczsNCiAgfQ0KDQogIF9jcmVhdGVDbGFzcyhXcmFwcGVkSW5wdXQsIFt7DQogICAga2V5OiAndmFsdWUnLA0KICAgIHNldDogZnVuY3Rpb24gc2V0KGl0ZW1zKSB7DQogICAgICB2YXIgaXRlbXNGaWx0ZXJlZCA9ICgwLCBfdXRpbHMucmVkdWNlVG9WYWx1ZXMpKGl0ZW1zKTsNCiAgICAgIHZhciBpdGVtc0ZpbHRlcmVkU3RyaW5nID0gaXRlbXNGaWx0ZXJlZC5qb2luKHRoaXMuZGVsaW1pdGVyKTsNCg0KICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgndmFsdWUnLCBpdGVtc0ZpbHRlcmVkU3RyaW5nKTsNCiAgICAgIHRoaXMuZWxlbWVudC52YWx1ZSA9IGl0ZW1zRmlsdGVyZWRTdHJpbmc7DQogICAgfQ0KDQogICAgLy8gQHRvZG8gZmlndXJlIG91dCB3aHkgd2UgbmVlZCB0aGlzPyBQZXJoYXBzIGEgYmFiZWwgaXNzdWUNCiAgICAsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gX2dldChXcmFwcGVkSW5wdXQucHJvdG90eXBlLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoV3JhcHBlZElucHV0LnByb3RvdHlwZSksICd2YWx1ZScsIHRoaXMpOw0KICAgIH0NCiAgfV0pOw0KDQogIHJldHVybiBXcmFwcGVkSW5wdXQ7DQp9KF93cmFwcGVkRWxlbWVudDIuZGVmYXVsdCk7DQoNCmV4cG9ydHMuZGVmYXVsdCA9IFdyYXBwZWRJbnB1dDsNCg0KLyoqKi8gfSksDQovKiA4OCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQoNCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOw0KDQp2YXIgX3dyYXBwZWRFbGVtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNSk7DQoNCnZhciBfd3JhcHBlZEVsZW1lbnQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfd3JhcHBlZEVsZW1lbnQpOw0KDQp2YXIgX3RlbXBsYXRlcyA9IF9fd2VicGFja19yZXF1aXJlX18oMzYpOw0KDQp2YXIgX3RlbXBsYXRlczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF90ZW1wbGF0ZXMpOw0KDQpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQ0KDQpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0NCg0KZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoIXNlbGYpIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSA/IGNhbGwgOiBzZWxmOyB9DQoNCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9DQoNCnZhciBXcmFwcGVkU2VsZWN0ID0gZnVuY3Rpb24gKF9XcmFwcGVkRWxlbWVudCkgew0KICBfaW5oZXJpdHMoV3JhcHBlZFNlbGVjdCwgX1dyYXBwZWRFbGVtZW50KTsNCg0KICBmdW5jdGlvbiBXcmFwcGVkU2VsZWN0KF9yZWYpIHsNCiAgICB2YXIgZWxlbWVudCA9IF9yZWYuZWxlbWVudCwNCiAgICAgICAgY2xhc3NOYW1lcyA9IF9yZWYuY2xhc3NOYW1lczsNCg0KICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBXcmFwcGVkU2VsZWN0KTsNCg0KICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoV3JhcHBlZFNlbGVjdC5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKFdyYXBwZWRTZWxlY3QpKS5jYWxsKHRoaXMsIHsgZWxlbWVudDogZWxlbWVudCwgY2xhc3NOYW1lczogY2xhc3NOYW1lcyB9KSk7DQogIH0NCg0KICBfY3JlYXRlQ2xhc3MoV3JhcHBlZFNlbGVjdCwgW3sNCiAgICBrZXk6ICdhcHBlbmREb2NGcmFnbWVudCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGFwcGVuZERvY0ZyYWdtZW50KGZyYWdtZW50KSB7DQogICAgICB0aGlzLmVsZW1lbnQuaW5uZXJIVE1MID0gJyc7DQogICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3BsYWNlaG9sZGVyT3B0aW9uJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3Rvcignb3B0aW9uW3BsYWNlaG9sZGVyXScpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ29wdGlvbkdyb3VwcycsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ09QVEdST1VQJykpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ29wdGlvbnMnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5lbGVtZW50Lm9wdGlvbnMpOw0KICAgIH0sDQogICAgc2V0OiBmdW5jdGlvbiBzZXQob3B0aW9ucykgew0KICAgICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KICAgICAgdmFyIGFkZE9wdGlvblRvRnJhZ21lbnQgPSBmdW5jdGlvbiBhZGRPcHRpb25Ub0ZyYWdtZW50KGRhdGEpIHsNCiAgICAgICAgLy8gQ3JlYXRlIGEgc3RhbmRhcmQgc2VsZWN0IG9wdGlvbg0KICAgICAgICB2YXIgdGVtcGxhdGUgPSBfdGVtcGxhdGVzMi5kZWZhdWx0Lm9wdGlvbihkYXRhKTsNCiAgICAgICAgLy8gQXBwZW5kIGl0IHRvIGZyYWdtZW50DQogICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHRlbXBsYXRlKTsNCiAgICAgIH07DQoNCiAgICAgIC8vIEFkZCBlYWNoIGxpc3QgaXRlbSB0byBsaXN0DQogICAgICBvcHRpb25zLmZvckVhY2goZnVuY3Rpb24gKG9wdGlvbkRhdGEpIHsNCiAgICAgICAgcmV0dXJuIGFkZE9wdGlvblRvRnJhZ21lbnQob3B0aW9uRGF0YSk7DQogICAgICB9KTsNCg0KICAgICAgdGhpcy5hcHBlbmREb2NGcmFnbWVudChmcmFnbWVudCk7DQogICAgfQ0KICB9XSk7DQoNCiAgcmV0dXJuIFdyYXBwZWRTZWxlY3Q7DQp9KF93cmFwcGVkRWxlbWVudDIuZGVmYXVsdCk7DQoNCmV4cG9ydHMuZGVmYXVsdCA9IFdyYXBwZWRTZWxlY3Q7DQoNCi8qKiovIH0pLA0KLyogODkgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIF9fV0VCUEFDS19BTURfREVGSU5FX0FSUkFZX18sIF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fOy8qIQ0KICBDb3B5cmlnaHQgKGMpIDIwMTYgSmVkIFdhdHNvbi4NCiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlIChNSVQpLCBzZWUNCiAgaHR0cDovL2plZHdhdHNvbi5naXRodWIuaW8vY2xhc3NuYW1lcw0KKi8NCi8qIGdsb2JhbCBkZWZpbmUgKi8NCg0KKGZ1bmN0aW9uICgpIHsNCgkndXNlIHN0cmljdCc7DQoNCgl2YXIgaGFzT3duID0ge30uaGFzT3duUHJvcGVydHk7DQoNCglmdW5jdGlvbiBjbGFzc05hbWVzICgpIHsNCgkJdmFyIGNsYXNzZXMgPSBbXTsNCg0KCQlmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgew0KCQkJdmFyIGFyZyA9IGFyZ3VtZW50c1tpXTsNCgkJCWlmICghYXJnKSBjb250aW51ZTsNCg0KCQkJdmFyIGFyZ1R5cGUgPSB0eXBlb2YgYXJnOw0KDQoJCQlpZiAoYXJnVHlwZSA9PT0gJ3N0cmluZycgfHwgYXJnVHlwZSA9PT0gJ251bWJlcicpIHsNCgkJCQljbGFzc2VzLnB1c2goYXJnKTsNCgkJCX0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShhcmcpKSB7DQoJCQkJY2xhc3Nlcy5wdXNoKGNsYXNzTmFtZXMuYXBwbHkobnVsbCwgYXJnKSk7DQoJCQl9IGVsc2UgaWYgKGFyZ1R5cGUgPT09ICdvYmplY3QnKSB7DQoJCQkJZm9yICh2YXIga2V5IGluIGFyZykgew0KCQkJCQlpZiAoaGFzT3duLmNhbGwoYXJnLCBrZXkpICYmIGFyZ1trZXldKSB7DQoJCQkJCQljbGFzc2VzLnB1c2goa2V5KTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoJCXJldHVybiBjbGFzc2VzLmpvaW4oJyAnKTsNCgl9DQoNCglpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHsNCgkJbW9kdWxlLmV4cG9ydHMgPSBjbGFzc05hbWVzOw0KCX0gZWxzZSBpZiAodHJ1ZSkgew0KCQkvLyByZWdpc3RlciBhcyAnY2xhc3NuYW1lcycsIGNvbnNpc3RlbnQgd2l0aCBucG0gcGFja2FnZSBuYW1lDQoJCSEoX19XRUJQQUNLX0FNRF9ERUZJTkVfQVJSQVlfXyA9IFtdLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXyA9IChmdW5jdGlvbiAoKSB7DQoJCQlyZXR1cm4gY2xhc3NOYW1lczsNCgkJfSkuYXBwbHkoZXhwb3J0cywgX19XRUJQQUNLX0FNRF9ERUZJTkVfQVJSQVlfXyksDQoJCQkJX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gIT09IHVuZGVmaW5lZCAmJiAobW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXykpOw0KCX0gZWxzZSB7DQoJCXdpbmRvdy5jbGFzc05hbWVzID0gY2xhc3NOYW1lczsNCgl9DQp9KCkpOw0KDQoNCi8qKiovIH0pLA0KLyogOTAgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KZXhwb3J0cy5jbGVhckNob2ljZXMgPSBleHBvcnRzLmFjdGl2YXRlQ2hvaWNlcyA9IGV4cG9ydHMuZmlsdGVyQ2hvaWNlcyA9IGV4cG9ydHMuYWRkQ2hvaWNlID0gdW5kZWZpbmVkOw0KDQp2YXIgX2NvbnN0YW50cyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7DQoNCnZhciBhZGRDaG9pY2UgPSBleHBvcnRzLmFkZENob2ljZSA9IGZ1bmN0aW9uIGFkZENob2ljZShfcmVmKSB7DQogIHZhciB2YWx1ZSA9IF9yZWYudmFsdWUsDQogICAgICBsYWJlbCA9IF9yZWYubGFiZWwsDQogICAgICBpZCA9IF9yZWYuaWQsDQogICAgICBncm91cElkID0gX3JlZi5ncm91cElkLA0KICAgICAgZGlzYWJsZWQgPSBfcmVmLmRpc2FibGVkLA0KICAgICAgZWxlbWVudElkID0gX3JlZi5lbGVtZW50SWQsDQogICAgICBjdXN0b21Qcm9wZXJ0aWVzID0gX3JlZi5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgcGxhY2Vob2xkZXIgPSBfcmVmLnBsYWNlaG9sZGVyLA0KICAgICAga2V5Q29kZSA9IF9yZWYua2V5Q29kZTsNCiAgcmV0dXJuIHsNCiAgICB0eXBlOiBfY29uc3RhbnRzLkFDVElPTl9UWVBFUy5BRERfQ0hPSUNFLA0KICAgIHZhbHVlOiB2YWx1ZSwNCiAgICBsYWJlbDogbGFiZWwsDQogICAgaWQ6IGlkLA0KICAgIGdyb3VwSWQ6IGdyb3VwSWQsDQogICAgZGlzYWJsZWQ6IGRpc2FibGVkLA0KICAgIGVsZW1lbnRJZDogZWxlbWVudElkLA0KICAgIGN1c3RvbVByb3BlcnRpZXM6IGN1c3RvbVByb3BlcnRpZXMsDQogICAgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyLA0KICAgIGtleUNvZGU6IGtleUNvZGUNCiAgfTsNCn07DQoNCnZhciBmaWx0ZXJDaG9pY2VzID0gZXhwb3J0cy5maWx0ZXJDaG9pY2VzID0gZnVuY3Rpb24gZmlsdGVyQ2hvaWNlcyhyZXN1bHRzKSB7DQogIHJldHVybiB7DQogICAgdHlwZTogX2NvbnN0YW50cy5BQ1RJT05fVFlQRVMuRklMVEVSX0NIT0lDRVMsDQogICAgcmVzdWx0czogcmVzdWx0cw0KICB9Ow0KfTsNCg0KdmFyIGFjdGl2YXRlQ2hvaWNlcyA9IGV4cG9ydHMuYWN0aXZhdGVDaG9pY2VzID0gZnVuY3Rpb24gYWN0aXZhdGVDaG9pY2VzKCkgew0KICB2YXIgYWN0aXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB0cnVlOw0KICByZXR1cm4gew0KICAgIHR5cGU6IF9jb25zdGFudHMuQUNUSU9OX1RZUEVTLkFDVElWQVRFX0NIT0lDRVMsDQogICAgYWN0aXZlOiBhY3RpdmUNCiAgfTsNCn07DQoNCnZhciBjbGVhckNob2ljZXMgPSBleHBvcnRzLmNsZWFyQ2hvaWNlcyA9IGZ1bmN0aW9uIGNsZWFyQ2hvaWNlcygpIHsNCiAgcmV0dXJuIHsNCiAgICB0eXBlOiBfY29uc3RhbnRzLkFDVElPTl9UWVBFUy5DTEVBUl9DSE9JQ0VTDQogIH07DQp9Ow0KDQovKioqLyB9KSwNCi8qIDkxICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCmV4cG9ydHMuaGlnaGxpZ2h0SXRlbSA9IGV4cG9ydHMucmVtb3ZlSXRlbSA9IGV4cG9ydHMuYWRkSXRlbSA9IHVuZGVmaW5lZDsNCg0KdmFyIF9jb25zdGFudHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOw0KDQp2YXIgYWRkSXRlbSA9IGV4cG9ydHMuYWRkSXRlbSA9IGZ1bmN0aW9uIGFkZEl0ZW0oX3JlZikgew0KICB2YXIgdmFsdWUgPSBfcmVmLnZhbHVlLA0KICAgICAgbGFiZWwgPSBfcmVmLmxhYmVsLA0KICAgICAgaWQgPSBfcmVmLmlkLA0KICAgICAgY2hvaWNlSWQgPSBfcmVmLmNob2ljZUlkLA0KICAgICAgZ3JvdXBJZCA9IF9yZWYuZ3JvdXBJZCwNCiAgICAgIGN1c3RvbVByb3BlcnRpZXMgPSBfcmVmLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICBwbGFjZWhvbGRlciA9IF9yZWYucGxhY2Vob2xkZXIsDQogICAgICBrZXlDb2RlID0gX3JlZi5rZXlDb2RlOw0KICByZXR1cm4gew0KICAgIHR5cGU6IF9jb25zdGFudHMuQUNUSU9OX1RZUEVTLkFERF9JVEVNLA0KICAgIHZhbHVlOiB2YWx1ZSwNCiAgICBsYWJlbDogbGFiZWwsDQogICAgaWQ6IGlkLA0KICAgIGNob2ljZUlkOiBjaG9pY2VJZCwNCiAgICBncm91cElkOiBncm91cElkLA0KICAgIGN1c3RvbVByb3BlcnRpZXM6IGN1c3RvbVByb3BlcnRpZXMsDQogICAgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyLA0KICAgIGtleUNvZGU6IGtleUNvZGUNCiAgfTsNCn07DQoNCnZhciByZW1vdmVJdGVtID0gZXhwb3J0cy5yZW1vdmVJdGVtID0gZnVuY3Rpb24gcmVtb3ZlSXRlbShpZCwgY2hvaWNlSWQpIHsNCiAgcmV0dXJuIHsNCiAgICB0eXBlOiBfY29uc3RhbnRzLkFDVElPTl9UWVBFUy5SRU1PVkVfSVRFTSwNCiAgICBpZDogaWQsDQogICAgY2hvaWNlSWQ6IGNob2ljZUlkDQogIH07DQp9Ow0KDQp2YXIgaGlnaGxpZ2h0SXRlbSA9IGV4cG9ydHMuaGlnaGxpZ2h0SXRlbSA9IGZ1bmN0aW9uIGhpZ2hsaWdodEl0ZW0oaWQsIGhpZ2hsaWdodGVkKSB7DQogIHJldHVybiB7DQogICAgdHlwZTogX2NvbnN0YW50cy5BQ1RJT05fVFlQRVMuSElHSExJR0hUX0lURU0sDQogICAgaWQ6IGlkLA0KICAgIGhpZ2hsaWdodGVkOiBoaWdobGlnaHRlZA0KICB9Ow0KfTsNCg0KLyoqKi8gfSksDQovKiA5MiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQpleHBvcnRzLmFkZEdyb3VwID0gdW5kZWZpbmVkOw0KDQp2YXIgX2NvbnN0YW50cyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7DQoNCi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9wcmVmZXItZGVmYXVsdC1leHBvcnQgKi8NCnZhciBhZGRHcm91cCA9IGV4cG9ydHMuYWRkR3JvdXAgPSBmdW5jdGlvbiBhZGRHcm91cCh2YWx1ZSwgaWQsIGFjdGl2ZSwgZGlzYWJsZWQpIHsNCiAgcmV0dXJuIHsNCiAgICB0eXBlOiBfY29uc3RhbnRzLkFDVElPTl9UWVBFUy5BRERfR1JPVVAsDQogICAgdmFsdWU6IHZhbHVlLA0KICAgIGlkOiBpZCwNCiAgICBhY3RpdmU6IGFjdGl2ZSwNCiAgICBkaXNhYmxlZDogZGlzYWJsZWQNCiAgfTsNCn07DQoNCi8qKiovIH0pLA0KLyogOTMgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KdmFyIGNsZWFyQWxsID0gZXhwb3J0cy5jbGVhckFsbCA9IGZ1bmN0aW9uIGNsZWFyQWxsKCkgew0KICByZXR1cm4gew0KICAgIHR5cGU6ICdDTEVBUl9BTEwnDQogIH07DQp9Ow0KDQp2YXIgcmVzZXRUbyA9IGV4cG9ydHMucmVzZXRUbyA9IGZ1bmN0aW9uIHJlc2V0VG8oc3RhdGUpIHsNCiAgcmV0dXJuIHsNCiAgICB0eXBlOiAnUkVTRVRfVE8nLA0KICAgIHN0YXRlOiBzdGF0ZQ0KICB9Ow0KfTsNCg0KLyoqKi8gfSkNCi8qKioqKiovIF0pOw0KfSk7DQovLyMgc291cmNlTWFwcGluZ1VSTD1jaG9pY2VzLmpzLm1hcA0KICA8L3NjcmlwdD4NCg0KICA8IS0tVHJhdmVsIExlYWRlcnMgQ29udGVudC0tPg0KICA8IS0tPHNjcmlwdCBzcmM9ImphdmFzY3JpcHRzL2NvbXBsZWF0LXZlbmRvci1kZWJ1Zy1wYXJzZXIuanMiPjwvc2NyaXB0Pi0tPg0KICA8c2NyaXB0Pi8qKioNCiogQ29tcGxlYXQgVmVuZG9yIERlYnVnIHBhcnNlciBmb3IgSmF2YVNjcmlwdA0KKg0KKiBDb3B5cmlnaHQgKGMpIDIwMTQgVG9kZCBIYW1ibGV5IChNSVQgTGljZW5zZSkuDQoqDQoqLw0KICAgIC8qanNoaW50DQogICAgICBsYXhjb21tYTp0cnVlDQogICAgICBsYXhicmVhazp0cnVlDQogICAgICBlcW51bGw6dHJ1ZQ0KICAgICAgbG9vcGZ1bmM6dHJ1ZQ0KICAgICAgc3ViOnRydWUNCiAgICAqLw0KICAgIDsgKGZ1bmN0aW9uICgpIHsNCiAgICAgICJ1c2Ugc3RyaWN0IjsNCg0KICAgICAgLy8gb25seSBydW4gd2hlbiB0aGUgc3Vic3RyKCkgZnVuY3Rpb24gaXMgYnJva2VuDQogICAgICBpZiAoJ2FiJy5zdWJzdHIoLTEpICE9ICdiJykgew0KICAgICAgICAvKioNCiAgICAgICAgICogIEdldCB0aGUgc3Vic3RyaW5nIG9mIGEgc3RyaW5nDQogICAgICAgICAqICBAcGFyYW0gIHtpbnRlZ2VyfSAgc3RhcnQgICB3aGVyZSB0byBzdGFydCB0aGUgc3Vic3RyaW5nDQogICAgICAgICAqICBAcGFyYW0gIHtpbnRlZ2VyfSAgbGVuZ3RoICBob3cgbWFueSBjaGFyYWN0ZXJzIHRvIHJldHVybg0KICAgICAgICAgKiAgQHJldHVybiB7c3RyaW5nfQ0KICAgICAgICAgKi8NCiAgICAgICAgU3RyaW5nLnByb3RvdHlwZS5zdWJzdHIgPSBmdW5jdGlvbiAoc3Vic3RyKSB7DQogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzdGFydCwgbGVuZ3RoKSB7DQogICAgICAgICAgICAvLyBkaWQgd2UgZ2V0IGEgbmVnYXRpdmUgc3RhcnQsIGNhbGN1bGF0ZSBob3cgbXVjaCBpdCBpcw0KICAgICAgICAgICAgLy8gZnJvbSB0aGUgYmVnaW5uaW5nIG9mIHRoZSBzdHJpbmcNCiAgICAgICAgICAgIGlmIChzdGFydCA8IDApIHsNCiAgICAgICAgICAgICAgc3RhcnQgPSB0aGlzLmxlbmd0aCArIHN0YXJ0Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBjYWxsIHRoZSBvcmlnaW5hbCBmdW5jdGlvbg0KICAgICAgICAgICAgcmV0dXJuIHN1YnN0ci5jYWxsKHRoaXMsIHN0YXJ0LCBsZW5ndGgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfShTdHJpbmcucHJvdG90eXBlLnN1YnN0cik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHJpZ2h0QWxpZ25aZXJvUGFkZGluZyhpbnB1dFN0cmluZykgew0KICAgICAgICByZXR1cm4gKCcwMCcgKyBpbnB1dFN0cmluZykuc3Vic3RyKC0yKTsNCiAgICAgIH0NCg0KICAgICAgLy8gbG9nIGNhdGVnb3J5DQogICAgICAvLyBsb2cgbGV2ZWwNCiAgICAgIC8vIGxvZyBkYXRlVGltZQ0KICAgICAgLy8gbG9nIHRleHQNCiAgICAgIGZ1bmN0aW9uIHBhcnNlRGVidWdMb2cobG9nVGV4dCkgew0KICAgICAgICB2YXIgbG9nTGluZXMgPSBsb2dUZXh0LnNwbGl0KCdcbicpOw0KICAgICAgICB2YXIgbG9nRW50cmllcyA9IFtdOw0KICAgICAgICB2YXIgbG9nRW50cnlOdW1iZXIgPSAtMTsNCiAgICAgICAgLy8gZXhhbXBsZSBsb2cgZW50cmllczoNCiAgICAgICAgLy8gW1cjMzc5OSAoNjApIFdSSzFdIC0tIHtSZXF1ZXN0fSAtLSA8RGVidWc+IC0tIDExLzIxLzE0IDE1OjM3OjU3LjkxNCAtLSBRLzdWQS8yNipDNw0KICAgICAgICAvLyB7bG9nIGluZm99IC0tIDxsb2cgbGV2ZWw+IC0tIGxvZyB0aW1lIC0tIGxvZyB0ZXh0DQogICAgICAgIC8vIHtJbmZvcm1hdGlvbkNsYXNzaWZpY2F0aW9ufSAtLSA8SW5mbz4gLS0gMTIvMjYvMTMgMjM6NTE6MDQuODcwIC0tIFRoaXMgTG9nIENvbnRhaW5zIFByaXZpbGVnZWQgSW5mb3JtYXRpb24uDQogICAgICAgIC8vIDxsb2cgbGV2ZWw+IC0tIGxvZyB0aW1lIC0tIGxvZyB0ZXh0DQogICAgICAgIC8vIDxTdGF0dXM+IC0tIDEyLzI2LzEzIDIzOjUxOjA2LjMyMSAtLSBDb25uZWN0ZWQuDQogICAgICAgIHZhciBjdXJyZW50V29ya2Zsb3cgPSAnJzsNCiAgICAgICAgdmFyIGN1cnJlbnRQcm9jZXNzID0gJyc7DQogICAgICAgIHZhciBjdXJyZW50Um91dGluZSA9ICcnOw0KICAgICAgICB2YXIgY3VycmVudExvY2F0b3IgPSAnJzsNCg0KICAgICAgICB2YXIgbG9nRW50cnlSZWdFeCA9IC9eKD86W1xbXVcjKFswLTldKykgW1woXShbMC05XSspW1wpXSBbQS1aXGRdKj9XUksoWzAtOV0rKVtcXV0gLS0gKT8oPzpbXHtdKFteXH1dKylbXH1dIC0tICk/KD86W1w8XShbQS1aYS16XSspW1w+XSAtLSApKD86KFswLTldezEsMn0pXC8oWzAtOV17MSwyfSlcLyhbMC05XXsyfSkgKFswLTldezEsMn0pOihbMC05XXsyfSk6KFswLTldezJ9KS4oWzAtOV17M30pIC0tICkoLispLzsNCiAgICAgICAgdmFyIGxvZ1NlcGFyYXRvclJlZ0V4ID0gL15bXC1dezIwfShbXGRdKylcLyhbXGRdKylcLyhbXGRdKykgKFtcZF0rKTooW1xkXSspOihbXGRdKykgKFtBUF1NKSBbXChdVVRDW1wpXVtcLV17MjB9LzsNCiAgICAgICAgdmFyIHJvdXRpbmVOYW1lUmVnRXggPSAvUm91dGluZSAoW0EtWmEtel9dKykvOw0KICAgICAgICB2YXIgbmFtZVJlZ0V4ID0gLyIoW14iXSspIi87DQogICAgICAgIGZvciAodmFyIGxpbmVOdW1iZXIgPSAwOyBsaW5lTnVtYmVyIDwgbG9nTGluZXMubGVuZ3RoOyBsaW5lTnVtYmVyKyspIHsNCiAgICAgICAgICBpZiAobG9nRW50cnlSZWdFeC50ZXN0KGxvZ0xpbmVzW2xpbmVOdW1iZXJdKSkgew0KICAgICAgICAgICAgbG9nRW50cnlOdW1iZXIrKzsNCiAgICAgICAgICAgIHZhciBsb2dNYXRjaCA9IGxvZ0VudHJ5UmVnRXguZXhlYyhsb2dMaW5lc1tsaW5lTnVtYmVyXSk7DQogICAgICAgICAgICB2YXIgY3VycmVudExvZ0VudHJ5ID0gY3VycmVudExvZ0VudHJ5ID0gew0KICAgICAgICAgICAgICBsaW5lTnVtYmVyOiBsaW5lTnVtYmVyICsgMSwNCiAgICAgICAgICAgICAgd29ya2VyOiBwYXJzZUludChsb2dNYXRjaFsxXSB8fCAnLTEnKSwNCiAgICAgICAgICAgICAgYWdlbmN5OiBwYXJzZUludChsb2dNYXRjaFsyXSB8fCAnLTEnKSwNCiAgICAgICAgICAgICAgd29ya3N0YXRpb246IHBhcnNlSW50KGxvZ01hdGNoWzNdIHx8ICctMScpLA0KICAgICAgICAgICAgICBjYXRlZ29yeTogbG9nTWF0Y2hbNF0gfHwgJycsDQogICAgICAgICAgICAgIGxldmVsOiBsb2dNYXRjaFs1XSwNCiAgICAgICAgICAgICAgZGF0ZVRpbWU6IG5ldyBEYXRlKERhdGUuVVRDKHBhcnNlSW50KCcyMCcgKyBsb2dNYXRjaFs4XSwgMTApLCBwYXJzZUludChsb2dNYXRjaFs2XSwgMTApIC0gMSwgcGFyc2VJbnQobG9nTWF0Y2hbN10sIDEwKSwgcGFyc2VJbnQobG9nTWF0Y2hbOV0sIDEwKSwgcGFyc2VJbnQobG9nTWF0Y2hbMTBdLCAxMCksIHBhcnNlSW50KGxvZ01hdGNoWzExXSwgMTApLCBwYXJzZUludChsb2dNYXRjaFsxMl0sIDEwKSkpLA0KICAgICAgICAgICAgICBkYXRlVGltZVRleHQ6ICcyMCcgKyBsb2dNYXRjaFs4XSArICctJyArIHJpZ2h0QWxpZ25aZXJvUGFkZGluZyhsb2dNYXRjaFs2XSkgKyAnLScgKyByaWdodEFsaWduWmVyb1BhZGRpbmcobG9nTWF0Y2hbN10pICsgJyAnICsgcmlnaHRBbGlnblplcm9QYWRkaW5nKGxvZ01hdGNoWzldKSArICc6JyArIGxvZ01hdGNoWzEwXSArICc6JyArIGxvZ01hdGNoWzExXSArICcuJyArIGxvZ01hdGNoWzEyXSwNCiAgICAgICAgICAgICAgdGV4dDogbG9nTWF0Y2hbMTNdLnJlcGxhY2UoLyAgL2csICIgJm5ic3A7IiksDQogICAgICAgICAgICAgIHdvcmtmbG93OiBjdXJyZW50V29ya2Zsb3csDQogICAgICAgICAgICAgIHByb2Nlc3M6IGN1cnJlbnRQcm9jZXNzLA0KICAgICAgICAgICAgICByb3V0aW5lOiBjdXJyZW50Um91dGluZSwNCiAgICAgICAgICAgICAgcG5yTG9jYXRvcjogY3VycmVudExvY2F0b3INCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGxvZ0VudHJpZXNbbG9nRW50cnlOdW1iZXJdID0gY3VycmVudExvZ0VudHJ5Ow0KICAgICAgICAgICAgc3dpdGNoIChjdXJyZW50TG9nRW50cnkuY2F0ZWdvcnkpIHsNCiAgICAgICAgICAgICAgY2FzZSAnUXVldWVQcm9jZXNzJzoNCiAgICAgICAgICAgICAgICBpZiAobmFtZVJlZ0V4LnRlc3QoY3VycmVudExvZ0VudHJ5LnRleHQpKSB7DQogICAgICAgICAgICAgICAgICB2YXIgbmFtZU1hdGNoID0gbmFtZVJlZ0V4LmV4ZWMoY3VycmVudExvZ0VudHJ5LnRleHQpOw0KICAgICAgICAgICAgICAgICAgLy8gc2V0IHdvcmtmbG93DQogICAgICAgICAgICAgICAgICBjdXJyZW50TG9nRW50cnkud29ya2Zsb3cgPSBjdXJyZW50V29ya2Zsb3cgPSBuYW1lTWF0Y2hbMV07DQogICAgICAgICAgICAgICAgICAvLyBjbGVhciBwcm9jZXNzIGFuZCByb3V0aW5lDQogICAgICAgICAgICAgICAgICBjdXJyZW50TG9nRW50cnkucHJvY2VzcyA9IGN1cnJlbnRQcm9jZXNzID0gJyc7DQogICAgICAgICAgICAgICAgICBjdXJyZW50TG9nRW50cnkucm91dGluZSA9IGN1cnJlbnRSb3V0aW5lID0gJyc7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGFsZXJ0KCd3b3JrZmxvdyBuYW1lIG5vdCBmb3VuZDonICsgY3VycmVudExvZ0VudHJ5LnRleHQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgY2FzZSAnUHJvY2Vzc0V4ZWN1dGUnOg0KICAgICAgICAgICAgICAgIGlmIChuYW1lUmVnRXgudGVzdChjdXJyZW50TG9nRW50cnkudGV4dCkpIHsNCiAgICAgICAgICAgICAgICAgIHZhciBuYW1lTWF0Y2ggPSBuYW1lUmVnRXguZXhlYyhjdXJyZW50TG9nRW50cnkudGV4dCk7DQogICAgICAgICAgICAgICAgICAvLyBzZXQgcHJvY2Vzcw0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnByb2Nlc3MgPSBjdXJyZW50UHJvY2VzcyA9IG5hbWVNYXRjaFsxXTsNCiAgICAgICAgICAgICAgICAgIC8vIGNsZWFyIHJvdXRpbmUNCiAgICAgICAgICAgICAgICAgIGN1cnJlbnRMb2dFbnRyeS5yb3V0aW5lID0gY3VycmVudFJvdXRpbmUgPSAnJzsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgYWxlcnQoJ3Byb2Nlc3MgbmFtZSBub3QgZm91bmQ6JyArIGN1cnJlbnRMb2dFbnRyeS50ZXh0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgIGNhc2UgJ1BuclRlc3RzRXhlY3V0ZSc6DQogICAgICAgICAgICAgICAgLy8gcm91dGluZQ0KICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TG9nRW50cnkudGV4dCA9PT0gJ0FsbCByb3V0aW5lcyBmaW5pc2hlZC4nKSB7DQogICAgICAgICAgICAgICAgICAvLyBjbGVhcg0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnJvdXRpbmUgPSBjdXJyZW50Um91dGluZSA9ICcnOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBpZiAocm91dGluZU5hbWVSZWdFeC50ZXN0KGN1cnJlbnRMb2dFbnRyeS50ZXh0KSkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZU1hdGNoID0gcm91dGluZU5hbWVSZWdFeC5leGVjKGN1cnJlbnRMb2dFbnRyeS50ZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnJvdXRpbmUgPSBjdXJyZW50Um91dGluZSA9IG5hbWVNYXRjaFsxXTsNCiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmFtZVJlZ0V4LnRlc3QoY3VycmVudExvZ0VudHJ5LnRleHQpKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBuYW1lTWF0Y2ggPSBuYW1lUmVnRXguZXhlYyhjdXJyZW50TG9nRW50cnkudGV4dCk7DQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMb2dFbnRyeS5yb3V0aW5lID0gY3VycmVudFJvdXRpbmUgPSBuYW1lTWF0Y2hbMV07DQogICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBhbGVydCgncm91dGluZSBuYW1lIG5vdCBmb3VuZDonICsgY3VycmVudExvZ0VudHJ5LnRleHQpOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgY2FzZSAnJzoNCiAgICAgICAgICAgICAgICAvLyBjaGVjayBmb3IgbGV2ZWwgPSAnZGVidWcnIGFuZCBwcmVzZW5jZSBvZiAiZW5jb3VudGVyZWQiIGluIHRleHQNCiAgICAgICAgICAgICAgICBpZiAoKGN1cnJlbnRMb2dFbnRyeS5sZXZlbCA9PT0gJ0RlYnVnJykgJiYgKGN1cnJlbnRMb2dFbnRyeS50ZXh0LnN1YnN0cigwLCAxMSkgPT09ICdFbmNvdW50ZXJlZCcpKSB7DQogICAgICAgICAgICAgICAgICAvLyBzZXQgbG9jYXRvcg0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnBuckxvY2F0b3IgPSBjdXJyZW50TG9jYXRvciA9IGN1cnJlbnRMb2dFbnRyeS50ZXh0LnN1YnN0cigxMik7DQogICAgICAgICAgICAgICAgICAvLyBjbGVhciB3b3JrZmxvdywgcHJvY2VzcyBhbmQgcm91dGluZQ0KICAgICAgICAgICAgICAgICAgLy8gY3VycmVudExvZ0VudHJ5LndvcmtmbG93ID0gY3VycmVudFdvcmtmbG93ID0gJyc7DQogICAgICAgICAgICAgICAgICBjdXJyZW50TG9nRW50cnkucHJvY2VzcyA9IGN1cnJlbnRQcm9jZXNzID0gJyc7DQogICAgICAgICAgICAgICAgICBjdXJyZW50TG9nRW50cnkucm91dGluZSA9IGN1cnJlbnRSb3V0aW5lID0gJyc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgfSBlbHNlIGlmIChsb2dFbnRyeU51bWJlciA+IC0xKSB7DQogICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLTExLzIxLzIwMTQgMzozNzo1NyBQTSAoVVRDKS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICBpZiAobG9nU2VwYXJhdG9yUmVnRXgudGVzdChsb2dMaW5lc1tsaW5lTnVtYmVyXSkpIHsNCiAgICAgICAgICAgICAgY3VycmVudFdvcmtmbG93ID0gJyc7DQogICAgICAgICAgICAgIGN1cnJlbnRQcm9jZXNzID0gJyc7DQogICAgICAgICAgICAgIGN1cnJlbnRSb3V0aW5lID0gJyc7DQogICAgICAgICAgICAgIGN1cnJlbnRMb2NhdG9yID0gJyc7DQoNCiAgICAgICAgICAgICAgdmFyIGxvZ01hdGNoID0gbG9nU2VwYXJhdG9yUmVnRXguZXhlYyhsb2dMaW5lc1tsaW5lTnVtYmVyXSk7DQogICAgICAgICAgICAgIC8vXltcLV17MjB9KFtcZF0rKVwvKFtcZF0rKVwvKFtcZF0rKSAoW1xkXSspOihbXGRdKyk6KFtcZF0rKSAoW0FQXU0pIFtcKF1VVENbXCldW1wtXXsyMH0NCiAgICAgICAgICAgICAgbG9nRW50cnlOdW1iZXIrKzsNCiAgICAgICAgICAgICAgbG9nRW50cmllc1tsb2dFbnRyeU51bWJlcl0gPSB7DQogICAgICAgICAgICAgICAgbGluZU51bWJlcjogbGluZU51bWJlciArIDEsDQogICAgICAgICAgICAgICAgd29ya2VyOiAtMSwNCiAgICAgICAgICAgICAgICBhZ2VuY3k6IC0xLA0KICAgICAgICAgICAgICAgIHdvcmtzdGF0aW9uOiAtMSwNCiAgICAgICAgICAgICAgICBjYXRlZ29yeTogJ1NlcGFyYXRvcicsDQogICAgICAgICAgICAgICAgbGV2ZWw6ICcnLA0KICAgICAgICAgICAgICAgIGRhdGVUaW1lOiBuZXcgRGF0ZShEYXRlLlVUQyhwYXJzZUludChsb2dNYXRjaFszXSwgMTApLCBwYXJzZUludChsb2dNYXRjaFsxXSwgMTApIC0gMSwgcGFyc2VJbnQobG9nTWF0Y2hbMl0sIDEwKSwgKHBhcnNlSW50KGxvZ01hdGNoWzRdLCAxMCkgKyAoKGxvZ01hdGNoWzddID09ICdQTScpID8gMTIgOiAwKSksIHBhcnNlSW50KGxvZ01hdGNoWzVdLCAxMCksIHBhcnNlSW50KGxvZ01hdGNoWzZdLCAxMCksIDApKSwNCiAgICAgICAgICAgICAgICBkYXRlVGltZVRleHQ6IGxvZ01hdGNoWzNdICsgJy0nICsgcmlnaHRBbGlnblplcm9QYWRkaW5nKGxvZ01hdGNoWzFdKSArICctJyArIHJpZ2h0QWxpZ25aZXJvUGFkZGluZyhsb2dNYXRjaFsyXSkgKyAnICcgKyByaWdodEFsaWduWmVyb1BhZGRpbmcoKHBhcnNlSW50KGxvZ01hdGNoWzRdLCAxMCkgKyAoKGxvZ01hdGNoWzddID09ICdQTScpID8gMTIgOiAwKSkudG9TdHJpbmcoKSkgKyAnOicgKyBsb2dNYXRjaFs1XSArICc6JyArIGxvZ01hdGNoWzZdICsgJy4wMDAnLA0KICAgICAgICAgICAgICAgIHRleHQ6IGxvZ0xpbmVzW2xpbmVOdW1iZXJdLA0KICAgICAgICAgICAgICAgIHdvcmtmbG93OiBjdXJyZW50V29ya2Zsb3csDQogICAgICAgICAgICAgICAgcHJvY2VzczogY3VycmVudFByb2Nlc3MsDQogICAgICAgICAgICAgICAgcm91dGluZTogY3VycmVudFJvdXRpbmUsDQogICAgICAgICAgICAgICAgcG5yTG9jYXRvcjogY3VycmVudExvY2F0b3INCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgbG9nRW50cmllc1tsb2dFbnRyeU51bWJlcl0udGV4dCArPSAnXG4nICsgbG9nTGluZXNbbGluZU51bWJlcl07DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBsb2dFbnRyaWVzOw0KICAgICAgfQ0KDQogICAgICB2YXIgY29tcGxlYXRWZW5kb3JEZWJ1ZyA9IHsNCiAgICAgICAgcGFyc2VMb2c6IHBhcnNlRGVidWdMb2cNCiAgICAgIH07DQoNCiAgICAgIC8qIGV4cG9zZWQgKi8NCiAgICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgew0KICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGNvbXBsZWF0VmVuZG9yRGVidWc7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLmNvbXBsZWF0VmVuZG9yRGVidWcgPSBjb21wbGVhdFZlbmRvckRlYnVnOw0KICAgICAgfQ0KDQogICAgfSkuY2FsbChmdW5jdGlvbiAoKSB7DQogICAgICByZXR1cm4gdGhpcyB8fCAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiBnbG9iYWwpOw0KICAgIH0oKSk7DQogIDwvc2NyaXB0Pg0KICA8IS0tPHNjcmlwdCBzcmM9ImphdmFzY3JpcHRzL3dzcGFuLWRpci1wYXJzZXIuanMiPjwvc2NyaXB0Pi0tPg0KICA8c2NyaXB0Pi8qKioNCiogRElSIHBhcnNlciBmb3IgSmF2YVNjcmlwdA0KKg0KKiBDb3B5cmlnaHQgKGMpIDIwMTQgVG9kZCBIYW1ibGV5IChNSVQgTGljZW5zZSkuDQoqDQoqLw0KICAgIC8qanNoaW50DQogICAgICBsYXhjb21tYTp0cnVlDQogICAgICBsYXhicmVhazp0cnVlDQogICAgICBlcW51bGw6dHJ1ZQ0KICAgICAgbG9vcGZ1bmM6dHJ1ZQ0KICAgICAgc3ViOnRydWUNCiAgICAqLw0KICAgIDsgKGZ1bmN0aW9uICgpIHsNCiAgICAgICJ1c2Ugc3RyaWN0IjsNCg0KICAgICAgZnVuY3Rpb24gcmliYm9uKGZlZWQpIHsNCiAgICAgICAgdmFyIF9zbG90ID0gbnVsbDsNCiAgICAgICAgdmFyIG9yZyA9IGZlZWQgKyAnJzsNCiAgICAgICAgdmFyIHBvcyA9IDA7DQoNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICBzYXZlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBfc2xvdCA9IHBvczsNCiAgICAgICAgICB9DQogICAgICAgICAgLCBsb2FkOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBwb3MgPSBfc2xvdDsNCiAgICAgICAgICAgIGZlZWQgPSBvcmcuc2xpY2UocG9zKTsNCiAgICAgICAgICB9DQogICAgICAgICAgLCBhZHZhbmNlOiBmdW5jdGlvbiAobikgew0KICAgICAgICAgICAgcG9zICs9ICh0eXBlb2YgbiA9PT0gJ3N0cmluZycpID8gbi5sZW5ndGggOiBuOw0KICAgICAgICAgICAgaWYgKHBvcyA+IDApIHsNCiAgICAgICAgICAgICAgcmV0dXJuIChmZWVkID0gb3JnLnNsaWNlKHBvcykpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGZlZWQgPSAnJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgLCByZWFkOiBmdW5jdGlvbiAobikgew0KICAgICAgICAgICAgdmFyIGluZm8gPSBmZWVkLnN1YnN0cmluZygwLCBuKTsNCiAgICAgICAgICAgIHRoaXMuYWR2YW5jZShuKTsNCiAgICAgICAgICAgIHJldHVybiBpbmZvOw0KICAgICAgICAgIH0NCiAgICAgICAgICAsIGxvb2tiZWhpbmQ6IGZ1bmN0aW9uIChuY2hhcnMpIHsNCiAgICAgICAgICAgIG5jaGFycyA9IG5jaGFycyA9PSBudWxsID8gMSA6IG5jaGFyczsNCiAgICAgICAgICAgIHJldHVybiBvcmcuc2xpY2UocG9zIC0gbmNoYXJzLCBwb3MpOw0KICAgICAgICAgIH0NCiAgICAgICAgICAsIHN0YXJ0c1dpdGg6IGZ1bmN0aW9uIChzKSB7DQogICAgICAgICAgICByZXR1cm4gZmVlZC5zdWJzdHJpbmcoMCwgcy5sZW5ndGgpID09PSBzOw0KICAgICAgICAgIH0NCiAgICAgICAgICAsIHZhbHVlT2Y6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHJldHVybiBmZWVkOw0KICAgICAgICAgIH0NCiAgICAgICAgICAsIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICByZXR1cm4gZmVlZDsNCiAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICB9DQoNCiAgICAgIC8qKioqKioqKiogdHJlZSAqKioqKioqKioqKioqKiovDQogICAgICAvL2h0dHBzOi8vZ2l0aHViLmNvbS9zcGlrZWJyZWhtL2FyYm9yZWFsDQoNCiAgICAgIGZ1bmN0aW9uIGluY2x1ZGUoYXJyYXksIGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIGFycmF5LmluZGV4T2YoaXRlbSkgPiAtMTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gX3RyYXZlcnNlRG93bihjb250ZXh0LCBpdGVyYXRvcikgew0KICAgICAgICB2YXIgZG9Db250aW51ZSA9IHRydWU7DQoNCiAgICAgICAgKGZ1bmN0aW9uIHdhbGtEb3duKG5vZGUpIHsNCiAgICAgICAgICB2YXIgaSwgbmV3Q29udGV4dDsNCg0KICAgICAgICAgIGlmICghZG9Db250aW51ZSkgcmV0dXJuOw0KDQogICAgICAgICAgaWYgKGl0ZXJhdG9yKG5vZGUpID09PSBmYWxzZSkgew0KICAgICAgICAgICAgLy9icmVhayB0aGUgdHJhdmVyc2FsIGxvb3AgaWYgdGhlIGl0ZXJhdG9yIHJldHVybnMgYSBmYWxzeSB2YWx1ZQ0KICAgICAgICAgICAgZG9Db250aW51ZSA9IGZhbHNlOw0KICAgICAgICAgIH0NCiAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBub2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgIG5ld0NvbnRleHQgPSBub2RlLmNoaWxkcmVuW2ldOw0KICAgICAgICAgICAgICB3YWxrRG93bihuZXdDb250ZXh0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0pKGNvbnRleHQpOw0KICAgICAgfQ0KDQoNCiAgICAgIGZ1bmN0aW9uIF90cmF2ZXJzZVVwKGNvbnRleHQsIGl0ZXJhdG9yKSB7DQogICAgICAgIHZhciBpLCBub2RlLCBkb0NvbnRpbnVlOw0KDQogICAgICAgIHdoaWxlIChjb250ZXh0KSB7DQogICAgICAgICAgaWYgKGl0ZXJhdG9yKGNvbnRleHQpID09PSBmYWxzZSkgcmV0dXJuOw0KDQogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvbnRleHQuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIG5vZGUgPSBjb250ZXh0LmNoaWxkcmVuW2ldOw0KICAgICAgICAgICAgaWYgKGl0ZXJhdG9yKG5vZGUpID09PSBmYWxzZSkgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICBjb250ZXh0ID0gY29udGV4dC5wYXJlbnQ7DQogICAgICAgIH0NCiAgICAgIH0NCg0KDQogICAgICBmdW5jdGlvbiBfdHJhdmVyc2UoY29udGV4dCwgaXRlcmF0b3IsIGNhbGxiYWNrKSB7DQogICAgICAgIHZhciB2aXNpdGVkID0gW10sDQogICAgICAgICAgY2FsbEl0ZXJhdG9yID0gZnVuY3Rpb24gKG5vZGUpIHsNCiAgICAgICAgICAgIHZhciBpZCA9IG5vZGUuaWQsDQogICAgICAgICAgICAgIHJldHVybmVkOw0KDQogICAgICAgICAgICBpZiAoIWluY2x1ZGUodmlzaXRlZCwgaWQpKSB7DQogICAgICAgICAgICAgIHJldHVybmVkID0gaXRlcmF0b3IuY2FsbChub2RlLCBub2RlKTsNCiAgICAgICAgICAgICAgdmlzaXRlZC5wdXNoKGlkKTsNCg0KICAgICAgICAgICAgICBpZiAocmV0dXJuZWQgPT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHJldHVybmVkOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfSwNCiAgICAgICAgICBpLCBub2RlOw0KDQogICAgICAgIGNhbGxiYWNrKGNvbnRleHQsIGNhbGxJdGVyYXRvcik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIF9yZW1vdmVDaGlsZChub2RlKSB7DQogICAgICAgIHZhciBwYXJlbnQgPSBub2RlLnBhcmVudCwNCiAgICAgICAgICBjaGlsZCwNCiAgICAgICAgICBpOw0KDQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXJlbnQuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICBjaGlsZCA9IHBhcmVudC5jaGlsZHJlbltpXTsNCg0KICAgICAgICAgIGlmIChjaGlsZCA9PT0gbm9kZSkgew0KICAgICAgICAgICAgcmV0dXJuIHBhcmVudC5jaGlsZHJlbi5zcGxpY2UoaSwgMSkuc2hpZnQoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gbm9kZUlkKHBhcmVudCwgc2VwYXJhdG9yKSB7DQogICAgICAgIHNlcGFyYXRvciA9IHNlcGFyYXRvciB8fCAnLyc7DQogICAgICAgIGlmIChwYXJlbnQpIHsNCiAgICAgICAgICByZXR1cm4gW3BhcmVudC5pZCwgcGFyZW50LmNoaWxkcmVuLmxlbmd0aF0uam9pbihzZXBhcmF0b3IpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIHJldHVybiAnMCc7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gRElSVHJlZShwYXJlbnQsIGRhdGEsIGlkKSB7DQogICAgICAgIHRoaXMuZGVwdGggPSBwYXJlbnQgPyBwYXJlbnQuZGVwdGggKyAxIDogMDsNCiAgICAgICAgdGhpcy5kYXRhID0gZGF0YSB8fCB7fTsNCiAgICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQgfHwgbnVsbDsNCiAgICAgICAgdGhpcy5pZCA9IGlkIHx8IG5vZGVJZChwYXJlbnQpOw0KICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107DQogICAgICB9DQoNCiAgICAgIERJUlRyZWUucHJvdG90eXBlLmFwcGVuZENoaWxkID0gZnVuY3Rpb24gKGRhdGEsIGlkKSB7DQogICAgICAgIHZhciBjaGlsZCA9IG5ldyBESVJUcmVlKHRoaXMsIGRhdGEsIGlkKTsNCiAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKGNoaWxkKTsNCiAgICAgICAgcmV0dXJuIGNoaWxkOw0KICAgICAgfTsNCg0KICAgICAgRElSVHJlZS5wcm90b3R5cGUucmVtb3ZlQ2hpbGQgPSBmdW5jdGlvbiAoYXJnKSB7DQogICAgICAgIGlmICh0eXBlb2YgYXJnID09PSAnbnVtYmVyJyAmJiB0aGlzLmNoaWxkcmVuW2FyZ10pIHsNCiAgICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbi5zcGxpY2UoYXJnLCAxKS5zaGlmdCgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChhcmcgaW5zdGFuY2VvZiBESVJUcmVlKSB7DQogICAgICAgICAgcmV0dXJuIF9yZW1vdmVDaGlsZChhcmcpOw0KICAgICAgICB9DQogICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBhcmd1bWVudCAiICsgYXJnKTsNCiAgICAgIH07DQoNCiAgICAgIERJUlRyZWUucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIF9yZW1vdmVDaGlsZCh0aGlzKTsNCiAgICAgIH07DQoNCg0KICAgICAgRElSVHJlZS5wcm90b3R5cGUucm9vdCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIG5vZGUgPSB0aGlzOw0KDQogICAgICAgIGlmICghbm9kZS5wYXJlbnQpIHsNCiAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KDQogICAgICAgIHdoaWxlIChub2RlLnBhcmVudCkgew0KICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbm9kZTsNCiAgICAgIH07DQoNCiAgICAgIERJUlRyZWUucHJvdG90eXBlLmlzUm9vdCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuICF0aGlzLnBhcmVudDsNCiAgICAgIH07DQoNCiAgICAgIERJUlRyZWUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgbGluZXMgPSBbXTsNCg0KICAgICAgICB0aGlzLnRyYXZlcnNlRG93bihmdW5jdGlvbiAobm9kZSkgew0KICAgICAgICAgIHZhciBzZXBhcmF0b3IgPSAnfC0gJywgaW5kZW50YXRpb24gPSAnJywgaTsNCg0KICAgICAgICAgIGlmIChub2RlLmRlcHRoID09PSAwKSB7DQogICAgICAgICAgICBsaW5lcy5wdXNoKG5vZGUuaWQpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbm9kZS5kZXB0aDsgaSsrKSB7DQogICAgICAgICAgICBpbmRlbnRhdGlvbiArPSAnfCc7DQogICAgICAgICAgfQ0KICAgICAgICAgIGxpbmVzLnB1c2goaW5kZW50YXRpb24gKyBzZXBhcmF0b3IgKyBub2RlLmRhdGEucGF0aCArICgobm9kZS5kYXRhLnZhbHVlKSA/ICcgPSAnICsgbm9kZS5kYXRhLnZhbHVlIDogJycpKTsNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBsaW5lcy5qb2luKCJcbiIpOw0KICAgICAgfTsNCg0KICAgICAgRElSVHJlZS5wcm90b3R5cGUudG9YTUwgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBsaW5lcyA9IFtdOw0KDQogICAgICAgIChmdW5jdGlvbiB3YWxrRG93blhNTChub2RlKSB7DQogICAgICAgICAgdmFyIGluZGVudGF0aW9uID0gJycNCiAgICAgICAgICB2YXIgaTsNCiAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBub2RlLmRhdGEubmFtZS5yZXBsYWNlKC9cLy9nLCAnJyk7DQoNCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbm9kZS5kZXB0aDsgaSsrKSB7DQogICAgICAgICAgICBpbmRlbnRhdGlvbiArPSAnICAnOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmIChub2RlLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGxpbmVzLnB1c2goaW5kZW50YXRpb24gKyAiPCIgKyBub2RlTmFtZSArICI+Iik7DQogICAgICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBjKyspIHsNCiAgICAgICAgICAgICAgd2Fsa0Rvd25YTUwobm9kZS5jaGlsZHJlbltjXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBsaW5lcy5wdXNoKGluZGVudGF0aW9uICsgIjwvIiArIG5vZGVOYW1lICsgIj4iKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbGluZXMucHVzaChpbmRlbnRhdGlvbiArICI8IiArIG5vZGVOYW1lICsgIj4iICsgbm9kZS5kYXRhLnZhbHVlICsgIjwvIiArIG5vZGVOYW1lICsgIj4iKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgfSkodGhpcyk7DQogICAgICAgIHJldHVybiBsaW5lcy5qb2luKCJcbiIpOw0KICAgICAgfTsNCg0KICAgICAgRElSVHJlZS5wcm90b3R5cGUudHJhdmVyc2VEb3duID0gZnVuY3Rpb24gKGl0ZXJhdG9yKSB7DQogICAgICAgIF90cmF2ZXJzZSh0aGlzLCBpdGVyYXRvciwgX3RyYXZlcnNlRG93bik7DQogICAgICB9Ow0KDQogICAgICAvKioqKioqKioqIHRyZWUgKioqKioqKioqKioqKioqLw0KDQogICAgICBmdW5jdGlvbiBnZXRWYXJpYWJsZUxlbmd0aFN0cmluZyhkaXJSZXNwb25zZSkgew0KICAgICAgICB2YXIgZmlyc3RDaGFyID0gZGlyUmVzcG9uc2UucmVhZCgxKTsNCiAgICAgICAgdmFyIHJlYWRMZW5ndGggPSBwYXJzZUludChmaXJzdENoYXIpOw0KICAgICAgICBpZiAoIWlzTmFOKHJlYWRMZW5ndGgpKSB7DQogICAgICAgICAgcmV0dXJuIGRpclJlc3BvbnNlLnJlYWQocmVhZExlbmd0aCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIGZpcnN0Q2hhcjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgdmFyIGdldFNlY3Rpb25UeXBlQ29kZSA9IGdldFZhcmlhYmxlTGVuZ3RoU3RyaW5nOw0KDQogICAgICBmdW5jdGlvbiBnZXRWYXJpYWJsZUxlbmd0aE51bWJlcihkaXJSZXNwb25zZSkgew0KICAgICAgICByZXR1cm4gcGFyc2VJbnQoZ2V0VmFyaWFibGVMZW5ndGhTdHJpbmcoZGlyUmVzcG9uc2UpKTsNCiAgICAgIH0NCiAgICAgIHZhciBnZXRTZWN0aW9uTGVuZ3RoID0gZ2V0VmFyaWFibGVMZW5ndGhOdW1iZXI7DQogICAgICB2YXIgZ2V0RWxlbWVudENvdW50ID0gZ2V0VmFyaWFibGVMZW5ndGhOdW1iZXI7DQoNCiAgICAgIGZ1bmN0aW9uIHBhcnNlRElSU2VjdGlvbihtc2dUZXh0LCBwYXJlbnQpIHsNCiAgICAgICAgaWYgKG1zZ1RleHQuc3RhcnRzV2l0aCgnKicpIHx8IG1zZ1RleHQuc3RhcnRzV2l0aCgnLicpKSB7DQogICAgICAgICAgLy8gbXVsdGlwbGUgaXRlbSBzZWN0aW9uIChvciBzdWJzZWN0aW9uKQ0KICAgICAgICAgIHZhciBhcnJheVR5cGUgPSBtc2dUZXh0LnJlYWQoMSk7DQogICAgICAgICAgdmFyIGVsZW1lbnRDb3VudCA9IGdldEVsZW1lbnRDb3VudChtc2dUZXh0KTsNCiAgICAgICAgICB2YXIgc2VjdGlvblR5cGUgPSBnZXRTZWN0aW9uVHlwZUNvZGUobXNnVGV4dCk7DQogICAgICAgICAgdmFyIHNlY3Rpb25UZXh0ID0gcmliYm9uKG1zZ1RleHQucmVhZChnZXRTZWN0aW9uTGVuZ3RoKG1zZ1RleHQpKSk7DQoNCiAgICAgICAgICB2YXIgbm9kZSA9IHBhcmVudC5hcHBlbmRDaGlsZCh7IG5hbWU6IHNlY3Rpb25UeXBlLCBwYXRoOiBwYXJlbnQuZGF0YS5wYXRoICsgJy4nICsgc2VjdGlvblR5cGUgfSk7DQoNCiAgICAgICAgICBmb3IgKHZhciBlbGVtZW50Q291bnRlciA9IDA7IGVsZW1lbnRDb3VudGVyIDwgZWxlbWVudENvdW50OyBlbGVtZW50Q291bnRlcisrKSB7DQogICAgICAgICAgICBwYXJzZURJUlNlY3Rpb24oc2VjdGlvblRleHQsIG5vZGUpOw0KICAgICAgICAgIH0NCg0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHZhciBzZWN0aW9uVHlwZSA9IG1zZ1RleHQucmVhZCgxKQ0KICAgICAgICAgIGlmIChzZWN0aW9uVHlwZSAhPSAnPicgJiYgc2VjdGlvblR5cGUgIT0gJzAnKSB7DQogICAgICAgICAgICB2YXIgc2VjdGlvblN0YXJ0TnVtYmVyID0gcGFyc2VJbnQoc2VjdGlvblR5cGUpOyAvLyBpcyB0aGUgc2VjdGlvbiBzdGFydCBhIG51bWJlcj8gIGlmIGl0IGlzIC0gaXQgaXNuJ3QgcmVhbGx5IHRoZSBzZWN0aW9uIHR5cGUuICByZWFkIHRoZSBudW1iZXIgb2YgY2hhcmFjdGVycyBpbiB0aGUgc2VjdGlvbiBudW1iZXIgdG8gZ2V0IHRoZSBzZWN0aW9uIHR5cGUNCiAgICAgICAgICAgIGlmICghaXNOYU4oc2VjdGlvblN0YXJ0TnVtYmVyKSkgew0KICAgICAgICAgICAgICBzZWN0aW9uVHlwZSA9IG1zZ1RleHQucmVhZChzZWN0aW9uU3RhcnROdW1iZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHNlY3Rpb25UZXh0ID0gcmliYm9uKG1zZ1RleHQucmVhZChnZXRTZWN0aW9uTGVuZ3RoKG1zZ1RleHQpKSk7DQogICAgICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoeyBuYW1lOiBzZWN0aW9uVHlwZSwgdmFsdWU6IHNlY3Rpb25UZXh0LCBwYXRoOiBwYXJlbnQuZGF0YS5wYXRoICsgJy4nICsgc2VjdGlvblR5cGUgfSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHBhcnNlRElSTWVzc2FnZShkaXJUZXh0KSB7DQogICAgICAgIGRpclRleHQgPSAodHlwZW9mIGRpclRleHQgPT09ICdzdHJpbmcnKSA/IHJpYmJvbihkaXJUZXh0KSA6IGRpclRleHQ7DQoNCiAgICAgICAgdmFyIG1zZ1RyZWU7DQoNCiAgICAgICAgaWYgKC8oLio/XCRcZCspKFxkKVtBLVpdKy8udGVzdChkaXJUZXh0LnRvU3RyaW5nKCkpKSB7DQogICAgICAgICAgLy9maW5kIHRoZSBiZWdpbm5pbmcgb2YgdGhlIERJUiBkYXRhLg0KICAgICAgICAgIC8vaXQgd2lsbCBsb29rIHNvbWV0aGluZyBsaWtlIHRoaXM6DQogICAgICAgICAgLy8kMDAwMDAwMDAwMDAyMTYzUE5SNTExMTc1SDIzOU0yM0FERw0KICAgICAgICAgIGRpclRleHQuYWR2YW5jZSgvKC4qP1wkXGQrKShcZClbQS1aXSsvLmV4ZWMoZGlyVGV4dC50b1N0cmluZygpKVsxXSk7DQoNCiAgICAgICAgICB2YXIgdHlwZUxlbmd0aCA9IHBhcnNlSW50KGRpclRleHQucmVhZCgxKSk7DQogICAgICAgICAgdmFyIG1zZ1R5cGUgPSBkaXJUZXh0LnJlYWQodHlwZUxlbmd0aCk7DQoNCiAgICAgICAgICAvL0RJUlRyZWUgKHBhcmVudCwgZGF0YSwgaWQpDQogICAgICAgICAgbXNnVHJlZSA9IG5ldyBESVJUcmVlKG51bGwsIHsgbmFtZTogbXNnVHlwZSwgcGF0aDogbXNnVHlwZSB9LCBtc2dUeXBlKTsNCg0KICAgICAgICAgIHZhciBtc2dUZXh0ID0gcmliYm9uKGRpclRleHQucmVhZChnZXRTZWN0aW9uTGVuZ3RoKGRpclRleHQpKSk7DQoNCiAgICAgICAgICB2YXIgc3RhcnRMZW5ndGggPSBtc2dUZXh0LnRvU3RyaW5nKCkubGVuZ3RoOw0KICAgICAgICAgIHdoaWxlIChtc2dUZXh0LnRvU3RyaW5nKCkubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgcGFyc2VESVJTZWN0aW9uKG1zZ1RleHQsIG1zZ1RyZWUpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBtc2dUcmVlOw0KICAgICAgfQ0KDQogICAgICB2YXIgd3NwYW5ESVIgPSB7DQogICAgICAgIHBhcnNlRElSTWVzc2FnZTogcGFyc2VESVJNZXNzYWdlDQogICAgICB9Ow0KDQogICAgICAvKiBleHBvc2VkICovDQoNCiAgICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgew0KICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IHdzcGFuRElSOw0KICAgICAgfQ0KICAgICAgZWxzZSB7DQogICAgICAgIHRoaXMud3NwYW5ESVIgPSB3c3BhbkRJUjsNCiAgICAgIH0NCg0KICAgIH0pLmNhbGwoZnVuY3Rpb24gKCkgew0KICAgICAgcmV0dXJuIHRoaXMgfHwgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogZ2xvYmFsKTsNCiAgICB9KCkpOw0KICA8L3NjcmlwdD4NCjwvaGVhZD4NCg0KPGJvZHk+DQogIDxkaXYgaWQ9ImlucHV0ZGl2IiBzdHlsZT0id2lkdGg6MTAwJTsgbWFyZ2luOiAwIGF1dG87IHBhZGRpbmc6IDAgMCAxMHB4OyI+DQogICAgPHVsIGNsYXNzPSJ0YWJzIiBkYXRhLXBlcnNpc3Q9InRydWUiIGlkPSJ0YWJzbGlzdCI+DQogICAgICA8bGkgaWQ9InRhYjEiPg0KICAgICAgICA8YSBpZD0idGFiMWxpbmsiIGhyZWY9IiNzZWFyY2h2aWV3Ij5TZWFyY2g8L2E+DQogICAgICA8L2xpPg0KICAgICAgPGxpIGlkPSJ0YWIyIj4NCiAgICAgICAgPGEgaWQ9InRhYjJsaW5rIiBocmVmPSIjZmlsdGVydmlldyI+RmlsdGVyPC9hPg0KICAgICAgPC9saT4NCiAgICAgIDxsaSBpZD0idGFiMyI+DQogICAgICAgIDxhIGlkPSJ0YWIzbGluayIgaHJlZj0iI3NldHRpbmdzdmlldyI+U2V0dGluZ3M8L2E+DQogICAgICA8L2xpPg0KICAgICAgPGxpIGlkPSJ0YWI0Ij4NCiAgICAgICAgPGEgaWQ9InRhYjRsaW5rIiBocmVmPSIjaW5mb3ZpZXciPkluZm88L2E+DQogICAgICA8L2xpPg0KICAgIDwvdWw+DQogICAgPGRpdiBjbGFzcz0idGFiY29udGVudHMiPg0KICAgICAgPGRpdiBpZD0ic2VhcmNodmlldyI+DQogICAgICAgIDxmb3JtIGlkPSJzZWFyY2giPg0KICAgICAgICAgIDxkaXYgY2xhc3M9InN0cmluZyBpbnB1dCBvcHRpb25hbCBzdHJpbmdpc2ggc2VhcmNoX2Zvcm1fZmllbGQgc2VhcmNoX3N0cmluZyIgaWQ9InFfc2VhcmNoX2lucHV0Ij4NCiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfc2VhcmNoIiBjbGFzcz0ibGFiZWwiPlNlYXJjaDo8L2xhYmVsPg0KICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJzZWFyY2giIHBsYWNlaG9sZGVyPSJTZWFyY2ggbG9nIiBuYW1lPSJxW3NlYXJjaF0iIGlkPSJxX3NlYXJjaCIgLz4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWxlY3QgaW5wdXQgb3B0aW9uYWwgc2VhcmNoX2Zvcm1fZmllbGQgc2VhcmNoX3NlbGVjdCIgaWQ9InFfY29sdW1uX2lucHV0Ij4NCiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfY29sdW1uIiBjbGFzcz0ibGFiZWwiPkNvbHVtbihzKTo8L2xhYmVsPg0KICAgICAgICAgICAgPHNlbGVjdCBuYW1lPSJxW2NvbHVtbl0iIGlkPSJxX2NvbHVtbiIgbXVsdGlwbGU9Im11bHRpcGxlIiBzaXplPSI1Ij4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ibGluZU51bWJlciI+TGluZTwvb3B0aW9uPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJ3b3JrZXIiPldvcmtlcjwvb3B0aW9uPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJ3b3Jrc3RhdGlvbiI+V29ya3N0YXRpb248L29wdGlvbj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0id29ya2Zsb3ciPldvcmtmbG93PC9vcHRpb24+DQogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9InByb2Nlc3MiPlByb2Nlc3M8L29wdGlvbj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0icm91dGluZSI+Um91dGluZTwvb3B0aW9uPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJwbnJMb2NhdG9yIj5Mb2NhdG9yPC9vcHRpb24+DQogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImNhdGVnb3J5Ij5DYXRlZ29yeTwvb3B0aW9uPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJsZXZlbCI+TGV2ZWw8L29wdGlvbj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iZGF0ZVRpbWVUZXh0Ij5EYXRlL1RpbWU8L29wdGlvbj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0idGV4dCI+VGV4dDwvb3B0aW9uPg0KICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0iYnV0dG9ucyI+DQogICAgICAgICAgICA8aW5wdXQgbmFtZT0iYXBwbHlfc2VhcmNoX2J0biIgaWQ9ImFwcGx5X3NlYXJjaF9idG4iIGNsYXNzPSJzdWJtaXRfYnRuIiB0eXBlPSJzdWJtaXQiIHZhbHVlPSJTZWFyY2giIC8+DQogICAgICAgICAgICA8aW5wdXQgbmFtZT0iY2xlYXJfc2VhcmNoX2J0biIgaWQ9ImNsZWFyX3NlYXJjaF9idG4iIGNsYXNzPSJyZXNldF9idG4iIHR5cGU9ImJ1dHRvbiIgdmFsdWU9IkNsZWFyIiAvPg0KICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Zvcm0+DQogICAgICA8L2Rpdj4NCiAgICAgIDxkaXYgaWQ9ImZpbHRlcnZpZXciPg0KICAgICAgICA8Zm9ybSBpZD0iZmlsdGVyIj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJudW1iZXJfcmFuZ2UgaW5wdXQgb3B0aW9uYWwgZmlsdGVyX2Zvcm1fZmllbGQgZmlsdGVyX251bWJlcl9yYW5nZSIgaWQ9InFfbGluZV9udW1iZXJfaW5wdXQiPg0KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJsYWJlbCI+TGluZTwvbGFiZWw+DQogICAgICAgICAgICA8aW5wdXQgc2l6ZT0iMTIiIG1heGxlbmd0aD0iMTAiIHBsYWNlaG9sZGVyPSJGcm9tIiB2YWx1ZT0iIiB0eXBlPSJudW1iZXIiIG5hbWU9InFbbGluZV9udW1iZXJfZ3RlcV0iDQogICAgICAgICAgICAgIGlkPSJxX2xpbmVfbnVtYmVyX2d0ZXEiPg0KICAgICAgICAgICAgPGlucHV0IHNpemU9IjEyIiBtYXhsZW5ndGg9IjEwIiBwbGFjZWhvbGRlcj0iVG8iIHZhbHVlPSIiIHR5cGU9Im51bWJlciIgbmFtZT0icVtsaW5lX251bWJlcl9sdGVxXSINCiAgICAgICAgICAgICAgaWQ9InFfbGluZV9udW1iZXJfbHRlcSI+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0ic2VsZWN0IGlucHV0IG9wdGlvbmFsIGZpbHRlcl9mb3JtX2ZpZWxkIGZpbHRlcl9zZWxlY3QiIGlkPSJxX3dvcmtlcl9pbnB1dCI+DQogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX3dvcmtlciIgY2xhc3M9ImxhYmVsIj5Xb3JrZXI6PC9sYWJlbD4NCiAgICAgICAgICAgIDxzZWxlY3QgbmFtZT0icVt3b3JrZXJfZXFdIiBpZD0icV93b3JrZXIiPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJBbGwiPkFsbDwvb3B0aW9uPg0KICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0ic2VsZWN0IGlucHV0IG9wdGlvbmFsIGZpbHRlcl9mb3JtX2ZpZWxkIGZpbHRlcl9zZWxlY3QiIGlkPSJxX3dvcmtzdGF0aW9uX2lucHV0Ij4NCiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfd29ya3N0YXRpb24iIGNsYXNzPSJsYWJlbCI+V29ya3N0YXRpb246PC9sYWJlbD4NCiAgICAgICAgICAgIDxzZWxlY3QgbmFtZT0icVt3b3Jrc3RhdGlvbl9lcV0iIGlkPSJxX3dvcmtzdGF0aW9uIj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQWxsIj5BbGw8L29wdGlvbj4NCiAgICAgICAgICAgIDwvc2VsZWN0Pg0KICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgIDxkaXYgY2xhc3M9InNlbGVjdCBpbnB1dCBvcHRpb25hbCBmaWx0ZXJfZm9ybV9maWVsZCBmaWx0ZXJfc2VsZWN0IiBpZD0icV93b3JrZmxvd19pbnB1dCI+DQogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX3dvcmtmbG93IiBjbGFzcz0ibGFiZWwiPldvcmtmbG93OjwvbGFiZWw+DQogICAgICAgICAgICA8c2VsZWN0IG5hbWU9InFbd29ya2Zsb3dfZXFdIiBpZD0icV93b3JrZmxvdyI+DQogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkFsbCI+QWxsPC9vcHRpb24+DQogICAgICAgICAgICA8L3NlbGVjdD4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWxlY3QgaW5wdXQgb3B0aW9uYWwgZmlsdGVyX2Zvcm1fZmllbGQgZmlsdGVyX3NlbGVjdCIgaWQ9InFfcHJvY2Vzc19pbnB1dCI+DQogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX3Byb2Nlc3MiIGNsYXNzPSJsYWJlbCI+UHJvY2Vzczo8L2xhYmVsPg0KICAgICAgICAgICAgPHNlbGVjdCBuYW1lPSJxW3Byb2Nlc3NfZXFdIiBpZD0icV9wcm9jZXNzIj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQWxsIj5BbGw8L29wdGlvbj4NCiAgICAgICAgICAgIDwvc2VsZWN0Pg0KICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgIDxkaXYgY2xhc3M9InNlbGVjdCBpbnB1dCBvcHRpb25hbCBmaWx0ZXJfZm9ybV9maWVsZCBmaWx0ZXJfc2VsZWN0IiBpZD0icV9jYXRlZ29yeV9pbnB1dCI+DQogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX2NhdGVnb3J5IiBjbGFzcz0ibGFiZWwiPkNhdGVnb3J5OjwvbGFiZWw+DQogICAgICAgICAgICA8c2VsZWN0IG5hbWU9InFbY2F0ZWdvcnlfZXFdIiBpZD0icV9jYXRlZ29yeSI+DQogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkFsbCI+QWxsPC9vcHRpb24+DQogICAgICAgICAgICA8L3NlbGVjdD4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWxlY3QgaW5wdXQgb3B0aW9uYWwgZmlsdGVyX2Zvcm1fZmllbGQgZmlsdGVyX3NlbGVjdCIgaWQ9InFfbGV2ZWxfaW5wdXQiPg0KICAgICAgICAgICAgPGxhYmVsIGZvcj0icV9sZXZlbCIgY2xhc3M9ImxhYmVsIj5MZXZlbDo8L2xhYmVsPg0KICAgICAgICAgICAgPHNlbGVjdCBuYW1lPSJxW2xldmVsX2VxXSIgaWQ9InFfbGV2ZWwiPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJBbGwiPkFsbDwvb3B0aW9uPg0KICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0iZGF0ZV9yYW5nZSBpbnB1dCBvcHRpb25hbCBmaWx0ZXJfZm9ybV9maWVsZCBmaWx0ZXJfZGF0ZV9yYW5nZSIgaWQ9InFfZGF0ZV90aW1lX2lucHV0Ij4NCiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ibGFiZWwiPkRhdGUvVGltZTo8L2xhYmVsPg0KICAgICAgICAgICAgPGlucHV0IGNsYXNzPSJkYXRlcGlja2VyIiBzaXplPSIxMiIgbWF4bGVuZ3RoPSIxMCIgcGxhY2Vob2xkZXI9IkZyb20iIHZhbHVlPSIiIHR5cGU9InRleHQiDQogICAgICAgICAgICAgIG5hbWU9InFbZGF0ZV90aW1lX2d0ZXFdIiBpZD0icV9kYXRlX3RpbWVfZ3RlcSI+DQogICAgICAgICAgICA8aW5wdXQgY2xhc3M9ImRhdGVwaWNrZXIiIHNpemU9IjEyIiBtYXhsZW5ndGg9IjEwIiBwbGFjZWhvbGRlcj0iVG8iIHZhbHVlPSIiIHR5cGU9InRleHQiDQogICAgICAgICAgICAgIG5hbWU9InFbZGF0ZV90aW1lX2x0ZXFdIiBpZD0icV9kYXRlX3RpbWVfbHRlcSI+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0iYnV0dG9ucyI+DQogICAgICAgICAgICA8aW5wdXQgbmFtZT0iYXBwbHlfZmlsdGVyc19idG4iIGlkPSJhcHBseV9maWx0ZXJzX2J0biIgY2xhc3M9InN1Ym1pdF9idG4iIHR5cGU9InN1Ym1pdCIgdmFsdWU9IkZpbHRlciIgLz4NCiAgICAgICAgICAgIDxpbnB1dCBuYW1lPSJjbGVhcl9maWx0ZXJzX2J0biIgaWQ9ImNsZWFyX2ZpbHRlcnNfYnRuIiBjbGFzcz0icmVzZXRfYnRuIiB0eXBlPSJidXR0b24iIHZhbHVlPSJDbGVhciIgLz4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC9mb3JtPg0KICAgICAgPC9kaXY+DQogICAgICA8ZGl2IGlkPSJzZXR0aW5nc3ZpZXciPg0KICAgICAgICA8Zm9ybSBpZD0ic2V0dGluZ3MiPg0KICAgICAgICAgIDxmaWVsZHNldCBpZD0iY29sdW1uc3Rvc2hvdyI+DQogICAgICAgICAgICA8bGVnZW5kPkNvbHVtbnMgdG8gc2hvdzwvbGVnZW5kPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZyBpdGVtIGNvbnRhaW5lciI+DQogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibGluZW9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+TGluZTogPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9ImxpbmVOdW1iZXJvbm9mZnN3aXRjaCIgY2xhc3M9Im9ub2Zmc3dpdGNoLWNoZWNrYm94Ig0KICAgICAgICAgICAgICAgICAgICBpZD0ibGluZU51bWJlcm9ub2Zmc3dpdGNoIiBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJsaW5lTnVtYmVyb25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPg0KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9Indvcmtlcm9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+V29ya2VyOiA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0id29ya2Vyb25vZmZzd2l0Y2giIGNsYXNzPSJvbm9mZnN3aXRjaC1jaGVja2JveCIgaWQ9Indvcmtlcm9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0id29ya2Vyb25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPg0KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9IndvcmtzdGF0aW9ub25vZmZzd2l0Y2giIGNsYXNzPSJpdGVtIj5Xb3Jrc3RhdGlvbjogPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9IndvcmtzdGF0aW9ub25vZmZzd2l0Y2giIGNsYXNzPSJvbm9mZnN3aXRjaC1jaGVja2JveCINCiAgICAgICAgICAgICAgICAgICAgaWQ9IndvcmtzdGF0aW9ub25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJ3b3Jrc3RhdGlvbm9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+V29ya2Zsb3c6IDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giDQogICAgICAgICAgICAgICAgICAgIGlkPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIiBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwcm9jZXNzb25vZmZzd2l0Y2giIGNsYXNzPSJpdGVtIj5Qcm9jZXNzOiA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0icHJvY2Vzc29ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giIGlkPSJwcm9jZXNzb25vZmZzd2l0Y2giDQogICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ+DQogICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9Im9ub2Zmc3dpdGNoLWxhYmVsIiBmb3I9InByb2Nlc3Nvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1pbm5lciI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtc3dpdGNoIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZyBpdGVtIGNvbnRhaW5lciI+DQogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0icm91dGluZW9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+Um91dGluZTogPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9InJvdXRpbmVvbm9mZnN3aXRjaCIgY2xhc3M9Im9ub2Zmc3dpdGNoLWNoZWNrYm94IiBpZD0icm91dGluZW9ub2Zmc3dpdGNoIg0KICAgICAgICAgICAgICAgICAgICBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJyb3V0aW5lb25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPg0KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InBuckxvY2F0b3Jvbm9mZnN3aXRjaCIgY2xhc3M9Iml0ZW0iPkxvY2F0b3I6IDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJwbnJMb2NhdG9yb25vZmZzd2l0Y2giIGNsYXNzPSJvbm9mZnN3aXRjaC1jaGVja2JveCINCiAgICAgICAgICAgICAgICAgICAgaWQ9InBuckxvY2F0b3Jvbm9mZnN3aXRjaCIgY2hlY2tlZD4NCiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0icG5yTG9jYXRvcm9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjYXRlZ29yeW9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+Q2F0ZWdvcnk6IDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJjYXRlZ29yeW9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giDQogICAgICAgICAgICAgICAgICAgIGlkPSJjYXRlZ29yeW9ub2Zmc3dpdGNoIiBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJjYXRlZ29yeW9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJsZXZlbG9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+TGV2ZWw6IDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJsZXZlbG9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giIGlkPSJsZXZlbG9ub2Zmc3dpdGNoIg0KICAgICAgICAgICAgICAgICAgICBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJsZXZlbG9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJkYXRlVGltZVRleHRvbm9mZnN3aXRjaCIgY2xhc3M9Iml0ZW0iPkRhdGUvVGltZTogPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9ImRhdGVUaW1lVGV4dG9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giDQogICAgICAgICAgICAgICAgICAgIGlkPSJkYXRlVGltZVRleHRvbm9mZnN3aXRjaCIgY2hlY2tlZD4NCiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0iZGF0ZVRpbWVUZXh0b25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPg0KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InRleHRvbm9mZnN3aXRjaCIgY2xhc3M9Iml0ZW0iPiBUZXh0OiA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0idGV4dG9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giIGlkPSJ0ZXh0b25vZmZzd2l0Y2giDQogICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ+DQogICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9Im9ub2Zmc3dpdGNoLWxhYmVsIiBmb3I9InRleHRvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1pbm5lciI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtc3dpdGNoIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgIDwvZmllbGRzZXQ+DQogICAgICAgICAgPGZpZWxkc2V0IGlkPSJ0ZXh0dmlld3NldHRpbmdzIj4NCiAgICAgICAgICAgIDxsZWdlbmQ+UmVxdWVzdC9SZXNwb25zZSBUZXh0IFZpZXc8L2xlZ2VuZD4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJhZGlvVG9nZ2xlIj4NCiAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBuYW1lPSJjb21tdW5pY2F0aW9uRGlzcGxheSIgdmFsdWU9Im5hdGl2ZSIgaWQ9ImNvbW11bmljYXRpb25OYXRpdmUiIGNoZWNrZWQ9ImNoZWNrZWQiIC8+DQogICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImNvbW11bmljYXRpb25OYXRpdmUiPk5hdGl2ZTwvbGFiZWw+DQogICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0iY29tbXVuaWNhdGlvbkRpc3BsYXkiIHZhbHVlPSJ4bWwiIGlkPSJjb21tdW5pY2F0aW9uWG1sIiAvPg0KICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjb21tdW5pY2F0aW9uWG1sIj5Gb3JtYXR0ZWQgWE1MPC9sYWJlbD4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgIDwvZmllbGRzZXQ+DQogICAgICAgIDwvZm9ybT4NCiAgICAgIDwvZGl2Pg0KICAgICAgPGRpdiBpZD0iaW5mb3ZpZXciPg0KICAgICAgICA8ZGl2IGlkPSJpbmZvIj4NCiAgICAgICAgICA8ZGl2IGlkPSJpbmZvRmlsZSIgY2xhc3M9ImluZm8iPjxzcGFuIGNsYXNzPSJpbmZvTGFiZWwiPkZpbGUgbmFtZTogPC9zcGFuPjxzcGFuIGlkPSJpbmZvRmlsZW5hbWUiPjwvc3Bhbj4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICA8ZGl2IGlkPSJpbmZvU2VhcmNoIiBjbGFzcz0iaW5mbyBoaWRkZW4iPjxzcGFuIGNsYXNzPSJpbmZvTGFiZWwiPlNlYXJjaCBmb3IgPC9zcGFuPjxzcGFuDQogICAgICAgICAgICAgIGlkPSJpbmZvU2VhcmNoVGV4dCI+PC9zcGFuPjwvZGl2Pg0KICAgICAgICAgIDxkaXYgaWQ9ImluZm9TZWFyY2hDb2x1bW5zIiBjbGFzcz0iaW5mbyBoaWRkZW4iPjxzcGFuIGNsYXNzPSJpbmZvTGFiZWwiPmluIGNvbHVtbnM6IDwvc3Bhbj48c3Bhbg0KICAgICAgICAgICAgICBpZD0iaW5mb1NlYXJjaENvbHVtbnNUZXh0Ij48L3NwYW4+PC9kaXY+DQogICAgICAgICAgPGRpdiBpZD0iaW5mb0ZpbHRlciIgY2xhc3M9ImluZm8gaGlkZGVuIj48c3BhbiBjbGFzcz0iaW5mb0xhYmVsIj5GaWx0ZXJzOiA8L3NwYW4+PHNwYW4NCiAgICAgICAgICAgICAgaWQ9ImluZm9GaWx0ZXJUZXh0Ij48L3NwYW4+PC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQogIDwvZGl2Pg0KICA8ZGl2IGlkPSJsb2d0YWJsZSI+DQogICAgPGRpdiBpZD0icGFnZWRpdiI+DQogICAgICA8dWwgY2xhc3M9InBhZ2luYXRpb24iPjwvdWw+DQogICAgPC9kaXY+DQogICAgPGRpdiBpZD0iZGF0YSI+DQogICAgICA8dGFibGUgY2xhc3M9Imxpc3RhYmxlIHNvcnRhYmxlIj4NCiAgICAgICAgPGNvbGdyb3VwPg0KICAgICAgICAgIDxjb2wgY2xhc3M9ImxpbmVOdW1iZXIiIC8+DQogICAgICAgICAgPGNvbCBjbGFzcz0id29ya2VyIiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9IndvcmtzdGF0aW9uIiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9IndvcmtmbG93IiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9InByb2Nlc3MiIC8+DQogICAgICAgICAgPGNvbCBjbGFzcz0icm91dGluZSIgLz4NCiAgICAgICAgICA8Y29sIGNsYXNzPSJwbnJMb2NhdG9yIiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9ImNhdGVnb3J5IiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9ImxldmVsIiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9ImRhdGVUaW1lVGV4dCIgLz4NCiAgICAgICAgICA8Y29sIGNsYXNzPSJ0ZXh0IiAvPg0KICAgICAgICA8L2NvbGdyb3VwPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgPHRyPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IGxpbmVOdW1iZXIiIGRhdGEtc29ydD0ibGluZU51bWJlciI+TGluZTwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgd29ya2VyIiBkYXRhLXNvcnQ9IndvcmtlciI+V29ya2VyPC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0ic29ydCB3b3Jrc3RhdGlvbiIgZGF0YS1zb3J0PSJ3b3Jrc3RhdGlvbiI+V29ya3N0YXRpb248L3RoPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IHdvcmtmbG93IiBkYXRhLXNvcnQ9IndvcmtmbG93Ij5Xb3JrZmxvdzwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgcHJvY2VzcyIgZGF0YS1zb3J0PSJwcm9jZXNzIj5Qcm9jZXNzPC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0ic29ydCByb3V0aW5lIiBkYXRhLXNvcnQ9InJvdXRpbmUiPlJvdXRpbmU8L3RoPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IHBuckxvY2F0b3IiIGRhdGEtc29ydD0icG5yTG9jYXRvciI+TG9jYXRvcjwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgY2F0ZWdvcnkiIGRhdGEtc29ydD0iY2F0ZWdvcnkiPkNhdGVnb3J5PC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0ic29ydCBsZXZlbCIgZGF0YS1zb3J0PSJsZXZlbCI+TGV2ZWw8L3RoPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IGRhdGVUaW1lVGV4dCIgZGF0YS1zb3J0PSJkYXRlVGltZVRleHQiPkRhdGUvVGltZTwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgdGV4dCIgZGF0YS1zb3J0PSJ0ZXh0Ij5UZXh0PC90aD4NCiAgICAgICAgICA8L3RyPg0KICAgICAgICA8L3RoZWFkPg0KICAgICAgICA8dGJvZHkgY2xhc3M9Imxpc3QiPg0KICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0ibGluZU51bWJlciI+PC90ZD4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0id29ya2VyIj48L3RkPg0KICAgICAgICAgICAgPHRkIGNsYXNzPSJ3b3Jrc3RhdGlvbiI+PC90ZD4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0id29ya2Zsb3ciPjwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9InByb2Nlc3MiPjwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9InJvdXRpbmUiPjwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9InBuckxvY2F0b3IiPjwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9ImNhdGVnb3J5Ij48L3RkPg0KICAgICAgICAgICAgPHRkIGNsYXNzPSJsZXZlbCI+PC90ZD4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0iZGF0ZVRpbWVUZXh0Ij48L3RkPg0KICAgICAgICAgICAgPHRkIGNsYXNzPSJ0ZXh0Ij48L3RkPg0KICAgICAgICAgIDwvdHI+DQogICAgICAgIDwvdGJvZHk+DQogICAgICA8L3RhYmxlPg0KICAgIDwvZGl2Pg0KICA8L2Rpdj4NCiAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KICAgIC8vbGlzdA0KICAgIHZhciBvcHRpb25zID0gew0KICAgICAgdmFsdWVOYW1lczogWydsaW5lTnVtYmVyJywgJ3dvcmtlcicsICd3b3Jrc3RhdGlvbicsICdjYXRlZ29yeScsICdsZXZlbCcsICdkYXRlVGltZVRleHQnLCAndGV4dCcsICd3b3JrZmxvdycsDQogICAgICAgICdwcm9jZXNzJywgJ3JvdXRpbmUnLCAncG5yTG9jYXRvcicNCiAgICAgIF0sDQogICAgICBwYWdlOiAyMCwNCiAgICAgIHBsdWdpbnM6IFtMaXN0UGFnaW5hdGlvbih7DQogICAgICAgIG91dGVyV2luZG93OiAyDQogICAgICB9KV0NCiAgICB9Ow0KICAgIC8vIEluaXQgbGlzdA0KICAgIHZhciBsb2dUYWJsZSA9IG5ldyBMaXN0KCdsb2d0YWJsZScsIG9wdGlvbnMpOw0KICAgIGxvZ1RhYmxlLm9uKCd1cGRhdGVkJywgZm9ybWF0WG1sKTsNCiAgICBsb2dUYWJsZS5vbigndXBkYXRlZCcsIGZvcm1hdEpzb24pOw0KICAgIGxvZ1RhYmxlLm9uKCd1cGRhdGVkJywgY29udmVydERJUik7DQogICAgbG9nVGFibGUub24oJ3VwZGF0ZWQnLCB1cGRhdGVDb2x1bW5zKTsNCg0KICAgIC8vIEdEU1ggTG9nIGhhbmRsaW5nDQogICAgLyoNCiAgICBmdW5jdGlvbiBwcm9jZXNzVGV4dEJveChlKSB7DQogICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICBwcm9jZXNzTG9nVGV4dChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9ndGV4dCcpLnZhbHVlKTsNCiAgICAgIGluZm8uZmlsZU5hbWUgPSAnQ29weS9QYXN0ZSc7DQogICAgICBzaG93SW5mbygpOw0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICAqLw0KDQogICAgZnVuY3Rpb24gcHJldHR5WG1sKHhtbFRleHQpIHsNCiAgICAgIHZhciBmb3JtYXQgPSByZXF1aXJlKCd4bWwtZm9ybWF0dGVyJyk7DQoNCiAgICAgIHZhciBvcHRpb25zID0gew0KICAgICAgICBpbmRlbnRhdGlvbjogJyAgJywNCiAgICAgICAgc3RyaXBDb21tZW50czogdHJ1ZSwNCiAgICAgICAgY29sbGFwc2VDb250ZW50OiB0cnVlDQogICAgICB9Ow0KICAgICAgcmV0dXJuIGZvcm1hdCh4bWxUZXh0LCBvcHRpb25zKTsNCiAgICB9DQoNCiAgICAvLyB1dGlsaXR5IGZ1bmN0aW9uIHRvIHByb2Nlc3MgbG9nIHRleHQNCiAgICBmdW5jdGlvbiBwcm9jZXNzTG9nVGV4dChsb2dUZXh0KSB7DQogICAgICBsb2dUYWJsZS5jbGVhcigpOw0KICAgICAgaWYgKGxvZ1RleHQubGVuZ3RoID4gMCkgew0KICAgICAgICB2YXIgbG9nQXJyYXkgPSBjb21wbGVhdFZlbmRvckRlYnVnLnBhcnNlTG9nKGxvZ1RleHQpOw0KICAgICAgICBjb25zdCBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7DQogICAgICAgIGxvZ0FycmF5LmZvckVhY2gobG9nSXRlbSA9PiB7DQogICAgICAgICAgaWYgKGxvZ0l0ZW0udGV4dC5zdGFydHNXaXRoKCI8IikgJiYgbG9nSXRlbS50ZXh0LmVuZHNXaXRoKCI+IikpDQogICAgICAgICAgew0KICAgICAgICAgICAgY29uc3QgZG9jID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhsb2dJdGVtLnRleHQucmVwbGFjZUFsbCgiJm5ic3A7IiwgIiAiKSwgImFwcGxpY2F0aW9uL3htbCIpOw0KICAgICAgICAgICAgY29uc3QgZXJyb3JOb2RlID0gZG9jLnF1ZXJ5U2VsZWN0b3IoInBhcnNlcmVycm9yIik7DQogICAgICAgICAgICBpZiAoZXJyb3JOb2RlKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJlcnJvciB3aGlsZSBwYXJzaW5nIGluIHByb2Nlc3NMb2dUZXh0Iik7DQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKGxvZ0l0ZW0udGV4dCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBsb2dJdGVtLnRleHQgPSBsb2dJdGVtLnRleHQucmVwbGFjZUFsbCgiJm5ic3A7IiwgIiAiKS5yZXBsYWNlKC9bXHUwMEEwLVx1OTk5OTw+XCZdL2csIGkgPT4gJyYjJytpLmNoYXJDb2RlQXQoMCkrJzsnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBsb2dUYWJsZS5hZGQobG9nQXJyYXkpOw0KICAgICAgICBidWlsZEZpbHRlcnMobG9nQXJyYXkpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG1vdmVPcmlnaW5hbChlbGVtZW50KSB7DQogICAgICB2YXIgbmV3UGFyZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgICB3aGlsZSAoZWxlbWVudC5oYXNDaGlsZE5vZGVzKCkpIHsNCiAgICAgICAgbmV3UGFyZW50LmFwcGVuZENoaWxkKGVsZW1lbnQuZmlyc3RDaGlsZCk7DQogICAgICB9DQogICAgICBuZXdQYXJlbnQuY2xhc3NOYW1lID0gJ2hpZGRlbiBwbGFpbnRleHQnDQogICAgICBlbGVtZW50LmFwcGVuZENoaWxkKG5ld1BhcmVudCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY3JlYXRlQ2hpbGRFbGVtZW50KGVsZW1lbnQsIGNoaWxkVHlwZSkgew0KICAgICAgdmFyIGNoaWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChjaGlsZFR5cGUpOw0KICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChjaGlsZCk7DQogICAgICByZXR1cm4gY2hpbGQ7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY3JlYXRlVGV4dEVsZW1lbnQoZWxlbWVudCwgdGV4dCkgew0KICAgICAgdmFyIGNoaWxkVGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTsNCiAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQoY2hpbGRUZXh0Tm9kZSk7DQogICAgICByZXR1cm4gY2hpbGRUZXh0Tm9kZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhZGRKc29uTm9kZShlbGVtZW50LCB0ZXh0KSB7DQogICAgICB0cnkgew0KICAgICAgICBjb25zdCBkb2MgPSBKU09OLnBhcnNlKHRleHQpOw0KICAgICAgICB2YXIgcHJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncHJlJyk7DQogICAgICAgIHZhciBjb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY29kZScpOw0KICAgICAgICBjb2RlLmNsYXNzTmFtZSA9ICdmb3JtYXR0ZWQganNvbic7DQogICAgICAgIHByZS5hcHBlbmRDaGlsZChjb2RlKTsNCiAgICAgICAgY3JlYXRlVGV4dEVsZW1lbnQoY29kZSwgSlNPTi5zdHJpbmdpZnkoZG9jLCBudWxsLCAyKSk7DQogICAgICAgIG1vdmVPcmlnaW5hbChlbGVtZW50KTsNCiAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChwcmUpOw0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmxvZygiZXJyb3Igd2hpbGUgcGFyc2luZyBpbiBhZGRKc29uTm9kZSIpOw0KICAgICAgICBjb25zb2xlLmxvZyh0ZXh0KTsNCiAgICAgICAgY29uc29sZS5lcnJvcihlKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBmb3JtYXRKc29uKCkgew0KICAgICAgdmFyIHRleHROb2RlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3RleHQnKTsNCiAgICAgIHZhciBqc29uTm9kZXMgPSBBcnJheS5mcm9tKHRleHROb2Rlcyk7DQogICAgICBpZiAoanNvbk5vZGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAganNvbk5vZGVzLmZvckVhY2goZWxlbWVudCA9PiB7DQogICAgICAgICAgY29uc3QgdGV4dCA9IGVsZW1lbnQuaW5uZXJUZXh0IHx8IGVsZW1lbnQudGV4dENvbnRlbnQ7DQogICAgICAgICAgY29uc3QganNvbkNvZGUgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoImNvZGUuanNvbiIpOw0KICAgICAgICAgIGNvbnN0IHRhYmxlQnJlYWtkb3duID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yKCJ0YWJsZS5icmVha2Rvd24iKTsNCiAgICAgICAgICBpZiAoanNvbkNvZGUgPT0gbnVsbCkgew0KICAgICAgICAgICAgaWYgKHRleHQuc3RhcnRzV2l0aCgieyIpICYmIHRleHQuZW5kc1dpdGgoIn0iKSkgew0KICAgICAgICAgICAgICBhZGRKc29uTm9kZShlbGVtZW50LCB0ZXh0KTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAodGV4dC5zdGFydHNXaXRoKCJNZXRob2Q6ICIpIHx8IHRleHQuc3RhcnRzV2l0aCgiU3RhdHVzQ29kZTogIikpIHsNCiAgICAgICAgICAgICAgdmFyIGxpbmVzID0gdGV4dC50cmltKCkuc3BsaXQoL1tcclxuXSsvKS5maWx0ZXIoKGxpbmUpID0+IGxpbmUudHJpbSgpICE9ICcnKTsNCiAgICAgICAgICAgICAgdmFyIGZpcnN0TGluZSA9IGxpbmVzLnNoaWZ0KCkudHJpbSgpOw0KICAgICAgICAgICAgICB2YXIgc2Vjb25kTGluZSA9IGxpbmVzLnNoaWZ0KCkudHJpbSgpOw0KICAgICAgICAgICAgICB2YXIgbGFzdExpbmUgPSBsaW5lcy5wb3AoKS50cmltKCk7DQogICAgICAgICAgICAgIHZhciBzZWNvbmRUb0xhc3RMaW5lID0gbGluZXMucG9wKCkudHJpbSgpOw0KICAgICAgICAgICAgICBpZiAoc2Vjb25kTGluZSA9PSAneycgJiYgc2Vjb25kVG9MYXN0TGluZSA9PSAnfScpIHsNCiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIHRoZSBraW5kIG9mIHRleHQgd2UncmUgbG9va2luZyBmb3INCiAgICAgICAgICAgICAgICB2YXIgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpOw0KICAgICAgICAgICAgICAgIHRhYmxlLmNsYXNzTmFtZSA9ICdicmVha2Rvd24nOw0KICAgICAgICAgICAgICAgIC8vIGxpbmUgMToNCiAgICAgICAgICAgICAgICAvL01ldGhvZDogUE9TVCwgUmVxdWVzdFVyaTogJ2h0dHBzOi8vYXBpLmhhdmFpbC5zYWJyZS5jb20vdjIvYXV0aC90b2tlbicsIFZlcnNpb246IDEuMSwgQ29udGVudDogU3lzdGVtLk5ldC5IdHRwLlN0cmluZ0NvbnRlbnQsIEhlYWRlcnM6DQogICAgICAgICAgICAgICAgLy8gU3RhdHVzQ29kZTogMjAwLCBSZWFzb25QaHJhc2U6ICdPSycsIFZlcnNpb246IDEuMSwgQ29udGVudDogU3lzdGVtLk5ldC5IdHRwLlN0cmVhbUNvbnRlbnQsIEhlYWRlcnM6DQogICAgICAgICAgICAgICAgdmFyIGxpbmUxUGFydHMgPSBmaXJzdExpbmUuc3BsaXQoLywgLyk7DQogICAgICAgICAgICAgICAgdmFyIGxhYmVsVmFsdWVSZWdleCA9IC9eKFteOl0rKTooLiopLzsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmUxUGFydHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgIHZhciB0ciA9IGNyZWF0ZUNoaWxkRWxlbWVudCh0YWJsZSwgJ3RyJyk7DQogICAgICAgICAgICAgICAgICB2YXIgbGFiZWxWYWx1ZU1hdGNoZXMgPSBsaW5lMVBhcnRzW2ldLm1hdGNoKGxhYmVsVmFsdWVSZWdleCk7DQogICAgICAgICAgICAgICAgICB2YXIgbGFiZWxUZXh0ID0gbGFiZWxWYWx1ZU1hdGNoZXNbMV07DQogICAgICAgICAgICAgICAgICB2YXIgdmFsdWVUZXh0ID0gbGFiZWxWYWx1ZU1hdGNoZXNbMl0udHJpbSgpOw0KICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsVGQgPSBjcmVhdGVDaGlsZEVsZW1lbnQodHIsICd0ZCcpOw0KICAgICAgICAgICAgICAgICAgY3JlYXRlVGV4dEVsZW1lbnQobGFiZWxUZCwgbGFiZWxUZXh0ICsgIjoiKTsNCiAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZVRkID0gY3JlYXRlQ2hpbGRFbGVtZW50KHRyLCAndGQnKTsNCiAgICAgICAgICAgICAgICAgIGlmIChsYWJlbFRleHQgPT0gIkhlYWRlcnMiKSB7DQogICAgICAgICAgICAgICAgICAgIGNyZWF0ZVRleHRFbGVtZW50KHZhbHVlVGQsIGxpbmVzLm1hcChzID0+IHMudHJpbSgpKS5qb2luKCdcbicpKTsNCiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGNyZWF0ZVRleHRFbGVtZW50KHZhbHVlVGQsIHZhbHVlVGV4dCk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHZhciBwYXlsb2FkVHIgPSBjcmVhdGVDaGlsZEVsZW1lbnQodGFibGUsICd0cicpOw0KICAgICAgICAgICAgICAgIHZhciBwYXlsb2FkTGFiZWxUZCA9IGNyZWF0ZUNoaWxkRWxlbWVudChwYXlsb2FkVHIsICd0ZCcpOw0KICAgICAgICAgICAgICAgIGNyZWF0ZVRleHRFbGVtZW50KHBheWxvYWRMYWJlbFRkLCAiUGF5bG9hZDoiKTsNCiAgICAgICAgICAgICAgICB2YXIgcGF5bG9hZFZhbHVlVGQgPSBjcmVhdGVDaGlsZEVsZW1lbnQocGF5bG9hZFRyLCAndGQnKTsNCiAgICAgICAgICAgICAgICBpZiAobGFzdExpbmUuc3RhcnRzV2l0aCgieyIpICYmIGxhc3RMaW5lLmVuZHNXaXRoKCJ9IikpIHsNCiAgICAgICAgICAgICAgICAgIGFkZEpzb25Ob2RlKHBheWxvYWRWYWx1ZVRkLCBsYXN0TGluZSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIHZhciBwYXlsb2FkUHJlID0gY3JlYXRlQ2hpbGRFbGVtZW50KHBheWxvYWRWYWx1ZVRkLCAncHJlJyk7DQogICAgICAgICAgICAgICAgICBjcmVhdGVUZXh0RWxlbWVudChwYXlsb2FkUHJlLCBsYXN0TGluZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG1vdmVPcmlnaW5hbChlbGVtZW50KTsNCiAgICAgICAgICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKHRhYmxlKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfQ0KDQogICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzE1ODM5MjgzDQogICAgZnVuY3Rpb24gZ2V0UmFkaW9WYWx1ZShyYWRpb05hbWUpIHsNCiAgICAgIHZhciBidXR0b25zID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUocmFkaW9OYW1lKTsNCiAgICAgIHZhciBidXR0b25WYWx1ZTsNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnV0dG9ucy5sZW5ndGg7IGkrKykgew0KICAgICAgICBpZiAoYnV0dG9uc1tpXS5jaGVja2VkKSB7DQogICAgICAgICAgYnV0dG9uVmFsdWUgPSBidXR0b25zW2ldLnZhbHVlOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gYnV0dG9uVmFsdWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYWRkWG1sTm9kZShwYXJzZXIsIGVsZW1lbnQsIHRleHQsIGNvbW11bmljYXRpb25EaXNwbGF5VmFsdWUpIHsNCiAgICAgIGNvbnN0IGRvYyA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcodGV4dCwgImFwcGxpY2F0aW9uL3htbCIpOw0KICAgICAgY29uc3QgZXJyb3JOb2RlID0gZG9jLnF1ZXJ5U2VsZWN0b3IoInBhcnNlcmVycm9yIik7DQogICAgICBpZiAoZXJyb3JOb2RlKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCJlcnJvciB3aGlsZSBwYXJzaW5nIGluIGZvcm1hdFhtbCIpOw0KICAgICAgICBjb25zb2xlLmxvZyh0ZXh0KTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIGNvbnNvbGUubG9nKGRvYy5maXJzdENoaWxkLnRhZ05hbWUpOw0KICAgICAgICB2YXIgZW5hYmxlTmF0aXZlID0gKGRvYy5maXJzdENoaWxkLnRhZ05hbWUgPT0gIlNhYnJlQ29tbWFuZExMU1JRIiB8fCBkb2MuZmlyc3RDaGlsZC50YWdOYW1lID09ICJTYWJyZUNvbW1hbmRMTFNSUyIpOw0KICAgICAgICB2YXIgcHJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncHJlJyk7DQogICAgICAgIHZhciBjb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY29kZScpOw0KICAgICAgICBpZiAoZW5hYmxlTmF0aXZlICYmIGNvbW11bmljYXRpb25EaXNwbGF5VmFsdWUgPT0gIm5hdGl2ZSIpIHsNCiAgICAgICAgICBjb2RlLmNsYXNzTmFtZSA9ICdmb3JtYXR0ZWQgeG1sIGhpZGRlbic7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgY29kZS5jbGFzc05hbWUgPSAnZm9ybWF0dGVkIHhtbCc7DQogICAgICAgIH0NCiAgICAgICAgcHJlLmFwcGVuZENoaWxkKGNvZGUpOw0KICAgICAgICBjcmVhdGVUZXh0RWxlbWVudChjb2RlLCBwcmV0dHlYbWwodGV4dCkpDQogICAgICAgIG1vdmVPcmlnaW5hbChlbGVtZW50KTsNCiAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChwcmUpOw0KDQogICAgICAgIGlmIChlbmFibGVOYXRpdmUpIHsNCiAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgICAgICAgaWYgKGNvbW11bmljYXRpb25EaXNwbGF5VmFsdWUgPT0gIm5hdGl2ZSIpIHsNCiAgICAgICAgICAgIGRpdi5jbGFzc05hbWUgPSAnbmF0aXZlJzsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgZGl2LmNsYXNzTmFtZSA9ICduYXRpdmUgaGlkZGVuJzsNCiAgICAgICAgICB9DQogICAgICAgICAgY3JlYXRlVGV4dEVsZW1lbnQoZGl2LCBkb2MuZG9jdW1lbnRFbGVtZW50LnRleHRDb250ZW50KTsNCiAgICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGRpdik7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBmb3JtYXRYbWwoKSB7DQogICAgICB2YXIgdGV4dE5vZGVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndGV4dCcpOw0KICAgICAgdmFyIHhtbE5vZGVzID0gQXJyYXkuZnJvbSh0ZXh0Tm9kZXMpOw0KICAgICAgaWYgKHhtbE5vZGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgdmFyIGNvbW11bmljYXRpb25EaXNwbGF5VmFsdWUgPSBnZXRSYWRpb1ZhbHVlKCdjb21tdW5pY2F0aW9uRGlzcGxheScpOw0KICAgICAgICBjb25zb2xlLmxvZygicmVxdWVzdC9yZXNwb25zZSBkaXNwbGF5OiAiICsgY29tbXVuaWNhdGlvbkRpc3BsYXlWYWx1ZSk7DQogICAgICAgIGNvbnN0IHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTsNCiAgICAgICAgeG1sTm9kZXMuZm9yRWFjaChlbGVtZW50ID0+IHsNCiAgICAgICAgICBjb25zdCB0ZXh0ID0gZWxlbWVudC5pbm5lclRleHQgfHwgZWxlbWVudC50ZXh0Q29udGVudDsNCiAgICAgICAgICBjb25zdCB4bWxDb2RlID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yKCJjb2RlLnhtbCIpOw0KICAgICAgICAgIGlmICh4bWxDb2RlID09IG51bGwpIHsNCiAgICAgICAgICAgIGlmIChlbGVtZW50LmlubmVySFRNTC5zdGFydHNXaXRoKCJSZXF1ZXN0OiA8IikgJiYgZWxlbWVudC5pbm5lckhUTUwuZW5kc1dpdGgoIj4iKSkgew0KICAgICAgICAgICAgICBhZGRYbWxOb2RlKHBhcnNlciwgZWxlbWVudCwgZWxlbWVudC5pbm5lckhUTUwucmVwbGFjZSgiUmVxdWVzdDogPCIsICI8IiksIGNvbW11bmljYXRpb25EaXNwbGF5VmFsdWUpOw0KICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlOb2RlcyA9IGVsZW1lbnQucGFyZW50Tm9kZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjYXRlZ29yeScpOw0KICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlOb2RlQXJyYXkgPSBBcnJheS5mcm9tKGNhdGVnb3J5Tm9kZXMpOw0KICAgICAgICAgICAgICBjYXRlZ29yeU5vZGVBcnJheVswXS5pbm5lclRleHQgPSBjYXRlZ29yeU5vZGVBcnJheVswXS5pbm5lclRleHQgKyAnIFJlcXVlc3QnOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LmlubmVySFRNTC5zdGFydHNXaXRoKCJSZXNwb25zZTogPCIpICYmIGVsZW1lbnQuaW5uZXJIVE1MLmVuZHNXaXRoKCI+IikpIHsNCiAgICAgICAgICAgICAgYWRkWG1sTm9kZShwYXJzZXIsIGVsZW1lbnQsIGVsZW1lbnQuaW5uZXJIVE1MLnJlcGxhY2UoIlJlc3BvbnNlOiA8IiwgIjwiKSwgY29tbXVuaWNhdGlvbkRpc3BsYXlWYWx1ZSk7DQogICAgICAgICAgICAgIHZhciBjYXRlZ29yeU5vZGVzID0gZWxlbWVudC5wYXJlbnROb2RlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NhdGVnb3J5Jyk7DQogICAgICAgICAgICAgIHZhciBjYXRlZ29yeU5vZGVBcnJheSA9IEFycmF5LmZyb20oY2F0ZWdvcnlOb2Rlcyk7DQogICAgICAgICAgICAgIGNhdGVnb3J5Tm9kZUFycmF5WzBdLmlubmVyVGV4dCA9IGNhdGVnb3J5Tm9kZUFycmF5WzBdLmlubmVyVGV4dCArICcgUmVzcG9uc2UnOw0KICAgICAgICAgICAgfSBlbHNlIGlmICh0ZXh0LnN0YXJ0c1dpdGgoIjwiKSAmJiB0ZXh0LmVuZHNXaXRoKCI+IikpIHsNCiAgICAgICAgICAgICAgYWRkWG1sTm9kZShwYXJzZXIsIGVsZW1lbnQsIHRleHQsIGNvbW11bmljYXRpb25EaXNwbGF5VmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjb25zdCBuYXRpdmVDb21tdW5pY2F0aW9uID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yKCJkaXYubmF0aXZlIik7DQogICAgICAgICAgICBpZiAobmF0aXZlQ29tbXVuaWNhdGlvbikgew0KICAgICAgICAgICAgICBpZiAoY29tbXVuaWNhdGlvbkRpc3BsYXlWYWx1ZSA9PSAibmF0aXZlIikgew0KICAgICAgICAgICAgICAgIG5hdGl2ZUNvbW11bmljYXRpb24uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7DQogICAgICAgICAgICAgICAgeG1sQ29kZS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBuYXRpdmVDb21tdW5pY2F0aW9uLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOw0KICAgICAgICAgICAgICAgIHhtbENvZGUuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY29udmVydERJUigpIHsNCiAgICAgIHZhciB0ZXh0Tm9kZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd0ZXh0Jyk7DQogICAgICB2YXIgZGlyTm9kZXMgPSBBcnJheS5mcm9tKHRleHROb2RlcykuZmlsdGVyKG5vZGUgPT4gKG5vZGUuaW5uZXJUZXh0IHx8IG5vZGUudGV4dENvbnRlbnQpLnN1YnN0cmluZygwLCAzKSA9PT0gJ0RJUicpOw0KICAgICAgZGlyTm9kZXMuZm9yRWFjaChlbGVtZW50ID0+IHsNCiAgICAgICAgdmFyIERJUlRyZWUgPSB3c3BhbkRJUi5wYXJzZURJUk1lc3NhZ2UoZWxlbWVudC5pbm5lclRleHQgfHwgZWxlbWVudC50ZXh0Q29udGVudCk7DQogICAgICAgIGlmIChESVJUcmVlKSB7DQogICAgICAgICAgdmFyIHByZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ByZScpOw0KICAgICAgICAgIHZhciBjb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY29kZScpOw0KICAgICAgICAgIGNvZGUuY2xhc3NOYW1lID0gJ3htbCc7DQogICAgICAgICAgcHJlLmFwcGVuZENoaWxkKGNvZGUpOw0KICAgICAgICAgIHZhciBwbGFpblhNTCA9IERJUlRyZWUudG9YTUwoKTsNCiAgICAgICAgICBjcmVhdGVUZXh0RWxlbWVudChjb2RlLCBwbGFpblhNTCk7DQogICAgICAgICAgbW92ZU9yaWdpbmFsKGVsZW1lbnQpOw0KICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQocHJlKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfQ0KDQogICAgLy9odHRwOi8vanNmaWRkbGUubmV0LzBHaVMwL25EVllkLw0KICAgIHdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7DQogICAgICBhZGRFdmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiMWxpbmsnKSwgJ2NsaWNrJywgcmVzaXplRGF0YSk7DQogICAgICBhZGRFdmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiMmxpbmsnKSwgJ2NsaWNrJywgcmVzaXplRGF0YSk7DQogICAgICBhZGRFdmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiM2xpbmsnKSwgJ2NsaWNrJywgcmVzaXplRGF0YSk7DQogICAgICBhZGRFdmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiNGxpbmsnKSwgJ2NsaWNrJywgcmVzaXplRGF0YSk7DQoNCiAgICAgIGFkZEV2ZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWx0ZXInKSwgJ3N1Ym1pdCcsIGFwcGx5RmlsdGVycyk7DQogICAgICBhZGRFdmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXJfZmlsdGVyc19idG4nKSwgJ2NsaWNrJywgY2xlYXJGaWx0ZXJzKTsNCiAgICAgIGFkZEV2ZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2gnKSwgJ3N1Ym1pdCcsIGFwcGx5U2VhcmNoKTsNCiAgICAgIGFkZEV2ZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbGVhcl9zZWFyY2hfYnRuJyksICdjbGljaycsIGNsZWFyU2VhcmNoKTsNCiAgICAgIGluaXRDb2x1bW5zKCk7DQogICAgICBpbml0Q29tbXVuaWNhdGlvblZpZXcoKTsNCiAgICAgIHVwZGF0ZUluZm8oKTsNCiAgICAgIHJlc2l6ZURhdGEoKTsNCiAgICAgIHByb2Nlc3NMb2dUZXh0KGAlTE9HVEVYVCVgKTsNCiAgICAgIHNob3dJbmZvKCk7DQogICAgfQ0KDQogICAgd2luZG93Lm9ucmVzaXplID0gcmVzaXplRGF0YTsNCg0KICAgIGZ1bmN0aW9uIHJlc2l6ZURhdGEoKSB7DQogICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgIHJlc2l6ZUVsZW1lbnRIZWlnaHQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEnKSkNCiAgICAgIH0sIDUwKTsNCiAgICB9DQoNCiAgICAvKiogaW5mbyAqKi8NCiAgICB2YXIgaW5mbyA9IHsNCiAgICAgIGZpbGVOYW1lOiAnJUZJTEVOQU1FJScsDQogICAgICBzZWFyY2hUZXh0OiAnJywNCiAgICAgIHNlYXJjaENvbHVtbnM6IFtdLA0KICAgICAgZmlsdGVyczogW10NCiAgICB9Ow0KDQogICAgZnVuY3Rpb24gc2hvd0luZm8oKSB7DQogICAgICB1cGRhdGVJbmZvKCk7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiNGxpbmsnKS5jbGljaygpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHVwZGF0ZUluZm8oKSB7DQogICAgICB2YXIgZmlsZU5hbWVEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5mb0ZpbGVuYW1lJyk7DQogICAgICBmaWxlTmFtZURpdi5pbm5lclRleHQgPSBpbmZvLmZpbGVOYW1lOw0KICAgICAgdmFyIHNlYXJjaERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvU2VhcmNoJyk7DQogICAgICB2YXIgc2VhcmNoQ29sdW1uc0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvU2VhcmNoQ29sdW1ucycpOw0KICAgICAgaWYgKGluZm8uc2VhcmNoVGV4dC5sZW5ndGggPT0gMCkgew0KICAgICAgICBzZWFyY2hEaXYuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7DQogICAgICAgIHNlYXJjaENvbHVtbnNEaXYuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzZWFyY2hEaXYuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7DQogICAgICAgIHZhciBzZWFyY2hUZXh0RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luZm9TZWFyY2hUZXh0Jyk7DQogICAgICAgIHNlYXJjaFRleHREaXYuaW5uZXJUZXh0ID0gaW5mby5zZWFyY2hUZXh0Ow0KICAgICAgICBzZWFyY2hDb2x1bW5zRGl2LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOw0KICAgICAgICB2YXIgc2VhcmNoQ29sdW1uc1RleHREaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5mb1NlYXJjaENvbHVtbnNUZXh0Jyk7DQogICAgICAgIGlmIChpbmZvLnNlYXJjaENvbHVtbnMubGVuZ3RoID4gMCkgew0KICAgICAgICAgIHNlYXJjaENvbHVtbnNUZXh0RGl2LmlubmVyVGV4dCA9IGluZm8uc2VhcmNoQ29sdW1ucy5qb2luKCcsICcpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHNlYXJjaENvbHVtbnNUZXh0RGl2LmlubmVyVGV4dCA9ICdBbGwnOw0KICAgICAgICB9DQogICAgICB9DQogICAgICB2YXIgZmlsdGVyRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luZm9GaWx0ZXInKTsNCiAgICAgIGlmIChpbmZvLmZpbHRlcnMubGVuZ3RoID09IDApIHsNCiAgICAgICAgZmlsdGVyRGl2LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZmlsdGVyRGl2LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOw0KICAgICAgICB2YXIgZmlsdGVyVGV4dERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvRmlsdGVyVGV4dCcpOw0KICAgICAgICBmaWx0ZXJUZXh0RGl2LmlubmVySFRNTCA9IGluZm8uZmlsdGVycy5qb2luKCcgYW5kICcpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKiBTZXR0aW5ncyAqKi8NCiAgICBmdW5jdGlvbiBpbml0Q29sdW1ucygpIHsNCiAgICAgIHZhciB0YmwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZGF0YSA+IHRhYmxlJyk7DQogICAgICB2YXIgY29scyA9IEFycmF5LmZyb20odGJsLnF1ZXJ5U2VsZWN0b3JBbGwoJ2NvbCcpKTsNCiAgICAgIGNvbHMuZm9yRWFjaChjb2wgPT4gew0KICAgICAgICB2YXIgY29sTmFtZSA9IGNvbC5jbGFzc05hbWU7DQogICAgICAgIHZhciBjaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbE5hbWUgKyAnb25vZmZzd2l0Y2gnKTsNCiAgICAgICAgaWYgKGNoZWNrYm94KSB7DQogICAgICAgICAgdmFyIGRpc3BsYXlNb2RlID0gKGNoZWNrYm94LmNoZWNrZWQpID8gJ3RhYmxlLWNlbGwnIDogJ25vbmUnOw0KICAgICAgICAgIEFycmF5LmZyb20odGJsLnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgY29sTmFtZSkpLmZvckVhY2goY2VsbCA9PiBjZWxsLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5TW9kZSk7DQogICAgICAgICAgYWRkRXZlbnQoY2hlY2tib3gsICdjaGFuZ2UnLCB0b2dnbGVDb2x1bW4pOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB1cGRhdGVDb2x1bW5zKCkgew0KICAgICAgdmFyIHRibCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkYXRhID4gdGFibGUnKTsNCiAgICAgIHZhciBjb2xzID0gQXJyYXkuZnJvbSh0YmwucXVlcnlTZWxlY3RvckFsbCgnY29sJykpOw0KICAgICAgY29scy5mb3JFYWNoKGNvbCA9PiB7DQogICAgICAgIHZhciBjb2xOYW1lID0gY29sLmNsYXNzTmFtZTsNCiAgICAgICAgdmFyIGNoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29sTmFtZSArICdvbm9mZnN3aXRjaCcpOw0KICAgICAgICBpZiAoY2hlY2tib3gpIHsNCiAgICAgICAgICB2YXIgZGlzcGxheU1vZGUgPSAoY2hlY2tib3guY2hlY2tlZCkgPyAndGFibGUtY2VsbCcgOiAnbm9uZSc7DQogICAgICAgICAgQXJyYXkuZnJvbSh0YmwucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjb2xOYW1lKSkuZm9yRWFjaChjZWxsID0+IGNlbGwuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXlNb2RlKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdG9nZ2xlQ29sdW1uKGV2dCkgew0KICAgICAgdmFyIGNoZWNrYm94ID0gZXZ0LnRhcmdldDsNCiAgICAgIHZhciBjb2xOYW1lID0gY2hlY2tib3guaWQucmVwbGFjZSgnb25vZmZzd2l0Y2gnLCAnJyk7DQogICAgICB2YXIgdGJsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2RhdGEgPiB0YWJsZScpOw0KICAgICAgdmFyIGRpc3BsYXlNb2RlID0gKGNoZWNrYm94LmNoZWNrZWQpID8gJ3RhYmxlLWNlbGwnIDogJ25vbmUnOw0KICAgICAgQXJyYXkuZnJvbSh0YmwucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjb2xOYW1lKSkuZm9yRWFjaChjZWxsID0+IGNlbGwuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXlNb2RlKTsNCiAgICAgIHJlc2l6ZURhdGEoKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBpbml0Q29tbXVuaWNhdGlvblZpZXcoKSB7DQogICAgICB2YXIgYnV0dG9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCdjb21tdW5pY2F0aW9uRGlzcGxheScpOw0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBidXR0b25zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGJ1dHRvbnNbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlQ29tbXVuaWNhdGlvblZpZXcpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHVwZGF0ZUNvbW11bmljYXRpb25WaWV3KGV2dCkgew0KICAgICAgZm9ybWF0WG1sKCk7DQogICAgfQ0KDQogICAgLyoqIFNlYXJjaCAqKi8NCiAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMTgyMTI2MS9ob3ctdG8tZ2V0LWFsbC1zZWxlY3RlZC12YWx1ZXMtZnJvbS1zZWxlY3QtbXVsdGlwbGUtbXVsdGlwbGUNCiAgICBmdW5jdGlvbiBnZXRTZWxlY3RWYWx1ZXMoc2VsZWN0KSB7DQogICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICB2YXIgb3B0aW9ucyA9IHNlbGVjdCAmJiBzZWxlY3Qub3B0aW9uczsNCiAgICAgIHZhciBvcHQ7DQoNCiAgICAgIGZvciAodmFyIGkgPSAwLCBpTGVuID0gb3B0aW9ucy5sZW5ndGg7IGkgPCBpTGVuOyBpKyspIHsNCiAgICAgICAgb3B0ID0gb3B0aW9uc1tpXTsNCg0KICAgICAgICBpZiAob3B0LnNlbGVjdGVkKSB7DQogICAgICAgICAgcmVzdWx0LnB1c2gob3B0LnZhbHVlIHx8IG9wdC50ZXh0KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMjgwMjczOS9kZXNlbGVjdC1zZWxlY3RlZC1vcHRpb25zLWluLXNlbGVjdC1tZW51LXdpdGgtbXVsdGlwbGUtYW5kLW9wdGdyb3Vwcw0KICAgIGZ1bmN0aW9uIGNsZWFyU2VsZWN0ZWQoc2VsZWN0KSB7DQogICAgICB2YXIgb3B0aW9ucyA9IHNlbGVjdCAmJiBzZWxlY3Qub3B0aW9uczsNCg0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIG9wdGlvbnNbaV0uc2VsZWN0ZWQgPSBmYWxzZTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhcHBseVNlYXJjaChlKSB7DQogICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICB2YXIgY29sdW1ucyA9IGdldFNlbGVjdFZhbHVlcyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9jb2x1bW4nKSk7DQogICAgICB2YXIgc2VhcmNoVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3NlYXJjaCcpLnZhbHVlOw0KICAgICAgaWYgKGNvbHVtbnMubGVuZ3RoID4gMCkgew0KICAgICAgICBsb2dUYWJsZS5zZWFyY2goc2VhcmNoVGV4dCwgY29sdW1ucyk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBsb2dUYWJsZS5zZWFyY2goc2VhcmNoVGV4dCk7DQogICAgICB9DQogICAgICBpbmZvLnNlYXJjaENvbHVtbnMgPSBjb2x1bW5zOw0KICAgICAgaW5mby5zZWFyY2hUZXh0ID0gc2VhcmNoVGV4dDsNCiAgICAgIHNob3dJbmZvKCk7DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2xlYXJTZWFyY2goKSB7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9zZWFyY2gnKS52YWx1ZSA9ICcnOw0KICAgICAgY29sdW1uQ2hvaWNlcy5yZW1vdmVBY3RpdmVJdGVtcygpOw0KICAgICAgaW5mby5zZWFyY2hDb2x1bW5zID0gW107DQogICAgICBpbmZvLnNlYXJjaFRleHQgPSAnJzsNCiAgICAgIHVwZGF0ZUluZm8oKTsNCiAgICAgIGxvZ1RhYmxlLnNlYXJjaCgpOyAvLyBTaG93IGFsbCBpdGVtcyBpbiBsaXN0DQogICAgfQ0KDQogICAgLyoqIEVuZCBzZWFyY2ggKiovDQoNCiAgICAvKiogZmlsdGVycyAqKi8NCiAgICAvLyBpbml0IGRhdGVwaWNrZXJzOg0KICAgIGZsYXRwaWNrcigiLmRhdGVwaWNrZXIiLCB7DQogICAgICBlbmFibGVUaW1lOiB0cnVlLA0KICAgICAgZGF0ZUZvcm1hdDogIlktbS1kIEg6aSINCiAgICB9KTsNCg0KICAgIGNvbnN0IGNvbHVtbkNob2ljZXMgPSBuZXcgQ2hvaWNlcygnI3FfY29sdW1uJywgew0KICAgICAgcmVtb3ZlSXRlbUJ1dHRvbjogdHJ1ZSwNCiAgICAgIGR1cGxpY2F0ZUl0ZW1zQWxsb3dlZDogZmFsc2UNCiAgICB9KQ0KICAgIGNvbnN0IHdvcmtlckNob2ljZXMgPSBuZXcgQ2hvaWNlcygnI3Ffd29ya2VyJywgew0KICAgICAgZHVwbGljYXRlSXRlbXNBbGxvd2VkOiBmYWxzZQ0KICAgIH0pOw0KICAgIGNvbnN0IHdvcmtzdGF0aW9uQ2hvaWNlcyA9IG5ldyBDaG9pY2VzKCcjcV93b3Jrc3RhdGlvbicsIHsNCiAgICAgIGR1cGxpY2F0ZUl0ZW1zQWxsb3dlZDogZmFsc2UNCiAgICB9KTsNCiAgICBjb25zdCB3b3JrZmxvd0Nob2ljZXMgPSBuZXcgQ2hvaWNlcygnI3Ffd29ya2Zsb3cnLCB7DQogICAgICBkdXBsaWNhdGVJdGVtc0FsbG93ZWQ6IGZhbHNlDQogICAgfSk7DQogICAgY29uc3QgcHJvY2Vzc0Nob2ljZXMgPSBuZXcgQ2hvaWNlcygnI3FfcHJvY2VzcycsIHsNCiAgICAgIGR1cGxpY2F0ZUl0ZW1zQWxsb3dlZDogZmFsc2UNCiAgICB9KTsNCiAgICBjb25zdCBjYXRlZ29yeUNob2ljZXMgPSBuZXcgQ2hvaWNlcygnI3FfY2F0ZWdvcnknLCB7DQogICAgICBkdXBsaWNhdGVJdGVtc0FsbG93ZWQ6IGZhbHNlDQogICAgfSk7DQogICAgY29uc3QgbGV2ZWxDaG9pY2VzID0gbmV3IENob2ljZXMoJyNxX2xldmVsJywgew0KICAgICAgZHVwbGljYXRlSXRlbXNBbGxvd2VkOiBmYWxzZQ0KICAgIH0pOw0KDQogICAgZnVuY3Rpb24gcG9wdWxhdGVDaG9pY2VzKGNob2ljZUJveCwgdmFsdWVzKSB7DQogICAgICBjaG9pY2VzID0gdmFsdWVzLm1hcCgodmFsKSA9PiB7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgdmFsdWU6IHZhbC50b1N0cmluZygpLA0KICAgICAgICAgIGxhYmVsOiB2YWwudG9TdHJpbmcoKSwNCiAgICAgICAgICBzZWxlY3RlZDogZmFsc2UNCiAgICAgICAgfTsNCiAgICAgIH0pOw0KICAgICAgY2hvaWNlcy51bnNoaWZ0KHsNCiAgICAgICAgdmFsdWU6ICdBbGwnLA0KICAgICAgICBsYWJlbDogJ0FsbCcsDQogICAgICAgIHNlbGVjdGVkOiB0cnVlDQogICAgICB9KTsNCiAgICAgIGNob2ljZUJveC5zZXRDaG9pY2VzKGNob2ljZXMsICd2YWx1ZScsICdsYWJlbCcsIHRydWUpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJlbW92ZU9wdGlvbnMoc2VsZWN0Ym94KSB7DQogICAgICB2YXIgaTsNCiAgICAgIGZvciAoaSA9IHNlbGVjdGJveC5vcHRpb25zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7DQogICAgICAgIHNlbGVjdGJveC5yZW1vdmUoaSk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYWRkT3B0aW9uKHNlbGVjdCwgdGV4dCwgdmFsdWUsIHNlbGVjdGVkKSB7DQogICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsNCiAgICAgIGVsLnRleHRDb250ZW50ID0gdGV4dDsNCiAgICAgIGVsLnZhbHVlID0gdmFsdWU7DQogICAgICBlbC5zZWxlY3RlZCA9IHNlbGVjdGVkOw0KICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKGVsKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwb3B1bGF0ZVNlbGVjdChlbGVtZW50SWQsIHZhbHVlcykgew0KICAgICAgdmFyIHNlbGVjdEJveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7DQogICAgICByZW1vdmVPcHRpb25zKHNlbGVjdEJveCk7DQogICAgICBhZGRPcHRpb24oc2VsZWN0Qm94LCAnQWxsJywgJ0FsbCcsIHRydWUpOw0KDQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICB2YXIgb3B0ID0gdmFsdWVzW2ldOw0KICAgICAgICBhZGRPcHRpb24oc2VsZWN0Qm94LCBvcHQsIG9wdCwgZmFsc2UpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGJ1aWxkRmlsdGVycyhsb2dUYWJsZSkgew0KICAgICAgbGV0IHdvcmtlcnMgPSBbLi4ubmV3IFNldChsb2dUYWJsZS5tYXAoaXRlbSA9PiBpdGVtLndvcmtlcikpXS5zb3J0KCk7DQogICAgICBwb3B1bGF0ZVNlbGVjdCgncV93b3JrZXInLCB3b3JrZXJzKTsNCiAgICAgIHBvcHVsYXRlQ2hvaWNlcyh3b3JrZXJDaG9pY2VzLCB3b3JrZXJzKTsNCiAgICAgIGxldCB3b3Jrc3RhdGlvbnMgPSBbLi4ubmV3IFNldChsb2dUYWJsZS5tYXAoaXRlbSA9PiBpdGVtLndvcmtzdGF0aW9uKSldLnNvcnQoKTsNCiAgICAgIHBvcHVsYXRlU2VsZWN0KCdxX3dvcmtzdGF0aW9uJywgd29ya3N0YXRpb25zKTsNCiAgICAgIHBvcHVsYXRlQ2hvaWNlcyh3b3Jrc3RhdGlvbkNob2ljZXMsIHdvcmtzdGF0aW9ucyk7DQogICAgICBsZXQgd29ya2Zsb3dzID0gWy4uLm5ldyBTZXQobG9nVGFibGUubWFwKGl0ZW0gPT4gaXRlbS53b3JrZmxvdykpXS5zb3J0KCk7DQogICAgICBwb3B1bGF0ZVNlbGVjdCgncV93b3JrZmxvdycsIHdvcmtmbG93cyk7DQogICAgICBwb3B1bGF0ZUNob2ljZXMod29ya2Zsb3dDaG9pY2VzLCB3b3JrZmxvd3MpOw0KICAgICAgbGV0IHByb2Nlc3NlcyA9IFsuLi5uZXcgU2V0KGxvZ1RhYmxlLm1hcChpdGVtID0+IGl0ZW0ucHJvY2VzcykpXS5zb3J0KCk7DQogICAgICBwb3B1bGF0ZVNlbGVjdCgncV9wcm9jZXNzJywgcHJvY2Vzc2VzKTsNCiAgICAgIHBvcHVsYXRlQ2hvaWNlcyhwcm9jZXNzQ2hvaWNlcywgcHJvY2Vzc2VzKTsNCiAgICAgIGxldCBjYXRlZ29yaWVzID0gWy4uLm5ldyBTZXQobG9nVGFibGUubWFwKGl0ZW0gPT4gaXRlbS5jYXRlZ29yeSkpXS5zb3J0KCk7DQogICAgICBwb3B1bGF0ZVNlbGVjdCgncV9jYXRlZ29yeScsIGNhdGVnb3JpZXMpOw0KICAgICAgcG9wdWxhdGVDaG9pY2VzKGNhdGVnb3J5Q2hvaWNlcywgY2F0ZWdvcmllcyk7DQogICAgICBsZXQgbGV2ZWxzID0gWy4uLm5ldyBTZXQobG9nVGFibGUubWFwKGl0ZW0gPT4gaXRlbS5sZXZlbCkpXS5zb3J0KCk7DQogICAgICBwb3B1bGF0ZVNlbGVjdCgncV9sZXZlbCcsIGxldmVscyk7DQogICAgICBwb3B1bGF0ZUNob2ljZXMobGV2ZWxDaG9pY2VzLCBsZXZlbHMpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldEludGVnZXJWYWx1ZShlbGVtZW50SWQpIHsNCiAgICAgIHZhciBmb3JtVmFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKS52YWx1ZTsNCiAgICAgIGlmIChOdW1iZXIuaXNOYU4oZm9ybVZhbCkpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gbmV3IE51bWJlcihmb3JtVmFsKS52YWx1ZU9mKCk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2VsZWN0VmFsdWUoZWxlbWVudElkKSB7DQogICAgICB2YXIgc2VsZWN0Qm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKTsNCiAgICAgIHJldHVybiBzZWxlY3RCb3gub3B0aW9uc1tzZWxlY3RCb3guc2VsZWN0ZWRJbmRleF0udmFsdWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2VsZWN0RmlsdGVyKGVsZW1lbnRJZCkgew0KICAgICAgdmFyIHZhbHVlID0gc2VsZWN0VmFsdWUoZWxlbWVudElkKTsNCiAgICAgIGlmICh2YWx1ZSA9PSAnQWxsJykgew0KICAgICAgICByZXR1cm4gdHJ1ZUZpbHRlcjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsKSB7DQogICAgICAgICAgcmV0dXJuICh2YWwgPT0gdmFsdWUpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJ1ZUZpbHRlcigpIHsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGxlc3NUaGFuRmlsdGVyKHVwcGVyTGltaXQpIHsNCiAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsKSB7DQogICAgICAgIHJldHVybiAodmFsIDw9IHVwcGVyTGltaXQpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdyZWF0ZXJUaGFuRmlsdGVyKGxvd2VyTGltaXQpIHsNCiAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsKSB7DQogICAgICAgIHJldHVybiAodmFsID49IGxvd2VyTGltaXQpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGJldHdlZW5GaWx0ZXIobG93ZXJMaW1pdCwgdXBwZXJMaW1pdCkgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWwpIHsNCiAgICAgICAgcmV0dXJuICh2YWwgPj0gbG93ZXJMaW1pdCAmJiB2YWwgPD0gdXBwZXJMaW1pdCk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2VsZWN0RmlsdGVyVGV4dChmaWx0ZXJzLCBlbGVtZW50TmFtZSwgZWxlbWVudElkKSB7DQogICAgICB2YXIgdmFsdWUgPSBzZWxlY3RWYWx1ZShlbGVtZW50SWQpOw0KICAgICAgaWYgKHZhbHVlICE9ICdBbGwnKSB7DQogICAgICAgIGZpbHRlcnMucHVzaChgPGI+JHtlbGVtZW50TmFtZX08L2I+IGlzICIke3ZhbHVlfSJgKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhcHBseUZpbHRlcnMoZSkgew0KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgaW5mby5maWx0ZXJzID0gW107DQogICAgICB2YXIgbGluZUZpbHRlcjsNCiAgICAgIHZhciBkYXRlRmlsdGVyOw0KICAgICAgdmFyIGxpbmVHcmVhdGVyVGhhbiA9IGdldEludGVnZXJWYWx1ZSgncV9saW5lX251bWJlcl9ndGVxJyk7DQogICAgICB2YXIgbGluZUxlc3NUaGFuID0gZ2V0SW50ZWdlclZhbHVlKCdxX2xpbmVfbnVtYmVyX2x0ZXEnKTsNCiAgICAgIGlmIChsaW5lTGVzc1RoYW4gPT0gMCAmJiBsaW5lR3JlYXRlclRoYW4gPT0gMCkgew0KICAgICAgICBsaW5lRmlsdGVyID0gdHJ1ZUZpbHRlcjsNCiAgICAgIH0gZWxzZSBpZiAobGluZUxlc3NUaGFuID09IDApIHsNCiAgICAgICAgbGluZUZpbHRlciA9IGdyZWF0ZXJUaGFuRmlsdGVyKGxpbmVHcmVhdGVyVGhhbik7DQogICAgICAgIGluZm8uZmlsdGVycy5wdXNoKGA8Yj5MaW5lIG51bWJlcjwvYj4gaXMgZ3JlYXRlciB0aGFuICR7bGluZUdyZWF0ZXJUaGFufWApOw0KICAgICAgfSBlbHNlIGlmIChsaW5lR3JlYXRlclRoYW4gPT0gMCkgew0KICAgICAgICBsaW5lRmlsdGVyID0gbGVzc1RoYW5GaWx0ZXIobGluZUxlc3NUaGFuKTsNCiAgICAgICAgaW5mby5maWx0ZXJzLnB1c2goYDxiPkxpbmUgbnVtYmVyPC9iPiBpcyBsZXNzIHRoYW4gJHtsaW5lTGVzc1RoYW59YCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBsaW5lRmlsdGVyID0gYmV0d2VlbkZpbHRlcihsaW5lR3JlYXRlclRoYW4sIGxpbmVMZXNzVGhhbik7DQogICAgICAgIGluZm8uZmlsdGVycy5wdXNoKGA8Yj5MaW5lIG51bWJlcjwvYj4gaXMgYmV0d2VlbiAke2xpbmVMZXNzVGhhbn0gYW5kICR7bGluZUdyZWF0ZXJUaGFufWApOw0KICAgICAgfQ0KICAgICAgdmFyIHdvcmtlckZpbHRlciA9IHNlbGVjdEZpbHRlcigncV93b3JrZXInKTsNCiAgICAgIHNlbGVjdEZpbHRlclRleHQoaW5mby5maWx0ZXJzLCAnV29ya2VyJywgJ3Ffd29ya2VyJyk7DQogICAgICB2YXIgd29ya3N0YXRpb25GaWx0ZXIgPSBzZWxlY3RGaWx0ZXIoJ3Ffd29ya3N0YXRpb24nKTsNCiAgICAgIHNlbGVjdEZpbHRlclRleHQoaW5mby5maWx0ZXJzLCAnV29ya3N0YXRpb24nLCAncV93b3Jrc3RhdGlvbicpOw0KICAgICAgdmFyIHdvcmtmbG93RmlsdGVyID0gc2VsZWN0RmlsdGVyKCdxX3dvcmtmbG93Jyk7DQogICAgICBzZWxlY3RGaWx0ZXJUZXh0KGluZm8uZmlsdGVycywgJ1dvcmtmbG93JywgJ3Ffd29ya2Zsb3cnKTsNCiAgICAgIHZhciBwcm9jZXNzRmlsdGVyID0gc2VsZWN0RmlsdGVyKCdxX3Byb2Nlc3MnKTsNCiAgICAgIHNlbGVjdEZpbHRlclRleHQoaW5mby5maWx0ZXJzLCAnUHJvY2VzcycsICdxX3Byb2Nlc3MnKTsNCiAgICAgIHZhciBjYXRlZ29yeUZpbHRlciA9IHNlbGVjdEZpbHRlcigncV9jYXRlZ29yeScpOw0KICAgICAgc2VsZWN0RmlsdGVyVGV4dChpbmZvLmZpbHRlcnMsICdDYXRlZ29yeScsICdxX2NhdGVnb3J5Jyk7DQogICAgICB2YXIgbGV2ZWxGaWx0ZXIgPSBzZWxlY3RGaWx0ZXIoJ3FfbGV2ZWwnKTsNCiAgICAgIHNlbGVjdEZpbHRlclRleHQoaW5mby5maWx0ZXJzLCAnTGV2ZWwnLCAncV9sZXZlbCcpOw0KICAgICAgdmFyIGRhdGVHcmVhdGVyVGhhbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX2RhdGVfdGltZV9ndGVxJykudmFsdWU7DQogICAgICB2YXIgZGF0ZUxlc3NUaGFuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FfZGF0ZV90aW1lX2x0ZXEnKS52YWx1ZTsNCiAgICAgIGlmIChkYXRlR3JlYXRlclRoYW4gIT0gJycgJiYgZGF0ZUxlc3NUaGFuICE9ICcnKSB7DQogICAgICAgIGRhdGVGaWx0ZXIgPSBiZXR3ZWVuRmlsdGVyKG5ldyBEYXRlKGRhdGVHcmVhdGVyVGhhbiksIG5ldyBEYXRlKGRhdGVMZXNzVGhhbikpOw0KICAgICAgICBpbmZvLmZpbHRlcnMucHVzaChgPGI+RGF0ZS9UaW1lPC9iPiBpcyBiZXR3ZWVuICR7ZGF0ZUxlc3NUaGFufSBhbmQgJHtkYXRlR3JlYXRlclRoYW59YCk7DQogICAgICB9IGVsc2UgaWYgKGRhdGVHcmVhdGVyVGhhbiAhPSAnJykgew0KICAgICAgICBkYXRlRmlsdGVyID0gZ3JlYXRlclRoYW5GaWx0ZXIobmV3IERhdGUoZGF0ZUdyZWF0ZXJUaGFuKSk7DQogICAgICAgIGluZm8uZmlsdGVycy5wdXNoKGA8Yj5EYXRlL1RpbWU8L2I+IGlzIGdyZWF0ZXIgdGhhbiAke2RhdGVHcmVhdGVyVGhhbn1gKTsNCiAgICAgIH0gZWxzZSBpZiAoZGF0ZUxlc3NUaGFuICE9ICcnKSB7DQogICAgICAgIGRhdGVGaWx0ZXIgPSBsZXNzVGhhbkZpbHRlcihuZXcgRGF0ZShkYXRlTGVzc1RoYW4pKTsNCiAgICAgICAgaW5mby5maWx0ZXJzLnB1c2goYDxiPkRhdGUvVGltZTwvYj4gaXMgbGVzcyB0aGFuICR7ZGF0ZUxlc3NUaGFufWApOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZGF0ZUZpbHRlciA9IHRydWVGaWx0ZXI7DQogICAgICB9DQogICAgICBsb2dUYWJsZS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgaXRlbVZhbHVlcyA9IGl0ZW0udmFsdWVzKCk7DQogICAgICAgIHZhciBsaW5lSW5Cb3VuZHMgPSBsaW5lRmlsdGVyKGl0ZW1WYWx1ZXMubGluZU51bWJlcik7DQogICAgICAgIHZhciB3b3JrZXJWYWxpZCA9IHdvcmtlckZpbHRlcihpdGVtVmFsdWVzLndvcmtlcik7DQogICAgICAgIHZhciB3b3Jrc3RhdGlvblZhbGlkID0gd29ya3N0YXRpb25GaWx0ZXIoaXRlbVZhbHVlcy53b3Jrc3RhdGlvbik7DQogICAgICAgIHZhciB3b3JrZmxvd1ZhbGlkID0gd29ya2Zsb3dGaWx0ZXIoaXRlbVZhbHVlcy53b3JrZmxvdyk7DQogICAgICAgIHZhciBwcm9jZXNzVmFsaWQgPSBwcm9jZXNzRmlsdGVyKGl0ZW1WYWx1ZXMucHJvY2Vzcyk7DQogICAgICAgIHZhciBjYXRlZ29yeVZhbGlkID0gY2F0ZWdvcnlGaWx0ZXIoaXRlbVZhbHVlcy5jYXRlZ29yeSk7DQogICAgICAgIHZhciBsZXZlbFZhbGlkID0gbGV2ZWxGaWx0ZXIoaXRlbVZhbHVlcy5sZXZlbCk7DQogICAgICAgIHZhciBkYXRlVmFsaWQgPSBkYXRlRmlsdGVyKGl0ZW1WYWx1ZXMuZGF0ZVRpbWUpOw0KICAgICAgICByZXR1cm4gbGluZUluQm91bmRzICYmIHdvcmtlclZhbGlkICYmIHdvcmtzdGF0aW9uVmFsaWQgJiYgd29ya2Zsb3dWYWxpZCAmJiBwcm9jZXNzVmFsaWQgJiYgY2F0ZWdvcnlWYWxpZCAmJg0KICAgICAgICAgIGxldmVsVmFsaWQgJiYgZGF0ZVZhbGlkOw0KICAgICAgfSk7DQogICAgICBzaG93SW5mbygpOw0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNsZWFyRmlsdGVycygpIHsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX2xpbmVfbnVtYmVyX2d0ZXEnKS52YWx1ZSA9ICcnOw0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FfbGluZV9udW1iZXJfbHRlcScpLnZhbHVlID0gJyc7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV93b3JrZXInKS52YWx1ZSA9ICdBbGwnOw0KICAgICAgd29ya2VyQ2hvaWNlcy5zZXRDaG9pY2VCeVZhbHVlKCdBbGwnKTsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3dvcmtzdGF0aW9uJykudmFsdWUgPSAnQWxsJzsNCiAgICAgIHdvcmtzdGF0aW9uQ2hvaWNlcy5zZXRDaG9pY2VCeVZhbHVlKCdBbGwnKTsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3dvcmtmbG93JykudmFsdWUgPSAnQWxsJzsNCiAgICAgIHdvcmtmbG93Q2hvaWNlcy5zZXRDaG9pY2VCeVZhbHVlKCdBbGwnKTsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3Byb2Nlc3MnKS52YWx1ZSA9ICdBbGwnOw0KICAgICAgcHJvY2Vzc0Nob2ljZXMuc2V0Q2hvaWNlQnlWYWx1ZSgnQWxsJyk7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9jYXRlZ29yeScpLnZhbHVlID0gJ0FsbCc7DQogICAgICBjYXRlZ29yeUNob2ljZXMuc2V0Q2hvaWNlQnlWYWx1ZSgnQWxsJyk7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9sZXZlbCcpLnZhbHVlID0gJ0FsbCc7DQogICAgICBsZXZlbENob2ljZXMuc2V0Q2hvaWNlQnlWYWx1ZSgnQWxsJyk7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9kYXRlX3RpbWVfZ3RlcScpLnZhbHVlID0gJyc7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9kYXRlX3RpbWVfbHRlcScpLnZhbHVlID0gJyc7DQogICAgICBpbmZvLmZpbHRlcnMgPSBbXTsNCiAgICAgIHVwZGF0ZUluZm8oKTsNCiAgICAgIGxvZ1RhYmxlLmZpbHRlcigpOw0KICAgIH0NCiAgICAvKiogZW5kIGZpbHRlcnMgKiovDQoNCiAgICAvL2Rpc3BsYXkgaGFuZGxpbmcNCiAgICAvL2h0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzMwODAvc2V0dGluZy10aGUtaGVpZ2h0LW9mLWEtZGl2LWR5bmFtaWNhbGx5DQogICAgZnVuY3Rpb24gcmVzaXplRWxlbWVudEhlaWdodChlbGVtZW50KSB7DQogICAgICB2YXIgaGVpZ2h0ID0gMDsNCiAgICAgIHZhciBib2R5ID0gd2luZG93LmRvY3VtZW50LmJvZHk7DQogICAgICBpZiAod2luZG93LmlubmVySGVpZ2h0KSB7DQogICAgICAgIGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDsNCiAgICAgIH0gZWxzZSBpZiAoYm9keS5wYXJlbnRFbGVtZW50LmNsaWVudEhlaWdodCkgew0KICAgICAgICBoZWlnaHQgPSBib2R5LnBhcmVudEVsZW1lbnQuY2xpZW50SGVpZ2h0Ow0KICAgICAgfSBlbHNlIGlmIChib2R5ICYmIGJvZHkuY2xpZW50SGVpZ2h0KSB7DQogICAgICAgIGhlaWdodCA9IGJvZHkuY2xpZW50SGVpZ2h0Ow0KICAgICAgfQ0KICAgICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSAoKChoZWlnaHQgLSBlbGVtZW50Lm9mZnNldFRvcCkpICsgInB4Iik7DQogICAgfQ0KDQogICAgLy8gYWRkIGV2ZW50IGNyb3NzIGJyb3dzZXINCiAgICAvL2h0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTAxNDk5NjMvYWRkaW5nLWV2ZW50LWxpc3RlbmVyLWNyb3NzLWJyb3dzZXINCiAgICBmdW5jdGlvbiBhZGRFdmVudChlbGVtLCBldmVudCwgZm4pIHsNCiAgICAgIGlmIChlbGVtLmFkZEV2ZW50TGlzdGVuZXIpIHsNCiAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBmbiwgZmFsc2UpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZWxlbS5hdHRhY2hFdmVudCgib24iICsgZXZlbnQsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAvLyBzZXQgdGhlIHRoaXMgcG9pbnRlciBzYW1lIGFzIGFkZEV2ZW50TGlzdGVuZXIgd2hlbiBmbiBpcyBjYWxsZWQNCiAgICAgICAgICByZXR1cm4gKGZuLmNhbGwoZWxlbSwgd2luZG93LmV2ZW50KSk7DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0NCiAgPC9zY3JpcHQ+DQo8L2JvZHk+DQoNCjwvaHRtbD4=';

  var locator = null;
  var logs = [];
  var selectedLogs = [];
  var currentHref = document.location.href;

  function jsonHandler(json) {
    if (json.body != null) {
      locator = json.name;
      const found = logs.find(log => log.id == json.id);
      if (found == null) {
        logs.push(json);
        populateSelectedLogs(currentHref);
        updateTableViewButton();
      }
    }
  }

  function populateSelectedLogs(href) {
    var queryParts = href.split('?');
    selectedLogs = [];
    if (queryParts.length > 1) {
      var query = queryParts[1].split('&');
      var parameters = { id: '', sid: [] };
      for (var i = 0; i < query.length; i++) {
        var parameterParts = query[i].split('=');
        if (parameterParts[0] == 'id') {
          parameters.id = parameterParts[1];
        } else if (parameterParts[0] == 'sid') {
          var sid = parameterParts[1];
          parameters.sid.push(sid);
          const found = logs.find(log => log.id == sid);
          if (found != null) {
            selectedLogs.push(found);
          }
        }
      }
    }
  }

  function getContent() {
    if (selectedLogs.length == 0) {
      return null;
    } else {
      return selectedLogs.map(log => log.body).join('\r\n');
    }
  }

  function getRecordLocator() {
    if (locator != null) {
      return locator;
    }
    const labels = Array.from(document.querySelectorAll('label'));
    const recordLocatorLabel = labels.find(el => el.textContent === 'Record Locator');
    return recordLocatorLabel.nextSibling.querySelector('input').value;
  }

  function getAgencyName() {
    return document.getElementById('agency-combo').value;
  }

  function getGds(content) {
    return content.includes('<PNRBFManagement') && content.includes('<OwningCRS>1G</OwningCRS>') ? 'Galileo' :
           content.includes('<PNRBFManagement') && content.includes('<OwningCRS>1V</OwningCRS>') ? 'Apollo' :
           content.includes('DIR0DPN') ? 'Worldspan' :
           content.includes('<SabreCommandLLSRQ') || content.includes('SD000766') ? 'Sabre' :
           content.includes('http://xml.amadeus.com/') ? 'Amadeus' :
           'Unknown';
  }

  function getFileDate(content) {
    var logDateMatches = content.match(new RegExp('([\\d]+)/([\\d]+)/([\\d]+) ([\\d]+):([\\d]+):([\\d]+)\\.([\\d]+)'));
    var make2Characters = function (str) { return ('0' + str).substring(str.length - 1) };
    var logDateText = '20' + logDateMatches[3] + '_' + make2Characters(logDateMatches[1]) + '_' + make2Characters(logDateMatches[2]) + '_' + make2Characters(logDateMatches[4]) + '_' + make2Characters(logDateMatches[5]) + '_' + logDateMatches[6];
    return logDateText;
  }

  function getWorkflowName(content) {
    var processRegex = new RegExp('(Workflow:|Name:) "([^"]+)"', 'g');
    var processMatches = [...content.matchAll(processRegex)];
    var processMatch = processMatches.find((wfElement) => { return (wfElement[1] == 'Workflow:') }) || processMatches.find((element) => { return (element[2] !== 'Determine PNR Type' && element[2] !== 'Determine PNR Type - IC Offline (ALTOUR)' && element[2] !== 'Determine PNR Type - IC Online (ALTOUR)') });
    var process = processMatch ? processMatch[2] : 'Unknown';

    return process;
  }

  function getFilename(content) {
    if (content == null) {
      console.log('filename: null');
      return null;
    } else {
      var filenameParts = [getRecordLocator(), getAgencyName().replace(' ', ''), getGds(content), getFileDate(content), getWorkflowName(content)];
      return (filenameParts.join('-') + '.log');
    }
  }

  function updateTableViewButton() {
    const buttons = Array.from(document.querySelectorAll('button'));
    const snippetsButton = buttons.find(el => el.textContent === 'All Snippets' || el.textContent === 'First 15 Snippets');

    if (snippetsButton != null)
    {
      var tableViewButton = document.getElementById('TableViewButton');

      if (tableViewButton == null) {
        const snippetsParent = snippetsButton.parentNode;
        const buttonContainer = snippetsParent.parentNode;

        const tableViewDiv = document.createElement("div");
        for (const parentClass of snippetsParent.classList.values()) {
          // console.log('snippet parent class: ' + parentClass);
          tableViewDiv.classList.add(parentClass);
        }

        tableViewButton = document.createElement("button");
        tableViewButton.id = "TableViewButton";
        for (const buttonClass of snippetsButton.classList.values()) {
          // console.log('snippets class: ' + buttonClass);
          tableViewButton.classList.add(buttonClass);
        }
        tableViewDiv.appendChild(tableViewButton);

        var spanDownload = document.createElement("span");
        spanDownload.innerText = "View as Table";
        tableViewButton.appendChild(spanDownload);

        buttonContainer.appendChild(tableViewDiv);
      }

      var content = getContent();
      if (content != null) {
        if (tableViewButton.classList.contains('Mui-disabled')) {
          tableViewButton.classList.remove('Mui-disabled');
        }
        tableViewButton.onclick = function () {
          // https://stackoverflow.com/questions/11965087/open-a-new-tab-window-and-write-something-to-it#11967627
          // https://stackoverflow.com/a/38866224 - addresses special handling of $$
          // replace \ with \\ in content to avoid occasional errors about octal escape sequences in template literals
          var tab = window.open('about:blank', '_blank');
          tab.document.write(atob(htmlContent).replace('%FILENAME%', getFilename(content)).split('%LOGTEXT%').join(content.replace(/\\/g, '\\\\').replace(/`/g, '\\`'))); // where 'html' is a variable containing your HTML
          tab.document.close(); // to finish loading the page
        };
      } else {
        if (!tableViewButton.classList.contains('Mui-disabled')) {
          tableViewButton.classList.add('Mui-disabled');
        }
      }
    }
  }

  // clone the response to be handled by the original handler
  function responseHandler(response) {
    var clonedResponse = response.clone();
    response.json().then(jsonHandler);
    return clonedResponse;
  }

  if (document.location.hash != '#infoview') {
    // replace the fetch event to allow the script to get log information
    var old_fetch = unsafeWindow.fetch;
    unsafeWindow.fetch = function (resource, init) {
      return old_fetch(resource, init).then(responseHandler);
    }

    // https://stackoverflow.com/questions/3522090/event-when-window-location-href-changes
    var bodyList = document.querySelector("body")

    var observer = new MutationObserver(function (mutations) {
      mutations.forEach(function (mutation) {
        if (currentHref != document.location.href) {
          currentHref = document.location.href;
          populateSelectedLogs(currentHref);
          updateTableViewButton();
        }
      });
    });

    var config = {
      childList: true,
      subtree: true
    };

    observer.observe(bodyList, config);
  }
})();