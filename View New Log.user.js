// ==UserScript==
// @name         View New Log
// @namespace    https://support.concurcompleat.com/Logs/
// @updateURL    https://github.com/thambley/compleat-tampermonkey/raw/main/View%20New%20Log.user.js
// @version      0.36
// @description  View formatted log text
// @author       thambley@tlcorporate.com
// @match        https://support.concurcompleat.com/Logs*
// @match        https://support.concurcompleat.com/logs*
// @grant        unsafeWindow
// ==/UserScript==

(function () {
  'use strict';

  var htmlContent = 'PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbiI+DQoNCjxoZWFkPg0KICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCIgLz4NCiAgPHRpdGxlPmxvZyB0byBodG1sIHVwbG9hZDwvdGl0bGU+DQogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy9sb2ctdG8taHRtbC5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+DQogIDxzdHlsZT4NCiAgICBib2R5IHsNCiAgICAgIGZvbnQtZmFtaWx5OiBzYW5zLXNlcmlmOw0KICAgICAgZm9udC1zaXplOiAxMnB4Ow0KICAgICAgbWFyZ2luOiAwcHg7DQogICAgfQ0KDQogICAgLmNvbnRhaW5lciB7DQogICAgICBtaW4taGVpZ2h0OiA1MHB4Ow0KICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtZmxleDsNCiAgICAgIGZsZXgtd3JhcDogd3JhcDsNCiAgICAgIGZsZXgtZGlyZWN0aW9uOiByb3c7DQogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtc3RhcnQ7DQogICAgICBhbGlnbi1pdGVtczogYXV0bzsNCiAgICAgIGFsaWduLWNvbnRlbnQ6IGNlbnRlcjsNCiAgICB9DQoNCiAgICAuY29udGFpbmVyOmFmdGVyIHsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgLypjb250ZW50OiAiIGludmlzaWJsZSBub2RlICI7Ki8NCiAgICAgIGZsZXg6IDk5OSA5OTkgYXV0bzsNCiAgICB9DQoNCiAgICAuaXRlbSB7DQogICAgICBmbGV4OiAwIDAgYXV0bzsNCiAgICAgIG1hcmdpbjogNXB4Ow0KICAgIH0NCg0KICAgIC5wYWdlZGl2IHsNCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHdoaXRlOw0KICAgIH0NCg0KICAgIC5pbmZvIHsNCiAgICAgIGRpc3BsYXk6IHRhYmxlLWNlbGw7DQogICAgICBwYWRkaW5nOiA1cHg7DQogICAgfQ0KDQogICAgLmhpZGRlbiB7DQogICAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7DQogICAgfQ0KDQogICAgLmluZm9MYWJlbCB7DQogICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgIHBhZGRpbmc6IDVweDsNCiAgICB9DQoNCiAgICAjZGF0YSB7DQogICAgICBjbGVhcjogYm90aDsNCiAgICAgIG92ZXJmbG93OiBhdXRvOw0KICAgICAgd2lkdGg6IDEwMCU7DQogICAgfQ0KDQogICAgLnN1Ym1pdF9idG4gew0KICAgICAgYm9yZGVyLXJhZGl1czogMjAwcHg7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgIGZvbnQtc2l6ZTogMS4wZW07DQogICAgICBmb250LWZhbWlseTogJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsNCiAgICAgIGxpbmUtaGVpZ2h0OiAxMnB4Ow0KICAgICAgbWFyZ2luLXJpZ2h0OiAzcHg7DQogICAgICBwYWRkaW5nOiA3cHggMTZweCA2cHg7DQogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjODM4YTkwOw0KICAgICAgYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgIzgzOGE5MCwgIzQxNDU0OSk7DQogICAgICB0ZXh0LXNoYWRvdzogIzAwMCAwIDFweCAwOw0KICAgICAgYm94LXNoYWRvdzogMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4xKSwgMCAxcHggMCAwcHggcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpIGluc2V0Ow0KICAgICAgYm9yZGVyOiBzb2xpZCAxcHggIzQ4NGU1MzsNCiAgICAgIGJvcmRlci1jb2xvcjogIzQ4NGU1MzsNCiAgICAgIGJvcmRlci10b3AtY29sb3I6ICM2MTZhNzE7DQogICAgICBib3JkZXItcmlnaHQtY29sb3I6ICM0ODRlNTM7DQogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjMzYzYjNmOw0KICAgICAgYm9yZGVyLWxlZnQtY29sb3I6ICM0ODRlNTM7DQogICAgICBjb2xvcjogI2VmZWZlZjsNCiAgICAgIGN1cnNvcjogcG9pbnRlcg0KICAgIH0NCg0KICAgIC5yZXNldF9idG4gew0KICAgICAgYm9yZGVyLXJhZGl1czogMjAwcHg7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgIGZvbnQtc2l6ZTogMS4wZW07DQogICAgICBmb250LWZhbWlseTogJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsNCiAgICAgIGxpbmUtaGVpZ2h0OiAxMnB4Ow0KICAgICAgbWFyZ2luLXJpZ2h0OiAzcHg7DQogICAgICBwYWRkaW5nOiA3cHggMTZweCA2cHg7DQogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGOw0KICAgICAgYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgI2ZmZiwgI0U3RTdFNyk7DQogICAgICBib3gtc2hhZG93OiAwIDFweCAxcHggcmdiYSgwLCAwLCAwLCAwLjEpLCAwIDFweCAwIDAgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjgpIGluc2V0Ow0KICAgICAgYm9yZGVyOiBzb2xpZCAxcHggI2M3YzdjNzsNCiAgICAgIGJvcmRlci1jb2xvcjogI2M3YzdjNzsNCiAgICAgIGJvcmRlci10b3AtY29sb3I6ICNkM2QzZDM7DQogICAgICBib3JkZXItcmlnaHQtY29sb3I6ICNjN2M3Yzc7DQogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjYzJjMmMyOw0KICAgICAgYm9yZGVyLWxlZnQtY29sb3I6ICNjN2M3Yzc7DQogICAgICB0ZXh0LXNoYWRvdzogI2ZmZiAwIDFweCAwOw0KICAgICAgY29sb3I6ICM1RTY0NjkNCiAgICB9DQoNCiAgICB0ZC5uYXRpdmUsIGRpdi5uYXRpdmUgew0KICAgICAgYmFja2dyb3VuZC1jb2xvcjogYmx1ZTsNCiAgICAgIGNvbG9yOiB3aGl0ZTsNCiAgICB9DQoNCgkgIC5jb250cmFjdGVkIHsNCiAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgfQ0KDQogICAgLmV4cGFuZGVkIHsNCiAgICAgIG92ZXJmbG93OiBhdXRvOw0KICAgIH0NCiAgPC9zdHlsZT4NCiAgPCEtLTxsaW5rIGhyZWY9InN0eWxlc2hlZXRzL3NlYXJjaC5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+DQogIDxzdHlsZT4NCiAgICBmb3JtI3NlYXJjaCAuc2VhcmNoX2Zvcm1fZmllbGQgew0KICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDsNCiAgICAgIGNsZWFyOiBib3RoDQogICAgfQ0KDQogICAgZm9ybSNzZWFyY2ggaW5wdXRbdHlwZT10ZXh0XSwNCiAgICBmb3JtI3NlYXJjaCBpbnB1dFt0eXBlPWVtYWlsXSwNCiAgICBmb3JtI3NlYXJjaCBpbnB1dFt0eXBlPW51bWJlcl0sDQogICAgZm9ybSNzZWFyY2ggaW5wdXRbdHlwZT11cmxdLA0KICAgIGZvcm0jc2VhcmNoIGlucHV0W3R5cGU9dGVsXSwNCiAgICBmb3JtI3NlYXJjaCBpbnB1dFt0eXBlPWRhdGVdLA0KICAgIGZvcm0jc2VhcmNoIGlucHV0W3R5cGU9dGltZV0sDQogICAgZm9ybSNzZWFyY2ggdGV4dGFyZWEgew0KICAgICAgLyogd2lkdGg6IGNhbGMoODAlIC0gMjJweCk7Ki8NCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNjOWQwZDY7DQogICAgICBib3JkZXItcmFkaXVzOiAzcHg7DQogICAgICBmb250LXNpemU6IDAuOTVlbTsNCiAgICAgIGZvbnQtZmFtaWx5OiAnSGVsdmV0aWNhIE5ldWUnLCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOw0KICAgICAgb3V0bGluZTogbm9uZTsNCiAgICAgIHBhZGRpbmc6IDhweCAxMHB4IDdweA0KICAgIH0NCg0KICAgIGZvcm0jc2VhcmNoIC5idXR0b25zIHsNCiAgICAgIG1hcmdpbi10b3A6IDE1cHgNCiAgICB9DQoNCiAgICBmb3JtI3NlYXJjaCBzZWxlY3Qgew0KICAgICAgd2lkdGg6IDI0MHB4DQogICAgfQ0KICA8L3N0eWxlPg0KICA8IS0tPGxpbmsgaHJlZj0ic3R5bGVzaGVldHMvZmlsdGVyLmNzcyIgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgLz4tLT4NCiAgPHN0eWxlPg0KICAgIGZvcm0jZmlsdGVyIC5maWx0ZXJfZm9ybV9maWVsZCB7DQogICAgICBtYXJnaW4tYm90dG9tOiAxMHB4Ow0KICAgICAgY2xlYXI6IGJvdGgNCiAgICB9DQoNCiAgICBmb3JtI2ZpbHRlciBpbnB1dFt0eXBlPXRleHRdLA0KICAgIGZvcm0jZmlsdGVyIGlucHV0W3R5cGU9ZW1haWxdLA0KICAgIGZvcm0jZmlsdGVyIGlucHV0W3R5cGU9bnVtYmVyXSwNCiAgICBmb3JtI2ZpbHRlciBpbnB1dFt0eXBlPXVybF0sDQogICAgZm9ybSNmaWx0ZXIgaW5wdXRbdHlwZT10ZWxdLA0KICAgIGZvcm0jZmlsdGVyIGlucHV0W3R5cGU9ZGF0ZV0sDQogICAgZm9ybSNmaWx0ZXIgaW5wdXRbdHlwZT10aW1lXSwNCiAgICBmb3JtI2ZpbHRlciB0ZXh0YXJlYSB7DQogICAgICAvKiB3aWR0aDogY2FsYyg4MCUgLSAyMnB4KTsqLw0KICAgICAgYm9yZGVyOiAxcHggc29saWQgI2M5ZDBkNjsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDNweDsNCiAgICAgIGZvbnQtc2l6ZTogMC45NWVtOw0KICAgICAgZm9udC1mYW1pbHk6ICdIZWx2ZXRpY2EgTmV1ZScsIEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7DQogICAgICBvdXRsaW5lOiBub25lOw0KICAgICAgcGFkZGluZzogOHB4IDEwcHggN3B4DQogICAgfQ0KDQogICAgZm9ybSNmaWx0ZXIgLmJ1dHRvbnMgew0KICAgICAgbWFyZ2luLXRvcDogMTVweA0KICAgIH0NCg0KICAgIGZvcm0jZmlsdGVyIHNlbGVjdCB7DQogICAgICB3aWR0aDogMjQwcHgNCiAgICB9DQogIDwvc3R5bGU+DQogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy9vbm9mZi5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+DQogIDxzdHlsZT4NCiAgICAvKiBodHRwczovL3Byb3RvLmlvL2ZyZWViaWVzL29ub2ZmLyAqLw0KDQogICAgLm9ub2Zmc3dpdGNoIHsNCiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgIHdpZHRoOiA3MHB4Ow0KICAgICAgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIC1tb3otdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAtbXMtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICB1c2VyLXNlbGVjdDogbm9uZTsNCiAgICB9DQoNCiAgICAub25vZmZzd2l0Y2gtY2hlY2tib3ggew0KICAgICAgZGlzcGxheTogbm9uZTsNCiAgICB9DQoNCiAgICAub25vZmZzd2l0Y2gtbGFiZWwgew0KICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgY3Vyc29yOiBwb2ludGVyOw0KICAgICAgYm9yZGVyOiAycHggc29saWQgIzk5OTk5OTsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDE1cHg7DQogICAgfQ0KDQogICAgLm9ub2Zmc3dpdGNoLWlubmVyIHsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgd2lkdGg6IDIwMCU7DQogICAgICBtYXJnaW4tbGVmdDogLTEwMCU7DQogICAgICB0cmFuc2l0aW9uOiBtYXJnaW4gMC4zcyBlYXNlLWluIDBzOw0KICAgIH0NCg0KICAgIC5vbm9mZnN3aXRjaC1pbm5lcjpiZWZvcmUsDQogICAgLm9ub2Zmc3dpdGNoLWlubmVyOmFmdGVyIHsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgZmxvYXQ6IGxlZnQ7DQogICAgICB3aWR0aDogNTAlOw0KICAgICAgaGVpZ2h0OiAyNXB4Ow0KICAgICAgcGFkZGluZzogMDsNCiAgICAgIGxpbmUtaGVpZ2h0OiAyNXB4Ow0KICAgICAgZm9udC1zaXplOiAxMnB4Ow0KICAgICAgY29sb3I6IHdoaXRlOw0KICAgICAgZm9udC1mYW1pbHk6IFRyZWJ1Y2hldCwgQXJpYWwsIHNhbnMtc2VyaWY7DQogICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgfQ0KDQogICAgLm9ub2Zmc3dpdGNoLWlubmVyOmJlZm9yZSB7DQogICAgICBjb250ZW50OiAiT04iOw0KICAgICAgcGFkZGluZy1sZWZ0OiAxMHB4Ow0KICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzM0QTdDMTsNCiAgICAgIGNvbG9yOiAjRkZGRkZGOw0KICAgIH0NCg0KICAgIC5vbm9mZnN3aXRjaC1pbm5lcjphZnRlciB7DQogICAgICBjb250ZW50OiAiT0ZGIjsNCiAgICAgIHBhZGRpbmctcmlnaHQ6IDEwcHg7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRUVFRUVFOw0KICAgICAgY29sb3I6ICM5OTk5OTk7DQogICAgICB0ZXh0LWFsaWduOiByaWdodDsNCiAgICB9DQoNCiAgICAub25vZmZzd2l0Y2gtc3dpdGNoIHsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgd2lkdGg6IDE1cHg7DQogICAgICBtYXJnaW46IDVweDsNCiAgICAgIGJhY2tncm91bmQ6ICNGRkZGRkY7DQogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgICB0b3A6IDA7DQogICAgICBib3R0b206IDA7DQogICAgICByaWdodDogNDFweDsNCiAgICAgIGJvcmRlcjogMnB4IHNvbGlkICM5OTk5OTk7DQogICAgICBib3JkZXItcmFkaXVzOiAxNXB4Ow0KICAgICAgdHJhbnNpdGlvbjogYWxsIDAuM3MgZWFzZS1pbiAwczsNCiAgICB9DQoNCiAgICAub25vZmZzd2l0Y2gtY2hlY2tib3g6Y2hlY2tlZCsub25vZmZzd2l0Y2gtbGFiZWwgLm9ub2Zmc3dpdGNoLWlubmVyIHsNCiAgICAgIG1hcmdpbi1sZWZ0OiAwOw0KICAgIH0NCg0KICAgIC5vbm9mZnN3aXRjaC1jaGVja2JveDpjaGVja2VkKy5vbm9mZnN3aXRjaC1sYWJlbCAub25vZmZzd2l0Y2gtc3dpdGNoIHsNCiAgICAgIHJpZ2h0OiAwcHg7DQogICAgfQ0KICA8L3N0eWxlPg0KICA8IS0tPGxpbmsgaHJlZj0ic3R5bGVzaGVldHMvcmFkaW90b2dnbGUuY3NzIiByZWw9InN0eWxlc2hlZXQiIHR5cGU9InRleHQvY3NzIiAvPi0tPg0KICA8c3R5bGU+DQogICAgLyogVE9HR0xFIFNUWUxJTkcgKi8NCiAgICAucmFkaW9Ub2dnbGUgew0KICAgICAgbWFyZ2luOiAwIDAgMDsNCiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBmb250LXNpemU6IDA7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgZmxleC1mbG93OiByb3cgbm93cmFwOw0KICAgICAganVzdGlmeS1jb250ZW50OiBmbGV4LXN0YXJ0Ow0KICAgICAgYWxpZ24taXRlbXM6IHN0cmV0Y2g7DQoNCiAgICAgIGlucHV0IHsNCiAgICAgICAgd2lkdGg6IDA7DQogICAgICAgIGhlaWdodDogMDsNCiAgICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgICAgICBsZWZ0OiAtOTk5OXB4Ow0KICAgICAgfQ0KDQogICAgICBpbnB1dCArIGxhYmVsIHsNCiAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICBwYWRkaW5nLWxlZnQ6IDEwcHg7DQogICAgICAgIHBhZGRpbmctcmlnaHQ6IDEwcHg7DQogICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgICBib3JkZXI6IHNvbGlkIDJweCAjOTk5OTk5Ow0KICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGOw0KICAgICAgICBjb2xvcjogIzk5OTk5OTsNCiAgICAgICAgZm9udC1zaXplOiAxMnB4Ow0KICAgICAgICBsaW5lLWhlaWdodDogMjVweDsNCiAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgICAgYm94LXNoYWRvdzogMCAwIDAgcmdiYSgyNTUsMjU1LDI1NSwwKTsNCiAgICAgICAgdHJhbnNpdGlvbjogCWJvcmRlci1jb2xvciAuMTVzIGVhc2Utb3V0LA0KICAgICAgICAgICAgICBjb2xvciAuMjVzIGVhc2Utb3V0LA0KICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yIC4xNXMgZWFzZS1vdXQsDQogICAgICAgICAgICAgIGJveC1zaGFkb3cgLjE1cyBlYXNlLW91dDsNCg0KICAgICAgICAvKiBBREQgVEhFU0UgUFJPUEVSVElFUyBUTyBTV0lUQ0ggRlJPTSBBVVRPIFdJRFRIIFRPIEZVTEwgV0lEVEggKi8NCiAgICAgICAgLypmbGV4OiAwIDAgNTAlOyBkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgYWxpZ24taXRlbXM6IGNlbnRlcjsqLw0KICAgICAgICAvKiAtLS0tLSAqLw0KDQogICAgICAgICY6Zmlyc3Qtb2YtdHlwZSB7DQogICAgICAgICAgYm9yZGVyLXJhZGl1czogMTVweCAwIDAgMTVweDsNCiAgICAgICAgICBib3JkZXItcmlnaHQ6IG5vbmU7DQogICAgICAgIH0NCg0KICAgICAgICAmOmxhc3Qtb2YtdHlwZSB7DQogICAgICAgICAgYm9yZGVyLXJhZGl1czogMCAxNXB4IDE1cHggMDsNCiAgICAgICAgICBib3JkZXItbGVmdDogbm9uZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBpbnB1dDpob3ZlciArIGxhYmVsIHsNCiAgICAgICAgYm9yZGVyLWNvbG9yOiAjOTk5OTk5Ow0KICAgICAgfQ0KDQogICAgICBpbnB1dDpjaGVja2VkICsgbGFiZWwgew0KICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMzRBN0MxOw0KICAgICAgICBjb2xvcjogI0ZGRjsNCiAgICAgICAgYm94LXNoYWRvdzogMCAwIDEwcHggcmdiYSgjNjZCM0ZCLCAuNSk7DQogICAgICAgIGJvcmRlci1jb2xvcjogIzk5OTk5OTsNCiAgICAgICAgei1pbmRleDogMTsNCiAgICAgIH0NCg0KICAgICAgaW5wdXQ6Zm9jdXMgKyBsYWJlbCB7DQogICAgICAgIG91dGxpbmU6IGRvdHRlZCAxcHggI0NDQzsNCiAgICAgICAgb3V0bGluZS1vZmZzZXQ6IC40NXJlbTsNCiAgICAgIH0NCg0KICAgICAgQG1lZGlhIChtYXgtd2lkdGg6IDgwMHB4KSB7DQogICAgICAgIGlucHV0ICsgbGFiZWwgew0KICAgICAgICAgIHBhZGRpbmc6IC43NXJlbSAuMjVyZW07DQogICAgICAgICAgZmxleDogMCAwIDUwJTsNCiAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIDwvc3R5bGU+DQogIDwhLS1odHRwOi8vd3d3Lmxpc3Rqcy5jb20vLS0+DQogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy9saXN0LmNzcyIgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgLz4tLT4NCiAgPHN0eWxlPg0KICAgIC8qIHRhYmxlcyAqLw0KICAgIHRhYmxlLmxpc3RhYmxlIHRyOmhvdmVyIHRkIHsNCiAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmMmYyZjI7DQogICAgfQ0KDQogICAgdGFibGUubGlzdGFibGUgdGQsDQogICAgdGFibGUubGlzdGFibGUgdGggew0KICAgICAgcGFkZGluZzogNXB4Ow0KICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7DQogICAgfQ0KDQogICAgdGFibGUubGlzdGFibGUgew0KICAgICAgYmFja2dyb3VuZC1jb2xvcjogYmxhY2s7DQogICAgfQ0KDQogICAgdGQudGV4dCB7DQogICAgICB3aGl0ZS1zcGFjZTogcHJlOw0KICAgICAgZm9udC1mYW1pbHk6IGNvdXJpZXIgbmV3Ow0KICAgIH0NCg0KICAgIC5wYWdpbmF0aW9uIGxpIHsNCiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgIHBhZGRpbmc6IDVweDsNCiAgICB9DQoNCiAgICAucGFnaW5hdGlvbiBsaS5hY3RpdmUgew0KICAgICAgYm9yZGVyOiAxcHggc29saWQgYmxhY2s7DQogICAgICBib3JkZXItcmFkaXVzOiA2cHg7DQogICAgfQ0KDQogICAgLnBhZ2luYXRpb24gbGkgYS5wYWdlIHsNCiAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsNCiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgY29sb3I6IGJsYWNrOw0KICAgIH0NCg0KICAgIC5zZWFyY2ggew0KICAgICAgYm9yZGVyOiBzb2xpZCAxcHggI2NjYzsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDVweDsNCiAgICAgIHBhZGRpbmc6IDdweCAxNHB4Ow0KICAgICAgbWFyZ2luLXRvcDogMTBweA0KICAgIH0NCg0KICAgIHRhYmxlLnNvcnRhYmxlIHRoZWFkIHRyIC5zb3J0IHsNCiAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoRlFBSkFJQUFBQ010TVAvLy95SDVCQUVBQUFFQUxBQUFBQUFWQUFrQUFBSVhqSStBeXduYVluaFVNb3F0M2daWFBtVmc5NHlKVlFBQU93PT0pOw0KICAgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsNCiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlciByaWdodDsNCiAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICAgIHBhZGRpbmctcmlnaHQ6IDIwcHg7DQogICAgfQ0KDQogICAgdGFibGUuc29ydGFibGUgdGhlYWQgdHIgLmFzYyB7DQogICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoRlFBRUFJQUFBQ010TVAvLy95SDVCQUVBQUFFQUxBQUFBQUFWQUFRQUFBSU5qQitnQytqUDJwdG4wV3NrTFFBNyk7DQogICAgfQ0KDQogICAgdGFibGUuc29ydGFibGUgdGhlYWQgdHIgLmRlc2Mgew0KICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEZRQUVBSUFBQUNNdE1QLy8veUg1QkFFQUFBRUFMQUFBQUFBVkFBUUFBQUlOakk4QnlhMnduSU5VTW9wWkFRQTcpOw0KICAgIH0NCg0KICAgIHRhYmxlLnNvcnRhYmxlIHRoZWFkIHRyIC5hc2MsDQogICAgdGFibGUuc29ydGFibGUgdGhlYWQgdHIgLmRlc2Mgew0KICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzhkYmRkODsNCiAgICB9DQogIDwvc3R5bGU+DQogIDwhLS08c2NyaXB0IHNyYz0iamF2YXNjcmlwdHMvbGlzdC5qcyI+PC9zY3JpcHQ+LS0+DQogIDxzY3JpcHQ+DQogIC8vIExpc3QuanMgdjEuMy4wIChodHRwOi8vd3d3Lmxpc3Rqcy5jb20pIGJ5IEpvbm55IFN0csO2bWJlcmcgKGh0dHA6Ly9qYXZ2ZS5jb20pDQooZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoIkNhbm5vdCBmaW5kIG1vZHVsZSAnIitvKyInIik7dGhyb3cgZi5jb2RlPSJNT0RVTEVfTk9UX0ZPVU5EIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pKHsxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCihmdW5jdGlvbiggd2luZG93LCB1bmRlZmluZWQgKSB7DQoidXNlIHN0cmljdCI7DQoNCnZhciBkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudCwNCiAgZ2V0QnlDbGFzcyA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL2dldC1ieS1jbGFzcycpLA0KICBleHRlbmQgPSByZXF1aXJlKCcuL3NyYy91dGlscy9leHRlbmQnKSwNCiAgaW5kZXhPZiA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL2luZGV4LW9mJyksDQogIGV2ZW50cyA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL2V2ZW50cycpLA0KICB0b1N0cmluZyA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL3RvLXN0cmluZycpLA0KICBuYXR1cmFsU29ydCA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL25hdHVyYWwtc29ydCcpLA0KICBjbGFzc2VzID0gcmVxdWlyZSgnLi9zcmMvdXRpbHMvY2xhc3NlcycpLA0KICBnZXRBdHRyaWJ1dGUgPSByZXF1aXJlKCcuL3NyYy91dGlscy9nZXQtYXR0cmlidXRlJyksDQogIHRvQXJyYXkgPSByZXF1aXJlKCcuL3NyYy91dGlscy90by1hcnJheScpOw0KDQp2YXIgTGlzdCA9IGZ1bmN0aW9uKGlkLCBvcHRpb25zLCB2YWx1ZXMpIHsNCg0KICB2YXIgc2VsZiA9IHRoaXMsDQogICAgaW5pdCwNCiAgICBJdGVtID0gcmVxdWlyZSgnLi9zcmMvaXRlbScpKHNlbGYpLA0KICAgIGFkZEFzeW5jID0gcmVxdWlyZSgnLi9zcmMvYWRkLWFzeW5jJykoc2VsZik7DQoNCiAgaW5pdCA9IHsNCiAgICBzdGFydDogZnVuY3Rpb24oKSB7DQogICAgICBzZWxmLmxpc3RDbGFzcyAgICAgID0gImxpc3QiOw0KICAgICAgc2VsZi5zZWFyY2hDbGFzcyAgICA9ICJzZWFyY2giOw0KICAgICAgc2VsZi5zb3J0Q2xhc3MgICAgICA9ICJzb3J0IjsNCiAgICAgIHNlbGYucGFnZSAgICAgICAgICAgPSAxMDAwMDsNCiAgICAgIHNlbGYuaSAgICAgICAgICAgICAgPSAxOw0KICAgICAgc2VsZi5pdGVtcyAgICAgICAgICA9IFtdOw0KICAgICAgc2VsZi52aXNpYmxlSXRlbXMgICA9IFtdOw0KICAgICAgc2VsZi5tYXRjaGluZ0l0ZW1zICA9IFtdOw0KICAgICAgc2VsZi5zZWFyY2hlZCAgICAgICA9IGZhbHNlOw0KICAgICAgc2VsZi5maWx0ZXJlZCAgICAgICA9IGZhbHNlOw0KICAgICAgc2VsZi5zZWFyY2hDb2x1bW5zICA9IHVuZGVmaW5lZDsNCiAgICAgIHNlbGYuaGFuZGxlcnMgICAgICAgPSB7ICd1cGRhdGVkJzogW10gfTsNCiAgICAgIHNlbGYucGx1Z2lucyAgICAgICAgPSB7fTsNCiAgICAgIHNlbGYudmFsdWVOYW1lcyAgICAgPSBbXTsNCiAgICAgIHNlbGYudXRpbHMgICAgICAgICAgPSB7DQogICAgICAgIGdldEJ5Q2xhc3M6IGdldEJ5Q2xhc3MsDQogICAgICAgIGV4dGVuZDogZXh0ZW5kLA0KICAgICAgICBpbmRleE9mOiBpbmRleE9mLA0KICAgICAgICBldmVudHM6IGV2ZW50cywNCiAgICAgICAgdG9TdHJpbmc6IHRvU3RyaW5nLA0KICAgICAgICBuYXR1cmFsU29ydDogbmF0dXJhbFNvcnQsDQogICAgICAgIGNsYXNzZXM6IGNsYXNzZXMsDQogICAgICAgIGdldEF0dHJpYnV0ZTogZ2V0QXR0cmlidXRlLA0KICAgICAgICB0b0FycmF5OiB0b0FycmF5DQogICAgICB9Ow0KDQogICAgICBzZWxmLnV0aWxzLmV4dGVuZChzZWxmLCBvcHRpb25zKTsNCg0KICAgICAgc2VsZi5saXN0Q29udGFpbmVyID0gKHR5cGVvZihpZCkgPT09ICdzdHJpbmcnKSA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSA6IGlkOw0KICAgICAgaWYgKCFzZWxmLmxpc3RDb250YWluZXIpIHsgcmV0dXJuOyB9DQogICAgICBzZWxmLmxpc3QgICAgICAgPSBnZXRCeUNsYXNzKHNlbGYubGlzdENvbnRhaW5lciwgc2VsZi5saXN0Q2xhc3MsIHRydWUpOw0KDQogICAgICBzZWxmLnBhcnNlICAgICAgPSByZXF1aXJlKCcuL3NyYy9wYXJzZScpKHNlbGYpOw0KICAgICAgc2VsZi50ZW1wbGF0ZXIgID0gcmVxdWlyZSgnLi9zcmMvdGVtcGxhdGVyJykoc2VsZik7DQogICAgICBzZWxmLnNlYXJjaCAgICAgPSByZXF1aXJlKCcuL3NyYy9zZWFyY2gnKShzZWxmKTsNCiAgICAgIHNlbGYuZmlsdGVyICAgICA9IHJlcXVpcmUoJy4vc3JjL2ZpbHRlcicpKHNlbGYpOw0KICAgICAgc2VsZi5zb3J0ICAgICAgID0gcmVxdWlyZSgnLi9zcmMvc29ydCcpKHNlbGYpOw0KDQogICAgICB0aGlzLmhhbmRsZXJzKCk7DQogICAgICB0aGlzLml0ZW1zKCk7DQogICAgICBzZWxmLnVwZGF0ZSgpOw0KICAgICAgdGhpcy5wbHVnaW5zKCk7DQogICAgfSwNCiAgICBoYW5kbGVyczogZnVuY3Rpb24oKSB7DQogICAgICBmb3IgKHZhciBoYW5kbGVyIGluIHNlbGYuaGFuZGxlcnMpIHsNCiAgICAgICAgaWYgKHNlbGZbaGFuZGxlcl0pIHsNCiAgICAgICAgICBzZWxmLm9uKGhhbmRsZXIsIHNlbGZbaGFuZGxlcl0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBpdGVtczogZnVuY3Rpb24oKSB7DQogICAgICBzZWxmLnBhcnNlKHNlbGYubGlzdCk7DQogICAgICBpZiAodmFsdWVzICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgc2VsZi5hZGQodmFsdWVzKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHBsdWdpbnM6IGZ1bmN0aW9uKCkgew0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLnBsdWdpbnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgdmFyIHBsdWdpbiA9IHNlbGYucGx1Z2luc1tpXTsNCiAgICAgICAgc2VsZltwbHVnaW4ubmFtZV0gPSBwbHVnaW47DQogICAgICAgIHBsdWdpbi5pbml0KHNlbGYsIExpc3QpOw0KICAgICAgfQ0KICAgIH0NCiAgfTsNCg0KICAvKg0KICAqIFJlLXBhcnNlIHRoZSBMaXN0LCB1c2UgaWYgaHRtbCBoYXZlIGNoYW5nZWQNCiAgKi8NCiAgdGhpcy5yZUluZGV4ID0gZnVuY3Rpb24oKSB7DQogICAgc2VsZi5pdGVtcyAgICAgICAgICA9IFtdOw0KICAgIHNlbGYudmlzaWJsZUl0ZW1zICAgPSBbXTsNCiAgICBzZWxmLm1hdGNoaW5nSXRlbXMgID0gW107DQogICAgc2VsZi5zZWFyY2hlZCAgICAgICA9IGZhbHNlOw0KICAgIHNlbGYuZmlsdGVyZWQgICAgICAgPSBmYWxzZTsNCiAgICBzZWxmLnBhcnNlKHNlbGYubGlzdCk7DQogIH07DQoNCiAgdGhpcy50b0pTT04gPSBmdW5jdGlvbigpIHsNCiAgICB2YXIganNvbiA9IFtdOw0KICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IHNlbGYuaXRlbXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAganNvbi5wdXNoKHNlbGYuaXRlbXNbaV0udmFsdWVzKCkpOw0KICAgIH0NCiAgICByZXR1cm4ganNvbjsNCiAgfTsNCg0KDQogIC8qDQogICogQWRkIG9iamVjdCB0byBsaXN0DQogICovDQogIHRoaXMuYWRkID0gZnVuY3Rpb24odmFsdWVzLCBjYWxsYmFjaykgew0KICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKSB7DQogICAgICByZXR1cm47DQogICAgfQ0KICAgIGlmIChjYWxsYmFjaykgew0KICAgICAgYWRkQXN5bmModmFsdWVzLCBjYWxsYmFjayk7DQogICAgICByZXR1cm47DQogICAgfQ0KICAgIHZhciBhZGRlZCA9IFtdLA0KICAgICAgbm90Q3JlYXRlID0gZmFsc2U7DQogICAgaWYgKHZhbHVlc1swXSA9PT0gdW5kZWZpbmVkKXsNCiAgICAgIHZhbHVlcyA9IFt2YWx1ZXNdOw0KICAgIH0NCiAgICBmb3IgKHZhciBpID0gMCwgaWwgPSB2YWx1ZXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgdmFyIGl0ZW0gPSBudWxsOw0KICAgICAgbm90Q3JlYXRlID0gKHNlbGYuaXRlbXMubGVuZ3RoID4gc2VsZi5wYWdlKSA/IHRydWUgOiBmYWxzZTsNCiAgICAgIGl0ZW0gPSBuZXcgSXRlbSh2YWx1ZXNbaV0sIHVuZGVmaW5lZCwgbm90Q3JlYXRlKTsNCiAgICAgIHNlbGYuaXRlbXMucHVzaChpdGVtKTsNCiAgICAgIGFkZGVkLnB1c2goaXRlbSk7DQogICAgfQ0KICAgIHNlbGYudXBkYXRlKCk7DQogICAgcmV0dXJuIGFkZGVkOw0KICB9Ow0KDQoJdGhpcy5zaG93ID0gZnVuY3Rpb24oaSwgcGFnZSkgew0KCQl0aGlzLmkgPSBpOw0KCQl0aGlzLnBhZ2UgPSBwYWdlOw0KCQlzZWxmLnVwZGF0ZSgpOw0KICAgIHJldHVybiBzZWxmOw0KCX07DQoNCiAgLyogUmVtb3ZlcyBvYmplY3QgZnJvbSBsaXN0Lg0KICAqIExvb3BzIHRocm91Z2ggdGhlIGxpc3QgYW5kIHJlbW92ZXMgb2JqZWN0cyB3aGVyZQ0KICAqIHByb3BlcnR5ICJ2YWx1ZW5hbWUiID09PSB2YWx1ZQ0KICAqLw0KICB0aGlzLnJlbW92ZSA9IGZ1bmN0aW9uKHZhbHVlTmFtZSwgdmFsdWUsIG9wdGlvbnMpIHsNCiAgICB2YXIgZm91bmQgPSAwOw0KICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IHNlbGYuaXRlbXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgaWYgKHNlbGYuaXRlbXNbaV0udmFsdWVzKClbdmFsdWVOYW1lXSA9PSB2YWx1ZSkgew0KICAgICAgICBzZWxmLnRlbXBsYXRlci5yZW1vdmUoc2VsZi5pdGVtc1tpXSwgb3B0aW9ucyk7DQogICAgICAgIHNlbGYuaXRlbXMuc3BsaWNlKGksMSk7DQogICAgICAgIGlsLS07DQogICAgICAgIGktLTsNCiAgICAgICAgZm91bmQrKzsNCiAgICAgIH0NCiAgICB9DQogICAgc2VsZi51cGRhdGUoKTsNCiAgICByZXR1cm4gZm91bmQ7DQogIH07DQoNCiAgLyogR2V0cyB0aGUgb2JqZWN0cyBpbiB0aGUgbGlzdCB3aGljaA0KICAqIHByb3BlcnR5ICJ2YWx1ZU5hbWUiID09PSB2YWx1ZQ0KICAqLw0KICB0aGlzLmdldCA9IGZ1bmN0aW9uKHZhbHVlTmFtZSwgdmFsdWUpIHsNCiAgICB2YXIgbWF0Y2hlZEl0ZW1zID0gW107DQogICAgZm9yICh2YXIgaSA9IDAsIGlsID0gc2VsZi5pdGVtcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXNbaV07DQogICAgICBpZiAoaXRlbS52YWx1ZXMoKVt2YWx1ZU5hbWVdID09IHZhbHVlKSB7DQogICAgICAgIG1hdGNoZWRJdGVtcy5wdXNoKGl0ZW0pOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbWF0Y2hlZEl0ZW1zOw0KICB9Ow0KDQogIC8qDQogICogR2V0IHNpemUgb2YgdGhlIGxpc3QNCiAgKi8NCiAgdGhpcy5zaXplID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHNlbGYuaXRlbXMubGVuZ3RoOw0KICB9Ow0KDQogIC8qDQogICogUmVtb3ZlcyBhbGwgaXRlbXMgZnJvbSB0aGUgbGlzdA0KICAqLw0KICB0aGlzLmNsZWFyID0gZnVuY3Rpb24oKSB7DQogICAgc2VsZi50ZW1wbGF0ZXIuY2xlYXIoKTsNCiAgICBzZWxmLml0ZW1zID0gW107DQogICAgcmV0dXJuIHNlbGY7DQogIH07DQoNCiAgdGhpcy5vbiA9IGZ1bmN0aW9uKGV2ZW50LCBjYWxsYmFjaykgew0KICAgIHNlbGYuaGFuZGxlcnNbZXZlbnRdLnB1c2goY2FsbGJhY2spOw0KICAgIHJldHVybiBzZWxmOw0KICB9Ow0KDQogIHRoaXMub2ZmID0gZnVuY3Rpb24oZXZlbnQsIGNhbGxiYWNrKSB7DQogICAgdmFyIGUgPSBzZWxmLmhhbmRsZXJzW2V2ZW50XTsNCiAgICB2YXIgaW5kZXggPSBpbmRleE9mKGUsIGNhbGxiYWNrKTsNCiAgICBpZiAoaW5kZXggPiAtMSkgew0KICAgICAgZS5zcGxpY2UoaW5kZXgsIDEpOw0KICAgIH0NCiAgICByZXR1cm4gc2VsZjsNCiAgfTsNCg0KICB0aGlzLnRyaWdnZXIgPSBmdW5jdGlvbihldmVudCkgew0KICAgIHZhciBpID0gc2VsZi5oYW5kbGVyc1tldmVudF0ubGVuZ3RoOw0KICAgIHdoaWxlKGktLSkgew0KICAgICAgc2VsZi5oYW5kbGVyc1tldmVudF1baV0oc2VsZik7DQogICAgfQ0KICAgIHJldHVybiBzZWxmOw0KICB9Ow0KDQogIHRoaXMucmVzZXQgPSB7DQogICAgZmlsdGVyOiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBpcyA9IHNlbGYuaXRlbXMsDQogICAgICAgIGlsID0gaXMubGVuZ3RoOw0KICAgICAgd2hpbGUgKGlsLS0pIHsNCiAgICAgICAgaXNbaWxdLmZpbHRlcmVkID0gZmFsc2U7DQogICAgICB9DQogICAgICByZXR1cm4gc2VsZjsNCiAgICB9LA0KICAgIHNlYXJjaDogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgaXMgPSBzZWxmLml0ZW1zLA0KICAgICAgICBpbCA9IGlzLmxlbmd0aDsNCiAgICAgIHdoaWxlIChpbC0tKSB7DQogICAgICAgIGlzW2lsXS5mb3VuZCA9IGZhbHNlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KICB9Ow0KDQogIHRoaXMudXBkYXRlID0gZnVuY3Rpb24oKSB7DQogICAgdmFyIGlzID0gc2VsZi5pdGVtcywNCgkJCWlsID0gaXMubGVuZ3RoOw0KDQogICAgc2VsZi52aXNpYmxlSXRlbXMgPSBbXTsNCiAgICBzZWxmLm1hdGNoaW5nSXRlbXMgPSBbXTsNCiAgICBzZWxmLnRlbXBsYXRlci5jbGVhcigpOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaWw7IGkrKykgew0KICAgICAgaWYgKGlzW2ldLm1hdGNoaW5nKCkgJiYgKChzZWxmLm1hdGNoaW5nSXRlbXMubGVuZ3RoKzEpID49IHNlbGYuaSAmJiBzZWxmLnZpc2libGVJdGVtcy5sZW5ndGggPCBzZWxmLnBhZ2UpKSB7DQogICAgICAgIGlzW2ldLnNob3coKTsNCiAgICAgICAgc2VsZi52aXNpYmxlSXRlbXMucHVzaChpc1tpXSk7DQogICAgICAgIHNlbGYubWF0Y2hpbmdJdGVtcy5wdXNoKGlzW2ldKTsNCiAgICAgIH0gZWxzZSBpZiAoaXNbaV0ubWF0Y2hpbmcoKSkgew0KICAgICAgICBzZWxmLm1hdGNoaW5nSXRlbXMucHVzaChpc1tpXSk7DQogICAgICAgIGlzW2ldLmhpZGUoKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlzW2ldLmhpZGUoKTsNCiAgICAgIH0NCiAgICB9DQogICAgc2VsZi50cmlnZ2VyKCd1cGRhdGVkJyk7DQogICAgcmV0dXJuIHNlbGY7DQogIH07DQoNCiAgaW5pdC5zdGFydCgpOw0KfTsNCg0KDQovLyBBTUQgc3VwcG9ydA0KaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgew0KICBkZWZpbmUoZnVuY3Rpb24gKCkgeyByZXR1cm4gTGlzdDsgfSk7DQp9DQptb2R1bGUuZXhwb3J0cyA9IExpc3Q7DQp3aW5kb3cuTGlzdCA9IExpc3Q7DQoNCn0pKHdpbmRvdyk7DQoNCn0seyIuL3NyYy9hZGQtYXN5bmMiOjIsIi4vc3JjL2ZpbHRlciI6MywiLi9zcmMvaXRlbSI6NCwiLi9zcmMvcGFyc2UiOjUsIi4vc3JjL3NlYXJjaCI6NiwiLi9zcmMvc29ydCI6NywiLi9zcmMvdGVtcGxhdGVyIjo4LCIuL3NyYy91dGlscy9jbGFzc2VzIjo5LCIuL3NyYy91dGlscy9ldmVudHMiOjEwLCIuL3NyYy91dGlscy9leHRlbmQiOjExLCIuL3NyYy91dGlscy9nZXQtYXR0cmlidXRlIjoxMiwiLi9zcmMvdXRpbHMvZ2V0LWJ5LWNsYXNzIjoxMywiLi9zcmMvdXRpbHMvaW5kZXgtb2YiOjE0LCIuL3NyYy91dGlscy9uYXR1cmFsLXNvcnQiOjE1LCIuL3NyYy91dGlscy90by1hcnJheSI6MTYsIi4vc3JjL3V0aWxzL3RvLXN0cmluZyI6MTd9XSwyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obGlzdCkgew0KICB2YXIgYWRkQXN5bmMgPSBmdW5jdGlvbih2YWx1ZXMsIGNhbGxiYWNrLCBpdGVtcykgew0KICAgIHZhciB2YWx1ZXNUb0FkZCA9IHZhbHVlcy5zcGxpY2UoMCwgNTApOw0KICAgIGl0ZW1zID0gaXRlbXMgfHwgW107DQogICAgaXRlbXMgPSBpdGVtcy5jb25jYXQobGlzdC5hZGQodmFsdWVzVG9BZGQpKTsNCiAgICBpZiAodmFsdWVzLmxlbmd0aCA+IDApIHsNCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgIGFkZEFzeW5jKHZhbHVlcywgY2FsbGJhY2ssIGl0ZW1zKTsNCiAgICAgIH0sIDEpOw0KICAgIH0gZWxzZSB7DQogICAgICBsaXN0LnVwZGF0ZSgpOw0KICAgICAgY2FsbGJhY2soaXRlbXMpOw0KICAgIH0NCiAgfTsNCiAgcmV0dXJuIGFkZEFzeW5jOw0KfTsNCg0KfSx7fV0sMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGxpc3QpIHsNCg0KICAvLyBBZGQgaGFuZGxlcnMNCiAgbGlzdC5oYW5kbGVycy5maWx0ZXJTdGFydCA9IGxpc3QuaGFuZGxlcnMuZmlsdGVyU3RhcnQgfHwgW107DQogIGxpc3QuaGFuZGxlcnMuZmlsdGVyQ29tcGxldGUgPSBsaXN0LmhhbmRsZXJzLmZpbHRlckNvbXBsZXRlIHx8IFtdOw0KDQogIHJldHVybiBmdW5jdGlvbihmaWx0ZXJGdW5jdGlvbikgew0KICAgIGxpc3QudHJpZ2dlcignZmlsdGVyU3RhcnQnKTsNCiAgICBsaXN0LmkgPSAxOyAvLyBSZXNldCBwYWdpbmcNCiAgICBsaXN0LnJlc2V0LmZpbHRlcigpOw0KICAgIGlmIChmaWx0ZXJGdW5jdGlvbiA9PT0gdW5kZWZpbmVkKSB7DQogICAgICBsaXN0LmZpbHRlcmVkID0gZmFsc2U7DQogICAgfSBlbHNlIHsNCiAgICAgIGxpc3QuZmlsdGVyZWQgPSB0cnVlOw0KICAgICAgdmFyIGlzID0gbGlzdC5pdGVtczsNCiAgICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IGlzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsNCiAgICAgICAgdmFyIGl0ZW0gPSBpc1tpXTsNCiAgICAgICAgaWYgKGZpbHRlckZ1bmN0aW9uKGl0ZW0pKSB7DQogICAgICAgICAgaXRlbS5maWx0ZXJlZCA9IHRydWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaXRlbS5maWx0ZXJlZCA9IGZhbHNlOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIGxpc3QudXBkYXRlKCk7DQogICAgbGlzdC50cmlnZ2VyKCdmaWx0ZXJDb21wbGV0ZScpOw0KICAgIHJldHVybiBsaXN0LnZpc2libGVJdGVtczsNCiAgfTsNCn07DQoNCn0se31dLDQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihsaXN0KSB7DQogIHJldHVybiBmdW5jdGlvbihpbml0VmFsdWVzLCBlbGVtZW50LCBub3RDcmVhdGUpIHsNCiAgICB2YXIgaXRlbSA9IHRoaXM7DQoNCiAgICB0aGlzLl92YWx1ZXMgPSB7fTsNCg0KICAgIHRoaXMuZm91bmQgPSBmYWxzZTsgLy8gU2hvdyBpZiBsaXN0LnNlYXJjaGVkID09IHRydWUgYW5kIHRoaXMuZm91bmQgPT0gdHJ1ZQ0KICAgIHRoaXMuZmlsdGVyZWQgPSBmYWxzZTsvLyBTaG93IGlmIGxpc3QuZmlsdGVyZWQgPT0gdHJ1ZSBhbmQgdGhpcy5maWx0ZXJlZCA9PSB0cnVlDQoNCiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKGluaXRWYWx1ZXMsIGVsZW1lbnQsIG5vdENyZWF0ZSkgew0KICAgICAgaWYgKGVsZW1lbnQgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICBpZiAobm90Q3JlYXRlKSB7DQogICAgICAgICAgaXRlbS52YWx1ZXMoaW5pdFZhbHVlcywgbm90Q3JlYXRlKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpdGVtLnZhbHVlcyhpbml0VmFsdWVzKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaXRlbS5lbG0gPSBlbGVtZW50Ow0KICAgICAgICB2YXIgdmFsdWVzID0gbGlzdC50ZW1wbGF0ZXIuZ2V0KGl0ZW0sIGluaXRWYWx1ZXMpOw0KICAgICAgICBpdGVtLnZhbHVlcyh2YWx1ZXMpOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICB0aGlzLnZhbHVlcyA9IGZ1bmN0aW9uKG5ld1ZhbHVlcywgbm90Q3JlYXRlKSB7DQogICAgICBpZiAobmV3VmFsdWVzICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgZm9yKHZhciBuYW1lIGluIG5ld1ZhbHVlcykgew0KICAgICAgICAgIGl0ZW0uX3ZhbHVlc1tuYW1lXSA9IG5ld1ZhbHVlc1tuYW1lXTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAobm90Q3JlYXRlICE9PSB0cnVlKSB7DQogICAgICAgICAgbGlzdC50ZW1wbGF0ZXIuc2V0KGl0ZW0sIGl0ZW0udmFsdWVzKCkpOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gaXRlbS5fdmFsdWVzOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICB0aGlzLnNob3cgPSBmdW5jdGlvbigpIHsNCiAgICAgIGxpc3QudGVtcGxhdGVyLnNob3coaXRlbSk7DQogICAgfTsNCg0KICAgIHRoaXMuaGlkZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgbGlzdC50ZW1wbGF0ZXIuaGlkZShpdGVtKTsNCiAgICB9Ow0KDQogICAgdGhpcy5tYXRjaGluZyA9IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuICgNCiAgICAgICAgKGxpc3QuZmlsdGVyZWQgJiYgbGlzdC5zZWFyY2hlZCAmJiBpdGVtLmZvdW5kICYmIGl0ZW0uZmlsdGVyZWQpIHx8DQogICAgICAgIChsaXN0LmZpbHRlcmVkICYmICFsaXN0LnNlYXJjaGVkICYmIGl0ZW0uZmlsdGVyZWQpIHx8DQogICAgICAgICghbGlzdC5maWx0ZXJlZCAmJiBsaXN0LnNlYXJjaGVkICYmIGl0ZW0uZm91bmQpIHx8DQogICAgICAgICghbGlzdC5maWx0ZXJlZCAmJiAhbGlzdC5zZWFyY2hlZCkNCiAgICAgICk7DQogICAgfTsNCg0KICAgIHRoaXMudmlzaWJsZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIChpdGVtLmVsbSAmJiAoaXRlbS5lbG0ucGFyZW50Tm9kZSA9PSBsaXN0Lmxpc3QpKSA/IHRydWUgOiBmYWxzZTsNCiAgICB9Ow0KDQogICAgaW5pdChpbml0VmFsdWVzLCBlbGVtZW50LCBub3RDcmVhdGUpOw0KICB9Ow0KfTsNCg0KfSx7fV0sNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGxpc3QpIHsNCg0KICB2YXIgSXRlbSA9IHJlcXVpcmUoJy4vaXRlbScpKGxpc3QpOw0KDQogIHZhciBnZXRDaGlsZHJlbiA9IGZ1bmN0aW9uKHBhcmVudCkgew0KICAgIHZhciBub2RlcyA9IHBhcmVudC5jaGlsZE5vZGVzLA0KICAgICAgaXRlbXMgPSBbXTsNCiAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBub2Rlcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICAvLyBPbmx5IHRleHRub2RlcyBoYXZlIGEgZGF0YSBhdHRyaWJ1dGUNCiAgICAgIGlmIChub2Rlc1tpXS5kYXRhID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgaXRlbXMucHVzaChub2Rlc1tpXSk7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBpdGVtczsNCiAgfTsNCg0KICB2YXIgcGFyc2UgPSBmdW5jdGlvbihpdGVtRWxlbWVudHMsIHZhbHVlTmFtZXMpIHsNCiAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBpdGVtRWxlbWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgbGlzdC5pdGVtcy5wdXNoKG5ldyBJdGVtKHZhbHVlTmFtZXMsIGl0ZW1FbGVtZW50c1tpXSkpOw0KICAgIH0NCiAgfTsNCiAgdmFyIHBhcnNlQXN5bmMgPSBmdW5jdGlvbihpdGVtRWxlbWVudHMsIHZhbHVlTmFtZXMpIHsNCiAgICB2YXIgaXRlbXNUb0luZGV4ID0gaXRlbUVsZW1lbnRzLnNwbGljZSgwLCA1MCk7IC8vIFRPRE86IElmIDwgMTAwIGl0ZW1zLCB3aGF0IGhhcHBlbnMgaW4gSUUgZXRjPw0KICAgIHBhcnNlKGl0ZW1zVG9JbmRleCwgdmFsdWVOYW1lcyk7DQogICAgaWYgKGl0ZW1FbGVtZW50cy5sZW5ndGggPiAwKSB7DQogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICBwYXJzZUFzeW5jKGl0ZW1FbGVtZW50cywgdmFsdWVOYW1lcyk7DQogICAgICB9LCAxKTsNCiAgICB9IGVsc2Ugew0KICAgICAgbGlzdC51cGRhdGUoKTsNCiAgICAgIGxpc3QudHJpZ2dlcigncGFyc2VDb21wbGV0ZScpOw0KICAgIH0NCiAgfTsNCg0KICBsaXN0LmhhbmRsZXJzLnBhcnNlQ29tcGxldGUgPSBsaXN0LmhhbmRsZXJzLnBhcnNlQ29tcGxldGUgfHwgW107DQoNCiAgcmV0dXJuIGZ1bmN0aW9uKCkgew0KICAgIHZhciBpdGVtc1RvSW5kZXggPSBnZXRDaGlsZHJlbihsaXN0Lmxpc3QpLA0KICAgICAgdmFsdWVOYW1lcyA9IGxpc3QudmFsdWVOYW1lczsNCg0KICAgIGlmIChsaXN0LmluZGV4QXN5bmMpIHsNCiAgICAgIHBhcnNlQXN5bmMoaXRlbXNUb0luZGV4LCB2YWx1ZU5hbWVzKTsNCiAgICB9IGVsc2Ugew0KICAgICAgcGFyc2UoaXRlbXNUb0luZGV4LCB2YWx1ZU5hbWVzKTsNCiAgICB9DQogIH07DQp9Ow0KDQp9LHsiLi9pdGVtIjo0fV0sNjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGxpc3QpIHsNCiAgdmFyIGl0ZW0sDQogICAgdGV4dCwNCiAgICBjb2x1bW5zLA0KICAgIHNlYXJjaFN0cmluZywNCiAgICBjdXN0b21TZWFyY2g7DQoNCiAgdmFyIHByZXBhcmUgPSB7DQogICAgcmVzZXRMaXN0OiBmdW5jdGlvbigpIHsNCiAgICAgIGxpc3QuaSA9IDE7DQogICAgICBsaXN0LnRlbXBsYXRlci5jbGVhcigpOw0KICAgICAgY3VzdG9tU2VhcmNoID0gdW5kZWZpbmVkOw0KICAgIH0sDQogICAgc2V0T3B0aW9uczogZnVuY3Rpb24oYXJncykgew0KICAgICAgaWYgKGFyZ3MubGVuZ3RoID09IDIgJiYgYXJnc1sxXSBpbnN0YW5jZW9mIEFycmF5KSB7DQogICAgICAgIGNvbHVtbnMgPSBhcmdzWzFdOw0KICAgICAgfSBlbHNlIGlmIChhcmdzLmxlbmd0aCA9PSAyICYmIHR5cGVvZihhcmdzWzFdKSA9PSAiZnVuY3Rpb24iKSB7DQogICAgICAgIGNvbHVtbnMgPSB1bmRlZmluZWQ7DQogICAgICAgIGN1c3RvbVNlYXJjaCA9IGFyZ3NbMV07DQogICAgICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID09IDMpIHsNCiAgICAgICAgY29sdW1ucyA9IGFyZ3NbMV07DQogICAgICAgIGN1c3RvbVNlYXJjaCA9IGFyZ3NbMl07DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb2x1bW5zID0gdW5kZWZpbmVkOw0KICAgICAgfQ0KICAgIH0sDQogICAgc2V0Q29sdW1uczogZnVuY3Rpb24oKSB7DQogICAgICBpZiAobGlzdC5pdGVtcy5sZW5ndGggPT09IDApIHJldHVybjsNCiAgICAgIGlmIChjb2x1bW5zID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgY29sdW1ucyA9IChsaXN0LnNlYXJjaENvbHVtbnMgPT09IHVuZGVmaW5lZCkgPyBwcmVwYXJlLnRvQXJyYXkobGlzdC5pdGVtc1swXS52YWx1ZXMoKSkgOiBsaXN0LnNlYXJjaENvbHVtbnM7DQogICAgICB9DQogICAgfSwNCiAgICBzZXRTZWFyY2hTdHJpbmc6IGZ1bmN0aW9uKHMpIHsNCiAgICAgIHMgPSBsaXN0LnV0aWxzLnRvU3RyaW5nKHMpLnRvTG93ZXJDYXNlKCk7DQogICAgICBzID0gcy5yZXBsYWNlKC9bLVtcXXt9KCkqKz8uLFxcXiR8I10vZywgIlxcJCYiKTsgLy8gRXNjYXBlIHJlZ3VsYXIgZXhwcmVzc2lvbiBjaGFyYWN0ZXJzDQogICAgICBzZWFyY2hTdHJpbmcgPSBzOw0KICAgIH0sDQogICAgdG9BcnJheTogZnVuY3Rpb24odmFsdWVzKSB7DQogICAgICB2YXIgdG1wQ29sdW1uID0gW107DQogICAgICBmb3IgKHZhciBuYW1lIGluIHZhbHVlcykgew0KICAgICAgICB0bXBDb2x1bW4ucHVzaChuYW1lKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiB0bXBDb2x1bW47DQogICAgfQ0KICB9Ow0KICB2YXIgc2VhcmNoID0gew0KICAgIGxpc3Q6IGZ1bmN0aW9uKCkgew0KICAgICAgZm9yICh2YXIgayA9IDAsIGtsID0gbGlzdC5pdGVtcy5sZW5ndGg7IGsgPCBrbDsgaysrKSB7DQogICAgICAgIHNlYXJjaC5pdGVtKGxpc3QuaXRlbXNba10pOw0KICAgICAgfQ0KICAgIH0sDQogICAgaXRlbTogZnVuY3Rpb24oaXRlbSkgew0KICAgICAgaXRlbS5mb3VuZCA9IGZhbHNlOw0KICAgICAgZm9yICh2YXIgaiA9IDAsIGpsID0gY29sdW1ucy5sZW5ndGg7IGogPCBqbDsgaisrKSB7DQogICAgICAgIGlmIChzZWFyY2gudmFsdWVzKGl0ZW0udmFsdWVzKCksIGNvbHVtbnNbal0pKSB7DQogICAgICAgICAgaXRlbS5mb3VuZCA9IHRydWU7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICB2YWx1ZXM6IGZ1bmN0aW9uKHZhbHVlcywgY29sdW1uKSB7DQogICAgICBpZiAodmFsdWVzLmhhc093blByb3BlcnR5KGNvbHVtbikpIHsNCiAgICAgICAgdGV4dCA9IGxpc3QudXRpbHMudG9TdHJpbmcodmFsdWVzW2NvbHVtbl0pLnRvTG93ZXJDYXNlKCk7DQogICAgICAgIGlmICgoc2VhcmNoU3RyaW5nICE9PSAiIikgJiYgKHRleHQuc2VhcmNoKHNlYXJjaFN0cmluZykgPiAtMSkpIHsNCiAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0sDQogICAgcmVzZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgbGlzdC5yZXNldC5zZWFyY2goKTsNCiAgICAgIGxpc3Quc2VhcmNoZWQgPSBmYWxzZTsNCiAgICB9DQogIH07DQoNCiAgdmFyIHNlYXJjaE1ldGhvZCA9IGZ1bmN0aW9uKHN0cikgew0KICAgIGxpc3QudHJpZ2dlcignc2VhcmNoU3RhcnQnKTsNCg0KICAgIHByZXBhcmUucmVzZXRMaXN0KCk7DQogICAgcHJlcGFyZS5zZXRTZWFyY2hTdHJpbmcoc3RyKTsNCiAgICBwcmVwYXJlLnNldE9wdGlvbnMoYXJndW1lbnRzKTsgLy8gc3RyLCBjb2xzfHNlYXJjaEZ1bmN0aW9uLCBzZWFyY2hGdW5jdGlvbg0KICAgIHByZXBhcmUuc2V0Q29sdW1ucygpOw0KDQogICAgaWYgKHNlYXJjaFN0cmluZyA9PT0gIiIgKSB7DQogICAgICBzZWFyY2gucmVzZXQoKTsNCiAgICB9IGVsc2Ugew0KICAgICAgbGlzdC5zZWFyY2hlZCA9IHRydWU7DQogICAgICBpZiAoY3VzdG9tU2VhcmNoKSB7DQogICAgICAgIGN1c3RvbVNlYXJjaChzZWFyY2hTdHJpbmcsIGNvbHVtbnMpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc2VhcmNoLmxpc3QoKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBsaXN0LnVwZGF0ZSgpOw0KICAgIGxpc3QudHJpZ2dlcignc2VhcmNoQ29tcGxldGUnKTsNCiAgICByZXR1cm4gbGlzdC52aXNpYmxlSXRlbXM7DQogIH07DQoNCiAgbGlzdC5oYW5kbGVycy5zZWFyY2hTdGFydCA9IGxpc3QuaGFuZGxlcnMuc2VhcmNoU3RhcnQgfHwgW107DQogIGxpc3QuaGFuZGxlcnMuc2VhcmNoQ29tcGxldGUgPSBsaXN0LmhhbmRsZXJzLnNlYXJjaENvbXBsZXRlIHx8IFtdOw0KDQogIGxpc3QudXRpbHMuZXZlbnRzLmJpbmQobGlzdC51dGlscy5nZXRCeUNsYXNzKGxpc3QubGlzdENvbnRhaW5lciwgbGlzdC5zZWFyY2hDbGFzcyksICdrZXl1cCcsIGZ1bmN0aW9uKGUpIHsNCiAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQgfHwgZS5zcmNFbGVtZW50LCAvLyBJRSBoYXZlIHNyY0VsZW1lbnQNCiAgICAgIGFscmVhZHlDbGVhcmVkID0gKHRhcmdldC52YWx1ZSA9PT0gIiIgJiYgIWxpc3Quc2VhcmNoZWQpOw0KICAgIGlmICghYWxyZWFkeUNsZWFyZWQpIHsgLy8gSWYgb25pbnB1dCBhbHJlYWR5IGhhdmUgcmVzZXR0ZWQgdGhlIGxpc3QsIGRvIG5vdGhpbmcNCiAgICAgIHNlYXJjaE1ldGhvZCh0YXJnZXQudmFsdWUpOw0KICAgIH0NCiAgfSk7DQoNCiAgLy8gVXNlZCB0byBkZXRlY3QgY2xpY2sgb24gSFRNTDUgY2xlYXIgYnV0dG9uDQogIGxpc3QudXRpbHMuZXZlbnRzLmJpbmQobGlzdC51dGlscy5nZXRCeUNsYXNzKGxpc3QubGlzdENvbnRhaW5lciwgbGlzdC5zZWFyY2hDbGFzcyksICdpbnB1dCcsIGZ1bmN0aW9uKGUpIHsNCiAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQgfHwgZS5zcmNFbGVtZW50Ow0KICAgIGlmICh0YXJnZXQudmFsdWUgPT09ICIiKSB7DQogICAgICBzZWFyY2hNZXRob2QoJycpOw0KICAgIH0NCiAgfSk7DQoNCiAgcmV0dXJuIHNlYXJjaE1ldGhvZDsNCn07DQoNCn0se31dLDc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihsaXN0KSB7DQogIGxpc3Quc29ydEZ1bmN0aW9uID0gbGlzdC5zb3J0RnVuY3Rpb24gfHwgZnVuY3Rpb24oaXRlbUEsIGl0ZW1CLCBvcHRpb25zKSB7DQogICAgb3B0aW9ucy5kZXNjID0gb3B0aW9ucy5vcmRlciA9PSAiZGVzYyIgPyB0cnVlIDogZmFsc2U7IC8vIE5hdHVyYWwgc29ydCB1c2VzIHRoaXMgZm9ybWF0DQogICAgcmV0dXJuIGxpc3QudXRpbHMubmF0dXJhbFNvcnQoaXRlbUEudmFsdWVzKClbb3B0aW9ucy52YWx1ZU5hbWVdLCBpdGVtQi52YWx1ZXMoKVtvcHRpb25zLnZhbHVlTmFtZV0sIG9wdGlvbnMpOw0KICB9Ow0KDQogIHZhciBidXR0b25zID0gew0KICAgIGVsczogdW5kZWZpbmVkLA0KICAgIGNsZWFyOiBmdW5jdGlvbigpIHsNCiAgICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IGJ1dHRvbnMuZWxzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsNCiAgICAgICAgbGlzdC51dGlscy5jbGFzc2VzKGJ1dHRvbnMuZWxzW2ldKS5yZW1vdmUoJ2FzYycpOw0KICAgICAgICBsaXN0LnV0aWxzLmNsYXNzZXMoYnV0dG9ucy5lbHNbaV0pLnJlbW92ZSgnZGVzYycpOw0KICAgICAgfQ0KICAgIH0sDQogICAgZ2V0T3JkZXI6IGZ1bmN0aW9uKGJ0bikgew0KICAgICAgdmFyIHByZWRlZmluZWRPcmRlciA9IGxpc3QudXRpbHMuZ2V0QXR0cmlidXRlKGJ0biwgJ2RhdGEtb3JkZXInKTsNCiAgICAgIGlmIChwcmVkZWZpbmVkT3JkZXIgPT0gImFzYyIgfHwgcHJlZGVmaW5lZE9yZGVyID09ICJkZXNjIikgew0KICAgICAgICByZXR1cm4gcHJlZGVmaW5lZE9yZGVyOw0KICAgICAgfSBlbHNlIGlmIChsaXN0LnV0aWxzLmNsYXNzZXMoYnRuKS5oYXMoJ2Rlc2MnKSkgew0KICAgICAgICByZXR1cm4gImFzYyI7DQogICAgICB9IGVsc2UgaWYgKGxpc3QudXRpbHMuY2xhc3NlcyhidG4pLmhhcygnYXNjJykpIHsNCiAgICAgICAgcmV0dXJuICJkZXNjIjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAiYXNjIjsNCiAgICAgIH0NCiAgICB9LA0KICAgIGdldEluU2Vuc2l0aXZlOiBmdW5jdGlvbihidG4sIG9wdGlvbnMpIHsNCiAgICAgIHZhciBpbnNlbnNpdGl2ZSA9IGxpc3QudXRpbHMuZ2V0QXR0cmlidXRlKGJ0biwgJ2RhdGEtaW5zZW5zaXRpdmUnKTsNCiAgICAgIGlmIChpbnNlbnNpdGl2ZSA9PT0gImZhbHNlIikgew0KICAgICAgICBvcHRpb25zLmluc2Vuc2l0aXZlID0gZmFsc2U7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBvcHRpb25zLmluc2Vuc2l0aXZlID0gdHJ1ZTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHNldE9yZGVyOiBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBidXR0b25zLmVscy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICAgIHZhciBidG4gPSBidXR0b25zLmVsc1tpXTsNCiAgICAgICAgaWYgKGxpc3QudXRpbHMuZ2V0QXR0cmlidXRlKGJ0biwgJ2RhdGEtc29ydCcpICE9PSBvcHRpb25zLnZhbHVlTmFtZSkgew0KICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQogICAgICAgIHZhciBwcmVkZWZpbmVkT3JkZXIgPSBsaXN0LnV0aWxzLmdldEF0dHJpYnV0ZShidG4sICdkYXRhLW9yZGVyJyk7DQogICAgICAgIGlmIChwcmVkZWZpbmVkT3JkZXIgPT0gImFzYyIgfHwgcHJlZGVmaW5lZE9yZGVyID09ICJkZXNjIikgew0KICAgICAgICAgIGlmIChwcmVkZWZpbmVkT3JkZXIgPT0gb3B0aW9ucy5vcmRlcikgew0KICAgICAgICAgICAgbGlzdC51dGlscy5jbGFzc2VzKGJ0bikuYWRkKG9wdGlvbnMub3JkZXIpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBsaXN0LnV0aWxzLmNsYXNzZXMoYnRuKS5hZGQob3B0aW9ucy5vcmRlcik7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH07DQogIHZhciBzb3J0ID0gZnVuY3Rpb24oKSB7DQogICAgbGlzdC50cmlnZ2VyKCdzb3J0U3RhcnQnKTsNCiAgICB2YXIgb3B0aW9ucyA9IHt9Ow0KDQogICAgdmFyIHRhcmdldCA9IGFyZ3VtZW50c1swXS5jdXJyZW50VGFyZ2V0IHx8IGFyZ3VtZW50c1swXS5zcmNFbGVtZW50IHx8IHVuZGVmaW5lZDsNCg0KICAgIGlmICh0YXJnZXQpIHsNCiAgICAgIG9wdGlvbnMudmFsdWVOYW1lID0gbGlzdC51dGlscy5nZXRBdHRyaWJ1dGUodGFyZ2V0LCAnZGF0YS1zb3J0Jyk7DQogICAgICBidXR0b25zLmdldEluU2Vuc2l0aXZlKHRhcmdldCwgb3B0aW9ucyk7DQogICAgICBvcHRpb25zLm9yZGVyID0gYnV0dG9ucy5nZXRPcmRlcih0YXJnZXQpOw0KICAgIH0gZWxzZSB7DQogICAgICBvcHRpb25zID0gYXJndW1lbnRzWzFdIHx8IG9wdGlvbnM7DQogICAgICBvcHRpb25zLnZhbHVlTmFtZSA9IGFyZ3VtZW50c1swXTsNCiAgICAgIG9wdGlvbnMub3JkZXIgPSBvcHRpb25zLm9yZGVyIHx8ICJhc2MiOw0KICAgICAgb3B0aW9ucy5pbnNlbnNpdGl2ZSA9ICh0eXBlb2Ygb3B0aW9ucy5pbnNlbnNpdGl2ZSA9PSAidW5kZWZpbmVkIikgPyB0cnVlIDogb3B0aW9ucy5pbnNlbnNpdGl2ZTsNCiAgICB9DQogICAgYnV0dG9ucy5jbGVhcigpOw0KICAgIGJ1dHRvbnMuc2V0T3JkZXIob3B0aW9ucyk7DQoNCiAgICBvcHRpb25zLnNvcnRGdW5jdGlvbiA9IG9wdGlvbnMuc29ydEZ1bmN0aW9uIHx8IGxpc3Quc29ydEZ1bmN0aW9uOw0KICAgIGxpc3QuaXRlbXMuc29ydChmdW5jdGlvbihhLCBiKSB7DQogICAgICB2YXIgbXVsdCA9IChvcHRpb25zLm9yZGVyID09PSAnZGVzYycpID8gLTEgOiAxOw0KICAgICAgcmV0dXJuIChvcHRpb25zLnNvcnRGdW5jdGlvbihhLCBiLCBvcHRpb25zKSAqIG11bHQpOw0KICAgIH0pOw0KICAgIGxpc3QudXBkYXRlKCk7DQogICAgbGlzdC50cmlnZ2VyKCdzb3J0Q29tcGxldGUnKTsNCiAgfTsNCg0KICAvLyBBZGQgaGFuZGxlcnMNCiAgbGlzdC5oYW5kbGVycy5zb3J0U3RhcnQgPSBsaXN0LmhhbmRsZXJzLnNvcnRTdGFydCB8fCBbXTsNCiAgbGlzdC5oYW5kbGVycy5zb3J0Q29tcGxldGUgPSBsaXN0LmhhbmRsZXJzLnNvcnRDb21wbGV0ZSB8fCBbXTsNCg0KICBidXR0b25zLmVscyA9IGxpc3QudXRpbHMuZ2V0QnlDbGFzcyhsaXN0Lmxpc3RDb250YWluZXIsIGxpc3Quc29ydENsYXNzKTsNCiAgbGlzdC51dGlscy5ldmVudHMuYmluZChidXR0b25zLmVscywgJ2NsaWNrJywgc29ydCk7DQogIGxpc3Qub24oJ3NlYXJjaFN0YXJ0JywgYnV0dG9ucy5jbGVhcik7DQogIGxpc3Qub24oJ2ZpbHRlclN0YXJ0JywgYnV0dG9ucy5jbGVhcik7DQoNCiAgcmV0dXJuIHNvcnQ7DQp9Ow0KDQp9LHt9XSw4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCnZhciBUZW1wbGF0ZXIgPSBmdW5jdGlvbihsaXN0KSB7DQogIHZhciBpdGVtU291cmNlLA0KICAgIHRlbXBsYXRlciA9IHRoaXM7DQoNCiAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHsNCiAgICBpdGVtU291cmNlID0gdGVtcGxhdGVyLmdldEl0ZW1Tb3VyY2UobGlzdC5pdGVtKTsNCiAgICBpZiAoaXRlbVNvdXJjZSkgew0KICAgICAgaXRlbVNvdXJjZSA9IHRlbXBsYXRlci5jbGVhclNvdXJjZUl0ZW0oaXRlbVNvdXJjZSwgbGlzdC52YWx1ZU5hbWVzKTsNCiAgICB9DQogIH07DQoNCiAgdGhpcy5jbGVhclNvdXJjZUl0ZW0gPSBmdW5jdGlvbihlbCwgdmFsdWVOYW1lcykgew0KICAgIGZvcih2YXIgaSA9IDAsIGlsID0gdmFsdWVOYW1lcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICB2YXIgZWxtOw0KICAgICAgaWYgKHZhbHVlTmFtZXNbaV0uZGF0YSkgew0KICAgICAgICBmb3IgKHZhciBqID0gMCwgamwgPSB2YWx1ZU5hbWVzW2ldLmRhdGEubGVuZ3RoOyBqIDwgamw7IGorKykgew0KICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnZGF0YS0nK3ZhbHVlTmFtZXNbaV0uZGF0YVtqXSwgJycpOw0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHZhbHVlTmFtZXNbaV0uYXR0ciAmJiB2YWx1ZU5hbWVzW2ldLm5hbWUpIHsNCiAgICAgICAgZWxtID0gbGlzdC51dGlscy5nZXRCeUNsYXNzKGVsLCB2YWx1ZU5hbWVzW2ldLm5hbWUsIHRydWUpOw0KICAgICAgICBpZiAoZWxtKSB7DQogICAgICAgICAgZWxtLnNldEF0dHJpYnV0ZSh2YWx1ZU5hbWVzW2ldLmF0dHIsICIiKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZWxtID0gbGlzdC51dGlscy5nZXRCeUNsYXNzKGVsLCB2YWx1ZU5hbWVzW2ldLCB0cnVlKTsNCiAgICAgICAgaWYgKGVsbSkgew0KICAgICAgICAgIGVsbS5pbm5lckhUTUwgPSAiIjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgZWxtID0gdW5kZWZpbmVkOw0KICAgIH0NCiAgICByZXR1cm4gZWw7DQogIH07DQoNCiAgdGhpcy5nZXRJdGVtU291cmNlID0gZnVuY3Rpb24oaXRlbSkgew0KICAgIGlmIChpdGVtID09PSB1bmRlZmluZWQpIHsNCiAgICAgIHZhciBub2RlcyA9IGxpc3QubGlzdC5jaGlsZE5vZGVzLA0KICAgICAgICBpdGVtcyA9IFtdOw0KDQogICAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBub2Rlcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICAgIC8vIE9ubHkgdGV4dG5vZGVzIGhhdmUgYSBkYXRhIGF0dHJpYnV0ZQ0KICAgICAgICBpZiAobm9kZXNbaV0uZGF0YSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgcmV0dXJuIG5vZGVzW2ldLmNsb25lTm9kZSh0cnVlKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoLzx0cltccz5dL2cuZXhlYyhpdGVtKSkgew0KICAgICAgdmFyIHRib2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGJvZHknKTsNCiAgICAgIHRib2R5LmlubmVySFRNTCA9IGl0ZW07DQogICAgICByZXR1cm4gdGJvZHkuZmlyc3RDaGlsZDsNCiAgICB9IGVsc2UgaWYgKGl0ZW0uaW5kZXhPZigiPCIpICE9PSAtMSkgew0KICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgICAgZGl2LmlubmVySFRNTCA9IGl0ZW07DQogICAgICByZXR1cm4gZGl2LmZpcnN0Q2hpbGQ7DQogICAgfSBlbHNlIHsNCiAgICAgIHZhciBzb3VyY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0Lml0ZW0pOw0KICAgICAgaWYgKHNvdXJjZSkgew0KICAgICAgICByZXR1cm4gc291cmNlOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdW5kZWZpbmVkOw0KICB9Ow0KDQogIHRoaXMuZ2V0ID0gZnVuY3Rpb24oaXRlbSwgdmFsdWVOYW1lcykgew0KICAgIHRlbXBsYXRlci5jcmVhdGUoaXRlbSk7DQogICAgdmFyIHZhbHVlcyA9IHt9Ow0KICAgIGZvcih2YXIgaSA9IDAsIGlsID0gdmFsdWVOYW1lcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICB2YXIgZWxtOw0KICAgICAgaWYgKHZhbHVlTmFtZXNbaV0uZGF0YSkgew0KICAgICAgICBmb3IgKHZhciBqID0gMCwgamwgPSB2YWx1ZU5hbWVzW2ldLmRhdGEubGVuZ3RoOyBqIDwgamw7IGorKykgew0KICAgICAgICAgIHZhbHVlc1t2YWx1ZU5hbWVzW2ldLmRhdGFbal1dID0gbGlzdC51dGlscy5nZXRBdHRyaWJ1dGUoaXRlbS5lbG0sICdkYXRhLScrdmFsdWVOYW1lc1tpXS5kYXRhW2pdKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICh2YWx1ZU5hbWVzW2ldLmF0dHIgJiYgdmFsdWVOYW1lc1tpXS5uYW1lKSB7DQogICAgICAgIGVsbSA9IGxpc3QudXRpbHMuZ2V0QnlDbGFzcyhpdGVtLmVsbSwgdmFsdWVOYW1lc1tpXS5uYW1lLCB0cnVlKTsNCiAgICAgICAgdmFsdWVzW3ZhbHVlTmFtZXNbaV0ubmFtZV0gPSBlbG0gPyBsaXN0LnV0aWxzLmdldEF0dHJpYnV0ZShlbG0sIHZhbHVlTmFtZXNbaV0uYXR0cikgOiAiIjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGVsbSA9IGxpc3QudXRpbHMuZ2V0QnlDbGFzcyhpdGVtLmVsbSwgdmFsdWVOYW1lc1tpXSwgdHJ1ZSk7DQogICAgICAgIHZhbHVlc1t2YWx1ZU5hbWVzW2ldXSA9IGVsbSA/IGVsbS5pbm5lckhUTUwgOiAiIjsNCiAgICAgIH0NCiAgICAgIGVsbSA9IHVuZGVmaW5lZDsNCiAgICB9DQogICAgcmV0dXJuIHZhbHVlczsNCiAgfTsNCg0KICB0aGlzLnNldCA9IGZ1bmN0aW9uKGl0ZW0sIHZhbHVlcykgew0KICAgIHZhciBnZXRWYWx1ZU5hbWUgPSBmdW5jdGlvbihuYW1lKSB7DQogICAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBsaXN0LnZhbHVlTmFtZXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgICBpZiAobGlzdC52YWx1ZU5hbWVzW2ldLmRhdGEpIHsNCiAgICAgICAgICB2YXIgZGF0YSA9IGxpc3QudmFsdWVOYW1lc1tpXS5kYXRhOw0KICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqbCA9IGRhdGEubGVuZ3RoOyBqIDwgamw7IGorKykgew0KICAgICAgICAgICAgaWYgKGRhdGFbal0gPT09IG5hbWUpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIHsgZGF0YTogbmFtZSB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIGlmIChsaXN0LnZhbHVlTmFtZXNbaV0uYXR0ciAmJiBsaXN0LnZhbHVlTmFtZXNbaV0ubmFtZSAmJiBsaXN0LnZhbHVlTmFtZXNbaV0ubmFtZSA9PSBuYW1lKSB7DQogICAgICAgICAgcmV0dXJuIGxpc3QudmFsdWVOYW1lc1tpXTsNCiAgICAgICAgfSBlbHNlIGlmIChsaXN0LnZhbHVlTmFtZXNbaV0gPT09IG5hbWUpIHsNCiAgICAgICAgICByZXR1cm4gbmFtZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH07DQogICAgdmFyIHNldFZhbHVlID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsNCiAgICAgIHZhciBlbG07DQogICAgICB2YXIgdmFsdWVOYW1lID0gZ2V0VmFsdWVOYW1lKG5hbWUpOw0KICAgICAgaWYgKCF2YWx1ZU5hbWUpDQogICAgICAgIHJldHVybjsNCiAgICAgIGlmICh2YWx1ZU5hbWUuZGF0YSkgew0KICAgICAgICBpdGVtLmVsbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtJyt2YWx1ZU5hbWUuZGF0YSwgdmFsdWUpOw0KICAgICAgfSBlbHNlIGlmICh2YWx1ZU5hbWUuYXR0ciAmJiB2YWx1ZU5hbWUubmFtZSkgew0KICAgICAgICBlbG0gPSBsaXN0LnV0aWxzLmdldEJ5Q2xhc3MoaXRlbS5lbG0sIHZhbHVlTmFtZS5uYW1lLCB0cnVlKTsNCiAgICAgICAgaWYgKGVsbSkgew0KICAgICAgICAgIGVsbS5zZXRBdHRyaWJ1dGUodmFsdWVOYW1lLmF0dHIsIHZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZWxtID0gbGlzdC51dGlscy5nZXRCeUNsYXNzKGl0ZW0uZWxtLCB2YWx1ZU5hbWUsIHRydWUpOw0KICAgICAgICBpZiAoZWxtKSB7DQogICAgICAgICAgZWxtLmlubmVySFRNTCA9IHZhbHVlOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBlbG0gPSB1bmRlZmluZWQ7DQogICAgfTsNCiAgICBpZiAoIXRlbXBsYXRlci5jcmVhdGUoaXRlbSkpIHsNCiAgICAgIGZvcih2YXIgdiBpbiB2YWx1ZXMpIHsNCiAgICAgICAgaWYgKHZhbHVlcy5oYXNPd25Qcm9wZXJ0eSh2KSkgew0KICAgICAgICAgIHNldFZhbHVlKHYsIHZhbHVlc1t2XSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH07DQoNCiAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbihpdGVtKSB7DQogICAgaWYgKGl0ZW0uZWxtICE9PSB1bmRlZmluZWQpIHsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgaWYgKGl0ZW1Tb3VyY2UgPT09IHVuZGVmaW5lZCkgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgbGlzdCBuZWVkIHRvIGhhdmUgYXQgbGlzdCBvbmUgaXRlbSBvbiBpbml0IG90aGVyd2lzZSB5b3UnbGwgaGF2ZSB0byBhZGQgYSB0ZW1wbGF0ZS4iKTsNCiAgICB9DQogICAgLyogSWYgaXRlbSBzb3VyY2UgZG9lcyBub3QgZXhpc3RzLCB1c2UgdGhlIGZpcnN0IGl0ZW0gaW4gbGlzdCBhcw0KICAgIHNvdXJjZSBmb3IgbmV3IGl0ZW1zICovDQogICAgdmFyIG5ld0l0ZW0gPSBpdGVtU291cmNlLmNsb25lTm9kZSh0cnVlKTsNCiAgICBuZXdJdGVtLnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTsNCiAgICBpdGVtLmVsbSA9IG5ld0l0ZW07DQogICAgdGVtcGxhdGVyLnNldChpdGVtLCBpdGVtLnZhbHVlcygpKTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfTsNCiAgdGhpcy5yZW1vdmUgPSBmdW5jdGlvbihpdGVtKSB7DQogICAgaWYgKGl0ZW0uZWxtLnBhcmVudE5vZGUgPT09IGxpc3QubGlzdCkgew0KICAgICAgbGlzdC5saXN0LnJlbW92ZUNoaWxkKGl0ZW0uZWxtKTsNCiAgICB9DQogIH07DQogIHRoaXMuc2hvdyA9IGZ1bmN0aW9uKGl0ZW0pIHsNCiAgICB0ZW1wbGF0ZXIuY3JlYXRlKGl0ZW0pOw0KICAgIGxpc3QubGlzdC5hcHBlbmRDaGlsZChpdGVtLmVsbSk7DQogIH07DQogIHRoaXMuaGlkZSA9IGZ1bmN0aW9uKGl0ZW0pIHsNCiAgICBpZiAoaXRlbS5lbG0gIT09IHVuZGVmaW5lZCAmJiBpdGVtLmVsbS5wYXJlbnROb2RlID09PSBsaXN0Lmxpc3QpIHsNCiAgICAgIGxpc3QubGlzdC5yZW1vdmVDaGlsZChpdGVtLmVsbSk7DQogICAgfQ0KICB9Ow0KICB0aGlzLmNsZWFyID0gZnVuY3Rpb24oKSB7DQogICAgLyogLmlubmVySFRNTCA9ICcnOyBmdWNrcyB1cCBJRSAqLw0KICAgIGlmIChsaXN0Lmxpc3QuaGFzQ2hpbGROb2RlcygpKSB7DQogICAgICB3aGlsZSAobGlzdC5saXN0LmNoaWxkTm9kZXMubGVuZ3RoID49IDEpDQogICAgICB7DQogICAgICAgIGxpc3QubGlzdC5yZW1vdmVDaGlsZChsaXN0Lmxpc3QuZmlyc3RDaGlsZCk7DQogICAgICB9DQogICAgfQ0KICB9Ow0KDQogIGluaXQoKTsNCn07DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obGlzdCkgew0KICByZXR1cm4gbmV3IFRlbXBsYXRlcihsaXN0KTsNCn07DQoNCn0se31dLDk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyoqDQogKiBNb2R1bGUgZGVwZW5kZW5jaWVzLg0KICovDQoNCnZhciBpbmRleCA9IHJlcXVpcmUoJy4vaW5kZXgtb2YnKTsNCg0KLyoqDQogKiBXaGl0ZXNwYWNlIHJlZ2V4cC4NCiAqLw0KDQp2YXIgcmUgPSAvXHMrLzsNCg0KLyoqDQogKiB0b1N0cmluZyByZWZlcmVuY2UuDQogKi8NCg0KdmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsNCg0KLyoqDQogKiBXcmFwIGBlbGAgaW4gYSBgQ2xhc3NMaXN0YC4NCiAqDQogKiBAcGFyYW0ge0VsZW1lbnR9IGVsDQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZWwpew0KICByZXR1cm4gbmV3IENsYXNzTGlzdChlbCk7DQp9Ow0KDQovKioNCiAqIEluaXRpYWxpemUgYSBuZXcgQ2xhc3NMaXN0IGZvciBgZWxgLg0KICoNCiAqIEBwYXJhbSB7RWxlbWVudH0gZWwNCiAqIEBhcGkgcHJpdmF0ZQ0KICovDQoNCmZ1bmN0aW9uIENsYXNzTGlzdChlbCkgew0KICBpZiAoIWVsIHx8ICFlbC5ub2RlVHlwZSkgew0KICAgIHRocm93IG5ldyBFcnJvcignQSBET00gZWxlbWVudCByZWZlcmVuY2UgaXMgcmVxdWlyZWQnKTsNCiAgfQ0KICB0aGlzLmVsID0gZWw7DQogIHRoaXMubGlzdCA9IGVsLmNsYXNzTGlzdDsNCn0NCg0KLyoqDQogKiBBZGQgY2xhc3MgYG5hbWVgIGlmIG5vdCBhbHJlYWR5IHByZXNlbnQuDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IG5hbWUNCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAqIEBhcGkgcHVibGljDQogKi8NCg0KQ2xhc3NMaXN0LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihuYW1lKXsNCiAgLy8gY2xhc3NMaXN0DQogIGlmICh0aGlzLmxpc3QpIHsNCiAgICB0aGlzLmxpc3QuYWRkKG5hbWUpOw0KICAgIHJldHVybiB0aGlzOw0KICB9DQoNCiAgLy8gZmFsbGJhY2sNCiAgdmFyIGFyciA9IHRoaXMuYXJyYXkoKTsNCiAgdmFyIGkgPSBpbmRleChhcnIsIG5hbWUpOw0KICBpZiAoIX5pKSBhcnIucHVzaChuYW1lKTsNCiAgdGhpcy5lbC5jbGFzc05hbWUgPSBhcnIuam9pbignICcpOw0KICByZXR1cm4gdGhpczsNCn07DQoNCi8qKg0KICogUmVtb3ZlIGNsYXNzIGBuYW1lYCB3aGVuIHByZXNlbnQsIG9yDQogKiBwYXNzIGEgcmVndWxhciBleHByZXNzaW9uIHRvIHJlbW92ZQ0KICogYW55IHdoaWNoIG1hdGNoLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfFJlZ0V4cH0gbmFtZQ0KICogQHJldHVybiB7Q2xhc3NMaXN0fQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpDbGFzc0xpc3QucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKG5hbWUpew0KICBpZiAoJ1tvYmplY3QgUmVnRXhwXScgPT0gdG9TdHJpbmcuY2FsbChuYW1lKSkgew0KICAgIHJldHVybiB0aGlzLnJlbW92ZU1hdGNoaW5nKG5hbWUpOw0KICB9DQoNCiAgLy8gY2xhc3NMaXN0DQogIGlmICh0aGlzLmxpc3QpIHsNCiAgICB0aGlzLmxpc3QucmVtb3ZlKG5hbWUpOw0KICAgIHJldHVybiB0aGlzOw0KICB9DQoNCiAgLy8gZmFsbGJhY2sNCiAgdmFyIGFyciA9IHRoaXMuYXJyYXkoKTsNCiAgdmFyIGkgPSBpbmRleChhcnIsIG5hbWUpOw0KICBpZiAofmkpIGFyci5zcGxpY2UoaSwgMSk7DQogIHRoaXMuZWwuY2xhc3NOYW1lID0gYXJyLmpvaW4oJyAnKTsNCiAgcmV0dXJuIHRoaXM7DQp9Ow0KDQovKioNCiAqIFJlbW92ZSBhbGwgY2xhc3NlcyBtYXRjaGluZyBgcmVgLg0KICoNCiAqIEBwYXJhbSB7UmVnRXhwfSByZQ0KICogQHJldHVybiB7Q2xhc3NMaXN0fQ0KICogQGFwaSBwcml2YXRlDQogKi8NCg0KQ2xhc3NMaXN0LnByb3RvdHlwZS5yZW1vdmVNYXRjaGluZyA9IGZ1bmN0aW9uKHJlKXsNCiAgdmFyIGFyciA9IHRoaXMuYXJyYXkoKTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsNCiAgICBpZiAocmUudGVzdChhcnJbaV0pKSB7DQogICAgICB0aGlzLnJlbW92ZShhcnJbaV0pOw0KICAgIH0NCiAgfQ0KICByZXR1cm4gdGhpczsNCn07DQoNCi8qKg0KICogVG9nZ2xlIGNsYXNzIGBuYW1lYCwgY2FuIGZvcmNlIHN0YXRlIHZpYSBgZm9yY2VgLg0KICoNCiAqIEZvciBicm93c2VycyB0aGF0IHN1cHBvcnQgY2xhc3NMaXN0LCBidXQgZG8gbm90IHN1cHBvcnQgYGZvcmNlYCB5ZXQsDQogKiB0aGUgbWlzdGFrZSB3aWxsIGJlIGRldGVjdGVkIGFuZCBjb3JyZWN0ZWQuDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IG5hbWUNCiAqIEBwYXJhbSB7Qm9vbGVhbn0gZm9yY2UNCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAqIEBhcGkgcHVibGljDQogKi8NCg0KQ2xhc3NMaXN0LnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbihuYW1lLCBmb3JjZSl7DQogIC8vIGNsYXNzTGlzdA0KICBpZiAodGhpcy5saXN0KSB7DQogICAgaWYgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZm9yY2UpIHsNCiAgICAgIGlmIChmb3JjZSAhPT0gdGhpcy5saXN0LnRvZ2dsZShuYW1lLCBmb3JjZSkpIHsNCiAgICAgICAgdGhpcy5saXN0LnRvZ2dsZShuYW1lKTsgLy8gdG9nZ2xlIGFnYWluIHRvIGNvcnJlY3QNCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5saXN0LnRvZ2dsZShuYW1lKTsNCiAgICB9DQogICAgcmV0dXJuIHRoaXM7DQogIH0NCg0KICAvLyBmYWxsYmFjaw0KICBpZiAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBmb3JjZSkgew0KICAgIGlmICghZm9yY2UpIHsNCiAgICAgIHRoaXMucmVtb3ZlKG5hbWUpOw0KICAgIH0gZWxzZSB7DQogICAgICB0aGlzLmFkZChuYW1lKTsNCiAgICB9DQogIH0gZWxzZSB7DQogICAgaWYgKHRoaXMuaGFzKG5hbWUpKSB7DQogICAgICB0aGlzLnJlbW92ZShuYW1lKTsNCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5hZGQobmFtZSk7DQogICAgfQ0KICB9DQoNCiAgcmV0dXJuIHRoaXM7DQp9Ow0KDQovKioNCiAqIFJldHVybiBhbiBhcnJheSBvZiBjbGFzc2VzLg0KICoNCiAqIEByZXR1cm4ge0FycmF5fQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpDbGFzc0xpc3QucHJvdG90eXBlLmFycmF5ID0gZnVuY3Rpb24oKXsNCiAgdmFyIGNsYXNzTmFtZSA9IHRoaXMuZWwuZ2V0QXR0cmlidXRlKCdjbGFzcycpIHx8ICcnOw0KICB2YXIgc3RyID0gY2xhc3NOYW1lLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyk7DQogIHZhciBhcnIgPSBzdHIuc3BsaXQocmUpOw0KICBpZiAoJycgPT09IGFyclswXSkgYXJyLnNoaWZ0KCk7DQogIHJldHVybiBhcnI7DQp9Ow0KDQovKioNCiAqIENoZWNrIGlmIGNsYXNzIGBuYW1lYCBpcyBwcmVzZW50Lg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lDQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCkNsYXNzTGlzdC5wcm90b3R5cGUuaGFzID0NCkNsYXNzTGlzdC5wcm90b3R5cGUuY29udGFpbnMgPSBmdW5jdGlvbihuYW1lKXsNCiAgcmV0dXJuIHRoaXMubGlzdCA/IHRoaXMubGlzdC5jb250YWlucyhuYW1lKSA6ICEhIH5pbmRleCh0aGlzLmFycmF5KCksIG5hbWUpOw0KfTsNCg0KfSx7Ii4vaW5kZXgtb2YiOjE0fV0sMTA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KdmFyIGJpbmQgPSB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciA/ICdhZGRFdmVudExpc3RlbmVyJyA6ICdhdHRhY2hFdmVudCcsDQogICAgdW5iaW5kID0gd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIgPyAncmVtb3ZlRXZlbnRMaXN0ZW5lcicgOiAnZGV0YWNoRXZlbnQnLA0KICAgIHByZWZpeCA9IGJpbmQgIT09ICdhZGRFdmVudExpc3RlbmVyJyA/ICdvbicgOiAnJywNCiAgICB0b0FycmF5ID0gcmVxdWlyZSgnLi90by1hcnJheScpOw0KDQovKioNCiAqIEJpbmQgYGVsYCBldmVudCBgdHlwZWAgdG8gYGZuYC4NCiAqDQogKiBAcGFyYW0ge0VsZW1lbnR9IGVsLCBOb2RlTGlzdCwgSFRNTENvbGxlY3Rpb24gb3IgQXJyYXkNCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbg0KICogQHBhcmFtIHtCb29sZWFufSBjYXB0dXJlDQogKiBAYXBpIHB1YmxpYw0KICovDQoNCmV4cG9ydHMuYmluZCA9IGZ1bmN0aW9uKGVsLCB0eXBlLCBmbiwgY2FwdHVyZSl7DQogIGVsID0gdG9BcnJheShlbCk7DQogIGZvciAoIHZhciBpID0gMDsgaSA8IGVsLmxlbmd0aDsgaSsrICkgew0KICAgIGVsW2ldW2JpbmRdKHByZWZpeCArIHR5cGUsIGZuLCBjYXB0dXJlIHx8IGZhbHNlKTsNCiAgfQ0KfTsNCg0KLyoqDQogKiBVbmJpbmQgYGVsYCBldmVudCBgdHlwZWAncyBjYWxsYmFjayBgZm5gLg0KICoNCiAqIEBwYXJhbSB7RWxlbWVudH0gZWwsIE5vZGVMaXN0LCBIVE1MQ29sbGVjdGlvbiBvciBBcnJheQ0KICogQHBhcmFtIHtTdHJpbmd9IHR5cGUNCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuDQogKiBAcGFyYW0ge0Jvb2xlYW59IGNhcHR1cmUNCiAqIEBhcGkgcHVibGljDQogKi8NCg0KZXhwb3J0cy51bmJpbmQgPSBmdW5jdGlvbihlbCwgdHlwZSwgZm4sIGNhcHR1cmUpew0KICBlbCA9IHRvQXJyYXkoZWwpOw0KICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBlbC5sZW5ndGg7IGkrKyApIHsNCiAgICBlbFtpXVt1bmJpbmRdKHByZWZpeCArIHR5cGUsIGZuLCBjYXB0dXJlIHx8IGZhbHNlKTsNCiAgfQ0KfTsNCg0KfSx7Ii4vdG8tYXJyYXkiOjE2fV0sMTE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyoNCiAqIFNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9leHRlbmQNCiAqLw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGV4dGVuZCAob2JqZWN0KSB7DQogICAgLy8gVGFrZXMgYW4gdW5saW1pdGVkIG51bWJlciBvZiBleHRlbmRlcnMuDQogICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOw0KDQogICAgLy8gRm9yIGVhY2ggZXh0ZW5kZXIsIGNvcHkgdGhlaXIgcHJvcGVydGllcyBvbiBvdXIgb2JqZWN0Lg0KICAgIGZvciAodmFyIGkgPSAwLCBzb3VyY2U7IHNvdXJjZSA9IGFyZ3NbaV07IGkrKykgew0KICAgICAgICBpZiAoIXNvdXJjZSkgY29udGludWU7DQogICAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIHNvdXJjZSkgew0KICAgICAgICAgICAgb2JqZWN0W3Byb3BlcnR5XSA9IHNvdXJjZVtwcm9wZXJ0eV07DQogICAgICAgIH0NCiAgICB9DQoNCiAgICByZXR1cm4gb2JqZWN0Ow0KfTsNCg0KfSx7fV0sMTI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyoqDQogKiBBIGNyb3NzLWJyb3dzZXIgaW1wbGVtZW50YXRpb24gb2YgZ2V0QXR0cmlidXRlLg0KICogU291cmNlIGZvdW5kIGhlcmU6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzM3NTUzNDMvMzYxMzM3IHdyaXR0ZW4gYnkgVml2aW4gUGFsaWF0aA0KICoNCiAqIFJldHVybiB0aGUgdmFsdWUgZm9yIGBhdHRyYCBhdCBgZWxlbWVudGAuDQogKg0KICogQHBhcmFtIHtFbGVtZW50fSBlbA0KICogQHBhcmFtIHtTdHJpbmd9IGF0dHINCiAqIEBhcGkgcHVibGljDQogKi8NCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihlbCwgYXR0cikgew0KICB2YXIgcmVzdWx0ID0gKGVsLmdldEF0dHJpYnV0ZSAmJiBlbC5nZXRBdHRyaWJ1dGUoYXR0cikpIHx8IG51bGw7DQogIGlmKCAhcmVzdWx0ICkgew0KICAgIHZhciBhdHRycyA9IGVsLmF0dHJpYnV0ZXM7DQogICAgdmFyIGxlbmd0aCA9IGF0dHJzLmxlbmd0aDsNCiAgICBmb3IodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICAgIGlmIChhdHRyW2ldICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgaWYoYXR0cltpXS5ub2RlTmFtZSA9PT0gYXR0cikgew0KICAgICAgICAgIHJlc3VsdCA9IGF0dHJbaV0ubm9kZVZhbHVlOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9DQogIHJldHVybiByZXN1bHQ7DQp9Ow0KDQp9LHt9XSwxMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQovKioNCiAqIEEgY3Jvc3MtYnJvd3NlciBpbXBsZW1lbnRhdGlvbiBvZiBnZXRFbGVtZW50c0J5Q2xhc3MuDQogKiBIZWF2aWx5IGJhc2VkIG9uIER1c3RpbiBEaWF6J3MgZnVuY3Rpb246IGh0dHA6Ly9kdXN0aW5kaWF6LmNvbS9nZXRlbGVtZW50c2J5Y2xhc3MuDQogKg0KICogRmluZCBhbGwgZWxlbWVudHMgd2l0aCBjbGFzcyBgY2xhc3NOYW1lYCBpbnNpZGUgYGNvbnRhaW5lcmAuDQogKiBVc2UgYHNpbmdsZSA9IHRydWVgIHRvIGluY3JlYXNlIHBlcmZvcm1hbmNlIGluIG9sZGVyIGJyb3dzZXJzDQogKiB3aGVuIG9ubHkgb25lIGVsZW1lbnQgaXMgbmVlZGVkLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBjbGFzc05hbWUNCiAqIEBwYXJhbSB7RWxlbWVudH0gY29udGFpbmVyDQogKiBAcGFyYW0ge0Jvb2xlYW59IHNpbmdsZQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQptb2R1bGUuZXhwb3J0cyA9IChmdW5jdGlvbigpIHsNCiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24oY29udGFpbmVyLCBjbGFzc05hbWUsIHNpbmdsZSkgew0KICAgICAgaWYgKHNpbmdsZSkgew0KICAgICAgICByZXR1cm4gY29udGFpbmVyLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoY2xhc3NOYW1lKVswXTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBjb250YWluZXIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjbGFzc05hbWUpOw0KICAgICAgfQ0KICAgIH07DQogIH0gZWxzZSBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3Rvcikgew0KICAgIHJldHVybiBmdW5jdGlvbihjb250YWluZXIsIGNsYXNzTmFtZSwgc2luZ2xlKSB7DQogICAgICBjbGFzc05hbWUgPSAnLicgKyBjbGFzc05hbWU7DQogICAgICBpZiAoc2luZ2xlKSB7DQogICAgICAgIHJldHVybiBjb250YWluZXIucXVlcnlTZWxlY3RvcihjbGFzc05hbWUpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKGNsYXNzTmFtZSk7DQogICAgICB9DQogICAgfTsNCiAgfSBlbHNlIHsNCiAgICByZXR1cm4gZnVuY3Rpb24oY29udGFpbmVyLCBjbGFzc05hbWUsIHNpbmdsZSkgew0KICAgICAgdmFyIGNsYXNzRWxlbWVudHMgPSBbXSwNCiAgICAgICAgdGFnID0gJyonOw0KICAgICAgaWYgKGNvbnRhaW5lciA9PT0gbnVsbCkgew0KICAgICAgICBjb250YWluZXIgPSBkb2N1bWVudDsNCiAgICAgIH0NCiAgICAgIHZhciBlbHMgPSBjb250YWluZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnKTsNCiAgICAgIHZhciBlbHNMZW4gPSBlbHMubGVuZ3RoOw0KICAgICAgdmFyIHBhdHRlcm4gPSBuZXcgUmVnRXhwKCIoXnxcXHMpIitjbGFzc05hbWUrIihcXHN8JCkiKTsNCiAgICAgIGZvciAodmFyIGkgPSAwLCBqID0gMDsgaSA8IGVsc0xlbjsgaSsrKSB7DQogICAgICAgIGlmICggcGF0dGVybi50ZXN0KGVsc1tpXS5jbGFzc05hbWUpICkgew0KICAgICAgICAgIGlmIChzaW5nbGUpIHsNCiAgICAgICAgICAgIHJldHVybiBlbHNbaV07DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNsYXNzRWxlbWVudHNbal0gPSBlbHNbaV07DQogICAgICAgICAgICBqKys7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gY2xhc3NFbGVtZW50czsNCiAgICB9Ow0KICB9DQp9KSgpOw0KDQp9LHt9XSwxNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQp2YXIgaW5kZXhPZiA9IFtdLmluZGV4T2Y7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYXJyLCBvYmopew0KICBpZiAoaW5kZXhPZikgcmV0dXJuIGFyci5pbmRleE9mKG9iaik7DQogIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgKytpKSB7DQogICAgaWYgKGFycltpXSA9PT0gb2JqKSByZXR1cm4gaTsNCiAgfQ0KICByZXR1cm4gLTE7DQp9Ow0KDQp9LHt9XSwxNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQovKg0KICogTmF0dXJhbCBTb3J0IGFsZ29yaXRobSBmb3IgSmF2YXNjcmlwdCAtIFZlcnNpb24gMC44LjEgLSBSZWxlYXNlZCB1bmRlciBNSVQgbGljZW5zZQ0KICogQXV0aG9yOiBKaW0gUGFsbWVyIChiYXNlZCBvbiBjaHVua2luZyBpZGVhIGZyb20gRGF2ZSBLb2VsbGUpDQogKi8NCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYSwgYiwgb3B0cykgew0KICAgIHZhciByZSA9IC8oXihbK1wtXT9cZCsoPzpcLlxkKik/KD86W2VFXVsrXC1dP1xkKyk/KD89XER8XHN8JCkpfF4weFtcZGEtZkEtRl0rJHxcZCspL2csDQogICAgICAgIHNyZSA9IC9eXHMrfFxzKyQvZywgICAvLyB0cmltIHByZS1wb3N0IHdoaXRlc3BhY2UNCiAgICAgICAgc25yZSA9IC9ccysvZywgICAgICAgIC8vIG5vcm1hbGl6ZSBhbGwgd2hpdGVzcGFjZSB0byBzaW5nbGUgJyAnIGNoYXJhY3Rlcg0KICAgICAgICBkcmUgPSAvKF4oW1x3IF0rLD9bXHcgXSspP1tcdyBdKyw/W1x3IF0rXGQrOlxkKyg6XGQrKT9bXHcgXT98XlxkezEsNH1bXC9cLV1cZHsxLDR9W1wvXC1dXGR7MSw0fXxeXHcrLCBcdysgXGQrLCBcZHs0fSkvLA0KICAgICAgICBocmUgPSAvXjB4WzAtOWEtZl0rJC9pLA0KICAgICAgICBvcmUgPSAvXjAvLA0KICAgICAgICBvcHRpb25zID0gb3B0cyB8fCB7fSwNCiAgICAgICAgaSA9IGZ1bmN0aW9uKHMpIHsNCiAgICAgICAgICAgIHJldHVybiAob3B0aW9ucy5pbnNlbnNpdGl2ZSAmJiAoJycgKyBzKS50b0xvd2VyQ2FzZSgpIHx8ICcnICsgcykucmVwbGFjZShzcmUsICcnKTsNCiAgICAgICAgfSwNCiAgICAgICAgLy8gY29udmVydCBhbGwgdG8gc3RyaW5ncyBzdHJpcCB3aGl0ZXNwYWNlDQogICAgICAgIHggPSBpKGEpLA0KICAgICAgICB5ID0gaShiKSwNCiAgICAgICAgLy8gY2h1bmsvdG9rZW5pemUNCiAgICAgICAgeE4gPSB4LnJlcGxhY2UocmUsICdcMCQxXDAnKS5yZXBsYWNlKC9cMCQvLCcnKS5yZXBsYWNlKC9eXDAvLCcnKS5zcGxpdCgnXDAnKSwNCiAgICAgICAgeU4gPSB5LnJlcGxhY2UocmUsICdcMCQxXDAnKS5yZXBsYWNlKC9cMCQvLCcnKS5yZXBsYWNlKC9eXDAvLCcnKS5zcGxpdCgnXDAnKSwNCiAgICAgICAgLy8gbnVtZXJpYywgaGV4IG9yIGRhdGUgZGV0ZWN0aW9uDQogICAgICAgIHhEID0gcGFyc2VJbnQoeC5tYXRjaChocmUpLCAxNikgfHwgKHhOLmxlbmd0aCAhPT0gMSAmJiBEYXRlLnBhcnNlKHgpKSwNCiAgICAgICAgeUQgPSBwYXJzZUludCh5Lm1hdGNoKGhyZSksIDE2KSB8fCB4RCAmJiB5Lm1hdGNoKGRyZSkgJiYgRGF0ZS5wYXJzZSh5KSB8fCBudWxsLA0KICAgICAgICBub3JtQ2h1bmsgPSBmdW5jdGlvbihzLCBsKSB7DQogICAgICAgICAgIC8vIG5vcm1hbGl6ZSBzcGFjZXM7IGZpbmQgZmxvYXRzIG5vdCBzdGFydGluZyB3aXRoICcwJywgc3RyaW5nIG9yIDAgaWYgbm90IGRlZmluZWQgKENsaW50IFByaWVzdCkNCiAgICAgICAgICAgcmV0dXJuICghcy5tYXRjaChvcmUpIHx8IGwgPT0gMSkgJiYgcGFyc2VGbG9hdChzKSB8fCBzLnJlcGxhY2Uoc25yZSwgJyAnKS5yZXBsYWNlKHNyZSwgJycpIHx8IDA7DQogICAgICAgIH0sDQogICAgICAgIG9GeE5jTCwgb0Z5TmNMOw0KICAgLy8gZmlyc3QgdHJ5IGFuZCBzb3J0IEhleCBjb2RlcyBvciBEYXRlcw0KICAgaWYgKHlEKSB7DQogICAgICAgaWYgKHhEIDwgeUQpIHsgcmV0dXJuIC0xOyB9DQogICAgICAgZWxzZSBpZiAoeEQgPiB5RCkgeyByZXR1cm4gMTsgfQ0KICAgfQ0KICAgLy8gbmF0dXJhbCBzb3J0aW5nIHRocm91Z2ggc3BsaXQgbnVtZXJpYyBzdHJpbmdzIGFuZCBkZWZhdWx0IHN0cmluZ3MNCiAgIGZvcih2YXIgY0xvYyA9IDAsIHhObCA9IHhOLmxlbmd0aCwgeU5sID0geU4ubGVuZ3RoLCBudW1TID0gTWF0aC5tYXgoeE5sLCB5TmwpOyBjTG9jIDwgbnVtUzsgY0xvYysrKSB7DQogICAgICAgb0Z4TmNMID0gbm9ybUNodW5rKHhOW2NMb2NdIHx8ICcnLCB4TmwpOw0KICAgICAgIG9GeU5jTCA9IG5vcm1DaHVuayh5TltjTG9jXSB8fCAnJywgeU5sKTsNCiAgICAgICAvLyBoYW5kbGUgbnVtZXJpYyB2cyBzdHJpbmcgY29tcGFyaXNvbiAtIG51bWJlciA8IHN0cmluZyAtIChLeWxlIEFkYW1zKQ0KICAgICAgIGlmIChpc05hTihvRnhOY0wpICE9PSBpc05hTihvRnlOY0wpKSB7DQogICAgICAgICAgIHJldHVybiBpc05hTihvRnhOY0wpID8gMSA6IC0xOw0KICAgICAgIH0NCiAgICAgICAvLyBpZiB1bmljb2RlIHVzZSBsb2NhbGUgY29tcGFyaXNvbg0KICAgICAgIGlmICgvW15ceDAwLVx4ODBdLy50ZXN0KG9GeE5jTCArIG9GeU5jTCkgJiYgb0Z4TmNMLmxvY2FsZUNvbXBhcmUpIHsNCiAgICAgICAgICAgdmFyIGNvbXAgPSBvRnhOY0wubG9jYWxlQ29tcGFyZShvRnlOY0wpOw0KICAgICAgICAgICByZXR1cm4gY29tcCAvIE1hdGguYWJzKGNvbXApOw0KICAgICAgIH0NCiAgICAgICBpZiAob0Z4TmNMIDwgb0Z5TmNMKSB7IHJldHVybiAtMTsgfQ0KICAgICAgIGVsc2UgaWYgKG9GeE5jTCA+IG9GeU5jTCkgeyByZXR1cm4gMTsgfQ0KICAgfQ0KICAgIHJldHVybiAwOw0KfTsNCg0KfSx7fV0sMTY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyoqDQogKiBTb3VyY2U6IGh0dHBzOi8vZ2l0aHViLmNvbS90aW1veGxleS90by1hcnJheQ0KICoNCiAqIENvbnZlcnQgYW4gYXJyYXktbGlrZSBvYmplY3QgaW50byBhbiBgQXJyYXlgLg0KICogSWYgYGNvbGxlY3Rpb25gIGlzIGFscmVhZHkgYW4gYEFycmF5YCwgdGhlbiB3aWxsIHJldHVybiBhIGNsb25lIG9mIGBjb2xsZWN0aW9uYC4NCiAqDQogKiBAcGFyYW0ge0FycmF5IHwgTWl4ZWR9IGNvbGxlY3Rpb24gQW4gYEFycmF5YCBvciBhcnJheS1saWtlIG9iamVjdCB0byBjb252ZXJ0IGUuZy4gYGFyZ3VtZW50c2Agb3IgYE5vZGVMaXN0YA0KICogQHJldHVybiB7QXJyYXl9IE5haXZlIGNvbnZlcnNpb24gb2YgYGNvbGxlY3Rpb25gIHRvIGEgbmV3IGBBcnJheWAuDQogKiBAYXBpIHB1YmxpYw0KICovDQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gdG9BcnJheShjb2xsZWN0aW9uKSB7DQogIGlmICh0eXBlb2YgY29sbGVjdGlvbiA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiBbXTsNCiAgaWYgKGNvbGxlY3Rpb24gPT09IG51bGwpIHJldHVybiBbbnVsbF07DQogIGlmIChjb2xsZWN0aW9uID09PSB3aW5kb3cpIHJldHVybiBbd2luZG93XTsNCiAgaWYgKHR5cGVvZiBjb2xsZWN0aW9uID09PSAnc3RyaW5nJykgcmV0dXJuIFtjb2xsZWN0aW9uXTsNCiAgaWYgKGlzQXJyYXkoY29sbGVjdGlvbikpIHJldHVybiBjb2xsZWN0aW9uOw0KICBpZiAodHlwZW9mIGNvbGxlY3Rpb24ubGVuZ3RoICE9ICdudW1iZXInKSByZXR1cm4gW2NvbGxlY3Rpb25dOw0KICBpZiAodHlwZW9mIGNvbGxlY3Rpb24gPT09ICdmdW5jdGlvbicgJiYgY29sbGVjdGlvbiBpbnN0YW5jZW9mIEZ1bmN0aW9uKSByZXR1cm4gW2NvbGxlY3Rpb25dOw0KDQogIHZhciBhcnIgPSBbXTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2xsZWN0aW9uLmxlbmd0aDsgaSsrKSB7DQogICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChjb2xsZWN0aW9uLCBpKSB8fCBpIGluIGNvbGxlY3Rpb24pIHsNCiAgICAgIGFyci5wdXNoKGNvbGxlY3Rpb25baV0pOw0KICAgIH0NCiAgfQ0KICBpZiAoIWFyci5sZW5ndGgpIHJldHVybiBbXTsNCiAgcmV0dXJuIGFycjsNCn07DQoNCmZ1bmN0aW9uIGlzQXJyYXkoYXJyKSB7DQogIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKSA9PT0gIltvYmplY3QgQXJyYXldIjsNCn0NCg0KfSx7fV0sMTc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihzKSB7DQogIHMgPSAocyA9PT0gdW5kZWZpbmVkKSA/ICIiIDogczsNCiAgcyA9IChzID09PSBudWxsKSA/ICIiIDogczsNCiAgcyA9IHMudG9TdHJpbmcoKTsNCiAgcmV0dXJuIHM7DQp9Ow0KDQp9LHt9XX0se30sWzFdKTsNCg0KICA8L3NjcmlwdD4NCiAgPHNjcmlwdD4NCiAgOyhmdW5jdGlvbigpew0KDQovKioNCiAqIFJlcXVpcmUgdGhlIGdpdmVuIHBhdGguDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IHBhdGgNCiAqIEByZXR1cm4ge09iamVjdH0gZXhwb3J0cw0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpmdW5jdGlvbiByZXF1aXJlKHBhdGgsIHBhcmVudCwgb3JpZykgew0KICB2YXIgcmVzb2x2ZWQgPSByZXF1aXJlLnJlc29sdmUocGF0aCk7DQoNCiAgLy8gbG9va3VwIGZhaWxlZA0KICBpZiAobnVsbCA9PSByZXNvbHZlZCkgew0KICAgIG9yaWcgPSBvcmlnIHx8IHBhdGg7DQogICAgcGFyZW50ID0gcGFyZW50IHx8ICdyb290JzsNCiAgICB2YXIgZXJyID0gbmV3IEVycm9yKCdGYWlsZWQgdG8gcmVxdWlyZSAiJyArIG9yaWcgKyAnIiBmcm9tICInICsgcGFyZW50ICsgJyInKTsNCiAgICBlcnIucGF0aCA9IG9yaWc7DQogICAgZXJyLnBhcmVudCA9IHBhcmVudDsNCiAgICBlcnIucmVxdWlyZSA9IHRydWU7DQogICAgdGhyb3cgZXJyOw0KICB9DQoNCiAgdmFyIG1vZHVsZSA9IHJlcXVpcmUubW9kdWxlc1tyZXNvbHZlZF07DQoNCiAgLy8gcGVyZm9ybSByZWFsIHJlcXVpcmUoKQ0KICAvLyBieSBpbnZva2luZyB0aGUgbW9kdWxlJ3MNCiAgLy8gcmVnaXN0ZXJlZCBmdW5jdGlvbg0KICBpZiAoIW1vZHVsZS5fcmVzb2x2aW5nICYmICFtb2R1bGUuZXhwb3J0cykgew0KICAgIHZhciBtb2QgPSB7fTsNCiAgICBtb2QuZXhwb3J0cyA9IHt9Ow0KICAgIG1vZC5jbGllbnQgPSBtb2QuY29tcG9uZW50ID0gdHJ1ZTsNCiAgICBtb2R1bGUuX3Jlc29sdmluZyA9IHRydWU7DQogICAgbW9kdWxlLmNhbGwodGhpcywgbW9kLmV4cG9ydHMsIHJlcXVpcmUucmVsYXRpdmUocmVzb2x2ZWQpLCBtb2QpOw0KICAgIGRlbGV0ZSBtb2R1bGUuX3Jlc29sdmluZzsNCiAgICBtb2R1bGUuZXhwb3J0cyA9IG1vZC5leHBvcnRzOw0KICB9DQoNCiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOw0KfQ0KDQovKioNCiAqIFJlZ2lzdGVyZWQgbW9kdWxlcy4NCiAqLw0KDQpyZXF1aXJlLm1vZHVsZXMgPSB7fTsNCg0KLyoqDQogKiBSZWdpc3RlcmVkIGFsaWFzZXMuDQogKi8NCg0KcmVxdWlyZS5hbGlhc2VzID0ge307DQoNCi8qKg0KICogUmVzb2x2ZSBgcGF0aGAuDQogKg0KICogTG9va3VwOg0KICoNCiAqICAgLSBQQVRIL2luZGV4LmpzDQogKiAgIC0gUEFUSC5qcw0KICogICAtIFBBVEgNCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gcGF0aA0KICogQHJldHVybiB7U3RyaW5nfSBwYXRoIG9yIG51bGwNCiAqIEBhcGkgcHJpdmF0ZQ0KICovDQoNCnJlcXVpcmUucmVzb2x2ZSA9IGZ1bmN0aW9uKHBhdGgpIHsNCiAgaWYgKHBhdGguY2hhckF0KDApID09PSAnLycpIHBhdGggPSBwYXRoLnNsaWNlKDEpOw0KDQogIHZhciBwYXRocyA9IFsNCiAgICBwYXRoLA0KICAgIHBhdGggKyAnLmpzJywNCiAgICBwYXRoICsgJy5qc29uJywNCiAgICBwYXRoICsgJy9pbmRleC5qcycsDQogICAgcGF0aCArICcvaW5kZXguanNvbicNCiAgXTsNCg0KICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGhzLmxlbmd0aDsgaSsrKSB7DQogICAgdmFyIHBhdGggPSBwYXRoc1tpXTsNCiAgICBpZiAocmVxdWlyZS5tb2R1bGVzLmhhc093blByb3BlcnR5KHBhdGgpKSByZXR1cm4gcGF0aDsNCiAgICBpZiAocmVxdWlyZS5hbGlhc2VzLmhhc093blByb3BlcnR5KHBhdGgpKSByZXR1cm4gcmVxdWlyZS5hbGlhc2VzW3BhdGhdOw0KICB9DQp9Ow0KDQovKioNCiAqIE5vcm1hbGl6ZSBgcGF0aGAgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgcGF0aC4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gY3Vycg0KICogQHBhcmFtIHtTdHJpbmd9IHBhdGgNCiAqIEByZXR1cm4ge1N0cmluZ30NCiAqIEBhcGkgcHJpdmF0ZQ0KICovDQoNCnJlcXVpcmUubm9ybWFsaXplID0gZnVuY3Rpb24oY3VyciwgcGF0aCkgew0KICB2YXIgc2VncyA9IFtdOw0KDQogIGlmICgnLicgIT0gcGF0aC5jaGFyQXQoMCkpIHJldHVybiBwYXRoOw0KDQogIGN1cnIgPSBjdXJyLnNwbGl0KCcvJyk7DQogIHBhdGggPSBwYXRoLnNwbGl0KCcvJyk7DQoNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgKytpKSB7DQogICAgaWYgKCcuLicgPT0gcGF0aFtpXSkgew0KICAgICAgY3Vyci5wb3AoKTsNCiAgICB9IGVsc2UgaWYgKCcuJyAhPSBwYXRoW2ldICYmICcnICE9IHBhdGhbaV0pIHsNCiAgICAgIHNlZ3MucHVzaChwYXRoW2ldKTsNCiAgICB9DQogIH0NCg0KICByZXR1cm4gY3Vyci5jb25jYXQoc2Vncykuam9pbignLycpOw0KfTsNCg0KLyoqDQogKiBSZWdpc3RlciBtb2R1bGUgYXQgYHBhdGhgIHdpdGggY2FsbGJhY2sgYGRlZmluaXRpb25gLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBkZWZpbml0aW9uDQogKiBAYXBpIHByaXZhdGUNCiAqLw0KDQpyZXF1aXJlLnJlZ2lzdGVyID0gZnVuY3Rpb24ocGF0aCwgZGVmaW5pdGlvbikgew0KICByZXF1aXJlLm1vZHVsZXNbcGF0aF0gPSBkZWZpbml0aW9uOw0KfTsNCg0KLyoqDQogKiBBbGlhcyBhIG1vZHVsZSBkZWZpbml0aW9uLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBmcm9tDQogKiBAcGFyYW0ge1N0cmluZ30gdG8NCiAqIEBhcGkgcHJpdmF0ZQ0KICovDQoNCnJlcXVpcmUuYWxpYXMgPSBmdW5jdGlvbihmcm9tLCB0bykgew0KICBpZiAoIXJlcXVpcmUubW9kdWxlcy5oYXNPd25Qcm9wZXJ0eShmcm9tKSkgew0KICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGFsaWFzICInICsgZnJvbSArICciLCBpdCBkb2VzIG5vdCBleGlzdCcpOw0KICB9DQogIHJlcXVpcmUuYWxpYXNlc1t0b10gPSBmcm9tOw0KfTsNCg0KLyoqDQogKiBSZXR1cm4gYSByZXF1aXJlIGZ1bmN0aW9uIHJlbGF0aXZlIHRvIHRoZSBgcGFyZW50YCBwYXRoLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXJlbnQNCiAqIEByZXR1cm4ge0Z1bmN0aW9ufQ0KICogQGFwaSBwcml2YXRlDQogKi8NCg0KcmVxdWlyZS5yZWxhdGl2ZSA9IGZ1bmN0aW9uKHBhcmVudCkgew0KICB2YXIgcCA9IHJlcXVpcmUubm9ybWFsaXplKHBhcmVudCwgJy4uJyk7DQoNCiAgLyoqDQogICAqIGxhc3RJbmRleE9mIGhlbHBlci4NCiAgICovDQoNCiAgZnVuY3Rpb24gbGFzdEluZGV4T2YoYXJyLCBvYmopIHsNCiAgICB2YXIgaSA9IGFyci5sZW5ndGg7DQogICAgd2hpbGUgKGktLSkgew0KICAgICAgaWYgKGFycltpXSA9PT0gb2JqKSByZXR1cm4gaTsNCiAgICB9DQogICAgcmV0dXJuIC0xOw0KICB9DQoNCiAgLyoqDQogICAqIFRoZSByZWxhdGl2ZSByZXF1aXJlKCkgaXRzZWxmLg0KICAgKi8NCg0KICBmdW5jdGlvbiBsb2NhbFJlcXVpcmUocGF0aCkgew0KICAgIHZhciByZXNvbHZlZCA9IGxvY2FsUmVxdWlyZS5yZXNvbHZlKHBhdGgpOw0KICAgIHJldHVybiByZXF1aXJlKHJlc29sdmVkLCBwYXJlbnQsIHBhdGgpOw0KICB9DQoNCiAgLyoqDQogICAqIFJlc29sdmUgcmVsYXRpdmUgdG8gdGhlIHBhcmVudC4NCiAgICovDQoNCiAgbG9jYWxSZXF1aXJlLnJlc29sdmUgPSBmdW5jdGlvbihwYXRoKSB7DQogICAgdmFyIGMgPSBwYXRoLmNoYXJBdCgwKTsNCiAgICBpZiAoJy8nID09IGMpIHJldHVybiBwYXRoLnNsaWNlKDEpOw0KICAgIGlmICgnLicgPT0gYykgcmV0dXJuIHJlcXVpcmUubm9ybWFsaXplKHAsIHBhdGgpOw0KDQogICAgLy8gcmVzb2x2ZSBkZXBzIGJ5IHJldHVybmluZw0KICAgIC8vIHRoZSBkZXAgaW4gdGhlIG5lYXJlc3QgImRlcHMiDQogICAgLy8gZGlyZWN0b3J5DQogICAgdmFyIHNlZ3MgPSBwYXJlbnQuc3BsaXQoJy8nKTsNCiAgICB2YXIgaSA9IGxhc3RJbmRleE9mKHNlZ3MsICdkZXBzJykgKyAxOw0KICAgIGlmICghaSkgaSA9IDA7DQogICAgcGF0aCA9IHNlZ3Muc2xpY2UoMCwgaSArIDEpLmpvaW4oJy8nKSArICcvZGVwcy8nICsgcGF0aDsNCiAgICByZXR1cm4gcGF0aDsNCiAgfTsNCg0KICAvKioNCiAgICogQ2hlY2sgaWYgbW9kdWxlIGlzIGRlZmluZWQgYXQgYHBhdGhgLg0KICAgKi8NCg0KICBsb2NhbFJlcXVpcmUuZXhpc3RzID0gZnVuY3Rpb24ocGF0aCkgew0KICAgIHJldHVybiByZXF1aXJlLm1vZHVsZXMuaGFzT3duUHJvcGVydHkobG9jYWxSZXF1aXJlLnJlc29sdmUocGF0aCkpOw0KICB9Ow0KDQogIHJldHVybiBsb2NhbFJlcXVpcmU7DQp9Ow0KcmVxdWlyZS5yZWdpc3RlcigiY29tcG9uZW50LWNsYXNzZXMvaW5kZXguanMiLCBmdW5jdGlvbihleHBvcnRzLCByZXF1aXJlLCBtb2R1bGUpew0KLyoqDQogKiBNb2R1bGUgZGVwZW5kZW5jaWVzLg0KICovDQoNCnZhciBpbmRleCA9IHJlcXVpcmUoJ2luZGV4b2YnKTsNCg0KLyoqDQogKiBXaGl0ZXNwYWNlIHJlZ2V4cC4NCiAqLw0KDQp2YXIgcmUgPSAvXHMrLzsNCg0KLyoqDQogKiB0b1N0cmluZyByZWZlcmVuY2UuDQogKi8NCg0KdmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsNCg0KLyoqDQogKiBXcmFwIGBlbGAgaW4gYSBgQ2xhc3NMaXN0YC4NCiAqDQogKiBAcGFyYW0ge0VsZW1lbnR9IGVsDQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZWwpew0KICByZXR1cm4gbmV3IENsYXNzTGlzdChlbCk7DQp9Ow0KDQovKioNCiAqIEluaXRpYWxpemUgYSBuZXcgQ2xhc3NMaXN0IGZvciBgZWxgLg0KICoNCiAqIEBwYXJhbSB7RWxlbWVudH0gZWwNCiAqIEBhcGkgcHJpdmF0ZQ0KICovDQoNCmZ1bmN0aW9uIENsYXNzTGlzdChlbCkgew0KICBpZiAoIWVsKSB0aHJvdyBuZXcgRXJyb3IoJ0EgRE9NIGVsZW1lbnQgcmVmZXJlbmNlIGlzIHJlcXVpcmVkJyk7DQogIHRoaXMuZWwgPSBlbDsNCiAgdGhpcy5saXN0ID0gZWwuY2xhc3NMaXN0Ow0KfQ0KDQovKioNCiAqIEFkZCBjbGFzcyBgbmFtZWAgaWYgbm90IGFscmVhZHkgcHJlc2VudC4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQ0KICogQHJldHVybiB7Q2xhc3NMaXN0fQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpDbGFzc0xpc3QucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uKG5hbWUpew0KICAvLyBjbGFzc0xpc3QNCiAgaWYgKHRoaXMubGlzdCkgew0KICAgIHRoaXMubGlzdC5hZGQobmFtZSk7DQogICAgcmV0dXJuIHRoaXM7DQogIH0NCg0KICAvLyBmYWxsYmFjaw0KICB2YXIgYXJyID0gdGhpcy5hcnJheSgpOw0KICB2YXIgaSA9IGluZGV4KGFyciwgbmFtZSk7DQogIGlmICghfmkpIGFyci5wdXNoKG5hbWUpOw0KICB0aGlzLmVsLmNsYXNzTmFtZSA9IGFyci5qb2luKCcgJyk7DQogIHJldHVybiB0aGlzOw0KfTsNCg0KLyoqDQogKiBSZW1vdmUgY2xhc3MgYG5hbWVgIHdoZW4gcHJlc2VudCwgb3INCiAqIHBhc3MgYSByZWd1bGFyIGV4cHJlc3Npb24gdG8gcmVtb3ZlDQogKiBhbnkgd2hpY2ggbWF0Y2guDQogKg0KICogQHBhcmFtIHtTdHJpbmd8UmVnRXhwfSBuYW1lDQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCkNsYXNzTGlzdC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24obmFtZSl7DQogIGlmICgnW29iamVjdCBSZWdFeHBdJyA9PSB0b1N0cmluZy5jYWxsKG5hbWUpKSB7DQogICAgcmV0dXJuIHRoaXMucmVtb3ZlTWF0Y2hpbmcobmFtZSk7DQogIH0NCg0KICAvLyBjbGFzc0xpc3QNCiAgaWYgKHRoaXMubGlzdCkgew0KICAgIHRoaXMubGlzdC5yZW1vdmUobmFtZSk7DQogICAgcmV0dXJuIHRoaXM7DQogIH0NCg0KICAvLyBmYWxsYmFjaw0KICB2YXIgYXJyID0gdGhpcy5hcnJheSgpOw0KICB2YXIgaSA9IGluZGV4KGFyciwgbmFtZSk7DQogIGlmICh+aSkgYXJyLnNwbGljZShpLCAxKTsNCiAgdGhpcy5lbC5jbGFzc05hbWUgPSBhcnIuam9pbignICcpOw0KICByZXR1cm4gdGhpczsNCn07DQoNCi8qKg0KICogUmVtb3ZlIGFsbCBjbGFzc2VzIG1hdGNoaW5nIGByZWAuDQogKg0KICogQHBhcmFtIHtSZWdFeHB9IHJlDQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogKiBAYXBpIHByaXZhdGUNCiAqLw0KDQpDbGFzc0xpc3QucHJvdG90eXBlLnJlbW92ZU1hdGNoaW5nID0gZnVuY3Rpb24ocmUpew0KICB2YXIgYXJyID0gdGhpcy5hcnJheSgpOw0KICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykgew0KICAgIGlmIChyZS50ZXN0KGFycltpXSkpIHsNCiAgICAgIHRoaXMucmVtb3ZlKGFycltpXSk7DQogICAgfQ0KICB9DQogIHJldHVybiB0aGlzOw0KfTsNCg0KLyoqDQogKiBUb2dnbGUgY2xhc3MgYG5hbWVgLCBjYW4gZm9yY2Ugc3RhdGUgdmlhIGBmb3JjZWAuDQogKg0KICogRm9yIGJyb3dzZXJzIHRoYXQgc3VwcG9ydCBjbGFzc0xpc3QsIGJ1dCBkbyBub3Qgc3VwcG9ydCBgZm9yY2VgIHlldCwNCiAqIHRoZSBtaXN0YWtlIHdpbGwgYmUgZGV0ZWN0ZWQgYW5kIGNvcnJlY3RlZC4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQ0KICogQHBhcmFtIHtCb29sZWFufSBmb3JjZQ0KICogQHJldHVybiB7Q2xhc3NMaXN0fQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpDbGFzc0xpc3QucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKG5hbWUsIGZvcmNlKXsNCiAgLy8gY2xhc3NMaXN0DQogIGlmICh0aGlzLmxpc3QpIHsNCiAgICBpZiAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBmb3JjZSkgew0KICAgICAgaWYgKGZvcmNlICE9PSB0aGlzLmxpc3QudG9nZ2xlKG5hbWUsIGZvcmNlKSkgew0KICAgICAgICB0aGlzLmxpc3QudG9nZ2xlKG5hbWUpOyAvLyB0b2dnbGUgYWdhaW4gdG8gY29ycmVjdA0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICB0aGlzLmxpc3QudG9nZ2xlKG5hbWUpOw0KICAgIH0NCiAgICByZXR1cm4gdGhpczsNCiAgfQ0KDQogIC8vIGZhbGxiYWNrDQogIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGZvcmNlKSB7DQogICAgaWYgKCFmb3JjZSkgew0KICAgICAgdGhpcy5yZW1vdmUobmFtZSk7DQogICAgfSBlbHNlIHsNCiAgICAgIHRoaXMuYWRkKG5hbWUpOw0KICAgIH0NCiAgfSBlbHNlIHsNCiAgICBpZiAodGhpcy5oYXMobmFtZSkpIHsNCiAgICAgIHRoaXMucmVtb3ZlKG5hbWUpOw0KICAgIH0gZWxzZSB7DQogICAgICB0aGlzLmFkZChuYW1lKTsNCiAgICB9DQogIH0NCg0KICByZXR1cm4gdGhpczsNCn07DQoNCi8qKg0KICogUmV0dXJuIGFuIGFycmF5IG9mIGNsYXNzZXMuDQogKg0KICogQHJldHVybiB7QXJyYXl9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCkNsYXNzTGlzdC5wcm90b3R5cGUuYXJyYXkgPSBmdW5jdGlvbigpew0KICB2YXIgc3RyID0gdGhpcy5lbC5jbGFzc05hbWUucmVwbGFjZSgvXlxzK3xccyskL2csICcnKTsNCiAgdmFyIGFyciA9IHN0ci5zcGxpdChyZSk7DQogIGlmICgnJyA9PT0gYXJyWzBdKSBhcnIuc2hpZnQoKTsNCiAgcmV0dXJuIGFycjsNCn07DQoNCi8qKg0KICogQ2hlY2sgaWYgY2xhc3MgYG5hbWVgIGlzIHByZXNlbnQuDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IG5hbWUNCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAqIEBhcGkgcHVibGljDQogKi8NCg0KQ2xhc3NMaXN0LnByb3RvdHlwZS5oYXMgPQ0KQ2xhc3NMaXN0LnByb3RvdHlwZS5jb250YWlucyA9IGZ1bmN0aW9uKG5hbWUpew0KICByZXR1cm4gdGhpcy5saXN0DQogICAgPyB0aGlzLmxpc3QuY29udGFpbnMobmFtZSkNCiAgICA6ICEhIH5pbmRleCh0aGlzLmFycmF5KCksIG5hbWUpOw0KfTsNCg0KfSk7DQpyZXF1aXJlLnJlZ2lzdGVyKCJjb21wb25lbnQtZXZlbnQvaW5kZXguanMiLCBmdW5jdGlvbihleHBvcnRzLCByZXF1aXJlLCBtb2R1bGUpew0KdmFyIGJpbmQgPSB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciA/ICdhZGRFdmVudExpc3RlbmVyJyA6ICdhdHRhY2hFdmVudCcsDQogICAgdW5iaW5kID0gd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIgPyAncmVtb3ZlRXZlbnRMaXN0ZW5lcicgOiAnZGV0YWNoRXZlbnQnLA0KICAgIHByZWZpeCA9IGJpbmQgIT09ICdhZGRFdmVudExpc3RlbmVyJyA/ICdvbicgOiAnJzsNCg0KLyoqDQogKiBCaW5kIGBlbGAgZXZlbnQgYHR5cGVgIHRvIGBmbmAuDQogKg0KICogQHBhcmFtIHtFbGVtZW50fSBlbA0KICogQHBhcmFtIHtTdHJpbmd9IHR5cGUNCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuDQogKiBAcGFyYW0ge0Jvb2xlYW59IGNhcHR1cmUNCiAqIEByZXR1cm4ge0Z1bmN0aW9ufQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpleHBvcnRzLmJpbmQgPSBmdW5jdGlvbihlbCwgdHlwZSwgZm4sIGNhcHR1cmUpew0KICBlbFtiaW5kXShwcmVmaXggKyB0eXBlLCBmbiwgY2FwdHVyZSB8fCBmYWxzZSk7DQogIHJldHVybiBmbjsNCn07DQoNCi8qKg0KICogVW5iaW5kIGBlbGAgZXZlbnQgYHR5cGVgJ3MgY2FsbGJhY2sgYGZuYC4NCiAqDQogKiBAcGFyYW0ge0VsZW1lbnR9IGVsDQogKiBAcGFyYW0ge1N0cmluZ30gdHlwZQ0KICogQHBhcmFtIHtGdW5jdGlvbn0gZm4NCiAqIEBwYXJhbSB7Qm9vbGVhbn0gY2FwdHVyZQ0KICogQHJldHVybiB7RnVuY3Rpb259DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCmV4cG9ydHMudW5iaW5kID0gZnVuY3Rpb24oZWwsIHR5cGUsIGZuLCBjYXB0dXJlKXsNCiAgZWxbdW5iaW5kXShwcmVmaXggKyB0eXBlLCBmbiwgY2FwdHVyZSB8fCBmYWxzZSk7DQogIHJldHVybiBmbjsNCn07DQp9KTsNCnJlcXVpcmUucmVnaXN0ZXIoImNvbXBvbmVudC1pbmRleG9mL2luZGV4LmpzIiwgZnVuY3Rpb24oZXhwb3J0cywgcmVxdWlyZSwgbW9kdWxlKXsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYXJyLCBvYmopew0KICBpZiAoYXJyLmluZGV4T2YpIHJldHVybiBhcnIuaW5kZXhPZihvYmopOw0KICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7ICsraSkgew0KICAgIGlmIChhcnJbaV0gPT09IG9iaikgcmV0dXJuIGk7DQogIH0NCiAgcmV0dXJuIC0xOw0KfTsNCn0pOw0KcmVxdWlyZS5yZWdpc3RlcigibGlzdC5wYWdpbmF0aW9uLmpzL2luZGV4LmpzIiwgZnVuY3Rpb24oZXhwb3J0cywgcmVxdWlyZSwgbW9kdWxlKXsNCnZhciBjbGFzc2VzID0gcmVxdWlyZSgnY2xhc3NlcycpLA0KICAgIGV2ZW50cyA9IHJlcXVpcmUoJ2V2ZW50Jyk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob3B0aW9ucykgew0KICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9Ow0KDQogICAgdmFyIHBhZ2luZ0xpc3QsDQogICAgICAgIGxpc3Q7DQoNCiAgICB2YXIgcmVmcmVzaCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgaXRlbSwNCiAgICAgICAgICAgIGwgPSBsaXN0Lm1hdGNoaW5nSXRlbXMubGVuZ3RoLA0KICAgICAgICAgICAgaW5kZXggPSBsaXN0LmksDQogICAgICAgICAgICBwYWdlID0gbGlzdC5wYWdlLA0KICAgICAgICAgICAgcGFnZXMgPSBNYXRoLmNlaWwobCAvIHBhZ2UpLA0KICAgICAgICAgICAgY3VycmVudFBhZ2UgPSBNYXRoLmNlaWwoKGluZGV4IC8gcGFnZSkpLA0KICAgICAgICAgICAgaW5uZXJXaW5kb3cgPSBvcHRpb25zLmlubmVyV2luZG93IHx8IDIsDQogICAgICAgICAgICBsZWZ0ID0gb3B0aW9ucy5sZWZ0IHx8IG9wdGlvbnMub3V0ZXJXaW5kb3cgfHwgMCwNCiAgICAgICAgICAgIHJpZ2h0ID0gb3B0aW9ucy5yaWdodCB8fCBvcHRpb25zLm91dGVyV2luZG93IHx8IDA7DQoNCiAgICAgICAgcmlnaHQgPSBwYWdlcyAtIHJpZ2h0Ow0KDQogICAgICAgIHBhZ2luZ0xpc3QuY2xlYXIoKTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gcGFnZXM7IGkrKykgew0KICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IChjdXJyZW50UGFnZSA9PT0gaSkgPyAiYWN0aXZlIiA6ICIiOw0KDQogICAgICAgICAgICAvL2NvbnNvbGUubG9nKGksIGxlZnQsIHJpZ2h0LCBjdXJyZW50UGFnZSwgKGN1cnJlbnRQYWdlIC0gaW5uZXJXaW5kb3cpLCAoY3VycmVudFBhZ2UgKyBpbm5lcldpbmRvdyksIGNsYXNzTmFtZSk7DQoNCiAgICAgICAgICAgIGlmIChpcy5udW1iZXIoaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdykpIHsNCiAgICAgICAgICAgICAgICBpdGVtID0gcGFnaW5nTGlzdC5hZGQoew0KICAgICAgICAgICAgICAgICAgICBwYWdlOiBpLA0KICAgICAgICAgICAgICAgICAgICBkb3R0ZWQ6IGZhbHNlDQogICAgICAgICAgICAgICAgfSlbMF07DQogICAgICAgICAgICAgICAgaWYgKGNsYXNzTmFtZSkgew0KICAgICAgICAgICAgICAgICAgICBjbGFzc2VzKGl0ZW0uZWxtKS5hZGQoY2xhc3NOYW1lKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYWRkRXZlbnQoaXRlbS5lbG0sIGksIHBhZ2UpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChpcy5kb3R0ZWQoaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdywgcGFnaW5nTGlzdC5zaXplKCkpKSB7DQogICAgICAgICAgICAgICAgaXRlbSA9IHBhZ2luZ0xpc3QuYWRkKHsNCiAgICAgICAgICAgICAgICAgICAgcGFnZTogIi4uLiIsDQogICAgICAgICAgICAgICAgICAgIGRvdHRlZDogdHJ1ZQ0KICAgICAgICAgICAgICAgIH0pWzBdOw0KICAgICAgICAgICAgICAgIGNsYXNzZXMoaXRlbS5lbG0pLmFkZCgiZGlzYWJsZWQiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICB2YXIgaXMgPSB7DQogICAgICAgIG51bWJlcjogZnVuY3Rpb24oaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdykgew0KICAgICAgICAgICByZXR1cm4gdGhpcy5sZWZ0KGksIGxlZnQpIHx8IHRoaXMucmlnaHQoaSwgcmlnaHQpIHx8IHRoaXMuaW5uZXJXaW5kb3coaSwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93KTsNCiAgICAgICAgfSwNCiAgICAgICAgbGVmdDogZnVuY3Rpb24oaSwgbGVmdCkgew0KICAgICAgICAgICAgcmV0dXJuIChpIDw9IGxlZnQpOw0KICAgICAgICB9LA0KICAgICAgICByaWdodDogZnVuY3Rpb24oaSwgcmlnaHQpIHsNCiAgICAgICAgICAgIHJldHVybiAoaSA+IHJpZ2h0KTsNCiAgICAgICAgfSwNCiAgICAgICAgaW5uZXJXaW5kb3c6IGZ1bmN0aW9uKGksIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdykgew0KICAgICAgICAgICAgcmV0dXJuICggaSA+PSAoY3VycmVudFBhZ2UgLSBpbm5lcldpbmRvdykgJiYgaSA8PSAoY3VycmVudFBhZ2UgKyBpbm5lcldpbmRvdykpOw0KICAgICAgICB9LA0KICAgICAgICBkb3R0ZWQ6IGZ1bmN0aW9uKGksIGxlZnQsIHJpZ2h0LCBjdXJyZW50UGFnZSwgaW5uZXJXaW5kb3csIGN1cnJlbnRQYWdlSXRlbSkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZG90dGVkTGVmdChpLCBsZWZ0LCByaWdodCwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93KSB8fCAodGhpcy5kb3R0ZWRSaWdodChpLCBsZWZ0LCByaWdodCwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93LCBjdXJyZW50UGFnZUl0ZW0pKTsNCiAgICAgICAgfSwNCiAgICAgICAgZG90dGVkTGVmdDogZnVuY3Rpb24oaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdykgew0KICAgICAgICAgICAgcmV0dXJuICgoaSA9PSAobGVmdCArIDEpKSAmJiAhdGhpcy5pbm5lcldpbmRvdyhpLCBjdXJyZW50UGFnZSwgaW5uZXJXaW5kb3cpICYmICF0aGlzLnJpZ2h0KGksIHJpZ2h0KSk7DQogICAgICAgIH0sDQogICAgICAgIGRvdHRlZFJpZ2h0OiBmdW5jdGlvbihpLCBsZWZ0LCByaWdodCwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93LCBjdXJyZW50UGFnZUl0ZW0pIHsNCiAgICAgICAgICAgIGlmIChwYWdpbmdMaXN0Lml0ZW1zW2N1cnJlbnRQYWdlSXRlbS0xXS52YWx1ZXMoKS5kb3R0ZWQpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiAoKGkgPT0gKHJpZ2h0KSkgJiYgIXRoaXMuaW5uZXJXaW5kb3coaSwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93KSAmJiAhdGhpcy5yaWdodChpLCByaWdodCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIHZhciBhZGRFdmVudCA9IGZ1bmN0aW9uKGVsbSwgaSwgcGFnZSkgew0KICAgICAgIGV2ZW50cy5iaW5kKGVsbSwgJ2NsaWNrJywgZnVuY3Rpb24oKSB7DQogICAgICAgICAgIGxpc3Quc2hvdygoaS0xKSpwYWdlICsgMSwgcGFnZSk7DQogICAgICAgfSk7DQogICAgfTsNCg0KICAgIHJldHVybiB7DQogICAgICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudExpc3QpIHsNCiAgICAgICAgICAgIGxpc3QgPSBwYXJlbnRMaXN0Ow0KICAgICAgICAgICAgcGFnaW5nTGlzdCA9IG5ldyBMaXN0KGxpc3QubGlzdENvbnRhaW5lci5pZCwgew0KICAgICAgICAgICAgICAgIGxpc3RDbGFzczogb3B0aW9ucy5wYWdpbmF0aW9uQ2xhc3MgfHwgJ3BhZ2luYXRpb24nLA0KICAgICAgICAgICAgICAgIGl0ZW06ICI8bGk+PGEgY2xhc3M9J3BhZ2UnIGhyZWY9J2phdmFzY3JpcHQ6ZnVuY3Rpb24gWigpe1o9XCJcIn1aKCknPjwvYT48L2xpPiIsDQogICAgICAgICAgICAgICAgdmFsdWVOYW1lczogWydwYWdlJywgJ2RvdHRlZCddLA0KICAgICAgICAgICAgICAgIHNlYXJjaENsYXNzOiAncGFnaW5hdGlvbi1zZWFyY2gtdGhhdC1pcy1ub3Qtc3VwcG9zZWQtdG8tZXhpc3QnLA0KICAgICAgICAgICAgICAgIHNvcnRDbGFzczogJ3BhZ2luYXRpb24tc29ydC10aGF0LWlzLW5vdC1zdXBwb3NlZC10by1leGlzdCcNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgbGlzdC5vbigndXBkYXRlZCcsIHJlZnJlc2gpOw0KICAgICAgICAgICAgcmVmcmVzaCgpOw0KICAgICAgICB9LA0KICAgICAgICBuYW1lOiBvcHRpb25zLm5hbWUgfHwgInBhZ2luYXRpb24iDQogICAgfTsNCn07DQoNCn0pOw0KDQoNCg0KDQoNCg0KcmVxdWlyZS5hbGlhcygiY29tcG9uZW50LWNsYXNzZXMvaW5kZXguanMiLCAibGlzdC5wYWdpbmF0aW9uLmpzL2RlcHMvY2xhc3Nlcy9pbmRleC5qcyIpOw0KcmVxdWlyZS5hbGlhcygiY29tcG9uZW50LWNsYXNzZXMvaW5kZXguanMiLCAiY2xhc3Nlcy9pbmRleC5qcyIpOw0KcmVxdWlyZS5hbGlhcygiY29tcG9uZW50LWluZGV4b2YvaW5kZXguanMiLCAiY29tcG9uZW50LWNsYXNzZXMvZGVwcy9pbmRleG9mL2luZGV4LmpzIik7DQoNCnJlcXVpcmUuYWxpYXMoImNvbXBvbmVudC1ldmVudC9pbmRleC5qcyIsICJsaXN0LnBhZ2luYXRpb24uanMvZGVwcy9ldmVudC9pbmRleC5qcyIpOw0KcmVxdWlyZS5hbGlhcygiY29tcG9uZW50LWV2ZW50L2luZGV4LmpzIiwgImV2ZW50L2luZGV4LmpzIik7DQoNCnJlcXVpcmUuYWxpYXMoImNvbXBvbmVudC1pbmRleG9mL2luZGV4LmpzIiwgImxpc3QucGFnaW5hdGlvbi5qcy9kZXBzL2luZGV4b2YvaW5kZXguanMiKTsNCnJlcXVpcmUuYWxpYXMoImNvbXBvbmVudC1pbmRleG9mL2luZGV4LmpzIiwgImluZGV4b2YvaW5kZXguanMiKTsNCg0KcmVxdWlyZS5hbGlhcygibGlzdC5wYWdpbmF0aW9uLmpzL2luZGV4LmpzIiwgImxpc3QucGFnaW5hdGlvbi5qcy9pbmRleC5qcyIpO2lmICh0eXBlb2YgZXhwb3J0cyA9PSAib2JqZWN0Iikgew0KICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImxpc3QucGFnaW5hdGlvbi5qcyIpOw0KfSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCkgew0KICBkZWZpbmUoZnVuY3Rpb24oKXsgcmV0dXJuIHJlcXVpcmUoImxpc3QucGFnaW5hdGlvbi5qcyIpOyB9KTsNCn0gZWxzZSB7DQogIHRoaXNbIkxpc3RQYWdpbmF0aW9uIl0gPSByZXF1aXJlKCJsaXN0LnBhZ2luYXRpb24uanMiKTsNCn19KSgpOw0KICA8L3NjcmlwdD4NCiAgPCEtLWh0dHA6Ly93d3cubWVudWNvb2wuY29tL3RhYmJlZC1jb250ZW50LS0+DQogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy90YWJjb250ZW50LmNzcyIgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgLz4tLT4NCiAgPHN0eWxlPg0KICAgIC8qIFRhYiBDb250ZW50IC0gbWVudWNvb2wuY29tICovDQogICAgdWwudGFicyB7DQogICAgICBwYWRkaW5nOiAxNHB4IDAgOHB4Ow0KICAgICAgbWFyZ2luOiAwOw0KICAgICAgZm9udC1zaXplOiAwOw0KICAgICAgbGlzdC1zdHlsZS10eXBlOiBub25lOw0KICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgIC8qc2V0IHRvIGxlZnQsIGNlbnRlciwgb3IgcmlnaHQgdG8gYWxpZ24gdGhlIHRhYnMgYXMgZGVzaXJlZCovDQogICAgICBiYWNrZ3JvdW5kOiAjREREREUzOw0KICAgICAgYm9yZGVyOiAxcHggc29saWQgI0NDQzsNCiAgICAgIGJvcmRlci1ib3R0b206IG5vbmU7DQogICAgICBib3JkZXItcmFkaXVzOiAycHggMnB4IDAgMDsNCiAgICAgIHBhZGRpbmctbGVmdDogMTBweDsNCiAgICAgIC8qIE9mZnNldCBvZiB0aGUgZmlyc3QgdGFiICovDQogICAgfQ0KDQogICAgdWwudGFicyBsaSB7DQogICAgICBkaXNwbGF5OiBpbmxpbmU7DQogICAgICBtYXJnaW46IDA7DQogICAgICBtYXJnaW4tcmlnaHQ6IDJweDsNCiAgICAgIC8qZGlzdGFuY2UgYmV0d2VlbiB0YWJzKi8NCiAgICAgIGZvbnQ6IG5vcm1hbCAxMnB4IFZlcmRhbmE7DQogICAgfQ0KDQogICAgdWwudGFicyBsaSBhIHsNCiAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsNCiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgIHBhZGRpbmc6IDhweCAyMnB4Ow0KICAgICAgY29sb3I6ICMwMDA7DQogICAgICBib3JkZXItcmFkaXVzOiAzcHggM3B4IDAgMDsNCiAgICAgIG91dGxpbmU6IG5vbmU7DQogICAgfQ0KDQogICAgdWwudGFicyBsaSBhOmhvdmVyIHsNCiAgICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOw0KICAgICAgY29sb3I6ICMwMDA7DQogICAgfQ0KDQogICAgdWwudGFicyBsaS5zZWxlY3RlZCBhIHsNCiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgIHRvcDogMHB4Ow0KICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICBiYWNrZ3JvdW5kOiAjRkZGOw0KICAgICAgYm9yZGVyOiAxcHggc29saWQgI0FBQTsNCiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjRkZGOw0KICAgICAgY29sb3I6ICMwMDA7DQogICAgfQ0KDQogICAgdWwudGFicyBsaS5zZWxlY3RlZCBhOmhvdmVyLA0KICAgIHVsLnRhYnMgbGkuc2VsZWN0ZWQgYTpob3ZlciB7DQogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgfQ0KDQogICAgZGl2LnRhYmNvbnRlbnRzIHsNCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNDQ0M7DQogICAgICBwYWRkaW5nOiAxNXB4Ow0KICAgICAgYm9yZGVyLXRvcC1jb2xvcjogI0FBQTsNCiAgICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkY7DQogICAgICBib3JkZXItcmFkaXVzOiAwIDAgMnB4IDJweDsNCiAgICB9DQogIDwvc3R5bGU+DQogIDwhLS08c2NyaXB0IHNyYz0iamF2YXNjcmlwdHMvdGFiY29udGVudC5qcyIgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij48L3NjcmlwdD4tLT4NCiAgPHNjcmlwdD4NCiAgICAvKiBodHRwOi8vd3d3Lm1lbnVjb29sLmNvbS90YWJiZWQtY29udGVudCBGcmVlIHRvIHVzZS4gdjIwMTMuNy42ICovDQogICAgKGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciBwcmV2ZW50RGVmYXVsdCA9IGZ1bmN0aW9uIChldnQpIHsNCiAgICAgICAgaWYgKGV2dCAmJiBldnQuc3RvcFByb3BhZ2F0aW9uKSB7DQogICAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICB9DQogICAgICAgIGlmIChldnQgJiYgZXZ0LnByZXZlbnREZWZhdWx0KSB7DQogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAgIGFkZEV2ZW50ID0gZnVuY3Rpb24gKGVsZW0sIGV2ZW50TmFtZSwgZm4pIHsNCiAgICAgICAgICBpZiAoZWxlbS5hZGRFdmVudExpc3RlbmVyKSB7DQogICAgICAgICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmbiwgZmFsc2UpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBlbGVtLmF0dGFjaEV2ZW50KCJvbiIgKyBldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgLy8gc2V0IHRoZSB0aGlzIHBvaW50ZXIgc2FtZSBhcyBhZGRFdmVudExpc3RlbmVyIHdoZW4gZm4gaXMgY2FsbGVkDQogICAgICAgICAgICAgIHJldHVybiAoZm4uY2FsbChlbGVtLCB3aW5kb3cuZXZlbnQpKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgaGFzQ2xhc3MgPSBmdW5jdGlvbiAoZWxlbSwgY2xhc3NOYW1lKSB7DQogICAgICAgICAgdmFyIGNsYXNzUGF0dGVybiA9IG5ldyBSZWdFeHAoIihefCApIiArIGNsYXNzTmFtZSArICIoIHwkKSIpOw0KICAgICAgICAgIHJldHVybiBjbGFzc1BhdHRlcm4udGVzdChlbGVtLmNsYXNzTmFtZSkgPyB0cnVlIDogZmFsc2U7DQogICAgICAgIH0sDQogICAgICAgIGFkZENsYXNzID0gZnVuY3Rpb24gKGVsZW0sIGNsYXNzTmFtZSwgZmlyc3QpIHsNCiAgICAgICAgICBpZiAoIWhhc0NsYXNzKGVsZW0sIGNsYXNzTmFtZSkpIHsNCiAgICAgICAgICAgIGlmIChlbGVtLmNsYXNzTmFtZSA9PSAiIikgew0KICAgICAgICAgICAgICBlbGVtLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlyc3QpIHsNCiAgICAgICAgICAgICAgZWxlbS5jbGFzc05hbWUgPSBjbGFzc05hbWUgKyAiICIgKyBlbGVtLmNsYXNzTmFtZTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGVsZW0uY2xhc3NOYW1lICs9ICIgIiArIGNsYXNzTmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHJlbW92ZUNsYXNzID0gZnVuY3Rpb24gKGVsZW0sIGNsYXNzTmFtZSkgew0KICAgICAgICAgIHZhciBjbGFzc1BhdHRlcm4gPSBuZXcgUmVnRXhwKCIoXnwgKSIgKyBjbGFzc05hbWUgKyAiKCB8JCkiKTsNCiAgICAgICAgICBlbGVtLmNsYXNzTmFtZSA9IGVsZW0uY2xhc3NOYW1lLnJlcGxhY2UoY2xhc3NQYXR0ZXJuLCAiJDEiKTsNCiAgICAgICAgICBlbGVtLmNsYXNzTmFtZSA9IGVsZW0uY2xhc3NOYW1lLnJlcGxhY2UoLyAkLywgIiIpDQogICAgICAgIH0sDQogICAgICAgIHBhZ2VOYW1lID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHZhciBwYXRoID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lOw0KICAgICAgICAgIHZhciBsYXN0UGFydCA9ICcnOw0KICAgICAgICAgIGlmIChwYXRoLmluZGV4T2YoIi8iKSAhPSAtMSkgew0KICAgICAgICAgICAgcGF0aFBhcnRzID0gcGF0aC5zcGxpdCgiLyIpLmZpbHRlcihwYXJ0ID0+IHBhcnQubGVuZ3RoID4gMCk7DQogICAgICAgICAgICBsYXN0UGFydCA9IHBhdGhQYXJ0c1twYXRoUGFydHMubGVuZ3RoIC0gMV0gfHwgInJvb3QiOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBsYXN0UGFydCA9IHBhdGggfHwgInJvb3QiOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAobGFzdFBhcnQuaW5kZXhPZigiLiIpICE9IC0xKSB7DQogICAgICAgICAgICBsYXN0UGFydCA9IGxhc3RQYXJ0LnN1YnN0cmluZygwLCBsYXN0UGFydC5pbmRleE9mKCIuIikpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAobGFzdFBhcnQubGVuZ3RoID4gMjApIHsNCiAgICAgICAgICAgIGxhc3RQYXJ0ID0gbGFzdFBhcnQuc3Vic3RyaW5nKGxhc3RQYXJ0Lmxlbmd0aCAtIDE5KTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIGxhc3RQYXJ0Ow0KICAgICAgICB9LA0KICAgICAgICBjb29raWVOYW1lID0gIm1pIiArIHBhZ2VOYW1lKCksDQogICAgICAgIFRhYkdyb3VwID0gZnVuY3Rpb24gKGVsZW0sIGluZGV4KSB7DQogICAgICAgICAgdGhpcy5pbml0KGVsZW0sIGluZGV4KQ0KICAgICAgICB9Ow0KICAgICAgVGFiR3JvdXAucHJvdG90eXBlID0gew0KICAgICAgICBsb2FkU2VsZWN0ZWRUYWI6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICB2YXIgY29va2llUGF0dGVybiA9IG5ldyBSZWdFeHAoY29va2llTmFtZSArIHRoaXMuaW5kZXggKyAiPShcXGQrKSIpLA0KICAgICAgICAgICAgY29va2llTWF0Y2ggPSBkb2N1bWVudC5jb29raWUubWF0Y2goY29va2llUGF0dGVybik7DQogICAgICAgICAgcmV0dXJuIGNvb2tpZU1hdGNoID8gY29va2llTWF0Y2hbMV0gOiB0aGlzLmdldFNlbGVjdGVkSW5kZXgoKQ0KICAgICAgICB9LA0KICAgICAgICBnZXRTZWxlY3RlZEluZGV4OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgdmFyIGMgPSB0aGlzLnRhYnMubGVuZ3RoOw0KICAgICAgICAgIGZvciAodmFyIGIgPSAwOyBiIDwgYzsgYisrKSB7DQogICAgICAgICAgICBpZiAoaGFzQ2xhc3ModGhpcy50YWJzW2JdLnBhcmVudE5vZGUsICJzZWxlY3RlZCIpKSB7DQogICAgICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfSwNCiAgICAgICAgc2VsZWN0VGFiOiBmdW5jdGlvbiAodGFiTGluaywgdXBkYXRlQ29va2llKSB7DQogICAgICAgICAgdmFyIHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYkxpbmsudGFyZ2V0SWQpOw0KICAgICAgICAgIGlmICghdGFyZ2V0KSByZXR1cm47DQogICAgICAgICAgdGhpcy5zaG93VGFiKHRhcmdldCk7DQogICAgICAgICAgZm9yICh2YXIgYSA9IDA7IGEgPCB0aGlzLnRhYnMubGVuZ3RoOyBhKyspDQogICAgICAgICAgICBpZiAodGhpcy50YWJzW2FdID09IHRhYkxpbmspIHsNCiAgICAgICAgICAgICAgYWRkQ2xhc3ModGFiTGluay5wYXJlbnROb2RlLCAic2VsZWN0ZWQiKTsNCiAgICAgICAgICAgICAgaWYgKHVwZGF0ZUNvb2tpZSAmJiB0aGlzLmRhdGFQZXJzaXN0KSB7DQogICAgICAgICAgICAgICAgdGhpcy5zdG9yZVNlbGVjdGVkVGFiKHRoaXMuaW5kZXgsIGEpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICByZW1vdmVDbGFzcyh0aGlzLnRhYnNbYV0ucGFyZW50Tm9kZSwgInNlbGVjdGVkIik7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHN0b3JlU2VsZWN0ZWRUYWI6IGZ1bmN0aW9uICh0YWJHcm91cEluZGV4LCB0YWJJbmRleCkgew0KICAgICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZU5hbWUgKyB0YWJHcm91cEluZGV4ICsgIj0iICsgdGFiSW5kZXggKyAiOyBwYXRoPS8iDQogICAgICAgIH0sDQogICAgICAgIHNob3dUYWI6IGZ1bmN0aW9uICh0YXJnZXQpIHsNCiAgICAgICAgICBmb3IgKHZhciBhID0gMDsgYSA8IHRoaXMudGFyZ2V0cy5sZW5ndGg7IGErKykgew0KICAgICAgICAgICAgdGhpcy50YXJnZXRzW2FdLnN0eWxlLmRpc3BsYXkgPSB0aGlzLnRhcmdldHNbYV0uaWQgPT0gdGFyZ2V0LmlkID8gImJsb2NrIiA6ICJub25lIjsNCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGluaXRUYWJzOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgdGhpcy50YXJnZXRzID0gW107DQogICAgICAgICAgdmFyIHRhYkdyb3VwID0gdGhpczsNCiAgICAgICAgICBmb3IgKHZhciBhID0gMDsgYSA8IHRoaXMudGFicy5sZW5ndGg7IGErKykgew0KICAgICAgICAgICAgdmFyIHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudGFic1thXS50YXJnZXRJZCk7DQogICAgICAgICAgICBpZiAodGFyZ2V0KSB7DQogICAgICAgICAgICAgIHRoaXMudGFyZ2V0cy5wdXNoKHRhcmdldCk7DQogICAgICAgICAgICAgIGFkZEV2ZW50KHRoaXMudGFic1thXSwgImNsaWNrIiwgZnVuY3Rpb24gKGV2dCkgew0KICAgICAgICAgICAgICAgIHZhciB0YWJMaW5rID0gdGhpczsNCiAgICAgICAgICAgICAgICBpZiAodGFiTGluayA9PT0gd2luZG93KSB7DQogICAgICAgICAgICAgICAgICB0YWJMaW5rID0gd2luZG93LmV2ZW50LnNyY0VsZW1lbnQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRhYkdyb3VwLnNlbGVjdFRhYih0YWJMaW5rLCAxKTsNCiAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdChldnQpOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChlbGVtLCBpbmRleCkgew0KICAgICAgICAgIHRoaXMuaW5kZXggPSBpbmRleDsNCiAgICAgICAgICB0aGlzLnRhYnMgPSBbXTsNCiAgICAgICAgICB2YXIgbGlua3MgPSBlbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJhIiksDQogICAgICAgICAgICBhbmNob3JQYXR0ZXJuID0gLyMoW14/XSspLzsNCiAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgbGlua3MubGVuZ3RoOyBjKyspIHsNCiAgICAgICAgICAgIHZhciB0YWJMaW5rID0gbGlua3NbY107DQogICAgICAgICAgICB2YXIgaHJlZiA9IHRhYkxpbmsuZ2V0QXR0cmlidXRlKCJocmVmIik7DQogICAgICAgICAgICBpZiAoaHJlZi5pbmRleE9mKCIjIikgPT0gLTEpIHsNCiAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICB2YXIgYW5jaG9yTWF0Y2ggPSBocmVmLm1hdGNoKGFuY2hvclBhdHRlcm4pOw0KICAgICAgICAgICAgICBpZiAoYW5jaG9yTWF0Y2gpIHsNCiAgICAgICAgICAgICAgICBocmVmID0gYW5jaG9yTWF0Y2hbMV07DQogICAgICAgICAgICAgICAgdGFiTGluay50YXJnZXRJZCA9IGhyZWY7DQogICAgICAgICAgICAgICAgdGhpcy50YWJzLnB1c2godGFiTGluayk7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIGRhdGFQZXJzaXN0ID0gZWxlbS5nZXRBdHRyaWJ1dGUoImRhdGEtcGVyc2lzdCIpIHx8ICIiOw0KICAgICAgICAgIHRoaXMuZGF0YVBlcnNpc3QgPSBkYXRhUGVyc2lzdC50b0xvd2VyQ2FzZSgpID09ICJ0cnVlIiA/IDEgOiAwOw0KICAgICAgICAgIHRoaXMuaW5pdFRhYnMoKTsNCiAgICAgICAgICB0aGlzLmluaXRTZWxlY3RlZFRhYigpDQogICAgICAgIH0sDQogICAgICAgIGluaXRTZWxlY3RlZFRhYjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHZhciBzZWxlY3RlZFRhYkluZGV4ID0gdGhpcy5kYXRhUGVyc2lzdCA/IHBhcnNlSW50KHRoaXMubG9hZFNlbGVjdGVkVGFiKCkpIDogdGhpcy5nZXRTZWxlY3RlZEluZGV4KCk7DQogICAgICAgICAgaWYgKHNlbGVjdGVkVGFiSW5kZXggPj0gdGhpcy50YWJzLmxlbmd0aCkgew0KICAgICAgICAgICAgc2VsZWN0ZWRUYWJJbmRleCA9IDA7DQogICAgICAgICAgfQ0KICAgICAgICAgIHRoaXMuc2VsZWN0VGFiKHRoaXMudGFic1tzZWxlY3RlZFRhYkluZGV4XSwgMCk7DQogICAgICAgIH0NCiAgICAgIH07DQogICAgICB2YXIgdGFiR3JvdXBzID0gW10sDQogICAgICAgIGRvY3VtZW50UmVhZHkgPSBmdW5jdGlvbiAoZnVuYykgew0KICAgICAgICAgIHZhciBzdGFydGluZyA9IGZhbHNlOw0KDQogICAgICAgICAgZnVuY3Rpb24gc3RhcnRGdW5jKCkgew0KICAgICAgICAgICAgaWYgKHN0YXJ0aW5nKSByZXR1cm47DQogICAgICAgICAgICBzdGFydGluZyA9IHRydWU7DQogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmMsIDQpDQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7DQogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgc3RhcnRGdW5jLCBmYWxzZSk7DQogICAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5hdHRhY2hFdmVudCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgdmFyIHRvcGxldmVsID0gd2luZG93LmZyYW1lRWxlbWVudCA9PSBudWxsOw0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgeyB9DQogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsICYmIHRvcGxldmVsKSB7DQogICAgICAgICAgICAgIGZ1bmN0aW9uIGRvU2Nyb2xsQ2hlY2soKSB7DQogICAgICAgICAgICAgICAgaWYgKHN0YXJ0aW5nKSByZXR1cm47DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCgibGVmdCIpOw0KICAgICAgICAgICAgICAgICAgc3RhcnRGdW5jKCkNCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGRvU2Nyb2xsQ2hlY2ssIDEwKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBkb1Njcm9sbENoZWNrKCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRvY3VtZW50LmF0dGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgIGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIgJiYgc3RhcnRGdW5jKCkNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KICAgICAgICAgIGFkZEV2ZW50KHdpbmRvdywgImxvYWQiLCBzdGFydEZ1bmMpDQogICAgICAgIH0sDQogICAgICAgIGluaXRUYWJHcm91cHMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgdmFyIHBvc3NpYmxlVGFiR3JvdXBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInVsIiksDQogICAgICAgICAgICBlID0gcG9zc2libGVUYWJHcm91cHMubGVuZ3RoOw0KICAgICAgICAgIGZvciAoYyA9IDA7IGMgPCBlOyBjKyspIHsNCiAgICAgICAgICAgIGlmIChoYXNDbGFzcyhwb3NzaWJsZVRhYkdyb3Vwc1tjXSwgInRhYnMiKSkgew0KICAgICAgICAgICAgICB0YWJHcm91cHMucHVzaChuZXcgVGFiR3JvdXAocG9zc2libGVUYWJHcm91cHNbY10sIGMpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICBkb2N1bWVudFJlYWR5KGluaXRUYWJHcm91cHMpOw0KICAgICAgcmV0dXJuIHt9DQogICAgfSkoKQ0KDQogIDwvc2NyaXB0Pg0KICA8IS0tWE1MIEZvcm1hdHRlci0tPg0KICA8IS0tPHNjcmlwdCBzcmM9ImphdmFzY3JpcHRzL3htbC1mb3JtYXR0ZXIuanMiPjwvc2NyaXB0Pi0tPg0KICA8c2NyaXB0Pg0KICAgIHJlcXVpcmUgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiByKGUsIG4sIHQpIHsgZnVuY3Rpb24gbyhpLCBmKSB7IGlmICghbltpXSkgeyBpZiAoIWVbaV0pIHsgdmFyIGMgPSAiZnVuY3Rpb24iID09IHR5cGVvZiByZXF1aXJlICYmIHJlcXVpcmU7IGlmICghZiAmJiBjKSByZXR1cm4gYyhpLCAhMCk7IGlmICh1KSByZXR1cm4gdShpLCAhMCk7IHZhciBhID0gbmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIgKyBpICsgIiciKTsgdGhyb3cgYS5jb2RlID0gIk1PRFVMRV9OT1RfRk9VTkQiLCBhIH0gdmFyIHAgPSBuW2ldID0geyBleHBvcnRzOiB7fSB9OyBlW2ldWzBdLmNhbGwocC5leHBvcnRzLCBmdW5jdGlvbiAocikgeyB2YXIgbiA9IGVbaV1bMV1bcl07IHJldHVybiBvKG4gfHwgcikgfSwgcCwgcC5leHBvcnRzLCByLCBlLCBuLCB0KSB9IHJldHVybiBuW2ldLmV4cG9ydHMgfSBmb3IgKHZhciB1ID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgcmVxdWlyZSAmJiByZXF1aXJlLCBpID0gMDsgaSA8IHQubGVuZ3RoOyBpKyspbyh0W2ldKTsgcmV0dXJuIG8gfSByZXR1cm4gciB9KSgpKHsNCiAgMTogW2Z1bmN0aW9uIChyZXF1aXJlLCBtb2R1bGUsIGV4cG9ydHMpIHsNCiAgICAidXNlIHN0cmljdCI7DQoNCiAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyAiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiOyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0NCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0NCiAgICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9DQogICAgZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsgdmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7IHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsgdmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLCByZXN1bHQ7IGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7IHZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7IHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7IH0gZWxzZSB7IHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH0gcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7IH07IH0NCiAgICBmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsgcmV0dXJuIGNhbGw7IH0gZWxzZSBpZiAoY2FsbCAhPT0gdm9pZCAwKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkRlcml2ZWQgY29uc3RydWN0b3JzIG1heSBvbmx5IHJldHVybiBvYmplY3Qgb3IgdW5kZWZpbmVkIik7IH0gcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7IH0NCiAgICBmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9DQogICAgZnVuY3Rpb24gX3dyYXBOYXRpdmVTdXBlcihDbGFzcykgeyB2YXIgX2NhY2hlID0gdHlwZW9mIE1hcCA9PT0gImZ1bmN0aW9uIiA/IG5ldyBNYXAoKSA6IHVuZGVmaW5lZDsgX3dyYXBOYXRpdmVTdXBlciA9IGZ1bmN0aW9uIF93cmFwTmF0aXZlU3VwZXIoQ2xhc3MpIHsgaWYgKENsYXNzID09PSBudWxsIHx8ICFfaXNOYXRpdmVGdW5jdGlvbihDbGFzcykpIHJldHVybiBDbGFzczsgaWYgKHR5cGVvZiBDbGFzcyAhPT0gImZ1bmN0aW9uIikgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IGlmICh0eXBlb2YgX2NhY2hlICE9PSAidW5kZWZpbmVkIikgeyBpZiAoX2NhY2hlLmhhcyhDbGFzcykpIHJldHVybiBfY2FjaGUuZ2V0KENsYXNzKTsgX2NhY2hlLnNldChDbGFzcywgV3JhcHBlcik7IH0gZnVuY3Rpb24gV3JhcHBlcigpIHsgcmV0dXJuIF9jb25zdHJ1Y3QoQ2xhc3MsIGFyZ3VtZW50cywgX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yKTsgfSBXcmFwcGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBXcmFwcGVyLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyByZXR1cm4gX3NldFByb3RvdHlwZU9mKFdyYXBwZXIsIENsYXNzKTsgfTsgcmV0dXJuIF93cmFwTmF0aXZlU3VwZXIoQ2xhc3MpOyB9DQogICAgZnVuY3Rpb24gX2NvbnN0cnVjdChQYXJlbnQsIGFyZ3MsIENsYXNzKSB7IGlmIChfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkpIHsgX2NvbnN0cnVjdCA9IFJlZmxlY3QuY29uc3RydWN0OyB9IGVsc2UgeyBfY29uc3RydWN0ID0gZnVuY3Rpb24gX2NvbnN0cnVjdChQYXJlbnQsIGFyZ3MsIENsYXNzKSB7IHZhciBhID0gW251bGxdOyBhLnB1c2guYXBwbHkoYSwgYXJncyk7IHZhciBDb25zdHJ1Y3RvciA9IEZ1bmN0aW9uLmJpbmQuYXBwbHkoUGFyZW50LCBhKTsgdmFyIGluc3RhbmNlID0gbmV3IENvbnN0cnVjdG9yKCk7IGlmIChDbGFzcykgX3NldFByb3RvdHlwZU9mKGluc3RhbmNlLCBDbGFzcy5wcm90b3R5cGUpOyByZXR1cm4gaW5zdGFuY2U7IH07IH0gcmV0dXJuIF9jb25zdHJ1Y3QuYXBwbHkobnVsbCwgYXJndW1lbnRzKTsgfQ0KICAgIGZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7IGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7IGlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7IGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOyB0cnkgeyBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHsgfSkpOyByZXR1cm4gdHJ1ZTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH0gfQ0KICAgIGZ1bmN0aW9uIF9pc05hdGl2ZUZ1bmN0aW9uKGZuKSB7IHJldHVybiBGdW5jdGlvbi50b1N0cmluZy5jYWxsKGZuKS5pbmRleE9mKCJbbmF0aXZlIGNvZGVdIikgIT09IC0xOyB9DQogICAgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0NCiAgICBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9DQogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICAgICAgdmFsdWU6IHRydWUNCiAgICB9KTsNCiAgICBleHBvcnRzLlBhcnNpbmdFcnJvciA9IHZvaWQgMDsNCiAgICB2YXIgUGFyc2luZ0Vycm9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfRXJyb3IpIHsNCiAgICAgIF9pbmhlcml0cyhQYXJzaW5nRXJyb3IsIF9FcnJvcik7DQogICAgICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKFBhcnNpbmdFcnJvcik7DQogICAgICBmdW5jdGlvbiBQYXJzaW5nRXJyb3IobWVzc2FnZSwgY2F1c2UpIHsNCiAgICAgICAgdmFyIF90aGlzOw0KICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGFyc2luZ0Vycm9yKTsNCiAgICAgICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKTsNCiAgICAgICAgX3RoaXMuY2F1c2UgPSBjYXVzZTsNCiAgICAgICAgcmV0dXJuIF90aGlzOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIFBhcnNpbmdFcnJvcjsNCg0KICAgIH0oIC8qI19fUFVSRV9fKi9fd3JhcE5hdGl2ZVN1cGVyKEVycm9yKSk7DQogICAgZXhwb3J0cy5QYXJzaW5nRXJyb3IgPSBQYXJzaW5nRXJyb3I7DQogICAgdmFyIHBhcnNpbmdTdGF0ZTsNCg0KICAgIGZ1bmN0aW9uIG5leHRDaGlsZCgpIHsNCiAgICAgIHJldHVybiBlbGVtZW50KGZhbHNlKSB8fCB0ZXh0KCkgfHwgY29tbWVudCgpIHx8IGNkYXRhKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gbmV4dFJvb3RDaGlsZCgpIHsNCiAgICAgIG1hdGNoKC9ccyovKTsNCiAgICAgIHJldHVybiBlbGVtZW50KHRydWUpIHx8IGNvbW1lbnQoKSB8fCBkb2N0eXBlKCkgfHwgcHJvY2Vzc2luZ0luc3RydWN0aW9uKGZhbHNlKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwYXJzZURvY3VtZW50KCkgew0KICAgICAgdmFyIGRlY2xhcmF0aW9uID0gcHJvY2Vzc2luZ0luc3RydWN0aW9uKHRydWUpOw0KICAgICAgdmFyIGNoaWxkcmVuID0gW107DQogICAgICB2YXIgZG9jdW1lbnRSb290Tm9kZTsNCiAgICAgIHZhciBjaGlsZCA9IG5leHRSb290Q2hpbGQoKTsNCiAgICAgIHdoaWxlIChjaGlsZCkgew0KICAgICAgICBpZiAoY2hpbGQubm9kZS50eXBlID09PSAnRWxlbWVudCcpIHsNCiAgICAgICAgICBpZiAoZG9jdW1lbnRSb290Tm9kZSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGb3VuZCBtdWx0aXBsZSByb290IG5vZGVzJyk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGRvY3VtZW50Um9vdE5vZGUgPSBjaGlsZC5ub2RlOw0KICAgICAgICB9DQogICAgICAgIGlmICghY2hpbGQuZXhjbHVkZWQpIHsNCiAgICAgICAgICBjaGlsZHJlbi5wdXNoKGNoaWxkLm5vZGUpOw0KICAgICAgICB9DQogICAgICAgIGNoaWxkID0gbmV4dFJvb3RDaGlsZCgpOw0KICAgICAgfQ0KICAgICAgaWYgKCFkb2N1bWVudFJvb3ROb2RlKSB7DQogICAgICAgIHRocm93IG5ldyBQYXJzaW5nRXJyb3IoJ0ZhaWxlZCB0byBwYXJzZSBYTUwnLCAnUm9vdCBFbGVtZW50IG5vdCBmb3VuZCcpOw0KICAgICAgfQ0KICAgICAgaWYgKHBhcnNpbmdTdGF0ZS54bWwubGVuZ3RoICE9PSAwKSB7DQogICAgICAgIHRocm93IG5ldyBQYXJzaW5nRXJyb3IoJ0ZhaWxlZCB0byBwYXJzZSBYTUwnLCAnTm90IFdlbGwtRm9ybWVkIFhNTCcpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgZGVjbGFyYXRpb246IGRlY2xhcmF0aW9uID8gZGVjbGFyYXRpb24ubm9kZSA6IG51bGwsDQogICAgICAgIHJvb3Q6IGRvY3VtZW50Um9vdE5vZGUsDQogICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbg0KICAgICAgfTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwcm9jZXNzaW5nSW5zdHJ1Y3Rpb24obWF0Y2hEZWNsYXJhdGlvbikgew0KICAgICAgdmFyIG0gPSBtYXRjaERlY2xhcmF0aW9uID8gbWF0Y2goL148XD8oeG1sKVxzKi8pIDogbWF0Y2goL148XD8oW1x3LTouXSspXHMqLyk7DQogICAgICBpZiAoIW0pIHJldHVybjsNCiAgICAgIC8vIHRhZw0KICAgICAgdmFyIG5vZGUgPSB7DQogICAgICAgIG5hbWU6IG1bMV0sDQogICAgICAgIHR5cGU6ICdQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24nLA0KICAgICAgICBhdHRyaWJ1dGVzOiB7fQ0KICAgICAgfTsNCiAgICAgIC8vIGF0dHJpYnV0ZXMNCiAgICAgIHdoaWxlICghKGVvcygpIHx8IGlzKCc/PicpKSkgew0KICAgICAgICB2YXIgYXR0ciA9IGF0dHJpYnV0ZSgpOw0KICAgICAgICBpZiAoYXR0cikgew0KICAgICAgICAgIG5vZGUuYXR0cmlidXRlc1thdHRyLm5hbWVdID0gYXR0ci52YWx1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIG1hdGNoKC9cPz4vKTsNCiAgICAgIHJldHVybiB7DQogICAgICAgIGV4Y2x1ZGVkOiBtYXRjaERlY2xhcmF0aW9uID8gZmFsc2UgOiBwYXJzaW5nU3RhdGUub3B0aW9ucy5maWx0ZXIobm9kZSkgPT09IGZhbHNlLA0KICAgICAgICBub2RlOiBub2RlDQogICAgICB9Ow0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGVsZW1lbnQobWF0Y2hSb290KSB7DQogICAgICB2YXIgbSA9IG1hdGNoKC9ePChbXj8hPC8+XHNdKylccyovKTsNCiAgICAgIGlmICghbSkgcmV0dXJuOw0KICAgICAgLy8gbmFtZQ0KICAgICAgdmFyIG5vZGUgPSB7DQogICAgICAgIHR5cGU6ICdFbGVtZW50JywNCiAgICAgICAgbmFtZTogbVsxXSwNCiAgICAgICAgYXR0cmlidXRlczoge30sDQogICAgICAgIGNoaWxkcmVuOiBbXQ0KICAgICAgfTsNCiAgICAgIHZhciBleGNsdWRlZCA9IG1hdGNoUm9vdCA/IGZhbHNlIDogcGFyc2luZ1N0YXRlLm9wdGlvbnMuZmlsdGVyKG5vZGUpID09PSBmYWxzZTsNCiAgICAgIC8vIGF0dHJpYnV0ZXMNCiAgICAgIHdoaWxlICghKGVvcygpIHx8IGlzKCc+JykgfHwgaXMoJz8+JykgfHwgaXMoJy8+JykpKSB7DQogICAgICAgIHZhciBhdHRyID0gYXR0cmlidXRlKCk7DQogICAgICAgIGlmIChhdHRyKSB7DQogICAgICAgICAgbm9kZS5hdHRyaWJ1dGVzW2F0dHIubmFtZV0gPSBhdHRyLnZhbHVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLy8gc2VsZiBjbG9zaW5nIHRhZw0KICAgICAgaWYgKG1hdGNoKC9eXHMqXC8+LykpIHsNCiAgICAgICAgbm9kZS5jaGlsZHJlbiA9IG51bGw7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgZXhjbHVkZWQ6IGV4Y2x1ZGVkLA0KICAgICAgICAgIG5vZGU6IG5vZGUNCiAgICAgICAgfTsNCiAgICAgIH0NCiAgICAgIG1hdGNoKC9cPz8+Lyk7DQogICAgICAvLyBjaGlsZHJlbg0KICAgICAgdmFyIGNoaWxkID0gbmV4dENoaWxkKCk7DQogICAgICB3aGlsZSAoY2hpbGQpIHsNCiAgICAgICAgaWYgKCFjaGlsZC5leGNsdWRlZCkgew0KICAgICAgICAgIG5vZGUuY2hpbGRyZW4ucHVzaChjaGlsZC5ub2RlKTsNCiAgICAgICAgfQ0KICAgICAgICBjaGlsZCA9IG5leHRDaGlsZCgpOw0KICAgICAgfQ0KICAgICAgLy8gY2xvc2luZw0KICAgICAgaWYgKHBhcnNpbmdTdGF0ZS5vcHRpb25zLnN0cmljdE1vZGUpIHsNCiAgICAgICAgdmFyIGNsb3NpbmdUYWcgPSAiPC8iLmNvbmNhdChub2RlLm5hbWUsICI+Iik7DQogICAgICAgIGlmIChwYXJzaW5nU3RhdGUueG1sLnN0YXJ0c1dpdGgoY2xvc2luZ1RhZykpIHsNCiAgICAgICAgICBwYXJzaW5nU3RhdGUueG1sID0gcGFyc2luZ1N0YXRlLnhtbC5zbGljZShjbG9zaW5nVGFnLmxlbmd0aCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhyb3cgbmV3IFBhcnNpbmdFcnJvcignRmFpbGVkIHRvIHBhcnNlIFhNTCcsICJDbG9zaW5nIHRhZyBub3QgbWF0Y2hpbmcgXCIiLmNvbmNhdChjbG9zaW5nVGFnLCAiXCIiKSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIG1hdGNoKC9ePFwvXHMqW1x3LTouXHUwMEMwLVx1MDBGRl0rPi8pOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgZXhjbHVkZWQ6IGV4Y2x1ZGVkLA0KICAgICAgICBub2RlOiBub2RlDQogICAgICB9Ow0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGRvY3R5cGUoKSB7DQogICAgICB2YXIgbSA9IG1hdGNoKC9ePCFET0NUWVBFXHMrXFMrXHMrU1lTVEVNW14+XSo+LykgfHwgbWF0Y2goL148IURPQ1RZUEVccytcUytccytQVUJMSUNbXj5dKj4vKSB8fCBtYXRjaCgvXjwhRE9DVFlQRVxzK1xTK1xzK1xbW15cXV0qXT4vKTsNCiAgICAgIGlmIChtKSB7DQogICAgICAgIHZhciBub2RlID0gew0KICAgICAgICAgIHR5cGU6ICdEb2N1bWVudFR5cGUnLA0KICAgICAgICAgIGNvbnRlbnQ6IG1bMF0NCiAgICAgICAgfTsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICBleGNsdWRlZDogcGFyc2luZ1N0YXRlLm9wdGlvbnMuZmlsdGVyKG5vZGUpID09PSBmYWxzZSwNCiAgICAgICAgICBub2RlOiBub2RlDQogICAgICAgIH07DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2RhdGEoKSB7DQogICAgICBpZiAocGFyc2luZ1N0YXRlLnhtbC5zdGFydHNXaXRoKCc8IVtDREFUQVsnKSkgew0KICAgICAgICB2YXIgZW5kUG9zaXRpb25TdGFydCA9IHBhcnNpbmdTdGF0ZS54bWwuaW5kZXhPZignXV0+Jyk7DQogICAgICAgIGlmIChlbmRQb3NpdGlvblN0YXJ0ID4gLTEpIHsNCiAgICAgICAgICB2YXIgZW5kUG9zaXRpb25GaW5pc2ggPSBlbmRQb3NpdGlvblN0YXJ0ICsgMzsNCiAgICAgICAgICB2YXIgbm9kZSA9IHsNCiAgICAgICAgICAgIHR5cGU6ICdDREFUQScsDQogICAgICAgICAgICBjb250ZW50OiBwYXJzaW5nU3RhdGUueG1sLnN1YnN0cmluZygwLCBlbmRQb3NpdGlvbkZpbmlzaCkNCiAgICAgICAgICB9Ow0KICAgICAgICAgIHBhcnNpbmdTdGF0ZS54bWwgPSBwYXJzaW5nU3RhdGUueG1sLnNsaWNlKGVuZFBvc2l0aW9uRmluaXNoKTsNCiAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgZXhjbHVkZWQ6IHBhcnNpbmdTdGF0ZS5vcHRpb25zLmZpbHRlcihub2RlKSA9PT0gZmFsc2UsDQogICAgICAgICAgICBub2RlOiBub2RlDQogICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNvbW1lbnQoKSB7DQogICAgICB2YXIgbSA9IG1hdGNoKC9ePCEtLVtcc1xTXSo/LS0+Lyk7DQogICAgICBpZiAobSkgew0KICAgICAgICB2YXIgbm9kZSA9IHsNCiAgICAgICAgICB0eXBlOiAnQ29tbWVudCcsDQogICAgICAgICAgY29udGVudDogbVswXQ0KICAgICAgICB9Ow0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgIGV4Y2x1ZGVkOiBwYXJzaW5nU3RhdGUub3B0aW9ucy5maWx0ZXIobm9kZSkgPT09IGZhbHNlLA0KICAgICAgICAgIG5vZGU6IG5vZGUNCiAgICAgICAgfTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0ZXh0KCkgew0KICAgICAgdmFyIG0gPSBtYXRjaCgvXihbXjxdKykvKTsNCiAgICAgIGlmIChtKSB7DQogICAgICAgIHZhciBub2RlID0gew0KICAgICAgICAgIHR5cGU6ICdUZXh0JywNCiAgICAgICAgICBjb250ZW50OiBtWzFdDQogICAgICAgIH07DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgZXhjbHVkZWQ6IHBhcnNpbmdTdGF0ZS5vcHRpb25zLmZpbHRlcihub2RlKSA9PT0gZmFsc2UsDQogICAgICAgICAgbm9kZTogbm9kZQ0KICAgICAgICB9Ow0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGF0dHJpYnV0ZSgpIHsNCiAgICAgIHZhciBtID0gbWF0Y2goLyhbXj1dKylccyo9XHMqKCJbXiJdKiJ8J1teJ10qJ3xbXj5cc10rKVxzKi8pOw0KICAgICAgaWYgKG0pIHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICBuYW1lOiBtWzFdLnRyaW0oKSwNCiAgICAgICAgICB2YWx1ZTogc3RyaXBRdW90ZXMobVsyXS50cmltKCkpDQogICAgICAgIH07DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc3RyaXBRdW90ZXModmFsKSB7DQogICAgICByZXR1cm4gdmFsLnJlcGxhY2UoL15bJyJdfFsnIl0kL2csICcnKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBNYXRjaCBgcmVgIGFuZCBhZHZhbmNlIHRoZSBzdHJpbmcuDQogICAgICovDQogICAgZnVuY3Rpb24gbWF0Y2gocmUpIHsNCiAgICAgIHZhciBtID0gcGFyc2luZ1N0YXRlLnhtbC5tYXRjaChyZSk7DQogICAgICBpZiAobSkgew0KICAgICAgICBwYXJzaW5nU3RhdGUueG1sID0gcGFyc2luZ1N0YXRlLnhtbC5zbGljZShtWzBdLmxlbmd0aCk7DQogICAgICAgIHJldHVybiBtOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEVuZC1vZi1zb3VyY2UuDQogICAgICovDQogICAgZnVuY3Rpb24gZW9zKCkgew0KICAgICAgcmV0dXJuIDAgPT09IHBhcnNpbmdTdGF0ZS54bWwubGVuZ3RoOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrIGZvciBgcHJlZml4YC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpcyhwcmVmaXgpIHsNCiAgICAgIHJldHVybiAwID09PSBwYXJzaW5nU3RhdGUueG1sLmluZGV4T2YocHJlZml4KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBQYXJzZSB0aGUgZ2l2ZW4gWE1MIHN0cmluZyBpbnRvIGFuIG9iamVjdC4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBwYXJzZVhtbCh4bWwpIHsNCiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsNCiAgICAgIHhtbCA9IHhtbC50cmltKCk7DQogICAgICB2YXIgZmlsdGVyID0gb3B0aW9ucy5maWx0ZXIgfHwgZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH07DQogICAgICBwYXJzaW5nU3RhdGUgPSB7DQogICAgICAgIHhtbDogeG1sLA0KICAgICAgICBvcHRpb25zOiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpLCB7DQogICAgICAgICAgZmlsdGVyOiBmaWx0ZXIsDQogICAgICAgICAgc3RyaWN0TW9kZTogb3B0aW9ucy5zdHJpY3RNb2RlID09PSB0cnVlDQogICAgICAgIH0pDQogICAgICB9Ow0KICAgICAgcmV0dXJuIHBhcnNlRG9jdW1lbnQoKTsNCiAgICB9DQogICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmICh0eXBlb2YgZXhwb3J0cyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZXhwb3J0cykpID09PSAnb2JqZWN0Jykgew0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJzZVhtbDsNCiAgICB9DQogICAgZXhwb3J0c1siZGVmYXVsdCJdID0gcGFyc2VYbWw7DQogIH0sIHt9XSwgInhtbC1mb3JtYXR0ZXIiOiBbZnVuY3Rpb24gKHJlcXVpcmUsIG1vZHVsZSwgZXhwb3J0cykgew0KICAgICJ1c2Ugc3RyaWN0IjsNCg0KICAgIGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7ICJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07IH0gcmV0dXJuIF90eXBlb2Yob2JqKTsgfQ0KICAgIHZhciBfX2ltcG9ydERlZmF1bHQgPSB2b2lkIDAgJiYgKHZvaWQgMCkuX19pbXBvcnREZWZhdWx0IHx8IGZ1bmN0aW9uIChtb2QpIHsNCiAgICAgIHJldHVybiBtb2QgJiYgbW9kLl9fZXNNb2R1bGUgPyBtb2QgOiB7DQogICAgICAgICJkZWZhdWx0IjogbW9kDQogICAgICB9Ow0KICAgIH07DQogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICAgICAgdmFsdWU6IHRydWUNCiAgICB9KTsNCiAgICB2YXIgeG1sX3BhcnNlcl94b18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoInhtbC1wYXJzZXIteG8iKSk7DQoNCiAgICBmdW5jdGlvbiBuZXdMaW5lKHN0YXRlKSB7DQogICAgICBpZiAoIXN0YXRlLm9wdGlvbnMuaW5kZW50YXRpb24gJiYgIXN0YXRlLm9wdGlvbnMubGluZVNlcGFyYXRvcikgcmV0dXJuOw0KICAgICAgc3RhdGUuY29udGVudCArPSBzdGF0ZS5vcHRpb25zLmxpbmVTZXBhcmF0b3I7DQogICAgICB2YXIgaTsNCiAgICAgIGZvciAoaSA9IDA7IGkgPCBzdGF0ZS5sZXZlbDsgaSsrKSB7DQogICAgICAgIHN0YXRlLmNvbnRlbnQgKz0gc3RhdGUub3B0aW9ucy5pbmRlbnRhdGlvbjsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBpbmRlbnQoc3RhdGUpIHsNCiAgICAgIHN0YXRlLmNvbnRlbnQgPSBzdGF0ZS5jb250ZW50LnJlcGxhY2UoLyArJC8sICcnKTsNCiAgICAgIHZhciBpOw0KICAgICAgZm9yIChpID0gMDsgaSA8IHN0YXRlLmxldmVsOyBpKyspIHsNCiAgICAgICAgc3RhdGUuY29udGVudCArPSBzdGF0ZS5vcHRpb25zLmluZGVudGF0aW9uOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFwcGVuZENvbnRlbnQoc3RhdGUsIGNvbnRlbnQpIHsNCiAgICAgIHN0YXRlLmNvbnRlbnQgKz0gY29udGVudDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwcm9jZXNzTm9kZShub2RlLCBzdGF0ZSwgcHJlc2VydmVTcGFjZSkgew0KICAgICAgaWYgKHR5cGVvZiBub2RlLmNvbnRlbnQgPT09ICdzdHJpbmcnKSB7DQogICAgICAgIHByb2Nlc3NDb250ZW50KG5vZGUuY29udGVudCwgc3RhdGUsIHByZXNlcnZlU3BhY2UpOw0KICAgICAgfSBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdFbGVtZW50Jykgew0KICAgICAgICBwcm9jZXNzRWxlbWVudE5vZGUobm9kZSwgc3RhdGUsIHByZXNlcnZlU3BhY2UpOw0KICAgICAgfSBlbHNlIGlmIChub2RlLnR5cGUgPT09ICdQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24nKSB7DQogICAgICAgIHByb2Nlc3NQcm9jZXNzaW5nSW50cnVjdGlvbihub2RlLCBzdGF0ZSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gbm9kZSB0eXBlOiAnICsgbm9kZS50eXBlKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwcm9jZXNzQ29udGVudChjb250ZW50LCBzdGF0ZSwgcHJlc2VydmVTcGFjZSkgew0KICAgICAgaWYgKCFwcmVzZXJ2ZVNwYWNlKSB7DQogICAgICAgIHZhciB0cmltbWVkQ29udGVudCA9IGNvbnRlbnQudHJpbSgpOw0KICAgICAgICBpZiAoc3RhdGUub3B0aW9ucy5saW5lU2VwYXJhdG9yKSB7DQogICAgICAgICAgY29udGVudCA9IHRyaW1tZWRDb250ZW50Ow0KICAgICAgICB9IGVsc2UgaWYgKHRyaW1tZWRDb250ZW50Lmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgIGNvbnRlbnQgPSB0cmltbWVkQ29udGVudDsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKGNvbnRlbnQubGVuZ3RoID4gMCkgew0KICAgICAgICBpZiAoIXByZXNlcnZlU3BhY2UgJiYgc3RhdGUuY29udGVudC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgbmV3TGluZShzdGF0ZSk7DQogICAgICAgIH0NCiAgICAgICAgYXBwZW5kQ29udGVudChzdGF0ZSwgY29udGVudCk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gaXNQYXRoTWF0Y2hpbmdJZ25vcmVkUGF0aHMocGF0aCwgaWdub3JlZFBhdGhzKSB7DQogICAgICB2YXIgZnVsbFBhdGggPSAnLycgKyBwYXRoLmpvaW4oJy8nKTsNCiAgICAgIHZhciBwYXRoTGFzdFBhcnQgPSBwYXRoW3BhdGgubGVuZ3RoIC0gMV07DQogICAgICByZXR1cm4gaWdub3JlZFBhdGhzLmluY2x1ZGVzKHBhdGhMYXN0UGFydCkgfHwgaWdub3JlZFBhdGhzLmluY2x1ZGVzKGZ1bGxQYXRoKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwcm9jZXNzRWxlbWVudE5vZGUobm9kZSwgc3RhdGUsIHByZXNlcnZlU3BhY2UpIHsNCiAgICAgIHN0YXRlLnBhdGgucHVzaChub2RlLm5hbWUpOw0KICAgICAgaWYgKCFwcmVzZXJ2ZVNwYWNlICYmIHN0YXRlLmNvbnRlbnQubGVuZ3RoID4gMCkgew0KICAgICAgICBuZXdMaW5lKHN0YXRlKTsNCiAgICAgIH0NCiAgICAgIGFwcGVuZENvbnRlbnQoc3RhdGUsICc8JyArIG5vZGUubmFtZSk7DQogICAgICBwcm9jZXNzQXR0cmlidXRlcyhzdGF0ZSwgbm9kZS5hdHRyaWJ1dGVzKTsNCiAgICAgIGlmIChub2RlLmNoaWxkcmVuID09PSBudWxsIHx8IHN0YXRlLm9wdGlvbnMuZm9yY2VTZWxmQ2xvc2luZ0VtcHR5VGFnICYmIG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7DQogICAgICAgIHZhciBzZWxmQ2xvc2luZ05vZGVDbG9zaW5nVGFnID0gc3RhdGUub3B0aW9ucy53aGl0ZVNwYWNlQXRFbmRPZlNlbGZjbG9zaW5nVGFnID8gJyAvPicgOiAnLz4nOw0KICAgICAgICAvLyBzZWxmLWNsb3Npbmcgbm9kZQ0KICAgICAgICBhcHBlbmRDb250ZW50KHN0YXRlLCBzZWxmQ2xvc2luZ05vZGVDbG9zaW5nVGFnKTsNCiAgICAgIH0gZWxzZSBpZiAobm9kZS5jaGlsZHJlbi5sZW5ndGggPT09IDApIHsNCiAgICAgICAgLy8gZW1wdHkgbm9kZQ0KICAgICAgICBhcHBlbmRDb250ZW50KHN0YXRlLCAnPjwvJyArIG5vZGUubmFtZSArICc+Jyk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB2YXIgbm9kZUNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjsNCiAgICAgICAgYXBwZW5kQ29udGVudChzdGF0ZSwgJz4nKTsNCiAgICAgICAgc3RhdGUubGV2ZWwrKzsNCiAgICAgICAgdmFyIG5vZGVQcmVzZXJ2ZVNwYWNlID0gbm9kZS5hdHRyaWJ1dGVzWyd4bWw6c3BhY2UnXSA9PT0gJ3ByZXNlcnZlJzsNCiAgICAgICAgdmFyIGlnbm9yZWRQYXRoID0gZmFsc2U7DQogICAgICAgIGlmICghbm9kZVByZXNlcnZlU3BhY2UgJiYgc3RhdGUub3B0aW9ucy5pZ25vcmVkUGF0aHMpIHsNCiAgICAgICAgICBpZ25vcmVkUGF0aCA9IGlzUGF0aE1hdGNoaW5nSWdub3JlZFBhdGhzKHN0YXRlLnBhdGgsIHN0YXRlLm9wdGlvbnMuaWdub3JlZFBhdGhzKTsNCiAgICAgICAgICBub2RlUHJlc2VydmVTcGFjZSA9IGlnbm9yZWRQYXRoOw0KICAgICAgICB9DQogICAgICAgIGlmICghbm9kZVByZXNlcnZlU3BhY2UgJiYgc3RhdGUub3B0aW9ucy5jb2xsYXBzZUNvbnRlbnQpIHsNCiAgICAgICAgICB2YXIgY29udGFpbnNUZXh0Tm9kZXMgPSBmYWxzZTsNCiAgICAgICAgICB2YXIgY29udGFpbnNUZXh0Tm9kZXNXaXRoTGluZUJyZWFrcyA9IGZhbHNlOw0KICAgICAgICAgIHZhciBjb250YWluc05vblRleHROb2RlcyA9IGZhbHNlOw0KICAgICAgICAgIG5vZGVDaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCwgaW5kZXgpIHsNCiAgICAgICAgICAgIGlmIChjaGlsZC50eXBlID09PSAnVGV4dCcpIHsNCiAgICAgICAgICAgICAgaWYgKGNoaWxkLmNvbnRlbnQuaW5jbHVkZXMoJ1xuJykpIHsNCiAgICAgICAgICAgICAgICBjb250YWluc1RleHROb2Rlc1dpdGhMaW5lQnJlYWtzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBjaGlsZC5jb250ZW50ID0gY2hpbGQuY29udGVudC50cmltKCk7DQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoKGluZGV4ID09PSAwIHx8IGluZGV4ID09PSBub2RlQ2hpbGRyZW4ubGVuZ3RoIC0gMSkgJiYgIXByZXNlcnZlU3BhY2UpIHsNCiAgICAgICAgICAgICAgICBpZiAoY2hpbGQuY29udGVudC50cmltKCkubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgdGV4dCBub2RlIGlzIGF0IHRoZSBzdGFydCBvciBlbmQgYW5kIGlzIGVtcHR5LCBpdCBzaG91bGQgYmUgaWdub3JlZCB3aGVuIGZvcm1hdHRpbmcNCiAgICAgICAgICAgICAgICAgIGNoaWxkLmNvbnRlbnQgPSAnJzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGNoaWxkLmNvbnRlbnQudHJpbSgpLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBjb250YWluc1RleHROb2RlcyA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hpbGQudHlwZSA9PT0gJ0NEQVRBJykgew0KICAgICAgICAgICAgICBjb250YWluc1RleHROb2RlcyA9IHRydWU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBjb250YWluc05vblRleHROb2RlcyA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgICAgaWYgKGNvbnRhaW5zVGV4dE5vZGVzICYmICghY29udGFpbnNOb25UZXh0Tm9kZXMgfHwgIWNvbnRhaW5zVGV4dE5vZGVzV2l0aExpbmVCcmVha3MpKSB7DQogICAgICAgICAgICBub2RlUHJlc2VydmVTcGFjZSA9IHRydWU7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIG5vZGVDaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkgew0KICAgICAgICAgIHByb2Nlc3NOb2RlKGNoaWxkLCBzdGF0ZSwgcHJlc2VydmVTcGFjZSB8fCBub2RlUHJlc2VydmVTcGFjZSk7DQogICAgICAgIH0pOw0KICAgICAgICBzdGF0ZS5sZXZlbC0tOw0KICAgICAgICBpZiAoIXByZXNlcnZlU3BhY2UgJiYgIW5vZGVQcmVzZXJ2ZVNwYWNlKSB7DQogICAgICAgICAgbmV3TGluZShzdGF0ZSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlnbm9yZWRQYXRoKSB7DQogICAgICAgICAgaW5kZW50KHN0YXRlKTsNCiAgICAgICAgfQ0KICAgICAgICBhcHBlbmRDb250ZW50KHN0YXRlLCAnPC8nICsgbm9kZS5uYW1lICsgJz4nKTsNCiAgICAgIH0NCiAgICAgIHN0YXRlLnBhdGgucG9wKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcHJvY2Vzc0F0dHJpYnV0ZXMoc3RhdGUsIGF0dHJpYnV0ZXMpIHsNCiAgICAgIE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLmZvckVhY2goZnVuY3Rpb24gKGF0dHIpIHsNCiAgICAgICAgdmFyIGVzY2FwZWQgPSBhdHRyaWJ1dGVzW2F0dHJdLnJlcGxhY2UoLyIvZywgJyZxdW90OycpOw0KICAgICAgICBhcHBlbmRDb250ZW50KHN0YXRlLCAnICcgKyBhdHRyICsgJz0iJyArIGVzY2FwZWQgKyAnIicpOw0KICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcHJvY2Vzc1Byb2Nlc3NpbmdJbnRydWN0aW9uKG5vZGUsIHN0YXRlKSB7DQogICAgICBpZiAoc3RhdGUuY29udGVudC5sZW5ndGggPiAwKSB7DQogICAgICAgIG5ld0xpbmUoc3RhdGUpOw0KICAgICAgfQ0KICAgICAgYXBwZW5kQ29udGVudChzdGF0ZSwgJzw/JyArIG5vZGUubmFtZSk7DQogICAgICBwcm9jZXNzQXR0cmlidXRlcyhzdGF0ZSwgbm9kZS5hdHRyaWJ1dGVzKTsNCiAgICAgIGFwcGVuZENvbnRlbnQoc3RhdGUsICc/PicpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENvbnZlcnRzIHRoZSBnaXZlbiBYTUwgaW50byBodW1hbiByZWFkYWJsZSBmb3JtYXQuDQogICAgICovDQogICAgZnVuY3Rpb24gZm9ybWF0WG1sKHhtbCkgew0KICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9Ow0KICAgICAgb3B0aW9ucy5pbmRlbnRhdGlvbiA9ICdpbmRlbnRhdGlvbicgaW4gb3B0aW9ucyA/IG9wdGlvbnMuaW5kZW50YXRpb24gOiAnICAgICc7DQogICAgICBvcHRpb25zLmNvbGxhcHNlQ29udGVudCA9IG9wdGlvbnMuY29sbGFwc2VDb250ZW50ID09PSB0cnVlOw0KICAgICAgb3B0aW9ucy5saW5lU2VwYXJhdG9yID0gJ2xpbmVTZXBhcmF0b3InIGluIG9wdGlvbnMgPyBvcHRpb25zLmxpbmVTZXBhcmF0b3IgOiAnXHJcbic7DQogICAgICBvcHRpb25zLndoaXRlU3BhY2VBdEVuZE9mU2VsZmNsb3NpbmdUYWcgPSBvcHRpb25zLndoaXRlU3BhY2VBdEVuZE9mU2VsZmNsb3NpbmdUYWcgPT09IHRydWU7DQogICAgICBvcHRpb25zLnRocm93T25GYWlsdXJlID0gb3B0aW9ucy50aHJvd09uRmFpbHVyZSAhPT0gZmFsc2U7DQogICAgICB0cnkgew0KICAgICAgICB2YXIgcGFyc2VkWG1sID0gKDAsIHhtbF9wYXJzZXJfeG9fMVsiZGVmYXVsdCJdKSh4bWwsIHsNCiAgICAgICAgICBmaWx0ZXI6IG9wdGlvbnMuZmlsdGVyLA0KICAgICAgICAgIHN0cmljdE1vZGU6IG9wdGlvbnMuc3RyaWN0TW9kZQ0KICAgICAgICB9KTsNCiAgICAgICAgdmFyIHN0YXRlID0gew0KICAgICAgICAgIGNvbnRlbnQ6ICcnLA0KICAgICAgICAgIGxldmVsOiAwLA0KICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMsDQogICAgICAgICAgcGF0aDogW10NCiAgICAgICAgfTsNCiAgICAgICAgaWYgKHBhcnNlZFhtbC5kZWNsYXJhdGlvbikgew0KICAgICAgICAgIHByb2Nlc3NQcm9jZXNzaW5nSW50cnVjdGlvbihwYXJzZWRYbWwuZGVjbGFyYXRpb24sIHN0YXRlKTsNCiAgICAgICAgfQ0KICAgICAgICBwYXJzZWRYbWwuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHsNCiAgICAgICAgICBwcm9jZXNzTm9kZShjaGlsZCwgc3RhdGUsIGZhbHNlKTsNCiAgICAgICAgfSk7DQogICAgICAgIGlmICghb3B0aW9ucy5saW5lU2VwYXJhdG9yKSB7DQogICAgICAgICAgcmV0dXJuIHN0YXRlLmNvbnRlbnQ7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHN0YXRlLmNvbnRlbnQucmVwbGFjZSgvXHJcbi9nLCAnXG4nKS5yZXBsYWNlKC9cbi9nLCBvcHRpb25zLmxpbmVTZXBhcmF0b3IpOw0KICAgICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgIGlmIChvcHRpb25zLnRocm93T25GYWlsdXJlKSB7DQogICAgICAgICAgdGhyb3cgZXJyOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB4bWw7DQogICAgICB9DQogICAgfQ0KDQogICAgZm9ybWF0WG1sLm1pbmlmeSA9IGZ1bmN0aW9uICh4bWwpIHsNCiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsNCiAgICAgIHJldHVybiBmb3JtYXRYbWwoeG1sLCBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpLCB7DQogICAgICAgIGluZGVudGF0aW9uOiAnJywNCiAgICAgICAgbGluZVNlcGFyYXRvcjogJycNCiAgICAgIH0pKTsNCiAgICB9Ow0KDQogICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmICh0eXBlb2YgZXhwb3J0cyA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YoZXhwb3J0cykpID09PSAnb2JqZWN0Jykgew0KICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmb3JtYXRYbWw7DQogICAgfQ0KDQogICAgZXhwb3J0c1siZGVmYXVsdCJdID0gZm9ybWF0WG1sOw0KICB9LCB7ICJ4bWwtcGFyc2VyLXhvIjogMSB9XQ0KfSwge30sIFtdKTsNCg0KICA8L3NjcmlwdD4NCiAgPCEtLWh0dHBzOi8vZmxhdHBpY2tyLmpzLm9yZy8tLT4NCiAgPCEtLTxsaW5rIGhyZWY9InN0eWxlc2hlZXRzL2ZsYXRwaWNrci5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+DQogIDxzdHlsZT4NCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyIHsNCiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50Ow0KICAgICAgb3BhY2l0eTogMDsNCiAgICAgIGRpc3BsYXk6IG5vbmU7DQogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICB2aXNpYmlsaXR5OiBoaWRkZW47DQogICAgICBwYWRkaW5nOiAwOw0KICAgICAgLXdlYmtpdC1hbmltYXRpb246IG5vbmU7DQogICAgICBhbmltYXRpb246IG5vbmU7DQogICAgICBkaXJlY3Rpb246IGx0cjsNCiAgICAgIGJvcmRlcjogMDsNCiAgICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICAgIGxpbmUtaGVpZ2h0OiAyNHB4Ow0KICAgICAgYm9yZGVyLXJhZGl1czogNXB4Ow0KICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgICAgd2lkdGg6IDMwNy44NzVweDsNCiAgICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAtbXMtdG91Y2gtYWN0aW9uOiBtYW5pcHVsYXRpb247DQogICAgICB0b3VjaC1hY3Rpb246IG1hbmlwdWxhdGlvbjsNCiAgICAgIGJhY2tncm91bmQ6ICNmZmY7DQogICAgICAtd2Via2l0LWJveC1zaGFkb3c6IDFweCAwIDAgI2U2ZTZlNiwgLTFweCAwIDAgI2U2ZTZlNiwgMCAxcHggMCAjZTZlNmU2LCAwIC0xcHggMCAjZTZlNmU2LCAwIDNweCAxM3B4IHJnYmEoMCwgMCwgMCwgMC4wOCk7DQogICAgICBib3gtc2hhZG93OiAxcHggMCAwICNlNmU2ZTYsIC0xcHggMCAwICNlNmU2ZTYsIDAgMXB4IDAgI2U2ZTZlNiwgMCAtMXB4IDAgI2U2ZTZlNiwgMCAzcHggMTNweCByZ2JhKDAsIDAsIDAsIDAuMDgpOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIub3BlbiwNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmlubGluZSB7DQogICAgICBvcGFjaXR5OiAxOw0KICAgICAgbWF4LWhlaWdodDogNjQwcHg7DQogICAgICB2aXNpYmlsaXR5OiB2aXNpYmxlOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIub3BlbiB7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICB6LWluZGV4OiA5OTk5OTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmFuaW1hdGUub3BlbiB7DQogICAgICAtd2Via2l0LWFuaW1hdGlvbjogZnBGYWRlSW5Eb3duIDMwMG1zIGN1YmljLWJlemllcigwLjIzLCAxLCAwLjMyLCAxKTsNCiAgICAgIGFuaW1hdGlvbjogZnBGYWRlSW5Eb3duIDMwMG1zIGN1YmljLWJlemllcigwLjIzLCAxLCAwLjMyLCAxKTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmlubGluZSB7DQogICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgIHRvcDogMnB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuc3RhdGljIHsNCiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgIHRvcDogY2FsYygxMDAlICsgMnB4KTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLnN0YXRpYy5vcGVuIHsNCiAgICAgIHotaW5kZXg6IDk5OTsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIubXVsdGlNb250aCAuZmxhdHBpY2tyLWRheXMgLmRheUNvbnRhaW5lcjpudGgtY2hpbGQobisxKSAuZmxhdHBpY2tyLWRheS5pblJhbmdlOm50aC1jaGlsZCg3bis3KSB7DQogICAgICAtd2Via2l0LWJveC1zaGFkb3c6IG5vbmUgIWltcG9ydGFudDsNCiAgICAgIGJveC1zaGFkb3c6IG5vbmUgIWltcG9ydGFudDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLm11bHRpTW9udGggLmZsYXRwaWNrci1kYXlzIC5kYXlDb250YWluZXI6bnRoLWNoaWxkKG4rMikgLmZsYXRwaWNrci1kYXkuaW5SYW5nZTpudGgtY2hpbGQoN24rMSkgew0KICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiAtMnB4IDAgMCAjZTZlNmU2LCA1cHggMCAwICNlNmU2ZTY7DQogICAgICBib3gtc2hhZG93OiAtMnB4IDAgMCAjZTZlNmU2LCA1cHggMCAwICNlNmU2ZTY7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhciAuaGFzV2Vla3MgLmRheUNvbnRhaW5lciwNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyIC5oYXNUaW1lIC5kYXlDb250YWluZXIgew0KICAgICAgYm9yZGVyLWJvdHRvbTogMDsNCiAgICAgIGJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiAwOw0KICAgICAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyIC5oYXNXZWVrcyAuZGF5Q29udGFpbmVyIHsNCiAgICAgIGJvcmRlci1sZWZ0OiAwOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuc2hvd1RpbWVJbnB1dC5oYXNUaW1lIC5mbGF0cGlja3ItdGltZSB7DQogICAgICBoZWlnaHQ6IDQwcHg7DQogICAgICBib3JkZXItdG9wOiAxcHggc29saWQgI2U2ZTZlNjsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLm5vQ2FsZW5kYXIuaGFzVGltZSAuZmxhdHBpY2tyLXRpbWUgew0KICAgICAgaGVpZ2h0OiBhdXRvOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXI6YmVmb3JlLA0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXI6YWZ0ZXIgew0KICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICBwb2ludGVyLWV2ZW50czogbm9uZTsNCiAgICAgIGJvcmRlcjogc29saWQgdHJhbnNwYXJlbnQ7DQogICAgICBjb250ZW50OiAnJzsNCiAgICAgIGhlaWdodDogMDsNCiAgICAgIHdpZHRoOiAwOw0KICAgICAgbGVmdDogMjJweDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLnJpZ2h0TW9zdDpiZWZvcmUsDQogICAgLmZsYXRwaWNrci1jYWxlbmRhci5yaWdodE1vc3Q6YWZ0ZXIgew0KICAgICAgbGVmdDogYXV0bzsNCiAgICAgIHJpZ2h0OiAyMnB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXI6YmVmb3JlIHsNCiAgICAgIGJvcmRlci13aWR0aDogNXB4Ow0KICAgICAgbWFyZ2luOiAwIC01cHg7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhcjphZnRlciB7DQogICAgICBib3JkZXItd2lkdGg6IDRweDsNCiAgICAgIG1hcmdpbjogMCAtNHB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dUb3A6YmVmb3JlLA0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dUb3A6YWZ0ZXIgew0KICAgICAgYm90dG9tOiAxMDAlOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dUb3A6YmVmb3JlIHsNCiAgICAgIGJvcmRlci1ib3R0b20tY29sb3I6ICNlNmU2ZTY7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhci5hcnJvd1RvcDphZnRlciB7DQogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjZmZmOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dCb3R0b206YmVmb3JlLA0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dCb3R0b206YWZ0ZXIgew0KICAgICAgdG9wOiAxMDAlOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dCb3R0b206YmVmb3JlIHsNCiAgICAgIGJvcmRlci10b3AtY29sb3I6ICNlNmU2ZTY7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhci5hcnJvd0JvdHRvbTphZnRlciB7DQogICAgICBib3JkZXItdG9wLWNvbG9yOiAjZmZmOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXI6Zm9jdXMgew0KICAgICAgb3V0bGluZTogMDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXdyYXBwZXIgew0KICAgICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItbW9udGhzIHsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtYm94Ow0KICAgICAgZGlzcGxheTogLXdlYmtpdC1mbGV4Ow0KICAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbW9udGggew0KICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7DQogICAgICBjb2xvcjogcmdiYSgwLCAwLCAwLCAwLjkpOw0KICAgICAgZmlsbDogcmdiYSgwLCAwLCAwLCAwLjkpOw0KICAgICAgaGVpZ2h0OiAyOHB4Ow0KICAgICAgbGluZS1oZWlnaHQ6IDE7DQogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOw0KICAgICAgLW1vei11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIC1tcy11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIHVzZXItc2VsZWN0OiBub25lOw0KICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgIC13ZWJraXQtYm94LWZsZXg6IDE7DQogICAgICAtd2Via2l0LWZsZXg6IDE7DQogICAgICAtbXMtZmxleDogMTsNCiAgICAgIGZsZXg6IDE7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1wcmV2LW1vbnRoLA0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aCB7DQogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgICB0b3A6IDBweDsNCiAgICAgIGxpbmUtaGVpZ2h0OiAxNnB4Ow0KICAgICAgaGVpZ2h0OiAyOHB4Ow0KICAgICAgcGFkZGluZzogMTBweDsNCiAgICAgIHotaW5kZXg6IDM7DQogICAgICBjb2xvcjogcmdiYSgwLCAwLCAwLCAwLjkpOw0KICAgICAgZmlsbDogcmdiYSgwLCAwLCAwLCAwLjkpOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItcHJldi1tb250aC5kaXNhYmxlZCwNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLW5leHQtbW9udGguZGlzYWJsZWQgew0KICAgICAgZGlzcGxheTogbm9uZTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGggaSwNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLW5leHQtbW9udGggaSB7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1wcmV2LW1vbnRoLmZsYXRwaWNrci1wcmV2LW1vbnRoLA0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aC5mbGF0cGlja3ItcHJldi1tb250aCB7DQogICAgICAvKg0KICAgICAgLypydGw6YmVnaW46aWdub3JlKi8NCiAgICAgIC8qDQogICAgICAqLw0KICAgICAgbGVmdDogMDsNCiAgICAgIC8qDQogICAgICAvKnJ0bDplbmQ6aWdub3JlKi8NCiAgICAgIC8qDQogICAgICAqLw0KICAgIH0NCg0KICAgIC8qDQogICAgICAvKnJ0bDpiZWdpbjppZ25vcmUqLw0KICAgIC8qDQogICAgICAvKnJ0bDplbmQ6aWdub3JlKi8NCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGguZmxhdHBpY2tyLW5leHQtbW9udGgsDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoLmZsYXRwaWNrci1uZXh0LW1vbnRoIHsNCiAgICAgIC8qDQogICAgICAvKnJ0bDpiZWdpbjppZ25vcmUqLw0KICAgICAgLyoNCiAgICAgICovDQogICAgICByaWdodDogMDsNCiAgICAgIC8qDQogICAgICAvKnJ0bDplbmQ6aWdub3JlKi8NCiAgICAgIC8qDQogICAgICAqLw0KICAgIH0NCg0KICAgIC8qDQogICAgICAvKnJ0bDpiZWdpbjppZ25vcmUqLw0KICAgIC8qDQogICAgICAvKnJ0bDplbmQ6aWdub3JlKi8NCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGg6aG92ZXIsDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoOmhvdmVyIHsNCiAgICAgIGNvbG9yOiAjOTU5ZWE5Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItcHJldi1tb250aDpob3ZlciBzdmcsDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoOmhvdmVyIHN2ZyB7DQogICAgICBmaWxsOiAjZjY0NzQ3Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItcHJldi1tb250aCBzdmcsDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoIHN2ZyB7DQogICAgICB3aWR0aDogMTRweDsNCiAgICAgIGhlaWdodDogMTRweDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGggc3ZnIHBhdGgsDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoIHN2ZyBwYXRoIHsNCiAgICAgIC13ZWJraXQtdHJhbnNpdGlvbjogZmlsbCAwLjFzOw0KICAgICAgdHJhbnNpdGlvbjogZmlsbCAwLjFzOw0KICAgICAgZmlsbDogaW5oZXJpdDsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIHsNCiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgIGhlaWdodDogYXV0bzsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIGlucHV0LA0KICAgIC5udW1JbnB1dFdyYXBwZXIgc3BhbiB7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBpbnB1dCB7DQogICAgICB3aWR0aDogMTAwJTsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIGlucHV0OjotbXMtY2xlYXIgew0KICAgICAgZGlzcGxheTogbm9uZTsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIHNwYW4gew0KICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgICAgcmlnaHQ6IDA7DQogICAgICB3aWR0aDogMTRweDsNCiAgICAgIHBhZGRpbmc6IDAgNHB4IDAgMnB4Ow0KICAgICAgaGVpZ2h0OiA1MCU7DQogICAgICBsaW5lLWhlaWdodDogNTAlOw0KICAgICAgb3BhY2l0eTogMDsNCiAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoNTcsIDU3LCA1NywgMC4xNSk7DQogICAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIH0NCg0KICAgIC5udW1JbnB1dFdyYXBwZXIgc3Bhbjpob3ZlciB7DQogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMSk7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBzcGFuOmFjdGl2ZSB7DQogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMik7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBzcGFuOmFmdGVyIHsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgY29udGVudDogIiI7DQogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93VXAgew0KICAgICAgdG9wOiAwOw0KICAgICAgYm9yZGVyLWJvdHRvbTogMDsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIHNwYW4uYXJyb3dVcDphZnRlciB7DQogICAgICBib3JkZXItbGVmdDogNHB4IHNvbGlkIHRyYW5zcGFyZW50Ow0KICAgICAgYm9yZGVyLXJpZ2h0OiA0cHggc29saWQgdHJhbnNwYXJlbnQ7DQogICAgICBib3JkZXItYm90dG9tOiA0cHggc29saWQgcmdiYSg1NywgNTcsIDU3LCAwLjYpOw0KICAgICAgdG9wOiAyNiU7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93RG93biB7DQogICAgICB0b3A6IDUwJTsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIHNwYW4uYXJyb3dEb3duOmFmdGVyIHsNCiAgICAgIGJvcmRlci1sZWZ0OiA0cHggc29saWQgdHJhbnNwYXJlbnQ7DQogICAgICBib3JkZXItcmlnaHQ6IDRweCBzb2xpZCB0cmFuc3BhcmVudDsNCiAgICAgIGJvcmRlci10b3A6IDRweCBzb2xpZCByZ2JhKDU3LCA1NywgNTcsIDAuNik7DQogICAgICB0b3A6IDQwJTsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIHNwYW4gc3ZnIHsNCiAgICAgIHdpZHRoOiBpbmhlcml0Ow0KICAgICAgaGVpZ2h0OiBhdXRvOw0KICAgIH0NCg0KICAgIC5udW1JbnB1dFdyYXBwZXIgc3BhbiBzdmcgcGF0aCB7DQogICAgICBmaWxsOiByZ2JhKDAsIDAsIDAsIDAuNSk7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlcjpob3ZlciB7DQogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMDUpOw0KICAgIH0NCg0KICAgIC5udW1JbnB1dFdyYXBwZXI6aG92ZXIgc3BhbiB7DQogICAgICBvcGFjaXR5OiAxOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY3VycmVudC1tb250aCB7DQogICAgICBmb250LXNpemU6IDEzNSU7DQogICAgICBsaW5lLWhlaWdodDogaW5oZXJpdDsNCiAgICAgIGZvbnQtd2VpZ2h0OiAzMDA7DQogICAgICBjb2xvcjogaW5oZXJpdDsNCiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgIHdpZHRoOiA3NSU7DQogICAgICBsZWZ0OiAxMi41JTsNCiAgICAgIHBhZGRpbmc6IDYuMTZweCAwIDAgMDsNCiAgICAgIGxpbmUtaGVpZ2h0OiAxOw0KICAgICAgaGVpZ2h0OiAyOHB4Ow0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDBweCwgMHB4LCAwcHgpOw0KICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwcHgsIDBweCwgMHB4KTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggc3Bhbi5jdXItbW9udGggew0KICAgICAgZm9udC1mYW1pbHk6IGluaGVyaXQ7DQogICAgICBmb250LXdlaWdodDogNzAwOw0KICAgICAgY29sb3I6IGluaGVyaXQ7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBtYXJnaW4tbGVmdDogMC41Y2g7DQogICAgICBwYWRkaW5nOiAwOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY3VycmVudC1tb250aCBzcGFuLmN1ci1tb250aDpob3ZlciB7DQogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMDUpOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY3VycmVudC1tb250aCAubnVtSW5wdXRXcmFwcGVyIHsNCiAgICAgIHdpZHRoOiA2Y2g7DQogICAgICB3aWR0aDogN2NoXDA7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jdXJyZW50LW1vbnRoIC5udW1JbnB1dFdyYXBwZXIgc3Bhbi5hcnJvd1VwOmFmdGVyIHsNCiAgICAgIGJvcmRlci1ib3R0b20tY29sb3I6IHJnYmEoMCwgMCwgMCwgMC45KTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93RG93bjphZnRlciB7DQogICAgICBib3JkZXItdG9wLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuOSk7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jdXJyZW50LW1vbnRoIGlucHV0LmN1ci15ZWFyIHsNCiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50Ow0KICAgICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIGNvbG9yOiBpbmhlcml0Ow0KICAgICAgY3Vyc29yOiB0ZXh0Ow0KICAgICAgcGFkZGluZzogMCAwIDAgMC41Y2g7DQogICAgICBtYXJnaW46IDA7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBmb250LXNpemU6IGluaGVyaXQ7DQogICAgICBmb250LWZhbWlseTogaW5oZXJpdDsNCiAgICAgIGZvbnQtd2VpZ2h0OiAzMDA7DQogICAgICBsaW5lLWhlaWdodDogaW5oZXJpdDsNCiAgICAgIGhlaWdodDogYXV0bzsNCiAgICAgIGJvcmRlcjogMDsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDA7DQogICAgICB2ZXJ0aWNhbC1hbGlnbjogaW5pdGlhbDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggaW5wdXQuY3VyLXllYXI6Zm9jdXMgew0KICAgICAgb3V0bGluZTogMDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggaW5wdXQuY3VyLXllYXJbZGlzYWJsZWRdLA0KICAgIC5mbGF0cGlja3ItY3VycmVudC1tb250aCBpbnB1dC5jdXIteWVhcltkaXNhYmxlZF06aG92ZXIgew0KICAgICAgZm9udC1zaXplOiAxMDAlOw0KICAgICAgY29sb3I6IHJnYmEoMCwgMCwgMCwgMC41KTsNCiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50Ow0KICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci13ZWVrZGF5cyB7DQogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICB3aWR0aDogMTAwJTsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtYm94Ow0KICAgICAgZGlzcGxheTogLXdlYmtpdC1mbGV4Ow0KICAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgLXdlYmtpdC1ib3gtYWxpZ246IGNlbnRlcjsNCiAgICAgIC13ZWJraXQtYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgIC1tcy1mbGV4LWFsaWduOiBjZW50ZXI7DQogICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgaGVpZ2h0OiAyOHB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3Itd2Vla2RheXMgLmZsYXRwaWNrci13ZWVrZGF5Y29udGFpbmVyIHsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtYm94Ow0KICAgICAgZGlzcGxheTogLXdlYmtpdC1mbGV4Ow0KICAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgLXdlYmtpdC1ib3gtZmxleDogMTsNCiAgICAgIC13ZWJraXQtZmxleDogMTsNCiAgICAgIC1tcy1mbGV4OiAxOw0KICAgICAgZmxleDogMTsNCiAgICB9DQoNCiAgICBzcGFuLmZsYXRwaWNrci13ZWVrZGF5IHsNCiAgICAgIGN1cnNvcjogZGVmYXVsdDsNCiAgICAgIGZvbnQtc2l6ZTogOTAlOw0KICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7DQogICAgICBjb2xvcjogcmdiYSgwLCAwLCAwLCAwLjU0KTsNCiAgICAgIGxpbmUtaGVpZ2h0OiAxOw0KICAgICAgbWFyZ2luOiAwOw0KICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAtd2Via2l0LWJveC1mbGV4OiAxOw0KICAgICAgLXdlYmtpdC1mbGV4OiAxOw0KICAgICAgLW1zLWZsZXg6IDE7DQogICAgICBmbGV4OiAxOw0KICAgICAgZm9udC13ZWlnaHQ6IGJvbGRlcjsNCiAgICB9DQoNCiAgICAuZGF5Q29udGFpbmVyLA0KICAgIC5mbGF0cGlja3Itd2Vla3Mgew0KICAgICAgcGFkZGluZzogMXB4IDAgMCAwOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5cyB7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgZGlzcGxheTogLXdlYmtpdC1ib3g7DQogICAgICBkaXNwbGF5OiAtd2Via2l0LWZsZXg7DQogICAgICBkaXNwbGF5OiAtbXMtZmxleGJveDsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAtd2Via2l0LWJveC1hbGlnbjogc3RhcnQ7DQogICAgICAtd2Via2l0LWFsaWduLWl0ZW1zOiBmbGV4LXN0YXJ0Ow0KICAgICAgLW1zLWZsZXgtYWxpZ246IHN0YXJ0Ow0KICAgICAgYWxpZ24taXRlbXM6IGZsZXgtc3RhcnQ7DQogICAgICB3aWR0aDogMzA3Ljg3NXB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5czpmb2N1cyB7DQogICAgICBvdXRsaW5lOiAwOw0KICAgIH0NCg0KICAgIC5kYXlDb250YWluZXIgew0KICAgICAgcGFkZGluZzogMDsNCiAgICAgIG91dGxpbmU6IDA7DQogICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgd2lkdGg6IDMwNy44NzVweDsNCiAgICAgIG1pbi13aWR0aDogMzA3Ljg3NXB4Ow0KICAgICAgbWF4LXdpZHRoOiAzMDcuODc1cHg7DQogICAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7DQogICAgICBkaXNwbGF5OiAtd2Via2l0LWJveDsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtZmxleDsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAtd2Via2l0LWZsZXgtd3JhcDogd3JhcDsNCiAgICAgIGZsZXgtd3JhcDogd3JhcDsNCiAgICAgIC1tcy1mbGV4LXdyYXA6IHdyYXA7DQogICAgICAtbXMtZmxleC1wYWNrOiBqdXN0aWZ5Ow0KICAgICAgLXdlYmtpdC1qdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWFyb3VuZDsNCiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYXJvdW5kOw0KICAgICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDBweCwgMHB4LCAwcHgpOw0KICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwcHgsIDBweCwgMHB4KTsNCiAgICAgIG9wYWNpdHk6IDE7DQogICAgfQ0KDQogICAgLmRheUNvbnRhaW5lcisuZGF5Q29udGFpbmVyIHsNCiAgICAgIC13ZWJraXQtYm94LXNoYWRvdzogLTFweCAwIDAgI2U2ZTZlNjsNCiAgICAgIGJveC1zaGFkb3c6IC0xcHggMCAwICNlNmU2ZTY7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkgew0KICAgICAgYmFja2dyb3VuZDogbm9uZTsNCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50Ow0KICAgICAgYm9yZGVyLXJhZGl1czogMTUwcHg7DQogICAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgY29sb3I6ICMzOTM5Mzk7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICBmb250LXdlaWdodDogNDAwOw0KICAgICAgd2lkdGg6IDE0LjI4NTcxNDMlOw0KICAgICAgLXdlYmtpdC1mbGV4LWJhc2lzOiAxNC4yODU3MTQzJTsNCiAgICAgIC1tcy1mbGV4LXByZWZlcnJlZC1zaXplOiAxNC4yODU3MTQzJTsNCiAgICAgIGZsZXgtYmFzaXM6IDE0LjI4NTcxNDMlOw0KICAgICAgbWF4LXdpZHRoOiAzOXB4Ow0KICAgICAgaGVpZ2h0OiAzOXB4Ow0KICAgICAgbGluZS1oZWlnaHQ6IDM5cHg7DQogICAgICBtYXJnaW46IDA7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICAtd2Via2l0LWJveC1wYWNrOiBjZW50ZXI7DQogICAgICAtd2Via2l0LWp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgLW1zLWZsZXgtcGFjazogY2VudGVyOw0KICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuaW5SYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5wcmV2TW9udGhEYXkuaW5SYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5uZXh0TW9udGhEYXkuaW5SYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS50b2RheS5pblJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5LnByZXZNb250aERheS50b2RheS5pblJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5Lm5leHRNb250aERheS50b2RheS5pblJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5OmhvdmVyLA0KICAgIC5mbGF0cGlja3ItZGF5LnByZXZNb250aERheTpob3ZlciwNCiAgICAuZmxhdHBpY2tyLWRheS5uZXh0TW9udGhEYXk6aG92ZXIsDQogICAgLmZsYXRwaWNrci1kYXk6Zm9jdXMsDQogICAgLmZsYXRwaWNrci1kYXkucHJldk1vbnRoRGF5OmZvY3VzLA0KICAgIC5mbGF0cGlja3ItZGF5Lm5leHRNb250aERheTpmb2N1cyB7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICBvdXRsaW5lOiAwOw0KICAgICAgYmFja2dyb3VuZDogI2U2ZTZlNjsNCiAgICAgIGJvcmRlci1jb2xvcjogI2U2ZTZlNjsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWRheS50b2RheSB7DQogICAgICBib3JkZXItY29sb3I6ICM5NTllYTk7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkudG9kYXk6aG92ZXIsDQogICAgLmZsYXRwaWNrci1kYXkudG9kYXk6Zm9jdXMgew0KICAgICAgYm9yZGVyLWNvbG9yOiAjOTU5ZWE5Ow0KICAgICAgYmFja2dyb3VuZDogIzk1OWVhOTsNCiAgICAgIGNvbG9yOiAjZmZmOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5LnNlbGVjdGVkLA0KICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuc2VsZWN0ZWQuaW5SYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlLmluUmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2UuaW5SYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZDpmb2N1cywNCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlOmZvY3VzLA0KICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlOmZvY3VzLA0KICAgIC5mbGF0cGlja3ItZGF5LnNlbGVjdGVkOmhvdmVyLA0KICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2U6aG92ZXIsDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2U6aG92ZXIsDQogICAgLmZsYXRwaWNrci1kYXkuc2VsZWN0ZWQucHJldk1vbnRoRGF5LA0KICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2UucHJldk1vbnRoRGF5LA0KICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlLnByZXZNb250aERheSwNCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZC5uZXh0TW9udGhEYXksDQogICAgLmZsYXRwaWNrci1kYXkuc3RhcnRSYW5nZS5uZXh0TW9udGhEYXksDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2UubmV4dE1vbnRoRGF5IHsNCiAgICAgIGJhY2tncm91bmQ6ICM1NjlmZjc7DQogICAgICAtd2Via2l0LWJveC1zaGFkb3c6IG5vbmU7DQogICAgICBib3gtc2hhZG93OiBub25lOw0KICAgICAgY29sb3I6ICNmZmY7DQogICAgICBib3JkZXItY29sb3I6ICM1NjlmZjc7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuc2VsZWN0ZWQuc3RhcnRSYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlLnN0YXJ0UmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2Uuc3RhcnRSYW5nZSB7DQogICAgICBib3JkZXItcmFkaXVzOiA1MHB4IDAgMCA1MHB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5LnNlbGVjdGVkLmVuZFJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2UuZW5kUmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2UuZW5kUmFuZ2Ugew0KICAgICAgYm9yZGVyLXJhZGl1czogMCA1MHB4IDUwcHggMDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZC5zdGFydFJhbmdlKy5lbmRSYW5nZTpub3QoOm50aC1jaGlsZCg3bisxKSksDQogICAgLmZsYXRwaWNrci1kYXkuc3RhcnRSYW5nZS5zdGFydFJhbmdlKy5lbmRSYW5nZTpub3QoOm50aC1jaGlsZCg3bisxKSksDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2Uuc3RhcnRSYW5nZSsuZW5kUmFuZ2U6bm90KDpudGgtY2hpbGQoN24rMSkpIHsNCiAgICAgIC13ZWJraXQtYm94LXNoYWRvdzogLTEwcHggMCAwICM1NjlmZjc7DQogICAgICBib3gtc2hhZG93OiAtMTBweCAwIDAgIzU2OWZmNzsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZC5zdGFydFJhbmdlLmVuZFJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2Uuc3RhcnRSYW5nZS5lbmRSYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5lbmRSYW5nZS5zdGFydFJhbmdlLmVuZFJhbmdlIHsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDUwcHg7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuaW5SYW5nZSB7DQogICAgICBib3JkZXItcmFkaXVzOiAwOw0KICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiAtNXB4IDAgMCAjZTZlNmU2LCA1cHggMCAwICNlNmU2ZTY7DQogICAgICBib3gtc2hhZG93OiAtNXB4IDAgMCAjZTZlNmU2LCA1cHggMCAwICNlNmU2ZTY7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuZGlzYWJsZWQsDQogICAgLmZsYXRwaWNrci1kYXkuZGlzYWJsZWQ6aG92ZXIsDQogICAgLmZsYXRwaWNrci1kYXkucHJldk1vbnRoRGF5LA0KICAgIC5mbGF0cGlja3ItZGF5Lm5leHRNb250aERheSwNCiAgICAuZmxhdHBpY2tyLWRheS5ub3RBbGxvd2VkLA0KICAgIC5mbGF0cGlja3ItZGF5Lm5vdEFsbG93ZWQucHJldk1vbnRoRGF5LA0KICAgIC5mbGF0cGlja3ItZGF5Lm5vdEFsbG93ZWQubmV4dE1vbnRoRGF5IHsNCiAgICAgIGNvbG9yOiByZ2JhKDU3LCA1NywgNTcsIDAuMyk7DQogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICAgIGJvcmRlci1jb2xvcjogdHJhbnNwYXJlbnQ7DQogICAgICBjdXJzb3I6IGRlZmF1bHQ7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuZGlzYWJsZWQsDQogICAgLmZsYXRwaWNrci1kYXkuZGlzYWJsZWQ6aG92ZXIgew0KICAgICAgY3Vyc29yOiBub3QtYWxsb3dlZDsNCiAgICAgIGNvbG9yOiByZ2JhKDU3LCA1NywgNTcsIDAuMSk7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkud2Vlay5zZWxlY3RlZCB7DQogICAgICBib3JkZXItcmFkaXVzOiAwOw0KICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiAtNXB4IDAgMCAjNTY5ZmY3LCA1cHggMCAwICM1NjlmZjc7DQogICAgICBib3gtc2hhZG93OiAtNXB4IDAgMCAjNTY5ZmY3LCA1cHggMCAwICM1NjlmZjc7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuaGlkZGVuIHsNCiAgICAgIHZpc2liaWxpdHk6IGhpZGRlbjsNCiAgICB9DQoNCiAgICAucmFuZ2VNb2RlIC5mbGF0cGlja3ItZGF5IHsNCiAgICAgIG1hcmdpbi10b3A6IDFweDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXdlZWt3cmFwcGVyIHsNCiAgICAgIGZsb2F0OiBsZWZ0Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3Itd2Vla3dyYXBwZXIgLmZsYXRwaWNrci13ZWVrcyB7DQogICAgICBwYWRkaW5nOiAwIDEycHg7DQogICAgICAtd2Via2l0LWJveC1zaGFkb3c6IDFweCAwIDAgI2U2ZTZlNjsNCiAgICAgIGJveC1zaGFkb3c6IDFweCAwIDAgI2U2ZTZlNjsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXdlZWt3cmFwcGVyIC5mbGF0cGlja3Itd2Vla2RheSB7DQogICAgICBmbG9hdDogbm9uZTsNCiAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgbGluZS1oZWlnaHQ6IDI4cHg7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci13ZWVrd3JhcHBlciBzcGFuLmZsYXRwaWNrci1kYXksDQogICAgLmZsYXRwaWNrci13ZWVrd3JhcHBlciBzcGFuLmZsYXRwaWNrci1kYXk6aG92ZXIgew0KICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICB3aWR0aDogMTAwJTsNCiAgICAgIG1heC13aWR0aDogbm9uZTsNCiAgICAgIGNvbG9yOiByZ2JhKDU3LCA1NywgNTcsIDAuMyk7DQogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICAgIGN1cnNvcjogZGVmYXVsdDsNCiAgICAgIGJvcmRlcjogbm9uZTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWlubmVyQ29udGFpbmVyIHsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgZGlzcGxheTogLXdlYmtpdC1ib3g7DQogICAgICBkaXNwbGF5OiAtd2Via2l0LWZsZXg7DQogICAgICBkaXNwbGF5OiAtbXMtZmxleGJveDsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXJDb250YWluZXIgew0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgcGFkZGluZzogMDsNCiAgICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lIHsNCiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgIG91dGxpbmU6IDA7DQogICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgIGhlaWdodDogMDsNCiAgICAgIGxpbmUtaGVpZ2h0OiA0MHB4Ow0KICAgICAgbWF4LWhlaWdodDogNDBweDsNCiAgICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgZGlzcGxheTogLXdlYmtpdC1ib3g7DQogICAgICBkaXNwbGF5OiAtd2Via2l0LWZsZXg7DQogICAgICBkaXNwbGF5OiAtbXMtZmxleGJveDsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lOmFmdGVyIHsNCiAgICAgIGNvbnRlbnQ6ICIiOw0KICAgICAgZGlzcGxheTogdGFibGU7DQogICAgICBjbGVhcjogYm90aDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXRpbWUgLm51bUlucHV0V3JhcHBlciB7DQogICAgICAtd2Via2l0LWJveC1mbGV4OiAxOw0KICAgICAgLXdlYmtpdC1mbGV4OiAxOw0KICAgICAgLW1zLWZsZXg6IDE7DQogICAgICBmbGV4OiAxOw0KICAgICAgd2lkdGg6IDQwJTsNCiAgICAgIGhlaWdodDogNDBweDsNCiAgICAgIGZsb2F0OiBsZWZ0Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZSAubnVtSW5wdXRXcmFwcGVyIHNwYW4uYXJyb3dVcDphZnRlciB7DQogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjMzkzOTM5Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZSAubnVtSW5wdXRXcmFwcGVyIHNwYW4uYXJyb3dEb3duOmFmdGVyIHsNCiAgICAgIGJvcmRlci10b3AtY29sb3I6ICMzOTM5Mzk7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lLmhhc1NlY29uZHMgLm51bUlucHV0V3JhcHBlciB7DQogICAgICB3aWR0aDogMjYlOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZS50aW1lMjRociAubnVtSW5wdXRXcmFwcGVyIHsNCiAgICAgIHdpZHRoOiA0OSU7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lIGlucHV0IHsNCiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50Ow0KICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiBub25lOw0KICAgICAgYm94LXNoYWRvdzogbm9uZTsNCiAgICAgIGJvcmRlcjogMDsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDA7DQogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICBtYXJnaW46IDA7DQogICAgICBwYWRkaW5nOiAwOw0KICAgICAgaGVpZ2h0OiBpbmhlcml0Ow0KICAgICAgbGluZS1oZWlnaHQ6IGluaGVyaXQ7DQogICAgICBjb2xvcjogIzM5MzkzOTsNCiAgICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lIGlucHV0LmZsYXRwaWNrci1ob3VyIHsNCiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dC5mbGF0cGlja3ItbWludXRlLA0KICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dC5mbGF0cGlja3Itc2Vjb25kIHsNCiAgICAgIGZvbnQtd2VpZ2h0OiA0MDA7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lIGlucHV0OmZvY3VzIHsNCiAgICAgIG91dGxpbmU6IDA7DQogICAgICBib3JkZXI6IDA7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lIC5mbGF0cGlja3ItdGltZS1zZXBhcmF0b3IsDQogICAgLmZsYXRwaWNrci10aW1lIC5mbGF0cGlja3ItYW0tcG0gew0KICAgICAgaGVpZ2h0OiBpbmhlcml0Ow0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgbGluZS1oZWlnaHQ6IGluaGVyaXQ7DQogICAgICBjb2xvcjogIzM5MzkzOTsNCiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgd2lkdGg6IDIlOw0KICAgICAgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIC1tb3otdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAtbXMtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICB1c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIC13ZWJraXQtYWxpZ24tc2VsZjogY2VudGVyOw0KICAgICAgLW1zLWZsZXgtaXRlbS1hbGlnbjogY2VudGVyOw0KICAgICAgYWxpZ24tc2VsZjogY2VudGVyOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZSAuZmxhdHBpY2tyLWFtLXBtIHsNCiAgICAgIG91dGxpbmU6IDA7DQogICAgICB3aWR0aDogMTglOw0KICAgICAgY3Vyc29yOiBwb2ludGVyOw0KICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgZm9udC13ZWlnaHQ6IDQwMDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXRpbWUgaW5wdXQ6aG92ZXIsDQogICAgLmZsYXRwaWNrci10aW1lIC5mbGF0cGlja3ItYW0tcG06aG92ZXIsDQogICAgLmZsYXRwaWNrci10aW1lIGlucHV0OmZvY3VzLA0KICAgIC5mbGF0cGlja3ItdGltZSAuZmxhdHBpY2tyLWFtLXBtOmZvY3VzIHsNCiAgICAgIGJhY2tncm91bmQ6ICNmM2YzZjM7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1pbnB1dFtyZWFkb25seV0gew0KICAgICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIH0NCg0KICAgIEAtd2Via2l0LWtleWZyYW1lcyBmcEZhZGVJbkRvd24gew0KICAgICAgZnJvbSB7DQogICAgICAgIG9wYWNpdHk6IDA7DQogICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAtMjBweCwgMCk7DQogICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgLTIwcHgsIDApOw0KICAgICAgfQ0KDQogICAgICB0byB7DQogICAgICAgIG9wYWNpdHk6IDE7DQogICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAwLCAwKTsNCiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAwLCAwKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBAa2V5ZnJhbWVzIGZwRmFkZUluRG93biB7DQogICAgICBmcm9tIHsNCiAgICAgICAgb3BhY2l0eTogMDsNCiAgICAgICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIC0yMHB4LCAwKTsNCiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAtMjBweCwgMCk7DQogICAgICB9DQoNCiAgICAgIHRvIHsNCiAgICAgICAgb3BhY2l0eTogMTsNCiAgICAgICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIDAsIDApOw0KICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIDAsIDApOw0KICAgICAgfQ0KICAgIH0NCiAgPC9zdHlsZT4NCiAgPCEtLTxzY3JpcHQgc3JjPSJqYXZhc2NyaXB0cy9mbGF0cGlja3IuanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+LS0+DQogIDxzY3JpcHQ+DQogIC8qIGZsYXRwaWNrciB2NC41LjAsIEBsaWNlbnNlIE1JVCAqLw0KKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsNCiAgICB0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA6DQogICAgdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDoNCiAgICAoZ2xvYmFsLmZsYXRwaWNrciA9IGZhY3RvcnkoKSk7DQp9KHRoaXMsIChmdW5jdGlvbiAoKSB7ICd1c2Ugc3RyaWN0JzsNCg0KICAgIHZhciBwYWQgPSBmdW5jdGlvbiBwYWQobnVtYmVyKSB7DQogICAgICByZXR1cm4gKCIwIiArIG51bWJlcikuc2xpY2UoLTIpOw0KICAgIH07DQogICAgdmFyIGludCA9IGZ1bmN0aW9uIGludChib29sKSB7DQogICAgICByZXR1cm4gYm9vbCA9PT0gdHJ1ZSA/IDEgOiAwOw0KICAgIH07DQogICAgZnVuY3Rpb24gZGVib3VuY2UoZnVuYywgd2FpdCwgaW1tZWRpYXRlKSB7DQogICAgICBpZiAoaW1tZWRpYXRlID09PSB2b2lkIDApIHsNCiAgICAgICAgaW1tZWRpYXRlID0gZmFsc2U7DQogICAgICB9DQoNCiAgICAgIHZhciB0aW1lb3V0Ow0KICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLA0KICAgICAgICAgICAgYXJncyA9IGFyZ3VtZW50czsNCiAgICAgICAgdGltZW91dCAhPT0gbnVsbCAmJiBjbGVhclRpbWVvdXQodGltZW91dCk7DQogICAgICAgIHRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgdGltZW91dCA9IG51bGw7DQogICAgICAgICAgaWYgKCFpbW1lZGlhdGUpIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7DQogICAgICAgIH0sIHdhaXQpOw0KICAgICAgICBpZiAoaW1tZWRpYXRlICYmICF0aW1lb3V0KSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOw0KICAgICAgfTsNCiAgICB9DQogICAgdmFyIGFycmF5aWZ5ID0gZnVuY3Rpb24gYXJyYXlpZnkob2JqKSB7DQogICAgICByZXR1cm4gb2JqIGluc3RhbmNlb2YgQXJyYXkgPyBvYmogOiBbb2JqXTsNCiAgICB9Ow0KDQogICAgdmFyIGRvX25vdGhpbmcgPSBmdW5jdGlvbiBkb19ub3RoaW5nKCkgew0KICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICB9Ow0KDQogICAgdmFyIG1vbnRoVG9TdHIgPSBmdW5jdGlvbiBtb250aFRvU3RyKG1vbnRoTnVtYmVyLCBzaG9ydGhhbmQsIGxvY2FsZSkgew0KICAgICAgcmV0dXJuIGxvY2FsZS5tb250aHNbc2hvcnRoYW5kID8gInNob3J0aGFuZCIgOiAibG9uZ2hhbmQiXVttb250aE51bWJlcl07DQogICAgfTsNCiAgICB2YXIgcmV2Rm9ybWF0ID0gew0KICAgICAgRDogZG9fbm90aGluZywNCiAgICAgIEY6IGZ1bmN0aW9uIEYoZGF0ZU9iaiwgbW9udGhOYW1lLCBsb2NhbGUpIHsNCiAgICAgICAgZGF0ZU9iai5zZXRNb250aChsb2NhbGUubW9udGhzLmxvbmdoYW5kLmluZGV4T2YobW9udGhOYW1lKSk7DQogICAgICB9LA0KICAgICAgRzogZnVuY3Rpb24gRyhkYXRlT2JqLCBob3VyKSB7DQogICAgICAgIGRhdGVPYmouc2V0SG91cnMocGFyc2VGbG9hdChob3VyKSk7DQogICAgICB9LA0KICAgICAgSDogZnVuY3Rpb24gSChkYXRlT2JqLCBob3VyKSB7DQogICAgICAgIGRhdGVPYmouc2V0SG91cnMocGFyc2VGbG9hdChob3VyKSk7DQogICAgICB9LA0KICAgICAgSjogZnVuY3Rpb24gSihkYXRlT2JqLCBkYXkpIHsNCiAgICAgICAgZGF0ZU9iai5zZXREYXRlKHBhcnNlRmxvYXQoZGF5KSk7DQogICAgICB9LA0KICAgICAgSzogZnVuY3Rpb24gSyhkYXRlT2JqLCBhbVBNLCBsb2NhbGUpIHsNCiAgICAgICAgZGF0ZU9iai5zZXRIb3VycyhkYXRlT2JqLmdldEhvdXJzKCkgJSAxMiArIDEyICogaW50KG5ldyBSZWdFeHAobG9jYWxlLmFtUE1bMV0sICJpIikudGVzdChhbVBNKSkpOw0KICAgICAgfSwNCiAgICAgIE06IGZ1bmN0aW9uIE0oZGF0ZU9iaiwgc2hvcnRNb250aCwgbG9jYWxlKSB7DQogICAgICAgIGRhdGVPYmouc2V0TW9udGgobG9jYWxlLm1vbnRocy5zaG9ydGhhbmQuaW5kZXhPZihzaG9ydE1vbnRoKSk7DQogICAgICB9LA0KICAgICAgUzogZnVuY3Rpb24gUyhkYXRlT2JqLCBzZWNvbmRzKSB7DQogICAgICAgIGRhdGVPYmouc2V0U2Vjb25kcyhwYXJzZUZsb2F0KHNlY29uZHMpKTsNCiAgICAgIH0sDQogICAgICBVOiBmdW5jdGlvbiBVKF8sIHVuaXhTZWNvbmRzKSB7DQogICAgICAgIHJldHVybiBuZXcgRGF0ZShwYXJzZUZsb2F0KHVuaXhTZWNvbmRzKSAqIDEwMDApOw0KICAgICAgfSwNCiAgICAgIFc6IGZ1bmN0aW9uIFcoZGF0ZU9iaiwgd2Vla051bSkgew0KICAgICAgICB2YXIgd2Vla051bWJlciA9IHBhcnNlSW50KHdlZWtOdW0pOw0KICAgICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZU9iai5nZXRGdWxsWWVhcigpLCAwLCAyICsgKHdlZWtOdW1iZXIgLSAxKSAqIDcsIDAsIDAsIDAsIDApOw0KICAgICAgfSwNCiAgICAgIFk6IGZ1bmN0aW9uIFkoZGF0ZU9iaiwgeWVhcikgew0KICAgICAgICBkYXRlT2JqLnNldEZ1bGxZZWFyKHBhcnNlRmxvYXQoeWVhcikpOw0KICAgICAgfSwNCiAgICAgIFo6IGZ1bmN0aW9uIFooXywgSVNPRGF0ZSkgew0KICAgICAgICByZXR1cm4gbmV3IERhdGUoSVNPRGF0ZSk7DQogICAgICB9LA0KICAgICAgZDogZnVuY3Rpb24gZChkYXRlT2JqLCBkYXkpIHsNCiAgICAgICAgZGF0ZU9iai5zZXREYXRlKHBhcnNlRmxvYXQoZGF5KSk7DQogICAgICB9LA0KICAgICAgaDogZnVuY3Rpb24gaChkYXRlT2JqLCBob3VyKSB7DQogICAgICAgIGRhdGVPYmouc2V0SG91cnMocGFyc2VGbG9hdChob3VyKSk7DQogICAgICB9LA0KICAgICAgaTogZnVuY3Rpb24gaShkYXRlT2JqLCBtaW51dGVzKSB7DQogICAgICAgIGRhdGVPYmouc2V0TWludXRlcyhwYXJzZUZsb2F0KG1pbnV0ZXMpKTsNCiAgICAgIH0sDQogICAgICBqOiBmdW5jdGlvbiBqKGRhdGVPYmosIGRheSkgew0KICAgICAgICBkYXRlT2JqLnNldERhdGUocGFyc2VGbG9hdChkYXkpKTsNCiAgICAgIH0sDQogICAgICBsOiBkb19ub3RoaW5nLA0KICAgICAgbTogZnVuY3Rpb24gbShkYXRlT2JqLCBtb250aCkgew0KICAgICAgICBkYXRlT2JqLnNldE1vbnRoKHBhcnNlRmxvYXQobW9udGgpIC0gMSk7DQogICAgICB9LA0KICAgICAgbjogZnVuY3Rpb24gbihkYXRlT2JqLCBtb250aCkgew0KICAgICAgICBkYXRlT2JqLnNldE1vbnRoKHBhcnNlRmxvYXQobW9udGgpIC0gMSk7DQogICAgICB9LA0KICAgICAgczogZnVuY3Rpb24gcyhkYXRlT2JqLCBzZWNvbmRzKSB7DQogICAgICAgIGRhdGVPYmouc2V0U2Vjb25kcyhwYXJzZUZsb2F0KHNlY29uZHMpKTsNCiAgICAgIH0sDQogICAgICB3OiBkb19ub3RoaW5nLA0KICAgICAgeTogZnVuY3Rpb24geShkYXRlT2JqLCB5ZWFyKSB7DQogICAgICAgIGRhdGVPYmouc2V0RnVsbFllYXIoMjAwMCArIHBhcnNlRmxvYXQoeWVhcikpOw0KICAgICAgfQ0KICAgIH07DQogICAgdmFyIHRva2VuUmVnZXggPSB7DQogICAgICBEOiAiKFxcdyspIiwNCiAgICAgIEY6ICIoXFx3KykiLA0KICAgICAgRzogIihcXGRcXGR8XFxkKSIsDQogICAgICBIOiAiKFxcZFxcZHxcXGQpIiwNCiAgICAgIEo6ICIoXFxkXFxkfFxcZClcXHcrIiwNCiAgICAgIEs6ICIiLA0KICAgICAgTTogIihcXHcrKSIsDQogICAgICBTOiAiKFxcZFxcZHxcXGQpIiwNCiAgICAgIFU6ICIoLispIiwNCiAgICAgIFc6ICIoXFxkXFxkfFxcZCkiLA0KICAgICAgWTogIihcXGR7NH0pIiwNCiAgICAgIFo6ICIoLispIiwNCiAgICAgIGQ6ICIoXFxkXFxkfFxcZCkiLA0KICAgICAgaDogIihcXGRcXGR8XFxkKSIsDQogICAgICBpOiAiKFxcZFxcZHxcXGQpIiwNCiAgICAgIGo6ICIoXFxkXFxkfFxcZCkiLA0KICAgICAgbDogIihcXHcrKSIsDQogICAgICBtOiAiKFxcZFxcZHxcXGQpIiwNCiAgICAgIG46ICIoXFxkXFxkfFxcZCkiLA0KICAgICAgczogIihcXGRcXGR8XFxkKSIsDQogICAgICB3OiAiKFxcZFxcZHxcXGQpIiwNCiAgICAgIHk6ICIoXFxkezJ9KSINCiAgICB9Ow0KICAgIHZhciBmb3JtYXRzID0gew0KICAgICAgWjogZnVuY3Rpb24gWihkYXRlKSB7DQogICAgICAgIHJldHVybiBkYXRlLnRvSVNPU3RyaW5nKCk7DQogICAgICB9LA0KICAgICAgRDogZnVuY3Rpb24gRChkYXRlLCBsb2NhbGUsIG9wdGlvbnMpIHsNCiAgICAgICAgcmV0dXJuIGxvY2FsZS53ZWVrZGF5cy5zaG9ydGhhbmRbZm9ybWF0cy53KGRhdGUsIGxvY2FsZSwgb3B0aW9ucyldOw0KICAgICAgfSwNCiAgICAgIEY6IGZ1bmN0aW9uIEYoZGF0ZSwgbG9jYWxlLCBvcHRpb25zKSB7DQogICAgICAgIHJldHVybiBtb250aFRvU3RyKGZvcm1hdHMubihkYXRlLCBsb2NhbGUsIG9wdGlvbnMpIC0gMSwgZmFsc2UsIGxvY2FsZSk7DQogICAgICB9LA0KICAgICAgRzogZnVuY3Rpb24gRyhkYXRlLCBsb2NhbGUsIG9wdGlvbnMpIHsNCiAgICAgICAgcmV0dXJuIHBhZChmb3JtYXRzLmgoZGF0ZSwgbG9jYWxlLCBvcHRpb25zKSk7DQogICAgICB9LA0KICAgICAgSDogZnVuY3Rpb24gSChkYXRlKSB7DQogICAgICAgIHJldHVybiBwYWQoZGF0ZS5nZXRIb3VycygpKTsNCiAgICAgIH0sDQogICAgICBKOiBmdW5jdGlvbiBKKGRhdGUsIGxvY2FsZSkgew0KICAgICAgICByZXR1cm4gbG9jYWxlLm9yZGluYWwgIT09IHVuZGVmaW5lZCA/IGRhdGUuZ2V0RGF0ZSgpICsgbG9jYWxlLm9yZGluYWwoZGF0ZS5nZXREYXRlKCkpIDogZGF0ZS5nZXREYXRlKCk7DQogICAgICB9LA0KICAgICAgSzogZnVuY3Rpb24gSyhkYXRlLCBsb2NhbGUpIHsNCiAgICAgICAgcmV0dXJuIGxvY2FsZS5hbVBNW2ludChkYXRlLmdldEhvdXJzKCkgPiAxMSldOw0KICAgICAgfSwNCiAgICAgIE06IGZ1bmN0aW9uIE0oZGF0ZSwgbG9jYWxlKSB7DQogICAgICAgIHJldHVybiBtb250aFRvU3RyKGRhdGUuZ2V0TW9udGgoKSwgdHJ1ZSwgbG9jYWxlKTsNCiAgICAgIH0sDQogICAgICBTOiBmdW5jdGlvbiBTKGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIHBhZChkYXRlLmdldFNlY29uZHMoKSk7DQogICAgICB9LA0KICAgICAgVTogZnVuY3Rpb24gVShkYXRlKSB7DQogICAgICAgIHJldHVybiBkYXRlLmdldFRpbWUoKSAvIDEwMDA7DQogICAgICB9LA0KICAgICAgVzogZnVuY3Rpb24gVyhkYXRlLCBfLCBvcHRpb25zKSB7DQogICAgICAgIHJldHVybiBvcHRpb25zLmdldFdlZWsoZGF0ZSk7DQogICAgICB9LA0KICAgICAgWTogZnVuY3Rpb24gWShkYXRlKSB7DQogICAgICAgIHJldHVybiBkYXRlLmdldEZ1bGxZZWFyKCk7DQogICAgICB9LA0KICAgICAgZDogZnVuY3Rpb24gZChkYXRlKSB7DQogICAgICAgIHJldHVybiBwYWQoZGF0ZS5nZXREYXRlKCkpOw0KICAgICAgfSwNCiAgICAgIGg6IGZ1bmN0aW9uIGgoZGF0ZSkgew0KICAgICAgICByZXR1cm4gZGF0ZS5nZXRIb3VycygpICUgMTIgPyBkYXRlLmdldEhvdXJzKCkgJSAxMiA6IDEyOw0KICAgICAgfSwNCiAgICAgIGk6IGZ1bmN0aW9uIGkoZGF0ZSkgew0KICAgICAgICByZXR1cm4gcGFkKGRhdGUuZ2V0TWludXRlcygpKTsNCiAgICAgIH0sDQogICAgICBqOiBmdW5jdGlvbiBqKGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RGF0ZSgpOw0KICAgICAgfSwNCiAgICAgIGw6IGZ1bmN0aW9uIGwoZGF0ZSwgbG9jYWxlKSB7DQogICAgICAgIHJldHVybiBsb2NhbGUud2Vla2RheXMubG9uZ2hhbmRbZGF0ZS5nZXREYXkoKV07DQogICAgICB9LA0KICAgICAgbTogZnVuY3Rpb24gbShkYXRlKSB7DQogICAgICAgIHJldHVybiBwYWQoZGF0ZS5nZXRNb250aCgpICsgMSk7DQogICAgICB9LA0KICAgICAgbjogZnVuY3Rpb24gbihkYXRlKSB7DQogICAgICAgIHJldHVybiBkYXRlLmdldE1vbnRoKCkgKyAxOw0KICAgICAgfSwNCiAgICAgIHM6IGZ1bmN0aW9uIHMoZGF0ZSkgew0KICAgICAgICByZXR1cm4gZGF0ZS5nZXRTZWNvbmRzKCk7DQogICAgICB9LA0KICAgICAgdzogZnVuY3Rpb24gdyhkYXRlKSB7DQogICAgICAgIHJldHVybiBkYXRlLmdldERheSgpOw0KICAgICAgfSwNCiAgICAgIHk6IGZ1bmN0aW9uIHkoZGF0ZSkgew0KICAgICAgICByZXR1cm4gU3RyaW5nKGRhdGUuZ2V0RnVsbFllYXIoKSkuc3Vic3RyaW5nKDIpOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICB2YXIgZW5nbGlzaCA9IHsNCiAgICAgIHdlZWtkYXlzOiB7DQogICAgICAgIHNob3J0aGFuZDogWyJTdW4iLCAiTW9uIiwgIlR1ZSIsICJXZWQiLCAiVGh1IiwgIkZyaSIsICJTYXQiXSwNCiAgICAgICAgbG9uZ2hhbmQ6IFsiU3VuZGF5IiwgIk1vbmRheSIsICJUdWVzZGF5IiwgIldlZG5lc2RheSIsICJUaHVyc2RheSIsICJGcmlkYXkiLCAiU2F0dXJkYXkiXQ0KICAgICAgfSwNCiAgICAgIG1vbnRoczogew0KICAgICAgICBzaG9ydGhhbmQ6IFsiSmFuIiwgIkZlYiIsICJNYXIiLCAiQXByIiwgIk1heSIsICJKdW4iLCAiSnVsIiwgIkF1ZyIsICJTZXAiLCAiT2N0IiwgIk5vdiIsICJEZWMiXSwNCiAgICAgICAgbG9uZ2hhbmQ6IFsiSmFudWFyeSIsICJGZWJydWFyeSIsICJNYXJjaCIsICJBcHJpbCIsICJNYXkiLCAiSnVuZSIsICJKdWx5IiwgIkF1Z3VzdCIsICJTZXB0ZW1iZXIiLCAiT2N0b2JlciIsICJOb3ZlbWJlciIsICJEZWNlbWJlciJdDQogICAgICB9LA0KICAgICAgZGF5c0luTW9udGg6IFszMSwgMjgsIDMxLCAzMCwgMzEsIDMwLCAzMSwgMzEsIDMwLCAzMSwgMzAsIDMxXSwNCiAgICAgIGZpcnN0RGF5T2ZXZWVrOiAwLA0KICAgICAgb3JkaW5hbDogZnVuY3Rpb24gb3JkaW5hbChudGgpIHsNCiAgICAgICAgdmFyIHMgPSBudGggJSAxMDA7DQogICAgICAgIGlmIChzID4gMyAmJiBzIDwgMjEpIHJldHVybiAidGgiOw0KDQogICAgICAgIHN3aXRjaCAocyAlIDEwKSB7DQogICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgcmV0dXJuICJzdCI7DQoNCiAgICAgICAgICBjYXNlIDI6DQogICAgICAgICAgICByZXR1cm4gIm5kIjsNCg0KICAgICAgICAgIGNhc2UgMzoNCiAgICAgICAgICAgIHJldHVybiAicmQiOw0KDQogICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHJldHVybiAidGgiOw0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgcmFuZ2VTZXBhcmF0b3I6ICIgdG8gIiwNCiAgICAgIHdlZWtBYmJyZXZpYXRpb246ICJXayIsDQogICAgICBzY3JvbGxUaXRsZTogIlNjcm9sbCB0byBpbmNyZW1lbnQiLA0KICAgICAgdG9nZ2xlVGl0bGU6ICJDbGljayB0byB0b2dnbGUiLA0KICAgICAgYW1QTTogWyJBTSIsICJQTSJdLA0KICAgICAgeWVhckFyaWFMYWJlbDogIlllYXIiDQogICAgfTsNCg0KICAgIHZhciBjcmVhdGVEYXRlRm9ybWF0dGVyID0gZnVuY3Rpb24gY3JlYXRlRGF0ZUZvcm1hdHRlcihfcmVmKSB7DQogICAgICB2YXIgX3JlZiRjb25maWcgPSBfcmVmLmNvbmZpZywNCiAgICAgICAgICBjb25maWcgPSBfcmVmJGNvbmZpZyA9PT0gdm9pZCAwID8gZGVmYXVsdHMgOiBfcmVmJGNvbmZpZywNCiAgICAgICAgICBfcmVmJGwxMG4gPSBfcmVmLmwxMG4sDQogICAgICAgICAgbDEwbiA9IF9yZWYkbDEwbiA9PT0gdm9pZCAwID8gZW5nbGlzaCA6IF9yZWYkbDEwbjsNCiAgICAgIHJldHVybiBmdW5jdGlvbiAoZGF0ZU9iaiwgZnJtdCwgb3ZlcnJpZGVMb2NhbGUpIHsNCiAgICAgICAgaWYgKGNvbmZpZy5mb3JtYXREYXRlICE9PSB1bmRlZmluZWQpIHJldHVybiBjb25maWcuZm9ybWF0RGF0ZShkYXRlT2JqLCBmcm10KTsNCiAgICAgICAgdmFyIGxvY2FsZSA9IG92ZXJyaWRlTG9jYWxlIHx8IGwxMG47DQogICAgICAgIHJldHVybiBmcm10LnNwbGl0KCIiKS5tYXAoZnVuY3Rpb24gKGMsIGksIGFycikgew0KICAgICAgICAgIHJldHVybiBmb3JtYXRzW2NdICYmIGFycltpIC0gMV0gIT09ICJcXCIgPyBmb3JtYXRzW2NdKGRhdGVPYmosIGxvY2FsZSwgY29uZmlnKSA6IGMgIT09ICJcXCIgPyBjIDogIiI7DQogICAgICAgIH0pLmpvaW4oIiIpOw0KICAgICAgfTsNCiAgICB9Ow0KICAgIHZhciBjcmVhdGVEYXRlUGFyc2VyID0gZnVuY3Rpb24gY3JlYXRlRGF0ZVBhcnNlcihfcmVmMikgew0KICAgICAgdmFyIF9yZWYyJGNvbmZpZyA9IF9yZWYyLmNvbmZpZywNCiAgICAgICAgICBjb25maWcgPSBfcmVmMiRjb25maWcgPT09IHZvaWQgMCA/IGRlZmF1bHRzIDogX3JlZjIkY29uZmlnLA0KICAgICAgICAgIF9yZWYyJGwxMG4gPSBfcmVmMi5sMTBuLA0KICAgICAgICAgIGwxMG4gPSBfcmVmMiRsMTBuID09PSB2b2lkIDAgPyBlbmdsaXNoIDogX3JlZjIkbDEwbjsNCiAgICAgIHJldHVybiBmdW5jdGlvbiAoZGF0ZSwgZ2l2ZW5Gb3JtYXQsIHRpbWVsZXNzKSB7DQogICAgICAgIGlmIChkYXRlICE9PSAwICYmICFkYXRlKSByZXR1cm4gdW5kZWZpbmVkOw0KICAgICAgICB2YXIgcGFyc2VkRGF0ZTsNCiAgICAgICAgdmFyIGRhdGVfb3JpZyA9IGRhdGU7DQogICAgICAgIGlmIChkYXRlIGluc3RhbmNlb2YgRGF0ZSkgcGFyc2VkRGF0ZSA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtlbHNlIGlmICh0eXBlb2YgZGF0ZSAhPT0gInN0cmluZyIgJiYgZGF0ZS50b0ZpeGVkICE9PSB1bmRlZmluZWQpIHBhcnNlZERhdGUgPSBuZXcgRGF0ZShkYXRlKTtlbHNlIGlmICh0eXBlb2YgZGF0ZSA9PT0gInN0cmluZyIpIHsNCiAgICAgICAgICB2YXIgZm9ybWF0ID0gZ2l2ZW5Gb3JtYXQgfHwgKGNvbmZpZyB8fCBkZWZhdWx0cykuZGF0ZUZvcm1hdDsNCiAgICAgICAgICB2YXIgZGF0ZXN0ciA9IFN0cmluZyhkYXRlKS50cmltKCk7DQoNCiAgICAgICAgICBpZiAoZGF0ZXN0ciA9PT0gInRvZGF5Iikgew0KICAgICAgICAgICAgcGFyc2VkRGF0ZSA9IG5ldyBEYXRlKCk7DQogICAgICAgICAgICB0aW1lbGVzcyA9IHRydWU7DQogICAgICAgICAgfSBlbHNlIGlmICgvWiQvLnRlc3QoZGF0ZXN0cikgfHwgL0dNVCQvLnRlc3QoZGF0ZXN0cikpIHBhcnNlZERhdGUgPSBuZXcgRGF0ZShkYXRlKTtlbHNlIGlmIChjb25maWcgJiYgY29uZmlnLnBhcnNlRGF0ZSkgcGFyc2VkRGF0ZSA9IGNvbmZpZy5wYXJzZURhdGUoZGF0ZSwgZm9ybWF0KTtlbHNlIHsNCiAgICAgICAgICAgIHBhcnNlZERhdGUgPSAhY29uZmlnIHx8ICFjb25maWcubm9DYWxlbmRhciA/IG5ldyBEYXRlKG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSwgMCwgMSwgMCwgMCwgMCwgMCkgOiBuZXcgRGF0ZShuZXcgRGF0ZSgpLnNldEhvdXJzKDAsIDAsIDAsIDApKTsNCiAgICAgICAgICAgIHZhciBtYXRjaGVkLA0KICAgICAgICAgICAgICAgIG9wcyA9IFtdOw0KDQogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbWF0Y2hJbmRleCA9IDAsIHJlZ2V4U3RyID0gIiI7IGkgPCBmb3JtYXQubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgdmFyIHRva2VuID0gZm9ybWF0W2ldOw0KICAgICAgICAgICAgICB2YXIgaXNCYWNrU2xhc2ggPSB0b2tlbiA9PT0gIlxcIjsNCiAgICAgICAgICAgICAgdmFyIGVzY2FwZWQgPSBmb3JtYXRbaSAtIDFdID09PSAiXFwiIHx8IGlzQmFja1NsYXNoOw0KDQogICAgICAgICAgICAgIGlmICh0b2tlblJlZ2V4W3Rva2VuXSAmJiAhZXNjYXBlZCkgew0KICAgICAgICAgICAgICAgIHJlZ2V4U3RyICs9IHRva2VuUmVnZXhbdG9rZW5dOw0KICAgICAgICAgICAgICAgIHZhciBtYXRjaCA9IG5ldyBSZWdFeHAocmVnZXhTdHIpLmV4ZWMoZGF0ZSk7DQoNCiAgICAgICAgICAgICAgICBpZiAobWF0Y2ggJiYgKG1hdGNoZWQgPSB0cnVlKSkgew0KICAgICAgICAgICAgICAgICAgb3BzW3Rva2VuICE9PSAiWSIgPyAicHVzaCIgOiAidW5zaGlmdCJdKHsNCiAgICAgICAgICAgICAgICAgICAgZm46IHJldkZvcm1hdFt0b2tlbl0sDQogICAgICAgICAgICAgICAgICAgIHZhbDogbWF0Y2hbKyttYXRjaEluZGV4XQ0KICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFpc0JhY2tTbGFzaCkgcmVnZXhTdHIgKz0gIi4iOw0KDQogICAgICAgICAgICAgIG9wcy5mb3JFYWNoKGZ1bmN0aW9uIChfcmVmMykgew0KICAgICAgICAgICAgICAgIHZhciBmbiA9IF9yZWYzLmZuLA0KICAgICAgICAgICAgICAgICAgICB2YWwgPSBfcmVmMy52YWw7DQogICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlZERhdGUgPSBmbihwYXJzZWREYXRlLCB2YWwsIGwxMG4pIHx8IHBhcnNlZERhdGU7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBwYXJzZWREYXRlID0gbWF0Y2hlZCA/IHBhcnNlZERhdGUgOiB1bmRlZmluZWQ7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCEocGFyc2VkRGF0ZSBpbnN0YW5jZW9mIERhdGUgJiYgIWlzTmFOKHBhcnNlZERhdGUuZ2V0VGltZSgpKSkpIHsNCiAgICAgICAgICBjb25maWcuZXJyb3JIYW5kbGVyKG5ldyBFcnJvcigiSW52YWxpZCBkYXRlIHByb3ZpZGVkOiAiICsgZGF0ZV9vcmlnKSk7DQogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICh0aW1lbGVzcyA9PT0gdHJ1ZSkgcGFyc2VkRGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKTsNCiAgICAgICAgcmV0dXJuIHBhcnNlZERhdGU7DQogICAgICB9Ow0KICAgIH07DQogICAgZnVuY3Rpb24gY29tcGFyZURhdGVzKGRhdGUxLCBkYXRlMiwgdGltZWxlc3MpIHsNCiAgICAgIGlmICh0aW1lbGVzcyA9PT0gdm9pZCAwKSB7DQogICAgICAgIHRpbWVsZXNzID0gdHJ1ZTsNCiAgICAgIH0NCg0KICAgICAgaWYgKHRpbWVsZXNzICE9PSBmYWxzZSkgew0KICAgICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZTEuZ2V0VGltZSgpKS5zZXRIb3VycygwLCAwLCAwLCAwKSAtIG5ldyBEYXRlKGRhdGUyLmdldFRpbWUoKSkuc2V0SG91cnMoMCwgMCwgMCwgMCk7DQogICAgICB9DQoNCiAgICAgIHJldHVybiBkYXRlMS5nZXRUaW1lKCkgLSBkYXRlMi5nZXRUaW1lKCk7DQogICAgfQ0KICAgIHZhciBnZXRXZWVrID0gZnVuY3Rpb24gZ2V0V2VlayhnaXZlbkRhdGUpIHsNCiAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoZ2l2ZW5EYXRlLmdldFRpbWUoKSk7DQogICAgICBkYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApOw0KICAgICAgZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpICsgMyAtIChkYXRlLmdldERheSgpICsgNikgJSA3KTsNCiAgICAgIHZhciB3ZWVrMSA9IG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgMCwgNCk7DQogICAgICByZXR1cm4gMSArIE1hdGgucm91bmQoKChkYXRlLmdldFRpbWUoKSAtIHdlZWsxLmdldFRpbWUoKSkgLyA4NjQwMDAwMCAtIDMgKyAod2VlazEuZ2V0RGF5KCkgKyA2KSAlIDcpIC8gNyk7DQogICAgfTsNCiAgICB2YXIgaXNCZXR3ZWVuID0gZnVuY3Rpb24gaXNCZXR3ZWVuKHRzLCB0czEsIHRzMikgew0KICAgICAgcmV0dXJuIHRzID4gTWF0aC5taW4odHMxLCB0czIpICYmIHRzIDwgTWF0aC5tYXgodHMxLCB0czIpOw0KICAgIH07DQogICAgdmFyIGR1cmF0aW9uID0gew0KICAgICAgREFZOiA4NjQwMDAwMA0KICAgIH07DQoNCiAgICB2YXIgZGVmYXVsdHMgPSB7DQogICAgICBfZGlzYWJsZTogW10sDQogICAgICBfZW5hYmxlOiBbXSwNCiAgICAgIGFsbG93SW5wdXQ6IGZhbHNlLA0KICAgICAgYWx0Rm9ybWF0OiAiRiBqLCBZIiwNCiAgICAgIGFsdElucHV0OiBmYWxzZSwNCiAgICAgIGFsdElucHV0Q2xhc3M6ICJmb3JtLWNvbnRyb2wgaW5wdXQiLA0KICAgICAgYW5pbWF0ZTogdHlwZW9mIHdpbmRvdyA9PT0gIm9iamVjdCIgJiYgd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiTVNJRSIpID09PSAtMSwNCiAgICAgIGFyaWFEYXRlRm9ybWF0OiAiRiBqLCBZIiwNCiAgICAgIGNsaWNrT3BlbnM6IHRydWUsDQogICAgICBjbG9zZU9uU2VsZWN0OiB0cnVlLA0KICAgICAgY29uanVuY3Rpb246ICIsICIsDQogICAgICBkYXRlRm9ybWF0OiAiWS1tLWQiLA0KICAgICAgZGVmYXVsdEhvdXI6IDEyLA0KICAgICAgZGVmYXVsdE1pbnV0ZTogMCwNCiAgICAgIGRlZmF1bHRTZWNvbmRzOiAwLA0KICAgICAgZGlzYWJsZTogW10sDQogICAgICBkaXNhYmxlTW9iaWxlOiBmYWxzZSwNCiAgICAgIGVuYWJsZTogW10sDQogICAgICBlbmFibGVTZWNvbmRzOiBmYWxzZSwNCiAgICAgIGVuYWJsZVRpbWU6IGZhbHNlLA0KICAgICAgZXJyb3JIYW5kbGVyOiBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZXJyKSB7DQogICAgICAgIHJldHVybiB0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIgJiYgY29uc29sZS53YXJuKGVycik7DQogICAgICB9LA0KICAgICAgZ2V0V2VlazogZ2V0V2VlaywNCiAgICAgIGhvdXJJbmNyZW1lbnQ6IDEsDQogICAgICBpZ25vcmVkRm9jdXNFbGVtZW50czogW10sDQogICAgICBpbmxpbmU6IGZhbHNlLA0KICAgICAgbG9jYWxlOiAiZGVmYXVsdCIsDQogICAgICBtaW51dGVJbmNyZW1lbnQ6IDUsDQogICAgICBtb2RlOiAic2luZ2xlIiwNCiAgICAgIG5leHRBcnJvdzogIjxzdmcgdmVyc2lvbj0nMS4xJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHhtbG5zOnhsaW5rPSdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJyB2aWV3Qm94PScwIDAgMTcgMTcnPjxnPjwvZz48cGF0aCBkPSdNMTMuMjA3IDguNDcybC03Ljg1NCA3Ljg1NC0wLjcwNy0wLjcwNyA3LjE0Ni03LjE0Ni03LjE0Ni03LjE0OCAwLjcwNy0wLjcwNyA3Ljg1NCA3Ljg1NHonIC8+PC9zdmc+IiwNCiAgICAgIG5vQ2FsZW5kYXI6IGZhbHNlLA0KICAgICAgbm93OiBuZXcgRGF0ZSgpLA0KICAgICAgb25DaGFuZ2U6IFtdLA0KICAgICAgb25DbG9zZTogW10sDQogICAgICBvbkRheUNyZWF0ZTogW10sDQogICAgICBvbkRlc3Ryb3k6IFtdLA0KICAgICAgb25LZXlEb3duOiBbXSwNCiAgICAgIG9uTW9udGhDaGFuZ2U6IFtdLA0KICAgICAgb25PcGVuOiBbXSwNCiAgICAgIG9uUGFyc2VDb25maWc6IFtdLA0KICAgICAgb25SZWFkeTogW10sDQogICAgICBvblZhbHVlVXBkYXRlOiBbXSwNCiAgICAgIG9uWWVhckNoYW5nZTogW10sDQogICAgICBvblByZUNhbGVuZGFyUG9zaXRpb246IFtdLA0KICAgICAgcGx1Z2luczogW10sDQogICAgICBwb3NpdGlvbjogImF1dG8iLA0KICAgICAgcG9zaXRpb25FbGVtZW50OiB1bmRlZmluZWQsDQogICAgICBwcmV2QXJyb3c6ICI8c3ZnIHZlcnNpb249JzEuMScgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB4bWxuczp4bGluaz0naHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluaycgdmlld0JveD0nMCAwIDE3IDE3Jz48Zz48L2c+PHBhdGggZD0nTTUuMjA3IDguNDcxbDcuMTQ2IDcuMTQ3LTAuNzA3IDAuNzA3LTcuODUzLTcuODU0IDcuODU0LTcuODUzIDAuNzA3IDAuNzA3LTcuMTQ3IDcuMTQ2eicgLz48L3N2Zz4iLA0KICAgICAgc2hvcnRoYW5kQ3VycmVudE1vbnRoOiBmYWxzZSwNCiAgICAgIHNob3dNb250aHM6IDEsDQogICAgICBzdGF0aWM6IGZhbHNlLA0KICAgICAgdGltZV8yNGhyOiBmYWxzZSwNCiAgICAgIHdlZWtOdW1iZXJzOiBmYWxzZSwNCiAgICAgIHdyYXA6IGZhbHNlDQogICAgfTsNCg0KICAgIGZ1bmN0aW9uIHRvZ2dsZUNsYXNzKGVsZW0sIGNsYXNzTmFtZSwgYm9vbCkgew0KICAgICAgaWYgKGJvb2wgPT09IHRydWUpIHJldHVybiBlbGVtLmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTsNCiAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpOw0KICAgIH0NCiAgICBmdW5jdGlvbiBjcmVhdGVFbGVtZW50KHRhZywgY2xhc3NOYW1lLCBjb250ZW50KSB7DQogICAgICB2YXIgZSA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7DQogICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUgfHwgIiI7DQogICAgICBjb250ZW50ID0gY29udGVudCB8fCAiIjsNCiAgICAgIGUuY2xhc3NOYW1lID0gY2xhc3NOYW1lOw0KICAgICAgaWYgKGNvbnRlbnQgIT09IHVuZGVmaW5lZCkgZS50ZXh0Q29udGVudCA9IGNvbnRlbnQ7DQogICAgICByZXR1cm4gZTsNCiAgICB9DQogICAgZnVuY3Rpb24gY2xlYXJOb2RlKG5vZGUpIHsNCiAgICAgIHdoaWxlIChub2RlLmZpcnN0Q2hpbGQpIHsNCiAgICAgICAgbm9kZS5yZW1vdmVDaGlsZChub2RlLmZpcnN0Q2hpbGQpOw0KICAgICAgfQ0KICAgIH0NCiAgICBmdW5jdGlvbiBmaW5kUGFyZW50KG5vZGUsIGNvbmRpdGlvbikgew0KICAgICAgaWYgKGNvbmRpdGlvbihub2RlKSkgcmV0dXJuIG5vZGU7ZWxzZSBpZiAobm9kZS5wYXJlbnROb2RlKSByZXR1cm4gZmluZFBhcmVudChub2RlLnBhcmVudE5vZGUsIGNvbmRpdGlvbik7DQogICAgICByZXR1cm4gdW5kZWZpbmVkOw0KICAgIH0NCiAgICBmdW5jdGlvbiBjcmVhdGVOdW1iZXJJbnB1dChpbnB1dENsYXNzTmFtZSwgb3B0cykgew0KICAgICAgdmFyIHdyYXBwZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAibnVtSW5wdXRXcmFwcGVyIiksDQogICAgICAgICAgbnVtSW5wdXQgPSBjcmVhdGVFbGVtZW50KCJpbnB1dCIsICJudW1JbnB1dCAiICsgaW5wdXRDbGFzc05hbWUpLA0KICAgICAgICAgIGFycm93VXAgPSBjcmVhdGVFbGVtZW50KCJzcGFuIiwgImFycm93VXAiKSwNCiAgICAgICAgICBhcnJvd0Rvd24gPSBjcmVhdGVFbGVtZW50KCJzcGFuIiwgImFycm93RG93biIpOw0KICAgICAgbnVtSW5wdXQudHlwZSA9ICJ0ZXh0IjsNCiAgICAgIG51bUlucHV0LnBhdHRlcm4gPSAiXFxkKiI7DQogICAgICBpZiAob3B0cyAhPT0gdW5kZWZpbmVkKSBmb3IgKHZhciBrZXkgaW4gb3B0cykgew0KICAgICAgICBudW1JbnB1dC5zZXRBdHRyaWJ1dGUoa2V5LCBvcHRzW2tleV0pOw0KICAgICAgfQ0KICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChudW1JbnB1dCk7DQogICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKGFycm93VXApOw0KICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChhcnJvd0Rvd24pOw0KICAgICAgcmV0dXJuIHdyYXBwZXI7DQogICAgfQ0KDQogICAgaWYgKHR5cGVvZiBPYmplY3QuYXNzaWduICE9PSAiZnVuY3Rpb24iKSB7DQogICAgICBPYmplY3QuYXNzaWduID0gZnVuY3Rpb24gKHRhcmdldCkgew0KICAgICAgICBpZiAoIXRhcmdldCkgew0KICAgICAgICAgIHRocm93IFR5cGVFcnJvcigiQ2Fubm90IGNvbnZlcnQgdW5kZWZpbmVkIG9yIG51bGwgdG8gb2JqZWN0Iik7DQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuID4gMSA/IF9sZW4gLSAxIDogMCksIF9rZXkgPSAxOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7DQogICAgICAgICAgYXJnc1tfa2V5IC0gMV0gPSBhcmd1bWVudHNbX2tleV07DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcCgpIHsNCiAgICAgICAgICB2YXIgc291cmNlID0gYXJnc1tfaV07DQoNCiAgICAgICAgICBpZiAoc291cmNlKSB7DQogICAgICAgICAgICBPYmplY3Qua2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgew0KICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJncy5sZW5ndGg7IF9pKyspIHsNCiAgICAgICAgICBfbG9vcCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHRhcmdldDsNCiAgICAgIH07DQogICAgfQ0KDQogICAgdmFyIERFQk9VTkNFRF9DSEFOR0VfTVMgPSAzMDA7DQoNCiAgICBmdW5jdGlvbiBGbGF0cGlja3JJbnN0YW5jZShlbGVtZW50LCBpbnN0YW5jZUNvbmZpZykgew0KICAgICAgdmFyIHNlbGYgPSB7DQogICAgICAgIGNvbmZpZzogT2JqZWN0LmFzc2lnbih7fSwgZmxhdHBpY2tyLmRlZmF1bHRDb25maWcpLA0KICAgICAgICBsMTBuOiBlbmdsaXNoDQogICAgICB9Ow0KICAgICAgc2VsZi5wYXJzZURhdGUgPSBjcmVhdGVEYXRlUGFyc2VyKHsNCiAgICAgICAgY29uZmlnOiBzZWxmLmNvbmZpZywNCiAgICAgICAgbDEwbjogc2VsZi5sMTBuDQogICAgICB9KTsNCiAgICAgIHNlbGYuX2hhbmRsZXJzID0gW107DQogICAgICBzZWxmLl9iaW5kID0gYmluZDsNCiAgICAgIHNlbGYuX3NldEhvdXJzRnJvbURhdGUgPSBzZXRIb3Vyc0Zyb21EYXRlOw0KICAgICAgc2VsZi5fcG9zaXRpb25DYWxlbmRhciA9IHBvc2l0aW9uQ2FsZW5kYXI7DQogICAgICBzZWxmLmNoYW5nZU1vbnRoID0gY2hhbmdlTW9udGg7DQogICAgICBzZWxmLmNoYW5nZVllYXIgPSBjaGFuZ2VZZWFyOw0KICAgICAgc2VsZi5jbGVhciA9IGNsZWFyOw0KICAgICAgc2VsZi5jbG9zZSA9IGNsb3NlOw0KICAgICAgc2VsZi5fY3JlYXRlRWxlbWVudCA9IGNyZWF0ZUVsZW1lbnQ7DQogICAgICBzZWxmLmRlc3Ryb3kgPSBkZXN0cm95Ow0KICAgICAgc2VsZi5pc0VuYWJsZWQgPSBpc0VuYWJsZWQ7DQogICAgICBzZWxmLmp1bXBUb0RhdGUgPSBqdW1wVG9EYXRlOw0KICAgICAgc2VsZi5vcGVuID0gb3BlbjsNCiAgICAgIHNlbGYucmVkcmF3ID0gcmVkcmF3Ow0KICAgICAgc2VsZi5zZXQgPSBzZXQ7DQogICAgICBzZWxmLnNldERhdGUgPSBzZXREYXRlOw0KICAgICAgc2VsZi50b2dnbGUgPSB0b2dnbGU7DQoNCiAgICAgIGZ1bmN0aW9uIHNldHVwSGVscGVyRnVuY3Rpb25zKCkgew0KICAgICAgICBzZWxmLnV0aWxzID0gew0KICAgICAgICAgIGdldERheXNJbk1vbnRoOiBmdW5jdGlvbiBnZXREYXlzSW5Nb250aChtb250aCwgeXIpIHsNCiAgICAgICAgICAgIGlmIChtb250aCA9PT0gdm9pZCAwKSB7DQogICAgICAgICAgICAgIG1vbnRoID0gc2VsZi5jdXJyZW50TW9udGg7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICh5ciA9PT0gdm9pZCAwKSB7DQogICAgICAgICAgICAgIHlyID0gc2VsZi5jdXJyZW50WWVhcjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKG1vbnRoID09PSAxICYmICh5ciAlIDQgPT09IDAgJiYgeXIgJSAxMDAgIT09IDAgfHwgeXIgJSA0MDAgPT09IDApKSByZXR1cm4gMjk7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5sMTBuLmRheXNJbk1vbnRoW21vbnRoXTsNCiAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGluaXQoKSB7DQogICAgICAgIHNlbGYuZWxlbWVudCA9IHNlbGYuaW5wdXQgPSBlbGVtZW50Ow0KICAgICAgICBzZWxmLmlzT3BlbiA9IGZhbHNlOw0KICAgICAgICBwYXJzZUNvbmZpZygpOw0KICAgICAgICBzZXR1cExvY2FsZSgpOw0KICAgICAgICBzZXR1cElucHV0cygpOw0KICAgICAgICBzZXR1cERhdGVzKCk7DQogICAgICAgIHNldHVwSGVscGVyRnVuY3Rpb25zKCk7DQogICAgICAgIGlmICghc2VsZi5pc01vYmlsZSkgYnVpbGQoKTsNCiAgICAgICAgYmluZEV2ZW50cygpOw0KDQogICAgICAgIGlmIChzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoIHx8IHNlbGYuY29uZmlnLm5vQ2FsZW5kYXIpIHsNCiAgICAgICAgICBpZiAoc2VsZi5jb25maWcuZW5hYmxlVGltZSkgew0KICAgICAgICAgICAgc2V0SG91cnNGcm9tRGF0ZShzZWxmLmNvbmZpZy5ub0NhbGVuZGFyID8gc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogfHwgc2VsZi5jb25maWcubWluRGF0ZSA6IHVuZGVmaW5lZCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgdXBkYXRlVmFsdWUoZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgc2V0Q2FsZW5kYXJXaWR0aCgpOw0KICAgICAgICBzZWxmLnNob3dUaW1lSW5wdXQgPSBzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID4gMCB8fCBzZWxmLmNvbmZpZy5ub0NhbGVuZGFyOw0KICAgICAgICB2YXIgaXNTYWZhcmkgPSAvXigoPyFjaHJvbWV8YW5kcm9pZCkuKSpzYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOw0KDQogICAgICAgIGlmICghc2VsZi5pc01vYmlsZSAmJiBpc1NhZmFyaSkgew0KICAgICAgICAgIHBvc2l0aW9uQ2FsZW5kYXIoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRyaWdnZXJFdmVudCgib25SZWFkeSIpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBiaW5kVG9JbnN0YW5jZShmbikgew0KICAgICAgICByZXR1cm4gZm4uYmluZChzZWxmKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gc2V0Q2FsZW5kYXJXaWR0aCgpIHsNCiAgICAgICAgdmFyIGNvbmZpZyA9IHNlbGYuY29uZmlnOw0KICAgICAgICBpZiAoY29uZmlnLndlZWtOdW1iZXJzID09PSBmYWxzZSAmJiBjb25maWcuc2hvd01vbnRocyA9PT0gMSkgcmV0dXJuO2Vsc2UgaWYgKGNvbmZpZy5ub0NhbGVuZGFyICE9PSB0cnVlKSB7DQogICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsNCiAgICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoNCiAgICAgICAgICAgIGlmIChzZWxmLmRheXNDb250YWluZXIgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICB2YXIgZGF5c1dpZHRoID0gKHNlbGYuZGF5cy5vZmZzZXRXaWR0aCArIDEpICogY29uZmlnLnNob3dNb250aHM7DQogICAgICAgICAgICAgIHNlbGYuZGF5c0NvbnRhaW5lci5zdHlsZS53aWR0aCA9IGRheXNXaWR0aCArICJweCI7DQogICAgICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuc3R5bGUud2lkdGggPSBkYXlzV2lkdGggKyAoc2VsZi53ZWVrV3JhcHBlciAhPT0gdW5kZWZpbmVkID8gc2VsZi53ZWVrV3JhcHBlci5vZmZzZXRXaWR0aCA6IDApICsgInB4IjsNCiAgICAgICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgidmlzaWJpbGl0eSIpOw0KICAgICAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLnJlbW92ZVByb3BlcnR5KCJkaXNwbGF5Iik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gdXBkYXRlVGltZShlKSB7DQogICAgICAgIGlmIChzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID09PSAwKSByZXR1cm47DQogICAgICAgIGlmIChlICE9PSB1bmRlZmluZWQgJiYgZS50eXBlICE9PSAiYmx1ciIpIHRpbWVXcmFwcGVyKGUpOw0KICAgICAgICBzZXRIb3Vyc0Zyb21JbnB1dHMoKTsNCiAgICAgICAgdXBkYXRlVmFsdWUoKTsNCg0KICAgICAgICBzZWxmLl9kZWJvdW5jZWRDaGFuZ2UoKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gYW1wbTJtaWxpdGFyeShob3VyLCBhbVBNKSB7DQogICAgICAgIHJldHVybiBob3VyICUgMTIgKyAxMiAqIGludChhbVBNID09PSBzZWxmLmwxMG4uYW1QTVsxXSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIG1pbGl0YXJ5MmFtcG0oaG91cikgew0KICAgICAgICBzd2l0Y2ggKGhvdXIgJSAyNCkgew0KICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICBjYXNlIDEyOg0KICAgICAgICAgICAgcmV0dXJuIDEyOw0KDQogICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHJldHVybiBob3VyICUgMTI7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gc2V0SG91cnNGcm9tSW5wdXRzKCkgew0KICAgICAgICBpZiAoc2VsZi5ob3VyRWxlbWVudCA9PT0gdW5kZWZpbmVkIHx8IHNlbGYubWludXRlRWxlbWVudCA9PT0gdW5kZWZpbmVkKSByZXR1cm47DQogICAgICAgIHZhciBob3VycyA9IChwYXJzZUludChzZWxmLmhvdXJFbGVtZW50LnZhbHVlLnNsaWNlKC0yKSwgMTApIHx8IDApICUgMjQsDQogICAgICAgICAgICBtaW51dGVzID0gKHBhcnNlSW50KHNlbGYubWludXRlRWxlbWVudC52YWx1ZSwgMTApIHx8IDApICUgNjAsDQogICAgICAgICAgICBzZWNvbmRzID0gc2VsZi5zZWNvbmRFbGVtZW50ICE9PSB1bmRlZmluZWQgPyAocGFyc2VJbnQoc2VsZi5zZWNvbmRFbGVtZW50LnZhbHVlLCAxMCkgfHwgMCkgJSA2MCA6IDA7DQoNCiAgICAgICAgaWYgKHNlbGYuYW1QTSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgaG91cnMgPSBhbXBtMm1pbGl0YXJ5KGhvdXJzLCBzZWxmLmFtUE0udGV4dENvbnRlbnQpOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGxpbWl0TWluSG91cnMgPSBzZWxmLmNvbmZpZy5taW5UaW1lICE9PSB1bmRlZmluZWQgfHwgc2VsZi5jb25maWcubWluRGF0ZSAmJiBzZWxmLm1pbkRhdGVIYXNUaW1lICYmIHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqICYmIGNvbXBhcmVEYXRlcyhzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiwgc2VsZi5jb25maWcubWluRGF0ZSwgdHJ1ZSkgPT09IDA7DQogICAgICAgIHZhciBsaW1pdE1heEhvdXJzID0gc2VsZi5jb25maWcubWF4VGltZSAhPT0gdW5kZWZpbmVkIHx8IHNlbGYuY29uZmlnLm1heERhdGUgJiYgc2VsZi5tYXhEYXRlSGFzVGltZSAmJiBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiAmJiBjb21wYXJlRGF0ZXMoc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmosIHNlbGYuY29uZmlnLm1heERhdGUsIHRydWUpID09PSAwOw0KDQogICAgICAgIGlmIChsaW1pdE1heEhvdXJzKSB7DQogICAgICAgICAgdmFyIG1heFRpbWUgPSBzZWxmLmNvbmZpZy5tYXhUaW1lICE9PSB1bmRlZmluZWQgPyBzZWxmLmNvbmZpZy5tYXhUaW1lIDogc2VsZi5jb25maWcubWF4RGF0ZTsNCiAgICAgICAgICBob3VycyA9IE1hdGgubWluKGhvdXJzLCBtYXhUaW1lLmdldEhvdXJzKCkpOw0KICAgICAgICAgIGlmIChob3VycyA9PT0gbWF4VGltZS5nZXRIb3VycygpKSBtaW51dGVzID0gTWF0aC5taW4obWludXRlcywgbWF4VGltZS5nZXRNaW51dGVzKCkpOw0KICAgICAgICAgIGlmIChtaW51dGVzID09PSBtYXhUaW1lLmdldE1pbnV0ZXMoKSkgc2Vjb25kcyA9IE1hdGgubWluKHNlY29uZHMsIG1heFRpbWUuZ2V0U2Vjb25kcygpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChsaW1pdE1pbkhvdXJzKSB7DQogICAgICAgICAgdmFyIG1pblRpbWUgPSBzZWxmLmNvbmZpZy5taW5UaW1lICE9PSB1bmRlZmluZWQgPyBzZWxmLmNvbmZpZy5taW5UaW1lIDogc2VsZi5jb25maWcubWluRGF0ZTsNCiAgICAgICAgICBob3VycyA9IE1hdGgubWF4KGhvdXJzLCBtaW5UaW1lLmdldEhvdXJzKCkpOw0KICAgICAgICAgIGlmIChob3VycyA9PT0gbWluVGltZS5nZXRIb3VycygpKSBtaW51dGVzID0gTWF0aC5tYXgobWludXRlcywgbWluVGltZS5nZXRNaW51dGVzKCkpOw0KICAgICAgICAgIGlmIChtaW51dGVzID09PSBtaW5UaW1lLmdldE1pbnV0ZXMoKSkgc2Vjb25kcyA9IE1hdGgubWF4KHNlY29uZHMsIG1pblRpbWUuZ2V0U2Vjb25kcygpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHNldEhvdXJzKGhvdXJzLCBtaW51dGVzLCBzZWNvbmRzKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gc2V0SG91cnNGcm9tRGF0ZShkYXRlT2JqKSB7DQogICAgICAgIHZhciBkYXRlID0gZGF0ZU9iaiB8fCBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iajsNCiAgICAgICAgaWYgKGRhdGUpIHNldEhvdXJzKGRhdGUuZ2V0SG91cnMoKSwgZGF0ZS5nZXRNaW51dGVzKCksIGRhdGUuZ2V0U2Vjb25kcygpKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gc2V0RGVmYXVsdEhvdXJzKCkgew0KICAgICAgICB2YXIgaG91cnMgPSBzZWxmLmNvbmZpZy5kZWZhdWx0SG91cjsNCiAgICAgICAgdmFyIG1pbnV0ZXMgPSBzZWxmLmNvbmZpZy5kZWZhdWx0TWludXRlOw0KICAgICAgICB2YXIgc2Vjb25kcyA9IHNlbGYuY29uZmlnLmRlZmF1bHRTZWNvbmRzOw0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5taW5EYXRlICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICB2YXIgbWluX2hyID0gc2VsZi5jb25maWcubWluRGF0ZS5nZXRIb3VycygpOw0KICAgICAgICAgIHZhciBtaW5fbWludXRlcyA9IHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0TWludXRlcygpOw0KICAgICAgICAgIGhvdXJzID0gTWF0aC5tYXgoaG91cnMsIG1pbl9ocik7DQogICAgICAgICAgaWYgKGhvdXJzID09PSBtaW5faHIpIG1pbnV0ZXMgPSBNYXRoLm1heChtaW5fbWludXRlcywgbWludXRlcyk7DQogICAgICAgICAgaWYgKGhvdXJzID09PSBtaW5faHIgJiYgbWludXRlcyA9PT0gbWluX21pbnV0ZXMpIHNlY29uZHMgPSBzZWxmLmNvbmZpZy5taW5EYXRlLmdldFNlY29uZHMoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tYXhEYXRlICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICB2YXIgbWF4X2hyID0gc2VsZi5jb25maWcubWF4RGF0ZS5nZXRIb3VycygpOw0KICAgICAgICAgIHZhciBtYXhfbWludXRlcyA9IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0TWludXRlcygpOw0KICAgICAgICAgIGhvdXJzID0gTWF0aC5taW4oaG91cnMsIG1heF9ocik7DQogICAgICAgICAgaWYgKGhvdXJzID09PSBtYXhfaHIpIG1pbnV0ZXMgPSBNYXRoLm1pbihtYXhfbWludXRlcywgbWludXRlcyk7DQogICAgICAgICAgaWYgKGhvdXJzID09PSBtYXhfaHIgJiYgbWludXRlcyA9PT0gbWF4X21pbnV0ZXMpIHNlY29uZHMgPSBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldFNlY29uZHMoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHNldEhvdXJzKGhvdXJzLCBtaW51dGVzLCBzZWNvbmRzKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gc2V0SG91cnMoaG91cnMsIG1pbnV0ZXMsIHNlY29uZHMpIHsNCiAgICAgICAgaWYgKHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iai5zZXRIb3Vycyhob3VycyAlIDI0LCBtaW51dGVzLCBzZWNvbmRzIHx8IDAsIDApOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCFzZWxmLmhvdXJFbGVtZW50IHx8ICFzZWxmLm1pbnV0ZUVsZW1lbnQgfHwgc2VsZi5pc01vYmlsZSkgcmV0dXJuOw0KICAgICAgICBzZWxmLmhvdXJFbGVtZW50LnZhbHVlID0gcGFkKCFzZWxmLmNvbmZpZy50aW1lXzI0aHIgPyAoMTIgKyBob3VycykgJSAxMiArIDEyICogaW50KGhvdXJzICUgMTIgPT09IDApIDogaG91cnMpOw0KICAgICAgICBzZWxmLm1pbnV0ZUVsZW1lbnQudmFsdWUgPSBwYWQobWludXRlcyk7DQogICAgICAgIGlmIChzZWxmLmFtUE0gIT09IHVuZGVmaW5lZCkgc2VsZi5hbVBNLnRleHRDb250ZW50ID0gc2VsZi5sMTBuLmFtUE1baW50KGhvdXJzID49IDEyKV07DQogICAgICAgIGlmIChzZWxmLnNlY29uZEVsZW1lbnQgIT09IHVuZGVmaW5lZCkgc2VsZi5zZWNvbmRFbGVtZW50LnZhbHVlID0gcGFkKHNlY29uZHMpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBvblllYXJJbnB1dChldmVudCkgew0KICAgICAgICB2YXIgeWVhciA9IHBhcnNlSW50KGV2ZW50LnRhcmdldC52YWx1ZSkgKyAoZXZlbnQuZGVsdGEgfHwgMCk7DQoNCiAgICAgICAgaWYgKHllYXIgLyAxMDAwID4gMSB8fCBldmVudC5rZXkgPT09ICJFbnRlciIgJiYgIS9bXlxkXS8udGVzdCh5ZWFyLnRvU3RyaW5nKCkpKSB7DQogICAgICAgICAgY2hhbmdlWWVhcih5ZWFyKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBiaW5kKGVsZW1lbnQsIGV2ZW50LCBoYW5kbGVyLCBvcHRpb25zKSB7DQogICAgICAgIGlmIChldmVudCBpbnN0YW5jZW9mIEFycmF5KSByZXR1cm4gZXZlbnQuZm9yRWFjaChmdW5jdGlvbiAoZXYpIHsNCiAgICAgICAgICByZXR1cm4gYmluZChlbGVtZW50LCBldiwgaGFuZGxlciwgb3B0aW9ucyk7DQogICAgICAgIH0pOw0KICAgICAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIEFycmF5KSByZXR1cm4gZWxlbWVudC5mb3JFYWNoKGZ1bmN0aW9uIChlbCkgew0KICAgICAgICAgIHJldHVybiBiaW5kKGVsLCBldmVudCwgaGFuZGxlciwgb3B0aW9ucyk7DQogICAgICAgIH0pOw0KICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGhhbmRsZXIsIG9wdGlvbnMpOw0KDQogICAgICAgIHNlbGYuX2hhbmRsZXJzLnB1c2goew0KICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsDQogICAgICAgICAgZXZlbnQ6IGV2ZW50LA0KICAgICAgICAgIGhhbmRsZXI6IGhhbmRsZXIsDQogICAgICAgICAgb3B0aW9uczogb3B0aW9ucw0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gb25DbGljayhoYW5kbGVyKSB7DQogICAgICAgIHJldHVybiBmdW5jdGlvbiAoZXZ0KSB7DQogICAgICAgICAgZXZ0LndoaWNoID09PSAxICYmIGhhbmRsZXIoZXZ0KTsNCiAgICAgICAgfTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gdHJpZ2dlckNoYW5nZSgpIHsNCiAgICAgICAgdHJpZ2dlckV2ZW50KCJvbkNoYW5nZSIpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBiaW5kRXZlbnRzKCkgew0KICAgICAgICBpZiAoc2VsZi5jb25maWcud3JhcCkgew0KICAgICAgICAgIFsib3BlbiIsICJjbG9zZSIsICJ0b2dnbGUiLCAiY2xlYXIiXS5mb3JFYWNoKGZ1bmN0aW9uIChldnQpIHsNCiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoc2VsZi5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLSIgKyBldnQgKyAiXSIpLCBmdW5jdGlvbiAoZWwpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGJpbmQoZWwsICJjbGljayIsIHNlbGZbZXZ0XSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLmlzTW9iaWxlKSB7DQogICAgICAgICAgc2V0dXBNb2JpbGUoKTsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgZGVib3VuY2VkUmVzaXplID0gZGVib3VuY2Uob25SZXNpemUsIDUwKTsNCiAgICAgICAgc2VsZi5fZGVib3VuY2VkQ2hhbmdlID0gZGVib3VuY2UodHJpZ2dlckNoYW5nZSwgREVCT1VOQ0VEX0NIQU5HRV9NUyk7DQogICAgICAgIGlmIChzZWxmLmRheXNDb250YWluZXIgJiYgIS9pUGhvbmV8aVBhZHxpUG9kL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgYmluZChzZWxmLmRheXNDb250YWluZXIsICJtb3VzZW92ZXIiLCBmdW5jdGlvbiAoZSkgew0KICAgICAgICAgIGlmIChzZWxmLmNvbmZpZy5tb2RlID09PSAicmFuZ2UiKSBvbk1vdXNlT3ZlcihlLnRhcmdldCk7DQogICAgICAgIH0pOw0KICAgICAgICBiaW5kKHdpbmRvdy5kb2N1bWVudC5ib2R5LCAia2V5ZG93biIsIG9uS2V5RG93bik7DQogICAgICAgIGlmICghc2VsZi5jb25maWcuc3RhdGljKSBiaW5kKHNlbGYuX2lucHV0LCAia2V5ZG93biIsIG9uS2V5RG93bik7DQogICAgICAgIGlmICghc2VsZi5jb25maWcuaW5saW5lICYmICFzZWxmLmNvbmZpZy5zdGF0aWMpIGJpbmQod2luZG93LCAicmVzaXplIiwgZGVib3VuY2VkUmVzaXplKTsNCiAgICAgICAgaWYgKHdpbmRvdy5vbnRvdWNoc3RhcnQgIT09IHVuZGVmaW5lZCkgYmluZCh3aW5kb3cuZG9jdW1lbnQsICJjbGljayIsIGRvY3VtZW50Q2xpY2spO2Vsc2UgYmluZCh3aW5kb3cuZG9jdW1lbnQsICJtb3VzZWRvd24iLCBvbkNsaWNrKGRvY3VtZW50Q2xpY2spKTsNCiAgICAgICAgYmluZCh3aW5kb3cuZG9jdW1lbnQsICJmb2N1cyIsIGRvY3VtZW50Q2xpY2ssIHsNCiAgICAgICAgICBjYXB0dXJlOiB0cnVlDQogICAgICAgIH0pOw0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5jbGlja09wZW5zID09PSB0cnVlKSB7DQogICAgICAgICAgYmluZChzZWxmLl9pbnB1dCwgImZvY3VzIiwgc2VsZi5vcGVuKTsNCiAgICAgICAgICBiaW5kKHNlbGYuX2lucHV0LCAibW91c2Vkb3duIiwgb25DbGljayhzZWxmLm9wZW4pKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLmRheXNDb250YWluZXIgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgIGJpbmQoc2VsZi5tb250aE5hdiwgIm1vdXNlZG93biIsIG9uQ2xpY2sob25Nb250aE5hdkNsaWNrKSk7DQogICAgICAgICAgYmluZChzZWxmLm1vbnRoTmF2LCBbImtleXVwIiwgImluY3JlbWVudCJdLCBvblllYXJJbnB1dCk7DQogICAgICAgICAgYmluZChzZWxmLmRheXNDb250YWluZXIsICJtb3VzZWRvd24iLCBvbkNsaWNrKHNlbGVjdERhdGUpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLnRpbWVDb250YWluZXIgIT09IHVuZGVmaW5lZCAmJiBzZWxmLm1pbnV0ZUVsZW1lbnQgIT09IHVuZGVmaW5lZCAmJiBzZWxmLmhvdXJFbGVtZW50ICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICB2YXIgc2VsVGV4dCA9IGZ1bmN0aW9uIHNlbFRleHQoZSkgew0KICAgICAgICAgICAgcmV0dXJuIGUudGFyZ2V0LnNlbGVjdCgpOw0KICAgICAgICAgIH07DQoNCiAgICAgICAgICBiaW5kKHNlbGYudGltZUNvbnRhaW5lciwgWyJpbmNyZW1lbnQiXSwgdXBkYXRlVGltZSk7DQogICAgICAgICAgYmluZChzZWxmLnRpbWVDb250YWluZXIsICJibHVyIiwgdXBkYXRlVGltZSwgew0KICAgICAgICAgICAgY2FwdHVyZTogdHJ1ZQ0KICAgICAgICAgIH0pOw0KICAgICAgICAgIGJpbmQoc2VsZi50aW1lQ29udGFpbmVyLCAibW91c2Vkb3duIiwgb25DbGljayh0aW1lSW5jcmVtZW50KSk7DQogICAgICAgICAgYmluZChbc2VsZi5ob3VyRWxlbWVudCwgc2VsZi5taW51dGVFbGVtZW50XSwgWyJmb2N1cyIsICJjbGljayJdLCBzZWxUZXh0KTsNCiAgICAgICAgICBpZiAoc2VsZi5zZWNvbmRFbGVtZW50ICE9PSB1bmRlZmluZWQpIGJpbmQoc2VsZi5zZWNvbmRFbGVtZW50LCAiZm9jdXMiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5zZWNvbmRFbGVtZW50ICYmIHNlbGYuc2Vjb25kRWxlbWVudC5zZWxlY3QoKTsNCiAgICAgICAgICB9KTsNCg0KICAgICAgICAgIGlmIChzZWxmLmFtUE0gIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgYmluZChzZWxmLmFtUE0sICJtb3VzZWRvd24iLCBvbkNsaWNrKGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICAgIHVwZGF0ZVRpbWUoZSk7DQogICAgICAgICAgICAgIHRyaWdnZXJDaGFuZ2UoKTsNCiAgICAgICAgICAgIH0pKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24ganVtcFRvRGF0ZShqdW1wRGF0ZSkgew0KICAgICAgICB2YXIganVtcFRvID0ganVtcERhdGUgIT09IHVuZGVmaW5lZCA/IHNlbGYucGFyc2VEYXRlKGp1bXBEYXRlKSA6IHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqIHx8IChzZWxmLmNvbmZpZy5taW5EYXRlICYmIHNlbGYuY29uZmlnLm1pbkRhdGUgPiBzZWxmLm5vdyA/IHNlbGYuY29uZmlnLm1pbkRhdGUgOiBzZWxmLmNvbmZpZy5tYXhEYXRlICYmIHNlbGYuY29uZmlnLm1heERhdGUgPCBzZWxmLm5vdyA/IHNlbGYuY29uZmlnLm1heERhdGUgOiBzZWxmLm5vdyk7DQoNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBpZiAoanVtcFRvICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIHNlbGYuY3VycmVudFllYXIgPSBqdW1wVG8uZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICAgIHNlbGYuY3VycmVudE1vbnRoID0ganVtcFRvLmdldE1vbnRoKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgZS5tZXNzYWdlID0gIkludmFsaWQgZGF0ZSBzdXBwbGllZDogIiArIGp1bXBUbzsNCiAgICAgICAgICBzZWxmLmNvbmZpZy5lcnJvckhhbmRsZXIoZSk7DQogICAgICAgIH0NCg0KICAgICAgICBzZWxmLnJlZHJhdygpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiB0aW1lSW5jcmVtZW50KGUpIHsNCiAgICAgICAgaWYgKH5lLnRhcmdldC5jbGFzc05hbWUuaW5kZXhPZigiYXJyb3ciKSkgaW5jcmVtZW50TnVtSW5wdXQoZSwgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJhcnJvd1VwIikgPyAxIDogLTEpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBpbmNyZW1lbnROdW1JbnB1dChlLCBkZWx0YSwgaW5wdXRFbGVtKSB7DQogICAgICAgIHZhciB0YXJnZXQgPSBlICYmIGUudGFyZ2V0Ow0KICAgICAgICB2YXIgaW5wdXQgPSBpbnB1dEVsZW0gfHwgdGFyZ2V0ICYmIHRhcmdldC5wYXJlbnROb2RlICYmIHRhcmdldC5wYXJlbnROb2RlLmZpcnN0Q2hpbGQ7DQogICAgICAgIHZhciBldmVudCA9IGNyZWF0ZUV2ZW50KCJpbmNyZW1lbnQiKTsNCiAgICAgICAgZXZlbnQuZGVsdGEgPSBkZWx0YTsNCiAgICAgICAgaW5wdXQgJiYgaW5wdXQuZGlzcGF0Y2hFdmVudChldmVudCk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGJ1aWxkKCkgew0KICAgICAgICB2YXIgZnJhZ21lbnQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci1jYWxlbmRhciIpOw0KICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnRhYkluZGV4ID0gLTE7DQoNCiAgICAgICAgaWYgKCFzZWxmLmNvbmZpZy5ub0NhbGVuZGFyKSB7DQogICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoYnVpbGRNb250aE5hdigpKTsNCiAgICAgICAgICBzZWxmLmlubmVyQ29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci1pbm5lckNvbnRhaW5lciIpOw0KDQogICAgICAgICAgaWYgKHNlbGYuY29uZmlnLndlZWtOdW1iZXJzKSB7DQogICAgICAgICAgICB2YXIgX2J1aWxkV2Vla3MgPSBidWlsZFdlZWtzKCksDQogICAgICAgICAgICAgICAgd2Vla1dyYXBwZXIgPSBfYnVpbGRXZWVrcy53ZWVrV3JhcHBlciwNCiAgICAgICAgICAgICAgICB3ZWVrTnVtYmVycyA9IF9idWlsZFdlZWtzLndlZWtOdW1iZXJzOw0KDQogICAgICAgICAgICBzZWxmLmlubmVyQ29udGFpbmVyLmFwcGVuZENoaWxkKHdlZWtXcmFwcGVyKTsNCiAgICAgICAgICAgIHNlbGYud2Vla051bWJlcnMgPSB3ZWVrTnVtYmVyczsNCiAgICAgICAgICAgIHNlbGYud2Vla1dyYXBwZXIgPSB3ZWVrV3JhcHBlcjsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBzZWxmLnJDb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLXJDb250YWluZXIiKTsNCiAgICAgICAgICBzZWxmLnJDb250YWluZXIuYXBwZW5kQ2hpbGQoYnVpbGRXZWVrZGF5cygpKTsNCg0KICAgICAgICAgIGlmICghc2VsZi5kYXlzQ29udGFpbmVyKSB7DQogICAgICAgICAgICBzZWxmLmRheXNDb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLWRheXMiKTsNCiAgICAgICAgICAgIHNlbGYuZGF5c0NvbnRhaW5lci50YWJJbmRleCA9IC0xOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGJ1aWxkRGF5cygpOw0KICAgICAgICAgIHNlbGYuckNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWxmLmRheXNDb250YWluZXIpOw0KICAgICAgICAgIHNlbGYuaW5uZXJDb250YWluZXIuYXBwZW5kQ2hpbGQoc2VsZi5yQ29udGFpbmVyKTsNCiAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChzZWxmLmlubmVyQ29udGFpbmVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5lbmFibGVUaW1lKSB7DQogICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoYnVpbGRUaW1lKCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgdG9nZ2xlQ2xhc3Moc2VsZi5jYWxlbmRhckNvbnRhaW5lciwgInJhbmdlTW9kZSIsIHNlbGYuY29uZmlnLm1vZGUgPT09ICJyYW5nZSIpOw0KICAgICAgICB0b2dnbGVDbGFzcyhzZWxmLmNhbGVuZGFyQ29udGFpbmVyLCAiYW5pbWF0ZSIsIHNlbGYuY29uZmlnLmFuaW1hdGUgPT09IHRydWUpOw0KICAgICAgICB0b2dnbGVDbGFzcyhzZWxmLmNhbGVuZGFyQ29udGFpbmVyLCAibXVsdGlNb250aCIsIHNlbGYuY29uZmlnLnNob3dNb250aHMgPiAxKTsNCiAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5hcHBlbmRDaGlsZChmcmFnbWVudCk7DQogICAgICAgIHZhciBjdXN0b21BcHBlbmQgPSBzZWxmLmNvbmZpZy5hcHBlbmRUbyAhPT0gdW5kZWZpbmVkICYmIHNlbGYuY29uZmlnLmFwcGVuZFRvLm5vZGVUeXBlICE9PSB1bmRlZmluZWQ7DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmlubGluZSB8fCBzZWxmLmNvbmZpZy5zdGF0aWMpIHsNCiAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoc2VsZi5jb25maWcuaW5saW5lID8gImlubGluZSIgOiAic3RhdGljIik7DQoNCiAgICAgICAgICBpZiAoc2VsZi5jb25maWcuaW5saW5lKSB7DQogICAgICAgICAgICBpZiAoIWN1c3RvbUFwcGVuZCAmJiBzZWxmLmVsZW1lbnQucGFyZW50Tm9kZSkgc2VsZi5lbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHNlbGYuY2FsZW5kYXJDb250YWluZXIsIHNlbGYuX2lucHV0Lm5leHRTaWJsaW5nKTtlbHNlIGlmIChzZWxmLmNvbmZpZy5hcHBlbmRUbyAhPT0gdW5kZWZpbmVkKSBzZWxmLmNvbmZpZy5hcHBlbmRUby5hcHBlbmRDaGlsZChzZWxmLmNhbGVuZGFyQ29udGFpbmVyKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpZiAoc2VsZi5jb25maWcuc3RhdGljKSB7DQogICAgICAgICAgICB2YXIgd3JhcHBlciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3Itd3JhcHBlciIpOw0KICAgICAgICAgICAgaWYgKHNlbGYuZWxlbWVudC5wYXJlbnROb2RlKSBzZWxmLmVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUod3JhcHBlciwgc2VsZi5lbGVtZW50KTsNCiAgICAgICAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoc2VsZi5lbGVtZW50KTsNCiAgICAgICAgICAgIGlmIChzZWxmLmFsdElucHV0KSB3cmFwcGVyLmFwcGVuZENoaWxkKHNlbGYuYWx0SW5wdXQpOw0KICAgICAgICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChzZWxmLmNhbGVuZGFyQ29udGFpbmVyKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIXNlbGYuY29uZmlnLnN0YXRpYyAmJiAhc2VsZi5jb25maWcuaW5saW5lKSAoc2VsZi5jb25maWcuYXBwZW5kVG8gIT09IHVuZGVmaW5lZCA/IHNlbGYuY29uZmlnLmFwcGVuZFRvIDogd2luZG93LmRvY3VtZW50LmJvZHkpLmFwcGVuZENoaWxkKHNlbGYuY2FsZW5kYXJDb250YWluZXIpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBjcmVhdGVEYXkoY2xhc3NOYW1lLCBkYXRlLCBkYXlOdW1iZXIsIGkpIHsNCiAgICAgICAgdmFyIGRhdGVJc0VuYWJsZWQgPSBpc0VuYWJsZWQoZGF0ZSwgdHJ1ZSksDQogICAgICAgICAgICBkYXlFbGVtZW50ID0gY3JlYXRlRWxlbWVudCgic3BhbiIsICJmbGF0cGlja3ItZGF5ICIgKyBjbGFzc05hbWUsIGRhdGUuZ2V0RGF0ZSgpLnRvU3RyaW5nKCkpOw0KICAgICAgICBkYXlFbGVtZW50LmRhdGVPYmogPSBkYXRlOw0KICAgICAgICBkYXlFbGVtZW50LiRpID0gaTsNCiAgICAgICAgZGF5RWxlbWVudC5zZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWwiLCBzZWxmLmZvcm1hdERhdGUoZGF0ZSwgc2VsZi5jb25maWcuYXJpYURhdGVGb3JtYXQpKTsNCg0KICAgICAgICBpZiAoY2xhc3NOYW1lLmluZGV4T2YoImhpZGRlbiIpID09PSAtMSAmJiBjb21wYXJlRGF0ZXMoZGF0ZSwgc2VsZi5ub3cpID09PSAwKSB7DQogICAgICAgICAgc2VsZi50b2RheURhdGVFbGVtID0gZGF5RWxlbWVudDsNCiAgICAgICAgICBkYXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoInRvZGF5Iik7DQogICAgICAgICAgZGF5RWxlbWVudC5zZXRBdHRyaWJ1dGUoImFyaWEtY3VycmVudCIsICJkYXRlIik7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoZGF0ZUlzRW5hYmxlZCkgew0KICAgICAgICAgIGRheUVsZW1lbnQudGFiSW5kZXggPSAtMTsNCg0KICAgICAgICAgIGlmIChpc0RhdGVTZWxlY3RlZChkYXRlKSkgew0KICAgICAgICAgICAgZGF5RWxlbWVudC5jbGFzc0xpc3QuYWRkKCJzZWxlY3RlZCIpOw0KICAgICAgICAgICAgc2VsZi5zZWxlY3RlZERhdGVFbGVtID0gZGF5RWxlbWVudDsNCg0KICAgICAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1vZGUgPT09ICJyYW5nZSIpIHsNCiAgICAgICAgICAgICAgdG9nZ2xlQ2xhc3MoZGF5RWxlbWVudCwgInN0YXJ0UmFuZ2UiLCBzZWxmLnNlbGVjdGVkRGF0ZXNbMF0gJiYgY29tcGFyZURhdGVzKGRhdGUsIHNlbGYuc2VsZWN0ZWREYXRlc1swXSwgdHJ1ZSkgPT09IDApOw0KICAgICAgICAgICAgICB0b2dnbGVDbGFzcyhkYXlFbGVtZW50LCAiZW5kUmFuZ2UiLCBzZWxmLnNlbGVjdGVkRGF0ZXNbMV0gJiYgY29tcGFyZURhdGVzKGRhdGUsIHNlbGYuc2VsZWN0ZWREYXRlc1sxXSwgdHJ1ZSkgPT09IDApOw0KICAgICAgICAgICAgICBpZiAoY2xhc3NOYW1lID09PSAibmV4dE1vbnRoRGF5IikgZGF5RWxlbWVudC5jbGFzc0xpc3QuYWRkKCJpblJhbmdlIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGRheUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgiZGlzYWJsZWQiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tb2RlID09PSAicmFuZ2UiKSB7DQogICAgICAgICAgaWYgKGlzRGF0ZUluUmFuZ2UoZGF0ZSkgJiYgIWlzRGF0ZVNlbGVjdGVkKGRhdGUpKSBkYXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoImluUmFuZ2UiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLndlZWtOdW1iZXJzICYmIHNlbGYuY29uZmlnLnNob3dNb250aHMgPT09IDEgJiYgY2xhc3NOYW1lICE9PSAicHJldk1vbnRoRGF5IiAmJiBkYXlOdW1iZXIgJSA3ID09PSAxKSB7DQogICAgICAgICAgc2VsZi53ZWVrTnVtYmVycy5pbnNlcnRBZGphY2VudEhUTUwoImJlZm9yZWVuZCIsICI8c3BhbiBjbGFzcz0nZmxhdHBpY2tyLWRheSc+IiArIHNlbGYuY29uZmlnLmdldFdlZWsoZGF0ZSkgKyAiPC9zcGFuPiIpOw0KICAgICAgICB9DQoNCiAgICAgICAgdHJpZ2dlckV2ZW50KCJvbkRheUNyZWF0ZSIsIGRheUVsZW1lbnQpOw0KICAgICAgICByZXR1cm4gZGF5RWxlbWVudDsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gZm9jdXNPbkRheUVsZW0odGFyZ2V0Tm9kZSkgew0KICAgICAgICB0YXJnZXROb2RlLmZvY3VzKCk7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tb2RlID09PSAicmFuZ2UiKSBvbk1vdXNlT3Zlcih0YXJnZXROb2RlKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gZ2V0Rmlyc3RBdmFpbGFibGVEYXkoZGVsdGEpIHsNCiAgICAgICAgdmFyIHN0YXJ0TW9udGggPSBkZWx0YSA+IDAgPyAwIDogc2VsZi5jb25maWcuc2hvd01vbnRocyAtIDE7DQogICAgICAgIHZhciBlbmRNb250aCA9IGRlbHRhID4gMCA/IHNlbGYuY29uZmlnLnNob3dNb250aHMgOiAtMTsNCg0KICAgICAgICBmb3IgKHZhciBtID0gc3RhcnRNb250aDsgbSAhPSBlbmRNb250aDsgbSArPSBkZWx0YSkgew0KICAgICAgICAgIHZhciBtb250aCA9IHNlbGYuZGF5c0NvbnRhaW5lci5jaGlsZHJlblttXTsNCiAgICAgICAgICB2YXIgc3RhcnRJbmRleCA9IGRlbHRhID4gMCA/IDAgOiBtb250aC5jaGlsZHJlbi5sZW5ndGggLSAxOw0KICAgICAgICAgIHZhciBlbmRJbmRleCA9IGRlbHRhID4gMCA/IG1vbnRoLmNoaWxkcmVuLmxlbmd0aCA6IC0xOw0KDQogICAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0SW5kZXg7IGkgIT0gZW5kSW5kZXg7IGkgKz0gZGVsdGEpIHsNCiAgICAgICAgICAgIHZhciBjID0gbW9udGguY2hpbGRyZW5baV07DQogICAgICAgICAgICBpZiAoYy5jbGFzc05hbWUuaW5kZXhPZigiaGlkZGVuIikgPT09IC0xICYmIGlzRW5hYmxlZChjLmRhdGVPYmopKSByZXR1cm4gYzsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdW5kZWZpbmVkOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBnZXROZXh0QXZhaWxhYmxlRGF5KGN1cnJlbnQsIGRlbHRhKSB7DQogICAgICAgIHZhciBnaXZlbk1vbnRoID0gY3VycmVudC5jbGFzc05hbWUuaW5kZXhPZigiTW9udGgiKSA9PT0gLTEgPyBjdXJyZW50LmRhdGVPYmouZ2V0TW9udGgoKSA6IHNlbGYuY3VycmVudE1vbnRoOw0KICAgICAgICB2YXIgZW5kTW9udGggPSBkZWx0YSA+IDAgPyBzZWxmLmNvbmZpZy5zaG93TW9udGhzIDogLTE7DQogICAgICAgIHZhciBsb29wRGVsdGEgPSBkZWx0YSA+IDAgPyAxIDogLTE7DQoNCiAgICAgICAgZm9yICh2YXIgbSA9IGdpdmVuTW9udGggLSBzZWxmLmN1cnJlbnRNb250aDsgbSAhPSBlbmRNb250aDsgbSArPSBsb29wRGVsdGEpIHsNCiAgICAgICAgICB2YXIgbW9udGggPSBzZWxmLmRheXNDb250YWluZXIuY2hpbGRyZW5bbV07DQogICAgICAgICAgdmFyIHN0YXJ0SW5kZXggPSBnaXZlbk1vbnRoIC0gc2VsZi5jdXJyZW50TW9udGggPT09IG0gPyBjdXJyZW50LiRpICsgZGVsdGEgOiBkZWx0YSA8IDAgPyBtb250aC5jaGlsZHJlbi5sZW5ndGggLSAxIDogMDsNCiAgICAgICAgICB2YXIgbnVtTW9udGhEYXlzID0gbW9udGguY2hpbGRyZW4ubGVuZ3RoOw0KDQogICAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0SW5kZXg7IGkgPj0gMCAmJiBpIDwgbnVtTW9udGhEYXlzICYmIGkgIT0gKGRlbHRhID4gMCA/IG51bU1vbnRoRGF5cyA6IC0xKTsgaSArPSBsb29wRGVsdGEpIHsNCiAgICAgICAgICAgIHZhciBjID0gbW9udGguY2hpbGRyZW5baV07DQogICAgICAgICAgICBpZiAoYy5jbGFzc05hbWUuaW5kZXhPZigiaGlkZGVuIikgPT09IC0xICYmIGlzRW5hYmxlZChjLmRhdGVPYmopICYmIE1hdGguYWJzKGN1cnJlbnQuJGkgLSBpKSA+PSBNYXRoLmFicyhkZWx0YSkpIHJldHVybiBmb2N1c09uRGF5RWxlbShjKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBzZWxmLmNoYW5nZU1vbnRoKGxvb3BEZWx0YSk7DQogICAgICAgIGZvY3VzT25EYXkoZ2V0Rmlyc3RBdmFpbGFibGVEYXkobG9vcERlbHRhKSwgMCk7DQogICAgICAgIHJldHVybiB1bmRlZmluZWQ7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGZvY3VzT25EYXkoY3VycmVudCwgb2Zmc2V0KSB7DQogICAgICAgIHZhciBkYXlGb2N1c2VkID0gaXNJblZpZXcoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCk7DQogICAgICAgIHZhciBzdGFydEVsZW0gPSBjdXJyZW50ICE9PSB1bmRlZmluZWQgPyBjdXJyZW50IDogZGF5Rm9jdXNlZCA/IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgOiBzZWxmLnNlbGVjdGVkRGF0ZUVsZW0gIT09IHVuZGVmaW5lZCAmJiBpc0luVmlldyhzZWxmLnNlbGVjdGVkRGF0ZUVsZW0pID8gc2VsZi5zZWxlY3RlZERhdGVFbGVtIDogc2VsZi50b2RheURhdGVFbGVtICE9PSB1bmRlZmluZWQgJiYgaXNJblZpZXcoc2VsZi50b2RheURhdGVFbGVtKSA/IHNlbGYudG9kYXlEYXRlRWxlbSA6IGdldEZpcnN0QXZhaWxhYmxlRGF5KG9mZnNldCA+IDAgPyAxIDogLTEpOw0KICAgICAgICBpZiAoc3RhcnRFbGVtID09PSB1bmRlZmluZWQpIHJldHVybiBzZWxmLl9pbnB1dC5mb2N1cygpOw0KICAgICAgICBpZiAoIWRheUZvY3VzZWQpIHJldHVybiBmb2N1c09uRGF5RWxlbShzdGFydEVsZW0pOw0KICAgICAgICBnZXROZXh0QXZhaWxhYmxlRGF5KHN0YXJ0RWxlbSwgb2Zmc2V0KTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gYnVpbGRNb250aERheXMoeWVhciwgbW9udGgpIHsNCiAgICAgICAgdmFyIGZpcnN0T2ZNb250aCA9IChuZXcgRGF0ZSh5ZWFyLCBtb250aCwgMSkuZ2V0RGF5KCkgLSBzZWxmLmwxMG4uZmlyc3REYXlPZldlZWsgKyA3KSAlIDc7DQogICAgICAgIHZhciBwcmV2TW9udGhEYXlzID0gc2VsZi51dGlscy5nZXREYXlzSW5Nb250aCgobW9udGggLSAxICsgMTIpICUgMTIpOw0KICAgICAgICB2YXIgZGF5c0luTW9udGggPSBzZWxmLnV0aWxzLmdldERheXNJbk1vbnRoKG1vbnRoKSwNCiAgICAgICAgICAgIGRheXMgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLA0KICAgICAgICAgICAgaXNNdWx0aU1vbnRoID0gc2VsZi5jb25maWcuc2hvd01vbnRocyA+IDEsDQogICAgICAgICAgICBwcmV2TW9udGhEYXlDbGFzcyA9IGlzTXVsdGlNb250aCA/ICJwcmV2TW9udGhEYXkgaGlkZGVuIiA6ICJwcmV2TW9udGhEYXkiLA0KICAgICAgICAgICAgbmV4dE1vbnRoRGF5Q2xhc3MgPSBpc011bHRpTW9udGggPyAibmV4dE1vbnRoRGF5IGhpZGRlbiIgOiAibmV4dE1vbnRoRGF5IjsNCiAgICAgICAgdmFyIGRheU51bWJlciA9IHByZXZNb250aERheXMgKyAxIC0gZmlyc3RPZk1vbnRoLA0KICAgICAgICAgICAgZGF5SW5kZXggPSAwOw0KDQogICAgICAgIGZvciAoOyBkYXlOdW1iZXIgPD0gcHJldk1vbnRoRGF5czsgZGF5TnVtYmVyKyssIGRheUluZGV4KyspIHsNCiAgICAgICAgICBkYXlzLmFwcGVuZENoaWxkKGNyZWF0ZURheShwcmV2TW9udGhEYXlDbGFzcywgbmV3IERhdGUoeWVhciwgbW9udGggLSAxLCBkYXlOdW1iZXIpLCBkYXlOdW1iZXIsIGRheUluZGV4KSk7DQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKGRheU51bWJlciA9IDE7IGRheU51bWJlciA8PSBkYXlzSW5Nb250aDsgZGF5TnVtYmVyKyssIGRheUluZGV4KyspIHsNCiAgICAgICAgICBkYXlzLmFwcGVuZENoaWxkKGNyZWF0ZURheSgiIiwgbmV3IERhdGUoeWVhciwgbW9udGgsIGRheU51bWJlciksIGRheU51bWJlciwgZGF5SW5kZXgpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAodmFyIGRheU51bSA9IGRheXNJbk1vbnRoICsgMTsgZGF5TnVtIDw9IDQyIC0gZmlyc3RPZk1vbnRoICYmIChzZWxmLmNvbmZpZy5zaG93TW9udGhzID09PSAxIHx8IGRheUluZGV4ICUgNyAhPT0gMCk7IGRheU51bSsrLCBkYXlJbmRleCsrKSB7DQogICAgICAgICAgZGF5cy5hcHBlbmRDaGlsZChjcmVhdGVEYXkobmV4dE1vbnRoRGF5Q2xhc3MsIG5ldyBEYXRlKHllYXIsIG1vbnRoICsgMSwgZGF5TnVtICUgZGF5c0luTW9udGgpLCBkYXlOdW0sIGRheUluZGV4KSk7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgZGF5Q29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImRheUNvbnRhaW5lciIpOw0KICAgICAgICBkYXlDb250YWluZXIuYXBwZW5kQ2hpbGQoZGF5cyk7DQogICAgICAgIHJldHVybiBkYXlDb250YWluZXI7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGJ1aWxkRGF5cygpIHsNCiAgICAgICAgaWYgKHNlbGYuZGF5c0NvbnRhaW5lciA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgY2xlYXJOb2RlKHNlbGYuZGF5c0NvbnRhaW5lcik7DQogICAgICAgIGlmIChzZWxmLndlZWtOdW1iZXJzKSBjbGVhck5vZGUoc2VsZi53ZWVrTnVtYmVycyk7DQogICAgICAgIHZhciBmcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KDQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5jb25maWcuc2hvd01vbnRoczsgaSsrKSB7DQogICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZShzZWxmLmN1cnJlbnRZZWFyLCBzZWxmLmN1cnJlbnRNb250aCwgMSk7DQogICAgICAgICAgZC5zZXRNb250aChzZWxmLmN1cnJlbnRNb250aCArIGkpOw0KICAgICAgICAgIGZyYWcuYXBwZW5kQ2hpbGQoYnVpbGRNb250aERheXMoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCkpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHNlbGYuZGF5c0NvbnRhaW5lci5hcHBlbmRDaGlsZChmcmFnKTsNCiAgICAgICAgc2VsZi5kYXlzID0gc2VsZi5kYXlzQ29udGFpbmVyLmZpcnN0Q2hpbGQ7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGJ1aWxkTW9udGgoKSB7DQogICAgICAgIHZhciBjb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLW1vbnRoIik7DQogICAgICAgIHZhciBtb250aE5hdkZyYWdtZW50ID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCiAgICAgICAgdmFyIG1vbnRoRWxlbWVudCA9IGNyZWF0ZUVsZW1lbnQoInNwYW4iLCAiY3VyLW1vbnRoIik7DQogICAgICAgIG1vbnRoRWxlbWVudC50aXRsZSA9IHNlbGYubDEwbi5zY3JvbGxUaXRsZTsNCiAgICAgICAgdmFyIHllYXJJbnB1dCA9IGNyZWF0ZU51bWJlcklucHV0KCJjdXIteWVhciIsIHsNCiAgICAgICAgICB0YWJpbmRleDogIi0xIg0KICAgICAgICB9KTsNCiAgICAgICAgdmFyIHllYXJFbGVtZW50ID0geWVhcklucHV0LmNoaWxkTm9kZXNbMF07DQogICAgICAgIHllYXJFbGVtZW50LnRpdGxlID0gc2VsZi5sMTBuLnNjcm9sbFRpdGxlOw0KICAgICAgICB5ZWFyRWxlbWVudC5zZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWwiLCBzZWxmLmwxMG4ueWVhckFyaWFMYWJlbCk7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5taW5EYXRlKSB5ZWFyRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtbWluIiwgc2VsZi5jb25maWcubWluRGF0ZS5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCkpOw0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tYXhEYXRlKSB7DQogICAgICAgICAgeWVhckVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLW1heCIsIHNlbGYuY29uZmlnLm1heERhdGUuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpKTsNCiAgICAgICAgICB5ZWFyRWxlbWVudC5kaXNhYmxlZCA9ICEhc2VsZi5jb25maWcubWluRGF0ZSAmJiBzZWxmLmNvbmZpZy5taW5EYXRlLmdldEZ1bGxZZWFyKCkgPT09IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBjdXJyZW50TW9udGggPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLWN1cnJlbnQtbW9udGgiKTsNCiAgICAgICAgY3VycmVudE1vbnRoLmFwcGVuZENoaWxkKG1vbnRoRWxlbWVudCk7DQogICAgICAgIGN1cnJlbnRNb250aC5hcHBlbmRDaGlsZCh5ZWFySW5wdXQpOw0KICAgICAgICBtb250aE5hdkZyYWdtZW50LmFwcGVuZENoaWxkKGN1cnJlbnRNb250aCk7DQogICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChtb250aE5hdkZyYWdtZW50KTsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICBjb250YWluZXI6IGNvbnRhaW5lciwNCiAgICAgICAgICB5ZWFyRWxlbWVudDogeWVhckVsZW1lbnQsDQogICAgICAgICAgbW9udGhFbGVtZW50OiBtb250aEVsZW1lbnQNCiAgICAgICAgfTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gYnVpbGRNb250aHMoKSB7DQogICAgICAgIGNsZWFyTm9kZShzZWxmLm1vbnRoTmF2KTsNCiAgICAgICAgc2VsZi5tb250aE5hdi5hcHBlbmRDaGlsZChzZWxmLnByZXZNb250aE5hdik7DQoNCiAgICAgICAgZm9yICh2YXIgbSA9IHNlbGYuY29uZmlnLnNob3dNb250aHM7IG0tLTspIHsNCiAgICAgICAgICB2YXIgbW9udGggPSBidWlsZE1vbnRoKCk7DQogICAgICAgICAgc2VsZi55ZWFyRWxlbWVudHMucHVzaChtb250aC55ZWFyRWxlbWVudCk7DQogICAgICAgICAgc2VsZi5tb250aEVsZW1lbnRzLnB1c2gobW9udGgubW9udGhFbGVtZW50KTsNCiAgICAgICAgICBzZWxmLm1vbnRoTmF2LmFwcGVuZENoaWxkKG1vbnRoLmNvbnRhaW5lcik7DQogICAgICAgIH0NCg0KICAgICAgICBzZWxmLm1vbnRoTmF2LmFwcGVuZENoaWxkKHNlbGYubmV4dE1vbnRoTmF2KTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gYnVpbGRNb250aE5hdigpIHsNCiAgICAgICAgc2VsZi5tb250aE5hdiA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3ItbW9udGhzIik7DQogICAgICAgIHNlbGYueWVhckVsZW1lbnRzID0gW107DQogICAgICAgIHNlbGYubW9udGhFbGVtZW50cyA9IFtdOw0KICAgICAgICBzZWxmLnByZXZNb250aE5hdiA9IGNyZWF0ZUVsZW1lbnQoInNwYW4iLCAiZmxhdHBpY2tyLXByZXYtbW9udGgiKTsNCiAgICAgICAgc2VsZi5wcmV2TW9udGhOYXYuaW5uZXJIVE1MID0gc2VsZi5jb25maWcucHJldkFycm93Ow0KICAgICAgICBzZWxmLm5leHRNb250aE5hdiA9IGNyZWF0ZUVsZW1lbnQoInNwYW4iLCAiZmxhdHBpY2tyLW5leHQtbW9udGgiKTsNCiAgICAgICAgc2VsZi5uZXh0TW9udGhOYXYuaW5uZXJIVE1MID0gc2VsZi5jb25maWcubmV4dEFycm93Ow0KICAgICAgICBidWlsZE1vbnRocygpOw0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZiwgIl9oaWRlUHJldk1vbnRoQXJyb3ciLCB7DQogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fX2hpZGVQcmV2TW9udGhBcnJvdzsNCiAgICAgICAgICB9LA0KICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGJvb2wpIHsNCiAgICAgICAgICAgIGlmIChzZWxmLl9faGlkZVByZXZNb250aEFycm93ICE9PSBib29sKSB7DQogICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKHNlbGYucHJldk1vbnRoTmF2LCAiZGlzYWJsZWQiLCBib29sKTsNCiAgICAgICAgICAgICAgc2VsZi5fX2hpZGVQcmV2TW9udGhBcnJvdyA9IGJvb2w7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYsICJfaGlkZU5leHRNb250aEFycm93Iiwgew0KICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuX19oaWRlTmV4dE1vbnRoQXJyb3c7DQogICAgICAgICAgfSwNCiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChib29sKSB7DQogICAgICAgICAgICBpZiAoc2VsZi5fX2hpZGVOZXh0TW9udGhBcnJvdyAhPT0gYm9vbCkgew0KICAgICAgICAgICAgICB0b2dnbGVDbGFzcyhzZWxmLm5leHRNb250aE5hdiwgImRpc2FibGVkIiwgYm9vbCk7DQogICAgICAgICAgICAgIHNlbGYuX19oaWRlTmV4dE1vbnRoQXJyb3cgPSBib29sOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIHNlbGYuY3VycmVudFllYXJFbGVtZW50ID0gc2VsZi55ZWFyRWxlbWVudHNbMF07DQogICAgICAgIHVwZGF0ZU5hdmlnYXRpb25DdXJyZW50TW9udGgoKTsNCiAgICAgICAgcmV0dXJuIHNlbGYubW9udGhOYXY7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGJ1aWxkVGltZSgpIHsNCiAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJoYXNUaW1lIik7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5ub0NhbGVuZGFyKSBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoIm5vQ2FsZW5kYXIiKTsNCiAgICAgICAgc2VsZi50aW1lQ29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci10aW1lIik7DQogICAgICAgIHNlbGYudGltZUNvbnRhaW5lci50YWJJbmRleCA9IC0xOw0KICAgICAgICB2YXIgc2VwYXJhdG9yID0gY3JlYXRlRWxlbWVudCgic3BhbiIsICJmbGF0cGlja3ItdGltZS1zZXBhcmF0b3IiLCAiOiIpOw0KICAgICAgICB2YXIgaG91cklucHV0ID0gY3JlYXRlTnVtYmVySW5wdXQoImZsYXRwaWNrci1ob3VyIik7DQogICAgICAgIHNlbGYuaG91ckVsZW1lbnQgPSBob3VySW5wdXQuY2hpbGROb2Rlc1swXTsNCiAgICAgICAgdmFyIG1pbnV0ZUlucHV0ID0gY3JlYXRlTnVtYmVySW5wdXQoImZsYXRwaWNrci1taW51dGUiKTsNCiAgICAgICAgc2VsZi5taW51dGVFbGVtZW50ID0gbWludXRlSW5wdXQuY2hpbGROb2Rlc1swXTsNCiAgICAgICAgc2VsZi5ob3VyRWxlbWVudC50YWJJbmRleCA9IHNlbGYubWludXRlRWxlbWVudC50YWJJbmRleCA9IC0xOw0KICAgICAgICBzZWxmLmhvdXJFbGVtZW50LnZhbHVlID0gcGFkKHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqID8gc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmouZ2V0SG91cnMoKSA6IHNlbGYuY29uZmlnLnRpbWVfMjRociA/IHNlbGYuY29uZmlnLmRlZmF1bHRIb3VyIDogbWlsaXRhcnkyYW1wbShzZWxmLmNvbmZpZy5kZWZhdWx0SG91cikpOw0KICAgICAgICBzZWxmLm1pbnV0ZUVsZW1lbnQudmFsdWUgPSBwYWQoc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogPyBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iai5nZXRNaW51dGVzKCkgOiBzZWxmLmNvbmZpZy5kZWZhdWx0TWludXRlKTsNCiAgICAgICAgc2VsZi5ob3VyRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtc3RlcCIsIHNlbGYuY29uZmlnLmhvdXJJbmNyZW1lbnQudG9TdHJpbmcoKSk7DQogICAgICAgIHNlbGYubWludXRlRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtc3RlcCIsIHNlbGYuY29uZmlnLm1pbnV0ZUluY3JlbWVudC50b1N0cmluZygpKTsNCiAgICAgICAgc2VsZi5ob3VyRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtbWluIiwgc2VsZi5jb25maWcudGltZV8yNGhyID8gIjAiIDogIjEiKTsNCiAgICAgICAgc2VsZi5ob3VyRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtbWF4Iiwgc2VsZi5jb25maWcudGltZV8yNGhyID8gIjIzIiA6ICIxMiIpOw0KICAgICAgICBzZWxmLm1pbnV0ZUVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLW1pbiIsICIwIik7DQogICAgICAgIHNlbGYubWludXRlRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtbWF4IiwgIjU5Iik7DQogICAgICAgIHNlbGYudGltZUNvbnRhaW5lci5hcHBlbmRDaGlsZChob3VySW5wdXQpOw0KICAgICAgICBzZWxmLnRpbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoc2VwYXJhdG9yKTsNCiAgICAgICAgc2VsZi50aW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKG1pbnV0ZUlucHV0KTsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLnRpbWVfMjRocikgc2VsZi50aW1lQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoInRpbWUyNGhyIik7DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmVuYWJsZVNlY29uZHMpIHsNCiAgICAgICAgICBzZWxmLnRpbWVDb250YWluZXIuY2xhc3NMaXN0LmFkZCgiaGFzU2Vjb25kcyIpOw0KICAgICAgICAgIHZhciBzZWNvbmRJbnB1dCA9IGNyZWF0ZU51bWJlcklucHV0KCJmbGF0cGlja3Itc2Vjb25kIik7DQogICAgICAgICAgc2VsZi5zZWNvbmRFbGVtZW50ID0gc2Vjb25kSW5wdXQuY2hpbGROb2Rlc1swXTsNCiAgICAgICAgICBzZWxmLnNlY29uZEVsZW1lbnQudmFsdWUgPSBwYWQoc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogPyBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iai5nZXRTZWNvbmRzKCkgOiBzZWxmLmNvbmZpZy5kZWZhdWx0U2Vjb25kcyk7DQogICAgICAgICAgc2VsZi5zZWNvbmRFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1zdGVwIiwgc2VsZi5taW51dGVFbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS1zdGVwIikpOw0KICAgICAgICAgIHNlbGYuc2Vjb25kRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtbWluIiwgc2VsZi5taW51dGVFbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS1taW4iKSk7DQogICAgICAgICAgc2VsZi5zZWNvbmRFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1tYXgiLCBzZWxmLm1pbnV0ZUVsZW1lbnQuZ2V0QXR0cmlidXRlKCJkYXRhLW1heCIpKTsNCiAgICAgICAgICBzZWxmLnRpbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlRWxlbWVudCgic3BhbiIsICJmbGF0cGlja3ItdGltZS1zZXBhcmF0b3IiLCAiOiIpKTsNCiAgICAgICAgICBzZWxmLnRpbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoc2Vjb25kSW5wdXQpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCFzZWxmLmNvbmZpZy50aW1lXzI0aHIpIHsNCiAgICAgICAgICBzZWxmLmFtUE0gPSBjcmVhdGVFbGVtZW50KCJzcGFuIiwgImZsYXRwaWNrci1hbS1wbSIsIHNlbGYubDEwbi5hbVBNW2ludCgoc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogPyBzZWxmLmhvdXJFbGVtZW50LnZhbHVlIDogc2VsZi5jb25maWcuZGVmYXVsdEhvdXIpID4gMTEpXSk7DQogICAgICAgICAgc2VsZi5hbVBNLnRpdGxlID0gc2VsZi5sMTBuLnRvZ2dsZVRpdGxlOw0KICAgICAgICAgIHNlbGYuYW1QTS50YWJJbmRleCA9IC0xOw0KICAgICAgICAgIHNlbGYudGltZUNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWxmLmFtUE0pOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHNlbGYudGltZUNvbnRhaW5lcjsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gYnVpbGRXZWVrZGF5cygpIHsNCiAgICAgICAgaWYgKCFzZWxmLndlZWtkYXlDb250YWluZXIpIHNlbGYud2Vla2RheUNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3Itd2Vla2RheXMiKTtlbHNlIGNsZWFyTm9kZShzZWxmLndlZWtkYXlDb250YWluZXIpOw0KDQogICAgICAgIGZvciAodmFyIGkgPSBzZWxmLmNvbmZpZy5zaG93TW9udGhzOyBpLS07KSB7DQogICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3Itd2Vla2RheWNvbnRhaW5lciIpOw0KICAgICAgICAgIHNlbGYud2Vla2RheUNvbnRhaW5lci5hcHBlbmRDaGlsZChjb250YWluZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgdXBkYXRlV2Vla2RheXMoKTsNCiAgICAgICAgcmV0dXJuIHNlbGYud2Vla2RheUNvbnRhaW5lcjsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gdXBkYXRlV2Vla2RheXMoKSB7DQogICAgICAgIHZhciBmaXJzdERheU9mV2VlayA9IHNlbGYubDEwbi5maXJzdERheU9mV2VlazsNCiAgICAgICAgdmFyIHdlZWtkYXlzID0gc2VsZi5sMTBuLndlZWtkYXlzLnNob3J0aGFuZC5jb25jYXQoKTsNCg0KICAgICAgICBpZiAoZmlyc3REYXlPZldlZWsgPiAwICYmIGZpcnN0RGF5T2ZXZWVrIDwgd2Vla2RheXMubGVuZ3RoKSB7DQogICAgICAgICAgd2Vla2RheXMgPSB3ZWVrZGF5cy5zcGxpY2UoZmlyc3REYXlPZldlZWssIHdlZWtkYXlzLmxlbmd0aCkuY29uY2F0KHdlZWtkYXlzLnNwbGljZSgwLCBmaXJzdERheU9mV2VlaykpOw0KICAgICAgICB9DQoNCiAgICAgICAgZm9yICh2YXIgaSA9IHNlbGYuY29uZmlnLnNob3dNb250aHM7IGktLTspIHsNCiAgICAgICAgICBzZWxmLndlZWtkYXlDb250YWluZXIuY2hpbGRyZW5baV0uaW5uZXJIVE1MID0gIlxuICAgICAgPHNwYW4gY2xhc3M9ZmxhdHBpY2tyLXdlZWtkYXk+XG4gICAgICAgICIgKyB3ZWVrZGF5cy5qb2luKCI8L3NwYW4+PHNwYW4gY2xhc3M9ZmxhdHBpY2tyLXdlZWtkYXk+IikgKyAiXG4gICAgICA8L3NwYW4+XG4gICAgICAiOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGJ1aWxkV2Vla3MoKSB7DQogICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuY2xhc3NMaXN0LmFkZCgiaGFzV2Vla3MiKTsNCiAgICAgICAgdmFyIHdlZWtXcmFwcGVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci13ZWVrd3JhcHBlciIpOw0KICAgICAgICB3ZWVrV3JhcHBlci5hcHBlbmRDaGlsZChjcmVhdGVFbGVtZW50KCJzcGFuIiwgImZsYXRwaWNrci13ZWVrZGF5Iiwgc2VsZi5sMTBuLndlZWtBYmJyZXZpYXRpb24pKTsNCiAgICAgICAgdmFyIHdlZWtOdW1iZXJzID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci13ZWVrcyIpOw0KICAgICAgICB3ZWVrV3JhcHBlci5hcHBlbmRDaGlsZCh3ZWVrTnVtYmVycyk7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgd2Vla1dyYXBwZXI6IHdlZWtXcmFwcGVyLA0KICAgICAgICAgIHdlZWtOdW1iZXJzOiB3ZWVrTnVtYmVycw0KICAgICAgICB9Ow0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBjaGFuZ2VNb250aCh2YWx1ZSwgaXNfb2Zmc2V0KSB7DQogICAgICAgIGlmIChpc19vZmZzZXQgPT09IHZvaWQgMCkgew0KICAgICAgICAgIGlzX29mZnNldCA9IHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgZGVsdGEgPSBpc19vZmZzZXQgPyB2YWx1ZSA6IHZhbHVlIC0gc2VsZi5jdXJyZW50TW9udGg7DQogICAgICAgIGlmIChkZWx0YSA8IDAgJiYgc2VsZi5faGlkZVByZXZNb250aEFycm93ID09PSB0cnVlIHx8IGRlbHRhID4gMCAmJiBzZWxmLl9oaWRlTmV4dE1vbnRoQXJyb3cgPT09IHRydWUpIHJldHVybjsNCiAgICAgICAgc2VsZi5jdXJyZW50TW9udGggKz0gZGVsdGE7DQoNCiAgICAgICAgaWYgKHNlbGYuY3VycmVudE1vbnRoIDwgMCB8fCBzZWxmLmN1cnJlbnRNb250aCA+IDExKSB7DQogICAgICAgICAgc2VsZi5jdXJyZW50WWVhciArPSBzZWxmLmN1cnJlbnRNb250aCA+IDExID8gMSA6IC0xOw0KICAgICAgICAgIHNlbGYuY3VycmVudE1vbnRoID0gKHNlbGYuY3VycmVudE1vbnRoICsgMTIpICUgMTI7DQogICAgICAgICAgdHJpZ2dlckV2ZW50KCJvblllYXJDaGFuZ2UiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGJ1aWxkRGF5cygpOw0KICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uTW9udGhDaGFuZ2UiKTsNCiAgICAgICAgdXBkYXRlTmF2aWdhdGlvbkN1cnJlbnRNb250aCgpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBjbGVhcih0cmlnZ2VyQ2hhbmdlRXZlbnQpIHsNCiAgICAgICAgaWYgKHRyaWdnZXJDaGFuZ2VFdmVudCA9PT0gdm9pZCAwKSB7DQogICAgICAgICAgdHJpZ2dlckNoYW5nZUV2ZW50ID0gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHNlbGYuaW5wdXQudmFsdWUgPSAiIjsNCiAgICAgICAgaWYgKHNlbGYuYWx0SW5wdXQgIT09IHVuZGVmaW5lZCkgc2VsZi5hbHRJbnB1dC52YWx1ZSA9ICIiOw0KICAgICAgICBpZiAoc2VsZi5tb2JpbGVJbnB1dCAhPT0gdW5kZWZpbmVkKSBzZWxmLm1vYmlsZUlucHV0LnZhbHVlID0gIiI7DQogICAgICAgIHNlbGYuc2VsZWN0ZWREYXRlcyA9IFtdOw0KICAgICAgICBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiA9IHVuZGVmaW5lZDsNCiAgICAgICAgc2VsZi5zaG93VGltZUlucHV0ID0gZmFsc2U7DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmVuYWJsZVRpbWUgPT09IHRydWUpIHsNCiAgICAgICAgICBzZXREZWZhdWx0SG91cnMoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHNlbGYucmVkcmF3KCk7DQogICAgICAgIGlmICh0cmlnZ2VyQ2hhbmdlRXZlbnQpIHRyaWdnZXJFdmVudCgib25DaGFuZ2UiKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gY2xvc2UoKSB7DQogICAgICAgIHNlbGYuaXNPcGVuID0gZmFsc2U7DQoNCiAgICAgICAgaWYgKCFzZWxmLmlzTW9iaWxlKSB7DQogICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCJvcGVuIik7DQoNCiAgICAgICAgICBzZWxmLl9pbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCJhY3RpdmUiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRyaWdnZXJFdmVudCgib25DbG9zZSIpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBkZXN0cm95KCkgew0KICAgICAgICBpZiAoc2VsZi5jb25maWcgIT09IHVuZGVmaW5lZCkgdHJpZ2dlckV2ZW50KCJvbkRlc3Ryb3kiKTsNCg0KICAgICAgICBmb3IgKHZhciBpID0gc2VsZi5faGFuZGxlcnMubGVuZ3RoOyBpLS07KSB7DQogICAgICAgICAgdmFyIGggPSBzZWxmLl9oYW5kbGVyc1tpXTsNCiAgICAgICAgICBoLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihoLmV2ZW50LCBoLmhhbmRsZXIsIGgub3B0aW9ucyk7DQogICAgICAgIH0NCg0KICAgICAgICBzZWxmLl9oYW5kbGVycyA9IFtdOw0KDQogICAgICAgIGlmIChzZWxmLm1vYmlsZUlucHV0KSB7DQogICAgICAgICAgaWYgKHNlbGYubW9iaWxlSW5wdXQucGFyZW50Tm9kZSkgc2VsZi5tb2JpbGVJbnB1dC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNlbGYubW9iaWxlSW5wdXQpOw0KICAgICAgICAgIHNlbGYubW9iaWxlSW5wdXQgPSB1bmRlZmluZWQ7DQogICAgICAgIH0gZWxzZSBpZiAoc2VsZi5jYWxlbmRhckNvbnRhaW5lciAmJiBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnBhcmVudE5vZGUpIHNlbGYuY2FsZW5kYXJDb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzZWxmLmNhbGVuZGFyQ29udGFpbmVyKTsNCg0KICAgICAgICBpZiAoc2VsZi5hbHRJbnB1dCkgew0KICAgICAgICAgIHNlbGYuaW5wdXQudHlwZSA9ICJ0ZXh0IjsNCiAgICAgICAgICBpZiAoc2VsZi5hbHRJbnB1dC5wYXJlbnROb2RlKSBzZWxmLmFsdElucHV0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2VsZi5hbHRJbnB1dCk7DQogICAgICAgICAgZGVsZXRlIHNlbGYuYWx0SW5wdXQ7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5pbnB1dCkgew0KICAgICAgICAgIHNlbGYuaW5wdXQudHlwZSA9IHNlbGYuaW5wdXQuX3R5cGU7DQogICAgICAgICAgc2VsZi5pbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCJmbGF0cGlja3ItaW5wdXQiKTsNCiAgICAgICAgICBzZWxmLmlucHV0LnJlbW92ZUF0dHJpYnV0ZSgicmVhZG9ubHkiKTsNCiAgICAgICAgICBzZWxmLmlucHV0LnZhbHVlID0gIiI7DQogICAgICAgIH0NCg0KICAgICAgICBbIl9zaG93VGltZUlucHV0IiwgImxhdGVzdFNlbGVjdGVkRGF0ZU9iaiIsICJfaGlkZU5leHRNb250aEFycm93IiwgIl9oaWRlUHJldk1vbnRoQXJyb3ciLCAiX19oaWRlTmV4dE1vbnRoQXJyb3ciLCAiX19oaWRlUHJldk1vbnRoQXJyb3ciLCAiaXNNb2JpbGUiLCAiaXNPcGVuIiwgInNlbGVjdGVkRGF0ZUVsZW0iLCAibWluRGF0ZUhhc1RpbWUiLCAibWF4RGF0ZUhhc1RpbWUiLCAiZGF5cyIsICJkYXlzQ29udGFpbmVyIiwgIl9pbnB1dCIsICJfcG9zaXRpb25FbGVtZW50IiwgImlubmVyQ29udGFpbmVyIiwgInJDb250YWluZXIiLCAibW9udGhOYXYiLCAidG9kYXlEYXRlRWxlbSIsICJjYWxlbmRhckNvbnRhaW5lciIsICJ3ZWVrZGF5Q29udGFpbmVyIiwgInByZXZNb250aE5hdiIsICJuZXh0TW9udGhOYXYiLCAiY3VycmVudE1vbnRoRWxlbWVudCIsICJjdXJyZW50WWVhckVsZW1lbnQiLCAibmF2aWdhdGlvbkN1cnJlbnRNb250aCIsICJzZWxlY3RlZERhdGVFbGVtIiwgImNvbmZpZyJdLmZvckVhY2goZnVuY3Rpb24gKGspIHsNCiAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgZGVsZXRlIHNlbGZba107DQogICAgICAgICAgfSBjYXRjaCAoXykge30NCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGlzQ2FsZW5kYXJFbGVtKGVsZW0pIHsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmFwcGVuZFRvICYmIHNlbGYuY29uZmlnLmFwcGVuZFRvLmNvbnRhaW5zKGVsZW0pKSByZXR1cm4gdHJ1ZTsNCiAgICAgICAgcmV0dXJuIHNlbGYuY2FsZW5kYXJDb250YWluZXIuY29udGFpbnMoZWxlbSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q2xpY2soZSkgew0KICAgICAgICBpZiAoc2VsZi5pc09wZW4gJiYgIXNlbGYuY29uZmlnLmlubGluZSkgew0KICAgICAgICAgIHZhciBpc0NhbGVuZGFyRWxlbWVudCA9IGlzQ2FsZW5kYXJFbGVtKGUudGFyZ2V0KTsNCiAgICAgICAgICB2YXIgaXNJbnB1dCA9IGUudGFyZ2V0ID09PSBzZWxmLmlucHV0IHx8IGUudGFyZ2V0ID09PSBzZWxmLmFsdElucHV0IHx8IHNlbGYuZWxlbWVudC5jb250YWlucyhlLnRhcmdldCkgfHwgZS5wYXRoICYmIGUucGF0aC5pbmRleE9mICYmICh+ZS5wYXRoLmluZGV4T2Yoc2VsZi5pbnB1dCkgfHwgfmUucGF0aC5pbmRleE9mKHNlbGYuYWx0SW5wdXQpKTsNCiAgICAgICAgICB2YXIgbG9zdEZvY3VzID0gZS50eXBlID09PSAiYmx1ciIgPyBpc0lucHV0ICYmIGUucmVsYXRlZFRhcmdldCAmJiAhaXNDYWxlbmRhckVsZW0oZS5yZWxhdGVkVGFyZ2V0KSA6ICFpc0lucHV0ICYmICFpc0NhbGVuZGFyRWxlbWVudDsNCiAgICAgICAgICB2YXIgaXNJZ25vcmVkID0gIXNlbGYuY29uZmlnLmlnbm9yZWRGb2N1c0VsZW1lbnRzLnNvbWUoZnVuY3Rpb24gKGVsZW0pIHsNCiAgICAgICAgICAgIHJldHVybiBlbGVtLmNvbnRhaW5zKGUudGFyZ2V0KTsNCiAgICAgICAgICB9KTsNCg0KICAgICAgICAgIGlmIChsb3N0Rm9jdXMgJiYgaXNJZ25vcmVkKSB7DQogICAgICAgICAgICBzZWxmLmNsb3NlKCk7DQoNCiAgICAgICAgICAgIGlmIChzZWxmLmNvbmZpZy5tb2RlID09PSAicmFuZ2UiICYmIHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPT09IDEpIHsNCiAgICAgICAgICAgICAgc2VsZi5jbGVhcihmYWxzZSk7DQogICAgICAgICAgICAgIHNlbGYucmVkcmF3KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGNoYW5nZVllYXIobmV3WWVhcikgew0KICAgICAgICBpZiAoIW5ld1llYXIgfHwgc2VsZi5jb25maWcubWluRGF0ZSAmJiBuZXdZZWFyIDwgc2VsZi5jb25maWcubWluRGF0ZS5nZXRGdWxsWWVhcigpIHx8IHNlbGYuY29uZmlnLm1heERhdGUgJiYgbmV3WWVhciA+IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0RnVsbFllYXIoKSkgcmV0dXJuOw0KICAgICAgICB2YXIgbmV3WWVhck51bSA9IG5ld1llYXIsDQogICAgICAgICAgICBpc05ld1llYXIgPSBzZWxmLmN1cnJlbnRZZWFyICE9PSBuZXdZZWFyTnVtOw0KICAgICAgICBzZWxmLmN1cnJlbnRZZWFyID0gbmV3WWVhck51bSB8fCBzZWxmLmN1cnJlbnRZZWFyOw0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tYXhEYXRlICYmIHNlbGYuY3VycmVudFllYXIgPT09IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0RnVsbFllYXIoKSkgew0KICAgICAgICAgIHNlbGYuY3VycmVudE1vbnRoID0gTWF0aC5taW4oc2VsZi5jb25maWcubWF4RGF0ZS5nZXRNb250aCgpLCBzZWxmLmN1cnJlbnRNb250aCk7DQogICAgICAgIH0gZWxzZSBpZiAoc2VsZi5jb25maWcubWluRGF0ZSAmJiBzZWxmLmN1cnJlbnRZZWFyID09PSBzZWxmLmNvbmZpZy5taW5EYXRlLmdldEZ1bGxZZWFyKCkpIHsNCiAgICAgICAgICBzZWxmLmN1cnJlbnRNb250aCA9IE1hdGgubWF4KHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0TW9udGgoKSwgc2VsZi5jdXJyZW50TW9udGgpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGlzTmV3WWVhcikgew0KICAgICAgICAgIHNlbGYucmVkcmF3KCk7DQogICAgICAgICAgdHJpZ2dlckV2ZW50KCJvblllYXJDaGFuZ2UiKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBpc0VuYWJsZWQoZGF0ZSwgdGltZWxlc3MpIHsNCiAgICAgICAgaWYgKHRpbWVsZXNzID09PSB2b2lkIDApIHsNCiAgICAgICAgICB0aW1lbGVzcyA9IHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgZGF0ZVRvQ2hlY2sgPSBzZWxmLnBhcnNlRGF0ZShkYXRlLCB1bmRlZmluZWQsIHRpbWVsZXNzKTsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1pbkRhdGUgJiYgZGF0ZVRvQ2hlY2sgJiYgY29tcGFyZURhdGVzKGRhdGVUb0NoZWNrLCBzZWxmLmNvbmZpZy5taW5EYXRlLCB0aW1lbGVzcyAhPT0gdW5kZWZpbmVkID8gdGltZWxlc3MgOiAhc2VsZi5taW5EYXRlSGFzVGltZSkgPCAwIHx8IHNlbGYuY29uZmlnLm1heERhdGUgJiYgZGF0ZVRvQ2hlY2sgJiYgY29tcGFyZURhdGVzKGRhdGVUb0NoZWNrLCBzZWxmLmNvbmZpZy5tYXhEYXRlLCB0aW1lbGVzcyAhPT0gdW5kZWZpbmVkID8gdGltZWxlc3MgOiAhc2VsZi5tYXhEYXRlSGFzVGltZSkgPiAwKSByZXR1cm4gZmFsc2U7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5lbmFibGUubGVuZ3RoID09PSAwICYmIHNlbGYuY29uZmlnLmRpc2FibGUubGVuZ3RoID09PSAwKSByZXR1cm4gdHJ1ZTsNCiAgICAgICAgaWYgKGRhdGVUb0NoZWNrID09PSB1bmRlZmluZWQpIHJldHVybiBmYWxzZTsNCiAgICAgICAgdmFyIGJvb2wgPSBzZWxmLmNvbmZpZy5lbmFibGUubGVuZ3RoID4gMCwNCiAgICAgICAgICAgIGFycmF5ID0gYm9vbCA/IHNlbGYuY29uZmlnLmVuYWJsZSA6IHNlbGYuY29uZmlnLmRpc2FibGU7DQoNCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGQ7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgIGQgPSBhcnJheVtpXTsNCiAgICAgICAgICBpZiAodHlwZW9mIGQgPT09ICJmdW5jdGlvbiIgJiYgZChkYXRlVG9DaGVjaykpIHJldHVybiBib29sO2Vsc2UgaWYgKGQgaW5zdGFuY2VvZiBEYXRlICYmIGRhdGVUb0NoZWNrICE9PSB1bmRlZmluZWQgJiYgZC5nZXRUaW1lKCkgPT09IGRhdGVUb0NoZWNrLmdldFRpbWUoKSkgcmV0dXJuIGJvb2w7ZWxzZSBpZiAodHlwZW9mIGQgPT09ICJzdHJpbmciICYmIGRhdGVUb0NoZWNrICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIHZhciBwYXJzZWQgPSBzZWxmLnBhcnNlRGF0ZShkLCB1bmRlZmluZWQsIHRydWUpOw0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlZCAmJiBwYXJzZWQuZ2V0VGltZSgpID09PSBkYXRlVG9DaGVjay5nZXRUaW1lKCkgPyBib29sIDogIWJvb2w7DQogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZCA9PT0gIm9iamVjdCIgJiYgZGF0ZVRvQ2hlY2sgIT09IHVuZGVmaW5lZCAmJiBkLmZyb20gJiYgZC50byAmJiBkYXRlVG9DaGVjay5nZXRUaW1lKCkgPj0gZC5mcm9tLmdldFRpbWUoKSAmJiBkYXRlVG9DaGVjay5nZXRUaW1lKCkgPD0gZC50by5nZXRUaW1lKCkpIHJldHVybiBib29sOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICFib29sOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBpc0luVmlldyhlbGVtKSB7DQogICAgICAgIGlmIChzZWxmLmRheXNDb250YWluZXIgIT09IHVuZGVmaW5lZCkgcmV0dXJuIGVsZW0uY2xhc3NOYW1lLmluZGV4T2YoImhpZGRlbiIpID09PSAtMSAmJiBzZWxmLmRheXNDb250YWluZXIuY29udGFpbnMoZWxlbSk7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gb25LZXlEb3duKGUpIHsNCiAgICAgICAgdmFyIGlzSW5wdXQgPSBlLnRhcmdldCA9PT0gc2VsZi5faW5wdXQ7DQogICAgICAgIHZhciBhbGxvd0lucHV0ID0gc2VsZi5jb25maWcuYWxsb3dJbnB1dDsNCiAgICAgICAgdmFyIGFsbG93S2V5ZG93biA9IHNlbGYuaXNPcGVuICYmICghYWxsb3dJbnB1dCB8fCAhaXNJbnB1dCk7DQogICAgICAgIHZhciBhbGxvd0lubGluZUtleWRvd24gPSBzZWxmLmNvbmZpZy5pbmxpbmUgJiYgaXNJbnB1dCAmJiAhYWxsb3dJbnB1dDsNCg0KICAgICAgICBpZiAoZS5rZXlDb2RlID09PSAxMyAmJiBpc0lucHV0KSB7DQogICAgICAgICAgaWYgKGFsbG93SW5wdXQpIHsNCiAgICAgICAgICAgIHNlbGYuc2V0RGF0ZShzZWxmLl9pbnB1dC52YWx1ZSwgdHJ1ZSwgZS50YXJnZXQgPT09IHNlbGYuYWx0SW5wdXQgPyBzZWxmLmNvbmZpZy5hbHRGb3JtYXQgOiBzZWxmLmNvbmZpZy5kYXRlRm9ybWF0KTsNCiAgICAgICAgICAgIHJldHVybiBlLnRhcmdldC5ibHVyKCk7DQogICAgICAgICAgfSBlbHNlIHNlbGYub3BlbigpOw0KICAgICAgICB9IGVsc2UgaWYgKGlzQ2FsZW5kYXJFbGVtKGUudGFyZ2V0KSB8fCBhbGxvd0tleWRvd24gfHwgYWxsb3dJbmxpbmVLZXlkb3duKSB7DQogICAgICAgICAgdmFyIGlzVGltZU9iaiA9ICEhc2VsZi50aW1lQ29udGFpbmVyICYmIHNlbGYudGltZUNvbnRhaW5lci5jb250YWlucyhlLnRhcmdldCk7DQoNCiAgICAgICAgICBzd2l0Y2ggKGUua2V5Q29kZSkgew0KICAgICAgICAgICAgY2FzZSAxMzoNCiAgICAgICAgICAgICAgaWYgKGlzVGltZU9iaikgdXBkYXRlVGltZSgpO2Vsc2Ugc2VsZWN0RGF0ZShlKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgMjc6DQogICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgZm9jdXNBbmRDbG9zZSgpOw0KICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSA4Og0KICAgICAgICAgICAgY2FzZSA0NjoNCiAgICAgICAgICAgICAgaWYgKGlzSW5wdXQgJiYgIXNlbGYuY29uZmlnLmFsbG93SW5wdXQpIHsNCiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgICAgc2VsZi5jbGVhcigpOw0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgMzc6DQogICAgICAgICAgICBjYXNlIDM5Og0KICAgICAgICAgICAgICBpZiAoIWlzVGltZU9iaikgew0KICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCg0KICAgICAgICAgICAgICAgIGlmIChzZWxmLmRheXNDb250YWluZXIgIT09IHVuZGVmaW5lZCAmJiAoYWxsb3dJbnB1dCA9PT0gZmFsc2UgfHwgaXNJblZpZXcoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkpKSB7DQogICAgICAgICAgICAgICAgICB2YXIgX2RlbHRhID0gZS5rZXlDb2RlID09PSAzOSA/IDEgOiAtMTsNCg0KICAgICAgICAgICAgICAgICAgaWYgKCFlLmN0cmxLZXkpIGZvY3VzT25EYXkodW5kZWZpbmVkLCBfZGVsdGEpO2Vsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjaGFuZ2VNb250aChfZGVsdGEpOw0KICAgICAgICAgICAgICAgICAgICBmb2N1c09uRGF5KGdldEZpcnN0QXZhaWxhYmxlRGF5KDEpLCAwKTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VsZi5ob3VyRWxlbWVudCkgc2VsZi5ob3VyRWxlbWVudC5mb2N1cygpOw0KDQogICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIDM4Og0KICAgICAgICAgICAgY2FzZSA0MDoNCiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgICB2YXIgZGVsdGEgPSBlLmtleUNvZGUgPT09IDQwID8gMSA6IC0xOw0KDQogICAgICAgICAgICAgIGlmIChzZWxmLmRheXNDb250YWluZXIpIHsNCiAgICAgICAgICAgICAgICBpZiAoZS5jdHJsS2V5KSB7DQogICAgICAgICAgICAgICAgICBjaGFuZ2VZZWFyKHNlbGYuY3VycmVudFllYXIgLSBkZWx0YSk7DQogICAgICAgICAgICAgICAgICBmb2N1c09uRGF5KGdldEZpcnN0QXZhaWxhYmxlRGF5KDEpLCAwKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFpc1RpbWVPYmopIGZvY3VzT25EYXkodW5kZWZpbmVkLCBkZWx0YSAqIDcpOw0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlbGYuY29uZmlnLmVuYWJsZVRpbWUpIHsNCiAgICAgICAgICAgICAgICBpZiAoIWlzVGltZU9iaiAmJiBzZWxmLmhvdXJFbGVtZW50KSBzZWxmLmhvdXJFbGVtZW50LmZvY3VzKCk7DQogICAgICAgICAgICAgICAgdXBkYXRlVGltZShlKTsNCg0KICAgICAgICAgICAgICAgIHNlbGYuX2RlYm91bmNlZENoYW5nZSgpOw0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgOToNCiAgICAgICAgICAgICAgaWYgKCFpc1RpbWVPYmopIGJyZWFrOw0KICAgICAgICAgICAgICB2YXIgZWxlbXMgPSBbc2VsZi5ob3VyRWxlbWVudCwgc2VsZi5taW51dGVFbGVtZW50LCBzZWxmLnNlY29uZEVsZW1lbnQsIHNlbGYuYW1QTV0uZmlsdGVyKGZ1bmN0aW9uICh4KSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHg7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICB2YXIgaSA9IGVsZW1zLmluZGV4T2YoZS50YXJnZXQpOw0KDQogICAgICAgICAgICAgIGlmIChpICE9PSAtMSkgew0KICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSBlbGVtc1tpICsgKGUuc2hpZnRLZXkgPyAtMSA6IDEpXTsNCg0KICAgICAgICAgICAgICAgIGlmICh0YXJnZXQgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgICAgICAgdGFyZ2V0LmZvY3VzKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLmFtUE0gIT09IHVuZGVmaW5lZCAmJiBlLnRhcmdldCA9PT0gc2VsZi5hbVBNKSB7DQogICAgICAgICAgc3dpdGNoIChlLmtleSkgew0KICAgICAgICAgICAgY2FzZSBzZWxmLmwxMG4uYW1QTVswXS5jaGFyQXQoMCk6DQogICAgICAgICAgICBjYXNlIHNlbGYubDEwbi5hbVBNWzBdLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpOg0KICAgICAgICAgICAgICBzZWxmLmFtUE0udGV4dENvbnRlbnQgPSBzZWxmLmwxMG4uYW1QTVswXTsNCiAgICAgICAgICAgICAgc2V0SG91cnNGcm9tSW5wdXRzKCk7DQogICAgICAgICAgICAgIHVwZGF0ZVZhbHVlKCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIHNlbGYubDEwbi5hbVBNWzFdLmNoYXJBdCgwKToNCiAgICAgICAgICAgIGNhc2Ugc2VsZi5sMTBuLmFtUE1bMV0uY2hhckF0KDApLnRvTG93ZXJDYXNlKCk6DQogICAgICAgICAgICAgIHNlbGYuYW1QTS50ZXh0Q29udGVudCA9IHNlbGYubDEwbi5hbVBNWzFdOw0KICAgICAgICAgICAgICBzZXRIb3Vyc0Zyb21JbnB1dHMoKTsNCiAgICAgICAgICAgICAgdXBkYXRlVmFsdWUoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgdHJpZ2dlckV2ZW50KCJvbktleURvd24iLCBlKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gb25Nb3VzZU92ZXIoZWxlbSkgew0KICAgICAgICBpZiAoc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCAhPT0gMSB8fCAhZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoImZsYXRwaWNrci1kYXkiKSB8fCBlbGVtLmNsYXNzTGlzdC5jb250YWlucygiZGlzYWJsZWQiKSkgcmV0dXJuOw0KICAgICAgICB2YXIgaG92ZXJEYXRlID0gZWxlbS5kYXRlT2JqLmdldFRpbWUoKSwNCiAgICAgICAgICAgIGluaXRpYWxEYXRlID0gc2VsZi5wYXJzZURhdGUoc2VsZi5zZWxlY3RlZERhdGVzWzBdLCB1bmRlZmluZWQsIHRydWUpLmdldFRpbWUoKSwNCiAgICAgICAgICAgIHJhbmdlU3RhcnREYXRlID0gTWF0aC5taW4oaG92ZXJEYXRlLCBzZWxmLnNlbGVjdGVkRGF0ZXNbMF0uZ2V0VGltZSgpKSwNCiAgICAgICAgICAgIHJhbmdlRW5kRGF0ZSA9IE1hdGgubWF4KGhvdmVyRGF0ZSwgc2VsZi5zZWxlY3RlZERhdGVzWzBdLmdldFRpbWUoKSk7DQogICAgICAgIHZhciBjb250YWluc0Rpc2FibGVkID0gZmFsc2U7DQogICAgICAgIHZhciBtaW5SYW5nZSA9IDAsDQogICAgICAgICAgICBtYXhSYW5nZSA9IDA7DQoNCiAgICAgICAgZm9yICh2YXIgdCA9IHJhbmdlU3RhcnREYXRlOyB0IDwgcmFuZ2VFbmREYXRlOyB0ICs9IGR1cmF0aW9uLkRBWSkgew0KICAgICAgICAgIGlmICghaXNFbmFibGVkKG5ldyBEYXRlKHQpLCB0cnVlKSkgew0KICAgICAgICAgICAgY29udGFpbnNEaXNhYmxlZCA9IGNvbnRhaW5zRGlzYWJsZWQgfHwgdCA+IHJhbmdlU3RhcnREYXRlICYmIHQgPCByYW5nZUVuZERhdGU7DQogICAgICAgICAgICBpZiAodCA8IGluaXRpYWxEYXRlICYmICghbWluUmFuZ2UgfHwgdCA+IG1pblJhbmdlKSkgbWluUmFuZ2UgPSB0O2Vsc2UgaWYgKHQgPiBpbml0aWFsRGF0ZSAmJiAoIW1heFJhbmdlIHx8IHQgPCBtYXhSYW5nZSkpIG1heFJhbmdlID0gdDsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKHZhciBtID0gMDsgbSA8IHNlbGYuY29uZmlnLnNob3dNb250aHM7IG0rKykgew0KICAgICAgICAgIHZhciBtb250aCA9IHNlbGYuZGF5c0NvbnRhaW5lci5jaGlsZHJlblttXTsNCiAgICAgICAgICB2YXIgcHJldk1vbnRoID0gc2VsZi5kYXlzQ29udGFpbmVyLmNoaWxkcmVuW20gLSAxXTsNCg0KICAgICAgICAgIHZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKGksIGwpIHsNCiAgICAgICAgICAgIHZhciBkYXlFbGVtID0gbW9udGguY2hpbGRyZW5baV0sDQogICAgICAgICAgICAgICAgZGF0ZSA9IGRheUVsZW0uZGF0ZU9iajsNCiAgICAgICAgICAgIHZhciB0aW1lc3RhbXAgPSBkYXRlLmdldFRpbWUoKTsNCiAgICAgICAgICAgIHZhciBvdXRPZlJhbmdlID0gbWluUmFuZ2UgPiAwICYmIHRpbWVzdGFtcCA8IG1pblJhbmdlIHx8IG1heFJhbmdlID4gMCAmJiB0aW1lc3RhbXAgPiBtYXhSYW5nZTsNCg0KICAgICAgICAgICAgaWYgKG91dE9mUmFuZ2UpIHsNCiAgICAgICAgICAgICAgZGF5RWxlbS5jbGFzc0xpc3QuYWRkKCJub3RBbGxvd2VkIik7DQogICAgICAgICAgICAgIFsiaW5SYW5nZSIsICJzdGFydFJhbmdlIiwgImVuZFJhbmdlIl0uZm9yRWFjaChmdW5jdGlvbiAoYykgew0KICAgICAgICAgICAgICAgIGRheUVsZW0uY2xhc3NMaXN0LnJlbW92ZShjKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIHJldHVybiAiY29udGludWUiOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChjb250YWluc0Rpc2FibGVkICYmICFvdXRPZlJhbmdlKSByZXR1cm4gImNvbnRpbnVlIjsNCg0KICAgICAgICAgICAgWyJzdGFydFJhbmdlIiwgImluUmFuZ2UiLCAiZW5kUmFuZ2UiLCAibm90QWxsb3dlZCJdLmZvckVhY2goZnVuY3Rpb24gKGMpIHsNCiAgICAgICAgICAgICAgZGF5RWxlbS5jbGFzc0xpc3QucmVtb3ZlKGMpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoaG92ZXJEYXRlIDwgc2VsZi5zZWxlY3RlZERhdGVzWzBdLmdldFRpbWUoKSA/ICJzdGFydFJhbmdlIiA6ICJlbmRSYW5nZSIpOw0KDQogICAgICAgICAgICBpZiAobW9udGguY29udGFpbnMoZWxlbSkgfHwgIShtID4gMCAmJiBwcmV2TW9udGggJiYgcHJldk1vbnRoLmxhc3RDaGlsZC5kYXRlT2JqLmdldFRpbWUoKSA+PSB0aW1lc3RhbXApKSB7DQogICAgICAgICAgICAgIGlmIChpbml0aWFsRGF0ZSA8IGhvdmVyRGF0ZSAmJiB0aW1lc3RhbXAgPT09IGluaXRpYWxEYXRlKSBkYXlFbGVtLmNsYXNzTGlzdC5hZGQoInN0YXJ0UmFuZ2UiKTtlbHNlIGlmIChpbml0aWFsRGF0ZSA+IGhvdmVyRGF0ZSAmJiB0aW1lc3RhbXAgPT09IGluaXRpYWxEYXRlKSBkYXlFbGVtLmNsYXNzTGlzdC5hZGQoImVuZFJhbmdlIik7DQogICAgICAgICAgICAgIGlmICh0aW1lc3RhbXAgPj0gbWluUmFuZ2UgJiYgKG1heFJhbmdlID09PSAwIHx8IHRpbWVzdGFtcCA8PSBtYXhSYW5nZSkgJiYgaXNCZXR3ZWVuKHRpbWVzdGFtcCwgaW5pdGlhbERhdGUsIGhvdmVyRGF0ZSkpIGRheUVsZW0uY2xhc3NMaXN0LmFkZCgiaW5SYW5nZSIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH07DQoNCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG1vbnRoLmNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkrKykgew0KICAgICAgICAgICAgdmFyIF9yZXQgPSBfbG9vcChpLCBsKTsNCg0KICAgICAgICAgICAgaWYgKF9yZXQgPT09ICJjb250aW51ZSIpIGNvbnRpbnVlOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBvblJlc2l6ZSgpIHsNCiAgICAgICAgaWYgKHNlbGYuaXNPcGVuICYmICFzZWxmLmNvbmZpZy5zdGF0aWMgJiYgIXNlbGYuY29uZmlnLmlubGluZSkgcG9zaXRpb25DYWxlbmRhcigpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBvcGVuKGUsIHBvc2l0aW9uRWxlbWVudCkgew0KICAgICAgICBpZiAocG9zaXRpb25FbGVtZW50ID09PSB2b2lkIDApIHsNCiAgICAgICAgICBwb3NpdGlvbkVsZW1lbnQgPSBzZWxmLl9pbnB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLmlzTW9iaWxlID09PSB0cnVlKSB7DQogICAgICAgICAgaWYgKGUpIHsNCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIGUudGFyZ2V0ICYmIGUudGFyZ2V0LmJsdXIoKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHNlbGYubW9iaWxlSW5wdXQgIT09IHVuZGVmaW5lZCAmJiBzZWxmLm1vYmlsZUlucHV0LmZvY3VzKCk7DQogICAgICAgICAgfSwgMCk7DQogICAgICAgICAgdHJpZ2dlckV2ZW50KCJvbk9wZW4iKTsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5faW5wdXQuZGlzYWJsZWQgfHwgc2VsZi5jb25maWcuaW5saW5lKSByZXR1cm47DQogICAgICAgIHZhciB3YXNPcGVuID0gc2VsZi5pc09wZW47DQogICAgICAgIHNlbGYuaXNPcGVuID0gdHJ1ZTsNCg0KICAgICAgICBpZiAoIXdhc09wZW4pIHsNCiAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoIm9wZW4iKTsNCg0KICAgICAgICAgIHNlbGYuX2lucHV0LmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOw0KDQogICAgICAgICAgdHJpZ2dlckV2ZW50KCJvbk9wZW4iKTsNCiAgICAgICAgICBwb3NpdGlvbkNhbGVuZGFyKHBvc2l0aW9uRWxlbWVudCk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcuZW5hYmxlVGltZSA9PT0gdHJ1ZSAmJiBzZWxmLmNvbmZpZy5ub0NhbGVuZGFyID09PSB0cnVlKSB7DQogICAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHNlbGYuc2V0RGF0ZShzZWxmLmNvbmZpZy5taW5EYXRlICE9PSB1bmRlZmluZWQgPyBuZXcgRGF0ZShzZWxmLmNvbmZpZy5taW5EYXRlLmdldFRpbWUoKSkgOiBuZXcgRGF0ZSgpLCBmYWxzZSk7DQogICAgICAgICAgICBzZXREZWZhdWx0SG91cnMoKTsNCiAgICAgICAgICAgIHVwZGF0ZVZhbHVlKCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgaWYgKHNlbGYuY29uZmlnLmFsbG93SW5wdXQgPT09IGZhbHNlICYmIChlID09PSB1bmRlZmluZWQgfHwgIXNlbGYudGltZUNvbnRhaW5lci5jb250YWlucyhlLnJlbGF0ZWRUYXJnZXQpKSkgew0KICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgIHJldHVybiBzZWxmLmhvdXJFbGVtZW50LnNlbGVjdCgpOw0KICAgICAgICAgICAgfSwgNTApOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBtaW5NYXhEYXRlU2V0dGVyKHR5cGUpIHsNCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChkYXRlKSB7DQogICAgICAgICAgdmFyIGRhdGVPYmogPSBzZWxmLmNvbmZpZ1siXyIgKyB0eXBlICsgIkRhdGUiXSA9IHNlbGYucGFyc2VEYXRlKGRhdGUsIHNlbGYuY29uZmlnLmRhdGVGb3JtYXQpOw0KICAgICAgICAgIHZhciBpbnZlcnNlRGF0ZU9iaiA9IHNlbGYuY29uZmlnWyJfIiArICh0eXBlID09PSAibWluIiA/ICJtYXgiIDogIm1pbiIpICsgIkRhdGUiXTsNCg0KICAgICAgICAgIGlmIChkYXRlT2JqICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIHNlbGZbdHlwZSA9PT0gIm1pbiIgPyAibWluRGF0ZUhhc1RpbWUiIDogIm1heERhdGVIYXNUaW1lIl0gPSBkYXRlT2JqLmdldEhvdXJzKCkgPiAwIHx8IGRhdGVPYmouZ2V0TWludXRlcygpID4gMCB8fCBkYXRlT2JqLmdldFNlY29uZHMoKSA+IDA7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcykgew0KICAgICAgICAgICAgc2VsZi5zZWxlY3RlZERhdGVzID0gc2VsZi5zZWxlY3RlZERhdGVzLmZpbHRlcihmdW5jdGlvbiAoZCkgew0KICAgICAgICAgICAgICByZXR1cm4gaXNFbmFibGVkKGQpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBpZiAoIXNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggJiYgdHlwZSA9PT0gIm1pbiIpIHNldEhvdXJzRnJvbURhdGUoZGF0ZU9iaik7DQogICAgICAgICAgICB1cGRhdGVWYWx1ZSgpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmIChzZWxmLmRheXNDb250YWluZXIpIHsNCiAgICAgICAgICAgIHJlZHJhdygpOw0KICAgICAgICAgICAgaWYgKGRhdGVPYmogIT09IHVuZGVmaW5lZCkgc2VsZi5jdXJyZW50WWVhckVsZW1lbnRbdHlwZV0gPSBkYXRlT2JqLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKTtlbHNlIHNlbGYuY3VycmVudFllYXJFbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSh0eXBlKTsNCiAgICAgICAgICAgIHNlbGYuY3VycmVudFllYXJFbGVtZW50LmRpc2FibGVkID0gISFpbnZlcnNlRGF0ZU9iaiAmJiBkYXRlT2JqICE9PSB1bmRlZmluZWQgJiYgaW52ZXJzZURhdGVPYmouZ2V0RnVsbFllYXIoKSA9PT0gZGF0ZU9iai5nZXRGdWxsWWVhcigpOw0KICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gcGFyc2VDb25maWcoKSB7DQogICAgICAgIHZhciBib29sT3B0cyA9IFsid3JhcCIsICJ3ZWVrTnVtYmVycyIsICJhbGxvd0lucHV0IiwgImNsaWNrT3BlbnMiLCAidGltZV8yNGhyIiwgImVuYWJsZVRpbWUiLCAibm9DYWxlbmRhciIsICJhbHRJbnB1dCIsICJzaG9ydGhhbmRDdXJyZW50TW9udGgiLCAiaW5saW5lIiwgInN0YXRpYyIsICJlbmFibGVTZWNvbmRzIiwgImRpc2FibGVNb2JpbGUiXTsNCiAgICAgICAgdmFyIGhvb2tzID0gWyJvbkNoYW5nZSIsICJvbkNsb3NlIiwgIm9uRGF5Q3JlYXRlIiwgIm9uRGVzdHJveSIsICJvbktleURvd24iLCAib25Nb250aENoYW5nZSIsICJvbk9wZW4iLCAib25QYXJzZUNvbmZpZyIsICJvblJlYWR5IiwgIm9uVmFsdWVVcGRhdGUiLCAib25ZZWFyQ2hhbmdlIiwgIm9uUHJlQ2FsZW5kYXJQb3NpdGlvbiJdOw0KICAgICAgICB2YXIgdXNlckNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIGluc3RhbmNlQ29uZmlnLCBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGVsZW1lbnQuZGF0YXNldCB8fCB7fSkpKTsNCiAgICAgICAgdmFyIGZvcm1hdHMkJDEgPSB7fTsNCiAgICAgICAgc2VsZi5jb25maWcucGFyc2VEYXRlID0gdXNlckNvbmZpZy5wYXJzZURhdGU7DQogICAgICAgIHNlbGYuY29uZmlnLmZvcm1hdERhdGUgPSB1c2VyQ29uZmlnLmZvcm1hdERhdGU7DQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLmNvbmZpZywgImVuYWJsZSIsIHsNCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5fZW5hYmxlOw0KICAgICAgICAgIH0sDQogICAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoZGF0ZXMpIHsNCiAgICAgICAgICAgIHNlbGYuY29uZmlnLl9lbmFibGUgPSBwYXJzZURhdGVSdWxlcyhkYXRlcyk7DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYuY29uZmlnLCAiZGlzYWJsZSIsIHsNCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5fZGlzYWJsZTsNCiAgICAgICAgICB9LA0KICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGRhdGVzKSB7DQogICAgICAgICAgICBzZWxmLmNvbmZpZy5fZGlzYWJsZSA9IHBhcnNlRGF0ZVJ1bGVzKGRhdGVzKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICB2YXIgdGltZU1vZGUgPSB1c2VyQ29uZmlnLm1vZGUgPT09ICJ0aW1lIjsNCg0KICAgICAgICBpZiAoIXVzZXJDb25maWcuZGF0ZUZvcm1hdCAmJiAodXNlckNvbmZpZy5lbmFibGVUaW1lIHx8IHRpbWVNb2RlKSkgew0KICAgICAgICAgIGZvcm1hdHMkJDEuZGF0ZUZvcm1hdCA9IHVzZXJDb25maWcubm9DYWxlbmRhciB8fCB0aW1lTW9kZSA/ICJIOmkiICsgKHVzZXJDb25maWcuZW5hYmxlU2Vjb25kcyA/ICI6UyIgOiAiIikgOiBmbGF0cGlja3IuZGVmYXVsdENvbmZpZy5kYXRlRm9ybWF0ICsgIiBIOmkiICsgKHVzZXJDb25maWcuZW5hYmxlU2Vjb25kcyA/ICI6UyIgOiAiIik7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAodXNlckNvbmZpZy5hbHRJbnB1dCAmJiAodXNlckNvbmZpZy5lbmFibGVUaW1lIHx8IHRpbWVNb2RlKSAmJiAhdXNlckNvbmZpZy5hbHRGb3JtYXQpIHsNCiAgICAgICAgICBmb3JtYXRzJCQxLmFsdEZvcm1hdCA9IHVzZXJDb25maWcubm9DYWxlbmRhciB8fCB0aW1lTW9kZSA/ICJoOmkiICsgKHVzZXJDb25maWcuZW5hYmxlU2Vjb25kcyA/ICI6UyBLIiA6ICIgSyIpIDogZmxhdHBpY2tyLmRlZmF1bHRDb25maWcuYWx0Rm9ybWF0ICsgKCIgaDppIiArICh1c2VyQ29uZmlnLmVuYWJsZVNlY29uZHMgPyAiOlMiIDogIiIpICsgIiBLIik7DQogICAgICAgIH0NCg0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5jb25maWcsICJtaW5EYXRlIiwgew0KICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLl9taW5EYXRlOw0KICAgICAgICAgIH0sDQogICAgICAgICAgc2V0OiBtaW5NYXhEYXRlU2V0dGVyKCJtaW4iKQ0KICAgICAgICB9KTsNCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYuY29uZmlnLCAibWF4RGF0ZSIsIHsNCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5fbWF4RGF0ZTsNCiAgICAgICAgICB9LA0KICAgICAgICAgIHNldDogbWluTWF4RGF0ZVNldHRlcigibWF4IikNCiAgICAgICAgfSk7DQoNCiAgICAgICAgdmFyIG1pbk1heFRpbWVTZXR0ZXIgPSBmdW5jdGlvbiBtaW5NYXhUaW1lU2V0dGVyKHR5cGUpIHsNCiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbCkgew0KICAgICAgICAgICAgc2VsZi5jb25maWdbdHlwZSA9PT0gIm1pbiIgPyAiX21pblRpbWUiIDogIl9tYXhUaW1lIl0gPSBzZWxmLnBhcnNlRGF0ZSh2YWwsICJIOmkiKTsNCiAgICAgICAgICB9Ow0KICAgICAgICB9Ow0KDQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLmNvbmZpZywgIm1pblRpbWUiLCB7DQogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcuX21pblRpbWU7DQogICAgICAgICAgfSwNCiAgICAgICAgICBzZXQ6IG1pbk1heFRpbWVTZXR0ZXIoIm1pbiIpDQogICAgICAgIH0pOw0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5jb25maWcsICJtYXhUaW1lIiwgew0KICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLl9tYXhUaW1lOw0KICAgICAgICAgIH0sDQogICAgICAgICAgc2V0OiBtaW5NYXhUaW1lU2V0dGVyKCJtYXgiKQ0KICAgICAgICB9KTsNCg0KICAgICAgICBpZiAodXNlckNvbmZpZy5tb2RlID09PSAidGltZSIpIHsNCiAgICAgICAgICBzZWxmLmNvbmZpZy5ub0NhbGVuZGFyID0gdHJ1ZTsNCiAgICAgICAgICBzZWxmLmNvbmZpZy5lbmFibGVUaW1lID0gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIE9iamVjdC5hc3NpZ24oc2VsZi5jb25maWcsIGZvcm1hdHMkJDEsIHVzZXJDb25maWcpOw0KDQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYm9vbE9wdHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICBzZWxmLmNvbmZpZ1tib29sT3B0c1tpXV0gPSBzZWxmLmNvbmZpZ1tib29sT3B0c1tpXV0gPT09IHRydWUgfHwgc2VsZi5jb25maWdbYm9vbE9wdHNbaV1dID09PSAidHJ1ZSI7DQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKHZhciBfaSA9IGhvb2tzLmxlbmd0aDsgX2ktLTspIHsNCiAgICAgICAgICBpZiAoc2VsZi5jb25maWdbaG9va3NbX2ldXSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBzZWxmLmNvbmZpZ1tob29rc1tfaV1dID0gYXJyYXlpZnkoc2VsZi5jb25maWdbaG9va3NbX2ldXSB8fCBbXSkubWFwKGJpbmRUb0luc3RhbmNlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBzZWxmLmlzTW9iaWxlID0gIXNlbGYuY29uZmlnLmRpc2FibGVNb2JpbGUgJiYgIXNlbGYuY29uZmlnLmlubGluZSAmJiBzZWxmLmNvbmZpZy5tb2RlID09PSAic2luZ2xlIiAmJiAhc2VsZi5jb25maWcuZGlzYWJsZS5sZW5ndGggJiYgIXNlbGYuY29uZmlnLmVuYWJsZS5sZW5ndGggJiYgIXNlbGYuY29uZmlnLndlZWtOdW1iZXJzICYmIC9BbmRyb2lkfHdlYk9TfGlQaG9uZXxpUGFkfGlQb2R8QmxhY2tCZXJyeXxJRU1vYmlsZXxPcGVyYSBNaW5pL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTsNCg0KICAgICAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCBzZWxmLmNvbmZpZy5wbHVnaW5zLmxlbmd0aDsgX2kyKyspIHsNCiAgICAgICAgICB2YXIgcGx1Z2luQ29uZiA9IHNlbGYuY29uZmlnLnBsdWdpbnNbX2kyXShzZWxmKSB8fCB7fTsNCg0KICAgICAgICAgIGZvciAodmFyIGtleSBpbiBwbHVnaW5Db25mKSB7DQogICAgICAgICAgICBpZiAofmhvb2tzLmluZGV4T2Yoa2V5KSkgew0KICAgICAgICAgICAgICBzZWxmLmNvbmZpZ1trZXldID0gYXJyYXlpZnkocGx1Z2luQ29uZltrZXldKS5tYXAoYmluZFRvSW5zdGFuY2UpLmNvbmNhdChzZWxmLmNvbmZpZ1trZXldKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHVzZXJDb25maWdba2V5XSA9PT0gInVuZGVmaW5lZCIpIHNlbGYuY29uZmlnW2tleV0gPSBwbHVnaW5Db25mW2tleV07DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgdHJpZ2dlckV2ZW50KCJvblBhcnNlQ29uZmlnIik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHNldHVwTG9jYWxlKCkgew0KICAgICAgICBpZiAodHlwZW9mIHNlbGYuY29uZmlnLmxvY2FsZSAhPT0gIm9iamVjdCIgJiYgdHlwZW9mIGZsYXRwaWNrci5sMTBuc1tzZWxmLmNvbmZpZy5sb2NhbGVdID09PSAidW5kZWZpbmVkIikgc2VsZi5jb25maWcuZXJyb3JIYW5kbGVyKG5ldyBFcnJvcigiZmxhdHBpY2tyOiBpbnZhbGlkIGxvY2FsZSAiICsgc2VsZi5jb25maWcubG9jYWxlKSk7DQogICAgICAgIHNlbGYubDEwbiA9IE9iamVjdC5hc3NpZ24oe30sIGZsYXRwaWNrci5sMTBucy5kZWZhdWx0LCB0eXBlb2Ygc2VsZi5jb25maWcubG9jYWxlID09PSAib2JqZWN0IiA/IHNlbGYuY29uZmlnLmxvY2FsZSA6IHNlbGYuY29uZmlnLmxvY2FsZSAhPT0gImRlZmF1bHQiID8gZmxhdHBpY2tyLmwxMG5zW3NlbGYuY29uZmlnLmxvY2FsZV0gOiB1bmRlZmluZWQpOw0KICAgICAgICB0b2tlblJlZ2V4LksgPSAiKCIgKyBzZWxmLmwxMG4uYW1QTVswXSArICJ8IiArIHNlbGYubDEwbi5hbVBNWzFdICsgInwiICsgc2VsZi5sMTBuLmFtUE1bMF0udG9Mb3dlckNhc2UoKSArICJ8IiArIHNlbGYubDEwbi5hbVBNWzFdLnRvTG93ZXJDYXNlKCkgKyAiKSI7DQogICAgICAgIHNlbGYuZm9ybWF0RGF0ZSA9IGNyZWF0ZURhdGVGb3JtYXR0ZXIoc2VsZik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHBvc2l0aW9uQ2FsZW5kYXIoY3VzdG9tUG9zaXRpb25FbGVtZW50KSB7DQogICAgICAgIGlmIChzZWxmLmNhbGVuZGFyQ29udGFpbmVyID09PSB1bmRlZmluZWQpIHJldHVybjsNCiAgICAgICAgdHJpZ2dlckV2ZW50KCJvblByZUNhbGVuZGFyUG9zaXRpb24iKTsNCiAgICAgICAgdmFyIHBvc2l0aW9uRWxlbWVudCA9IGN1c3RvbVBvc2l0aW9uRWxlbWVudCB8fCBzZWxmLl9wb3NpdGlvbkVsZW1lbnQ7DQogICAgICAgIHZhciBjYWxlbmRhckhlaWdodCA9IEFycmF5LnByb3RvdHlwZS5yZWR1Y2UuY2FsbChzZWxmLmNhbGVuZGFyQ29udGFpbmVyLmNoaWxkcmVuLCBmdW5jdGlvbiAoYWNjLCBjaGlsZCkgew0KICAgICAgICAgIHJldHVybiBhY2MgKyBjaGlsZC5vZmZzZXRIZWlnaHQ7DQogICAgICAgIH0sIDApLA0KICAgICAgICAgICAgY2FsZW5kYXJXaWR0aCA9IHNlbGYuY2FsZW5kYXJDb250YWluZXIub2Zmc2V0V2lkdGgsDQogICAgICAgICAgICBjb25maWdQb3MgPSBzZWxmLmNvbmZpZy5wb3NpdGlvbi5zcGxpdCgiICIpLA0KICAgICAgICAgICAgY29uZmlnUG9zVmVydGljYWwgPSBjb25maWdQb3NbMF0sDQogICAgICAgICAgICBjb25maWdQb3NIb3Jpem9udGFsID0gY29uZmlnUG9zLmxlbmd0aCA+IDEgPyBjb25maWdQb3NbMV0gOiBudWxsLA0KICAgICAgICAgICAgaW5wdXRCb3VuZHMgPSBwb3NpdGlvbkVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksDQogICAgICAgICAgICBkaXN0YW5jZUZyb21Cb3R0b20gPSB3aW5kb3cuaW5uZXJIZWlnaHQgLSBpbnB1dEJvdW5kcy5ib3R0b20sDQogICAgICAgICAgICBzaG93T25Ub3AgPSBjb25maWdQb3NWZXJ0aWNhbCA9PT0gImFib3ZlIiB8fCBjb25maWdQb3NWZXJ0aWNhbCAhPT0gImJlbG93IiAmJiBkaXN0YW5jZUZyb21Cb3R0b20gPCBjYWxlbmRhckhlaWdodCAmJiBpbnB1dEJvdW5kcy50b3AgPiBjYWxlbmRhckhlaWdodDsNCiAgICAgICAgdmFyIHRvcCA9IHdpbmRvdy5wYWdlWU9mZnNldCArIGlucHV0Qm91bmRzLnRvcCArICghc2hvd09uVG9wID8gcG9zaXRpb25FbGVtZW50Lm9mZnNldEhlaWdodCArIDIgOiAtY2FsZW5kYXJIZWlnaHQgLSAyKTsNCiAgICAgICAgdG9nZ2xlQ2xhc3Moc2VsZi5jYWxlbmRhckNvbnRhaW5lciwgImFycm93VG9wIiwgIXNob3dPblRvcCk7DQogICAgICAgIHRvZ2dsZUNsYXNzKHNlbGYuY2FsZW5kYXJDb250YWluZXIsICJhcnJvd0JvdHRvbSIsIHNob3dPblRvcCk7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5pbmxpbmUpIHJldHVybjsNCiAgICAgICAgdmFyIGxlZnQgPSB3aW5kb3cucGFnZVhPZmZzZXQgKyBpbnB1dEJvdW5kcy5sZWZ0IC0gKGNvbmZpZ1Bvc0hvcml6b250YWwgIT0gbnVsbCAmJiBjb25maWdQb3NIb3Jpem9udGFsID09PSAiY2VudGVyIiA/IChjYWxlbmRhcldpZHRoIC0gaW5wdXRCb3VuZHMud2lkdGgpIC8gMiA6IDApOw0KICAgICAgICB2YXIgcmlnaHQgPSB3aW5kb3cuZG9jdW1lbnQuYm9keS5vZmZzZXRXaWR0aCAtIGlucHV0Qm91bmRzLnJpZ2h0Ow0KICAgICAgICB2YXIgcmlnaHRNb3N0ID0gbGVmdCArIGNhbGVuZGFyV2lkdGggPiB3aW5kb3cuZG9jdW1lbnQuYm9keS5vZmZzZXRXaWR0aDsNCiAgICAgICAgdG9nZ2xlQ2xhc3Moc2VsZi5jYWxlbmRhckNvbnRhaW5lciwgInJpZ2h0TW9zdCIsIHJpZ2h0TW9zdCk7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5zdGF0aWMpIHJldHVybjsNCiAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS50b3AgPSB0b3AgKyAicHgiOw0KDQogICAgICAgIGlmICghcmlnaHRNb3N0KSB7DQogICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gbGVmdCArICJweCI7DQogICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS5yaWdodCA9ICJhdXRvIjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLmxlZnQgPSAiYXV0byI7DQogICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS5yaWdodCA9IHJpZ2h0ICsgInB4IjsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiByZWRyYXcoKSB7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5ub0NhbGVuZGFyIHx8IHNlbGYuaXNNb2JpbGUpIHJldHVybjsNCiAgICAgICAgdXBkYXRlTmF2aWdhdGlvbkN1cnJlbnRNb250aCgpOw0KICAgICAgICBidWlsZERheXMoKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gZm9jdXNBbmRDbG9zZSgpIHsNCiAgICAgICAgc2VsZi5faW5wdXQuZm9jdXMoKTsNCg0KICAgICAgICBpZiAod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiTVNJRSIpICE9PSAtMSB8fCBuYXZpZ2F0b3IubXNNYXhUb3VjaFBvaW50cyAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgc2V0VGltZW91dChzZWxmLmNsb3NlLCAwKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzZWxmLmNsb3NlKCk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gc2VsZWN0RGF0ZShlKSB7DQogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCg0KICAgICAgICB2YXIgaXNTZWxlY3RhYmxlID0gZnVuY3Rpb24gaXNTZWxlY3RhYmxlKGRheSkgew0KICAgICAgICAgIHJldHVybiBkYXkuY2xhc3NMaXN0ICYmIGRheS5jbGFzc0xpc3QuY29udGFpbnMoImZsYXRwaWNrci1kYXkiKSAmJiAhZGF5LmNsYXNzTGlzdC5jb250YWlucygiZGlzYWJsZWQiKSAmJiAhZGF5LmNsYXNzTGlzdC5jb250YWlucygibm90QWxsb3dlZCIpOw0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciB0ID0gZmluZFBhcmVudChlLnRhcmdldCwgaXNTZWxlY3RhYmxlKTsNCiAgICAgICAgaWYgKHQgPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KICAgICAgICB2YXIgdGFyZ2V0ID0gdDsNCiAgICAgICAgdmFyIHNlbGVjdGVkRGF0ZSA9IHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqID0gbmV3IERhdGUodGFyZ2V0LmRhdGVPYmouZ2V0VGltZSgpKTsNCiAgICAgICAgdmFyIHNob3VsZENoYW5nZU1vbnRoID0gKHNlbGVjdGVkRGF0ZS5nZXRNb250aCgpIDwgc2VsZi5jdXJyZW50TW9udGggfHwgc2VsZWN0ZWREYXRlLmdldE1vbnRoKCkgPiBzZWxmLmN1cnJlbnRNb250aCArIHNlbGYuY29uZmlnLnNob3dNb250aHMgLSAxKSAmJiBzZWxmLmNvbmZpZy5tb2RlICE9PSAicmFuZ2UiOw0KICAgICAgICBzZWxmLnNlbGVjdGVkRGF0ZUVsZW0gPSB0YXJnZXQ7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tb2RlID09PSAic2luZ2xlIikgc2VsZi5zZWxlY3RlZERhdGVzID0gW3NlbGVjdGVkRGF0ZV07ZWxzZSBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gIm11bHRpcGxlIikgew0KICAgICAgICAgIHZhciBzZWxlY3RlZEluZGV4ID0gaXNEYXRlU2VsZWN0ZWQoc2VsZWN0ZWREYXRlKTsNCiAgICAgICAgICBpZiAoc2VsZWN0ZWRJbmRleCkgc2VsZi5zZWxlY3RlZERhdGVzLnNwbGljZShwYXJzZUludChzZWxlY3RlZEluZGV4KSwgMSk7ZWxzZSBzZWxmLnNlbGVjdGVkRGF0ZXMucHVzaChzZWxlY3RlZERhdGUpOw0KICAgICAgICB9IGVsc2UgaWYgKHNlbGYuY29uZmlnLm1vZGUgPT09ICJyYW5nZSIpIHsNCiAgICAgICAgICBpZiAoc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA9PT0gMikgc2VsZi5jbGVhcihmYWxzZSk7DQogICAgICAgICAgc2VsZi5zZWxlY3RlZERhdGVzLnB1c2goc2VsZWN0ZWREYXRlKTsNCiAgICAgICAgICBpZiAoY29tcGFyZURhdGVzKHNlbGVjdGVkRGF0ZSwgc2VsZi5zZWxlY3RlZERhdGVzWzBdLCB0cnVlKSAhPT0gMCkgc2VsZi5zZWxlY3RlZERhdGVzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsNCiAgICAgICAgICAgIHJldHVybiBhLmdldFRpbWUoKSAtIGIuZ2V0VGltZSgpOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIHNldEhvdXJzRnJvbUlucHV0cygpOw0KDQogICAgICAgIGlmIChzaG91bGRDaGFuZ2VNb250aCkgew0KICAgICAgICAgIHZhciBpc05ld1llYXIgPSBzZWxmLmN1cnJlbnRZZWFyICE9PSBzZWxlY3RlZERhdGUuZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICBzZWxmLmN1cnJlbnRZZWFyID0gc2VsZWN0ZWREYXRlLmdldEZ1bGxZZWFyKCk7DQogICAgICAgICAgc2VsZi5jdXJyZW50TW9udGggPSBzZWxlY3RlZERhdGUuZ2V0TW9udGgoKTsNCiAgICAgICAgICBpZiAoaXNOZXdZZWFyKSB0cmlnZ2VyRXZlbnQoIm9uWWVhckNoYW5nZSIpOw0KICAgICAgICAgIHRyaWdnZXJFdmVudCgib25Nb250aENoYW5nZSIpOw0KICAgICAgICB9DQoNCiAgICAgICAgdXBkYXRlTmF2aWdhdGlvbkN1cnJlbnRNb250aCgpOw0KICAgICAgICBidWlsZERheXMoKTsNCiAgICAgICAgc2V0RGVmYXVsdEhvdXJzKCk7DQogICAgICAgIHVwZGF0ZVZhbHVlKCk7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5lbmFibGVUaW1lKSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICByZXR1cm4gc2VsZi5zaG93VGltZUlucHV0ID0gdHJ1ZTsNCiAgICAgICAgfSwgNTApOw0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tb2RlID09PSAicmFuZ2UiKSB7DQogICAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPT09IDEpIHsNCiAgICAgICAgICAgIG9uTW91c2VPdmVyKHRhcmdldCk7DQogICAgICAgICAgfSBlbHNlIHVwZGF0ZU5hdmlnYXRpb25DdXJyZW50TW9udGgoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICghc2hvdWxkQ2hhbmdlTW9udGggJiYgc2VsZi5jb25maWcubW9kZSAhPT0gInJhbmdlIiAmJiBzZWxmLmNvbmZpZy5zaG93TW9udGhzID09PSAxKSBmb2N1c09uRGF5RWxlbSh0YXJnZXQpO2Vsc2Ugc2VsZi5zZWxlY3RlZERhdGVFbGVtICYmIHNlbGYuc2VsZWN0ZWREYXRlRWxlbS5mb2N1cygpOw0KICAgICAgICBpZiAoc2VsZi5ob3VyRWxlbWVudCAhPT0gdW5kZWZpbmVkKSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICByZXR1cm4gc2VsZi5ob3VyRWxlbWVudCAhPT0gdW5kZWZpbmVkICYmIHNlbGYuaG91ckVsZW1lbnQuc2VsZWN0KCk7DQogICAgICAgIH0sIDQ1MSk7DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmNsb3NlT25TZWxlY3QpIHsNCiAgICAgICAgICB2YXIgc2luZ2xlID0gc2VsZi5jb25maWcubW9kZSA9PT0gInNpbmdsZSIgJiYgIXNlbGYuY29uZmlnLmVuYWJsZVRpbWU7DQogICAgICAgICAgdmFyIHJhbmdlID0gc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIiAmJiBzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID09PSAyICYmICFzZWxmLmNvbmZpZy5lbmFibGVUaW1lOw0KDQogICAgICAgICAgaWYgKHNpbmdsZSB8fCByYW5nZSkgew0KICAgICAgICAgICAgZm9jdXNBbmRDbG9zZSgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHRyaWdnZXJDaGFuZ2UoKTsNCiAgICAgIH0NCg0KICAgICAgdmFyIENBTExCQUNLUyA9IHsNCiAgICAgICAgbG9jYWxlOiBbc2V0dXBMb2NhbGUsIHVwZGF0ZVdlZWtkYXlzXSwNCiAgICAgICAgc2hvd01vbnRoczogW2J1aWxkTW9udGhzLCBzZXRDYWxlbmRhcldpZHRoLCBidWlsZFdlZWtkYXlzXQ0KICAgICAgfTsNCg0KICAgICAgZnVuY3Rpb24gc2V0KG9wdGlvbiwgdmFsdWUpIHsNCiAgICAgICAgaWYgKG9wdGlvbiAhPT0gbnVsbCAmJiB0eXBlb2Ygb3B0aW9uID09PSAib2JqZWN0IikgT2JqZWN0LmFzc2lnbihzZWxmLmNvbmZpZywgb3B0aW9uKTtlbHNlIHsNCiAgICAgICAgICBzZWxmLmNvbmZpZ1tvcHRpb25dID0gdmFsdWU7DQogICAgICAgICAgaWYgKENBTExCQUNLU1tvcHRpb25dICE9PSB1bmRlZmluZWQpIENBTExCQUNLU1tvcHRpb25dLmZvckVhY2goZnVuY3Rpb24gKHgpIHsNCiAgICAgICAgICAgIHJldHVybiB4KCk7DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgc2VsZi5yZWRyYXcoKTsNCiAgICAgICAganVtcFRvRGF0ZSgpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzZXRTZWxlY3RlZERhdGUoaW5wdXREYXRlLCBmb3JtYXQpIHsNCiAgICAgICAgdmFyIGRhdGVzID0gW107DQogICAgICAgIGlmIChpbnB1dERhdGUgaW5zdGFuY2VvZiBBcnJheSkgZGF0ZXMgPSBpbnB1dERhdGUubWFwKGZ1bmN0aW9uIChkKSB7DQogICAgICAgICAgcmV0dXJuIHNlbGYucGFyc2VEYXRlKGQsIGZvcm1hdCk7DQogICAgICAgIH0pO2Vsc2UgaWYgKGlucHV0RGF0ZSBpbnN0YW5jZW9mIERhdGUgfHwgdHlwZW9mIGlucHV0RGF0ZSA9PT0gIm51bWJlciIpIGRhdGVzID0gW3NlbGYucGFyc2VEYXRlKGlucHV0RGF0ZSwgZm9ybWF0KV07ZWxzZSBpZiAodHlwZW9mIGlucHV0RGF0ZSA9PT0gInN0cmluZyIpIHsNCiAgICAgICAgICBzd2l0Y2ggKHNlbGYuY29uZmlnLm1vZGUpIHsNCiAgICAgICAgICAgIGNhc2UgInNpbmdsZSI6DQogICAgICAgICAgICBjYXNlICJ0aW1lIjoNCiAgICAgICAgICAgICAgZGF0ZXMgPSBbc2VsZi5wYXJzZURhdGUoaW5wdXREYXRlLCBmb3JtYXQpXTsNCiAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgIm11bHRpcGxlIjoNCiAgICAgICAgICAgICAgZGF0ZXMgPSBpbnB1dERhdGUuc3BsaXQoc2VsZi5jb25maWcuY29uanVuY3Rpb24pLm1hcChmdW5jdGlvbiAoZGF0ZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnBhcnNlRGF0ZShkYXRlLCBmb3JtYXQpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgInJhbmdlIjoNCiAgICAgICAgICAgICAgZGF0ZXMgPSBpbnB1dERhdGUuc3BsaXQoc2VsZi5sMTBuLnJhbmdlU2VwYXJhdG9yKS5tYXAoZnVuY3Rpb24gKGRhdGUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5wYXJzZURhdGUoZGF0ZSwgZm9ybWF0KTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSBzZWxmLmNvbmZpZy5lcnJvckhhbmRsZXIobmV3IEVycm9yKCJJbnZhbGlkIGRhdGUgc3VwcGxpZWQ6ICIgKyBKU09OLnN0cmluZ2lmeShpbnB1dERhdGUpKSk7DQogICAgICAgIHNlbGYuc2VsZWN0ZWREYXRlcyA9IGRhdGVzLmZpbHRlcihmdW5jdGlvbiAoZCkgew0KICAgICAgICAgIHJldHVybiBkIGluc3RhbmNlb2YgRGF0ZSAmJiBpc0VuYWJsZWQoZCwgZmFsc2UpOw0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1vZGUgPT09ICJyYW5nZSIpIHNlbGYuc2VsZWN0ZWREYXRlcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7DQogICAgICAgICAgcmV0dXJuIGEuZ2V0VGltZSgpIC0gYi5nZXRUaW1lKCk7DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzZXREYXRlKGRhdGUsIHRyaWdnZXJDaGFuZ2UsIGZvcm1hdCkgew0KICAgICAgICBpZiAodHJpZ2dlckNoYW5nZSA9PT0gdm9pZCAwKSB7DQogICAgICAgICAgdHJpZ2dlckNoYW5nZSA9IGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGZvcm1hdCA9PT0gdm9pZCAwKSB7DQogICAgICAgICAgZm9ybWF0ID0gc2VsZi5jb25maWcuZGF0ZUZvcm1hdDsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChkYXRlICE9PSAwICYmICFkYXRlIHx8IGRhdGUgaW5zdGFuY2VvZiBBcnJheSAmJiBkYXRlLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHNlbGYuY2xlYXIodHJpZ2dlckNoYW5nZSk7DQogICAgICAgIHNldFNlbGVjdGVkRGF0ZShkYXRlLCBmb3JtYXQpOw0KICAgICAgICBzZWxmLnNob3dUaW1lSW5wdXQgPSBzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID4gMDsNCiAgICAgICAgc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogPSBzZWxmLnNlbGVjdGVkRGF0ZXNbMF07DQogICAgICAgIHNlbGYucmVkcmF3KCk7DQogICAgICAgIGp1bXBUb0RhdGUoKTsNCiAgICAgICAgc2V0SG91cnNGcm9tRGF0ZSgpOw0KICAgICAgICB1cGRhdGVWYWx1ZSh0cmlnZ2VyQ2hhbmdlKTsNCiAgICAgICAgaWYgKHRyaWdnZXJDaGFuZ2UpIHRyaWdnZXJFdmVudCgib25DaGFuZ2UiKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gcGFyc2VEYXRlUnVsZXMoYXJyKSB7DQogICAgICAgIHJldHVybiBhcnIuc2xpY2UoKS5tYXAoZnVuY3Rpb24gKHJ1bGUpIHsNCiAgICAgICAgICBpZiAodHlwZW9mIHJ1bGUgPT09ICJzdHJpbmciIHx8IHR5cGVvZiBydWxlID09PSAibnVtYmVyIiB8fCBydWxlIGluc3RhbmNlb2YgRGF0ZSkgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYucGFyc2VEYXRlKHJ1bGUsIHVuZGVmaW5lZCwgdHJ1ZSk7DQogICAgICAgICAgfSBlbHNlIGlmIChydWxlICYmIHR5cGVvZiBydWxlID09PSAib2JqZWN0IiAmJiBydWxlLmZyb20gJiYgcnVsZS50bykgcmV0dXJuIHsNCiAgICAgICAgICAgIGZyb206IHNlbGYucGFyc2VEYXRlKHJ1bGUuZnJvbSwgdW5kZWZpbmVkKSwNCiAgICAgICAgICAgIHRvOiBzZWxmLnBhcnNlRGF0ZShydWxlLnRvLCB1bmRlZmluZWQpDQogICAgICAgICAgfTsNCg0KICAgICAgICAgIHJldHVybiBydWxlOw0KICAgICAgICB9KS5maWx0ZXIoZnVuY3Rpb24gKHgpIHsNCiAgICAgICAgICByZXR1cm4geDsNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHNldHVwRGF0ZXMoKSB7DQogICAgICAgIHNlbGYuc2VsZWN0ZWREYXRlcyA9IFtdOw0KICAgICAgICBzZWxmLm5vdyA9IHNlbGYucGFyc2VEYXRlKHNlbGYuY29uZmlnLm5vdykgfHwgbmV3IERhdGUoKTsNCiAgICAgICAgdmFyIHByZWxvYWRlZERhdGUgPSBzZWxmLmNvbmZpZy5kZWZhdWx0RGF0ZSB8fCAoc2VsZi5pbnB1dC5wbGFjZWhvbGRlci5sZW5ndGggPiAwICYmIHNlbGYuaW5wdXQudmFsdWUgPT09IHNlbGYuaW5wdXQucGxhY2Vob2xkZXIgPyBudWxsIDogc2VsZi5pbnB1dC52YWx1ZSk7DQogICAgICAgIGlmIChwcmVsb2FkZWREYXRlKSBzZXRTZWxlY3RlZERhdGUocHJlbG9hZGVkRGF0ZSwgc2VsZi5jb25maWcuZGF0ZUZvcm1hdCk7DQogICAgICAgIHZhciBpbml0aWFsRGF0ZSA9IHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPiAwID8gc2VsZi5zZWxlY3RlZERhdGVzWzBdIDogc2VsZi5jb25maWcubWluRGF0ZSAmJiBzZWxmLmNvbmZpZy5taW5EYXRlLmdldFRpbWUoKSA+IHNlbGYubm93LmdldFRpbWUoKSA/IHNlbGYuY29uZmlnLm1pbkRhdGUgOiBzZWxmLmNvbmZpZy5tYXhEYXRlICYmIHNlbGYuY29uZmlnLm1heERhdGUuZ2V0VGltZSgpIDwgc2VsZi5ub3cuZ2V0VGltZSgpID8gc2VsZi5jb25maWcubWF4RGF0ZSA6IHNlbGYubm93Ow0KICAgICAgICBzZWxmLmN1cnJlbnRZZWFyID0gaW5pdGlhbERhdGUuZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgc2VsZi5jdXJyZW50TW9udGggPSBpbml0aWFsRGF0ZS5nZXRNb250aCgpOw0KICAgICAgICBpZiAoc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA+IDApIHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqID0gc2VsZi5zZWxlY3RlZERhdGVzWzBdOw0KICAgICAgICBpZiAoc2VsZi5jb25maWcubWluVGltZSAhPT0gdW5kZWZpbmVkKSBzZWxmLmNvbmZpZy5taW5UaW1lID0gc2VsZi5wYXJzZURhdGUoc2VsZi5jb25maWcubWluVGltZSwgIkg6aSIpOw0KICAgICAgICBpZiAoc2VsZi5jb25maWcubWF4VGltZSAhPT0gdW5kZWZpbmVkKSBzZWxmLmNvbmZpZy5tYXhUaW1lID0gc2VsZi5wYXJzZURhdGUoc2VsZi5jb25maWcubWF4VGltZSwgIkg6aSIpOw0KICAgICAgICBzZWxmLm1pbkRhdGVIYXNUaW1lID0gISFzZWxmLmNvbmZpZy5taW5EYXRlICYmIChzZWxmLmNvbmZpZy5taW5EYXRlLmdldEhvdXJzKCkgPiAwIHx8IHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0TWludXRlcygpID4gMCB8fCBzZWxmLmNvbmZpZy5taW5EYXRlLmdldFNlY29uZHMoKSA+IDApOw0KICAgICAgICBzZWxmLm1heERhdGVIYXNUaW1lID0gISFzZWxmLmNvbmZpZy5tYXhEYXRlICYmIChzZWxmLmNvbmZpZy5tYXhEYXRlLmdldEhvdXJzKCkgPiAwIHx8IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0TWludXRlcygpID4gMCB8fCBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldFNlY29uZHMoKSA+IDApOw0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZiwgInNob3dUaW1lSW5wdXQiLCB7DQogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2hvd1RpbWVJbnB1dDsNCiAgICAgICAgICB9LA0KICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGJvb2wpIHsNCiAgICAgICAgICAgIHNlbGYuX3Nob3dUaW1lSW5wdXQgPSBib29sOw0KICAgICAgICAgICAgaWYgKHNlbGYuY2FsZW5kYXJDb250YWluZXIpIHRvZ2dsZUNsYXNzKHNlbGYuY2FsZW5kYXJDb250YWluZXIsICJzaG93VGltZUlucHV0IiwgYm9vbCk7DQogICAgICAgICAgICBzZWxmLmlzT3BlbiAmJiBwb3NpdGlvbkNhbGVuZGFyKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gc2V0dXBJbnB1dHMoKSB7DQogICAgICAgIHNlbGYuaW5wdXQgPSBzZWxmLmNvbmZpZy53cmFwID8gZWxlbWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1pbnB1dF0iKSA6IGVsZW1lbnQ7DQoNCiAgICAgICAgaWYgKCFzZWxmLmlucHV0KSB7DQogICAgICAgICAgc2VsZi5jb25maWcuZXJyb3JIYW5kbGVyKG5ldyBFcnJvcigiSW52YWxpZCBpbnB1dCBlbGVtZW50IHNwZWNpZmllZCIpKTsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBzZWxmLmlucHV0Ll90eXBlID0gc2VsZi5pbnB1dC50eXBlOw0KICAgICAgICBzZWxmLmlucHV0LnR5cGUgPSAidGV4dCI7DQogICAgICAgIHNlbGYuaW5wdXQuY2xhc3NMaXN0LmFkZCgiZmxhdHBpY2tyLWlucHV0Iik7DQogICAgICAgIHNlbGYuX2lucHV0ID0gc2VsZi5pbnB1dDsNCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcuYWx0SW5wdXQpIHsNCiAgICAgICAgICBzZWxmLmFsdElucHV0ID0gY3JlYXRlRWxlbWVudChzZWxmLmlucHV0Lm5vZGVOYW1lLCBzZWxmLmlucHV0LmNsYXNzTmFtZSArICIgIiArIHNlbGYuY29uZmlnLmFsdElucHV0Q2xhc3MpOw0KICAgICAgICAgIHNlbGYuX2lucHV0ID0gc2VsZi5hbHRJbnB1dDsNCiAgICAgICAgICBzZWxmLmFsdElucHV0LnBsYWNlaG9sZGVyID0gc2VsZi5pbnB1dC5wbGFjZWhvbGRlcjsNCiAgICAgICAgICBzZWxmLmFsdElucHV0LmRpc2FibGVkID0gc2VsZi5pbnB1dC5kaXNhYmxlZDsNCiAgICAgICAgICBzZWxmLmFsdElucHV0LnJlcXVpcmVkID0gc2VsZi5pbnB1dC5yZXF1aXJlZDsNCiAgICAgICAgICBzZWxmLmFsdElucHV0LnRhYkluZGV4ID0gc2VsZi5pbnB1dC50YWJJbmRleDsNCiAgICAgICAgICBzZWxmLmFsdElucHV0LnR5cGUgPSAidGV4dCI7DQogICAgICAgICAgc2VsZi5pbnB1dC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAiaGlkZGVuIik7DQogICAgICAgICAgaWYgKCFzZWxmLmNvbmZpZy5zdGF0aWMgJiYgc2VsZi5pbnB1dC5wYXJlbnROb2RlKSBzZWxmLmlucHV0LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHNlbGYuYWx0SW5wdXQsIHNlbGYuaW5wdXQubmV4dFNpYmxpbmcpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCFzZWxmLmNvbmZpZy5hbGxvd0lucHV0KSBzZWxmLl9pbnB1dC5zZXRBdHRyaWJ1dGUoInJlYWRvbmx5IiwgInJlYWRvbmx5Iik7DQogICAgICAgIHNlbGYuX3Bvc2l0aW9uRWxlbWVudCA9IHNlbGYuY29uZmlnLnBvc2l0aW9uRWxlbWVudCB8fCBzZWxmLl9pbnB1dDsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gc2V0dXBNb2JpbGUoKSB7DQogICAgICAgIHZhciBpbnB1dFR5cGUgPSBzZWxmLmNvbmZpZy5lbmFibGVUaW1lID8gc2VsZi5jb25maWcubm9DYWxlbmRhciA/ICJ0aW1lIiA6ICJkYXRldGltZS1sb2NhbCIgOiAiZGF0ZSI7DQogICAgICAgIHNlbGYubW9iaWxlSW5wdXQgPSBjcmVhdGVFbGVtZW50KCJpbnB1dCIsIHNlbGYuaW5wdXQuY2xhc3NOYW1lICsgIiBmbGF0cGlja3ItbW9iaWxlIik7DQogICAgICAgIHNlbGYubW9iaWxlSW5wdXQuc3RlcCA9IHNlbGYuaW5wdXQuZ2V0QXR0cmlidXRlKCJzdGVwIikgfHwgImFueSI7DQogICAgICAgIHNlbGYubW9iaWxlSW5wdXQudGFiSW5kZXggPSAxOw0KICAgICAgICBzZWxmLm1vYmlsZUlucHV0LnR5cGUgPSBpbnB1dFR5cGU7DQogICAgICAgIHNlbGYubW9iaWxlSW5wdXQuZGlzYWJsZWQgPSBzZWxmLmlucHV0LmRpc2FibGVkOw0KICAgICAgICBzZWxmLm1vYmlsZUlucHV0LnJlcXVpcmVkID0gc2VsZi5pbnB1dC5yZXF1aXJlZDsNCiAgICAgICAgc2VsZi5tb2JpbGVJbnB1dC5wbGFjZWhvbGRlciA9IHNlbGYuaW5wdXQucGxhY2Vob2xkZXI7DQogICAgICAgIHNlbGYubW9iaWxlRm9ybWF0U3RyID0gaW5wdXRUeXBlID09PSAiZGF0ZXRpbWUtbG9jYWwiID8gIlktbS1kXFxUSDppOlMiIDogaW5wdXRUeXBlID09PSAiZGF0ZSIgPyAiWS1tLWQiIDogIkg6aTpTIjsNCg0KICAgICAgICBpZiAoc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICBzZWxmLm1vYmlsZUlucHV0LmRlZmF1bHRWYWx1ZSA9IHNlbGYubW9iaWxlSW5wdXQudmFsdWUgPSBzZWxmLmZvcm1hdERhdGUoc2VsZi5zZWxlY3RlZERhdGVzWzBdLCBzZWxmLm1vYmlsZUZvcm1hdFN0cik7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcubWluRGF0ZSkgc2VsZi5tb2JpbGVJbnB1dC5taW4gPSBzZWxmLmZvcm1hdERhdGUoc2VsZi5jb25maWcubWluRGF0ZSwgIlktbS1kIik7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tYXhEYXRlKSBzZWxmLm1vYmlsZUlucHV0Lm1heCA9IHNlbGYuZm9ybWF0RGF0ZShzZWxmLmNvbmZpZy5tYXhEYXRlLCAiWS1tLWQiKTsNCiAgICAgICAgc2VsZi5pbnB1dC50eXBlID0gImhpZGRlbiI7DQogICAgICAgIGlmIChzZWxmLmFsdElucHV0ICE9PSB1bmRlZmluZWQpIHNlbGYuYWx0SW5wdXQudHlwZSA9ICJoaWRkZW4iOw0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgaWYgKHNlbGYuaW5wdXQucGFyZW50Tm9kZSkgc2VsZi5pbnB1dC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzZWxmLm1vYmlsZUlucHV0LCBzZWxmLmlucHV0Lm5leHRTaWJsaW5nKTsNCiAgICAgICAgfSBjYXRjaCAoX2EpIHt9DQoNCiAgICAgICAgYmluZChzZWxmLm1vYmlsZUlucHV0LCAiY2hhbmdlIiwgZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICBzZWxmLnNldERhdGUoZS50YXJnZXQudmFsdWUsIGZhbHNlLCBzZWxmLm1vYmlsZUZvcm1hdFN0cik7DQogICAgICAgICAgdHJpZ2dlckV2ZW50KCJvbkNoYW5nZSIpOw0KICAgICAgICAgIHRyaWdnZXJFdmVudCgib25DbG9zZSIpOw0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gdG9nZ2xlKGUpIHsNCiAgICAgICAgaWYgKHNlbGYuaXNPcGVuID09PSB0cnVlKSByZXR1cm4gc2VsZi5jbG9zZSgpOw0KICAgICAgICBzZWxmLm9wZW4oZSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHRyaWdnZXJFdmVudChldmVudCwgZGF0YSkgew0KICAgICAgICB2YXIgaG9va3MgPSBzZWxmLmNvbmZpZ1tldmVudF07DQoNCiAgICAgICAgaWYgKGhvb2tzICE9PSB1bmRlZmluZWQgJiYgaG9va3MubGVuZ3RoID4gMCkgew0KICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBob29rc1tpXSAmJiBpIDwgaG9va3MubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGhvb2tzW2ldKHNlbGYuc2VsZWN0ZWREYXRlcywgc2VsZi5pbnB1dC52YWx1ZSwgc2VsZiwgZGF0YSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGV2ZW50ID09PSAib25DaGFuZ2UiKSB7DQogICAgICAgICAgc2VsZi5pbnB1dC5kaXNwYXRjaEV2ZW50KGNyZWF0ZUV2ZW50KCJjaGFuZ2UiKSk7DQogICAgICAgICAgc2VsZi5pbnB1dC5kaXNwYXRjaEV2ZW50KGNyZWF0ZUV2ZW50KCJpbnB1dCIpKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBjcmVhdGVFdmVudChuYW1lKSB7DQogICAgICAgIHZhciBlID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoIkV2ZW50Iik7DQogICAgICAgIGUuaW5pdEV2ZW50KG5hbWUsIHRydWUsIHRydWUpOw0KICAgICAgICByZXR1cm4gZTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gaXNEYXRlU2VsZWN0ZWQoZGF0ZSkgew0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgIGlmIChjb21wYXJlRGF0ZXMoc2VsZi5zZWxlY3RlZERhdGVzW2ldLCBkYXRlKSA9PT0gMCkgcmV0dXJuICIiICsgaTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gaXNEYXRlSW5SYW5nZShkYXRlKSB7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tb2RlICE9PSAicmFuZ2UiIHx8IHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPCAyKSByZXR1cm4gZmFsc2U7DQogICAgICAgIHJldHVybiBjb21wYXJlRGF0ZXMoZGF0ZSwgc2VsZi5zZWxlY3RlZERhdGVzWzBdKSA+PSAwICYmIGNvbXBhcmVEYXRlcyhkYXRlLCBzZWxmLnNlbGVjdGVkRGF0ZXNbMV0pIDw9IDA7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZU5hdmlnYXRpb25DdXJyZW50TW9udGgoKSB7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5ub0NhbGVuZGFyIHx8IHNlbGYuaXNNb2JpbGUgfHwgIXNlbGYubW9udGhOYXYpIHJldHVybjsNCiAgICAgICAgc2VsZi55ZWFyRWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAoeWVhckVsZW1lbnQsIGkpIHsNCiAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKHNlbGYuY3VycmVudFllYXIsIHNlbGYuY3VycmVudE1vbnRoLCAxKTsNCiAgICAgICAgICBkLnNldE1vbnRoKHNlbGYuY3VycmVudE1vbnRoICsgaSk7DQogICAgICAgICAgc2VsZi5tb250aEVsZW1lbnRzW2ldLnRleHRDb250ZW50ID0gbW9udGhUb1N0cihkLmdldE1vbnRoKCksIHNlbGYuY29uZmlnLnNob3J0aGFuZEN1cnJlbnRNb250aCwgc2VsZi5sMTBuKSArICIgIjsNCiAgICAgICAgICB5ZWFyRWxlbWVudC52YWx1ZSA9IGQuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpOw0KICAgICAgICB9KTsNCiAgICAgICAgc2VsZi5faGlkZVByZXZNb250aEFycm93ID0gc2VsZi5jb25maWcubWluRGF0ZSAhPT0gdW5kZWZpbmVkICYmIChzZWxmLmN1cnJlbnRZZWFyID09PSBzZWxmLmNvbmZpZy5taW5EYXRlLmdldEZ1bGxZZWFyKCkgPyBzZWxmLmN1cnJlbnRNb250aCA8PSBzZWxmLmNvbmZpZy5taW5EYXRlLmdldE1vbnRoKCkgOiBzZWxmLmN1cnJlbnRZZWFyIDwgc2VsZi5jb25maWcubWluRGF0ZS5nZXRGdWxsWWVhcigpKTsNCiAgICAgICAgc2VsZi5faGlkZU5leHRNb250aEFycm93ID0gc2VsZi5jb25maWcubWF4RGF0ZSAhPT0gdW5kZWZpbmVkICYmIChzZWxmLmN1cnJlbnRZZWFyID09PSBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldEZ1bGxZZWFyKCkgPyBzZWxmLmN1cnJlbnRNb250aCArIDEgPiBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldE1vbnRoKCkgOiBzZWxmLmN1cnJlbnRZZWFyID4gc2VsZi5jb25maWcubWF4RGF0ZS5nZXRGdWxsWWVhcigpKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gdXBkYXRlVmFsdWUodHJpZ2dlckNoYW5nZSkgew0KICAgICAgICBpZiAodHJpZ2dlckNoYW5nZSA9PT0gdm9pZCAwKSB7DQogICAgICAgICAgdHJpZ2dlckNoYW5nZSA9IHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHNlbGYuY2xlYXIodHJpZ2dlckNoYW5nZSk7DQoNCiAgICAgICAgaWYgKHNlbGYubW9iaWxlSW5wdXQgIT09IHVuZGVmaW5lZCAmJiBzZWxmLm1vYmlsZUZvcm1hdFN0cikgew0KICAgICAgICAgIHNlbGYubW9iaWxlSW5wdXQudmFsdWUgPSBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiAhPT0gdW5kZWZpbmVkID8gc2VsZi5mb3JtYXREYXRlKHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqLCBzZWxmLm1vYmlsZUZvcm1hdFN0cikgOiAiIjsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBqb2luQ2hhciA9IHNlbGYuY29uZmlnLm1vZGUgIT09ICJyYW5nZSIgPyBzZWxmLmNvbmZpZy5jb25qdW5jdGlvbiA6IHNlbGYubDEwbi5yYW5nZVNlcGFyYXRvcjsNCiAgICAgICAgc2VsZi5pbnB1dC52YWx1ZSA9IHNlbGYuc2VsZWN0ZWREYXRlcy5tYXAoZnVuY3Rpb24gKGRPYmopIHsNCiAgICAgICAgICByZXR1cm4gc2VsZi5mb3JtYXREYXRlKGRPYmosIHNlbGYuY29uZmlnLmRhdGVGb3JtYXQpOw0KICAgICAgICB9KS5qb2luKGpvaW5DaGFyKTsNCg0KICAgICAgICBpZiAoc2VsZi5hbHRJbnB1dCAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgc2VsZi5hbHRJbnB1dC52YWx1ZSA9IHNlbGYuc2VsZWN0ZWREYXRlcy5tYXAoZnVuY3Rpb24gKGRPYmopIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLmZvcm1hdERhdGUoZE9iaiwgc2VsZi5jb25maWcuYWx0Rm9ybWF0KTsNCiAgICAgICAgICB9KS5qb2luKGpvaW5DaGFyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICh0cmlnZ2VyQ2hhbmdlICE9PSBmYWxzZSkgdHJpZ2dlckV2ZW50KCJvblZhbHVlVXBkYXRlIik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIG9uTW9udGhOYXZDbGljayhlKSB7DQogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgdmFyIGlzUHJldk1vbnRoID0gc2VsZi5wcmV2TW9udGhOYXYuY29udGFpbnMoZS50YXJnZXQpOw0KICAgICAgICB2YXIgaXNOZXh0TW9udGggPSBzZWxmLm5leHRNb250aE5hdi5jb250YWlucyhlLnRhcmdldCk7DQoNCiAgICAgICAgaWYgKGlzUHJldk1vbnRoIHx8IGlzTmV4dE1vbnRoKSB7DQogICAgICAgICAgY2hhbmdlTW9udGgoaXNQcmV2TW9udGggPyAtMSA6IDEpOw0KICAgICAgICB9IGVsc2UgaWYgKHNlbGYueWVhckVsZW1lbnRzLmluZGV4T2YoZS50YXJnZXQpID49IDApIHsNCiAgICAgICAgICBlLnRhcmdldC5zZWxlY3QoKTsNCiAgICAgICAgfSBlbHNlIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImFycm93VXAiKSkgew0KICAgICAgICAgIHNlbGYuY2hhbmdlWWVhcihzZWxmLmN1cnJlbnRZZWFyICsgMSk7DQogICAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJhcnJvd0Rvd24iKSkgew0KICAgICAgICAgIHNlbGYuY2hhbmdlWWVhcihzZWxmLmN1cnJlbnRZZWFyIC0gMSk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gdGltZVdyYXBwZXIoZSkgew0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIHZhciBpc0tleURvd24gPSBlLnR5cGUgPT09ICJrZXlkb3duIiwNCiAgICAgICAgICAgIGlucHV0ID0gZS50YXJnZXQ7DQoNCiAgICAgICAgaWYgKHNlbGYuYW1QTSAhPT0gdW5kZWZpbmVkICYmIGUudGFyZ2V0ID09PSBzZWxmLmFtUE0pIHsNCiAgICAgICAgICBzZWxmLmFtUE0udGV4dENvbnRlbnQgPSBzZWxmLmwxMG4uYW1QTVtpbnQoc2VsZi5hbVBNLnRleHRDb250ZW50ID09PSBzZWxmLmwxMG4uYW1QTVswXSldOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIG1pbiA9IHBhcnNlRmxvYXQoaW5wdXQuZ2V0QXR0cmlidXRlKCJkYXRhLW1pbiIpKSwNCiAgICAgICAgICAgIG1heCA9IHBhcnNlRmxvYXQoaW5wdXQuZ2V0QXR0cmlidXRlKCJkYXRhLW1heCIpKSwNCiAgICAgICAgICAgIHN0ZXAgPSBwYXJzZUZsb2F0KGlucHV0LmdldEF0dHJpYnV0ZSgiZGF0YS1zdGVwIikpLA0KICAgICAgICAgICAgY3VyVmFsdWUgPSBwYXJzZUludChpbnB1dC52YWx1ZSwgMTApLA0KICAgICAgICAgICAgZGVsdGEgPSBlLmRlbHRhIHx8IChpc0tleURvd24gPyBlLndoaWNoID09PSAzOCA/IDEgOiAtMSA6IDApOw0KICAgICAgICB2YXIgbmV3VmFsdWUgPSBjdXJWYWx1ZSArIHN0ZXAgKiBkZWx0YTsNCg0KICAgICAgICBpZiAodHlwZW9mIGlucHV0LnZhbHVlICE9PSAidW5kZWZpbmVkIiAmJiBpbnB1dC52YWx1ZS5sZW5ndGggPT09IDIpIHsNCiAgICAgICAgICB2YXIgaXNIb3VyRWxlbSA9IGlucHV0ID09PSBzZWxmLmhvdXJFbGVtZW50LA0KICAgICAgICAgICAgICBpc01pbnV0ZUVsZW0gPSBpbnB1dCA9PT0gc2VsZi5taW51dGVFbGVtZW50Ow0KDQogICAgICAgICAgaWYgKG5ld1ZhbHVlIDwgbWluKSB7DQogICAgICAgICAgICBuZXdWYWx1ZSA9IG1heCArIG5ld1ZhbHVlICsgaW50KCFpc0hvdXJFbGVtKSArIChpbnQoaXNIb3VyRWxlbSkgJiYgaW50KCFzZWxmLmFtUE0pKTsNCiAgICAgICAgICAgIGlmIChpc01pbnV0ZUVsZW0pIGluY3JlbWVudE51bUlucHV0KHVuZGVmaW5lZCwgLTEsIHNlbGYuaG91ckVsZW1lbnQpOw0KICAgICAgICAgIH0gZWxzZSBpZiAobmV3VmFsdWUgPiBtYXgpIHsNCiAgICAgICAgICAgIG5ld1ZhbHVlID0gaW5wdXQgPT09IHNlbGYuaG91ckVsZW1lbnQgPyBuZXdWYWx1ZSAtIG1heCAtIGludCghc2VsZi5hbVBNKSA6IG1pbjsNCiAgICAgICAgICAgIGlmIChpc01pbnV0ZUVsZW0pIGluY3JlbWVudE51bUlucHV0KHVuZGVmaW5lZCwgMSwgc2VsZi5ob3VyRWxlbWVudCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgaWYgKHNlbGYuYW1QTSAmJiBpc0hvdXJFbGVtICYmIChzdGVwID09PSAxID8gbmV3VmFsdWUgKyBjdXJWYWx1ZSA9PT0gMjMgOiBNYXRoLmFicyhuZXdWYWx1ZSAtIGN1clZhbHVlKSA+IHN0ZXApKSB7DQogICAgICAgICAgICBzZWxmLmFtUE0udGV4dENvbnRlbnQgPSBzZWxmLmwxMG4uYW1QTVtpbnQoc2VsZi5hbVBNLnRleHRDb250ZW50ID09PSBzZWxmLmwxMG4uYW1QTVswXSldOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlucHV0LnZhbHVlID0gcGFkKG5ld1ZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBpbml0KCk7DQogICAgICByZXR1cm4gc2VsZjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBfZmxhdHBpY2tyKG5vZGVMaXN0LCBjb25maWcpIHsNCiAgICAgIHZhciBub2RlcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKG5vZGVMaXN0KTsNCiAgICAgIHZhciBpbnN0YW5jZXMgPSBbXTsNCg0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICB2YXIgbm9kZSA9IG5vZGVzW2ldOw0KDQogICAgICAgIHRyeSB7DQogICAgICAgICAgaWYgKG5vZGUuZ2V0QXR0cmlidXRlKCJkYXRhLWZwLW9taXQiKSAhPT0gbnVsbCkgY29udGludWU7DQoNCiAgICAgICAgICBpZiAobm9kZS5fZmxhdHBpY2tyICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIG5vZGUuX2ZsYXRwaWNrci5kZXN0cm95KCk7DQoNCiAgICAgICAgICAgIG5vZGUuX2ZsYXRwaWNrciA9IHVuZGVmaW5lZDsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBub2RlLl9mbGF0cGlja3IgPSBGbGF0cGlja3JJbnN0YW5jZShub2RlLCBjb25maWcgfHwge30pOw0KICAgICAgICAgIGluc3RhbmNlcy5wdXNoKG5vZGUuX2ZsYXRwaWNrcik7DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICBjb25zb2xlLmVycm9yKGUpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHJldHVybiBpbnN0YW5jZXMubGVuZ3RoID09PSAxID8gaW5zdGFuY2VzWzBdIDogaW5zdGFuY2VzOw0KICAgIH0NCg0KICAgIGlmICh0eXBlb2YgSFRNTEVsZW1lbnQgIT09ICJ1bmRlZmluZWQiKSB7DQogICAgICBIVE1MQ29sbGVjdGlvbi5wcm90b3R5cGUuZmxhdHBpY2tyID0gTm9kZUxpc3QucHJvdG90eXBlLmZsYXRwaWNrciA9IGZ1bmN0aW9uIChjb25maWcpIHsNCiAgICAgICAgcmV0dXJuIF9mbGF0cGlja3IodGhpcywgY29uZmlnKTsNCiAgICAgIH07DQoNCiAgICAgIEhUTUxFbGVtZW50LnByb3RvdHlwZS5mbGF0cGlja3IgPSBmdW5jdGlvbiAoY29uZmlnKSB7DQogICAgICAgIHJldHVybiBfZmxhdHBpY2tyKFt0aGlzXSwgY29uZmlnKTsNCiAgICAgIH07DQogICAgfQ0KDQogICAgdmFyIGZsYXRwaWNrciA9IGZ1bmN0aW9uIGZsYXRwaWNrcihzZWxlY3RvciwgY29uZmlnKSB7DQogICAgICBpZiAoc2VsZWN0b3IgaW5zdGFuY2VvZiBOb2RlTGlzdCkgcmV0dXJuIF9mbGF0cGlja3Ioc2VsZWN0b3IsIGNvbmZpZyk7ZWxzZSBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIikgcmV0dXJuIF9mbGF0cGlja3Iod2luZG93LmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpLCBjb25maWcpOw0KICAgICAgcmV0dXJuIF9mbGF0cGlja3IoW3NlbGVjdG9yXSwgY29uZmlnKTsNCiAgICB9Ow0KDQogICAgZmxhdHBpY2tyLmRlZmF1bHRDb25maWcgPSBkZWZhdWx0czsNCiAgICBmbGF0cGlja3IubDEwbnMgPSB7DQogICAgICBlbjogT2JqZWN0LmFzc2lnbih7fSwgZW5nbGlzaCksDQogICAgICBkZWZhdWx0OiBPYmplY3QuYXNzaWduKHt9LCBlbmdsaXNoKQ0KICAgIH07DQoNCiAgICBmbGF0cGlja3IubG9jYWxpemUgPSBmdW5jdGlvbiAobDEwbikgew0KICAgICAgZmxhdHBpY2tyLmwxMG5zLmRlZmF1bHQgPSBPYmplY3QuYXNzaWduKHt9LCBmbGF0cGlja3IubDEwbnMuZGVmYXVsdCwgbDEwbik7DQogICAgfTsNCg0KICAgIGZsYXRwaWNrci5zZXREZWZhdWx0cyA9IGZ1bmN0aW9uIChjb25maWcpIHsNCiAgICAgIGZsYXRwaWNrci5kZWZhdWx0Q29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgZmxhdHBpY2tyLmRlZmF1bHRDb25maWcsIGNvbmZpZyk7DQogICAgfTsNCg0KICAgIGZsYXRwaWNrci5wYXJzZURhdGUgPSBjcmVhdGVEYXRlUGFyc2VyKHt9KTsNCiAgICBmbGF0cGlja3IuZm9ybWF0RGF0ZSA9IGNyZWF0ZURhdGVGb3JtYXR0ZXIoe30pOw0KICAgIGZsYXRwaWNrci5jb21wYXJlRGF0ZXMgPSBjb21wYXJlRGF0ZXM7DQoNCiAgICBpZiAodHlwZW9mIGpRdWVyeSAhPT0gInVuZGVmaW5lZCIpIHsNCiAgICAgIGpRdWVyeS5mbi5mbGF0cGlja3IgPSBmdW5jdGlvbiAoY29uZmlnKSB7DQogICAgICAgIHJldHVybiBfZmxhdHBpY2tyKHRoaXMsIGNvbmZpZyk7DQogICAgICB9Ow0KICAgIH0NCg0KICAgIERhdGUucHJvdG90eXBlLmZwX2luY3IgPSBmdW5jdGlvbiAoZGF5cykgew0KICAgICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMuZ2V0RnVsbFllYXIoKSwgdGhpcy5nZXRNb250aCgpLCB0aGlzLmdldERhdGUoKSArICh0eXBlb2YgZGF5cyA9PT0gInN0cmluZyIgPyBwYXJzZUludChkYXlzLCAxMCkgOiBkYXlzKSk7DQogICAgfTsNCg0KICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIikgew0KICAgICAgd2luZG93LmZsYXRwaWNrciA9IGZsYXRwaWNrcjsNCiAgICB9DQoNCiAgICByZXR1cm4gZmxhdHBpY2tyOw0KDQp9KSkpOw0KPC9zY3JpcHQ+DQogIDwhLS1odHRwczovL2pvc2h1YWpvaG5zb24uY28udWsvQ2hvaWNlcy8tLT4NCiAgPCEtLTxsaW5rIGhyZWY9InN0eWxlc2hlZXRzL2Nob2ljZXMuY3NzIiByZWw9InN0eWxlc2hlZXQiIHR5cGU9InRleHQvY3NzIiAvPi0tPg0KICA8c3R5bGU+DQogICAgLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQo9ICAgICAgICAgICAgQ2hvaWNlcyAgICAgICAgICAgID0NCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLw0KLmNob2ljZXMgew0KICBwb3NpdGlvbjogcmVsYXRpdmU7DQogIG1hcmdpbi1ib3R0b206IDI0cHg7DQogIGZvbnQtc2l6ZTogMTJweDsNCn0NCg0KLmNob2ljZXM6Zm9jdXMgew0KICBvdXRsaW5lOiBub25lOw0KfQ0KDQouY2hvaWNlczpsYXN0LWNoaWxkIHsNCiAgbWFyZ2luLWJvdHRvbTogMDsNCn0NCg0KLmNob2ljZXMuaXMtZGlzYWJsZWQgLmNob2ljZXNfX2lubmVyLA0KLmNob2ljZXMuaXMtZGlzYWJsZWQgLmNob2ljZXNfX2lucHV0IHsNCiAgYmFja2dyb3VuZC1jb2xvcjogI0VBRUFFQTsNCiAgY3Vyc29yOiBub3QtYWxsb3dlZDsNCiAgdXNlci1zZWxlY3Q6IG5vbmU7DQp9DQoNCi5jaG9pY2VzLmlzLWRpc2FibGVkIC5jaG9pY2VzX19pdGVtIHsNCiAgY3Vyc29yOiBub3QtYWxsb3dlZDsNCn0NCg0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdIHsNCiAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0gLmNob2ljZXNfX2lubmVyIHsNCiAgcGFkZGluZy1ib3R0b206IDcuNXB4Ow0KfQ0KDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0gLmNob2ljZXNfX2lucHV0IHsNCiAgZGlzcGxheTogYmxvY2s7DQogIHdpZHRoOiAxMDAlOw0KICBwYWRkaW5nOiAxMHB4Ow0KICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI0RERERERDsNCiAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRkZGRjsNCiAgbWFyZ2luOiAwOw0KfQ0KDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0gLmNob2ljZXNfX2J1dHRvbiB7DQogIGJhY2tncm91bmQtaW1hZ2U6IHVybChkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNakVpSUdobGFXZG9kRDBpTWpFaUlIWnBaWGRDYjNnOUlqQWdNQ0F5TVNBeU1TSWdlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREF2YzNabklqNDhaeUJtYVd4c1BTSWpNREF3SWlCbWFXeHNMWEoxYkdVOUltVjJaVzV2WkdRaVBqeHdZWFJvSUdROUlrMHlMalU1TWk0d05EUnNNVGd1TXpZMElERTRMak0yTkMweUxqVTBPQ0F5TGpVME9Fd3VNRFEwSURJdU5Ua3llaUl2UGp4d1lYUm9JR1E5SWswd0lERTRMak0yTkV3eE9DNHpOalFnTUd3eUxqVTBPQ0F5TGpVME9Fd3lMalUwT0NBeU1DNDVNVEo2SWk4K1BDOW5Qand2YzNablBnPT0pOw0KICBwYWRkaW5nOiAwOw0KICBiYWNrZ3JvdW5kLXNpemU6IDhweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICB0b3A6IDUwJTsNCiAgcmlnaHQ6IDA7DQogIG1hcmdpbi10b3A6IC0xMHB4Ow0KICBtYXJnaW4tcmlnaHQ6IDI1cHg7DQogIGhlaWdodDogMjBweDsNCiAgd2lkdGg6IDIwcHg7DQogIGJvcmRlci1yYWRpdXM6IDEwZW07DQogIG9wYWNpdHk6IC41Ow0KfQ0KDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0gLmNob2ljZXNfX2J1dHRvbjpob3ZlciwNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXSAuY2hvaWNlc19fYnV0dG9uOmZvY3VzIHsNCiAgb3BhY2l0eTogMTsNCn0NCg0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdIC5jaG9pY2VzX19idXR0b246Zm9jdXMgew0KICBib3gtc2hhZG93OiAwcHggMHB4IDBweCAycHggIzAwQkNENDsNCn0NCg0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdOmFmdGVyIHsNCiAgY29udGVudDogIiI7DQogIGhlaWdodDogMDsNCiAgd2lkdGg6IDA7DQogIGJvcmRlci1zdHlsZTogc29saWQ7DQogIGJvcmRlci1jb2xvcjogIzMzMzMzMyB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB0cmFuc3BhcmVudDsNCiAgYm9yZGVyLXdpZHRoOiA1cHg7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgcmlnaHQ6IDExLjVweDsNCiAgdG9wOiA1MCU7DQogIG1hcmdpbi10b3A6IC0yLjVweDsNCiAgcG9pbnRlci1ldmVudHM6IG5vbmU7DQp9DQoNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXS5pcy1vcGVuOmFmdGVyIHsNCiAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCAjMzMzMzMzIHRyYW5zcGFyZW50Ow0KICBtYXJnaW4tdG9wOiAtNy41cHg7DQp9DQoNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXVtkaXI9InJ0bCJdOmFmdGVyIHsNCiAgbGVmdDogMTEuNXB4Ow0KICByaWdodDogYXV0bzsNCn0NCg0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdW2Rpcj0icnRsIl0gLmNob2ljZXNfX2J1dHRvbiB7DQogIHJpZ2h0OiBhdXRvOw0KICBsZWZ0OiAwOw0KICBtYXJnaW4tbGVmdDogMjVweDsNCiAgbWFyZ2luLXJpZ2h0OiAwOw0KfQ0KDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3QtbXVsdGlwbGUiXSAuY2hvaWNlc19faW5uZXIsDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJ0ZXh0Il0gLmNob2ljZXNfX2lubmVyIHsNCiAgY3Vyc29yOiB0ZXh0Ow0KfQ0KDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3QtbXVsdGlwbGUiXSAuY2hvaWNlc19fYnV0dG9uLA0KLmNob2ljZXNbZGF0YS10eXBlKj0idGV4dCJdIC5jaG9pY2VzX19idXR0b24gew0KICBwb3NpdGlvbjogcmVsYXRpdmU7DQogIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgbWFyZ2luLXRvcDogMDsNCiAgbWFyZ2luLXJpZ2h0OiAtNHB4Ow0KICBtYXJnaW4tYm90dG9tOiAwOw0KICBtYXJnaW4tbGVmdDogOHB4Ow0KICBwYWRkaW5nLWxlZnQ6IDE2cHg7DQogIGJvcmRlci1sZWZ0OiAxcHggc29saWQgIzAwOGZhMTsNCiAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1qRWlJR2hsYVdkb2REMGlNakVpSUhacFpYZENiM2c5SWpBZ01DQXlNU0F5TVNJZ2VHMXNibk05SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01EQXZjM1puSWo0OFp5Qm1hV3hzUFNJalJrWkdJaUJtYVd4c0xYSjFiR1U5SW1WMlpXNXZaR1FpUGp4d1lYUm9JR1E5SWsweUxqVTVNaTR3TkRSc01UZ3VNelkwSURFNExqTTJOQzB5TGpVME9DQXlMalUwT0V3dU1EUTBJREl1TlRreWVpSXZQanh3WVhSb0lHUTlJazB3SURFNExqTTJORXd4T0M0ek5qUWdNR3d5TGpVME9DQXlMalUwT0V3eUxqVTBPQ0F5TUM0NU1USjZJaTgrUEM5blBqd3ZjM1puUGc9PSk7DQogIGJhY2tncm91bmQtc2l6ZTogOHB4Ow0KICB3aWR0aDogOHB4Ow0KICBsaW5lLWhlaWdodDogMTsNCiAgb3BhY2l0eTogLjc1Ow0KICBib3JkZXItcmFkaXVzOiAwOw0KfQ0KDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3QtbXVsdGlwbGUiXSAuY2hvaWNlc19fYnV0dG9uOmhvdmVyLA0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW11bHRpcGxlIl0gLmNob2ljZXNfX2J1dHRvbjpmb2N1cywNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InRleHQiXSAuY2hvaWNlc19fYnV0dG9uOmhvdmVyLA0KLmNob2ljZXNbZGF0YS10eXBlKj0idGV4dCJdIC5jaG9pY2VzX19idXR0b246Zm9jdXMgew0KICBvcGFjaXR5OiAxOw0KfQ0KDQouY2hvaWNlc19faW5uZXIgew0KICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogIHZlcnRpY2FsLWFsaWduOiB0b3A7DQogIHdpZHRoOiAxMDAlOw0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjlmOWY5Ow0KICBwYWRkaW5nOiA3LjVweCA3LjVweCAzLjc1cHg7DQogIGJvcmRlcjogMXB4IHNvbGlkICNEREREREQ7DQogIGJvcmRlci1yYWRpdXM6IDIuNXB4Ow0KICBmb250LXNpemU6IDEycHg7DQogIG1pbi1oZWlnaHQ6IDI0cHg7DQogIG92ZXJmbG93OiBoaWRkZW47DQp9DQoNCi5pcy1mb2N1c2VkIC5jaG9pY2VzX19pbm5lciwNCi5pcy1vcGVuIC5jaG9pY2VzX19pbm5lciB7DQogIGJvcmRlci1jb2xvcjogI2I3YjdiNzsNCn0NCg0KLmlzLW9wZW4gLmNob2ljZXNfX2lubmVyIHsNCiAgYm9yZGVyLXJhZGl1czogMi41cHggMi41cHggMCAwOw0KfQ0KDQouaXMtZmxpcHBlZC5pcy1vcGVuIC5jaG9pY2VzX19pbm5lciB7DQogIGJvcmRlci1yYWRpdXM6IDAgMCAyLjVweCAyLjVweDsNCn0NCg0KLmNob2ljZXNfX2xpc3Qgew0KICBtYXJnaW46IDA7DQogIHBhZGRpbmctbGVmdDogMDsNCiAgbGlzdC1zdHlsZTogbm9uZTsNCn0NCg0KLmNob2ljZXNfX2xpc3QtLXNpbmdsZSB7DQogIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgcGFkZGluZzogNHB4IDE2cHggNHB4IDRweDsNCiAgd2lkdGg6IDEwMCU7DQp9DQoNCltkaXI9InJ0bCJdIC5jaG9pY2VzX19saXN0LS1zaW5nbGUgew0KICBwYWRkaW5nLXJpZ2h0OiA0cHg7DQogIHBhZGRpbmctbGVmdDogMTZweDsNCn0NCg0KLmNob2ljZXNfX2xpc3QtLXNpbmdsZSAuY2hvaWNlc19faXRlbSB7DQogIHdpZHRoOiAxMDAlOw0KfQ0KDQouY2hvaWNlc19fbGlzdC0tbXVsdGlwbGUgew0KICBkaXNwbGF5OiBpbmxpbmU7DQp9DQoNCi5jaG9pY2VzX19saXN0LS1tdWx0aXBsZSAuY2hvaWNlc19faXRlbSB7DQogIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsNCiAgYm9yZGVyLXJhZGl1czogMjBweDsNCiAgcGFkZGluZzogNHB4IDEwcHg7DQogIGZvbnQtc2l6ZTogMTJweDsNCiAgZm9udC13ZWlnaHQ6IDUwMDsNCiAgbWFyZ2luLXJpZ2h0OiAzLjc1cHg7DQogIG1hcmdpbi1ib3R0b206IDMuNzVweDsNCiAgYmFja2dyb3VuZC1jb2xvcjogIzAwQkNENDsNCiAgYm9yZGVyOiAxcHggc29saWQgIzAwYTViYjsNCiAgY29sb3I6ICNGRkZGRkY7DQogIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsNCn0NCg0KLmNob2ljZXNfX2xpc3QtLW11bHRpcGxlIC5jaG9pY2VzX19pdGVtW2RhdGEtZGVsZXRhYmxlXSB7DQogIHBhZGRpbmctcmlnaHQ6IDVweDsNCn0NCg0KW2Rpcj0icnRsIl0gLmNob2ljZXNfX2xpc3QtLW11bHRpcGxlIC5jaG9pY2VzX19pdGVtIHsNCiAgbWFyZ2luLXJpZ2h0OiAwOw0KICBtYXJnaW4tbGVmdDogMy43NXB4Ow0KfQ0KDQouY2hvaWNlc19fbGlzdC0tbXVsdGlwbGUgLmNob2ljZXNfX2l0ZW0uaXMtaGlnaGxpZ2h0ZWQgew0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDBhNWJiOw0KICBib3JkZXI6IDFweCBzb2xpZCAjMDA4ZmExOw0KfQ0KDQouaXMtZGlzYWJsZWQgLmNob2ljZXNfX2xpc3QtLW11bHRpcGxlIC5jaG9pY2VzX19pdGVtIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2FhYWFhYTsNCiAgYm9yZGVyOiAxcHggc29saWQgIzkxOTE5MTsNCn0NCg0KLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIHsNCiAgZGlzcGxheTogbm9uZTsNCiAgei1pbmRleDogMTsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICB3aWR0aDogMTAwJTsNCiAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRkZGRjsNCiAgYm9yZGVyOiAxcHggc29saWQgI0RERERERDsNCiAgdG9wOiAxMDAlOw0KICBtYXJnaW4tdG9wOiAtMXB4Ow0KICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAyLjVweDsNCiAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDIuNXB4Ow0KICBvdmVyZmxvdzogaGlkZGVuOw0KICB3b3JkLWJyZWFrOiBicmVhay1hbGw7DQp9DQoNCi5jaG9pY2VzX19saXN0LS1kcm9wZG93bi5pcy1hY3RpdmUgew0KICBkaXNwbGF5OiBibG9jazsNCn0NCg0KLmlzLW9wZW4gLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIHsNCiAgYm9yZGVyLWNvbG9yOiAjYjdiN2I3Ow0KfQ0KDQouaXMtZmxpcHBlZCAuY2hvaWNlc19fbGlzdC0tZHJvcGRvd24gew0KICB0b3A6IGF1dG87DQogIGJvdHRvbTogMTAwJTsNCiAgbWFyZ2luLXRvcDogMDsNCiAgbWFyZ2luLWJvdHRvbTogLTFweDsNCiAgYm9yZGVyLXJhZGl1czogLjI1cmVtIC4yNXJlbSAwIDA7DQp9DQoNCi5jaG9pY2VzX19saXN0LS1kcm9wZG93biAuY2hvaWNlc19fbGlzdCB7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgbWF4LWhlaWdodDogMzAwcHg7DQogIG92ZXJmbG93OiBhdXRvOw0KICAtd2Via2l0LW92ZXJmbG93LXNjcm9sbGluZzogdG91Y2g7DQogIHdpbGwtY2hhbmdlOiBzY3JvbGwtcG9zaXRpb247DQp9DQoNCi5jaG9pY2VzX19saXN0LS1kcm9wZG93biAuY2hvaWNlc19faXRlbSB7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgcGFkZGluZzogMTBweDsNCiAgZm9udC1zaXplOiAxMnB4Ow0KfQ0KDQpbZGlyPSJydGwiXSAuY2hvaWNlc19fbGlzdC0tZHJvcGRvd24gLmNob2ljZXNfX2l0ZW0gew0KICB0ZXh0LWFsaWduOiByaWdodDsNCn0NCg0KQG1lZGlhIChtaW4td2lkdGg6IDY0MHB4KSB7DQogIC5jaG9pY2VzX19saXN0LS1kcm9wZG93biAuY2hvaWNlc19faXRlbS0tc2VsZWN0YWJsZSB7DQogICAgcGFkZGluZy1yaWdodDogMTAwcHg7DQogIH0NCg0KICAuY2hvaWNlc19fbGlzdC0tZHJvcGRvd24gLmNob2ljZXNfX2l0ZW0tLXNlbGVjdGFibGU6YWZ0ZXIgew0KICAgIGNvbnRlbnQ6IGF0dHIoZGF0YS1zZWxlY3QtdGV4dCk7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIG9wYWNpdHk6IDA7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIHJpZ2h0OiAxMHB4Ow0KICAgIHRvcDogNTAlOw0KICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsNCiAgfQ0KDQogIFtkaXI9InJ0bCJdIC5jaG9pY2VzX19saXN0LS1kcm9wZG93biAuY2hvaWNlc19faXRlbS0tc2VsZWN0YWJsZSB7DQogICAgdGV4dC1hbGlnbjogcmlnaHQ7DQogICAgcGFkZGluZy1sZWZ0OiAxMDBweDsNCiAgICBwYWRkaW5nLXJpZ2h0OiAxMHB4Ow0KICB9DQoNCiAgW2Rpcj0icnRsIl0gLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19pdGVtLS1zZWxlY3RhYmxlOmFmdGVyIHsNCiAgICByaWdodDogYXV0bzsNCiAgICBsZWZ0OiAxMHB4Ow0KICB9DQp9DQoNCi5jaG9pY2VzX19saXN0LS1kcm9wZG93biAuY2hvaWNlc19faXRlbS0tc2VsZWN0YWJsZS5pcy1oaWdobGlnaHRlZCB7DQogIGJhY2tncm91bmQtY29sb3I6ICNmMmYyZjI7DQp9DQoNCi5jaG9pY2VzX19saXN0LS1kcm9wZG93biAuY2hvaWNlc19faXRlbS0tc2VsZWN0YWJsZS5pcy1oaWdobGlnaHRlZDphZnRlciB7DQogIG9wYWNpdHk6IC41Ow0KfQ0KDQouY2hvaWNlc19faXRlbSB7DQogIGN1cnNvcjogZGVmYXVsdDsNCn0NCg0KLmNob2ljZXNfX2l0ZW0tLXNlbGVjdGFibGUgew0KICBjdXJzb3I6IHBvaW50ZXI7DQp9DQoNCi5jaG9pY2VzX19pdGVtLS1kaXNhYmxlZCB7DQogIGN1cnNvcjogbm90LWFsbG93ZWQ7DQogIHVzZXItc2VsZWN0OiBub25lOw0KICBvcGFjaXR5OiAuNTsNCn0NCg0KLmNob2ljZXNfX2hlYWRpbmcgew0KICBmb250LXdlaWdodDogNjAwOw0KICBmb250LXNpemU6IDEycHg7DQogIHBhZGRpbmc6IDEwcHg7DQogIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZjdmN2Y3Ow0KICBjb2xvcjogZ3JheTsNCn0NCg0KLmNob2ljZXNfX2J1dHRvbiB7DQogIHRleHQtaW5kZW50OiAtOTk5OXB4Ow0KICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7DQogIGFwcGVhcmFuY2U6IG5vbmU7DQogIGJvcmRlcjogMDsNCiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7DQogIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7DQogIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlcjsNCiAgY3Vyc29yOiBwb2ludGVyOw0KfQ0KDQouY2hvaWNlc19fYnV0dG9uOmZvY3VzIHsNCiAgb3V0bGluZTogbm9uZTsNCn0NCg0KLmNob2ljZXNfX2lucHV0IHsNCiAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICB2ZXJ0aWNhbC1hbGlnbjogYmFzZWxpbmU7DQogIGJhY2tncm91bmQtY29sb3I6ICNmOWY5Zjk7DQogIGZvbnQtc2l6ZTogMTJweDsNCiAgbWFyZ2luLWJvdHRvbTogNXB4Ow0KICBib3JkZXI6IDA7DQogIGJvcmRlci1yYWRpdXM6IDA7DQogIG1heC13aWR0aDogMTAwJTsNCiAgcGFkZGluZzogNHB4IDAgNHB4IDJweDsNCn0NCg0KLmNob2ljZXNfX2lucHV0OmZvY3VzIHsNCiAgb3V0bGluZTogMDsNCn0NCg0KW2Rpcj0icnRsIl0gLmNob2ljZXNfX2lucHV0IHsNCiAgcGFkZGluZy1yaWdodDogMnB4Ow0KICBwYWRkaW5nLWxlZnQ6IDA7DQp9DQoNCi5jaG9pY2VzX19wbGFjZWhvbGRlciB7DQogIG9wYWNpdHk6IC41Ow0KfQ0KDQouY2hvaWNlc19faW5wdXQuaXMtaGlkZGVuLA0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdIC5jaG9pY2VzX19pbnB1dC5pcy1oaWRkZW4sDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3QtbXVsdGlwbGUiXSAuY2hvaWNlc19faW5wdXQuaXMtaGlkZGVuIHsNCiAgZGlzcGxheTogbm9uZTsNCn0NCg0KLyo9PT09PSAgRW5kIG9mIENob2ljZXMgID09PT09PSovDQoNCiAgPC9zdHlsZT4NCiAgPHNjcmlwdD4NCiAgLyohIGNob2ljZXMuanMgdjQuMS4yIHwgKGMpIDIwMTggSm9zaCBKb2huc29uIHwgaHR0cHM6Ly9naXRodWIuY29tL2pzaGpvaG5zb24vQ2hvaWNlcyNyZWFkbWUgKi8NCihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7DQogICAvL0NvbW1vbkpTMg0KCWlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JykNCgkJbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7DQogICAvL0FNRA0KCWVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKQ0KCQlkZWZpbmUoW10sIGZhY3RvcnkpOw0KICAgLy9Db21tb25KUw0KCWVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKQ0KCQlleHBvcnRzWyJDaG9pY2VzIl0gPSBmYWN0b3J5KCk7DQogICAvL1dpbmRvdw0KCWVsc2UNCgkJcm9vdFsiQ2hvaWNlcyJdID0gZmFjdG9yeSgpOw0KfSkodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHRoaXMsIGZ1bmN0aW9uKCkgew0KcmV0dXJuIC8qKioqKiovIChmdW5jdGlvbihtb2R1bGVzKSB7IC8vIHdlYnBhY2tCb290c3RyYXANCi8qKioqKiovIAkvLyBUaGUgbW9kdWxlIGNhY2hlDQovKioqKioqLyAJdmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTsNCi8qKioqKiovDQovKioqKioqLyAJLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb24NCi8qKioqKiovIAlmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7DQovKioqKioqLw0KLyoqKioqKi8gCQkvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGUNCi8qKioqKiovIAkJaWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHsNCi8qKioqKiovIAkJCXJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzOw0KLyoqKioqKi8gCQl9DQovKioqKioqLyAJCS8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpDQovKioqKioqLyAJCXZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHsNCi8qKioqKiovIAkJCWk6IG1vZHVsZUlkLA0KLyoqKioqKi8gCQkJbDogZmFsc2UsDQovKioqKioqLyAJCQlleHBvcnRzOiB7fQ0KLyoqKioqKi8gCQl9Ow0KLyoqKioqKi8NCi8qKioqKiovIAkJLy8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uDQovKioqKioqLyAJCW1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pOw0KLyoqKioqKi8NCi8qKioqKiovIAkJLy8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZA0KLyoqKioqKi8gCQltb2R1bGUubCA9IHRydWU7DQovKioqKioqLw0KLyoqKioqKi8gCQkvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZQ0KLyoqKioqKi8gCQlyZXR1cm4gbW9kdWxlLmV4cG9ydHM7DQovKioqKioqLyAJfQ0KLyoqKioqKi8NCi8qKioqKiovDQovKioqKioqLyAJLy8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXykNCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzOw0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZQ0KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7DQovKioqKioqLw0KLyoqKioqKi8gCS8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0cw0KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikgew0KLyoqKioqKi8gCQlpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7DQovKioqKioqLyAJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgew0KLyoqKioqKi8gCQkJCWNvbmZpZ3VyYWJsZTogZmFsc2UsDQovKioqKioqLyAJCQkJZW51bWVyYWJsZTogdHJ1ZSwNCi8qKioqKiovIAkJCQlnZXQ6IGdldHRlcg0KLyoqKioqKi8gCQkJfSk7DQovKioqKioqLyAJCX0NCi8qKioqKiovIAl9Ow0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlcw0KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkgew0KLyoqKioqKi8gCQl2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID8NCi8qKioqKiovIAkJCWZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6DQovKioqKioqLyAJCQlmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9Ow0KLyoqKioqKi8gCQlfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7DQovKioqKioqLyAJCXJldHVybiBnZXR0ZXI7DQovKioqKioqLyAJfTsNCi8qKioqKiovDQovKioqKioqLyAJLy8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsDQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9Ow0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfXw0KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ucCA9ICIvcHVibGljL2Fzc2V0cy9zY3JpcHRzLyI7DQovKioqKioqLw0KLyoqKioqKi8gCS8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0cw0KLyoqKioqKi8gCXJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDM3KTsNCi8qKioqKiovIH0pDQovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KLyoqKioqKi8gKFsNCi8qIDAgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIHN0b3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNikoJ3drcycpOw0KdmFyIHVpZCA9IF9fd2VicGFja19yZXF1aXJlX18oMTMpOw0KdmFyIFN5bWJvbCA9IF9fd2VicGFja19yZXF1aXJlX18oMykuU3ltYm9sOw0KdmFyIFVTRV9TWU1CT0wgPSB0eXBlb2YgU3ltYm9sID09ICdmdW5jdGlvbic7DQoNCnZhciAkZXhwb3J0cyA9IG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG5hbWUpIHsNCiAgcmV0dXJuIHN0b3JlW25hbWVdIHx8IChzdG9yZVtuYW1lXSA9DQogICAgVVNFX1NZTUJPTCAmJiBTeW1ib2xbbmFtZV0gfHwgKFVTRV9TWU1CT0wgPyBTeW1ib2wgOiB1aWQpKCdTeW1ib2wuJyArIG5hbWUpKTsNCn07DQoNCiRleHBvcnRzLnN0b3JlID0gc3RvcmU7DQoNCg0KLyoqKi8gfSksDQovKiAxICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCi8qIGVzbGludC1kaXNhYmxlICovDQoNCnZhciBnZXRSYW5kb21OdW1iZXIgPSBleHBvcnRzLmdldFJhbmRvbU51bWJlciA9IGZ1bmN0aW9uIGdldFJhbmRvbU51bWJlcihtaW4sIG1heCkgew0KICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikgKyBtaW4pOw0KfTsNCg0KdmFyIGdlbmVyYXRlQ2hhcnMgPSBleHBvcnRzLmdlbmVyYXRlQ2hhcnMgPSBmdW5jdGlvbiBnZW5lcmF0ZUNoYXJzKGxlbmd0aCkgew0KICB2YXIgY2hhcnMgPSAnJzsNCg0KICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7DQogICAgdmFyIHJhbmRvbUNoYXIgPSBnZXRSYW5kb21OdW1iZXIoMCwgMzYpOw0KICAgIGNoYXJzICs9IHJhbmRvbUNoYXIudG9TdHJpbmcoMzYpOw0KICB9DQoNCiAgcmV0dXJuIGNoYXJzOw0KfTsNCg0KdmFyIGdlbmVyYXRlSWQgPSBleHBvcnRzLmdlbmVyYXRlSWQgPSBmdW5jdGlvbiBnZW5lcmF0ZUlkKGVsZW1lbnQsIHByZWZpeCkgew0KICB2YXIgaWQgPSBlbGVtZW50LmlkIHx8IGVsZW1lbnQubmFtZSAmJiBlbGVtZW50Lm5hbWUgKyAnLScgKyBnZW5lcmF0ZUNoYXJzKDIpIHx8IGdlbmVyYXRlQ2hhcnMoNCk7DQogIGlkID0gaWQucmVwbGFjZSgvKDp8XC58XFt8XF18LCkvZywgJycpOw0KICBpZCA9IHByZWZpeCArICctJyArIGlkOw0KDQogIHJldHVybiBpZDsNCn07DQoNCnZhciBnZXRUeXBlID0gZXhwb3J0cy5nZXRUeXBlID0gZnVuY3Rpb24gZ2V0VHlwZShvYmopIHsNCiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopLnNsaWNlKDgsIC0xKTsNCn07DQoNCnZhciBpc1R5cGUgPSBleHBvcnRzLmlzVHlwZSA9IGZ1bmN0aW9uIGlzVHlwZSh0eXBlLCBvYmopIHsNCiAgdmFyIGNsYXMgPSBnZXRUeXBlKG9iaik7DQogIHJldHVybiBvYmogIT09IHVuZGVmaW5lZCAmJiBvYmogIT09IG51bGwgJiYgY2xhcyA9PT0gdHlwZTsNCn07DQoNCnZhciBpc0VsZW1lbnQgPSBleHBvcnRzLmlzRWxlbWVudCA9IGZ1bmN0aW9uIGlzRWxlbWVudChlbGVtZW50KSB7DQogIHJldHVybiBlbGVtZW50IGluc3RhbmNlb2YgRWxlbWVudDsNCn07DQoNCnZhciBleHRlbmQgPSBleHBvcnRzLmV4dGVuZCA9IGZ1bmN0aW9uIGV4dGVuZCgpIHsNCiAgdmFyIGV4dGVuZGVkID0ge307DQogIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOw0KDQogIC8qKg0KICAgKiBNZXJnZSBvbmUgb2JqZWN0IGludG8gYW5vdGhlcg0KICAgKiBAcGFyYW0gIHtPYmplY3R9IG9iaiAgT2JqZWN0IHRvIG1lcmdlIGludG8gZXh0ZW5kZWQgb2JqZWN0DQogICAqLw0KICB2YXIgbWVyZ2UgPSBmdW5jdGlvbiBtZXJnZShvYmopIHsNCiAgICBmb3IgKHZhciBwcm9wIGluIG9iaikgew0KICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSB7DQogICAgICAgIC8vIElmIGRlZXAgbWVyZ2UgYW5kIHByb3BlcnR5IGlzIGFuIG9iamVjdCwgbWVyZ2UgcHJvcGVydGllcw0KICAgICAgICBpZiAoaXNUeXBlKCdPYmplY3QnLCBvYmpbcHJvcF0pKSB7DQogICAgICAgICAgZXh0ZW5kZWRbcHJvcF0gPSBleHRlbmQodHJ1ZSwgZXh0ZW5kZWRbcHJvcF0sIG9ialtwcm9wXSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgZXh0ZW5kZWRbcHJvcF0gPSBvYmpbcHJvcF07DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH07DQoNCiAgLy8gTG9vcCB0aHJvdWdoIGVhY2ggcGFzc2VkIGFyZ3VtZW50DQogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICAvLyBzdG9yZSBhcmd1bWVudCBhdCBwb3NpdGlvbiBpDQogICAgdmFyIG9iaiA9IGFyZ3VtZW50c1tpXTsNCg0KICAgIC8vIElmIHdlIGFyZSBpbiBmYWN0IGRlYWxpbmcgd2l0aCBhbiBvYmplY3QsIG1lcmdlIGl0Lg0KICAgIGlmIChpc1R5cGUoJ09iamVjdCcsIG9iaikpIHsNCiAgICAgIG1lcmdlKG9iaik7DQogICAgfQ0KICB9DQoNCiAgcmV0dXJuIGV4dGVuZGVkOw0KfTsNCg0KdmFyIHdyYXAgPSBleHBvcnRzLndyYXAgPSBmdW5jdGlvbiB3cmFwKGVsZW1lbnQsIHdyYXBwZXIpIHsNCiAgd3JhcHBlciA9IHdyYXBwZXIgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogIGlmIChlbGVtZW50Lm5leHRTaWJsaW5nKSB7DQogICAgZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh3cmFwcGVyLCBlbGVtZW50Lm5leHRTaWJsaW5nKTsNCiAgfSBlbHNlIHsNCiAgICBlbGVtZW50LnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQod3JhcHBlcik7DQogIH0NCiAgcmV0dXJuIHdyYXBwZXIuYXBwZW5kQ2hpbGQoZWxlbWVudCk7DQp9Ow0KDQp2YXIgZmluZEFuY2VzdG9yID0gZXhwb3J0cy5maW5kQW5jZXN0b3IgPSBmdW5jdGlvbiBmaW5kQW5jZXN0b3IoZWwsIGNscykgew0KICB3aGlsZSAoKGVsID0gZWwucGFyZW50RWxlbWVudCkgJiYgIWVsLmNsYXNzTGlzdC5jb250YWlucyhjbHMpKSB7fQ0KICByZXR1cm4gZWw7DQp9Ow0KDQp2YXIgZmluZEFuY2VzdG9yQnlBdHRyTmFtZSA9IGV4cG9ydHMuZmluZEFuY2VzdG9yQnlBdHRyTmFtZSA9IGZ1bmN0aW9uIGZpbmRBbmNlc3RvckJ5QXR0ck5hbWUoZWwsIGF0dHIpIHsNCiAgdmFyIHRhcmdldCA9IGVsOw0KDQogIHdoaWxlICh0YXJnZXQpIHsNCiAgICBpZiAodGFyZ2V0Lmhhc0F0dHJpYnV0ZShhdHRyKSkgew0KICAgICAgcmV0dXJuIHRhcmdldDsNCiAgICB9DQoNCiAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50RWxlbWVudDsNCiAgfQ0KDQogIHJldHVybiBudWxsOw0KfTsNCg0KdmFyIGdldEFkamFjZW50RWwgPSBleHBvcnRzLmdldEFkamFjZW50RWwgPSBmdW5jdGlvbiBnZXRBZGphY2VudEVsKHN0YXJ0RWwsIGNsYXNzTmFtZSkgew0KICB2YXIgZGlyZWN0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAxOw0KDQogIGlmICghc3RhcnRFbCB8fCAhY2xhc3NOYW1lKSByZXR1cm47DQoNCiAgdmFyIHBhcmVudCA9IHN0YXJ0RWwucGFyZW50Tm9kZS5wYXJlbnROb2RlOw0KICB2YXIgY2hpbGRyZW4gPSBBcnJheS5mcm9tKHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKGNsYXNzTmFtZSkpOw0KDQogIHZhciBzdGFydFBvcyA9IGNoaWxkcmVuLmluZGV4T2Yoc3RhcnRFbCk7DQogIHZhciBvcGVyYXRvckRpcmVjdGlvbiA9IGRpcmVjdGlvbiA+IDAgPyAxIDogLTE7DQoNCiAgcmV0dXJuIGNoaWxkcmVuW3N0YXJ0UG9zICsgb3BlcmF0b3JEaXJlY3Rpb25dOw0KfTsNCg0KdmFyIGlzU2Nyb2xsZWRJbnRvVmlldyA9IGV4cG9ydHMuaXNTY3JvbGxlZEludG9WaWV3ID0gZnVuY3Rpb24gaXNTY3JvbGxlZEludG9WaWV3KGVsLCBwYXJlbnQpIHsNCiAgdmFyIGRpcmVjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogMTsNCg0KICBpZiAoIWVsKSByZXR1cm47DQoNCiAgdmFyIGlzVmlzaWJsZSA9IHZvaWQgMDsNCg0KICBpZiAoZGlyZWN0aW9uID4gMCkgew0KICAgIC8vIEluIHZpZXcgZnJvbSBib3R0b20NCiAgICBpc1Zpc2libGUgPSBwYXJlbnQuc2Nyb2xsVG9wICsgcGFyZW50Lm9mZnNldEhlaWdodCA+PSBlbC5vZmZzZXRUb3AgKyBlbC5vZmZzZXRIZWlnaHQ7DQogIH0gZWxzZSB7DQogICAgLy8gSW4gdmlldyBmcm9tIHRvcA0KICAgIGlzVmlzaWJsZSA9IGVsLm9mZnNldFRvcCA+PSBwYXJlbnQuc2Nyb2xsVG9wOw0KICB9DQoNCiAgcmV0dXJuIGlzVmlzaWJsZTsNCn07DQoNCnZhciBzdHJpcEhUTUwgPSBleHBvcnRzLnN0cmlwSFRNTCA9IGZ1bmN0aW9uIHN0cmlwSFRNTChodG1sKSB7DQogIHJldHVybiBodG1sLnJlcGxhY2UoLyYvZywgJyZhbXA7JykucmVwbGFjZSgvPi9nLCAnJnJ0OycpLnJlcGxhY2UoLzwvZywgJyZsdDsnKS5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsNCn07DQoNCnZhciBzdHJUb0VsID0gZXhwb3J0cy5zdHJUb0VsID0gZnVuY3Rpb24gKCkgew0KICB2YXIgdG1wRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgcmV0dXJuIGZ1bmN0aW9uIChzdHIpIHsNCiAgICB2YXIgY2xlYW5lZElucHV0ID0gc3RyLnRyaW0oKTsNCiAgICB2YXIgciA9IHZvaWQgMDsNCiAgICB0bXBFbC5pbm5lckhUTUwgPSBjbGVhbmVkSW5wdXQ7DQogICAgciA9IHRtcEVsLmNoaWxkcmVuWzBdOw0KDQogICAgd2hpbGUgKHRtcEVsLmZpcnN0Q2hpbGQpIHsNCiAgICAgIHRtcEVsLnJlbW92ZUNoaWxkKHRtcEVsLmZpcnN0Q2hpbGQpOw0KICAgIH0NCg0KICAgIHJldHVybiByOw0KICB9Ow0KfSgpOw0KDQovKioNCiAqIERldGVybWluZXMgdGhlIHdpZHRoIG9mIGEgcGFzc2VkIGlucHV0IGJhc2VkIG9uIGl0cyB2YWx1ZSBhbmQgcGFzc2VzDQogKiBpdCB0byB0aGUgc3VwcGxpZWQgY2FsbGJhY2sgZnVuY3Rpb24uDQogKi8NCnZhciBjYWxjV2lkdGhPZklucHV0ID0gZXhwb3J0cy5jYWxjV2lkdGhPZklucHV0ID0gZnVuY3Rpb24gY2FsY1dpZHRoT2ZJbnB1dChpbnB1dCwgY2FsbGJhY2spIHsNCiAgdmFyIHZhbHVlID0gaW5wdXQudmFsdWUgfHwgaW5wdXQucGxhY2Vob2xkZXI7DQogIHZhciB3aWR0aCA9IGlucHV0Lm9mZnNldFdpZHRoOw0KDQogIGlmICh2YWx1ZSkgew0KICAgIHZhciB0ZXN0RWwgPSBzdHJUb0VsKCc8c3Bhbj4nICsgc3RyaXBIVE1MKHZhbHVlKSArICc8L3NwYW4+Jyk7DQogICAgdGVzdEVsLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsNCiAgICB0ZXN0RWwuc3R5bGUucGFkZGluZyA9ICcwJzsNCiAgICB0ZXN0RWwuc3R5bGUudG9wID0gJy05OTk5cHgnOw0KICAgIHRlc3RFbC5zdHlsZS5sZWZ0ID0gJy05OTk5cHgnOw0KICAgIHRlc3RFbC5zdHlsZS53aWR0aCA9ICdhdXRvJzsNCiAgICB0ZXN0RWwuc3R5bGUud2hpdGVTcGFjZSA9ICdwcmUnOw0KDQogICAgaWYgKGRvY3VtZW50LmJvZHkuY29udGFpbnMoaW5wdXQpICYmIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKSB7DQogICAgICB2YXIgaW5wdXRTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGlucHV0KTsNCg0KICAgICAgaWYgKGlucHV0U3R5bGUpIHsNCiAgICAgICAgdGVzdEVsLnN0eWxlLmZvbnRTaXplID0gaW5wdXRTdHlsZS5mb250U2l6ZTsNCiAgICAgICAgdGVzdEVsLnN0eWxlLmZvbnRGYW1pbHkgPSBpbnB1dFN0eWxlLmZvbnRGYW1pbHk7DQogICAgICAgIHRlc3RFbC5zdHlsZS5mb250V2VpZ2h0ID0gaW5wdXRTdHlsZS5mb250V2VpZ2h0Ow0KICAgICAgICB0ZXN0RWwuc3R5bGUuZm9udFN0eWxlID0gaW5wdXRTdHlsZS5mb250U3R5bGU7DQogICAgICAgIHRlc3RFbC5zdHlsZS5sZXR0ZXJTcGFjaW5nID0gaW5wdXRTdHlsZS5sZXR0ZXJTcGFjaW5nOw0KICAgICAgICB0ZXN0RWwuc3R5bGUudGV4dFRyYW5zZm9ybSA9IGlucHV0U3R5bGUudGV4dFRyYW5zZm9ybTsNCiAgICAgICAgdGVzdEVsLnN0eWxlLnBhZGRpbmcgPSBpbnB1dFN0eWxlLnBhZGRpbmc7DQogICAgICB9DQogICAgfQ0KDQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0ZXN0RWwpOw0KDQogICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsNCiAgICAgIGlmICh2YWx1ZSAmJiB0ZXN0RWwub2Zmc2V0V2lkdGggIT09IGlucHV0Lm9mZnNldFdpZHRoKSB7DQogICAgICAgIHdpZHRoID0gdGVzdEVsLm9mZnNldFdpZHRoICsgNDsNCiAgICAgIH0NCg0KICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0ZXN0RWwpOw0KDQogICAgICBjYWxsYmFjay5jYWxsKHVuZGVmaW5lZCwgd2lkdGggKyAncHgnKTsNCiAgICB9KTsNCiAgfSBlbHNlIHsNCiAgICBjYWxsYmFjay5jYWxsKHVuZGVmaW5lZCwgd2lkdGggKyAncHgnKTsNCiAgfQ0KfTsNCg0KdmFyIHNvcnRCeUFscGhhID0gZXhwb3J0cy5zb3J0QnlBbHBoYSA9IGZ1bmN0aW9uIHNvcnRCeUFscGhhKGEsIGIpIHsNCiAgdmFyIGxhYmVsQSA9IChhLmxhYmVsIHx8IGEudmFsdWUpLnRvTG93ZXJDYXNlKCk7DQogIHZhciBsYWJlbEIgPSAoYi5sYWJlbCB8fCBiLnZhbHVlKS50b0xvd2VyQ2FzZSgpOw0KDQogIGlmIChsYWJlbEEgPCBsYWJlbEIpIHsNCiAgICByZXR1cm4gLTE7DQogIH0NCg0KICBpZiAobGFiZWxBID4gbGFiZWxCKSB7DQogICAgcmV0dXJuIDE7DQogIH0NCg0KICByZXR1cm4gMDsNCn07DQoNCnZhciBzb3J0QnlTY29yZSA9IGV4cG9ydHMuc29ydEJ5U2NvcmUgPSBmdW5jdGlvbiBzb3J0QnlTY29yZShhLCBiKSB7DQogIHJldHVybiBhLnNjb3JlIC0gYi5zY29yZTsNCn07DQoNCnZhciBkaXNwYXRjaEV2ZW50ID0gZXhwb3J0cy5kaXNwYXRjaEV2ZW50ID0gZnVuY3Rpb24gZGlzcGF0Y2hFdmVudChlbGVtZW50LCB0eXBlKSB7DQogIHZhciBjdXN0b21BcmdzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBudWxsOw0KDQogIHZhciBldmVudCA9IG5ldyBDdXN0b21FdmVudCh0eXBlLCB7DQogICAgZGV0YWlsOiBjdXN0b21BcmdzLA0KICAgIGJ1YmJsZXM6IHRydWUsDQogICAgY2FuY2VsYWJsZTogdHJ1ZQ0KICB9KTsNCg0KICByZXR1cm4gZWxlbWVudC5kaXNwYXRjaEV2ZW50KGV2ZW50KTsNCn07DQoNCnZhciByZWdleEZpbHRlciA9IGV4cG9ydHMucmVnZXhGaWx0ZXIgPSBmdW5jdGlvbiByZWdleEZpbHRlcih2YWx1ZSwgcmVnZXgpIHsNCiAgaWYgKCF2YWx1ZSB8fCAhcmVnZXgpIHsNCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCg0KICB2YXIgZXhwcmVzc2lvbiA9IG5ldyBSZWdFeHAocmVnZXguc291cmNlLCAnaScpOw0KICByZXR1cm4gZXhwcmVzc2lvbi50ZXN0KHZhbHVlKTsNCn07DQoNCnZhciBnZXRXaW5kb3dIZWlnaHQgPSBleHBvcnRzLmdldFdpbmRvd0hlaWdodCA9IGZ1bmN0aW9uIGdldFdpbmRvd0hlaWdodCgpIHsNCiAgdmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5Ow0KICB2YXIgaHRtbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsNCiAgcmV0dXJuIE1hdGgubWF4KGJvZHkuc2Nyb2xsSGVpZ2h0LCBib2R5Lm9mZnNldEhlaWdodCwgaHRtbC5jbGllbnRIZWlnaHQsIGh0bWwuc2Nyb2xsSGVpZ2h0LCBodG1sLm9mZnNldEhlaWdodCk7DQp9Ow0KDQp2YXIgcmVkdWNlVG9WYWx1ZXMgPSBleHBvcnRzLnJlZHVjZVRvVmFsdWVzID0gZnVuY3Rpb24gcmVkdWNlVG9WYWx1ZXMoaXRlbXMpIHsNCiAgdmFyIGtleSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogJ3ZhbHVlJzsNCg0KICB2YXIgdmFsdWVzID0gaXRlbXMucmVkdWNlKGZ1bmN0aW9uIChwcmV2LCBjdXJyZW50KSB7DQogICAgcHJldi5wdXNoKGN1cnJlbnRba2V5XSk7DQogICAgcmV0dXJuIHByZXY7DQogIH0sIFtdKTsNCg0KICByZXR1cm4gdmFsdWVzOw0KfTsNCg0KdmFyIGZldGNoRnJvbU9iamVjdCA9IGV4cG9ydHMuZmV0Y2hGcm9tT2JqZWN0ID0gZnVuY3Rpb24gZmV0Y2hGcm9tT2JqZWN0KG9iamVjdCwgcGF0aCkgew0KICB2YXIgaW5kZXggPSBwYXRoLmluZGV4T2YoJy4nKTsNCg0KICBpZiAoaW5kZXggPiAtMSkgew0KICAgIHJldHVybiBmZXRjaEZyb21PYmplY3Qob2JqZWN0W3BhdGguc3Vic3RyaW5nKDAsIGluZGV4KV0sIHBhdGguc3Vic3RyKGluZGV4ICsgMSkpOw0KICB9DQoNCiAgcmV0dXJuIG9iamVjdFtwYXRoXTsNCn07DQoNCnZhciBpc0lFMTEgPSBleHBvcnRzLmlzSUUxMSA9IGZ1bmN0aW9uIGlzSUUxMSgpIHsNCiAgcmV0dXJuICEhKG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL1RyaWRlbnQvKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9ydlsgOl0xMS8pKTsNCn07DQoNCnZhciBleGlzdHNJbkFycmF5ID0gZXhwb3J0cy5leGlzdHNJbkFycmF5ID0gZnVuY3Rpb24gZXhpc3RzSW5BcnJheShhcnJheSwgdmFsdWUpIHsNCiAgdmFyIGtleSA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogJ3ZhbHVlJzsNCiAgcmV0dXJuIGFycmF5LnNvbWUoZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICBpZiAoaXNUeXBlKCdTdHJpbmcnLCB2YWx1ZSkpIHsNCiAgICAgIHJldHVybiBpdGVtW2tleV0gPT09IHZhbHVlLnRyaW0oKTsNCiAgICB9DQoNCiAgICByZXR1cm4gaXRlbVtrZXldID09PSB2YWx1ZTsNCiAgfSk7DQp9Ow0KDQp2YXIgY2xvbmVPYmplY3QgPSBleHBvcnRzLmNsb25lT2JqZWN0ID0gZnVuY3Rpb24gY2xvbmVPYmplY3Qob2JqKSB7DQogIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpOw0KfTsNCg0KdmFyIGRvS2V5c01hdGNoID0gZXhwb3J0cy5kb0tleXNNYXRjaCA9IGZ1bmN0aW9uIGRvS2V5c01hdGNoKGEsIGIpIHsNCiAgdmFyIGFLZXlzID0gT2JqZWN0LmtleXMoYSkuc29ydCgpOw0KICB2YXIgYktleXMgPSBPYmplY3Qua2V5cyhiKS5zb3J0KCk7DQogIHJldHVybiBKU09OLnN0cmluZ2lmeShhS2V5cykgPT09IEpTT04uc3RyaW5naWZ5KGJLZXlzKTsNCn07DQoNCi8qKiovIH0pLA0KLyogMiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQp2YXIgY29yZSA9IG1vZHVsZS5leHBvcnRzID0geyB2ZXJzaW9uOiAnMi41LjcnIH07DQppZiAodHlwZW9mIF9fZSA9PSAnbnVtYmVyJykgX19lID0gY29yZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bmRlZg0KDQoNCi8qKiovIH0pLA0KLyogMyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQovLyBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvODYjaXNzdWVjb21tZW50LTExNTc1OTAyOA0KdmFyIGdsb2JhbCA9IG1vZHVsZS5leHBvcnRzID0gdHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoDQogID8gd2luZG93IDogdHlwZW9mIHNlbGYgIT0gJ3VuZGVmaW5lZCcgJiYgc2VsZi5NYXRoID09IE1hdGggPyBzZWxmDQogIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1uZXctZnVuYw0KICA6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7DQppZiAodHlwZW9mIF9fZyA9PSAnbnVtYmVyJykgX19nID0gZ2xvYmFsOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVuZGVmDQoNCg0KLyoqKi8gfSksDQovKiA0ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBkUCA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7DQp2YXIgY3JlYXRlRGVzYyA9IF9fd2VicGFja19yZXF1aXJlX18oMTIpOw0KbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKSA/IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsNCiAgcmV0dXJuIGRQLmYob2JqZWN0LCBrZXksIGNyZWF0ZURlc2MoMSwgdmFsdWUpKTsNCn0gOiBmdW5jdGlvbiAob2JqZWN0LCBrZXksIHZhbHVlKSB7DQogIG9iamVjdFtrZXldID0gdmFsdWU7DQogIHJldHVybiBvYmplY3Q7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQpleHBvcnRzLlNDUk9MTElOR19TUEVFRCA9IGV4cG9ydHMuS0VZX0NPREVTID0gZXhwb3J0cy5BQ1RJT05fVFlQRVMgPSBleHBvcnRzLkVWRU5UUyA9IGV4cG9ydHMuREVGQVVMVF9DT05GSUcgPSBleHBvcnRzLkRFRkFVTFRfQ0xBU1NOQU1FUyA9IHVuZGVmaW5lZDsNCg0KdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7DQoNCnZhciBERUZBVUxUX0NMQVNTTkFNRVMgPSBleHBvcnRzLkRFRkFVTFRfQ0xBU1NOQU1FUyA9IHsNCiAgY29udGFpbmVyT3V0ZXI6ICdjaG9pY2VzJywNCiAgY29udGFpbmVySW5uZXI6ICdjaG9pY2VzX19pbm5lcicsDQogIGlucHV0OiAnY2hvaWNlc19faW5wdXQnLA0KICBpbnB1dENsb25lZDogJ2Nob2ljZXNfX2lucHV0LS1jbG9uZWQnLA0KICBsaXN0OiAnY2hvaWNlc19fbGlzdCcsDQogIGxpc3RJdGVtczogJ2Nob2ljZXNfX2xpc3QtLW11bHRpcGxlJywNCiAgbGlzdFNpbmdsZTogJ2Nob2ljZXNfX2xpc3QtLXNpbmdsZScsDQogIGxpc3REcm9wZG93bjogJ2Nob2ljZXNfX2xpc3QtLWRyb3Bkb3duJywNCiAgaXRlbTogJ2Nob2ljZXNfX2l0ZW0nLA0KICBpdGVtU2VsZWN0YWJsZTogJ2Nob2ljZXNfX2l0ZW0tLXNlbGVjdGFibGUnLA0KICBpdGVtRGlzYWJsZWQ6ICdjaG9pY2VzX19pdGVtLS1kaXNhYmxlZCcsDQogIGl0ZW1DaG9pY2U6ICdjaG9pY2VzX19pdGVtLS1jaG9pY2UnLA0KICBwbGFjZWhvbGRlcjogJ2Nob2ljZXNfX3BsYWNlaG9sZGVyJywNCiAgZ3JvdXA6ICdjaG9pY2VzX19ncm91cCcsDQogIGdyb3VwSGVhZGluZzogJ2Nob2ljZXNfX2hlYWRpbmcnLA0KICBidXR0b246ICdjaG9pY2VzX19idXR0b24nLA0KICBhY3RpdmVTdGF0ZTogJ2lzLWFjdGl2ZScsDQogIGZvY3VzU3RhdGU6ICdpcy1mb2N1c2VkJywNCiAgb3BlblN0YXRlOiAnaXMtb3BlbicsDQogIGRpc2FibGVkU3RhdGU6ICdpcy1kaXNhYmxlZCcsDQogIGhpZ2hsaWdodGVkU3RhdGU6ICdpcy1oaWdobGlnaHRlZCcsDQogIGhpZGRlblN0YXRlOiAnaXMtaGlkZGVuJywNCiAgZmxpcHBlZFN0YXRlOiAnaXMtZmxpcHBlZCcsDQogIGxvYWRpbmdTdGF0ZTogJ2lzLWxvYWRpbmcnLA0KICBub1Jlc3VsdHM6ICdoYXMtbm8tcmVzdWx0cycsDQogIG5vQ2hvaWNlczogJ2hhcy1uby1jaG9pY2VzJw0KfTsNCg0KdmFyIERFRkFVTFRfQ09ORklHID0gZXhwb3J0cy5ERUZBVUxUX0NPTkZJRyA9IHsNCiAgaXRlbXM6IFtdLA0KICBjaG9pY2VzOiBbXSwNCiAgc2lsZW50OiBmYWxzZSwNCiAgcmVuZGVyQ2hvaWNlTGltaXQ6IC0xLA0KICBtYXhJdGVtQ291bnQ6IC0xLA0KICBhZGRJdGVtczogdHJ1ZSwNCiAgcmVtb3ZlSXRlbXM6IHRydWUsDQogIHJlbW92ZUl0ZW1CdXR0b246IGZhbHNlLA0KICBlZGl0SXRlbXM6IGZhbHNlLA0KICBkdXBsaWNhdGVJdGVtc0FsbG93ZWQ6IHRydWUsDQogIGRlbGltaXRlcjogJywnLA0KICBwYXN0ZTogdHJ1ZSwNCiAgc2VhcmNoRW5hYmxlZDogdHJ1ZSwNCiAgc2VhcmNoQ2hvaWNlczogdHJ1ZSwNCiAgc2VhcmNoRmxvb3I6IDEsDQogIHNlYXJjaFJlc3VsdExpbWl0OiA0LA0KICBzZWFyY2hGaWVsZHM6IFsnbGFiZWwnLCAndmFsdWUnXSwNCiAgcG9zaXRpb246ICdhdXRvJywNCiAgcmVzZXRTY3JvbGxQb3NpdGlvbjogdHJ1ZSwNCiAgcmVnZXhGaWx0ZXI6IG51bGwsDQogIHNob3VsZFNvcnQ6IHRydWUsDQogIHNob3VsZFNvcnRJdGVtczogZmFsc2UsDQogIHNvcnRGbjogX3V0aWxzLnNvcnRCeUFscGhhLA0KICBwbGFjZWhvbGRlcjogdHJ1ZSwNCiAgcGxhY2Vob2xkZXJWYWx1ZTogbnVsbCwNCiAgc2VhcmNoUGxhY2Vob2xkZXJWYWx1ZTogbnVsbCwNCiAgcHJlcGVuZFZhbHVlOiBudWxsLA0KICBhcHBlbmRWYWx1ZTogbnVsbCwNCiAgcmVuZGVyU2VsZWN0ZWRDaG9pY2VzOiAnYXV0bycsDQogIGxvYWRpbmdUZXh0OiAnTG9hZGluZy4uLicsDQogIG5vUmVzdWx0c1RleHQ6ICdObyByZXN1bHRzIGZvdW5kJywNCiAgbm9DaG9pY2VzVGV4dDogJ05vIGNob2ljZXMgdG8gY2hvb3NlIGZyb20nLA0KICBpdGVtU2VsZWN0VGV4dDogJ1ByZXNzIHRvIHNlbGVjdCcsDQogIHVuaXF1ZUl0ZW1UZXh0OiAnT25seSB1bmlxdWUgdmFsdWVzIGNhbiBiZSBhZGRlZCcsDQogIGFkZEl0ZW1UZXh0OiBmdW5jdGlvbiBhZGRJdGVtVGV4dCh2YWx1ZSkgew0KICAgIHJldHVybiAnUHJlc3MgRW50ZXIgdG8gYWRkIDxiPiInICsgKDAsIF91dGlscy5zdHJpcEhUTUwpKHZhbHVlKSArICciPC9iPic7DQogIH0sDQogIG1heEl0ZW1UZXh0OiBmdW5jdGlvbiBtYXhJdGVtVGV4dChtYXhJdGVtQ291bnQpIHsNCiAgICByZXR1cm4gJ09ubHkgJyArIG1heEl0ZW1Db3VudCArICcgdmFsdWVzIGNhbiBiZSBhZGRlZCc7DQogIH0sDQogIGl0ZW1Db21wYXJlcjogZnVuY3Rpb24gaXRlbUNvbXBhcmVyKGNob2ljZSwgaXRlbSkgew0KICAgIHJldHVybiBjaG9pY2UgPT09IGl0ZW07DQogIH0sDQogIGZ1c2VPcHRpb25zOiB7DQogICAgaW5jbHVkZVNjb3JlOiB0cnVlDQogIH0sDQogIGNhbGxiYWNrT25Jbml0OiBudWxsLA0KICBjYWxsYmFja09uQ3JlYXRlVGVtcGxhdGVzOiBudWxsLA0KICBjbGFzc05hbWVzOiBERUZBVUxUX0NMQVNTTkFNRVMNCn07DQoNCnZhciBFVkVOVFMgPSBleHBvcnRzLkVWRU5UUyA9IHsNCiAgc2hvd0Ryb3Bkb3duOiAnc2hvd0Ryb3Bkb3duJywNCiAgaGlkZURyb3Bkb3duOiAnaGlkZURyb3Bkb3duJywNCiAgY2hhbmdlOiAnY2hhbmdlJywNCiAgY2hvaWNlOiAnY2hvaWNlJywNCiAgc2VhcmNoOiAnc2VhcmNoJywNCiAgYWRkSXRlbTogJ2FkZEl0ZW0nLA0KICByZW1vdmVJdGVtOiAncmVtb3ZlSXRlbScsDQogIGhpZ2hsaWdodEl0ZW06ICdoaWdobGlnaHRJdGVtJywNCiAgaGlnaGxpZ2h0Q2hvaWNlOiAnaGlnaGxpZ2h0Q2hvaWNlJw0KfTsNCg0KdmFyIEFDVElPTl9UWVBFUyA9IGV4cG9ydHMuQUNUSU9OX1RZUEVTID0gew0KICBBRERfQ0hPSUNFOiAnQUREX0NIT0lDRScsDQogIEZJTFRFUl9DSE9JQ0VTOiAnRklMVEVSX0NIT0lDRVMnLA0KICBBQ1RJVkFURV9DSE9JQ0VTOiAnQUNUSVZBVEVfQ0hPSUNFUycsDQogIENMRUFSX0NIT0lDRVM6ICdDTEVBUl9DSE9JQ0VTJywNCiAgQUREX0dST1VQOiAnQUREX0dST1VQJywNCiAgQUREX0lURU06ICdBRERfSVRFTScsDQogIFJFTU9WRV9JVEVNOiAnUkVNT1ZFX0lURU0nLA0KICBISUdITElHSFRfSVRFTTogJ0hJR0hMSUdIVF9JVEVNJywNCiAgQ0xFQVJfQUxMOiAnQ0xFQVJfQUxMJw0KfTsNCg0KdmFyIEtFWV9DT0RFUyA9IGV4cG9ydHMuS0VZX0NPREVTID0gew0KICBCQUNLX0tFWTogNDYsDQogIERFTEVURV9LRVk6IDgsDQogIEVOVEVSX0tFWTogMTMsDQogIEFfS0VZOiA2NSwNCiAgRVNDX0tFWTogMjcsDQogIFVQX0tFWTogMzgsDQogIERPV05fS0VZOiA0MCwNCiAgUEFHRV9VUF9LRVk6IDMzLA0KICBQQUdFX0RPV05fS0VZOiAzNA0KfTsNCg0KdmFyIFNDUk9MTElOR19TUEVFRCA9IGV4cG9ydHMuU0NST0xMSU5HX1NQRUVEID0gNDsNCg0KLyoqKi8gfSksDQovKiA2ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOw0KdmFyIGNvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOw0KdmFyIGhpZGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpOw0KdmFyIHJlZGVmaW5lID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNCk7DQp2YXIgY3R4ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNCk7DQp2YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7DQoNCnZhciAkZXhwb3J0ID0gZnVuY3Rpb24gKHR5cGUsIG5hbWUsIHNvdXJjZSkgew0KICB2YXIgSVNfRk9SQ0VEID0gdHlwZSAmICRleHBvcnQuRjsNCiAgdmFyIElTX0dMT0JBTCA9IHR5cGUgJiAkZXhwb3J0Lkc7DQogIHZhciBJU19TVEFUSUMgPSB0eXBlICYgJGV4cG9ydC5TOw0KICB2YXIgSVNfUFJPVE8gPSB0eXBlICYgJGV4cG9ydC5QOw0KICB2YXIgSVNfQklORCA9IHR5cGUgJiAkZXhwb3J0LkI7DQogIHZhciB0YXJnZXQgPSBJU19HTE9CQUwgPyBnbG9iYWwgOiBJU19TVEFUSUMgPyBnbG9iYWxbbmFtZV0gfHwgKGdsb2JhbFtuYW1lXSA9IHt9KSA6IChnbG9iYWxbbmFtZV0gfHwge30pW1BST1RPVFlQRV07DQogIHZhciBleHBvcnRzID0gSVNfR0xPQkFMID8gY29yZSA6IGNvcmVbbmFtZV0gfHwgKGNvcmVbbmFtZV0gPSB7fSk7DQogIHZhciBleHBQcm90byA9IGV4cG9ydHNbUFJPVE9UWVBFXSB8fCAoZXhwb3J0c1tQUk9UT1RZUEVdID0ge30pOw0KICB2YXIga2V5LCBvd24sIG91dCwgZXhwOw0KICBpZiAoSVNfR0xPQkFMKSBzb3VyY2UgPSBuYW1lOw0KICBmb3IgKGtleSBpbiBzb3VyY2UpIHsNCiAgICAvLyBjb250YWlucyBpbiBuYXRpdmUNCiAgICBvd24gPSAhSVNfRk9SQ0VEICYmIHRhcmdldCAmJiB0YXJnZXRba2V5XSAhPT0gdW5kZWZpbmVkOw0KICAgIC8vIGV4cG9ydCBuYXRpdmUgb3IgcGFzc2VkDQogICAgb3V0ID0gKG93biA/IHRhcmdldCA6IHNvdXJjZSlba2V5XTsNCiAgICAvLyBiaW5kIHRpbWVycyB0byBnbG9iYWwgZm9yIGNhbGwgZnJvbSBleHBvcnQgY29udGV4dA0KICAgIGV4cCA9IElTX0JJTkQgJiYgb3duID8gY3R4KG91dCwgZ2xvYmFsKSA6IElTX1BST1RPICYmIHR5cGVvZiBvdXQgPT0gJ2Z1bmN0aW9uJyA/IGN0eChGdW5jdGlvbi5jYWxsLCBvdXQpIDogb3V0Ow0KICAgIC8vIGV4dGVuZCBnbG9iYWwNCiAgICBpZiAodGFyZ2V0KSByZWRlZmluZSh0YXJnZXQsIGtleSwgb3V0LCB0eXBlICYgJGV4cG9ydC5VKTsNCiAgICAvLyBleHBvcnQNCiAgICBpZiAoZXhwb3J0c1trZXldICE9IG91dCkgaGlkZShleHBvcnRzLCBrZXksIGV4cCk7DQogICAgaWYgKElTX1BST1RPICYmIGV4cFByb3RvW2tleV0gIT0gb3V0KSBleHBQcm90b1trZXldID0gb3V0Ow0KICB9DQp9Ow0KZ2xvYmFsLmNvcmUgPSBjb3JlOw0KLy8gdHlwZSBiaXRtYXANCiRleHBvcnQuRiA9IDE7ICAgLy8gZm9yY2VkDQokZXhwb3J0LkcgPSAyOyAgIC8vIGdsb2JhbA0KJGV4cG9ydC5TID0gNDsgICAvLyBzdGF0aWMNCiRleHBvcnQuUCA9IDg7ICAgLy8gcHJvdG8NCiRleHBvcnQuQiA9IDE2OyAgLy8gYmluZA0KJGV4cG9ydC5XID0gMzI7ICAvLyB3cmFwDQokZXhwb3J0LlUgPSA2NDsgIC8vIHNhZmUNCiRleHBvcnQuUiA9IDEyODsgLy8gcmVhbCBwcm90byBtZXRob2QgZm9yIGBsaWJyYXJ5YA0KbW9kdWxlLmV4cG9ydHMgPSAkZXhwb3J0Ow0KDQoNCi8qKiovIH0pLA0KLyogNyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpOw0KdmFyIElFOF9ET01fREVGSU5FID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NCk7DQp2YXIgdG9QcmltaXRpdmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ1KTsNCnZhciBkUCA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsNCg0KZXhwb3J0cy5mID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCkgPyBPYmplY3QuZGVmaW5lUHJvcGVydHkgOiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKSB7DQogIGFuT2JqZWN0KE8pOw0KICBQID0gdG9QcmltaXRpdmUoUCwgdHJ1ZSk7DQogIGFuT2JqZWN0KEF0dHJpYnV0ZXMpOw0KICBpZiAoSUU4X0RPTV9ERUZJTkUpIHRyeSB7DQogICAgcmV0dXJuIGRQKE8sIFAsIEF0dHJpYnV0ZXMpOw0KICB9IGNhdGNoIChlKSB7IC8qIGVtcHR5ICovIH0NCiAgaWYgKCdnZXQnIGluIEF0dHJpYnV0ZXMgfHwgJ3NldCcgaW4gQXR0cmlidXRlcykgdGhyb3cgVHlwZUVycm9yKCdBY2Nlc3NvcnMgbm90IHN1cHBvcnRlZCEnKTsNCiAgaWYgKCd2YWx1ZScgaW4gQXR0cmlidXRlcykgT1tQXSA9IEF0dHJpYnV0ZXMudmFsdWU7DQogIHJldHVybiBPOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDggKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5KTsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7DQogIGlmICghaXNPYmplY3QoaXQpKSB0aHJvdyBUeXBlRXJyb3IoaXQgKyAnIGlzIG5vdCBhbiBvYmplY3QhJyk7DQogIHJldHVybiBpdDsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA5ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7DQogIHJldHVybiB0eXBlb2YgaXQgPT09ICdvYmplY3QnID8gaXQgIT09IG51bGwgOiB0eXBlb2YgaXQgPT09ICdmdW5jdGlvbic7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMTAgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gVGhhbmsncyBJRTggZm9yIGhpcyBmdW5ueSBkZWZpbmVQcm9wZXJ0eQ0KbW9kdWxlLmV4cG9ydHMgPSAhX193ZWJwYWNrX3JlcXVpcmVfXygyMikoZnVuY3Rpb24gKCkgew0KICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCAnYScsIHsgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiA3OyB9IH0pLmEgIT0gNzsNCn0pOw0KDQoNCi8qKiovIH0pLA0KLyogMTEgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KdmFyIGhhc093blByb3BlcnR5ID0ge30uaGFzT3duUHJvcGVydHk7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwga2V5KSB7DQogIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKGl0LCBrZXkpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDEyICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGJpdG1hcCwgdmFsdWUpIHsNCiAgcmV0dXJuIHsNCiAgICBlbnVtZXJhYmxlOiAhKGJpdG1hcCAmIDEpLA0KICAgIGNvbmZpZ3VyYWJsZTogIShiaXRtYXAgJiAyKSwNCiAgICB3cml0YWJsZTogIShiaXRtYXAgJiA0KSwNCiAgICB2YWx1ZTogdmFsdWUNCiAgfTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAxMyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQp2YXIgaWQgPSAwOw0KdmFyIHB4ID0gTWF0aC5yYW5kb20oKTsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSkgew0KICByZXR1cm4gJ1N5bWJvbCgnLmNvbmNhdChrZXkgPT09IHVuZGVmaW5lZCA/ICcnIDoga2V5LCAnKV8nLCAoKytpZCArIHB4KS50b1N0cmluZygzNikpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDE0ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIG9wdGlvbmFsIC8gc2ltcGxlIGNvbnRleHQgYmluZGluZw0KdmFyIGFGdW5jdGlvbiA9IF9fd2VicGFja19yZXF1aXJlX18oNDYpOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZm4sIHRoYXQsIGxlbmd0aCkgew0KICBhRnVuY3Rpb24oZm4pOw0KICBpZiAodGhhdCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gZm47DQogIHN3aXRjaCAobGVuZ3RoKSB7DQogICAgY2FzZSAxOiByZXR1cm4gZnVuY3Rpb24gKGEpIHsNCiAgICAgIHJldHVybiBmbi5jYWxsKHRoYXQsIGEpOw0KICAgIH07DQogICAgY2FzZSAyOiByZXR1cm4gZnVuY3Rpb24gKGEsIGIpIHsNCiAgICAgIHJldHVybiBmbi5jYWxsKHRoYXQsIGEsIGIpOw0KICAgIH07DQogICAgY2FzZSAzOiByZXR1cm4gZnVuY3Rpb24gKGEsIGIsIGMpIHsNCiAgICAgIHJldHVybiBmbi5jYWxsKHRoYXQsIGEsIGIsIGMpOw0KICAgIH07DQogIH0NCiAgcmV0dXJuIGZ1bmN0aW9uICgvKiAuLi5hcmdzICovKSB7DQogICAgcmV0dXJuIGZuLmFwcGx5KHRoYXQsIGFyZ3VtZW50cyk7DQogIH07DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMTUgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KdmFyIHRvU3RyaW5nID0ge30udG9TdHJpbmc7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7DQogIHJldHVybiB0b1N0cmluZy5jYWxsKGl0KS5zbGljZSg4LCAtMSk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMTYgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gNy4xLjEzIFRvT2JqZWN0KGFyZ3VtZW50KQ0KdmFyIGRlZmluZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3KTsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7DQogIHJldHVybiBPYmplY3QoZGVmaW5lZChpdCkpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDE3ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCi8vIDcuMi4xIFJlcXVpcmVPYmplY3RDb2VyY2libGUoYXJndW1lbnQpDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgew0KICBpZiAoaXQgPT0gdW5kZWZpbmVkKSB0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNhbGwgbWV0aG9kIG9uICAiICsgaXQpOw0KICByZXR1cm4gaXQ7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMTggKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gNy4xLjE1IFRvTGVuZ3RoDQp2YXIgdG9JbnRlZ2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOSk7DQp2YXIgbWluID0gTWF0aC5taW47DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgew0KICByZXR1cm4gaXQgPiAwID8gbWluKHRvSW50ZWdlcihpdCksIDB4MWZmZmZmZmZmZmZmZmYpIDogMDsgLy8gcG93KDIsIDUzKSAtIDEgPT0gOTAwNzE5OTI1NDc0MDk5MQ0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDE5ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCi8vIDcuMS40IFRvSW50ZWdlcg0KdmFyIGNlaWwgPSBNYXRoLmNlaWw7DQp2YXIgZmxvb3IgPSBNYXRoLmZsb29yOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsNCiAgcmV0dXJuIGlzTmFOKGl0ID0gK2l0KSA/IDAgOiAoaXQgPiAwID8gZmxvb3IgOiBjZWlsKShpdCk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMjAgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KbW9kdWxlLmV4cG9ydHMgPSB7fTsNCg0KDQovKioqLyB9KSwNCi8qIDIxICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBzaGFyZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI2KSgna2V5cycpOw0KdmFyIHVpZCA9IF9fd2VicGFja19yZXF1aXJlX18oMTMpOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoa2V5KSB7DQogIHJldHVybiBzaGFyZWRba2V5XSB8fCAoc2hhcmVkW2tleV0gPSB1aWQoa2V5KSk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMjIgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZXhlYykgew0KICB0cnkgew0KICAgIHJldHVybiAhIWV4ZWMoKTsNCiAgfSBjYXRjaCAoZSkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMjMgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5KTsNCnZhciBkb2N1bWVudCA9IF9fd2VicGFja19yZXF1aXJlX18oMykuZG9jdW1lbnQ7DQovLyB0eXBlb2YgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCBpcyAnb2JqZWN0JyBpbiBvbGQgSUUNCnZhciBpcyA9IGlzT2JqZWN0KGRvY3VtZW50KSAmJiBpc09iamVjdChkb2N1bWVudC5jcmVhdGVFbGVtZW50KTsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7DQogIHJldHVybiBpcyA/IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoaXQpIDoge307DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMjQgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7DQp2YXIgaGlkZSA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7DQp2YXIgaGFzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMSk7DQp2YXIgU1JDID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMykoJ3NyYycpOw0KdmFyIFRPX1NUUklORyA9ICd0b1N0cmluZyc7DQp2YXIgJHRvU3RyaW5nID0gRnVuY3Rpb25bVE9fU1RSSU5HXTsNCnZhciBUUEwgPSAoJycgKyAkdG9TdHJpbmcpLnNwbGl0KFRPX1NUUklORyk7DQoNCl9fd2VicGFja19yZXF1aXJlX18oMikuaW5zcGVjdFNvdXJjZSA9IGZ1bmN0aW9uIChpdCkgew0KICByZXR1cm4gJHRvU3RyaW5nLmNhbGwoaXQpOw0KfTsNCg0KKG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKE8sIGtleSwgdmFsLCBzYWZlKSB7DQogIHZhciBpc0Z1bmN0aW9uID0gdHlwZW9mIHZhbCA9PSAnZnVuY3Rpb24nOw0KICBpZiAoaXNGdW5jdGlvbikgaGFzKHZhbCwgJ25hbWUnKSB8fCBoaWRlKHZhbCwgJ25hbWUnLCBrZXkpOw0KICBpZiAoT1trZXldID09PSB2YWwpIHJldHVybjsNCiAgaWYgKGlzRnVuY3Rpb24pIGhhcyh2YWwsIFNSQykgfHwgaGlkZSh2YWwsIFNSQywgT1trZXldID8gJycgKyBPW2tleV0gOiBUUEwuam9pbihTdHJpbmcoa2V5KSkpOw0KICBpZiAoTyA9PT0gZ2xvYmFsKSB7DQogICAgT1trZXldID0gdmFsOw0KICB9IGVsc2UgaWYgKCFzYWZlKSB7DQogICAgZGVsZXRlIE9ba2V5XTsNCiAgICBoaWRlKE8sIGtleSwgdmFsKTsNCiAgfSBlbHNlIGlmIChPW2tleV0pIHsNCiAgICBPW2tleV0gPSB2YWw7DQogIH0gZWxzZSB7DQogICAgaGlkZShPLCBrZXksIHZhbCk7DQogIH0NCi8vIGFkZCBmYWtlIEZ1bmN0aW9uI3RvU3RyaW5nIGZvciBjb3JyZWN0IHdvcmsgd3JhcHBlZCBtZXRob2RzIC8gY29uc3RydWN0b3JzIHdpdGggbWV0aG9kcyBsaWtlIExvRGFzaCBpc05hdGl2ZQ0KfSkoRnVuY3Rpb24ucHJvdG90eXBlLCBUT19TVFJJTkcsIGZ1bmN0aW9uIHRvU3RyaW5nKCkgew0KICByZXR1cm4gdHlwZW9mIHRoaXMgPT0gJ2Z1bmN0aW9uJyAmJiB0aGlzW1NSQ10gfHwgJHRvU3RyaW5nLmNhbGwodGhpcyk7DQp9KTsNCg0KDQovKioqLyB9KSwNCi8qIDI1ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIGZhbGxiYWNrIGZvciBub24tYXJyYXktbGlrZSBFUzMgYW5kIG5vbi1lbnVtZXJhYmxlIG9sZCBWOCBzdHJpbmdzDQp2YXIgY29mID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNSk7DQovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zDQptb2R1bGUuZXhwb3J0cyA9IE9iamVjdCgneicpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApID8gT2JqZWN0IDogZnVuY3Rpb24gKGl0KSB7DQogIHJldHVybiBjb2YoaXQpID09ICdTdHJpbmcnID8gaXQuc3BsaXQoJycpIDogT2JqZWN0KGl0KTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAyNiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgY29yZSA9IF9fd2VicGFja19yZXF1aXJlX18oMik7DQp2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsNCnZhciBTSEFSRUQgPSAnX19jb3JlLWpzX3NoYXJlZF9fJzsNCnZhciBzdG9yZSA9IGdsb2JhbFtTSEFSRURdIHx8IChnbG9iYWxbU0hBUkVEXSA9IHt9KTsNCg0KKG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsNCiAgcmV0dXJuIHN0b3JlW2tleV0gfHwgKHN0b3JlW2tleV0gPSB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gdmFsdWUgOiB7fSk7DQp9KSgndmVyc2lvbnMnLCBbXSkucHVzaCh7DQogIHZlcnNpb246IGNvcmUudmVyc2lvbiwNCiAgbW9kZTogX193ZWJwYWNrX3JlcXVpcmVfXygyNykgPyAncHVyZScgOiAnZ2xvYmFsJywNCiAgY29weXJpZ2h0OiAnwqkgMjAxOCBEZW5pcyBQdXNoa2FyZXYgKHpsb2lyb2NrLnJ1KScNCn0pOw0KDQoNCi8qKiovIH0pLA0KLyogMjcgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmYWxzZTsNCg0KDQovKioqLyB9KSwNCi8qIDI4ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIDIyLjEuMy4zMSBBcnJheS5wcm90b3R5cGVbQEB1bnNjb3BhYmxlc10NCnZhciBVTlNDT1BBQkxFUyA9IF9fd2VicGFja19yZXF1aXJlX18oMCkoJ3Vuc2NvcGFibGVzJyk7DQp2YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZTsNCmlmIChBcnJheVByb3RvW1VOU0NPUEFCTEVTXSA9PSB1bmRlZmluZWQpIF9fd2VicGFja19yZXF1aXJlX18oNCkoQXJyYXlQcm90bywgVU5TQ09QQUJMRVMsIHt9KTsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSkgew0KICBBcnJheVByb3RvW1VOU0NPUEFCTEVTXVtrZXldID0gdHJ1ZTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAyOSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyB0byBpbmRleGVkIG9iamVjdCwgdG9PYmplY3Qgd2l0aCBmYWxsYmFjayBmb3Igbm9uLWFycmF5LWxpa2UgRVMzIHN0cmluZ3MNCnZhciBJT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNSk7DQp2YXIgZGVmaW5lZCA9IF9fd2VicGFja19yZXF1aXJlX18oMTcpOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsNCiAgcmV0dXJuIElPYmplY3QoZGVmaW5lZChpdCkpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDMwICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIGZhbHNlIC0+IEFycmF5I2luZGV4T2YNCi8vIHRydWUgIC0+IEFycmF5I2luY2x1ZGVzDQp2YXIgdG9JT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOSk7DQp2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE4KTsNCnZhciB0b0Fic29sdXRlSW5kZXggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYwKTsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKElTX0lOQ0xVREVTKSB7DQogIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIGVsLCBmcm9tSW5kZXgpIHsNCiAgICB2YXIgTyA9IHRvSU9iamVjdCgkdGhpcyk7DQogICAgdmFyIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKTsNCiAgICB2YXIgaW5kZXggPSB0b0Fic29sdXRlSW5kZXgoZnJvbUluZGV4LCBsZW5ndGgpOw0KICAgIHZhciB2YWx1ZTsNCiAgICAvLyBBcnJheSNpbmNsdWRlcyB1c2VzIFNhbWVWYWx1ZVplcm8gZXF1YWxpdHkgYWxnb3JpdGhtDQogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZQ0KICAgIGlmIChJU19JTkNMVURFUyAmJiBlbCAhPSBlbCkgd2hpbGUgKGxlbmd0aCA+IGluZGV4KSB7DQogICAgICB2YWx1ZSA9IE9baW5kZXgrK107DQogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlDQogICAgICBpZiAodmFsdWUgIT0gdmFsdWUpIHJldHVybiB0cnVlOw0KICAgIC8vIEFycmF5I2luZGV4T2YgaWdub3JlcyBob2xlcywgQXJyYXkjaW5jbHVkZXMgLSBub3QNCiAgICB9IGVsc2UgZm9yICg7bGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIGlmIChJU19JTkNMVURFUyB8fCBpbmRleCBpbiBPKSB7DQogICAgICBpZiAoT1tpbmRleF0gPT09IGVsKSByZXR1cm4gSVNfSU5DTFVERVMgfHwgaW5kZXggfHwgMDsNCiAgICB9IHJldHVybiAhSVNfSU5DTFVERVMgJiYgLTE7DQogIH07DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMzEgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KLy8gSUUgOC0gZG9uJ3QgZW51bSBidWcga2V5cw0KbW9kdWxlLmV4cG9ydHMgPSAoDQogICdjb25zdHJ1Y3RvcixoYXNPd25Qcm9wZXJ0eSxpc1Byb3RvdHlwZU9mLHByb3BlcnR5SXNFbnVtZXJhYmxlLHRvTG9jYWxlU3RyaW5nLHRvU3RyaW5nLHZhbHVlT2YnDQopLnNwbGl0KCcsJyk7DQoNCg0KLyoqKi8gfSksDQovKiAzMiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgZGVmID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KS5mOw0KdmFyIGhhcyA9IF9fd2VicGFja19yZXF1aXJlX18oMTEpOw0KdmFyIFRBRyA9IF9fd2VicGFja19yZXF1aXJlX18oMCkoJ3RvU3RyaW5nVGFnJyk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0LCB0YWcsIHN0YXQpIHsNCiAgaWYgKGl0ICYmICFoYXMoaXQgPSBzdGF0ID8gaXQgOiBpdC5wcm90b3R5cGUsIFRBRykpIGRlZihpdCwgVEFHLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgdmFsdWU6IHRhZyB9KTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAzMyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQpPYmplY3QuZGVmaW5lUHJvcGVydHkoX193ZWJwYWNrX2V4cG9ydHNfXywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOw0KDQovLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fZnJlZUdsb2JhbC5qcw0KdmFyIF9mcmVlR2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NCk7DQoNCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fcm9vdC5qcw0KDQoNCi8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgc2VsZmAuICovDQp2YXIgZnJlZVNlbGYgPSB0eXBlb2Ygc2VsZiA9PSAnb2JqZWN0JyAmJiBzZWxmICYmIHNlbGYuT2JqZWN0ID09PSBPYmplY3QgJiYgc2VsZjsNCg0KLyoqIFVzZWQgYXMgYSByZWZlcmVuY2UgdG8gdGhlIGdsb2JhbCBvYmplY3QuICovDQp2YXIgcm9vdCA9IF9mcmVlR2xvYmFsWyJhIiAvKiBkZWZhdWx0ICovXSB8fCBmcmVlU2VsZiB8fCBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOw0KDQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBfcm9vdCA9IChyb290KTsNCg0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19TeW1ib2wuanMNCg0KDQovKiogQnVpbHQtaW4gdmFsdWUgcmVmZXJlbmNlcy4gKi8NCnZhciBTeW1ib2wgPSBfcm9vdC5TeW1ib2w7DQoNCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIF9TeW1ib2wgPSAoU3ltYm9sKTsNCg0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19nZXRSYXdUYWcuanMNCg0KDQovKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovDQp2YXIgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOw0KDQovKiogVXNlZCB0byBjaGVjayBvYmplY3RzIGZvciBvd24gcHJvcGVydGllcy4gKi8NCnZhciBfZ2V0UmF3VGFnX2hhc093blByb3BlcnR5ID0gb2JqZWN0UHJvdG8uaGFzT3duUHJvcGVydHk7DQoNCi8qKg0KICogVXNlZCB0byByZXNvbHZlIHRoZQ0KICogW2B0b1N0cmluZ1RhZ2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5wcm90b3R5cGUudG9zdHJpbmcpDQogKiBvZiB2YWx1ZXMuDQogKi8NCnZhciBuYXRpdmVPYmplY3RUb1N0cmluZyA9IG9iamVjdFByb3RvLnRvU3RyaW5nOw0KDQovKiogQnVpbHQtaW4gdmFsdWUgcmVmZXJlbmNlcy4gKi8NCnZhciBzeW1Ub1N0cmluZ1RhZyA9IF9TeW1ib2wgPyBfU3ltYm9sLnRvU3RyaW5nVGFnIDogdW5kZWZpbmVkOw0KDQovKioNCiAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZUdldFRhZ2Agd2hpY2ggaWdub3JlcyBgU3ltYm9sLnRvU3RyaW5nVGFnYCB2YWx1ZXMuDQogKg0KICogQHByaXZhdGUNCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHF1ZXJ5Lg0KICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgcmF3IGB0b1N0cmluZ1RhZ2AuDQogKi8NCmZ1bmN0aW9uIGdldFJhd1RhZyh2YWx1ZSkgew0KICB2YXIgaXNPd24gPSBfZ2V0UmF3VGFnX2hhc093blByb3BlcnR5LmNhbGwodmFsdWUsIHN5bVRvU3RyaW5nVGFnKSwNCiAgICAgIHRhZyA9IHZhbHVlW3N5bVRvU3RyaW5nVGFnXTsNCg0KICB0cnkgew0KICAgIHZhbHVlW3N5bVRvU3RyaW5nVGFnXSA9IHVuZGVmaW5lZDsNCiAgICB2YXIgdW5tYXNrZWQgPSB0cnVlOw0KICB9IGNhdGNoIChlKSB7fQ0KDQogIHZhciByZXN1bHQgPSBuYXRpdmVPYmplY3RUb1N0cmluZy5jYWxsKHZhbHVlKTsNCiAgaWYgKHVubWFza2VkKSB7DQogICAgaWYgKGlzT3duKSB7DQogICAgICB2YWx1ZVtzeW1Ub1N0cmluZ1RhZ10gPSB0YWc7DQogICAgfSBlbHNlIHsNCiAgICAgIGRlbGV0ZSB2YWx1ZVtzeW1Ub1N0cmluZ1RhZ107DQogICAgfQ0KICB9DQogIHJldHVybiByZXN1bHQ7DQp9DQoNCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIF9nZXRSYXdUYWcgPSAoZ2V0UmF3VGFnKTsNCg0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19vYmplY3RUb1N0cmluZy5qcw0KLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqLw0KdmFyIF9vYmplY3RUb1N0cmluZ19vYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7DQoNCi8qKg0KICogVXNlZCB0byByZXNvbHZlIHRoZQ0KICogW2B0b1N0cmluZ1RhZ2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5wcm90b3R5cGUudG9zdHJpbmcpDQogKiBvZiB2YWx1ZXMuDQogKi8NCnZhciBfb2JqZWN0VG9TdHJpbmdfbmF0aXZlT2JqZWN0VG9TdHJpbmcgPSBfb2JqZWN0VG9TdHJpbmdfb2JqZWN0UHJvdG8udG9TdHJpbmc7DQoNCi8qKg0KICogQ29udmVydHMgYHZhbHVlYCB0byBhIHN0cmluZyB1c2luZyBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZ2AuDQogKg0KICogQHByaXZhdGUNCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuDQogKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgc3RyaW5nLg0KICovDQpmdW5jdGlvbiBvYmplY3RUb1N0cmluZyh2YWx1ZSkgew0KICByZXR1cm4gX29iamVjdFRvU3RyaW5nX25hdGl2ZU9iamVjdFRvU3RyaW5nLmNhbGwodmFsdWUpOw0KfQ0KDQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBfb2JqZWN0VG9TdHJpbmcgPSAob2JqZWN0VG9TdHJpbmcpOw0KDQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2Jhc2VHZXRUYWcuanMNCg0KDQoNCg0KLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqLw0KdmFyIG51bGxUYWcgPSAnW29iamVjdCBOdWxsXScsDQogICAgdW5kZWZpbmVkVGFnID0gJ1tvYmplY3QgVW5kZWZpbmVkXSc7DQoNCi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLw0KdmFyIF9iYXNlR2V0VGFnX3N5bVRvU3RyaW5nVGFnID0gX1N5bWJvbCA/IF9TeW1ib2wudG9TdHJpbmdUYWcgOiB1bmRlZmluZWQ7DQoNCi8qKg0KICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYGdldFRhZ2Agd2l0aG91dCBmYWxsYmFja3MgZm9yIGJ1Z2d5IGVudmlyb25tZW50cy4NCiAqDQogKiBAcHJpdmF0ZQ0KICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuDQogKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBgdG9TdHJpbmdUYWdgLg0KICovDQpmdW5jdGlvbiBiYXNlR2V0VGFnKHZhbHVlKSB7DQogIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWRUYWcgOiBudWxsVGFnOw0KICB9DQogIHJldHVybiAoX2Jhc2VHZXRUYWdfc3ltVG9TdHJpbmdUYWcgJiYgX2Jhc2VHZXRUYWdfc3ltVG9TdHJpbmdUYWcgaW4gT2JqZWN0KHZhbHVlKSkNCiAgICA/IF9nZXRSYXdUYWcodmFsdWUpDQogICAgOiBfb2JqZWN0VG9TdHJpbmcodmFsdWUpOw0KfQ0KDQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBfYmFzZUdldFRhZyA9IChiYXNlR2V0VGFnKTsNCg0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19vdmVyQXJnLmpzDQovKioNCiAqIENyZWF0ZXMgYSB1bmFyeSBmdW5jdGlvbiB0aGF0IGludm9rZXMgYGZ1bmNgIHdpdGggaXRzIGFyZ3VtZW50IHRyYW5zZm9ybWVkLg0KICoNCiAqIEBwcml2YXRlDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byB3cmFwLg0KICogQHBhcmFtIHtGdW5jdGlvbn0gdHJhbnNmb3JtIFRoZSBhcmd1bWVudCB0cmFuc2Zvcm0uDQogKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBmdW5jdGlvbi4NCiAqLw0KZnVuY3Rpb24gb3ZlckFyZyhmdW5jLCB0cmFuc2Zvcm0pIHsNCiAgcmV0dXJuIGZ1bmN0aW9uKGFyZykgew0KICAgIHJldHVybiBmdW5jKHRyYW5zZm9ybShhcmcpKTsNCiAgfTsNCn0NCg0KLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgX292ZXJBcmcgPSAob3ZlckFyZyk7DQoNCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fZ2V0UHJvdG90eXBlLmpzDQoNCg0KLyoqIEJ1aWx0LWluIHZhbHVlIHJlZmVyZW5jZXMuICovDQp2YXIgZ2V0UHJvdG90eXBlID0gX292ZXJBcmcoT2JqZWN0LmdldFByb3RvdHlwZU9mLCBPYmplY3QpOw0KDQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBfZ2V0UHJvdG90eXBlID0gKGdldFByb3RvdHlwZSk7DQoNCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9pc09iamVjdExpa2UuanMNCi8qKg0KICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UuIEEgdmFsdWUgaXMgb2JqZWN0LWxpa2UgaWYgaXQncyBub3QgYG51bGxgDQogKiBhbmQgaGFzIGEgYHR5cGVvZmAgcmVzdWx0IG9mICJvYmplY3QiLg0KICoNCiAqIEBzdGF0aWMNCiAqIEBtZW1iZXJPZiBfDQogKiBAc2luY2UgNC4wLjANCiAqIEBjYXRlZ29yeSBMYW5nDQogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4NCiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLCBlbHNlIGBmYWxzZWAuDQogKiBAZXhhbXBsZQ0KICoNCiAqIF8uaXNPYmplY3RMaWtlKHt9KTsNCiAqIC8vID0+IHRydWUNCiAqDQogKiBfLmlzT2JqZWN0TGlrZShbMSwgMiwgM10pOw0KICogLy8gPT4gdHJ1ZQ0KICoNCiAqIF8uaXNPYmplY3RMaWtlKF8ubm9vcCk7DQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqIF8uaXNPYmplY3RMaWtlKG51bGwpOw0KICogLy8gPT4gZmFsc2UNCiAqLw0KZnVuY3Rpb24gaXNPYmplY3RMaWtlKHZhbHVlKSB7DQogIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JzsNCn0NCg0KLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgbG9kYXNoX2VzX2lzT2JqZWN0TGlrZSA9IChpc09iamVjdExpa2UpOw0KDQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvaXNQbGFpbk9iamVjdC5qcw0KDQoNCg0KDQovKiogYE9iamVjdCN0b1N0cmluZ2AgcmVzdWx0IHJlZmVyZW5jZXMuICovDQp2YXIgb2JqZWN0VGFnID0gJ1tvYmplY3QgT2JqZWN0XSc7DQoNCi8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi8NCnZhciBmdW5jUHJvdG8gPSBGdW5jdGlvbi5wcm90b3R5cGUsDQogICAgaXNQbGFpbk9iamVjdF9vYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7DQoNCi8qKiBVc2VkIHRvIHJlc29sdmUgdGhlIGRlY29tcGlsZWQgc291cmNlIG9mIGZ1bmN0aW9ucy4gKi8NCnZhciBmdW5jVG9TdHJpbmcgPSBmdW5jUHJvdG8udG9TdHJpbmc7DQoNCi8qKiBVc2VkIHRvIGNoZWNrIG9iamVjdHMgZm9yIG93biBwcm9wZXJ0aWVzLiAqLw0KdmFyIGlzUGxhaW5PYmplY3RfaGFzT3duUHJvcGVydHkgPSBpc1BsYWluT2JqZWN0X29iamVjdFByb3RvLmhhc093blByb3BlcnR5Ow0KDQovKiogVXNlZCB0byBpbmZlciB0aGUgYE9iamVjdGAgY29uc3RydWN0b3IuICovDQp2YXIgb2JqZWN0Q3RvclN0cmluZyA9IGZ1bmNUb1N0cmluZy5jYWxsKE9iamVjdCk7DQoNCi8qKg0KICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBwbGFpbiBvYmplY3QsIHRoYXQgaXMsIGFuIG9iamVjdCBjcmVhdGVkIGJ5IHRoZQ0KICogYE9iamVjdGAgY29uc3RydWN0b3Igb3Igb25lIHdpdGggYSBgW1tQcm90b3R5cGVdXWAgb2YgYG51bGxgLg0KICoNCiAqIEBzdGF0aWMNCiAqIEBtZW1iZXJPZiBfDQogKiBAc2luY2UgMC44LjANCiAqIEBjYXRlZ29yeSBMYW5nDQogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4NCiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgcGxhaW4gb2JqZWN0LCBlbHNlIGBmYWxzZWAuDQogKiBAZXhhbXBsZQ0KICoNCiAqIGZ1bmN0aW9uIEZvbygpIHsNCiAqICAgdGhpcy5hID0gMTsNCiAqIH0NCiAqDQogKiBfLmlzUGxhaW5PYmplY3QobmV3IEZvbyk7DQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqIF8uaXNQbGFpbk9iamVjdChbMSwgMiwgM10pOw0KICogLy8gPT4gZmFsc2UNCiAqDQogKiBfLmlzUGxhaW5PYmplY3QoeyAneCc6IDAsICd5JzogMCB9KTsNCiAqIC8vID0+IHRydWUNCiAqDQogKiBfLmlzUGxhaW5PYmplY3QoT2JqZWN0LmNyZWF0ZShudWxsKSk7DQogKiAvLyA9PiB0cnVlDQogKi8NCmZ1bmN0aW9uIGlzUGxhaW5PYmplY3QodmFsdWUpIHsNCiAgaWYgKCFsb2Rhc2hfZXNfaXNPYmplY3RMaWtlKHZhbHVlKSB8fCBfYmFzZUdldFRhZyh2YWx1ZSkgIT0gb2JqZWN0VGFnKSB7DQogICAgcmV0dXJuIGZhbHNlOw0KICB9DQogIHZhciBwcm90byA9IF9nZXRQcm90b3R5cGUodmFsdWUpOw0KICBpZiAocHJvdG8gPT09IG51bGwpIHsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfQ0KICB2YXIgQ3RvciA9IGlzUGxhaW5PYmplY3RfaGFzT3duUHJvcGVydHkuY2FsbChwcm90bywgJ2NvbnN0cnVjdG9yJykgJiYgcHJvdG8uY29uc3RydWN0b3I7DQogIHJldHVybiB0eXBlb2YgQ3RvciA9PSAnZnVuY3Rpb24nICYmIEN0b3IgaW5zdGFuY2VvZiBDdG9yICYmDQogICAgZnVuY1RvU3RyaW5nLmNhbGwoQ3RvcikgPT0gb2JqZWN0Q3RvclN0cmluZzsNCn0NCg0KLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgbG9kYXNoX2VzX2lzUGxhaW5PYmplY3QgPSAoaXNQbGFpbk9iamVjdCk7DQoNCi8vIEVYVEVSTkFMIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvc3ltYm9sLW9ic2VydmFibGUvZXMvaW5kZXguanMNCnZhciBlcyA9IF9fd2VicGFja19yZXF1aXJlX18oNzUpOw0KDQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWR1eC9lcy9jcmVhdGVTdG9yZS5qcw0KDQoNCg0KLyoqDQogKiBUaGVzZSBhcmUgcHJpdmF0ZSBhY3Rpb24gdHlwZXMgcmVzZXJ2ZWQgYnkgUmVkdXguDQogKiBGb3IgYW55IHVua25vd24gYWN0aW9ucywgeW91IG11c3QgcmV0dXJuIHRoZSBjdXJyZW50IHN0YXRlLg0KICogSWYgdGhlIGN1cnJlbnQgc3RhdGUgaXMgdW5kZWZpbmVkLCB5b3UgbXVzdCByZXR1cm4gdGhlIGluaXRpYWwgc3RhdGUuDQogKiBEbyBub3QgcmVmZXJlbmNlIHRoZXNlIGFjdGlvbiB0eXBlcyBkaXJlY3RseSBpbiB5b3VyIGNvZGUuDQogKi8NCnZhciBBY3Rpb25UeXBlcyA9IHsNCiAgSU5JVDogJ0BAcmVkdXgvSU5JVCcNCg0KICAvKioNCiAgICogQ3JlYXRlcyBhIFJlZHV4IHN0b3JlIHRoYXQgaG9sZHMgdGhlIHN0YXRlIHRyZWUuDQogICAqIFRoZSBvbmx5IHdheSB0byBjaGFuZ2UgdGhlIGRhdGEgaW4gdGhlIHN0b3JlIGlzIHRvIGNhbGwgYGRpc3BhdGNoKClgIG9uIGl0Lg0KICAgKg0KICAgKiBUaGVyZSBzaG91bGQgb25seSBiZSBhIHNpbmdsZSBzdG9yZSBpbiB5b3VyIGFwcC4gVG8gc3BlY2lmeSBob3cgZGlmZmVyZW50DQogICAqIHBhcnRzIG9mIHRoZSBzdGF0ZSB0cmVlIHJlc3BvbmQgdG8gYWN0aW9ucywgeW91IG1heSBjb21iaW5lIHNldmVyYWwgcmVkdWNlcnMNCiAgICogaW50byBhIHNpbmdsZSByZWR1Y2VyIGZ1bmN0aW9uIGJ5IHVzaW5nIGBjb21iaW5lUmVkdWNlcnNgLg0KICAgKg0KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSByZWR1Y2VyIEEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBuZXh0IHN0YXRlIHRyZWUsIGdpdmVuDQogICAqIHRoZSBjdXJyZW50IHN0YXRlIHRyZWUgYW5kIHRoZSBhY3Rpb24gdG8gaGFuZGxlLg0KICAgKg0KICAgKiBAcGFyYW0ge2FueX0gW3ByZWxvYWRlZFN0YXRlXSBUaGUgaW5pdGlhbCBzdGF0ZS4gWW91IG1heSBvcHRpb25hbGx5IHNwZWNpZnkgaXQNCiAgICogdG8gaHlkcmF0ZSB0aGUgc3RhdGUgZnJvbSB0aGUgc2VydmVyIGluIHVuaXZlcnNhbCBhcHBzLCBvciB0byByZXN0b3JlIGENCiAgICogcHJldmlvdXNseSBzZXJpYWxpemVkIHVzZXIgc2Vzc2lvbi4NCiAgICogSWYgeW91IHVzZSBgY29tYmluZVJlZHVjZXJzYCB0byBwcm9kdWNlIHRoZSByb290IHJlZHVjZXIgZnVuY3Rpb24sIHRoaXMgbXVzdCBiZQ0KICAgKiBhbiBvYmplY3Qgd2l0aCB0aGUgc2FtZSBzaGFwZSBhcyBgY29tYmluZVJlZHVjZXJzYCBrZXlzLg0KICAgKg0KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbZW5oYW5jZXJdIFRoZSBzdG9yZSBlbmhhbmNlci4gWW91IG1heSBvcHRpb25hbGx5IHNwZWNpZnkgaXQNCiAgICogdG8gZW5oYW5jZSB0aGUgc3RvcmUgd2l0aCB0aGlyZC1wYXJ0eSBjYXBhYmlsaXRpZXMgc3VjaCBhcyBtaWRkbGV3YXJlLA0KICAgKiB0aW1lIHRyYXZlbCwgcGVyc2lzdGVuY2UsIGV0Yy4gVGhlIG9ubHkgc3RvcmUgZW5oYW5jZXIgdGhhdCBzaGlwcyB3aXRoIFJlZHV4DQogICAqIGlzIGBhcHBseU1pZGRsZXdhcmUoKWAuDQogICAqDQogICAqIEByZXR1cm5zIHtTdG9yZX0gQSBSZWR1eCBzdG9yZSB0aGF0IGxldHMgeW91IHJlYWQgdGhlIHN0YXRlLCBkaXNwYXRjaCBhY3Rpb25zDQogICAqIGFuZCBzdWJzY3JpYmUgdG8gY2hhbmdlcy4NCiAgICovDQp9O2Z1bmN0aW9uIGNyZWF0ZVN0b3JlX2NyZWF0ZVN0b3JlKHJlZHVjZXIsIHByZWxvYWRlZFN0YXRlLCBlbmhhbmNlcikgew0KICB2YXIgX3JlZjI7DQoNCiAgaWYgKHR5cGVvZiBwcmVsb2FkZWRTdGF0ZSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgZW5oYW5jZXIgPT09ICd1bmRlZmluZWQnKSB7DQogICAgZW5oYW5jZXIgPSBwcmVsb2FkZWRTdGF0ZTsNCiAgICBwcmVsb2FkZWRTdGF0ZSA9IHVuZGVmaW5lZDsNCiAgfQ0KDQogIGlmICh0eXBlb2YgZW5oYW5jZXIgIT09ICd1bmRlZmluZWQnKSB7DQogICAgaWYgKHR5cGVvZiBlbmhhbmNlciAhPT0gJ2Z1bmN0aW9uJykgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCB0aGUgZW5oYW5jZXIgdG8gYmUgYSBmdW5jdGlvbi4nKTsNCiAgICB9DQoNCiAgICByZXR1cm4gZW5oYW5jZXIoY3JlYXRlU3RvcmVfY3JlYXRlU3RvcmUpKHJlZHVjZXIsIHByZWxvYWRlZFN0YXRlKTsNCiAgfQ0KDQogIGlmICh0eXBlb2YgcmVkdWNlciAhPT0gJ2Z1bmN0aW9uJykgew0KICAgIHRocm93IG5ldyBFcnJvcignRXhwZWN0ZWQgdGhlIHJlZHVjZXIgdG8gYmUgYSBmdW5jdGlvbi4nKTsNCiAgfQ0KDQogIHZhciBjdXJyZW50UmVkdWNlciA9IHJlZHVjZXI7DQogIHZhciBjdXJyZW50U3RhdGUgPSBwcmVsb2FkZWRTdGF0ZTsNCiAgdmFyIGN1cnJlbnRMaXN0ZW5lcnMgPSBbXTsNCiAgdmFyIG5leHRMaXN0ZW5lcnMgPSBjdXJyZW50TGlzdGVuZXJzOw0KICB2YXIgaXNEaXNwYXRjaGluZyA9IGZhbHNlOw0KDQogIGZ1bmN0aW9uIGVuc3VyZUNhbk11dGF0ZU5leHRMaXN0ZW5lcnMoKSB7DQogICAgaWYgKG5leHRMaXN0ZW5lcnMgPT09IGN1cnJlbnRMaXN0ZW5lcnMpIHsNCiAgICAgIG5leHRMaXN0ZW5lcnMgPSBjdXJyZW50TGlzdGVuZXJzLnNsaWNlKCk7DQogICAgfQ0KICB9DQoNCiAgLyoqDQogICAqIFJlYWRzIHRoZSBzdGF0ZSB0cmVlIG1hbmFnZWQgYnkgdGhlIHN0b3JlLg0KICAgKg0KICAgKiBAcmV0dXJucyB7YW55fSBUaGUgY3VycmVudCBzdGF0ZSB0cmVlIG9mIHlvdXIgYXBwbGljYXRpb24uDQogICAqLw0KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHsNCiAgICByZXR1cm4gY3VycmVudFN0YXRlOw0KICB9DQoNCiAgLyoqDQogICAqIEFkZHMgYSBjaGFuZ2UgbGlzdGVuZXIuIEl0IHdpbGwgYmUgY2FsbGVkIGFueSB0aW1lIGFuIGFjdGlvbiBpcyBkaXNwYXRjaGVkLA0KICAgKiBhbmQgc29tZSBwYXJ0IG9mIHRoZSBzdGF0ZSB0cmVlIG1heSBwb3RlbnRpYWxseSBoYXZlIGNoYW5nZWQuIFlvdSBtYXkgdGhlbg0KICAgKiBjYWxsIGBnZXRTdGF0ZSgpYCB0byByZWFkIHRoZSBjdXJyZW50IHN0YXRlIHRyZWUgaW5zaWRlIHRoZSBjYWxsYmFjay4NCiAgICoNCiAgICogWW91IG1heSBjYWxsIGBkaXNwYXRjaCgpYCBmcm9tIGEgY2hhbmdlIGxpc3RlbmVyLCB3aXRoIHRoZSBmb2xsb3dpbmcNCiAgICogY2F2ZWF0czoNCiAgICoNCiAgICogMS4gVGhlIHN1YnNjcmlwdGlvbnMgYXJlIHNuYXBzaG90dGVkIGp1c3QgYmVmb3JlIGV2ZXJ5IGBkaXNwYXRjaCgpYCBjYWxsLg0KICAgKiBJZiB5b3Ugc3Vic2NyaWJlIG9yIHVuc3Vic2NyaWJlIHdoaWxlIHRoZSBsaXN0ZW5lcnMgYXJlIGJlaW5nIGludm9rZWQsIHRoaXMNCiAgICogd2lsbCBub3QgaGF2ZSBhbnkgZWZmZWN0IG9uIHRoZSBgZGlzcGF0Y2goKWAgdGhhdCBpcyBjdXJyZW50bHkgaW4gcHJvZ3Jlc3MuDQogICAqIEhvd2V2ZXIsIHRoZSBuZXh0IGBkaXNwYXRjaCgpYCBjYWxsLCB3aGV0aGVyIG5lc3RlZCBvciBub3QsIHdpbGwgdXNlIGEgbW9yZQ0KICAgKiByZWNlbnQgc25hcHNob3Qgb2YgdGhlIHN1YnNjcmlwdGlvbiBsaXN0Lg0KICAgKg0KICAgKiAyLiBUaGUgbGlzdGVuZXIgc2hvdWxkIG5vdCBleHBlY3QgdG8gc2VlIGFsbCBzdGF0ZSBjaGFuZ2VzLCBhcyB0aGUgc3RhdGUNCiAgICogbWlnaHQgaGF2ZSBiZWVuIHVwZGF0ZWQgbXVsdGlwbGUgdGltZXMgZHVyaW5nIGEgbmVzdGVkIGBkaXNwYXRjaCgpYCBiZWZvcmUNCiAgICogdGhlIGxpc3RlbmVyIGlzIGNhbGxlZC4gSXQgaXMsIGhvd2V2ZXIsIGd1YXJhbnRlZWQgdGhhdCBhbGwgc3Vic2NyaWJlcnMNCiAgICogcmVnaXN0ZXJlZCBiZWZvcmUgdGhlIGBkaXNwYXRjaCgpYCBzdGFydGVkIHdpbGwgYmUgY2FsbGVkIHdpdGggdGhlIGxhdGVzdA0KICAgKiBzdGF0ZSBieSB0aGUgdGltZSBpdCBleGl0cy4NCiAgICoNCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIgQSBjYWxsYmFjayB0byBiZSBpbnZva2VkIG9uIGV2ZXJ5IGRpc3BhdGNoLg0KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgZnVuY3Rpb24gdG8gcmVtb3ZlIHRoaXMgY2hhbmdlIGxpc3RlbmVyLg0KICAgKi8NCiAgZnVuY3Rpb24gc3Vic2NyaWJlKGxpc3RlbmVyKSB7DQogICAgaWYgKHR5cGVvZiBsaXN0ZW5lciAhPT0gJ2Z1bmN0aW9uJykgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCBsaXN0ZW5lciB0byBiZSBhIGZ1bmN0aW9uLicpOw0KICAgIH0NCg0KICAgIHZhciBpc1N1YnNjcmliZWQgPSB0cnVlOw0KDQogICAgZW5zdXJlQ2FuTXV0YXRlTmV4dExpc3RlbmVycygpOw0KICAgIG5leHRMaXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7DQoNCiAgICByZXR1cm4gZnVuY3Rpb24gdW5zdWJzY3JpYmUoKSB7DQogICAgICBpZiAoIWlzU3Vic2NyaWJlZCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIGlzU3Vic2NyaWJlZCA9IGZhbHNlOw0KDQogICAgICBlbnN1cmVDYW5NdXRhdGVOZXh0TGlzdGVuZXJzKCk7DQogICAgICB2YXIgaW5kZXggPSBuZXh0TGlzdGVuZXJzLmluZGV4T2YobGlzdGVuZXIpOw0KICAgICAgbmV4dExpc3RlbmVycy5zcGxpY2UoaW5kZXgsIDEpOw0KICAgIH07DQogIH0NCg0KICAvKioNCiAgICogRGlzcGF0Y2hlcyBhbiBhY3Rpb24uIEl0IGlzIHRoZSBvbmx5IHdheSB0byB0cmlnZ2VyIGEgc3RhdGUgY2hhbmdlLg0KICAgKg0KICAgKiBUaGUgYHJlZHVjZXJgIGZ1bmN0aW9uLCB1c2VkIHRvIGNyZWF0ZSB0aGUgc3RvcmUsIHdpbGwgYmUgY2FsbGVkIHdpdGggdGhlDQogICAqIGN1cnJlbnQgc3RhdGUgdHJlZSBhbmQgdGhlIGdpdmVuIGBhY3Rpb25gLiBJdHMgcmV0dXJuIHZhbHVlIHdpbGwNCiAgICogYmUgY29uc2lkZXJlZCB0aGUgKipuZXh0Kiogc3RhdGUgb2YgdGhlIHRyZWUsIGFuZCB0aGUgY2hhbmdlIGxpc3RlbmVycw0KICAgKiB3aWxsIGJlIG5vdGlmaWVkLg0KICAgKg0KICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvbmx5IHN1cHBvcnRzIHBsYWluIG9iamVjdCBhY3Rpb25zLiBJZiB5b3Ugd2FudCB0bw0KICAgKiBkaXNwYXRjaCBhIFByb21pc2UsIGFuIE9ic2VydmFibGUsIGEgdGh1bmssIG9yIHNvbWV0aGluZyBlbHNlLCB5b3UgbmVlZCB0bw0KICAgKiB3cmFwIHlvdXIgc3RvcmUgY3JlYXRpbmcgZnVuY3Rpb24gaW50byB0aGUgY29ycmVzcG9uZGluZyBtaWRkbGV3YXJlLiBGb3INCiAgICogZXhhbXBsZSwgc2VlIHRoZSBkb2N1bWVudGF0aW9uIGZvciB0aGUgYHJlZHV4LXRodW5rYCBwYWNrYWdlLiBFdmVuIHRoZQ0KICAgKiBtaWRkbGV3YXJlIHdpbGwgZXZlbnR1YWxseSBkaXNwYXRjaCBwbGFpbiBvYmplY3QgYWN0aW9ucyB1c2luZyB0aGlzIG1ldGhvZC4NCiAgICoNCiAgICogQHBhcmFtIHtPYmplY3R9IGFjdGlvbiBBIHBsYWluIG9iamVjdCByZXByZXNlbnRpbmcg4oCcd2hhdCBjaGFuZ2Vk4oCdLiBJdCBpcw0KICAgKiBhIGdvb2QgaWRlYSB0byBrZWVwIGFjdGlvbnMgc2VyaWFsaXphYmxlIHNvIHlvdSBjYW4gcmVjb3JkIGFuZCByZXBsYXkgdXNlcg0KICAgKiBzZXNzaW9ucywgb3IgdXNlIHRoZSB0aW1lIHRyYXZlbGxpbmcgYHJlZHV4LWRldnRvb2xzYC4gQW4gYWN0aW9uIG11c3QgaGF2ZQ0KICAgKiBhIGB0eXBlYCBwcm9wZXJ0eSB3aGljaCBtYXkgbm90IGJlIGB1bmRlZmluZWRgLiBJdCBpcyBhIGdvb2QgaWRlYSB0byB1c2UNCiAgICogc3RyaW5nIGNvbnN0YW50cyBmb3IgYWN0aW9uIHR5cGVzLg0KICAgKg0KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBGb3IgY29udmVuaWVuY2UsIHRoZSBzYW1lIGFjdGlvbiBvYmplY3QgeW91IGRpc3BhdGNoZWQuDQogICAqDQogICAqIE5vdGUgdGhhdCwgaWYgeW91IHVzZSBhIGN1c3RvbSBtaWRkbGV3YXJlLCBpdCBtYXkgd3JhcCBgZGlzcGF0Y2goKWAgdG8NCiAgICogcmV0dXJuIHNvbWV0aGluZyBlbHNlIChmb3IgZXhhbXBsZSwgYSBQcm9taXNlIHlvdSBjYW4gYXdhaXQpLg0KICAgKi8NCiAgZnVuY3Rpb24gZGlzcGF0Y2goYWN0aW9uKSB7DQogICAgaWYgKCFsb2Rhc2hfZXNfaXNQbGFpbk9iamVjdChhY3Rpb24pKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FjdGlvbnMgbXVzdCBiZSBwbGFpbiBvYmplY3RzLiAnICsgJ1VzZSBjdXN0b20gbWlkZGxld2FyZSBmb3IgYXN5bmMgYWN0aW9ucy4nKTsNCiAgICB9DQoNCiAgICBpZiAodHlwZW9mIGFjdGlvbi50eXBlID09PSAndW5kZWZpbmVkJykgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCdBY3Rpb25zIG1heSBub3QgaGF2ZSBhbiB1bmRlZmluZWQgInR5cGUiIHByb3BlcnR5LiAnICsgJ0hhdmUgeW91IG1pc3NwZWxsZWQgYSBjb25zdGFudD8nKTsNCiAgICB9DQoNCiAgICBpZiAoaXNEaXNwYXRjaGluZykgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZWR1Y2VycyBtYXkgbm90IGRpc3BhdGNoIGFjdGlvbnMuJyk7DQogICAgfQ0KDQogICAgdHJ5IHsNCiAgICAgIGlzRGlzcGF0Y2hpbmcgPSB0cnVlOw0KICAgICAgY3VycmVudFN0YXRlID0gY3VycmVudFJlZHVjZXIoY3VycmVudFN0YXRlLCBhY3Rpb24pOw0KICAgIH0gZmluYWxseSB7DQogICAgICBpc0Rpc3BhdGNoaW5nID0gZmFsc2U7DQogICAgfQ0KDQogICAgdmFyIGxpc3RlbmVycyA9IGN1cnJlbnRMaXN0ZW5lcnMgPSBuZXh0TGlzdGVuZXJzOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdGVuZXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIgbGlzdGVuZXIgPSBsaXN0ZW5lcnNbaV07DQogICAgICBsaXN0ZW5lcigpOw0KICAgIH0NCg0KICAgIHJldHVybiBhY3Rpb247DQogIH0NCg0KICAvKioNCiAgICogUmVwbGFjZXMgdGhlIHJlZHVjZXIgY3VycmVudGx5IHVzZWQgYnkgdGhlIHN0b3JlIHRvIGNhbGN1bGF0ZSB0aGUgc3RhdGUuDQogICAqDQogICAqIFlvdSBtaWdodCBuZWVkIHRoaXMgaWYgeW91ciBhcHAgaW1wbGVtZW50cyBjb2RlIHNwbGl0dGluZyBhbmQgeW91IHdhbnQgdG8NCiAgICogbG9hZCBzb21lIG9mIHRoZSByZWR1Y2VycyBkeW5hbWljYWxseS4gWW91IG1pZ2h0IGFsc28gbmVlZCB0aGlzIGlmIHlvdQ0KICAgKiBpbXBsZW1lbnQgYSBob3QgcmVsb2FkaW5nIG1lY2hhbmlzbSBmb3IgUmVkdXguDQogICAqDQogICAqIEBwYXJhbSB7RnVuY3Rpb259IG5leHRSZWR1Y2VyIFRoZSByZWR1Y2VyIGZvciB0aGUgc3RvcmUgdG8gdXNlIGluc3RlYWQuDQogICAqIEByZXR1cm5zIHt2b2lkfQ0KICAgKi8NCiAgZnVuY3Rpb24gcmVwbGFjZVJlZHVjZXIobmV4dFJlZHVjZXIpIHsNCiAgICBpZiAodHlwZW9mIG5leHRSZWR1Y2VyICE9PSAnZnVuY3Rpb24nKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIHRoZSBuZXh0UmVkdWNlciB0byBiZSBhIGZ1bmN0aW9uLicpOw0KICAgIH0NCg0KICAgIGN1cnJlbnRSZWR1Y2VyID0gbmV4dFJlZHVjZXI7DQogICAgZGlzcGF0Y2goeyB0eXBlOiBBY3Rpb25UeXBlcy5JTklUIH0pOw0KICB9DQoNCiAgLyoqDQogICAqIEludGVyb3BlcmFiaWxpdHkgcG9pbnQgZm9yIG9ic2VydmFibGUvcmVhY3RpdmUgbGlicmFyaWVzLg0KICAgKiBAcmV0dXJucyB7b2JzZXJ2YWJsZX0gQSBtaW5pbWFsIG9ic2VydmFibGUgb2Ygc3RhdGUgY2hhbmdlcy4NCiAgICogRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZSB0aGUgb2JzZXJ2YWJsZSBwcm9wb3NhbDoNCiAgICogaHR0cHM6Ly9naXRodWIuY29tL3RjMzkvcHJvcG9zYWwtb2JzZXJ2YWJsZQ0KICAgKi8NCiAgZnVuY3Rpb24gb2JzZXJ2YWJsZSgpIHsNCiAgICB2YXIgX3JlZjsNCg0KICAgIHZhciBvdXRlclN1YnNjcmliZSA9IHN1YnNjcmliZTsNCiAgICByZXR1cm4gX3JlZiA9IHsNCiAgICAgIC8qKg0KICAgICAgICogVGhlIG1pbmltYWwgb2JzZXJ2YWJsZSBzdWJzY3JpcHRpb24gbWV0aG9kLg0KICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9ic2VydmVyIEFueSBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCBhcyBhbiBvYnNlcnZlci4NCiAgICAgICAqIFRoZSBvYnNlcnZlciBvYmplY3Qgc2hvdWxkIGhhdmUgYSBgbmV4dGAgbWV0aG9kLg0KICAgICAgICogQHJldHVybnMge3N1YnNjcmlwdGlvbn0gQW4gb2JqZWN0IHdpdGggYW4gYHVuc3Vic2NyaWJlYCBtZXRob2QgdGhhdCBjYW4NCiAgICAgICAqIGJlIHVzZWQgdG8gdW5zdWJzY3JpYmUgdGhlIG9ic2VydmFibGUgZnJvbSB0aGUgc3RvcmUsIGFuZCBwcmV2ZW50IGZ1cnRoZXINCiAgICAgICAqIGVtaXNzaW9uIG9mIHZhbHVlcyBmcm9tIHRoZSBvYnNlcnZhYmxlLg0KICAgICAgICovDQogICAgICBzdWJzY3JpYmU6IGZ1bmN0aW9uIHN1YnNjcmliZShvYnNlcnZlcikgew0KICAgICAgICBpZiAodHlwZW9mIG9ic2VydmVyICE9PSAnb2JqZWN0Jykgew0KICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkIHRoZSBvYnNlcnZlciB0byBiZSBhbiBvYmplY3QuJyk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBvYnNlcnZlU3RhdGUoKSB7DQogICAgICAgICAgaWYgKG9ic2VydmVyLm5leHQpIHsNCiAgICAgICAgICAgIG9ic2VydmVyLm5leHQoZ2V0U3RhdGUoKSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgb2JzZXJ2ZVN0YXRlKCk7DQogICAgICAgIHZhciB1bnN1YnNjcmliZSA9IG91dGVyU3Vic2NyaWJlKG9ic2VydmVTdGF0ZSk7DQogICAgICAgIHJldHVybiB7IHVuc3Vic2NyaWJlOiB1bnN1YnNjcmliZSB9Ow0KICAgICAgfQ0KICAgIH0sIF9yZWZbZXNbImEiIC8qIGRlZmF1bHQgKi9dXSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0sIF9yZWY7DQogIH0NCg0KICAvLyBXaGVuIGEgc3RvcmUgaXMgY3JlYXRlZCwgYW4gIklOSVQiIGFjdGlvbiBpcyBkaXNwYXRjaGVkIHNvIHRoYXQgZXZlcnkNCiAgLy8gcmVkdWNlciByZXR1cm5zIHRoZWlyIGluaXRpYWwgc3RhdGUuIFRoaXMgZWZmZWN0aXZlbHkgcG9wdWxhdGVzDQogIC8vIHRoZSBpbml0aWFsIHN0YXRlIHRyZWUuDQogIGRpc3BhdGNoKHsgdHlwZTogQWN0aW9uVHlwZXMuSU5JVCB9KTsNCg0KICByZXR1cm4gX3JlZjIgPSB7DQogICAgZGlzcGF0Y2g6IGRpc3BhdGNoLA0KICAgIHN1YnNjcmliZTogc3Vic2NyaWJlLA0KICAgIGdldFN0YXRlOiBnZXRTdGF0ZSwNCiAgICByZXBsYWNlUmVkdWNlcjogcmVwbGFjZVJlZHVjZXINCiAgfSwgX3JlZjJbZXNbImEiIC8qIGRlZmF1bHQgKi9dXSA9IG9ic2VydmFibGUsIF9yZWYyOw0KfQ0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVkdXgvZXMvdXRpbHMvd2FybmluZy5qcw0KLyoqDQogKiBQcmludHMgYSB3YXJuaW5nIGluIHRoZSBjb25zb2xlIGlmIGl0IGV4aXN0cy4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZSBUaGUgd2FybmluZyBtZXNzYWdlLg0KICogQHJldHVybnMge3ZvaWR9DQogKi8NCmZ1bmN0aW9uIHdhcm5pbmdfd2FybmluZyhtZXNzYWdlKSB7DQogIC8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi8NCiAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgY29uc29sZS5lcnJvciA9PT0gJ2Z1bmN0aW9uJykgew0KICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7DQogIH0NCiAgLyogZXNsaW50LWVuYWJsZSBuby1jb25zb2xlICovDQogIHRyeSB7DQogICAgLy8gVGhpcyBlcnJvciB3YXMgdGhyb3duIGFzIGEgY29udmVuaWVuY2Ugc28gdGhhdCBpZiB5b3UgZW5hYmxlDQogICAgLy8gImJyZWFrIG9uIGFsbCBleGNlcHRpb25zIiBpbiB5b3VyIGNvbnNvbGUsDQogICAgLy8gaXQgd291bGQgcGF1c2UgdGhlIGV4ZWN1dGlvbiBhdCB0aGlzIGxpbmUuDQogICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOw0KICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWVtcHR5ICovDQogIH0gY2F0Y2ggKGUpIHt9DQogIC8qIGVzbGludC1lbmFibGUgbm8tZW1wdHkgKi8NCn0NCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlZHV4L2VzL2NvbWJpbmVSZWR1Y2Vycy5qcw0KDQoNCg0KDQpmdW5jdGlvbiBnZXRVbmRlZmluZWRTdGF0ZUVycm9yTWVzc2FnZShrZXksIGFjdGlvbikgew0KICB2YXIgYWN0aW9uVHlwZSA9IGFjdGlvbiAmJiBhY3Rpb24udHlwZTsNCiAgdmFyIGFjdGlvbk5hbWUgPSBhY3Rpb25UeXBlICYmICciJyArIGFjdGlvblR5cGUudG9TdHJpbmcoKSArICciJyB8fCAnYW4gYWN0aW9uJzsNCg0KICByZXR1cm4gJ0dpdmVuIGFjdGlvbiAnICsgYWN0aW9uTmFtZSArICcsIHJlZHVjZXIgIicgKyBrZXkgKyAnIiByZXR1cm5lZCB1bmRlZmluZWQuICcgKyAnVG8gaWdub3JlIGFuIGFjdGlvbiwgeW91IG11c3QgZXhwbGljaXRseSByZXR1cm4gdGhlIHByZXZpb3VzIHN0YXRlLiAnICsgJ0lmIHlvdSB3YW50IHRoaXMgcmVkdWNlciB0byBob2xkIG5vIHZhbHVlLCB5b3UgY2FuIHJldHVybiBudWxsIGluc3RlYWQgb2YgdW5kZWZpbmVkLic7DQp9DQoNCmZ1bmN0aW9uIGdldFVuZXhwZWN0ZWRTdGF0ZVNoYXBlV2FybmluZ01lc3NhZ2UoaW5wdXRTdGF0ZSwgcmVkdWNlcnMsIGFjdGlvbiwgdW5leHBlY3RlZEtleUNhY2hlKSB7DQogIHZhciByZWR1Y2VyS2V5cyA9IE9iamVjdC5rZXlzKHJlZHVjZXJzKTsNCiAgdmFyIGFyZ3VtZW50TmFtZSA9IGFjdGlvbiAmJiBhY3Rpb24udHlwZSA9PT0gQWN0aW9uVHlwZXMuSU5JVCA/ICdwcmVsb2FkZWRTdGF0ZSBhcmd1bWVudCBwYXNzZWQgdG8gY3JlYXRlU3RvcmUnIDogJ3ByZXZpb3VzIHN0YXRlIHJlY2VpdmVkIGJ5IHRoZSByZWR1Y2VyJzsNCg0KICBpZiAocmVkdWNlcktleXMubGVuZ3RoID09PSAwKSB7DQogICAgcmV0dXJuICdTdG9yZSBkb2VzIG5vdCBoYXZlIGEgdmFsaWQgcmVkdWNlci4gTWFrZSBzdXJlIHRoZSBhcmd1bWVudCBwYXNzZWQgJyArICd0byBjb21iaW5lUmVkdWNlcnMgaXMgYW4gb2JqZWN0IHdob3NlIHZhbHVlcyBhcmUgcmVkdWNlcnMuJzsNCiAgfQ0KDQogIGlmICghbG9kYXNoX2VzX2lzUGxhaW5PYmplY3QoaW5wdXRTdGF0ZSkpIHsNCiAgICByZXR1cm4gJ1RoZSAnICsgYXJndW1lbnROYW1lICsgJyBoYXMgdW5leHBlY3RlZCB0eXBlIG9mICInICsge30udG9TdHJpbmcuY2FsbChpbnB1dFN0YXRlKS5tYXRjaCgvXHMoW2EtenxBLVpdKykvKVsxXSArICciLiBFeHBlY3RlZCBhcmd1bWVudCB0byBiZSBhbiBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nICcgKyAoJ2tleXM6ICInICsgcmVkdWNlcktleXMuam9pbignIiwgIicpICsgJyInKTsNCiAgfQ0KDQogIHZhciB1bmV4cGVjdGVkS2V5cyA9IE9iamVjdC5rZXlzKGlucHV0U3RhdGUpLmZpbHRlcihmdW5jdGlvbiAoa2V5KSB7DQogICAgcmV0dXJuICFyZWR1Y2Vycy5oYXNPd25Qcm9wZXJ0eShrZXkpICYmICF1bmV4cGVjdGVkS2V5Q2FjaGVba2V5XTsNCiAgfSk7DQoNCiAgdW5leHBlY3RlZEtleXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7DQogICAgdW5leHBlY3RlZEtleUNhY2hlW2tleV0gPSB0cnVlOw0KICB9KTsNCg0KICBpZiAodW5leHBlY3RlZEtleXMubGVuZ3RoID4gMCkgew0KICAgIHJldHVybiAnVW5leHBlY3RlZCAnICsgKHVuZXhwZWN0ZWRLZXlzLmxlbmd0aCA+IDEgPyAna2V5cycgOiAna2V5JykgKyAnICcgKyAoJyInICsgdW5leHBlY3RlZEtleXMuam9pbignIiwgIicpICsgJyIgZm91bmQgaW4gJyArIGFyZ3VtZW50TmFtZSArICcuICcpICsgJ0V4cGVjdGVkIHRvIGZpbmQgb25lIG9mIHRoZSBrbm93biByZWR1Y2VyIGtleXMgaW5zdGVhZDogJyArICgnIicgKyByZWR1Y2VyS2V5cy5qb2luKCciLCAiJykgKyAnIi4gVW5leHBlY3RlZCBrZXlzIHdpbGwgYmUgaWdub3JlZC4nKTsNCiAgfQ0KfQ0KDQpmdW5jdGlvbiBhc3NlcnRSZWR1Y2VyU2hhcGUocmVkdWNlcnMpIHsNCiAgT2JqZWN0LmtleXMocmVkdWNlcnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgew0KICAgIHZhciByZWR1Y2VyID0gcmVkdWNlcnNba2V5XTsNCiAgICB2YXIgaW5pdGlhbFN0YXRlID0gcmVkdWNlcih1bmRlZmluZWQsIHsgdHlwZTogQWN0aW9uVHlwZXMuSU5JVCB9KTsNCg0KICAgIGlmICh0eXBlb2YgaW5pdGlhbFN0YXRlID09PSAndW5kZWZpbmVkJykgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZWR1Y2VyICInICsga2V5ICsgJyIgcmV0dXJuZWQgdW5kZWZpbmVkIGR1cmluZyBpbml0aWFsaXphdGlvbi4gJyArICdJZiB0aGUgc3RhdGUgcGFzc2VkIHRvIHRoZSByZWR1Y2VyIGlzIHVuZGVmaW5lZCwgeW91IG11c3QgJyArICdleHBsaWNpdGx5IHJldHVybiB0aGUgaW5pdGlhbCBzdGF0ZS4gVGhlIGluaXRpYWwgc3RhdGUgbWF5ICcgKyAnbm90IGJlIHVuZGVmaW5lZC4gSWYgeW91IGRvblwndCB3YW50IHRvIHNldCBhIHZhbHVlIGZvciB0aGlzIHJlZHVjZXIsICcgKyAneW91IGNhbiB1c2UgbnVsbCBpbnN0ZWFkIG9mIHVuZGVmaW5lZC4nKTsNCiAgICB9DQoNCiAgICB2YXIgdHlwZSA9ICdAQHJlZHV4L1BST0JFX1VOS05PV05fQUNUSU9OXycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoNykuc3BsaXQoJycpLmpvaW4oJy4nKTsNCiAgICBpZiAodHlwZW9mIHJlZHVjZXIodW5kZWZpbmVkLCB7IHR5cGU6IHR5cGUgfSkgPT09ICd1bmRlZmluZWQnKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZHVjZXIgIicgKyBrZXkgKyAnIiByZXR1cm5lZCB1bmRlZmluZWQgd2hlbiBwcm9iZWQgd2l0aCBhIHJhbmRvbSB0eXBlLiAnICsgKCdEb25cJ3QgdHJ5IHRvIGhhbmRsZSAnICsgQWN0aW9uVHlwZXMuSU5JVCArICcgb3Igb3RoZXIgYWN0aW9ucyBpbiAicmVkdXgvKiIgJykgKyAnbmFtZXNwYWNlLiBUaGV5IGFyZSBjb25zaWRlcmVkIHByaXZhdGUuIEluc3RlYWQsIHlvdSBtdXN0IHJldHVybiB0aGUgJyArICdjdXJyZW50IHN0YXRlIGZvciBhbnkgdW5rbm93biBhY3Rpb25zLCB1bmxlc3MgaXQgaXMgdW5kZWZpbmVkLCAnICsgJ2luIHdoaWNoIGNhc2UgeW91IG11c3QgcmV0dXJuIHRoZSBpbml0aWFsIHN0YXRlLCByZWdhcmRsZXNzIG9mIHRoZSAnICsgJ2FjdGlvbiB0eXBlLiBUaGUgaW5pdGlhbCBzdGF0ZSBtYXkgbm90IGJlIHVuZGVmaW5lZCwgYnV0IGNhbiBiZSBudWxsLicpOw0KICAgIH0NCiAgfSk7DQp9DQoNCi8qKg0KICogVHVybnMgYW4gb2JqZWN0IHdob3NlIHZhbHVlcyBhcmUgZGlmZmVyZW50IHJlZHVjZXIgZnVuY3Rpb25zLCBpbnRvIGEgc2luZ2xlDQogKiByZWR1Y2VyIGZ1bmN0aW9uLiBJdCB3aWxsIGNhbGwgZXZlcnkgY2hpbGQgcmVkdWNlciwgYW5kIGdhdGhlciB0aGVpciByZXN1bHRzDQogKiBpbnRvIGEgc2luZ2xlIHN0YXRlIG9iamVjdCwgd2hvc2Uga2V5cyBjb3JyZXNwb25kIHRvIHRoZSBrZXlzIG9mIHRoZSBwYXNzZWQNCiAqIHJlZHVjZXIgZnVuY3Rpb25zLg0KICoNCiAqIEBwYXJhbSB7T2JqZWN0fSByZWR1Y2VycyBBbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGNvcnJlc3BvbmQgdG8gZGlmZmVyZW50DQogKiByZWR1Y2VyIGZ1bmN0aW9ucyB0aGF0IG5lZWQgdG8gYmUgY29tYmluZWQgaW50byBvbmUuIE9uZSBoYW5keSB3YXkgdG8gb2J0YWluDQogKiBpdCBpcyB0byB1c2UgRVM2IGBpbXBvcnQgKiBhcyByZWR1Y2Vyc2Agc3ludGF4LiBUaGUgcmVkdWNlcnMgbWF5IG5ldmVyIHJldHVybg0KICogdW5kZWZpbmVkIGZvciBhbnkgYWN0aW9uLiBJbnN0ZWFkLCB0aGV5IHNob3VsZCByZXR1cm4gdGhlaXIgaW5pdGlhbCBzdGF0ZQ0KICogaWYgdGhlIHN0YXRlIHBhc3NlZCB0byB0aGVtIHdhcyB1bmRlZmluZWQsIGFuZCB0aGUgY3VycmVudCBzdGF0ZSBmb3IgYW55DQogKiB1bnJlY29nbml6ZWQgYWN0aW9uLg0KICoNCiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSByZWR1Y2VyIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBldmVyeSByZWR1Y2VyIGluc2lkZSB0aGUNCiAqIHBhc3NlZCBvYmplY3QsIGFuZCBidWlsZHMgYSBzdGF0ZSBvYmplY3Qgd2l0aCB0aGUgc2FtZSBzaGFwZS4NCiAqLw0KZnVuY3Rpb24gY29tYmluZVJlZHVjZXJzKHJlZHVjZXJzKSB7DQogIHZhciByZWR1Y2VyS2V5cyA9IE9iamVjdC5rZXlzKHJlZHVjZXJzKTsNCiAgdmFyIGZpbmFsUmVkdWNlcnMgPSB7fTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCByZWR1Y2VyS2V5cy5sZW5ndGg7IGkrKykgew0KICAgIHZhciBrZXkgPSByZWR1Y2VyS2V5c1tpXTsNCg0KICAgIGlmIChmYWxzZSkgew0KICAgICAgaWYgKHR5cGVvZiByZWR1Y2Vyc1trZXldID09PSAndW5kZWZpbmVkJykgew0KICAgICAgICB3YXJuaW5nKCdObyByZWR1Y2VyIHByb3ZpZGVkIGZvciBrZXkgIicgKyBrZXkgKyAnIicpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGlmICh0eXBlb2YgcmVkdWNlcnNba2V5XSA9PT0gJ2Z1bmN0aW9uJykgew0KICAgICAgZmluYWxSZWR1Y2Vyc1trZXldID0gcmVkdWNlcnNba2V5XTsNCiAgICB9DQogIH0NCiAgdmFyIGZpbmFsUmVkdWNlcktleXMgPSBPYmplY3Qua2V5cyhmaW5hbFJlZHVjZXJzKTsNCg0KICB2YXIgdW5leHBlY3RlZEtleUNhY2hlID0gdm9pZCAwOw0KICBpZiAoZmFsc2UpIHsNCiAgICB1bmV4cGVjdGVkS2V5Q2FjaGUgPSB7fTsNCiAgfQ0KDQogIHZhciBzaGFwZUFzc2VydGlvbkVycm9yID0gdm9pZCAwOw0KICB0cnkgew0KICAgIGFzc2VydFJlZHVjZXJTaGFwZShmaW5hbFJlZHVjZXJzKTsNCiAgfSBjYXRjaCAoZSkgew0KICAgIHNoYXBlQXNzZXJ0aW9uRXJyb3IgPSBlOw0KICB9DQoNCiAgcmV0dXJuIGZ1bmN0aW9uIGNvbWJpbmF0aW9uKCkgew0KICAgIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307DQogICAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50c1sxXTsNCg0KICAgIGlmIChzaGFwZUFzc2VydGlvbkVycm9yKSB7DQogICAgICB0aHJvdyBzaGFwZUFzc2VydGlvbkVycm9yOw0KICAgIH0NCg0KICAgIGlmIChmYWxzZSkgew0KICAgICAgdmFyIHdhcm5pbmdNZXNzYWdlID0gZ2V0VW5leHBlY3RlZFN0YXRlU2hhcGVXYXJuaW5nTWVzc2FnZShzdGF0ZSwgZmluYWxSZWR1Y2VycywgYWN0aW9uLCB1bmV4cGVjdGVkS2V5Q2FjaGUpOw0KICAgICAgaWYgKHdhcm5pbmdNZXNzYWdlKSB7DQogICAgICAgIHdhcm5pbmcod2FybmluZ01lc3NhZ2UpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHZhciBoYXNDaGFuZ2VkID0gZmFsc2U7DQogICAgdmFyIG5leHRTdGF0ZSA9IHt9Ow0KICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBmaW5hbFJlZHVjZXJLZXlzLmxlbmd0aDsgX2krKykgew0KICAgICAgdmFyIF9rZXkgPSBmaW5hbFJlZHVjZXJLZXlzW19pXTsNCiAgICAgIHZhciByZWR1Y2VyID0gZmluYWxSZWR1Y2Vyc1tfa2V5XTsNCiAgICAgIHZhciBwcmV2aW91c1N0YXRlRm9yS2V5ID0gc3RhdGVbX2tleV07DQogICAgICB2YXIgbmV4dFN0YXRlRm9yS2V5ID0gcmVkdWNlcihwcmV2aW91c1N0YXRlRm9yS2V5LCBhY3Rpb24pOw0KICAgICAgaWYgKHR5cGVvZiBuZXh0U3RhdGVGb3JLZXkgPT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSBnZXRVbmRlZmluZWRTdGF0ZUVycm9yTWVzc2FnZShfa2V5LCBhY3Rpb24pOw0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNZXNzYWdlKTsNCiAgICAgIH0NCiAgICAgIG5leHRTdGF0ZVtfa2V5XSA9IG5leHRTdGF0ZUZvcktleTsNCiAgICAgIGhhc0NoYW5nZWQgPSBoYXNDaGFuZ2VkIHx8IG5leHRTdGF0ZUZvcktleSAhPT0gcHJldmlvdXNTdGF0ZUZvcktleTsNCiAgICB9DQogICAgcmV0dXJuIGhhc0NoYW5nZWQgPyBuZXh0U3RhdGUgOiBzdGF0ZTsNCiAgfTsNCn0NCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlZHV4L2VzL2JpbmRBY3Rpb25DcmVhdG9ycy5qcw0KZnVuY3Rpb24gYmluZEFjdGlvbkNyZWF0b3IoYWN0aW9uQ3JlYXRvciwgZGlzcGF0Y2gpIHsNCiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gZGlzcGF0Y2goYWN0aW9uQ3JlYXRvci5hcHBseSh1bmRlZmluZWQsIGFyZ3VtZW50cykpOw0KICB9Ow0KfQ0KDQovKioNCiAqIFR1cm5zIGFuIG9iamVjdCB3aG9zZSB2YWx1ZXMgYXJlIGFjdGlvbiBjcmVhdG9ycywgaW50byBhbiBvYmplY3Qgd2l0aCB0aGUNCiAqIHNhbWUga2V5cywgYnV0IHdpdGggZXZlcnkgZnVuY3Rpb24gd3JhcHBlZCBpbnRvIGEgYGRpc3BhdGNoYCBjYWxsIHNvIHRoZXkNCiAqIG1heSBiZSBpbnZva2VkIGRpcmVjdGx5LiBUaGlzIGlzIGp1c3QgYSBjb252ZW5pZW5jZSBtZXRob2QsIGFzIHlvdSBjYW4gY2FsbA0KICogYHN0b3JlLmRpc3BhdGNoKE15QWN0aW9uQ3JlYXRvcnMuZG9Tb21ldGhpbmcoKSlgIHlvdXJzZWxmIGp1c3QgZmluZS4NCiAqDQogKiBGb3IgY29udmVuaWVuY2UsIHlvdSBjYW4gYWxzbyBwYXNzIGEgc2luZ2xlIGZ1bmN0aW9uIGFzIHRoZSBmaXJzdCBhcmd1bWVudCwNCiAqIGFuZCBnZXQgYSBmdW5jdGlvbiBpbiByZXR1cm4uDQogKg0KICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R9IGFjdGlvbkNyZWF0b3JzIEFuIG9iamVjdCB3aG9zZSB2YWx1ZXMgYXJlIGFjdGlvbg0KICogY3JlYXRvciBmdW5jdGlvbnMuIE9uZSBoYW5keSB3YXkgdG8gb2J0YWluIGl0IGlzIHRvIHVzZSBFUzYgYGltcG9ydCAqIGFzYA0KICogc3ludGF4LiBZb3UgbWF5IGFsc28gcGFzcyBhIHNpbmdsZSBmdW5jdGlvbi4NCiAqDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBkaXNwYXRjaCBUaGUgYGRpc3BhdGNoYCBmdW5jdGlvbiBhdmFpbGFibGUgb24geW91ciBSZWR1eA0KICogc3RvcmUuDQogKg0KICogQHJldHVybnMge0Z1bmN0aW9ufE9iamVjdH0gVGhlIG9iamVjdCBtaW1pY2tpbmcgdGhlIG9yaWdpbmFsIG9iamVjdCwgYnV0IHdpdGgNCiAqIGV2ZXJ5IGFjdGlvbiBjcmVhdG9yIHdyYXBwZWQgaW50byB0aGUgYGRpc3BhdGNoYCBjYWxsLiBJZiB5b3UgcGFzc2VkIGENCiAqIGZ1bmN0aW9uIGFzIGBhY3Rpb25DcmVhdG9yc2AsIHRoZSByZXR1cm4gdmFsdWUgd2lsbCBhbHNvIGJlIGEgc2luZ2xlDQogKiBmdW5jdGlvbi4NCiAqLw0KZnVuY3Rpb24gYmluZEFjdGlvbkNyZWF0b3JzKGFjdGlvbkNyZWF0b3JzLCBkaXNwYXRjaCkgew0KICBpZiAodHlwZW9mIGFjdGlvbkNyZWF0b3JzID09PSAnZnVuY3Rpb24nKSB7DQogICAgcmV0dXJuIGJpbmRBY3Rpb25DcmVhdG9yKGFjdGlvbkNyZWF0b3JzLCBkaXNwYXRjaCk7DQogIH0NCg0KICBpZiAodHlwZW9mIGFjdGlvbkNyZWF0b3JzICE9PSAnb2JqZWN0JyB8fCBhY3Rpb25DcmVhdG9ycyA9PT0gbnVsbCkgew0KICAgIHRocm93IG5ldyBFcnJvcignYmluZEFjdGlvbkNyZWF0b3JzIGV4cGVjdGVkIGFuIG9iamVjdCBvciBhIGZ1bmN0aW9uLCBpbnN0ZWFkIHJlY2VpdmVkICcgKyAoYWN0aW9uQ3JlYXRvcnMgPT09IG51bGwgPyAnbnVsbCcgOiB0eXBlb2YgYWN0aW9uQ3JlYXRvcnMpICsgJy4gJyArICdEaWQgeW91IHdyaXRlICJpbXBvcnQgQWN0aW9uQ3JlYXRvcnMgZnJvbSIgaW5zdGVhZCBvZiAiaW1wb3J0ICogYXMgQWN0aW9uQ3JlYXRvcnMgZnJvbSI/Jyk7DQogIH0NCg0KICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKGFjdGlvbkNyZWF0b3JzKTsNCiAgdmFyIGJvdW5kQWN0aW9uQ3JlYXRvcnMgPSB7fTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7DQogICAgdmFyIGtleSA9IGtleXNbaV07DQogICAgdmFyIGFjdGlvbkNyZWF0b3IgPSBhY3Rpb25DcmVhdG9yc1trZXldOw0KICAgIGlmICh0eXBlb2YgYWN0aW9uQ3JlYXRvciA9PT0gJ2Z1bmN0aW9uJykgew0KICAgICAgYm91bmRBY3Rpb25DcmVhdG9yc1trZXldID0gYmluZEFjdGlvbkNyZWF0b3IoYWN0aW9uQ3JlYXRvciwgZGlzcGF0Y2gpOw0KICAgIH0NCiAgfQ0KICByZXR1cm4gYm91bmRBY3Rpb25DcmVhdG9yczsNCn0NCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlZHV4L2VzL2NvbXBvc2UuanMNCi8qKg0KICogQ29tcG9zZXMgc2luZ2xlLWFyZ3VtZW50IGZ1bmN0aW9ucyBmcm9tIHJpZ2h0IHRvIGxlZnQuIFRoZSByaWdodG1vc3QNCiAqIGZ1bmN0aW9uIGNhbiB0YWtlIG11bHRpcGxlIGFyZ3VtZW50cyBhcyBpdCBwcm92aWRlcyB0aGUgc2lnbmF0dXJlIGZvcg0KICogdGhlIHJlc3VsdGluZyBjb21wb3NpdGUgZnVuY3Rpb24uDQogKg0KICogQHBhcmFtIHsuLi5GdW5jdGlvbn0gZnVuY3MgVGhlIGZ1bmN0aW9ucyB0byBjb21wb3NlLg0KICogQHJldHVybnMge0Z1bmN0aW9ufSBBIGZ1bmN0aW9uIG9idGFpbmVkIGJ5IGNvbXBvc2luZyB0aGUgYXJndW1lbnQgZnVuY3Rpb25zDQogKiBmcm9tIHJpZ2h0IHRvIGxlZnQuIEZvciBleGFtcGxlLCBjb21wb3NlKGYsIGcsIGgpIGlzIGlkZW50aWNhbCB0byBkb2luZw0KICogKC4uLmFyZ3MpID0+IGYoZyhoKC4uLmFyZ3MpKSkuDQogKi8NCg0KZnVuY3Rpb24gY29tcG9zZSgpIHsNCiAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGZ1bmNzID0gQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7DQogICAgZnVuY3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07DQogIH0NCg0KICBpZiAoZnVuY3MubGVuZ3RoID09PSAwKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uIChhcmcpIHsNCiAgICAgIHJldHVybiBhcmc7DQogICAgfTsNCiAgfQ0KDQogIGlmIChmdW5jcy5sZW5ndGggPT09IDEpIHsNCiAgICByZXR1cm4gZnVuY3NbMF07DQogIH0NCg0KICByZXR1cm4gZnVuY3MucmVkdWNlKGZ1bmN0aW9uIChhLCBiKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsNCiAgICAgIHJldHVybiBhKGIuYXBwbHkodW5kZWZpbmVkLCBhcmd1bWVudHMpKTsNCiAgICB9Ow0KICB9KTsNCn0NCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlZHV4L2VzL2FwcGx5TWlkZGxld2FyZS5qcw0KdmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTsNCg0KDQoNCi8qKg0KICogQ3JlYXRlcyBhIHN0b3JlIGVuaGFuY2VyIHRoYXQgYXBwbGllcyBtaWRkbGV3YXJlIHRvIHRoZSBkaXNwYXRjaCBtZXRob2QNCiAqIG9mIHRoZSBSZWR1eCBzdG9yZS4gVGhpcyBpcyBoYW5keSBmb3IgYSB2YXJpZXR5IG9mIHRhc2tzLCBzdWNoIGFzIGV4cHJlc3NpbmcNCiAqIGFzeW5jaHJvbm91cyBhY3Rpb25zIGluIGEgY29uY2lzZSBtYW5uZXIsIG9yIGxvZ2dpbmcgZXZlcnkgYWN0aW9uIHBheWxvYWQuDQogKg0KICogU2VlIGByZWR1eC10aHVua2AgcGFja2FnZSBhcyBhbiBleGFtcGxlIG9mIHRoZSBSZWR1eCBtaWRkbGV3YXJlLg0KICoNCiAqIEJlY2F1c2UgbWlkZGxld2FyZSBpcyBwb3RlbnRpYWxseSBhc3luY2hyb25vdXMsIHRoaXMgc2hvdWxkIGJlIHRoZSBmaXJzdA0KICogc3RvcmUgZW5oYW5jZXIgaW4gdGhlIGNvbXBvc2l0aW9uIGNoYWluLg0KICoNCiAqIE5vdGUgdGhhdCBlYWNoIG1pZGRsZXdhcmUgd2lsbCBiZSBnaXZlbiB0aGUgYGRpc3BhdGNoYCBhbmQgYGdldFN0YXRlYCBmdW5jdGlvbnMNCiAqIGFzIG5hbWVkIGFyZ3VtZW50cy4NCiAqDQogKiBAcGFyYW0gey4uLkZ1bmN0aW9ufSBtaWRkbGV3YXJlcyBUaGUgbWlkZGxld2FyZSBjaGFpbiB0byBiZSBhcHBsaWVkLg0KICogQHJldHVybnMge0Z1bmN0aW9ufSBBIHN0b3JlIGVuaGFuY2VyIGFwcGx5aW5nIHRoZSBtaWRkbGV3YXJlLg0KICovDQpmdW5jdGlvbiBhcHBseU1pZGRsZXdhcmUoKSB7DQogIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBtaWRkbGV3YXJlcyA9IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgew0KICAgIG1pZGRsZXdhcmVzW19rZXldID0gYXJndW1lbnRzW19rZXldOw0KICB9DQoNCiAgcmV0dXJuIGZ1bmN0aW9uIChjcmVhdGVTdG9yZSkgew0KICAgIHJldHVybiBmdW5jdGlvbiAocmVkdWNlciwgcHJlbG9hZGVkU3RhdGUsIGVuaGFuY2VyKSB7DQogICAgICB2YXIgc3RvcmUgPSBjcmVhdGVTdG9yZShyZWR1Y2VyLCBwcmVsb2FkZWRTdGF0ZSwgZW5oYW5jZXIpOw0KICAgICAgdmFyIF9kaXNwYXRjaCA9IHN0b3JlLmRpc3BhdGNoOw0KICAgICAgdmFyIGNoYWluID0gW107DQoNCiAgICAgIHZhciBtaWRkbGV3YXJlQVBJID0gew0KICAgICAgICBnZXRTdGF0ZTogc3RvcmUuZ2V0U3RhdGUsDQogICAgICAgIGRpc3BhdGNoOiBmdW5jdGlvbiBkaXNwYXRjaChhY3Rpb24pIHsNCiAgICAgICAgICByZXR1cm4gX2Rpc3BhdGNoKGFjdGlvbik7DQogICAgICAgIH0NCiAgICAgIH07DQogICAgICBjaGFpbiA9IG1pZGRsZXdhcmVzLm1hcChmdW5jdGlvbiAobWlkZGxld2FyZSkgew0KICAgICAgICByZXR1cm4gbWlkZGxld2FyZShtaWRkbGV3YXJlQVBJKTsNCiAgICAgIH0pOw0KICAgICAgX2Rpc3BhdGNoID0gY29tcG9zZS5hcHBseSh1bmRlZmluZWQsIGNoYWluKShzdG9yZS5kaXNwYXRjaCk7DQoNCiAgICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgc3RvcmUsIHsNCiAgICAgICAgZGlzcGF0Y2g6IF9kaXNwYXRjaA0KICAgICAgfSk7DQogICAgfTsNCiAgfTsNCn0NCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlZHV4L2VzL2luZGV4LmpzDQovKiBjb25jYXRlZCBoYXJtb255IHJlZXhwb3J0ICovX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sICJjcmVhdGVTdG9yZSIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gY3JlYXRlU3RvcmVfY3JlYXRlU3RvcmU7IH0pOw0KLyogY29uY2F0ZWQgaGFybW9ueSByZWV4cG9ydCAqL19fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiY29tYmluZVJlZHVjZXJzIiwgZnVuY3Rpb24oKSB7IHJldHVybiBjb21iaW5lUmVkdWNlcnM7IH0pOw0KLyogY29uY2F0ZWQgaGFybW9ueSByZWV4cG9ydCAqL19fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiYmluZEFjdGlvbkNyZWF0b3JzIiwgZnVuY3Rpb24oKSB7IHJldHVybiBiaW5kQWN0aW9uQ3JlYXRvcnM7IH0pOw0KLyogY29uY2F0ZWQgaGFybW9ueSByZWV4cG9ydCAqL19fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiYXBwbHlNaWRkbGV3YXJlIiwgZnVuY3Rpb24oKSB7IHJldHVybiBhcHBseU1pZGRsZXdhcmU7IH0pOw0KLyogY29uY2F0ZWQgaGFybW9ueSByZWV4cG9ydCAqL19fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiY29tcG9zZSIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gY29tcG9zZTsgfSk7DQoNCg0KDQoNCg0KDQoNCi8qDQoqIFRoaXMgaXMgYSBkdW1teSBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgZnVuY3Rpb24gbmFtZSBoYXMgYmVlbiBhbHRlcmVkIGJ5IG1pbmlmaWNhdGlvbi4NCiogSWYgdGhlIGZ1bmN0aW9uIGhhcyBiZWVuIG1pbmlmaWVkIGFuZCBOT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nLCB3YXJuIHRoZSB1c2VyLg0KKi8NCmZ1bmN0aW9uIGlzQ3J1c2hlZCgpIHt9DQoNCmlmIChmYWxzZSkgew0KICB3YXJuaW5nKCdZb3UgYXJlIGN1cnJlbnRseSB1c2luZyBtaW5pZmllZCBjb2RlIG91dHNpZGUgb2YgTk9ERV9FTlYgPT09IFwncHJvZHVjdGlvblwnLiAnICsgJ1RoaXMgbWVhbnMgdGhhdCB5b3UgYXJlIHJ1bm5pbmcgYSBzbG93ZXIgZGV2ZWxvcG1lbnQgYnVpbGQgb2YgUmVkdXguICcgKyAnWW91IGNhbiB1c2UgbG9vc2UtZW52aWZ5IChodHRwczovL2dpdGh1Yi5jb20vemVydG9zaC9sb29zZS1lbnZpZnkpIGZvciBicm93c2VyaWZ5ICcgKyAnb3IgRGVmaW5lUGx1Z2luIGZvciB3ZWJwYWNrIChodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzMwMDMwMDMxKSAnICsgJ3RvIGVuc3VyZSB5b3UgaGF2ZSB0aGUgY29ycmVjdCBjb2RlIGZvciB5b3VyIHByb2R1Y3Rpb24gYnVpbGQuJyk7DQp9DQoNCg0KDQovKioqLyB9KSwNCi8qIDM0ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCnZhciBnOw0KDQovLyBUaGlzIHdvcmtzIGluIG5vbi1zdHJpY3QgbW9kZQ0KZyA9IChmdW5jdGlvbigpIHsNCglyZXR1cm4gdGhpczsNCn0pKCk7DQoNCnRyeSB7DQoJLy8gVGhpcyB3b3JrcyBpZiBldmFsIGlzIGFsbG93ZWQgKHNlZSBDU1ApDQoJZyA9IGcgfHwgRnVuY3Rpb24oInJldHVybiB0aGlzIikoKSB8fCAoMSxldmFsKSgidGhpcyIpOw0KfSBjYXRjaChlKSB7DQoJLy8gVGhpcyB3b3JrcyBpZiB0aGUgd2luZG93IHJlZmVyZW5jZSBpcyBhdmFpbGFibGUNCglpZih0eXBlb2Ygd2luZG93ID09PSAib2JqZWN0IikNCgkJZyA9IHdpbmRvdzsNCn0NCg0KLy8gZyBjYW4gc3RpbGwgYmUgdW5kZWZpbmVkLCBidXQgbm90aGluZyB0byBkbyBhYm91dCBpdC4uLg0KLy8gV2UgcmV0dXJuIHVuZGVmaW5lZCwgaW5zdGVhZCBvZiBub3RoaW5nIGhlcmUsIHNvIGl0J3MNCi8vIGVhc2llciB0byBoYW5kbGUgdGhpcyBjYXNlLiBpZighZ2xvYmFsKSB7IC4uLn0NCg0KbW9kdWxlLmV4cG9ydHMgPSBnOw0KDQoNCi8qKiovIH0pLA0KLyogMzUgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KDQp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsNCg0KdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7DQoNCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQ0KDQp2YXIgV3JhcHBlZEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7DQogIGZ1bmN0aW9uIFdyYXBwZWRFbGVtZW50KF9yZWYpIHsNCiAgICB2YXIgZWxlbWVudCA9IF9yZWYuZWxlbWVudCwNCiAgICAgICAgY2xhc3NOYW1lcyA9IF9yZWYuY2xhc3NOYW1lczsNCg0KICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBXcmFwcGVkRWxlbWVudCk7DQoNCiAgICBPYmplY3QuYXNzaWduKHRoaXMsIHsgZWxlbWVudDogZWxlbWVudCwgY2xhc3NOYW1lczogY2xhc3NOYW1lcyB9KTsNCg0KICAgIGlmICghKDAsIF91dGlscy5pc0VsZW1lbnQpKGVsZW1lbnQpKSB7DQogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIGVsZW1lbnQgcGFzc2VkJyk7DQogICAgfQ0KDQogICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7DQogIH0NCg0KICBfY3JlYXRlQ2xhc3MoV3JhcHBlZEVsZW1lbnQsIFt7DQogICAga2V5OiAnY29uY2VhbCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbmNlYWwoKSB7DQogICAgICAvLyBIaWRlIHBhc3NlZCBpbnB1dA0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5jbGFzc05hbWVzLmlucHV0KTsNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuY2xhc3NOYW1lcy5oaWRkZW5TdGF0ZSk7DQoNCiAgICAgIC8vIFJlbW92ZSBlbGVtZW50IGZyb20gdGFiIGluZGV4DQogICAgICB0aGlzLmVsZW1lbnQudGFiSW5kZXggPSAnLTEnOw0KDQogICAgICAvLyBCYWNrdXAgb3JpZ2luYWwgc3R5bGVzIGlmIGFueQ0KICAgICAgdmFyIG9yaWdTdHlsZSA9IHRoaXMuZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3N0eWxlJyk7DQoNCiAgICAgIGlmIChvcmlnU3R5bGUpIHsNCiAgICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1jaG9pY2Utb3JpZy1zdHlsZScsIG9yaWdTdHlsZSk7DQogICAgICB9DQoNCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTsNCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtY2hvaWNlJywgJ2FjdGl2ZScpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3JldmVhbCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHJldmVhbCgpIHsNCiAgICAgIC8vIFJlaW5zdGF0ZSBwYXNzZWQgZWxlbWVudA0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5jbGFzc05hbWVzLmlucHV0KTsNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2xhc3NOYW1lcy5oaWRkZW5TdGF0ZSk7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCd0YWJpbmRleCcpOw0KDQogICAgICAvLyBSZWNvdmVyIG9yaWdpbmFsIHN0eWxlcyBpZiBhbnkNCiAgICAgIHZhciBvcmlnU3R5bGUgPSB0aGlzLmVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWNob2ljZS1vcmlnLXN0eWxlJyk7DQoNCiAgICAgIGlmIChvcmlnU3R5bGUpIHsNCiAgICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1jaG9pY2Utb3JpZy1zdHlsZScpOw0KICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdzdHlsZScsIG9yaWdTdHlsZSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpOw0KICAgICAgfQ0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nKTsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtY2hvaWNlJyk7DQoNCiAgICAgIC8vIFJlLWFzc2lnbiB2YWx1ZXMgLSB0aGlzIGlzIHdlaXJkLCBJIGtub3cNCiAgICAgIHRoaXMuZWxlbWVudC52YWx1ZSA9IHRoaXMuZWxlbWVudC52YWx1ZTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdlbmFibGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBlbmFibGUoKSB7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpOw0KICAgICAgdGhpcy5lbGVtZW50LmRpc2FibGVkID0gZmFsc2U7DQogICAgICB0aGlzLmlzRGlzYWJsZWQgPSBmYWxzZTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdkaXNhYmxlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzYWJsZSgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpOw0KICAgICAgdGhpcy5lbGVtZW50LmRpc2FibGVkID0gdHJ1ZTsNCiAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IHRydWU7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAndHJpZ2dlckV2ZW50JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gdHJpZ2dlckV2ZW50KGV2ZW50VHlwZSwgZGF0YSkgew0KICAgICAgKDAsIF91dGlscy5kaXNwYXRjaEV2ZW50KSh0aGlzLmVsZW1lbnQsIGV2ZW50VHlwZSwgZGF0YSk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAndmFsdWUnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC52YWx1ZTsNCiAgICB9DQogIH1dKTsNCg0KICByZXR1cm4gV3JhcHBlZEVsZW1lbnQ7DQp9KCk7DQoNCmV4cG9ydHMuZGVmYXVsdCA9IFdyYXBwZWRFbGVtZW50Ow0KDQovKioqLyB9KSwNCi8qIDM2ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCmV4cG9ydHMuVEVNUExBVEVTID0gdW5kZWZpbmVkOw0KDQp2YXIgX2NsYXNzbmFtZXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg5KTsNCg0KdmFyIF9jbGFzc25hbWVzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NsYXNzbmFtZXMpOw0KDQp2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsNCg0KZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0NCg0KZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0NCg0KdmFyIFRFTVBMQVRFUyA9IGV4cG9ydHMuVEVNUExBVEVTID0gew0KICBjb250YWluZXJPdXRlcjogZnVuY3Rpb24gY29udGFpbmVyT3V0ZXIoZ2xvYmFsQ2xhc3NlcywgZGlyZWN0aW9uLCBpc1NlbGVjdEVsZW1lbnQsIGlzU2VsZWN0T25lRWxlbWVudCwgc2VhcmNoRW5hYmxlZCwgcGFzc2VkRWxlbWVudFR5cGUpIHsNCiAgICB2YXIgdGFiSW5kZXggPSBpc1NlbGVjdE9uZUVsZW1lbnQgPyAndGFiaW5kZXg9IjAiJyA6ICcnOw0KICAgIHZhciByb2xlID0gaXNTZWxlY3RFbGVtZW50ID8gJ3JvbGU9Imxpc3Rib3giJyA6ICcnOw0KICAgIHZhciBhcmlhQXV0b0NvbXBsZXRlID0gJyc7DQoNCiAgICBpZiAoaXNTZWxlY3RFbGVtZW50ICYmIHNlYXJjaEVuYWJsZWQpIHsNCiAgICAgIHJvbGUgPSAncm9sZT0iY29tYm9ib3giJzsNCiAgICAgIGFyaWFBdXRvQ29tcGxldGUgPSAnYXJpYS1hdXRvY29tcGxldGU9Imxpc3QiJzsNCiAgICB9DQoNCiAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzPSInICsgZ2xvYmFsQ2xhc3Nlcy5jb250YWluZXJPdXRlciArICciXG4gICAgICAgIGRhdGEtdHlwZT0iJyArIHBhc3NlZEVsZW1lbnRUeXBlICsgJyJcbiAgICAgICAgJyArIHJvbGUgKyAnXG4gICAgICAgICcgKyB0YWJJbmRleCArICdcbiAgICAgICAgJyArIGFyaWFBdXRvQ29tcGxldGUgKyAnXG4gICAgICAgIGFyaWEtaGFzcG9wdXA9InRydWUiXG4gICAgICAgIGFyaWEtZXhwYW5kZWQ9ImZhbHNlIlxuICAgICAgICBkaXI9IicgKyBkaXJlY3Rpb24gKyAnIlxuICAgICAgICA+XG4gICAgICA8L2Rpdj5cbiAgICAnKTsNCiAgfSwNCiAgY29udGFpbmVySW5uZXI6IGZ1bmN0aW9uIGNvbnRhaW5lcklubmVyKGdsb2JhbENsYXNzZXMpIHsNCiAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICA8ZGl2IGNsYXNzPSInICsgZ2xvYmFsQ2xhc3Nlcy5jb250YWluZXJJbm5lciArICciPjwvZGl2PlxuICAgICcpOw0KICB9LA0KICBpdGVtTGlzdDogZnVuY3Rpb24gaXRlbUxpc3QoZ2xvYmFsQ2xhc3NlcywgaXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgdmFyIF9jbGFzc05hbWVzOw0KDQogICAgdmFyIGxvY2FsQ2xhc3NlcyA9ICgwLCBfY2xhc3NuYW1lczIuZGVmYXVsdCkoZ2xvYmFsQ2xhc3Nlcy5saXN0LCAoX2NsYXNzTmFtZXMgPSB7fSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzLCBnbG9iYWxDbGFzc2VzLmxpc3RTaW5nbGUsIGlzU2VsZWN0T25lRWxlbWVudCksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lcywgZ2xvYmFsQ2xhc3Nlcy5saXN0SXRlbXMsICFpc1NlbGVjdE9uZUVsZW1lbnQpLCBfY2xhc3NOYW1lcykpOw0KDQogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPGRpdiBjbGFzcz0iJyArIGxvY2FsQ2xhc3NlcyArICciPjwvZGl2PlxuICAgICcpOw0KICB9LA0KICBwbGFjZWhvbGRlcjogZnVuY3Rpb24gcGxhY2Vob2xkZXIoZ2xvYmFsQ2xhc3NlcywgdmFsdWUpIHsNCiAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICA8ZGl2IGNsYXNzPSInICsgZ2xvYmFsQ2xhc3Nlcy5wbGFjZWhvbGRlciArICciPlxuICAgICAgICAnICsgdmFsdWUgKyAnXG4gICAgICA8L2Rpdj5cbiAgICAnKTsNCiAgfSwNCiAgaXRlbTogZnVuY3Rpb24gaXRlbShnbG9iYWxDbGFzc2VzLCBkYXRhLCByZW1vdmVJdGVtQnV0dG9uKSB7DQogICAgdmFyIF9jbGFzc05hbWVzMjsNCg0KICAgIHZhciBhcmlhU2VsZWN0ZWQgPSBkYXRhLmFjdGl2ZSA/ICdhcmlhLXNlbGVjdGVkPSJ0cnVlIicgOiAnJzsNCiAgICB2YXIgYXJpYURpc2FibGVkID0gZGF0YS5kaXNhYmxlZCA/ICdhcmlhLWRpc2FibGVkPSJ0cnVlIicgOiAnJzsNCg0KICAgIHZhciBsb2NhbENsYXNzZXMgPSAoMCwgX2NsYXNzbmFtZXMyLmRlZmF1bHQpKGdsb2JhbENsYXNzZXMuaXRlbSwgKF9jbGFzc05hbWVzMiA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXMyLCBnbG9iYWxDbGFzc2VzLmhpZ2hsaWdodGVkU3RhdGUsIGRhdGEuaGlnaGxpZ2h0ZWQpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXMyLCBnbG9iYWxDbGFzc2VzLml0ZW1TZWxlY3RhYmxlLCAhZGF0YS5oaWdobGlnaHRlZCksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczIsIGdsb2JhbENsYXNzZXMucGxhY2Vob2xkZXIsIGRhdGEucGxhY2Vob2xkZXIpLCBfY2xhc3NOYW1lczIpKTsNCg0KICAgIGlmIChyZW1vdmVJdGVtQnV0dG9uKSB7DQogICAgICB2YXIgX2NsYXNzTmFtZXMzOw0KDQogICAgICBsb2NhbENsYXNzZXMgPSAoMCwgX2NsYXNzbmFtZXMyLmRlZmF1bHQpKGdsb2JhbENsYXNzZXMuaXRlbSwgKF9jbGFzc05hbWVzMyA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXMzLCBnbG9iYWxDbGFzc2VzLmhpZ2hsaWdodGVkU3RhdGUsIGRhdGEuaGlnaGxpZ2h0ZWQpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXMzLCBnbG9iYWxDbGFzc2VzLml0ZW1TZWxlY3RhYmxlLCAhZGF0YS5kaXNhYmxlZCksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczMsIGdsb2JhbENsYXNzZXMucGxhY2Vob2xkZXIsIGRhdGEucGxhY2Vob2xkZXIpLCBfY2xhc3NOYW1lczMpKTsNCg0KICAgICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgICA8ZGl2XG4gICAgICAgICAgY2xhc3M9IicgKyBsb2NhbENsYXNzZXMgKyAnIlxuICAgICAgICAgIGRhdGEtaXRlbVxuICAgICAgICAgIGRhdGEtaWQ9IicgKyBkYXRhLmlkICsgJyJcbiAgICAgICAgICBkYXRhLXZhbHVlPSInICsgZGF0YS52YWx1ZSArICciXG4gICAgICAgICAgZGF0YS1kZWxldGFibGVcbiAgICAgICAgICAnICsgYXJpYVNlbGVjdGVkICsgJ1xuICAgICAgICAgICcgKyBhcmlhRGlzYWJsZWQgKyAnXG4gICAgICAgICAgPlxuICAgICAgICAgICcgKyBkYXRhLmxhYmVsICsgJzwhLS1cbiAgICAgICAtLT48YnV0dG9uXG4gICAgICAgICAgICB0eXBlPSJidXR0b24iXG4gICAgICAgICAgICBjbGFzcz0iJyArIGdsb2JhbENsYXNzZXMuYnV0dG9uICsgJyJcbiAgICAgICAgICAgIGRhdGEtYnV0dG9uXG4gICAgICAgICAgICBhcmlhLWxhYmVsPSJSZW1vdmUgaXRlbTogXCcnICsgZGF0YS52YWx1ZSArICdcJyJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgIFJlbW92ZSBpdGVtXG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgJyk7DQogICAgfQ0KDQogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPGRpdlxuICAgICAgICBjbGFzcz0iJyArIGxvY2FsQ2xhc3NlcyArICciXG4gICAgICAgIGRhdGEtaXRlbVxuICAgICAgICBkYXRhLWlkPSInICsgZGF0YS5pZCArICciXG4gICAgICAgIGRhdGEtdmFsdWU9IicgKyBkYXRhLnZhbHVlICsgJyJcbiAgICAgICAgJyArIGFyaWFTZWxlY3RlZCArICdcbiAgICAgICAgJyArIGFyaWFEaXNhYmxlZCArICdcbiAgICAgICAgPlxuICAgICAgICAnICsgZGF0YS5sYWJlbCArICdcbiAgICAgIDwvZGl2PlxuICAgICcpOw0KICB9LA0KICBjaG9pY2VMaXN0OiBmdW5jdGlvbiBjaG9pY2VMaXN0KGdsb2JhbENsYXNzZXMsIGlzU2VsZWN0T25lRWxlbWVudCkgew0KICAgIHZhciBhcmlhTXVsdGlTZWxlY3RhYmxlID0gIWlzU2VsZWN0T25lRWxlbWVudCA/ICdhcmlhLW11bHRpc2VsZWN0YWJsZT0idHJ1ZSInIDogJyc7DQoNCiAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzPSInICsgZ2xvYmFsQ2xhc3Nlcy5saXN0ICsgJyJcbiAgICAgICAgZGlyPSJsdHIiXG4gICAgICAgIHJvbGU9Imxpc3Rib3giXG4gICAgICAgICcgKyBhcmlhTXVsdGlTZWxlY3RhYmxlICsgJ1xuICAgICAgICA+XG4gICAgICA8L2Rpdj5cbiAgICAnKTsNCiAgfSwNCiAgY2hvaWNlR3JvdXA6IGZ1bmN0aW9uIGNob2ljZUdyb3VwKGdsb2JhbENsYXNzZXMsIGRhdGEpIHsNCiAgICB2YXIgYXJpYURpc2FibGVkID0gZGF0YS5kaXNhYmxlZCA/ICdhcmlhLWRpc2FibGVkPSJ0cnVlIicgOiAnJzsNCiAgICB2YXIgbG9jYWxDbGFzc2VzID0gKDAsIF9jbGFzc25hbWVzMi5kZWZhdWx0KShnbG9iYWxDbGFzc2VzLmdyb3VwLCBfZGVmaW5lUHJvcGVydHkoe30sIGdsb2JhbENsYXNzZXMuaXRlbURpc2FibGVkLCBkYXRhLmRpc2FibGVkKSk7DQoNCiAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzPSInICsgbG9jYWxDbGFzc2VzICsgJyJcbiAgICAgICAgZGF0YS1ncm91cFxuICAgICAgICBkYXRhLWlkPSInICsgZGF0YS5pZCArICciXG4gICAgICAgIGRhdGEtdmFsdWU9IicgKyBkYXRhLnZhbHVlICsgJyJcbiAgICAgICAgcm9sZT0iZ3JvdXAiXG4gICAgICAgICcgKyBhcmlhRGlzYWJsZWQgKyAnXG4gICAgICAgID5cbiAgICAgICAgPGRpdiBjbGFzcz0iJyArIGdsb2JhbENsYXNzZXMuZ3JvdXBIZWFkaW5nICsgJyI+JyArIGRhdGEudmFsdWUgKyAnPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAnKTsNCiAgfSwNCiAgY2hvaWNlOiBmdW5jdGlvbiBjaG9pY2UoZ2xvYmFsQ2xhc3NlcywgZGF0YSwgaXRlbVNlbGVjdFRleHQpIHsNCiAgICB2YXIgX2NsYXNzTmFtZXM1Ow0KDQogICAgdmFyIHJvbGUgPSBkYXRhLmdyb3VwSWQgPiAwID8gJ3JvbGU9InRyZWVpdGVtIicgOiAncm9sZT0ib3B0aW9uIic7DQogICAgdmFyIGxvY2FsQ2xhc3NlcyA9ICgwLCBfY2xhc3NuYW1lczIuZGVmYXVsdCkoZ2xvYmFsQ2xhc3Nlcy5pdGVtLCBnbG9iYWxDbGFzc2VzLml0ZW1DaG9pY2UsIChfY2xhc3NOYW1lczUgPSB7fSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzNSwgZ2xvYmFsQ2xhc3Nlcy5pdGVtRGlzYWJsZWQsIGRhdGEuZGlzYWJsZWQpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXM1LCBnbG9iYWxDbGFzc2VzLml0ZW1TZWxlY3RhYmxlLCAhZGF0YS5kaXNhYmxlZCksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczUsIGdsb2JhbENsYXNzZXMucGxhY2Vob2xkZXIsIGRhdGEucGxhY2Vob2xkZXIpLCBfY2xhc3NOYW1lczUpKTsNCg0KICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9IicgKyBsb2NhbENsYXNzZXMgKyAnIlxuICAgICAgICBkYXRhLXNlbGVjdC10ZXh0PSInICsgaXRlbVNlbGVjdFRleHQgKyAnIlxuICAgICAgICBkYXRhLWNob2ljZVxuICAgICAgICBkYXRhLWlkPSInICsgZGF0YS5pZCArICciXG4gICAgICAgIGRhdGEtdmFsdWU9IicgKyBkYXRhLnZhbHVlICsgJyJcbiAgICAgICAgJyArIChkYXRhLmRpc2FibGVkID8gJ2RhdGEtY2hvaWNlLWRpc2FibGVkIGFyaWEtZGlzYWJsZWQ9InRydWUiJyA6ICdkYXRhLWNob2ljZS1zZWxlY3RhYmxlJykgKyAnXG4gICAgICAgIGlkPSInICsgZGF0YS5lbGVtZW50SWQgKyAnIlxuICAgICAgICAnICsgcm9sZSArICdcbiAgICAgICAgPlxuICAgICAgICAnICsgZGF0YS5sYWJlbCArICdcbiAgICAgIDwvZGl2PlxuICAgICcpOw0KICB9LA0KICBpbnB1dDogZnVuY3Rpb24gaW5wdXQoZ2xvYmFsQ2xhc3Nlcykgew0KICAgIHZhciBsb2NhbENsYXNzZXMgPSAoMCwgX2NsYXNzbmFtZXMyLmRlZmF1bHQpKGdsb2JhbENsYXNzZXMuaW5wdXQsIGdsb2JhbENsYXNzZXMuaW5wdXRDbG9uZWQpOw0KDQogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPGlucHV0XG4gICAgICAgIHR5cGU9InRleHQiXG4gICAgICAgIGNsYXNzPSInICsgbG9jYWxDbGFzc2VzICsgJyJcbiAgICAgICAgYXV0b2NvbXBsZXRlPSJvZmYiXG4gICAgICAgIGF1dG9jYXBpdGFsaXplPSJvZmYiXG4gICAgICAgIHNwZWxsY2hlY2s9ImZhbHNlIlxuICAgICAgICByb2xlPSJ0ZXh0Ym94IlxuICAgICAgICBhcmlhLWF1dG9jb21wbGV0ZT0ibGlzdCJcbiAgICAgICAgPlxuICAgICcpOw0KICB9LA0KICBkcm9wZG93bjogZnVuY3Rpb24gZHJvcGRvd24oZ2xvYmFsQ2xhc3Nlcykgew0KICAgIHZhciBsb2NhbENsYXNzZXMgPSAoMCwgX2NsYXNzbmFtZXMyLmRlZmF1bHQpKGdsb2JhbENsYXNzZXMubGlzdCwgZ2xvYmFsQ2xhc3Nlcy5saXN0RHJvcGRvd24pOw0KDQogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPGRpdlxuICAgICAgICBjbGFzcz0iJyArIGxvY2FsQ2xhc3NlcyArICciXG4gICAgICAgIGFyaWEtZXhwYW5kZWQ9ImZhbHNlIlxuICAgICAgICA+XG4gICAgICA8L2Rpdj5cbiAgICAnKTsNCiAgfSwNCiAgbm90aWNlOiBmdW5jdGlvbiBub3RpY2UoZ2xvYmFsQ2xhc3NlcywgbGFiZWwpIHsNCiAgICB2YXIgX2NsYXNzTmFtZXM2Ow0KDQogICAgdmFyIHR5cGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICcnOw0KDQogICAgdmFyIGxvY2FsQ2xhc3NlcyA9ICgwLCBfY2xhc3NuYW1lczIuZGVmYXVsdCkoZ2xvYmFsQ2xhc3Nlcy5pdGVtLCBnbG9iYWxDbGFzc2VzLml0ZW1DaG9pY2UsIChfY2xhc3NOYW1lczYgPSB7fSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzNiwgZ2xvYmFsQ2xhc3Nlcy5ub1Jlc3VsdHMsIHR5cGUgPT09ICduby1yZXN1bHRzJyksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczYsIGdsb2JhbENsYXNzZXMubm9DaG9pY2VzLCB0eXBlID09PSAnbm8tY2hvaWNlcycpLCBfY2xhc3NOYW1lczYpKTsNCg0KICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXYgY2xhc3M9IicgKyBsb2NhbENsYXNzZXMgKyAnIj5cbiAgICAgICAgJyArIGxhYmVsICsgJ1xuICAgICAgPC9kaXY+XG4gICAgJyk7DQogIH0sDQogIG9wdGlvbjogZnVuY3Rpb24gb3B0aW9uKGRhdGEpIHsNCiAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICA8b3B0aW9uIHZhbHVlPSInICsgZGF0YS52YWx1ZSArICciICcgKyAoZGF0YS5hY3RpdmUgPyAnc2VsZWN0ZWQnIDogJycpICsgJyAnICsgKGRhdGEuZGlzYWJsZWQgPyAnZGlzYWJsZWQnIDogJycpICsgJz4nICsgZGF0YS5sYWJlbCArICc8L29wdGlvbj5cbiAgICAnKTsNCiAgfQ0KfTsNCg0KZXhwb3J0cy5kZWZhdWx0ID0gVEVNUExBVEVTOw0KDQovKioqLyB9KSwNCi8qIDM3ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzOCk7DQoNCg0KLyoqKi8gfSksDQovKiAzOCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7DQoNCnZhciBfZnVzZSA9IF9fd2VicGFja19yZXF1aXJlX18oMzkpOw0KDQp2YXIgX2Z1c2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZnVzZSk7DQoNCnZhciBfZGVlcG1lcmdlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MCk7DQoNCnZhciBfZGVlcG1lcmdlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2RlZXBtZXJnZSk7DQoNCl9fd2VicGFja19yZXF1aXJlX18oNDEpOw0KDQp2YXIgX3N0b3JlMiA9IF9fd2VicGFja19yZXF1aXJlX18oNzMpOw0KDQp2YXIgX3N0b3JlMyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3N0b3JlMik7DQoNCnZhciBfY29tcG9uZW50cyA9IF9fd2VicGFja19yZXF1aXJlX18oODIpOw0KDQp2YXIgX2NvbnN0YW50cyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7DQoNCnZhciBfdGVtcGxhdGVzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNik7DQoNCnZhciBfY2hvaWNlcyA9IF9fd2VicGFja19yZXF1aXJlX18oOTApOw0KDQp2YXIgX2l0ZW1zID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5MSk7DQoNCnZhciBfZ3JvdXBzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5Mik7DQoNCnZhciBfbWlzYyA9IF9fd2VicGFja19yZXF1aXJlX18oOTMpOw0KDQp2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsNCg0KZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0NCg0KZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0NCg0KZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSBlbHNlIHsgcmV0dXJuIEFycmF5LmZyb20oYXJyKTsgfSB9DQoNCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQ0KDQovKioNCiAqIENob2ljZXMNCiAqIEBhdXRob3IgSm9zaCBKb2huc29uPGpvc2hAam9zaHVham9obnNvbi5jby51az4NCiAqLw0KdmFyIENob2ljZXMgPSBmdW5jdGlvbiAoKSB7DQogIGZ1bmN0aW9uIENob2ljZXMoKSB7DQogICAgdmFyIGVsZW1lbnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICdbZGF0YS1jaG9pY2VdJzsNCiAgICB2YXIgdXNlckNvbmZpZyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307DQoNCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ2hvaWNlcyk7DQoNCiAgICBpZiAoKDAsIF91dGlscy5pc1R5cGUpKCdTdHJpbmcnLCBlbGVtZW50KSkgew0KICAgICAgdmFyIGVsZW1lbnRzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGVsZW1lbnQpKTsNCg0KICAgICAgLy8gSWYgdGhlcmUgYXJlIG11bHRpcGxlIGVsZW1lbnRzLCBjcmVhdGUgYSBuZXcgaW5zdGFuY2UNCiAgICAgIC8vIGZvciBlYWNoIGVsZW1lbnQgYmVzaWRlcyB0aGUgZmlyc3Qgb25lIChhcyB0aGF0IGFscmVhZHkgaGFzIGFuIGluc3RhbmNlKQ0KICAgICAgaWYgKGVsZW1lbnRzLmxlbmd0aCA+IDEpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2dlbmVyYXRlSW5zdGFuY2VzKGVsZW1lbnRzLCB1c2VyQ29uZmlnKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICB0aGlzLmNvbmZpZyA9IF9kZWVwbWVyZ2UyLmRlZmF1bHQuYWxsKFtfY29uc3RhbnRzLkRFRkFVTFRfQ09ORklHLCBDaG9pY2VzLnVzZXJEZWZhdWx0cywgdXNlckNvbmZpZ10pOw0KDQogICAgaWYgKCEoMCwgX3V0aWxzLmRvS2V5c01hdGNoKSh0aGlzLmNvbmZpZywgX2NvbnN0YW50cy5ERUZBVUxUX0NPTkZJRykpIHsNCiAgICAgIGNvbnNvbGUud2FybignVW5rbm93biBjb25maWcgb3B0aW9uKHMpIHBhc3NlZCcpOw0KICAgIH0NCg0KICAgIGlmICghWydhdXRvJywgJ2Fsd2F5cyddLmluY2x1ZGVzKHRoaXMuY29uZmlnLnJlbmRlclNlbGVjdGVkQ2hvaWNlcykpIHsNCiAgICAgIHRoaXMuY29uZmlnLnJlbmRlclNlbGVjdGVkQ2hvaWNlcyA9ICdhdXRvJzsNCiAgICB9DQoNCiAgICAvLyBSZXRyaWV2ZSB0cmlnZ2VyaW5nIGVsZW1lbnQgKGkuZS4gZWxlbWVudCB3aXRoICdkYXRhLWNob2ljZScgdHJpZ2dlcikNCiAgICB2YXIgcGFzc2VkRWxlbWVudCA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnU3RyaW5nJywgZWxlbWVudCkgPyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsZW1lbnQpIDogZWxlbWVudDsNCg0KICAgIGlmICghcGFzc2VkRWxlbWVudCkgew0KICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoJ0NvdWxkIG5vdCBmaW5kIHBhc3NlZCBlbGVtZW50IG9yIHBhc3NlZCBlbGVtZW50IHdhcyBvZiBhbiBpbnZhbGlkIHR5cGUnKTsNCiAgICB9DQoNCiAgICB0aGlzLl9pc1RleHRFbGVtZW50ID0gcGFzc2VkRWxlbWVudC50eXBlID09PSAndGV4dCc7DQogICAgdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50ID0gcGFzc2VkRWxlbWVudC50eXBlID09PSAnc2VsZWN0LW9uZSc7DQogICAgdGhpcy5faXNTZWxlY3RNdWx0aXBsZUVsZW1lbnQgPSBwYXNzZWRFbGVtZW50LnR5cGUgPT09ICdzZWxlY3QtbXVsdGlwbGUnOw0KICAgIHRoaXMuX2lzU2VsZWN0RWxlbWVudCA9IHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCB8fCB0aGlzLl9pc1NlbGVjdE11bHRpcGxlRWxlbWVudDsNCg0KICAgIGlmICh0aGlzLl9pc1RleHRFbGVtZW50KSB7DQogICAgICB0aGlzLnBhc3NlZEVsZW1lbnQgPSBuZXcgX2NvbXBvbmVudHMuV3JhcHBlZElucHV0KHsNCiAgICAgICAgZWxlbWVudDogcGFzc2VkRWxlbWVudCwNCiAgICAgICAgY2xhc3NOYW1lczogdGhpcy5jb25maWcuY2xhc3NOYW1lcywNCiAgICAgICAgZGVsaW1pdGVyOiB0aGlzLmNvbmZpZy5kZWxpbWl0ZXINCiAgICAgIH0pOw0KICAgIH0gZWxzZSBpZiAodGhpcy5faXNTZWxlY3RFbGVtZW50KSB7DQogICAgICB0aGlzLnBhc3NlZEVsZW1lbnQgPSBuZXcgX2NvbXBvbmVudHMuV3JhcHBlZFNlbGVjdCh7DQogICAgICAgIGVsZW1lbnQ6IHBhc3NlZEVsZW1lbnQsDQogICAgICAgIGNsYXNzTmFtZXM6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMNCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIGlmICghcGFzc2VkRWxlbWVudCkgew0KICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoJ1Bhc3NlZCBlbGVtZW50IHdhcyBvZiBhbiBpbnZhbGlkIHR5cGUnKTsNCiAgICB9DQoNCiAgICBpZiAodGhpcy5jb25maWcuc2hvdWxkU29ydEl0ZW1zID09PSB0cnVlICYmIHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCAmJiAhdGhpcy5jb25maWcuc2lsZW50KSB7DQogICAgICBjb25zb2xlLndhcm4oInNob3VsZFNvcnRFbGVtZW50czogVHlwZSBvZiBwYXNzZWQgZWxlbWVudCBpcyAnc2VsZWN0LW9uZScsIGZhbGxpbmcgYmFjayB0byBmYWxzZS4iKTsNCiAgICB9DQoNCiAgICB0aGlzLmluaXRpYWxpc2VkID0gZmFsc2U7DQoNCiAgICB0aGlzLl9zdG9yZSA9IG5ldyBfc3RvcmUzLmRlZmF1bHQodGhpcy5yZW5kZXIpOw0KICAgIHRoaXMuX2luaXRpYWxTdGF0ZSA9IHt9Ow0KICAgIHRoaXMuX2N1cnJlbnRTdGF0ZSA9IHt9Ow0KICAgIHRoaXMuX3ByZXZTdGF0ZSA9IHt9Ow0KICAgIHRoaXMuX2N1cnJlbnRWYWx1ZSA9ICcnOw0KICAgIHRoaXMuX2NhblNlYXJjaCA9IHRoaXMuY29uZmlnLnNlYXJjaEVuYWJsZWQ7DQogICAgdGhpcy5faXNTY3JvbGxpbmdPbkllID0gZmFsc2U7DQogICAgdGhpcy5faGlnaGxpZ2h0UG9zaXRpb24gPSAwOw0KICAgIHRoaXMuX3dhc1RhcCA9IHRydWU7DQogICAgdGhpcy5fcGxhY2Vob2xkZXJWYWx1ZSA9IHRoaXMuX2dlbmVyYXRlUGxhY2Vob2xkZXJWYWx1ZSgpOw0KICAgIHRoaXMuX2Jhc2VJZCA9ICgwLCBfdXRpbHMuZ2VuZXJhdGVJZCkodGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQsICdjaG9pY2VzLScpOw0KICAgIHRoaXMuX2RpcmVjdGlvbiA9IHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LmdldEF0dHJpYnV0ZSgnZGlyJykgfHwgJ2x0cic7DQogICAgdGhpcy5faWROYW1lcyA9IHsNCiAgICAgIGl0ZW1DaG9pY2U6ICdpdGVtLWNob2ljZScNCiAgICB9Ow0KICAgIC8vIEFzc2lnbiBwcmVzZXQgY2hvaWNlcyBmcm9tIHBhc3NlZCBvYmplY3QNCiAgICB0aGlzLl9wcmVzZXRDaG9pY2VzID0gdGhpcy5jb25maWcuY2hvaWNlczsNCiAgICAvLyBBc3NpZ24gcHJlc2V0IGl0ZW1zIGZyb20gcGFzc2VkIG9iamVjdCBmaXJzdA0KICAgIHRoaXMuX3ByZXNldEl0ZW1zID0gdGhpcy5jb25maWcuaXRlbXM7DQogICAgLy8gVGhlbiBhZGQgYW55IHZhbHVlcyBwYXNzZWQgZnJvbSBhdHRyaWJ1dGUNCiAgICBpZiAodGhpcy5wYXNzZWRFbGVtZW50LnZhbHVlKSB7DQogICAgICB0aGlzLl9wcmVzZXRJdGVtcyA9IHRoaXMuX3ByZXNldEl0ZW1zLmNvbmNhdCh0aGlzLnBhc3NlZEVsZW1lbnQudmFsdWUuc3BsaXQodGhpcy5jb25maWcuZGVsaW1pdGVyKSk7DQogICAgfQ0KDQogICAgdGhpcy5fcmVuZGVyID0gdGhpcy5fcmVuZGVyLmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25Gb2N1cyA9IHRoaXMuX29uRm9jdXMuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbkJsdXIgPSB0aGlzLl9vbkJsdXIuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbktleVVwID0gdGhpcy5fb25LZXlVcC5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uS2V5RG93biA9IHRoaXMuX29uS2V5RG93bi5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uQ2xpY2sgPSB0aGlzLl9vbkNsaWNrLmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25Ub3VjaE1vdmUgPSB0aGlzLl9vblRvdWNoTW92ZS5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uVG91Y2hFbmQgPSB0aGlzLl9vblRvdWNoRW5kLmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25Nb3VzZURvd24gPSB0aGlzLl9vbk1vdXNlRG93bi5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uTW91c2VPdmVyID0gdGhpcy5fb25Nb3VzZU92ZXIuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbkZvcm1SZXNldCA9IHRoaXMuX29uRm9ybVJlc2V0LmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25BS2V5ID0gdGhpcy5fb25BS2V5LmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25FbnRlcktleSA9IHRoaXMuX29uRW50ZXJLZXkuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbkVzY2FwZUtleSA9IHRoaXMuX29uRXNjYXBlS2V5LmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25EaXJlY3Rpb25LZXkgPSB0aGlzLl9vbkRpcmVjdGlvbktleS5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uRGVsZXRlS2V5ID0gdGhpcy5fb25EZWxldGVLZXkuYmluZCh0aGlzKTsNCg0KICAgIC8vIElmIGVsZW1lbnQgaGFzIGFscmVhZHkgYmVlbiBpbml0aWFsaXNlZCB3aXRoIENob2ljZXMsIGZhaWwgc2lsZW50bHkNCiAgICBpZiAodGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWNob2ljZScpID09PSAnYWN0aXZlJykgew0KICAgICAgY29uc29sZS53YXJuKCdUcnlpbmcgdG8gaW5pdGlhbGlzZSBDaG9pY2VzIG9uIGVsZW1lbnQgYWxyZWFkeSBpbml0aWFsaXNlZCcpOw0KICAgIH0NCg0KICAgIC8vIExldCdzIGdvDQogICAgdGhpcy5pbml0KCk7DQogIH0NCg0KICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogID0gICAgICAgICAgICBQdWJsaWMgZnVuY3Rpb25zICAgICAgICAgICAgPQ0KICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCiAgX2NyZWF0ZUNsYXNzKENob2ljZXMsIFt7DQogICAga2V5OiAnaW5pdCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGluaXQoKSB7DQogICAgICBpZiAodGhpcy5pbml0aWFsaXNlZCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHRoaXMuX2NyZWF0ZVRlbXBsYXRlcygpOw0KICAgICAgdGhpcy5fY3JlYXRlRWxlbWVudHMoKTsNCiAgICAgIHRoaXMuX2NyZWF0ZVN0cnVjdHVyZSgpOw0KDQogICAgICAvLyBTZXQgaW5pdGlhbCBzdGF0ZSAoV2UgbmVlZCB0byBjbG9uZSB0aGUgc3RhdGUgYmVjYXVzZSBzb21lIHJlZHVjZXJzDQogICAgICAvLyBtb2RpZnkgdGhlIGlubmVyIG9iamVjdHMgcHJvcGVydGllcyBpbiB0aGUgc3RhdGUpIPCfpKINCiAgICAgIHRoaXMuX2luaXRpYWxTdGF0ZSA9ICgwLCBfdXRpbHMuY2xvbmVPYmplY3QpKHRoaXMuX3N0b3JlLnN0YXRlKTsNCiAgICAgIHRoaXMuX3N0b3JlLnN1YnNjcmliZSh0aGlzLl9yZW5kZXIpOw0KICAgICAgdGhpcy5fcmVuZGVyKCk7DQogICAgICB0aGlzLl9hZGRFdmVudExpc3RlbmVycygpOw0KDQogICAgICB2YXIgc2hvdWxkRGlzYWJsZSA9ICF0aGlzLmNvbmZpZy5hZGRJdGVtcyB8fCB0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7DQoNCiAgICAgIGlmIChzaG91bGREaXNhYmxlKSB7DQogICAgICAgIHRoaXMuZGlzYWJsZSgpOw0KICAgICAgfQ0KDQogICAgICB0aGlzLmluaXRpYWxpc2VkID0gdHJ1ZTsNCg0KICAgICAgdmFyIGNhbGxiYWNrT25Jbml0ID0gdGhpcy5jb25maWcuY2FsbGJhY2tPbkluaXQ7DQogICAgICAvLyBSdW4gY2FsbGJhY2sgaWYgaXQgaXMgYSBmdW5jdGlvbg0KDQogICAgICBpZiAoY2FsbGJhY2tPbkluaXQgJiYgKDAsIF91dGlscy5pc1R5cGUpKCdGdW5jdGlvbicsIGNhbGxiYWNrT25Jbml0KSkgew0KICAgICAgICBjYWxsYmFja09uSW5pdC5jYWxsKHRoaXMpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2Rlc3Ryb3knLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgew0KICAgICAgaWYgKCF0aGlzLmluaXRpYWxpc2VkKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5fcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsNCiAgICAgIHRoaXMucGFzc2VkRWxlbWVudC5yZXZlYWwoKTsNCiAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIudW53cmFwKHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50KTsNCg0KICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0RWxlbWVudCkgew0KICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQub3B0aW9ucyA9IHRoaXMuX3ByZXNldENob2ljZXM7DQogICAgICB9DQoNCiAgICAgIHRoaXMuY2xlYXJTdG9yZSgpOw0KDQogICAgICB0aGlzLmNvbmZpZy50ZW1wbGF0ZXMgPSBudWxsOw0KICAgICAgdGhpcy5pbml0aWFsaXNlZCA9IGZhbHNlOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2VuYWJsZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGVuYWJsZSgpIHsNCiAgICAgIGlmICh0aGlzLnBhc3NlZEVsZW1lbnQuaXNEaXNhYmxlZCkgew0KICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQuZW5hYmxlKCk7DQogICAgICB9DQoNCiAgICAgIGlmICh0aGlzLmNvbnRhaW5lck91dGVyLmlzRGlzYWJsZWQpIHsNCiAgICAgICAgdGhpcy5fYWRkRXZlbnRMaXN0ZW5lcnMoKTsNCiAgICAgICAgdGhpcy5pbnB1dC5lbmFibGUoKTsNCiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5lbmFibGUoKTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnZGlzYWJsZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2FibGUoKSB7DQogICAgICBpZiAoIXRoaXMucGFzc2VkRWxlbWVudC5pc0Rpc2FibGVkKSB7DQogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC5kaXNhYmxlKCk7DQogICAgICB9DQoNCiAgICAgIGlmICghdGhpcy5jb250YWluZXJPdXRlci5pc0Rpc2FibGVkKSB7DQogICAgICAgIHRoaXMuX3JlbW92ZUV2ZW50TGlzdGVuZXJzKCk7DQogICAgICAgIHRoaXMuaW5wdXQuZGlzYWJsZSgpOw0KICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLmRpc2FibGUoKTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnaGlnaGxpZ2h0SXRlbScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGhpZ2hsaWdodEl0ZW0oaXRlbSkgew0KICAgICAgdmFyIHJ1bkV2ZW50ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0cnVlOw0KDQogICAgICBpZiAoIWl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHZhciBpZCA9IGl0ZW0uaWQsDQogICAgICAgICAgX2l0ZW0kZ3JvdXBJZCA9IGl0ZW0uZ3JvdXBJZCwNCiAgICAgICAgICBncm91cElkID0gX2l0ZW0kZ3JvdXBJZCA9PT0gdW5kZWZpbmVkID8gLTEgOiBfaXRlbSRncm91cElkLA0KICAgICAgICAgIF9pdGVtJHZhbHVlID0gaXRlbS52YWx1ZSwNCiAgICAgICAgICB2YWx1ZSA9IF9pdGVtJHZhbHVlID09PSB1bmRlZmluZWQgPyAnJyA6IF9pdGVtJHZhbHVlLA0KICAgICAgICAgIF9pdGVtJGxhYmVsID0gaXRlbS5sYWJlbCwNCiAgICAgICAgICBsYWJlbCA9IF9pdGVtJGxhYmVsID09PSB1bmRlZmluZWQgPyAnJyA6IF9pdGVtJGxhYmVsOw0KDQogICAgICB2YXIgZ3JvdXAgPSBncm91cElkID49IDAgPyB0aGlzLl9zdG9yZS5nZXRHcm91cEJ5SWQoZ3JvdXBJZCkgOiBudWxsOw0KDQogICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX2l0ZW1zLmhpZ2hsaWdodEl0ZW0pKGlkLCB0cnVlKSk7DQoNCiAgICAgIGlmIChydW5FdmVudCkgew0KICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLmhpZ2hsaWdodEl0ZW0sIHsNCiAgICAgICAgICBpZDogaWQsDQogICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgIGxhYmVsOiBsYWJlbCwNCiAgICAgICAgICBncm91cFZhbHVlOiBncm91cCAmJiBncm91cC52YWx1ZSA/IGdyb3VwLnZhbHVlIDogbnVsbA0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAndW5oaWdobGlnaHRJdGVtJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gdW5oaWdobGlnaHRJdGVtKGl0ZW0pIHsNCiAgICAgIGlmICghaXRlbSkgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgdmFyIGlkID0gaXRlbS5pZCwNCiAgICAgICAgICBfaXRlbSRncm91cElkMiA9IGl0ZW0uZ3JvdXBJZCwNCiAgICAgICAgICBncm91cElkID0gX2l0ZW0kZ3JvdXBJZDIgPT09IHVuZGVmaW5lZCA/IC0xIDogX2l0ZW0kZ3JvdXBJZDIsDQogICAgICAgICAgX2l0ZW0kdmFsdWUyID0gaXRlbS52YWx1ZSwNCiAgICAgICAgICB2YWx1ZSA9IF9pdGVtJHZhbHVlMiA9PT0gdW5kZWZpbmVkID8gJycgOiBfaXRlbSR2YWx1ZTIsDQogICAgICAgICAgX2l0ZW0kbGFiZWwyID0gaXRlbS5sYWJlbCwNCiAgICAgICAgICBsYWJlbCA9IF9pdGVtJGxhYmVsMiA9PT0gdW5kZWZpbmVkID8gJycgOiBfaXRlbSRsYWJlbDI7DQoNCiAgICAgIHZhciBncm91cCA9IGdyb3VwSWQgPj0gMCA/IHRoaXMuX3N0b3JlLmdldEdyb3VwQnlJZChncm91cElkKSA6IG51bGw7DQoNCiAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfaXRlbXMuaGlnaGxpZ2h0SXRlbSkoaWQsIGZhbHNlKSk7DQogICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLmhpZ2hsaWdodEl0ZW0sIHsNCiAgICAgICAgaWQ6IGlkLA0KICAgICAgICB2YWx1ZTogdmFsdWUsDQogICAgICAgIGxhYmVsOiBsYWJlbCwNCiAgICAgICAgZ3JvdXBWYWx1ZTogZ3JvdXAgJiYgZ3JvdXAudmFsdWUgPyBncm91cC52YWx1ZSA6IG51bGwNCiAgICAgIH0pOw0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdoaWdobGlnaHRBbGwnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBoaWdobGlnaHRBbGwoKSB7DQogICAgICB2YXIgX3RoaXMgPSB0aGlzOw0KDQogICAgICB0aGlzLl9zdG9yZS5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgIHJldHVybiBfdGhpcy5oaWdobGlnaHRJdGVtKGl0ZW0pOw0KICAgICAgfSk7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICd1bmhpZ2hsaWdodEFsbCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHVuaGlnaGxpZ2h0QWxsKCkgew0KICAgICAgdmFyIF90aGlzMiA9IHRoaXM7DQoNCiAgICAgIHRoaXMuX3N0b3JlLml0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIF90aGlzMi51bmhpZ2hsaWdodEl0ZW0oaXRlbSk7DQogICAgICB9KTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3JlbW92ZUFjdGl2ZUl0ZW1zQnlWYWx1ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUFjdGl2ZUl0ZW1zQnlWYWx1ZSh2YWx1ZSkgew0KICAgICAgdmFyIF90aGlzMyA9IHRoaXM7DQoNCiAgICAgIHRoaXMuX3N0b3JlLmFjdGl2ZUl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICByZXR1cm4gaXRlbS52YWx1ZSA9PT0gdmFsdWU7DQogICAgICB9KS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgIHJldHVybiBfdGhpczMuX3JlbW92ZUl0ZW0oaXRlbSk7DQogICAgICB9KTsNCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAncmVtb3ZlQWN0aXZlSXRlbXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVBY3RpdmVJdGVtcyhleGNsdWRlZElkKSB7DQogICAgICB2YXIgX3RoaXM0ID0gdGhpczsNCg0KICAgICAgdGhpcy5fc3RvcmUuYWN0aXZlSXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChfcmVmKSB7DQogICAgICAgIHZhciBpZCA9IF9yZWYuaWQ7DQogICAgICAgIHJldHVybiBpZCAhPT0gZXhjbHVkZWRJZDsNCiAgICAgIH0pLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIF90aGlzNC5fcmVtb3ZlSXRlbShpdGVtKTsNCiAgICAgIH0pOw0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdyZW1vdmVIaWdobGlnaHRlZEl0ZW1zJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlSGlnaGxpZ2h0ZWRJdGVtcygpIHsNCiAgICAgIHZhciBfdGhpczUgPSB0aGlzOw0KDQogICAgICB2YXIgcnVuRXZlbnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IGZhbHNlOw0KDQogICAgICB0aGlzLl9zdG9yZS5oaWdobGlnaHRlZEFjdGl2ZUl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgX3RoaXM1Ll9yZW1vdmVJdGVtKGl0ZW0pOw0KICAgICAgICAvLyBJZiB0aGlzIGFjdGlvbiB3YXMgcGVyZm9ybWVkIGJ5IHRoZSB1c2VyDQogICAgICAgIC8vIHRyaWdnZXIgdGhlIGV2ZW50DQogICAgICAgIGlmIChydW5FdmVudCkgew0KICAgICAgICAgIF90aGlzNS5fdHJpZ2dlckNoYW5nZShpdGVtLnZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3Nob3dEcm9wZG93bicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNob3dEcm9wZG93bihwcmV2ZW50SW5wdXRGb2N1cykgew0KICAgICAgdmFyIF90aGlzNiA9IHRoaXM7DQoNCiAgICAgIGlmICh0aGlzLmRyb3Bkb3duLmlzQWN0aXZlKSB7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgew0KICAgICAgICBfdGhpczYuZHJvcGRvd24uc2hvdygpOw0KICAgICAgICBfdGhpczYuY29udGFpbmVyT3V0ZXIub3BlbihfdGhpczYuZHJvcGRvd24uZGlzdGFuY2VGcm9tVG9wV2luZG93KCkpOw0KDQogICAgICAgIGlmICghcHJldmVudElucHV0Rm9jdXMgJiYgX3RoaXM2Ll9jYW5TZWFyY2gpIHsNCiAgICAgICAgICBfdGhpczYuaW5wdXQuZm9jdXMoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIF90aGlzNi5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5zaG93RHJvcGRvd24sIHt9KTsNCiAgICAgIH0pOw0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdoaWRlRHJvcGRvd24nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBoaWRlRHJvcGRvd24ocHJldmVudElucHV0Qmx1cikgew0KICAgICAgdmFyIF90aGlzNyA9IHRoaXM7DQoNCiAgICAgIGlmICghdGhpcy5kcm9wZG93bi5pc0FjdGl2ZSkgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgX3RoaXM3LmRyb3Bkb3duLmhpZGUoKTsNCiAgICAgICAgX3RoaXM3LmNvbnRhaW5lck91dGVyLmNsb3NlKCk7DQoNCiAgICAgICAgaWYgKCFwcmV2ZW50SW5wdXRCbHVyICYmIF90aGlzNy5fY2FuU2VhcmNoKSB7DQogICAgICAgICAgX3RoaXM3LmlucHV0LnJlbW92ZUFjdGl2ZURlc2NlbmRhbnQoKTsNCiAgICAgICAgICBfdGhpczcuaW5wdXQuYmx1cigpOw0KICAgICAgICB9DQoNCiAgICAgICAgX3RoaXM3LnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLmhpZGVEcm9wZG93biwge30pOw0KICAgICAgfSk7DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3RvZ2dsZURyb3Bkb3duJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9nZ2xlRHJvcGRvd24oKSB7DQogICAgICB0aGlzLmRyb3Bkb3duLmlzQWN0aXZlID8gdGhpcy5oaWRlRHJvcGRvd24oKSA6IHRoaXMuc2hvd0Ryb3Bkb3duKCk7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdnZXRWYWx1ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKCkgew0KICAgICAgdmFyIHZhbHVlT25seSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7DQoNCiAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtcy5yZWR1Y2UoZnVuY3Rpb24gKHNlbGVjdGVkSXRlbXMsIGl0ZW0pIHsNCiAgICAgICAgdmFyIGl0ZW1WYWx1ZSA9IHZhbHVlT25seSA/IGl0ZW0udmFsdWUgOiBpdGVtOw0KICAgICAgICBzZWxlY3RlZEl0ZW1zLnB1c2goaXRlbVZhbHVlKTsNCiAgICAgICAgcmV0dXJuIHNlbGVjdGVkSXRlbXM7DQogICAgICB9LCBbXSk7DQoNCiAgICAgIHJldHVybiB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQgPyB2YWx1ZXNbMF0gOiB2YWx1ZXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnc2V0VmFsdWUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZShhcmdzKSB7DQogICAgICB2YXIgX3RoaXM4ID0gdGhpczsNCg0KICAgICAgaWYgKCF0aGlzLmluaXRpYWxpc2VkKSB7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGFyZ3MpKS5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSkgew0KICAgICAgICByZXR1cm4gX3RoaXM4Ll9zZXRDaG9pY2VPckl0ZW0odmFsdWUpOw0KICAgICAgfSk7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdzZXRDaG9pY2VCeVZhbHVlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q2hvaWNlQnlWYWx1ZSh2YWx1ZSkgew0KICAgICAgdmFyIF90aGlzOSA9IHRoaXM7DQoNCiAgICAgIGlmICghdGhpcy5pbml0aWFsaXNlZCB8fCB0aGlzLl9pc1RleHRFbGVtZW50KSB7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICAvLyBJZiBvbmx5IG9uZSB2YWx1ZSBoYXMgYmVlbiBwYXNzZWQsIGNvbnZlcnQgdG8gYXJyYXkNCiAgICAgIHZhciBjaG9pY2VWYWx1ZSA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnQXJyYXknLCB2YWx1ZSkgPyB2YWx1ZSA6IFt2YWx1ZV07DQoNCiAgICAgIC8vIExvb3AgdGhyb3VnaCBlYWNoIHZhbHVlIGFuZA0KICAgICAgY2hvaWNlVmFsdWUuZm9yRWFjaChmdW5jdGlvbiAodmFsKSB7DQogICAgICAgIHJldHVybiBfdGhpczkuX2ZpbmRBbmRTZWxlY3RDaG9pY2VCeVZhbHVlKHZhbCk7DQogICAgICB9KTsNCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnc2V0Q2hvaWNlcycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNldENob2ljZXMoKSB7DQogICAgICB2YXIgY2hvaWNlcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107DQogICAgICB2YXIgdmFsdWUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICcnOw0KDQogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7DQoNCiAgICAgIHZhciBsYWJlbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogJyc7DQogICAgICB2YXIgcmVwbGFjZUNob2ljZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IGZhbHNlOw0KDQogICAgICBpZiAoIXRoaXMuX2lzU2VsZWN0RWxlbWVudCB8fCAhY2hvaWNlcy5sZW5ndGggfHwgIXZhbHVlKSB7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICAvLyBDbGVhciBjaG9pY2VzIGlmIG5lZWRlZA0KICAgICAgaWYgKHJlcGxhY2VDaG9pY2VzKSB7DQogICAgICAgIHRoaXMuX2NsZWFyQ2hvaWNlcygpOw0KICAgICAgfQ0KDQogICAgICB0aGlzLmNvbnRhaW5lck91dGVyLnJlbW92ZUxvYWRpbmdTdGF0ZSgpOw0KICAgICAgdmFyIGFkZEdyb3Vwc0FuZENob2ljZXMgPSBmdW5jdGlvbiBhZGRHcm91cHNBbmRDaG9pY2VzKGdyb3VwT3JDaG9pY2UpIHsNCiAgICAgICAgaWYgKGdyb3VwT3JDaG9pY2UuY2hvaWNlcykgew0KICAgICAgICAgIF90aGlzMTAuX2FkZEdyb3VwKHsNCiAgICAgICAgICAgIGdyb3VwOiBncm91cE9yQ2hvaWNlLA0KICAgICAgICAgICAgaWQ6IGdyb3VwT3JDaG9pY2UuaWQgfHwgbnVsbCwNCiAgICAgICAgICAgIHZhbHVlS2V5OiB2YWx1ZSwNCiAgICAgICAgICAgIGxhYmVsS2V5OiBsYWJlbA0KICAgICAgICAgIH0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIF90aGlzMTAuX2FkZENob2ljZSh7DQogICAgICAgICAgICB2YWx1ZTogZ3JvdXBPckNob2ljZVt2YWx1ZV0sDQogICAgICAgICAgICBsYWJlbDogZ3JvdXBPckNob2ljZVtsYWJlbF0sDQogICAgICAgICAgICBpc1NlbGVjdGVkOiBncm91cE9yQ2hvaWNlLnNlbGVjdGVkLA0KICAgICAgICAgICAgaXNEaXNhYmxlZDogZ3JvdXBPckNob2ljZS5kaXNhYmxlZCwNCiAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGdyb3VwT3JDaG9pY2UuY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBncm91cE9yQ2hvaWNlLnBsYWNlaG9sZGVyDQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH07DQoNCiAgICAgIGNob2ljZXMuZm9yRWFjaChhZGRHcm91cHNBbmRDaG9pY2VzKTsNCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnY2xlYXJTdG9yZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGNsZWFyU3RvcmUoKSB7DQogICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX21pc2MuY2xlYXJBbGwpKCkpOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnY2xlYXJJbnB1dCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGNsZWFySW5wdXQoKSB7DQogICAgICB2YXIgc2hvdWxkU2V0SW5wdXRXaWR0aCA9ICF0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQ7DQogICAgICB0aGlzLmlucHV0LmNsZWFyKHNob3VsZFNldElucHV0V2lkdGgpOw0KDQogICAgICBpZiAoIXRoaXMuX2lzVGV4dEVsZW1lbnQgJiYgdGhpcy5fY2FuU2VhcmNoKSB7DQogICAgICAgIHRoaXMuX2lzU2VhcmNoaW5nID0gZmFsc2U7DQogICAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfY2hvaWNlcy5hY3RpdmF0ZUNob2ljZXMpKHRydWUpKTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnYWpheCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGFqYXgoZm4pIHsNCiAgICAgIHZhciBfdGhpczExID0gdGhpczsNCg0KICAgICAgaWYgKCF0aGlzLmluaXRpYWxpc2VkIHx8ICF0aGlzLl9pc1NlbGVjdEVsZW1lbnQgfHwgIWZuKSB7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gX3RoaXMxMS5faGFuZGxlTG9hZGluZ1N0YXRlKHRydWUpOw0KICAgICAgfSk7DQogICAgICBmbih0aGlzLl9hamF4Q2FsbGJhY2soKSk7DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCg0KICAgIC8qID09PT09ICBFbmQgb2YgUHVibGljIGZ1bmN0aW9ucyAgPT09PT09ICovDQoNCiAgICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgICA9ICAgICAgICAgICAgICAgIFByaXZhdGUgZnVuY3Rpb25zICAgICAgICAgICAgPQ0KICAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdfcmVuZGVyJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlcigpIHsNCiAgICAgIHRoaXMuX2N1cnJlbnRTdGF0ZSA9IHRoaXMuX3N0b3JlLnN0YXRlOw0KDQogICAgICB2YXIgc3RhdGVDaGFuZ2VkID0gdGhpcy5fY3VycmVudFN0YXRlLmNob2ljZXMgIT09IHRoaXMuX3ByZXZTdGF0ZS5jaG9pY2VzIHx8IHRoaXMuX2N1cnJlbnRTdGF0ZS5ncm91cHMgIT09IHRoaXMuX3ByZXZTdGF0ZS5ncm91cHMgfHwgdGhpcy5fY3VycmVudFN0YXRlLml0ZW1zICE9PSB0aGlzLl9wcmV2U3RhdGUuaXRlbXM7DQogICAgICB2YXIgc2hvdWxkUmVuZGVyQ2hvaWNlcyA9IHRoaXMuX2lzU2VsZWN0RWxlbWVudDsNCiAgICAgIHZhciBzaG91bGRSZW5kZXJJdGVtcyA9IHRoaXMuX2N1cnJlbnRTdGF0ZS5pdGVtcyAhPT0gdGhpcy5fcHJldlN0YXRlLml0ZW1zOw0KDQogICAgICBpZiAoIXN0YXRlQ2hhbmdlZCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIGlmIChzaG91bGRSZW5kZXJDaG9pY2VzKSB7DQogICAgICAgIHRoaXMuX3JlbmRlckNob2ljZXMoKTsNCiAgICAgIH0NCg0KICAgICAgaWYgKHNob3VsZFJlbmRlckl0ZW1zKSB7DQogICAgICAgIHRoaXMuX3JlbmRlckl0ZW1zKCk7DQogICAgICB9DQoNCiAgICAgIHRoaXMuX3ByZXZTdGF0ZSA9IHRoaXMuX2N1cnJlbnRTdGF0ZTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfcmVuZGVyQ2hvaWNlcycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW5kZXJDaG9pY2VzKCkgew0KICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOw0KDQogICAgICB2YXIgX3N0b3JlID0gdGhpcy5fc3RvcmUsDQogICAgICAgICAgYWN0aXZlR3JvdXBzID0gX3N0b3JlLmFjdGl2ZUdyb3VwcywNCiAgICAgICAgICBhY3RpdmVDaG9pY2VzID0gX3N0b3JlLmFjdGl2ZUNob2ljZXM7DQoNCiAgICAgIHZhciBjaG9pY2VMaXN0RnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7DQoNCiAgICAgIHRoaXMuY2hvaWNlTGlzdC5jbGVhcigpOw0KDQogICAgICBpZiAodGhpcy5jb25maWcucmVzZXRTY3JvbGxQb3NpdGlvbikgew0KICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHJldHVybiBfdGhpczEyLmNob2ljZUxpc3Quc2Nyb2xsVG9Ub3AoKTsNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAgIC8vIElmIHdlIGhhdmUgZ3JvdXBlZCBvcHRpb25zDQogICAgICBpZiAoYWN0aXZlR3JvdXBzLmxlbmd0aCA+PSAxICYmICF0aGlzLl9pc1NlYXJjaGluZykgew0KICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgcGxhY2Vob2xkZXIgY2hvaWNlIGFsb25nIHdpdGggZ3JvdXBzDQogICAgICAgIHZhciBhY3RpdmVQbGFjZWhvbGRlcnMgPSBhY3RpdmVDaG9pY2VzLmZpbHRlcihmdW5jdGlvbiAoYWN0aXZlQ2hvaWNlKSB7DQogICAgICAgICAgcmV0dXJuIGFjdGl2ZUNob2ljZS5wbGFjZWhvbGRlciA9PT0gdHJ1ZSAmJiBhY3RpdmVDaG9pY2UuZ3JvdXBJZCA9PT0gLTE7DQogICAgICAgIH0pOw0KICAgICAgICBpZiAoYWN0aXZlUGxhY2Vob2xkZXJzLmxlbmd0aCA+PSAxKSB7DQogICAgICAgICAgY2hvaWNlTGlzdEZyYWdtZW50ID0gdGhpcy5fY3JlYXRlQ2hvaWNlc0ZyYWdtZW50KGFjdGl2ZVBsYWNlaG9sZGVycywgY2hvaWNlTGlzdEZyYWdtZW50KTsNCiAgICAgICAgfQ0KICAgICAgICBjaG9pY2VMaXN0RnJhZ21lbnQgPSB0aGlzLl9jcmVhdGVHcm91cHNGcmFnbWVudChhY3RpdmVHcm91cHMsIGFjdGl2ZUNob2ljZXMsIGNob2ljZUxpc3RGcmFnbWVudCk7DQogICAgICB9IGVsc2UgaWYgKGFjdGl2ZUNob2ljZXMubGVuZ3RoID49IDEpIHsNCiAgICAgICAgY2hvaWNlTGlzdEZyYWdtZW50ID0gdGhpcy5fY3JlYXRlQ2hvaWNlc0ZyYWdtZW50KGFjdGl2ZUNob2ljZXMsIGNob2ljZUxpc3RGcmFnbWVudCk7DQogICAgICB9DQoNCiAgICAgIC8vIElmIHdlIGhhdmUgY2hvaWNlcyB0byBzaG93DQogICAgICBpZiAoY2hvaWNlTGlzdEZyYWdtZW50LmNoaWxkTm9kZXMgJiYgY2hvaWNlTGlzdEZyYWdtZW50LmNoaWxkTm9kZXMubGVuZ3RoID4gMCkgew0KICAgICAgICB2YXIgYWN0aXZlSXRlbXMgPSB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtczsNCiAgICAgICAgdmFyIGNhbkFkZEl0ZW0gPSB0aGlzLl9jYW5BZGRJdGVtKGFjdGl2ZUl0ZW1zLCB0aGlzLmlucHV0LnZhbHVlKTsNCg0KICAgICAgICAvLyAuLi5hbmQgd2UgY2FuIHNlbGVjdCB0aGVtDQogICAgICAgIGlmIChjYW5BZGRJdGVtLnJlc3BvbnNlKSB7DQogICAgICAgICAgLy8gLi4uYXBwZW5kIHRoZW0gYW5kIGhpZ2hsaWdodCB0aGUgZmlyc3QgY2hvaWNlDQogICAgICAgICAgdGhpcy5jaG9pY2VMaXN0LmFwcGVuZChjaG9pY2VMaXN0RnJhZ21lbnQpOw0KICAgICAgICAgIHRoaXMuX2hpZ2hsaWdodENob2ljZSgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIC8vIC4uLm90aGVyd2lzZSBzaG93IGEgbm90aWNlDQogICAgICAgICAgdGhpcy5jaG9pY2VMaXN0LmFwcGVuZCh0aGlzLl9nZXRUZW1wbGF0ZSgnbm90aWNlJywgY2FuQWRkSXRlbS5ub3RpY2UpKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8gT3RoZXJ3aXNlIHNob3cgYSBub3RpY2UNCiAgICAgICAgdmFyIGRyb3Bkb3duSXRlbSA9IHZvaWQgMDsNCiAgICAgICAgdmFyIG5vdGljZSA9IHZvaWQgMDsNCg0KICAgICAgICBpZiAodGhpcy5faXNTZWFyY2hpbmcpIHsNCiAgICAgICAgICBub3RpY2UgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ0Z1bmN0aW9uJywgdGhpcy5jb25maWcubm9SZXN1bHRzVGV4dCkgPyB0aGlzLmNvbmZpZy5ub1Jlc3VsdHNUZXh0KCkgOiB0aGlzLmNvbmZpZy5ub1Jlc3VsdHNUZXh0Ow0KDQogICAgICAgICAgZHJvcGRvd25JdGVtID0gdGhpcy5fZ2V0VGVtcGxhdGUoJ25vdGljZScsIG5vdGljZSwgJ25vLXJlc3VsdHMnKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBub3RpY2UgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ0Z1bmN0aW9uJywgdGhpcy5jb25maWcubm9DaG9pY2VzVGV4dCkgPyB0aGlzLmNvbmZpZy5ub0Nob2ljZXNUZXh0KCkgOiB0aGlzLmNvbmZpZy5ub0Nob2ljZXNUZXh0Ow0KDQogICAgICAgICAgZHJvcGRvd25JdGVtID0gdGhpcy5fZ2V0VGVtcGxhdGUoJ25vdGljZScsIG5vdGljZSwgJ25vLWNob2ljZXMnKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRoaXMuY2hvaWNlTGlzdC5hcHBlbmQoZHJvcGRvd25JdGVtKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfcmVuZGVySXRlbXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVuZGVySXRlbXMoKSB7DQogICAgICB2YXIgYWN0aXZlSXRlbXMgPSB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtcyB8fCBbXTsNCiAgICAgIHRoaXMuaXRlbUxpc3QuY2xlYXIoKTsNCg0KICAgICAgLy8gQ3JlYXRlIGEgZnJhZ21lbnQgdG8gc3RvcmUgb3VyIGxpc3QgaXRlbXMNCiAgICAgIC8vIChzbyB3ZSBkb24ndCBoYXZlIHRvIHVwZGF0ZSB0aGUgRE9NIGZvciBlYWNoIGl0ZW0pDQogICAgICB2YXIgaXRlbUxpc3RGcmFnbWVudCA9IHRoaXMuX2NyZWF0ZUl0ZW1zRnJhZ21lbnQoYWN0aXZlSXRlbXMpOw0KDQogICAgICAvLyBJZiB3ZSBoYXZlIGl0ZW1zIHRvIGFkZCwgYXBwZW5kIHRoZW0NCiAgICAgIGlmIChpdGVtTGlzdEZyYWdtZW50LmNoaWxkTm9kZXMpIHsNCiAgICAgICAgdGhpcy5pdGVtTGlzdC5hcHBlbmQoaXRlbUxpc3RGcmFnbWVudCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2NyZWF0ZUdyb3Vwc0ZyYWdtZW50JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZUdyb3Vwc0ZyYWdtZW50KGdyb3VwcywgY2hvaWNlcywgZnJhZ21lbnQpIHsNCiAgICAgIHZhciBfdGhpczEzID0gdGhpczsNCg0KICAgICAgdmFyIGdyb3VwRnJhZ21lbnQgPSBmcmFnbWVudCB8fCBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7DQogICAgICB2YXIgZ2V0R3JvdXBDaG9pY2VzID0gZnVuY3Rpb24gZ2V0R3JvdXBDaG9pY2VzKGdyb3VwKSB7DQogICAgICAgIHJldHVybiBjaG9pY2VzLmZpbHRlcihmdW5jdGlvbiAoY2hvaWNlKSB7DQogICAgICAgICAgaWYgKF90aGlzMTMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICAgICAgcmV0dXJuIGNob2ljZS5ncm91cElkID09PSBncm91cC5pZDsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIGNob2ljZS5ncm91cElkID09PSBncm91cC5pZCAmJiAoX3RoaXMxMy5jb25maWcucmVuZGVyU2VsZWN0ZWRDaG9pY2VzID09PSAnYWx3YXlzJyB8fCAhY2hvaWNlLnNlbGVjdGVkKTsNCiAgICAgICAgfSk7DQogICAgICB9Ow0KDQogICAgICAvLyBJZiBzb3J0aW5nIGlzIGVuYWJsZWQsIGZpbHRlciBncm91cHMNCiAgICAgIGlmICh0aGlzLmNvbmZpZy5zaG91bGRTb3J0KSB7DQogICAgICAgIGdyb3Vwcy5zb3J0KHRoaXMuY29uZmlnLnNvcnRGbik7DQogICAgICB9DQoNCiAgICAgIGdyb3Vwcy5mb3JFYWNoKGZ1bmN0aW9uIChncm91cCkgew0KICAgICAgICB2YXIgZ3JvdXBDaG9pY2VzID0gZ2V0R3JvdXBDaG9pY2VzKGdyb3VwKTsNCiAgICAgICAgaWYgKGdyb3VwQ2hvaWNlcy5sZW5ndGggPj0gMSkgew0KICAgICAgICAgIHZhciBkcm9wZG93bkdyb3VwID0gX3RoaXMxMy5fZ2V0VGVtcGxhdGUoJ2Nob2ljZUdyb3VwJywgZ3JvdXApOw0KICAgICAgICAgIGdyb3VwRnJhZ21lbnQuYXBwZW5kQ2hpbGQoZHJvcGRvd25Hcm91cCk7DQogICAgICAgICAgX3RoaXMxMy5fY3JlYXRlQ2hvaWNlc0ZyYWdtZW50KGdyb3VwQ2hvaWNlcywgZ3JvdXBGcmFnbWVudCwgdHJ1ZSk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KDQogICAgICByZXR1cm4gZ3JvdXBGcmFnbWVudDsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfY3JlYXRlQ2hvaWNlc0ZyYWdtZW50JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZUNob2ljZXNGcmFnbWVudChjaG9pY2VzLCBmcmFnbWVudCkgew0KICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOw0KDQogICAgICB2YXIgd2l0aGluR3JvdXAgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOw0KDQogICAgICAvLyBDcmVhdGUgYSBmcmFnbWVudCB0byBzdG9yZSBvdXIgbGlzdCBpdGVtcyAoc28gd2UgZG9uJ3QgaGF2ZSB0byB1cGRhdGUgdGhlIERPTSBmb3IgZWFjaCBpdGVtKQ0KICAgICAgdmFyIGNob2ljZXNGcmFnbWVudCA9IGZyYWdtZW50IHx8IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCiAgICAgIHZhciBfY29uZmlnID0gdGhpcy5jb25maWcsDQogICAgICAgICAgcmVuZGVyU2VsZWN0ZWRDaG9pY2VzID0gX2NvbmZpZy5yZW5kZXJTZWxlY3RlZENob2ljZXMsDQogICAgICAgICAgc2VhcmNoUmVzdWx0TGltaXQgPSBfY29uZmlnLnNlYXJjaFJlc3VsdExpbWl0LA0KICAgICAgICAgIHJlbmRlckNob2ljZUxpbWl0ID0gX2NvbmZpZy5yZW5kZXJDaG9pY2VMaW1pdDsNCg0KICAgICAgdmFyIGZpbHRlciA9IHRoaXMuX2lzU2VhcmNoaW5nID8gX3V0aWxzLnNvcnRCeVNjb3JlIDogdGhpcy5jb25maWcuc29ydEZuOw0KICAgICAgdmFyIGFwcGVuZENob2ljZSA9IGZ1bmN0aW9uIGFwcGVuZENob2ljZShjaG9pY2UpIHsNCiAgICAgICAgdmFyIHNob3VsZFJlbmRlciA9IHJlbmRlclNlbGVjdGVkQ2hvaWNlcyA9PT0gJ2F1dG8nID8gX3RoaXMxNC5faXNTZWxlY3RPbmVFbGVtZW50IHx8ICFjaG9pY2Uuc2VsZWN0ZWQgOiB0cnVlOw0KICAgICAgICBpZiAoc2hvdWxkUmVuZGVyKSB7DQogICAgICAgICAgdmFyIGRyb3Bkb3duSXRlbSA9IF90aGlzMTQuX2dldFRlbXBsYXRlKCdjaG9pY2UnLCBjaG9pY2UsIF90aGlzMTQuY29uZmlnLml0ZW1TZWxlY3RUZXh0KTsNCiAgICAgICAgICBjaG9pY2VzRnJhZ21lbnQuYXBwZW5kQ2hpbGQoZHJvcGRvd25JdGVtKTsNCiAgICAgICAgfQ0KICAgICAgfTsNCg0KICAgICAgdmFyIHJlbmRlcmVyYWJsZUNob2ljZXMgPSBjaG9pY2VzOw0KDQogICAgICBpZiAocmVuZGVyU2VsZWN0ZWRDaG9pY2VzID09PSAnYXV0bycgJiYgIXRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICByZW5kZXJlcmFibGVDaG9pY2VzID0gY2hvaWNlcy5maWx0ZXIoZnVuY3Rpb24gKGNob2ljZSkgew0KICAgICAgICAgIHJldHVybiAhY2hvaWNlLnNlbGVjdGVkOw0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgLy8gU3BsaXQgYXJyYXkgaW50byBwbGFjZWhvbGRlcnMgYW5kICJub3JtYWwiIGNob2ljZXMNCg0KICAgICAgdmFyIF9yZW5kZXJlcmFibGVDaG9pY2VzJCA9IHJlbmRlcmVyYWJsZUNob2ljZXMucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGNob2ljZSkgew0KICAgICAgICBpZiAoY2hvaWNlLnBsYWNlaG9sZGVyKSB7DQogICAgICAgICAgYWNjLnBsYWNlaG9sZGVyQ2hvaWNlcy5wdXNoKGNob2ljZSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgYWNjLm5vcm1hbENob2ljZXMucHVzaChjaG9pY2UpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBhY2M7DQogICAgICB9LCB7IHBsYWNlaG9sZGVyQ2hvaWNlczogW10sIG5vcm1hbENob2ljZXM6IFtdIH0pLA0KICAgICAgICAgIHBsYWNlaG9sZGVyQ2hvaWNlcyA9IF9yZW5kZXJlcmFibGVDaG9pY2VzJC5wbGFjZWhvbGRlckNob2ljZXMsDQogICAgICAgICAgbm9ybWFsQ2hvaWNlcyA9IF9yZW5kZXJlcmFibGVDaG9pY2VzJC5ub3JtYWxDaG9pY2VzOw0KDQogICAgICAvLyBJZiBzb3J0aW5nIGlzIGVuYWJsZWQgb3IgdGhlIHVzZXIgaXMgc2VhcmNoaW5nLCBmaWx0ZXIgY2hvaWNlcw0KDQoNCiAgICAgIGlmICh0aGlzLmNvbmZpZy5zaG91bGRTb3J0IHx8IHRoaXMuX2lzU2VhcmNoaW5nKSB7DQogICAgICAgIG5vcm1hbENob2ljZXMuc29ydChmaWx0ZXIpOw0KICAgICAgfQ0KDQogICAgICB2YXIgY2hvaWNlTGltaXQgPSByZW5kZXJlcmFibGVDaG9pY2VzLmxlbmd0aDsNCg0KICAgICAgLy8gUHJlcGVuZCBwbGFjZWhvbGVkZXINCiAgICAgIHZhciBzb3J0ZWRDaG9pY2VzID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShwbGFjZWhvbGRlckNob2ljZXMpLCBfdG9Db25zdW1hYmxlQXJyYXkobm9ybWFsQ2hvaWNlcykpOw0KDQogICAgICBpZiAodGhpcy5faXNTZWFyY2hpbmcpIHsNCiAgICAgICAgY2hvaWNlTGltaXQgPSBzZWFyY2hSZXN1bHRMaW1pdDsNCiAgICAgIH0gZWxzZSBpZiAocmVuZGVyQ2hvaWNlTGltaXQgPiAwICYmICF3aXRoaW5Hcm91cCkgew0KICAgICAgICBjaG9pY2VMaW1pdCA9IHJlbmRlckNob2ljZUxpbWl0Ow0KICAgICAgfQ0KDQogICAgICAvLyBBZGQgZWFjaCBjaG9pY2UgdG8gZHJvcGRvd24gd2l0aGluIHJhbmdlDQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNob2ljZUxpbWl0OyBpICs9IDEpIHsNCiAgICAgICAgaWYgKHNvcnRlZENob2ljZXNbaV0pIHsNCiAgICAgICAgICBhcHBlbmRDaG9pY2Uoc29ydGVkQ2hvaWNlc1tpXSk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIGNob2ljZXNGcmFnbWVudDsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfY3JlYXRlSXRlbXNGcmFnbWVudCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVJdGVtc0ZyYWdtZW50KGl0ZW1zKSB7DQogICAgICB2YXIgX3RoaXMxNSA9IHRoaXM7DQoNCiAgICAgIHZhciBmcmFnbWVudCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogbnVsbDsNCg0KICAgICAgLy8gQ3JlYXRlIGZyYWdtZW50IHRvIGFkZCBlbGVtZW50cyB0bw0KICAgICAgdmFyIF9jb25maWcyID0gdGhpcy5jb25maWcsDQogICAgICAgICAgc2hvdWxkU29ydEl0ZW1zID0gX2NvbmZpZzIuc2hvdWxkU29ydEl0ZW1zLA0KICAgICAgICAgIHNvcnRGbiA9IF9jb25maWcyLnNvcnRGbiwNCiAgICAgICAgICByZW1vdmVJdGVtQnV0dG9uID0gX2NvbmZpZzIucmVtb3ZlSXRlbUJ1dHRvbjsNCg0KICAgICAgdmFyIGl0ZW1MaXN0RnJhZ21lbnQgPSBmcmFnbWVudCB8fCBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7DQoNCiAgICAgIC8vIElmIHNvcnRpbmcgaXMgZW5hYmxlZCwgZmlsdGVyIGl0ZW1zDQogICAgICBpZiAoc2hvdWxkU29ydEl0ZW1zICYmICF0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgaXRlbXMuc29ydChzb3J0Rm4pOw0KICAgICAgfQ0KDQogICAgICBpZiAodGhpcy5faXNUZXh0RWxlbWVudCkgew0KICAgICAgICAvLyBVcGRhdGUgdGhlIHZhbHVlIG9mIHRoZSBoaWRkZW4gaW5wdXQNCiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnZhbHVlID0gaXRlbXM7DQogICAgICB9IGVsc2Ugew0KICAgICAgICAvLyBVcGRhdGUgdGhlIG9wdGlvbnMgb2YgdGhlIGhpZGRlbiBpbnB1dA0KICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQub3B0aW9ucyA9IGl0ZW1zOw0KICAgICAgfQ0KDQogICAgICB2YXIgYWRkSXRlbVRvRnJhZ21lbnQgPSBmdW5jdGlvbiBhZGRJdGVtVG9GcmFnbWVudChpdGVtKSB7DQogICAgICAgIC8vIENyZWF0ZSBuZXcgbGlzdCBlbGVtZW50DQogICAgICAgIHZhciBsaXN0SXRlbSA9IF90aGlzMTUuX2dldFRlbXBsYXRlKCdpdGVtJywgaXRlbSwgcmVtb3ZlSXRlbUJ1dHRvbik7DQogICAgICAgIC8vIEFwcGVuZCBpdCB0byBsaXN0DQogICAgICAgIGl0ZW1MaXN0RnJhZ21lbnQuYXBwZW5kQ2hpbGQobGlzdEl0ZW0pOw0KICAgICAgfTsNCg0KICAgICAgLy8gQWRkIGVhY2ggbGlzdCBpdGVtIHRvIGxpc3QNCiAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIGFkZEl0ZW1Ub0ZyYWdtZW50KGl0ZW0pOw0KICAgICAgfSk7DQoNCiAgICAgIHJldHVybiBpdGVtTGlzdEZyYWdtZW50Ow0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ190cmlnZ2VyQ2hhbmdlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3RyaWdnZXJDaGFuZ2UodmFsdWUpIHsNCiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5jaGFuZ2UsIHsNCiAgICAgICAgdmFsdWU6IHZhbHVlDQogICAgICB9KTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfc2VsZWN0UGxhY2Vob2xkZXJDaG9pY2UnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfc2VsZWN0UGxhY2Vob2xkZXJDaG9pY2UoKSB7DQogICAgICB2YXIgcGxhY2Vob2xkZXJDaG9pY2UgPSB0aGlzLl9zdG9yZS5wbGFjZWhvbGRlckNob2ljZTsNCg0KICAgICAgaWYgKHBsYWNlaG9sZGVyQ2hvaWNlKSB7DQogICAgICAgIHRoaXMuX2FkZEl0ZW0oew0KICAgICAgICAgIHZhbHVlOiBwbGFjZWhvbGRlckNob2ljZS52YWx1ZSwNCiAgICAgICAgICBsYWJlbDogcGxhY2Vob2xkZXJDaG9pY2UubGFiZWwsDQogICAgICAgICAgY2hvaWNlSWQ6IHBsYWNlaG9sZGVyQ2hvaWNlLmlkLA0KICAgICAgICAgIGdyb3VwSWQ6IHBsYWNlaG9sZGVyQ2hvaWNlLmdyb3VwSWQsDQogICAgICAgICAgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyQ2hvaWNlLnBsYWNlaG9sZGVyDQogICAgICAgIH0pOw0KDQogICAgICAgIHRoaXMuX3RyaWdnZXJDaGFuZ2UocGxhY2Vob2xkZXJDaG9pY2UudmFsdWUpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19oYW5kbGVCdXR0b25BY3Rpb24nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlQnV0dG9uQWN0aW9uKGFjdGl2ZUl0ZW1zLCBlbGVtZW50KSB7DQogICAgICBpZiAoIWFjdGl2ZUl0ZW1zIHx8ICFlbGVtZW50IHx8ICF0aGlzLmNvbmZpZy5yZW1vdmVJdGVtcyB8fCAhdGhpcy5jb25maWcucmVtb3ZlSXRlbUJ1dHRvbikgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHZhciBpdGVtSWQgPSBlbGVtZW50LnBhcmVudE5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7DQogICAgICB2YXIgaXRlbVRvUmVtb3ZlID0gYWN0aXZlSXRlbXMuZmluZChmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICByZXR1cm4gaXRlbS5pZCA9PT0gcGFyc2VJbnQoaXRlbUlkLCAxMCk7DQogICAgICB9KTsNCg0KICAgICAgLy8gUmVtb3ZlIGl0ZW0gYXNzb2NpYXRlZCB3aXRoIGJ1dHRvbg0KICAgICAgdGhpcy5fcmVtb3ZlSXRlbShpdGVtVG9SZW1vdmUpOw0KICAgICAgdGhpcy5fdHJpZ2dlckNoYW5nZShpdGVtVG9SZW1vdmUudmFsdWUpOw0KDQogICAgICBpZiAodGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIHRoaXMuX3NlbGVjdFBsYWNlaG9sZGVyQ2hvaWNlKCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2hhbmRsZUl0ZW1BY3Rpb24nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlSXRlbUFjdGlvbihhY3RpdmVJdGVtcywgZWxlbWVudCkgew0KICAgICAgdmFyIF90aGlzMTYgPSB0aGlzOw0KDQogICAgICB2YXIgaGFzU2hpZnRLZXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOw0KDQogICAgICBpZiAoIWFjdGl2ZUl0ZW1zIHx8ICFlbGVtZW50IHx8ICF0aGlzLmNvbmZpZy5yZW1vdmVJdGVtcyB8fCB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB2YXIgcGFzc2VkSWQgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpOw0KDQogICAgICAvLyBXZSBvbmx5IHdhbnQgdG8gc2VsZWN0IG9uZSBpdGVtIHdpdGggYSBjbGljaw0KICAgICAgLy8gc28gd2UgZGVzZWxlY3QgYW55IGl0ZW1zIHRoYXQgYXJlbid0IHRoZSB0YXJnZXQNCiAgICAgIC8vIHVubGVzcyBzaGlmdCBpcyBiZWluZyBwcmVzc2VkDQogICAgICBhY3RpdmVJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgIGlmIChpdGVtLmlkID09PSBwYXJzZUludChwYXNzZWRJZCwgMTApICYmICFpdGVtLmhpZ2hsaWdodGVkKSB7DQogICAgICAgICAgX3RoaXMxNi5oaWdobGlnaHRJdGVtKGl0ZW0pOw0KICAgICAgICB9IGVsc2UgaWYgKCFoYXNTaGlmdEtleSAmJiBpdGVtLmhpZ2hsaWdodGVkKSB7DQogICAgICAgICAgX3RoaXMxNi51bmhpZ2hsaWdodEl0ZW0oaXRlbSk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KDQogICAgICAvLyBGb2N1cyBpbnB1dCBhcyB3aXRob3V0IGZvY3VzLCBhIHVzZXIgY2Fubm90IGRvIGFueXRoaW5nIHdpdGggYQ0KICAgICAgLy8gaGlnaGxpZ2h0ZWQgaXRlbQ0KICAgICAgdGhpcy5pbnB1dC5mb2N1cygpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19oYW5kbGVDaG9pY2VBY3Rpb24nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlQ2hvaWNlQWN0aW9uKGFjdGl2ZUl0ZW1zLCBlbGVtZW50KSB7DQogICAgICBpZiAoIWFjdGl2ZUl0ZW1zIHx8ICFlbGVtZW50KSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgLy8gSWYgd2UgYXJlIGNsaWNraW5nIG9uIGFuIG9wdGlvbg0KICAgICAgdmFyIGlkID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTsNCiAgICAgIHZhciBjaG9pY2UgPSB0aGlzLl9zdG9yZS5nZXRDaG9pY2VCeUlkKGlkKTsNCiAgICAgIHZhciBwYXNzZWRLZXlDb2RlID0gYWN0aXZlSXRlbXNbMF0gJiYgYWN0aXZlSXRlbXNbMF0ua2V5Q29kZSA/IGFjdGl2ZUl0ZW1zWzBdLmtleUNvZGUgOiBudWxsOw0KICAgICAgdmFyIGhhc0FjdGl2ZURyb3Bkb3duID0gdGhpcy5kcm9wZG93bi5pc0FjdGl2ZTsNCg0KICAgICAgLy8gVXBkYXRlIGNob2ljZSBrZXlDb2RlDQogICAgICBjaG9pY2Uua2V5Q29kZSA9IHBhc3NlZEtleUNvZGU7DQoNCiAgICAgIHRoaXMucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMuY2hvaWNlLCB7DQogICAgICAgIGNob2ljZTogY2hvaWNlDQogICAgICB9KTsNCg0KICAgICAgaWYgKGNob2ljZSAmJiAhY2hvaWNlLnNlbGVjdGVkICYmICFjaG9pY2UuZGlzYWJsZWQpIHsNCiAgICAgICAgdmFyIGNhbkFkZEl0ZW0gPSB0aGlzLl9jYW5BZGRJdGVtKGFjdGl2ZUl0ZW1zLCBjaG9pY2UudmFsdWUpOw0KDQogICAgICAgIGlmIChjYW5BZGRJdGVtLnJlc3BvbnNlKSB7DQogICAgICAgICAgdGhpcy5fYWRkSXRlbSh7DQogICAgICAgICAgICB2YWx1ZTogY2hvaWNlLnZhbHVlLA0KICAgICAgICAgICAgbGFiZWw6IGNob2ljZS5sYWJlbCwNCiAgICAgICAgICAgIGNob2ljZUlkOiBjaG9pY2UuaWQsDQogICAgICAgICAgICBncm91cElkOiBjaG9pY2UuZ3JvdXBJZCwNCiAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGNob2ljZS5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGNob2ljZS5wbGFjZWhvbGRlciwNCiAgICAgICAgICAgIGtleUNvZGU6IGNob2ljZS5rZXlDb2RlDQogICAgICAgICAgfSk7DQoNCiAgICAgICAgICB0aGlzLl90cmlnZ2VyQ2hhbmdlKGNob2ljZS52YWx1ZSk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgdGhpcy5jbGVhcklucHV0KCk7DQoNCiAgICAgIC8vIFdlIHdvbnQgdG8gY2xvc2UgdGhlIGRyb3Bkb3duIGlmIHdlIGFyZSBkZWFsaW5nIHdpdGggYSBzaW5nbGUgc2VsZWN0IGJveA0KICAgICAgaWYgKGhhc0FjdGl2ZURyb3Bkb3duICYmIHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICB0aGlzLmhpZGVEcm9wZG93bih0cnVlKTsNCiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5mb2N1cygpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19oYW5kbGVCYWNrc3BhY2UnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlQmFja3NwYWNlKGFjdGl2ZUl0ZW1zKSB7DQogICAgICBpZiAoIXRoaXMuY29uZmlnLnJlbW92ZUl0ZW1zIHx8ICFhY3RpdmVJdGVtcykgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHZhciBsYXN0SXRlbSA9IGFjdGl2ZUl0ZW1zW2FjdGl2ZUl0ZW1zLmxlbmd0aCAtIDFdOw0KICAgICAgdmFyIGhhc0hpZ2hsaWdodGVkSXRlbXMgPSBhY3RpdmVJdGVtcy5zb21lKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgIHJldHVybiBpdGVtLmhpZ2hsaWdodGVkOw0KICAgICAgfSk7DQoNCiAgICAgIC8vIElmIGVkaXRpbmcgdGhlIGxhc3QgaXRlbSBpcyBhbGxvd2VkIGFuZCB0aGVyZSBhcmUgbm90IG90aGVyIHNlbGVjdGVkIGl0ZW1zLA0KICAgICAgLy8gd2UgY2FuIGVkaXQgdGhlIGl0ZW0gdmFsdWUuIE90aGVyd2lzZSBpZiB3ZSBjYW4gcmVtb3ZlIGl0ZW1zLCByZW1vdmUgYWxsIHNlbGVjdGVkIGl0ZW1zDQogICAgICBpZiAodGhpcy5jb25maWcuZWRpdEl0ZW1zICYmICFoYXNIaWdobGlnaHRlZEl0ZW1zICYmIGxhc3RJdGVtKSB7DQogICAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBsYXN0SXRlbS52YWx1ZTsNCiAgICAgICAgdGhpcy5pbnB1dC5zZXRXaWR0aCgpOw0KICAgICAgICB0aGlzLl9yZW1vdmVJdGVtKGxhc3RJdGVtKTsNCiAgICAgICAgdGhpcy5fdHJpZ2dlckNoYW5nZShsYXN0SXRlbS52YWx1ZSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBpZiAoIWhhc0hpZ2hsaWdodGVkSXRlbXMpIHsNCiAgICAgICAgICAvLyBIaWdobGlnaHQgbGFzdCBpdGVtIGlmIG5vbmUgYWxyZWFkeSBoaWdobGlnaHRlZA0KICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0SXRlbShsYXN0SXRlbSwgZmFsc2UpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMucmVtb3ZlSGlnaGxpZ2h0ZWRJdGVtcyh0cnVlKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfaGFuZGxlTG9hZGluZ1N0YXRlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZUxvYWRpbmdTdGF0ZSgpIHsNCiAgICAgIHZhciBpc0xvYWRpbmcgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHRydWU7DQoNCiAgICAgIHZhciBwbGFjZWhvbGRlckl0ZW0gPSB0aGlzLml0ZW1MaXN0LmdldENoaWxkKCcuJyArIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMucGxhY2Vob2xkZXIpOw0KDQogICAgICBpZiAoaXNMb2FkaW5nKSB7DQogICAgICAgIHRoaXMuZGlzYWJsZSgpOw0KICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLmFkZExvYWRpbmdTdGF0ZSgpOw0KDQogICAgICAgIGlmICh0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgICBpZiAoIXBsYWNlaG9sZGVySXRlbSkgew0KICAgICAgICAgICAgcGxhY2Vob2xkZXJJdGVtID0gdGhpcy5fZ2V0VGVtcGxhdGUoJ3BsYWNlaG9sZGVyJywgdGhpcy5jb25maWcubG9hZGluZ1RleHQpOw0KICAgICAgICAgICAgdGhpcy5pdGVtTGlzdC5hcHBlbmQocGxhY2Vob2xkZXJJdGVtKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcGxhY2Vob2xkZXJJdGVtLmlubmVySFRNTCA9IHRoaXMuY29uZmlnLmxvYWRpbmdUZXh0Ow0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLmlucHV0LnBsYWNlaG9sZGVyID0gdGhpcy5jb25maWcubG9hZGluZ1RleHQ7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuZW5hYmxlKCk7DQogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIucmVtb3ZlTG9hZGluZ1N0YXRlKCk7DQoNCiAgICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICAgIHBsYWNlaG9sZGVySXRlbS5pbm5lckhUTUwgPSB0aGlzLl9wbGFjZWhvbGRlclZhbHVlIHx8ICcnOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMuaW5wdXQucGxhY2Vob2xkZXIgPSB0aGlzLl9wbGFjZWhvbGRlclZhbHVlIHx8ICcnOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2hhbmRsZVNlYXJjaCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVTZWFyY2godmFsdWUpIHsNCiAgICAgIGlmICghdmFsdWUgfHwgIXRoaXMuaW5wdXQuaXNGb2N1c3NlZCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHZhciBjaG9pY2VzID0gdGhpcy5fc3RvcmUuY2hvaWNlczsNCiAgICAgIHZhciBfY29uZmlnMyA9IHRoaXMuY29uZmlnLA0KICAgICAgICAgIHNlYXJjaEZsb29yID0gX2NvbmZpZzMuc2VhcmNoRmxvb3IsDQogICAgICAgICAgc2VhcmNoQ2hvaWNlcyA9IF9jb25maWczLnNlYXJjaENob2ljZXM7DQoNCiAgICAgIHZhciBoYXNVbmFjdGl2ZUNob2ljZXMgPSBjaG9pY2VzLnNvbWUoZnVuY3Rpb24gKG9wdGlvbikgew0KICAgICAgICByZXR1cm4gIW9wdGlvbi5hY3RpdmU7DQogICAgICB9KTsNCg0KICAgICAgLy8gQ2hlY2sgdGhhdCB3ZSBoYXZlIGEgdmFsdWUgdG8gc2VhcmNoIGFuZCB0aGUgaW5wdXQgd2FzIGFuIGFscGhhbnVtZXJpYyBjaGFyYWN0ZXINCiAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5sZW5ndGggPj0gc2VhcmNoRmxvb3IpIHsNCiAgICAgICAgdmFyIHJlc3VsdENvdW50ID0gc2VhcmNoQ2hvaWNlcyA/IHRoaXMuX3NlYXJjaENob2ljZXModmFsdWUpIDogMDsNCiAgICAgICAgLy8gVHJpZ2dlciBzZWFyY2ggZXZlbnQNCiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5zZWFyY2gsIHsNCiAgICAgICAgICB2YWx1ZTogdmFsdWUsDQogICAgICAgICAgcmVzdWx0Q291bnQ6IHJlc3VsdENvdW50DQogICAgICAgIH0pOw0KICAgICAgfSBlbHNlIGlmIChoYXNVbmFjdGl2ZUNob2ljZXMpIHsNCiAgICAgICAgLy8gT3RoZXJ3aXNlIHJlc2V0IGNob2ljZXMgdG8gYWN0aXZlDQogICAgICAgIHRoaXMuX2lzU2VhcmNoaW5nID0gZmFsc2U7DQogICAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfY2hvaWNlcy5hY3RpdmF0ZUNob2ljZXMpKHRydWUpKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfY2FuQWRkSXRlbScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9jYW5BZGRJdGVtKGFjdGl2ZUl0ZW1zLCB2YWx1ZSkgew0KICAgICAgdmFyIGNhbkFkZEl0ZW0gPSB0cnVlOw0KICAgICAgdmFyIG5vdGljZSA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnRnVuY3Rpb24nLCB0aGlzLmNvbmZpZy5hZGRJdGVtVGV4dCkgPyB0aGlzLmNvbmZpZy5hZGRJdGVtVGV4dCh2YWx1ZSkgOiB0aGlzLmNvbmZpZy5hZGRJdGVtVGV4dDsNCg0KICAgICAgaWYgKCF0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgdmFyIGlzRHVwbGljYXRlVmFsdWUgPSAoMCwgX3V0aWxzLmV4aXN0c0luQXJyYXkpKGFjdGl2ZUl0ZW1zLCB2YWx1ZSk7DQoNCiAgICAgICAgaWYgKHRoaXMuY29uZmlnLm1heEl0ZW1Db3VudCA+IDAgJiYgdGhpcy5jb25maWcubWF4SXRlbUNvdW50IDw9IGFjdGl2ZUl0ZW1zLmxlbmd0aCkgew0KICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGEgbWF4IGVudHJ5IGxpbWl0IGFuZCB3ZSBoYXZlIHJlYWNoZWQgdGhhdCBsaW1pdA0KICAgICAgICAgIC8vIGRvbid0IHVwZGF0ZQ0KICAgICAgICAgIGNhbkFkZEl0ZW0gPSBmYWxzZTsNCiAgICAgICAgICBub3RpY2UgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ0Z1bmN0aW9uJywgdGhpcy5jb25maWcubWF4SXRlbVRleHQpID8gdGhpcy5jb25maWcubWF4SXRlbVRleHQodGhpcy5jb25maWcubWF4SXRlbUNvdW50KSA6IHRoaXMuY29uZmlnLm1heEl0ZW1UZXh0Ow0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHRoaXMuY29uZmlnLnJlZ2V4RmlsdGVyICYmIHRoaXMuX2lzVGV4dEVsZW1lbnQgJiYgdGhpcy5jb25maWcuYWRkSXRlbXMgJiYgY2FuQWRkSXRlbSkgew0KICAgICAgICAgIC8vIElmIGEgdXNlciBoYXMgc3VwcGxpZWQgYSByZWd1bGFyIGV4cHJlc3Npb24gZmlsdGVyDQogICAgICAgICAgLy8gZGV0ZXJtaW5lIHdoZXRoZXIgd2UgY2FuIHVwZGF0ZSBiYXNlZCBvbiB3aGV0aGVyDQogICAgICAgICAgLy8gb3VyIHJlZ3VsYXIgZXhwcmVzc2lvbiBwYXNzZXMNCiAgICAgICAgICBjYW5BZGRJdGVtID0gKDAsIF91dGlscy5yZWdleEZpbHRlcikodmFsdWUsIHRoaXMuY29uZmlnLnJlZ2V4RmlsdGVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICghdGhpcy5jb25maWcuZHVwbGljYXRlSXRlbXNBbGxvd2VkICYmIGlzRHVwbGljYXRlVmFsdWUgJiYgY2FuQWRkSXRlbSkgew0KICAgICAgICAgIGNhbkFkZEl0ZW0gPSBmYWxzZTsNCiAgICAgICAgICBub3RpY2UgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ0Z1bmN0aW9uJywgdGhpcy5jb25maWcudW5pcXVlSXRlbVRleHQpID8gdGhpcy5jb25maWcudW5pcXVlSXRlbVRleHQodmFsdWUpIDogdGhpcy5jb25maWcudW5pcXVlSXRlbVRleHQ7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgcmVzcG9uc2U6IGNhbkFkZEl0ZW0sDQogICAgICAgIG5vdGljZTogbm90aWNlDQogICAgICB9Ow0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19hamF4Q2FsbGJhY2snLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfYWpheENhbGxiYWNrKCkgew0KICAgICAgdmFyIF90aGlzMTcgPSB0aGlzOw0KDQogICAgICByZXR1cm4gZnVuY3Rpb24gKHJlc3VsdHMsIHZhbHVlLCBsYWJlbCkgew0KICAgICAgICBpZiAoIXJlc3VsdHMgfHwgIXZhbHVlKSB7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIHBhcnNlZFJlc3VsdHMgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ09iamVjdCcsIHJlc3VsdHMpID8gW3Jlc3VsdHNdIDogcmVzdWx0czsNCg0KICAgICAgICBpZiAocGFyc2VkUmVzdWx0cyAmJiAoMCwgX3V0aWxzLmlzVHlwZSkoJ0FycmF5JywgcGFyc2VkUmVzdWx0cykgJiYgcGFyc2VkUmVzdWx0cy5sZW5ndGgpIHsNCiAgICAgICAgICAvLyBSZW1vdmUgbG9hZGluZyBzdGF0ZXMvdGV4dA0KICAgICAgICAgIF90aGlzMTcuX2hhbmRsZUxvYWRpbmdTdGF0ZShmYWxzZSk7DQogICAgICAgICAgLy8gQWRkIGVhY2ggcmVzdWx0IGFzIGEgY2hvaWNlDQogICAgICAgICAgcGFyc2VkUmVzdWx0cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXN1bHQpIHsNCiAgICAgICAgICAgIGlmIChyZXN1bHQuY2hvaWNlcykgew0KICAgICAgICAgICAgICBfdGhpczE3Ll9hZGRHcm91cCh7DQogICAgICAgICAgICAgICAgZ3JvdXA6IHJlc3VsdCwNCiAgICAgICAgICAgICAgICBpZDogcmVzdWx0LmlkIHx8IG51bGwsDQogICAgICAgICAgICAgICAgdmFsdWVLZXk6IHZhbHVlLA0KICAgICAgICAgICAgICAgIGxhYmVsS2V5OiBsYWJlbA0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIF90aGlzMTcuX2FkZENob2ljZSh7DQogICAgICAgICAgICAgICAgdmFsdWU6ICgwLCBfdXRpbHMuZmV0Y2hGcm9tT2JqZWN0KShyZXN1bHQsIHZhbHVlKSwNCiAgICAgICAgICAgICAgICBsYWJlbDogKDAsIF91dGlscy5mZXRjaEZyb21PYmplY3QpKHJlc3VsdCwgbGFiZWwpLA0KICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IHJlc3VsdC5zZWxlY3RlZCwNCiAgICAgICAgICAgICAgICBpc0Rpc2FibGVkOiByZXN1bHQuZGlzYWJsZWQsDQogICAgICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllczogcmVzdWx0LmN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IHJlc3VsdC5wbGFjZWhvbGRlcg0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCg0KICAgICAgICAgIGlmIChfdGhpczE3Ll9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgICAgIF90aGlzMTcuX3NlbGVjdFBsYWNlaG9sZGVyQ2hvaWNlKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIC8vIE5vIHJlc3VsdHMsIHJlbW92ZSBsb2FkaW5nIHN0YXRlDQogICAgICAgICAgX3RoaXMxNy5faGFuZGxlTG9hZGluZ1N0YXRlKGZhbHNlKTsNCiAgICAgICAgfQ0KICAgICAgfTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfc2VhcmNoQ2hvaWNlcycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9zZWFyY2hDaG9pY2VzKHZhbHVlKSB7DQogICAgICB2YXIgbmV3VmFsdWUgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ1N0cmluZycsIHZhbHVlKSA/IHZhbHVlLnRyaW0oKSA6IHZhbHVlOw0KICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnU3RyaW5nJywgdGhpcy5fY3VycmVudFZhbHVlKSA/IHRoaXMuX2N1cnJlbnRWYWx1ZS50cmltKCkgOiB0aGlzLl9jdXJyZW50VmFsdWU7DQoNCiAgICAgIGlmIChuZXdWYWx1ZS5sZW5ndGggPCAxICYmIG5ld1ZhbHVlID09PSBjdXJyZW50VmFsdWUgKyAnICcpIHsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgICB9DQoNCiAgICAgIC8vIElmIG5ldyB2YWx1ZSBtYXRjaGVzIHRoZSBkZXNpcmVkIGxlbmd0aCBhbmQgaXMgbm90IHRoZSBzYW1lIGFzIHRoZSBjdXJyZW50IHZhbHVlIHdpdGggYSBzcGFjZQ0KICAgICAgdmFyIGhheXN0YWNrID0gdGhpcy5fc3RvcmUuc2VhcmNoYWJsZUNob2ljZXM7DQogICAgICB2YXIgbmVlZGxlID0gbmV3VmFsdWU7DQogICAgICB2YXIga2V5cyA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5jb25maWcuc2VhcmNoRmllbGRzKSk7DQogICAgICB2YXIgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24odGhpcy5jb25maWcuZnVzZU9wdGlvbnMsIHsga2V5czoga2V5cyB9KTsNCiAgICAgIHZhciBmdXNlID0gbmV3IF9mdXNlMi5kZWZhdWx0KGhheXN0YWNrLCBvcHRpb25zKTsNCiAgICAgIHZhciByZXN1bHRzID0gZnVzZS5zZWFyY2gobmVlZGxlKTsNCg0KICAgICAgdGhpcy5fY3VycmVudFZhbHVlID0gbmV3VmFsdWU7DQogICAgICB0aGlzLl9oaWdobGlnaHRQb3NpdGlvbiA9IDA7DQogICAgICB0aGlzLl9pc1NlYXJjaGluZyA9IHRydWU7DQogICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX2Nob2ljZXMuZmlsdGVyQ2hvaWNlcykocmVzdWx0cykpOw0KDQogICAgICByZXR1cm4gcmVzdWx0cy5sZW5ndGg7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2FkZEV2ZW50TGlzdGVuZXJzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZEV2ZW50TGlzdGVuZXJzKCkgew0KICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLl9vbktleVVwKTsNCiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9vbktleURvd24pOw0KICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9vbkNsaWNrKTsNCiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMuX29uVG91Y2hNb3ZlKTsNCiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5fb25Ub3VjaEVuZCk7DQogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLl9vbk1vdXNlRG93bik7DQogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCB0aGlzLl9vbk1vdXNlT3Zlcik7DQoNCiAgICAgIGlmICh0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fb25Gb2N1cyk7DQogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5fb25CbHVyKTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5pbnB1dC5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fb25Gb2N1cyk7DQogICAgICB0aGlzLmlucHV0LmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIHRoaXMuX29uQmx1cik7DQoNCiAgICAgIGlmICh0aGlzLmlucHV0LmVsZW1lbnQuZm9ybSkgew0KICAgICAgICB0aGlzLmlucHV0LmVsZW1lbnQuZm9ybS5hZGRFdmVudExpc3RlbmVyKCdyZXNldCcsIHRoaXMuX29uRm9ybVJlc2V0KTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5pbnB1dC5hZGRFdmVudExpc3RlbmVycygpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19yZW1vdmVFdmVudExpc3RlbmVycycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW1vdmVFdmVudExpc3RlbmVycygpIHsNCiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5fb25LZXlVcCk7DQogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5fb25LZXlEb3duKTsNCiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fb25DbGljayk7DQogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLl9vblRvdWNoTW92ZSk7DQogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMuX29uVG91Y2hFbmQpOw0KICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5fb25Nb3VzZURvd24pOw0KICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgdGhpcy5fb25Nb3VzZU92ZXIpOw0KDQogICAgICBpZiAodGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX29uRm9jdXMpOw0KICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmx1cicsIHRoaXMuX29uQmx1cik7DQogICAgICB9DQoNCiAgICAgIHRoaXMuaW5wdXQuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX29uRm9jdXMpOw0KICAgICAgdGhpcy5pbnB1dC5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOw0KDQogICAgICBpZiAodGhpcy5pbnB1dC5lbGVtZW50LmZvcm0pIHsNCiAgICAgICAgdGhpcy5pbnB1dC5lbGVtZW50LmZvcm0ucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzZXQnLCB0aGlzLl9vbkZvcm1SZXNldCk7DQogICAgICB9DQoNCiAgICAgIHRoaXMuaW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25LZXlEb3duJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uS2V5RG93bihldmVudCkgew0KICAgICAgdmFyIF9rZXlEb3duQWN0aW9uczsNCg0KICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldCwNCiAgICAgICAgICBrZXlDb2RlID0gZXZlbnQua2V5Q29kZSwNCiAgICAgICAgICBjdHJsS2V5ID0gZXZlbnQuY3RybEtleSwNCiAgICAgICAgICBtZXRhS2V5ID0gZXZlbnQubWV0YUtleTsNCg0KDQogICAgICBpZiAodGFyZ2V0ICE9PSB0aGlzLmlucHV0LmVsZW1lbnQgJiYgIXRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5jb250YWlucyh0YXJnZXQpKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdmFyIGFjdGl2ZUl0ZW1zID0gdGhpcy5fc3RvcmUuYWN0aXZlSXRlbXM7DQogICAgICB2YXIgaGFzRm9jdXNlZElucHV0ID0gdGhpcy5pbnB1dC5pc0ZvY3Vzc2VkOw0KICAgICAgdmFyIGhhc0FjdGl2ZURyb3Bkb3duID0gdGhpcy5kcm9wZG93bi5pc0FjdGl2ZTsNCiAgICAgIHZhciBoYXNJdGVtcyA9IHRoaXMuaXRlbUxpc3QuaGFzQ2hpbGRyZW47DQogICAgICB2YXIga2V5U3RyaW5nID0gU3RyaW5nLmZyb21DaGFyQ29kZShrZXlDb2RlKTsNCg0KICAgICAgdmFyIEJBQ0tfS0VZID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuQkFDS19LRVksDQogICAgICAgICAgREVMRVRFX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkRFTEVURV9LRVksDQogICAgICAgICAgRU5URVJfS0VZID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuRU5URVJfS0VZLA0KICAgICAgICAgIEFfS0VZID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuQV9LRVksDQogICAgICAgICAgRVNDX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkVTQ19LRVksDQogICAgICAgICAgVVBfS0VZID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuVVBfS0VZLA0KICAgICAgICAgIERPV05fS0VZID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuRE9XTl9LRVksDQogICAgICAgICAgUEFHRV9VUF9LRVkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5QQUdFX1VQX0tFWSwNCiAgICAgICAgICBQQUdFX0RPV05fS0VZID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuUEFHRV9ET1dOX0tFWTsNCg0KICAgICAgdmFyIGhhc0N0cmxEb3duS2V5UHJlc3NlZCA9IGN0cmxLZXkgfHwgbWV0YUtleTsNCg0KICAgICAgLy8gSWYgYSB1c2VyIGlzIHR5cGluZyBhbmQgdGhlIGRyb3Bkb3duIGlzIG5vdCBhY3RpdmUNCiAgICAgIGlmICghdGhpcy5faXNUZXh0RWxlbWVudCAmJiAvW2EtekEtWjAtOS1fIF0vLnRlc3Qoa2V5U3RyaW5nKSkgew0KICAgICAgICB0aGlzLnNob3dEcm9wZG93bigpOw0KICAgICAgfQ0KDQogICAgICAvLyBNYXAga2V5cyB0byBrZXkgYWN0aW9ucw0KICAgICAgdmFyIGtleURvd25BY3Rpb25zID0gKF9rZXlEb3duQWN0aW9ucyA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX2tleURvd25BY3Rpb25zLCBBX0tFWSwgdGhpcy5fb25BS2V5KSwgX2RlZmluZVByb3BlcnR5KF9rZXlEb3duQWN0aW9ucywgRU5URVJfS0VZLCB0aGlzLl9vbkVudGVyS2V5KSwgX2RlZmluZVByb3BlcnR5KF9rZXlEb3duQWN0aW9ucywgRVNDX0tFWSwgdGhpcy5fb25Fc2NhcGVLZXkpLCBfZGVmaW5lUHJvcGVydHkoX2tleURvd25BY3Rpb25zLCBVUF9LRVksIHRoaXMuX29uRGlyZWN0aW9uS2V5KSwgX2RlZmluZVByb3BlcnR5KF9rZXlEb3duQWN0aW9ucywgUEFHRV9VUF9LRVksIHRoaXMuX29uRGlyZWN0aW9uS2V5KSwgX2RlZmluZVByb3BlcnR5KF9rZXlEb3duQWN0aW9ucywgRE9XTl9LRVksIHRoaXMuX29uRGlyZWN0aW9uS2V5KSwgX2RlZmluZVByb3BlcnR5KF9rZXlEb3duQWN0aW9ucywgUEFHRV9ET1dOX0tFWSwgdGhpcy5fb25EaXJlY3Rpb25LZXkpLCBfZGVmaW5lUHJvcGVydHkoX2tleURvd25BY3Rpb25zLCBERUxFVEVfS0VZLCB0aGlzLl9vbkRlbGV0ZUtleSksIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIEJBQ0tfS0VZLCB0aGlzLl9vbkRlbGV0ZUtleSksIF9rZXlEb3duQWN0aW9ucyk7DQoNCiAgICAgIC8vIElmIGtleWNvZGUgaGFzIGEgZnVuY3Rpb24sIHJ1biBpdA0KICAgICAgaWYgKGtleURvd25BY3Rpb25zW2tleUNvZGVdKSB7DQogICAgICAgIGtleURvd25BY3Rpb25zW2tleUNvZGVdKHsNCiAgICAgICAgICBldmVudDogZXZlbnQsDQogICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsDQogICAgICAgICAga2V5Q29kZToga2V5Q29kZSwNCiAgICAgICAgICBtZXRhS2V5OiBtZXRhS2V5LA0KICAgICAgICAgIGFjdGl2ZUl0ZW1zOiBhY3RpdmVJdGVtcywNCiAgICAgICAgICBoYXNGb2N1c2VkSW5wdXQ6IGhhc0ZvY3VzZWRJbnB1dCwNCiAgICAgICAgICBoYXNBY3RpdmVEcm9wZG93bjogaGFzQWN0aXZlRHJvcGRvd24sDQogICAgICAgICAgaGFzSXRlbXM6IGhhc0l0ZW1zLA0KICAgICAgICAgIGhhc0N0cmxEb3duS2V5UHJlc3NlZDogaGFzQ3RybERvd25LZXlQcmVzc2VkDQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbktleVVwJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uS2V5VXAoX3JlZjIpIHsNCiAgICAgIHZhciB0YXJnZXQgPSBfcmVmMi50YXJnZXQsDQogICAgICAgICAga2V5Q29kZSA9IF9yZWYyLmtleUNvZGU7DQoNCiAgICAgIGlmICh0YXJnZXQgIT09IHRoaXMuaW5wdXQuZWxlbWVudCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuaW5wdXQudmFsdWU7DQogICAgICB2YXIgYWN0aXZlSXRlbXMgPSB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtczsNCiAgICAgIHZhciBjYW5BZGRJdGVtID0gdGhpcy5fY2FuQWRkSXRlbShhY3RpdmVJdGVtcywgdmFsdWUpOw0KDQogICAgICAvLyBXZSBhcmUgdHlwaW5nIGludG8gYSB0ZXh0IGlucHV0IGFuZCBoYXZlIGEgdmFsdWUsIHdlIHdhbnQgdG8gc2hvdyBhIGRyb3Bkb3duDQogICAgICAvLyBub3RpY2UuIE90aGVyd2lzZSBoaWRlIHRoZSBkcm9wZG93bg0KICAgICAgaWYgKHRoaXMuX2lzVGV4dEVsZW1lbnQpIHsNCiAgICAgICAgaWYgKHZhbHVlKSB7DQogICAgICAgICAgaWYgKGNhbkFkZEl0ZW0ubm90aWNlKSB7DQogICAgICAgICAgICB2YXIgZHJvcGRvd25JdGVtID0gdGhpcy5fZ2V0VGVtcGxhdGUoJ25vdGljZScsIGNhbkFkZEl0ZW0ubm90aWNlKTsNCiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uZWxlbWVudC5pbm5lckhUTUwgPSBkcm9wZG93bkl0ZW0ub3V0ZXJIVE1MOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmIChjYW5BZGRJdGVtLnJlc3BvbnNlID09PSB0cnVlKSB7DQogICAgICAgICAgICB0aGlzLnNob3dEcm9wZG93bih0cnVlKTsNCiAgICAgICAgICB9IGVsc2UgaWYgKCFjYW5BZGRJdGVtLm5vdGljZSkgew0KICAgICAgICAgICAgdGhpcy5oaWRlRHJvcGRvd24odHJ1ZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMuaGlkZURyb3Bkb3duKHRydWUpOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICB2YXIgYmFja0tleSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkJBQ0tfS0VZOw0KICAgICAgICB2YXIgZGVsZXRlS2V5ID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuREVMRVRFX0tFWTsNCg0KICAgICAgICAvLyBJZiB1c2VyIGhhcyByZW1vdmVkIHZhbHVlLi4uDQogICAgICAgIGlmICgoa2V5Q29kZSA9PT0gYmFja0tleSB8fCBrZXlDb2RlID09PSBkZWxldGVLZXkpICYmICF0YXJnZXQudmFsdWUpIHsNCiAgICAgICAgICBpZiAoIXRoaXMuX2lzVGV4dEVsZW1lbnQgJiYgdGhpcy5faXNTZWFyY2hpbmcpIHsNCiAgICAgICAgICAgIHRoaXMuX2lzU2VhcmNoaW5nID0gZmFsc2U7DQogICAgICAgICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX2Nob2ljZXMuYWN0aXZhdGVDaG9pY2VzKSh0cnVlKSk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NhblNlYXJjaCAmJiBjYW5BZGRJdGVtLnJlc3BvbnNlKSB7DQogICAgICAgICAgdGhpcy5faGFuZGxlU2VhcmNoKHRoaXMuaW5wdXQudmFsdWUpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHRoaXMuX2NhblNlYXJjaCA9IHRoaXMuY29uZmlnLnNlYXJjaEVuYWJsZWQ7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uQUtleScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkFLZXkoX3JlZjMpIHsNCiAgICAgIHZhciBoYXNJdGVtcyA9IF9yZWYzLmhhc0l0ZW1zLA0KICAgICAgICAgIGhhc0N0cmxEb3duS2V5UHJlc3NlZCA9IF9yZWYzLmhhc0N0cmxEb3duS2V5UHJlc3NlZDsNCg0KICAgICAgLy8gSWYgQ1RSTCArIEEgb3IgQ01EICsgQSBoYXZlIGJlZW4gcHJlc3NlZCBhbmQgdGhlcmUgYXJlIGl0ZW1zIHRvIHNlbGVjdA0KICAgICAgaWYgKGhhc0N0cmxEb3duS2V5UHJlc3NlZCAmJiBoYXNJdGVtcykgew0KICAgICAgICB0aGlzLl9jYW5TZWFyY2ggPSBmYWxzZTsNCiAgICAgICAgaWYgKHRoaXMuY29uZmlnLnJlbW92ZUl0ZW1zICYmICF0aGlzLmlucHV0LnZhbHVlICYmIHRoaXMuaW5wdXQuZWxlbWVudCA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkgew0KICAgICAgICAgIC8vIEhpZ2hsaWdodCBpdGVtcw0KICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0QWxsKCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25FbnRlcktleScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkVudGVyS2V5KF9yZWY0KSB7DQogICAgICB2YXIgZXZlbnQgPSBfcmVmNC5ldmVudCwNCiAgICAgICAgICB0YXJnZXQgPSBfcmVmNC50YXJnZXQsDQogICAgICAgICAgYWN0aXZlSXRlbXMgPSBfcmVmNC5hY3RpdmVJdGVtcywNCiAgICAgICAgICBoYXNBY3RpdmVEcm9wZG93biA9IF9yZWY0Lmhhc0FjdGl2ZURyb3Bkb3duOw0KICAgICAgdmFyIGVudGVyS2V5ID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuRU5URVJfS0VZOw0KICAgICAgLy8gSWYgZW50ZXIga2V5IGlzIHByZXNzZWQgYW5kIHRoZSBpbnB1dCBoYXMgYSB2YWx1ZQ0KDQogICAgICBpZiAodGhpcy5faXNUZXh0RWxlbWVudCAmJiB0YXJnZXQudmFsdWUpIHsNCiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5pbnB1dC52YWx1ZTsNCiAgICAgICAgdmFyIGNhbkFkZEl0ZW0gPSB0aGlzLl9jYW5BZGRJdGVtKGFjdGl2ZUl0ZW1zLCB2YWx1ZSk7DQoNCiAgICAgICAgLy8gQWxsIGlzIGdvb2QsIGFkZA0KICAgICAgICBpZiAoY2FuQWRkSXRlbS5yZXNwb25zZSkgew0KICAgICAgICAgIHRoaXMuaGlkZURyb3Bkb3duKHRydWUpOw0KICAgICAgICAgIHRoaXMuX2FkZEl0ZW0oeyB2YWx1ZTogdmFsdWUgfSk7DQogICAgICAgICAgdGhpcy5fdHJpZ2dlckNoYW5nZSh2YWx1ZSk7DQogICAgICAgICAgdGhpcy5jbGVhcklucHV0KCk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgaWYgKHRhcmdldC5oYXNBdHRyaWJ1dGUoJ2RhdGEtYnV0dG9uJykpIHsNCiAgICAgICAgdGhpcy5faGFuZGxlQnV0dG9uQWN0aW9uKGFjdGl2ZUl0ZW1zLCB0YXJnZXQpOw0KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgfQ0KDQogICAgICBpZiAoaGFzQWN0aXZlRHJvcGRvd24pIHsNCiAgICAgICAgdmFyIGhpZ2hsaWdodGVkID0gdGhpcy5kcm9wZG93bi5nZXRDaGlsZCgnLicgKyB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmhpZ2hsaWdodGVkU3RhdGUpOw0KDQogICAgICAgIC8vIElmIHdlIGhhdmUgYSBoaWdobGlnaHRlZCBjaG9pY2UNCiAgICAgICAgaWYgKGhpZ2hsaWdodGVkKSB7DQogICAgICAgICAgLy8gYWRkIGVudGVyIGtleUNvZGUgdmFsdWUNCiAgICAgICAgICBpZiAoYWN0aXZlSXRlbXNbMF0pIHsNCiAgICAgICAgICAgIGFjdGl2ZUl0ZW1zWzBdLmtleUNvZGUgPSBlbnRlcktleTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1wYXJhbS1yZWFzc2lnbg0KICAgICAgICAgIH0NCiAgICAgICAgICB0aGlzLl9oYW5kbGVDaG9pY2VBY3Rpb24oYWN0aXZlSXRlbXMsIGhpZ2hsaWdodGVkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICB9IGVsc2UgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICAvLyBPcGVuIHNpbmdsZSBzZWxlY3QgZHJvcGRvd24gaWYgaXQncyBub3QgYWN0aXZlDQogICAgICAgIHRoaXMuc2hvd0Ryb3Bkb3duKCk7DQogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uRXNjYXBlS2V5JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRXNjYXBlS2V5KF9yZWY1KSB7DQogICAgICB2YXIgaGFzQWN0aXZlRHJvcGRvd24gPSBfcmVmNS5oYXNBY3RpdmVEcm9wZG93bjsNCg0KICAgICAgaWYgKGhhc0FjdGl2ZURyb3Bkb3duKSB7DQogICAgICAgIHRoaXMuaGlkZURyb3Bkb3duKHRydWUpOw0KICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLmZvY3VzKCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uRGlyZWN0aW9uS2V5JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRGlyZWN0aW9uS2V5KF9yZWY2KSB7DQogICAgICB2YXIgZXZlbnQgPSBfcmVmNi5ldmVudCwNCiAgICAgICAgICBoYXNBY3RpdmVEcm9wZG93biA9IF9yZWY2Lmhhc0FjdGl2ZURyb3Bkb3duLA0KICAgICAgICAgIGtleUNvZGUgPSBfcmVmNi5rZXlDb2RlLA0KICAgICAgICAgIG1ldGFLZXkgPSBfcmVmNi5tZXRhS2V5Ow0KICAgICAgdmFyIGRvd25LZXkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5ET1dOX0tFWSwNCiAgICAgICAgICBwYWdlVXBLZXkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5QQUdFX1VQX0tFWSwNCiAgICAgICAgICBwYWdlRG93bktleSA9IF9jb25zdGFudHMuS0VZX0NPREVTLlBBR0VfRE9XTl9LRVk7DQoNCiAgICAgIC8vIElmIHVwIG9yIGRvd24ga2V5IGlzIHByZXNzZWQsIHRyYXZlcnNlIHRocm91Z2ggb3B0aW9ucw0KDQogICAgICBpZiAoaGFzQWN0aXZlRHJvcGRvd24gfHwgdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIHRoaXMuc2hvd0Ryb3Bkb3duKCk7DQogICAgICAgIHRoaXMuX2NhblNlYXJjaCA9IGZhbHNlOw0KDQogICAgICAgIHZhciBkaXJlY3Rpb25JbnQgPSBrZXlDb2RlID09PSBkb3duS2V5IHx8IGtleUNvZGUgPT09IHBhZ2VEb3duS2V5ID8gMSA6IC0xOw0KICAgICAgICB2YXIgc2tpcEtleSA9IG1ldGFLZXkgfHwga2V5Q29kZSA9PT0gcGFnZURvd25LZXkgfHwga2V5Q29kZSA9PT0gcGFnZVVwS2V5Ow0KICAgICAgICB2YXIgc2VsZWN0YWJsZUNob2ljZUlkZW50aWZpZXIgPSAnW2RhdGEtY2hvaWNlLXNlbGVjdGFibGVdJzsNCg0KICAgICAgICB2YXIgbmV4dEVsID0gdm9pZCAwOw0KICAgICAgICBpZiAoc2tpcEtleSkgew0KICAgICAgICAgIGlmIChkaXJlY3Rpb25JbnQgPiAwKSB7DQogICAgICAgICAgICBuZXh0RWwgPSBBcnJheS5mcm9tKHRoaXMuZHJvcGRvd24uZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdGFibGVDaG9pY2VJZGVudGlmaWVyKSkucG9wKCk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIG5leHRFbCA9IHRoaXMuZHJvcGRvd24uZWxlbWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdGFibGVDaG9pY2VJZGVudGlmaWVyKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdmFyIGN1cnJlbnRFbCA9IHRoaXMuZHJvcGRvd24uZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuJyArIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuaGlnaGxpZ2h0ZWRTdGF0ZSk7DQogICAgICAgICAgaWYgKGN1cnJlbnRFbCkgew0KICAgICAgICAgICAgbmV4dEVsID0gKDAsIF91dGlscy5nZXRBZGphY2VudEVsKShjdXJyZW50RWwsIHNlbGVjdGFibGVDaG9pY2VJZGVudGlmaWVyLCBkaXJlY3Rpb25JbnQpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBuZXh0RWwgPSB0aGlzLmRyb3Bkb3duLmVsZW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RhYmxlQ2hvaWNlSWRlbnRpZmllcik7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKG5leHRFbCkgew0KICAgICAgICAgIC8vIFdlIHByZXZlbnQgZGVmYXVsdCB0byBzdG9wIHRoZSBjdXJzb3IgbW92aW5nDQogICAgICAgICAgLy8gd2hlbiBwcmVzc2luZyB0aGUgYXJyb3cNCiAgICAgICAgICBpZiAoISgwLCBfdXRpbHMuaXNTY3JvbGxlZEludG9WaWV3KShuZXh0RWwsIHRoaXMuY2hvaWNlTGlzdC5lbGVtZW50LCBkaXJlY3Rpb25JbnQpKSB7DQogICAgICAgICAgICB0aGlzLmNob2ljZUxpc3Quc2Nyb2xsVG9DaG9pY2UobmV4dEVsLCBkaXJlY3Rpb25JbnQpOw0KICAgICAgICAgIH0NCiAgICAgICAgICB0aGlzLl9oaWdobGlnaHRDaG9pY2UobmV4dEVsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFByZXZlbnQgZGVmYXVsdCB0byBtYWludGFpbiBjdXJzb3IgcG9zaXRpb24gd2hpbHN0DQogICAgICAgIC8vIHRyYXZlcnNpbmcgZHJvcGRvd24gb3B0aW9ucw0KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbkRlbGV0ZUtleScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkRlbGV0ZUtleShfcmVmNykgew0KICAgICAgdmFyIGV2ZW50ID0gX3JlZjcuZXZlbnQsDQogICAgICAgICAgdGFyZ2V0ID0gX3JlZjcudGFyZ2V0LA0KICAgICAgICAgIGhhc0ZvY3VzZWRJbnB1dCA9IF9yZWY3Lmhhc0ZvY3VzZWRJbnB1dCwNCiAgICAgICAgICBhY3RpdmVJdGVtcyA9IF9yZWY3LmFjdGl2ZUl0ZW1zOw0KDQogICAgICAvLyBJZiBiYWNrc3BhY2Ugb3IgZGVsZXRlIGtleSBpcyBwcmVzc2VkIGFuZCB0aGUgaW5wdXQgaGFzIG5vIHZhbHVlDQogICAgICBpZiAoaGFzRm9jdXNlZElucHV0ICYmICF0YXJnZXQudmFsdWUgJiYgIXRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICB0aGlzLl9oYW5kbGVCYWNrc3BhY2UoYWN0aXZlSXRlbXMpOw0KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vblRvdWNoTW92ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblRvdWNoTW92ZSgpIHsNCiAgICAgIGlmICh0aGlzLl93YXNUYXAgPT09IHRydWUpIHsNCiAgICAgICAgdGhpcy5fd2FzVGFwID0gZmFsc2U7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uVG91Y2hFbmQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Ub3VjaEVuZChldmVudCkgew0KICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldCB8fCBldmVudC50b3VjaGVzWzBdLnRhcmdldDsNCg0KICAgICAgLy8gSWYgYSB1c2VyIHRhcHBlZCB3aXRoaW4gb3VyIGNvbnRhaW5lci4uLg0KICAgICAgaWYgKHRoaXMuX3dhc1RhcCA9PT0gdHJ1ZSAmJiB0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQuY29udGFpbnModGFyZ2V0KSkgew0KICAgICAgICAvLyAuLi5hbmQgd2UgYXJlbid0IGRlYWxpbmcgd2l0aCBhIHNpbmdsZSBzZWxlY3QgYm94LCBzaG93IGRyb3Bkb3duL2ZvY3VzIGlucHV0DQoNCiAgICAgICAgdmFyIGNvbnRhaW5lcldhc1RhcmdldCA9IHRhcmdldCA9PT0gdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50IHx8IHRhcmdldCA9PT0gdGhpcy5jb250YWluZXJJbm5lci5lbGVtZW50Ow0KDQogICAgICAgIGlmIChjb250YWluZXJXYXNUYXJnZXQgJiYgIXRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICAgIGlmICh0aGlzLl9pc1RleHRFbGVtZW50KSB7DQogICAgICAgICAgICAvLyBJZiB0ZXh0IGVsZW1lbnQsIHdlIG9ubHkgd2FudCB0byBmb2N1cyB0aGUgaW5wdXQNCiAgICAgICAgICAgIHRoaXMuaW5wdXQuZm9jdXMoKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gSWYgYSBzZWxlY3QgYm94LCB3ZSB3YW50IHRvIHNob3cgdGhlIGRyb3Bkb3duDQogICAgICAgICAgICB0aGlzLnNob3dEcm9wZG93bigpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBQcmV2ZW50cyBmb2N1cyBldmVudCBmaXJpbmcNCiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICB9DQoNCiAgICAgIHRoaXMuX3dhc1RhcCA9IHRydWU7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uTW91c2VEb3duJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uTW91c2VEb3duKGV2ZW50KSB7DQogICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0LA0KICAgICAgICAgIHNoaWZ0S2V5ID0gZXZlbnQuc2hpZnRLZXk7DQogICAgICAvLyBJZiB3ZSBoYXZlIG91ciBtb3VzZSBkb3duIG9uIHRoZSBzY3JvbGxiYXIgYW5kIGFyZSBvbiBJRTExLi4uDQoNCiAgICAgIGlmICh0YXJnZXQgPT09IHRoaXMuY2hvaWNlTGlzdCAmJiAoMCwgX3V0aWxzLmlzSUUxMSkoKSkgew0KICAgICAgICB0aGlzLl9pc1Njcm9sbGluZ09uSWUgPSB0cnVlOw0KICAgICAgfQ0KDQogICAgICBpZiAoIXRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5jb250YWlucyh0YXJnZXQpIHx8IHRhcmdldCA9PT0gdGhpcy5pbnB1dC5lbGVtZW50KSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdmFyIGFjdGl2ZUl0ZW1zID0gdGhpcy5fc3RvcmUuYWN0aXZlSXRlbXM7DQogICAgICB2YXIgaGFzU2hpZnRLZXkgPSBzaGlmdEtleTsNCg0KICAgICAgdmFyIGJ1dHRvblRhcmdldCA9ICgwLCBfdXRpbHMuZmluZEFuY2VzdG9yQnlBdHRyTmFtZSkodGFyZ2V0LCAnZGF0YS1idXR0b24nKTsNCiAgICAgIHZhciBpdGVtVGFyZ2V0ID0gKDAsIF91dGlscy5maW5kQW5jZXN0b3JCeUF0dHJOYW1lKSh0YXJnZXQsICdkYXRhLWl0ZW0nKTsNCiAgICAgIHZhciBjaG9pY2VUYXJnZXQgPSAoMCwgX3V0aWxzLmZpbmRBbmNlc3RvckJ5QXR0ck5hbWUpKHRhcmdldCwgJ2RhdGEtY2hvaWNlJyk7DQoNCiAgICAgIGlmIChidXR0b25UYXJnZXQpIHsNCiAgICAgICAgdGhpcy5faGFuZGxlQnV0dG9uQWN0aW9uKGFjdGl2ZUl0ZW1zLCBidXR0b25UYXJnZXQpOw0KICAgICAgfSBlbHNlIGlmIChpdGVtVGFyZ2V0KSB7DQogICAgICAgIHRoaXMuX2hhbmRsZUl0ZW1BY3Rpb24oYWN0aXZlSXRlbXMsIGl0ZW1UYXJnZXQsIGhhc1NoaWZ0S2V5KTsNCiAgICAgIH0gZWxzZSBpZiAoY2hvaWNlVGFyZ2V0KSB7DQogICAgICAgIHRoaXMuX2hhbmRsZUNob2ljZUFjdGlvbihhY3RpdmVJdGVtcywgY2hvaWNlVGFyZ2V0KTsNCiAgICAgIH0NCg0KICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25Nb3VzZU92ZXInLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Nb3VzZU92ZXIoX3JlZjgpIHsNCiAgICAgIHZhciB0YXJnZXQgPSBfcmVmOC50YXJnZXQ7DQoNCiAgICAgIHZhciB0YXJnZXRXaXRoaW5Ecm9wZG93biA9IHRhcmdldCA9PT0gdGhpcy5kcm9wZG93biB8fCB0aGlzLmRyb3Bkb3duLmVsZW1lbnQuY29udGFpbnModGFyZ2V0KTsNCiAgICAgIHZhciBzaG91bGRIaWdobGlnaHRDaG9pY2UgPSB0YXJnZXRXaXRoaW5Ecm9wZG93biAmJiB0YXJnZXQuaGFzQXR0cmlidXRlKCdkYXRhLWNob2ljZScpOw0KDQogICAgICBpZiAoc2hvdWxkSGlnaGxpZ2h0Q2hvaWNlKSB7DQogICAgICAgIHRoaXMuX2hpZ2hsaWdodENob2ljZSh0YXJnZXQpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbkNsaWNrJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uQ2xpY2soX3JlZjkpIHsNCiAgICAgIHZhciB0YXJnZXQgPSBfcmVmOS50YXJnZXQ7DQoNCiAgICAgIGlmICh0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQuY29udGFpbnModGFyZ2V0KSkgew0KICAgICAgICBpZiAoIXRoaXMuZHJvcGRvd24uaXNBY3RpdmUgJiYgIXRoaXMuY29udGFpbmVyT3V0ZXIuaXNEaXNhYmxlZCkgew0KICAgICAgICAgIGlmICh0aGlzLl9pc1RleHRFbGVtZW50KSB7DQogICAgICAgICAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAhPT0gdGhpcy5pbnB1dC5lbGVtZW50KSB7DQogICAgICAgICAgICAgIHRoaXMuaW5wdXQuZm9jdXMoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5zaG93RHJvcGRvd24oKTsNCiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZm9jdXMoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSBpZiAodGhpcy5faXNTZWxlY3RPbmVFbGVtZW50ICYmIHRhcmdldCAhPT0gdGhpcy5pbnB1dC5lbGVtZW50ICYmICF0aGlzLmRyb3Bkb3duLmVsZW1lbnQuY29udGFpbnModGFyZ2V0KSkgew0KICAgICAgICAgIHRoaXMuaGlkZURyb3Bkb3duKCk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHZhciBoYXNIaWdobGlnaHRlZEl0ZW1zID0gdGhpcy5fc3RvcmUuaGlnaGxpZ2h0ZWRBY3RpdmVJdGVtczsNCg0KICAgICAgICBpZiAoaGFzSGlnaGxpZ2h0ZWRJdGVtcykgew0KICAgICAgICAgIHRoaXMudW5oaWdobGlnaHRBbGwoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIucmVtb3ZlRm9jdXNTdGF0ZSgpOw0KICAgICAgICB0aGlzLmhpZGVEcm9wZG93bih0cnVlKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25Gb2N1cycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkZvY3VzKF9yZWYxMCkgew0KICAgICAgdmFyIF90aGlzMTggPSB0aGlzOw0KDQogICAgICB2YXIgdGFyZ2V0ID0gX3JlZjEwLnRhcmdldDsNCg0KICAgICAgaWYgKCF0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQuY29udGFpbnModGFyZ2V0KSkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHZhciBmb2N1c0FjdGlvbnMgPSB7DQogICAgICAgIHRleHQ6IGZ1bmN0aW9uIHRleHQoKSB7DQogICAgICAgICAgaWYgKHRhcmdldCA9PT0gX3RoaXMxOC5pbnB1dC5lbGVtZW50KSB7DQogICAgICAgICAgICBfdGhpczE4LmNvbnRhaW5lck91dGVyLmFkZEZvY3VzU3RhdGUoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgICdzZWxlY3Qtb25lJzogZnVuY3Rpb24gc2VsZWN0T25lKCkgew0KICAgICAgICAgIF90aGlzMTguY29udGFpbmVyT3V0ZXIuYWRkRm9jdXNTdGF0ZSgpOw0KICAgICAgICAgIGlmICh0YXJnZXQgPT09IF90aGlzMTguaW5wdXQuZWxlbWVudCkgew0KICAgICAgICAgICAgX3RoaXMxOC5zaG93RHJvcGRvd24odHJ1ZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICAnc2VsZWN0LW11bHRpcGxlJzogZnVuY3Rpb24gc2VsZWN0TXVsdGlwbGUoKSB7DQogICAgICAgICAgaWYgKHRhcmdldCA9PT0gX3RoaXMxOC5pbnB1dC5lbGVtZW50KSB7DQogICAgICAgICAgICBfdGhpczE4LnNob3dEcm9wZG93bih0cnVlKTsNCiAgICAgICAgICAgIC8vIElmIGVsZW1lbnQgaXMgYSBzZWxlY3QgYm94LCB0aGUgZm9jdXNlZCBlbGVtZW50IGlzIHRoZSBjb250YWluZXIgYW5kIHRoZSBkcm9wZG93bg0KICAgICAgICAgICAgLy8gaXNuJ3QgYWxyZWFkeSBvcGVuLCBmb2N1cyBhbmQgc2hvdyBkcm9wZG93bg0KICAgICAgICAgICAgX3RoaXMxOC5jb250YWluZXJPdXRlci5hZGRGb2N1c1N0YXRlKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9Ow0KDQogICAgICBmb2N1c0FjdGlvbnNbdGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQudHlwZV0oKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25CbHVyJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uQmx1cihfcmVmMTEpIHsNCiAgICAgIHZhciBfdGhpczE5ID0gdGhpczsNCg0KICAgICAgdmFyIHRhcmdldCA9IF9yZWYxMS50YXJnZXQ7DQoNCiAgICAgIC8vIElmIHRhcmdldCBpcyBzb21ldGhpbmcgdGhhdCBjb25jZXJucyB1cw0KICAgICAgaWYgKHRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5jb250YWlucyh0YXJnZXQpICYmICF0aGlzLl9pc1Njcm9sbGluZ09uSWUpIHsNCiAgICAgICAgdmFyIGFjdGl2ZUl0ZW1zID0gdGhpcy5fc3RvcmUuYWN0aXZlSXRlbXM7DQogICAgICAgIHZhciBoYXNIaWdobGlnaHRlZEl0ZW1zID0gYWN0aXZlSXRlbXMuc29tZShmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICAgIHJldHVybiBpdGVtLmhpZ2hsaWdodGVkOw0KICAgICAgICB9KTsNCiAgICAgICAgdmFyIGJsdXJBY3Rpb25zID0gew0KICAgICAgICAgIHRleHQ6IGZ1bmN0aW9uIHRleHQoKSB7DQogICAgICAgICAgICBpZiAodGFyZ2V0ID09PSBfdGhpczE5LmlucHV0LmVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgX3RoaXMxOS5jb250YWluZXJPdXRlci5yZW1vdmVGb2N1c1N0YXRlKCk7DQogICAgICAgICAgICAgIGlmIChoYXNIaWdobGlnaHRlZEl0ZW1zKSB7DQogICAgICAgICAgICAgICAgX3RoaXMxOS51bmhpZ2hsaWdodEFsbCgpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIF90aGlzMTkuaGlkZURyb3Bkb3duKHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgJ3NlbGVjdC1vbmUnOiBmdW5jdGlvbiBzZWxlY3RPbmUoKSB7DQogICAgICAgICAgICBfdGhpczE5LmNvbnRhaW5lck91dGVyLnJlbW92ZUZvY3VzU3RhdGUoKTsNCiAgICAgICAgICAgIGlmICh0YXJnZXQgPT09IF90aGlzMTkuaW5wdXQuZWxlbWVudCB8fCB0YXJnZXQgPT09IF90aGlzMTkuY29udGFpbmVyT3V0ZXIuZWxlbWVudCAmJiAhX3RoaXMxOS5fY2FuU2VhcmNoKSB7DQogICAgICAgICAgICAgIF90aGlzMTkuaGlkZURyb3Bkb3duKHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgJ3NlbGVjdC1tdWx0aXBsZSc6IGZ1bmN0aW9uIHNlbGVjdE11bHRpcGxlKCkgew0KICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gX3RoaXMxOS5pbnB1dC5lbGVtZW50KSB7DQogICAgICAgICAgICAgIF90aGlzMTkuY29udGFpbmVyT3V0ZXIucmVtb3ZlRm9jdXNTdGF0ZSgpOw0KICAgICAgICAgICAgICBfdGhpczE5LmhpZGVEcm9wZG93bih0cnVlKTsNCiAgICAgICAgICAgICAgaWYgKGhhc0hpZ2hsaWdodGVkSXRlbXMpIHsNCiAgICAgICAgICAgICAgICBfdGhpczE5LnVuaGlnaGxpZ2h0QWxsKCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgYmx1ckFjdGlvbnNbdGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQudHlwZV0oKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIE9uIElFMTEsIGNsaWNraW5nIHRoZSBzY29sbGJhciBibHVycyBvdXIgaW5wdXQgYW5kIHRodXMNCiAgICAgICAgLy8gY2xvc2VzIHRoZSBkcm9wZG93bi4gVG8gc3RvcCB0aGlzLCB3ZSByZWZvY3VzIG91ciBpbnB1dA0KICAgICAgICAvLyBpZiB3ZSBrbm93IHdlIGFyZSBvbiBJRSAqYW5kKiBhcmUgc2Nyb2xsaW5nLg0KICAgICAgICB0aGlzLl9pc1Njcm9sbGluZ09uSWUgPSBmYWxzZTsNCiAgICAgICAgdGhpcy5pbnB1dC5lbGVtZW50LmZvY3VzKCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uRm9ybVJlc2V0JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRm9ybVJlc2V0KCkgew0KICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9taXNjLnJlc2V0VG8pKHRoaXMuX2luaXRpYWxTdGF0ZSkpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19oaWdobGlnaHRDaG9pY2UnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfaGlnaGxpZ2h0Q2hvaWNlKCkgew0KICAgICAgdmFyIF90aGlzMjAgPSB0aGlzOw0KDQogICAgICB2YXIgZWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IG51bGw7DQoNCiAgICAgIHZhciBjaG9pY2VzID0gQXJyYXkuZnJvbSh0aGlzLmRyb3Bkb3duLmVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtY2hvaWNlLXNlbGVjdGFibGVdJykpOw0KDQogICAgICBpZiAoIWNob2ljZXMubGVuZ3RoKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdmFyIHBhc3NlZEVsID0gZWw7DQogICAgICB2YXIgaGlnaGxpZ2h0ZWRDaG9pY2VzID0gQXJyYXkuZnJvbSh0aGlzLmRyb3Bkb3duLmVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmhpZ2hsaWdodGVkU3RhdGUpKTsNCg0KICAgICAgLy8gUmVtb3ZlIGFueSBoaWdobGlnaHRlZCBjaG9pY2VzDQogICAgICBoaWdobGlnaHRlZENob2ljZXMuZm9yRWFjaChmdW5jdGlvbiAoY2hvaWNlKSB7DQogICAgICAgIGNob2ljZS5jbGFzc0xpc3QucmVtb3ZlKF90aGlzMjAuY29uZmlnLmNsYXNzTmFtZXMuaGlnaGxpZ2h0ZWRTdGF0ZSk7DQogICAgICAgIGNob2ljZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtc2VsZWN0ZWQnLCAnZmFsc2UnKTsNCiAgICAgIH0pOw0KDQogICAgICBpZiAocGFzc2VkRWwpIHsNCiAgICAgICAgdGhpcy5faGlnaGxpZ2h0UG9zaXRpb24gPSBjaG9pY2VzLmluZGV4T2YocGFzc2VkRWwpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8gSGlnaGxpZ2h0IGNob2ljZSBiYXNlZCBvbiBsYXN0IGtub3duIGhpZ2hsaWdodCBsb2NhdGlvbg0KICAgICAgICBpZiAoY2hvaWNlcy5sZW5ndGggPiB0aGlzLl9oaWdobGlnaHRQb3NpdGlvbikgew0KICAgICAgICAgIC8vIElmIHdlIGhhdmUgYW4gb3B0aW9uIHRvIGhpZ2hsaWdodA0KICAgICAgICAgIHBhc3NlZEVsID0gY2hvaWNlc1t0aGlzLl9oaWdobGlnaHRQb3NpdGlvbl07DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgLy8gT3RoZXJ3aXNlIGhpZ2hsaWdodCB0aGUgb3B0aW9uIGJlZm9yZQ0KICAgICAgICAgIHBhc3NlZEVsID0gY2hvaWNlc1tjaG9pY2VzLmxlbmd0aCAtIDFdOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCFwYXNzZWRFbCkgew0KICAgICAgICAgIHBhc3NlZEVsID0gY2hvaWNlc1swXTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBwYXNzZWRFbC5jbGFzc0xpc3QuYWRkKHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuaGlnaGxpZ2h0ZWRTdGF0ZSk7DQogICAgICBwYXNzZWRFbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtc2VsZWN0ZWQnLCAndHJ1ZScpOw0KICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5oaWdobGlnaHRDaG9pY2UsIHsgZWw6IHBhc3NlZEVsIH0pOw0KDQogICAgICBpZiAodGhpcy5kcm9wZG93bi5pc0FjdGl2ZSkgew0KICAgICAgICAvLyBJRTExIGlnbm9yZXMgYXJpYS1sYWJlbCBhbmQgYmxvY2tzIHZpcnR1YWwga2V5Ym9hcmQNCiAgICAgICAgLy8gaWYgYXJpYS1hY3RpdmVkZXNjZW5kYW50IGlzIHNldCB3aXRob3V0IGEgZHJvcGRvd24NCiAgICAgICAgdGhpcy5pbnB1dC5zZXRBY3RpdmVEZXNjZW5kYW50KHBhc3NlZEVsLmlkKTsNCiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5zZXRBY3RpdmVEZXNjZW5kYW50KHBhc3NlZEVsLmlkKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfYWRkSXRlbScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9hZGRJdGVtKF9yZWYxMikgew0KICAgICAgdmFyIHZhbHVlID0gX3JlZjEyLnZhbHVlLA0KICAgICAgICAgIF9yZWYxMiRsYWJlbCA9IF9yZWYxMi5sYWJlbCwNCiAgICAgICAgICBsYWJlbCA9IF9yZWYxMiRsYWJlbCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IF9yZWYxMiRsYWJlbCwNCiAgICAgICAgICBfcmVmMTIkY2hvaWNlSWQgPSBfcmVmMTIuY2hvaWNlSWQsDQogICAgICAgICAgY2hvaWNlSWQgPSBfcmVmMTIkY2hvaWNlSWQgPT09IHVuZGVmaW5lZCA/IC0xIDogX3JlZjEyJGNob2ljZUlkLA0KICAgICAgICAgIF9yZWYxMiRncm91cElkID0gX3JlZjEyLmdyb3VwSWQsDQogICAgICAgICAgZ3JvdXBJZCA9IF9yZWYxMiRncm91cElkID09PSB1bmRlZmluZWQgPyAtMSA6IF9yZWYxMiRncm91cElkLA0KICAgICAgICAgIF9yZWYxMiRjdXN0b21Qcm9wZXJ0aSA9IF9yZWYxMi5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXMgPSBfcmVmMTIkY3VzdG9tUHJvcGVydGkgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBfcmVmMTIkY3VzdG9tUHJvcGVydGksDQogICAgICAgICAgX3JlZjEyJHBsYWNlaG9sZGVyID0gX3JlZjEyLnBsYWNlaG9sZGVyLA0KICAgICAgICAgIHBsYWNlaG9sZGVyID0gX3JlZjEyJHBsYWNlaG9sZGVyID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYxMiRwbGFjZWhvbGRlciwNCiAgICAgICAgICBfcmVmMTIka2V5Q29kZSA9IF9yZWYxMi5rZXlDb2RlLA0KICAgICAgICAgIGtleUNvZGUgPSBfcmVmMTIka2V5Q29kZSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IF9yZWYxMiRrZXlDb2RlOw0KDQogICAgICB2YXIgcGFzc2VkVmFsdWUgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ1N0cmluZycsIHZhbHVlKSA/IHZhbHVlLnRyaW0oKSA6IHZhbHVlOw0KDQogICAgICB2YXIgcGFzc2VkS2V5Q29kZSA9IGtleUNvZGU7DQogICAgICB2YXIgcGFzc2VkQ3VzdG9tUHJvcGVydGllcyA9IGN1c3RvbVByb3BlcnRpZXM7DQogICAgICB2YXIgaXRlbXMgPSB0aGlzLl9zdG9yZS5pdGVtczsNCiAgICAgIHZhciBwYXNzZWRMYWJlbCA9IGxhYmVsIHx8IHBhc3NlZFZhbHVlOw0KICAgICAgdmFyIHBhc3NlZE9wdGlvbklkID0gcGFyc2VJbnQoY2hvaWNlSWQsIDEwKSB8fCAtMTsNCiAgICAgIHZhciBncm91cCA9IGdyb3VwSWQgPj0gMCA/IHRoaXMuX3N0b3JlLmdldEdyb3VwQnlJZChncm91cElkKSA6IG51bGw7DQogICAgICB2YXIgaWQgPSBpdGVtcyA/IGl0ZW1zLmxlbmd0aCArIDEgOiAxOw0KDQogICAgICAvLyBJZiBhIHByZXBlbmRlZCB2YWx1ZSBoYXMgYmVlbiBwYXNzZWQsIHByZXBlbmQgaXQNCiAgICAgIGlmICh0aGlzLmNvbmZpZy5wcmVwZW5kVmFsdWUpIHsNCiAgICAgICAgcGFzc2VkVmFsdWUgPSB0aGlzLmNvbmZpZy5wcmVwZW5kVmFsdWUgKyBwYXNzZWRWYWx1ZS50b1N0cmluZygpOw0KICAgICAgfQ0KDQogICAgICAvLyBJZiBhbiBhcHBlbmRlZCB2YWx1ZSBoYXMgYmVlbiBwYXNzZWQsIGFwcGVuZCBpdA0KICAgICAgaWYgKHRoaXMuY29uZmlnLmFwcGVuZFZhbHVlKSB7DQogICAgICAgIHBhc3NlZFZhbHVlICs9IHRoaXMuY29uZmlnLmFwcGVuZFZhbHVlLnRvU3RyaW5nKCk7DQogICAgICB9DQoNCiAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfaXRlbXMuYWRkSXRlbSkoew0KICAgICAgICB2YWx1ZTogcGFzc2VkVmFsdWUsDQogICAgICAgIGxhYmVsOiBwYXNzZWRMYWJlbCwNCiAgICAgICAgaWQ6IGlkLA0KICAgICAgICBjaG9pY2VJZDogcGFzc2VkT3B0aW9uSWQsDQogICAgICAgIGdyb3VwSWQ6IGdyb3VwSWQsDQogICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlciwNCiAgICAgICAga2V5Q29kZTogcGFzc2VkS2V5Q29kZQ0KICAgICAgfSkpOw0KDQogICAgICBpZiAodGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIHRoaXMucmVtb3ZlQWN0aXZlSXRlbXMoaWQpOw0KICAgICAgfQ0KDQogICAgICAvLyBUcmlnZ2VyIGNoYW5nZSBldmVudA0KICAgICAgaWYgKGdyb3VwICYmIGdyb3VwLnZhbHVlKSB7DQogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMuYWRkSXRlbSwgew0KICAgICAgICAgIGlkOiBpZCwNCiAgICAgICAgICB2YWx1ZTogcGFzc2VkVmFsdWUsDQogICAgICAgICAgbGFiZWw6IHBhc3NlZExhYmVsLA0KICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IHBhc3NlZEN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgZ3JvdXBWYWx1ZTogZ3JvdXAudmFsdWUsDQogICAgICAgICAga2V5Q29kZTogcGFzc2VkS2V5Q29kZQ0KICAgICAgICB9KTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMuYWRkSXRlbSwgew0KICAgICAgICAgIGlkOiBpZCwNCiAgICAgICAgICB2YWx1ZTogcGFzc2VkVmFsdWUsDQogICAgICAgICAgbGFiZWw6IHBhc3NlZExhYmVsLA0KICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IHBhc3NlZEN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAga2V5Q29kZTogcGFzc2VkS2V5Q29kZQ0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX3JlbW92ZUl0ZW0nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVtb3ZlSXRlbShpdGVtKSB7DQogICAgICBpZiAoIWl0ZW0gfHwgISgwLCBfdXRpbHMuaXNUeXBlKSgnT2JqZWN0JywgaXRlbSkpIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHZhciBpZCA9IGl0ZW0uaWQsDQogICAgICAgICAgdmFsdWUgPSBpdGVtLnZhbHVlLA0KICAgICAgICAgIGxhYmVsID0gaXRlbS5sYWJlbCwNCiAgICAgICAgICBjaG9pY2VJZCA9IGl0ZW0uY2hvaWNlSWQsDQogICAgICAgICAgZ3JvdXBJZCA9IGl0ZW0uZ3JvdXBJZDsNCg0KICAgICAgdmFyIGdyb3VwID0gZ3JvdXBJZCA+PSAwID8gdGhpcy5fc3RvcmUuZ2V0R3JvdXBCeUlkKGdyb3VwSWQpIDogbnVsbDsNCg0KICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9pdGVtcy5yZW1vdmVJdGVtKShpZCwgY2hvaWNlSWQpKTsNCg0KICAgICAgaWYgKGdyb3VwICYmIGdyb3VwLnZhbHVlKSB7DQogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMucmVtb3ZlSXRlbSwgew0KICAgICAgICAgIGlkOiBpZCwNCiAgICAgICAgICB2YWx1ZTogdmFsdWUsDQogICAgICAgICAgbGFiZWw6IGxhYmVsLA0KICAgICAgICAgIGdyb3VwVmFsdWU6IGdyb3VwLnZhbHVlDQogICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5yZW1vdmVJdGVtLCB7DQogICAgICAgICAgaWQ6IGlkLA0KICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICBsYWJlbDogbGFiZWwNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19hZGRDaG9pY2UnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfYWRkQ2hvaWNlKF9yZWYxMykgew0KICAgICAgdmFyIHZhbHVlID0gX3JlZjEzLnZhbHVlLA0KICAgICAgICAgIF9yZWYxMyRsYWJlbCA9IF9yZWYxMy5sYWJlbCwNCiAgICAgICAgICBsYWJlbCA9IF9yZWYxMyRsYWJlbCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IF9yZWYxMyRsYWJlbCwNCiAgICAgICAgICBfcmVmMTMkaXNTZWxlY3RlZCA9IF9yZWYxMy5pc1NlbGVjdGVkLA0KICAgICAgICAgIGlzU2VsZWN0ZWQgPSBfcmVmMTMkaXNTZWxlY3RlZCA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmMTMkaXNTZWxlY3RlZCwNCiAgICAgICAgICBfcmVmMTMkaXNEaXNhYmxlZCA9IF9yZWYxMy5pc0Rpc2FibGVkLA0KICAgICAgICAgIGlzRGlzYWJsZWQgPSBfcmVmMTMkaXNEaXNhYmxlZCA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmMTMkaXNEaXNhYmxlZCwNCiAgICAgICAgICBfcmVmMTMkZ3JvdXBJZCA9IF9yZWYxMy5ncm91cElkLA0KICAgICAgICAgIGdyb3VwSWQgPSBfcmVmMTMkZ3JvdXBJZCA9PT0gdW5kZWZpbmVkID8gLTEgOiBfcmVmMTMkZ3JvdXBJZCwNCiAgICAgICAgICBfcmVmMTMkY3VzdG9tUHJvcGVydGkgPSBfcmVmMTMuY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzID0gX3JlZjEzJGN1c3RvbVByb3BlcnRpID09PSB1bmRlZmluZWQgPyBudWxsIDogX3JlZjEzJGN1c3RvbVByb3BlcnRpLA0KICAgICAgICAgIF9yZWYxMyRwbGFjZWhvbGRlciA9IF9yZWYxMy5wbGFjZWhvbGRlciwNCiAgICAgICAgICBwbGFjZWhvbGRlciA9IF9yZWYxMyRwbGFjZWhvbGRlciA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmMTMkcGxhY2Vob2xkZXIsDQogICAgICAgICAgX3JlZjEzJGtleUNvZGUgPSBfcmVmMTMua2V5Q29kZSwNCiAgICAgICAgICBrZXlDb2RlID0gX3JlZjEzJGtleUNvZGUgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBfcmVmMTMka2V5Q29kZTsNCg0KICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgdmFsdWUgPT09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgaWQNCiAgICAgIHZhciBjaG9pY2VzID0gdGhpcy5fc3RvcmUuY2hvaWNlczsNCiAgICAgIHZhciBjaG9pY2VMYWJlbCA9IGxhYmVsIHx8IHZhbHVlOw0KICAgICAgdmFyIGNob2ljZUlkID0gY2hvaWNlcyA/IGNob2ljZXMubGVuZ3RoICsgMSA6IDE7DQogICAgICB2YXIgY2hvaWNlRWxlbWVudElkID0gdGhpcy5fYmFzZUlkICsgJy0nICsgdGhpcy5faWROYW1lcy5pdGVtQ2hvaWNlICsgJy0nICsgY2hvaWNlSWQ7DQoNCiAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfY2hvaWNlcy5hZGRDaG9pY2UpKHsNCiAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICBsYWJlbDogY2hvaWNlTGFiZWwsDQogICAgICAgIGlkOiBjaG9pY2VJZCwNCiAgICAgICAgZ3JvdXBJZDogZ3JvdXBJZCwNCiAgICAgICAgZGlzYWJsZWQ6IGlzRGlzYWJsZWQsDQogICAgICAgIGVsZW1lbnRJZDogY2hvaWNlRWxlbWVudElkLA0KICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBjdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXIsDQogICAgICAgIGtleUNvZGU6IGtleUNvZGUNCiAgICAgIH0pKTsNCg0KICAgICAgaWYgKGlzU2VsZWN0ZWQpIHsNCiAgICAgICAgdGhpcy5fYWRkSXRlbSh7DQogICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgIGxhYmVsOiBjaG9pY2VMYWJlbCwNCiAgICAgICAgICBjaG9pY2VJZDogY2hvaWNlSWQsDQogICAgICAgICAgY3VzdG9tUHJvcGVydGllczogY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXIsDQogICAgICAgICAga2V5Q29kZToga2V5Q29kZQ0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfY2xlYXJDaG9pY2VzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NsZWFyQ2hvaWNlcygpIHsNCiAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfY2hvaWNlcy5jbGVhckNob2ljZXMpKCkpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19hZGRHcm91cCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9hZGRHcm91cChfcmVmMTQpIHsNCiAgICAgIHZhciBfdGhpczIxID0gdGhpczsNCg0KICAgICAgdmFyIGdyb3VwID0gX3JlZjE0Lmdyb3VwLA0KICAgICAgICAgIGlkID0gX3JlZjE0LmlkLA0KICAgICAgICAgIF9yZWYxNCR2YWx1ZUtleSA9IF9yZWYxNC52YWx1ZUtleSwNCiAgICAgICAgICB2YWx1ZUtleSA9IF9yZWYxNCR2YWx1ZUtleSA9PT0gdW5kZWZpbmVkID8gJ3ZhbHVlJyA6IF9yZWYxNCR2YWx1ZUtleSwNCiAgICAgICAgICBfcmVmMTQkbGFiZWxLZXkgPSBfcmVmMTQubGFiZWxLZXksDQogICAgICAgICAgbGFiZWxLZXkgPSBfcmVmMTQkbGFiZWxLZXkgPT09IHVuZGVmaW5lZCA/ICdsYWJlbCcgOiBfcmVmMTQkbGFiZWxLZXk7DQoNCiAgICAgIHZhciBncm91cENob2ljZXMgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ09iamVjdCcsIGdyb3VwKSA/IGdyb3VwLmNob2ljZXMgOiBBcnJheS5mcm9tKGdyb3VwLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdPUFRJT04nKSk7DQogICAgICB2YXIgZ3JvdXBJZCA9IGlkIHx8IE1hdGguZmxvb3IobmV3IERhdGUoKS52YWx1ZU9mKCkgKiBNYXRoLnJhbmRvbSgpKTsNCiAgICAgIHZhciBpc0Rpc2FibGVkID0gZ3JvdXAuZGlzYWJsZWQgPyBncm91cC5kaXNhYmxlZCA6IGZhbHNlOw0KDQogICAgICBpZiAoZ3JvdXBDaG9pY2VzKSB7DQogICAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfZ3JvdXBzLmFkZEdyb3VwKShncm91cC5sYWJlbCwgZ3JvdXBJZCwgdHJ1ZSwgaXNEaXNhYmxlZCkpOw0KDQogICAgICAgIHZhciBhZGRHcm91cENob2ljZXMgPSBmdW5jdGlvbiBhZGRHcm91cENob2ljZXMoY2hvaWNlKSB7DQogICAgICAgICAgdmFyIGlzT3B0RGlzYWJsZWQgPSBjaG9pY2UuZGlzYWJsZWQgfHwgY2hvaWNlLnBhcmVudE5vZGUgJiYgY2hvaWNlLnBhcmVudE5vZGUuZGlzYWJsZWQ7DQoNCiAgICAgICAgICBfdGhpczIxLl9hZGRDaG9pY2Uoew0KICAgICAgICAgICAgdmFsdWU6IGNob2ljZVt2YWx1ZUtleV0sDQogICAgICAgICAgICBsYWJlbDogKDAsIF91dGlscy5pc1R5cGUpKCdPYmplY3QnLCBjaG9pY2UpID8gY2hvaWNlW2xhYmVsS2V5XSA6IGNob2ljZS5pbm5lckhUTUwsDQogICAgICAgICAgICBpc1NlbGVjdGVkOiBjaG9pY2Uuc2VsZWN0ZWQsDQogICAgICAgICAgICBpc0Rpc2FibGVkOiBpc09wdERpc2FibGVkLA0KICAgICAgICAgICAgZ3JvdXBJZDogZ3JvdXBJZCwNCiAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGNob2ljZS5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGNob2ljZS5wbGFjZWhvbGRlcg0KICAgICAgICAgIH0pOw0KICAgICAgICB9Ow0KDQogICAgICAgIGdyb3VwQ2hvaWNlcy5mb3JFYWNoKGFkZEdyb3VwQ2hvaWNlcyk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX2dyb3Vwcy5hZGRHcm91cCkoZ3JvdXAubGFiZWwsIGdyb3VwLmlkLCBmYWxzZSwgZ3JvdXAuZGlzYWJsZWQpKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfZ2V0VGVtcGxhdGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0VGVtcGxhdGUodGVtcGxhdGUpIHsNCiAgICAgIHZhciBfdGVtcGxhdGVzJHRlbXBsYXRlOw0KDQogICAgICBpZiAoIXRlbXBsYXRlKSB7DQogICAgICAgIHJldHVybiBudWxsOw0KICAgICAgfQ0KDQogICAgICB2YXIgX2NvbmZpZzQgPSB0aGlzLmNvbmZpZywNCiAgICAgICAgICB0ZW1wbGF0ZXMgPSBfY29uZmlnNC50ZW1wbGF0ZXMsDQogICAgICAgICAgY2xhc3NOYW1lcyA9IF9jb25maWc0LmNsYXNzTmFtZXM7DQoNCiAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gQXJyYXkoX2xlbiA+IDEgPyBfbGVuIC0gMSA6IDApLCBfa2V5ID0gMTsgX2tleSA8IF9sZW47IF9rZXkrKykgew0KICAgICAgICBhcmdzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIChfdGVtcGxhdGVzJHRlbXBsYXRlID0gdGVtcGxhdGVzW3RlbXBsYXRlXSkuY2FsbC5hcHBseShfdGVtcGxhdGVzJHRlbXBsYXRlLCBbdGhpcywgY2xhc3NOYW1lc10uY29uY2F0KGFyZ3MpKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfY3JlYXRlVGVtcGxhdGVzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZVRlbXBsYXRlcygpIHsNCiAgICAgIHZhciBjYWxsYmFja09uQ3JlYXRlVGVtcGxhdGVzID0gdGhpcy5jb25maWcuY2FsbGJhY2tPbkNyZWF0ZVRlbXBsYXRlczsNCg0KICAgICAgdmFyIHVzZXJUZW1wbGF0ZXMgPSB7fTsNCg0KICAgICAgaWYgKGNhbGxiYWNrT25DcmVhdGVUZW1wbGF0ZXMgJiYgKDAsIF91dGlscy5pc1R5cGUpKCdGdW5jdGlvbicsIGNhbGxiYWNrT25DcmVhdGVUZW1wbGF0ZXMpKSB7DQogICAgICAgIHVzZXJUZW1wbGF0ZXMgPSBjYWxsYmFja09uQ3JlYXRlVGVtcGxhdGVzLmNhbGwodGhpcywgX3V0aWxzLnN0clRvRWwpOw0KICAgICAgfQ0KDQogICAgICB0aGlzLmNvbmZpZy50ZW1wbGF0ZXMgPSAoMCwgX3V0aWxzLmV4dGVuZCkoX3RlbXBsYXRlcy5URU1QTEFURVMsIHVzZXJUZW1wbGF0ZXMpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19jcmVhdGVFbGVtZW50cycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVFbGVtZW50cygpIHsNCiAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIgPSBuZXcgX2NvbXBvbmVudHMuQ29udGFpbmVyKHsNCiAgICAgICAgZWxlbWVudDogdGhpcy5fZ2V0VGVtcGxhdGUoJ2NvbnRhaW5lck91dGVyJywgdGhpcy5fZGlyZWN0aW9uLCB0aGlzLl9pc1NlbGVjdEVsZW1lbnQsIHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCwgdGhpcy5jb25maWcuc2VhcmNoRW5hYmxlZCwgdGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQudHlwZSksDQogICAgICAgIGNsYXNzTmFtZXM6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMsDQogICAgICAgIHR5cGU6IHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LnR5cGUsDQogICAgICAgIHBvc2l0aW9uOiB0aGlzLmNvbmZpZy5wb3NpdGlvbg0KICAgICAgfSk7DQoNCiAgICAgIHRoaXMuY29udGFpbmVySW5uZXIgPSBuZXcgX2NvbXBvbmVudHMuQ29udGFpbmVyKHsNCiAgICAgICAgZWxlbWVudDogdGhpcy5fZ2V0VGVtcGxhdGUoJ2NvbnRhaW5lcklubmVyJyksDQogICAgICAgIGNsYXNzTmFtZXM6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMsDQogICAgICAgIHR5cGU6IHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LnR5cGUsDQogICAgICAgIHBvc2l0aW9uOiB0aGlzLmNvbmZpZy5wb3NpdGlvbg0KICAgICAgfSk7DQoNCiAgICAgIHRoaXMuaW5wdXQgPSBuZXcgX2NvbXBvbmVudHMuSW5wdXQoew0KICAgICAgICBlbGVtZW50OiB0aGlzLl9nZXRUZW1wbGF0ZSgnaW5wdXQnKSwNCiAgICAgICAgY2xhc3NOYW1lczogdGhpcy5jb25maWcuY2xhc3NOYW1lcywNCiAgICAgICAgdHlwZTogdGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQudHlwZQ0KICAgICAgfSk7DQoNCiAgICAgIHRoaXMuY2hvaWNlTGlzdCA9IG5ldyBfY29tcG9uZW50cy5MaXN0KHsNCiAgICAgICAgZWxlbWVudDogdGhpcy5fZ2V0VGVtcGxhdGUoJ2Nob2ljZUxpc3QnLCB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpDQogICAgICB9KTsNCg0KICAgICAgdGhpcy5pdGVtTGlzdCA9IG5ldyBfY29tcG9uZW50cy5MaXN0KHsNCiAgICAgICAgZWxlbWVudDogdGhpcy5fZ2V0VGVtcGxhdGUoJ2l0ZW1MaXN0JywgdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KQ0KICAgICAgfSk7DQoNCiAgICAgIHRoaXMuZHJvcGRvd24gPSBuZXcgX2NvbXBvbmVudHMuRHJvcGRvd24oew0KICAgICAgICBlbGVtZW50OiB0aGlzLl9nZXRUZW1wbGF0ZSgnZHJvcGRvd24nKSwNCiAgICAgICAgY2xhc3NOYW1lczogdGhpcy5jb25maWcuY2xhc3NOYW1lcywNCiAgICAgICAgdHlwZTogdGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQudHlwZQ0KICAgICAgfSk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2NyZWF0ZVN0cnVjdHVyZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVTdHJ1Y3R1cmUoKSB7DQogICAgICAvLyBIaWRlIG9yaWdpbmFsIGVsZW1lbnQNCiAgICAgIHRoaXMucGFzc2VkRWxlbWVudC5jb25jZWFsKCk7DQogICAgICAvLyBXcmFwIGlucHV0IGluIGNvbnRhaW5lciBwcmVzZXJ2aW5nIERPTSBvcmRlcmluZw0KICAgICAgdGhpcy5jb250YWluZXJJbm5lci53cmFwKHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50KTsNCiAgICAgIC8vIFdyYXBwZXIgaW5uZXIgY29udGFpbmVyIHdpdGggb3V0ZXIgY29udGFpbmVyDQogICAgICB0aGlzLmNvbnRhaW5lck91dGVyLndyYXAodGhpcy5jb250YWluZXJJbm5lci5lbGVtZW50KTsNCg0KICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICB0aGlzLmlucHV0LnBsYWNlaG9sZGVyID0gdGhpcy5jb25maWcuc2VhcmNoUGxhY2Vob2xkZXJWYWx1ZSB8fCAnJzsNCiAgICAgIH0gZWxzZSBpZiAodGhpcy5fcGxhY2Vob2xkZXJWYWx1ZSkgew0KICAgICAgICB0aGlzLmlucHV0LnBsYWNlaG9sZGVyID0gdGhpcy5fcGxhY2Vob2xkZXJWYWx1ZTsNCiAgICAgICAgdGhpcy5pbnB1dC5zZXRXaWR0aCh0cnVlKTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuY29udGFpbmVySW5uZXIuZWxlbWVudCk7DQogICAgICB0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5kcm9wZG93bi5lbGVtZW50KTsNCiAgICAgIHRoaXMuY29udGFpbmVySW5uZXIuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLml0ZW1MaXN0LmVsZW1lbnQpOw0KDQogICAgICBpZiAoIXRoaXMuX2lzVGV4dEVsZW1lbnQpIHsNCiAgICAgICAgdGhpcy5kcm9wZG93bi5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuY2hvaWNlTGlzdC5lbGVtZW50KTsNCiAgICAgIH0NCg0KICAgICAgaWYgKCF0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgdGhpcy5jb250YWluZXJJbm5lci5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuaW5wdXQuZWxlbWVudCk7DQogICAgICB9IGVsc2UgaWYgKHRoaXMuY29uZmlnLnNlYXJjaEVuYWJsZWQpIHsNCiAgICAgICAgdGhpcy5kcm9wZG93bi5lbGVtZW50Lmluc2VydEJlZm9yZSh0aGlzLmlucHV0LmVsZW1lbnQsIHRoaXMuZHJvcGRvd24uZWxlbWVudC5maXJzdENoaWxkKTsNCiAgICAgIH0NCg0KICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0RWxlbWVudCkgew0KICAgICAgICB0aGlzLl9hZGRQcmVkZWZpbmVkQ2hvaWNlcygpOw0KICAgICAgfSBlbHNlIGlmICh0aGlzLl9pc1RleHRFbGVtZW50KSB7DQogICAgICAgIHRoaXMuX2FkZFByZWRlZmluZWRJdGVtcygpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19hZGRQcmVkZWZpbmVkQ2hvaWNlcycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9hZGRQcmVkZWZpbmVkQ2hvaWNlcygpIHsNCiAgICAgIHZhciBfdGhpczIyID0gdGhpczsNCg0KICAgICAgdmFyIHBhc3NlZEdyb3VwcyA9IHRoaXMucGFzc2VkRWxlbWVudC5vcHRpb25Hcm91cHM7DQoNCiAgICAgIHRoaXMuX2hpZ2hsaWdodFBvc2l0aW9uID0gMDsNCiAgICAgIHRoaXMuX2lzU2VhcmNoaW5nID0gZmFsc2U7DQoNCiAgICAgIGlmIChwYXNzZWRHcm91cHMgJiYgcGFzc2VkR3JvdXBzLmxlbmd0aCkgew0KICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgcGxhY2Vob2xkZXIgb3B0aW9uDQogICAgICAgIHZhciBwbGFjZWhvbGRlckNob2ljZSA9IHRoaXMucGFzc2VkRWxlbWVudC5wbGFjZWhvbGRlck9wdGlvbjsNCiAgICAgICAgaWYgKHBsYWNlaG9sZGVyQ2hvaWNlICYmIHBsYWNlaG9sZGVyQ2hvaWNlLnBhcmVudE5vZGUudGFnTmFtZSA9PT0gJ1NFTEVDVCcpIHsNCiAgICAgICAgICB0aGlzLl9hZGRDaG9pY2Uoew0KICAgICAgICAgICAgdmFsdWU6IHBsYWNlaG9sZGVyQ2hvaWNlLnZhbHVlLA0KICAgICAgICAgICAgbGFiZWw6IHBsYWNlaG9sZGVyQ2hvaWNlLmlubmVySFRNTCwNCiAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IHBsYWNlaG9sZGVyQ2hvaWNlLnNlbGVjdGVkLA0KICAgICAgICAgICAgaXNEaXNhYmxlZDogcGxhY2Vob2xkZXJDaG9pY2UuZGlzYWJsZWQsDQogICAgICAgICAgICBwbGFjZWhvbGRlcjogdHJ1ZQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgcGFzc2VkR3JvdXBzLmZvckVhY2goZnVuY3Rpb24gKGdyb3VwKSB7DQogICAgICAgICAgcmV0dXJuIF90aGlzMjIuX2FkZEdyb3VwKHsNCiAgICAgICAgICAgIGdyb3VwOiBncm91cCwNCiAgICAgICAgICAgIGlkOiBncm91cC5pZCB8fCBudWxsDQogICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdmFyIHBhc3NlZE9wdGlvbnMgPSB0aGlzLnBhc3NlZEVsZW1lbnQub3B0aW9uczsNCiAgICAgICAgdmFyIGZpbHRlciA9IHRoaXMuY29uZmlnLnNvcnRGbjsNCiAgICAgICAgdmFyIGFsbENob2ljZXMgPSB0aGlzLl9wcmVzZXRDaG9pY2VzOw0KDQogICAgICAgIC8vIENyZWF0ZSBhcnJheSBvZiBvcHRpb25zIGZyb20gb3B0aW9uIGVsZW1lbnRzDQogICAgICAgIHBhc3NlZE9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAobykgew0KICAgICAgICAgIGFsbENob2ljZXMucHVzaCh7DQogICAgICAgICAgICB2YWx1ZTogby52YWx1ZSwNCiAgICAgICAgICAgIGxhYmVsOiBvLmlubmVySFRNTCwNCiAgICAgICAgICAgIHNlbGVjdGVkOiBvLnNlbGVjdGVkLA0KICAgICAgICAgICAgZGlzYWJsZWQ6IG8uZGlzYWJsZWQgfHwgby5wYXJlbnROb2RlLmRpc2FibGVkLA0KICAgICAgICAgICAgcGxhY2Vob2xkZXI6IG8uaGFzQXR0cmlidXRlKCdwbGFjZWhvbGRlcicpDQogICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIElmIHNvcnRpbmcgaXMgZW5hYmxlZCBvciB0aGUgdXNlciBpcyBzZWFyY2hpbmcsIGZpbHRlciBjaG9pY2VzDQogICAgICAgIGlmICh0aGlzLmNvbmZpZy5zaG91bGRTb3J0KSB7DQogICAgICAgICAgYWxsQ2hvaWNlcy5zb3J0KGZpbHRlcik7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBEZXRlcm1pbmUgd2hldGhlciB0aGVyZSBpcyBhIHNlbGVjdGVkIGNob2ljZQ0KICAgICAgICB2YXIgaGFzU2VsZWN0ZWRDaG9pY2UgPSBhbGxDaG9pY2VzLnNvbWUoZnVuY3Rpb24gKGNob2ljZSkgew0KICAgICAgICAgIHJldHVybiBjaG9pY2Uuc2VsZWN0ZWQ7DQogICAgICAgIH0pOw0KICAgICAgICB2YXIgaGFuZGxlQ2hvaWNlID0gZnVuY3Rpb24gaGFuZGxlQ2hvaWNlKGNob2ljZSwgaW5kZXgpIHsNCiAgICAgICAgICB2YXIgdmFsdWUgPSBjaG9pY2UudmFsdWUsDQogICAgICAgICAgICAgIGxhYmVsID0gY2hvaWNlLmxhYmVsLA0KICAgICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzID0gY2hvaWNlLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgICAgIHBsYWNlaG9sZGVyID0gY2hvaWNlLnBsYWNlaG9sZGVyOw0KDQoNCiAgICAgICAgICBpZiAoX3RoaXMyMi5faXNTZWxlY3RFbGVtZW50KSB7DQogICAgICAgICAgICAvLyBJZiB0aGUgY2hvaWNlIGlzIGFjdHVhbGx5IGEgZ3JvdXANCiAgICAgICAgICAgIGlmIChjaG9pY2UuY2hvaWNlcykgew0KICAgICAgICAgICAgICBfdGhpczIyLl9hZGRHcm91cCh7DQogICAgICAgICAgICAgICAgZ3JvdXA6IGNob2ljZSwNCiAgICAgICAgICAgICAgICBpZDogY2hvaWNlLmlkIHx8IG51bGwNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhIHNlbGVjdGVkIGNob2ljZSBhbHJlYWR5IG9yIHRoZSBjaG9pY2UgaXMgbm90DQogICAgICAgICAgICAgIC8vIHRoZSBmaXJzdCBpbiB0aGUgYXJyYXksIGFkZCBlYWNoIGNob2ljZSBub3JtYWxseQ0KICAgICAgICAgICAgICAvLyBPdGhlcndpc2UgcHJlLXNlbGVjdCB0aGUgZmlyc3QgY2hvaWNlIGluIHRoZSBhcnJheSBpZiBpdCdzIGEgc2luZ2xlIHNlbGVjdA0KICAgICAgICAgICAgICB2YXIgc2hvdWxkUHJlc2VsZWN0ID0gX3RoaXMyMi5faXNTZWxlY3RPbmVFbGVtZW50ICYmICFoYXNTZWxlY3RlZENob2ljZSAmJiBpbmRleCA9PT0gMDsNCiAgICAgICAgICAgICAgdmFyIGlzU2VsZWN0ZWQgPSBzaG91bGRQcmVzZWxlY3QgPyB0cnVlIDogY2hvaWNlLnNlbGVjdGVkOw0KICAgICAgICAgICAgICB2YXIgaXNEaXNhYmxlZCA9IHNob3VsZFByZXNlbGVjdCA/IGZhbHNlIDogY2hvaWNlLmRpc2FibGVkOw0KDQogICAgICAgICAgICAgIF90aGlzMjIuX2FkZENob2ljZSh7DQogICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgICAgICAgIGxhYmVsOiBsYWJlbCwNCiAgICAgICAgICAgICAgICBpc1NlbGVjdGVkOiBpc1NlbGVjdGVkLA0KICAgICAgICAgICAgICAgIGlzRGlzYWJsZWQ6IGlzRGlzYWJsZWQsDQogICAgICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllczogY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXINCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIF90aGlzMjIuX2FkZENob2ljZSh7DQogICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICAgICAgbGFiZWw6IGxhYmVsLA0KICAgICAgICAgICAgICBpc1NlbGVjdGVkOiBjaG9pY2Uuc2VsZWN0ZWQsDQogICAgICAgICAgICAgIGlzRGlzYWJsZWQ6IGNob2ljZS5kaXNhYmxlZCwNCiAgICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllczogY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgLy8gQWRkIGVhY2ggY2hvaWNlDQogICAgICAgIGFsbENob2ljZXMuZm9yRWFjaChmdW5jdGlvbiAoY2hvaWNlLCBpbmRleCkgew0KICAgICAgICAgIHJldHVybiBoYW5kbGVDaG9pY2UoY2hvaWNlLCBpbmRleCk7DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19hZGRQcmVkZWZpbmVkSXRlbXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfYWRkUHJlZGVmaW5lZEl0ZW1zKCkgew0KICAgICAgdmFyIF90aGlzMjMgPSB0aGlzOw0KDQogICAgICB2YXIgaGFuZGxlUHJlc2V0SXRlbSA9IGZ1bmN0aW9uIGhhbmRsZVByZXNldEl0ZW0oaXRlbSkgew0KICAgICAgICB2YXIgaXRlbVR5cGUgPSAoMCwgX3V0aWxzLmdldFR5cGUpKGl0ZW0pOw0KICAgICAgICBpZiAoaXRlbVR5cGUgPT09ICdPYmplY3QnICYmIGl0ZW0udmFsdWUpIHsNCiAgICAgICAgICBfdGhpczIzLl9hZGRJdGVtKHsNCiAgICAgICAgICAgIHZhbHVlOiBpdGVtLnZhbHVlLA0KICAgICAgICAgICAgbGFiZWw6IGl0ZW0ubGFiZWwsDQogICAgICAgICAgICBjaG9pY2VJZDogaXRlbS5pZCwNCiAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGl0ZW0uY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBpdGVtLnBsYWNlaG9sZGVyDQogICAgICAgICAgfSk7DQogICAgICAgIH0gZWxzZSBpZiAoaXRlbVR5cGUgPT09ICdTdHJpbmcnKSB7DQogICAgICAgICAgX3RoaXMyMy5fYWRkSXRlbSh7DQogICAgICAgICAgICB2YWx1ZTogaXRlbQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9Ow0KDQogICAgICB0aGlzLl9wcmVzZXRJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgIHJldHVybiBoYW5kbGVQcmVzZXRJdGVtKGl0ZW0pOw0KICAgICAgfSk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX3NldENob2ljZU9ySXRlbScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9zZXRDaG9pY2VPckl0ZW0oaXRlbSkgew0KICAgICAgdmFyIF90aGlzMjQgPSB0aGlzOw0KDQogICAgICB2YXIgaXRlbVR5cGUgPSAoMCwgX3V0aWxzLmdldFR5cGUpKGl0ZW0pLnRvTG93ZXJDYXNlKCk7DQogICAgICB2YXIgaGFuZGxlVHlwZSA9IHsNCiAgICAgICAgb2JqZWN0OiBmdW5jdGlvbiBvYmplY3QoKSB7DQogICAgICAgICAgaWYgKCFpdGVtLnZhbHVlKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gSWYgd2UgYXJlIGRlYWxpbmcgd2l0aCBhIHNlbGVjdCBpbnB1dCwgd2UgbmVlZCB0byBjcmVhdGUgYW4gb3B0aW9uIGZpcnN0DQogICAgICAgICAgLy8gdGhhdCBpcyB0aGVuIHNlbGVjdGVkLiBGb3IgdGV4dCBpbnB1dHMgd2UgY2FuIGp1c3QgYWRkIGl0ZW1zIG5vcm1hbGx5Lg0KICAgICAgICAgIGlmICghX3RoaXMyNC5faXNUZXh0RWxlbWVudCkgew0KICAgICAgICAgICAgX3RoaXMyNC5fYWRkQ2hvaWNlKHsNCiAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0udmFsdWUsDQogICAgICAgICAgICAgIGxhYmVsOiBpdGVtLmxhYmVsLA0KICAgICAgICAgICAgICBpc1NlbGVjdGVkOiB0cnVlLA0KICAgICAgICAgICAgICBpc0Rpc2FibGVkOiBmYWxzZSwNCiAgICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllczogaXRlbS5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogaXRlbS5wbGFjZWhvbGRlcg0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIF90aGlzMjQuX2FkZEl0ZW0oew0KICAgICAgICAgICAgICB2YWx1ZTogaXRlbS52YWx1ZSwNCiAgICAgICAgICAgICAgbGFiZWw6IGl0ZW0ubGFiZWwsDQogICAgICAgICAgICAgIGNob2ljZUlkOiBpdGVtLmlkLA0KICAgICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBpdGVtLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBpdGVtLnBsYWNlaG9sZGVyDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHN0cmluZzogZnVuY3Rpb24gc3RyaW5nKCkgew0KICAgICAgICAgIGlmICghX3RoaXMyNC5faXNUZXh0RWxlbWVudCkgew0KICAgICAgICAgICAgX3RoaXMyNC5fYWRkQ2hvaWNlKHsNCiAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0sDQogICAgICAgICAgICAgIGxhYmVsOiBpdGVtLA0KICAgICAgICAgICAgICBpc1NlbGVjdGVkOiB0cnVlLA0KICAgICAgICAgICAgICBpc0Rpc2FibGVkOiBmYWxzZQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIF90aGlzMjQuX2FkZEl0ZW0oew0KICAgICAgICAgICAgICB2YWx1ZTogaXRlbQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9Ow0KDQogICAgICBoYW5kbGVUeXBlW2l0ZW1UeXBlXSgpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19maW5kQW5kU2VsZWN0Q2hvaWNlQnlWYWx1ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9maW5kQW5kU2VsZWN0Q2hvaWNlQnlWYWx1ZSh2YWwpIHsNCiAgICAgIHZhciBfdGhpczI1ID0gdGhpczsNCg0KICAgICAgdmFyIGNob2ljZXMgPSB0aGlzLl9zdG9yZS5jaG9pY2VzOw0KICAgICAgLy8gQ2hlY2sgJ3ZhbHVlJyBwcm9wZXJ0eSBleGlzdHMgYW5kIHRoZSBjaG9pY2UgaXNuJ3QgYWxyZWFkeSBzZWxlY3RlZA0KICAgICAgdmFyIGZvdW5kQ2hvaWNlID0gY2hvaWNlcy5maW5kKGZ1bmN0aW9uIChjaG9pY2UpIHsNCiAgICAgICAgcmV0dXJuIF90aGlzMjUuY29uZmlnLml0ZW1Db21wYXJlcihjaG9pY2UudmFsdWUsIHZhbCk7DQogICAgICB9KTsNCg0KICAgICAgaWYgKGZvdW5kQ2hvaWNlICYmICFmb3VuZENob2ljZS5zZWxlY3RlZCkgew0KICAgICAgICB0aGlzLl9hZGRJdGVtKHsNCiAgICAgICAgICB2YWx1ZTogZm91bmRDaG9pY2UudmFsdWUsDQogICAgICAgICAgbGFiZWw6IGZvdW5kQ2hvaWNlLmxhYmVsLA0KICAgICAgICAgIGlkOiBmb3VuZENob2ljZS5pZCwNCiAgICAgICAgICBncm91cElkOiBmb3VuZENob2ljZS5ncm91cElkLA0KICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGZvdW5kQ2hvaWNlLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgcGxhY2Vob2xkZXI6IGZvdW5kQ2hvaWNlLnBsYWNlaG9sZGVyLA0KICAgICAgICAgIGtleUNvZGU6IGZvdW5kQ2hvaWNlLmtleUNvZGUNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2dlbmVyYXRlSW5zdGFuY2VzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dlbmVyYXRlSW5zdGFuY2VzKGVsZW1lbnRzLCBjb25maWcpIHsNCiAgICAgIHJldHVybiBlbGVtZW50cy5yZWR1Y2UoZnVuY3Rpb24gKGluc3RhbmNlcywgZWxlbWVudCkgew0KICAgICAgICBpbnN0YW5jZXMucHVzaChuZXcgQ2hvaWNlcyhlbGVtZW50LCBjb25maWcpKTsNCiAgICAgICAgcmV0dXJuIGluc3RhbmNlczsNCiAgICAgIH0sIFt0aGlzXSk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2dlbmVyYXRlUGxhY2Vob2xkZXJWYWx1ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZW5lcmF0ZVBsYWNlaG9sZGVyVmFsdWUoKSB7DQogICAgICBpZiAodGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLnBsYWNlaG9sZGVyID8gdGhpcy5jb25maWcucGxhY2Vob2xkZXJWYWx1ZSB8fCB0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJykgOiBmYWxzZTsNCiAgICB9DQoNCiAgICAvKiA9PT09PSAgRW5kIG9mIFByaXZhdGUgZnVuY3Rpb25zICA9PT09PT0gKi8NCg0KICB9XSk7DQoNCiAgcmV0dXJuIENob2ljZXM7DQp9KCk7DQoNCkNob2ljZXMudXNlckRlZmF1bHRzID0ge307DQovLyBXZSBjYW5ub3QgZXhwb3J0IGRlZmF1bHQgaGVyZSBkdWUgdG8gV2VicGFjazogaHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2svd2VicGFjay9pc3N1ZXMvMzkyOQ0KbW9kdWxlLmV4cG9ydHMgPSBDaG9pY2VzOw0KDQovKioqLyB9KSwNCi8qIDM5ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8qIQ0KICogRnVzZS5qcyB2My4yLjAgLSBMaWdodHdlaWdodCBmdXp6eS1zZWFyY2ggKGh0dHA6Ly9mdXNlanMuaW8pDQogKg0KICogQ29weXJpZ2h0IChjKSAyMDEyLTIwMTcgS2lyb2xsb3MgUmlzayAoaHR0cDovL2tpcm8ubWUpDQogKiBBbGwgUmlnaHRzIFJlc2VydmVkLiBBcGFjaGUgU29mdHdhcmUgTGljZW5zZSAyLjANCiAqDQogKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqLw0KKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHsNCglpZih0cnVlKQ0KCQltb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTsNCgllbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkNCgkJZGVmaW5lKCJGdXNlIiwgW10sIGZhY3RvcnkpOw0KCWVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKQ0KCQlleHBvcnRzWyJGdXNlIl0gPSBmYWN0b3J5KCk7DQoJZWxzZQ0KCQlyb290WyJGdXNlIl0gPSBmYWN0b3J5KCk7DQp9KSh0aGlzLCBmdW5jdGlvbigpIHsNCnJldHVybiAvKioqKioqLyAoZnVuY3Rpb24obW9kdWxlcykgeyAvLyB3ZWJwYWNrQm9vdHN0cmFwDQovKioqKioqLyAJLy8gVGhlIG1vZHVsZSBjYWNoZQ0KLyoqKioqKi8gCXZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307DQovKioqKioqLw0KLyoqKioqKi8gCS8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uDQovKioqKioqLyAJZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgew0KLyoqKioqKi8NCi8qKioqKiovIAkJLy8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlDQovKioqKioqLyAJCWlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7DQovKioqKioqLyAJCQlyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0czsNCi8qKioqKiovIAkJfQ0KLyoqKioqKi8gCQkvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKQ0KLyoqKioqKi8gCQl2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7DQovKioqKioqLyAJCQlpOiBtb2R1bGVJZCwNCi8qKioqKiovIAkJCWw6IGZhbHNlLA0KLyoqKioqKi8gCQkJZXhwb3J0czoge30NCi8qKioqKiovIAkJfTsNCi8qKioqKiovDQovKioqKioqLyAJCS8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvbg0KLyoqKioqKi8gCQltb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTsNCi8qKioqKiovDQovKioqKioqLyAJCS8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWQNCi8qKioqKiovIAkJbW9kdWxlLmwgPSB0cnVlOw0KLyoqKioqKi8NCi8qKioqKiovIAkJLy8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGUNCi8qKioqKiovIAkJcmV0dXJuIG1vZHVsZS5leHBvcnRzOw0KLyoqKioqKi8gCX0NCi8qKioqKiovDQovKioqKioqLw0KLyoqKioqKi8gCS8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pDQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlczsNCi8qKioqKiovDQovKioqKioqLyAJLy8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGUNCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzOw0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBpZGVudGl0eSBmdW5jdGlvbiBmb3IgY2FsbGluZyBoYXJtb255IGltcG9ydHMgd2l0aCB0aGUgY29ycmVjdCBjb250ZXh0DQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5pID0gZnVuY3Rpb24odmFsdWUpIHsgcmV0dXJuIHZhbHVlOyB9Ow0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHMNCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHsNCi8qKioqKiovIAkJaWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkgew0KLyoqKioqKi8gCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsNCi8qKioqKiovIAkJCQljb25maWd1cmFibGU6IGZhbHNlLA0KLyoqKioqKi8gCQkJCWVudW1lcmFibGU6IHRydWUsDQovKioqKioqLyAJCQkJZ2V0OiBnZXR0ZXINCi8qKioqKiovIAkJCX0pOw0KLyoqKioqKi8gCQl9DQovKioqKioqLyAJfTsNCi8qKioqKiovDQovKioqKioqLyAJLy8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXMNCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHsNCi8qKioqKiovIAkJdmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/DQovKioqKioqLyAJCQlmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOg0KLyoqKioqKi8gCQkJZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTsNCi8qKioqKiovIAkJX193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpOw0KLyoqKioqKi8gCQlyZXR1cm4gZ2V0dGVyOw0KLyoqKioqKi8gCX07DQovKioqKioqLw0KLyoqKioqKi8gCS8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbA0KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTsNCi8qKioqKiovDQovKioqKioqLyAJLy8gX193ZWJwYWNrX3B1YmxpY19wYXRoX18NCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSAiIjsNCi8qKioqKiovDQovKioqKioqLyAJLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzDQovKioqKioqLyAJcmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gOCk7DQovKioqKioqLyB9KQ0KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCi8qKioqKiovIChbDQovKiAwICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvYmopIHsNCiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBBcnJheV0nOw0KfTsNCg0KLyoqKi8gfSksDQovKiAxICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsNCg0KZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9DQoNCnZhciBiaXRhcFJlZ2V4U2VhcmNoID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsNCnZhciBiaXRhcFNlYXJjaCA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7DQp2YXIgcGF0dGVybkFscGhhYmV0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTsNCg0KdmFyIEJpdGFwID0gZnVuY3Rpb24gKCkgew0KICBmdW5jdGlvbiBCaXRhcChwYXR0ZXJuLCBfcmVmKSB7DQogICAgdmFyIF9yZWYkbG9jYXRpb24gPSBfcmVmLmxvY2F0aW9uLA0KICAgICAgICBsb2NhdGlvbiA9IF9yZWYkbG9jYXRpb24gPT09IHVuZGVmaW5lZCA/IDAgOiBfcmVmJGxvY2F0aW9uLA0KICAgICAgICBfcmVmJGRpc3RhbmNlID0gX3JlZi5kaXN0YW5jZSwNCiAgICAgICAgZGlzdGFuY2UgPSBfcmVmJGRpc3RhbmNlID09PSB1bmRlZmluZWQgPyAxMDAgOiBfcmVmJGRpc3RhbmNlLA0KICAgICAgICBfcmVmJHRocmVzaG9sZCA9IF9yZWYudGhyZXNob2xkLA0KICAgICAgICB0aHJlc2hvbGQgPSBfcmVmJHRocmVzaG9sZCA9PT0gdW5kZWZpbmVkID8gMC42IDogX3JlZiR0aHJlc2hvbGQsDQogICAgICAgIF9yZWYkbWF4UGF0dGVybkxlbmd0aCA9IF9yZWYubWF4UGF0dGVybkxlbmd0aCwNCiAgICAgICAgbWF4UGF0dGVybkxlbmd0aCA9IF9yZWYkbWF4UGF0dGVybkxlbmd0aCA9PT0gdW5kZWZpbmVkID8gMzIgOiBfcmVmJG1heFBhdHRlcm5MZW5ndGgsDQogICAgICAgIF9yZWYkaXNDYXNlU2Vuc2l0aXZlID0gX3JlZi5pc0Nhc2VTZW5zaXRpdmUsDQogICAgICAgIGlzQ2FzZVNlbnNpdGl2ZSA9IF9yZWYkaXNDYXNlU2Vuc2l0aXZlID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkaXNDYXNlU2Vuc2l0aXZlLA0KICAgICAgICBfcmVmJHRva2VuU2VwYXJhdG9yID0gX3JlZi50b2tlblNlcGFyYXRvciwNCiAgICAgICAgdG9rZW5TZXBhcmF0b3IgPSBfcmVmJHRva2VuU2VwYXJhdG9yID09PSB1bmRlZmluZWQgPyAvICsvZyA6IF9yZWYkdG9rZW5TZXBhcmF0b3IsDQogICAgICAgIF9yZWYkZmluZEFsbE1hdGNoZXMgPSBfcmVmLmZpbmRBbGxNYXRjaGVzLA0KICAgICAgICBmaW5kQWxsTWF0Y2hlcyA9IF9yZWYkZmluZEFsbE1hdGNoZXMgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiRmaW5kQWxsTWF0Y2hlcywNCiAgICAgICAgX3JlZiRtaW5NYXRjaENoYXJMZW5nID0gX3JlZi5taW5NYXRjaENoYXJMZW5ndGgsDQogICAgICAgIG1pbk1hdGNoQ2hhckxlbmd0aCA9IF9yZWYkbWluTWF0Y2hDaGFyTGVuZyA9PT0gdW5kZWZpbmVkID8gMSA6IF9yZWYkbWluTWF0Y2hDaGFyTGVuZzsNCg0KICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBCaXRhcCk7DQoNCiAgICB0aGlzLm9wdGlvbnMgPSB7DQogICAgICBsb2NhdGlvbjogbG9jYXRpb24sDQogICAgICBkaXN0YW5jZTogZGlzdGFuY2UsDQogICAgICB0aHJlc2hvbGQ6IHRocmVzaG9sZCwNCiAgICAgIG1heFBhdHRlcm5MZW5ndGg6IG1heFBhdHRlcm5MZW5ndGgsDQogICAgICBpc0Nhc2VTZW5zaXRpdmU6IGlzQ2FzZVNlbnNpdGl2ZSwNCiAgICAgIHRva2VuU2VwYXJhdG9yOiB0b2tlblNlcGFyYXRvciwNCiAgICAgIGZpbmRBbGxNYXRjaGVzOiBmaW5kQWxsTWF0Y2hlcywNCiAgICAgIG1pbk1hdGNoQ2hhckxlbmd0aDogbWluTWF0Y2hDaGFyTGVuZ3RoDQogICAgfTsNCg0KICAgIHRoaXMucGF0dGVybiA9IHRoaXMub3B0aW9ucy5pc0Nhc2VTZW5zaXRpdmUgPyBwYXR0ZXJuIDogcGF0dGVybi50b0xvd2VyQ2FzZSgpOw0KDQogICAgaWYgKHRoaXMucGF0dGVybi5sZW5ndGggPD0gbWF4UGF0dGVybkxlbmd0aCkgew0KICAgICAgdGhpcy5wYXR0ZXJuQWxwaGFiZXQgPSBwYXR0ZXJuQWxwaGFiZXQodGhpcy5wYXR0ZXJuKTsNCiAgICB9DQogIH0NCg0KICBfY3JlYXRlQ2xhc3MoQml0YXAsIFt7DQogICAga2V5OiAnc2VhcmNoJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VhcmNoKHRleHQpIHsNCiAgICAgIGlmICghdGhpcy5vcHRpb25zLmlzQ2FzZVNlbnNpdGl2ZSkgew0KICAgICAgICB0ZXh0ID0gdGV4dC50b0xvd2VyQ2FzZSgpOw0KICAgICAgfQ0KDQogICAgICAvLyBFeGFjdCBtYXRjaA0KICAgICAgaWYgKHRoaXMucGF0dGVybiA9PT0gdGV4dCkgew0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgIGlzTWF0Y2g6IHRydWUsDQogICAgICAgICAgc2NvcmU6IDAsDQogICAgICAgICAgbWF0Y2hlZEluZGljZXM6IFtbMCwgdGV4dC5sZW5ndGggLSAxXV0NCiAgICAgICAgfTsNCiAgICAgIH0NCg0KICAgICAgLy8gV2hlbiBwYXR0ZXJuIGxlbmd0aCBpcyBncmVhdGVyIHRoYW4gdGhlIG1hY2hpbmUgd29yZCBsZW5ndGgsIGp1c3QgZG8gYSBhIHJlZ2V4IGNvbXBhcmlzb24NCiAgICAgIHZhciBfb3B0aW9ucyA9IHRoaXMub3B0aW9ucywNCiAgICAgICAgICBtYXhQYXR0ZXJuTGVuZ3RoID0gX29wdGlvbnMubWF4UGF0dGVybkxlbmd0aCwNCiAgICAgICAgICB0b2tlblNlcGFyYXRvciA9IF9vcHRpb25zLnRva2VuU2VwYXJhdG9yOw0KDQogICAgICBpZiAodGhpcy5wYXR0ZXJuLmxlbmd0aCA+IG1heFBhdHRlcm5MZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuIGJpdGFwUmVnZXhTZWFyY2godGV4dCwgdGhpcy5wYXR0ZXJuLCB0b2tlblNlcGFyYXRvcik7DQogICAgICB9DQoNCiAgICAgIC8vIE90aGVyd2lzZSwgdXNlIEJpdGFwIGFsZ29yaXRobQ0KICAgICAgdmFyIF9vcHRpb25zMiA9IHRoaXMub3B0aW9ucywNCiAgICAgICAgICBsb2NhdGlvbiA9IF9vcHRpb25zMi5sb2NhdGlvbiwNCiAgICAgICAgICBkaXN0YW5jZSA9IF9vcHRpb25zMi5kaXN0YW5jZSwNCiAgICAgICAgICB0aHJlc2hvbGQgPSBfb3B0aW9uczIudGhyZXNob2xkLA0KICAgICAgICAgIGZpbmRBbGxNYXRjaGVzID0gX29wdGlvbnMyLmZpbmRBbGxNYXRjaGVzLA0KICAgICAgICAgIG1pbk1hdGNoQ2hhckxlbmd0aCA9IF9vcHRpb25zMi5taW5NYXRjaENoYXJMZW5ndGg7DQoNCiAgICAgIHJldHVybiBiaXRhcFNlYXJjaCh0ZXh0LCB0aGlzLnBhdHRlcm4sIHRoaXMucGF0dGVybkFscGhhYmV0LCB7DQogICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwNCiAgICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlLA0KICAgICAgICB0aHJlc2hvbGQ6IHRocmVzaG9sZCwNCiAgICAgICAgZmluZEFsbE1hdGNoZXM6IGZpbmRBbGxNYXRjaGVzLA0KICAgICAgICBtaW5NYXRjaENoYXJMZW5ndGg6IG1pbk1hdGNoQ2hhckxlbmd0aA0KICAgICAgfSk7DQogICAgfQ0KICB9XSk7DQoNCiAgcmV0dXJuIEJpdGFwOw0KfSgpOw0KDQovLyBsZXQgeCA9IG5ldyBCaXRhcCgib2QgbW4gd2FyIiwge30pDQovLyBsZXQgcmVzdWx0ID0geC5zZWFyY2goIk9sZCBNYW4ncyBXYXIiKQ0KLy8gY29uc29sZS5sb2cocmVzdWx0KQ0KDQptb2R1bGUuZXhwb3J0cyA9IEJpdGFwOw0KDQovKioqLyB9KSwNCi8qIDIgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCnZhciBpc0FycmF5ID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKTsNCg0KdmFyIGRlZXBWYWx1ZSA9IGZ1bmN0aW9uIGRlZXBWYWx1ZShvYmosIHBhdGgsIGxpc3QpIHsNCiAgaWYgKCFwYXRoKSB7DQogICAgLy8gSWYgdGhlcmUncyBubyBwYXRoIGxlZnQsIHdlJ3ZlIGdvdHRlbiB0byB0aGUgb2JqZWN0IHdlIGNhcmUgYWJvdXQuDQogICAgbGlzdC5wdXNoKG9iaik7DQogIH0gZWxzZSB7DQogICAgdmFyIGRvdEluZGV4ID0gcGF0aC5pbmRleE9mKCcuJyk7DQogICAgdmFyIGZpcnN0U2VnbWVudCA9IHBhdGg7DQogICAgdmFyIHJlbWFpbmluZyA9IG51bGw7DQoNCiAgICBpZiAoZG90SW5kZXggIT09IC0xKSB7DQogICAgICBmaXJzdFNlZ21lbnQgPSBwYXRoLnNsaWNlKDAsIGRvdEluZGV4KTsNCiAgICAgIHJlbWFpbmluZyA9IHBhdGguc2xpY2UoZG90SW5kZXggKyAxKTsNCiAgICB9DQoNCiAgICB2YXIgdmFsdWUgPSBvYmpbZmlyc3RTZWdtZW50XTsNCg0KICAgIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICBpZiAoIXJlbWFpbmluZyAmJiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSkgew0KICAgICAgICBsaXN0LnB1c2godmFsdWUudG9TdHJpbmcoKSk7DQogICAgICB9IGVsc2UgaWYgKGlzQXJyYXkodmFsdWUpKSB7DQogICAgICAgIC8vIFNlYXJjaCBlYWNoIGl0ZW0gaW4gdGhlIGFycmF5Lg0KICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdmFsdWUubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDEpIHsNCiAgICAgICAgICBkZWVwVmFsdWUodmFsdWVbaV0sIHJlbWFpbmluZywgbGlzdCk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSBpZiAocmVtYWluaW5nKSB7DQogICAgICAgIC8vIEFuIG9iamVjdC4gUmVjdXJzZSBmdXJ0aGVyLg0KICAgICAgICBkZWVwVmFsdWUodmFsdWUsIHJlbWFpbmluZywgbGlzdCk7DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgcmV0dXJuIGxpc3Q7DQp9Ow0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvYmosIHBhdGgpIHsNCiAgcmV0dXJuIGRlZXBWYWx1ZShvYmosIHBhdGgsIFtdKTsNCn07DQoNCi8qKiovIH0pLA0KLyogMyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7DQogIHZhciBtYXRjaG1hc2sgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOw0KICB2YXIgbWluTWF0Y2hDaGFyTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAxOw0KDQogIHZhciBtYXRjaGVkSW5kaWNlcyA9IFtdOw0KICB2YXIgc3RhcnQgPSAtMTsNCiAgdmFyIGVuZCA9IC0xOw0KICB2YXIgaSA9IDA7DQoNCiAgZm9yICh2YXIgbGVuID0gbWF0Y2htYXNrLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAxKSB7DQogICAgdmFyIG1hdGNoID0gbWF0Y2htYXNrW2ldOw0KICAgIGlmIChtYXRjaCAmJiBzdGFydCA9PT0gLTEpIHsNCiAgICAgIHN0YXJ0ID0gaTsNCiAgICB9IGVsc2UgaWYgKCFtYXRjaCAmJiBzdGFydCAhPT0gLTEpIHsNCiAgICAgIGVuZCA9IGkgLSAxOw0KICAgICAgaWYgKGVuZCAtIHN0YXJ0ICsgMSA+PSBtaW5NYXRjaENoYXJMZW5ndGgpIHsNCiAgICAgICAgbWF0Y2hlZEluZGljZXMucHVzaChbc3RhcnQsIGVuZF0pOw0KICAgICAgfQ0KICAgICAgc3RhcnQgPSAtMTsNCiAgICB9DQogIH0NCg0KICAvLyAoaS0xIC0gc3RhcnQpICsgMSA9PiBpIC0gc3RhcnQNCiAgaWYgKG1hdGNobWFza1tpIC0gMV0gJiYgaSAtIHN0YXJ0ID49IG1pbk1hdGNoQ2hhckxlbmd0aCkgew0KICAgIG1hdGNoZWRJbmRpY2VzLnB1c2goW3N0YXJ0LCBpIC0gMV0pOw0KICB9DQoNCiAgcmV0dXJuIG1hdGNoZWRJbmRpY2VzOw0KfTsNCg0KLyoqKi8gfSksDQovKiA0ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChwYXR0ZXJuKSB7DQogIHZhciBtYXNrID0ge307DQogIHZhciBsZW4gPSBwYXR0ZXJuLmxlbmd0aDsNCg0KICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSArPSAxKSB7DQogICAgbWFza1twYXR0ZXJuLmNoYXJBdChpKV0gPSAwOw0KICB9DQoNCiAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGxlbjsgX2kgKz0gMSkgew0KICAgIG1hc2tbcGF0dGVybi5jaGFyQXQoX2kpXSB8PSAxIDw8IGxlbiAtIF9pIC0gMTsNCiAgfQ0KDQogIHJldHVybiBtYXNrOw0KfTsNCg0KLyoqKi8gfSksDQovKiA1ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQp2YXIgU1BFQ0lBTF9DSEFSU19SRUdFWCA9IC9bXC1cW1xdXC9ce1x9XChcKVwqXCtcP1wuXFxcXlwkXHxdL2c7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHRleHQsIHBhdHRlcm4pIHsNCiAgdmFyIHRva2VuU2VwYXJhdG9yID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAvICsvZzsNCg0KICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKHBhdHRlcm4ucmVwbGFjZShTUEVDSUFMX0NIQVJTX1JFR0VYLCAnXFwkJicpLnJlcGxhY2UodG9rZW5TZXBhcmF0b3IsICd8JykpOw0KICB2YXIgbWF0Y2hlcyA9IHRleHQubWF0Y2gocmVnZXgpOw0KICB2YXIgaXNNYXRjaCA9ICEhbWF0Y2hlczsNCiAgdmFyIG1hdGNoZWRJbmRpY2VzID0gW107DQoNCiAgaWYgKGlzTWF0Y2gpIHsNCiAgICBmb3IgKHZhciBpID0gMCwgbWF0Y2hlc0xlbiA9IG1hdGNoZXMubGVuZ3RoOyBpIDwgbWF0Y2hlc0xlbjsgaSArPSAxKSB7DQogICAgICB2YXIgbWF0Y2ggPSBtYXRjaGVzW2ldOw0KICAgICAgbWF0Y2hlZEluZGljZXMucHVzaChbdGV4dC5pbmRleE9mKG1hdGNoKSwgbWF0Y2gubGVuZ3RoIC0gMV0pOw0KICAgIH0NCiAgfQ0KDQogIHJldHVybiB7DQogICAgLy8gVE9ETzogcmV2aXNpdCB0aGlzIHNjb3JlDQogICAgc2NvcmU6IGlzTWF0Y2ggPyAwLjUgOiAxLA0KICAgIGlzTWF0Y2g6IGlzTWF0Y2gsDQogICAgbWF0Y2hlZEluZGljZXM6IG1hdGNoZWRJbmRpY2VzDQogIH07DQp9Ow0KDQovKioqLyB9KSwNCi8qIDYgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHBhdHRlcm4sIF9yZWYpIHsNCiAgdmFyIF9yZWYkZXJyb3JzID0gX3JlZi5lcnJvcnMsDQogICAgICBlcnJvcnMgPSBfcmVmJGVycm9ycyA9PT0gdW5kZWZpbmVkID8gMCA6IF9yZWYkZXJyb3JzLA0KICAgICAgX3JlZiRjdXJyZW50TG9jYXRpb24gPSBfcmVmLmN1cnJlbnRMb2NhdGlvbiwNCiAgICAgIGN1cnJlbnRMb2NhdGlvbiA9IF9yZWYkY3VycmVudExvY2F0aW9uID09PSB1bmRlZmluZWQgPyAwIDogX3JlZiRjdXJyZW50TG9jYXRpb24sDQogICAgICBfcmVmJGV4cGVjdGVkTG9jYXRpb24gPSBfcmVmLmV4cGVjdGVkTG9jYXRpb24sDQogICAgICBleHBlY3RlZExvY2F0aW9uID0gX3JlZiRleHBlY3RlZExvY2F0aW9uID09PSB1bmRlZmluZWQgPyAwIDogX3JlZiRleHBlY3RlZExvY2F0aW9uLA0KICAgICAgX3JlZiRkaXN0YW5jZSA9IF9yZWYuZGlzdGFuY2UsDQogICAgICBkaXN0YW5jZSA9IF9yZWYkZGlzdGFuY2UgPT09IHVuZGVmaW5lZCA/IDEwMCA6IF9yZWYkZGlzdGFuY2U7DQoNCiAgdmFyIGFjY3VyYWN5ID0gZXJyb3JzIC8gcGF0dGVybi5sZW5ndGg7DQogIHZhciBwcm94aW1pdHkgPSBNYXRoLmFicyhleHBlY3RlZExvY2F0aW9uIC0gY3VycmVudExvY2F0aW9uKTsNCg0KICBpZiAoIWRpc3RhbmNlKSB7DQogICAgLy8gRG9kZ2UgZGl2aWRlIGJ5IHplcm8gZXJyb3IuDQogICAgcmV0dXJuIHByb3hpbWl0eSA/IDEuMCA6IGFjY3VyYWN5Ow0KICB9DQoNCiAgcmV0dXJuIGFjY3VyYWN5ICsgcHJveGltaXR5IC8gZGlzdGFuY2U7DQp9Ow0KDQovKioqLyB9KSwNCi8qIDcgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCnZhciBiaXRhcFNjb3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsNCnZhciBtYXRjaGVkSW5kaWNlcyA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHRleHQsIHBhdHRlcm4sIHBhdHRlcm5BbHBoYWJldCwgX3JlZikgew0KICB2YXIgX3JlZiRsb2NhdGlvbiA9IF9yZWYubG9jYXRpb24sDQogICAgICBsb2NhdGlvbiA9IF9yZWYkbG9jYXRpb24gPT09IHVuZGVmaW5lZCA/IDAgOiBfcmVmJGxvY2F0aW9uLA0KICAgICAgX3JlZiRkaXN0YW5jZSA9IF9yZWYuZGlzdGFuY2UsDQogICAgICBkaXN0YW5jZSA9IF9yZWYkZGlzdGFuY2UgPT09IHVuZGVmaW5lZCA/IDEwMCA6IF9yZWYkZGlzdGFuY2UsDQogICAgICBfcmVmJHRocmVzaG9sZCA9IF9yZWYudGhyZXNob2xkLA0KICAgICAgdGhyZXNob2xkID0gX3JlZiR0aHJlc2hvbGQgPT09IHVuZGVmaW5lZCA/IDAuNiA6IF9yZWYkdGhyZXNob2xkLA0KICAgICAgX3JlZiRmaW5kQWxsTWF0Y2hlcyA9IF9yZWYuZmluZEFsbE1hdGNoZXMsDQogICAgICBmaW5kQWxsTWF0Y2hlcyA9IF9yZWYkZmluZEFsbE1hdGNoZXMgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiRmaW5kQWxsTWF0Y2hlcywNCiAgICAgIF9yZWYkbWluTWF0Y2hDaGFyTGVuZyA9IF9yZWYubWluTWF0Y2hDaGFyTGVuZ3RoLA0KICAgICAgbWluTWF0Y2hDaGFyTGVuZ3RoID0gX3JlZiRtaW5NYXRjaENoYXJMZW5nID09PSB1bmRlZmluZWQgPyAxIDogX3JlZiRtaW5NYXRjaENoYXJMZW5nOw0KDQogIHZhciBleHBlY3RlZExvY2F0aW9uID0gbG9jYXRpb247DQogIC8vIFNldCBzdGFydGluZyBsb2NhdGlvbiBhdCBiZWdpbm5pbmcgdGV4dCBhbmQgaW5pdGlhbGl6ZSB0aGUgYWxwaGFiZXQuDQogIHZhciB0ZXh0TGVuID0gdGV4dC5sZW5ndGg7DQogIC8vIEhpZ2hlc3Qgc2NvcmUgYmV5b25kIHdoaWNoIHdlIGdpdmUgdXAuDQogIHZhciBjdXJyZW50VGhyZXNob2xkID0gdGhyZXNob2xkOw0KICAvLyBJcyB0aGVyZSBhIG5lYXJieSBleGFjdCBtYXRjaD8gKHNwZWVkdXApDQogIHZhciBiZXN0TG9jYXRpb24gPSB0ZXh0LmluZGV4T2YocGF0dGVybiwgZXhwZWN0ZWRMb2NhdGlvbik7DQoNCiAgdmFyIHBhdHRlcm5MZW4gPSBwYXR0ZXJuLmxlbmd0aDsNCg0KICAvLyBhIG1hc2sgb2YgdGhlIG1hdGNoZXMNCiAgdmFyIG1hdGNoTWFzayA9IFtdOw0KICBmb3IgKHZhciBpID0gMDsgaSA8IHRleHRMZW47IGkgKz0gMSkgew0KICAgIG1hdGNoTWFza1tpXSA9IDA7DQogIH0NCg0KICBpZiAoYmVzdExvY2F0aW9uICE9PSAtMSkgew0KICAgIHZhciBzY29yZSA9IGJpdGFwU2NvcmUocGF0dGVybiwgew0KICAgICAgZXJyb3JzOiAwLA0KICAgICAgY3VycmVudExvY2F0aW9uOiBiZXN0TG9jYXRpb24sDQogICAgICBleHBlY3RlZExvY2F0aW9uOiBleHBlY3RlZExvY2F0aW9uLA0KICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlDQogICAgfSk7DQogICAgY3VycmVudFRocmVzaG9sZCA9IE1hdGgubWluKHNjb3JlLCBjdXJyZW50VGhyZXNob2xkKTsNCg0KICAgIC8vIFdoYXQgYWJvdXQgaW4gdGhlIG90aGVyIGRpcmVjdGlvbj8gKHNwZWVkIHVwKQ0KICAgIGJlc3RMb2NhdGlvbiA9IHRleHQubGFzdEluZGV4T2YocGF0dGVybiwgZXhwZWN0ZWRMb2NhdGlvbiArIHBhdHRlcm5MZW4pOw0KDQogICAgaWYgKGJlc3RMb2NhdGlvbiAhPT0gLTEpIHsNCiAgICAgIHZhciBfc2NvcmUgPSBiaXRhcFNjb3JlKHBhdHRlcm4sIHsNCiAgICAgICAgZXJyb3JzOiAwLA0KICAgICAgICBjdXJyZW50TG9jYXRpb246IGJlc3RMb2NhdGlvbiwNCiAgICAgICAgZXhwZWN0ZWRMb2NhdGlvbjogZXhwZWN0ZWRMb2NhdGlvbiwNCiAgICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlDQogICAgICB9KTsNCiAgICAgIGN1cnJlbnRUaHJlc2hvbGQgPSBNYXRoLm1pbihfc2NvcmUsIGN1cnJlbnRUaHJlc2hvbGQpOw0KICAgIH0NCiAgfQ0KDQogIC8vIFJlc2V0IHRoZSBiZXN0IGxvY2F0aW9uDQogIGJlc3RMb2NhdGlvbiA9IC0xOw0KDQogIHZhciBsYXN0Qml0QXJyID0gW107DQogIHZhciBmaW5hbFNjb3JlID0gMTsNCiAgdmFyIGJpbk1heCA9IHBhdHRlcm5MZW4gKyB0ZXh0TGVuOw0KDQogIHZhciBtYXNrID0gMSA8PCBwYXR0ZXJuTGVuIC0gMTsNCg0KICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgcGF0dGVybkxlbjsgX2kgKz0gMSkgew0KICAgIC8vIFNjYW4gZm9yIHRoZSBiZXN0IG1hdGNoOyBlYWNoIGl0ZXJhdGlvbiBhbGxvd3MgZm9yIG9uZSBtb3JlIGVycm9yLg0KICAgIC8vIFJ1biBhIGJpbmFyeSBzZWFyY2ggdG8gZGV0ZXJtaW5lIGhvdyBmYXIgZnJvbSB0aGUgbWF0Y2ggbG9jYXRpb24gd2UgY2FuIHN0cmF5DQogICAgLy8gYXQgdGhpcyBlcnJvciBsZXZlbC4NCiAgICB2YXIgYmluTWluID0gMDsNCiAgICB2YXIgYmluTWlkID0gYmluTWF4Ow0KDQogICAgd2hpbGUgKGJpbk1pbiA8IGJpbk1pZCkgew0KICAgICAgdmFyIF9zY29yZTMgPSBiaXRhcFNjb3JlKHBhdHRlcm4sIHsNCiAgICAgICAgZXJyb3JzOiBfaSwNCiAgICAgICAgY3VycmVudExvY2F0aW9uOiBleHBlY3RlZExvY2F0aW9uICsgYmluTWlkLA0KICAgICAgICBleHBlY3RlZExvY2F0aW9uOiBleHBlY3RlZExvY2F0aW9uLA0KICAgICAgICBkaXN0YW5jZTogZGlzdGFuY2UNCiAgICAgIH0pOw0KDQogICAgICBpZiAoX3Njb3JlMyA8PSBjdXJyZW50VGhyZXNob2xkKSB7DQogICAgICAgIGJpbk1pbiA9IGJpbk1pZDsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGJpbk1heCA9IGJpbk1pZDsNCiAgICAgIH0NCg0KICAgICAgYmluTWlkID0gTWF0aC5mbG9vcigoYmluTWF4IC0gYmluTWluKSAvIDIgKyBiaW5NaW4pOw0KICAgIH0NCg0KICAgIC8vIFVzZSB0aGUgcmVzdWx0IGZyb20gdGhpcyBpdGVyYXRpb24gYXMgdGhlIG1heGltdW0gZm9yIHRoZSBuZXh0Lg0KICAgIGJpbk1heCA9IGJpbk1pZDsNCg0KICAgIHZhciBzdGFydCA9IE1hdGgubWF4KDEsIGV4cGVjdGVkTG9jYXRpb24gLSBiaW5NaWQgKyAxKTsNCiAgICB2YXIgZmluaXNoID0gZmluZEFsbE1hdGNoZXMgPyB0ZXh0TGVuIDogTWF0aC5taW4oZXhwZWN0ZWRMb2NhdGlvbiArIGJpbk1pZCwgdGV4dExlbikgKyBwYXR0ZXJuTGVuOw0KDQogICAgLy8gSW5pdGlhbGl6ZSB0aGUgYml0IGFycmF5DQogICAgdmFyIGJpdEFyciA9IEFycmF5KGZpbmlzaCArIDIpOw0KDQogICAgYml0QXJyW2ZpbmlzaCArIDFdID0gKDEgPDwgX2kpIC0gMTsNCg0KICAgIGZvciAodmFyIGogPSBmaW5pc2g7IGogPj0gc3RhcnQ7IGogLT0gMSkgew0KICAgICAgdmFyIGN1cnJlbnRMb2NhdGlvbiA9IGogLSAxOw0KICAgICAgdmFyIGNoYXJNYXRjaCA9IHBhdHRlcm5BbHBoYWJldFt0ZXh0LmNoYXJBdChjdXJyZW50TG9jYXRpb24pXTsNCg0KICAgICAgaWYgKGNoYXJNYXRjaCkgew0KICAgICAgICBtYXRjaE1hc2tbY3VycmVudExvY2F0aW9uXSA9IDE7DQogICAgICB9DQoNCiAgICAgIC8vIEZpcnN0IHBhc3M6IGV4YWN0IG1hdGNoDQogICAgICBiaXRBcnJbal0gPSAoYml0QXJyW2ogKyAxXSA8PCAxIHwgMSkgJiBjaGFyTWF0Y2g7DQoNCiAgICAgIC8vIFN1YnNlcXVlbnQgcGFzc2VzOiBmdXp6eSBtYXRjaA0KICAgICAgaWYgKF9pICE9PSAwKSB7DQogICAgICAgIGJpdEFycltqXSB8PSAobGFzdEJpdEFycltqICsgMV0gfCBsYXN0Qml0QXJyW2pdKSA8PCAxIHwgMSB8IGxhc3RCaXRBcnJbaiArIDFdOw0KICAgICAgfQ0KDQogICAgICBpZiAoYml0QXJyW2pdICYgbWFzaykgew0KICAgICAgICBmaW5hbFNjb3JlID0gYml0YXBTY29yZShwYXR0ZXJuLCB7DQogICAgICAgICAgZXJyb3JzOiBfaSwNCiAgICAgICAgICBjdXJyZW50TG9jYXRpb246IGN1cnJlbnRMb2NhdGlvbiwNCiAgICAgICAgICBleHBlY3RlZExvY2F0aW9uOiBleHBlY3RlZExvY2F0aW9uLA0KICAgICAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZQ0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyBUaGlzIG1hdGNoIHdpbGwgYWxtb3N0IGNlcnRhaW5seSBiZSBiZXR0ZXIgdGhhbiBhbnkgZXhpc3RpbmcgbWF0Y2guDQogICAgICAgIC8vIEJ1dCBjaGVjayBhbnl3YXkuDQogICAgICAgIGlmIChmaW5hbFNjb3JlIDw9IGN1cnJlbnRUaHJlc2hvbGQpIHsNCiAgICAgICAgICAvLyBJbmRlZWQgaXQgaXMNCiAgICAgICAgICBjdXJyZW50VGhyZXNob2xkID0gZmluYWxTY29yZTsNCiAgICAgICAgICBiZXN0TG9jYXRpb24gPSBjdXJyZW50TG9jYXRpb247DQoNCiAgICAgICAgICAvLyBBbHJlYWR5IHBhc3NlZCBgbG9jYCwgZG93bmhpbGwgZnJvbSBoZXJlIG9uIGluLg0KICAgICAgICAgIGlmIChiZXN0TG9jYXRpb24gPD0gZXhwZWN0ZWRMb2NhdGlvbikgew0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gV2hlbiBwYXNzaW5nIGBiZXN0TG9jYXRpb25gLCBkb24ndCBleGNlZWQgb3VyIGN1cnJlbnQgZGlzdGFuY2UgZnJvbSBgZXhwZWN0ZWRMb2NhdGlvbmAuDQogICAgICAgICAgc3RhcnQgPSBNYXRoLm1heCgxLCAyICogZXhwZWN0ZWRMb2NhdGlvbiAtIGJlc3RMb2NhdGlvbik7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBObyBob3BlIGZvciBhIChiZXR0ZXIpIG1hdGNoIGF0IGdyZWF0ZXIgZXJyb3IgbGV2ZWxzLg0KICAgIHZhciBfc2NvcmUyID0gYml0YXBTY29yZShwYXR0ZXJuLCB7DQogICAgICBlcnJvcnM6IF9pICsgMSwNCiAgICAgIGN1cnJlbnRMb2NhdGlvbjogZXhwZWN0ZWRMb2NhdGlvbiwNCiAgICAgIGV4cGVjdGVkTG9jYXRpb246IGV4cGVjdGVkTG9jYXRpb24sDQogICAgICBkaXN0YW5jZTogZGlzdGFuY2UNCiAgICB9KTsNCg0KICAgIGlmIChfc2NvcmUyID4gY3VycmVudFRocmVzaG9sZCkgew0KICAgICAgYnJlYWs7DQogICAgfQ0KDQogICAgbGFzdEJpdEFyciA9IGJpdEFycjsNCiAgfQ0KDQogIC8vIENvdW50IGV4YWN0IG1hdGNoZXMgKHRob3NlIHdpdGggYSBzY29yZSBvZiAwKSB0byBiZSAiYWxtb3N0IiBleGFjdA0KICByZXR1cm4gew0KICAgIGlzTWF0Y2g6IGJlc3RMb2NhdGlvbiA+PSAwLA0KICAgIHNjb3JlOiBmaW5hbFNjb3JlID09PSAwID8gMC4wMDEgOiBmaW5hbFNjb3JlLA0KICAgIG1hdGNoZWRJbmRpY2VzOiBtYXRjaGVkSW5kaWNlcyhtYXRjaE1hc2ssIG1pbk1hdGNoQ2hhckxlbmd0aCkNCiAgfTsNCn07DQoNCi8qKiovIH0pLA0KLyogOCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7DQoNCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQ0KDQp2YXIgQml0YXAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOw0KdmFyIGRlZXBWYWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18oMik7DQp2YXIgaXNBcnJheSA9IF9fd2VicGFja19yZXF1aXJlX18oMCk7DQoNCnZhciBGdXNlID0gZnVuY3Rpb24gKCkgew0KICBmdW5jdGlvbiBGdXNlKGxpc3QsIF9yZWYpIHsNCiAgICB2YXIgX3JlZiRsb2NhdGlvbiA9IF9yZWYubG9jYXRpb24sDQogICAgICAgIGxvY2F0aW9uID0gX3JlZiRsb2NhdGlvbiA9PT0gdW5kZWZpbmVkID8gMCA6IF9yZWYkbG9jYXRpb24sDQogICAgICAgIF9yZWYkZGlzdGFuY2UgPSBfcmVmLmRpc3RhbmNlLA0KICAgICAgICBkaXN0YW5jZSA9IF9yZWYkZGlzdGFuY2UgPT09IHVuZGVmaW5lZCA/IDEwMCA6IF9yZWYkZGlzdGFuY2UsDQogICAgICAgIF9yZWYkdGhyZXNob2xkID0gX3JlZi50aHJlc2hvbGQsDQogICAgICAgIHRocmVzaG9sZCA9IF9yZWYkdGhyZXNob2xkID09PSB1bmRlZmluZWQgPyAwLjYgOiBfcmVmJHRocmVzaG9sZCwNCiAgICAgICAgX3JlZiRtYXhQYXR0ZXJuTGVuZ3RoID0gX3JlZi5tYXhQYXR0ZXJuTGVuZ3RoLA0KICAgICAgICBtYXhQYXR0ZXJuTGVuZ3RoID0gX3JlZiRtYXhQYXR0ZXJuTGVuZ3RoID09PSB1bmRlZmluZWQgPyAzMiA6IF9yZWYkbWF4UGF0dGVybkxlbmd0aCwNCiAgICAgICAgX3JlZiRjYXNlU2Vuc2l0aXZlID0gX3JlZi5jYXNlU2Vuc2l0aXZlLA0KICAgICAgICBjYXNlU2Vuc2l0aXZlID0gX3JlZiRjYXNlU2Vuc2l0aXZlID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkY2FzZVNlbnNpdGl2ZSwNCiAgICAgICAgX3JlZiR0b2tlblNlcGFyYXRvciA9IF9yZWYudG9rZW5TZXBhcmF0b3IsDQogICAgICAgIHRva2VuU2VwYXJhdG9yID0gX3JlZiR0b2tlblNlcGFyYXRvciA9PT0gdW5kZWZpbmVkID8gLyArL2cgOiBfcmVmJHRva2VuU2VwYXJhdG9yLA0KICAgICAgICBfcmVmJGZpbmRBbGxNYXRjaGVzID0gX3JlZi5maW5kQWxsTWF0Y2hlcywNCiAgICAgICAgZmluZEFsbE1hdGNoZXMgPSBfcmVmJGZpbmRBbGxNYXRjaGVzID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkZmluZEFsbE1hdGNoZXMsDQogICAgICAgIF9yZWYkbWluTWF0Y2hDaGFyTGVuZyA9IF9yZWYubWluTWF0Y2hDaGFyTGVuZ3RoLA0KICAgICAgICBtaW5NYXRjaENoYXJMZW5ndGggPSBfcmVmJG1pbk1hdGNoQ2hhckxlbmcgPT09IHVuZGVmaW5lZCA/IDEgOiBfcmVmJG1pbk1hdGNoQ2hhckxlbmcsDQogICAgICAgIF9yZWYkaWQgPSBfcmVmLmlkLA0KICAgICAgICBpZCA9IF9yZWYkaWQgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBfcmVmJGlkLA0KICAgICAgICBfcmVmJGtleXMgPSBfcmVmLmtleXMsDQogICAgICAgIGtleXMgPSBfcmVmJGtleXMgPT09IHVuZGVmaW5lZCA/IFtdIDogX3JlZiRrZXlzLA0KICAgICAgICBfcmVmJHNob3VsZFNvcnQgPSBfcmVmLnNob3VsZFNvcnQsDQogICAgICAgIHNob3VsZFNvcnQgPSBfcmVmJHNob3VsZFNvcnQgPT09IHVuZGVmaW5lZCA/IHRydWUgOiBfcmVmJHNob3VsZFNvcnQsDQogICAgICAgIF9yZWYkZ2V0Rm4gPSBfcmVmLmdldEZuLA0KICAgICAgICBnZXRGbiA9IF9yZWYkZ2V0Rm4gPT09IHVuZGVmaW5lZCA/IGRlZXBWYWx1ZSA6IF9yZWYkZ2V0Rm4sDQogICAgICAgIF9yZWYkc29ydEZuID0gX3JlZi5zb3J0Rm4sDQogICAgICAgIHNvcnRGbiA9IF9yZWYkc29ydEZuID09PSB1bmRlZmluZWQgPyBmdW5jdGlvbiAoYSwgYikgew0KICAgICAgcmV0dXJuIGEuc2NvcmUgLSBiLnNjb3JlOw0KICAgIH0gOiBfcmVmJHNvcnRGbiwNCiAgICAgICAgX3JlZiR0b2tlbml6ZSA9IF9yZWYudG9rZW5pemUsDQogICAgICAgIHRva2VuaXplID0gX3JlZiR0b2tlbml6ZSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmJHRva2VuaXplLA0KICAgICAgICBfcmVmJG1hdGNoQWxsVG9rZW5zID0gX3JlZi5tYXRjaEFsbFRva2VucywNCiAgICAgICAgbWF0Y2hBbGxUb2tlbnMgPSBfcmVmJG1hdGNoQWxsVG9rZW5zID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkbWF0Y2hBbGxUb2tlbnMsDQogICAgICAgIF9yZWYkaW5jbHVkZU1hdGNoZXMgPSBfcmVmLmluY2x1ZGVNYXRjaGVzLA0KICAgICAgICBpbmNsdWRlTWF0Y2hlcyA9IF9yZWYkaW5jbHVkZU1hdGNoZXMgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiRpbmNsdWRlTWF0Y2hlcywNCiAgICAgICAgX3JlZiRpbmNsdWRlU2NvcmUgPSBfcmVmLmluY2x1ZGVTY29yZSwNCiAgICAgICAgaW5jbHVkZVNjb3JlID0gX3JlZiRpbmNsdWRlU2NvcmUgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiRpbmNsdWRlU2NvcmUsDQogICAgICAgIF9yZWYkdmVyYm9zZSA9IF9yZWYudmVyYm9zZSwNCiAgICAgICAgdmVyYm9zZSA9IF9yZWYkdmVyYm9zZSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmJHZlcmJvc2U7DQoNCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRnVzZSk7DQoNCiAgICB0aGlzLm9wdGlvbnMgPSB7DQogICAgICBsb2NhdGlvbjogbG9jYXRpb24sDQogICAgICBkaXN0YW5jZTogZGlzdGFuY2UsDQogICAgICB0aHJlc2hvbGQ6IHRocmVzaG9sZCwNCiAgICAgIG1heFBhdHRlcm5MZW5ndGg6IG1heFBhdHRlcm5MZW5ndGgsDQogICAgICBpc0Nhc2VTZW5zaXRpdmU6IGNhc2VTZW5zaXRpdmUsDQogICAgICB0b2tlblNlcGFyYXRvcjogdG9rZW5TZXBhcmF0b3IsDQogICAgICBmaW5kQWxsTWF0Y2hlczogZmluZEFsbE1hdGNoZXMsDQogICAgICBtaW5NYXRjaENoYXJMZW5ndGg6IG1pbk1hdGNoQ2hhckxlbmd0aCwNCiAgICAgIGlkOiBpZCwNCiAgICAgIGtleXM6IGtleXMsDQogICAgICBpbmNsdWRlTWF0Y2hlczogaW5jbHVkZU1hdGNoZXMsDQogICAgICBpbmNsdWRlU2NvcmU6IGluY2x1ZGVTY29yZSwNCiAgICAgIHNob3VsZFNvcnQ6IHNob3VsZFNvcnQsDQogICAgICBnZXRGbjogZ2V0Rm4sDQogICAgICBzb3J0Rm46IHNvcnRGbiwNCiAgICAgIHZlcmJvc2U6IHZlcmJvc2UsDQogICAgICB0b2tlbml6ZTogdG9rZW5pemUsDQogICAgICBtYXRjaEFsbFRva2VuczogbWF0Y2hBbGxUb2tlbnMNCiAgICB9Ow0KDQogICAgdGhpcy5zZXRDb2xsZWN0aW9uKGxpc3QpOw0KICB9DQoNCiAgX2NyZWF0ZUNsYXNzKEZ1c2UsIFt7DQogICAga2V5OiAnc2V0Q29sbGVjdGlvbicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNldENvbGxlY3Rpb24obGlzdCkgew0KICAgICAgdGhpcy5saXN0ID0gbGlzdDsNCiAgICAgIHJldHVybiBsaXN0Ow0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3NlYXJjaCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNlYXJjaChwYXR0ZXJuKSB7DQogICAgICB0aGlzLl9sb2coJy0tLS0tLS0tLVxuU2VhcmNoIHBhdHRlcm46ICInICsgcGF0dGVybiArICciJyk7DQoNCiAgICAgIHZhciBfcHJlcGFyZVNlYXJjaGVyczIgPSB0aGlzLl9wcmVwYXJlU2VhcmNoZXJzKHBhdHRlcm4pLA0KICAgICAgICAgIHRva2VuU2VhcmNoZXJzID0gX3ByZXBhcmVTZWFyY2hlcnMyLnRva2VuU2VhcmNoZXJzLA0KICAgICAgICAgIGZ1bGxTZWFyY2hlciA9IF9wcmVwYXJlU2VhcmNoZXJzMi5mdWxsU2VhcmNoZXI7DQoNCiAgICAgIHZhciBfc2VhcmNoMiA9IHRoaXMuX3NlYXJjaCh0b2tlblNlYXJjaGVycywgZnVsbFNlYXJjaGVyKSwNCiAgICAgICAgICB3ZWlnaHRzID0gX3NlYXJjaDIud2VpZ2h0cywNCiAgICAgICAgICByZXN1bHRzID0gX3NlYXJjaDIucmVzdWx0czsNCg0KICAgICAgdGhpcy5fY29tcHV0ZVNjb3JlKHdlaWdodHMsIHJlc3VsdHMpOw0KDQogICAgICBpZiAodGhpcy5vcHRpb25zLnNob3VsZFNvcnQpIHsNCiAgICAgICAgdGhpcy5fc29ydChyZXN1bHRzKTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHRoaXMuX2Zvcm1hdChyZXN1bHRzKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfcHJlcGFyZVNlYXJjaGVycycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9wcmVwYXJlU2VhcmNoZXJzKCkgew0KICAgICAgdmFyIHBhdHRlcm4gPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICcnOw0KDQogICAgICB2YXIgdG9rZW5TZWFyY2hlcnMgPSBbXTsNCg0KICAgICAgaWYgKHRoaXMub3B0aW9ucy50b2tlbml6ZSkgew0KICAgICAgICAvLyBUb2tlbml6ZSBvbiB0aGUgc2VwYXJhdG9yDQogICAgICAgIHZhciB0b2tlbnMgPSBwYXR0ZXJuLnNwbGl0KHRoaXMub3B0aW9ucy50b2tlblNlcGFyYXRvcik7DQogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0b2tlbnMubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDEpIHsNCiAgICAgICAgICB0b2tlblNlYXJjaGVycy5wdXNoKG5ldyBCaXRhcCh0b2tlbnNbaV0sIHRoaXMub3B0aW9ucykpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHZhciBmdWxsU2VhcmNoZXIgPSBuZXcgQml0YXAocGF0dGVybiwgdGhpcy5vcHRpb25zKTsNCg0KICAgICAgcmV0dXJuIHsgdG9rZW5TZWFyY2hlcnM6IHRva2VuU2VhcmNoZXJzLCBmdWxsU2VhcmNoZXI6IGZ1bGxTZWFyY2hlciB9Ow0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19zZWFyY2gnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfc2VhcmNoKCkgew0KICAgICAgdmFyIHRva2VuU2VhcmNoZXJzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTsNCiAgICAgIHZhciBmdWxsU2VhcmNoZXIgPSBhcmd1bWVudHNbMV07DQoNCiAgICAgIHZhciBsaXN0ID0gdGhpcy5saXN0Ow0KICAgICAgdmFyIHJlc3VsdE1hcCA9IHt9Ow0KICAgICAgdmFyIHJlc3VsdHMgPSBbXTsNCg0KICAgICAgLy8gQ2hlY2sgdGhlIGZpcnN0IGl0ZW0gaW4gdGhlIGxpc3QsIGlmIGl0J3MgYSBzdHJpbmcsIHRoZW4gd2UgYXNzdW1lDQogICAgICAvLyB0aGF0IGV2ZXJ5IGl0ZW0gaW4gdGhlIGxpc3QgaXMgYWxzbyBhIHN0cmluZywgYW5kIHRodXMgaXQncyBhIGZsYXR0ZW5lZCBhcnJheS4NCiAgICAgIGlmICh0eXBlb2YgbGlzdFswXSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgLy8gSXRlcmF0ZSBvdmVyIGV2ZXJ5IGl0ZW0NCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGxpc3QubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDEpIHsNCiAgICAgICAgICB0aGlzLl9hbmFseXplKHsNCiAgICAgICAgICAgIGtleTogJycsDQogICAgICAgICAgICB2YWx1ZTogbGlzdFtpXSwNCiAgICAgICAgICAgIHJlY29yZDogaSwNCiAgICAgICAgICAgIGluZGV4OiBpDQogICAgICAgICAgfSwgew0KICAgICAgICAgICAgcmVzdWx0TWFwOiByZXN1bHRNYXAsDQogICAgICAgICAgICByZXN1bHRzOiByZXN1bHRzLA0KICAgICAgICAgICAgdG9rZW5TZWFyY2hlcnM6IHRva2VuU2VhcmNoZXJzLA0KICAgICAgICAgICAgZnVsbFNlYXJjaGVyOiBmdWxsU2VhcmNoZXINCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB7IHdlaWdodHM6IG51bGwsIHJlc3VsdHM6IHJlc3VsdHMgfTsNCiAgICAgIH0NCg0KICAgICAgLy8gT3RoZXJ3aXNlLCB0aGUgZmlyc3QgaXRlbSBpcyBhbiBPYmplY3QgKGhvcGVmdWxseSksIGFuZCB0aHVzIHRoZSBzZWFyY2hpbmcNCiAgICAgIC8vIGlzIGRvbmUgb24gdGhlIHZhbHVlcyBvZiB0aGUga2V5cyBvZiBlYWNoIGl0ZW0uDQogICAgICB2YXIgd2VpZ2h0cyA9IHt9Ow0KICAgICAgZm9yICh2YXIgX2kgPSAwLCBfbGVuID0gbGlzdC5sZW5ndGg7IF9pIDwgX2xlbjsgX2kgKz0gMSkgew0KICAgICAgICB2YXIgaXRlbSA9IGxpc3RbX2ldOw0KICAgICAgICAvLyBJdGVyYXRlIG92ZXIgZXZlcnkga2V5DQogICAgICAgIGZvciAodmFyIGogPSAwLCBrZXlzTGVuID0gdGhpcy5vcHRpb25zLmtleXMubGVuZ3RoOyBqIDwga2V5c0xlbjsgaiArPSAxKSB7DQogICAgICAgICAgdmFyIGtleSA9IHRoaXMub3B0aW9ucy5rZXlzW2pdOw0KICAgICAgICAgIGlmICh0eXBlb2Yga2V5ICE9PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgd2VpZ2h0c1trZXkubmFtZV0gPSB7DQogICAgICAgICAgICAgIHdlaWdodDogMSAtIGtleS53ZWlnaHQgfHwgMQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIGlmIChrZXkud2VpZ2h0IDw9IDAgfHwga2V5LndlaWdodCA+IDEpIHsNCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdLZXkgd2VpZ2h0IGhhcyB0byBiZSA+IDAgYW5kIDw9IDEnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGtleSA9IGtleS5uYW1lOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB3ZWlnaHRzW2tleV0gPSB7DQogICAgICAgICAgICAgIHdlaWdodDogMQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICB0aGlzLl9hbmFseXplKHsNCiAgICAgICAgICAgIGtleToga2V5LA0KICAgICAgICAgICAgdmFsdWU6IHRoaXMub3B0aW9ucy5nZXRGbihpdGVtLCBrZXkpLA0KICAgICAgICAgICAgcmVjb3JkOiBpdGVtLA0KICAgICAgICAgICAgaW5kZXg6IF9pDQogICAgICAgICAgfSwgew0KICAgICAgICAgICAgcmVzdWx0TWFwOiByZXN1bHRNYXAsDQogICAgICAgICAgICByZXN1bHRzOiByZXN1bHRzLA0KICAgICAgICAgICAgdG9rZW5TZWFyY2hlcnM6IHRva2VuU2VhcmNoZXJzLA0KICAgICAgICAgICAgZnVsbFNlYXJjaGVyOiBmdWxsU2VhcmNoZXINCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICByZXR1cm4geyB3ZWlnaHRzOiB3ZWlnaHRzLCByZXN1bHRzOiByZXN1bHRzIH07DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2FuYWx5emUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfYW5hbHl6ZShfcmVmMiwgX3JlZjMpIHsNCiAgICAgIHZhciBrZXkgPSBfcmVmMi5rZXksDQogICAgICAgICAgX3JlZjIkYXJyYXlJbmRleCA9IF9yZWYyLmFycmF5SW5kZXgsDQogICAgICAgICAgYXJyYXlJbmRleCA9IF9yZWYyJGFycmF5SW5kZXggPT09IHVuZGVmaW5lZCA/IC0xIDogX3JlZjIkYXJyYXlJbmRleCwNCiAgICAgICAgICB2YWx1ZSA9IF9yZWYyLnZhbHVlLA0KICAgICAgICAgIHJlY29yZCA9IF9yZWYyLnJlY29yZCwNCiAgICAgICAgICBpbmRleCA9IF9yZWYyLmluZGV4Ow0KICAgICAgdmFyIF9yZWYzJHRva2VuU2VhcmNoZXJzID0gX3JlZjMudG9rZW5TZWFyY2hlcnMsDQogICAgICAgICAgdG9rZW5TZWFyY2hlcnMgPSBfcmVmMyR0b2tlblNlYXJjaGVycyA9PT0gdW5kZWZpbmVkID8gW10gOiBfcmVmMyR0b2tlblNlYXJjaGVycywNCiAgICAgICAgICBfcmVmMyRmdWxsU2VhcmNoZXIgPSBfcmVmMy5mdWxsU2VhcmNoZXIsDQogICAgICAgICAgZnVsbFNlYXJjaGVyID0gX3JlZjMkZnVsbFNlYXJjaGVyID09PSB1bmRlZmluZWQgPyBbXSA6IF9yZWYzJGZ1bGxTZWFyY2hlciwNCiAgICAgICAgICBfcmVmMyRyZXN1bHRNYXAgPSBfcmVmMy5yZXN1bHRNYXAsDQogICAgICAgICAgcmVzdWx0TWFwID0gX3JlZjMkcmVzdWx0TWFwID09PSB1bmRlZmluZWQgPyB7fSA6IF9yZWYzJHJlc3VsdE1hcCwNCiAgICAgICAgICBfcmVmMyRyZXN1bHRzID0gX3JlZjMucmVzdWx0cywNCiAgICAgICAgICByZXN1bHRzID0gX3JlZjMkcmVzdWx0cyA9PT0gdW5kZWZpbmVkID8gW10gOiBfcmVmMyRyZXN1bHRzOw0KDQogICAgICAvLyBDaGVjayBpZiB0aGUgdGV4dmFsdWV0IGNhbiBiZSBzZWFyY2hlZA0KICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB2YXIgZXhpc3RzID0gZmFsc2U7DQogICAgICB2YXIgYXZlcmFnZVNjb3JlID0gLTE7DQogICAgICB2YXIgbnVtVGV4dE1hdGNoZXMgPSAwOw0KDQogICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgew0KICAgICAgICB0aGlzLl9sb2coJ1xuS2V5OiAnICsgKGtleSA9PT0gJycgPyAnLScgOiBrZXkpKTsNCg0KICAgICAgICB2YXIgbWFpblNlYXJjaFJlc3VsdCA9IGZ1bGxTZWFyY2hlci5zZWFyY2godmFsdWUpOw0KICAgICAgICB0aGlzLl9sb2coJ0Z1bGwgdGV4dDogIicgKyB2YWx1ZSArICciLCBzY29yZTogJyArIG1haW5TZWFyY2hSZXN1bHQuc2NvcmUpOw0KDQogICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG9rZW5pemUpIHsNCiAgICAgICAgICB2YXIgd29yZHMgPSB2YWx1ZS5zcGxpdCh0aGlzLm9wdGlvbnMudG9rZW5TZXBhcmF0b3IpOw0KICAgICAgICAgIHZhciBzY29yZXMgPSBbXTsNCg0KICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdG9rZW5TZWFyY2hlcnMubGVuZ3RoOyBpICs9IDEpIHsNCiAgICAgICAgICAgIHZhciB0b2tlblNlYXJjaGVyID0gdG9rZW5TZWFyY2hlcnNbaV07DQoNCiAgICAgICAgICAgIHRoaXMuX2xvZygnXG5QYXR0ZXJuOiAiJyArIHRva2VuU2VhcmNoZXIucGF0dGVybiArICciJyk7DQoNCiAgICAgICAgICAgIC8vIGxldCB0b2tlblNjb3JlcyA9IFtdDQogICAgICAgICAgICB2YXIgaGFzTWF0Y2hJblRleHQgPSBmYWxzZTsNCg0KICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3b3Jkcy5sZW5ndGg7IGogKz0gMSkgew0KICAgICAgICAgICAgICB2YXIgd29yZCA9IHdvcmRzW2pdOw0KICAgICAgICAgICAgICB2YXIgdG9rZW5TZWFyY2hSZXN1bHQgPSB0b2tlblNlYXJjaGVyLnNlYXJjaCh3b3JkKTsNCiAgICAgICAgICAgICAgdmFyIG9iaiA9IHt9Ow0KICAgICAgICAgICAgICBpZiAodG9rZW5TZWFyY2hSZXN1bHQuaXNNYXRjaCkgew0KICAgICAgICAgICAgICAgIG9ialt3b3JkXSA9IHRva2VuU2VhcmNoUmVzdWx0LnNjb3JlOw0KICAgICAgICAgICAgICAgIGV4aXN0cyA9IHRydWU7DQogICAgICAgICAgICAgICAgaGFzTWF0Y2hJblRleHQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIHNjb3Jlcy5wdXNoKHRva2VuU2VhcmNoUmVzdWx0LnNjb3JlKTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBvYmpbd29yZF0gPSAxOw0KICAgICAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLm1hdGNoQWxsVG9rZW5zKSB7DQogICAgICAgICAgICAgICAgICBzY29yZXMucHVzaCgxKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdGhpcy5fbG9nKCdUb2tlbjogIicgKyB3b3JkICsgJyIsIHNjb3JlOiAnICsgb2JqW3dvcmRdKTsNCiAgICAgICAgICAgICAgLy8gdG9rZW5TY29yZXMucHVzaChvYmopDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChoYXNNYXRjaEluVGV4dCkgew0KICAgICAgICAgICAgICBudW1UZXh0TWF0Y2hlcyArPSAxOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGF2ZXJhZ2VTY29yZSA9IHNjb3Jlc1swXTsNCiAgICAgICAgICB2YXIgc2NvcmVzTGVuID0gc2NvcmVzLmxlbmd0aDsNCiAgICAgICAgICBmb3IgKHZhciBfaTIgPSAxOyBfaTIgPCBzY29yZXNMZW47IF9pMiArPSAxKSB7DQogICAgICAgICAgICBhdmVyYWdlU2NvcmUgKz0gc2NvcmVzW19pMl07DQogICAgICAgICAgfQ0KICAgICAgICAgIGF2ZXJhZ2VTY29yZSA9IGF2ZXJhZ2VTY29yZSAvIHNjb3Jlc0xlbjsNCg0KICAgICAgICAgIHRoaXMuX2xvZygnVG9rZW4gc2NvcmUgYXZlcmFnZTonLCBhdmVyYWdlU2NvcmUpOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGZpbmFsU2NvcmUgPSBtYWluU2VhcmNoUmVzdWx0LnNjb3JlOw0KICAgICAgICBpZiAoYXZlcmFnZVNjb3JlID4gLTEpIHsNCiAgICAgICAgICBmaW5hbFNjb3JlID0gKGZpbmFsU2NvcmUgKyBhdmVyYWdlU2NvcmUpIC8gMjsNCiAgICAgICAgfQ0KDQogICAgICAgIHRoaXMuX2xvZygnU2NvcmUgYXZlcmFnZTonLCBmaW5hbFNjb3JlKTsNCg0KICAgICAgICB2YXIgY2hlY2tUZXh0TWF0Y2hlcyA9IHRoaXMub3B0aW9ucy50b2tlbml6ZSAmJiB0aGlzLm9wdGlvbnMubWF0Y2hBbGxUb2tlbnMgPyBudW1UZXh0TWF0Y2hlcyA+PSB0b2tlblNlYXJjaGVycy5sZW5ndGggOiB0cnVlOw0KDQogICAgICAgIHRoaXMuX2xvZygnXG5DaGVjayBNYXRjaGVzOiAnICsgY2hlY2tUZXh0TWF0Y2hlcyk7DQoNCiAgICAgICAgLy8gSWYgYSBtYXRjaCBpcyBmb3VuZCwgYWRkIHRoZSBpdGVtIHRvIDxyYXdSZXN1bHRzPiwgaW5jbHVkaW5nIGl0cyBzY29yZQ0KICAgICAgICBpZiAoKGV4aXN0cyB8fCBtYWluU2VhcmNoUmVzdWx0LmlzTWF0Y2gpICYmIGNoZWNrVGV4dE1hdGNoZXMpIHsNCiAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgaXRlbSBhbHJlYWR5IGV4aXN0cyBpbiBvdXIgcmVzdWx0cw0KICAgICAgICAgIHZhciBleGlzdGluZ1Jlc3VsdCA9IHJlc3VsdE1hcFtpbmRleF07DQogICAgICAgICAgaWYgKGV4aXN0aW5nUmVzdWx0KSB7DQogICAgICAgICAgICAvLyBVc2UgdGhlIGxvd2VzdCBzY29yZQ0KICAgICAgICAgICAgLy8gZXhpc3RpbmdSZXN1bHQuc2NvcmUsIGJpdGFwUmVzdWx0LnNjb3JlDQogICAgICAgICAgICBleGlzdGluZ1Jlc3VsdC5vdXRwdXQucHVzaCh7DQogICAgICAgICAgICAgIGtleToga2V5LA0KICAgICAgICAgICAgICBhcnJheUluZGV4OiBhcnJheUluZGV4LA0KICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsDQogICAgICAgICAgICAgIHNjb3JlOiBmaW5hbFNjb3JlLA0KICAgICAgICAgICAgICBtYXRjaGVkSW5kaWNlczogbWFpblNlYXJjaFJlc3VsdC5tYXRjaGVkSW5kaWNlcw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIEFkZCBpdCB0byB0aGUgcmF3IHJlc3VsdCBsaXN0DQogICAgICAgICAgICByZXN1bHRNYXBbaW5kZXhdID0gew0KICAgICAgICAgICAgICBpdGVtOiByZWNvcmQsDQogICAgICAgICAgICAgIG91dHB1dDogW3sNCiAgICAgICAgICAgICAgICBrZXk6IGtleSwNCiAgICAgICAgICAgICAgICBhcnJheUluZGV4OiBhcnJheUluZGV4LA0KICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICAgICAgICBzY29yZTogZmluYWxTY29yZSwNCiAgICAgICAgICAgICAgICBtYXRjaGVkSW5kaWNlczogbWFpblNlYXJjaFJlc3VsdC5tYXRjaGVkSW5kaWNlcw0KICAgICAgICAgICAgICB9XQ0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdE1hcFtpbmRleF0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmIChpc0FycmF5KHZhbHVlKSkgew0KICAgICAgICBmb3IgKHZhciBfaTMgPSAwLCBsZW4gPSB2YWx1ZS5sZW5ndGg7IF9pMyA8IGxlbjsgX2kzICs9IDEpIHsNCiAgICAgICAgICB0aGlzLl9hbmFseXplKHsNCiAgICAgICAgICAgIGtleToga2V5LA0KICAgICAgICAgICAgYXJyYXlJbmRleDogX2kzLA0KICAgICAgICAgICAgdmFsdWU6IHZhbHVlW19pM10sDQogICAgICAgICAgICByZWNvcmQ6IHJlY29yZCwNCiAgICAgICAgICAgIGluZGV4OiBpbmRleA0KICAgICAgICAgIH0sIHsNCiAgICAgICAgICAgIHJlc3VsdE1hcDogcmVzdWx0TWFwLA0KICAgICAgICAgICAgcmVzdWx0czogcmVzdWx0cywNCiAgICAgICAgICAgIHRva2VuU2VhcmNoZXJzOiB0b2tlblNlYXJjaGVycywNCiAgICAgICAgICAgIGZ1bGxTZWFyY2hlcjogZnVsbFNlYXJjaGVyDQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfY29tcHV0ZVNjb3JlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NvbXB1dGVTY29yZSh3ZWlnaHRzLCByZXN1bHRzKSB7DQogICAgICB0aGlzLl9sb2coJ1xuXG5Db21wdXRpbmcgc2NvcmU6XG4nKTsNCg0KICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHJlc3VsdHMubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDEpIHsNCiAgICAgICAgdmFyIG91dHB1dCA9IHJlc3VsdHNbaV0ub3V0cHV0Ow0KICAgICAgICB2YXIgc2NvcmVMZW4gPSBvdXRwdXQubGVuZ3RoOw0KDQogICAgICAgIHZhciB0b3RhbFNjb3JlID0gMDsNCiAgICAgICAgdmFyIGJlc3RTY29yZSA9IDE7DQoNCiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzY29yZUxlbjsgaiArPSAxKSB7DQogICAgICAgICAgdmFyIHdlaWdodCA9IHdlaWdodHMgPyB3ZWlnaHRzW291dHB1dFtqXS5rZXldLndlaWdodCA6IDE7DQogICAgICAgICAgdmFyIHNjb3JlID0gd2VpZ2h0ID09PSAxID8gb3V0cHV0W2pdLnNjb3JlIDogb3V0cHV0W2pdLnNjb3JlIHx8IDAuMDAxOw0KICAgICAgICAgIHZhciBuU2NvcmUgPSBzY29yZSAqIHdlaWdodDsNCg0KICAgICAgICAgIGlmICh3ZWlnaHQgIT09IDEpIHsNCiAgICAgICAgICAgIGJlc3RTY29yZSA9IE1hdGgubWluKGJlc3RTY29yZSwgblNjb3JlKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgb3V0cHV0W2pdLm5TY29yZSA9IG5TY29yZTsNCiAgICAgICAgICAgIHRvdGFsU2NvcmUgKz0gblNjb3JlOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJlc3VsdHNbaV0uc2NvcmUgPSBiZXN0U2NvcmUgPT09IDEgPyB0b3RhbFNjb3JlIC8gc2NvcmVMZW4gOiBiZXN0U2NvcmU7DQoNCiAgICAgICAgdGhpcy5fbG9nKHJlc3VsdHNbaV0pOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19zb3J0JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NvcnQocmVzdWx0cykgew0KICAgICAgdGhpcy5fbG9nKCdcblxuU29ydGluZy4uLi4nKTsNCiAgICAgIHJlc3VsdHMuc29ydCh0aGlzLm9wdGlvbnMuc29ydEZuKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfZm9ybWF0JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2Zvcm1hdChyZXN1bHRzKSB7DQogICAgICB2YXIgZmluYWxPdXRwdXQgPSBbXTsNCg0KICAgICAgdGhpcy5fbG9nKCdcblxuT3V0cHV0OlxuXG4nLCBKU09OLnN0cmluZ2lmeShyZXN1bHRzKSk7DQoNCiAgICAgIHZhciB0cmFuc2Zvcm1lcnMgPSBbXTsNCg0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pbmNsdWRlTWF0Y2hlcykgew0KICAgICAgICB0cmFuc2Zvcm1lcnMucHVzaChmdW5jdGlvbiAocmVzdWx0LCBkYXRhKSB7DQogICAgICAgICAgdmFyIG91dHB1dCA9IHJlc3VsdC5vdXRwdXQ7DQogICAgICAgICAgZGF0YS5tYXRjaGVzID0gW107DQoNCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gb3V0cHV0Lmxlbmd0aDsgaSA8IGxlbjsgaSArPSAxKSB7DQogICAgICAgICAgICB2YXIgaXRlbSA9IG91dHB1dFtpXTsNCg0KICAgICAgICAgICAgaWYgKGl0ZW0ubWF0Y2hlZEluZGljZXMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgb2JqID0gew0KICAgICAgICAgICAgICBpbmRpY2VzOiBpdGVtLm1hdGNoZWRJbmRpY2VzLA0KICAgICAgICAgICAgICB2YWx1ZTogaXRlbS52YWx1ZQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIGlmIChpdGVtLmtleSkgew0KICAgICAgICAgICAgICBvYmoua2V5ID0gaXRlbS5rZXk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoaXRlbS5oYXNPd25Qcm9wZXJ0eSgnYXJyYXlJbmRleCcpICYmIGl0ZW0uYXJyYXlJbmRleCA+IC0xKSB7DQogICAgICAgICAgICAgIG9iai5hcnJheUluZGV4ID0gaXRlbS5hcnJheUluZGV4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZGF0YS5tYXRjaGVzLnB1c2gob2JqKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICBpZiAodGhpcy5vcHRpb25zLmluY2x1ZGVTY29yZSkgew0KICAgICAgICB0cmFuc2Zvcm1lcnMucHVzaChmdW5jdGlvbiAocmVzdWx0LCBkYXRhKSB7DQogICAgICAgICAgZGF0YS5zY29yZSA9IHJlc3VsdC5zY29yZTsNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSByZXN1bHRzLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAxKSB7DQogICAgICAgIHZhciByZXN1bHQgPSByZXN1bHRzW2ldOw0KDQogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWQpIHsNCiAgICAgICAgICByZXN1bHQuaXRlbSA9IHRoaXMub3B0aW9ucy5nZXRGbihyZXN1bHQuaXRlbSwgdGhpcy5vcHRpb25zLmlkKVswXTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICghdHJhbnNmb3JtZXJzLmxlbmd0aCkgew0KICAgICAgICAgIGZpbmFsT3V0cHV0LnB1c2gocmVzdWx0Lml0ZW0pOw0KICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGRhdGEgPSB7DQogICAgICAgICAgaXRlbTogcmVzdWx0Lml0ZW0NCiAgICAgICAgfTsNCg0KICAgICAgICBmb3IgKHZhciBqID0gMCwgX2xlbjIgPSB0cmFuc2Zvcm1lcnMubGVuZ3RoOyBqIDwgX2xlbjI7IGogKz0gMSkgew0KICAgICAgICAgIHRyYW5zZm9ybWVyc1tqXShyZXN1bHQsIGRhdGEpOw0KICAgICAgICB9DQoNCiAgICAgICAgZmluYWxPdXRwdXQucHVzaChkYXRhKTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIGZpbmFsT3V0cHV0Ow0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19sb2cnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfbG9nKCkgew0KICAgICAgaWYgKHRoaXMub3B0aW9ucy52ZXJib3NlKSB7DQogICAgICAgIHZhciBfY29uc29sZTsNCg0KICAgICAgICAoX2NvbnNvbGUgPSBjb25zb2xlKS5sb2cuYXBwbHkoX2NvbnNvbGUsIGFyZ3VtZW50cyk7DQogICAgICB9DQogICAgfQ0KICB9XSk7DQoNCiAgcmV0dXJuIEZ1c2U7DQp9KCk7DQoNCm1vZHVsZS5leHBvcnRzID0gRnVzZTsNCg0KLyoqKi8gfSkNCi8qKioqKiovIF0pOw0KfSk7DQovLyMgc291cmNlTWFwcGluZ1VSTD1mdXNlLmpzLm1hcA0KDQovKioqLyB9KSwNCi8qIDQwICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShfX3dlYnBhY2tfZXhwb3J0c19fLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7DQp2YXIgaXNNZXJnZWFibGVPYmplY3QgPSBmdW5jdGlvbiBpc01lcmdlYWJsZU9iamVjdCh2YWx1ZSkgew0KCXJldHVybiBpc05vbk51bGxPYmplY3QodmFsdWUpDQoJCSYmICFpc1NwZWNpYWwodmFsdWUpDQp9Ow0KDQpmdW5jdGlvbiBpc05vbk51bGxPYmplY3QodmFsdWUpIHsNCglyZXR1cm4gISF2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnDQp9DQoNCmZ1bmN0aW9uIGlzU3BlY2lhbCh2YWx1ZSkgew0KCXZhciBzdHJpbmdWYWx1ZSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSk7DQoNCglyZXR1cm4gc3RyaW5nVmFsdWUgPT09ICdbb2JqZWN0IFJlZ0V4cF0nDQoJCXx8IHN0cmluZ1ZhbHVlID09PSAnW29iamVjdCBEYXRlXScNCgkJfHwgaXNSZWFjdEVsZW1lbnQodmFsdWUpDQp9DQoNCi8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVhY3QvYmxvYi9iNWFjOTYzZmI3OTFkMTI5OGU3ZjM5NjIzNjM4M2JjOTU1ZjkxNmMxL3NyYy9pc29tb3JwaGljL2NsYXNzaWMvZWxlbWVudC9SZWFjdEVsZW1lbnQuanMjTDIxLUwyNQ0KdmFyIGNhblVzZVN5bWJvbCA9IHR5cGVvZiBTeW1ib2wgPT09ICdmdW5jdGlvbicgJiYgU3ltYm9sLmZvcjsNCnZhciBSRUFDVF9FTEVNRU5UX1RZUEUgPSBjYW5Vc2VTeW1ib2wgPyBTeW1ib2wuZm9yKCdyZWFjdC5lbGVtZW50JykgOiAweGVhYzc7DQoNCmZ1bmN0aW9uIGlzUmVhY3RFbGVtZW50KHZhbHVlKSB7DQoJcmV0dXJuIHZhbHVlLiQkdHlwZW9mID09PSBSRUFDVF9FTEVNRU5UX1RZUEUNCn0NCg0KZnVuY3Rpb24gZW1wdHlUYXJnZXQodmFsKSB7DQoJcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsKSA/IFtdIDoge30NCn0NCg0KZnVuY3Rpb24gY2xvbmVVbmxlc3NPdGhlcndpc2VTcGVjaWZpZWQodmFsdWUsIG9wdGlvbnMpIHsNCglyZXR1cm4gKG9wdGlvbnMuY2xvbmUgIT09IGZhbHNlICYmIG9wdGlvbnMuaXNNZXJnZWFibGVPYmplY3QodmFsdWUpKQ0KCQk/IGRlZXBtZXJnZShlbXB0eVRhcmdldCh2YWx1ZSksIHZhbHVlLCBvcHRpb25zKQ0KCQk6IHZhbHVlDQp9DQoNCmZ1bmN0aW9uIGRlZmF1bHRBcnJheU1lcmdlKHRhcmdldCwgc291cmNlLCBvcHRpb25zKSB7DQoJcmV0dXJuIHRhcmdldC5jb25jYXQoc291cmNlKS5tYXAoZnVuY3Rpb24oZWxlbWVudCkgew0KCQlyZXR1cm4gY2xvbmVVbmxlc3NPdGhlcndpc2VTcGVjaWZpZWQoZWxlbWVudCwgb3B0aW9ucykNCgl9KQ0KfQ0KDQpmdW5jdGlvbiBtZXJnZU9iamVjdCh0YXJnZXQsIHNvdXJjZSwgb3B0aW9ucykgew0KCXZhciBkZXN0aW5hdGlvbiA9IHt9Ow0KCWlmIChvcHRpb25zLmlzTWVyZ2VhYmxlT2JqZWN0KHRhcmdldCkpIHsNCgkJT2JqZWN0LmtleXModGFyZ2V0KS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgew0KCQkJZGVzdGluYXRpb25ba2V5XSA9IGNsb25lVW5sZXNzT3RoZXJ3aXNlU3BlY2lmaWVkKHRhcmdldFtrZXldLCBvcHRpb25zKTsNCgkJfSk7DQoJfQ0KCU9iamVjdC5rZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsNCgkJaWYgKCFvcHRpb25zLmlzTWVyZ2VhYmxlT2JqZWN0KHNvdXJjZVtrZXldKSB8fCAhdGFyZ2V0W2tleV0pIHsNCgkJCWRlc3RpbmF0aW9uW2tleV0gPSBjbG9uZVVubGVzc090aGVyd2lzZVNwZWNpZmllZChzb3VyY2Vba2V5XSwgb3B0aW9ucyk7DQoJCX0gZWxzZSB7DQoJCQlkZXN0aW5hdGlvbltrZXldID0gZGVlcG1lcmdlKHRhcmdldFtrZXldLCBzb3VyY2Vba2V5XSwgb3B0aW9ucyk7DQoJCX0NCgl9KTsNCglyZXR1cm4gZGVzdGluYXRpb24NCn0NCg0KZnVuY3Rpb24gZGVlcG1lcmdlKHRhcmdldCwgc291cmNlLCBvcHRpb25zKSB7DQoJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307DQoJb3B0aW9ucy5hcnJheU1lcmdlID0gb3B0aW9ucy5hcnJheU1lcmdlIHx8IGRlZmF1bHRBcnJheU1lcmdlOw0KCW9wdGlvbnMuaXNNZXJnZWFibGVPYmplY3QgPSBvcHRpb25zLmlzTWVyZ2VhYmxlT2JqZWN0IHx8IGlzTWVyZ2VhYmxlT2JqZWN0Ow0KDQoJdmFyIHNvdXJjZUlzQXJyYXkgPSBBcnJheS5pc0FycmF5KHNvdXJjZSk7DQoJdmFyIHRhcmdldElzQXJyYXkgPSBBcnJheS5pc0FycmF5KHRhcmdldCk7DQoJdmFyIHNvdXJjZUFuZFRhcmdldFR5cGVzTWF0Y2ggPSBzb3VyY2VJc0FycmF5ID09PSB0YXJnZXRJc0FycmF5Ow0KDQoJaWYgKCFzb3VyY2VBbmRUYXJnZXRUeXBlc01hdGNoKSB7DQoJCXJldHVybiBjbG9uZVVubGVzc090aGVyd2lzZVNwZWNpZmllZChzb3VyY2UsIG9wdGlvbnMpDQoJfSBlbHNlIGlmIChzb3VyY2VJc0FycmF5KSB7DQoJCXJldHVybiBvcHRpb25zLmFycmF5TWVyZ2UodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpDQoJfSBlbHNlIHsNCgkJcmV0dXJuIG1lcmdlT2JqZWN0KHRhcmdldCwgc291cmNlLCBvcHRpb25zKQ0KCX0NCn0NCg0KZGVlcG1lcmdlLmFsbCA9IGZ1bmN0aW9uIGRlZXBtZXJnZUFsbChhcnJheSwgb3B0aW9ucykgew0KCWlmICghQXJyYXkuaXNBcnJheShhcnJheSkpIHsNCgkJdGhyb3cgbmV3IEVycm9yKCdmaXJzdCBhcmd1bWVudCBzaG91bGQgYmUgYW4gYXJyYXknKQ0KCX0NCg0KCXJldHVybiBhcnJheS5yZWR1Y2UoZnVuY3Rpb24ocHJldiwgbmV4dCkgew0KCQlyZXR1cm4gZGVlcG1lcmdlKHByZXYsIG5leHQsIG9wdGlvbnMpDQoJfSwge30pDQp9Ow0KDQp2YXIgZGVlcG1lcmdlXzEgPSBkZWVwbWVyZ2U7DQoNCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gX193ZWJwYWNrX2V4cG9ydHNfX1siZGVmYXVsdCJdID0gKGRlZXBtZXJnZV8xKTsNCg0KDQovKioqLyB9KSwNCi8qIDQxICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpfX3dlYnBhY2tfcmVxdWlyZV9fKDQyKTsNCg0KX193ZWJwYWNrX3JlcXVpcmVfXyg1MSk7DQoNCl9fd2VicGFja19yZXF1aXJlX18oNzApOw0KDQpfX3dlYnBhY2tfcmVxdWlyZV9fKDcyKTsNCg0KLyoqKi8gfSksDQovKiA0MiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQpfX3dlYnBhY2tfcmVxdWlyZV9fKDQzKTsNCm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKS5BcnJheS5maW5kOw0KDQoNCi8qKiovIH0pLA0KLyogNDMgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQovLyAyMi4xLjMuOCBBcnJheS5wcm90b3R5cGUuZmluZChwcmVkaWNhdGUsIHRoaXNBcmcgPSB1bmRlZmluZWQpDQp2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNik7DQp2YXIgJGZpbmQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ3KSg1KTsNCnZhciBLRVkgPSAnZmluZCc7DQp2YXIgZm9yY2VkID0gdHJ1ZTsNCi8vIFNob3VsZG4ndCBza2lwIGhvbGVzDQppZiAoS0VZIGluIFtdKSBBcnJheSgxKVtLRVldKGZ1bmN0aW9uICgpIHsgZm9yY2VkID0gZmFsc2U7IH0pOw0KJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiBmb3JjZWQsICdBcnJheScsIHsNCiAgZmluZDogZnVuY3Rpb24gZmluZChjYWxsYmFja2ZuIC8qICwgdGhhdCA9IHVuZGVmaW5lZCAqLykgew0KICAgIHJldHVybiAkZmluZCh0aGlzLCBjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7DQogIH0NCn0pOw0KX193ZWJwYWNrX3JlcXVpcmVfXygyOCkoS0VZKTsNCg0KDQovKioqLyB9KSwNCi8qIDQ0ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCm1vZHVsZS5leHBvcnRzID0gIV9fd2VicGFja19yZXF1aXJlX18oMTApICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fKDIyKShmdW5jdGlvbiAoKSB7DQogIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoX193ZWJwYWNrX3JlcXVpcmVfXygyMykoJ2RpdicpLCAnYScsIHsgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiA3OyB9IH0pLmEgIT0gNzsNCn0pOw0KDQoNCi8qKiovIH0pLA0KLyogNDUgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gNy4xLjEgVG9QcmltaXRpdmUoaW5wdXQgWywgUHJlZmVycmVkVHlwZV0pDQp2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpOw0KLy8gaW5zdGVhZCBvZiB0aGUgRVM2IHNwZWMgdmVyc2lvbiwgd2UgZGlkbid0IGltcGxlbWVudCBAQHRvUHJpbWl0aXZlIGNhc2UNCi8vIGFuZCB0aGUgc2Vjb25kIGFyZ3VtZW50IC0gZmxhZyAtIHByZWZlcnJlZCB0eXBlIGlzIGEgc3RyaW5nDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwgUykgew0KICBpZiAoIWlzT2JqZWN0KGl0KSkgcmV0dXJuIGl0Ow0KICB2YXIgZm4sIHZhbDsNCiAgaWYgKFMgJiYgdHlwZW9mIChmbiA9IGl0LnRvU3RyaW5nKSA9PSAnZnVuY3Rpb24nICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGl0KSkpIHJldHVybiB2YWw7DQogIGlmICh0eXBlb2YgKGZuID0gaXQudmFsdWVPZikgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpdCkpKSByZXR1cm4gdmFsOw0KICBpZiAoIVMgJiYgdHlwZW9mIChmbiA9IGl0LnRvU3RyaW5nKSA9PSAnZnVuY3Rpb24nICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGl0KSkpIHJldHVybiB2YWw7DQogIHRocm93IFR5cGVFcnJvcigiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIik7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNDYgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsNCiAgaWYgKHR5cGVvZiBpdCAhPSAnZnVuY3Rpb24nKSB0aHJvdyBUeXBlRXJyb3IoaXQgKyAnIGlzIG5vdCBhIGZ1bmN0aW9uIScpOw0KICByZXR1cm4gaXQ7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNDcgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gMCAtPiBBcnJheSNmb3JFYWNoDQovLyAxIC0+IEFycmF5I21hcA0KLy8gMiAtPiBBcnJheSNmaWx0ZXINCi8vIDMgLT4gQXJyYXkjc29tZQ0KLy8gNCAtPiBBcnJheSNldmVyeQ0KLy8gNSAtPiBBcnJheSNmaW5kDQovLyA2IC0+IEFycmF5I2ZpbmRJbmRleA0KdmFyIGN0eCA9IF9fd2VicGFja19yZXF1aXJlX18oMTQpOw0KdmFyIElPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI1KTsNCnZhciB0b09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMTYpOw0KdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOCk7DQp2YXIgYXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0OCk7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChUWVBFLCAkY3JlYXRlKSB7DQogIHZhciBJU19NQVAgPSBUWVBFID09IDE7DQogIHZhciBJU19GSUxURVIgPSBUWVBFID09IDI7DQogIHZhciBJU19TT01FID0gVFlQRSA9PSAzOw0KICB2YXIgSVNfRVZFUlkgPSBUWVBFID09IDQ7DQogIHZhciBJU19GSU5EX0lOREVYID0gVFlQRSA9PSA2Ow0KICB2YXIgTk9fSE9MRVMgPSBUWVBFID09IDUgfHwgSVNfRklORF9JTkRFWDsNCiAgdmFyIGNyZWF0ZSA9ICRjcmVhdGUgfHwgYXNjOw0KICByZXR1cm4gZnVuY3Rpb24gKCR0aGlzLCBjYWxsYmFja2ZuLCB0aGF0KSB7DQogICAgdmFyIE8gPSB0b09iamVjdCgkdGhpcyk7DQogICAgdmFyIHNlbGYgPSBJT2JqZWN0KE8pOw0KICAgIHZhciBmID0gY3R4KGNhbGxiYWNrZm4sIHRoYXQsIDMpOw0KICAgIHZhciBsZW5ndGggPSB0b0xlbmd0aChzZWxmLmxlbmd0aCk7DQogICAgdmFyIGluZGV4ID0gMDsNCiAgICB2YXIgcmVzdWx0ID0gSVNfTUFQID8gY3JlYXRlKCR0aGlzLCBsZW5ndGgpIDogSVNfRklMVEVSID8gY3JlYXRlKCR0aGlzLCAwKSA6IHVuZGVmaW5lZDsNCiAgICB2YXIgdmFsLCByZXM7DQogICAgZm9yICg7bGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIGlmIChOT19IT0xFUyB8fCBpbmRleCBpbiBzZWxmKSB7DQogICAgICB2YWwgPSBzZWxmW2luZGV4XTsNCiAgICAgIHJlcyA9IGYodmFsLCBpbmRleCwgTyk7DQogICAgICBpZiAoVFlQRSkgew0KICAgICAgICBpZiAoSVNfTUFQKSByZXN1bHRbaW5kZXhdID0gcmVzOyAgIC8vIG1hcA0KICAgICAgICBlbHNlIGlmIChyZXMpIHN3aXRjaCAoVFlQRSkgew0KICAgICAgICAgIGNhc2UgMzogcmV0dXJuIHRydWU7ICAgICAgICAgICAgIC8vIHNvbWUNCiAgICAgICAgICBjYXNlIDU6IHJldHVybiB2YWw7ICAgICAgICAgICAgICAvLyBmaW5kDQogICAgICAgICAgY2FzZSA2OiByZXR1cm4gaW5kZXg7ICAgICAgICAgICAgLy8gZmluZEluZGV4DQogICAgICAgICAgY2FzZSAyOiByZXN1bHQucHVzaCh2YWwpOyAgICAgICAgLy8gZmlsdGVyDQogICAgICAgIH0gZWxzZSBpZiAoSVNfRVZFUlkpIHJldHVybiBmYWxzZTsgLy8gZXZlcnkNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIElTX0ZJTkRfSU5ERVggPyAtMSA6IElTX1NPTUUgfHwgSVNfRVZFUlkgPyBJU19FVkVSWSA6IHJlc3VsdDsNCiAgfTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA0OCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyA5LjQuMi4zIEFycmF5U3BlY2llc0NyZWF0ZShvcmlnaW5hbEFycmF5LCBsZW5ndGgpDQp2YXIgc3BlY2llc0NvbnN0cnVjdG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0OSk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9yaWdpbmFsLCBsZW5ndGgpIHsNCiAgcmV0dXJuIG5ldyAoc3BlY2llc0NvbnN0cnVjdG9yKG9yaWdpbmFsKSkobGVuZ3RoKTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA0OSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpOw0KdmFyIGlzQXJyYXkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUwKTsNCnZhciBTUEVDSUVTID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKSgnc3BlY2llcycpOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvcmlnaW5hbCkgew0KICB2YXIgQzsNCiAgaWYgKGlzQXJyYXkob3JpZ2luYWwpKSB7DQogICAgQyA9IG9yaWdpbmFsLmNvbnN0cnVjdG9yOw0KICAgIC8vIGNyb3NzLXJlYWxtIGZhbGxiYWNrDQogICAgaWYgKHR5cGVvZiBDID09ICdmdW5jdGlvbicgJiYgKEMgPT09IEFycmF5IHx8IGlzQXJyYXkoQy5wcm90b3R5cGUpKSkgQyA9IHVuZGVmaW5lZDsNCiAgICBpZiAoaXNPYmplY3QoQykpIHsNCiAgICAgIEMgPSBDW1NQRUNJRVNdOw0KICAgICAgaWYgKEMgPT09IG51bGwpIEMgPSB1bmRlZmluZWQ7DQogICAgfQ0KICB9IHJldHVybiBDID09PSB1bmRlZmluZWQgPyBBcnJheSA6IEM7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNTAgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gNy4yLjIgSXNBcnJheShhcmd1bWVudCkNCnZhciBjb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1KTsNCm1vZHVsZS5leHBvcnRzID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiBpc0FycmF5KGFyZykgew0KICByZXR1cm4gY29mKGFyZykgPT0gJ0FycmF5JzsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA1MSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQpfX3dlYnBhY2tfcmVxdWlyZV9fKDUyKTsNCl9fd2VicGFja19yZXF1aXJlX18oNjMpOw0KbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpLkFycmF5LmZyb207DQoNCg0KLyoqKi8gfSksDQovKiA1MiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCnZhciAkYXQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUzKSh0cnVlKTsNCg0KLy8gMjEuMS4zLjI3IFN0cmluZy5wcm90b3R5cGVbQEBpdGVyYXRvcl0oKQ0KX193ZWJwYWNrX3JlcXVpcmVfXyg1NCkoU3RyaW5nLCAnU3RyaW5nJywgZnVuY3Rpb24gKGl0ZXJhdGVkKSB7DQogIHRoaXMuX3QgPSBTdHJpbmcoaXRlcmF0ZWQpOyAvLyB0YXJnZXQNCiAgdGhpcy5faSA9IDA7ICAgICAgICAgICAgICAgIC8vIG5leHQgaW5kZXgNCi8vIDIxLjEuNS4yLjEgJVN0cmluZ0l0ZXJhdG9yUHJvdG90eXBlJS5uZXh0KCkNCn0sIGZ1bmN0aW9uICgpIHsNCiAgdmFyIE8gPSB0aGlzLl90Ow0KICB2YXIgaW5kZXggPSB0aGlzLl9pOw0KICB2YXIgcG9pbnQ7DQogIGlmIChpbmRleCA+PSBPLmxlbmd0aCkgcmV0dXJuIHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogdHJ1ZSB9Ow0KICBwb2ludCA9ICRhdChPLCBpbmRleCk7DQogIHRoaXMuX2kgKz0gcG9pbnQubGVuZ3RoOw0KICByZXR1cm4geyB2YWx1ZTogcG9pbnQsIGRvbmU6IGZhbHNlIH07DQp9KTsNCg0KDQovKioqLyB9KSwNCi8qIDUzICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciB0b0ludGVnZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE5KTsNCnZhciBkZWZpbmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNyk7DQovLyB0cnVlICAtPiBTdHJpbmcjYXQNCi8vIGZhbHNlIC0+IFN0cmluZyNjb2RlUG9pbnRBdA0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoVE9fU1RSSU5HKSB7DQogIHJldHVybiBmdW5jdGlvbiAodGhhdCwgcG9zKSB7DQogICAgdmFyIHMgPSBTdHJpbmcoZGVmaW5lZCh0aGF0KSk7DQogICAgdmFyIGkgPSB0b0ludGVnZXIocG9zKTsNCiAgICB2YXIgbCA9IHMubGVuZ3RoOw0KICAgIHZhciBhLCBiOw0KICAgIGlmIChpIDwgMCB8fCBpID49IGwpIHJldHVybiBUT19TVFJJTkcgPyAnJyA6IHVuZGVmaW5lZDsNCiAgICBhID0gcy5jaGFyQ29kZUF0KGkpOw0KICAgIHJldHVybiBhIDwgMHhkODAwIHx8IGEgPiAweGRiZmYgfHwgaSArIDEgPT09IGwgfHwgKGIgPSBzLmNoYXJDb2RlQXQoaSArIDEpKSA8IDB4ZGMwMCB8fCBiID4gMHhkZmZmDQogICAgICA/IFRPX1NUUklORyA/IHMuY2hhckF0KGkpIDogYQ0KICAgICAgOiBUT19TVFJJTkcgPyBzLnNsaWNlKGksIGkgKyAyKSA6IChhIC0gMHhkODAwIDw8IDEwKSArIChiIC0gMHhkYzAwKSArIDB4MTAwMDA7DQogIH07DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNTQgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQp2YXIgTElCUkFSWSA9IF9fd2VicGFja19yZXF1aXJlX18oMjcpOw0KdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOw0KdmFyIHJlZGVmaW5lID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNCk7DQp2YXIgaGlkZSA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7DQp2YXIgSXRlcmF0b3JzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMCk7DQp2YXIgJGl0ZXJDcmVhdGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU1KTsNCnZhciBzZXRUb1N0cmluZ1RhZyA9IF9fd2VicGFja19yZXF1aXJlX18oMzIpOw0KdmFyIGdldFByb3RvdHlwZU9mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Mik7DQp2YXIgSVRFUkFUT1IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApKCdpdGVyYXRvcicpOw0KdmFyIEJVR0dZID0gIShbXS5rZXlzICYmICduZXh0JyBpbiBbXS5rZXlzKCkpOyAvLyBTYWZhcmkgaGFzIGJ1Z2d5IGl0ZXJhdG9ycyB3L28gYG5leHRgDQp2YXIgRkZfSVRFUkFUT1IgPSAnQEBpdGVyYXRvcic7DQp2YXIgS0VZUyA9ICdrZXlzJzsNCnZhciBWQUxVRVMgPSAndmFsdWVzJzsNCg0KdmFyIHJldHVyblRoaXMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9Ow0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChCYXNlLCBOQU1FLCBDb25zdHJ1Y3RvciwgbmV4dCwgREVGQVVMVCwgSVNfU0VULCBGT1JDRUQpIHsNCiAgJGl0ZXJDcmVhdGUoQ29uc3RydWN0b3IsIE5BTUUsIG5leHQpOw0KICB2YXIgZ2V0TWV0aG9kID0gZnVuY3Rpb24gKGtpbmQpIHsNCiAgICBpZiAoIUJVR0dZICYmIGtpbmQgaW4gcHJvdG8pIHJldHVybiBwcm90b1traW5kXTsNCiAgICBzd2l0Y2ggKGtpbmQpIHsNCiAgICAgIGNhc2UgS0VZUzogcmV0dXJuIGZ1bmN0aW9uIGtleXMoKSB7IHJldHVybiBuZXcgQ29uc3RydWN0b3IodGhpcywga2luZCk7IH07DQogICAgICBjYXNlIFZBTFVFUzogcmV0dXJuIGZ1bmN0aW9uIHZhbHVlcygpIHsgcmV0dXJuIG5ldyBDb25zdHJ1Y3Rvcih0aGlzLCBraW5kKTsgfTsNCiAgICB9IHJldHVybiBmdW5jdGlvbiBlbnRyaWVzKCkgeyByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOyB9Ow0KICB9Ow0KICB2YXIgVEFHID0gTkFNRSArICcgSXRlcmF0b3InOw0KICB2YXIgREVGX1ZBTFVFUyA9IERFRkFVTFQgPT0gVkFMVUVTOw0KICB2YXIgVkFMVUVTX0JVRyA9IGZhbHNlOw0KICB2YXIgcHJvdG8gPSBCYXNlLnByb3RvdHlwZTsNCiAgdmFyICRuYXRpdmUgPSBwcm90b1tJVEVSQVRPUl0gfHwgcHJvdG9bRkZfSVRFUkFUT1JdIHx8IERFRkFVTFQgJiYgcHJvdG9bREVGQVVMVF07DQogIHZhciAkZGVmYXVsdCA9ICRuYXRpdmUgfHwgZ2V0TWV0aG9kKERFRkFVTFQpOw0KICB2YXIgJGVudHJpZXMgPSBERUZBVUxUID8gIURFRl9WQUxVRVMgPyAkZGVmYXVsdCA6IGdldE1ldGhvZCgnZW50cmllcycpIDogdW5kZWZpbmVkOw0KICB2YXIgJGFueU5hdGl2ZSA9IE5BTUUgPT0gJ0FycmF5JyA/IHByb3RvLmVudHJpZXMgfHwgJG5hdGl2ZSA6ICRuYXRpdmU7DQogIHZhciBtZXRob2RzLCBrZXksIEl0ZXJhdG9yUHJvdG90eXBlOw0KICAvLyBGaXggbmF0aXZlDQogIGlmICgkYW55TmF0aXZlKSB7DQogICAgSXRlcmF0b3JQcm90b3R5cGUgPSBnZXRQcm90b3R5cGVPZigkYW55TmF0aXZlLmNhbGwobmV3IEJhc2UoKSkpOw0KICAgIGlmIChJdGVyYXRvclByb3RvdHlwZSAhPT0gT2JqZWN0LnByb3RvdHlwZSAmJiBJdGVyYXRvclByb3RvdHlwZS5uZXh0KSB7DQogICAgICAvLyBTZXQgQEB0b1N0cmluZ1RhZyB0byBuYXRpdmUgaXRlcmF0b3JzDQogICAgICBzZXRUb1N0cmluZ1RhZyhJdGVyYXRvclByb3RvdHlwZSwgVEFHLCB0cnVlKTsNCiAgICAgIC8vIGZpeCBmb3Igc29tZSBvbGQgZW5naW5lcw0KICAgICAgaWYgKCFMSUJSQVJZICYmIHR5cGVvZiBJdGVyYXRvclByb3RvdHlwZVtJVEVSQVRPUl0gIT0gJ2Z1bmN0aW9uJykgaGlkZShJdGVyYXRvclByb3RvdHlwZSwgSVRFUkFUT1IsIHJldHVyblRoaXMpOw0KICAgIH0NCiAgfQ0KICAvLyBmaXggQXJyYXkje3ZhbHVlcywgQEBpdGVyYXRvcn0ubmFtZSBpbiBWOCAvIEZGDQogIGlmIChERUZfVkFMVUVTICYmICRuYXRpdmUgJiYgJG5hdGl2ZS5uYW1lICE9PSBWQUxVRVMpIHsNCiAgICBWQUxVRVNfQlVHID0gdHJ1ZTsNCiAgICAkZGVmYXVsdCA9IGZ1bmN0aW9uIHZhbHVlcygpIHsgcmV0dXJuICRuYXRpdmUuY2FsbCh0aGlzKTsgfTsNCiAgfQ0KICAvLyBEZWZpbmUgaXRlcmF0b3INCiAgaWYgKCghTElCUkFSWSB8fCBGT1JDRUQpICYmIChCVUdHWSB8fCBWQUxVRVNfQlVHIHx8ICFwcm90b1tJVEVSQVRPUl0pKSB7DQogICAgaGlkZShwcm90bywgSVRFUkFUT1IsICRkZWZhdWx0KTsNCiAgfQ0KICAvLyBQbHVnIGZvciBsaWJyYXJ5DQogIEl0ZXJhdG9yc1tOQU1FXSA9ICRkZWZhdWx0Ow0KICBJdGVyYXRvcnNbVEFHXSA9IHJldHVyblRoaXM7DQogIGlmIChERUZBVUxUKSB7DQogICAgbWV0aG9kcyA9IHsNCiAgICAgIHZhbHVlczogREVGX1ZBTFVFUyA/ICRkZWZhdWx0IDogZ2V0TWV0aG9kKFZBTFVFUyksDQogICAgICBrZXlzOiBJU19TRVQgPyAkZGVmYXVsdCA6IGdldE1ldGhvZChLRVlTKSwNCiAgICAgIGVudHJpZXM6ICRlbnRyaWVzDQogICAgfTsNCiAgICBpZiAoRk9SQ0VEKSBmb3IgKGtleSBpbiBtZXRob2RzKSB7DQogICAgICBpZiAoIShrZXkgaW4gcHJvdG8pKSByZWRlZmluZShwcm90bywga2V5LCBtZXRob2RzW2tleV0pOw0KICAgIH0gZWxzZSAkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIChCVUdHWSB8fCBWQUxVRVNfQlVHKSwgTkFNRSwgbWV0aG9kcyk7DQogIH0NCiAgcmV0dXJuIG1ldGhvZHM7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNTUgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQp2YXIgY3JlYXRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1Nik7DQp2YXIgZGVzY3JpcHRvciA9IF9fd2VicGFja19yZXF1aXJlX18oMTIpOw0KdmFyIHNldFRvU3RyaW5nVGFnID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMik7DQp2YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTsNCg0KLy8gMjUuMS4yLjEuMSAlSXRlcmF0b3JQcm90b3R5cGUlW0BAaXRlcmF0b3JdKCkNCl9fd2VicGFja19yZXF1aXJlX18oNCkoSXRlcmF0b3JQcm90b3R5cGUsIF9fd2VicGFja19yZXF1aXJlX18oMCkoJ2l0ZXJhdG9yJyksIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0pOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgTkFNRSwgbmV4dCkgew0KICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSBjcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUsIHsgbmV4dDogZGVzY3JpcHRvcigxLCBuZXh0KSB9KTsNCiAgc2V0VG9TdHJpbmdUYWcoQ29uc3RydWN0b3IsIE5BTUUgKyAnIEl0ZXJhdG9yJyk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNTYgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gMTkuMS4yLjIgLyAxNS4yLjMuNSBPYmplY3QuY3JlYXRlKE8gWywgUHJvcGVydGllc10pDQp2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpOw0KdmFyIGRQcyA9IF9fd2VicGFja19yZXF1aXJlX18oNTcpOw0KdmFyIGVudW1CdWdLZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMSk7DQp2YXIgSUVfUFJPVE8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxKSgnSUVfUFJPVE8nKTsNCnZhciBFbXB0eSA9IGZ1bmN0aW9uICgpIHsgLyogZW1wdHkgKi8gfTsNCnZhciBQUk9UT1RZUEUgPSAncHJvdG90eXBlJzsNCg0KLy8gQ3JlYXRlIG9iamVjdCB3aXRoIGZha2UgYG51bGxgIHByb3RvdHlwZTogdXNlIGlmcmFtZSBPYmplY3Qgd2l0aCBjbGVhcmVkIHByb3RvdHlwZQ0KdmFyIGNyZWF0ZURpY3QgPSBmdW5jdGlvbiAoKSB7DQogIC8vIFRocmFzaCwgd2FzdGUgYW5kIHNvZG9teTogSUUgR0MgYnVnDQogIHZhciBpZnJhbWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIzKSgnaWZyYW1lJyk7DQogIHZhciBpID0gZW51bUJ1Z0tleXMubGVuZ3RoOw0KICB2YXIgbHQgPSAnPCc7DQogIHZhciBndCA9ICc+JzsNCiAgdmFyIGlmcmFtZURvY3VtZW50Ow0KICBpZnJhbWUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgX193ZWJwYWNrX3JlcXVpcmVfXyg2MSkuYXBwZW5kQ2hpbGQoaWZyYW1lKTsNCiAgaWZyYW1lLnNyYyA9ICdqYXZhc2NyaXB0Oic7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2NyaXB0LXVybA0KICAvLyBjcmVhdGVEaWN0ID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuT2JqZWN0Ow0KICAvLyBodG1sLnJlbW92ZUNoaWxkKGlmcmFtZSk7DQogIGlmcmFtZURvY3VtZW50ID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7DQogIGlmcmFtZURvY3VtZW50Lm9wZW4oKTsNCiAgaWZyYW1lRG9jdW1lbnQud3JpdGUobHQgKyAnc2NyaXB0JyArIGd0ICsgJ2RvY3VtZW50LkY9T2JqZWN0JyArIGx0ICsgJy9zY3JpcHQnICsgZ3QpOw0KICBpZnJhbWVEb2N1bWVudC5jbG9zZSgpOw0KICBjcmVhdGVEaWN0ID0gaWZyYW1lRG9jdW1lbnQuRjsNCiAgd2hpbGUgKGktLSkgZGVsZXRlIGNyZWF0ZURpY3RbUFJPVE9UWVBFXVtlbnVtQnVnS2V5c1tpXV07DQogIHJldHVybiBjcmVhdGVEaWN0KCk7DQp9Ow0KDQptb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5jcmVhdGUgfHwgZnVuY3Rpb24gY3JlYXRlKE8sIFByb3BlcnRpZXMpIHsNCiAgdmFyIHJlc3VsdDsNCiAgaWYgKE8gIT09IG51bGwpIHsNCiAgICBFbXB0eVtQUk9UT1RZUEVdID0gYW5PYmplY3QoTyk7DQogICAgcmVzdWx0ID0gbmV3IEVtcHR5KCk7DQogICAgRW1wdHlbUFJPVE9UWVBFXSA9IG51bGw7DQogICAgLy8gYWRkICJfX3Byb3RvX18iIGZvciBPYmplY3QuZ2V0UHJvdG90eXBlT2YgcG9seWZpbGwNCiAgICByZXN1bHRbSUVfUFJPVE9dID0gTzsNCiAgfSBlbHNlIHJlc3VsdCA9IGNyZWF0ZURpY3QoKTsNCiAgcmV0dXJuIFByb3BlcnRpZXMgPT09IHVuZGVmaW5lZCA/IHJlc3VsdCA6IGRQcyhyZXN1bHQsIFByb3BlcnRpZXMpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDU3ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBkUCA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7DQp2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpOw0KdmFyIGdldEtleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU4KTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKSA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzIDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKSB7DQogIGFuT2JqZWN0KE8pOw0KICB2YXIga2V5cyA9IGdldEtleXMoUHJvcGVydGllcyk7DQogIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsNCiAgdmFyIGkgPSAwOw0KICB2YXIgUDsNCiAgd2hpbGUgKGxlbmd0aCA+IGkpIGRQLmYoTywgUCA9IGtleXNbaSsrXSwgUHJvcGVydGllc1tQXSk7DQogIHJldHVybiBPOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDU4ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIDE5LjEuMi4xNCAvIDE1LjIuMy4xNCBPYmplY3Qua2V5cyhPKQ0KdmFyICRrZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1OSk7DQp2YXIgZW51bUJ1Z0tleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMxKTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBPYmplY3Qua2V5cyB8fCBmdW5jdGlvbiBrZXlzKE8pIHsNCiAgcmV0dXJuICRrZXlzKE8sIGVudW1CdWdLZXlzKTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA1OSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgaGFzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMSk7DQp2YXIgdG9JT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOSk7DQp2YXIgYXJyYXlJbmRleE9mID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMCkoZmFsc2UpOw0KdmFyIElFX1BST1RPID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMSkoJ0lFX1BST1RPJyk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9iamVjdCwgbmFtZXMpIHsNCiAgdmFyIE8gPSB0b0lPYmplY3Qob2JqZWN0KTsNCiAgdmFyIGkgPSAwOw0KICB2YXIgcmVzdWx0ID0gW107DQogIHZhciBrZXk7DQogIGZvciAoa2V5IGluIE8pIGlmIChrZXkgIT0gSUVfUFJPVE8pIGhhcyhPLCBrZXkpICYmIHJlc3VsdC5wdXNoKGtleSk7DQogIC8vIERvbid0IGVudW0gYnVnICYgaGlkZGVuIGtleXMNCiAgd2hpbGUgKG5hbWVzLmxlbmd0aCA+IGkpIGlmIChoYXMoTywga2V5ID0gbmFtZXNbaSsrXSkpIHsNCiAgICB+YXJyYXlJbmRleE9mKHJlc3VsdCwga2V5KSB8fCByZXN1bHQucHVzaChrZXkpOw0KICB9DQogIHJldHVybiByZXN1bHQ7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNjAgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIHRvSW50ZWdlciA9IF9fd2VicGFja19yZXF1aXJlX18oMTkpOw0KdmFyIG1heCA9IE1hdGgubWF4Ow0KdmFyIG1pbiA9IE1hdGgubWluOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaW5kZXgsIGxlbmd0aCkgew0KICBpbmRleCA9IHRvSW50ZWdlcihpbmRleCk7DQogIHJldHVybiBpbmRleCA8IDAgPyBtYXgoaW5kZXggKyBsZW5ndGgsIDApIDogbWluKGluZGV4LCBsZW5ndGgpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDYxICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBkb2N1bWVudCA9IF9fd2VicGFja19yZXF1aXJlX18oMykuZG9jdW1lbnQ7DQptb2R1bGUuZXhwb3J0cyA9IGRvY3VtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsNCg0KDQovKioqLyB9KSwNCi8qIDYyICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIDE5LjEuMi45IC8gMTUuMi4zLjIgT2JqZWN0LmdldFByb3RvdHlwZU9mKE8pDQp2YXIgaGFzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMSk7DQp2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE2KTsNCnZhciBJRV9QUk9UTyA9IF9fd2VicGFja19yZXF1aXJlX18oMjEpKCdJRV9QUk9UTycpOw0KdmFyIE9iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gKE8pIHsNCiAgTyA9IHRvT2JqZWN0KE8pOw0KICBpZiAoaGFzKE8sIElFX1BST1RPKSkgcmV0dXJuIE9bSUVfUFJPVE9dOw0KICBpZiAodHlwZW9mIE8uY29uc3RydWN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBPIGluc3RhbmNlb2YgTy5jb25zdHJ1Y3Rvcikgew0KICAgIHJldHVybiBPLmNvbnN0cnVjdG9yLnByb3RvdHlwZTsNCiAgfSByZXR1cm4gTyBpbnN0YW5jZW9mIE9iamVjdCA/IE9iamVjdFByb3RvIDogbnVsbDsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA2MyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCnZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE0KTsNCnZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsNCnZhciB0b09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMTYpOw0KdmFyIGNhbGwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY0KTsNCnZhciBpc0FycmF5SXRlciA9IF9fd2VicGFja19yZXF1aXJlX18oNjUpOw0KdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOCk7DQp2YXIgY3JlYXRlUHJvcGVydHkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY2KTsNCnZhciBnZXRJdGVyRm4gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY3KTsNCg0KJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhX193ZWJwYWNrX3JlcXVpcmVfXyg2OSkoZnVuY3Rpb24gKGl0ZXIpIHsgQXJyYXkuZnJvbShpdGVyKTsgfSksICdBcnJheScsIHsNCiAgLy8gMjIuMS4yLjEgQXJyYXkuZnJvbShhcnJheUxpa2UsIG1hcGZuID0gdW5kZWZpbmVkLCB0aGlzQXJnID0gdW5kZWZpbmVkKQ0KICBmcm9tOiBmdW5jdGlvbiBmcm9tKGFycmF5TGlrZSAvKiAsIG1hcGZuID0gdW5kZWZpbmVkLCB0aGlzQXJnID0gdW5kZWZpbmVkICovKSB7DQogICAgdmFyIE8gPSB0b09iamVjdChhcnJheUxpa2UpOw0KICAgIHZhciBDID0gdHlwZW9mIHRoaXMgPT0gJ2Z1bmN0aW9uJyA/IHRoaXMgOiBBcnJheTsNCiAgICB2YXIgYUxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7DQogICAgdmFyIG1hcGZuID0gYUxlbiA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7DQogICAgdmFyIG1hcHBpbmcgPSBtYXBmbiAhPT0gdW5kZWZpbmVkOw0KICAgIHZhciBpbmRleCA9IDA7DQogICAgdmFyIGl0ZXJGbiA9IGdldEl0ZXJGbihPKTsNCiAgICB2YXIgbGVuZ3RoLCByZXN1bHQsIHN0ZXAsIGl0ZXJhdG9yOw0KICAgIGlmIChtYXBwaW5nKSBtYXBmbiA9IGN0eChtYXBmbiwgYUxlbiA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQsIDIpOw0KICAgIC8vIGlmIG9iamVjdCBpc24ndCBpdGVyYWJsZSBvciBpdCdzIGFycmF5IHdpdGggZGVmYXVsdCBpdGVyYXRvciAtIHVzZSBzaW1wbGUgY2FzZQ0KICAgIGlmIChpdGVyRm4gIT0gdW5kZWZpbmVkICYmICEoQyA9PSBBcnJheSAmJiBpc0FycmF5SXRlcihpdGVyRm4pKSkgew0KICAgICAgZm9yIChpdGVyYXRvciA9IGl0ZXJGbi5jYWxsKE8pLCByZXN1bHQgPSBuZXcgQygpOyAhKHN0ZXAgPSBpdGVyYXRvci5uZXh0KCkpLmRvbmU7IGluZGV4KyspIHsNCiAgICAgICAgY3JlYXRlUHJvcGVydHkocmVzdWx0LCBpbmRleCwgbWFwcGluZyA/IGNhbGwoaXRlcmF0b3IsIG1hcGZuLCBbc3RlcC52YWx1ZSwgaW5kZXhdLCB0cnVlKSA6IHN0ZXAudmFsdWUpOw0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICBsZW5ndGggPSB0b0xlbmd0aChPLmxlbmd0aCk7DQogICAgICBmb3IgKHJlc3VsdCA9IG5ldyBDKGxlbmd0aCk7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7DQogICAgICAgIGNyZWF0ZVByb3BlcnR5KHJlc3VsdCwgaW5kZXgsIG1hcHBpbmcgPyBtYXBmbihPW2luZGV4XSwgaW5kZXgpIDogT1tpbmRleF0pOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXN1bHQubGVuZ3RoID0gaW5kZXg7DQogICAgcmV0dXJuIHJlc3VsdDsNCiAgfQ0KfSk7DQoNCg0KLyoqKi8gfSksDQovKiA2NCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyBjYWxsIHNvbWV0aGluZyBvbiBpdGVyYXRvciBzdGVwIHdpdGggc2FmZSBjbG9zaW5nIG9uIGVycm9yDQp2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXRlcmF0b3IsIGZuLCB2YWx1ZSwgZW50cmllcykgew0KICB0cnkgew0KICAgIHJldHVybiBlbnRyaWVzID8gZm4oYW5PYmplY3QodmFsdWUpWzBdLCB2YWx1ZVsxXSkgOiBmbih2YWx1ZSk7DQogIC8vIDcuNC42IEl0ZXJhdG9yQ2xvc2UoaXRlcmF0b3IsIGNvbXBsZXRpb24pDQogIH0gY2F0Y2ggKGUpIHsNCiAgICB2YXIgcmV0ID0gaXRlcmF0b3JbJ3JldHVybiddOw0KICAgIGlmIChyZXQgIT09IHVuZGVmaW5lZCkgYW5PYmplY3QocmV0LmNhbGwoaXRlcmF0b3IpKTsNCiAgICB0aHJvdyBlOw0KICB9DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNjUgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gY2hlY2sgb24gZGVmYXVsdCBBcnJheSBpdGVyYXRvcg0KdmFyIEl0ZXJhdG9ycyA9IF9fd2VicGFja19yZXF1aXJlX18oMjApOw0KdmFyIElURVJBVE9SID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKSgnaXRlcmF0b3InKTsNCnZhciBBcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgew0KICByZXR1cm4gaXQgIT09IHVuZGVmaW5lZCAmJiAoSXRlcmF0b3JzLkFycmF5ID09PSBpdCB8fCBBcnJheVByb3RvW0lURVJBVE9SXSA9PT0gaXQpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDY2ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KdmFyICRkZWZpbmVQcm9wZXJ0eSA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7DQp2YXIgY3JlYXRlRGVzYyA9IF9fd2VicGFja19yZXF1aXJlX18oMTIpOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChvYmplY3QsIGluZGV4LCB2YWx1ZSkgew0KICBpZiAoaW5kZXggaW4gb2JqZWN0KSAkZGVmaW5lUHJvcGVydHkuZihvYmplY3QsIGluZGV4LCBjcmVhdGVEZXNjKDAsIHZhbHVlKSk7DQogIGVsc2Ugb2JqZWN0W2luZGV4XSA9IHZhbHVlOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDY3ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBjbGFzc29mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2OCk7DQp2YXIgSVRFUkFUT1IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApKCdpdGVyYXRvcicpOw0KdmFyIEl0ZXJhdG9ycyA9IF9fd2VicGFja19yZXF1aXJlX18oMjApOw0KbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpLmdldEl0ZXJhdG9yTWV0aG9kID0gZnVuY3Rpb24gKGl0KSB7DQogIGlmIChpdCAhPSB1bmRlZmluZWQpIHJldHVybiBpdFtJVEVSQVRPUl0NCiAgICB8fCBpdFsnQEBpdGVyYXRvciddDQogICAgfHwgSXRlcmF0b3JzW2NsYXNzb2YoaXQpXTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA2OCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyBnZXR0aW5nIHRhZyBmcm9tIDE5LjEuMy42IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcoKQ0KdmFyIGNvZiA9IF9fd2VicGFja19yZXF1aXJlX18oMTUpOw0KdmFyIFRBRyA9IF9fd2VicGFja19yZXF1aXJlX18oMCkoJ3RvU3RyaW5nVGFnJyk7DQovLyBFUzMgd3JvbmcgaGVyZQ0KdmFyIEFSRyA9IGNvZihmdW5jdGlvbiAoKSB7IHJldHVybiBhcmd1bWVudHM7IH0oKSkgPT0gJ0FyZ3VtZW50cyc7DQoNCi8vIGZhbGxiYWNrIGZvciBJRTExIFNjcmlwdCBBY2Nlc3MgRGVuaWVkIGVycm9yDQp2YXIgdHJ5R2V0ID0gZnVuY3Rpb24gKGl0LCBrZXkpIHsNCiAgdHJ5IHsNCiAgICByZXR1cm4gaXRba2V5XTsNCiAgfSBjYXRjaCAoZSkgeyAvKiBlbXB0eSAqLyB9DQp9Ow0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgew0KICB2YXIgTywgVCwgQjsNCiAgcmV0dXJuIGl0ID09PSB1bmRlZmluZWQgPyAnVW5kZWZpbmVkJyA6IGl0ID09PSBudWxsID8gJ051bGwnDQogICAgLy8gQEB0b1N0cmluZ1RhZyBjYXNlDQogICAgOiB0eXBlb2YgKFQgPSB0cnlHZXQoTyA9IE9iamVjdChpdCksIFRBRykpID09ICdzdHJpbmcnID8gVA0KICAgIC8vIGJ1aWx0aW5UYWcgY2FzZQ0KICAgIDogQVJHID8gY29mKE8pDQogICAgLy8gRVMzIGFyZ3VtZW50cyBmYWxsYmFjaw0KICAgIDogKEIgPSBjb2YoTykpID09ICdPYmplY3QnICYmIHR5cGVvZiBPLmNhbGxlZSA9PSAnZnVuY3Rpb24nID8gJ0FyZ3VtZW50cycgOiBCOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDY5ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBJVEVSQVRPUiA9IF9fd2VicGFja19yZXF1aXJlX18oMCkoJ2l0ZXJhdG9yJyk7DQp2YXIgU0FGRV9DTE9TSU5HID0gZmFsc2U7DQoNCnRyeSB7DQogIHZhciByaXRlciA9IFs3XVtJVEVSQVRPUl0oKTsNCiAgcml0ZXJbJ3JldHVybiddID0gZnVuY3Rpb24gKCkgeyBTQUZFX0NMT1NJTkcgPSB0cnVlOyB9Ow0KICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdGhyb3ctbGl0ZXJhbA0KICBBcnJheS5mcm9tKHJpdGVyLCBmdW5jdGlvbiAoKSB7IHRocm93IDI7IH0pOw0KfSBjYXRjaCAoZSkgeyAvKiBlbXB0eSAqLyB9DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGV4ZWMsIHNraXBDbG9zaW5nKSB7DQogIGlmICghc2tpcENsb3NpbmcgJiYgIVNBRkVfQ0xPU0lORykgcmV0dXJuIGZhbHNlOw0KICB2YXIgc2FmZSA9IGZhbHNlOw0KICB0cnkgew0KICAgIHZhciBhcnIgPSBbN107DQogICAgdmFyIGl0ZXIgPSBhcnJbSVRFUkFUT1JdKCk7DQogICAgaXRlci5uZXh0ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4geyBkb25lOiBzYWZlID0gdHJ1ZSB9OyB9Ow0KICAgIGFycltJVEVSQVRPUl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiBpdGVyOyB9Ow0KICAgIGV4ZWMoYXJyKTsNCiAgfSBjYXRjaCAoZSkgeyAvKiBlbXB0eSAqLyB9DQogIHJldHVybiBzYWZlOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDcwICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCl9fd2VicGFja19yZXF1aXJlX18oNzEpOw0KbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpLkFycmF5LmluY2x1ZGVzOw0KDQoNCi8qKiovIH0pLA0KLyogNzEgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQovLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9BcnJheS5wcm90b3R5cGUuaW5jbHVkZXMNCnZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsNCnZhciAkaW5jbHVkZXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMwKSh0cnVlKTsNCg0KJGV4cG9ydCgkZXhwb3J0LlAsICdBcnJheScsIHsNCiAgaW5jbHVkZXM6IGZ1bmN0aW9uIGluY2x1ZGVzKGVsIC8qICwgZnJvbUluZGV4ID0gMCAqLykgew0KICAgIHJldHVybiAkaW5jbHVkZXModGhpcywgZWwsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsNCiAgfQ0KfSk7DQoNCl9fd2VicGFja19yZXF1aXJlX18oMjgpKCdpbmNsdWRlcycpOw0KDQoNCi8qKiovIH0pLA0KLyogNzIgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KLy8gUG9seWZpbGwgZm9yIGNyZWF0aW5nIEN1c3RvbUV2ZW50cyBvbiBJRTkvMTAvMTENCg0KLy8gY29kZSBwdWxsZWQgZnJvbToNCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9kNHRvY2NoaW5pL2N1c3RvbWV2ZW50LXBvbHlmaWxsDQovLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvQ3VzdG9tRXZlbnQjUG9seWZpbGwNCg0KdHJ5IHsNCiAgICB2YXIgY2UgPSBuZXcgd2luZG93LkN1c3RvbUV2ZW50KCd0ZXN0Jyk7DQogICAgY2UucHJldmVudERlZmF1bHQoKTsNCiAgICBpZiAoY2UuZGVmYXVsdFByZXZlbnRlZCAhPT0gdHJ1ZSkgew0KICAgICAgICAvLyBJRSBoYXMgcHJvYmxlbXMgd2l0aCAucHJldmVudERlZmF1bHQoKSBvbiBjdXN0b20gZXZlbnRzDQogICAgICAgIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjMzNDkxOTENCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb3VsZCBub3QgcHJldmVudCBkZWZhdWx0Jyk7DQogICAgfQ0KfSBjYXRjaChlKSB7DQogIHZhciBDdXN0b21FdmVudCA9IGZ1bmN0aW9uKGV2ZW50LCBwYXJhbXMpIHsNCiAgICB2YXIgZXZ0LCBvcmlnUHJldmVudDsNCiAgICBwYXJhbXMgPSBwYXJhbXMgfHwgew0KICAgICAgYnViYmxlczogZmFsc2UsDQogICAgICBjYW5jZWxhYmxlOiBmYWxzZSwNCiAgICAgIGRldGFpbDogdW5kZWZpbmVkDQogICAgfTsNCg0KICAgIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJDdXN0b21FdmVudCIpOw0KICAgIGV2dC5pbml0Q3VzdG9tRXZlbnQoZXZlbnQsIHBhcmFtcy5idWJibGVzLCBwYXJhbXMuY2FuY2VsYWJsZSwgcGFyYW1zLmRldGFpbCk7DQogICAgb3JpZ1ByZXZlbnQgPSBldnQucHJldmVudERlZmF1bHQ7DQogICAgZXZ0LnByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgb3JpZ1ByZXZlbnQuY2FsbCh0aGlzKTsNCiAgICAgIHRyeSB7DQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnZGVmYXVsdFByZXZlbnRlZCcsIHsNCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICB9IGNhdGNoKGUpIHsNCiAgICAgICAgdGhpcy5kZWZhdWx0UHJldmVudGVkID0gdHJ1ZTsNCiAgICAgIH0NCiAgICB9Ow0KICAgIHJldHVybiBldnQ7DQogIH07DQoNCiAgQ3VzdG9tRXZlbnQucHJvdG90eXBlID0gd2luZG93LkV2ZW50LnByb3RvdHlwZTsNCiAgd2luZG93LkN1c3RvbUV2ZW50ID0gQ3VzdG9tRXZlbnQ7IC8vIGV4cG9zZSBkZWZpbml0aW9uIHRvIHdpbmRvdw0KfQ0KDQoNCi8qKiovIH0pLA0KLyogNzMgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KDQp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsNCg0KdmFyIF9yZWR1eCA9IF9fd2VicGFja19yZXF1aXJlX18oMzMpOw0KDQp2YXIgX2luZGV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3OCk7DQoNCnZhciBfaW5kZXgyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaW5kZXgpOw0KDQpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQ0KDQpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IGVsc2UgeyByZXR1cm4gQXJyYXkuZnJvbShhcnIpOyB9IH0NCg0KZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9DQoNCnZhciBTdG9yZSA9IGZ1bmN0aW9uICgpIHsNCiAgZnVuY3Rpb24gU3RvcmUoKSB7DQogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFN0b3JlKTsNCg0KICAgIHRoaXMuX3N0b3JlID0gKDAsIF9yZWR1eC5jcmVhdGVTdG9yZSkoX2luZGV4Mi5kZWZhdWx0LCB3aW5kb3cuZGV2VG9vbHNFeHRlbnNpb24gPyB3aW5kb3cuZGV2VG9vbHNFeHRlbnNpb24oKSA6IHVuZGVmaW5lZCk7DQogIH0NCg0KICAvKioNCiAgICogU3Vic2NyaWJlIHN0b3JlIHRvIGZ1bmN0aW9uIGNhbGwgKHdyYXBwZWQgUmVkdXggbWV0aG9kKQ0KICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gb25DaGFuZ2UgRnVuY3Rpb24gdG8gdHJpZ2dlciB3aGVuIHN0YXRlIGNoYW5nZXMNCiAgICogQHJldHVybg0KICAgKi8NCg0KDQogIF9jcmVhdGVDbGFzcyhTdG9yZSwgW3sNCiAgICBrZXk6ICdzdWJzY3JpYmUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzdWJzY3JpYmUob25DaGFuZ2UpIHsNCiAgICAgIHRoaXMuX3N0b3JlLnN1YnNjcmliZShvbkNoYW5nZSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRGlzcGF0Y2ggZXZlbnQgdG8gc3RvcmUgKHdyYXBwZWQgUmVkdXggbWV0aG9kKQ0KICAgICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBhY3Rpb24gQWN0aW9uIGZ1bmN0aW9uIHRvIHRyaWdnZXINCiAgICAgKiBAcmV0dXJuDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2Rpc3BhdGNoJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzcGF0Y2goYWN0aW9uKSB7DQogICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaChhY3Rpb24pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCBzdG9yZSBvYmplY3QgKHdyYXBwaW5nIFJlZHV4IG1ldGhvZCkNCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IFN0YXRlDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2dldENob2ljZUJ5SWQnLA0KDQoNCiAgICAvKioNCiAgICAgKiBHZXQgc2luZ2xlIGNob2ljZSBieSBpdCdzIElEDQogICAgICogQHJldHVybiB7T2JqZWN0fSBGb3VuZCBjaG9pY2UNCiAgICAgKi8NCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2hvaWNlQnlJZChpZCkgew0KICAgICAgaWYgKGlkKSB7DQogICAgICAgIHZhciBjaG9pY2VzID0gdGhpcy5hY3RpdmVDaG9pY2VzOw0KICAgICAgICB2YXIgZm91bmRDaG9pY2UgPSBjaG9pY2VzLmZpbmQoZnVuY3Rpb24gKGNob2ljZSkgew0KICAgICAgICAgIHJldHVybiBjaG9pY2UuaWQgPT09IHBhcnNlSW50KGlkLCAxMCk7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gZm91bmRDaG9pY2U7DQogICAgICB9DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IGdyb3VwIGJ5IGdyb3VwIGlkDQogICAgICogQHBhcmFtICB7TnVtYmVyfSBpZCBHcm91cCBJRA0KICAgICAqIEByZXR1cm4ge09iamVjdH0gICAgR3JvdXAgZGF0YQ0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdnZXRHcm91cEJ5SWQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRHcm91cEJ5SWQoaWQpIHsNCiAgICAgIHJldHVybiB0aGlzLmdyb3Vwcy5maW5kKGZ1bmN0aW9uIChncm91cCkgew0KICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT09IHBhcnNlSW50KGlkLCAxMCk7DQogICAgICB9KTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdzdGF0ZScsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gdGhpcy5fc3RvcmUuZ2V0U3RhdGUoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgaXRlbXMgZnJvbSBzdG9yZQ0KICAgICAqIEByZXR1cm4ge0FycmF5fSBJdGVtIG9iamVjdHMNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnaXRlbXMnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuaXRlbXM7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IGFjdGl2ZSBpdGVtcyBmcm9tIHN0b3JlDQogICAgICogQHJldHVybiB7QXJyYXl9IEl0ZW0gb2JqZWN0cw0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdhY3RpdmVJdGVtcycsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gdGhpcy5pdGVtcy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIGl0ZW0uYWN0aXZlID09PSB0cnVlOw0KICAgICAgfSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IGhpZ2hsaWdodGVkIGl0ZW1zIGZyb20gc3RvcmUNCiAgICAgKiBAcmV0dXJuIHtBcnJheX0gSXRlbSBvYmplY3RzDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2hpZ2hsaWdodGVkQWN0aXZlSXRlbXMnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIHRoaXMuaXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgIHJldHVybiBpdGVtLmFjdGl2ZSAmJiBpdGVtLmhpZ2hsaWdodGVkOw0KICAgICAgfSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IGNob2ljZXMgZnJvbSBzdG9yZQ0KICAgICAqIEByZXR1cm4ge0FycmF5fSBPcHRpb24gb2JqZWN0cw0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdjaG9pY2VzJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiB0aGlzLnN0YXRlLmNob2ljZXM7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IGFjdGl2ZSBjaG9pY2VzIGZyb20gc3RvcmUNCiAgICAgKiBAcmV0dXJuIHtBcnJheX0gT3B0aW9uIG9iamVjdHMNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnYWN0aXZlQ2hvaWNlcycsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICB2YXIgY2hvaWNlcyA9IHRoaXMuY2hvaWNlczsNCiAgICAgIHZhciB2YWx1ZXMgPSBjaG9pY2VzLmZpbHRlcihmdW5jdGlvbiAoY2hvaWNlKSB7DQogICAgICAgIHJldHVybiBjaG9pY2UuYWN0aXZlID09PSB0cnVlOw0KICAgICAgfSk7DQoNCiAgICAgIHJldHVybiB2YWx1ZXM7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IHNlbGVjdGFibGUgY2hvaWNlcyBmcm9tIHN0b3JlDQogICAgICogQHJldHVybiB7QXJyYXl9IE9wdGlvbiBvYmplY3RzDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ3NlbGVjdGFibGVDaG9pY2VzJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiB0aGlzLmNob2ljZXMuZmlsdGVyKGZ1bmN0aW9uIChjaG9pY2UpIHsNCiAgICAgICAgcmV0dXJuIGNob2ljZS5kaXNhYmxlZCAhPT0gdHJ1ZTsNCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCBjaG9pY2VzIHRoYXQgY2FuIGJlIHNlYXJjaGVkIChleGNsdWRpbmcgcGxhY2Vob2xkZXJzKQ0KICAgICAqIEByZXR1cm4ge0FycmF5fSBPcHRpb24gb2JqZWN0cw0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdzZWFyY2hhYmxlQ2hvaWNlcycsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gdGhpcy5zZWxlY3RhYmxlQ2hvaWNlcy5maWx0ZXIoZnVuY3Rpb24gKGNob2ljZSkgew0KICAgICAgICByZXR1cm4gY2hvaWNlLnBsYWNlaG9sZGVyICE9PSB0cnVlOw0KICAgICAgfSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IHBsYWNlaG9sZGVyIGNob2ljZSBmcm9tIHN0b3JlDQogICAgICogQHJldHVybiB7T2JqZWN0fSBGb3VuZCBwbGFjZWhvbGRlcg0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdwbGFjZWhvbGRlckNob2ljZScsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0aGlzLmNob2ljZXMpKS5yZXZlcnNlKCkuZmluZChmdW5jdGlvbiAoY2hvaWNlKSB7DQogICAgICAgIHJldHVybiBjaG9pY2UucGxhY2Vob2xkZXIgPT09IHRydWU7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgZ3JvdXBzIGZyb20gc3RvcmUNCiAgICAgKiBAcmV0dXJuIHtBcnJheX0gR3JvdXAgb2JqZWN0cw0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdncm91cHMnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuZ3JvdXBzOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCBhY3RpdmUgZ3JvdXBzIGZyb20gc3RvcmUNCiAgICAgKiBAcmV0dXJuIHtBcnJheX0gR3JvdXAgb2JqZWN0cw0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdhY3RpdmVHcm91cHMnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgdmFyIGdyb3VwcyA9IHRoaXMuZ3JvdXBzOw0KICAgICAgdmFyIGNob2ljZXMgPSB0aGlzLmNob2ljZXM7DQoNCiAgICAgIHJldHVybiBncm91cHMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCkgew0KICAgICAgICB2YXIgaXNBY3RpdmUgPSBncm91cC5hY3RpdmUgPT09IHRydWUgJiYgZ3JvdXAuZGlzYWJsZWQgPT09IGZhbHNlOw0KICAgICAgICB2YXIgaGFzQWN0aXZlT3B0aW9ucyA9IGNob2ljZXMuc29tZShmdW5jdGlvbiAoY2hvaWNlKSB7DQogICAgICAgICAgcmV0dXJuIGNob2ljZS5hY3RpdmUgPT09IHRydWUgJiYgY2hvaWNlLmRpc2FibGVkID09PSBmYWxzZTsNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBpc0FjdGl2ZSAmJiBoYXNBY3RpdmVPcHRpb25zOw0KICAgICAgfSwgW10pOw0KICAgIH0NCiAgfV0pOw0KDQogIHJldHVybiBTdG9yZTsNCn0oKTsNCg0KZXhwb3J0cy5kZWZhdWx0ID0gU3RvcmU7DQoNCi8qKiovIH0pLA0KLyogNzQgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKGdsb2JhbCkgey8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgZ2xvYmFsYCBmcm9tIE5vZGUuanMuICovDQp2YXIgZnJlZUdsb2JhbCA9IHR5cGVvZiBnbG9iYWwgPT0gJ29iamVjdCcgJiYgZ2xvYmFsICYmIGdsb2JhbC5PYmplY3QgPT09IE9iamVjdCAmJiBnbG9iYWw7DQoNCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gX193ZWJwYWNrX2V4cG9ydHNfX1siYSJdID0gKGZyZWVHbG9iYWwpOw0KDQovKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwoX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXygzNCkpKQ0KDQovKioqLyB9KSwNCi8qIDc1ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwsIG1vZHVsZSkgey8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX3BvbnlmaWxsX2pzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc3KTsNCi8qIGdsb2JhbCB3aW5kb3cgKi8NCg0KDQp2YXIgcm9vdDsNCg0KaWYgKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJykgew0KICByb290ID0gc2VsZjsNCn0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgcm9vdCA9IHdpbmRvdzsNCn0gZWxzZSBpZiAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgcm9vdCA9IGdsb2JhbDsNCn0gZWxzZSBpZiAodHJ1ZSkgew0KICByb290ID0gbW9kdWxlOw0KfSBlbHNlIHsNCiAgcm9vdCA9IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7DQp9DQoNCnZhciByZXN1bHQgPSBPYmplY3QoX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX19wb255ZmlsbF9qc19fWyJhIiAvKiBkZWZhdWx0ICovXSkocm9vdCk7DQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIF9fd2VicGFja19leHBvcnRzX19bImEiXSA9IChyZXN1bHQpOw0KDQovKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwoX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXygzNCksIF9fd2VicGFja19yZXF1aXJlX18oNzYpKG1vZHVsZSkpKQ0KDQovKioqLyB9KSwNCi8qIDc2ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob3JpZ2luYWxNb2R1bGUpIHsNCglpZighb3JpZ2luYWxNb2R1bGUud2VicGFja1BvbHlmaWxsKSB7DQoJCXZhciBtb2R1bGUgPSBPYmplY3QuY3JlYXRlKG9yaWdpbmFsTW9kdWxlKTsNCgkJLy8gbW9kdWxlLnBhcmVudCA9IHVuZGVmaW5lZCBieSBkZWZhdWx0DQoJCWlmKCFtb2R1bGUuY2hpbGRyZW4pIG1vZHVsZS5jaGlsZHJlbiA9IFtdOw0KCQlPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kdWxlLCAibG9hZGVkIiwgew0KCQkJZW51bWVyYWJsZTogdHJ1ZSwNCgkJCWdldDogZnVuY3Rpb24oKSB7DQoJCQkJcmV0dXJuIG1vZHVsZS5sOw0KCQkJfQ0KCQl9KTsNCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgImlkIiwgew0KCQkJZW51bWVyYWJsZTogdHJ1ZSwNCgkJCWdldDogZnVuY3Rpb24oKSB7DQoJCQkJcmV0dXJuIG1vZHVsZS5pOw0KCQkJfQ0KCQl9KTsNCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgImV4cG9ydHMiLCB7DQoJCQllbnVtZXJhYmxlOiB0cnVlLA0KCQl9KTsNCgkJbW9kdWxlLndlYnBhY2tQb2x5ZmlsbCA9IDE7DQoJfQ0KCXJldHVybiBtb2R1bGU7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNzcgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KLyogaGFybW9ueSBleHBvcnQgKGltbXV0YWJsZSkgKi8gX193ZWJwYWNrX2V4cG9ydHNfX1siYSJdID0gc3ltYm9sT2JzZXJ2YWJsZVBvbnlmaWxsOw0KZnVuY3Rpb24gc3ltYm9sT2JzZXJ2YWJsZVBvbnlmaWxsKHJvb3QpIHsNCgl2YXIgcmVzdWx0Ow0KCXZhciBTeW1ib2wgPSByb290LlN5bWJvbDsNCg0KCWlmICh0eXBlb2YgU3ltYm9sID09PSAnZnVuY3Rpb24nKSB7DQoJCWlmIChTeW1ib2wub2JzZXJ2YWJsZSkgew0KCQkJcmVzdWx0ID0gU3ltYm9sLm9ic2VydmFibGU7DQoJCX0gZWxzZSB7DQoJCQlyZXN1bHQgPSBTeW1ib2woJ29ic2VydmFibGUnKTsNCgkJCVN5bWJvbC5vYnNlcnZhYmxlID0gcmVzdWx0Ow0KCQl9DQoJfSBlbHNlIHsNCgkJcmVzdWx0ID0gJ0BAb2JzZXJ2YWJsZSc7DQoJfQ0KDQoJcmV0dXJuIHJlc3VsdDsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA3OCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQoNCnZhciBfcmVkdXggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMzKTsNCg0KdmFyIF9pdGVtcyA9IF9fd2VicGFja19yZXF1aXJlX18oNzkpOw0KDQp2YXIgX2l0ZW1zMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2l0ZW1zKTsNCg0KdmFyIF9ncm91cHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgwKTsNCg0KdmFyIF9ncm91cHMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZ3JvdXBzKTsNCg0KdmFyIF9jaG9pY2VzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4MSk7DQoNCnZhciBfY2hvaWNlczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jaG9pY2VzKTsNCg0KdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7DQoNCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9DQoNCnZhciBhcHBSZWR1Y2VyID0gKDAsIF9yZWR1eC5jb21iaW5lUmVkdWNlcnMpKHsNCiAgaXRlbXM6IF9pdGVtczIuZGVmYXVsdCwNCiAgZ3JvdXBzOiBfZ3JvdXBzMi5kZWZhdWx0LA0KICBjaG9pY2VzOiBfY2hvaWNlczIuZGVmYXVsdA0KfSk7DQoNCnZhciByb290UmVkdWNlciA9IGZ1bmN0aW9uIHJvb3RSZWR1Y2VyKHBhc3NlZFN0YXRlLCBhY3Rpb24pIHsNCiAgdmFyIHN0YXRlID0gcGFzc2VkU3RhdGU7DQogIC8vIElmIHdlIGFyZSBjbGVhcmluZyBhbGwgaXRlbXMsIGdyb3VwcyBhbmQgb3B0aW9ucyB3ZSByZWFzc2lnbg0KICAvLyBzdGF0ZSBhbmQgdGhlbiBwYXNzIHRoYXQgc3RhdGUgdG8gb3VyIHByb3BlciByZWR1Y2VyLiBUaGlzIGlzbid0DQogIC8vIG11dGF0aW5nIG91ciBhY3R1YWwgc3RhdGUNCiAgLy8gU2VlOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8zNTY0MTk5Mg0KICBpZiAoYWN0aW9uLnR5cGUgPT09ICdDTEVBUl9BTEwnKSB7DQogICAgc3RhdGUgPSB1bmRlZmluZWQ7DQogIH0gZWxzZSBpZiAoYWN0aW9uLnR5cGUgPT09ICdSRVNFVF9UTycpIHsNCiAgICByZXR1cm4gKDAsIF91dGlscy5jbG9uZU9iamVjdCkoYWN0aW9uLnN0YXRlKTsNCiAgfQ0KDQogIHJldHVybiBhcHBSZWR1Y2VyKHN0YXRlLCBhY3Rpb24pOw0KfTsNCg0KZXhwb3J0cy5kZWZhdWx0ID0gcm9vdFJlZHVjZXI7DQoNCi8qKiovIH0pLA0KLyogNzkgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KZXhwb3J0cy5kZWZhdWx0ID0gaXRlbXM7DQoNCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gZWxzZSB7IHJldHVybiBBcnJheS5mcm9tKGFycik7IH0gfQ0KDQp2YXIgZGVmYXVsdFN0YXRlID0gZXhwb3J0cy5kZWZhdWx0U3RhdGUgPSBbXTsNCg0KZnVuY3Rpb24gaXRlbXMoKSB7DQogIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZGVmYXVsdFN0YXRlOw0KICB2YXIgYWN0aW9uID0gYXJndW1lbnRzWzFdOw0KDQogIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHsNCiAgICBjYXNlICdBRERfSVRFTSc6DQogICAgICB7DQogICAgICAgIC8vIEFkZCBvYmplY3QgdG8gaXRlbXMgYXJyYXkNCiAgICAgICAgdmFyIG5ld1N0YXRlID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShzdGF0ZSksIFt7DQogICAgICAgICAgaWQ6IGFjdGlvbi5pZCwNCiAgICAgICAgICBjaG9pY2VJZDogYWN0aW9uLmNob2ljZUlkLA0KICAgICAgICAgIGdyb3VwSWQ6IGFjdGlvbi5ncm91cElkLA0KICAgICAgICAgIHZhbHVlOiBhY3Rpb24udmFsdWUsDQogICAgICAgICAgbGFiZWw6IGFjdGlvbi5sYWJlbCwNCiAgICAgICAgICBhY3RpdmU6IHRydWUsDQogICAgICAgICAgaGlnaGxpZ2h0ZWQ6IGZhbHNlLA0KICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGFjdGlvbi5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgIHBsYWNlaG9sZGVyOiBhY3Rpb24ucGxhY2Vob2xkZXIgfHwgZmFsc2UsDQogICAgICAgICAga2V5Q29kZTogbnVsbA0KICAgICAgICB9XSk7DQoNCiAgICAgICAgcmV0dXJuIG5ld1N0YXRlLm1hcChmdW5jdGlvbiAob2JqKSB7DQogICAgICAgICAgdmFyIGl0ZW0gPSBvYmo7DQogICAgICAgICAgaXRlbS5oaWdobGlnaHRlZCA9IGZhbHNlOw0KICAgICAgICAgIHJldHVybiBpdGVtOw0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgIGNhc2UgJ1JFTU9WRV9JVEVNJzoNCiAgICAgIHsNCiAgICAgICAgLy8gU2V0IGl0ZW0gdG8gaW5hY3RpdmUNCiAgICAgICAgcmV0dXJuIHN0YXRlLm1hcChmdW5jdGlvbiAob2JqKSB7DQogICAgICAgICAgdmFyIGl0ZW0gPSBvYmo7DQogICAgICAgICAgaWYgKGl0ZW0uaWQgPT09IGFjdGlvbi5pZCkgew0KICAgICAgICAgICAgaXRlbS5hY3RpdmUgPSBmYWxzZTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIGl0ZW07DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgY2FzZSAnSElHSExJR0hUX0lURU0nOg0KICAgICAgew0KICAgICAgICByZXR1cm4gc3RhdGUubWFwKGZ1bmN0aW9uIChvYmopIHsNCiAgICAgICAgICB2YXIgaXRlbSA9IG9iajsNCiAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gYWN0aW9uLmlkKSB7DQogICAgICAgICAgICBpdGVtLmhpZ2hsaWdodGVkID0gYWN0aW9uLmhpZ2hsaWdodGVkOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gaXRlbTsNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICBkZWZhdWx0Og0KICAgICAgew0KICAgICAgICByZXR1cm4gc3RhdGU7DQogICAgICB9DQogIH0NCn0NCg0KLyoqKi8gfSksDQovKiA4MCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQpleHBvcnRzLmRlZmF1bHQgPSBncm91cHM7DQoNCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gZWxzZSB7IHJldHVybiBBcnJheS5mcm9tKGFycik7IH0gfQ0KDQp2YXIgZGVmYXVsdFN0YXRlID0gZXhwb3J0cy5kZWZhdWx0U3RhdGUgPSBbXTsNCg0KZnVuY3Rpb24gZ3JvdXBzKCkgew0KICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IGRlZmF1bHRTdGF0ZTsNCiAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50c1sxXTsNCg0KICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7DQogICAgY2FzZSAnQUREX0dST1VQJzoNCiAgICAgIHsNCiAgICAgICAgcmV0dXJuIFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoc3RhdGUpLCBbew0KICAgICAgICAgIGlkOiBhY3Rpb24uaWQsDQogICAgICAgICAgdmFsdWU6IGFjdGlvbi52YWx1ZSwNCiAgICAgICAgICBhY3RpdmU6IGFjdGlvbi5hY3RpdmUsDQogICAgICAgICAgZGlzYWJsZWQ6IGFjdGlvbi5kaXNhYmxlZA0KICAgICAgICB9XSk7DQogICAgICB9DQoNCiAgICBjYXNlICdDTEVBUl9DSE9JQ0VTJzoNCiAgICAgIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgfQ0KDQogICAgZGVmYXVsdDoNCiAgICAgIHsNCiAgICAgICAgcmV0dXJuIHN0YXRlOw0KICAgICAgfQ0KICB9DQp9DQoNCi8qKiovIH0pLA0KLyogODEgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KZXhwb3J0cy5kZWZhdWx0ID0gY2hvaWNlczsNCg0KZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSBlbHNlIHsgcmV0dXJuIEFycmF5LmZyb20oYXJyKTsgfSB9DQoNCnZhciBkZWZhdWx0U3RhdGUgPSBleHBvcnRzLmRlZmF1bHRTdGF0ZSA9IFtdOw0KDQpmdW5jdGlvbiBjaG9pY2VzKCkgew0KICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IGRlZmF1bHRTdGF0ZTsNCiAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50c1sxXTsNCg0KICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7DQogICAgY2FzZSAnQUREX0NIT0lDRSc6DQogICAgICB7DQogICAgICAgIC8qDQogICAgICAgICAgICBBIGRpc2FibGVkIGNob2ljZSBhcHBlYXJzIGluIHRoZSBjaG9pY2UgZHJvcGRvd24gYnV0IGNhbm5vdCBiZSBzZWxlY3RlZA0KICAgICAgICAgICAgQSBzZWxlY3RlZCBjaG9pY2UgaGFzIGJlZW4gYWRkZWQgdG8gdGhlIHBhc3NlZCBpbnB1dCdzIHZhbHVlIChhZGRlZCBhcyBhbiBpdGVtKQ0KICAgICAgICAgICAgQW4gYWN0aXZlIGNob2ljZSBhcHBlYXJzIHdpdGhpbiB0aGUgY2hvaWNlIGRyb3Bkb3duDQogICAgICAgICAqLw0KICAgICAgICByZXR1cm4gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShzdGF0ZSksIFt7DQogICAgICAgICAgaWQ6IGFjdGlvbi5pZCwNCiAgICAgICAgICBlbGVtZW50SWQ6IGFjdGlvbi5lbGVtZW50SWQsDQogICAgICAgICAgZ3JvdXBJZDogYWN0aW9uLmdyb3VwSWQsDQogICAgICAgICAgdmFsdWU6IGFjdGlvbi52YWx1ZSwNCiAgICAgICAgICBsYWJlbDogYWN0aW9uLmxhYmVsIHx8IGFjdGlvbi52YWx1ZSwNCiAgICAgICAgICBkaXNhYmxlZDogYWN0aW9uLmRpc2FibGVkIHx8IGZhbHNlLA0KICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZSwNCiAgICAgICAgICBhY3RpdmU6IHRydWUsDQogICAgICAgICAgc2NvcmU6IDk5OTksDQogICAgICAgICAgY3VzdG9tUHJvcGVydGllczogYWN0aW9uLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgcGxhY2Vob2xkZXI6IGFjdGlvbi5wbGFjZWhvbGRlciB8fCBmYWxzZSwNCiAgICAgICAgICBrZXlDb2RlOiBudWxsDQogICAgICAgIH1dKTsNCiAgICAgIH0NCg0KICAgIGNhc2UgJ0FERF9JVEVNJzoNCiAgICAgIHsNCiAgICAgICAgLy8gSWYgYWxsIGNob2ljZXMgbmVlZCB0byBiZSBhY3RpdmF0ZWQNCiAgICAgICAgaWYgKGFjdGlvbi5hY3RpdmF0ZU9wdGlvbnMpIHsNCiAgICAgICAgICByZXR1cm4gc3RhdGUubWFwKGZ1bmN0aW9uIChvYmopIHsNCiAgICAgICAgICAgIHZhciBjaG9pY2UgPSBvYmo7DQogICAgICAgICAgICBjaG9pY2UuYWN0aXZlID0gYWN0aW9uLmFjdGl2ZTsNCiAgICAgICAgICAgIHJldHVybiBjaG9pY2U7DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBXaGVuIGFuIGl0ZW0gaXMgYWRkZWQgYW5kIGl0IGhhcyBhbiBhc3NvY2lhdGVkIGNob2ljZSwNCiAgICAgICAgLy8gd2Ugd2FudCB0byBkaXNhYmxlIGl0IHNvIGl0IGNhbid0IGJlIGNob3NlbiBhZ2Fpbg0KICAgICAgICBpZiAoYWN0aW9uLmNob2ljZUlkID4gLTEpIHsNCiAgICAgICAgICByZXR1cm4gc3RhdGUubWFwKGZ1bmN0aW9uIChvYmopIHsNCiAgICAgICAgICAgIHZhciBjaG9pY2UgPSBvYmo7DQogICAgICAgICAgICBpZiAoY2hvaWNlLmlkID09PSBwYXJzZUludChhY3Rpb24uY2hvaWNlSWQsIDEwKSkgew0KICAgICAgICAgICAgICBjaG9pY2Uuc2VsZWN0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGNob2ljZTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBzdGF0ZTsNCiAgICAgIH0NCg0KICAgIGNhc2UgJ1JFTU9WRV9JVEVNJzoNCiAgICAgIHsNCiAgICAgICAgLy8gV2hlbiBhbiBpdGVtIGlzIHJlbW92ZWQgYW5kIGl0IGhhcyBhbiBhc3NvY2lhdGVkIGNob2ljZSwNCiAgICAgICAgLy8gd2Ugd2FudCB0byByZS1lbmFibGUgaXQgc28gaXQgY2FuIGJlIGNob3NlbiBhZ2Fpbg0KICAgICAgICBpZiAoYWN0aW9uLmNob2ljZUlkID4gLTEpIHsNCiAgICAgICAgICByZXR1cm4gc3RhdGUubWFwKGZ1bmN0aW9uIChvYmopIHsNCiAgICAgICAgICAgIHZhciBjaG9pY2UgPSBvYmo7DQogICAgICAgICAgICBpZiAoY2hvaWNlLmlkID09PSBwYXJzZUludChhY3Rpb24uY2hvaWNlSWQsIDEwKSkgew0KICAgICAgICAgICAgICBjaG9pY2Uuc2VsZWN0ZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBjaG9pY2U7DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gc3RhdGU7DQogICAgICB9DQoNCiAgICBjYXNlICdGSUxURVJfQ0hPSUNFUyc6DQogICAgICB7DQogICAgICAgIHJldHVybiBzdGF0ZS5tYXAoZnVuY3Rpb24gKG9iaikgew0KICAgICAgICAgIHZhciBjaG9pY2UgPSBvYmo7DQogICAgICAgICAgLy8gU2V0IGFjdGl2ZSBzdGF0ZSBiYXNlZCBvbiB3aGV0aGVyIGNob2ljZSBpcw0KICAgICAgICAgIC8vIHdpdGhpbiBmaWx0ZXJlZCByZXN1bHRzDQogICAgICAgICAgY2hvaWNlLmFjdGl2ZSA9IGFjdGlvbi5yZXN1bHRzLnNvbWUoZnVuY3Rpb24gKF9yZWYpIHsNCiAgICAgICAgICAgIHZhciBpdGVtID0gX3JlZi5pdGVtLA0KICAgICAgICAgICAgICAgIHNjb3JlID0gX3JlZi5zY29yZTsNCg0KICAgICAgICAgICAgaWYgKGl0ZW0uaWQgPT09IGNob2ljZS5pZCkgew0KICAgICAgICAgICAgICBjaG9pY2Uuc2NvcmUgPSBzY29yZTsNCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgfSk7DQoNCiAgICAgICAgICByZXR1cm4gY2hvaWNlOw0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgIGNhc2UgJ0FDVElWQVRFX0NIT0lDRVMnOg0KICAgICAgew0KICAgICAgICByZXR1cm4gc3RhdGUubWFwKGZ1bmN0aW9uIChvYmopIHsNCiAgICAgICAgICB2YXIgY2hvaWNlID0gb2JqOw0KICAgICAgICAgIGNob2ljZS5hY3RpdmUgPSBhY3Rpb24uYWN0aXZlOw0KICAgICAgICAgIHJldHVybiBjaG9pY2U7DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgY2FzZSAnQ0xFQVJfQ0hPSUNFUyc6DQogICAgICB7DQogICAgICAgIHJldHVybiBkZWZhdWx0U3RhdGU7DQogICAgICB9DQoNCiAgICBkZWZhdWx0Og0KICAgICAgew0KICAgICAgICByZXR1cm4gc3RhdGU7DQogICAgICB9DQogIH0NCn0NCg0KLyoqKi8gfSksDQovKiA4MiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQpleHBvcnRzLldyYXBwZWRTZWxlY3QgPSBleHBvcnRzLldyYXBwZWRJbnB1dCA9IGV4cG9ydHMuTGlzdCA9IGV4cG9ydHMuSW5wdXQgPSBleHBvcnRzLkNvbnRhaW5lciA9IGV4cG9ydHMuRHJvcGRvd24gPSB1bmRlZmluZWQ7DQoNCnZhciBfZHJvcGRvd24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgzKTsNCg0KdmFyIF9kcm9wZG93bjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9kcm9wZG93bik7DQoNCnZhciBfY29udGFpbmVyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NCk7DQoNCnZhciBfY29udGFpbmVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvbnRhaW5lcik7DQoNCnZhciBfaW5wdXQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg1KTsNCg0KdmFyIF9pbnB1dDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pbnB1dCk7DQoNCnZhciBfbGlzdCA9IF9fd2VicGFja19yZXF1aXJlX18oODYpOw0KDQp2YXIgX2xpc3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbGlzdCk7DQoNCnZhciBfd3JhcHBlZElucHV0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4Nyk7DQoNCnZhciBfd3JhcHBlZElucHV0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3dyYXBwZWRJbnB1dCk7DQoNCnZhciBfd3JhcHBlZFNlbGVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oODgpOw0KDQp2YXIgX3dyYXBwZWRTZWxlY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfd3JhcHBlZFNlbGVjdCk7DQoNCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9DQoNCmV4cG9ydHMuRHJvcGRvd24gPSBfZHJvcGRvd24yLmRlZmF1bHQ7DQpleHBvcnRzLkNvbnRhaW5lciA9IF9jb250YWluZXIyLmRlZmF1bHQ7DQpleHBvcnRzLklucHV0ID0gX2lucHV0Mi5kZWZhdWx0Ow0KZXhwb3J0cy5MaXN0ID0gX2xpc3QyLmRlZmF1bHQ7DQpleHBvcnRzLldyYXBwZWRJbnB1dCA9IF93cmFwcGVkSW5wdXQyLmRlZmF1bHQ7DQpleHBvcnRzLldyYXBwZWRTZWxlY3QgPSBfd3JhcHBlZFNlbGVjdDIuZGVmYXVsdDsNCg0KLyoqKi8gfSksDQovKiA4MyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQoNCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOw0KDQpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0NCg0KdmFyIERyb3Bkb3duID0gZnVuY3Rpb24gKCkgew0KICBmdW5jdGlvbiBEcm9wZG93bihfcmVmKSB7DQogICAgdmFyIGVsZW1lbnQgPSBfcmVmLmVsZW1lbnQsDQogICAgICAgIHR5cGUgPSBfcmVmLnR5cGUsDQogICAgICAgIGNsYXNzTmFtZXMgPSBfcmVmLmNsYXNzTmFtZXM7DQoNCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRHJvcGRvd24pOw0KDQogICAgT2JqZWN0LmFzc2lnbih0aGlzLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIHR5cGU6IHR5cGUsIGNsYXNzTmFtZXM6IGNsYXNzTmFtZXMgfSk7DQoNCiAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7DQogIH0NCg0KICAvKioNCiAgICogRGV0ZXJtaW5lIGhvdyBmYXIgdGhlIHRvcCBvZiBvdXIgZWxlbWVudCBpcyBmcm9tDQogICAqIHRoZSB0b3Agb2YgdGhlIHdpbmRvdw0KICAgKiBAcmV0dXJuIHtOdW1iZXJ9IFZlcnRpY2FsIHBvc2l0aW9uDQogICAqLw0KDQoNCiAgX2NyZWF0ZUNsYXNzKERyb3Bkb3duLCBbew0KICAgIGtleTogJ2Rpc3RhbmNlRnJvbVRvcFdpbmRvdycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3RhbmNlRnJvbVRvcFdpbmRvdygpIHsNCiAgICAgIHRoaXMuZGltZW5zaW9ucyA9IHRoaXMuZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgIHRoaXMucG9zaXRpb24gPSBNYXRoLmNlaWwodGhpcy5kaW1lbnNpb25zLnRvcCArIHdpbmRvdy5wYWdlWU9mZnNldCArIHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHQpOw0KICAgICAgcmV0dXJuIHRoaXMucG9zaXRpb247DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRmluZCBlbGVtZW50IHRoYXQgbWF0Y2hlcyBwYXNzZWQgc2VsZWN0b3INCiAgICAgKiBAcmV0dXJuIHtIVE1MRWxlbWVudH0NCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnZ2V0Q2hpbGQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDaGlsZChzZWxlY3Rvcikgew0KICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTaG93IGRyb3Bkb3duIHRvIHVzZXIgYnkgYWRkaW5nIGFjdGl2ZSBzdGF0ZSBjbGFzcw0KICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2xhc3MgaW5zdGFuY2UNCiAgICAgKiBAcHVibGljDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ3Nob3cnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzaG93KCkgew0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5jbGFzc05hbWVzLmFjdGl2ZVN0YXRlKTsNCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpOw0KICAgICAgdGhpcy5pc0FjdGl2ZSA9IHRydWU7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBIaWRlIGRyb3Bkb3duIGZyb20gdXNlcg0KICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2xhc3MgaW5zdGFuY2UNCiAgICAgKiBAcHVibGljDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2hpZGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBoaWRlKCkgew0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5jbGFzc05hbWVzLmFjdGl2ZVN0YXRlKTsNCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnKTsNCiAgICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfV0pOw0KDQogIHJldHVybiBEcm9wZG93bjsNCn0oKTsNCg0KZXhwb3J0cy5kZWZhdWx0ID0gRHJvcGRvd247DQoNCi8qKiovIH0pLA0KLyogODQgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KDQp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsNCg0KdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7DQoNCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQ0KDQp2YXIgQ29udGFpbmVyID0gZnVuY3Rpb24gKCkgew0KICBmdW5jdGlvbiBDb250YWluZXIoX3JlZikgew0KICAgIHZhciBlbGVtZW50ID0gX3JlZi5lbGVtZW50LA0KICAgICAgICB0eXBlID0gX3JlZi50eXBlLA0KICAgICAgICBjbGFzc05hbWVzID0gX3JlZi5jbGFzc05hbWVzLA0KICAgICAgICBwb3NpdGlvbiA9IF9yZWYucG9zaXRpb247DQoNCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ29udGFpbmVyKTsNCg0KICAgIE9iamVjdC5hc3NpZ24odGhpcywgeyBlbGVtZW50OiBlbGVtZW50LCBjbGFzc05hbWVzOiBjbGFzc05hbWVzLCB0eXBlOiB0eXBlLCBwb3NpdGlvbjogcG9zaXRpb24gfSk7DQoNCiAgICB0aGlzLmlzT3BlbiA9IGZhbHNlOw0KICAgIHRoaXMuaXNGbGlwcGVkID0gZmFsc2U7DQogICAgdGhpcy5pc0ZvY3Vzc2VkID0gZmFsc2U7DQogICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7DQogICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsNCg0KICAgIHRoaXMuX29uRm9jdXMgPSB0aGlzLl9vbkZvY3VzLmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25CbHVyID0gdGhpcy5fb25CbHVyLmJpbmQodGhpcyk7DQogIH0NCg0KICAvKioNCiAgICogQWRkIGV2ZW50IGxpc3RlbmVycw0KICAgKi8NCg0KDQogIF9jcmVhdGVDbGFzcyhDb250YWluZXIsIFt7DQogICAga2V5OiAnYWRkRXZlbnRMaXN0ZW5lcnMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVycygpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX29uRm9jdXMpOw0KICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlbW92ZSBldmVudCBsaXN0ZW5lcnMNCiAgICAgKi8NCg0KICAgIC8qKiAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdyZW1vdmVFdmVudExpc3RlbmVycycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkgew0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fb25Gb2N1cyk7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmx1cicsIHRoaXMuX29uQmx1cik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRGV0ZXJtaW5lIHdoZXRoZXIgY29udGFpbmVyIHNob3VsZCBiZSBmbGlwcGVkDQogICAgICogYmFzZWQgb24gcGFzc2VkIGRyb3Bkb3duIHBvc2l0aW9uDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IGRyb3Bkb3duUG9zDQogICAgICogQHJldHVybnMNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnc2hvdWxkRmxpcCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNob3VsZEZsaXAoZHJvcGRvd25Qb3MpIHsNCiAgICAgIHZhciB3aW5kb3dIZWlnaHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICgwLCBfdXRpbHMuZ2V0V2luZG93SGVpZ2h0KSgpOw0KDQogICAgICBpZiAoZHJvcGRvd25Qb3MgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQoNCiAgICAgIC8vIElmIGZsaXAgaXMgZW5hYmxlZCBhbmQgdGhlIGRyb3Bkb3duIGJvdHRvbSBwb3NpdGlvbiBpcw0KICAgICAgLy8gZ3JlYXRlciB0aGFuIHRoZSB3aW5kb3cgaGVpZ2h0IGZsaXAgdGhlIGRyb3Bkb3duLg0KICAgICAgdmFyIHNob3VsZEZsaXAgPSBmYWxzZTsNCiAgICAgIGlmICh0aGlzLnBvc2l0aW9uID09PSAnYXV0bycpIHsNCiAgICAgICAgc2hvdWxkRmxpcCA9IGRyb3Bkb3duUG9zID49IHdpbmRvd0hlaWdodDsNCiAgICAgIH0gZWxzZSBpZiAodGhpcy5wb3NpdGlvbiA9PT0gJ3RvcCcpIHsNCiAgICAgICAgc2hvdWxkRmxpcCA9IHRydWU7DQogICAgICB9DQoNCiAgICAgIHJldHVybiBzaG91bGRGbGlwOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFNldCBhY3RpdmUgZGVzY2VuZGFudCBhdHRyaWJ1dGUNCiAgICAgKiBAcGFyYW0ge051bWJlcn0gYWN0aXZlRGVzY2VuZGFudCBJRCBvZiBhY3RpdmUgZGVzY2VuZGFudA0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdzZXRBY3RpdmVEZXNjZW5kYW50JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0QWN0aXZlRGVzY2VuZGFudChhY3RpdmVEZXNjZW5kYW50SUQpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcsIGFjdGl2ZURlc2NlbmRhbnRJRCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVtb3ZlIGFjdGl2ZSBkZXNjZW5kYW50IGF0dHJpYnV0ZQ0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdyZW1vdmVBY3RpdmVEZXNjZW5kYW50JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlQWN0aXZlRGVzY2VuZGFudCgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ29wZW4nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBvcGVuKGRyb3Bkb3duUG9zKSB7DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLmNsYXNzTmFtZXMub3BlblN0YXRlKTsNCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpOw0KICAgICAgdGhpcy5pc09wZW4gPSB0cnVlOw0KDQogICAgICBpZiAodGhpcy5zaG91bGRGbGlwKGRyb3Bkb3duUG9zKSkgew0KICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLmNsYXNzTmFtZXMuZmxpcHBlZFN0YXRlKTsNCiAgICAgICAgdGhpcy5pc0ZsaXBwZWQgPSB0cnVlOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2Nsb3NlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xvc2UoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmNsYXNzTmFtZXMub3BlblN0YXRlKTsNCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnKTsNCiAgICAgIHRoaXMucmVtb3ZlQWN0aXZlRGVzY2VuZGFudCgpOw0KICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTsNCg0KICAgICAgLy8gQSBkcm9wZG93biBmbGlwcyBpZiBpdCBkb2VzIG5vdCBoYXZlIHNwYWNlIHdpdGhpbiB0aGUgcGFnZQ0KICAgICAgaWYgKHRoaXMuaXNGbGlwcGVkKSB7DQogICAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2xhc3NOYW1lcy5mbGlwcGVkU3RhdGUpOw0KICAgICAgICB0aGlzLmlzRmxpcHBlZCA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2ZvY3VzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9jdXMoKSB7DQogICAgICBpZiAoIXRoaXMuaXNGb2N1c3NlZCkgew0KICAgICAgICB0aGlzLmVsZW1lbnQuZm9jdXMoKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdhZGRGb2N1c1N0YXRlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkRm9jdXNTdGF0ZSgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuY2xhc3NOYW1lcy5mb2N1c1N0YXRlKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdyZW1vdmVGb2N1c1N0YXRlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlRm9jdXNTdGF0ZSgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2xhc3NOYW1lcy5mb2N1c1N0YXRlKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZW1vdmUgZGlzYWJsZWQgc3RhdGUNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnZW5hYmxlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZW5hYmxlKCkgew0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5jbGFzc05hbWVzLmRpc2FibGVkU3RhdGUpOw0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1kaXNhYmxlZCcpOw0KICAgICAgaWYgKHRoaXMudHlwZSA9PT0gJ3NlbGVjdC1vbmUnKSB7DQogICAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTsNCiAgICAgIH0NCiAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFNldCBkaXNhYmxlZCBzdGF0ZQ0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdkaXNhYmxlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzYWJsZSgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuY2xhc3NOYW1lcy5kaXNhYmxlZFN0YXRlKTsNCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZGlzYWJsZWQnLCAndHJ1ZScpOw0KICAgICAgaWYgKHRoaXMudHlwZSA9PT0gJ3NlbGVjdC1vbmUnKSB7DQogICAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJy0xJyk7DQogICAgICB9DQogICAgICB0aGlzLmlzRGlzYWJsZWQgPSB0cnVlOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3dyYXAnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiB3cmFwKGVsZW1lbnQpIHsNCiAgICAgICgwLCBfdXRpbHMud3JhcCkoZWxlbWVudCwgdGhpcy5lbGVtZW50KTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICd1bndyYXAnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiB1bndyYXAoZWxlbWVudCkgew0KICAgICAgLy8gTW92ZSBwYXNzZWQgZWxlbWVudCBvdXRzaWRlIHRoaXMgZWxlbWVudA0KICAgICAgdGhpcy5lbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsZW1lbnQsIHRoaXMuZWxlbWVudCk7DQogICAgICAvLyBSZW1vdmUgdGhpcyBlbGVtZW50DQogICAgICB0aGlzLmVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEFkZCBsb2FkaW5nIHN0YXRlIHRvIGVsZW1lbnQNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnYWRkTG9hZGluZ1N0YXRlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkTG9hZGluZ1N0YXRlKCkgew0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5jbGFzc05hbWVzLmxvYWRpbmdTdGF0ZSk7DQogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWJ1c3knLCAndHJ1ZScpOw0KICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlbW92ZSBsb2FkaW5nIHN0YXRlIGZyb20gZWxlbWVudA0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdyZW1vdmVMb2FkaW5nU3RhdGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVMb2FkaW5nU3RhdGUoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmNsYXNzTmFtZXMubG9hZGluZ1N0YXRlKTsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtYnVzeScpOw0KICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZXQgZm9jdXNzZWQgc3RhdGUNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnX29uRm9jdXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Gb2N1cygpIHsNCiAgICAgIHRoaXMuaXNGb2N1c3NlZCA9IHRydWU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVtb3ZlIGJsdXJyZWQgc3RhdGUNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnX29uQmx1cicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkJsdXIoKSB7DQogICAgICB0aGlzLmlzRm9jdXNzZWQgPSBmYWxzZTsNCiAgICB9DQogIH1dKTsNCg0KICByZXR1cm4gQ29udGFpbmVyOw0KfSgpOw0KDQpleHBvcnRzLmRlZmF1bHQgPSBDb250YWluZXI7DQoNCi8qKiovIH0pLA0KLyogODUgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KDQp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsNCg0KdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7DQoNCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQ0KDQp2YXIgSW5wdXQgPSBmdW5jdGlvbiAoKSB7DQogIGZ1bmN0aW9uIElucHV0KF9yZWYpIHsNCiAgICB2YXIgZWxlbWVudCA9IF9yZWYuZWxlbWVudCwNCiAgICAgICAgdHlwZSA9IF9yZWYudHlwZSwNCiAgICAgICAgY2xhc3NOYW1lcyA9IF9yZWYuY2xhc3NOYW1lcywNCiAgICAgICAgcGxhY2Vob2xkZXJWYWx1ZSA9IF9yZWYucGxhY2Vob2xkZXJWYWx1ZTsNCg0KICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJbnB1dCk7DQoNCiAgICBPYmplY3QuYXNzaWduKHRoaXMsIHsgZWxlbWVudDogZWxlbWVudCwgdHlwZTogdHlwZSwgY2xhc3NOYW1lczogY2xhc3NOYW1lcywgcGxhY2Vob2xkZXJWYWx1ZTogcGxhY2Vob2xkZXJWYWx1ZSB9KTsNCg0KICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7DQogICAgdGhpcy5jbGFzc05hbWVzID0gY2xhc3NOYW1lczsNCiAgICB0aGlzLmlzRm9jdXNzZWQgPSB0aGlzLmVsZW1lbnQgPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7DQogICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7DQoNCiAgICAvLyBCaW5kIGV2ZW50IGxpc3RlbmVycw0KICAgIHRoaXMuX29uUGFzdGUgPSB0aGlzLl9vblBhc3RlLmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25JbnB1dCA9IHRoaXMuX29uSW5wdXQuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbkZvY3VzID0gdGhpcy5fb25Gb2N1cy5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uQmx1ciA9IHRoaXMuX29uQmx1ci5iaW5kKHRoaXMpOw0KICB9DQoNCiAgX2NyZWF0ZUNsYXNzKElucHV0LCBbew0KICAgIGtleTogJ2FkZEV2ZW50TGlzdGVuZXJzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcnMoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB0aGlzLl9vbklucHV0KTsNCiAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdwYXN0ZScsIHRoaXMuX29uUGFzdGUpOw0KICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fb25Gb2N1cyk7DQogICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIHRoaXMuX29uQmx1cik7DQoNCiAgICAgIGlmICh0aGlzLmVsZW1lbnQuZm9ybSkgew0KICAgICAgICB0aGlzLmVsZW1lbnQuZm9ybS5hZGRFdmVudExpc3RlbmVyKCdyZXNldCcsIHRoaXMuX29uRm9ybVJlc2V0KTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdyZW1vdmVFdmVudExpc3RlbmVycycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkgew0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdGhpcy5fb25JbnB1dCk7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncGFzdGUnLCB0aGlzLl9vblBhc3RlKTsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX29uRm9jdXMpOw0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOw0KDQogICAgICBpZiAodGhpcy5lbGVtZW50LmZvcm0pIHsNCiAgICAgICAgdGhpcy5lbGVtZW50LmZvcm0ucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzZXQnLCB0aGlzLl9vbkZvcm1SZXNldCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnZW5hYmxlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZW5hYmxlKCkgew0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTsNCiAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2Rpc2FibGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNhYmxlKCkgew0KICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7DQogICAgICB0aGlzLmlzRGlzYWJsZWQgPSB0cnVlOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2ZvY3VzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9jdXMoKSB7DQogICAgICBpZiAoIXRoaXMuaXNGb2N1c3NlZCkgew0KICAgICAgICB0aGlzLmVsZW1lbnQuZm9jdXMoKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdibHVyJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gYmx1cigpIHsNCiAgICAgIGlmICh0aGlzLmlzRm9jdXNzZWQpIHsNCiAgICAgICAgdGhpcy5lbGVtZW50LmJsdXIoKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZXQgdmFsdWUgb2YgaW5wdXQgdG8gYmxhbmsNCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IENsYXNzIGluc3RhbmNlDQogICAgICogQHB1YmxpYw0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdjbGVhcicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGNsZWFyKCkgew0KICAgICAgdmFyIHNldFdpZHRoID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB0cnVlOw0KDQogICAgICBpZiAodGhpcy5lbGVtZW50LnZhbHVlKSB7DQogICAgICAgIHRoaXMuZWxlbWVudC52YWx1ZSA9ICcnOw0KICAgICAgfQ0KDQogICAgICBpZiAoc2V0V2lkdGgpIHsNCiAgICAgICAgdGhpcy5zZXRXaWR0aCgpOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTZXQgdGhlIGNvcnJlY3QgaW5wdXQgd2lkdGggYmFzZWQgb24gcGxhY2Vob2xkZXINCiAgICAgKiB2YWx1ZSBvciBpbnB1dCB2YWx1ZQ0KICAgICAqIEByZXR1cm4NCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnc2V0V2lkdGgnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRXaWR0aChlbmZvcmNlV2lkdGgpIHsNCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7DQoNCiAgICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uIGNhbGxiYWNrKHdpZHRoKSB7DQogICAgICAgIF90aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSB3aWR0aDsNCiAgICAgIH07DQoNCiAgICAgIGlmICh0aGlzLl9wbGFjZWhvbGRlclZhbHVlKSB7DQogICAgICAgIC8vIElmIHRoZXJlIGlzIGEgcGxhY2Vob2xkZXIsIHdlIG9ubHkgd2FudCB0byBzZXQgdGhlIHdpZHRoIG9mIHRoZSBpbnB1dCB3aGVuIGl0IGlzIGEgZ3JlYXRlcg0KICAgICAgICAvLyBsZW5ndGggdGhhbiA3NSUgb2YgdGhlIHBsYWNlaG9sZGVyLiBUaGlzIHN0b3BzIHRoZSBpbnB1dCBqdW1waW5nIGFyb3VuZC4NCiAgICAgICAgdmFyIHZhbHVlSGFzRGVzaXJlZExlbmd0aCA9IHRoaXMuZWxlbWVudC52YWx1ZS5sZW5ndGggPj0gdGhpcy5fcGxhY2Vob2xkZXJWYWx1ZS5sZW5ndGggLyAxLjI1Ow0KDQogICAgICAgIGlmICh0aGlzLmVsZW1lbnQudmFsdWUgJiYgdmFsdWVIYXNEZXNpcmVkTGVuZ3RoIHx8IGVuZm9yY2VXaWR0aCkgew0KICAgICAgICAgIHRoaXMuY2FsY1dpZHRoKGNhbGxiYWNrKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gcGxhY2Vob2xkZXIsIHJlc2l6ZSBpbnB1dCB0byBjb250ZW50cw0KICAgICAgICB0aGlzLmNhbGNXaWR0aChjYWxsYmFjayk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnY2FsY1dpZHRoJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gY2FsY1dpZHRoKGNhbGxiYWNrKSB7DQogICAgICByZXR1cm4gKDAsIF91dGlscy5jYWxjV2lkdGhPZklucHV0KSh0aGlzLmVsZW1lbnQsIGNhbGxiYWNrKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdzZXRBY3RpdmVEZXNjZW5kYW50JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0QWN0aXZlRGVzY2VuZGFudChhY3RpdmVEZXNjZW5kYW50SUQpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcsIGFjdGl2ZURlc2NlbmRhbnRJRCk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAncmVtb3ZlQWN0aXZlRGVzY2VuZGFudCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUFjdGl2ZURlc2NlbmRhbnQoKSB7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWFjdGl2ZWRlc2NlbmRhbnQnKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25JbnB1dCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbklucHV0KCkgew0KICAgICAgaWYgKHRoaXMudHlwZSAhPT0gJ3NlbGVjdC1vbmUnKSB7DQogICAgICAgIHRoaXMuc2V0V2lkdGgoKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25QYXN0ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblBhc3RlKGV2ZW50KSB7DQogICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0Ow0KICAgICAgLy8gRGlzYWJsZSBwYXN0aW5nIGludG8gdGhlIGlucHV0IGlmIG9wdGlvbiBoYXMgYmVlbiBzZXQNCg0KICAgICAgaWYgKHRhcmdldCA9PT0gdGhpcy5lbGVtZW50ICYmIHRoaXMucHJldmVudFBhc3RlKSB7DQogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uRm9jdXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Gb2N1cygpIHsNCiAgICAgIHRoaXMuaXNGb2N1c3NlZCA9IHRydWU7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uQmx1cicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkJsdXIoKSB7DQogICAgICB0aGlzLmlzRm9jdXNzZWQgPSBmYWxzZTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdwbGFjZWhvbGRlcicsDQogICAgc2V0OiBmdW5jdGlvbiBzZXQocGxhY2Vob2xkZXIpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5wbGFjZWhvbGRlciA9IHBsYWNlaG9sZGVyOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3ZhbHVlJywNCiAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWx1ZSkgew0KICAgICAgdGhpcy5lbGVtZW50LnZhbHVlID0gJycgKyB2YWx1ZTsNCiAgICB9LA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyaXBIVE1MKSh0aGlzLmVsZW1lbnQudmFsdWUpOw0KICAgIH0NCiAgfV0pOw0KDQogIHJldHVybiBJbnB1dDsNCn0oKTsNCg0KZXhwb3J0cy5kZWZhdWx0ID0gSW5wdXQ7DQoNCi8qKiovIH0pLA0KLyogODYgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KDQp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsNCg0KdmFyIF9jb25zdGFudHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOw0KDQpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0NCg0KdmFyIExpc3QgPSBmdW5jdGlvbiAoKSB7DQogIGZ1bmN0aW9uIExpc3QoX3JlZikgew0KICAgIHZhciBlbGVtZW50ID0gX3JlZi5lbGVtZW50Ow0KDQogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExpc3QpOw0KDQogICAgT2JqZWN0LmFzc2lnbih0aGlzLCB7IGVsZW1lbnQ6IGVsZW1lbnQgfSk7DQoNCiAgICB0aGlzLnNjcm9sbFBvcyA9IHRoaXMuZWxlbWVudC5zY3JvbGxUb3A7DQogICAgdGhpcy5oZWlnaHQgPSB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0Ow0KICAgIHRoaXMuaGFzQ2hpbGRyZW4gPSAhIXRoaXMuZWxlbWVudC5jaGlsZHJlbjsNCiAgfQ0KDQogIF9jcmVhdGVDbGFzcyhMaXN0LCBbew0KICAgIGtleTogJ2NsZWFyJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXIoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuaW5uZXJIVE1MID0gJyc7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnYXBwZW5kJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gYXBwZW5kKG5vZGUpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZChub2RlKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdnZXRDaGlsZCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENoaWxkKHNlbGVjdG9yKSB7DQogICAgICByZXR1cm4gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3Njcm9sbFRvVG9wJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2Nyb2xsVG9Ub3AoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wID0gMDsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdzY3JvbGxUb0Nob2ljZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNjcm9sbFRvQ2hvaWNlKGNob2ljZSwgZGlyZWN0aW9uKSB7DQogICAgICB2YXIgX3RoaXMgPSB0aGlzOw0KDQogICAgICBpZiAoIWNob2ljZSkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHZhciBkcm9wZG93bkhlaWdodCA9IHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHQ7DQogICAgICB2YXIgY2hvaWNlSGVpZ2h0ID0gY2hvaWNlLm9mZnNldEhlaWdodDsNCiAgICAgIC8vIERpc3RhbmNlIGZyb20gYm90dG9tIG9mIGVsZW1lbnQgdG8gdG9wIG9mIHBhcmVudA0KICAgICAgdmFyIGNob2ljZVBvcyA9IGNob2ljZS5vZmZzZXRUb3AgKyBjaG9pY2VIZWlnaHQ7DQogICAgICAvLyBTY3JvbGwgcG9zaXRpb24gb2YgZHJvcGRvd24NCiAgICAgIHZhciBjb250YWluZXJTY3JvbGxQb3MgPSB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wICsgZHJvcGRvd25IZWlnaHQ7DQogICAgICAvLyBEaWZmZXJlbmNlIGJldHdlZW4gdGhlIGNob2ljZSBhbmQgc2Nyb2xsIHBvc2l0aW9uDQogICAgICB2YXIgZW5kcG9pbnQgPSBkaXJlY3Rpb24gPiAwID8gdGhpcy5lbGVtZW50LnNjcm9sbFRvcCArIGNob2ljZVBvcyAtIGNvbnRhaW5lclNjcm9sbFBvcyA6IGNob2ljZS5vZmZzZXRUb3A7DQoNCiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAodGltZSkgew0KICAgICAgICBfdGhpcy5fYW5pbWF0ZVNjcm9sbCh0aW1lLCBlbmRwb2ludCwgZGlyZWN0aW9uKTsNCiAgICAgIH0pOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19zY3JvbGxEb3duJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3Njcm9sbERvd24oc2Nyb2xsUG9zLCBzdHJlbmd0aCwgZW5kcG9pbnQpIHsNCiAgICAgIHZhciBlYXNpbmcgPSAoZW5kcG9pbnQgLSBzY3JvbGxQb3MpIC8gc3RyZW5ndGg7DQogICAgICB2YXIgZGlzdGFuY2UgPSBlYXNpbmcgPiAxID8gZWFzaW5nIDogMTsNCg0KICAgICAgdGhpcy5lbGVtZW50LnNjcm9sbFRvcCA9IHNjcm9sbFBvcyArIGRpc3RhbmNlOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19zY3JvbGxVcCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9zY3JvbGxVcChzY3JvbGxQb3MsIHN0cmVuZ3RoLCBlbmRwb2ludCkgew0KICAgICAgdmFyIGVhc2luZyA9IChzY3JvbGxQb3MgLSBlbmRwb2ludCkgLyBzdHJlbmd0aDsNCiAgICAgIHZhciBkaXN0YW5jZSA9IGVhc2luZyA+IDEgPyBlYXNpbmcgOiAxOw0KDQogICAgICB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wID0gc2Nyb2xsUG9zIC0gZGlzdGFuY2U7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2FuaW1hdGVTY3JvbGwnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfYW5pbWF0ZVNjcm9sbCh0aW1lLCBlbmRwb2ludCwgZGlyZWN0aW9uKSB7DQogICAgICB2YXIgX3RoaXMyID0gdGhpczsNCg0KICAgICAgdmFyIHN0cmVuZ3RoID0gX2NvbnN0YW50cy5TQ1JPTExJTkdfU1BFRUQ7DQogICAgICB2YXIgY2hvaWNlTGlzdFNjcm9sbFRvcCA9IHRoaXMuZWxlbWVudC5zY3JvbGxUb3A7DQogICAgICB2YXIgY29udGludWVBbmltYXRpb24gPSBmYWxzZTsNCg0KICAgICAgaWYgKGRpcmVjdGlvbiA+IDApIHsNCiAgICAgICAgdGhpcy5fc2Nyb2xsRG93bihjaG9pY2VMaXN0U2Nyb2xsVG9wLCBzdHJlbmd0aCwgZW5kcG9pbnQpOw0KDQogICAgICAgIGlmIChjaG9pY2VMaXN0U2Nyb2xsVG9wIDwgZW5kcG9pbnQpIHsNCiAgICAgICAgICBjb250aW51ZUFuaW1hdGlvbiA9IHRydWU7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuX3Njcm9sbFVwKGNob2ljZUxpc3RTY3JvbGxUb3AsIHN0cmVuZ3RoLCBlbmRwb2ludCk7DQoNCiAgICAgICAgaWYgKGNob2ljZUxpc3RTY3JvbGxUb3AgPiBlbmRwb2ludCkgew0KICAgICAgICAgIGNvbnRpbnVlQW5pbWF0aW9uID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBpZiAoY29udGludWVBbmltYXRpb24pIHsNCiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICBfdGhpczIuX2FuaW1hdGVTY3JvbGwodGltZSwgZW5kcG9pbnQsIGRpcmVjdGlvbik7DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0NCiAgfV0pOw0KDQogIHJldHVybiBMaXN0Ow0KfSgpOw0KDQpleHBvcnRzLmRlZmF1bHQgPSBMaXN0Ow0KDQovKioqLyB9KSwNCi8qIDg3ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCg0KdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7DQoNCnZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KG9iamVjdCwgcHJvcGVydHksIHJlY2VpdmVyKSB7IGlmIChvYmplY3QgPT09IG51bGwpIG9iamVjdCA9IEZ1bmN0aW9uLnByb3RvdHlwZTsgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgcHJvcGVydHkpOyBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7IHZhciBwYXJlbnQgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsgaWYgKHBhcmVudCA9PT0gbnVsbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IGVsc2UgeyByZXR1cm4gZ2V0KHBhcmVudCwgcHJvcGVydHksIHJlY2VpdmVyKTsgfSB9IGVsc2UgaWYgKCJ2YWx1ZSIgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH07DQoNCnZhciBfd3JhcHBlZEVsZW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM1KTsNCg0KdmFyIF93cmFwcGVkRWxlbWVudDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF93cmFwcGVkRWxlbWVudCk7DQoNCnZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOw0KDQpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQ0KDQpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0NCg0KZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoIXNlbGYpIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSA/IGNhbGwgOiBzZWxmOyB9DQoNCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9DQoNCnZhciBXcmFwcGVkSW5wdXQgPSBmdW5jdGlvbiAoX1dyYXBwZWRFbGVtZW50KSB7DQogIF9pbmhlcml0cyhXcmFwcGVkSW5wdXQsIF9XcmFwcGVkRWxlbWVudCk7DQoNCiAgZnVuY3Rpb24gV3JhcHBlZElucHV0KF9yZWYpIHsNCiAgICB2YXIgZWxlbWVudCA9IF9yZWYuZWxlbWVudCwNCiAgICAgICAgY2xhc3NOYW1lcyA9IF9yZWYuY2xhc3NOYW1lcywNCiAgICAgICAgZGVsaW1pdGVyID0gX3JlZi5kZWxpbWl0ZXI7DQoNCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgV3JhcHBlZElucHV0KTsNCg0KICAgIHZhciBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIChXcmFwcGVkSW5wdXQuX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihXcmFwcGVkSW5wdXQpKS5jYWxsKHRoaXMsIHsgZWxlbWVudDogZWxlbWVudCwgY2xhc3NOYW1lczogY2xhc3NOYW1lcyB9KSk7DQoNCiAgICBfdGhpcy5kZWxpbWl0ZXIgPSBkZWxpbWl0ZXI7DQogICAgcmV0dXJuIF90aGlzOw0KICB9DQoNCiAgX2NyZWF0ZUNsYXNzKFdyYXBwZWRJbnB1dCwgW3sNCiAgICBrZXk6ICd2YWx1ZScsDQogICAgc2V0OiBmdW5jdGlvbiBzZXQoaXRlbXMpIHsNCiAgICAgIHZhciBpdGVtc0ZpbHRlcmVkID0gKDAsIF91dGlscy5yZWR1Y2VUb1ZhbHVlcykoaXRlbXMpOw0KICAgICAgdmFyIGl0ZW1zRmlsdGVyZWRTdHJpbmcgPSBpdGVtc0ZpbHRlcmVkLmpvaW4odGhpcy5kZWxpbWl0ZXIpOw0KDQogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCd2YWx1ZScsIGl0ZW1zRmlsdGVyZWRTdHJpbmcpOw0KICAgICAgdGhpcy5lbGVtZW50LnZhbHVlID0gaXRlbXNGaWx0ZXJlZFN0cmluZzsNCiAgICB9DQoNCiAgICAvLyBAdG9kbyBmaWd1cmUgb3V0IHdoeSB3ZSBuZWVkIHRoaXM/IFBlcmhhcHMgYSBiYWJlbCBpc3N1ZQ0KICAgICwNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiBfZ2V0KFdyYXBwZWRJbnB1dC5wcm90b3R5cGUuX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihXcmFwcGVkSW5wdXQucHJvdG90eXBlKSwgJ3ZhbHVlJywgdGhpcyk7DQogICAgfQ0KICB9XSk7DQoNCiAgcmV0dXJuIFdyYXBwZWRJbnB1dDsNCn0oX3dyYXBwZWRFbGVtZW50Mi5kZWZhdWx0KTsNCg0KZXhwb3J0cy5kZWZhdWx0ID0gV3JhcHBlZElucHV0Ow0KDQovKioqLyB9KSwNCi8qIDg4ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCg0KdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7DQoNCnZhciBfd3JhcHBlZEVsZW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM1KTsNCg0KdmFyIF93cmFwcGVkRWxlbWVudDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF93cmFwcGVkRWxlbWVudCk7DQoNCnZhciBfdGVtcGxhdGVzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNik7DQoNCnZhciBfdGVtcGxhdGVzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3RlbXBsYXRlcyk7DQoNCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9DQoNCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQ0KDQpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmICghc2VsZikgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpID8gY2FsbCA6IHNlbGY7IH0NCg0KZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0NCg0KdmFyIFdyYXBwZWRTZWxlY3QgPSBmdW5jdGlvbiAoX1dyYXBwZWRFbGVtZW50KSB7DQogIF9pbmhlcml0cyhXcmFwcGVkU2VsZWN0LCBfV3JhcHBlZEVsZW1lbnQpOw0KDQogIGZ1bmN0aW9uIFdyYXBwZWRTZWxlY3QoX3JlZikgew0KICAgIHZhciBlbGVtZW50ID0gX3JlZi5lbGVtZW50LA0KICAgICAgICBjbGFzc05hbWVzID0gX3JlZi5jbGFzc05hbWVzOw0KDQogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFdyYXBwZWRTZWxlY3QpOw0KDQogICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIChXcmFwcGVkU2VsZWN0Ll9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoV3JhcHBlZFNlbGVjdCkpLmNhbGwodGhpcywgeyBlbGVtZW50OiBlbGVtZW50LCBjbGFzc05hbWVzOiBjbGFzc05hbWVzIH0pKTsNCiAgfQ0KDQogIF9jcmVhdGVDbGFzcyhXcmFwcGVkU2VsZWN0LCBbew0KICAgIGtleTogJ2FwcGVuZERvY0ZyYWdtZW50JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gYXBwZW5kRG9jRnJhZ21lbnQoZnJhZ21lbnQpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5pbm5lckhUTUwgPSAnJzsNCiAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmRDaGlsZChmcmFnbWVudCk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAncGxhY2Vob2xkZXJPcHRpb24nLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdvcHRpb25bcGxhY2Vob2xkZXJdJyk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnb3B0aW9uR3JvdXBzJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnT1BUR1JPVVAnKSk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnb3B0aW9ucycsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmVsZW1lbnQub3B0aW9ucyk7DQogICAgfSwNCiAgICBzZXQ6IGZ1bmN0aW9uIHNldChvcHRpb25zKSB7DQogICAgICB2YXIgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7DQogICAgICB2YXIgYWRkT3B0aW9uVG9GcmFnbWVudCA9IGZ1bmN0aW9uIGFkZE9wdGlvblRvRnJhZ21lbnQoZGF0YSkgew0KICAgICAgICAvLyBDcmVhdGUgYSBzdGFuZGFyZCBzZWxlY3Qgb3B0aW9uDQogICAgICAgIHZhciB0ZW1wbGF0ZSA9IF90ZW1wbGF0ZXMyLmRlZmF1bHQub3B0aW9uKGRhdGEpOw0KICAgICAgICAvLyBBcHBlbmQgaXQgdG8gZnJhZ21lbnQNCiAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQodGVtcGxhdGUpOw0KICAgICAgfTsNCg0KICAgICAgLy8gQWRkIGVhY2ggbGlzdCBpdGVtIHRvIGxpc3QNCiAgICAgIG9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAob3B0aW9uRGF0YSkgew0KICAgICAgICByZXR1cm4gYWRkT3B0aW9uVG9GcmFnbWVudChvcHRpb25EYXRhKTsNCiAgICAgIH0pOw0KDQogICAgICB0aGlzLmFwcGVuZERvY0ZyYWdtZW50KGZyYWdtZW50KTsNCiAgICB9DQogIH1dKTsNCg0KICByZXR1cm4gV3JhcHBlZFNlbGVjdDsNCn0oX3dyYXBwZWRFbGVtZW50Mi5kZWZhdWx0KTsNCg0KZXhwb3J0cy5kZWZhdWx0ID0gV3JhcHBlZFNlbGVjdDsNCg0KLyoqKi8gfSksDQovKiA4OSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgX19XRUJQQUNLX0FNRF9ERUZJTkVfQVJSQVlfXywgX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX187LyohDQogIENvcHlyaWdodCAoYykgMjAxNiBKZWQgV2F0c29uLg0KICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UgKE1JVCksIHNlZQ0KICBodHRwOi8vamVkd2F0c29uLmdpdGh1Yi5pby9jbGFzc25hbWVzDQoqLw0KLyogZ2xvYmFsIGRlZmluZSAqLw0KDQooZnVuY3Rpb24gKCkgew0KCSd1c2Ugc3RyaWN0JzsNCg0KCXZhciBoYXNPd24gPSB7fS5oYXNPd25Qcm9wZXJ0eTsNCg0KCWZ1bmN0aW9uIGNsYXNzTmFtZXMgKCkgew0KCQl2YXIgY2xhc3NlcyA9IFtdOw0KDQoJCWZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7DQoJCQl2YXIgYXJnID0gYXJndW1lbnRzW2ldOw0KCQkJaWYgKCFhcmcpIGNvbnRpbnVlOw0KDQoJCQl2YXIgYXJnVHlwZSA9IHR5cGVvZiBhcmc7DQoNCgkJCWlmIChhcmdUeXBlID09PSAnc3RyaW5nJyB8fCBhcmdUeXBlID09PSAnbnVtYmVyJykgew0KCQkJCWNsYXNzZXMucHVzaChhcmcpOw0KCQkJfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGFyZykpIHsNCgkJCQljbGFzc2VzLnB1c2goY2xhc3NOYW1lcy5hcHBseShudWxsLCBhcmcpKTsNCgkJCX0gZWxzZSBpZiAoYXJnVHlwZSA9PT0gJ29iamVjdCcpIHsNCgkJCQlmb3IgKHZhciBrZXkgaW4gYXJnKSB7DQoJCQkJCWlmIChoYXNPd24uY2FsbChhcmcsIGtleSkgJiYgYXJnW2tleV0pIHsNCgkJCQkJCWNsYXNzZXMucHVzaChrZXkpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCgkJcmV0dXJuIGNsYXNzZXMuam9pbignICcpOw0KCX0NCg0KCWlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgew0KCQltb2R1bGUuZXhwb3J0cyA9IGNsYXNzTmFtZXM7DQoJfSBlbHNlIGlmICh0cnVlKSB7DQoJCS8vIHJlZ2lzdGVyIGFzICdjbGFzc25hbWVzJywgY29uc2lzdGVudCB3aXRoIG5wbSBwYWNrYWdlIG5hbWUNCgkJIShfX1dFQlBBQ0tfQU1EX0RFRklORV9BUlJBWV9fID0gW10sIF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fID0gKGZ1bmN0aW9uICgpIHsNCgkJCXJldHVybiBjbGFzc05hbWVzOw0KCQl9KS5hcHBseShleHBvcnRzLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9BUlJBWV9fKSwNCgkJCQlfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXyAhPT0gdW5kZWZpbmVkICYmIChtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fKSk7DQoJfSBlbHNlIHsNCgkJd2luZG93LmNsYXNzTmFtZXMgPSBjbGFzc05hbWVzOw0KCX0NCn0oKSk7DQoNCg0KLyoqKi8gfSksDQovKiA5MCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQpleHBvcnRzLmNsZWFyQ2hvaWNlcyA9IGV4cG9ydHMuYWN0aXZhdGVDaG9pY2VzID0gZXhwb3J0cy5maWx0ZXJDaG9pY2VzID0gZXhwb3J0cy5hZGRDaG9pY2UgPSB1bmRlZmluZWQ7DQoNCnZhciBfY29uc3RhbnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsNCg0KdmFyIGFkZENob2ljZSA9IGV4cG9ydHMuYWRkQ2hvaWNlID0gZnVuY3Rpb24gYWRkQ2hvaWNlKF9yZWYpIHsNCiAgdmFyIHZhbHVlID0gX3JlZi52YWx1ZSwNCiAgICAgIGxhYmVsID0gX3JlZi5sYWJlbCwNCiAgICAgIGlkID0gX3JlZi5pZCwNCiAgICAgIGdyb3VwSWQgPSBfcmVmLmdyb3VwSWQsDQogICAgICBkaXNhYmxlZCA9IF9yZWYuZGlzYWJsZWQsDQogICAgICBlbGVtZW50SWQgPSBfcmVmLmVsZW1lbnRJZCwNCiAgICAgIGN1c3RvbVByb3BlcnRpZXMgPSBfcmVmLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICBwbGFjZWhvbGRlciA9IF9yZWYucGxhY2Vob2xkZXIsDQogICAgICBrZXlDb2RlID0gX3JlZi5rZXlDb2RlOw0KICByZXR1cm4gew0KICAgIHR5cGU6IF9jb25zdGFudHMuQUNUSU9OX1RZUEVTLkFERF9DSE9JQ0UsDQogICAgdmFsdWU6IHZhbHVlLA0KICAgIGxhYmVsOiBsYWJlbCwNCiAgICBpZDogaWQsDQogICAgZ3JvdXBJZDogZ3JvdXBJZCwNCiAgICBkaXNhYmxlZDogZGlzYWJsZWQsDQogICAgZWxlbWVudElkOiBlbGVtZW50SWQsDQogICAgY3VzdG9tUHJvcGVydGllczogY3VzdG9tUHJvcGVydGllcywNCiAgICBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXIsDQogICAga2V5Q29kZToga2V5Q29kZQ0KICB9Ow0KfTsNCg0KdmFyIGZpbHRlckNob2ljZXMgPSBleHBvcnRzLmZpbHRlckNob2ljZXMgPSBmdW5jdGlvbiBmaWx0ZXJDaG9pY2VzKHJlc3VsdHMpIHsNCiAgcmV0dXJuIHsNCiAgICB0eXBlOiBfY29uc3RhbnRzLkFDVElPTl9UWVBFUy5GSUxURVJfQ0hPSUNFUywNCiAgICByZXN1bHRzOiByZXN1bHRzDQogIH07DQp9Ow0KDQp2YXIgYWN0aXZhdGVDaG9pY2VzID0gZXhwb3J0cy5hY3RpdmF0ZUNob2ljZXMgPSBmdW5jdGlvbiBhY3RpdmF0ZUNob2ljZXMoKSB7DQogIHZhciBhY3RpdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHRydWU7DQogIHJldHVybiB7DQogICAgdHlwZTogX2NvbnN0YW50cy5BQ1RJT05fVFlQRVMuQUNUSVZBVEVfQ0hPSUNFUywNCiAgICBhY3RpdmU6IGFjdGl2ZQ0KICB9Ow0KfTsNCg0KdmFyIGNsZWFyQ2hvaWNlcyA9IGV4cG9ydHMuY2xlYXJDaG9pY2VzID0gZnVuY3Rpb24gY2xlYXJDaG9pY2VzKCkgew0KICByZXR1cm4gew0KICAgIHR5cGU6IF9jb25zdGFudHMuQUNUSU9OX1RZUEVTLkNMRUFSX0NIT0lDRVMNCiAgfTsNCn07DQoNCi8qKiovIH0pLA0KLyogOTEgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KZXhwb3J0cy5oaWdobGlnaHRJdGVtID0gZXhwb3J0cy5yZW1vdmVJdGVtID0gZXhwb3J0cy5hZGRJdGVtID0gdW5kZWZpbmVkOw0KDQp2YXIgX2NvbnN0YW50cyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7DQoNCnZhciBhZGRJdGVtID0gZXhwb3J0cy5hZGRJdGVtID0gZnVuY3Rpb24gYWRkSXRlbShfcmVmKSB7DQogIHZhciB2YWx1ZSA9IF9yZWYudmFsdWUsDQogICAgICBsYWJlbCA9IF9yZWYubGFiZWwsDQogICAgICBpZCA9IF9yZWYuaWQsDQogICAgICBjaG9pY2VJZCA9IF9yZWYuY2hvaWNlSWQsDQogICAgICBncm91cElkID0gX3JlZi5ncm91cElkLA0KICAgICAgY3VzdG9tUHJvcGVydGllcyA9IF9yZWYuY3VzdG9tUHJvcGVydGllcywNCiAgICAgIHBsYWNlaG9sZGVyID0gX3JlZi5wbGFjZWhvbGRlciwNCiAgICAgIGtleUNvZGUgPSBfcmVmLmtleUNvZGU7DQogIHJldHVybiB7DQogICAgdHlwZTogX2NvbnN0YW50cy5BQ1RJT05fVFlQRVMuQUREX0lURU0sDQogICAgdmFsdWU6IHZhbHVlLA0KICAgIGxhYmVsOiBsYWJlbCwNCiAgICBpZDogaWQsDQogICAgY2hvaWNlSWQ6IGNob2ljZUlkLA0KICAgIGdyb3VwSWQ6IGdyb3VwSWQsDQogICAgY3VzdG9tUHJvcGVydGllczogY3VzdG9tUHJvcGVydGllcywNCiAgICBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXIsDQogICAga2V5Q29kZToga2V5Q29kZQ0KICB9Ow0KfTsNCg0KdmFyIHJlbW92ZUl0ZW0gPSBleHBvcnRzLnJlbW92ZUl0ZW0gPSBmdW5jdGlvbiByZW1vdmVJdGVtKGlkLCBjaG9pY2VJZCkgew0KICByZXR1cm4gew0KICAgIHR5cGU6IF9jb25zdGFudHMuQUNUSU9OX1RZUEVTLlJFTU9WRV9JVEVNLA0KICAgIGlkOiBpZCwNCiAgICBjaG9pY2VJZDogY2hvaWNlSWQNCiAgfTsNCn07DQoNCnZhciBoaWdobGlnaHRJdGVtID0gZXhwb3J0cy5oaWdobGlnaHRJdGVtID0gZnVuY3Rpb24gaGlnaGxpZ2h0SXRlbShpZCwgaGlnaGxpZ2h0ZWQpIHsNCiAgcmV0dXJuIHsNCiAgICB0eXBlOiBfY29uc3RhbnRzLkFDVElPTl9UWVBFUy5ISUdITElHSFRfSVRFTSwNCiAgICBpZDogaWQsDQogICAgaGlnaGxpZ2h0ZWQ6IGhpZ2hsaWdodGVkDQogIH07DQp9Ow0KDQovKioqLyB9KSwNCi8qIDkyICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCmV4cG9ydHMuYWRkR3JvdXAgPSB1bmRlZmluZWQ7DQoNCnZhciBfY29uc3RhbnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsNCg0KLyogZXNsaW50LWRpc2FibGUgaW1wb3J0L3ByZWZlci1kZWZhdWx0LWV4cG9ydCAqLw0KdmFyIGFkZEdyb3VwID0gZXhwb3J0cy5hZGRHcm91cCA9IGZ1bmN0aW9uIGFkZEdyb3VwKHZhbHVlLCBpZCwgYWN0aXZlLCBkaXNhYmxlZCkgew0KICByZXR1cm4gew0KICAgIHR5cGU6IF9jb25zdGFudHMuQUNUSU9OX1RZUEVTLkFERF9HUk9VUCwNCiAgICB2YWx1ZTogdmFsdWUsDQogICAgaWQ6IGlkLA0KICAgIGFjdGl2ZTogYWN0aXZlLA0KICAgIGRpc2FibGVkOiBkaXNhYmxlZA0KICB9Ow0KfTsNCg0KLyoqKi8gfSksDQovKiA5MyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQp2YXIgY2xlYXJBbGwgPSBleHBvcnRzLmNsZWFyQWxsID0gZnVuY3Rpb24gY2xlYXJBbGwoKSB7DQogIHJldHVybiB7DQogICAgdHlwZTogJ0NMRUFSX0FMTCcNCiAgfTsNCn07DQoNCnZhciByZXNldFRvID0gZXhwb3J0cy5yZXNldFRvID0gZnVuY3Rpb24gcmVzZXRUbyhzdGF0ZSkgew0KICByZXR1cm4gew0KICAgIHR5cGU6ICdSRVNFVF9UTycsDQogICAgc3RhdGU6IHN0YXRlDQogIH07DQp9Ow0KDQovKioqLyB9KQ0KLyoqKioqKi8gXSk7DQp9KTsNCi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNob2ljZXMuanMubWFwDQogIDwvc2NyaXB0Pg0KDQogIDwhLS1UcmF2ZWwgTGVhZGVycyBDb250ZW50LS0+DQogIDwhLS08c2NyaXB0IHNyYz0iamF2YXNjcmlwdHMvY29tcGxlYXQtdmVuZG9yLWRlYnVnLXBhcnNlci5qcyI+PC9zY3JpcHQ+LS0+DQogIDxzY3JpcHQ+LyoqKg0KKiBDb21wbGVhdCBWZW5kb3IgRGVidWcgcGFyc2VyIGZvciBKYXZhU2NyaXB0DQoqDQoqIENvcHlyaWdodCAoYykgMjAxNCBUb2RkIEhhbWJsZXkgKE1JVCBMaWNlbnNlKS4NCioNCiovDQogICAgLypqc2hpbnQNCiAgICAgIGxheGNvbW1hOnRydWUNCiAgICAgIGxheGJyZWFrOnRydWUNCiAgICAgIGVxbnVsbDp0cnVlDQogICAgICBsb29wZnVuYzp0cnVlDQogICAgICBzdWI6dHJ1ZQ0KICAgICovDQogICAgOyAoZnVuY3Rpb24gKCkgew0KICAgICAgInVzZSBzdHJpY3QiOw0KDQogICAgICAvLyBvbmx5IHJ1biB3aGVuIHRoZSBzdWJzdHIoKSBmdW5jdGlvbiBpcyBicm9rZW4NCiAgICAgIGlmICgnYWInLnN1YnN0cigtMSkgIT0gJ2InKSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiAgR2V0IHRoZSBzdWJzdHJpbmcgb2YgYSBzdHJpbmcNCiAgICAgICAgICogIEBwYXJhbSAge2ludGVnZXJ9ICBzdGFydCAgIHdoZXJlIHRvIHN0YXJ0IHRoZSBzdWJzdHJpbmcNCiAgICAgICAgICogIEBwYXJhbSAge2ludGVnZXJ9ICBsZW5ndGggIGhvdyBtYW55IGNoYXJhY3RlcnMgdG8gcmV0dXJuDQogICAgICAgICAqICBAcmV0dXJuIHtzdHJpbmd9DQogICAgICAgICAqLw0KICAgICAgICBTdHJpbmcucHJvdG90eXBlLnN1YnN0ciA9IGZ1bmN0aW9uIChzdWJzdHIpIHsNCiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHN0YXJ0LCBsZW5ndGgpIHsNCiAgICAgICAgICAgIC8vIGRpZCB3ZSBnZXQgYSBuZWdhdGl2ZSBzdGFydCwgY2FsY3VsYXRlIGhvdyBtdWNoIGl0IGlzDQogICAgICAgICAgICAvLyBmcm9tIHRoZSBiZWdpbm5pbmcgb2YgdGhlIHN0cmluZw0KICAgICAgICAgICAgaWYgKHN0YXJ0IDwgMCkgew0KICAgICAgICAgICAgICBzdGFydCA9IHRoaXMubGVuZ3RoICsgc3RhcnQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIGNhbGwgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uDQogICAgICAgICAgICByZXR1cm4gc3Vic3RyLmNhbGwodGhpcywgc3RhcnQsIGxlbmd0aCk7DQogICAgICAgICAgfQ0KICAgICAgICB9KFN0cmluZy5wcm90b3R5cGUuc3Vic3RyKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gcmlnaHRBbGlnblplcm9QYWRkaW5nKGlucHV0U3RyaW5nKSB7DQogICAgICAgIHJldHVybiAoJzAwJyArIGlucHV0U3RyaW5nKS5zdWJzdHIoLTIpOw0KICAgICAgfQ0KDQogICAgICAvLyBsb2cgY2F0ZWdvcnkNCiAgICAgIC8vIGxvZyBsZXZlbA0KICAgICAgLy8gbG9nIGRhdGVUaW1lDQogICAgICAvLyBsb2cgdGV4dA0KICAgICAgZnVuY3Rpb24gcGFyc2VEZWJ1Z0xvZyhsb2dUZXh0KSB7DQogICAgICAgIHZhciBsb2dMaW5lcyA9IGxvZ1RleHQuc3BsaXQoJ1xuJyk7DQogICAgICAgIHZhciBsb2dFbnRyaWVzID0gW107DQogICAgICAgIHZhciBsb2dFbnRyeU51bWJlciA9IC0xOw0KICAgICAgICAvLyBleGFtcGxlIGxvZyBlbnRyaWVzOg0KICAgICAgICAvLyBbVyMzNzk5ICg2MCkgV1JLMV0gLS0ge1JlcXVlc3R9IC0tIDxEZWJ1Zz4gLS0gMTEvMjEvMTQgMTU6Mzc6NTcuOTE0IC0tIFEvN1ZBLzI2KkM3DQogICAgICAgIC8vIHtsb2cgaW5mb30gLS0gPGxvZyBsZXZlbD4gLS0gbG9nIHRpbWUgLS0gbG9nIHRleHQNCiAgICAgICAgLy8ge0luZm9ybWF0aW9uQ2xhc3NpZmljYXRpb259IC0tIDxJbmZvPiAtLSAxMi8yNi8xMyAyMzo1MTowNC44NzAgLS0gVGhpcyBMb2cgQ29udGFpbnMgUHJpdmlsZWdlZCBJbmZvcm1hdGlvbi4NCiAgICAgICAgLy8gPGxvZyBsZXZlbD4gLS0gbG9nIHRpbWUgLS0gbG9nIHRleHQNCiAgICAgICAgLy8gPFN0YXR1cz4gLS0gMTIvMjYvMTMgMjM6NTE6MDYuMzIxIC0tIENvbm5lY3RlZC4NCiAgICAgICAgdmFyIGN1cnJlbnRXb3JrZmxvdyA9ICcnOw0KICAgICAgICB2YXIgY3VycmVudFByb2Nlc3MgPSAnJzsNCiAgICAgICAgdmFyIGN1cnJlbnRSb3V0aW5lID0gJyc7DQogICAgICAgIHZhciBjdXJyZW50TG9jYXRvciA9ICcnOw0KDQogICAgICAgIHZhciBsb2dFbnRyeVJlZ0V4ID0gL14oPzpbXFtdVyMoWzAtOV0rKSBbXChdKFswLTldKylbXCldIFtBLVpcZF0qP1dSSyhbMC05XSspW1xdXSAtLSApPyg/Oltce10oW15cfV0qKVtcfV0gLS0gKT8oPzpbXDxdKFtBLVphLXpdKylbXD5dIC0tICkoPzooWzAtOV17MSwyfSlcLyhbMC05XXsxLDJ9KVwvKFswLTldezJ9KSAoWzAtOV17MSwyfSk6KFswLTldezJ9KTooWzAtOV17Mn0pLihbMC05XXszfSkgLS0gKSguKikvOw0KICAgICAgICB2YXIgbG9nU2VwYXJhdG9yUmVnRXggPSAvXltcLV17MjB9KFtcZF0rKVwvKFtcZF0rKVwvKFtcZF0rKSAoW1xkXSspOihbXGRdKyk6KFtcZF0rKSAoW0FQXU0pIFtcKF1VVENbXCldW1wtXXsyMH0vOw0KICAgICAgICB2YXIgcm91dGluZU5hbWVSZWdFeCA9IC9Sb3V0aW5lIChbQS1aYS16MC05X10rKS87DQogICAgICAgIHZhciBuYW1lUmVnRXggPSAvIihbXiJdKykiLzsNCiAgICAgICAgZm9yICh2YXIgbGluZU51bWJlciA9IDA7IGxpbmVOdW1iZXIgPCBsb2dMaW5lcy5sZW5ndGg7IGxpbmVOdW1iZXIrKykgew0KICAgICAgICAgIGlmIChsb2dFbnRyeVJlZ0V4LnRlc3QobG9nTGluZXNbbGluZU51bWJlcl0pKSB7DQogICAgICAgICAgICBsb2dFbnRyeU51bWJlcisrOw0KICAgICAgICAgICAgdmFyIGxvZ01hdGNoID0gbG9nRW50cnlSZWdFeC5leGVjKGxvZ0xpbmVzW2xpbmVOdW1iZXJdKTsNCiAgICAgICAgICAgIHZhciBjdXJyZW50TG9nRW50cnkgPSBjdXJyZW50TG9nRW50cnkgPSB7DQogICAgICAgICAgICAgIGxpbmVOdW1iZXI6IGxpbmVOdW1iZXIgKyAxLA0KICAgICAgICAgICAgICB3b3JrZXI6IHBhcnNlSW50KGxvZ01hdGNoWzFdIHx8ICctMScpLA0KICAgICAgICAgICAgICBhZ2VuY3k6IHBhcnNlSW50KGxvZ01hdGNoWzJdIHx8ICctMScpLA0KICAgICAgICAgICAgICB3b3Jrc3RhdGlvbjogcGFyc2VJbnQobG9nTWF0Y2hbM10gfHwgJy0xJyksDQogICAgICAgICAgICAgIGNhdGVnb3J5OiBsb2dNYXRjaFs0XSB8fCAnJywNCiAgICAgICAgICAgICAgbGV2ZWw6IGxvZ01hdGNoWzVdLA0KICAgICAgICAgICAgICBkYXRlVGltZTogbmV3IERhdGUoRGF0ZS5VVEMocGFyc2VJbnQoJzIwJyArIGxvZ01hdGNoWzhdLCAxMCksIHBhcnNlSW50KGxvZ01hdGNoWzZdLCAxMCkgLSAxLCBwYXJzZUludChsb2dNYXRjaFs3XSwgMTApLCBwYXJzZUludChsb2dNYXRjaFs5XSwgMTApLCBwYXJzZUludChsb2dNYXRjaFsxMF0sIDEwKSwgcGFyc2VJbnQobG9nTWF0Y2hbMTFdLCAxMCksIHBhcnNlSW50KGxvZ01hdGNoWzEyXSwgMTApKSksDQogICAgICAgICAgICAgIGRhdGVUaW1lVGV4dDogJzIwJyArIGxvZ01hdGNoWzhdICsgJy0nICsgcmlnaHRBbGlnblplcm9QYWRkaW5nKGxvZ01hdGNoWzZdKSArICctJyArIHJpZ2h0QWxpZ25aZXJvUGFkZGluZyhsb2dNYXRjaFs3XSkgKyAnICcgKyByaWdodEFsaWduWmVyb1BhZGRpbmcobG9nTWF0Y2hbOV0pICsgJzonICsgbG9nTWF0Y2hbMTBdICsgJzonICsgbG9nTWF0Y2hbMTFdICsgJy4nICsgbG9nTWF0Y2hbMTJdLA0KICAgICAgICAgICAgICB0ZXh0OiBsb2dNYXRjaFsxM10ucmVwbGFjZSgvICAvZywgIiAmbmJzcDsiKS5yZXBsYWNlKC9cdXswMDg3fS9ndSwgIuKAoSIpLA0KICAgICAgICAgICAgICB3b3JrZmxvdzogY3VycmVudFdvcmtmbG93LA0KICAgICAgICAgICAgICBwcm9jZXNzOiBjdXJyZW50UHJvY2VzcywNCiAgICAgICAgICAgICAgcm91dGluZTogY3VycmVudFJvdXRpbmUsDQogICAgICAgICAgICAgIHBuckxvY2F0b3I6IGN1cnJlbnRMb2NhdG9yDQogICAgICAgICAgICB9DQogICAgICAgICAgICBsb2dFbnRyaWVzW2xvZ0VudHJ5TnVtYmVyXSA9IGN1cnJlbnRMb2dFbnRyeTsNCiAgICAgICAgICAgIHN3aXRjaCAoY3VycmVudExvZ0VudHJ5LmNhdGVnb3J5KSB7DQogICAgICAgICAgICAgIGNhc2UgJ1F1ZXVlUHJvY2Vzcyc6DQogICAgICAgICAgICAgICAgaWYgKG5hbWVSZWdFeC50ZXN0KGN1cnJlbnRMb2dFbnRyeS50ZXh0KSkgew0KICAgICAgICAgICAgICAgICAgdmFyIG5hbWVNYXRjaCA9IG5hbWVSZWdFeC5leGVjKGN1cnJlbnRMb2dFbnRyeS50ZXh0KTsNCiAgICAgICAgICAgICAgICAgIC8vIHNldCB3b3JrZmxvdw0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LndvcmtmbG93ID0gY3VycmVudFdvcmtmbG93ID0gbmFtZU1hdGNoWzFdOw0KICAgICAgICAgICAgICAgICAgLy8gY2xlYXIgcHJvY2VzcyBhbmQgcm91dGluZQ0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnByb2Nlc3MgPSBjdXJyZW50UHJvY2VzcyA9ICcnOw0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnJvdXRpbmUgPSBjdXJyZW50Um91dGluZSA9ICcnOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBpZiAoY3VycmVudExvZ0VudHJ5LnRleHQuaW5jbHVkZXMoJ1NpbXVsdGFuZW91c0NoYW5nZXNFeGNlcHRpb24nKSkgew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUXVldWVQcm9jZXNzIGVudHJ5IGNvbnRhaW5zIFNpbXVsdGFuZW91c0NoYW5nZXNFeGNlcHRpb24nKTsNCiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGFsZXJ0KCd3b3JrZmxvdyBuYW1lIG5vdCBmb3VuZDonICsgY3VycmVudExvZ0VudHJ5LnRleHQpOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgY2FzZSAnUHJvY2Vzc0V4ZWN1dGUnOg0KICAgICAgICAgICAgICAgIGlmIChuYW1lUmVnRXgudGVzdChjdXJyZW50TG9nRW50cnkudGV4dCkpIHsNCiAgICAgICAgICAgICAgICAgIHZhciBuYW1lTWF0Y2ggPSBuYW1lUmVnRXguZXhlYyhjdXJyZW50TG9nRW50cnkudGV4dCk7DQogICAgICAgICAgICAgICAgICAvLyBzZXQgcHJvY2Vzcw0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnByb2Nlc3MgPSBjdXJyZW50UHJvY2VzcyA9IG5hbWVNYXRjaFsxXTsNCiAgICAgICAgICAgICAgICAgIC8vIGNsZWFyIHJvdXRpbmUNCiAgICAgICAgICAgICAgICAgIGN1cnJlbnRMb2dFbnRyeS5yb3V0aW5lID0gY3VycmVudFJvdXRpbmUgPSAnJzsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgYWxlcnQoJ3Byb2Nlc3MgbmFtZSBub3QgZm91bmQ6JyArIGN1cnJlbnRMb2dFbnRyeS50ZXh0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgIGNhc2UgJ1BuclRlc3RzRXhlY3V0ZSc6DQogICAgICAgICAgICAgICAgLy8gcm91dGluZQ0KICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TG9nRW50cnkudGV4dCA9PT0gJ0FsbCByb3V0aW5lcyBmaW5pc2hlZC4nKSB7DQogICAgICAgICAgICAgICAgICAvLyBjbGVhcg0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnJvdXRpbmUgPSBjdXJyZW50Um91dGluZSA9ICcnOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBpZiAocm91dGluZU5hbWVSZWdFeC50ZXN0KGN1cnJlbnRMb2dFbnRyeS50ZXh0KSkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZU1hdGNoID0gcm91dGluZU5hbWVSZWdFeC5leGVjKGN1cnJlbnRMb2dFbnRyeS50ZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnJvdXRpbmUgPSBjdXJyZW50Um91dGluZSA9IG5hbWVNYXRjaFsxXTsNCiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmFtZVJlZ0V4LnRlc3QoY3VycmVudExvZ0VudHJ5LnRleHQpKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBuYW1lTWF0Y2ggPSBuYW1lUmVnRXguZXhlYyhjdXJyZW50TG9nRW50cnkudGV4dCk7DQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMb2dFbnRyeS5yb3V0aW5lID0gY3VycmVudFJvdXRpbmUgPSBuYW1lTWF0Y2hbMV07DQogICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBhbGVydCgncm91dGluZSBuYW1lIG5vdCBmb3VuZDonICsgY3VycmVudExvZ0VudHJ5LnRleHQpOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgY2FzZSAnJzoNCiAgICAgICAgICAgICAgICAvLyBjaGVjayBmb3IgbGV2ZWwgPSAnZGVidWcnIGFuZCBwcmVzZW5jZSBvZiAiZW5jb3VudGVyZWQiIGluIHRleHQNCiAgICAgICAgICAgICAgICBpZiAoKGN1cnJlbnRMb2dFbnRyeS5sZXZlbCA9PT0gJ0RlYnVnJykgJiYgKGN1cnJlbnRMb2dFbnRyeS50ZXh0LnN1YnN0cigwLCAxMSkgPT09ICdFbmNvdW50ZXJlZCcpKSB7DQogICAgICAgICAgICAgICAgICAvLyBzZXQgbG9jYXRvcg0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnBuckxvY2F0b3IgPSBjdXJyZW50TG9jYXRvciA9IGN1cnJlbnRMb2dFbnRyeS50ZXh0LnN1YnN0cigxMik7DQogICAgICAgICAgICAgICAgICAvLyBjbGVhciB3b3JrZmxvdywgcHJvY2VzcyBhbmQgcm91dGluZQ0KICAgICAgICAgICAgICAgICAgLy8gY3VycmVudExvZ0VudHJ5LndvcmtmbG93ID0gY3VycmVudFdvcmtmbG93ID0gJyc7DQogICAgICAgICAgICAgICAgICBjdXJyZW50TG9nRW50cnkucHJvY2VzcyA9IGN1cnJlbnRQcm9jZXNzID0gJyc7DQogICAgICAgICAgICAgICAgICBjdXJyZW50TG9nRW50cnkucm91dGluZSA9IGN1cnJlbnRSb3V0aW5lID0gJyc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgfSBlbHNlIGlmIChsb2dFbnRyeU51bWJlciA+IC0xKSB7DQogICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLTExLzIxLzIwMTQgMzozNzo1NyBQTSAoVVRDKS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICBpZiAobG9nU2VwYXJhdG9yUmVnRXgudGVzdChsb2dMaW5lc1tsaW5lTnVtYmVyXSkpIHsNCiAgICAgICAgICAgICAgY3VycmVudFdvcmtmbG93ID0gJyc7DQogICAgICAgICAgICAgIGN1cnJlbnRQcm9jZXNzID0gJyc7DQogICAgICAgICAgICAgIGN1cnJlbnRSb3V0aW5lID0gJyc7DQogICAgICAgICAgICAgIGN1cnJlbnRMb2NhdG9yID0gJyc7DQoNCiAgICAgICAgICAgICAgdmFyIGxvZ01hdGNoID0gbG9nU2VwYXJhdG9yUmVnRXguZXhlYyhsb2dMaW5lc1tsaW5lTnVtYmVyXSk7DQogICAgICAgICAgICAgIC8vXltcLV17MjB9KFtcZF0rKVwvKFtcZF0rKVwvKFtcZF0rKSAoW1xkXSspOihbXGRdKyk6KFtcZF0rKSAoW0FQXU0pIFtcKF1VVENbXCldW1wtXXsyMH0NCiAgICAgICAgICAgICAgbG9nRW50cnlOdW1iZXIrKzsNCiAgICAgICAgICAgICAgbG9nRW50cmllc1tsb2dFbnRyeU51bWJlcl0gPSB7DQogICAgICAgICAgICAgICAgbGluZU51bWJlcjogbGluZU51bWJlciArIDEsDQogICAgICAgICAgICAgICAgd29ya2VyOiAtMSwNCiAgICAgICAgICAgICAgICBhZ2VuY3k6IC0xLA0KICAgICAgICAgICAgICAgIHdvcmtzdGF0aW9uOiAtMSwNCiAgICAgICAgICAgICAgICBjYXRlZ29yeTogJ1NlcGFyYXRvcicsDQogICAgICAgICAgICAgICAgbGV2ZWw6ICcnLA0KICAgICAgICAgICAgICAgIGRhdGVUaW1lOiBuZXcgRGF0ZShEYXRlLlVUQyhwYXJzZUludChsb2dNYXRjaFszXSwgMTApLCBwYXJzZUludChsb2dNYXRjaFsxXSwgMTApIC0gMSwgcGFyc2VJbnQobG9nTWF0Y2hbMl0sIDEwKSwgKHBhcnNlSW50KGxvZ01hdGNoWzRdLCAxMCkgKyAoKGxvZ01hdGNoWzddID09ICdQTScpID8gMTIgOiAwKSksIHBhcnNlSW50KGxvZ01hdGNoWzVdLCAxMCksIHBhcnNlSW50KGxvZ01hdGNoWzZdLCAxMCksIDApKSwNCiAgICAgICAgICAgICAgICBkYXRlVGltZVRleHQ6IGxvZ01hdGNoWzNdICsgJy0nICsgcmlnaHRBbGlnblplcm9QYWRkaW5nKGxvZ01hdGNoWzFdKSArICctJyArIHJpZ2h0QWxpZ25aZXJvUGFkZGluZyhsb2dNYXRjaFsyXSkgKyAnICcgKyByaWdodEFsaWduWmVyb1BhZGRpbmcoKHBhcnNlSW50KGxvZ01hdGNoWzRdLCAxMCkgKyAoKGxvZ01hdGNoWzddID09ICdQTScpID8gMTIgOiAwKSkudG9TdHJpbmcoKSkgKyAnOicgKyBsb2dNYXRjaFs1XSArICc6JyArIGxvZ01hdGNoWzZdICsgJy4wMDAnLA0KICAgICAgICAgICAgICAgIHRleHQ6IGxvZ0xpbmVzW2xpbmVOdW1iZXJdLA0KICAgICAgICAgICAgICAgIHdvcmtmbG93OiBjdXJyZW50V29ya2Zsb3csDQogICAgICAgICAgICAgICAgcHJvY2VzczogY3VycmVudFByb2Nlc3MsDQogICAgICAgICAgICAgICAgcm91dGluZTogY3VycmVudFJvdXRpbmUsDQogICAgICAgICAgICAgICAgcG5yTG9jYXRvcjogY3VycmVudExvY2F0b3INCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgbG9nRW50cmllc1tsb2dFbnRyeU51bWJlcl0udGV4dCArPSAnXG4nICsgbG9nTGluZXNbbGluZU51bWJlcl07DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBsb2dFbnRyaWVzOw0KICAgICAgfQ0KDQogICAgICB2YXIgY29tcGxlYXRWZW5kb3JEZWJ1ZyA9IHsNCiAgICAgICAgcGFyc2VMb2c6IHBhcnNlRGVidWdMb2cNCiAgICAgIH07DQoNCiAgICAgIC8qIGV4cG9zZWQgKi8NCiAgICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgew0KICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGNvbXBsZWF0VmVuZG9yRGVidWc7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLmNvbXBsZWF0VmVuZG9yRGVidWcgPSBjb21wbGVhdFZlbmRvckRlYnVnOw0KICAgICAgfQ0KDQogICAgfSkuY2FsbChmdW5jdGlvbiAoKSB7DQogICAgICByZXR1cm4gdGhpcyB8fCAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiBnbG9iYWwpOw0KICAgIH0oKSk7DQogIDwvc2NyaXB0Pg0KICA8IS0tPHNjcmlwdCBzcmM9ImphdmFzY3JpcHRzL3dzcGFuLWRpci1wYXJzZXIuanMiPjwvc2NyaXB0Pi0tPg0KICA8c2NyaXB0Pi8qKioNCiogRElSIHBhcnNlciBmb3IgSmF2YVNjcmlwdA0KKg0KKiBDb3B5cmlnaHQgKGMpIDIwMTQgVG9kZCBIYW1ibGV5IChNSVQgTGljZW5zZSkuDQoqDQoqLw0KICAgIC8qanNoaW50DQogICAgICBsYXhjb21tYTp0cnVlDQogICAgICBsYXhicmVhazp0cnVlDQogICAgICBlcW51bGw6dHJ1ZQ0KICAgICAgbG9vcGZ1bmM6dHJ1ZQ0KICAgICAgc3ViOnRydWUNCiAgICAqLw0KICAgIDsgKGZ1bmN0aW9uICgpIHsNCiAgICAgICJ1c2Ugc3RyaWN0IjsNCg0KICAgICAgZnVuY3Rpb24gcmliYm9uKGZlZWQpIHsNCiAgICAgICAgdmFyIF9zbG90ID0gbnVsbDsNCiAgICAgICAgdmFyIG9yZyA9IGZlZWQgKyAnJzsNCiAgICAgICAgdmFyIHBvcyA9IDA7DQoNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICBzYXZlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBfc2xvdCA9IHBvczsNCiAgICAgICAgICB9DQogICAgICAgICAgLCBsb2FkOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBwb3MgPSBfc2xvdDsNCiAgICAgICAgICAgIGZlZWQgPSBvcmcuc2xpY2UocG9zKTsNCiAgICAgICAgICB9DQogICAgICAgICAgLCBhZHZhbmNlOiBmdW5jdGlvbiAobikgew0KICAgICAgICAgICAgcG9zICs9ICh0eXBlb2YgbiA9PT0gJ3N0cmluZycpID8gbi5sZW5ndGggOiBuOw0KICAgICAgICAgICAgaWYgKHBvcyA+IDApIHsNCiAgICAgICAgICAgICAgcmV0dXJuIChmZWVkID0gb3JnLnNsaWNlKHBvcykpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGZlZWQgPSAnJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgLCByZWFkOiBmdW5jdGlvbiAobikgew0KICAgICAgICAgICAgdmFyIGluZm8gPSBmZWVkLnN1YnN0cmluZygwLCBuKTsNCiAgICAgICAgICAgIHRoaXMuYWR2YW5jZShuKTsNCiAgICAgICAgICAgIHJldHVybiBpbmZvOw0KICAgICAgICAgIH0NCiAgICAgICAgICAsIGxvb2tiZWhpbmQ6IGZ1bmN0aW9uIChuY2hhcnMpIHsNCiAgICAgICAgICAgIG5jaGFycyA9IG5jaGFycyA9PSBudWxsID8gMSA6IG5jaGFyczsNCiAgICAgICAgICAgIHJldHVybiBvcmcuc2xpY2UocG9zIC0gbmNoYXJzLCBwb3MpOw0KICAgICAgICAgIH0NCiAgICAgICAgICAsIHN0YXJ0c1dpdGg6IGZ1bmN0aW9uIChzKSB7DQogICAgICAgICAgICByZXR1cm4gZmVlZC5zdWJzdHJpbmcoMCwgcy5sZW5ndGgpID09PSBzOw0KICAgICAgICAgIH0NCiAgICAgICAgICAsIHZhbHVlT2Y6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHJldHVybiBmZWVkOw0KICAgICAgICAgIH0NCiAgICAgICAgICAsIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICByZXR1cm4gZmVlZDsNCiAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICB9DQoNCiAgICAgIC8qKioqKioqKiogdHJlZSAqKioqKioqKioqKioqKiovDQogICAgICAvL2h0dHBzOi8vZ2l0aHViLmNvbS9zcGlrZWJyZWhtL2FyYm9yZWFsDQoNCiAgICAgIGZ1bmN0aW9uIGluY2x1ZGUoYXJyYXksIGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIGFycmF5LmluZGV4T2YoaXRlbSkgPiAtMTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gX3RyYXZlcnNlRG93bihjb250ZXh0LCBpdGVyYXRvcikgew0KICAgICAgICB2YXIgZG9Db250aW51ZSA9IHRydWU7DQoNCiAgICAgICAgKGZ1bmN0aW9uIHdhbGtEb3duKG5vZGUpIHsNCiAgICAgICAgICB2YXIgaSwgbmV3Q29udGV4dDsNCg0KICAgICAgICAgIGlmICghZG9Db250aW51ZSkgcmV0dXJuOw0KDQogICAgICAgICAgaWYgKGl0ZXJhdG9yKG5vZGUpID09PSBmYWxzZSkgew0KICAgICAgICAgICAgLy9icmVhayB0aGUgdHJhdmVyc2FsIGxvb3AgaWYgdGhlIGl0ZXJhdG9yIHJldHVybnMgYSBmYWxzeSB2YWx1ZQ0KICAgICAgICAgICAgZG9Db250aW51ZSA9IGZhbHNlOw0KICAgICAgICAgIH0NCiAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBub2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgIG5ld0NvbnRleHQgPSBub2RlLmNoaWxkcmVuW2ldOw0KICAgICAgICAgICAgICB3YWxrRG93bihuZXdDb250ZXh0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0pKGNvbnRleHQpOw0KICAgICAgfQ0KDQoNCiAgICAgIGZ1bmN0aW9uIF90cmF2ZXJzZVVwKGNvbnRleHQsIGl0ZXJhdG9yKSB7DQogICAgICAgIHZhciBpLCBub2RlLCBkb0NvbnRpbnVlOw0KDQogICAgICAgIHdoaWxlIChjb250ZXh0KSB7DQogICAgICAgICAgaWYgKGl0ZXJhdG9yKGNvbnRleHQpID09PSBmYWxzZSkgcmV0dXJuOw0KDQogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvbnRleHQuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIG5vZGUgPSBjb250ZXh0LmNoaWxkcmVuW2ldOw0KICAgICAgICAgICAgaWYgKGl0ZXJhdG9yKG5vZGUpID09PSBmYWxzZSkgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICBjb250ZXh0ID0gY29udGV4dC5wYXJlbnQ7DQogICAgICAgIH0NCiAgICAgIH0NCg0KDQogICAgICBmdW5jdGlvbiBfdHJhdmVyc2UoY29udGV4dCwgaXRlcmF0b3IsIGNhbGxiYWNrKSB7DQogICAgICAgIHZhciB2aXNpdGVkID0gW10sDQogICAgICAgICAgY2FsbEl0ZXJhdG9yID0gZnVuY3Rpb24gKG5vZGUpIHsNCiAgICAgICAgICAgIHZhciBpZCA9IG5vZGUuaWQsDQogICAgICAgICAgICAgIHJldHVybmVkOw0KDQogICAgICAgICAgICBpZiAoIWluY2x1ZGUodmlzaXRlZCwgaWQpKSB7DQogICAgICAgICAgICAgIHJldHVybmVkID0gaXRlcmF0b3IuY2FsbChub2RlLCBub2RlKTsNCiAgICAgICAgICAgICAgdmlzaXRlZC5wdXNoKGlkKTsNCg0KICAgICAgICAgICAgICBpZiAocmV0dXJuZWQgPT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHJldHVybmVkOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfSwNCiAgICAgICAgICBpLCBub2RlOw0KDQogICAgICAgIGNhbGxiYWNrKGNvbnRleHQsIGNhbGxJdGVyYXRvcik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIF9yZW1vdmVDaGlsZChub2RlKSB7DQogICAgICAgIHZhciBwYXJlbnQgPSBub2RlLnBhcmVudCwNCiAgICAgICAgICBjaGlsZCwNCiAgICAgICAgICBpOw0KDQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXJlbnQuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICBjaGlsZCA9IHBhcmVudC5jaGlsZHJlbltpXTsNCg0KICAgICAgICAgIGlmIChjaGlsZCA9PT0gbm9kZSkgew0KICAgICAgICAgICAgcmV0dXJuIHBhcmVudC5jaGlsZHJlbi5zcGxpY2UoaSwgMSkuc2hpZnQoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gbm9kZUlkKHBhcmVudCwgc2VwYXJhdG9yKSB7DQogICAgICAgIHNlcGFyYXRvciA9IHNlcGFyYXRvciB8fCAnLyc7DQogICAgICAgIGlmIChwYXJlbnQpIHsNCiAgICAgICAgICByZXR1cm4gW3BhcmVudC5pZCwgcGFyZW50LmNoaWxkcmVuLmxlbmd0aF0uam9pbihzZXBhcmF0b3IpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIHJldHVybiAnMCc7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gRElSVHJlZShwYXJlbnQsIGRhdGEsIGlkKSB7DQogICAgICAgIHRoaXMuZGVwdGggPSBwYXJlbnQgPyBwYXJlbnQuZGVwdGggKyAxIDogMDsNCiAgICAgICAgdGhpcy5kYXRhID0gZGF0YSB8fCB7fTsNCiAgICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQgfHwgbnVsbDsNCiAgICAgICAgdGhpcy5pZCA9IGlkIHx8IG5vZGVJZChwYXJlbnQpOw0KICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107DQogICAgICB9DQoNCiAgICAgIERJUlRyZWUucHJvdG90eXBlLmFwcGVuZENoaWxkID0gZnVuY3Rpb24gKGRhdGEsIGlkKSB7DQogICAgICAgIHZhciBjaGlsZCA9IG5ldyBESVJUcmVlKHRoaXMsIGRhdGEsIGlkKTsNCiAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKGNoaWxkKTsNCiAgICAgICAgcmV0dXJuIGNoaWxkOw0KICAgICAgfTsNCg0KICAgICAgRElSVHJlZS5wcm90b3R5cGUucmVtb3ZlQ2hpbGQgPSBmdW5jdGlvbiAoYXJnKSB7DQogICAgICAgIGlmICh0eXBlb2YgYXJnID09PSAnbnVtYmVyJyAmJiB0aGlzLmNoaWxkcmVuW2FyZ10pIHsNCiAgICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbi5zcGxpY2UoYXJnLCAxKS5zaGlmdCgpOw0KICAgICAgICB9DQogICAgICAgIGlmIChhcmcgaW5zdGFuY2VvZiBESVJUcmVlKSB7DQogICAgICAgICAgcmV0dXJuIF9yZW1vdmVDaGlsZChhcmcpOw0KICAgICAgICB9DQogICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBhcmd1bWVudCAiICsgYXJnKTsNCiAgICAgIH07DQoNCiAgICAgIERJUlRyZWUucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIF9yZW1vdmVDaGlsZCh0aGlzKTsNCiAgICAgIH07DQoNCg0KICAgICAgRElSVHJlZS5wcm90b3R5cGUucm9vdCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIG5vZGUgPSB0aGlzOw0KDQogICAgICAgIGlmICghbm9kZS5wYXJlbnQpIHsNCiAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KDQogICAgICAgIHdoaWxlIChub2RlLnBhcmVudCkgew0KICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbm9kZTsNCiAgICAgIH07DQoNCiAgICAgIERJUlRyZWUucHJvdG90eXBlLmlzUm9vdCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuICF0aGlzLnBhcmVudDsNCiAgICAgIH07DQoNCiAgICAgIERJUlRyZWUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgbGluZXMgPSBbXTsNCg0KICAgICAgICB0aGlzLnRyYXZlcnNlRG93bihmdW5jdGlvbiAobm9kZSkgew0KICAgICAgICAgIHZhciBzZXBhcmF0b3IgPSAnfC0gJywgaW5kZW50YXRpb24gPSAnJywgaTsNCg0KICAgICAgICAgIGlmIChub2RlLmRlcHRoID09PSAwKSB7DQogICAgICAgICAgICBsaW5lcy5wdXNoKG5vZGUuaWQpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbm9kZS5kZXB0aDsgaSsrKSB7DQogICAgICAgICAgICBpbmRlbnRhdGlvbiArPSAnfCc7DQogICAgICAgICAgfQ0KICAgICAgICAgIGxpbmVzLnB1c2goaW5kZW50YXRpb24gKyBzZXBhcmF0b3IgKyBub2RlLmRhdGEucGF0aCArICgobm9kZS5kYXRhLnZhbHVlKSA/ICcgPSAnICsgbm9kZS5kYXRhLnZhbHVlIDogJycpKTsNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBsaW5lcy5qb2luKCJcbiIpOw0KICAgICAgfTsNCg0KICAgICAgRElSVHJlZS5wcm90b3R5cGUudG9YTUwgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBsaW5lcyA9IFtdOw0KDQogICAgICAgIChmdW5jdGlvbiB3YWxrRG93blhNTChub2RlKSB7DQogICAgICAgICAgdmFyIGluZGVudGF0aW9uID0gJycNCiAgICAgICAgICB2YXIgaTsNCiAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBub2RlLmRhdGEubmFtZS5yZXBsYWNlKC9cLy9nLCAnJyk7DQoNCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbm9kZS5kZXB0aDsgaSsrKSB7DQogICAgICAgICAgICBpbmRlbnRhdGlvbiArPSAnICAnOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmIChub2RlLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGxpbmVzLnB1c2goaW5kZW50YXRpb24gKyAiPCIgKyBub2RlTmFtZSArICI+Iik7DQogICAgICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBjKyspIHsNCiAgICAgICAgICAgICAgd2Fsa0Rvd25YTUwobm9kZS5jaGlsZHJlbltjXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBsaW5lcy5wdXNoKGluZGVudGF0aW9uICsgIjwvIiArIG5vZGVOYW1lICsgIj4iKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbGluZXMucHVzaChpbmRlbnRhdGlvbiArICI8IiArIG5vZGVOYW1lICsgIj4iICsgbm9kZS5kYXRhLnZhbHVlICsgIjwvIiArIG5vZGVOYW1lICsgIj4iKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgfSkodGhpcyk7DQogICAgICAgIHJldHVybiBsaW5lcy5qb2luKCJcbiIpOw0KICAgICAgfTsNCg0KICAgICAgRElSVHJlZS5wcm90b3R5cGUudHJhdmVyc2VEb3duID0gZnVuY3Rpb24gKGl0ZXJhdG9yKSB7DQogICAgICAgIF90cmF2ZXJzZSh0aGlzLCBpdGVyYXRvciwgX3RyYXZlcnNlRG93bik7DQogICAgICB9Ow0KDQogICAgICAvKioqKioqKioqIHRyZWUgKioqKioqKioqKioqKioqLw0KDQogICAgICBmdW5jdGlvbiBnZXRWYXJpYWJsZUxlbmd0aFN0cmluZyhkaXJSZXNwb25zZSkgew0KICAgICAgICB2YXIgZmlyc3RDaGFyID0gZGlyUmVzcG9uc2UucmVhZCgxKTsNCiAgICAgICAgdmFyIHJlYWRMZW5ndGggPSBwYXJzZUludChmaXJzdENoYXIpOw0KICAgICAgICBpZiAoIWlzTmFOKHJlYWRMZW5ndGgpKSB7DQogICAgICAgICAgcmV0dXJuIGRpclJlc3BvbnNlLnJlYWQocmVhZExlbmd0aCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIGZpcnN0Q2hhcjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgdmFyIGdldFNlY3Rpb25UeXBlQ29kZSA9IGdldFZhcmlhYmxlTGVuZ3RoU3RyaW5nOw0KDQogICAgICBmdW5jdGlvbiBnZXRWYXJpYWJsZUxlbmd0aE51bWJlcihkaXJSZXNwb25zZSkgew0KICAgICAgICByZXR1cm4gcGFyc2VJbnQoZ2V0VmFyaWFibGVMZW5ndGhTdHJpbmcoZGlyUmVzcG9uc2UpKTsNCiAgICAgIH0NCiAgICAgIHZhciBnZXRTZWN0aW9uTGVuZ3RoID0gZ2V0VmFyaWFibGVMZW5ndGhOdW1iZXI7DQogICAgICB2YXIgZ2V0RWxlbWVudENvdW50ID0gZ2V0VmFyaWFibGVMZW5ndGhOdW1iZXI7DQoNCiAgICAgIGZ1bmN0aW9uIHBhcnNlRElSU2VjdGlvbihtc2dUZXh0LCBwYXJlbnQpIHsNCiAgICAgICAgaWYgKG1zZ1RleHQuc3RhcnRzV2l0aCgnKicpIHx8IG1zZ1RleHQuc3RhcnRzV2l0aCgnLicpKSB7DQogICAgICAgICAgLy8gbXVsdGlwbGUgaXRlbSBzZWN0aW9uIChvciBzdWJzZWN0aW9uKQ0KICAgICAgICAgIHZhciBhcnJheVR5cGUgPSBtc2dUZXh0LnJlYWQoMSk7DQogICAgICAgICAgdmFyIGVsZW1lbnRDb3VudCA9IGdldEVsZW1lbnRDb3VudChtc2dUZXh0KTsNCiAgICAgICAgICB2YXIgc2VjdGlvblR5cGUgPSBnZXRTZWN0aW9uVHlwZUNvZGUobXNnVGV4dCk7DQogICAgICAgICAgdmFyIHNlY3Rpb25UZXh0ID0gcmliYm9uKG1zZ1RleHQucmVhZChnZXRTZWN0aW9uTGVuZ3RoKG1zZ1RleHQpKSk7DQoNCiAgICAgICAgICB2YXIgbm9kZSA9IHBhcmVudC5hcHBlbmRDaGlsZCh7IG5hbWU6IHNlY3Rpb25UeXBlLCBwYXRoOiBwYXJlbnQuZGF0YS5wYXRoICsgJy4nICsgc2VjdGlvblR5cGUgfSk7DQoNCiAgICAgICAgICBmb3IgKHZhciBlbGVtZW50Q291bnRlciA9IDA7IGVsZW1lbnRDb3VudGVyIDwgZWxlbWVudENvdW50OyBlbGVtZW50Q291bnRlcisrKSB7DQogICAgICAgICAgICBwYXJzZURJUlNlY3Rpb24oc2VjdGlvblRleHQsIG5vZGUpOw0KICAgICAgICAgIH0NCg0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHZhciBzZWN0aW9uVHlwZSA9IG1zZ1RleHQucmVhZCgxKQ0KICAgICAgICAgIGlmIChzZWN0aW9uVHlwZSAhPSAnPicgJiYgc2VjdGlvblR5cGUgIT0gJzAnKSB7DQogICAgICAgICAgICB2YXIgc2VjdGlvblN0YXJ0TnVtYmVyID0gcGFyc2VJbnQoc2VjdGlvblR5cGUpOyAvLyBpcyB0aGUgc2VjdGlvbiBzdGFydCBhIG51bWJlcj8gIGlmIGl0IGlzIC0gaXQgaXNuJ3QgcmVhbGx5IHRoZSBzZWN0aW9uIHR5cGUuICByZWFkIHRoZSBudW1iZXIgb2YgY2hhcmFjdGVycyBpbiB0aGUgc2VjdGlvbiBudW1iZXIgdG8gZ2V0IHRoZSBzZWN0aW9uIHR5cGUNCiAgICAgICAgICAgIGlmICghaXNOYU4oc2VjdGlvblN0YXJ0TnVtYmVyKSkgew0KICAgICAgICAgICAgICBzZWN0aW9uVHlwZSA9IG1zZ1RleHQucmVhZChzZWN0aW9uU3RhcnROdW1iZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHNlY3Rpb25UZXh0ID0gcmliYm9uKG1zZ1RleHQucmVhZChnZXRTZWN0aW9uTGVuZ3RoKG1zZ1RleHQpKSk7DQogICAgICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoeyBuYW1lOiBzZWN0aW9uVHlwZSwgdmFsdWU6IHNlY3Rpb25UZXh0LCBwYXRoOiBwYXJlbnQuZGF0YS5wYXRoICsgJy4nICsgc2VjdGlvblR5cGUgfSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHBhcnNlRElSTWVzc2FnZShkaXJUZXh0KSB7DQogICAgICAgIGRpclRleHQgPSAodHlwZW9mIGRpclRleHQgPT09ICdzdHJpbmcnKSA/IHJpYmJvbihkaXJUZXh0KSA6IGRpclRleHQ7DQoNCiAgICAgICAgdmFyIG1zZ1RyZWU7DQoNCiAgICAgICAgaWYgKC8oLio/XCRcZCspKFxkKVtBLVpdKy8udGVzdChkaXJUZXh0LnRvU3RyaW5nKCkpKSB7DQogICAgICAgICAgLy9maW5kIHRoZSBiZWdpbm5pbmcgb2YgdGhlIERJUiBkYXRhLg0KICAgICAgICAgIC8vaXQgd2lsbCBsb29rIHNvbWV0aGluZyBsaWtlIHRoaXM6DQogICAgICAgICAgLy8kMDAwMDAwMDAwMDAyMTYzUE5SNTExMTc1SDIzOU0yM0FERw0KICAgICAgICAgIGRpclRleHQuYWR2YW5jZSgvKC4qP1wkXGQrKShcZClbQS1aXSsvLmV4ZWMoZGlyVGV4dC50b1N0cmluZygpKVsxXSk7DQoNCiAgICAgICAgICB2YXIgdHlwZUxlbmd0aCA9IHBhcnNlSW50KGRpclRleHQucmVhZCgxKSk7DQogICAgICAgICAgdmFyIG1zZ1R5cGUgPSBkaXJUZXh0LnJlYWQodHlwZUxlbmd0aCk7DQoNCiAgICAgICAgICAvL0RJUlRyZWUgKHBhcmVudCwgZGF0YSwgaWQpDQogICAgICAgICAgbXNnVHJlZSA9IG5ldyBESVJUcmVlKG51bGwsIHsgbmFtZTogbXNnVHlwZSwgcGF0aDogbXNnVHlwZSB9LCBtc2dUeXBlKTsNCg0KICAgICAgICAgIHZhciBtc2dUZXh0ID0gcmliYm9uKGRpclRleHQucmVhZChnZXRTZWN0aW9uTGVuZ3RoKGRpclRleHQpKSk7DQoNCiAgICAgICAgICB2YXIgc3RhcnRMZW5ndGggPSBtc2dUZXh0LnRvU3RyaW5nKCkubGVuZ3RoOw0KICAgICAgICAgIHdoaWxlIChtc2dUZXh0LnRvU3RyaW5nKCkubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgcGFyc2VESVJTZWN0aW9uKG1zZ1RleHQsIG1zZ1RyZWUpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBtc2dUcmVlOw0KICAgICAgfQ0KDQogICAgICB2YXIgd3NwYW5ESVIgPSB7DQogICAgICAgIHBhcnNlRElSTWVzc2FnZTogcGFyc2VESVJNZXNzYWdlDQogICAgICB9Ow0KDQogICAgICAvKiBleHBvc2VkICovDQoNCiAgICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgew0KICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IHdzcGFuRElSOw0KICAgICAgfQ0KICAgICAgZWxzZSB7DQogICAgICAgIHRoaXMud3NwYW5ESVIgPSB3c3BhbkRJUjsNCiAgICAgIH0NCg0KICAgIH0pLmNhbGwoZnVuY3Rpb24gKCkgew0KICAgICAgcmV0dXJuIHRoaXMgfHwgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogZ2xvYmFsKTsNCiAgICB9KCkpOw0KICA8L3NjcmlwdD4NCjwvaGVhZD4NCg0KPGJvZHk+DQogIDxkaXYgaWQ9ImlucHV0ZGl2IiBzdHlsZT0id2lkdGg6MTAwJTsgbWFyZ2luOiAwIGF1dG87IHBhZGRpbmc6IDAgMCAxMHB4OyI+DQogICAgPHVsIGNsYXNzPSJ0YWJzIiBkYXRhLXBlcnNpc3Q9InRydWUiIGlkPSJ0YWJzbGlzdCI+DQogICAgICA8bGkgaWQ9InRhYjEiPg0KICAgICAgICA8YSBpZD0idGFiMWxpbmsiIGhyZWY9IiNzZWFyY2h2aWV3Ij5TZWFyY2g8L2E+DQogICAgICA8L2xpPg0KICAgICAgPGxpIGlkPSJ0YWIyIj4NCiAgICAgICAgPGEgaWQ9InRhYjJsaW5rIiBocmVmPSIjZmlsdGVydmlldyI+RmlsdGVyPC9hPg0KICAgICAgPC9saT4NCiAgICAgIDxsaSBpZD0idGFiMyI+DQogICAgICAgIDxhIGlkPSJ0YWIzbGluayIgaHJlZj0iI3NldHRpbmdzdmlldyI+U2V0dGluZ3M8L2E+DQogICAgICA8L2xpPg0KICAgICAgPGxpIGlkPSJ0YWI0Ij4NCiAgICAgICAgPGEgaWQ9InRhYjRsaW5rIiBocmVmPSIjaW5mb3ZpZXciPkluZm88L2E+DQogICAgICA8L2xpPg0KICAgIDwvdWw+DQogICAgPGRpdiBjbGFzcz0idGFiY29udGVudHMiPg0KICAgICAgPGRpdiBpZD0ic2VhcmNodmlldyI+DQogICAgICAgIDxmb3JtIGlkPSJzZWFyY2giPg0KICAgICAgICAgIDxkaXYgY2xhc3M9InN0cmluZyBpbnB1dCBvcHRpb25hbCBzdHJpbmdpc2ggc2VhcmNoX2Zvcm1fZmllbGQgc2VhcmNoX3N0cmluZyIgaWQ9InFfc2VhcmNoX2lucHV0Ij4NCiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfc2VhcmNoIiBjbGFzcz0ibGFiZWwiPlNlYXJjaDo8L2xhYmVsPg0KICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJzZWFyY2giIHBsYWNlaG9sZGVyPSJTZWFyY2ggbG9nIiBuYW1lPSJxW3NlYXJjaF0iIGlkPSJxX3NlYXJjaCIgLz4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWxlY3QgaW5wdXQgb3B0aW9uYWwgc2VhcmNoX2Zvcm1fZmllbGQgc2VhcmNoX3NlbGVjdCIgaWQ9InFfY29sdW1uX2lucHV0Ij4NCiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfY29sdW1uIiBjbGFzcz0ibGFiZWwiPkNvbHVtbihzKTo8L2xhYmVsPg0KICAgICAgICAgICAgPHNlbGVjdCBuYW1lPSJxW2NvbHVtbl0iIGlkPSJxX2NvbHVtbiIgbXVsdGlwbGU9Im11bHRpcGxlIiBzaXplPSI1Ij4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ibGluZU51bWJlciI+TGluZTwvb3B0aW9uPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJ3b3JrZXIiPldvcmtlcjwvb3B0aW9uPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJ3b3Jrc3RhdGlvbiI+V29ya3N0YXRpb248L29wdGlvbj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0id29ya2Zsb3ciPldvcmtmbG93PC9vcHRpb24+DQogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9InByb2Nlc3MiPlByb2Nlc3M8L29wdGlvbj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0icm91dGluZSI+Um91dGluZTwvb3B0aW9uPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJwbnJMb2NhdG9yIj5Mb2NhdG9yPC9vcHRpb24+DQogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImNhdGVnb3J5Ij5DYXRlZ29yeTwvb3B0aW9uPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJsZXZlbCI+TGV2ZWw8L29wdGlvbj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iZGF0ZVRpbWVUZXh0Ij5EYXRlL1RpbWU8L29wdGlvbj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0idGV4dCI+VGV4dDwvb3B0aW9uPg0KICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0iYnV0dG9ucyI+DQogICAgICAgICAgICA8aW5wdXQgbmFtZT0iYXBwbHlfc2VhcmNoX2J0biIgaWQ9ImFwcGx5X3NlYXJjaF9idG4iIGNsYXNzPSJzdWJtaXRfYnRuIiB0eXBlPSJzdWJtaXQiIHZhbHVlPSJTZWFyY2giIC8+DQogICAgICAgICAgICA8aW5wdXQgbmFtZT0iY2xlYXJfc2VhcmNoX2J0biIgaWQ9ImNsZWFyX3NlYXJjaF9idG4iIGNsYXNzPSJyZXNldF9idG4iIHR5cGU9ImJ1dHRvbiIgdmFsdWU9IkNsZWFyIiAvPg0KICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Zvcm0+DQogICAgICA8L2Rpdj4NCiAgICAgIDxkaXYgaWQ9ImZpbHRlcnZpZXciPg0KICAgICAgICA8Zm9ybSBpZD0iZmlsdGVyIj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJudW1iZXJfcmFuZ2UgaW5wdXQgb3B0aW9uYWwgZmlsdGVyX2Zvcm1fZmllbGQgZmlsdGVyX251bWJlcl9yYW5nZSIgaWQ9InFfbGluZV9udW1iZXJfaW5wdXQiPg0KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJsYWJlbCI+TGluZTwvbGFiZWw+DQogICAgICAgICAgICA8aW5wdXQgc2l6ZT0iMTIiIG1heGxlbmd0aD0iMTAiIHBsYWNlaG9sZGVyPSJGcm9tIiB2YWx1ZT0iIiB0eXBlPSJudW1iZXIiIG5hbWU9InFbbGluZV9udW1iZXJfZ3RlcV0iDQogICAgICAgICAgICAgIGlkPSJxX2xpbmVfbnVtYmVyX2d0ZXEiPg0KICAgICAgICAgICAgPGlucHV0IHNpemU9IjEyIiBtYXhsZW5ndGg9IjEwIiBwbGFjZWhvbGRlcj0iVG8iIHZhbHVlPSIiIHR5cGU9Im51bWJlciIgbmFtZT0icVtsaW5lX251bWJlcl9sdGVxXSINCiAgICAgICAgICAgICAgaWQ9InFfbGluZV9udW1iZXJfbHRlcSI+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0ic2VsZWN0IGlucHV0IG9wdGlvbmFsIGZpbHRlcl9mb3JtX2ZpZWxkIGZpbHRlcl9zZWxlY3QiIGlkPSJxX3dvcmtlcl9pbnB1dCI+DQogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX3dvcmtlciIgY2xhc3M9ImxhYmVsIj5Xb3JrZXI6PC9sYWJlbD4NCiAgICAgICAgICAgIDxzZWxlY3QgbmFtZT0icVt3b3JrZXJfZXFdIiBpZD0icV93b3JrZXIiPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJBbGwiPkFsbDwvb3B0aW9uPg0KICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0ic2VsZWN0IGlucHV0IG9wdGlvbmFsIGZpbHRlcl9mb3JtX2ZpZWxkIGZpbHRlcl9zZWxlY3QiIGlkPSJxX3dvcmtzdGF0aW9uX2lucHV0Ij4NCiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfd29ya3N0YXRpb24iIGNsYXNzPSJsYWJlbCI+V29ya3N0YXRpb246PC9sYWJlbD4NCiAgICAgICAgICAgIDxzZWxlY3QgbmFtZT0icVt3b3Jrc3RhdGlvbl9lcV0iIGlkPSJxX3dvcmtzdGF0aW9uIj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQWxsIj5BbGw8L29wdGlvbj4NCiAgICAgICAgICAgIDwvc2VsZWN0Pg0KICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgIDxkaXYgY2xhc3M9InNlbGVjdCBpbnB1dCBvcHRpb25hbCBmaWx0ZXJfZm9ybV9maWVsZCBmaWx0ZXJfc2VsZWN0IiBpZD0icV93b3JrZmxvd19pbnB1dCI+DQogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX3dvcmtmbG93IiBjbGFzcz0ibGFiZWwiPldvcmtmbG93OjwvbGFiZWw+DQogICAgICAgICAgICA8c2VsZWN0IG5hbWU9InFbd29ya2Zsb3dfZXFdIiBpZD0icV93b3JrZmxvdyI+DQogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkFsbCI+QWxsPC9vcHRpb24+DQogICAgICAgICAgICA8L3NlbGVjdD4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWxlY3QgaW5wdXQgb3B0aW9uYWwgZmlsdGVyX2Zvcm1fZmllbGQgZmlsdGVyX3NlbGVjdCIgaWQ9InFfcHJvY2Vzc19pbnB1dCI+DQogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX3Byb2Nlc3MiIGNsYXNzPSJsYWJlbCI+UHJvY2Vzczo8L2xhYmVsPg0KICAgICAgICAgICAgPHNlbGVjdCBuYW1lPSJxW3Byb2Nlc3NfZXFdIiBpZD0icV9wcm9jZXNzIj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQWxsIj5BbGw8L29wdGlvbj4NCiAgICAgICAgICAgIDwvc2VsZWN0Pg0KICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgIDxkaXYgY2xhc3M9InNlbGVjdCBpbnB1dCBvcHRpb25hbCBmaWx0ZXJfZm9ybV9maWVsZCBmaWx0ZXJfc2VsZWN0IiBpZD0icV9jYXRlZ29yeV9pbnB1dCI+DQogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX2NhdGVnb3J5IiBjbGFzcz0ibGFiZWwiPkNhdGVnb3J5OjwvbGFiZWw+DQogICAgICAgICAgICA8c2VsZWN0IG5hbWU9InFbY2F0ZWdvcnlfZXFdIiBpZD0icV9jYXRlZ29yeSI+DQogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkFsbCI+QWxsPC9vcHRpb24+DQogICAgICAgICAgICA8L3NlbGVjdD4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWxlY3QgaW5wdXQgb3B0aW9uYWwgZmlsdGVyX2Zvcm1fZmllbGQgZmlsdGVyX3NlbGVjdCIgaWQ9InFfbGV2ZWxfaW5wdXQiPg0KICAgICAgICAgICAgPGxhYmVsIGZvcj0icV9sZXZlbCIgY2xhc3M9ImxhYmVsIj5MZXZlbDo8L2xhYmVsPg0KICAgICAgICAgICAgPHNlbGVjdCBuYW1lPSJxW2xldmVsX2VxXSIgaWQ9InFfbGV2ZWwiPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJBbGwiPkFsbDwvb3B0aW9uPg0KICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0iZGF0ZV9yYW5nZSBpbnB1dCBvcHRpb25hbCBmaWx0ZXJfZm9ybV9maWVsZCBmaWx0ZXJfZGF0ZV9yYW5nZSIgaWQ9InFfZGF0ZV90aW1lX2lucHV0Ij4NCiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ibGFiZWwiPkRhdGUvVGltZTo8L2xhYmVsPg0KICAgICAgICAgICAgPGlucHV0IGNsYXNzPSJkYXRlcGlja2VyIiBzaXplPSIxMiIgbWF4bGVuZ3RoPSIxMCIgcGxhY2Vob2xkZXI9IkZyb20iIHZhbHVlPSIiIHR5cGU9InRleHQiDQogICAgICAgICAgICAgIG5hbWU9InFbZGF0ZV90aW1lX2d0ZXFdIiBpZD0icV9kYXRlX3RpbWVfZ3RlcSI+DQogICAgICAgICAgICA8aW5wdXQgY2xhc3M9ImRhdGVwaWNrZXIiIHNpemU9IjEyIiBtYXhsZW5ndGg9IjEwIiBwbGFjZWhvbGRlcj0iVG8iIHZhbHVlPSIiIHR5cGU9InRleHQiDQogICAgICAgICAgICAgIG5hbWU9InFbZGF0ZV90aW1lX2x0ZXFdIiBpZD0icV9kYXRlX3RpbWVfbHRlcSI+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0iYnV0dG9ucyI+DQogICAgICAgICAgICA8aW5wdXQgbmFtZT0iYXBwbHlfZmlsdGVyc19idG4iIGlkPSJhcHBseV9maWx0ZXJzX2J0biIgY2xhc3M9InN1Ym1pdF9idG4iIHR5cGU9InN1Ym1pdCIgdmFsdWU9IkZpbHRlciIgLz4NCiAgICAgICAgICAgIDxpbnB1dCBuYW1lPSJjbGVhcl9maWx0ZXJzX2J0biIgaWQ9ImNsZWFyX2ZpbHRlcnNfYnRuIiBjbGFzcz0icmVzZXRfYnRuIiB0eXBlPSJidXR0b24iIHZhbHVlPSJDbGVhciIgLz4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC9mb3JtPg0KICAgICAgPC9kaXY+DQogICAgICA8ZGl2IGlkPSJzZXR0aW5nc3ZpZXciPg0KICAgICAgICA8Zm9ybSBpZD0ic2V0dGluZ3MiPg0KICAgICAgICAgIDxmaWVsZHNldCBpZD0iY29sdW1uc3Rvc2hvdyI+DQogICAgICAgICAgICA8bGVnZW5kPkNvbHVtbnMgdG8gc2hvdzwvbGVnZW5kPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZyBpdGVtIGNvbnRhaW5lciI+DQogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibGluZW9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+TGluZTogPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9ImxpbmVOdW1iZXJvbm9mZnN3aXRjaCIgY2xhc3M9Im9ub2Zmc3dpdGNoLWNoZWNrYm94Ig0KICAgICAgICAgICAgICAgICAgICBpZD0ibGluZU51bWJlcm9ub2Zmc3dpdGNoIiBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJsaW5lTnVtYmVyb25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPg0KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9Indvcmtlcm9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+V29ya2VyOiA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0id29ya2Vyb25vZmZzd2l0Y2giIGNsYXNzPSJvbm9mZnN3aXRjaC1jaGVja2JveCIgaWQ9Indvcmtlcm9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0id29ya2Vyb25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPg0KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9IndvcmtzdGF0aW9ub25vZmZzd2l0Y2giIGNsYXNzPSJpdGVtIj5Xb3Jrc3RhdGlvbjogPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9IndvcmtzdGF0aW9ub25vZmZzd2l0Y2giIGNsYXNzPSJvbm9mZnN3aXRjaC1jaGVja2JveCINCiAgICAgICAgICAgICAgICAgICAgaWQ9IndvcmtzdGF0aW9ub25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJ3b3Jrc3RhdGlvbm9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+V29ya2Zsb3c6IDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giDQogICAgICAgICAgICAgICAgICAgIGlkPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIiBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwcm9jZXNzb25vZmZzd2l0Y2giIGNsYXNzPSJpdGVtIj5Qcm9jZXNzOiA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0icHJvY2Vzc29ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giIGlkPSJwcm9jZXNzb25vZmZzd2l0Y2giDQogICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ+DQogICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9Im9ub2Zmc3dpdGNoLWxhYmVsIiBmb3I9InByb2Nlc3Nvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1pbm5lciI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtc3dpdGNoIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZyBpdGVtIGNvbnRhaW5lciI+DQogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0icm91dGluZW9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+Um91dGluZTogPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9InJvdXRpbmVvbm9mZnN3aXRjaCIgY2xhc3M9Im9ub2Zmc3dpdGNoLWNoZWNrYm94IiBpZD0icm91dGluZW9ub2Zmc3dpdGNoIg0KICAgICAgICAgICAgICAgICAgICBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJyb3V0aW5lb25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPg0KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InBuckxvY2F0b3Jvbm9mZnN3aXRjaCIgY2xhc3M9Iml0ZW0iPkxvY2F0b3I6IDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJwbnJMb2NhdG9yb25vZmZzd2l0Y2giIGNsYXNzPSJvbm9mZnN3aXRjaC1jaGVja2JveCINCiAgICAgICAgICAgICAgICAgICAgaWQ9InBuckxvY2F0b3Jvbm9mZnN3aXRjaCIgY2hlY2tlZD4NCiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0icG5yTG9jYXRvcm9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjYXRlZ29yeW9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+Q2F0ZWdvcnk6IDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJjYXRlZ29yeW9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giDQogICAgICAgICAgICAgICAgICAgIGlkPSJjYXRlZ29yeW9ub2Zmc3dpdGNoIiBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJjYXRlZ29yeW9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJsZXZlbG9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+TGV2ZWw6IDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJsZXZlbG9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giIGlkPSJsZXZlbG9ub2Zmc3dpdGNoIg0KICAgICAgICAgICAgICAgICAgICBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJsZXZlbG9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJkYXRlVGltZVRleHRvbm9mZnN3aXRjaCIgY2xhc3M9Iml0ZW0iPkRhdGUvVGltZTogPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9ImRhdGVUaW1lVGV4dG9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giDQogICAgICAgICAgICAgICAgICAgIGlkPSJkYXRlVGltZVRleHRvbm9mZnN3aXRjaCIgY2hlY2tlZD4NCiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0iZGF0ZVRpbWVUZXh0b25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPg0KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InRleHRvbm9mZnN3aXRjaCIgY2xhc3M9Iml0ZW0iPiBUZXh0OiA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0idGV4dG9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giIGlkPSJ0ZXh0b25vZmZzd2l0Y2giDQogICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ+DQogICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9Im9ub2Zmc3dpdGNoLWxhYmVsIiBmb3I9InRleHRvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1pbm5lciI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtc3dpdGNoIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgIDwvZmllbGRzZXQ+DQogICAgICAgICAgPGZpZWxkc2V0IGlkPSJ0ZXh0dmlld3NldHRpbmdzIj4NCiAgICAgICAgICAgIDxsZWdlbmQ+UmVxdWVzdC9SZXNwb25zZSBUZXh0IFZpZXc8L2xlZ2VuZD4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJhZGlvVG9nZ2xlIj4NCiAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBuYW1lPSJjb21tdW5pY2F0aW9uRGlzcGxheSIgdmFsdWU9Im5hdGl2ZSIgaWQ9ImNvbW11bmljYXRpb25OYXRpdmUiIGNoZWNrZWQ9ImNoZWNrZWQiIC8+DQogICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImNvbW11bmljYXRpb25OYXRpdmUiPk5hdGl2ZTwvbGFiZWw+DQogICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJyYWRpbyIgbmFtZT0iY29tbXVuaWNhdGlvbkRpc3BsYXkiIHZhbHVlPSJ4bWwiIGlkPSJjb21tdW5pY2F0aW9uWG1sIiAvPg0KICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjb21tdW5pY2F0aW9uWG1sIj5Gb3JtYXR0ZWQgWE1MPC9sYWJlbD4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgIDwvZmllbGRzZXQ+DQogICAgICAgIDwvZm9ybT4NCiAgICAgIDwvZGl2Pg0KICAgICAgPGRpdiBpZD0iaW5mb3ZpZXciPg0KICAgICAgICA8ZGl2IGlkPSJpbmZvIj4NCiAgICAgICAgICA8ZGl2IGlkPSJpbmZvRmlsZSIgY2xhc3M9ImluZm8iPjxzcGFuIGNsYXNzPSJpbmZvTGFiZWwiPkZpbGUgbmFtZTogPC9zcGFuPjxzcGFuIGlkPSJpbmZvRmlsZW5hbWUiPjwvc3Bhbj4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICA8ZGl2IGlkPSJpbmZvU2VhcmNoIiBjbGFzcz0iaW5mbyBoaWRkZW4iPjxzcGFuIGNsYXNzPSJpbmZvTGFiZWwiPlNlYXJjaCBmb3IgPC9zcGFuPjxzcGFuDQogICAgICAgICAgICAgIGlkPSJpbmZvU2VhcmNoVGV4dCI+PC9zcGFuPjwvZGl2Pg0KICAgICAgICAgIDxkaXYgaWQ9ImluZm9TZWFyY2hDb2x1bW5zIiBjbGFzcz0iaW5mbyBoaWRkZW4iPjxzcGFuIGNsYXNzPSJpbmZvTGFiZWwiPmluIGNvbHVtbnM6IDwvc3Bhbj48c3Bhbg0KICAgICAgICAgICAgICBpZD0iaW5mb1NlYXJjaENvbHVtbnNUZXh0Ij48L3NwYW4+PC9kaXY+DQogICAgICAgICAgPGRpdiBpZD0iaW5mb0ZpbHRlciIgY2xhc3M9ImluZm8gaGlkZGVuIj48c3BhbiBjbGFzcz0iaW5mb0xhYmVsIj5GaWx0ZXJzOiA8L3NwYW4+PHNwYW4NCiAgICAgICAgICAgICAgaWQ9ImluZm9GaWx0ZXJUZXh0Ij48L3NwYW4+PC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQogIDwvZGl2Pg0KICA8ZGl2IGlkPSJsb2d0YWJsZSI+DQogICAgPGRpdiBpZD0icGFnZWRpdiI+DQogICAgICA8dWwgY2xhc3M9InBhZ2luYXRpb24iPjwvdWw+DQogICAgPC9kaXY+DQogICAgPGRpdiBpZD0iZGF0YSI+DQogICAgICA8dGFibGUgY2xhc3M9Imxpc3RhYmxlIHNvcnRhYmxlIj4NCiAgICAgICAgPGNvbGdyb3VwPg0KICAgICAgICAgIDxjb2wgY2xhc3M9ImxpbmVOdW1iZXIiIC8+DQogICAgICAgICAgPGNvbCBjbGFzcz0id29ya2VyIiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9IndvcmtzdGF0aW9uIiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9IndvcmtmbG93IiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9InByb2Nlc3MiIC8+DQogICAgICAgICAgPGNvbCBjbGFzcz0icm91dGluZSIgLz4NCiAgICAgICAgICA8Y29sIGNsYXNzPSJwbnJMb2NhdG9yIiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9ImNhdGVnb3J5IiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9ImxldmVsIiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9ImRhdGVUaW1lVGV4dCIgLz4NCiAgICAgICAgICA8Y29sIGNsYXNzPSJ0ZXh0IiAvPg0KICAgICAgICA8L2NvbGdyb3VwPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgPHRyPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IGxpbmVOdW1iZXIiIGRhdGEtc29ydD0ibGluZU51bWJlciI+TGluZTwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgd29ya2VyIiBkYXRhLXNvcnQ9IndvcmtlciI+V29ya2VyPC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0ic29ydCB3b3Jrc3RhdGlvbiIgZGF0YS1zb3J0PSJ3b3Jrc3RhdGlvbiI+V29ya3N0YXRpb248L3RoPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IHdvcmtmbG93IiBkYXRhLXNvcnQ9IndvcmtmbG93Ij5Xb3JrZmxvdzwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgcHJvY2VzcyIgZGF0YS1zb3J0PSJwcm9jZXNzIj5Qcm9jZXNzPC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0ic29ydCByb3V0aW5lIiBkYXRhLXNvcnQ9InJvdXRpbmUiPlJvdXRpbmU8L3RoPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IHBuckxvY2F0b3IiIGRhdGEtc29ydD0icG5yTG9jYXRvciI+TG9jYXRvcjwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgY2F0ZWdvcnkiIGRhdGEtc29ydD0iY2F0ZWdvcnkiPkNhdGVnb3J5PC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0ic29ydCBsZXZlbCIgZGF0YS1zb3J0PSJsZXZlbCI+TGV2ZWw8L3RoPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IGRhdGVUaW1lVGV4dCIgZGF0YS1zb3J0PSJkYXRlVGltZVRleHQiPkRhdGUvVGltZTwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgdGV4dCIgZGF0YS1zb3J0PSJ0ZXh0Ij5UZXh0PC90aD4NCiAgICAgICAgICA8L3RyPg0KICAgICAgICA8L3RoZWFkPg0KICAgICAgICA8dGJvZHkgY2xhc3M9Imxpc3QiPg0KICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0ibGluZU51bWJlciI+PC90ZD4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0id29ya2VyIj48L3RkPg0KICAgICAgICAgICAgPHRkIGNsYXNzPSJ3b3Jrc3RhdGlvbiI+PC90ZD4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0id29ya2Zsb3ciPjwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9InByb2Nlc3MiPjwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9InJvdXRpbmUiPjwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9InBuckxvY2F0b3IiPjwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9ImNhdGVnb3J5Ij48L3RkPg0KICAgICAgICAgICAgPHRkIGNsYXNzPSJsZXZlbCI+PC90ZD4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0iZGF0ZVRpbWVUZXh0Ij48L3RkPg0KICAgICAgICAgICAgPHRkIGNsYXNzPSJ0ZXh0Ij48L3RkPg0KICAgICAgICAgIDwvdHI+DQogICAgICAgIDwvdGJvZHk+DQogICAgICA8L3RhYmxlPg0KICAgIDwvZGl2Pg0KICA8L2Rpdj4NCiAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KICAgIC8vbGlzdA0KICAgIHZhciBvcHRpb25zID0gew0KICAgICAgdmFsdWVOYW1lczogWydsaW5lTnVtYmVyJywgJ3dvcmtlcicsICd3b3Jrc3RhdGlvbicsICdjYXRlZ29yeScsICdsZXZlbCcsICdkYXRlVGltZVRleHQnLCAndGV4dCcsICd3b3JrZmxvdycsDQogICAgICAgICdwcm9jZXNzJywgJ3JvdXRpbmUnLCAncG5yTG9jYXRvcicNCiAgICAgIF0sDQogICAgICBwYWdlOiAyMCwNCiAgICAgIHBsdWdpbnM6IFtMaXN0UGFnaW5hdGlvbih7DQogICAgICAgIG91dGVyV2luZG93OiAyDQogICAgICB9KV0NCiAgICB9Ow0KICAgIC8vIEluaXQgbGlzdA0KICAgIHZhciBsb2dUYWJsZSA9IG5ldyBMaXN0KCdsb2d0YWJsZScsIG9wdGlvbnMpOw0KICAgIGxvZ1RhYmxlLm9uKCd1cGRhdGVkJywgaGlkZVRhbGxDb250ZW50KTsNCiAgICBsb2dUYWJsZS5vbigndXBkYXRlZCcsIGZvcm1hdFhtbCk7DQogICAgbG9nVGFibGUub24oJ3VwZGF0ZWQnLCBmb3JtYXRKc29uKTsNCiAgICBsb2dUYWJsZS5vbigndXBkYXRlZCcsIGNvbnZlcnRESVIpOw0KICAgIGxvZ1RhYmxlLm9uKCd1cGRhdGVkJywgdXBkYXRlQ29sdW1ucyk7DQoNCiAgICAvLyBHRFNYIExvZyBoYW5kbGluZw0KICAgIC8qDQogICAgZnVuY3Rpb24gcHJvY2Vzc1RleHRCb3goZSkgew0KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgcHJvY2Vzc0xvZ1RleHQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ3RleHQnKS52YWx1ZSk7DQogICAgICBpbmZvLmZpbGVOYW1lID0gJ0NvcHkvUGFzdGUnOw0KICAgICAgc2hvd0luZm8oKTsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgKi8NCg0KICAgIGZ1bmN0aW9uIHByZXR0eVhtbCh4bWxUZXh0KSB7DQogICAgICB2YXIgZm9ybWF0ID0gcmVxdWlyZSgneG1sLWZvcm1hdHRlcicpOw0KDQogICAgICB2YXIgb3B0aW9ucyA9IHsNCiAgICAgICAgaW5kZW50YXRpb246ICcgICcsDQogICAgICAgIHN0cmlwQ29tbWVudHM6IHRydWUsDQogICAgICAgIGNvbGxhcHNlQ29udGVudDogdHJ1ZQ0KICAgICAgfTsNCiAgICAgIHJldHVybiBmb3JtYXQoeG1sVGV4dCwgb3B0aW9ucyk7DQogICAgfQ0KDQogICAgLy8gdXRpbGl0eSBmdW5jdGlvbiB0byBwcm9jZXNzIGxvZyB0ZXh0DQogICAgZnVuY3Rpb24gcHJvY2Vzc0xvZ1RleHQobG9nVGV4dCkgew0KICAgICAgbG9nVGFibGUuY2xlYXIoKTsNCiAgICAgIGlmIChsb2dUZXh0LnRyaW0oKS5sZW5ndGggPiAwKSB7DQogICAgICAgIHZhciBsb2dBcnJheSA9IGNvbXBsZWF0VmVuZG9yRGVidWcucGFyc2VMb2cobG9nVGV4dC50cmltKCkpOw0KICAgICAgICBjb25zdCBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7DQogICAgICAgIGxvZ0FycmF5LmZvckVhY2gobG9nSXRlbSA9PiB7DQogICAgICAgICAgaWYgKGxvZ0l0ZW0udGV4dC5zdGFydHNXaXRoKCI8IikgJiYgbG9nSXRlbS50ZXh0LmVuZHNXaXRoKCI+IikpIHsNCiAgICAgICAgICAgIGNvbnN0IGRvYyA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcobG9nSXRlbS50ZXh0LnJlcGxhY2VBbGwoIiZuYnNwOyIsICIgIiksICJhcHBsaWNhdGlvbi94bWwiKTsNCiAgICAgICAgICAgIGNvbnN0IGVycm9yTm9kZSA9IGRvYy5xdWVyeVNlbGVjdG9yKCJwYXJzZXJlcnJvciIpOw0KICAgICAgICAgICAgaWYgKGVycm9yTm9kZSkgew0KICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZXJyb3Igd2hpbGUgcGFyc2luZyBpbiBwcm9jZXNzTG9nVGV4dCIpOw0KICAgICAgICAgICAgICBjb25zb2xlLmxvZyhsb2dJdGVtLnRleHQpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgbG9nSXRlbS50ZXh0ID0gbG9nSXRlbS50ZXh0LnJlcGxhY2VBbGwoIiZuYnNwOyIsICIgIikucmVwbGFjZSgvW1x1MDBBMC1cdTk5OTk8PlwmXS9nLCBpID0+ICcmIycraS5jaGFyQ29kZUF0KDApKyc7Jyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgbG9nVGFibGUuYWRkKGxvZ0FycmF5KTsNCiAgICAgICAgYnVpbGRGaWx0ZXJzKGxvZ0FycmF5KTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBtb3ZlT3JpZ2luYWwoZWxlbWVudCkgew0KICAgICAgdmFyIG5ld1BhcmVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgICAgd2hpbGUgKGVsZW1lbnQuaGFzQ2hpbGROb2RlcygpKSB7DQogICAgICAgIG5ld1BhcmVudC5hcHBlbmRDaGlsZChlbGVtZW50LmZpcnN0Q2hpbGQpOw0KICAgICAgfQ0KICAgICAgbmV3UGFyZW50LmNsYXNzTmFtZSA9ICdoaWRkZW4gcGxhaW50ZXh0Jw0KICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChuZXdQYXJlbnQpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNyZWF0ZUNoaWxkRWxlbWVudChlbGVtZW50LCBjaGlsZFR5cGUpIHsNCiAgICAgIHZhciBjaGlsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoY2hpbGRUeXBlKTsNCiAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQoY2hpbGQpOw0KICAgICAgcmV0dXJuIGNoaWxkOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNyZWF0ZVRleHRFbGVtZW50KGVsZW1lbnQsIHRleHQpIHsNCiAgICAgIHZhciBjaGlsZFRleHROb2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCk7DQogICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGNoaWxkVGV4dE5vZGUpOw0KICAgICAgcmV0dXJuIGNoaWxkVGV4dE5vZGU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYWRkSnNvbk5vZGUoZWxlbWVudCwgdGV4dCkgew0KICAgICAgdHJ5IHsNCiAgICAgICAgY29uc3QgZG9jID0gSlNPTi5wYXJzZSh0ZXh0KTsNCiAgICAgICAgdmFyIHByZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ByZScpOw0KICAgICAgICB2YXIgY29kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NvZGUnKTsNCiAgICAgICAgY29kZS5jbGFzc05hbWUgPSAnZm9ybWF0dGVkIGpzb24nOw0KICAgICAgICBwcmUuYXBwZW5kQ2hpbGQoY29kZSk7DQogICAgICAgIGNyZWF0ZVRleHRFbGVtZW50KGNvZGUsIEpTT04uc3RyaW5naWZ5KGRvYywgbnVsbCwgMikpOw0KICAgICAgICBtb3ZlT3JpZ2luYWwoZWxlbWVudCk7DQogICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQocHJlKTsNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5sb2coImVycm9yIHdoaWxlIHBhcnNpbmcgaW4gYWRkSnNvbk5vZGUiKTsNCiAgICAgICAgY29uc29sZS5sb2codGV4dCk7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZm9ybWF0SnNvbigpIHsNCiAgICAgIHZhciB0ZXh0Tm9kZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd0ZXh0Jyk7DQogICAgICB2YXIganNvbk5vZGVzID0gQXJyYXkuZnJvbSh0ZXh0Tm9kZXMpOw0KICAgICAgaWYgKGpzb25Ob2Rlcy5sZW5ndGggPiAwKSB7DQogICAgICAgIGpzb25Ob2Rlcy5mb3JFYWNoKGVsZW1lbnQgPT4gew0KICAgICAgICAgIGNvbnN0IHRleHQgPSBlbGVtZW50LmlubmVyVGV4dCB8fCBlbGVtZW50LnRleHRDb250ZW50Ow0KICAgICAgICAgIGNvbnN0IGpzb25Db2RlID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yKCJjb2RlLmpzb24iKTsNCiAgICAgICAgICBjb25zdCB0YWJsZUJyZWFrZG93biA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcigidGFibGUuYnJlYWtkb3duIik7DQogICAgICAgICAgaWYgKGpzb25Db2RlID09IG51bGwpIHsNCiAgICAgICAgICAgIGlmICh0ZXh0LnN0YXJ0c1dpdGgoInsiKSAmJiB0ZXh0LmVuZHNXaXRoKCJ9IikpIHsNCiAgICAgICAgICAgICAgYWRkSnNvbk5vZGUoZWxlbWVudCwgdGV4dCk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHRleHQuc3RhcnRzV2l0aCgiTWV0aG9kOiAiKSB8fCB0ZXh0LnN0YXJ0c1dpdGgoIlN0YXR1c0NvZGU6ICIpKSB7DQogICAgICAgICAgICAgIHZhciBsaW5lcyA9IHRleHQudHJpbSgpLnNwbGl0KC9bXHJcbl0rLykuZmlsdGVyKChsaW5lKSA9PiBsaW5lLnRyaW0oKSAhPSAnJyk7DQogICAgICAgICAgICAgIHZhciBmaXJzdExpbmUgPSBsaW5lcy5zaGlmdCgpLnRyaW0oKTsNCiAgICAgICAgICAgICAgdmFyIHNlY29uZExpbmUgPSBsaW5lcy5zaGlmdCgpLnRyaW0oKTsNCiAgICAgICAgICAgICAgdmFyIGxhc3RMaW5lID0gbGluZXMucG9wKCkudHJpbSgpOw0KICAgICAgICAgICAgICB2YXIgc2Vjb25kVG9MYXN0TGluZSA9IGxpbmVzLnBvcCgpLnRyaW0oKTsNCiAgICAgICAgICAgICAgaWYgKHNlY29uZExpbmUgPT0gJ3snICYmIHNlY29uZFRvTGFzdExpbmUgPT0gJ30nKSB7DQogICAgICAgICAgICAgICAgLy8gdGhpcyBpcyB0aGUga2luZCBvZiB0ZXh0IHdlJ3JlIGxvb2tpbmcgZm9yDQogICAgICAgICAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgICAgICAgICAgICAgIHZhciB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyk7DQogICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKHRhYmxlKTsNCiAgICAgICAgICAgICAgICB0YWJsZS5jbGFzc05hbWUgPSAnYnJlYWtkb3duJzsNCiAgICAgICAgICAgICAgICAvLyBsaW5lIDE6DQogICAgICAgICAgICAgICAgLy9NZXRob2Q6IFBPU1QsIFJlcXVlc3RVcmk6ICdodHRwczovL2FwaS5oYXZhaWwuc2FicmUuY29tL3YyL2F1dGgvdG9rZW4nLCBWZXJzaW9uOiAxLjEsIENvbnRlbnQ6IFN5c3RlbS5OZXQuSHR0cC5TdHJpbmdDb250ZW50LCBIZWFkZXJzOg0KICAgICAgICAgICAgICAgIC8vIFN0YXR1c0NvZGU6IDIwMCwgUmVhc29uUGhyYXNlOiAnT0snLCBWZXJzaW9uOiAxLjEsIENvbnRlbnQ6IFN5c3RlbS5OZXQuSHR0cC5TdHJlYW1Db250ZW50LCBIZWFkZXJzOg0KICAgICAgICAgICAgICAgIHZhciBsaW5lMVBhcnRzID0gZmlyc3RMaW5lLnNwbGl0KC8sIC8pOw0KICAgICAgICAgICAgICAgIHZhciBsYWJlbFZhbHVlUmVnZXggPSAvXihbXjpdKyk6KC4qKS87DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lMVBhcnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICB2YXIgdHIgPSBjcmVhdGVDaGlsZEVsZW1lbnQodGFibGUsICd0cicpOw0KICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsVmFsdWVNYXRjaGVzID0gbGluZTFQYXJ0c1tpXS5tYXRjaChsYWJlbFZhbHVlUmVnZXgpOw0KICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsVGV4dCA9IGxhYmVsVmFsdWVNYXRjaGVzWzFdOw0KICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlVGV4dCA9IGxhYmVsVmFsdWVNYXRjaGVzWzJdLnRyaW0oKTsNCiAgICAgICAgICAgICAgICAgIHZhciBsYWJlbFRkID0gY3JlYXRlQ2hpbGRFbGVtZW50KHRyLCAndGQnKTsNCiAgICAgICAgICAgICAgICAgIGNyZWF0ZVRleHRFbGVtZW50KGxhYmVsVGQsIGxhYmVsVGV4dCArICI6Iik7DQogICAgICAgICAgICAgICAgICB2YXIgdmFsdWVUZCA9IGNyZWF0ZUNoaWxkRWxlbWVudCh0ciwgJ3RkJyk7DQogICAgICAgICAgICAgICAgICBpZiAobGFiZWxUZXh0ID09ICJIZWFkZXJzIikgew0KICAgICAgICAgICAgICAgICAgICBjcmVhdGVUZXh0RWxlbWVudCh2YWx1ZVRkLCBsaW5lcy5tYXAocyA9PiBzLnRyaW0oKSkuam9pbignXG4nKSk7DQogICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjcmVhdGVUZXh0RWxlbWVudCh2YWx1ZVRkLCB2YWx1ZVRleHQpOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB2YXIgcGF5bG9hZFRyID0gY3JlYXRlQ2hpbGRFbGVtZW50KHRhYmxlLCAndHInKTsNCiAgICAgICAgICAgICAgICB2YXIgcGF5bG9hZExhYmVsVGQgPSBjcmVhdGVDaGlsZEVsZW1lbnQocGF5bG9hZFRyLCAndGQnKTsNCiAgICAgICAgICAgICAgICBjcmVhdGVUZXh0RWxlbWVudChwYXlsb2FkTGFiZWxUZCwgIlBheWxvYWQ6Iik7DQogICAgICAgICAgICAgICAgdmFyIHBheWxvYWRWYWx1ZVRkID0gY3JlYXRlQ2hpbGRFbGVtZW50KHBheWxvYWRUciwgJ3RkJyk7DQogICAgICAgICAgICAgICAgaWYgKGxhc3RMaW5lLnN0YXJ0c1dpdGgoInsiKSAmJiBsYXN0TGluZS5lbmRzV2l0aCgifSIpKSB7DQogICAgICAgICAgICAgICAgICBhZGRKc29uTm9kZShwYXlsb2FkVmFsdWVUZCwgbGFzdExpbmUpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICB2YXIgcGF5bG9hZFByZSA9IGNyZWF0ZUNoaWxkRWxlbWVudChwYXlsb2FkVmFsdWVUZCwgJ3ByZScpOw0KICAgICAgICAgICAgICAgICAgY3JlYXRlVGV4dEVsZW1lbnQocGF5bG9hZFByZSwgbGFzdExpbmUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBtb3ZlT3JpZ2luYWwoZWxlbWVudCk7DQogICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChkaXYpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMTU4MzkyODMNCiAgICBmdW5jdGlvbiBnZXRSYWRpb1ZhbHVlKHJhZGlvTmFtZSkgew0KICAgICAgdmFyIGJ1dHRvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZShyYWRpb05hbWUpOw0KICAgICAgdmFyIGJ1dHRvblZhbHVlOw0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBidXR0b25zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGlmIChidXR0b25zW2ldLmNoZWNrZWQpIHsNCiAgICAgICAgICBidXR0b25WYWx1ZSA9IGJ1dHRvbnNbaV0udmFsdWU7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiBidXR0b25WYWx1ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhZGRYbWxOb2RlKHBhcnNlciwgZWxlbWVudCwgdGV4dCwgY29tbXVuaWNhdGlvbkRpc3BsYXlWYWx1ZSkgew0KICAgICAgY29uc3QgZG9jID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyh0ZXh0LCAiYXBwbGljYXRpb24veG1sIik7DQogICAgICBjb25zdCBlcnJvck5vZGUgPSBkb2MucXVlcnlTZWxlY3RvcigicGFyc2VyZXJyb3IiKTsNCiAgICAgIGlmIChlcnJvck5vZGUpIHsNCiAgICAgICAgY29uc29sZS5sb2coImVycm9yIHdoaWxlIHBhcnNpbmcgaW4gZm9ybWF0WG1sIik7DQogICAgICAgIGNvbnNvbGUubG9nKHRleHQpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdmFyIGVuYWJsZU5hdGl2ZSA9IChkb2MuZmlyc3RDaGlsZC50YWdOYW1lID09ICJTYWJyZUNvbW1hbmRMTFNSUSIgfHwgZG9jLmZpcnN0Q2hpbGQudGFnTmFtZSA9PSAiU2FicmVDb21tYW5kTExTUlMiIHx8IGRvYy5maXJzdENoaWxkLnRhZ05hbWUgPT0gIkNvbW1hbmRfQ3J5cHRpYyIgfHwgZG9jLmZpcnN0Q2hpbGQudGFnTmFtZSA9PSAiQ29tbWFuZF9DcnlwdGljUmVwbHkiKTsNCiAgICAgICAgdmFyIHByZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ByZScpOw0KICAgICAgICB2YXIgY29kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NvZGUnKTsNCiAgICAgICAgY29kZS5jbGFzc05hbWUgPSAnZm9ybWF0dGVkIHhtbCc7DQogICAgICAgIGlmIChlbmFibGVOYXRpdmUgJiYgY29tbXVuaWNhdGlvbkRpc3BsYXlWYWx1ZSA9PSAibmF0aXZlIikgew0KICAgICAgICAgIHByZS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBwcmUuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7DQogICAgICAgIH0NCiAgICAgICAgcHJlLmFwcGVuZENoaWxkKGNvZGUpOw0KICAgICAgICBjcmVhdGVUZXh0RWxlbWVudChjb2RlLCBwcmV0dHlYbWwodGV4dCkpDQogICAgICAgIG1vdmVPcmlnaW5hbChlbGVtZW50KTsNCiAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChwcmUpOw0KDQogICAgICAgIGlmIChlbmFibGVOYXRpdmUpIHsNCiAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgICAgICAgaWYgKGNvbW11bmljYXRpb25EaXNwbGF5VmFsdWUgPT0gIm5hdGl2ZSIpIHsNCiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnbmF0aXZlJyk7DQogICAgICAgICAgICBkaXYuY2xhc3NOYW1lID0gJ25hdGl2ZSc7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGRpdi5jbGFzc05hbWUgPSAnbmF0aXZlIGhpZGRlbic7DQogICAgICAgICAgfQ0KICAgICAgICAgIGNyZWF0ZVRleHRFbGVtZW50KGRpdiwgZG9jLmRvY3VtZW50RWxlbWVudC50ZXh0Q29udGVudC5yZXBsYWNlQWxsKCJXQVJOLlNXUy5IT1NULklOVEVSTUVESUFURV9SRVNQT05TRSIsICIiKSk7DQogICAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChkaXYpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZm9ybWF0WG1sKCkgew0KICAgICAgdmFyIHRleHROb2RlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3RleHQnKTsNCiAgICAgIHZhciB4bWxOb2RlcyA9IEFycmF5LmZyb20odGV4dE5vZGVzKTsNCiAgICAgIGlmICh4bWxOb2Rlcy5sZW5ndGggPiAwKSB7DQogICAgICAgIHZhciBjb21tdW5pY2F0aW9uRGlzcGxheVZhbHVlID0gZ2V0UmFkaW9WYWx1ZSgnY29tbXVuaWNhdGlvbkRpc3BsYXknKTsNCiAgICAgICAgLy8gY29uc29sZS5sb2coInJlcXVlc3QvcmVzcG9uc2UgZGlzcGxheTogIiArIGNvbW11bmljYXRpb25EaXNwbGF5VmFsdWUpOw0KICAgICAgICBjb25zdCBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7DQogICAgICAgIHhtbE5vZGVzLmZvckVhY2goZWxlbWVudCA9PiB7DQogICAgICAgICAgY29uc3QgdGV4dCA9IGVsZW1lbnQuaW5uZXJUZXh0IHx8IGVsZW1lbnQudGV4dENvbnRlbnQ7DQogICAgICAgICAgY29uc3QgeG1sQ29kZSA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcigiY29kZS54bWwiKTsNCiAgICAgICAgICBpZiAoeG1sQ29kZSA9PSBudWxsKSB7DQogICAgICAgICAgICBpZiAoZWxlbWVudC5pbm5lckhUTUwuc3RhcnRzV2l0aCgiUmVxdWVzdDogPCIpICYmIGVsZW1lbnQuaW5uZXJIVE1MLmVuZHNXaXRoKCI+IikpIHsNCiAgICAgICAgICAgICAgYWRkWG1sTm9kZShwYXJzZXIsIGVsZW1lbnQsIGVsZW1lbnQuaW5uZXJIVE1MLnJlcGxhY2UoIlJlcXVlc3Q6IDwiLCAiPCIpLCBjb21tdW5pY2F0aW9uRGlzcGxheVZhbHVlKTsNCiAgICAgICAgICAgICAgdmFyIGNhdGVnb3J5Tm9kZXMgPSBlbGVtZW50LnBhcmVudE5vZGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY2F0ZWdvcnknKTsNCiAgICAgICAgICAgICAgdmFyIGNhdGVnb3J5Tm9kZUFycmF5ID0gQXJyYXkuZnJvbShjYXRlZ29yeU5vZGVzKTsNCiAgICAgICAgICAgICAgY2F0ZWdvcnlOb2RlQXJyYXlbMF0uaW5uZXJUZXh0ID0gY2F0ZWdvcnlOb2RlQXJyYXlbMF0uaW5uZXJUZXh0ICsgJyBSZXF1ZXN0JzsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5pbm5lckhUTUwuc3RhcnRzV2l0aCgiUmVzcG9uc2U6IDwiKSAmJiBlbGVtZW50LmlubmVySFRNTC5lbmRzV2l0aCgiPiIpKSB7DQogICAgICAgICAgICAgIGFkZFhtbE5vZGUocGFyc2VyLCBlbGVtZW50LCBlbGVtZW50LmlubmVySFRNTC5yZXBsYWNlKCJSZXNwb25zZTogPCIsICI8IiksIGNvbW11bmljYXRpb25EaXNwbGF5VmFsdWUpOw0KICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlOb2RlcyA9IGVsZW1lbnQucGFyZW50Tm9kZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjYXRlZ29yeScpOw0KICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlOb2RlQXJyYXkgPSBBcnJheS5mcm9tKGNhdGVnb3J5Tm9kZXMpOw0KICAgICAgICAgICAgICBjYXRlZ29yeU5vZGVBcnJheVswXS5pbm5lclRleHQgPSBjYXRlZ29yeU5vZGVBcnJheVswXS5pbm5lclRleHQgKyAnIFJlc3BvbnNlJzsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAodGV4dC5zdGFydHNXaXRoKCI8IikgJiYgdGV4dC5lbmRzV2l0aCgiPiIpKSB7DQogICAgICAgICAgICAgIGFkZFhtbE5vZGUocGFyc2VyLCBlbGVtZW50LCB0ZXh0LCBjb21tdW5pY2F0aW9uRGlzcGxheVZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgcHJlID0geG1sQ29kZS5wYXJlbnROb2RlOw0KICAgICAgICAgICAgY29uc3QgbmF0aXZlQ29tbXVuaWNhdGlvbiA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcigiZGl2Lm5hdGl2ZSIpOw0KICAgICAgICAgICAgaWYgKG5hdGl2ZUNvbW11bmljYXRpb24pIHsNCiAgICAgICAgICAgICAgaWYgKGNvbW11bmljYXRpb25EaXNwbGF5VmFsdWUgPT0gIm5hdGl2ZSIpIHsNCiAgICAgICAgICAgICAgICBuYXRpdmVDb21tdW5pY2F0aW9uLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOw0KICAgICAgICAgICAgICAgIHByZS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsNCiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ25hdGl2ZScpOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG5hdGl2ZUNvbW11bmljYXRpb24uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7DQogICAgICAgICAgICAgICAgcHJlLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOw0KICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnbmF0aXZlJyk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY29udmVydERJUigpIHsNCiAgICAgIHZhciB0ZXh0Tm9kZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd0ZXh0Jyk7DQogICAgICB2YXIgZGlyTm9kZXMgPSBBcnJheS5mcm9tKHRleHROb2RlcykuZmlsdGVyKG5vZGUgPT4gKG5vZGUuaW5uZXJUZXh0IHx8IG5vZGUudGV4dENvbnRlbnQpLnN1YnN0cmluZygwLCAzKSA9PT0gJ0RJUicpOw0KICAgICAgZGlyTm9kZXMuZm9yRWFjaChlbGVtZW50ID0+IHsNCiAgICAgICAgdmFyIERJUlRyZWUgPSB3c3BhbkRJUi5wYXJzZURJUk1lc3NhZ2UoZWxlbWVudC5pbm5lclRleHQgfHwgZWxlbWVudC50ZXh0Q29udGVudCk7DQogICAgICAgIGlmIChESVJUcmVlKSB7DQogICAgICAgICAgdmFyIHByZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ByZScpOw0KICAgICAgICAgIHZhciBjb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY29kZScpOw0KICAgICAgICAgIGNvZGUuY2xhc3NOYW1lID0gJ3htbCc7DQogICAgICAgICAgcHJlLmFwcGVuZENoaWxkKGNvZGUpOw0KICAgICAgICAgIHZhciBwbGFpblhNTCA9IERJUlRyZWUudG9YTUwoKTsNCiAgICAgICAgICBjcmVhdGVUZXh0RWxlbWVudChjb2RlLCBwbGFpblhNTCk7DQogICAgICAgICAgbW92ZU9yaWdpbmFsKGVsZW1lbnQpOw0KICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQocHJlKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdG9nZ2xlRnVsbFZpZXcoZWxlbWVudCkgew0KICAgICAgdmFyIGJ1dHRvbiA9IGVsZW1lbnQ7DQogICAgICB3aGlsZSAoIWVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCd0ZXh0JykgJiYgZWxlbWVudC5wYXJlbnROb2RlKXsNCiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZTsNCiAgICAgIH0NCiAgICAgIHZhciB0YWxsTm9kZSA9IGVsZW1lbnQ7DQogICAgICB2YXIgdmlzaWJsZUNoaWxkTm9kZXMgPSBBcnJheS5mcm9tKHRhbGxOb2RlLmNoaWxkcmVuKS5maWx0ZXIobm9kZSA9PiAobm9kZS50YWdOYW1lICE9ICdCVVRUT04nICYmICFub2RlLmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykpKTsNCiAgICAgIGlmICh2aXNpYmxlQ2hpbGROb2Rlcy5sZW5ndGggPT0gMSkgew0KICAgICAgICB2YXIgdmlzaWJsZU5vZGUgPSB2aXNpYmxlQ2hpbGROb2Rlc1swXTsNCiAgICAgICAgaWYgKHZpc2libGVOb2RlLmZ1bGxIZWlnaHQpIHsNCiAgICAgICAgICBpZiAodmlzaWJsZU5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb250cmFjdGVkJykpIHsNCiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdleHBhbmRpbmcgdG8gJyArIGVsZW1lbnQuZnVsbEhlaWdodCArICdweCcpOw0KICAgICAgICAgICAgdmlzaWJsZU5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY29udHJhY3RlZCcpOw0KICAgICAgICAgICAgdmlzaWJsZU5vZGUuY2xhc3NMaXN0LmFkZCgnZXhwYW5kZWQnKTsNCiAgICAgICAgICAgIHZpc2libGVOb2RlLnN0eWxlLmhlaWdodCA9IHZpc2libGVOb2RlLmZ1bGxIZWlnaHQgKyAncHgnOw0KICAgICAgICAgICAgYnV0dG9uLmlubmVyVGV4dCA9ICdDb2xsYXBzZSc7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdjb250cmFjdGluZycpOw0KICAgICAgICAgICAgdmlzaWJsZU5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnZXhwYW5kZWQnKTsNCiAgICAgICAgICAgIHZpc2libGVOb2RlLmNsYXNzTGlzdC5hZGQoJ2NvbnRyYWN0ZWQnKTsNCiAgICAgICAgICAgIHZpc2libGVOb2RlLnN0eWxlLmhlaWdodCA9ICc0MHB4JzsNCiAgICAgICAgICAgIGJ1dHRvbi5pbm5lclRleHQgPSAnRXhwYW5kJzsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjb2xsYXBzaWJsZUJ1dHRvbkNsaWNrKGV2dCkgew0KICAgICAgY29uc3Qgc291cmNlID0gZXZ0LnRhcmdldCB8fCBldnQuc3JjRWxlbWVudDsNCiAgICAgIHRvZ2dsZUZ1bGxWaWV3KHNvdXJjZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gaGlkZVRhbGxDb250ZW50KCkgew0KICAgICAgLy8gY29uc29sZS5sb2coJ2hpZGVUYWxsQ29udGVudCcpOw0KICAgICAgdmFyIHRleHROb2RlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3RleHQnKTsNCiAgICAgIHZhciB0YWxsTm9kZXMgPSBBcnJheS5mcm9tKHRleHROb2Rlcyk7DQogICAgICB0YWxsTm9kZXMuZm9yRWFjaCh0YWxsTm9kZSA9PiB7DQogICAgICAgIHZhciB2aXNpYmxlQ2hpbGROb2RlcyA9IEFycmF5LmZyb20odGFsbE5vZGUuY2hpbGRyZW4pLmZpbHRlcihub2RlID0+IChub2RlLnRhZ05hbWUgIT0gJ0JVVFRPTicgJiYgIW5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKSkpOw0KICAgICAgICB2YXIgYnV0dG9uID0gdGFsbE5vZGUucXVlcnlTZWxlY3RvcigiYnV0dG9uIik7DQogICAgICAgIGlmICh2aXNpYmxlQ2hpbGROb2Rlcy5sZW5ndGggPT0gMSkgew0KICAgICAgICAgIHZhciB2aXNpYmxlTm9kZSA9IHZpc2libGVDaGlsZE5vZGVzWzBdOw0KICAgICAgICAgIGlmICh2aXNpYmxlTm9kZS5vZmZzZXRIZWlnaHQgPiA0MCkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiB2aXNpYmxlTm9kZS5mdWxsSGVpZ2h0ID09ICd1bmRlZmluZWQnKSB7DQogICAgICAgICAgICAgIHZpc2libGVOb2RlLmZ1bGxIZWlnaHQgPSB2aXNpYmxlTm9kZS5vZmZzZXRIZWlnaHQ7DQogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCIxIHZpc2libGUgY2hpbGQuIEhlaWdodDogIiArIHZpc2libGVOb2RlLm9mZnNldEhlaWdodCk7DQogICAgICAgICAgICAgIC8vIHZpc2libGVOb2RlLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJzsNCiAgICAgICAgICAgICAgaWYgKGJ1dHRvbikgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdidXR0b24gYWxyZWFkeSBleGlzdHMnKQ0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOw0KICAgICAgICAgICAgICAgIGJ1dHRvbi5pbm5lclRleHQgPSAiQ29sbGFwc2UiOw0KICAgICAgICAgICAgICAgIHRhbGxOb2RlLmFwcGVuZENoaWxkKGJ1dHRvbik7DQogICAgICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgY29sbGFwc2libGVCdXR0b25DbGljaywgdHJ1ZSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdG9nZ2xlRnVsbFZpZXcoYnV0dG9uKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2aXNpYmxlTm9kZS5mdWxsSGVpZ2h0ID09ICd1bmRlZmluZWQnKSB7DQogICAgICAgICAgICBpZiAoYnV0dG9uKSB7DQogICAgICAgICAgICAgIGJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIGlmICh2aXNpYmxlQ2hpbGROb2Rlcy5sZW5ndGggPT0gMCkgew0KICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCIwIGNoaWxkcmVuLiIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGNvbnNvbGUubG9nKCJNb3JlIHRoYW4gMSB0YWxsIG5vZGUgaW4gaGlkZVRhbGxDb250ZW50Iik7DQogICAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCB0YWxsTm9kZS5jaGlsZHJlbi5sZW5ndGg7IG4rKykgew0KICAgICAgICAgICAgY29uc29sZS5sb2codGFsbE5vZGUuY2hpbGRyZW5bbl0pOw0KICAgICAgICAgICAgY29uc29sZS5sb2coImNoaWxkTm9kZXNbIiArIG4gKyAiXS50YWdOYW1lOiAiICsgdGFsbE5vZGUuY2hpbGRyZW5bbl0udGFnTmFtZSk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygiY2hpbGROb2Rlc1siICsgbiArICJdLmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJyk6ICIgKyB0YWxsTm9kZS5jaGlsZHJlbltuXS5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIC8vaHR0cDovL2pzZmlkZGxlLm5ldC8wR2lTMC9uRFZZZC8NCiAgICB3aW5kb3cub25sb2FkID0gZnVuY3Rpb24gKCkgew0KICAgICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYjFsaW5rJyksICdjbGljaycsIHJlc2l6ZURhdGEpOw0KICAgICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYjJsaW5rJyksICdjbGljaycsIHJlc2l6ZURhdGEpOw0KICAgICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYjNsaW5rJyksICdjbGljaycsIHJlc2l6ZURhdGEpOw0KICAgICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYjRsaW5rJyksICdjbGljaycsIHJlc2l6ZURhdGEpOw0KDQogICAgICBhZGRFdmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsdGVyJyksICdzdWJtaXQnLCBhcHBseUZpbHRlcnMpOw0KICAgICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyX2ZpbHRlcnNfYnRuJyksICdjbGljaycsIGNsZWFyRmlsdGVycyk7DQogICAgICBhZGRFdmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoJyksICdzdWJtaXQnLCBhcHBseVNlYXJjaCk7DQogICAgICBhZGRFdmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXJfc2VhcmNoX2J0bicpLCAnY2xpY2snLCBjbGVhclNlYXJjaCk7DQogICAgICBpbml0Q29sdW1ucygpOw0KICAgICAgaW5pdENvbW11bmljYXRpb25WaWV3KCk7DQogICAgICB1cGRhdGVJbmZvKCk7DQogICAgICByZXNpemVEYXRhKCk7DQogICAgICBwcm9jZXNzTG9nVGV4dChgJUxPR1RFWFQlYCk7DQogICAgICBzaG93SW5mbygpOw0KICAgIH0NCg0KICAgIHdpbmRvdy5vbnJlc2l6ZSA9IHJlc2l6ZURhdGE7DQoNCiAgICBmdW5jdGlvbiByZXNpemVEYXRhKCkgew0KICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICByZXNpemVFbGVtZW50SGVpZ2h0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRhJykpDQogICAgICB9LCA1MCk7DQogICAgfQ0KDQogICAgLyoqIGluZm8gKiovDQogICAgdmFyIGluZm8gPSB7DQogICAgICBmaWxlTmFtZTogJyVGSUxFTkFNRSUnLA0KICAgICAgc2VhcmNoVGV4dDogJycsDQogICAgICBzZWFyY2hDb2x1bW5zOiBbXSwNCiAgICAgIGZpbHRlcnM6IFtdDQogICAgfTsNCg0KICAgIGZ1bmN0aW9uIHNob3dJbmZvKCkgew0KICAgICAgdXBkYXRlSW5mbygpOw0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYjRsaW5rJykuY2xpY2soKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB1cGRhdGVJbmZvKCkgew0KICAgICAgdmFyIGZpbGVOYW1lRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luZm9GaWxlbmFtZScpOw0KICAgICAgZmlsZU5hbWVEaXYuaW5uZXJUZXh0ID0gaW5mby5maWxlTmFtZTsNCiAgICAgIHZhciBzZWFyY2hEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5mb1NlYXJjaCcpOw0KICAgICAgdmFyIHNlYXJjaENvbHVtbnNEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5mb1NlYXJjaENvbHVtbnMnKTsNCiAgICAgIGlmIChpbmZvLnNlYXJjaFRleHQubGVuZ3RoID09IDApIHsNCiAgICAgICAgc2VhcmNoRGl2LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOw0KICAgICAgICBzZWFyY2hDb2x1bW5zRGl2LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc2VhcmNoRGl2LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOw0KICAgICAgICB2YXIgc2VhcmNoVGV4dERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvU2VhcmNoVGV4dCcpOw0KICAgICAgICBzZWFyY2hUZXh0RGl2LmlubmVyVGV4dCA9IGluZm8uc2VhcmNoVGV4dDsNCiAgICAgICAgc2VhcmNoQ29sdW1uc0Rpdi5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsNCiAgICAgICAgdmFyIHNlYXJjaENvbHVtbnNUZXh0RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luZm9TZWFyY2hDb2x1bW5zVGV4dCcpOw0KICAgICAgICBpZiAoaW5mby5zZWFyY2hDb2x1bW5zLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICBzZWFyY2hDb2x1bW5zVGV4dERpdi5pbm5lclRleHQgPSBpbmZvLnNlYXJjaENvbHVtbnMuam9pbignLCAnKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzZWFyY2hDb2x1bW5zVGV4dERpdi5pbm5lclRleHQgPSAnQWxsJzsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgdmFyIGZpbHRlckRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvRmlsdGVyJyk7DQogICAgICBpZiAoaW5mby5maWx0ZXJzLmxlbmd0aCA9PSAwKSB7DQogICAgICAgIGZpbHRlckRpdi5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGZpbHRlckRpdi5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsNCiAgICAgICAgdmFyIGZpbHRlclRleHREaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5mb0ZpbHRlclRleHQnKTsNCiAgICAgICAgZmlsdGVyVGV4dERpdi5pbm5lckhUTUwgPSBpbmZvLmZpbHRlcnMuam9pbignIGFuZCAnKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAvKiogU2V0dGluZ3MgKiovDQogICAgZnVuY3Rpb24gaW5pdENvbHVtbnMoKSB7DQogICAgICB2YXIgdGJsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2RhdGEgPiB0YWJsZScpOw0KICAgICAgdmFyIGNvbHMgPSBBcnJheS5mcm9tKHRibC5xdWVyeVNlbGVjdG9yQWxsKCdjb2wnKSk7DQogICAgICBjb2xzLmZvckVhY2goY29sID0+IHsNCiAgICAgICAgdmFyIGNvbE5hbWUgPSBjb2wuY2xhc3NOYW1lOw0KICAgICAgICB2YXIgY2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb2xOYW1lICsgJ29ub2Zmc3dpdGNoJyk7DQogICAgICAgIGlmIChjaGVja2JveCkgew0KICAgICAgICAgIHZhciBkaXNwbGF5TW9kZSA9IChjaGVja2JveC5jaGVja2VkKSA/ICd0YWJsZS1jZWxsJyA6ICdub25lJzsNCiAgICAgICAgICBBcnJheS5mcm9tKHRibC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGNvbE5hbWUpKS5mb3JFYWNoKGNlbGwgPT4gY2VsbC5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheU1vZGUpOw0KICAgICAgICAgIGFkZEV2ZW50KGNoZWNrYm94LCAnY2hhbmdlJywgdG9nZ2xlQ29sdW1uKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdXBkYXRlQ29sdW1ucygpIHsNCiAgICAgIHZhciB0YmwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZGF0YSA+IHRhYmxlJyk7DQogICAgICB2YXIgY29scyA9IEFycmF5LmZyb20odGJsLnF1ZXJ5U2VsZWN0b3JBbGwoJ2NvbCcpKTsNCiAgICAgIGNvbHMuZm9yRWFjaChjb2wgPT4gew0KICAgICAgICB2YXIgY29sTmFtZSA9IGNvbC5jbGFzc05hbWU7DQogICAgICAgIHZhciBjaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbE5hbWUgKyAnb25vZmZzd2l0Y2gnKTsNCiAgICAgICAgaWYgKGNoZWNrYm94KSB7DQogICAgICAgICAgdmFyIGRpc3BsYXlNb2RlID0gKGNoZWNrYm94LmNoZWNrZWQpID8gJ3RhYmxlLWNlbGwnIDogJ25vbmUnOw0KICAgICAgICAgIEFycmF5LmZyb20odGJsLnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgY29sTmFtZSkpLmZvckVhY2goY2VsbCA9PiBjZWxsLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5TW9kZSk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHRvZ2dsZUNvbHVtbihldnQpIHsNCiAgICAgIHZhciBjaGVja2JveCA9IGV2dC50YXJnZXQ7DQogICAgICB2YXIgY29sTmFtZSA9IGNoZWNrYm94LmlkLnJlcGxhY2UoJ29ub2Zmc3dpdGNoJywgJycpOw0KICAgICAgdmFyIHRibCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkYXRhID4gdGFibGUnKTsNCiAgICAgIHZhciBkaXNwbGF5TW9kZSA9IChjaGVja2JveC5jaGVja2VkKSA/ICd0YWJsZS1jZWxsJyA6ICdub25lJzsNCiAgICAgIEFycmF5LmZyb20odGJsLnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgY29sTmFtZSkpLmZvckVhY2goY2VsbCA9PiBjZWxsLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5TW9kZSk7DQogICAgICByZXNpemVEYXRhKCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gaW5pdENvbW11bmljYXRpb25WaWV3KCkgew0KICAgICAgdmFyIGJ1dHRvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSgnY29tbXVuaWNhdGlvbkRpc3BsYXknKTsNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnV0dG9ucy5sZW5ndGg7IGkrKykgew0KICAgICAgICBidXR0b25zW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHVwZGF0ZUNvbW11bmljYXRpb25WaWV3KTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiB1cGRhdGVDb21tdW5pY2F0aW9uVmlldyhldnQpIHsNCiAgICAgIGZvcm1hdFhtbCgpOw0KICAgICAgaGlkZVRhbGxDb250ZW50KCk7DQogICAgfQ0KDQogICAgLyoqIFNlYXJjaCAqKi8NCiAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMTgyMTI2MS9ob3ctdG8tZ2V0LWFsbC1zZWxlY3RlZC12YWx1ZXMtZnJvbS1zZWxlY3QtbXVsdGlwbGUtbXVsdGlwbGUNCiAgICBmdW5jdGlvbiBnZXRTZWxlY3RWYWx1ZXMoc2VsZWN0KSB7DQogICAgICB2YXIgcmVzdWx0ID0gW107DQogICAgICB2YXIgb3B0aW9ucyA9IHNlbGVjdCAmJiBzZWxlY3Qub3B0aW9uczsNCiAgICAgIHZhciBvcHQ7DQoNCiAgICAgIGZvciAodmFyIGkgPSAwLCBpTGVuID0gb3B0aW9ucy5sZW5ndGg7IGkgPCBpTGVuOyBpKyspIHsNCiAgICAgICAgb3B0ID0gb3B0aW9uc1tpXTsNCg0KICAgICAgICBpZiAob3B0LnNlbGVjdGVkKSB7DQogICAgICAgICAgcmVzdWx0LnB1c2gob3B0LnZhbHVlIHx8IG9wdC50ZXh0KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQoNCiAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMjgwMjczOS9kZXNlbGVjdC1zZWxlY3RlZC1vcHRpb25zLWluLXNlbGVjdC1tZW51LXdpdGgtbXVsdGlwbGUtYW5kLW9wdGdyb3Vwcw0KICAgIGZ1bmN0aW9uIGNsZWFyU2VsZWN0ZWQoc2VsZWN0KSB7DQogICAgICB2YXIgb3B0aW9ucyA9IHNlbGVjdCAmJiBzZWxlY3Qub3B0aW9uczsNCg0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIG9wdGlvbnNbaV0uc2VsZWN0ZWQgPSBmYWxzZTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhcHBseVNlYXJjaChlKSB7DQogICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICB2YXIgY29sdW1ucyA9IGdldFNlbGVjdFZhbHVlcyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9jb2x1bW4nKSk7DQogICAgICB2YXIgc2VhcmNoVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3NlYXJjaCcpLnZhbHVlOw0KICAgICAgaWYgKGNvbHVtbnMubGVuZ3RoID4gMCkgew0KICAgICAgICBsb2dUYWJsZS5zZWFyY2goc2VhcmNoVGV4dCwgY29sdW1ucyk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBsb2dUYWJsZS5zZWFyY2goc2VhcmNoVGV4dCk7DQogICAgICB9DQogICAgICBpbmZvLnNlYXJjaENvbHVtbnMgPSBjb2x1bW5zOw0KICAgICAgaW5mby5zZWFyY2hUZXh0ID0gc2VhcmNoVGV4dDsNCiAgICAgIHNob3dJbmZvKCk7DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2xlYXJTZWFyY2goKSB7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9zZWFyY2gnKS52YWx1ZSA9ICcnOw0KICAgICAgY29sdW1uQ2hvaWNlcy5yZW1vdmVBY3RpdmVJdGVtcygpOw0KICAgICAgaW5mby5zZWFyY2hDb2x1bW5zID0gW107DQogICAgICBpbmZvLnNlYXJjaFRleHQgPSAnJzsNCiAgICAgIHVwZGF0ZUluZm8oKTsNCiAgICAgIGxvZ1RhYmxlLnNlYXJjaCgpOyAvLyBTaG93IGFsbCBpdGVtcyBpbiBsaXN0DQogICAgfQ0KDQogICAgLyoqIEVuZCBzZWFyY2ggKiovDQoNCiAgICAvKiogZmlsdGVycyAqKi8NCiAgICAvLyBpbml0IGRhdGVwaWNrZXJzOg0KICAgIGZsYXRwaWNrcigiLmRhdGVwaWNrZXIiLCB7DQogICAgICBlbmFibGVUaW1lOiB0cnVlLA0KICAgICAgZGF0ZUZvcm1hdDogIlktbS1kIEg6aSINCiAgICB9KTsNCg0KICAgIGNvbnN0IGNvbHVtbkNob2ljZXMgPSBuZXcgQ2hvaWNlcygnI3FfY29sdW1uJywgew0KICAgICAgcmVtb3ZlSXRlbUJ1dHRvbjogdHJ1ZSwNCiAgICAgIGR1cGxpY2F0ZUl0ZW1zQWxsb3dlZDogZmFsc2UNCiAgICB9KQ0KICAgIGNvbnN0IHdvcmtlckNob2ljZXMgPSBuZXcgQ2hvaWNlcygnI3Ffd29ya2VyJywgew0KICAgICAgZHVwbGljYXRlSXRlbXNBbGxvd2VkOiBmYWxzZQ0KICAgIH0pOw0KICAgIGNvbnN0IHdvcmtzdGF0aW9uQ2hvaWNlcyA9IG5ldyBDaG9pY2VzKCcjcV93b3Jrc3RhdGlvbicsIHsNCiAgICAgIGR1cGxpY2F0ZUl0ZW1zQWxsb3dlZDogZmFsc2UNCiAgICB9KTsNCiAgICBjb25zdCB3b3JrZmxvd0Nob2ljZXMgPSBuZXcgQ2hvaWNlcygnI3Ffd29ya2Zsb3cnLCB7DQogICAgICBkdXBsaWNhdGVJdGVtc0FsbG93ZWQ6IGZhbHNlDQogICAgfSk7DQogICAgY29uc3QgcHJvY2Vzc0Nob2ljZXMgPSBuZXcgQ2hvaWNlcygnI3FfcHJvY2VzcycsIHsNCiAgICAgIGR1cGxpY2F0ZUl0ZW1zQWxsb3dlZDogZmFsc2UNCiAgICB9KTsNCiAgICBjb25zdCBjYXRlZ29yeUNob2ljZXMgPSBuZXcgQ2hvaWNlcygnI3FfY2F0ZWdvcnknLCB7DQogICAgICBkdXBsaWNhdGVJdGVtc0FsbG93ZWQ6IGZhbHNlDQogICAgfSk7DQogICAgY29uc3QgbGV2ZWxDaG9pY2VzID0gbmV3IENob2ljZXMoJyNxX2xldmVsJywgew0KICAgICAgZHVwbGljYXRlSXRlbXNBbGxvd2VkOiBmYWxzZQ0KICAgIH0pOw0KDQogICAgZnVuY3Rpb24gcG9wdWxhdGVDaG9pY2VzKGNob2ljZUJveCwgdmFsdWVzKSB7DQogICAgICBjaG9pY2VzID0gdmFsdWVzLm1hcCgodmFsKSA9PiB7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgdmFsdWU6IHZhbC50b1N0cmluZygpLA0KICAgICAgICAgIGxhYmVsOiB2YWwudG9TdHJpbmcoKSwNCiAgICAgICAgICBzZWxlY3RlZDogZmFsc2UNCiAgICAgICAgfTsNCiAgICAgIH0pOw0KICAgICAgY2hvaWNlcy51bnNoaWZ0KHsNCiAgICAgICAgdmFsdWU6ICdBbGwnLA0KICAgICAgICBsYWJlbDogJ0FsbCcsDQogICAgICAgIHNlbGVjdGVkOiB0cnVlDQogICAgICB9KTsNCiAgICAgIGNob2ljZUJveC5zZXRDaG9pY2VzKGNob2ljZXMsICd2YWx1ZScsICdsYWJlbCcsIHRydWUpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJlbW92ZU9wdGlvbnMoc2VsZWN0Ym94KSB7DQogICAgICB2YXIgaTsNCiAgICAgIGZvciAoaSA9IHNlbGVjdGJveC5vcHRpb25zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7DQogICAgICAgIHNlbGVjdGJveC5yZW1vdmUoaSk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYWRkT3B0aW9uKHNlbGVjdCwgdGV4dCwgdmFsdWUsIHNlbGVjdGVkKSB7DQogICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsNCiAgICAgIGVsLnRleHRDb250ZW50ID0gdGV4dDsNCiAgICAgIGVsLnZhbHVlID0gdmFsdWU7DQogICAgICBlbC5zZWxlY3RlZCA9IHNlbGVjdGVkOw0KICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKGVsKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwb3B1bGF0ZVNlbGVjdChlbGVtZW50SWQsIHZhbHVlcykgew0KICAgICAgdmFyIHNlbGVjdEJveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7DQogICAgICByZW1vdmVPcHRpb25zKHNlbGVjdEJveCk7DQogICAgICBhZGRPcHRpb24oc2VsZWN0Qm94LCAnQWxsJywgJ0FsbCcsIHRydWUpOw0KDQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICB2YXIgb3B0ID0gdmFsdWVzW2ldOw0KICAgICAgICBhZGRPcHRpb24oc2VsZWN0Qm94LCBvcHQsIG9wdCwgZmFsc2UpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGJ1aWxkRmlsdGVycyhsb2dUYWJsZSkgew0KICAgICAgbGV0IHdvcmtlcnMgPSBbLi4ubmV3IFNldChsb2dUYWJsZS5tYXAoaXRlbSA9PiBpdGVtLndvcmtlcikpXS5zb3J0KCk7DQogICAgICBwb3B1bGF0ZVNlbGVjdCgncV93b3JrZXInLCB3b3JrZXJzKTsNCiAgICAgIHBvcHVsYXRlQ2hvaWNlcyh3b3JrZXJDaG9pY2VzLCB3b3JrZXJzKTsNCiAgICAgIGxldCB3b3Jrc3RhdGlvbnMgPSBbLi4ubmV3IFNldChsb2dUYWJsZS5tYXAoaXRlbSA9PiBpdGVtLndvcmtzdGF0aW9uKSldLnNvcnQoKTsNCiAgICAgIHBvcHVsYXRlU2VsZWN0KCdxX3dvcmtzdGF0aW9uJywgd29ya3N0YXRpb25zKTsNCiAgICAgIHBvcHVsYXRlQ2hvaWNlcyh3b3Jrc3RhdGlvbkNob2ljZXMsIHdvcmtzdGF0aW9ucyk7DQogICAgICBsZXQgd29ya2Zsb3dzID0gWy4uLm5ldyBTZXQobG9nVGFibGUubWFwKGl0ZW0gPT4gaXRlbS53b3JrZmxvdykpXS5zb3J0KCk7DQogICAgICBwb3B1bGF0ZVNlbGVjdCgncV93b3JrZmxvdycsIHdvcmtmbG93cyk7DQogICAgICBwb3B1bGF0ZUNob2ljZXMod29ya2Zsb3dDaG9pY2VzLCB3b3JrZmxvd3MpOw0KICAgICAgbGV0IHByb2Nlc3NlcyA9IFsuLi5uZXcgU2V0KGxvZ1RhYmxlLm1hcChpdGVtID0+IGl0ZW0ucHJvY2VzcykpXS5zb3J0KCk7DQogICAgICBwb3B1bGF0ZVNlbGVjdCgncV9wcm9jZXNzJywgcHJvY2Vzc2VzKTsNCiAgICAgIHBvcHVsYXRlQ2hvaWNlcyhwcm9jZXNzQ2hvaWNlcywgcHJvY2Vzc2VzKTsNCiAgICAgIGxldCBjYXRlZ29yaWVzID0gWy4uLm5ldyBTZXQobG9nVGFibGUubWFwKGl0ZW0gPT4gaXRlbS5jYXRlZ29yeSkpXS5zb3J0KCk7DQogICAgICBwb3B1bGF0ZVNlbGVjdCgncV9jYXRlZ29yeScsIGNhdGVnb3JpZXMpOw0KICAgICAgcG9wdWxhdGVDaG9pY2VzKGNhdGVnb3J5Q2hvaWNlcywgY2F0ZWdvcmllcyk7DQogICAgICBsZXQgbGV2ZWxzID0gWy4uLm5ldyBTZXQobG9nVGFibGUubWFwKGl0ZW0gPT4gaXRlbS5sZXZlbCkpXS5zb3J0KCk7DQogICAgICBwb3B1bGF0ZVNlbGVjdCgncV9sZXZlbCcsIGxldmVscyk7DQogICAgICBwb3B1bGF0ZUNob2ljZXMobGV2ZWxDaG9pY2VzLCBsZXZlbHMpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdldEludGVnZXJWYWx1ZShlbGVtZW50SWQpIHsNCiAgICAgIHZhciBmb3JtVmFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKS52YWx1ZTsNCiAgICAgIGlmIChOdW1iZXIuaXNOYU4oZm9ybVZhbCkpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gbmV3IE51bWJlcihmb3JtVmFsKS52YWx1ZU9mKCk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2VsZWN0VmFsdWUoZWxlbWVudElkKSB7DQogICAgICB2YXIgc2VsZWN0Qm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKTsNCiAgICAgIHJldHVybiBzZWxlY3RCb3gub3B0aW9uc1tzZWxlY3RCb3guc2VsZWN0ZWRJbmRleF0udmFsdWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2VsZWN0RmlsdGVyKGVsZW1lbnRJZCkgew0KICAgICAgdmFyIHZhbHVlID0gc2VsZWN0VmFsdWUoZWxlbWVudElkKTsNCiAgICAgIGlmICh2YWx1ZSA9PSAnQWxsJykgew0KICAgICAgICByZXR1cm4gdHJ1ZUZpbHRlcjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsKSB7DQogICAgICAgICAgcmV0dXJuICh2YWwgPT0gdmFsdWUpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdHJ1ZUZpbHRlcigpIHsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGxlc3NUaGFuRmlsdGVyKHVwcGVyTGltaXQpIHsNCiAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsKSB7DQogICAgICAgIHJldHVybiAodmFsIDw9IHVwcGVyTGltaXQpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGdyZWF0ZXJUaGFuRmlsdGVyKGxvd2VyTGltaXQpIHsNCiAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsKSB7DQogICAgICAgIHJldHVybiAodmFsID49IGxvd2VyTGltaXQpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGJldHdlZW5GaWx0ZXIobG93ZXJMaW1pdCwgdXBwZXJMaW1pdCkgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWwpIHsNCiAgICAgICAgcmV0dXJuICh2YWwgPj0gbG93ZXJMaW1pdCAmJiB2YWwgPD0gdXBwZXJMaW1pdCk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2VsZWN0RmlsdGVyVGV4dChmaWx0ZXJzLCBlbGVtZW50TmFtZSwgZWxlbWVudElkKSB7DQogICAgICB2YXIgdmFsdWUgPSBzZWxlY3RWYWx1ZShlbGVtZW50SWQpOw0KICAgICAgaWYgKHZhbHVlICE9ICdBbGwnKSB7DQogICAgICAgIGZpbHRlcnMucHVzaChgPGI+JHtlbGVtZW50TmFtZX08L2I+IGlzICIke3ZhbHVlfSJgKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhcHBseUZpbHRlcnMoZSkgew0KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgaW5mby5maWx0ZXJzID0gW107DQogICAgICB2YXIgbGluZUZpbHRlcjsNCiAgICAgIHZhciBkYXRlRmlsdGVyOw0KICAgICAgdmFyIGxpbmVHcmVhdGVyVGhhbiA9IGdldEludGVnZXJWYWx1ZSgncV9saW5lX251bWJlcl9ndGVxJyk7DQogICAgICB2YXIgbGluZUxlc3NUaGFuID0gZ2V0SW50ZWdlclZhbHVlKCdxX2xpbmVfbnVtYmVyX2x0ZXEnKTsNCiAgICAgIGlmIChsaW5lTGVzc1RoYW4gPT0gMCAmJiBsaW5lR3JlYXRlclRoYW4gPT0gMCkgew0KICAgICAgICBsaW5lRmlsdGVyID0gdHJ1ZUZpbHRlcjsNCiAgICAgIH0gZWxzZSBpZiAobGluZUxlc3NUaGFuID09IDApIHsNCiAgICAgICAgbGluZUZpbHRlciA9IGdyZWF0ZXJUaGFuRmlsdGVyKGxpbmVHcmVhdGVyVGhhbik7DQogICAgICAgIGluZm8uZmlsdGVycy5wdXNoKGA8Yj5MaW5lIG51bWJlcjwvYj4gaXMgZ3JlYXRlciB0aGFuICR7bGluZUdyZWF0ZXJUaGFufWApOw0KICAgICAgfSBlbHNlIGlmIChsaW5lR3JlYXRlclRoYW4gPT0gMCkgew0KICAgICAgICBsaW5lRmlsdGVyID0gbGVzc1RoYW5GaWx0ZXIobGluZUxlc3NUaGFuKTsNCiAgICAgICAgaW5mby5maWx0ZXJzLnB1c2goYDxiPkxpbmUgbnVtYmVyPC9iPiBpcyBsZXNzIHRoYW4gJHtsaW5lTGVzc1RoYW59YCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBsaW5lRmlsdGVyID0gYmV0d2VlbkZpbHRlcihsaW5lR3JlYXRlclRoYW4sIGxpbmVMZXNzVGhhbik7DQogICAgICAgIGluZm8uZmlsdGVycy5wdXNoKGA8Yj5MaW5lIG51bWJlcjwvYj4gaXMgYmV0d2VlbiAke2xpbmVMZXNzVGhhbn0gYW5kICR7bGluZUdyZWF0ZXJUaGFufWApOw0KICAgICAgfQ0KICAgICAgdmFyIHdvcmtlckZpbHRlciA9IHNlbGVjdEZpbHRlcigncV93b3JrZXInKTsNCiAgICAgIHNlbGVjdEZpbHRlclRleHQoaW5mby5maWx0ZXJzLCAnV29ya2VyJywgJ3Ffd29ya2VyJyk7DQogICAgICB2YXIgd29ya3N0YXRpb25GaWx0ZXIgPSBzZWxlY3RGaWx0ZXIoJ3Ffd29ya3N0YXRpb24nKTsNCiAgICAgIHNlbGVjdEZpbHRlclRleHQoaW5mby5maWx0ZXJzLCAnV29ya3N0YXRpb24nLCAncV93b3Jrc3RhdGlvbicpOw0KICAgICAgdmFyIHdvcmtmbG93RmlsdGVyID0gc2VsZWN0RmlsdGVyKCdxX3dvcmtmbG93Jyk7DQogICAgICBzZWxlY3RGaWx0ZXJUZXh0KGluZm8uZmlsdGVycywgJ1dvcmtmbG93JywgJ3Ffd29ya2Zsb3cnKTsNCiAgICAgIHZhciBwcm9jZXNzRmlsdGVyID0gc2VsZWN0RmlsdGVyKCdxX3Byb2Nlc3MnKTsNCiAgICAgIHNlbGVjdEZpbHRlclRleHQoaW5mby5maWx0ZXJzLCAnUHJvY2VzcycsICdxX3Byb2Nlc3MnKTsNCiAgICAgIHZhciBjYXRlZ29yeUZpbHRlciA9IHNlbGVjdEZpbHRlcigncV9jYXRlZ29yeScpOw0KICAgICAgc2VsZWN0RmlsdGVyVGV4dChpbmZvLmZpbHRlcnMsICdDYXRlZ29yeScsICdxX2NhdGVnb3J5Jyk7DQogICAgICB2YXIgbGV2ZWxGaWx0ZXIgPSBzZWxlY3RGaWx0ZXIoJ3FfbGV2ZWwnKTsNCiAgICAgIHNlbGVjdEZpbHRlclRleHQoaW5mby5maWx0ZXJzLCAnTGV2ZWwnLCAncV9sZXZlbCcpOw0KICAgICAgdmFyIGRhdGVHcmVhdGVyVGhhbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX2RhdGVfdGltZV9ndGVxJykudmFsdWU7DQogICAgICB2YXIgZGF0ZUxlc3NUaGFuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FfZGF0ZV90aW1lX2x0ZXEnKS52YWx1ZTsNCiAgICAgIGlmIChkYXRlR3JlYXRlclRoYW4gIT0gJycgJiYgZGF0ZUxlc3NUaGFuICE9ICcnKSB7DQogICAgICAgIGRhdGVGaWx0ZXIgPSBiZXR3ZWVuRmlsdGVyKG5ldyBEYXRlKGRhdGVHcmVhdGVyVGhhbiksIG5ldyBEYXRlKGRhdGVMZXNzVGhhbikpOw0KICAgICAgICBpbmZvLmZpbHRlcnMucHVzaChgPGI+RGF0ZS9UaW1lPC9iPiBpcyBiZXR3ZWVuICR7ZGF0ZUxlc3NUaGFufSBhbmQgJHtkYXRlR3JlYXRlclRoYW59YCk7DQogICAgICB9IGVsc2UgaWYgKGRhdGVHcmVhdGVyVGhhbiAhPSAnJykgew0KICAgICAgICBkYXRlRmlsdGVyID0gZ3JlYXRlclRoYW5GaWx0ZXIobmV3IERhdGUoZGF0ZUdyZWF0ZXJUaGFuKSk7DQogICAgICAgIGluZm8uZmlsdGVycy5wdXNoKGA8Yj5EYXRlL1RpbWU8L2I+IGlzIGdyZWF0ZXIgdGhhbiAke2RhdGVHcmVhdGVyVGhhbn1gKTsNCiAgICAgIH0gZWxzZSBpZiAoZGF0ZUxlc3NUaGFuICE9ICcnKSB7DQogICAgICAgIGRhdGVGaWx0ZXIgPSBsZXNzVGhhbkZpbHRlcihuZXcgRGF0ZShkYXRlTGVzc1RoYW4pKTsNCiAgICAgICAgaW5mby5maWx0ZXJzLnB1c2goYDxiPkRhdGUvVGltZTwvYj4gaXMgbGVzcyB0aGFuICR7ZGF0ZUxlc3NUaGFufWApOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZGF0ZUZpbHRlciA9IHRydWVGaWx0ZXI7DQogICAgICB9DQogICAgICBsb2dUYWJsZS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgaXRlbVZhbHVlcyA9IGl0ZW0udmFsdWVzKCk7DQogICAgICAgIHZhciBsaW5lSW5Cb3VuZHMgPSBsaW5lRmlsdGVyKGl0ZW1WYWx1ZXMubGluZU51bWJlcik7DQogICAgICAgIHZhciB3b3JrZXJWYWxpZCA9IHdvcmtlckZpbHRlcihpdGVtVmFsdWVzLndvcmtlcik7DQogICAgICAgIHZhciB3b3Jrc3RhdGlvblZhbGlkID0gd29ya3N0YXRpb25GaWx0ZXIoaXRlbVZhbHVlcy53b3Jrc3RhdGlvbik7DQogICAgICAgIHZhciB3b3JrZmxvd1ZhbGlkID0gd29ya2Zsb3dGaWx0ZXIoaXRlbVZhbHVlcy53b3JrZmxvdyk7DQogICAgICAgIHZhciBwcm9jZXNzVmFsaWQgPSBwcm9jZXNzRmlsdGVyKGl0ZW1WYWx1ZXMucHJvY2Vzcyk7DQogICAgICAgIHZhciBjYXRlZ29yeVZhbGlkID0gY2F0ZWdvcnlGaWx0ZXIoaXRlbVZhbHVlcy5jYXRlZ29yeSk7DQogICAgICAgIHZhciBsZXZlbFZhbGlkID0gbGV2ZWxGaWx0ZXIoaXRlbVZhbHVlcy5sZXZlbCk7DQogICAgICAgIHZhciBkYXRlVmFsaWQgPSBkYXRlRmlsdGVyKGl0ZW1WYWx1ZXMuZGF0ZVRpbWUpOw0KICAgICAgICByZXR1cm4gbGluZUluQm91bmRzICYmIHdvcmtlclZhbGlkICYmIHdvcmtzdGF0aW9uVmFsaWQgJiYgd29ya2Zsb3dWYWxpZCAmJiBwcm9jZXNzVmFsaWQgJiYgY2F0ZWdvcnlWYWxpZCAmJg0KICAgICAgICAgIGxldmVsVmFsaWQgJiYgZGF0ZVZhbGlkOw0KICAgICAgfSk7DQogICAgICBzaG93SW5mbygpOw0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNsZWFyRmlsdGVycygpIHsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX2xpbmVfbnVtYmVyX2d0ZXEnKS52YWx1ZSA9ICcnOw0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FfbGluZV9udW1iZXJfbHRlcScpLnZhbHVlID0gJyc7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV93b3JrZXInKS52YWx1ZSA9ICdBbGwnOw0KICAgICAgd29ya2VyQ2hvaWNlcy5zZXRDaG9pY2VCeVZhbHVlKCdBbGwnKTsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3dvcmtzdGF0aW9uJykudmFsdWUgPSAnQWxsJzsNCiAgICAgIHdvcmtzdGF0aW9uQ2hvaWNlcy5zZXRDaG9pY2VCeVZhbHVlKCdBbGwnKTsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3dvcmtmbG93JykudmFsdWUgPSAnQWxsJzsNCiAgICAgIHdvcmtmbG93Q2hvaWNlcy5zZXRDaG9pY2VCeVZhbHVlKCdBbGwnKTsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3Byb2Nlc3MnKS52YWx1ZSA9ICdBbGwnOw0KICAgICAgcHJvY2Vzc0Nob2ljZXMuc2V0Q2hvaWNlQnlWYWx1ZSgnQWxsJyk7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9jYXRlZ29yeScpLnZhbHVlID0gJ0FsbCc7DQogICAgICBjYXRlZ29yeUNob2ljZXMuc2V0Q2hvaWNlQnlWYWx1ZSgnQWxsJyk7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9sZXZlbCcpLnZhbHVlID0gJ0FsbCc7DQogICAgICBsZXZlbENob2ljZXMuc2V0Q2hvaWNlQnlWYWx1ZSgnQWxsJyk7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9kYXRlX3RpbWVfZ3RlcScpLnZhbHVlID0gJyc7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9kYXRlX3RpbWVfbHRlcScpLnZhbHVlID0gJyc7DQogICAgICBpbmZvLmZpbHRlcnMgPSBbXTsNCiAgICAgIHVwZGF0ZUluZm8oKTsNCiAgICAgIGxvZ1RhYmxlLmZpbHRlcigpOw0KICAgIH0NCiAgICAvKiogZW5kIGZpbHRlcnMgKiovDQoNCiAgICAvL2Rpc3BsYXkgaGFuZGxpbmcNCiAgICAvL2h0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzMwODAvc2V0dGluZy10aGUtaGVpZ2h0LW9mLWEtZGl2LWR5bmFtaWNhbGx5DQogICAgZnVuY3Rpb24gcmVzaXplRWxlbWVudEhlaWdodChlbGVtZW50KSB7DQogICAgICB2YXIgaGVpZ2h0ID0gMDsNCiAgICAgIHZhciBib2R5ID0gd2luZG93LmRvY3VtZW50LmJvZHk7DQogICAgICBpZiAod2luZG93LmlubmVySGVpZ2h0KSB7DQogICAgICAgIGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDsNCiAgICAgIH0gZWxzZSBpZiAoYm9keS5wYXJlbnRFbGVtZW50LmNsaWVudEhlaWdodCkgew0KICAgICAgICBoZWlnaHQgPSBib2R5LnBhcmVudEVsZW1lbnQuY2xpZW50SGVpZ2h0Ow0KICAgICAgfSBlbHNlIGlmIChib2R5ICYmIGJvZHkuY2xpZW50SGVpZ2h0KSB7DQogICAgICAgIGhlaWdodCA9IGJvZHkuY2xpZW50SGVpZ2h0Ow0KICAgICAgfQ0KICAgICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSAoKChoZWlnaHQgLSBlbGVtZW50Lm9mZnNldFRvcCkpICsgInB4Iik7DQogICAgfQ0KDQogICAgLy8gYWRkIGV2ZW50IGNyb3NzIGJyb3dzZXINCiAgICAvL2h0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTAxNDk5NjMvYWRkaW5nLWV2ZW50LWxpc3RlbmVyLWNyb3NzLWJyb3dzZXINCiAgICBmdW5jdGlvbiBhZGRFdmVudChlbGVtLCBldmVudCwgZm4pIHsNCiAgICAgIGlmIChlbGVtLmFkZEV2ZW50TGlzdGVuZXIpIHsNCiAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBmbiwgZmFsc2UpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZWxlbS5hdHRhY2hFdmVudCgib24iICsgZXZlbnQsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAvLyBzZXQgdGhlIHRoaXMgcG9pbnRlciBzYW1lIGFzIGFkZEV2ZW50TGlzdGVuZXIgd2hlbiBmbiBpcyBjYWxsZWQNCiAgICAgICAgICByZXR1cm4gKGZuLmNhbGwoZWxlbSwgd2luZG93LmV2ZW50KSk7DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0NCiAgPC9zY3JpcHQ+DQo8L2JvZHk+DQoNCjwvaHRtbD4=';

  var locator = null;
  var logs = [];
  var selectedLogs = [];
  var currentHref = document.location.href;

  function jsonHandler(json) {
    if (json.body != null) {
      locator = json.name;
      const found = logs.find(log => log.id == json.id);
      if (found == null) {
        logs.push(json);
        populateSelectedLogs(currentHref);
        updateTableViewButton();
      }
    }
  }

  function populateSelectedLogs(href) {
    var queryParts = href.split('?');
    selectedLogs = [];
    if (queryParts.length > 1) {
      var query = queryParts[1].split('&');
      var parameters = { id: '', sid: [] };
      for (var i = 0; i < query.length; i++) {
        var parameterParts = query[i].split('=');
        if (parameterParts[0] == 'id') {
          parameters.id = parameterParts[1];
        } else if (parameterParts[0] == 'sid') {
          var sid = parameterParts[1];
          parameters.sid.push(sid);
          const found = logs.find(log => log.id == sid);
          if (found != null) {
            selectedLogs.push(found);
          }
        }
      }
    }
  }

  function getContent() {
    if (selectedLogs.length == 0) {
      return null;
    } else {
      return selectedLogs.map(log => log.body).join('\r\n');
    }
  }

  function getRecordLocator() {
    if (locator != null) {
      return locator;
    }
    const labels = Array.from(document.querySelectorAll('label'));
    const recordLocatorLabel = labels.find(el => el.textContent === 'Record Locator');
    return recordLocatorLabel.nextSibling.querySelector('input').value;
  }

  function getAgencyName() {
    return document.getElementById('agency-combo').value;
  }

  function getGds(content) {
    return content.includes('<PNRBFManagement') && content.includes('<OwningCRS>1G</OwningCRS>') ? 'Galileo' :
           content.includes('<PNRBFManagement') && content.includes('<OwningCRS>1V</OwningCRS>') ? 'Apollo' :
           content.includes('DIR0DPN') ? 'Worldspan' :
           content.includes('<SabreCommandLLSRQ') || content.includes('SD000766') ? 'Sabre' :
           content.includes('http://xml.amadeus.com/') ? 'Amadeus' :
           'Unknown';
  }

  function getFileDate(content) {
    var logDateMatches = content.match(new RegExp('([\\d]+)/([\\d]+)/([\\d]+) ([\\d]+):([\\d]+):([\\d]+)\\.([\\d]+)'));
    var make2Characters = function (str) { return ('0' + str).substring(str.length - 1) };
    var logDateText = '20' + logDateMatches[3] + '_' + make2Characters(logDateMatches[1]) + '_' + make2Characters(logDateMatches[2]) + '_' + make2Characters(logDateMatches[4]) + '_' + make2Characters(logDateMatches[5]) + '_' + logDateMatches[6];
    return logDateText;
  }

  function getWorkflowName(content) {
    var processRegex = new RegExp('(Workflow:|Name:) "([^"]+)"', 'g');
    var processMatches = [...content.matchAll(processRegex)];
    var processMatch = processMatches.find((wfElement) => { return (wfElement[1] == 'Workflow:') }) || processMatches.find((element) => { return (element[2] !== 'Determine PNR Type' && element[2] !== 'Determine PNR Type - IC Offline (ALTOUR)' && element[2] !== 'Determine PNR Type - IC Online (ALTOUR)') });
    var process = processMatch ? processMatch[2] : 'Unknown';

    return process;
  }

  function getFilename(content) {
    if (content == null) {
      console.log('filename: null');
      return null;
    } else {
      var filenameParts = [getRecordLocator(), getAgencyName().replace(' ', ''), getGds(content), getFileDate(content), getWorkflowName(content)];
      return (filenameParts.join('-') + '.log');
    }
  }

  function updateTableViewButton() {
    const buttons = Array.from(document.querySelectorAll('button'));
    const snippetsButton = buttons.find(el => el.textContent === 'All Snippets' || el.textContent === 'First 15 Snippets');

    if (snippetsButton != null)
    {
      var tableViewButton = document.getElementById('TableViewButton');

      if (tableViewButton == null) {
        const snippetsParent = snippetsButton.parentNode;
        const buttonContainer = snippetsParent.parentNode;

        const tableViewDiv = document.createElement("div");
        for (const parentClass of snippetsParent.classList.values()) {
          // console.log('snippet parent class: ' + parentClass);
          tableViewDiv.classList.add(parentClass);
        }

        tableViewButton = document.createElement("button");
        tableViewButton.id = "TableViewButton";
        for (const buttonClass of snippetsButton.classList.values()) {
          // console.log('snippets class: ' + buttonClass);
          tableViewButton.classList.add(buttonClass);
        }
        tableViewDiv.appendChild(tableViewButton);

        var spanDownload = document.createElement("span");
        spanDownload.innerText = "View as Table";
        tableViewButton.appendChild(spanDownload);

        buttonContainer.appendChild(tableViewDiv);
      }

      var content = getContent();
      if (content != null) {
        if (tableViewButton.classList.contains('Mui-disabled')) {
          tableViewButton.classList.remove('Mui-disabled');
        }
        tableViewButton.onclick = function () {
          // https://stackoverflow.com/questions/11965087/open-a-new-tab-window-and-write-something-to-it#11967627
          // https://stackoverflow.com/a/38866224 - addresses special handling of $$
          // replace \ with \\ in content to avoid occasional errors about octal escape sequences in template literals
          // replace(/\u{0087}/gu, "") - replace special character found in Sabre logs with a viewable character
          var tab = window.open('about:blank', '_blank');
          tab.document.write(atob(htmlContent).replace('%FILENAME%', getFilename(content)).split('%LOGTEXT%').join(content.replace(/\\/g, '\\\\').replace(/`/g, '\\`').replace(/\u{0087}/gu, ""))); // where 'html' is a variable containing your HTML
          tab.document.close(); // to finish loading the page
        };
      } else {
        if (!tableViewButton.classList.contains('Mui-disabled')) {
          tableViewButton.classList.add('Mui-disabled');
        }
      }
    }
  }

  // clone the response to be handled by the original handler
  function responseHandler(response) {
    var clonedResponse = response.clone();
    response.json().then(jsonHandler);
    return clonedResponse;
  }

  if (document.location.hash != '#infoview') {
    // replace the fetch event to allow the script to get log information
    var old_fetch = unsafeWindow.fetch;
    unsafeWindow.fetch = function (resource, init) {
      return old_fetch(resource, init).then(responseHandler);
    }

    // https://stackoverflow.com/questions/3522090/event-when-window-location-href-changes
    var bodyList = document.querySelector("body")

    var observer = new MutationObserver(function (mutations) {
      mutations.forEach(function (mutation) {
        if (currentHref != document.location.href) {
          currentHref = document.location.href;
          populateSelectedLogs(currentHref);
          updateTableViewButton();
        }
      });
    });

    var config = {
      childList: true,
      subtree: true
    };

    observer.observe(bodyList, config);
  }
})();