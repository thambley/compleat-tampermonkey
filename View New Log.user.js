// ==UserScript==
// @name         View New Log
// @namespace    https://support.concurcompleat.com/Logs/
// @updateURL    https://github.com/thambley/compleat-tampermonkey/raw/main/View%20New%20Log.user.js
// @version      0.7
// @description  View formatted log text
// @author       thambley@tlcorporate.com
// @match        https://support.concurcompleat.com/Logs*
// @match        https://support.concurcompleat.com/logs*
// @grant        unsafeWindow
// ==/UserScript==

(function () {
  'use strict';

  var htmlContent = 'PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbiI+DQoNCjxoZWFkPg0KICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCIgLz4NCiAgPHRpdGxlPmxvZyB0byBodG1sIHVwbG9hZDwvdGl0bGU+DQogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy9sb2ctdG8taHRtbC5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+DQogIDxzdHlsZT4NCiAgICBib2R5IHsNCiAgICAgIGZvbnQtZmFtaWx5OiBzYW5zLXNlcmlmOw0KICAgICAgZm9udC1zaXplOiAxMnB4Ow0KICAgICAgbWFyZ2luOiAwcHg7DQogICAgfQ0KDQogICAgLmNvbnRhaW5lciB7DQogICAgICBtaW4taGVpZ2h0OiA1MHB4Ow0KICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtZmxleDsNCiAgICAgIGZsZXgtd3JhcDogd3JhcDsNCiAgICAgIGZsZXgtZGlyZWN0aW9uOiByb3c7DQogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtc3RhcnQ7DQogICAgICBhbGlnbi1pdGVtczogYXV0bzsNCiAgICAgIGFsaWduLWNvbnRlbnQ6IGNlbnRlcjsNCiAgICB9DQoNCiAgICAuY29udGFpbmVyOmFmdGVyIHsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgLypjb250ZW50OiAiIGludmlzaWJsZSBub2RlICI7Ki8NCiAgICAgIGZsZXg6IDk5OSA5OTkgYXV0bzsNCiAgICB9DQoNCiAgICAuaXRlbSB7DQogICAgICBmbGV4OiAwIDAgYXV0bzsNCiAgICAgIG1hcmdpbjogNXB4Ow0KICAgIH0NCg0KICAgIC5wYWdlZGl2IHsNCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHdoaXRlOw0KICAgIH0NCg0KICAgIC5pbmZvIHsNCiAgICAgIGRpc3BsYXk6IHRhYmxlLWNlbGw7DQogICAgICBwYWRkaW5nOiA1cHg7DQogICAgfQ0KDQogICAgLmhpZGRlbiB7DQogICAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7DQogICAgfQ0KDQogICAgLmluZm9MYWJlbCB7DQogICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgIHBhZGRpbmc6IDVweDsNCiAgICB9DQoNCiAgICAjZGF0YSB7DQogICAgICBjbGVhcjogYm90aDsNCiAgICAgIG92ZXJmbG93OiBhdXRvOw0KICAgICAgd2lkdGg6IDEwMCU7DQogICAgfQ0KDQogICAgLnN1Ym1pdF9idG4gew0KICAgICAgYm9yZGVyLXJhZGl1czogMjAwcHg7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgIGZvbnQtc2l6ZTogMS4wZW07DQogICAgICBmb250LWZhbWlseTogJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsNCiAgICAgIGxpbmUtaGVpZ2h0OiAxMnB4Ow0KICAgICAgbWFyZ2luLXJpZ2h0OiAzcHg7DQogICAgICBwYWRkaW5nOiA3cHggMTZweCA2cHg7DQogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjODM4YTkwOw0KICAgICAgYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgIzgzOGE5MCwgIzQxNDU0OSk7DQogICAgICB0ZXh0LXNoYWRvdzogIzAwMCAwIDFweCAwOw0KICAgICAgYm94LXNoYWRvdzogMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgMC4xKSwgMCAxcHggMCAwcHggcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpIGluc2V0Ow0KICAgICAgYm9yZGVyOiBzb2xpZCAxcHggIzQ4NGU1MzsNCiAgICAgIGJvcmRlci1jb2xvcjogIzQ4NGU1MzsNCiAgICAgIGJvcmRlci10b3AtY29sb3I6ICM2MTZhNzE7DQogICAgICBib3JkZXItcmlnaHQtY29sb3I6ICM0ODRlNTM7DQogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjMzYzYjNmOw0KICAgICAgYm9yZGVyLWxlZnQtY29sb3I6ICM0ODRlNTM7DQogICAgICBjb2xvcjogI2VmZWZlZjsNCiAgICAgIGN1cnNvcjogcG9pbnRlcg0KICAgIH0NCg0KICAgIC5yZXNldF9idG4gew0KICAgICAgYm9yZGVyLXJhZGl1czogMjAwcHg7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgIGZvbnQtc2l6ZTogMS4wZW07DQogICAgICBmb250LWZhbWlseTogJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsNCiAgICAgIGxpbmUtaGVpZ2h0OiAxMnB4Ow0KICAgICAgbWFyZ2luLXJpZ2h0OiAzcHg7DQogICAgICBwYWRkaW5nOiA3cHggMTZweCA2cHg7DQogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGOw0KICAgICAgYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgI2ZmZiwgI0U3RTdFNyk7DQogICAgICBib3gtc2hhZG93OiAwIDFweCAxcHggcmdiYSgwLCAwLCAwLCAwLjEpLCAwIDFweCAwIDAgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjgpIGluc2V0Ow0KICAgICAgYm9yZGVyOiBzb2xpZCAxcHggI2M3YzdjNzsNCiAgICAgIGJvcmRlci1jb2xvcjogI2M3YzdjNzsNCiAgICAgIGJvcmRlci10b3AtY29sb3I6ICNkM2QzZDM7DQogICAgICBib3JkZXItcmlnaHQtY29sb3I6ICNjN2M3Yzc7DQogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjYzJjMmMyOw0KICAgICAgYm9yZGVyLWxlZnQtY29sb3I6ICNjN2M3Yzc7DQogICAgICB0ZXh0LXNoYWRvdzogI2ZmZiAwIDFweCAwOw0KICAgICAgY29sb3I6ICM1RTY0NjkNCiAgICB9DQogIDwvc3R5bGU+DQogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy9zZWFyY2guY3NzIiByZWw9InN0eWxlc2hlZXQiIHR5cGU9InRleHQvY3NzIiAvPi0tPg0KICA8c3R5bGU+DQogICAgZm9ybSNzZWFyY2ggLnNlYXJjaF9mb3JtX2ZpZWxkIHsNCiAgICAgIG1hcmdpbi1ib3R0b206IDEwcHg7DQogICAgICBjbGVhcjogYm90aA0KICAgIH0NCg0KICAgIGZvcm0jc2VhcmNoIGlucHV0W3R5cGU9dGV4dF0sDQogICAgZm9ybSNzZWFyY2ggaW5wdXRbdHlwZT1lbWFpbF0sDQogICAgZm9ybSNzZWFyY2ggaW5wdXRbdHlwZT1udW1iZXJdLA0KICAgIGZvcm0jc2VhcmNoIGlucHV0W3R5cGU9dXJsXSwNCiAgICBmb3JtI3NlYXJjaCBpbnB1dFt0eXBlPXRlbF0sDQogICAgZm9ybSNzZWFyY2ggaW5wdXRbdHlwZT1kYXRlXSwNCiAgICBmb3JtI3NlYXJjaCBpbnB1dFt0eXBlPXRpbWVdLA0KICAgIGZvcm0jc2VhcmNoIHRleHRhcmVhIHsNCiAgICAgIC8qIHdpZHRoOiBjYWxjKDgwJSAtIDIycHgpOyovDQogICAgICBib3JkZXI6IDFweCBzb2xpZCAjYzlkMGQ2Ow0KICAgICAgYm9yZGVyLXJhZGl1czogM3B4Ow0KICAgICAgZm9udC1zaXplOiAwLjk1ZW07DQogICAgICBmb250LWZhbWlseTogJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsNCiAgICAgIG91dGxpbmU6IG5vbmU7DQogICAgICBwYWRkaW5nOiA4cHggMTBweCA3cHgNCiAgICB9DQoNCiAgICBmb3JtI3NlYXJjaCAuYnV0dG9ucyB7DQogICAgICBtYXJnaW4tdG9wOiAxNXB4DQogICAgfQ0KDQogICAgZm9ybSNzZWFyY2ggc2VsZWN0IHsNCiAgICAgIHdpZHRoOiAyNDBweA0KICAgIH0NCiAgPC9zdHlsZT4NCiAgPCEtLTxsaW5rIGhyZWY9InN0eWxlc2hlZXRzL2ZpbHRlci5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+DQogIDxzdHlsZT4NCiAgICBmb3JtI2ZpbHRlciAuZmlsdGVyX2Zvcm1fZmllbGQgew0KICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDsNCiAgICAgIGNsZWFyOiBib3RoDQogICAgfQ0KDQogICAgZm9ybSNmaWx0ZXIgaW5wdXRbdHlwZT10ZXh0XSwNCiAgICBmb3JtI2ZpbHRlciBpbnB1dFt0eXBlPWVtYWlsXSwNCiAgICBmb3JtI2ZpbHRlciBpbnB1dFt0eXBlPW51bWJlcl0sDQogICAgZm9ybSNmaWx0ZXIgaW5wdXRbdHlwZT11cmxdLA0KICAgIGZvcm0jZmlsdGVyIGlucHV0W3R5cGU9dGVsXSwNCiAgICBmb3JtI2ZpbHRlciBpbnB1dFt0eXBlPWRhdGVdLA0KICAgIGZvcm0jZmlsdGVyIGlucHV0W3R5cGU9dGltZV0sDQogICAgZm9ybSNmaWx0ZXIgdGV4dGFyZWEgew0KICAgICAgLyogd2lkdGg6IGNhbGMoODAlIC0gMjJweCk7Ki8NCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNjOWQwZDY7DQogICAgICBib3JkZXItcmFkaXVzOiAzcHg7DQogICAgICBmb250LXNpemU6IDAuOTVlbTsNCiAgICAgIGZvbnQtZmFtaWx5OiAnSGVsdmV0aWNhIE5ldWUnLCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOw0KICAgICAgb3V0bGluZTogbm9uZTsNCiAgICAgIHBhZGRpbmc6IDhweCAxMHB4IDdweA0KICAgIH0NCg0KICAgIGZvcm0jZmlsdGVyIC5idXR0b25zIHsNCiAgICAgIG1hcmdpbi10b3A6IDE1cHgNCiAgICB9DQoNCiAgICBmb3JtI2ZpbHRlciBzZWxlY3Qgew0KICAgICAgd2lkdGg6IDI0MHB4DQogICAgfQ0KICA8L3N0eWxlPg0KICA8IS0tPGxpbmsgaHJlZj0ic3R5bGVzaGVldHMvb25vZmYuY3NzIiByZWw9InN0eWxlc2hlZXQiIHR5cGU9InRleHQvY3NzIiAvPi0tPg0KICA8c3R5bGU+DQogICAgLyogaHR0cHM6Ly9wcm90by5pby9mcmVlYmllcy9vbm9mZi8gKi8NCg0KICAgIC5vbm9mZnN3aXRjaCB7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICB3aWR0aDogNzBweDsNCiAgICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7DQogICAgICAtbW96LXVzZXItc2VsZWN0OiBub25lOw0KICAgICAgLW1zLXVzZXItc2VsZWN0OiBub25lOw0KICAgIH0NCg0KICAgIC5vbm9mZnN3aXRjaC1jaGVja2JveCB7DQogICAgICBkaXNwbGF5OiBub25lOw0KICAgIH0NCg0KICAgIC5vbm9mZnN3aXRjaC1sYWJlbCB7DQogICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICBib3JkZXI6IDJweCBzb2xpZCAjOTk5OTk5Ow0KICAgICAgYm9yZGVyLXJhZGl1czogMTVweDsNCiAgICB9DQoNCiAgICAub25vZmZzd2l0Y2gtaW5uZXIgew0KICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICB3aWR0aDogMjAwJTsNCiAgICAgIG1hcmdpbi1sZWZ0OiAtMTAwJTsNCiAgICAgIHRyYW5zaXRpb246IG1hcmdpbiAwLjNzIGVhc2UtaW4gMHM7DQogICAgfQ0KDQogICAgLm9ub2Zmc3dpdGNoLWlubmVyOmJlZm9yZSwNCiAgICAub25vZmZzd2l0Y2gtaW5uZXI6YWZ0ZXIgew0KICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICBmbG9hdDogbGVmdDsNCiAgICAgIHdpZHRoOiA1MCU7DQogICAgICBoZWlnaHQ6IDI1cHg7DQogICAgICBwYWRkaW5nOiAwOw0KICAgICAgbGluZS1oZWlnaHQ6IDI1cHg7DQogICAgICBmb250LXNpemU6IDEycHg7DQogICAgICBjb2xvcjogd2hpdGU7DQogICAgICBmb250LWZhbWlseTogVHJlYnVjaGV0LCBBcmlhbCwgc2Fucy1zZXJpZjsNCiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICB9DQoNCiAgICAub25vZmZzd2l0Y2gtaW5uZXI6YmVmb3JlIHsNCiAgICAgIGNvbnRlbnQ6ICJPTiI7DQogICAgICBwYWRkaW5nLWxlZnQ6IDEwcHg7DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMzRBN0MxOw0KICAgICAgY29sb3I6ICNGRkZGRkY7DQogICAgfQ0KDQogICAgLm9ub2Zmc3dpdGNoLWlubmVyOmFmdGVyIHsNCiAgICAgIGNvbnRlbnQ6ICJPRkYiOw0KICAgICAgcGFkZGluZy1yaWdodDogMTBweDsNCiAgICAgIGJhY2tncm91bmQtY29sb3I6ICNFRUVFRUU7DQogICAgICBjb2xvcjogIzk5OTk5OTsNCiAgICAgIHRleHQtYWxpZ246IHJpZ2h0Ow0KICAgIH0NCg0KICAgIC5vbm9mZnN3aXRjaC1zd2l0Y2ggew0KICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICB3aWR0aDogMTVweDsNCiAgICAgIG1hcmdpbjogNXB4Ow0KICAgICAgYmFja2dyb3VuZDogI0ZGRkZGRjsNCiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgIHRvcDogMDsNCiAgICAgIGJvdHRvbTogMDsNCiAgICAgIHJpZ2h0OiA0MXB4Ow0KICAgICAgYm9yZGVyOiAycHggc29saWQgIzk5OTk5OTsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDE1cHg7DQogICAgICB0cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlLWluIDBzOw0KICAgIH0NCg0KICAgIC5vbm9mZnN3aXRjaC1jaGVja2JveDpjaGVja2VkKy5vbm9mZnN3aXRjaC1sYWJlbCAub25vZmZzd2l0Y2gtaW5uZXIgew0KICAgICAgbWFyZ2luLWxlZnQ6IDA7DQogICAgfQ0KDQogICAgLm9ub2Zmc3dpdGNoLWNoZWNrYm94OmNoZWNrZWQrLm9ub2Zmc3dpdGNoLWxhYmVsIC5vbm9mZnN3aXRjaC1zd2l0Y2ggew0KICAgICAgcmlnaHQ6IDBweDsNCiAgICB9DQogIDwvc3R5bGU+DQogIDwhLS1odHRwOi8vd3d3Lmxpc3Rqcy5jb20vLS0+DQogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy9saXN0LmNzcyIgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgLz4tLT4NCiAgPHN0eWxlPg0KICAgIC8qIHRhYmxlcyAqLw0KICAgIHRhYmxlLmxpc3RhYmxlIHRyOmhvdmVyIHRkIHsNCiAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmMmYyZjI7DQogICAgfQ0KDQogICAgdGFibGUubGlzdGFibGUgdGQsDQogICAgdGFibGUubGlzdGFibGUgdGggew0KICAgICAgcGFkZGluZzogNXB4Ow0KICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7DQogICAgfQ0KDQogICAgdGFibGUubGlzdGFibGUgew0KICAgICAgYmFja2dyb3VuZC1jb2xvcjogYmxhY2s7DQogICAgfQ0KDQogICAgdGQudGV4dCB7DQogICAgICB3aGl0ZS1zcGFjZTogcHJlOw0KICAgICAgZm9udC1mYW1pbHk6IGNvdXJpZXIgbmV3Ow0KICAgIH0NCg0KICAgIC5wYWdpbmF0aW9uIGxpIHsNCiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgIHBhZGRpbmc6IDVweDsNCiAgICB9DQoNCiAgICAucGFnaW5hdGlvbiBsaS5hY3RpdmUgew0KICAgICAgYm9yZGVyOiAxcHggc29saWQgYmxhY2s7DQogICAgICBib3JkZXItcmFkaXVzOiA2cHg7DQogICAgfQ0KDQogICAgLnBhZ2luYXRpb24gbGkgYS5wYWdlIHsNCiAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsNCiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgY29sb3I6IGJsYWNrOw0KICAgIH0NCg0KICAgIC5zZWFyY2ggew0KICAgICAgYm9yZGVyOiBzb2xpZCAxcHggI2NjYzsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDVweDsNCiAgICAgIHBhZGRpbmc6IDdweCAxNHB4Ow0KICAgICAgbWFyZ2luLXRvcDogMTBweA0KICAgIH0NCg0KICAgIHRhYmxlLnNvcnRhYmxlIHRoZWFkIHRyIC5zb3J0IHsNCiAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoRlFBSkFJQUFBQ010TVAvLy95SDVCQUVBQUFFQUxBQUFBQUFWQUFrQUFBSVhqSStBeXduYVluaFVNb3F0M2daWFBtVmc5NHlKVlFBQU93PT0pOw0KICAgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsNCiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlciByaWdodDsNCiAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICAgIHBhZGRpbmctcmlnaHQ6IDIwcHg7DQogICAgfQ0KDQogICAgdGFibGUuc29ydGFibGUgdGhlYWQgdHIgLmFzYyB7DQogICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoRlFBRUFJQUFBQ010TVAvLy95SDVCQUVBQUFFQUxBQUFBQUFWQUFRQUFBSU5qQitnQytqUDJwdG4wV3NrTFFBNyk7DQogICAgfQ0KDQogICAgdGFibGUuc29ydGFibGUgdGhlYWQgdHIgLmRlc2Mgew0KICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEZRQUVBSUFBQUNNdE1QLy8veUg1QkFFQUFBRUFMQUFBQUFBVkFBUUFBQUlOakk4QnlhMnduSU5VTW9wWkFRQTcpOw0KICAgIH0NCg0KICAgIHRhYmxlLnNvcnRhYmxlIHRoZWFkIHRyIC5hc2MsDQogICAgdGFibGUuc29ydGFibGUgdGhlYWQgdHIgLmRlc2Mgew0KICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzhkYmRkODsNCiAgICB9DQogIDwvc3R5bGU+DQogIDwhLS08c2NyaXB0IHNyYz0iamF2YXNjcmlwdHMvbGlzdC5qcyI+PC9zY3JpcHQ+LS0+DQogIDxzY3JpcHQ+DQogIC8vIExpc3QuanMgdjEuMy4wIChodHRwOi8vd3d3Lmxpc3Rqcy5jb20pIGJ5IEpvbm55IFN0csO2bWJlcmcgKGh0dHA6Ly9qYXZ2ZS5jb20pDQooZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoIkNhbm5vdCBmaW5kIG1vZHVsZSAnIitvKyInIik7dGhyb3cgZi5jb2RlPSJNT0RVTEVfTk9UX0ZPVU5EIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pKHsxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCihmdW5jdGlvbiggd2luZG93LCB1bmRlZmluZWQgKSB7DQoidXNlIHN0cmljdCI7DQoNCnZhciBkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudCwNCiAgZ2V0QnlDbGFzcyA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL2dldC1ieS1jbGFzcycpLA0KICBleHRlbmQgPSByZXF1aXJlKCcuL3NyYy91dGlscy9leHRlbmQnKSwNCiAgaW5kZXhPZiA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL2luZGV4LW9mJyksDQogIGV2ZW50cyA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL2V2ZW50cycpLA0KICB0b1N0cmluZyA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL3RvLXN0cmluZycpLA0KICBuYXR1cmFsU29ydCA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL25hdHVyYWwtc29ydCcpLA0KICBjbGFzc2VzID0gcmVxdWlyZSgnLi9zcmMvdXRpbHMvY2xhc3NlcycpLA0KICBnZXRBdHRyaWJ1dGUgPSByZXF1aXJlKCcuL3NyYy91dGlscy9nZXQtYXR0cmlidXRlJyksDQogIHRvQXJyYXkgPSByZXF1aXJlKCcuL3NyYy91dGlscy90by1hcnJheScpOw0KDQp2YXIgTGlzdCA9IGZ1bmN0aW9uKGlkLCBvcHRpb25zLCB2YWx1ZXMpIHsNCg0KICB2YXIgc2VsZiA9IHRoaXMsDQogICAgaW5pdCwNCiAgICBJdGVtID0gcmVxdWlyZSgnLi9zcmMvaXRlbScpKHNlbGYpLA0KICAgIGFkZEFzeW5jID0gcmVxdWlyZSgnLi9zcmMvYWRkLWFzeW5jJykoc2VsZik7DQoNCiAgaW5pdCA9IHsNCiAgICBzdGFydDogZnVuY3Rpb24oKSB7DQogICAgICBzZWxmLmxpc3RDbGFzcyAgICAgID0gImxpc3QiOw0KICAgICAgc2VsZi5zZWFyY2hDbGFzcyAgICA9ICJzZWFyY2giOw0KICAgICAgc2VsZi5zb3J0Q2xhc3MgICAgICA9ICJzb3J0IjsNCiAgICAgIHNlbGYucGFnZSAgICAgICAgICAgPSAxMDAwMDsNCiAgICAgIHNlbGYuaSAgICAgICAgICAgICAgPSAxOw0KICAgICAgc2VsZi5pdGVtcyAgICAgICAgICA9IFtdOw0KICAgICAgc2VsZi52aXNpYmxlSXRlbXMgICA9IFtdOw0KICAgICAgc2VsZi5tYXRjaGluZ0l0ZW1zICA9IFtdOw0KICAgICAgc2VsZi5zZWFyY2hlZCAgICAgICA9IGZhbHNlOw0KICAgICAgc2VsZi5maWx0ZXJlZCAgICAgICA9IGZhbHNlOw0KICAgICAgc2VsZi5zZWFyY2hDb2x1bW5zICA9IHVuZGVmaW5lZDsNCiAgICAgIHNlbGYuaGFuZGxlcnMgICAgICAgPSB7ICd1cGRhdGVkJzogW10gfTsNCiAgICAgIHNlbGYucGx1Z2lucyAgICAgICAgPSB7fTsNCiAgICAgIHNlbGYudmFsdWVOYW1lcyAgICAgPSBbXTsNCiAgICAgIHNlbGYudXRpbHMgICAgICAgICAgPSB7DQogICAgICAgIGdldEJ5Q2xhc3M6IGdldEJ5Q2xhc3MsDQogICAgICAgIGV4dGVuZDogZXh0ZW5kLA0KICAgICAgICBpbmRleE9mOiBpbmRleE9mLA0KICAgICAgICBldmVudHM6IGV2ZW50cywNCiAgICAgICAgdG9TdHJpbmc6IHRvU3RyaW5nLA0KICAgICAgICBuYXR1cmFsU29ydDogbmF0dXJhbFNvcnQsDQogICAgICAgIGNsYXNzZXM6IGNsYXNzZXMsDQogICAgICAgIGdldEF0dHJpYnV0ZTogZ2V0QXR0cmlidXRlLA0KICAgICAgICB0b0FycmF5OiB0b0FycmF5DQogICAgICB9Ow0KDQogICAgICBzZWxmLnV0aWxzLmV4dGVuZChzZWxmLCBvcHRpb25zKTsNCg0KICAgICAgc2VsZi5saXN0Q29udGFpbmVyID0gKHR5cGVvZihpZCkgPT09ICdzdHJpbmcnKSA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSA6IGlkOw0KICAgICAgaWYgKCFzZWxmLmxpc3RDb250YWluZXIpIHsgcmV0dXJuOyB9DQogICAgICBzZWxmLmxpc3QgICAgICAgPSBnZXRCeUNsYXNzKHNlbGYubGlzdENvbnRhaW5lciwgc2VsZi5saXN0Q2xhc3MsIHRydWUpOw0KDQogICAgICBzZWxmLnBhcnNlICAgICAgPSByZXF1aXJlKCcuL3NyYy9wYXJzZScpKHNlbGYpOw0KICAgICAgc2VsZi50ZW1wbGF0ZXIgID0gcmVxdWlyZSgnLi9zcmMvdGVtcGxhdGVyJykoc2VsZik7DQogICAgICBzZWxmLnNlYXJjaCAgICAgPSByZXF1aXJlKCcuL3NyYy9zZWFyY2gnKShzZWxmKTsNCiAgICAgIHNlbGYuZmlsdGVyICAgICA9IHJlcXVpcmUoJy4vc3JjL2ZpbHRlcicpKHNlbGYpOw0KICAgICAgc2VsZi5zb3J0ICAgICAgID0gcmVxdWlyZSgnLi9zcmMvc29ydCcpKHNlbGYpOw0KDQogICAgICB0aGlzLmhhbmRsZXJzKCk7DQogICAgICB0aGlzLml0ZW1zKCk7DQogICAgICBzZWxmLnVwZGF0ZSgpOw0KICAgICAgdGhpcy5wbHVnaW5zKCk7DQogICAgfSwNCiAgICBoYW5kbGVyczogZnVuY3Rpb24oKSB7DQogICAgICBmb3IgKHZhciBoYW5kbGVyIGluIHNlbGYuaGFuZGxlcnMpIHsNCiAgICAgICAgaWYgKHNlbGZbaGFuZGxlcl0pIHsNCiAgICAgICAgICBzZWxmLm9uKGhhbmRsZXIsIHNlbGZbaGFuZGxlcl0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBpdGVtczogZnVuY3Rpb24oKSB7DQogICAgICBzZWxmLnBhcnNlKHNlbGYubGlzdCk7DQogICAgICBpZiAodmFsdWVzICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgc2VsZi5hZGQodmFsdWVzKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHBsdWdpbnM6IGZ1bmN0aW9uKCkgew0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLnBsdWdpbnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgdmFyIHBsdWdpbiA9IHNlbGYucGx1Z2luc1tpXTsNCiAgICAgICAgc2VsZltwbHVnaW4ubmFtZV0gPSBwbHVnaW47DQogICAgICAgIHBsdWdpbi5pbml0KHNlbGYsIExpc3QpOw0KICAgICAgfQ0KICAgIH0NCiAgfTsNCg0KICAvKg0KICAqIFJlLXBhcnNlIHRoZSBMaXN0LCB1c2UgaWYgaHRtbCBoYXZlIGNoYW5nZWQNCiAgKi8NCiAgdGhpcy5yZUluZGV4ID0gZnVuY3Rpb24oKSB7DQogICAgc2VsZi5pdGVtcyAgICAgICAgICA9IFtdOw0KICAgIHNlbGYudmlzaWJsZUl0ZW1zICAgPSBbXTsNCiAgICBzZWxmLm1hdGNoaW5nSXRlbXMgID0gW107DQogICAgc2VsZi5zZWFyY2hlZCAgICAgICA9IGZhbHNlOw0KICAgIHNlbGYuZmlsdGVyZWQgICAgICAgPSBmYWxzZTsNCiAgICBzZWxmLnBhcnNlKHNlbGYubGlzdCk7DQogIH07DQoNCiAgdGhpcy50b0pTT04gPSBmdW5jdGlvbigpIHsNCiAgICB2YXIganNvbiA9IFtdOw0KICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IHNlbGYuaXRlbXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAganNvbi5wdXNoKHNlbGYuaXRlbXNbaV0udmFsdWVzKCkpOw0KICAgIH0NCiAgICByZXR1cm4ganNvbjsNCiAgfTsNCg0KDQogIC8qDQogICogQWRkIG9iamVjdCB0byBsaXN0DQogICovDQogIHRoaXMuYWRkID0gZnVuY3Rpb24odmFsdWVzLCBjYWxsYmFjaykgew0KICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKSB7DQogICAgICByZXR1cm47DQogICAgfQ0KICAgIGlmIChjYWxsYmFjaykgew0KICAgICAgYWRkQXN5bmModmFsdWVzLCBjYWxsYmFjayk7DQogICAgICByZXR1cm47DQogICAgfQ0KICAgIHZhciBhZGRlZCA9IFtdLA0KICAgICAgbm90Q3JlYXRlID0gZmFsc2U7DQogICAgaWYgKHZhbHVlc1swXSA9PT0gdW5kZWZpbmVkKXsNCiAgICAgIHZhbHVlcyA9IFt2YWx1ZXNdOw0KICAgIH0NCiAgICBmb3IgKHZhciBpID0gMCwgaWwgPSB2YWx1ZXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgdmFyIGl0ZW0gPSBudWxsOw0KICAgICAgbm90Q3JlYXRlID0gKHNlbGYuaXRlbXMubGVuZ3RoID4gc2VsZi5wYWdlKSA/IHRydWUgOiBmYWxzZTsNCiAgICAgIGl0ZW0gPSBuZXcgSXRlbSh2YWx1ZXNbaV0sIHVuZGVmaW5lZCwgbm90Q3JlYXRlKTsNCiAgICAgIHNlbGYuaXRlbXMucHVzaChpdGVtKTsNCiAgICAgIGFkZGVkLnB1c2goaXRlbSk7DQogICAgfQ0KICAgIHNlbGYudXBkYXRlKCk7DQogICAgcmV0dXJuIGFkZGVkOw0KICB9Ow0KDQoJdGhpcy5zaG93ID0gZnVuY3Rpb24oaSwgcGFnZSkgew0KCQl0aGlzLmkgPSBpOw0KCQl0aGlzLnBhZ2UgPSBwYWdlOw0KCQlzZWxmLnVwZGF0ZSgpOw0KICAgIHJldHVybiBzZWxmOw0KCX07DQoNCiAgLyogUmVtb3ZlcyBvYmplY3QgZnJvbSBsaXN0Lg0KICAqIExvb3BzIHRocm91Z2ggdGhlIGxpc3QgYW5kIHJlbW92ZXMgb2JqZWN0cyB3aGVyZQ0KICAqIHByb3BlcnR5ICJ2YWx1ZW5hbWUiID09PSB2YWx1ZQ0KICAqLw0KICB0aGlzLnJlbW92ZSA9IGZ1bmN0aW9uKHZhbHVlTmFtZSwgdmFsdWUsIG9wdGlvbnMpIHsNCiAgICB2YXIgZm91bmQgPSAwOw0KICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IHNlbGYuaXRlbXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgaWYgKHNlbGYuaXRlbXNbaV0udmFsdWVzKClbdmFsdWVOYW1lXSA9PSB2YWx1ZSkgew0KICAgICAgICBzZWxmLnRlbXBsYXRlci5yZW1vdmUoc2VsZi5pdGVtc1tpXSwgb3B0aW9ucyk7DQogICAgICAgIHNlbGYuaXRlbXMuc3BsaWNlKGksMSk7DQogICAgICAgIGlsLS07DQogICAgICAgIGktLTsNCiAgICAgICAgZm91bmQrKzsNCiAgICAgIH0NCiAgICB9DQogICAgc2VsZi51cGRhdGUoKTsNCiAgICByZXR1cm4gZm91bmQ7DQogIH07DQoNCiAgLyogR2V0cyB0aGUgb2JqZWN0cyBpbiB0aGUgbGlzdCB3aGljaA0KICAqIHByb3BlcnR5ICJ2YWx1ZU5hbWUiID09PSB2YWx1ZQ0KICAqLw0KICB0aGlzLmdldCA9IGZ1bmN0aW9uKHZhbHVlTmFtZSwgdmFsdWUpIHsNCiAgICB2YXIgbWF0Y2hlZEl0ZW1zID0gW107DQogICAgZm9yICh2YXIgaSA9IDAsIGlsID0gc2VsZi5pdGVtcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICB2YXIgaXRlbSA9IHNlbGYuaXRlbXNbaV07DQogICAgICBpZiAoaXRlbS52YWx1ZXMoKVt2YWx1ZU5hbWVdID09IHZhbHVlKSB7DQogICAgICAgIG1hdGNoZWRJdGVtcy5wdXNoKGl0ZW0pOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbWF0Y2hlZEl0ZW1zOw0KICB9Ow0KDQogIC8qDQogICogR2V0IHNpemUgb2YgdGhlIGxpc3QNCiAgKi8NCiAgdGhpcy5zaXplID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIHNlbGYuaXRlbXMubGVuZ3RoOw0KICB9Ow0KDQogIC8qDQogICogUmVtb3ZlcyBhbGwgaXRlbXMgZnJvbSB0aGUgbGlzdA0KICAqLw0KICB0aGlzLmNsZWFyID0gZnVuY3Rpb24oKSB7DQogICAgc2VsZi50ZW1wbGF0ZXIuY2xlYXIoKTsNCiAgICBzZWxmLml0ZW1zID0gW107DQogICAgcmV0dXJuIHNlbGY7DQogIH07DQoNCiAgdGhpcy5vbiA9IGZ1bmN0aW9uKGV2ZW50LCBjYWxsYmFjaykgew0KICAgIHNlbGYuaGFuZGxlcnNbZXZlbnRdLnB1c2goY2FsbGJhY2spOw0KICAgIHJldHVybiBzZWxmOw0KICB9Ow0KDQogIHRoaXMub2ZmID0gZnVuY3Rpb24oZXZlbnQsIGNhbGxiYWNrKSB7DQogICAgdmFyIGUgPSBzZWxmLmhhbmRsZXJzW2V2ZW50XTsNCiAgICB2YXIgaW5kZXggPSBpbmRleE9mKGUsIGNhbGxiYWNrKTsNCiAgICBpZiAoaW5kZXggPiAtMSkgew0KICAgICAgZS5zcGxpY2UoaW5kZXgsIDEpOw0KICAgIH0NCiAgICByZXR1cm4gc2VsZjsNCiAgfTsNCg0KICB0aGlzLnRyaWdnZXIgPSBmdW5jdGlvbihldmVudCkgew0KICAgIHZhciBpID0gc2VsZi5oYW5kbGVyc1tldmVudF0ubGVuZ3RoOw0KICAgIHdoaWxlKGktLSkgew0KICAgICAgc2VsZi5oYW5kbGVyc1tldmVudF1baV0oc2VsZik7DQogICAgfQ0KICAgIHJldHVybiBzZWxmOw0KICB9Ow0KDQogIHRoaXMucmVzZXQgPSB7DQogICAgZmlsdGVyOiBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBpcyA9IHNlbGYuaXRlbXMsDQogICAgICAgIGlsID0gaXMubGVuZ3RoOw0KICAgICAgd2hpbGUgKGlsLS0pIHsNCiAgICAgICAgaXNbaWxdLmZpbHRlcmVkID0gZmFsc2U7DQogICAgICB9DQogICAgICByZXR1cm4gc2VsZjsNCiAgICB9LA0KICAgIHNlYXJjaDogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgaXMgPSBzZWxmLml0ZW1zLA0KICAgICAgICBpbCA9IGlzLmxlbmd0aDsNCiAgICAgIHdoaWxlIChpbC0tKSB7DQogICAgICAgIGlzW2lsXS5mb3VuZCA9IGZhbHNlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KICB9Ow0KDQogIHRoaXMudXBkYXRlID0gZnVuY3Rpb24oKSB7DQogICAgdmFyIGlzID0gc2VsZi5pdGVtcywNCgkJCWlsID0gaXMubGVuZ3RoOw0KDQogICAgc2VsZi52aXNpYmxlSXRlbXMgPSBbXTsNCiAgICBzZWxmLm1hdGNoaW5nSXRlbXMgPSBbXTsNCiAgICBzZWxmLnRlbXBsYXRlci5jbGVhcigpOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaWw7IGkrKykgew0KICAgICAgaWYgKGlzW2ldLm1hdGNoaW5nKCkgJiYgKChzZWxmLm1hdGNoaW5nSXRlbXMubGVuZ3RoKzEpID49IHNlbGYuaSAmJiBzZWxmLnZpc2libGVJdGVtcy5sZW5ndGggPCBzZWxmLnBhZ2UpKSB7DQogICAgICAgIGlzW2ldLnNob3coKTsNCiAgICAgICAgc2VsZi52aXNpYmxlSXRlbXMucHVzaChpc1tpXSk7DQogICAgICAgIHNlbGYubWF0Y2hpbmdJdGVtcy5wdXNoKGlzW2ldKTsNCiAgICAgIH0gZWxzZSBpZiAoaXNbaV0ubWF0Y2hpbmcoKSkgew0KICAgICAgICBzZWxmLm1hdGNoaW5nSXRlbXMucHVzaChpc1tpXSk7DQogICAgICAgIGlzW2ldLmhpZGUoKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlzW2ldLmhpZGUoKTsNCiAgICAgIH0NCiAgICB9DQogICAgc2VsZi50cmlnZ2VyKCd1cGRhdGVkJyk7DQogICAgcmV0dXJuIHNlbGY7DQogIH07DQoNCiAgaW5pdC5zdGFydCgpOw0KfTsNCg0KDQovLyBBTUQgc3VwcG9ydA0KaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgew0KICBkZWZpbmUoZnVuY3Rpb24gKCkgeyByZXR1cm4gTGlzdDsgfSk7DQp9DQptb2R1bGUuZXhwb3J0cyA9IExpc3Q7DQp3aW5kb3cuTGlzdCA9IExpc3Q7DQoNCn0pKHdpbmRvdyk7DQoNCn0seyIuL3NyYy9hZGQtYXN5bmMiOjIsIi4vc3JjL2ZpbHRlciI6MywiLi9zcmMvaXRlbSI6NCwiLi9zcmMvcGFyc2UiOjUsIi4vc3JjL3NlYXJjaCI6NiwiLi9zcmMvc29ydCI6NywiLi9zcmMvdGVtcGxhdGVyIjo4LCIuL3NyYy91dGlscy9jbGFzc2VzIjo5LCIuL3NyYy91dGlscy9ldmVudHMiOjEwLCIuL3NyYy91dGlscy9leHRlbmQiOjExLCIuL3NyYy91dGlscy9nZXQtYXR0cmlidXRlIjoxMiwiLi9zcmMvdXRpbHMvZ2V0LWJ5LWNsYXNzIjoxMywiLi9zcmMvdXRpbHMvaW5kZXgtb2YiOjE0LCIuL3NyYy91dGlscy9uYXR1cmFsLXNvcnQiOjE1LCIuL3NyYy91dGlscy90by1hcnJheSI6MTYsIi4vc3JjL3V0aWxzL3RvLXN0cmluZyI6MTd9XSwyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obGlzdCkgew0KICB2YXIgYWRkQXN5bmMgPSBmdW5jdGlvbih2YWx1ZXMsIGNhbGxiYWNrLCBpdGVtcykgew0KICAgIHZhciB2YWx1ZXNUb0FkZCA9IHZhbHVlcy5zcGxpY2UoMCwgNTApOw0KICAgIGl0ZW1zID0gaXRlbXMgfHwgW107DQogICAgaXRlbXMgPSBpdGVtcy5jb25jYXQobGlzdC5hZGQodmFsdWVzVG9BZGQpKTsNCiAgICBpZiAodmFsdWVzLmxlbmd0aCA+IDApIHsNCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgIGFkZEFzeW5jKHZhbHVlcywgY2FsbGJhY2ssIGl0ZW1zKTsNCiAgICAgIH0sIDEpOw0KICAgIH0gZWxzZSB7DQogICAgICBsaXN0LnVwZGF0ZSgpOw0KICAgICAgY2FsbGJhY2soaXRlbXMpOw0KICAgIH0NCiAgfTsNCiAgcmV0dXJuIGFkZEFzeW5jOw0KfTsNCg0KfSx7fV0sMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGxpc3QpIHsNCg0KICAvLyBBZGQgaGFuZGxlcnMNCiAgbGlzdC5oYW5kbGVycy5maWx0ZXJTdGFydCA9IGxpc3QuaGFuZGxlcnMuZmlsdGVyU3RhcnQgfHwgW107DQogIGxpc3QuaGFuZGxlcnMuZmlsdGVyQ29tcGxldGUgPSBsaXN0LmhhbmRsZXJzLmZpbHRlckNvbXBsZXRlIHx8IFtdOw0KDQogIHJldHVybiBmdW5jdGlvbihmaWx0ZXJGdW5jdGlvbikgew0KICAgIGxpc3QudHJpZ2dlcignZmlsdGVyU3RhcnQnKTsNCiAgICBsaXN0LmkgPSAxOyAvLyBSZXNldCBwYWdpbmcNCiAgICBsaXN0LnJlc2V0LmZpbHRlcigpOw0KICAgIGlmIChmaWx0ZXJGdW5jdGlvbiA9PT0gdW5kZWZpbmVkKSB7DQogICAgICBsaXN0LmZpbHRlcmVkID0gZmFsc2U7DQogICAgfSBlbHNlIHsNCiAgICAgIGxpc3QuZmlsdGVyZWQgPSB0cnVlOw0KICAgICAgdmFyIGlzID0gbGlzdC5pdGVtczsNCiAgICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IGlzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsNCiAgICAgICAgdmFyIGl0ZW0gPSBpc1tpXTsNCiAgICAgICAgaWYgKGZpbHRlckZ1bmN0aW9uKGl0ZW0pKSB7DQogICAgICAgICAgaXRlbS5maWx0ZXJlZCA9IHRydWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaXRlbS5maWx0ZXJlZCA9IGZhbHNlOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIGxpc3QudXBkYXRlKCk7DQogICAgbGlzdC50cmlnZ2VyKCdmaWx0ZXJDb21wbGV0ZScpOw0KICAgIHJldHVybiBsaXN0LnZpc2libGVJdGVtczsNCiAgfTsNCn07DQoNCn0se31dLDQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihsaXN0KSB7DQogIHJldHVybiBmdW5jdGlvbihpbml0VmFsdWVzLCBlbGVtZW50LCBub3RDcmVhdGUpIHsNCiAgICB2YXIgaXRlbSA9IHRoaXM7DQoNCiAgICB0aGlzLl92YWx1ZXMgPSB7fTsNCg0KICAgIHRoaXMuZm91bmQgPSBmYWxzZTsgLy8gU2hvdyBpZiBsaXN0LnNlYXJjaGVkID09IHRydWUgYW5kIHRoaXMuZm91bmQgPT0gdHJ1ZQ0KICAgIHRoaXMuZmlsdGVyZWQgPSBmYWxzZTsvLyBTaG93IGlmIGxpc3QuZmlsdGVyZWQgPT0gdHJ1ZSBhbmQgdGhpcy5maWx0ZXJlZCA9PSB0cnVlDQoNCiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKGluaXRWYWx1ZXMsIGVsZW1lbnQsIG5vdENyZWF0ZSkgew0KICAgICAgaWYgKGVsZW1lbnQgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICBpZiAobm90Q3JlYXRlKSB7DQogICAgICAgICAgaXRlbS52YWx1ZXMoaW5pdFZhbHVlcywgbm90Q3JlYXRlKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpdGVtLnZhbHVlcyhpbml0VmFsdWVzKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaXRlbS5lbG0gPSBlbGVtZW50Ow0KICAgICAgICB2YXIgdmFsdWVzID0gbGlzdC50ZW1wbGF0ZXIuZ2V0KGl0ZW0sIGluaXRWYWx1ZXMpOw0KICAgICAgICBpdGVtLnZhbHVlcyh2YWx1ZXMpOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICB0aGlzLnZhbHVlcyA9IGZ1bmN0aW9uKG5ld1ZhbHVlcywgbm90Q3JlYXRlKSB7DQogICAgICBpZiAobmV3VmFsdWVzICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgZm9yKHZhciBuYW1lIGluIG5ld1ZhbHVlcykgew0KICAgICAgICAgIGl0ZW0uX3ZhbHVlc1tuYW1lXSA9IG5ld1ZhbHVlc1tuYW1lXTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAobm90Q3JlYXRlICE9PSB0cnVlKSB7DQogICAgICAgICAgbGlzdC50ZW1wbGF0ZXIuc2V0KGl0ZW0sIGl0ZW0udmFsdWVzKCkpOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gaXRlbS5fdmFsdWVzOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICB0aGlzLnNob3cgPSBmdW5jdGlvbigpIHsNCiAgICAgIGxpc3QudGVtcGxhdGVyLnNob3coaXRlbSk7DQogICAgfTsNCg0KICAgIHRoaXMuaGlkZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgbGlzdC50ZW1wbGF0ZXIuaGlkZShpdGVtKTsNCiAgICB9Ow0KDQogICAgdGhpcy5tYXRjaGluZyA9IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuICgNCiAgICAgICAgKGxpc3QuZmlsdGVyZWQgJiYgbGlzdC5zZWFyY2hlZCAmJiBpdGVtLmZvdW5kICYmIGl0ZW0uZmlsdGVyZWQpIHx8DQogICAgICAgIChsaXN0LmZpbHRlcmVkICYmICFsaXN0LnNlYXJjaGVkICYmIGl0ZW0uZmlsdGVyZWQpIHx8DQogICAgICAgICghbGlzdC5maWx0ZXJlZCAmJiBsaXN0LnNlYXJjaGVkICYmIGl0ZW0uZm91bmQpIHx8DQogICAgICAgICghbGlzdC5maWx0ZXJlZCAmJiAhbGlzdC5zZWFyY2hlZCkNCiAgICAgICk7DQogICAgfTsNCg0KICAgIHRoaXMudmlzaWJsZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIChpdGVtLmVsbSAmJiAoaXRlbS5lbG0ucGFyZW50Tm9kZSA9PSBsaXN0Lmxpc3QpKSA/IHRydWUgOiBmYWxzZTsNCiAgICB9Ow0KDQogICAgaW5pdChpbml0VmFsdWVzLCBlbGVtZW50LCBub3RDcmVhdGUpOw0KICB9Ow0KfTsNCg0KfSx7fV0sNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGxpc3QpIHsNCg0KICB2YXIgSXRlbSA9IHJlcXVpcmUoJy4vaXRlbScpKGxpc3QpOw0KDQogIHZhciBnZXRDaGlsZHJlbiA9IGZ1bmN0aW9uKHBhcmVudCkgew0KICAgIHZhciBub2RlcyA9IHBhcmVudC5jaGlsZE5vZGVzLA0KICAgICAgaXRlbXMgPSBbXTsNCiAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBub2Rlcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICAvLyBPbmx5IHRleHRub2RlcyBoYXZlIGEgZGF0YSBhdHRyaWJ1dGUNCiAgICAgIGlmIChub2Rlc1tpXS5kYXRhID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgaXRlbXMucHVzaChub2Rlc1tpXSk7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBpdGVtczsNCiAgfTsNCg0KICB2YXIgcGFyc2UgPSBmdW5jdGlvbihpdGVtRWxlbWVudHMsIHZhbHVlTmFtZXMpIHsNCiAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBpdGVtRWxlbWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgbGlzdC5pdGVtcy5wdXNoKG5ldyBJdGVtKHZhbHVlTmFtZXMsIGl0ZW1FbGVtZW50c1tpXSkpOw0KICAgIH0NCiAgfTsNCiAgdmFyIHBhcnNlQXN5bmMgPSBmdW5jdGlvbihpdGVtRWxlbWVudHMsIHZhbHVlTmFtZXMpIHsNCiAgICB2YXIgaXRlbXNUb0luZGV4ID0gaXRlbUVsZW1lbnRzLnNwbGljZSgwLCA1MCk7IC8vIFRPRE86IElmIDwgMTAwIGl0ZW1zLCB3aGF0IGhhcHBlbnMgaW4gSUUgZXRjPw0KICAgIHBhcnNlKGl0ZW1zVG9JbmRleCwgdmFsdWVOYW1lcyk7DQogICAgaWYgKGl0ZW1FbGVtZW50cy5sZW5ndGggPiAwKSB7DQogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICBwYXJzZUFzeW5jKGl0ZW1FbGVtZW50cywgdmFsdWVOYW1lcyk7DQogICAgICB9LCAxKTsNCiAgICB9IGVsc2Ugew0KICAgICAgbGlzdC51cGRhdGUoKTsNCiAgICAgIGxpc3QudHJpZ2dlcigncGFyc2VDb21wbGV0ZScpOw0KICAgIH0NCiAgfTsNCg0KICBsaXN0LmhhbmRsZXJzLnBhcnNlQ29tcGxldGUgPSBsaXN0LmhhbmRsZXJzLnBhcnNlQ29tcGxldGUgfHwgW107DQoNCiAgcmV0dXJuIGZ1bmN0aW9uKCkgew0KICAgIHZhciBpdGVtc1RvSW5kZXggPSBnZXRDaGlsZHJlbihsaXN0Lmxpc3QpLA0KICAgICAgdmFsdWVOYW1lcyA9IGxpc3QudmFsdWVOYW1lczsNCg0KICAgIGlmIChsaXN0LmluZGV4QXN5bmMpIHsNCiAgICAgIHBhcnNlQXN5bmMoaXRlbXNUb0luZGV4LCB2YWx1ZU5hbWVzKTsNCiAgICB9IGVsc2Ugew0KICAgICAgcGFyc2UoaXRlbXNUb0luZGV4LCB2YWx1ZU5hbWVzKTsNCiAgICB9DQogIH07DQp9Ow0KDQp9LHsiLi9pdGVtIjo0fV0sNjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGxpc3QpIHsNCiAgdmFyIGl0ZW0sDQogICAgdGV4dCwNCiAgICBjb2x1bW5zLA0KICAgIHNlYXJjaFN0cmluZywNCiAgICBjdXN0b21TZWFyY2g7DQoNCiAgdmFyIHByZXBhcmUgPSB7DQogICAgcmVzZXRMaXN0OiBmdW5jdGlvbigpIHsNCiAgICAgIGxpc3QuaSA9IDE7DQogICAgICBsaXN0LnRlbXBsYXRlci5jbGVhcigpOw0KICAgICAgY3VzdG9tU2VhcmNoID0gdW5kZWZpbmVkOw0KICAgIH0sDQogICAgc2V0T3B0aW9uczogZnVuY3Rpb24oYXJncykgew0KICAgICAgaWYgKGFyZ3MubGVuZ3RoID09IDIgJiYgYXJnc1sxXSBpbnN0YW5jZW9mIEFycmF5KSB7DQogICAgICAgIGNvbHVtbnMgPSBhcmdzWzFdOw0KICAgICAgfSBlbHNlIGlmIChhcmdzLmxlbmd0aCA9PSAyICYmIHR5cGVvZihhcmdzWzFdKSA9PSAiZnVuY3Rpb24iKSB7DQogICAgICAgIGNvbHVtbnMgPSB1bmRlZmluZWQ7DQogICAgICAgIGN1c3RvbVNlYXJjaCA9IGFyZ3NbMV07DQogICAgICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID09IDMpIHsNCiAgICAgICAgY29sdW1ucyA9IGFyZ3NbMV07DQogICAgICAgIGN1c3RvbVNlYXJjaCA9IGFyZ3NbMl07DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb2x1bW5zID0gdW5kZWZpbmVkOw0KICAgICAgfQ0KICAgIH0sDQogICAgc2V0Q29sdW1uczogZnVuY3Rpb24oKSB7DQogICAgICBpZiAobGlzdC5pdGVtcy5sZW5ndGggPT09IDApIHJldHVybjsNCiAgICAgIGlmIChjb2x1bW5zID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgY29sdW1ucyA9IChsaXN0LnNlYXJjaENvbHVtbnMgPT09IHVuZGVmaW5lZCkgPyBwcmVwYXJlLnRvQXJyYXkobGlzdC5pdGVtc1swXS52YWx1ZXMoKSkgOiBsaXN0LnNlYXJjaENvbHVtbnM7DQogICAgICB9DQogICAgfSwNCiAgICBzZXRTZWFyY2hTdHJpbmc6IGZ1bmN0aW9uKHMpIHsNCiAgICAgIHMgPSBsaXN0LnV0aWxzLnRvU3RyaW5nKHMpLnRvTG93ZXJDYXNlKCk7DQogICAgICBzID0gcy5yZXBsYWNlKC9bLVtcXXt9KCkqKz8uLFxcXiR8I10vZywgIlxcJCYiKTsgLy8gRXNjYXBlIHJlZ3VsYXIgZXhwcmVzc2lvbiBjaGFyYWN0ZXJzDQogICAgICBzZWFyY2hTdHJpbmcgPSBzOw0KICAgIH0sDQogICAgdG9BcnJheTogZnVuY3Rpb24odmFsdWVzKSB7DQogICAgICB2YXIgdG1wQ29sdW1uID0gW107DQogICAgICBmb3IgKHZhciBuYW1lIGluIHZhbHVlcykgew0KICAgICAgICB0bXBDb2x1bW4ucHVzaChuYW1lKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiB0bXBDb2x1bW47DQogICAgfQ0KICB9Ow0KICB2YXIgc2VhcmNoID0gew0KICAgIGxpc3Q6IGZ1bmN0aW9uKCkgew0KICAgICAgZm9yICh2YXIgayA9IDAsIGtsID0gbGlzdC5pdGVtcy5sZW5ndGg7IGsgPCBrbDsgaysrKSB7DQogICAgICAgIHNlYXJjaC5pdGVtKGxpc3QuaXRlbXNba10pOw0KICAgICAgfQ0KICAgIH0sDQogICAgaXRlbTogZnVuY3Rpb24oaXRlbSkgew0KICAgICAgaXRlbS5mb3VuZCA9IGZhbHNlOw0KICAgICAgZm9yICh2YXIgaiA9IDAsIGpsID0gY29sdW1ucy5sZW5ndGg7IGogPCBqbDsgaisrKSB7DQogICAgICAgIGlmIChzZWFyY2gudmFsdWVzKGl0ZW0udmFsdWVzKCksIGNvbHVtbnNbal0pKSB7DQogICAgICAgICAgaXRlbS5mb3VuZCA9IHRydWU7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICB2YWx1ZXM6IGZ1bmN0aW9uKHZhbHVlcywgY29sdW1uKSB7DQogICAgICBpZiAodmFsdWVzLmhhc093blByb3BlcnR5KGNvbHVtbikpIHsNCiAgICAgICAgdGV4dCA9IGxpc3QudXRpbHMudG9TdHJpbmcodmFsdWVzW2NvbHVtbl0pLnRvTG93ZXJDYXNlKCk7DQogICAgICAgIGlmICgoc2VhcmNoU3RyaW5nICE9PSAiIikgJiYgKHRleHQuc2VhcmNoKHNlYXJjaFN0cmluZykgPiAtMSkpIHsNCiAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0sDQogICAgcmVzZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgbGlzdC5yZXNldC5zZWFyY2goKTsNCiAgICAgIGxpc3Quc2VhcmNoZWQgPSBmYWxzZTsNCiAgICB9DQogIH07DQoNCiAgdmFyIHNlYXJjaE1ldGhvZCA9IGZ1bmN0aW9uKHN0cikgew0KICAgIGxpc3QudHJpZ2dlcignc2VhcmNoU3RhcnQnKTsNCg0KICAgIHByZXBhcmUucmVzZXRMaXN0KCk7DQogICAgcHJlcGFyZS5zZXRTZWFyY2hTdHJpbmcoc3RyKTsNCiAgICBwcmVwYXJlLnNldE9wdGlvbnMoYXJndW1lbnRzKTsgLy8gc3RyLCBjb2xzfHNlYXJjaEZ1bmN0aW9uLCBzZWFyY2hGdW5jdGlvbg0KICAgIHByZXBhcmUuc2V0Q29sdW1ucygpOw0KDQogICAgaWYgKHNlYXJjaFN0cmluZyA9PT0gIiIgKSB7DQogICAgICBzZWFyY2gucmVzZXQoKTsNCiAgICB9IGVsc2Ugew0KICAgICAgbGlzdC5zZWFyY2hlZCA9IHRydWU7DQogICAgICBpZiAoY3VzdG9tU2VhcmNoKSB7DQogICAgICAgIGN1c3RvbVNlYXJjaChzZWFyY2hTdHJpbmcsIGNvbHVtbnMpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc2VhcmNoLmxpc3QoKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBsaXN0LnVwZGF0ZSgpOw0KICAgIGxpc3QudHJpZ2dlcignc2VhcmNoQ29tcGxldGUnKTsNCiAgICByZXR1cm4gbGlzdC52aXNpYmxlSXRlbXM7DQogIH07DQoNCiAgbGlzdC5oYW5kbGVycy5zZWFyY2hTdGFydCA9IGxpc3QuaGFuZGxlcnMuc2VhcmNoU3RhcnQgfHwgW107DQogIGxpc3QuaGFuZGxlcnMuc2VhcmNoQ29tcGxldGUgPSBsaXN0LmhhbmRsZXJzLnNlYXJjaENvbXBsZXRlIHx8IFtdOw0KDQogIGxpc3QudXRpbHMuZXZlbnRzLmJpbmQobGlzdC51dGlscy5nZXRCeUNsYXNzKGxpc3QubGlzdENvbnRhaW5lciwgbGlzdC5zZWFyY2hDbGFzcyksICdrZXl1cCcsIGZ1bmN0aW9uKGUpIHsNCiAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQgfHwgZS5zcmNFbGVtZW50LCAvLyBJRSBoYXZlIHNyY0VsZW1lbnQNCiAgICAgIGFscmVhZHlDbGVhcmVkID0gKHRhcmdldC52YWx1ZSA9PT0gIiIgJiYgIWxpc3Quc2VhcmNoZWQpOw0KICAgIGlmICghYWxyZWFkeUNsZWFyZWQpIHsgLy8gSWYgb25pbnB1dCBhbHJlYWR5IGhhdmUgcmVzZXR0ZWQgdGhlIGxpc3QsIGRvIG5vdGhpbmcNCiAgICAgIHNlYXJjaE1ldGhvZCh0YXJnZXQudmFsdWUpOw0KICAgIH0NCiAgfSk7DQoNCiAgLy8gVXNlZCB0byBkZXRlY3QgY2xpY2sgb24gSFRNTDUgY2xlYXIgYnV0dG9uDQogIGxpc3QudXRpbHMuZXZlbnRzLmJpbmQobGlzdC51dGlscy5nZXRCeUNsYXNzKGxpc3QubGlzdENvbnRhaW5lciwgbGlzdC5zZWFyY2hDbGFzcyksICdpbnB1dCcsIGZ1bmN0aW9uKGUpIHsNCiAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQgfHwgZS5zcmNFbGVtZW50Ow0KICAgIGlmICh0YXJnZXQudmFsdWUgPT09ICIiKSB7DQogICAgICBzZWFyY2hNZXRob2QoJycpOw0KICAgIH0NCiAgfSk7DQoNCiAgcmV0dXJuIHNlYXJjaE1ldGhvZDsNCn07DQoNCn0se31dLDc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihsaXN0KSB7DQogIGxpc3Quc29ydEZ1bmN0aW9uID0gbGlzdC5zb3J0RnVuY3Rpb24gfHwgZnVuY3Rpb24oaXRlbUEsIGl0ZW1CLCBvcHRpb25zKSB7DQogICAgb3B0aW9ucy5kZXNjID0gb3B0aW9ucy5vcmRlciA9PSAiZGVzYyIgPyB0cnVlIDogZmFsc2U7IC8vIE5hdHVyYWwgc29ydCB1c2VzIHRoaXMgZm9ybWF0DQogICAgcmV0dXJuIGxpc3QudXRpbHMubmF0dXJhbFNvcnQoaXRlbUEudmFsdWVzKClbb3B0aW9ucy52YWx1ZU5hbWVdLCBpdGVtQi52YWx1ZXMoKVtvcHRpb25zLnZhbHVlTmFtZV0sIG9wdGlvbnMpOw0KICB9Ow0KDQogIHZhciBidXR0b25zID0gew0KICAgIGVsczogdW5kZWZpbmVkLA0KICAgIGNsZWFyOiBmdW5jdGlvbigpIHsNCiAgICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IGJ1dHRvbnMuZWxzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsNCiAgICAgICAgbGlzdC51dGlscy5jbGFzc2VzKGJ1dHRvbnMuZWxzW2ldKS5yZW1vdmUoJ2FzYycpOw0KICAgICAgICBsaXN0LnV0aWxzLmNsYXNzZXMoYnV0dG9ucy5lbHNbaV0pLnJlbW92ZSgnZGVzYycpOw0KICAgICAgfQ0KICAgIH0sDQogICAgZ2V0T3JkZXI6IGZ1bmN0aW9uKGJ0bikgew0KICAgICAgdmFyIHByZWRlZmluZWRPcmRlciA9IGxpc3QudXRpbHMuZ2V0QXR0cmlidXRlKGJ0biwgJ2RhdGEtb3JkZXInKTsNCiAgICAgIGlmIChwcmVkZWZpbmVkT3JkZXIgPT0gImFzYyIgfHwgcHJlZGVmaW5lZE9yZGVyID09ICJkZXNjIikgew0KICAgICAgICByZXR1cm4gcHJlZGVmaW5lZE9yZGVyOw0KICAgICAgfSBlbHNlIGlmIChsaXN0LnV0aWxzLmNsYXNzZXMoYnRuKS5oYXMoJ2Rlc2MnKSkgew0KICAgICAgICByZXR1cm4gImFzYyI7DQogICAgICB9IGVsc2UgaWYgKGxpc3QudXRpbHMuY2xhc3NlcyhidG4pLmhhcygnYXNjJykpIHsNCiAgICAgICAgcmV0dXJuICJkZXNjIjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAiYXNjIjsNCiAgICAgIH0NCiAgICB9LA0KICAgIGdldEluU2Vuc2l0aXZlOiBmdW5jdGlvbihidG4sIG9wdGlvbnMpIHsNCiAgICAgIHZhciBpbnNlbnNpdGl2ZSA9IGxpc3QudXRpbHMuZ2V0QXR0cmlidXRlKGJ0biwgJ2RhdGEtaW5zZW5zaXRpdmUnKTsNCiAgICAgIGlmIChpbnNlbnNpdGl2ZSA9PT0gImZhbHNlIikgew0KICAgICAgICBvcHRpb25zLmluc2Vuc2l0aXZlID0gZmFsc2U7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBvcHRpb25zLmluc2Vuc2l0aXZlID0gdHJ1ZTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHNldE9yZGVyOiBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBidXR0b25zLmVscy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICAgIHZhciBidG4gPSBidXR0b25zLmVsc1tpXTsNCiAgICAgICAgaWYgKGxpc3QudXRpbHMuZ2V0QXR0cmlidXRlKGJ0biwgJ2RhdGEtc29ydCcpICE9PSBvcHRpb25zLnZhbHVlTmFtZSkgew0KICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQogICAgICAgIHZhciBwcmVkZWZpbmVkT3JkZXIgPSBsaXN0LnV0aWxzLmdldEF0dHJpYnV0ZShidG4sICdkYXRhLW9yZGVyJyk7DQogICAgICAgIGlmIChwcmVkZWZpbmVkT3JkZXIgPT0gImFzYyIgfHwgcHJlZGVmaW5lZE9yZGVyID09ICJkZXNjIikgew0KICAgICAgICAgIGlmIChwcmVkZWZpbmVkT3JkZXIgPT0gb3B0aW9ucy5vcmRlcikgew0KICAgICAgICAgICAgbGlzdC51dGlscy5jbGFzc2VzKGJ0bikuYWRkKG9wdGlvbnMub3JkZXIpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBsaXN0LnV0aWxzLmNsYXNzZXMoYnRuKS5hZGQob3B0aW9ucy5vcmRlcik7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH07DQogIHZhciBzb3J0ID0gZnVuY3Rpb24oKSB7DQogICAgbGlzdC50cmlnZ2VyKCdzb3J0U3RhcnQnKTsNCiAgICB2YXIgb3B0aW9ucyA9IHt9Ow0KDQogICAgdmFyIHRhcmdldCA9IGFyZ3VtZW50c1swXS5jdXJyZW50VGFyZ2V0IHx8IGFyZ3VtZW50c1swXS5zcmNFbGVtZW50IHx8IHVuZGVmaW5lZDsNCg0KICAgIGlmICh0YXJnZXQpIHsNCiAgICAgIG9wdGlvbnMudmFsdWVOYW1lID0gbGlzdC51dGlscy5nZXRBdHRyaWJ1dGUodGFyZ2V0LCAnZGF0YS1zb3J0Jyk7DQogICAgICBidXR0b25zLmdldEluU2Vuc2l0aXZlKHRhcmdldCwgb3B0aW9ucyk7DQogICAgICBvcHRpb25zLm9yZGVyID0gYnV0dG9ucy5nZXRPcmRlcih0YXJnZXQpOw0KICAgIH0gZWxzZSB7DQogICAgICBvcHRpb25zID0gYXJndW1lbnRzWzFdIHx8IG9wdGlvbnM7DQogICAgICBvcHRpb25zLnZhbHVlTmFtZSA9IGFyZ3VtZW50c1swXTsNCiAgICAgIG9wdGlvbnMub3JkZXIgPSBvcHRpb25zLm9yZGVyIHx8ICJhc2MiOw0KICAgICAgb3B0aW9ucy5pbnNlbnNpdGl2ZSA9ICh0eXBlb2Ygb3B0aW9ucy5pbnNlbnNpdGl2ZSA9PSAidW5kZWZpbmVkIikgPyB0cnVlIDogb3B0aW9ucy5pbnNlbnNpdGl2ZTsNCiAgICB9DQogICAgYnV0dG9ucy5jbGVhcigpOw0KICAgIGJ1dHRvbnMuc2V0T3JkZXIob3B0aW9ucyk7DQoNCiAgICBvcHRpb25zLnNvcnRGdW5jdGlvbiA9IG9wdGlvbnMuc29ydEZ1bmN0aW9uIHx8IGxpc3Quc29ydEZ1bmN0aW9uOw0KICAgIGxpc3QuaXRlbXMuc29ydChmdW5jdGlvbihhLCBiKSB7DQogICAgICB2YXIgbXVsdCA9IChvcHRpb25zLm9yZGVyID09PSAnZGVzYycpID8gLTEgOiAxOw0KICAgICAgcmV0dXJuIChvcHRpb25zLnNvcnRGdW5jdGlvbihhLCBiLCBvcHRpb25zKSAqIG11bHQpOw0KICAgIH0pOw0KICAgIGxpc3QudXBkYXRlKCk7DQogICAgbGlzdC50cmlnZ2VyKCdzb3J0Q29tcGxldGUnKTsNCiAgfTsNCg0KICAvLyBBZGQgaGFuZGxlcnMNCiAgbGlzdC5oYW5kbGVycy5zb3J0U3RhcnQgPSBsaXN0LmhhbmRsZXJzLnNvcnRTdGFydCB8fCBbXTsNCiAgbGlzdC5oYW5kbGVycy5zb3J0Q29tcGxldGUgPSBsaXN0LmhhbmRsZXJzLnNvcnRDb21wbGV0ZSB8fCBbXTsNCg0KICBidXR0b25zLmVscyA9IGxpc3QudXRpbHMuZ2V0QnlDbGFzcyhsaXN0Lmxpc3RDb250YWluZXIsIGxpc3Quc29ydENsYXNzKTsNCiAgbGlzdC51dGlscy5ldmVudHMuYmluZChidXR0b25zLmVscywgJ2NsaWNrJywgc29ydCk7DQogIGxpc3Qub24oJ3NlYXJjaFN0YXJ0JywgYnV0dG9ucy5jbGVhcik7DQogIGxpc3Qub24oJ2ZpbHRlclN0YXJ0JywgYnV0dG9ucy5jbGVhcik7DQoNCiAgcmV0dXJuIHNvcnQ7DQp9Ow0KDQp9LHt9XSw4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCnZhciBUZW1wbGF0ZXIgPSBmdW5jdGlvbihsaXN0KSB7DQogIHZhciBpdGVtU291cmNlLA0KICAgIHRlbXBsYXRlciA9IHRoaXM7DQoNCiAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHsNCiAgICBpdGVtU291cmNlID0gdGVtcGxhdGVyLmdldEl0ZW1Tb3VyY2UobGlzdC5pdGVtKTsNCiAgICBpZiAoaXRlbVNvdXJjZSkgew0KICAgICAgaXRlbVNvdXJjZSA9IHRlbXBsYXRlci5jbGVhclNvdXJjZUl0ZW0oaXRlbVNvdXJjZSwgbGlzdC52YWx1ZU5hbWVzKTsNCiAgICB9DQogIH07DQoNCiAgdGhpcy5jbGVhclNvdXJjZUl0ZW0gPSBmdW5jdGlvbihlbCwgdmFsdWVOYW1lcykgew0KICAgIGZvcih2YXIgaSA9IDAsIGlsID0gdmFsdWVOYW1lcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICB2YXIgZWxtOw0KICAgICAgaWYgKHZhbHVlTmFtZXNbaV0uZGF0YSkgew0KICAgICAgICBmb3IgKHZhciBqID0gMCwgamwgPSB2YWx1ZU5hbWVzW2ldLmRhdGEubGVuZ3RoOyBqIDwgamw7IGorKykgew0KICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnZGF0YS0nK3ZhbHVlTmFtZXNbaV0uZGF0YVtqXSwgJycpOw0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHZhbHVlTmFtZXNbaV0uYXR0ciAmJiB2YWx1ZU5hbWVzW2ldLm5hbWUpIHsNCiAgICAgICAgZWxtID0gbGlzdC51dGlscy5nZXRCeUNsYXNzKGVsLCB2YWx1ZU5hbWVzW2ldLm5hbWUsIHRydWUpOw0KICAgICAgICBpZiAoZWxtKSB7DQogICAgICAgICAgZWxtLnNldEF0dHJpYnV0ZSh2YWx1ZU5hbWVzW2ldLmF0dHIsICIiKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZWxtID0gbGlzdC51dGlscy5nZXRCeUNsYXNzKGVsLCB2YWx1ZU5hbWVzW2ldLCB0cnVlKTsNCiAgICAgICAgaWYgKGVsbSkgew0KICAgICAgICAgIGVsbS5pbm5lckhUTUwgPSAiIjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgZWxtID0gdW5kZWZpbmVkOw0KICAgIH0NCiAgICByZXR1cm4gZWw7DQogIH07DQoNCiAgdGhpcy5nZXRJdGVtU291cmNlID0gZnVuY3Rpb24oaXRlbSkgew0KICAgIGlmIChpdGVtID09PSB1bmRlZmluZWQpIHsNCiAgICAgIHZhciBub2RlcyA9IGxpc3QubGlzdC5jaGlsZE5vZGVzLA0KICAgICAgICBpdGVtcyA9IFtdOw0KDQogICAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBub2Rlcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICAgIC8vIE9ubHkgdGV4dG5vZGVzIGhhdmUgYSBkYXRhIGF0dHJpYnV0ZQ0KICAgICAgICBpZiAobm9kZXNbaV0uZGF0YSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgcmV0dXJuIG5vZGVzW2ldLmNsb25lTm9kZSh0cnVlKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoLzx0cltccz5dL2cuZXhlYyhpdGVtKSkgew0KICAgICAgdmFyIHRib2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGJvZHknKTsNCiAgICAgIHRib2R5LmlubmVySFRNTCA9IGl0ZW07DQogICAgICByZXR1cm4gdGJvZHkuZmlyc3RDaGlsZDsNCiAgICB9IGVsc2UgaWYgKGl0ZW0uaW5kZXhPZigiPCIpICE9PSAtMSkgew0KICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgICAgZGl2LmlubmVySFRNTCA9IGl0ZW07DQogICAgICByZXR1cm4gZGl2LmZpcnN0Q2hpbGQ7DQogICAgfSBlbHNlIHsNCiAgICAgIHZhciBzb3VyY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0Lml0ZW0pOw0KICAgICAgaWYgKHNvdXJjZSkgew0KICAgICAgICByZXR1cm4gc291cmNlOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdW5kZWZpbmVkOw0KICB9Ow0KDQogIHRoaXMuZ2V0ID0gZnVuY3Rpb24oaXRlbSwgdmFsdWVOYW1lcykgew0KICAgIHRlbXBsYXRlci5jcmVhdGUoaXRlbSk7DQogICAgdmFyIHZhbHVlcyA9IHt9Ow0KICAgIGZvcih2YXIgaSA9IDAsIGlsID0gdmFsdWVOYW1lcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7DQogICAgICB2YXIgZWxtOw0KICAgICAgaWYgKHZhbHVlTmFtZXNbaV0uZGF0YSkgew0KICAgICAgICBmb3IgKHZhciBqID0gMCwgamwgPSB2YWx1ZU5hbWVzW2ldLmRhdGEubGVuZ3RoOyBqIDwgamw7IGorKykgew0KICAgICAgICAgIHZhbHVlc1t2YWx1ZU5hbWVzW2ldLmRhdGFbal1dID0gbGlzdC51dGlscy5nZXRBdHRyaWJ1dGUoaXRlbS5lbG0sICdkYXRhLScrdmFsdWVOYW1lc1tpXS5kYXRhW2pdKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICh2YWx1ZU5hbWVzW2ldLmF0dHIgJiYgdmFsdWVOYW1lc1tpXS5uYW1lKSB7DQogICAgICAgIGVsbSA9IGxpc3QudXRpbHMuZ2V0QnlDbGFzcyhpdGVtLmVsbSwgdmFsdWVOYW1lc1tpXS5uYW1lLCB0cnVlKTsNCiAgICAgICAgdmFsdWVzW3ZhbHVlTmFtZXNbaV0ubmFtZV0gPSBlbG0gPyBsaXN0LnV0aWxzLmdldEF0dHJpYnV0ZShlbG0sIHZhbHVlTmFtZXNbaV0uYXR0cikgOiAiIjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGVsbSA9IGxpc3QudXRpbHMuZ2V0QnlDbGFzcyhpdGVtLmVsbSwgdmFsdWVOYW1lc1tpXSwgdHJ1ZSk7DQogICAgICAgIHZhbHVlc1t2YWx1ZU5hbWVzW2ldXSA9IGVsbSA/IGVsbS5pbm5lckhUTUwgOiAiIjsNCiAgICAgIH0NCiAgICAgIGVsbSA9IHVuZGVmaW5lZDsNCiAgICB9DQogICAgcmV0dXJuIHZhbHVlczsNCiAgfTsNCg0KICB0aGlzLnNldCA9IGZ1bmN0aW9uKGl0ZW0sIHZhbHVlcykgew0KICAgIHZhciBnZXRWYWx1ZU5hbWUgPSBmdW5jdGlvbihuYW1lKSB7DQogICAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBsaXN0LnZhbHVlTmFtZXMubGVuZ3RoOyBpIDwgaWw7IGkrKykgew0KICAgICAgICBpZiAobGlzdC52YWx1ZU5hbWVzW2ldLmRhdGEpIHsNCiAgICAgICAgICB2YXIgZGF0YSA9IGxpc3QudmFsdWVOYW1lc1tpXS5kYXRhOw0KICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqbCA9IGRhdGEubGVuZ3RoOyBqIDwgamw7IGorKykgew0KICAgICAgICAgICAgaWYgKGRhdGFbal0gPT09IG5hbWUpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIHsgZGF0YTogbmFtZSB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIGlmIChsaXN0LnZhbHVlTmFtZXNbaV0uYXR0ciAmJiBsaXN0LnZhbHVlTmFtZXNbaV0ubmFtZSAmJiBsaXN0LnZhbHVlTmFtZXNbaV0ubmFtZSA9PSBuYW1lKSB7DQogICAgICAgICAgcmV0dXJuIGxpc3QudmFsdWVOYW1lc1tpXTsNCiAgICAgICAgfSBlbHNlIGlmIChsaXN0LnZhbHVlTmFtZXNbaV0gPT09IG5hbWUpIHsNCiAgICAgICAgICByZXR1cm4gbmFtZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH07DQogICAgdmFyIHNldFZhbHVlID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsNCiAgICAgIHZhciBlbG07DQogICAgICB2YXIgdmFsdWVOYW1lID0gZ2V0VmFsdWVOYW1lKG5hbWUpOw0KICAgICAgaWYgKCF2YWx1ZU5hbWUpDQogICAgICAgIHJldHVybjsNCiAgICAgIGlmICh2YWx1ZU5hbWUuZGF0YSkgew0KICAgICAgICBpdGVtLmVsbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtJyt2YWx1ZU5hbWUuZGF0YSwgdmFsdWUpOw0KICAgICAgfSBlbHNlIGlmICh2YWx1ZU5hbWUuYXR0ciAmJiB2YWx1ZU5hbWUubmFtZSkgew0KICAgICAgICBlbG0gPSBsaXN0LnV0aWxzLmdldEJ5Q2xhc3MoaXRlbS5lbG0sIHZhbHVlTmFtZS5uYW1lLCB0cnVlKTsNCiAgICAgICAgaWYgKGVsbSkgew0KICAgICAgICAgIGVsbS5zZXRBdHRyaWJ1dGUodmFsdWVOYW1lLmF0dHIsIHZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZWxtID0gbGlzdC51dGlscy5nZXRCeUNsYXNzKGl0ZW0uZWxtLCB2YWx1ZU5hbWUsIHRydWUpOw0KICAgICAgICBpZiAoZWxtKSB7DQogICAgICAgICAgZWxtLmlubmVySFRNTCA9IHZhbHVlOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBlbG0gPSB1bmRlZmluZWQ7DQogICAgfTsNCiAgICBpZiAoIXRlbXBsYXRlci5jcmVhdGUoaXRlbSkpIHsNCiAgICAgIGZvcih2YXIgdiBpbiB2YWx1ZXMpIHsNCiAgICAgICAgaWYgKHZhbHVlcy5oYXNPd25Qcm9wZXJ0eSh2KSkgew0KICAgICAgICAgIHNldFZhbHVlKHYsIHZhbHVlc1t2XSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH07DQoNCiAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbihpdGVtKSB7DQogICAgaWYgKGl0ZW0uZWxtICE9PSB1bmRlZmluZWQpIHsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgaWYgKGl0ZW1Tb3VyY2UgPT09IHVuZGVmaW5lZCkgew0KICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgbGlzdCBuZWVkIHRvIGhhdmUgYXQgbGlzdCBvbmUgaXRlbSBvbiBpbml0IG90aGVyd2lzZSB5b3UnbGwgaGF2ZSB0byBhZGQgYSB0ZW1wbGF0ZS4iKTsNCiAgICB9DQogICAgLyogSWYgaXRlbSBzb3VyY2UgZG9lcyBub3QgZXhpc3RzLCB1c2UgdGhlIGZpcnN0IGl0ZW0gaW4gbGlzdCBhcw0KICAgIHNvdXJjZSBmb3IgbmV3IGl0ZW1zICovDQogICAgdmFyIG5ld0l0ZW0gPSBpdGVtU291cmNlLmNsb25lTm9kZSh0cnVlKTsNCiAgICBuZXdJdGVtLnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTsNCiAgICBpdGVtLmVsbSA9IG5ld0l0ZW07DQogICAgdGVtcGxhdGVyLnNldChpdGVtLCBpdGVtLnZhbHVlcygpKTsNCiAgICByZXR1cm4gdHJ1ZTsNCiAgfTsNCiAgdGhpcy5yZW1vdmUgPSBmdW5jdGlvbihpdGVtKSB7DQogICAgaWYgKGl0ZW0uZWxtLnBhcmVudE5vZGUgPT09IGxpc3QubGlzdCkgew0KICAgICAgbGlzdC5saXN0LnJlbW92ZUNoaWxkKGl0ZW0uZWxtKTsNCiAgICB9DQogIH07DQogIHRoaXMuc2hvdyA9IGZ1bmN0aW9uKGl0ZW0pIHsNCiAgICB0ZW1wbGF0ZXIuY3JlYXRlKGl0ZW0pOw0KICAgIGxpc3QubGlzdC5hcHBlbmRDaGlsZChpdGVtLmVsbSk7DQogIH07DQogIHRoaXMuaGlkZSA9IGZ1bmN0aW9uKGl0ZW0pIHsNCiAgICBpZiAoaXRlbS5lbG0gIT09IHVuZGVmaW5lZCAmJiBpdGVtLmVsbS5wYXJlbnROb2RlID09PSBsaXN0Lmxpc3QpIHsNCiAgICAgIGxpc3QubGlzdC5yZW1vdmVDaGlsZChpdGVtLmVsbSk7DQogICAgfQ0KICB9Ow0KICB0aGlzLmNsZWFyID0gZnVuY3Rpb24oKSB7DQogICAgLyogLmlubmVySFRNTCA9ICcnOyBmdWNrcyB1cCBJRSAqLw0KICAgIGlmIChsaXN0Lmxpc3QuaGFzQ2hpbGROb2RlcygpKSB7DQogICAgICB3aGlsZSAobGlzdC5saXN0LmNoaWxkTm9kZXMubGVuZ3RoID49IDEpDQogICAgICB7DQogICAgICAgIGxpc3QubGlzdC5yZW1vdmVDaGlsZChsaXN0Lmxpc3QuZmlyc3RDaGlsZCk7DQogICAgICB9DQogICAgfQ0KICB9Ow0KDQogIGluaXQoKTsNCn07DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obGlzdCkgew0KICByZXR1cm4gbmV3IFRlbXBsYXRlcihsaXN0KTsNCn07DQoNCn0se31dLDk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyoqDQogKiBNb2R1bGUgZGVwZW5kZW5jaWVzLg0KICovDQoNCnZhciBpbmRleCA9IHJlcXVpcmUoJy4vaW5kZXgtb2YnKTsNCg0KLyoqDQogKiBXaGl0ZXNwYWNlIHJlZ2V4cC4NCiAqLw0KDQp2YXIgcmUgPSAvXHMrLzsNCg0KLyoqDQogKiB0b1N0cmluZyByZWZlcmVuY2UuDQogKi8NCg0KdmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsNCg0KLyoqDQogKiBXcmFwIGBlbGAgaW4gYSBgQ2xhc3NMaXN0YC4NCiAqDQogKiBAcGFyYW0ge0VsZW1lbnR9IGVsDQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZWwpew0KICByZXR1cm4gbmV3IENsYXNzTGlzdChlbCk7DQp9Ow0KDQovKioNCiAqIEluaXRpYWxpemUgYSBuZXcgQ2xhc3NMaXN0IGZvciBgZWxgLg0KICoNCiAqIEBwYXJhbSB7RWxlbWVudH0gZWwNCiAqIEBhcGkgcHJpdmF0ZQ0KICovDQoNCmZ1bmN0aW9uIENsYXNzTGlzdChlbCkgew0KICBpZiAoIWVsIHx8ICFlbC5ub2RlVHlwZSkgew0KICAgIHRocm93IG5ldyBFcnJvcignQSBET00gZWxlbWVudCByZWZlcmVuY2UgaXMgcmVxdWlyZWQnKTsNCiAgfQ0KICB0aGlzLmVsID0gZWw7DQogIHRoaXMubGlzdCA9IGVsLmNsYXNzTGlzdDsNCn0NCg0KLyoqDQogKiBBZGQgY2xhc3MgYG5hbWVgIGlmIG5vdCBhbHJlYWR5IHByZXNlbnQuDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IG5hbWUNCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAqIEBhcGkgcHVibGljDQogKi8NCg0KQ2xhc3NMaXN0LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihuYW1lKXsNCiAgLy8gY2xhc3NMaXN0DQogIGlmICh0aGlzLmxpc3QpIHsNCiAgICB0aGlzLmxpc3QuYWRkKG5hbWUpOw0KICAgIHJldHVybiB0aGlzOw0KICB9DQoNCiAgLy8gZmFsbGJhY2sNCiAgdmFyIGFyciA9IHRoaXMuYXJyYXkoKTsNCiAgdmFyIGkgPSBpbmRleChhcnIsIG5hbWUpOw0KICBpZiAoIX5pKSBhcnIucHVzaChuYW1lKTsNCiAgdGhpcy5lbC5jbGFzc05hbWUgPSBhcnIuam9pbignICcpOw0KICByZXR1cm4gdGhpczsNCn07DQoNCi8qKg0KICogUmVtb3ZlIGNsYXNzIGBuYW1lYCB3aGVuIHByZXNlbnQsIG9yDQogKiBwYXNzIGEgcmVndWxhciBleHByZXNzaW9uIHRvIHJlbW92ZQ0KICogYW55IHdoaWNoIG1hdGNoLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfFJlZ0V4cH0gbmFtZQ0KICogQHJldHVybiB7Q2xhc3NMaXN0fQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpDbGFzc0xpc3QucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKG5hbWUpew0KICBpZiAoJ1tvYmplY3QgUmVnRXhwXScgPT0gdG9TdHJpbmcuY2FsbChuYW1lKSkgew0KICAgIHJldHVybiB0aGlzLnJlbW92ZU1hdGNoaW5nKG5hbWUpOw0KICB9DQoNCiAgLy8gY2xhc3NMaXN0DQogIGlmICh0aGlzLmxpc3QpIHsNCiAgICB0aGlzLmxpc3QucmVtb3ZlKG5hbWUpOw0KICAgIHJldHVybiB0aGlzOw0KICB9DQoNCiAgLy8gZmFsbGJhY2sNCiAgdmFyIGFyciA9IHRoaXMuYXJyYXkoKTsNCiAgdmFyIGkgPSBpbmRleChhcnIsIG5hbWUpOw0KICBpZiAofmkpIGFyci5zcGxpY2UoaSwgMSk7DQogIHRoaXMuZWwuY2xhc3NOYW1lID0gYXJyLmpvaW4oJyAnKTsNCiAgcmV0dXJuIHRoaXM7DQp9Ow0KDQovKioNCiAqIFJlbW92ZSBhbGwgY2xhc3NlcyBtYXRjaGluZyBgcmVgLg0KICoNCiAqIEBwYXJhbSB7UmVnRXhwfSByZQ0KICogQHJldHVybiB7Q2xhc3NMaXN0fQ0KICogQGFwaSBwcml2YXRlDQogKi8NCg0KQ2xhc3NMaXN0LnByb3RvdHlwZS5yZW1vdmVNYXRjaGluZyA9IGZ1bmN0aW9uKHJlKXsNCiAgdmFyIGFyciA9IHRoaXMuYXJyYXkoKTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsNCiAgICBpZiAocmUudGVzdChhcnJbaV0pKSB7DQogICAgICB0aGlzLnJlbW92ZShhcnJbaV0pOw0KICAgIH0NCiAgfQ0KICByZXR1cm4gdGhpczsNCn07DQoNCi8qKg0KICogVG9nZ2xlIGNsYXNzIGBuYW1lYCwgY2FuIGZvcmNlIHN0YXRlIHZpYSBgZm9yY2VgLg0KICoNCiAqIEZvciBicm93c2VycyB0aGF0IHN1cHBvcnQgY2xhc3NMaXN0LCBidXQgZG8gbm90IHN1cHBvcnQgYGZvcmNlYCB5ZXQsDQogKiB0aGUgbWlzdGFrZSB3aWxsIGJlIGRldGVjdGVkIGFuZCBjb3JyZWN0ZWQuDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IG5hbWUNCiAqIEBwYXJhbSB7Qm9vbGVhbn0gZm9yY2UNCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAqIEBhcGkgcHVibGljDQogKi8NCg0KQ2xhc3NMaXN0LnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbihuYW1lLCBmb3JjZSl7DQogIC8vIGNsYXNzTGlzdA0KICBpZiAodGhpcy5saXN0KSB7DQogICAgaWYgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZm9yY2UpIHsNCiAgICAgIGlmIChmb3JjZSAhPT0gdGhpcy5saXN0LnRvZ2dsZShuYW1lLCBmb3JjZSkpIHsNCiAgICAgICAgdGhpcy5saXN0LnRvZ2dsZShuYW1lKTsgLy8gdG9nZ2xlIGFnYWluIHRvIGNvcnJlY3QNCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5saXN0LnRvZ2dsZShuYW1lKTsNCiAgICB9DQogICAgcmV0dXJuIHRoaXM7DQogIH0NCg0KICAvLyBmYWxsYmFjaw0KICBpZiAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBmb3JjZSkgew0KICAgIGlmICghZm9yY2UpIHsNCiAgICAgIHRoaXMucmVtb3ZlKG5hbWUpOw0KICAgIH0gZWxzZSB7DQogICAgICB0aGlzLmFkZChuYW1lKTsNCiAgICB9DQogIH0gZWxzZSB7DQogICAgaWYgKHRoaXMuaGFzKG5hbWUpKSB7DQogICAgICB0aGlzLnJlbW92ZShuYW1lKTsNCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5hZGQobmFtZSk7DQogICAgfQ0KICB9DQoNCiAgcmV0dXJuIHRoaXM7DQp9Ow0KDQovKioNCiAqIFJldHVybiBhbiBhcnJheSBvZiBjbGFzc2VzLg0KICoNCiAqIEByZXR1cm4ge0FycmF5fQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpDbGFzc0xpc3QucHJvdG90eXBlLmFycmF5ID0gZnVuY3Rpb24oKXsNCiAgdmFyIGNsYXNzTmFtZSA9IHRoaXMuZWwuZ2V0QXR0cmlidXRlKCdjbGFzcycpIHx8ICcnOw0KICB2YXIgc3RyID0gY2xhc3NOYW1lLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJyk7DQogIHZhciBhcnIgPSBzdHIuc3BsaXQocmUpOw0KICBpZiAoJycgPT09IGFyclswXSkgYXJyLnNoaWZ0KCk7DQogIHJldHVybiBhcnI7DQp9Ow0KDQovKioNCiAqIENoZWNrIGlmIGNsYXNzIGBuYW1lYCBpcyBwcmVzZW50Lg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lDQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCkNsYXNzTGlzdC5wcm90b3R5cGUuaGFzID0NCkNsYXNzTGlzdC5wcm90b3R5cGUuY29udGFpbnMgPSBmdW5jdGlvbihuYW1lKXsNCiAgcmV0dXJuIHRoaXMubGlzdCA/IHRoaXMubGlzdC5jb250YWlucyhuYW1lKSA6ICEhIH5pbmRleCh0aGlzLmFycmF5KCksIG5hbWUpOw0KfTsNCg0KfSx7Ii4vaW5kZXgtb2YiOjE0fV0sMTA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KdmFyIGJpbmQgPSB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciA/ICdhZGRFdmVudExpc3RlbmVyJyA6ICdhdHRhY2hFdmVudCcsDQogICAgdW5iaW5kID0gd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIgPyAncmVtb3ZlRXZlbnRMaXN0ZW5lcicgOiAnZGV0YWNoRXZlbnQnLA0KICAgIHByZWZpeCA9IGJpbmQgIT09ICdhZGRFdmVudExpc3RlbmVyJyA/ICdvbicgOiAnJywNCiAgICB0b0FycmF5ID0gcmVxdWlyZSgnLi90by1hcnJheScpOw0KDQovKioNCiAqIEJpbmQgYGVsYCBldmVudCBgdHlwZWAgdG8gYGZuYC4NCiAqDQogKiBAcGFyYW0ge0VsZW1lbnR9IGVsLCBOb2RlTGlzdCwgSFRNTENvbGxlY3Rpb24gb3IgQXJyYXkNCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbg0KICogQHBhcmFtIHtCb29sZWFufSBjYXB0dXJlDQogKiBAYXBpIHB1YmxpYw0KICovDQoNCmV4cG9ydHMuYmluZCA9IGZ1bmN0aW9uKGVsLCB0eXBlLCBmbiwgY2FwdHVyZSl7DQogIGVsID0gdG9BcnJheShlbCk7DQogIGZvciAoIHZhciBpID0gMDsgaSA8IGVsLmxlbmd0aDsgaSsrICkgew0KICAgIGVsW2ldW2JpbmRdKHByZWZpeCArIHR5cGUsIGZuLCBjYXB0dXJlIHx8IGZhbHNlKTsNCiAgfQ0KfTsNCg0KLyoqDQogKiBVbmJpbmQgYGVsYCBldmVudCBgdHlwZWAncyBjYWxsYmFjayBgZm5gLg0KICoNCiAqIEBwYXJhbSB7RWxlbWVudH0gZWwsIE5vZGVMaXN0LCBIVE1MQ29sbGVjdGlvbiBvciBBcnJheQ0KICogQHBhcmFtIHtTdHJpbmd9IHR5cGUNCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuDQogKiBAcGFyYW0ge0Jvb2xlYW59IGNhcHR1cmUNCiAqIEBhcGkgcHVibGljDQogKi8NCg0KZXhwb3J0cy51bmJpbmQgPSBmdW5jdGlvbihlbCwgdHlwZSwgZm4sIGNhcHR1cmUpew0KICBlbCA9IHRvQXJyYXkoZWwpOw0KICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBlbC5sZW5ndGg7IGkrKyApIHsNCiAgICBlbFtpXVt1bmJpbmRdKHByZWZpeCArIHR5cGUsIGZuLCBjYXB0dXJlIHx8IGZhbHNlKTsNCiAgfQ0KfTsNCg0KfSx7Ii4vdG8tYXJyYXkiOjE2fV0sMTE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyoNCiAqIFNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9leHRlbmQNCiAqLw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGV4dGVuZCAob2JqZWN0KSB7DQogICAgLy8gVGFrZXMgYW4gdW5saW1pdGVkIG51bWJlciBvZiBleHRlbmRlcnMuDQogICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOw0KDQogICAgLy8gRm9yIGVhY2ggZXh0ZW5kZXIsIGNvcHkgdGhlaXIgcHJvcGVydGllcyBvbiBvdXIgb2JqZWN0Lg0KICAgIGZvciAodmFyIGkgPSAwLCBzb3VyY2U7IHNvdXJjZSA9IGFyZ3NbaV07IGkrKykgew0KICAgICAgICBpZiAoIXNvdXJjZSkgY29udGludWU7DQogICAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIHNvdXJjZSkgew0KICAgICAgICAgICAgb2JqZWN0W3Byb3BlcnR5XSA9IHNvdXJjZVtwcm9wZXJ0eV07DQogICAgICAgIH0NCiAgICB9DQoNCiAgICByZXR1cm4gb2JqZWN0Ow0KfTsNCg0KfSx7fV0sMTI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyoqDQogKiBBIGNyb3NzLWJyb3dzZXIgaW1wbGVtZW50YXRpb24gb2YgZ2V0QXR0cmlidXRlLg0KICogU291cmNlIGZvdW5kIGhlcmU6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzM3NTUzNDMvMzYxMzM3IHdyaXR0ZW4gYnkgVml2aW4gUGFsaWF0aA0KICoNCiAqIFJldHVybiB0aGUgdmFsdWUgZm9yIGBhdHRyYCBhdCBgZWxlbWVudGAuDQogKg0KICogQHBhcmFtIHtFbGVtZW50fSBlbA0KICogQHBhcmFtIHtTdHJpbmd9IGF0dHINCiAqIEBhcGkgcHVibGljDQogKi8NCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihlbCwgYXR0cikgew0KICB2YXIgcmVzdWx0ID0gKGVsLmdldEF0dHJpYnV0ZSAmJiBlbC5nZXRBdHRyaWJ1dGUoYXR0cikpIHx8IG51bGw7DQogIGlmKCAhcmVzdWx0ICkgew0KICAgIHZhciBhdHRycyA9IGVsLmF0dHJpYnV0ZXM7DQogICAgdmFyIGxlbmd0aCA9IGF0dHJzLmxlbmd0aDsNCiAgICBmb3IodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICAgIGlmIChhdHRyW2ldICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgaWYoYXR0cltpXS5ub2RlTmFtZSA9PT0gYXR0cikgew0KICAgICAgICAgIHJlc3VsdCA9IGF0dHJbaV0ubm9kZVZhbHVlOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9DQogIHJldHVybiByZXN1bHQ7DQp9Ow0KDQp9LHt9XSwxMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQovKioNCiAqIEEgY3Jvc3MtYnJvd3NlciBpbXBsZW1lbnRhdGlvbiBvZiBnZXRFbGVtZW50c0J5Q2xhc3MuDQogKiBIZWF2aWx5IGJhc2VkIG9uIER1c3RpbiBEaWF6J3MgZnVuY3Rpb246IGh0dHA6Ly9kdXN0aW5kaWF6LmNvbS9nZXRlbGVtZW50c2J5Y2xhc3MuDQogKg0KICogRmluZCBhbGwgZWxlbWVudHMgd2l0aCBjbGFzcyBgY2xhc3NOYW1lYCBpbnNpZGUgYGNvbnRhaW5lcmAuDQogKiBVc2UgYHNpbmdsZSA9IHRydWVgIHRvIGluY3JlYXNlIHBlcmZvcm1hbmNlIGluIG9sZGVyIGJyb3dzZXJzDQogKiB3aGVuIG9ubHkgb25lIGVsZW1lbnQgaXMgbmVlZGVkLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBjbGFzc05hbWUNCiAqIEBwYXJhbSB7RWxlbWVudH0gY29udGFpbmVyDQogKiBAcGFyYW0ge0Jvb2xlYW59IHNpbmdsZQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQptb2R1bGUuZXhwb3J0cyA9IChmdW5jdGlvbigpIHsNCiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24oY29udGFpbmVyLCBjbGFzc05hbWUsIHNpbmdsZSkgew0KICAgICAgaWYgKHNpbmdsZSkgew0KICAgICAgICByZXR1cm4gY29udGFpbmVyLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoY2xhc3NOYW1lKVswXTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBjb250YWluZXIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjbGFzc05hbWUpOw0KICAgICAgfQ0KICAgIH07DQogIH0gZWxzZSBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3Rvcikgew0KICAgIHJldHVybiBmdW5jdGlvbihjb250YWluZXIsIGNsYXNzTmFtZSwgc2luZ2xlKSB7DQogICAgICBjbGFzc05hbWUgPSAnLicgKyBjbGFzc05hbWU7DQogICAgICBpZiAoc2luZ2xlKSB7DQogICAgICAgIHJldHVybiBjb250YWluZXIucXVlcnlTZWxlY3RvcihjbGFzc05hbWUpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKGNsYXNzTmFtZSk7DQogICAgICB9DQogICAgfTsNCiAgfSBlbHNlIHsNCiAgICByZXR1cm4gZnVuY3Rpb24oY29udGFpbmVyLCBjbGFzc05hbWUsIHNpbmdsZSkgew0KICAgICAgdmFyIGNsYXNzRWxlbWVudHMgPSBbXSwNCiAgICAgICAgdGFnID0gJyonOw0KICAgICAgaWYgKGNvbnRhaW5lciA9PT0gbnVsbCkgew0KICAgICAgICBjb250YWluZXIgPSBkb2N1bWVudDsNCiAgICAgIH0NCiAgICAgIHZhciBlbHMgPSBjb250YWluZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnKTsNCiAgICAgIHZhciBlbHNMZW4gPSBlbHMubGVuZ3RoOw0KICAgICAgdmFyIHBhdHRlcm4gPSBuZXcgUmVnRXhwKCIoXnxcXHMpIitjbGFzc05hbWUrIihcXHN8JCkiKTsNCiAgICAgIGZvciAodmFyIGkgPSAwLCBqID0gMDsgaSA8IGVsc0xlbjsgaSsrKSB7DQogICAgICAgIGlmICggcGF0dGVybi50ZXN0KGVsc1tpXS5jbGFzc05hbWUpICkgew0KICAgICAgICAgIGlmIChzaW5nbGUpIHsNCiAgICAgICAgICAgIHJldHVybiBlbHNbaV07DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNsYXNzRWxlbWVudHNbal0gPSBlbHNbaV07DQogICAgICAgICAgICBqKys7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gY2xhc3NFbGVtZW50czsNCiAgICB9Ow0KICB9DQp9KSgpOw0KDQp9LHt9XSwxNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQp2YXIgaW5kZXhPZiA9IFtdLmluZGV4T2Y7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYXJyLCBvYmopew0KICBpZiAoaW5kZXhPZikgcmV0dXJuIGFyci5pbmRleE9mKG9iaik7DQogIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgKytpKSB7DQogICAgaWYgKGFycltpXSA9PT0gb2JqKSByZXR1cm4gaTsNCiAgfQ0KICByZXR1cm4gLTE7DQp9Ow0KDQp9LHt9XSwxNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQovKg0KICogTmF0dXJhbCBTb3J0IGFsZ29yaXRobSBmb3IgSmF2YXNjcmlwdCAtIFZlcnNpb24gMC44LjEgLSBSZWxlYXNlZCB1bmRlciBNSVQgbGljZW5zZQ0KICogQXV0aG9yOiBKaW0gUGFsbWVyIChiYXNlZCBvbiBjaHVua2luZyBpZGVhIGZyb20gRGF2ZSBLb2VsbGUpDQogKi8NCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYSwgYiwgb3B0cykgew0KICAgIHZhciByZSA9IC8oXihbK1wtXT9cZCsoPzpcLlxkKik/KD86W2VFXVsrXC1dP1xkKyk/KD89XER8XHN8JCkpfF4weFtcZGEtZkEtRl0rJHxcZCspL2csDQogICAgICAgIHNyZSA9IC9eXHMrfFxzKyQvZywgICAvLyB0cmltIHByZS1wb3N0IHdoaXRlc3BhY2UNCiAgICAgICAgc25yZSA9IC9ccysvZywgICAgICAgIC8vIG5vcm1hbGl6ZSBhbGwgd2hpdGVzcGFjZSB0byBzaW5nbGUgJyAnIGNoYXJhY3Rlcg0KICAgICAgICBkcmUgPSAvKF4oW1x3IF0rLD9bXHcgXSspP1tcdyBdKyw/W1x3IF0rXGQrOlxkKyg6XGQrKT9bXHcgXT98XlxkezEsNH1bXC9cLV1cZHsxLDR9W1wvXC1dXGR7MSw0fXxeXHcrLCBcdysgXGQrLCBcZHs0fSkvLA0KICAgICAgICBocmUgPSAvXjB4WzAtOWEtZl0rJC9pLA0KICAgICAgICBvcmUgPSAvXjAvLA0KICAgICAgICBvcHRpb25zID0gb3B0cyB8fCB7fSwNCiAgICAgICAgaSA9IGZ1bmN0aW9uKHMpIHsNCiAgICAgICAgICAgIHJldHVybiAob3B0aW9ucy5pbnNlbnNpdGl2ZSAmJiAoJycgKyBzKS50b0xvd2VyQ2FzZSgpIHx8ICcnICsgcykucmVwbGFjZShzcmUsICcnKTsNCiAgICAgICAgfSwNCiAgICAgICAgLy8gY29udmVydCBhbGwgdG8gc3RyaW5ncyBzdHJpcCB3aGl0ZXNwYWNlDQogICAgICAgIHggPSBpKGEpLA0KICAgICAgICB5ID0gaShiKSwNCiAgICAgICAgLy8gY2h1bmsvdG9rZW5pemUNCiAgICAgICAgeE4gPSB4LnJlcGxhY2UocmUsICdcMCQxXDAnKS5yZXBsYWNlKC9cMCQvLCcnKS5yZXBsYWNlKC9eXDAvLCcnKS5zcGxpdCgnXDAnKSwNCiAgICAgICAgeU4gPSB5LnJlcGxhY2UocmUsICdcMCQxXDAnKS5yZXBsYWNlKC9cMCQvLCcnKS5yZXBsYWNlKC9eXDAvLCcnKS5zcGxpdCgnXDAnKSwNCiAgICAgICAgLy8gbnVtZXJpYywgaGV4IG9yIGRhdGUgZGV0ZWN0aW9uDQogICAgICAgIHhEID0gcGFyc2VJbnQoeC5tYXRjaChocmUpLCAxNikgfHwgKHhOLmxlbmd0aCAhPT0gMSAmJiBEYXRlLnBhcnNlKHgpKSwNCiAgICAgICAgeUQgPSBwYXJzZUludCh5Lm1hdGNoKGhyZSksIDE2KSB8fCB4RCAmJiB5Lm1hdGNoKGRyZSkgJiYgRGF0ZS5wYXJzZSh5KSB8fCBudWxsLA0KICAgICAgICBub3JtQ2h1bmsgPSBmdW5jdGlvbihzLCBsKSB7DQogICAgICAgICAgIC8vIG5vcm1hbGl6ZSBzcGFjZXM7IGZpbmQgZmxvYXRzIG5vdCBzdGFydGluZyB3aXRoICcwJywgc3RyaW5nIG9yIDAgaWYgbm90IGRlZmluZWQgKENsaW50IFByaWVzdCkNCiAgICAgICAgICAgcmV0dXJuICghcy5tYXRjaChvcmUpIHx8IGwgPT0gMSkgJiYgcGFyc2VGbG9hdChzKSB8fCBzLnJlcGxhY2Uoc25yZSwgJyAnKS5yZXBsYWNlKHNyZSwgJycpIHx8IDA7DQogICAgICAgIH0sDQogICAgICAgIG9GeE5jTCwgb0Z5TmNMOw0KICAgLy8gZmlyc3QgdHJ5IGFuZCBzb3J0IEhleCBjb2RlcyBvciBEYXRlcw0KICAgaWYgKHlEKSB7DQogICAgICAgaWYgKHhEIDwgeUQpIHsgcmV0dXJuIC0xOyB9DQogICAgICAgZWxzZSBpZiAoeEQgPiB5RCkgeyByZXR1cm4gMTsgfQ0KICAgfQ0KICAgLy8gbmF0dXJhbCBzb3J0aW5nIHRocm91Z2ggc3BsaXQgbnVtZXJpYyBzdHJpbmdzIGFuZCBkZWZhdWx0IHN0cmluZ3MNCiAgIGZvcih2YXIgY0xvYyA9IDAsIHhObCA9IHhOLmxlbmd0aCwgeU5sID0geU4ubGVuZ3RoLCBudW1TID0gTWF0aC5tYXgoeE5sLCB5TmwpOyBjTG9jIDwgbnVtUzsgY0xvYysrKSB7DQogICAgICAgb0Z4TmNMID0gbm9ybUNodW5rKHhOW2NMb2NdIHx8ICcnLCB4TmwpOw0KICAgICAgIG9GeU5jTCA9IG5vcm1DaHVuayh5TltjTG9jXSB8fCAnJywgeU5sKTsNCiAgICAgICAvLyBoYW5kbGUgbnVtZXJpYyB2cyBzdHJpbmcgY29tcGFyaXNvbiAtIG51bWJlciA8IHN0cmluZyAtIChLeWxlIEFkYW1zKQ0KICAgICAgIGlmIChpc05hTihvRnhOY0wpICE9PSBpc05hTihvRnlOY0wpKSB7DQogICAgICAgICAgIHJldHVybiBpc05hTihvRnhOY0wpID8gMSA6IC0xOw0KICAgICAgIH0NCiAgICAgICAvLyBpZiB1bmljb2RlIHVzZSBsb2NhbGUgY29tcGFyaXNvbg0KICAgICAgIGlmICgvW15ceDAwLVx4ODBdLy50ZXN0KG9GeE5jTCArIG9GeU5jTCkgJiYgb0Z4TmNMLmxvY2FsZUNvbXBhcmUpIHsNCiAgICAgICAgICAgdmFyIGNvbXAgPSBvRnhOY0wubG9jYWxlQ29tcGFyZShvRnlOY0wpOw0KICAgICAgICAgICByZXR1cm4gY29tcCAvIE1hdGguYWJzKGNvbXApOw0KICAgICAgIH0NCiAgICAgICBpZiAob0Z4TmNMIDwgb0Z5TmNMKSB7IHJldHVybiAtMTsgfQ0KICAgICAgIGVsc2UgaWYgKG9GeE5jTCA+IG9GeU5jTCkgeyByZXR1cm4gMTsgfQ0KICAgfQ0KICAgIHJldHVybiAwOw0KfTsNCg0KfSx7fV0sMTY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyoqDQogKiBTb3VyY2U6IGh0dHBzOi8vZ2l0aHViLmNvbS90aW1veGxleS90by1hcnJheQ0KICoNCiAqIENvbnZlcnQgYW4gYXJyYXktbGlrZSBvYmplY3QgaW50byBhbiBgQXJyYXlgLg0KICogSWYgYGNvbGxlY3Rpb25gIGlzIGFscmVhZHkgYW4gYEFycmF5YCwgdGhlbiB3aWxsIHJldHVybiBhIGNsb25lIG9mIGBjb2xsZWN0aW9uYC4NCiAqDQogKiBAcGFyYW0ge0FycmF5IHwgTWl4ZWR9IGNvbGxlY3Rpb24gQW4gYEFycmF5YCBvciBhcnJheS1saWtlIG9iamVjdCB0byBjb252ZXJ0IGUuZy4gYGFyZ3VtZW50c2Agb3IgYE5vZGVMaXN0YA0KICogQHJldHVybiB7QXJyYXl9IE5haXZlIGNvbnZlcnNpb24gb2YgYGNvbGxlY3Rpb25gIHRvIGEgbmV3IGBBcnJheWAuDQogKiBAYXBpIHB1YmxpYw0KICovDQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gdG9BcnJheShjb2xsZWN0aW9uKSB7DQogIGlmICh0eXBlb2YgY29sbGVjdGlvbiA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiBbXTsNCiAgaWYgKGNvbGxlY3Rpb24gPT09IG51bGwpIHJldHVybiBbbnVsbF07DQogIGlmIChjb2xsZWN0aW9uID09PSB3aW5kb3cpIHJldHVybiBbd2luZG93XTsNCiAgaWYgKHR5cGVvZiBjb2xsZWN0aW9uID09PSAnc3RyaW5nJykgcmV0dXJuIFtjb2xsZWN0aW9uXTsNCiAgaWYgKGlzQXJyYXkoY29sbGVjdGlvbikpIHJldHVybiBjb2xsZWN0aW9uOw0KICBpZiAodHlwZW9mIGNvbGxlY3Rpb24ubGVuZ3RoICE9ICdudW1iZXInKSByZXR1cm4gW2NvbGxlY3Rpb25dOw0KICBpZiAodHlwZW9mIGNvbGxlY3Rpb24gPT09ICdmdW5jdGlvbicgJiYgY29sbGVjdGlvbiBpbnN0YW5jZW9mIEZ1bmN0aW9uKSByZXR1cm4gW2NvbGxlY3Rpb25dOw0KDQogIHZhciBhcnIgPSBbXTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2xsZWN0aW9uLmxlbmd0aDsgaSsrKSB7DQogICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChjb2xsZWN0aW9uLCBpKSB8fCBpIGluIGNvbGxlY3Rpb24pIHsNCiAgICAgIGFyci5wdXNoKGNvbGxlY3Rpb25baV0pOw0KICAgIH0NCiAgfQ0KICBpZiAoIWFyci5sZW5ndGgpIHJldHVybiBbXTsNCiAgcmV0dXJuIGFycjsNCn07DQoNCmZ1bmN0aW9uIGlzQXJyYXkoYXJyKSB7DQogIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKSA9PT0gIltvYmplY3QgQXJyYXldIjsNCn0NCg0KfSx7fV0sMTc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihzKSB7DQogIHMgPSAocyA9PT0gdW5kZWZpbmVkKSA/ICIiIDogczsNCiAgcyA9IChzID09PSBudWxsKSA/ICIiIDogczsNCiAgcyA9IHMudG9TdHJpbmcoKTsNCiAgcmV0dXJuIHM7DQp9Ow0KDQp9LHt9XX0se30sWzFdKTsNCg0KICA8L3NjcmlwdD4NCiAgPHNjcmlwdD4NCiAgOyhmdW5jdGlvbigpew0KDQovKioNCiAqIFJlcXVpcmUgdGhlIGdpdmVuIHBhdGguDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IHBhdGgNCiAqIEByZXR1cm4ge09iamVjdH0gZXhwb3J0cw0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpmdW5jdGlvbiByZXF1aXJlKHBhdGgsIHBhcmVudCwgb3JpZykgew0KICB2YXIgcmVzb2x2ZWQgPSByZXF1aXJlLnJlc29sdmUocGF0aCk7DQoNCiAgLy8gbG9va3VwIGZhaWxlZA0KICBpZiAobnVsbCA9PSByZXNvbHZlZCkgew0KICAgIG9yaWcgPSBvcmlnIHx8IHBhdGg7DQogICAgcGFyZW50ID0gcGFyZW50IHx8ICdyb290JzsNCiAgICB2YXIgZXJyID0gbmV3IEVycm9yKCdGYWlsZWQgdG8gcmVxdWlyZSAiJyArIG9yaWcgKyAnIiBmcm9tICInICsgcGFyZW50ICsgJyInKTsNCiAgICBlcnIucGF0aCA9IG9yaWc7DQogICAgZXJyLnBhcmVudCA9IHBhcmVudDsNCiAgICBlcnIucmVxdWlyZSA9IHRydWU7DQogICAgdGhyb3cgZXJyOw0KICB9DQoNCiAgdmFyIG1vZHVsZSA9IHJlcXVpcmUubW9kdWxlc1tyZXNvbHZlZF07DQoNCiAgLy8gcGVyZm9ybSByZWFsIHJlcXVpcmUoKQ0KICAvLyBieSBpbnZva2luZyB0aGUgbW9kdWxlJ3MNCiAgLy8gcmVnaXN0ZXJlZCBmdW5jdGlvbg0KICBpZiAoIW1vZHVsZS5fcmVzb2x2aW5nICYmICFtb2R1bGUuZXhwb3J0cykgew0KICAgIHZhciBtb2QgPSB7fTsNCiAgICBtb2QuZXhwb3J0cyA9IHt9Ow0KICAgIG1vZC5jbGllbnQgPSBtb2QuY29tcG9uZW50ID0gdHJ1ZTsNCiAgICBtb2R1bGUuX3Jlc29sdmluZyA9IHRydWU7DQogICAgbW9kdWxlLmNhbGwodGhpcywgbW9kLmV4cG9ydHMsIHJlcXVpcmUucmVsYXRpdmUocmVzb2x2ZWQpLCBtb2QpOw0KICAgIGRlbGV0ZSBtb2R1bGUuX3Jlc29sdmluZzsNCiAgICBtb2R1bGUuZXhwb3J0cyA9IG1vZC5leHBvcnRzOw0KICB9DQoNCiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOw0KfQ0KDQovKioNCiAqIFJlZ2lzdGVyZWQgbW9kdWxlcy4NCiAqLw0KDQpyZXF1aXJlLm1vZHVsZXMgPSB7fTsNCg0KLyoqDQogKiBSZWdpc3RlcmVkIGFsaWFzZXMuDQogKi8NCg0KcmVxdWlyZS5hbGlhc2VzID0ge307DQoNCi8qKg0KICogUmVzb2x2ZSBgcGF0aGAuDQogKg0KICogTG9va3VwOg0KICoNCiAqICAgLSBQQVRIL2luZGV4LmpzDQogKiAgIC0gUEFUSC5qcw0KICogICAtIFBBVEgNCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gcGF0aA0KICogQHJldHVybiB7U3RyaW5nfSBwYXRoIG9yIG51bGwNCiAqIEBhcGkgcHJpdmF0ZQ0KICovDQoNCnJlcXVpcmUucmVzb2x2ZSA9IGZ1bmN0aW9uKHBhdGgpIHsNCiAgaWYgKHBhdGguY2hhckF0KDApID09PSAnLycpIHBhdGggPSBwYXRoLnNsaWNlKDEpOw0KDQogIHZhciBwYXRocyA9IFsNCiAgICBwYXRoLA0KICAgIHBhdGggKyAnLmpzJywNCiAgICBwYXRoICsgJy5qc29uJywNCiAgICBwYXRoICsgJy9pbmRleC5qcycsDQogICAgcGF0aCArICcvaW5kZXguanNvbicNCiAgXTsNCg0KICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGhzLmxlbmd0aDsgaSsrKSB7DQogICAgdmFyIHBhdGggPSBwYXRoc1tpXTsNCiAgICBpZiAocmVxdWlyZS5tb2R1bGVzLmhhc093blByb3BlcnR5KHBhdGgpKSByZXR1cm4gcGF0aDsNCiAgICBpZiAocmVxdWlyZS5hbGlhc2VzLmhhc093blByb3BlcnR5KHBhdGgpKSByZXR1cm4gcmVxdWlyZS5hbGlhc2VzW3BhdGhdOw0KICB9DQp9Ow0KDQovKioNCiAqIE5vcm1hbGl6ZSBgcGF0aGAgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgcGF0aC4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gY3Vycg0KICogQHBhcmFtIHtTdHJpbmd9IHBhdGgNCiAqIEByZXR1cm4ge1N0cmluZ30NCiAqIEBhcGkgcHJpdmF0ZQ0KICovDQoNCnJlcXVpcmUubm9ybWFsaXplID0gZnVuY3Rpb24oY3VyciwgcGF0aCkgew0KICB2YXIgc2VncyA9IFtdOw0KDQogIGlmICgnLicgIT0gcGF0aC5jaGFyQXQoMCkpIHJldHVybiBwYXRoOw0KDQogIGN1cnIgPSBjdXJyLnNwbGl0KCcvJyk7DQogIHBhdGggPSBwYXRoLnNwbGl0KCcvJyk7DQoNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgKytpKSB7DQogICAgaWYgKCcuLicgPT0gcGF0aFtpXSkgew0KICAgICAgY3Vyci5wb3AoKTsNCiAgICB9IGVsc2UgaWYgKCcuJyAhPSBwYXRoW2ldICYmICcnICE9IHBhdGhbaV0pIHsNCiAgICAgIHNlZ3MucHVzaChwYXRoW2ldKTsNCiAgICB9DQogIH0NCg0KICByZXR1cm4gY3Vyci5jb25jYXQoc2Vncykuam9pbignLycpOw0KfTsNCg0KLyoqDQogKiBSZWdpc3RlciBtb2R1bGUgYXQgYHBhdGhgIHdpdGggY2FsbGJhY2sgYGRlZmluaXRpb25gLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBkZWZpbml0aW9uDQogKiBAYXBpIHByaXZhdGUNCiAqLw0KDQpyZXF1aXJlLnJlZ2lzdGVyID0gZnVuY3Rpb24ocGF0aCwgZGVmaW5pdGlvbikgew0KICByZXF1aXJlLm1vZHVsZXNbcGF0aF0gPSBkZWZpbml0aW9uOw0KfTsNCg0KLyoqDQogKiBBbGlhcyBhIG1vZHVsZSBkZWZpbml0aW9uLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBmcm9tDQogKiBAcGFyYW0ge1N0cmluZ30gdG8NCiAqIEBhcGkgcHJpdmF0ZQ0KICovDQoNCnJlcXVpcmUuYWxpYXMgPSBmdW5jdGlvbihmcm9tLCB0bykgew0KICBpZiAoIXJlcXVpcmUubW9kdWxlcy5oYXNPd25Qcm9wZXJ0eShmcm9tKSkgew0KICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGFsaWFzICInICsgZnJvbSArICciLCBpdCBkb2VzIG5vdCBleGlzdCcpOw0KICB9DQogIHJlcXVpcmUuYWxpYXNlc1t0b10gPSBmcm9tOw0KfTsNCg0KLyoqDQogKiBSZXR1cm4gYSByZXF1aXJlIGZ1bmN0aW9uIHJlbGF0aXZlIHRvIHRoZSBgcGFyZW50YCBwYXRoLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXJlbnQNCiAqIEByZXR1cm4ge0Z1bmN0aW9ufQ0KICogQGFwaSBwcml2YXRlDQogKi8NCg0KcmVxdWlyZS5yZWxhdGl2ZSA9IGZ1bmN0aW9uKHBhcmVudCkgew0KICB2YXIgcCA9IHJlcXVpcmUubm9ybWFsaXplKHBhcmVudCwgJy4uJyk7DQoNCiAgLyoqDQogICAqIGxhc3RJbmRleE9mIGhlbHBlci4NCiAgICovDQoNCiAgZnVuY3Rpb24gbGFzdEluZGV4T2YoYXJyLCBvYmopIHsNCiAgICB2YXIgaSA9IGFyci5sZW5ndGg7DQogICAgd2hpbGUgKGktLSkgew0KICAgICAgaWYgKGFycltpXSA9PT0gb2JqKSByZXR1cm4gaTsNCiAgICB9DQogICAgcmV0dXJuIC0xOw0KICB9DQoNCiAgLyoqDQogICAqIFRoZSByZWxhdGl2ZSByZXF1aXJlKCkgaXRzZWxmLg0KICAgKi8NCg0KICBmdW5jdGlvbiBsb2NhbFJlcXVpcmUocGF0aCkgew0KICAgIHZhciByZXNvbHZlZCA9IGxvY2FsUmVxdWlyZS5yZXNvbHZlKHBhdGgpOw0KICAgIHJldHVybiByZXF1aXJlKHJlc29sdmVkLCBwYXJlbnQsIHBhdGgpOw0KICB9DQoNCiAgLyoqDQogICAqIFJlc29sdmUgcmVsYXRpdmUgdG8gdGhlIHBhcmVudC4NCiAgICovDQoNCiAgbG9jYWxSZXF1aXJlLnJlc29sdmUgPSBmdW5jdGlvbihwYXRoKSB7DQogICAgdmFyIGMgPSBwYXRoLmNoYXJBdCgwKTsNCiAgICBpZiAoJy8nID09IGMpIHJldHVybiBwYXRoLnNsaWNlKDEpOw0KICAgIGlmICgnLicgPT0gYykgcmV0dXJuIHJlcXVpcmUubm9ybWFsaXplKHAsIHBhdGgpOw0KDQogICAgLy8gcmVzb2x2ZSBkZXBzIGJ5IHJldHVybmluZw0KICAgIC8vIHRoZSBkZXAgaW4gdGhlIG5lYXJlc3QgImRlcHMiDQogICAgLy8gZGlyZWN0b3J5DQogICAgdmFyIHNlZ3MgPSBwYXJlbnQuc3BsaXQoJy8nKTsNCiAgICB2YXIgaSA9IGxhc3RJbmRleE9mKHNlZ3MsICdkZXBzJykgKyAxOw0KICAgIGlmICghaSkgaSA9IDA7DQogICAgcGF0aCA9IHNlZ3Muc2xpY2UoMCwgaSArIDEpLmpvaW4oJy8nKSArICcvZGVwcy8nICsgcGF0aDsNCiAgICByZXR1cm4gcGF0aDsNCiAgfTsNCg0KICAvKioNCiAgICogQ2hlY2sgaWYgbW9kdWxlIGlzIGRlZmluZWQgYXQgYHBhdGhgLg0KICAgKi8NCg0KICBsb2NhbFJlcXVpcmUuZXhpc3RzID0gZnVuY3Rpb24ocGF0aCkgew0KICAgIHJldHVybiByZXF1aXJlLm1vZHVsZXMuaGFzT3duUHJvcGVydHkobG9jYWxSZXF1aXJlLnJlc29sdmUocGF0aCkpOw0KICB9Ow0KDQogIHJldHVybiBsb2NhbFJlcXVpcmU7DQp9Ow0KcmVxdWlyZS5yZWdpc3RlcigiY29tcG9uZW50LWNsYXNzZXMvaW5kZXguanMiLCBmdW5jdGlvbihleHBvcnRzLCByZXF1aXJlLCBtb2R1bGUpew0KLyoqDQogKiBNb2R1bGUgZGVwZW5kZW5jaWVzLg0KICovDQoNCnZhciBpbmRleCA9IHJlcXVpcmUoJ2luZGV4b2YnKTsNCg0KLyoqDQogKiBXaGl0ZXNwYWNlIHJlZ2V4cC4NCiAqLw0KDQp2YXIgcmUgPSAvXHMrLzsNCg0KLyoqDQogKiB0b1N0cmluZyByZWZlcmVuY2UuDQogKi8NCg0KdmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsNCg0KLyoqDQogKiBXcmFwIGBlbGAgaW4gYSBgQ2xhc3NMaXN0YC4NCiAqDQogKiBAcGFyYW0ge0VsZW1lbnR9IGVsDQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZWwpew0KICByZXR1cm4gbmV3IENsYXNzTGlzdChlbCk7DQp9Ow0KDQovKioNCiAqIEluaXRpYWxpemUgYSBuZXcgQ2xhc3NMaXN0IGZvciBgZWxgLg0KICoNCiAqIEBwYXJhbSB7RWxlbWVudH0gZWwNCiAqIEBhcGkgcHJpdmF0ZQ0KICovDQoNCmZ1bmN0aW9uIENsYXNzTGlzdChlbCkgew0KICBpZiAoIWVsKSB0aHJvdyBuZXcgRXJyb3IoJ0EgRE9NIGVsZW1lbnQgcmVmZXJlbmNlIGlzIHJlcXVpcmVkJyk7DQogIHRoaXMuZWwgPSBlbDsNCiAgdGhpcy5saXN0ID0gZWwuY2xhc3NMaXN0Ow0KfQ0KDQovKioNCiAqIEFkZCBjbGFzcyBgbmFtZWAgaWYgbm90IGFscmVhZHkgcHJlc2VudC4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQ0KICogQHJldHVybiB7Q2xhc3NMaXN0fQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpDbGFzc0xpc3QucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uKG5hbWUpew0KICAvLyBjbGFzc0xpc3QNCiAgaWYgKHRoaXMubGlzdCkgew0KICAgIHRoaXMubGlzdC5hZGQobmFtZSk7DQogICAgcmV0dXJuIHRoaXM7DQogIH0NCg0KICAvLyBmYWxsYmFjaw0KICB2YXIgYXJyID0gdGhpcy5hcnJheSgpOw0KICB2YXIgaSA9IGluZGV4KGFyciwgbmFtZSk7DQogIGlmICghfmkpIGFyci5wdXNoKG5hbWUpOw0KICB0aGlzLmVsLmNsYXNzTmFtZSA9IGFyci5qb2luKCcgJyk7DQogIHJldHVybiB0aGlzOw0KfTsNCg0KLyoqDQogKiBSZW1vdmUgY2xhc3MgYG5hbWVgIHdoZW4gcHJlc2VudCwgb3INCiAqIHBhc3MgYSByZWd1bGFyIGV4cHJlc3Npb24gdG8gcmVtb3ZlDQogKiBhbnkgd2hpY2ggbWF0Y2guDQogKg0KICogQHBhcmFtIHtTdHJpbmd8UmVnRXhwfSBuYW1lDQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCkNsYXNzTGlzdC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24obmFtZSl7DQogIGlmICgnW29iamVjdCBSZWdFeHBdJyA9PSB0b1N0cmluZy5jYWxsKG5hbWUpKSB7DQogICAgcmV0dXJuIHRoaXMucmVtb3ZlTWF0Y2hpbmcobmFtZSk7DQogIH0NCg0KICAvLyBjbGFzc0xpc3QNCiAgaWYgKHRoaXMubGlzdCkgew0KICAgIHRoaXMubGlzdC5yZW1vdmUobmFtZSk7DQogICAgcmV0dXJuIHRoaXM7DQogIH0NCg0KICAvLyBmYWxsYmFjaw0KICB2YXIgYXJyID0gdGhpcy5hcnJheSgpOw0KICB2YXIgaSA9IGluZGV4KGFyciwgbmFtZSk7DQogIGlmICh+aSkgYXJyLnNwbGljZShpLCAxKTsNCiAgdGhpcy5lbC5jbGFzc05hbWUgPSBhcnIuam9pbignICcpOw0KICByZXR1cm4gdGhpczsNCn07DQoNCi8qKg0KICogUmVtb3ZlIGFsbCBjbGFzc2VzIG1hdGNoaW5nIGByZWAuDQogKg0KICogQHBhcmFtIHtSZWdFeHB9IHJlDQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9DQogKiBAYXBpIHByaXZhdGUNCiAqLw0KDQpDbGFzc0xpc3QucHJvdG90eXBlLnJlbW92ZU1hdGNoaW5nID0gZnVuY3Rpb24ocmUpew0KICB2YXIgYXJyID0gdGhpcy5hcnJheSgpOw0KICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykgew0KICAgIGlmIChyZS50ZXN0KGFycltpXSkpIHsNCiAgICAgIHRoaXMucmVtb3ZlKGFycltpXSk7DQogICAgfQ0KICB9DQogIHJldHVybiB0aGlzOw0KfTsNCg0KLyoqDQogKiBUb2dnbGUgY2xhc3MgYG5hbWVgLCBjYW4gZm9yY2Ugc3RhdGUgdmlhIGBmb3JjZWAuDQogKg0KICogRm9yIGJyb3dzZXJzIHRoYXQgc3VwcG9ydCBjbGFzc0xpc3QsIGJ1dCBkbyBub3Qgc3VwcG9ydCBgZm9yY2VgIHlldCwNCiAqIHRoZSBtaXN0YWtlIHdpbGwgYmUgZGV0ZWN0ZWQgYW5kIGNvcnJlY3RlZC4NCiAqDQogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQ0KICogQHBhcmFtIHtCb29sZWFufSBmb3JjZQ0KICogQHJldHVybiB7Q2xhc3NMaXN0fQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpDbGFzc0xpc3QucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKG5hbWUsIGZvcmNlKXsNCiAgLy8gY2xhc3NMaXN0DQogIGlmICh0aGlzLmxpc3QpIHsNCiAgICBpZiAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBmb3JjZSkgew0KICAgICAgaWYgKGZvcmNlICE9PSB0aGlzLmxpc3QudG9nZ2xlKG5hbWUsIGZvcmNlKSkgew0KICAgICAgICB0aGlzLmxpc3QudG9nZ2xlKG5hbWUpOyAvLyB0b2dnbGUgYWdhaW4gdG8gY29ycmVjdA0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICB0aGlzLmxpc3QudG9nZ2xlKG5hbWUpOw0KICAgIH0NCiAgICByZXR1cm4gdGhpczsNCiAgfQ0KDQogIC8vIGZhbGxiYWNrDQogIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGZvcmNlKSB7DQogICAgaWYgKCFmb3JjZSkgew0KICAgICAgdGhpcy5yZW1vdmUobmFtZSk7DQogICAgfSBlbHNlIHsNCiAgICAgIHRoaXMuYWRkKG5hbWUpOw0KICAgIH0NCiAgfSBlbHNlIHsNCiAgICBpZiAodGhpcy5oYXMobmFtZSkpIHsNCiAgICAgIHRoaXMucmVtb3ZlKG5hbWUpOw0KICAgIH0gZWxzZSB7DQogICAgICB0aGlzLmFkZChuYW1lKTsNCiAgICB9DQogIH0NCg0KICByZXR1cm4gdGhpczsNCn07DQoNCi8qKg0KICogUmV0dXJuIGFuIGFycmF5IG9mIGNsYXNzZXMuDQogKg0KICogQHJldHVybiB7QXJyYXl9DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCkNsYXNzTGlzdC5wcm90b3R5cGUuYXJyYXkgPSBmdW5jdGlvbigpew0KICB2YXIgc3RyID0gdGhpcy5lbC5jbGFzc05hbWUucmVwbGFjZSgvXlxzK3xccyskL2csICcnKTsNCiAgdmFyIGFyciA9IHN0ci5zcGxpdChyZSk7DQogIGlmICgnJyA9PT0gYXJyWzBdKSBhcnIuc2hpZnQoKTsNCiAgcmV0dXJuIGFycjsNCn07DQoNCi8qKg0KICogQ2hlY2sgaWYgY2xhc3MgYG5hbWVgIGlzIHByZXNlbnQuDQogKg0KICogQHBhcmFtIHtTdHJpbmd9IG5hbWUNCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0NCiAqIEBhcGkgcHVibGljDQogKi8NCg0KQ2xhc3NMaXN0LnByb3RvdHlwZS5oYXMgPQ0KQ2xhc3NMaXN0LnByb3RvdHlwZS5jb250YWlucyA9IGZ1bmN0aW9uKG5hbWUpew0KICByZXR1cm4gdGhpcy5saXN0DQogICAgPyB0aGlzLmxpc3QuY29udGFpbnMobmFtZSkNCiAgICA6ICEhIH5pbmRleCh0aGlzLmFycmF5KCksIG5hbWUpOw0KfTsNCg0KfSk7DQpyZXF1aXJlLnJlZ2lzdGVyKCJjb21wb25lbnQtZXZlbnQvaW5kZXguanMiLCBmdW5jdGlvbihleHBvcnRzLCByZXF1aXJlLCBtb2R1bGUpew0KdmFyIGJpbmQgPSB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciA/ICdhZGRFdmVudExpc3RlbmVyJyA6ICdhdHRhY2hFdmVudCcsDQogICAgdW5iaW5kID0gd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIgPyAncmVtb3ZlRXZlbnRMaXN0ZW5lcicgOiAnZGV0YWNoRXZlbnQnLA0KICAgIHByZWZpeCA9IGJpbmQgIT09ICdhZGRFdmVudExpc3RlbmVyJyA/ICdvbicgOiAnJzsNCg0KLyoqDQogKiBCaW5kIGBlbGAgZXZlbnQgYHR5cGVgIHRvIGBmbmAuDQogKg0KICogQHBhcmFtIHtFbGVtZW50fSBlbA0KICogQHBhcmFtIHtTdHJpbmd9IHR5cGUNCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuDQogKiBAcGFyYW0ge0Jvb2xlYW59IGNhcHR1cmUNCiAqIEByZXR1cm4ge0Z1bmN0aW9ufQ0KICogQGFwaSBwdWJsaWMNCiAqLw0KDQpleHBvcnRzLmJpbmQgPSBmdW5jdGlvbihlbCwgdHlwZSwgZm4sIGNhcHR1cmUpew0KICBlbFtiaW5kXShwcmVmaXggKyB0eXBlLCBmbiwgY2FwdHVyZSB8fCBmYWxzZSk7DQogIHJldHVybiBmbjsNCn07DQoNCi8qKg0KICogVW5iaW5kIGBlbGAgZXZlbnQgYHR5cGVgJ3MgY2FsbGJhY2sgYGZuYC4NCiAqDQogKiBAcGFyYW0ge0VsZW1lbnR9IGVsDQogKiBAcGFyYW0ge1N0cmluZ30gdHlwZQ0KICogQHBhcmFtIHtGdW5jdGlvbn0gZm4NCiAqIEBwYXJhbSB7Qm9vbGVhbn0gY2FwdHVyZQ0KICogQHJldHVybiB7RnVuY3Rpb259DQogKiBAYXBpIHB1YmxpYw0KICovDQoNCmV4cG9ydHMudW5iaW5kID0gZnVuY3Rpb24oZWwsIHR5cGUsIGZuLCBjYXB0dXJlKXsNCiAgZWxbdW5iaW5kXShwcmVmaXggKyB0eXBlLCBmbiwgY2FwdHVyZSB8fCBmYWxzZSk7DQogIHJldHVybiBmbjsNCn07DQp9KTsNCnJlcXVpcmUucmVnaXN0ZXIoImNvbXBvbmVudC1pbmRleG9mL2luZGV4LmpzIiwgZnVuY3Rpb24oZXhwb3J0cywgcmVxdWlyZSwgbW9kdWxlKXsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYXJyLCBvYmopew0KICBpZiAoYXJyLmluZGV4T2YpIHJldHVybiBhcnIuaW5kZXhPZihvYmopOw0KICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7ICsraSkgew0KICAgIGlmIChhcnJbaV0gPT09IG9iaikgcmV0dXJuIGk7DQogIH0NCiAgcmV0dXJuIC0xOw0KfTsNCn0pOw0KcmVxdWlyZS5yZWdpc3RlcigibGlzdC5wYWdpbmF0aW9uLmpzL2luZGV4LmpzIiwgZnVuY3Rpb24oZXhwb3J0cywgcmVxdWlyZSwgbW9kdWxlKXsNCnZhciBjbGFzc2VzID0gcmVxdWlyZSgnY2xhc3NlcycpLA0KICAgIGV2ZW50cyA9IHJlcXVpcmUoJ2V2ZW50Jyk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob3B0aW9ucykgew0KICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9Ow0KDQogICAgdmFyIHBhZ2luZ0xpc3QsDQogICAgICAgIGxpc3Q7DQoNCiAgICB2YXIgcmVmcmVzaCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgaXRlbSwNCiAgICAgICAgICAgIGwgPSBsaXN0Lm1hdGNoaW5nSXRlbXMubGVuZ3RoLA0KICAgICAgICAgICAgaW5kZXggPSBsaXN0LmksDQogICAgICAgICAgICBwYWdlID0gbGlzdC5wYWdlLA0KICAgICAgICAgICAgcGFnZXMgPSBNYXRoLmNlaWwobCAvIHBhZ2UpLA0KICAgICAgICAgICAgY3VycmVudFBhZ2UgPSBNYXRoLmNlaWwoKGluZGV4IC8gcGFnZSkpLA0KICAgICAgICAgICAgaW5uZXJXaW5kb3cgPSBvcHRpb25zLmlubmVyV2luZG93IHx8IDIsDQogICAgICAgICAgICBsZWZ0ID0gb3B0aW9ucy5sZWZ0IHx8IG9wdGlvbnMub3V0ZXJXaW5kb3cgfHwgMCwNCiAgICAgICAgICAgIHJpZ2h0ID0gb3B0aW9ucy5yaWdodCB8fCBvcHRpb25zLm91dGVyV2luZG93IHx8IDA7DQoNCiAgICAgICAgcmlnaHQgPSBwYWdlcyAtIHJpZ2h0Ow0KDQogICAgICAgIHBhZ2luZ0xpc3QuY2xlYXIoKTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gcGFnZXM7IGkrKykgew0KICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IChjdXJyZW50UGFnZSA9PT0gaSkgPyAiYWN0aXZlIiA6ICIiOw0KDQogICAgICAgICAgICAvL2NvbnNvbGUubG9nKGksIGxlZnQsIHJpZ2h0LCBjdXJyZW50UGFnZSwgKGN1cnJlbnRQYWdlIC0gaW5uZXJXaW5kb3cpLCAoY3VycmVudFBhZ2UgKyBpbm5lcldpbmRvdyksIGNsYXNzTmFtZSk7DQoNCiAgICAgICAgICAgIGlmIChpcy5udW1iZXIoaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdykpIHsNCiAgICAgICAgICAgICAgICBpdGVtID0gcGFnaW5nTGlzdC5hZGQoew0KICAgICAgICAgICAgICAgICAgICBwYWdlOiBpLA0KICAgICAgICAgICAgICAgICAgICBkb3R0ZWQ6IGZhbHNlDQogICAgICAgICAgICAgICAgfSlbMF07DQogICAgICAgICAgICAgICAgaWYgKGNsYXNzTmFtZSkgew0KICAgICAgICAgICAgICAgICAgICBjbGFzc2VzKGl0ZW0uZWxtKS5hZGQoY2xhc3NOYW1lKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYWRkRXZlbnQoaXRlbS5lbG0sIGksIHBhZ2UpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChpcy5kb3R0ZWQoaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdywgcGFnaW5nTGlzdC5zaXplKCkpKSB7DQogICAgICAgICAgICAgICAgaXRlbSA9IHBhZ2luZ0xpc3QuYWRkKHsNCiAgICAgICAgICAgICAgICAgICAgcGFnZTogIi4uLiIsDQogICAgICAgICAgICAgICAgICAgIGRvdHRlZDogdHJ1ZQ0KICAgICAgICAgICAgICAgIH0pWzBdOw0KICAgICAgICAgICAgICAgIGNsYXNzZXMoaXRlbS5lbG0pLmFkZCgiZGlzYWJsZWQiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICB2YXIgaXMgPSB7DQogICAgICAgIG51bWJlcjogZnVuY3Rpb24oaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdykgew0KICAgICAgICAgICByZXR1cm4gdGhpcy5sZWZ0KGksIGxlZnQpIHx8IHRoaXMucmlnaHQoaSwgcmlnaHQpIHx8IHRoaXMuaW5uZXJXaW5kb3coaSwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93KTsNCiAgICAgICAgfSwNCiAgICAgICAgbGVmdDogZnVuY3Rpb24oaSwgbGVmdCkgew0KICAgICAgICAgICAgcmV0dXJuIChpIDw9IGxlZnQpOw0KICAgICAgICB9LA0KICAgICAgICByaWdodDogZnVuY3Rpb24oaSwgcmlnaHQpIHsNCiAgICAgICAgICAgIHJldHVybiAoaSA+IHJpZ2h0KTsNCiAgICAgICAgfSwNCiAgICAgICAgaW5uZXJXaW5kb3c6IGZ1bmN0aW9uKGksIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdykgew0KICAgICAgICAgICAgcmV0dXJuICggaSA+PSAoY3VycmVudFBhZ2UgLSBpbm5lcldpbmRvdykgJiYgaSA8PSAoY3VycmVudFBhZ2UgKyBpbm5lcldpbmRvdykpOw0KICAgICAgICB9LA0KICAgICAgICBkb3R0ZWQ6IGZ1bmN0aW9uKGksIGxlZnQsIHJpZ2h0LCBjdXJyZW50UGFnZSwgaW5uZXJXaW5kb3csIGN1cnJlbnRQYWdlSXRlbSkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZG90dGVkTGVmdChpLCBsZWZ0LCByaWdodCwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93KSB8fCAodGhpcy5kb3R0ZWRSaWdodChpLCBsZWZ0LCByaWdodCwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93LCBjdXJyZW50UGFnZUl0ZW0pKTsNCiAgICAgICAgfSwNCiAgICAgICAgZG90dGVkTGVmdDogZnVuY3Rpb24oaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdykgew0KICAgICAgICAgICAgcmV0dXJuICgoaSA9PSAobGVmdCArIDEpKSAmJiAhdGhpcy5pbm5lcldpbmRvdyhpLCBjdXJyZW50UGFnZSwgaW5uZXJXaW5kb3cpICYmICF0aGlzLnJpZ2h0KGksIHJpZ2h0KSk7DQogICAgICAgIH0sDQogICAgICAgIGRvdHRlZFJpZ2h0OiBmdW5jdGlvbihpLCBsZWZ0LCByaWdodCwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93LCBjdXJyZW50UGFnZUl0ZW0pIHsNCiAgICAgICAgICAgIGlmIChwYWdpbmdMaXN0Lml0ZW1zW2N1cnJlbnRQYWdlSXRlbS0xXS52YWx1ZXMoKS5kb3R0ZWQpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiAoKGkgPT0gKHJpZ2h0KSkgJiYgIXRoaXMuaW5uZXJXaW5kb3coaSwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93KSAmJiAhdGhpcy5yaWdodChpLCByaWdodCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIHZhciBhZGRFdmVudCA9IGZ1bmN0aW9uKGVsbSwgaSwgcGFnZSkgew0KICAgICAgIGV2ZW50cy5iaW5kKGVsbSwgJ2NsaWNrJywgZnVuY3Rpb24oKSB7DQogICAgICAgICAgIGxpc3Quc2hvdygoaS0xKSpwYWdlICsgMSwgcGFnZSk7DQogICAgICAgfSk7DQogICAgfTsNCg0KICAgIHJldHVybiB7DQogICAgICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmVudExpc3QpIHsNCiAgICAgICAgICAgIGxpc3QgPSBwYXJlbnRMaXN0Ow0KICAgICAgICAgICAgcGFnaW5nTGlzdCA9IG5ldyBMaXN0KGxpc3QubGlzdENvbnRhaW5lci5pZCwgew0KICAgICAgICAgICAgICAgIGxpc3RDbGFzczogb3B0aW9ucy5wYWdpbmF0aW9uQ2xhc3MgfHwgJ3BhZ2luYXRpb24nLA0KICAgICAgICAgICAgICAgIGl0ZW06ICI8bGk+PGEgY2xhc3M9J3BhZ2UnIGhyZWY9J2phdmFzY3JpcHQ6ZnVuY3Rpb24gWigpe1o9XCJcIn1aKCknPjwvYT48L2xpPiIsDQogICAgICAgICAgICAgICAgdmFsdWVOYW1lczogWydwYWdlJywgJ2RvdHRlZCddLA0KICAgICAgICAgICAgICAgIHNlYXJjaENsYXNzOiAncGFnaW5hdGlvbi1zZWFyY2gtdGhhdC1pcy1ub3Qtc3VwcG9zZWQtdG8tZXhpc3QnLA0KICAgICAgICAgICAgICAgIHNvcnRDbGFzczogJ3BhZ2luYXRpb24tc29ydC10aGF0LWlzLW5vdC1zdXBwb3NlZC10by1leGlzdCcNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgbGlzdC5vbigndXBkYXRlZCcsIHJlZnJlc2gpOw0KICAgICAgICAgICAgcmVmcmVzaCgpOw0KICAgICAgICB9LA0KICAgICAgICBuYW1lOiBvcHRpb25zLm5hbWUgfHwgInBhZ2luYXRpb24iDQogICAgfTsNCn07DQoNCn0pOw0KDQoNCg0KDQoNCg0KcmVxdWlyZS5hbGlhcygiY29tcG9uZW50LWNsYXNzZXMvaW5kZXguanMiLCAibGlzdC5wYWdpbmF0aW9uLmpzL2RlcHMvY2xhc3Nlcy9pbmRleC5qcyIpOw0KcmVxdWlyZS5hbGlhcygiY29tcG9uZW50LWNsYXNzZXMvaW5kZXguanMiLCAiY2xhc3Nlcy9pbmRleC5qcyIpOw0KcmVxdWlyZS5hbGlhcygiY29tcG9uZW50LWluZGV4b2YvaW5kZXguanMiLCAiY29tcG9uZW50LWNsYXNzZXMvZGVwcy9pbmRleG9mL2luZGV4LmpzIik7DQoNCnJlcXVpcmUuYWxpYXMoImNvbXBvbmVudC1ldmVudC9pbmRleC5qcyIsICJsaXN0LnBhZ2luYXRpb24uanMvZGVwcy9ldmVudC9pbmRleC5qcyIpOw0KcmVxdWlyZS5hbGlhcygiY29tcG9uZW50LWV2ZW50L2luZGV4LmpzIiwgImV2ZW50L2luZGV4LmpzIik7DQoNCnJlcXVpcmUuYWxpYXMoImNvbXBvbmVudC1pbmRleG9mL2luZGV4LmpzIiwgImxpc3QucGFnaW5hdGlvbi5qcy9kZXBzL2luZGV4b2YvaW5kZXguanMiKTsNCnJlcXVpcmUuYWxpYXMoImNvbXBvbmVudC1pbmRleG9mL2luZGV4LmpzIiwgImluZGV4b2YvaW5kZXguanMiKTsNCg0KcmVxdWlyZS5hbGlhcygibGlzdC5wYWdpbmF0aW9uLmpzL2luZGV4LmpzIiwgImxpc3QucGFnaW5hdGlvbi5qcy9pbmRleC5qcyIpO2lmICh0eXBlb2YgZXhwb3J0cyA9PSAib2JqZWN0Iikgew0KICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImxpc3QucGFnaW5hdGlvbi5qcyIpOw0KfSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCkgew0KICBkZWZpbmUoZnVuY3Rpb24oKXsgcmV0dXJuIHJlcXVpcmUoImxpc3QucGFnaW5hdGlvbi5qcyIpOyB9KTsNCn0gZWxzZSB7DQogIHRoaXNbIkxpc3RQYWdpbmF0aW9uIl0gPSByZXF1aXJlKCJsaXN0LnBhZ2luYXRpb24uanMiKTsNCn19KSgpOw0KICA8L3NjcmlwdD4NCiAgPCEtLWh0dHA6Ly93d3cubWVudWNvb2wuY29tL3RhYmJlZC1jb250ZW50LS0+DQogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy90YWJjb250ZW50LmNzcyIgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgLz4tLT4NCiAgPHN0eWxlPg0KICAgIC8qIFRhYiBDb250ZW50IC0gbWVudWNvb2wuY29tICovDQogICAgdWwudGFicyB7DQogICAgICBwYWRkaW5nOiAxNHB4IDAgOHB4Ow0KICAgICAgbWFyZ2luOiAwOw0KICAgICAgZm9udC1zaXplOiAwOw0KICAgICAgbGlzdC1zdHlsZS10eXBlOiBub25lOw0KICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgIC8qc2V0IHRvIGxlZnQsIGNlbnRlciwgb3IgcmlnaHQgdG8gYWxpZ24gdGhlIHRhYnMgYXMgZGVzaXJlZCovDQogICAgICBiYWNrZ3JvdW5kOiAjREREREUzOw0KICAgICAgYm9yZGVyOiAxcHggc29saWQgI0NDQzsNCiAgICAgIGJvcmRlci1ib3R0b206IG5vbmU7DQogICAgICBib3JkZXItcmFkaXVzOiAycHggMnB4IDAgMDsNCiAgICAgIHBhZGRpbmctbGVmdDogMTBweDsNCiAgICAgIC8qIE9mZnNldCBvZiB0aGUgZmlyc3QgdGFiICovDQogICAgfQ0KDQogICAgdWwudGFicyBsaSB7DQogICAgICBkaXNwbGF5OiBpbmxpbmU7DQogICAgICBtYXJnaW46IDA7DQogICAgICBtYXJnaW4tcmlnaHQ6IDJweDsNCiAgICAgIC8qZGlzdGFuY2UgYmV0d2VlbiB0YWJzKi8NCiAgICAgIGZvbnQ6IG5vcm1hbCAxMnB4IFZlcmRhbmE7DQogICAgfQ0KDQogICAgdWwudGFicyBsaSBhIHsNCiAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsNCiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgIHBhZGRpbmc6IDhweCAyMnB4Ow0KICAgICAgY29sb3I6ICMwMDA7DQogICAgICBib3JkZXItcmFkaXVzOiAzcHggM3B4IDAgMDsNCiAgICAgIG91dGxpbmU6IG5vbmU7DQogICAgfQ0KDQogICAgdWwudGFicyBsaSBhOmhvdmVyIHsNCiAgICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOw0KICAgICAgY29sb3I6ICMwMDA7DQogICAgfQ0KDQogICAgdWwudGFicyBsaS5zZWxlY3RlZCBhIHsNCiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgIHRvcDogMHB4Ow0KICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICBiYWNrZ3JvdW5kOiAjRkZGOw0KICAgICAgYm9yZGVyOiAxcHggc29saWQgI0FBQTsNCiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjRkZGOw0KICAgICAgY29sb3I6ICMwMDA7DQogICAgfQ0KDQogICAgdWwudGFicyBsaS5zZWxlY3RlZCBhOmhvdmVyLA0KICAgIHVsLnRhYnMgbGkuc2VsZWN0ZWQgYTpob3ZlciB7DQogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgfQ0KDQogICAgZGl2LnRhYmNvbnRlbnRzIHsNCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNDQ0M7DQogICAgICBwYWRkaW5nOiAxNXB4Ow0KICAgICAgYm9yZGVyLXRvcC1jb2xvcjogI0FBQTsNCiAgICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkY7DQogICAgICBib3JkZXItcmFkaXVzOiAwIDAgMnB4IDJweDsNCiAgICB9DQogIDwvc3R5bGU+DQogIDwhLS08c2NyaXB0IHNyYz0iamF2YXNjcmlwdHMvdGFiY29udGVudC5qcyIgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij48L3NjcmlwdD4tLT4NCiAgPHNjcmlwdD4NCiAgICAvKiBodHRwOi8vd3d3Lm1lbnVjb29sLmNvbS90YWJiZWQtY29udGVudCBGcmVlIHRvIHVzZS4gdjIwMTMuNy42ICovDQogICAgKGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciBwcmV2ZW50RGVmYXVsdCA9IGZ1bmN0aW9uIChldnQpIHsNCiAgICAgICAgaWYgKGV2dCAmJiBldnQuc3RvcFByb3BhZ2F0aW9uKSB7DQogICAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICB9DQogICAgICAgIGlmIChldnQgJiYgZXZ0LnByZXZlbnREZWZhdWx0KSB7DQogICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICAgIGFkZEV2ZW50ID0gZnVuY3Rpb24gKGVsZW0sIGV2ZW50TmFtZSwgZm4pIHsNCiAgICAgICAgICBpZiAoZWxlbS5hZGRFdmVudExpc3RlbmVyKSB7DQogICAgICAgICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmbiwgZmFsc2UpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBlbGVtLmF0dGFjaEV2ZW50KCJvbiIgKyBldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgLy8gc2V0IHRoZSB0aGlzIHBvaW50ZXIgc2FtZSBhcyBhZGRFdmVudExpc3RlbmVyIHdoZW4gZm4gaXMgY2FsbGVkDQogICAgICAgICAgICAgIHJldHVybiAoZm4uY2FsbChlbGVtLCB3aW5kb3cuZXZlbnQpKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgaGFzQ2xhc3MgPSBmdW5jdGlvbiAoZWxlbSwgY2xhc3NOYW1lKSB7DQogICAgICAgICAgdmFyIGNsYXNzUGF0dGVybiA9IG5ldyBSZWdFeHAoIihefCApIiArIGNsYXNzTmFtZSArICIoIHwkKSIpOw0KICAgICAgICAgIHJldHVybiBjbGFzc1BhdHRlcm4udGVzdChlbGVtLmNsYXNzTmFtZSkgPyB0cnVlIDogZmFsc2U7DQogICAgICAgIH0sDQogICAgICAgIGFkZENsYXNzID0gZnVuY3Rpb24gKGVsZW0sIGNsYXNzTmFtZSwgZmlyc3QpIHsNCiAgICAgICAgICBpZiAoIWhhc0NsYXNzKGVsZW0sIGNsYXNzTmFtZSkpIHsNCiAgICAgICAgICAgIGlmIChlbGVtLmNsYXNzTmFtZSA9PSAiIikgew0KICAgICAgICAgICAgICBlbGVtLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlyc3QpIHsNCiAgICAgICAgICAgICAgZWxlbS5jbGFzc05hbWUgPSBjbGFzc05hbWUgKyAiICIgKyBlbGVtLmNsYXNzTmFtZTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGVsZW0uY2xhc3NOYW1lICs9ICIgIiArIGNsYXNzTmFtZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHJlbW92ZUNsYXNzID0gZnVuY3Rpb24gKGVsZW0sIGNsYXNzTmFtZSkgew0KICAgICAgICAgIHZhciBjbGFzc1BhdHRlcm4gPSBuZXcgUmVnRXhwKCIoXnwgKSIgKyBjbGFzc05hbWUgKyAiKCB8JCkiKTsNCiAgICAgICAgICBlbGVtLmNsYXNzTmFtZSA9IGVsZW0uY2xhc3NOYW1lLnJlcGxhY2UoY2xhc3NQYXR0ZXJuLCAiJDEiKTsNCiAgICAgICAgICBlbGVtLmNsYXNzTmFtZSA9IGVsZW0uY2xhc3NOYW1lLnJlcGxhY2UoLyAkLywgIiIpDQogICAgICAgIH0sDQogICAgICAgIHBhZ2VOYW1lID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHZhciBwYXRoID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lOw0KICAgICAgICAgIHZhciBsYXN0UGFydCA9ICcnOw0KICAgICAgICAgIGlmIChwYXRoLmluZGV4T2YoIi8iKSAhPSAtMSkgew0KICAgICAgICAgICAgcGF0aFBhcnRzID0gcGF0aC5zcGxpdCgiLyIpLmZpbHRlcihwYXJ0ID0+IHBhcnQubGVuZ3RoID4gMCk7DQogICAgICAgICAgICBsYXN0UGFydCA9IHBhdGhQYXJ0c1twYXRoUGFydHMubGVuZ3RoIC0gMV0gfHwgInJvb3QiOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBsYXN0UGFydCA9IHBhdGggfHwgInJvb3QiOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAobGFzdFBhcnQuaW5kZXhPZigiLiIpICE9IC0xKSB7DQogICAgICAgICAgICBsYXN0UGFydCA9IGxhc3RQYXJ0LnN1YnN0cmluZygwLCBsYXN0UGFydC5pbmRleE9mKCIuIikpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAobGFzdFBhcnQubGVuZ3RoID4gMjApIHsNCiAgICAgICAgICAgIGxhc3RQYXJ0ID0gbGFzdFBhcnQuc3Vic3RyaW5nKGxhc3RQYXJ0Lmxlbmd0aCAtIDE5KTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmV0dXJuIGxhc3RQYXJ0Ow0KICAgICAgICB9LA0KICAgICAgICBjb29raWVOYW1lID0gIm1pIiArIHBhZ2VOYW1lKCksDQogICAgICAgIFRhYkdyb3VwID0gZnVuY3Rpb24gKGVsZW0sIGluZGV4KSB7DQogICAgICAgICAgdGhpcy5pbml0KGVsZW0sIGluZGV4KQ0KICAgICAgICB9Ow0KICAgICAgVGFiR3JvdXAucHJvdG90eXBlID0gew0KICAgICAgICBsb2FkU2VsZWN0ZWRUYWI6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICB2YXIgY29va2llUGF0dGVybiA9IG5ldyBSZWdFeHAoY29va2llTmFtZSArIHRoaXMuaW5kZXggKyAiPShcXGQrKSIpLA0KICAgICAgICAgICAgY29va2llTWF0Y2ggPSBkb2N1bWVudC5jb29raWUubWF0Y2goY29va2llUGF0dGVybik7DQogICAgICAgICAgcmV0dXJuIGNvb2tpZU1hdGNoID8gY29va2llTWF0Y2hbMV0gOiB0aGlzLmdldFNlbGVjdGVkSW5kZXgoKQ0KICAgICAgICB9LA0KICAgICAgICBnZXRTZWxlY3RlZEluZGV4OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgdmFyIGMgPSB0aGlzLnRhYnMubGVuZ3RoOw0KICAgICAgICAgIGZvciAodmFyIGIgPSAwOyBiIDwgYzsgYisrKSB7DQogICAgICAgICAgICBpZiAoaGFzQ2xhc3ModGhpcy50YWJzW2JdLnBhcmVudE5vZGUsICJzZWxlY3RlZCIpKSB7DQogICAgICAgICAgICAgIHJldHVybiBiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfSwNCiAgICAgICAgc2VsZWN0VGFiOiBmdW5jdGlvbiAodGFiTGluaywgdXBkYXRlQ29va2llKSB7DQogICAgICAgICAgdmFyIHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYkxpbmsudGFyZ2V0SWQpOw0KICAgICAgICAgIGlmICghdGFyZ2V0KSByZXR1cm47DQogICAgICAgICAgdGhpcy5zaG93VGFiKHRhcmdldCk7DQogICAgICAgICAgZm9yICh2YXIgYSA9IDA7IGEgPCB0aGlzLnRhYnMubGVuZ3RoOyBhKyspDQogICAgICAgICAgICBpZiAodGhpcy50YWJzW2FdID09IHRhYkxpbmspIHsNCiAgICAgICAgICAgICAgYWRkQ2xhc3ModGFiTGluay5wYXJlbnROb2RlLCAic2VsZWN0ZWQiKTsNCiAgICAgICAgICAgICAgaWYgKHVwZGF0ZUNvb2tpZSAmJiB0aGlzLmRhdGFQZXJzaXN0KSB7DQogICAgICAgICAgICAgICAgdGhpcy5zdG9yZVNlbGVjdGVkVGFiKHRoaXMuaW5kZXgsIGEpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICByZW1vdmVDbGFzcyh0aGlzLnRhYnNbYV0ucGFyZW50Tm9kZSwgInNlbGVjdGVkIik7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHN0b3JlU2VsZWN0ZWRUYWI6IGZ1bmN0aW9uICh0YWJHcm91cEluZGV4LCB0YWJJbmRleCkgew0KICAgICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZU5hbWUgKyB0YWJHcm91cEluZGV4ICsgIj0iICsgdGFiSW5kZXggKyAiOyBwYXRoPS8iDQogICAgICAgIH0sDQogICAgICAgIHNob3dUYWI6IGZ1bmN0aW9uICh0YXJnZXQpIHsNCiAgICAgICAgICBmb3IgKHZhciBhID0gMDsgYSA8IHRoaXMudGFyZ2V0cy5sZW5ndGg7IGErKykgew0KICAgICAgICAgICAgdGhpcy50YXJnZXRzW2FdLnN0eWxlLmRpc3BsYXkgPSB0aGlzLnRhcmdldHNbYV0uaWQgPT0gdGFyZ2V0LmlkID8gImJsb2NrIiA6ICJub25lIjsNCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGluaXRUYWJzOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgdGhpcy50YXJnZXRzID0gW107DQogICAgICAgICAgdmFyIHRhYkdyb3VwID0gdGhpczsNCiAgICAgICAgICBmb3IgKHZhciBhID0gMDsgYSA8IHRoaXMudGFicy5sZW5ndGg7IGErKykgew0KICAgICAgICAgICAgdmFyIHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudGFic1thXS50YXJnZXRJZCk7DQogICAgICAgICAgICBpZiAodGFyZ2V0KSB7DQogICAgICAgICAgICAgIHRoaXMudGFyZ2V0cy5wdXNoKHRhcmdldCk7DQogICAgICAgICAgICAgIGFkZEV2ZW50KHRoaXMudGFic1thXSwgImNsaWNrIiwgZnVuY3Rpb24gKGV2dCkgew0KICAgICAgICAgICAgICAgIHZhciB0YWJMaW5rID0gdGhpczsNCiAgICAgICAgICAgICAgICBpZiAodGFiTGluayA9PT0gd2luZG93KSB7DQogICAgICAgICAgICAgICAgICB0YWJMaW5rID0gd2luZG93LmV2ZW50LnNyY0VsZW1lbnQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRhYkdyb3VwLnNlbGVjdFRhYih0YWJMaW5rLCAxKTsNCiAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdChldnQpOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChlbGVtLCBpbmRleCkgew0KICAgICAgICAgIHRoaXMuaW5kZXggPSBpbmRleDsNCiAgICAgICAgICB0aGlzLnRhYnMgPSBbXTsNCiAgICAgICAgICB2YXIgbGlua3MgPSBlbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJhIiksDQogICAgICAgICAgICBhbmNob3JQYXR0ZXJuID0gLyMoW14/XSspLzsNCiAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgbGlua3MubGVuZ3RoOyBjKyspIHsNCiAgICAgICAgICAgIHZhciB0YWJMaW5rID0gbGlua3NbY107DQogICAgICAgICAgICB2YXIgaHJlZiA9IHRhYkxpbmsuZ2V0QXR0cmlidXRlKCJocmVmIik7DQogICAgICAgICAgICBpZiAoaHJlZi5pbmRleE9mKCIjIikgPT0gLTEpIHsNCiAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICB2YXIgYW5jaG9yTWF0Y2ggPSBocmVmLm1hdGNoKGFuY2hvclBhdHRlcm4pOw0KICAgICAgICAgICAgICBpZiAoYW5jaG9yTWF0Y2gpIHsNCiAgICAgICAgICAgICAgICBocmVmID0gYW5jaG9yTWF0Y2hbMV07DQogICAgICAgICAgICAgICAgdGFiTGluay50YXJnZXRJZCA9IGhyZWY7DQogICAgICAgICAgICAgICAgdGhpcy50YWJzLnB1c2godGFiTGluayk7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIGRhdGFQZXJzaXN0ID0gZWxlbS5nZXRBdHRyaWJ1dGUoImRhdGEtcGVyc2lzdCIpIHx8ICIiOw0KICAgICAgICAgIHRoaXMuZGF0YVBlcnNpc3QgPSBkYXRhUGVyc2lzdC50b0xvd2VyQ2FzZSgpID09ICJ0cnVlIiA/IDEgOiAwOw0KICAgICAgICAgIHRoaXMuaW5pdFRhYnMoKTsNCiAgICAgICAgICB0aGlzLmluaXRTZWxlY3RlZFRhYigpDQogICAgICAgIH0sDQogICAgICAgIGluaXRTZWxlY3RlZFRhYjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHZhciBzZWxlY3RlZFRhYkluZGV4ID0gdGhpcy5kYXRhUGVyc2lzdCA/IHBhcnNlSW50KHRoaXMubG9hZFNlbGVjdGVkVGFiKCkpIDogdGhpcy5nZXRTZWxlY3RlZEluZGV4KCk7DQogICAgICAgICAgaWYgKHNlbGVjdGVkVGFiSW5kZXggPj0gdGhpcy50YWJzLmxlbmd0aCkgew0KICAgICAgICAgICAgc2VsZWN0ZWRUYWJJbmRleCA9IDA7DQogICAgICAgICAgfQ0KICAgICAgICAgIHRoaXMuc2VsZWN0VGFiKHRoaXMudGFic1tzZWxlY3RlZFRhYkluZGV4XSwgMCk7DQogICAgICAgIH0NCiAgICAgIH07DQogICAgICB2YXIgdGFiR3JvdXBzID0gW10sDQogICAgICAgIGRvY3VtZW50UmVhZHkgPSBmdW5jdGlvbiAoZnVuYykgew0KICAgICAgICAgIHZhciBzdGFydGluZyA9IGZhbHNlOw0KDQogICAgICAgICAgZnVuY3Rpb24gc3RhcnRGdW5jKCkgew0KICAgICAgICAgICAgaWYgKHN0YXJ0aW5nKSByZXR1cm47DQogICAgICAgICAgICBzdGFydGluZyA9IHRydWU7DQogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmMsIDQpDQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7DQogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgc3RhcnRGdW5jLCBmYWxzZSk7DQogICAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5hdHRhY2hFdmVudCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgdmFyIHRvcGxldmVsID0gd2luZG93LmZyYW1lRWxlbWVudCA9PSBudWxsOw0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgeyB9DQogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsICYmIHRvcGxldmVsKSB7DQogICAgICAgICAgICAgIGZ1bmN0aW9uIGRvU2Nyb2xsQ2hlY2soKSB7DQogICAgICAgICAgICAgICAgaWYgKHN0YXJ0aW5nKSByZXR1cm47DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCgibGVmdCIpOw0KICAgICAgICAgICAgICAgICAgc3RhcnRGdW5jKCkNCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGRvU2Nyb2xsQ2hlY2ssIDEwKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBkb1Njcm9sbENoZWNrKCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRvY3VtZW50LmF0dGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgIGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIgJiYgc3RhcnRGdW5jKCkNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KICAgICAgICAgIGFkZEV2ZW50KHdpbmRvdywgImxvYWQiLCBzdGFydEZ1bmMpDQogICAgICAgIH0sDQogICAgICAgIGluaXRUYWJHcm91cHMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgdmFyIHBvc3NpYmxlVGFiR3JvdXBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInVsIiksDQogICAgICAgICAgICBlID0gcG9zc2libGVUYWJHcm91cHMubGVuZ3RoOw0KICAgICAgICAgIGZvciAoYyA9IDA7IGMgPCBlOyBjKyspIHsNCiAgICAgICAgICAgIGlmIChoYXNDbGFzcyhwb3NzaWJsZVRhYkdyb3Vwc1tjXSwgInRhYnMiKSkgew0KICAgICAgICAgICAgICB0YWJHcm91cHMucHVzaChuZXcgVGFiR3JvdXAocG9zc2libGVUYWJHcm91cHNbY10sIGMpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICBkb2N1bWVudFJlYWR5KGluaXRUYWJHcm91cHMpOw0KICAgICAgcmV0dXJuIHt9DQogICAgfSkoKQ0KDQogIDwvc2NyaXB0Pg0KICA8IS0tWE1MIEZvcm1hdHRlci0tPg0KICA8IS0tPHNjcmlwdCBzcmM9ImphdmFzY3JpcHRzL3htbC1mb3JtYXR0ZXIuanMiPjwvc2NyaXB0Pi0tPg0KICA8c2NyaXB0Pg0KICAgIHJlcXVpcmUgPSAoZnVuY3Rpb24gZSh0LCBuLCByKSB7IGZ1bmN0aW9uIHMobywgdSkgeyBpZiAoIW5bb10pIHsgaWYgKCF0W29dKSB7IHZhciBhID0gdHlwZW9mIHJlcXVpcmUgPT0gImZ1bmN0aW9uIiAmJiByZXF1aXJlOyBpZiAoIXUgJiYgYSkgcmV0dXJuIGEobywgITApOyBpZiAoaSkgcmV0dXJuIGkobywgITApOyB2YXIgZiA9IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciICsgbyArICInIik7IHRocm93IGYuY29kZSA9ICJNT0RVTEVfTk9UX0ZPVU5EIiwgZiB9IHZhciBsID0gbltvXSA9IHsgZXhwb3J0czoge30gfTsgdFtvXVswXS5jYWxsKGwuZXhwb3J0cywgZnVuY3Rpb24gKGUpIHsgdmFyIG4gPSB0W29dWzFdW2VdOyByZXR1cm4gcyhuID8gbiA6IGUpIH0sIGwsIGwuZXhwb3J0cywgZSwgdCwgbiwgcikgfSByZXR1cm4gbltvXS5leHBvcnRzIH0gdmFyIGkgPSB0eXBlb2YgcmVxdWlyZSA9PSAiZnVuY3Rpb24iICYmIHJlcXVpcmU7IGZvciAodmFyIG8gPSAwOyBvIDwgci5sZW5ndGg7IG8rKylzKHJbb10pOyByZXR1cm4gcyB9KSh7DQogICAgICAxOiBbZnVuY3Rpb24gKHJlcXVpcmUsIG1vZHVsZSwgZXhwb3J0cykgew0KDQogICAgICB9LCB7fV0sIDI6IFtmdW5jdGlvbiAocmVxdWlyZSwgbW9kdWxlLCBleHBvcnRzKSB7DQogICAgICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBkZWJ1ZygpIHsNCiAgICAgICAgICAgIC8vIGVtcHR5IG1vY2sgb2YgZGVidWcgbW9kdWxlIGZvciBicm93c2VyIHVzYWdlDQogICAgICAgICAgfTsNCiAgICAgICAgfTsNCiAgICAgIH0sIHt9XSwgMzogW2Z1bmN0aW9uIChyZXF1aXJlLCBtb2R1bGUsIGV4cG9ydHMpIHsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogTW9kdWxlIGRlcGVuZGVuY2llcy4NCiAgICAgICAgICovDQoNCiAgICAgICAgdmFyIGRlYnVnID0gcmVxdWlyZSgnZGVidWcnKSgneG1sLXBhcnNlcicpOw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBFeHBvc2UgYHBhcnNlYC4NCiAgICAgICAgICovDQoNCiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBwYXJzZTsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogUGFyc2UgdGhlIGdpdmVuIHN0cmluZyBvZiBgeG1sYC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHhtbA0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdDQogICAgICAgICAqICBAY29uZmlnIHtCb29sZWFufSBbdHJpbT10cnVlXQ0KICAgICAgICAgKiAgQGNvbmZpZyB7Qm9vbGVhbn0gW3N0cmlwQ29tbWVudHM9dHJ1ZV0NCiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fQ0KICAgICAgICAgKiBAYXBpIHB1YmxpYw0KICAgICAgICAgKi8NCg0KICAgICAgICBmdW5jdGlvbiBwYXJzZSh4bWwsIG9wdGlvbnMpIHsNCg0KICAgICAgICAgIC8vIHRyaW0gY29udGVudA0KICAgICAgICAgIGlmICghb3B0aW9ucyB8fCBvcHRpb25zLnRyaW0pIHsNCiAgICAgICAgICAgIHhtbCA9IHhtbC50cmltKCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gc3RyaXAgY29tbWVudHMNCiAgICAgICAgICBpZiAoIW9wdGlvbnMgfHwgb3B0aW9ucy5zdHJpcENvbW1lbnRzKSB7DQogICAgICAgICAgICB4bWwgPSB4bWwucmVwbGFjZSgvPCEtLVtcc1xTXSo/LS0+L2csICcnKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICByZXR1cm4gZG9jdW1lbnQoKTsNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIFhNTCBkb2N1bWVudC4NCiAgICAgICAgICAgKi8NCg0KICAgICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50KCkgew0KDQogICAgICAgICAgICB2YXIgZGVjbCA9IGRlY2xhcmF0aW9uKCk7DQogICAgICAgICAgICB2YXIgY2hpbGQ7DQogICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBbXTsNCiAgICAgICAgICAgIHZhciBkb2N1bWVudFJvb3ROb2RlOw0KDQogICAgICAgICAgICB3aGlsZSAoY2hpbGQgPSBuZXh0Um9vdENoaWxkKCkpIHsNCiAgICAgICAgICAgICAgaWYgKGNoaWxkLm5hbWUgIT09ICcjY29tbWVudCcpIHsNCiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnRSb290Tm9kZSkgew0KICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGb3VuZCBtdWx0aXBsZSByb290IG5vZGVzJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGRvY3VtZW50Um9vdE5vZGUgPSBjaGlsZDsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKGNoaWxkKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgZGVjbGFyYXRpb246IGRlY2wsDQogICAgICAgICAgICAgIHJvb3Q6IGRvY3VtZW50Um9vdE5vZGUsDQogICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbg0KICAgICAgICAgICAgfTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBEZWNsYXJhdGlvbi4NCiAgICAgICAgICAgKi8NCg0KICAgICAgICAgIGZ1bmN0aW9uIGRlY2xhcmF0aW9uKCkgew0KICAgICAgICAgICAgdmFyIG0gPSBtYXRjaCgvXjxcP3htbFxzKi8pOw0KICAgICAgICAgICAgaWYgKCFtKSByZXR1cm47DQoNCiAgICAgICAgICAgIC8vIHRhZw0KICAgICAgICAgICAgdmFyIG5vZGUgPSB7DQogICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHt9DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAvLyBhdHRyaWJ1dGVzDQogICAgICAgICAgICB3aGlsZSAoIShlb3MoKSB8fCBpcygnPz4nKSkpIHsNCiAgICAgICAgICAgICAgdmFyIGF0dHIgPSBhdHRyaWJ1dGUoKTsNCiAgICAgICAgICAgICAgaWYgKCFhdHRyKSByZXR1cm4gbm9kZTsNCiAgICAgICAgICAgICAgbm9kZS5hdHRyaWJ1dGVzW2F0dHIubmFtZV0gPSBhdHRyLnZhbHVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBtYXRjaCgvXD8+XHMqLyk7DQoNCiAgICAgICAgICAgIHJldHVybiBub2RlOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIFRhZy4NCiAgICAgICAgICAgKi8NCg0KICAgICAgICAgIGZ1bmN0aW9uIHRhZygpIHsNCiAgICAgICAgICAgIGRlYnVnKCd0YWcgJWonLCB4bWwpOw0KICAgICAgICAgICAgdmFyIG0gPSBtYXRjaCgvXjwoW1x3LTouXSspXHMqLyk7DQogICAgICAgICAgICBpZiAoIW0pIHJldHVybjsNCg0KICAgICAgICAgICAgLy8gbmFtZQ0KICAgICAgICAgICAgdmFyIG5vZGUgPSB7DQogICAgICAgICAgICAgIG5hbWU6IG1bMV0sDQogICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHt9LA0KICAgICAgICAgICAgICBjaGlsZHJlbjogW10NCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIC8vIGF0dHJpYnV0ZXMNCiAgICAgICAgICAgIHdoaWxlICghKGVvcygpIHx8IGlzKCc+JykgfHwgaXMoJz8+JykgfHwgaXMoJy8+JykpKSB7DQogICAgICAgICAgICAgIHZhciBhdHRyID0gYXR0cmlidXRlKCk7DQogICAgICAgICAgICAgIGlmICghYXR0cikgcmV0dXJuIG5vZGU7DQogICAgICAgICAgICAgIG5vZGUuYXR0cmlidXRlc1thdHRyLm5hbWVdID0gYXR0ci52YWx1ZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gc2VsZiBjbG9zaW5nIHRhZw0KICAgICAgICAgICAgaWYgKG1hdGNoKC9eXHMqXC8+LykpIHsNCiAgICAgICAgICAgICAgbm9kZS5jaGlsZHJlbiA9IG51bGw7DQogICAgICAgICAgICAgIHJldHVybiBub2RlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBtYXRjaCgvXD8/Pi8pOw0KDQogICAgICAgICAgICAvLyBjaGlsZHJlbg0KICAgICAgICAgICAgdmFyIGNoaWxkOw0KICAgICAgICAgICAgd2hpbGUgKGNoaWxkID0gbmV4dENoaWxkKCkpIHsNCiAgICAgICAgICAgICAgbm9kZS5jaGlsZHJlbi5wdXNoKGNoaWxkKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gY2xvc2luZw0KICAgICAgICAgICAgbWF0Y2goL148XC9bXHctOi5dKz4vKTsNCg0KICAgICAgICAgICAgcmV0dXJuIG5vZGU7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gbmV4dENoaWxkKCkgew0KICAgICAgICAgICAgcmV0dXJuIHRhZygpIHx8IGNvbnRlbnQoKSB8fCBjb21tZW50KCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gbmV4dFJvb3RDaGlsZCgpIHsNCiAgICAgICAgICAgIHJldHVybiB0YWcoKSB8fCBjb21tZW50KCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gY29tbWVudCgpIHsNCiAgICAgICAgICAgIHZhciBtID0gbWF0Y2goL148IS0tW1xzXFNdKj8tLT4vKTsNCiAgICAgICAgICAgIGlmIChtKSB7DQogICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgbmFtZTogJyNjb21tZW50JywNCiAgICAgICAgICAgICAgICBjb250ZW50OiBtWzBdDQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogVGV4dCBjb250ZW50Lg0KICAgICAgICAgICAqLw0KDQogICAgICAgICAgZnVuY3Rpb24gY29udGVudCgpIHsNCiAgICAgICAgICAgIGRlYnVnKCdjb250ZW50ICVqJywgeG1sKTsNCiAgICAgICAgICAgIHZhciBtID0gbWF0Y2goL14oW148XSspLyk7DQogICAgICAgICAgICBpZiAobSkgew0KICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIG5hbWU6ICcjdGV4dCcsDQogICAgICAgICAgICAgICAgY29udGVudDogbVsxXQ0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEF0dHJpYnV0ZS4NCiAgICAgICAgICAgKi8NCg0KICAgICAgICAgIGZ1bmN0aW9uIGF0dHJpYnV0ZSgpIHsNCiAgICAgICAgICAgIGRlYnVnKCdhdHRyaWJ1dGUgJWonLCB4bWwpOw0KICAgICAgICAgICAgdmFyIG0gPSBtYXRjaCgvKFtcdzotXSspXHMqPVxzKigiW14iXSoifCdbXiddKid8XHcrKVxzKi8pOw0KICAgICAgICAgICAgaWYgKCFtKSByZXR1cm47DQogICAgICAgICAgICByZXR1cm4geyBuYW1lOiBtWzFdLCB2YWx1ZTogc3RyaXAobVsyXSkgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIFN0cmlwIHF1b3RlcyBmcm9tIGB2YWxgLg0KICAgICAgICAgICAqLw0KDQogICAgICAgICAgZnVuY3Rpb24gc3RyaXAodmFsKSB7DQogICAgICAgICAgICByZXR1cm4gdmFsLnJlcGxhY2UoL15bJyJdfFsnIl0kL2csICcnKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBNYXRjaCBgcmVgIGFuZCBhZHZhbmNlIHRoZSBzdHJpbmcuDQogICAgICAgICAgICovDQoNCiAgICAgICAgICBmdW5jdGlvbiBtYXRjaChyZSkgew0KICAgICAgICAgICAgdmFyIG0gPSB4bWwubWF0Y2gocmUpOw0KICAgICAgICAgICAgaWYgKCFtKSByZXR1cm47DQogICAgICAgICAgICB4bWwgPSB4bWwuc2xpY2UobVswXS5sZW5ndGgpOw0KICAgICAgICAgICAgcmV0dXJuIG07DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogRW5kLW9mLXNvdXJjZS4NCiAgICAgICAgICAgKi8NCg0KICAgICAgICAgIGZ1bmN0aW9uIGVvcygpIHsNCiAgICAgICAgICAgIHJldHVybiAwID09IHhtbC5sZW5ndGg7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQ2hlY2sgZm9yIGBwcmVmaXhgLg0KICAgICAgICAgICAqLw0KDQogICAgICAgICAgZnVuY3Rpb24gaXMocHJlZml4KSB7DQogICAgICAgICAgICByZXR1cm4gMCA9PSB4bWwuaW5kZXhPZihwcmVmaXgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICB9LCB7ICJkZWJ1ZyI6IDIgfV0sICJ4bWwtZm9ybWF0dGVyIjogW2Z1bmN0aW9uIChyZXF1aXJlLCBtb2R1bGUsIGV4cG9ydHMpIHsNCiAgICAgICAgZnVuY3Rpb24gbmV3TGluZShvdXRwdXQpIHsNCiAgICAgICAgICBvdXRwdXQuY29udGVudCArPSAnXG4nOw0KICAgICAgICAgIHZhciBpOw0KICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBvdXRwdXQubGV2ZWw7IGkrKykgew0KICAgICAgICAgICAgb3V0cHV0LmNvbnRlbnQgKz0gb3V0cHV0Lm9wdGlvbnMuaW5kZW50YXRpb247DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gYXBwZW5kQ29udGVudChvdXRwdXQsIGNvbnRlbnQpIHsNCiAgICAgICAgICBvdXRwdXQuY29udGVudCArPSBjb250ZW50Ow0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc05vZGUobm9kZSwgb3V0cHV0LCBwcmVzZXJ2ZVNwYWNlKSB7DQogICAgICAgICAgaWYgKG5vZGUubmFtZSA9PT0gJyN0ZXh0JyB8fCBub2RlLm5hbWUgPT09ICcjY29tbWVudCcpIHsNCiAgICAgICAgICAgIHByb2Nlc3NDb250ZW50Tm9kZShub2RlLCBvdXRwdXQsIHByZXNlcnZlU3BhY2UpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBBc3N1bWluZyB0aGF0IHdlIG9ubHkgaGF2ZSAzIHR5cGVzIG9mIG5vZGUgKCN0ZXh0LCAjY29tbWVudCBhbmQgZWxlbWVudCkNCiAgICAgICAgICAgIHByb2Nlc3NFbGVtZW50KG5vZGUsIG91dHB1dCwgcHJlc2VydmVTcGFjZSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiAobm9kZS5uYW1lKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NDb250ZW50Tm9kZShub2RlLCBvdXRwdXQsIHByZXNlcnZlU3BhY2UpIHsNCiAgICAgICAgICBpZiAoIXByZXNlcnZlU3BhY2UgJiYgb3V0cHV0LmNvbnRlbnQubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgLy8gbmV3TGluZShvdXRwdXQpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBhcHBlbmRDb250ZW50KG91dHB1dCwgbm9kZS5jb250ZW50KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NFbGVtZW50KG5vZGUsIG91dHB1dCwgcHJlc2VydmVTcGFjZSkgew0KICAgICAgICAgIGlmICghcHJlc2VydmVTcGFjZSAmJiBvdXRwdXQuY29udGVudC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBuZXdMaW5lKG91dHB1dCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgYXBwZW5kQ29udGVudChvdXRwdXQsICc8JyArIG5vZGUubmFtZSk7DQogICAgICAgICAgcHJvY2Vzc0F0dHJpYnV0ZXMob3V0cHV0LCBub2RlLmF0dHJpYnV0ZXMpOw0KDQogICAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4gPT09IG51bGwpIHsNCiAgICAgICAgICAgIC8vIHNlbGYtY2xvc2luZyBub2RlDQogICAgICAgICAgICBhcHBlbmRDb250ZW50KG91dHB1dCwgJy8+Jyk7DQogICAgICAgICAgfSBlbHNlIHsNCg0KICAgICAgICAgICAgYXBwZW5kQ29udGVudChvdXRwdXQsICc+Jyk7DQoNCiAgICAgICAgICAgIG91dHB1dC5sZXZlbCsrOw0KDQogICAgICAgICAgICB2YXIgbm9kZVByZXNlcnZlU3BhY2UgPSBub2RlLmF0dHJpYnV0ZXNbJ3htbDpzcGFjZSddID09PSAncHJlc2VydmUnOw0KICAgICAgICAgICAgdmFyIGxhc3RDaGlsZFR5cGU7DQogICAgICAgICAgICBub2RlLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7DQogICAgICAgICAgICAgIGxhc3RDaGlsZFR5cGUgPSBwcm9jZXNzTm9kZShjaGlsZCwgb3V0cHV0LCBwcmVzZXJ2ZVNwYWNlIHx8IG5vZGVQcmVzZXJ2ZVNwYWNlKTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBvdXRwdXQubGV2ZWwtLTsNCg0KICAgICAgICAgICAgaWYgKCFwcmVzZXJ2ZVNwYWNlICYmICFub2RlUHJlc2VydmVTcGFjZSAmJiBsYXN0Q2hpbGRUeXBlICE9PSAnI3RleHQnICYmIGxhc3RDaGlsZFR5cGUgIT09ICcjY29tbWVudCcpIHsNCiAgICAgICAgICAgICAgbmV3TGluZShvdXRwdXQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYXBwZW5kQ29udGVudChvdXRwdXQsICc8LycgKyBub2RlLm5hbWUgKyAnPicpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NBdHRyaWJ1dGVzKG91dHB1dCwgYXR0cmlidXRlcykgew0KICAgICAgICAgIE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLmZvckVhY2goZnVuY3Rpb24gKGF0dHIpIHsNCiAgICAgICAgICAgIGFwcGVuZENvbnRlbnQob3V0cHV0LCAnICcgKyBhdHRyICsgJz0iJyArIGF0dHJpYnV0ZXNbYXR0cl0gKyAnIicpOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc0RlY2xhcmF0aW9uKGRlY2xhcmF0aW9uLCBvdXRwdXQpIHsNCiAgICAgICAgICBpZiAoZGVjbGFyYXRpb24pIHsNCiAgICAgICAgICAgIGFwcGVuZENvbnRlbnQob3V0cHV0LCAnPD94bWwnKTsNCiAgICAgICAgICAgIHByb2Nlc3NBdHRyaWJ1dGVzKG91dHB1dCwgZGVjbGFyYXRpb24uYXR0cmlidXRlcyk7DQogICAgICAgICAgICBhcHBlbmRDb250ZW50KG91dHB1dCwgJz8+Jyk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ29udmVydHMgdGhlIGdpdmVuIFhNTCBpbnRvIGh1bWFuIHJlYWRhYmxlIGZvcm1hdC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHhtbA0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucw0KICAgICAgICAgKiAgQGNvbmZpZyB7Qm9vbGVhbn0gW2RlYnVnPWZhbHNlXSBkaXNwbGF5cyBhIHRyZWUgb2YgdGhlIHBhcnNlZCBYTUwgYmVmb3JlIGZvcm1hdHRpbmcNCiAgICAgICAgICogIEBjb25maWcge1N0cmluZ30gW2luZGVudGF0aW9uPScgICAgJ10gVGhlIHZhbHVlIHVzZWQgZm9yIGluZGVudGF0aW9uDQogICAgICAgICAqICBAY29uZmlnIHtCb29sZWFufSBbc3RyaXBDb21tZW50cz1mYWxzZV0gVHJ1ZSB0byBzdHJpcCB0aGUgY29tbWVudHMNCiAgICAgICAgICogQHJldHVybnMge3N0cmluZ30NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGZvcm1hdCh4bWwsIG9wdGlvbnMpIHsNCg0KICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9Ow0KICAgICAgICAgIG9wdGlvbnMuZGVidWcgPSBvcHRpb25zLmRlYnVnID09PSB0cnVlOw0KICAgICAgICAgIG9wdGlvbnMuaW5kZW50YXRpb24gPSBvcHRpb25zLmluZGVudGF0aW9uIHx8ICcgICAgJzsNCiAgICAgICAgICBvcHRpb25zLnN0cmlwQ29tbWVudHMgPSBvcHRpb25zLnN0cmlwQ29tbWVudHMgPT09IHRydWU7DQoNCiAgICAgICAgICB2YXIgcGFyc2UgPSByZXF1aXJlKCd4bWwtcGFyc2VyLXhvJyk7DQogICAgICAgICAgdmFyIHBhcnNlZFhtbCA9IHBhcnNlKHhtbCwgeyBzdHJpcENvbW1lbnRzOiBvcHRpb25zLnN0cmlwQ29tbWVudHMgfSk7DQoNCiAgICAgICAgICBpZiAob3B0aW9ucy5kZWJ1Zykgew0KICAgICAgICAgICAgdmFyIGluc3BlY3QgPSByZXF1aXJlKCd1dGlsJykuaW5zcGVjdDsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGluc3BlY3QocGFyc2VkWG1sLCB7IGNvbG9yczogdHJ1ZSwgZGVwdGg6IEluZmluaXR5IH0pKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICB2YXIgb3V0cHV0ID0geyBjb250ZW50OiAnJywgbGV2ZWw6IDAsIG9wdGlvbnM6IG9wdGlvbnMgfTsNCg0KICAgICAgICAgIHByb2Nlc3NEZWNsYXJhdGlvbihwYXJzZWRYbWwuZGVjbGFyYXRpb24sIG91dHB1dCk7DQoNCiAgICAgICAgICBwYXJzZWRYbWwuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHsNCiAgICAgICAgICAgIHByb2Nlc3NOb2RlKGNoaWxkLCBvdXRwdXQsIGZhbHNlKTsNCiAgICAgICAgICB9KTsNCg0KICAgICAgICAgIHJldHVybiBvdXRwdXQuY29udGVudDsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmb3JtYXQ7DQogICAgICB9LCB7ICJ1dGlsIjogMSwgInhtbC1wYXJzZXIteG8iOiAzIH1dDQogICAgfSwge30sIFtdKTsNCg0KICA8L3NjcmlwdD4NCiAgPCEtLWh0dHBzOi8vZmxhdHBpY2tyLmpzLm9yZy8tLT4NCiAgPCEtLTxsaW5rIGhyZWY9InN0eWxlc2hlZXRzL2ZsYXRwaWNrci5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+DQogIDxzdHlsZT4NCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyIHsNCiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50Ow0KICAgICAgb3BhY2l0eTogMDsNCiAgICAgIGRpc3BsYXk6IG5vbmU7DQogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICB2aXNpYmlsaXR5OiBoaWRkZW47DQogICAgICBwYWRkaW5nOiAwOw0KICAgICAgLXdlYmtpdC1hbmltYXRpb246IG5vbmU7DQogICAgICBhbmltYXRpb246IG5vbmU7DQogICAgICBkaXJlY3Rpb246IGx0cjsNCiAgICAgIGJvcmRlcjogMDsNCiAgICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICAgIGxpbmUtaGVpZ2h0OiAyNHB4Ow0KICAgICAgYm9yZGVyLXJhZGl1czogNXB4Ow0KICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgICAgd2lkdGg6IDMwNy44NzVweDsNCiAgICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAtbXMtdG91Y2gtYWN0aW9uOiBtYW5pcHVsYXRpb247DQogICAgICB0b3VjaC1hY3Rpb246IG1hbmlwdWxhdGlvbjsNCiAgICAgIGJhY2tncm91bmQ6ICNmZmY7DQogICAgICAtd2Via2l0LWJveC1zaGFkb3c6IDFweCAwIDAgI2U2ZTZlNiwgLTFweCAwIDAgI2U2ZTZlNiwgMCAxcHggMCAjZTZlNmU2LCAwIC0xcHggMCAjZTZlNmU2LCAwIDNweCAxM3B4IHJnYmEoMCwgMCwgMCwgMC4wOCk7DQogICAgICBib3gtc2hhZG93OiAxcHggMCAwICNlNmU2ZTYsIC0xcHggMCAwICNlNmU2ZTYsIDAgMXB4IDAgI2U2ZTZlNiwgMCAtMXB4IDAgI2U2ZTZlNiwgMCAzcHggMTNweCByZ2JhKDAsIDAsIDAsIDAuMDgpOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIub3BlbiwNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmlubGluZSB7DQogICAgICBvcGFjaXR5OiAxOw0KICAgICAgbWF4LWhlaWdodDogNjQwcHg7DQogICAgICB2aXNpYmlsaXR5OiB2aXNpYmxlOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIub3BlbiB7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICB6LWluZGV4OiA5OTk5OTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmFuaW1hdGUub3BlbiB7DQogICAgICAtd2Via2l0LWFuaW1hdGlvbjogZnBGYWRlSW5Eb3duIDMwMG1zIGN1YmljLWJlemllcigwLjIzLCAxLCAwLjMyLCAxKTsNCiAgICAgIGFuaW1hdGlvbjogZnBGYWRlSW5Eb3duIDMwMG1zIGN1YmljLWJlemllcigwLjIzLCAxLCAwLjMyLCAxKTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmlubGluZSB7DQogICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgIHRvcDogMnB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuc3RhdGljIHsNCiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgIHRvcDogY2FsYygxMDAlICsgMnB4KTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLnN0YXRpYy5vcGVuIHsNCiAgICAgIHotaW5kZXg6IDk5OTsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIubXVsdGlNb250aCAuZmxhdHBpY2tyLWRheXMgLmRheUNvbnRhaW5lcjpudGgtY2hpbGQobisxKSAuZmxhdHBpY2tyLWRheS5pblJhbmdlOm50aC1jaGlsZCg3bis3KSB7DQogICAgICAtd2Via2l0LWJveC1zaGFkb3c6IG5vbmUgIWltcG9ydGFudDsNCiAgICAgIGJveC1zaGFkb3c6IG5vbmUgIWltcG9ydGFudDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLm11bHRpTW9udGggLmZsYXRwaWNrci1kYXlzIC5kYXlDb250YWluZXI6bnRoLWNoaWxkKG4rMikgLmZsYXRwaWNrci1kYXkuaW5SYW5nZTpudGgtY2hpbGQoN24rMSkgew0KICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiAtMnB4IDAgMCAjZTZlNmU2LCA1cHggMCAwICNlNmU2ZTY7DQogICAgICBib3gtc2hhZG93OiAtMnB4IDAgMCAjZTZlNmU2LCA1cHggMCAwICNlNmU2ZTY7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhciAuaGFzV2Vla3MgLmRheUNvbnRhaW5lciwNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyIC5oYXNUaW1lIC5kYXlDb250YWluZXIgew0KICAgICAgYm9yZGVyLWJvdHRvbTogMDsNCiAgICAgIGJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiAwOw0KICAgICAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyIC5oYXNXZWVrcyAuZGF5Q29udGFpbmVyIHsNCiAgICAgIGJvcmRlci1sZWZ0OiAwOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuc2hvd1RpbWVJbnB1dC5oYXNUaW1lIC5mbGF0cGlja3ItdGltZSB7DQogICAgICBoZWlnaHQ6IDQwcHg7DQogICAgICBib3JkZXItdG9wOiAxcHggc29saWQgI2U2ZTZlNjsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLm5vQ2FsZW5kYXIuaGFzVGltZSAuZmxhdHBpY2tyLXRpbWUgew0KICAgICAgaGVpZ2h0OiBhdXRvOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXI6YmVmb3JlLA0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXI6YWZ0ZXIgew0KICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICBwb2ludGVyLWV2ZW50czogbm9uZTsNCiAgICAgIGJvcmRlcjogc29saWQgdHJhbnNwYXJlbnQ7DQogICAgICBjb250ZW50OiAnJzsNCiAgICAgIGhlaWdodDogMDsNCiAgICAgIHdpZHRoOiAwOw0KICAgICAgbGVmdDogMjJweDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLnJpZ2h0TW9zdDpiZWZvcmUsDQogICAgLmZsYXRwaWNrci1jYWxlbmRhci5yaWdodE1vc3Q6YWZ0ZXIgew0KICAgICAgbGVmdDogYXV0bzsNCiAgICAgIHJpZ2h0OiAyMnB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXI6YmVmb3JlIHsNCiAgICAgIGJvcmRlci13aWR0aDogNXB4Ow0KICAgICAgbWFyZ2luOiAwIC01cHg7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhcjphZnRlciB7DQogICAgICBib3JkZXItd2lkdGg6IDRweDsNCiAgICAgIG1hcmdpbjogMCAtNHB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dUb3A6YmVmb3JlLA0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dUb3A6YWZ0ZXIgew0KICAgICAgYm90dG9tOiAxMDAlOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dUb3A6YmVmb3JlIHsNCiAgICAgIGJvcmRlci1ib3R0b20tY29sb3I6ICNlNmU2ZTY7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhci5hcnJvd1RvcDphZnRlciB7DQogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjZmZmOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dCb3R0b206YmVmb3JlLA0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dCb3R0b206YWZ0ZXIgew0KICAgICAgdG9wOiAxMDAlOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dCb3R0b206YmVmb3JlIHsNCiAgICAgIGJvcmRlci10b3AtY29sb3I6ICNlNmU2ZTY7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jYWxlbmRhci5hcnJvd0JvdHRvbTphZnRlciB7DQogICAgICBib3JkZXItdG9wLWNvbG9yOiAjZmZmOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY2FsZW5kYXI6Zm9jdXMgew0KICAgICAgb3V0bGluZTogMDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXdyYXBwZXIgew0KICAgICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItbW9udGhzIHsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtYm94Ow0KICAgICAgZGlzcGxheTogLXdlYmtpdC1mbGV4Ow0KICAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbW9udGggew0KICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7DQogICAgICBjb2xvcjogcmdiYSgwLCAwLCAwLCAwLjkpOw0KICAgICAgZmlsbDogcmdiYSgwLCAwLCAwLCAwLjkpOw0KICAgICAgaGVpZ2h0OiAyOHB4Ow0KICAgICAgbGluZS1oZWlnaHQ6IDE7DQogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOw0KICAgICAgLW1vei11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIC1tcy11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIHVzZXItc2VsZWN0OiBub25lOw0KICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgIC13ZWJraXQtYm94LWZsZXg6IDE7DQogICAgICAtd2Via2l0LWZsZXg6IDE7DQogICAgICAtbXMtZmxleDogMTsNCiAgICAgIGZsZXg6IDE7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1wcmV2LW1vbnRoLA0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aCB7DQogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgICB0b3A6IDBweDsNCiAgICAgIGxpbmUtaGVpZ2h0OiAxNnB4Ow0KICAgICAgaGVpZ2h0OiAyOHB4Ow0KICAgICAgcGFkZGluZzogMTBweDsNCiAgICAgIHotaW5kZXg6IDM7DQogICAgICBjb2xvcjogcmdiYSgwLCAwLCAwLCAwLjkpOw0KICAgICAgZmlsbDogcmdiYSgwLCAwLCAwLCAwLjkpOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItcHJldi1tb250aC5kaXNhYmxlZCwNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLW5leHQtbW9udGguZGlzYWJsZWQgew0KICAgICAgZGlzcGxheTogbm9uZTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGggaSwNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLW5leHQtbW9udGggaSB7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1wcmV2LW1vbnRoLmZsYXRwaWNrci1wcmV2LW1vbnRoLA0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aC5mbGF0cGlja3ItcHJldi1tb250aCB7DQogICAgICAvKg0KICAgICAgLypydGw6YmVnaW46aWdub3JlKi8NCiAgICAgIC8qDQogICAgICAqLw0KICAgICAgbGVmdDogMDsNCiAgICAgIC8qDQogICAgICAvKnJ0bDplbmQ6aWdub3JlKi8NCiAgICAgIC8qDQogICAgICAqLw0KICAgIH0NCg0KICAgIC8qDQogICAgICAvKnJ0bDpiZWdpbjppZ25vcmUqLw0KICAgIC8qDQogICAgICAvKnJ0bDplbmQ6aWdub3JlKi8NCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGguZmxhdHBpY2tyLW5leHQtbW9udGgsDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoLmZsYXRwaWNrci1uZXh0LW1vbnRoIHsNCiAgICAgIC8qDQogICAgICAvKnJ0bDpiZWdpbjppZ25vcmUqLw0KICAgICAgLyoNCiAgICAgICovDQogICAgICByaWdodDogMDsNCiAgICAgIC8qDQogICAgICAvKnJ0bDplbmQ6aWdub3JlKi8NCiAgICAgIC8qDQogICAgICAqLw0KICAgIH0NCg0KICAgIC8qDQogICAgICAvKnJ0bDpiZWdpbjppZ25vcmUqLw0KICAgIC8qDQogICAgICAvKnJ0bDplbmQ6aWdub3JlKi8NCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGg6aG92ZXIsDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoOmhvdmVyIHsNCiAgICAgIGNvbG9yOiAjOTU5ZWE5Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItcHJldi1tb250aDpob3ZlciBzdmcsDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoOmhvdmVyIHN2ZyB7DQogICAgICBmaWxsOiAjZjY0NzQ3Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItcHJldi1tb250aCBzdmcsDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoIHN2ZyB7DQogICAgICB3aWR0aDogMTRweDsNCiAgICAgIGhlaWdodDogMTRweDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGggc3ZnIHBhdGgsDQogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoIHN2ZyBwYXRoIHsNCiAgICAgIC13ZWJraXQtdHJhbnNpdGlvbjogZmlsbCAwLjFzOw0KICAgICAgdHJhbnNpdGlvbjogZmlsbCAwLjFzOw0KICAgICAgZmlsbDogaW5oZXJpdDsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIHsNCiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgIGhlaWdodDogYXV0bzsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIGlucHV0LA0KICAgIC5udW1JbnB1dFdyYXBwZXIgc3BhbiB7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBpbnB1dCB7DQogICAgICB3aWR0aDogMTAwJTsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIGlucHV0OjotbXMtY2xlYXIgew0KICAgICAgZGlzcGxheTogbm9uZTsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIHNwYW4gew0KICAgICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgICAgcmlnaHQ6IDA7DQogICAgICB3aWR0aDogMTRweDsNCiAgICAgIHBhZGRpbmc6IDAgNHB4IDAgMnB4Ow0KICAgICAgaGVpZ2h0OiA1MCU7DQogICAgICBsaW5lLWhlaWdodDogNTAlOw0KICAgICAgb3BhY2l0eTogMDsNCiAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoNTcsIDU3LCA1NywgMC4xNSk7DQogICAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIH0NCg0KICAgIC5udW1JbnB1dFdyYXBwZXIgc3Bhbjpob3ZlciB7DQogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMSk7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBzcGFuOmFjdGl2ZSB7DQogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMik7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBzcGFuOmFmdGVyIHsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgY29udGVudDogIiI7DQogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93VXAgew0KICAgICAgdG9wOiAwOw0KICAgICAgYm9yZGVyLWJvdHRvbTogMDsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIHNwYW4uYXJyb3dVcDphZnRlciB7DQogICAgICBib3JkZXItbGVmdDogNHB4IHNvbGlkIHRyYW5zcGFyZW50Ow0KICAgICAgYm9yZGVyLXJpZ2h0OiA0cHggc29saWQgdHJhbnNwYXJlbnQ7DQogICAgICBib3JkZXItYm90dG9tOiA0cHggc29saWQgcmdiYSg1NywgNTcsIDU3LCAwLjYpOw0KICAgICAgdG9wOiAyNiU7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93RG93biB7DQogICAgICB0b3A6IDUwJTsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIHNwYW4uYXJyb3dEb3duOmFmdGVyIHsNCiAgICAgIGJvcmRlci1sZWZ0OiA0cHggc29saWQgdHJhbnNwYXJlbnQ7DQogICAgICBib3JkZXItcmlnaHQ6IDRweCBzb2xpZCB0cmFuc3BhcmVudDsNCiAgICAgIGJvcmRlci10b3A6IDRweCBzb2xpZCByZ2JhKDU3LCA1NywgNTcsIDAuNik7DQogICAgICB0b3A6IDQwJTsNCiAgICB9DQoNCiAgICAubnVtSW5wdXRXcmFwcGVyIHNwYW4gc3ZnIHsNCiAgICAgIHdpZHRoOiBpbmhlcml0Ow0KICAgICAgaGVpZ2h0OiBhdXRvOw0KICAgIH0NCg0KICAgIC5udW1JbnB1dFdyYXBwZXIgc3BhbiBzdmcgcGF0aCB7DQogICAgICBmaWxsOiByZ2JhKDAsIDAsIDAsIDAuNSk7DQogICAgfQ0KDQogICAgLm51bUlucHV0V3JhcHBlcjpob3ZlciB7DQogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMDUpOw0KICAgIH0NCg0KICAgIC5udW1JbnB1dFdyYXBwZXI6aG92ZXIgc3BhbiB7DQogICAgICBvcGFjaXR5OiAxOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY3VycmVudC1tb250aCB7DQogICAgICBmb250LXNpemU6IDEzNSU7DQogICAgICBsaW5lLWhlaWdodDogaW5oZXJpdDsNCiAgICAgIGZvbnQtd2VpZ2h0OiAzMDA7DQogICAgICBjb2xvcjogaW5oZXJpdDsNCiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgIHdpZHRoOiA3NSU7DQogICAgICBsZWZ0OiAxMi41JTsNCiAgICAgIHBhZGRpbmc6IDYuMTZweCAwIDAgMDsNCiAgICAgIGxpbmUtaGVpZ2h0OiAxOw0KICAgICAgaGVpZ2h0OiAyOHB4Ow0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDBweCwgMHB4LCAwcHgpOw0KICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwcHgsIDBweCwgMHB4KTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggc3Bhbi5jdXItbW9udGggew0KICAgICAgZm9udC1mYW1pbHk6IGluaGVyaXQ7DQogICAgICBmb250LXdlaWdodDogNzAwOw0KICAgICAgY29sb3I6IGluaGVyaXQ7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBtYXJnaW4tbGVmdDogMC41Y2g7DQogICAgICBwYWRkaW5nOiAwOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY3VycmVudC1tb250aCBzcGFuLmN1ci1tb250aDpob3ZlciB7DQogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMDUpOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItY3VycmVudC1tb250aCAubnVtSW5wdXRXcmFwcGVyIHsNCiAgICAgIHdpZHRoOiA2Y2g7DQogICAgICB3aWR0aDogN2NoXDA7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jdXJyZW50LW1vbnRoIC5udW1JbnB1dFdyYXBwZXIgc3Bhbi5hcnJvd1VwOmFmdGVyIHsNCiAgICAgIGJvcmRlci1ib3R0b20tY29sb3I6IHJnYmEoMCwgMCwgMCwgMC45KTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93RG93bjphZnRlciB7DQogICAgICBib3JkZXItdG9wLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuOSk7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1jdXJyZW50LW1vbnRoIGlucHV0LmN1ci15ZWFyIHsNCiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50Ow0KICAgICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIGNvbG9yOiBpbmhlcml0Ow0KICAgICAgY3Vyc29yOiB0ZXh0Ow0KICAgICAgcGFkZGluZzogMCAwIDAgMC41Y2g7DQogICAgICBtYXJnaW46IDA7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBmb250LXNpemU6IGluaGVyaXQ7DQogICAgICBmb250LWZhbWlseTogaW5oZXJpdDsNCiAgICAgIGZvbnQtd2VpZ2h0OiAzMDA7DQogICAgICBsaW5lLWhlaWdodDogaW5oZXJpdDsNCiAgICAgIGhlaWdodDogYXV0bzsNCiAgICAgIGJvcmRlcjogMDsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDA7DQogICAgICB2ZXJ0aWNhbC1hbGlnbjogaW5pdGlhbDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggaW5wdXQuY3VyLXllYXI6Zm9jdXMgew0KICAgICAgb3V0bGluZTogMDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggaW5wdXQuY3VyLXllYXJbZGlzYWJsZWRdLA0KICAgIC5mbGF0cGlja3ItY3VycmVudC1tb250aCBpbnB1dC5jdXIteWVhcltkaXNhYmxlZF06aG92ZXIgew0KICAgICAgZm9udC1zaXplOiAxMDAlOw0KICAgICAgY29sb3I6IHJnYmEoMCwgMCwgMCwgMC41KTsNCiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50Ow0KICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci13ZWVrZGF5cyB7DQogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICB3aWR0aDogMTAwJTsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtYm94Ow0KICAgICAgZGlzcGxheTogLXdlYmtpdC1mbGV4Ow0KICAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgLXdlYmtpdC1ib3gtYWxpZ246IGNlbnRlcjsNCiAgICAgIC13ZWJraXQtYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgIC1tcy1mbGV4LWFsaWduOiBjZW50ZXI7DQogICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgaGVpZ2h0OiAyOHB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3Itd2Vla2RheXMgLmZsYXRwaWNrci13ZWVrZGF5Y29udGFpbmVyIHsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtYm94Ow0KICAgICAgZGlzcGxheTogLXdlYmtpdC1mbGV4Ow0KICAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgLXdlYmtpdC1ib3gtZmxleDogMTsNCiAgICAgIC13ZWJraXQtZmxleDogMTsNCiAgICAgIC1tcy1mbGV4OiAxOw0KICAgICAgZmxleDogMTsNCiAgICB9DQoNCiAgICBzcGFuLmZsYXRwaWNrci13ZWVrZGF5IHsNCiAgICAgIGN1cnNvcjogZGVmYXVsdDsNCiAgICAgIGZvbnQtc2l6ZTogOTAlOw0KICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7DQogICAgICBjb2xvcjogcmdiYSgwLCAwLCAwLCAwLjU0KTsNCiAgICAgIGxpbmUtaGVpZ2h0OiAxOw0KICAgICAgbWFyZ2luOiAwOw0KICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAtd2Via2l0LWJveC1mbGV4OiAxOw0KICAgICAgLXdlYmtpdC1mbGV4OiAxOw0KICAgICAgLW1zLWZsZXg6IDE7DQogICAgICBmbGV4OiAxOw0KICAgICAgZm9udC13ZWlnaHQ6IGJvbGRlcjsNCiAgICB9DQoNCiAgICAuZGF5Q29udGFpbmVyLA0KICAgIC5mbGF0cGlja3Itd2Vla3Mgew0KICAgICAgcGFkZGluZzogMXB4IDAgMCAwOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5cyB7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgZGlzcGxheTogLXdlYmtpdC1ib3g7DQogICAgICBkaXNwbGF5OiAtd2Via2l0LWZsZXg7DQogICAgICBkaXNwbGF5OiAtbXMtZmxleGJveDsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAtd2Via2l0LWJveC1hbGlnbjogc3RhcnQ7DQogICAgICAtd2Via2l0LWFsaWduLWl0ZW1zOiBmbGV4LXN0YXJ0Ow0KICAgICAgLW1zLWZsZXgtYWxpZ246IHN0YXJ0Ow0KICAgICAgYWxpZ24taXRlbXM6IGZsZXgtc3RhcnQ7DQogICAgICB3aWR0aDogMzA3Ljg3NXB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5czpmb2N1cyB7DQogICAgICBvdXRsaW5lOiAwOw0KICAgIH0NCg0KICAgIC5kYXlDb250YWluZXIgew0KICAgICAgcGFkZGluZzogMDsNCiAgICAgIG91dGxpbmU6IDA7DQogICAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICAgICAgd2lkdGg6IDMwNy44NzVweDsNCiAgICAgIG1pbi13aWR0aDogMzA3Ljg3NXB4Ow0KICAgICAgbWF4LXdpZHRoOiAzMDcuODc1cHg7DQogICAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7DQogICAgICBkaXNwbGF5OiAtd2Via2l0LWJveDsNCiAgICAgIGRpc3BsYXk6IC13ZWJraXQtZmxleDsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAtd2Via2l0LWZsZXgtd3JhcDogd3JhcDsNCiAgICAgIGZsZXgtd3JhcDogd3JhcDsNCiAgICAgIC1tcy1mbGV4LXdyYXA6IHdyYXA7DQogICAgICAtbXMtZmxleC1wYWNrOiBqdXN0aWZ5Ow0KICAgICAgLXdlYmtpdC1qdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWFyb3VuZDsNCiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYXJvdW5kOw0KICAgICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDBweCwgMHB4LCAwcHgpOw0KICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwcHgsIDBweCwgMHB4KTsNCiAgICAgIG9wYWNpdHk6IDE7DQogICAgfQ0KDQogICAgLmRheUNvbnRhaW5lcisuZGF5Q29udGFpbmVyIHsNCiAgICAgIC13ZWJraXQtYm94LXNoYWRvdzogLTFweCAwIDAgI2U2ZTZlNjsNCiAgICAgIGJveC1zaGFkb3c6IC0xcHggMCAwICNlNmU2ZTY7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkgew0KICAgICAgYmFja2dyb3VuZDogbm9uZTsNCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50Ow0KICAgICAgYm9yZGVyLXJhZGl1czogMTUwcHg7DQogICAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgY29sb3I6ICMzOTM5Mzk7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICBmb250LXdlaWdodDogNDAwOw0KICAgICAgd2lkdGg6IDE0LjI4NTcxNDMlOw0KICAgICAgLXdlYmtpdC1mbGV4LWJhc2lzOiAxNC4yODU3MTQzJTsNCiAgICAgIC1tcy1mbGV4LXByZWZlcnJlZC1zaXplOiAxNC4yODU3MTQzJTsNCiAgICAgIGZsZXgtYmFzaXM6IDE0LjI4NTcxNDMlOw0KICAgICAgbWF4LXdpZHRoOiAzOXB4Ow0KICAgICAgaGVpZ2h0OiAzOXB4Ow0KICAgICAgbGluZS1oZWlnaHQ6IDM5cHg7DQogICAgICBtYXJnaW46IDA7DQogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICAtd2Via2l0LWJveC1wYWNrOiBjZW50ZXI7DQogICAgICAtd2Via2l0LWp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgLW1zLWZsZXgtcGFjazogY2VudGVyOw0KICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuaW5SYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5wcmV2TW9udGhEYXkuaW5SYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5uZXh0TW9udGhEYXkuaW5SYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS50b2RheS5pblJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5LnByZXZNb250aERheS50b2RheS5pblJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5Lm5leHRNb250aERheS50b2RheS5pblJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5OmhvdmVyLA0KICAgIC5mbGF0cGlja3ItZGF5LnByZXZNb250aERheTpob3ZlciwNCiAgICAuZmxhdHBpY2tyLWRheS5uZXh0TW9udGhEYXk6aG92ZXIsDQogICAgLmZsYXRwaWNrci1kYXk6Zm9jdXMsDQogICAgLmZsYXRwaWNrci1kYXkucHJldk1vbnRoRGF5OmZvY3VzLA0KICAgIC5mbGF0cGlja3ItZGF5Lm5leHRNb250aERheTpmb2N1cyB7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICBvdXRsaW5lOiAwOw0KICAgICAgYmFja2dyb3VuZDogI2U2ZTZlNjsNCiAgICAgIGJvcmRlci1jb2xvcjogI2U2ZTZlNjsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWRheS50b2RheSB7DQogICAgICBib3JkZXItY29sb3I6ICM5NTllYTk7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkudG9kYXk6aG92ZXIsDQogICAgLmZsYXRwaWNrci1kYXkudG9kYXk6Zm9jdXMgew0KICAgICAgYm9yZGVyLWNvbG9yOiAjOTU5ZWE5Ow0KICAgICAgYmFja2dyb3VuZDogIzk1OWVhOTsNCiAgICAgIGNvbG9yOiAjZmZmOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5LnNlbGVjdGVkLA0KICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuc2VsZWN0ZWQuaW5SYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlLmluUmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2UuaW5SYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZDpmb2N1cywNCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlOmZvY3VzLA0KICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlOmZvY3VzLA0KICAgIC5mbGF0cGlja3ItZGF5LnNlbGVjdGVkOmhvdmVyLA0KICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2U6aG92ZXIsDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2U6aG92ZXIsDQogICAgLmZsYXRwaWNrci1kYXkuc2VsZWN0ZWQucHJldk1vbnRoRGF5LA0KICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2UucHJldk1vbnRoRGF5LA0KICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlLnByZXZNb250aERheSwNCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZC5uZXh0TW9udGhEYXksDQogICAgLmZsYXRwaWNrci1kYXkuc3RhcnRSYW5nZS5uZXh0TW9udGhEYXksDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2UubmV4dE1vbnRoRGF5IHsNCiAgICAgIGJhY2tncm91bmQ6ICM1NjlmZjc7DQogICAgICAtd2Via2l0LWJveC1zaGFkb3c6IG5vbmU7DQogICAgICBib3gtc2hhZG93OiBub25lOw0KICAgICAgY29sb3I6ICNmZmY7DQogICAgICBib3JkZXItY29sb3I6ICM1NjlmZjc7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuc2VsZWN0ZWQuc3RhcnRSYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlLnN0YXJ0UmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2Uuc3RhcnRSYW5nZSB7DQogICAgICBib3JkZXItcmFkaXVzOiA1MHB4IDAgMCA1MHB4Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItZGF5LnNlbGVjdGVkLmVuZFJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2UuZW5kUmFuZ2UsDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2UuZW5kUmFuZ2Ugew0KICAgICAgYm9yZGVyLXJhZGl1czogMCA1MHB4IDUwcHggMDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZC5zdGFydFJhbmdlKy5lbmRSYW5nZTpub3QoOm50aC1jaGlsZCg3bisxKSksDQogICAgLmZsYXRwaWNrci1kYXkuc3RhcnRSYW5nZS5zdGFydFJhbmdlKy5lbmRSYW5nZTpub3QoOm50aC1jaGlsZCg3bisxKSksDQogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2Uuc3RhcnRSYW5nZSsuZW5kUmFuZ2U6bm90KDpudGgtY2hpbGQoN24rMSkpIHsNCiAgICAgIC13ZWJraXQtYm94LXNoYWRvdzogLTEwcHggMCAwICM1NjlmZjc7DQogICAgICBib3gtc2hhZG93OiAtMTBweCAwIDAgIzU2OWZmNzsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZC5zdGFydFJhbmdlLmVuZFJhbmdlLA0KICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2Uuc3RhcnRSYW5nZS5lbmRSYW5nZSwNCiAgICAuZmxhdHBpY2tyLWRheS5lbmRSYW5nZS5zdGFydFJhbmdlLmVuZFJhbmdlIHsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDUwcHg7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuaW5SYW5nZSB7DQogICAgICBib3JkZXItcmFkaXVzOiAwOw0KICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiAtNXB4IDAgMCAjZTZlNmU2LCA1cHggMCAwICNlNmU2ZTY7DQogICAgICBib3gtc2hhZG93OiAtNXB4IDAgMCAjZTZlNmU2LCA1cHggMCAwICNlNmU2ZTY7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuZGlzYWJsZWQsDQogICAgLmZsYXRwaWNrci1kYXkuZGlzYWJsZWQ6aG92ZXIsDQogICAgLmZsYXRwaWNrci1kYXkucHJldk1vbnRoRGF5LA0KICAgIC5mbGF0cGlja3ItZGF5Lm5leHRNb250aERheSwNCiAgICAuZmxhdHBpY2tyLWRheS5ub3RBbGxvd2VkLA0KICAgIC5mbGF0cGlja3ItZGF5Lm5vdEFsbG93ZWQucHJldk1vbnRoRGF5LA0KICAgIC5mbGF0cGlja3ItZGF5Lm5vdEFsbG93ZWQubmV4dE1vbnRoRGF5IHsNCiAgICAgIGNvbG9yOiByZ2JhKDU3LCA1NywgNTcsIDAuMyk7DQogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICAgIGJvcmRlci1jb2xvcjogdHJhbnNwYXJlbnQ7DQogICAgICBjdXJzb3I6IGRlZmF1bHQ7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuZGlzYWJsZWQsDQogICAgLmZsYXRwaWNrci1kYXkuZGlzYWJsZWQ6aG92ZXIgew0KICAgICAgY3Vyc29yOiBub3QtYWxsb3dlZDsNCiAgICAgIGNvbG9yOiByZ2JhKDU3LCA1NywgNTcsIDAuMSk7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkud2Vlay5zZWxlY3RlZCB7DQogICAgICBib3JkZXItcmFkaXVzOiAwOw0KICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiAtNXB4IDAgMCAjNTY5ZmY3LCA1cHggMCAwICM1NjlmZjc7DQogICAgICBib3gtc2hhZG93OiAtNXB4IDAgMCAjNTY5ZmY3LCA1cHggMCAwICM1NjlmZjc7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci1kYXkuaGlkZGVuIHsNCiAgICAgIHZpc2liaWxpdHk6IGhpZGRlbjsNCiAgICB9DQoNCiAgICAucmFuZ2VNb2RlIC5mbGF0cGlja3ItZGF5IHsNCiAgICAgIG1hcmdpbi10b3A6IDFweDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXdlZWt3cmFwcGVyIHsNCiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgIGZsb2F0OiBsZWZ0Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3Itd2Vla3dyYXBwZXIgLmZsYXRwaWNrci13ZWVrcyB7DQogICAgICBwYWRkaW5nOiAwIDEycHg7DQogICAgICAtd2Via2l0LWJveC1zaGFkb3c6IDFweCAwIDAgI2U2ZTZlNjsNCiAgICAgIGJveC1zaGFkb3c6IDFweCAwIDAgI2U2ZTZlNjsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXdlZWt3cmFwcGVyIC5mbGF0cGlja3Itd2Vla2RheSB7DQogICAgICBmbG9hdDogbm9uZTsNCiAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgbGluZS1oZWlnaHQ6IDI4cHg7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci13ZWVrd3JhcHBlciBzcGFuLmZsYXRwaWNrci1kYXksDQogICAgLmZsYXRwaWNrci13ZWVrd3JhcHBlciBzcGFuLmZsYXRwaWNrci1kYXk6aG92ZXIgew0KICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICB3aWR0aDogMTAwJTsNCiAgICAgIG1heC13aWR0aDogbm9uZTsNCiAgICAgIGNvbG9yOiByZ2JhKDU3LCA1NywgNTcsIDAuMyk7DQogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsNCiAgICAgIGN1cnNvcjogZGVmYXVsdDsNCiAgICAgIGJvcmRlcjogbm9uZTsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWlubmVyQ29udGFpbmVyIHsNCiAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgZGlzcGxheTogLXdlYmtpdC1ib3g7DQogICAgICBkaXNwbGF5OiAtd2Via2l0LWZsZXg7DQogICAgICBkaXNwbGF5OiAtbXMtZmxleGJveDsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXJDb250YWluZXIgew0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgcGFkZGluZzogMDsNCiAgICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lIHsNCiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgIG91dGxpbmU6IDA7DQogICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgIGhlaWdodDogMDsNCiAgICAgIGxpbmUtaGVpZ2h0OiA0MHB4Ow0KICAgICAgbWF4LWhlaWdodDogNDBweDsNCiAgICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgZGlzcGxheTogLXdlYmtpdC1ib3g7DQogICAgICBkaXNwbGF5OiAtd2Via2l0LWZsZXg7DQogICAgICBkaXNwbGF5OiAtbXMtZmxleGJveDsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lOmFmdGVyIHsNCiAgICAgIGNvbnRlbnQ6ICIiOw0KICAgICAgZGlzcGxheTogdGFibGU7DQogICAgICBjbGVhcjogYm90aDsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLXRpbWUgLm51bUlucHV0V3JhcHBlciB7DQogICAgICAtd2Via2l0LWJveC1mbGV4OiAxOw0KICAgICAgLXdlYmtpdC1mbGV4OiAxOw0KICAgICAgLW1zLWZsZXg6IDE7DQogICAgICBmbGV4OiAxOw0KICAgICAgd2lkdGg6IDQwJTsNCiAgICAgIGhlaWdodDogNDBweDsNCiAgICAgIGZsb2F0OiBsZWZ0Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZSAubnVtSW5wdXRXcmFwcGVyIHNwYW4uYXJyb3dVcDphZnRlciB7DQogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjMzkzOTM5Ow0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZSAubnVtSW5wdXRXcmFwcGVyIHNwYW4uYXJyb3dEb3duOmFmdGVyIHsNCiAgICAgIGJvcmRlci10b3AtY29sb3I6ICMzOTM5Mzk7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lLmhhc1NlY29uZHMgLm51bUlucHV0V3JhcHBlciB7DQogICAgICB3aWR0aDogMjYlOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZS50aW1lMjRociAubnVtSW5wdXRXcmFwcGVyIHsNCiAgICAgIHdpZHRoOiA0OSU7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lIGlucHV0IHsNCiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50Ow0KICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiBub25lOw0KICAgICAgYm94LXNoYWRvdzogbm9uZTsNCiAgICAgIGJvcmRlcjogMDsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDA7DQogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICBtYXJnaW46IDA7DQogICAgICBwYWRkaW5nOiAwOw0KICAgICAgaGVpZ2h0OiBpbmhlcml0Ow0KICAgICAgbGluZS1oZWlnaHQ6IGluaGVyaXQ7DQogICAgICBjb2xvcjogIzM5MzkzOTsNCiAgICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lIGlucHV0LmZsYXRwaWNrci1ob3VyIHsNCiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dC5mbGF0cGlja3ItbWludXRlLA0KICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dC5mbGF0cGlja3Itc2Vjb25kIHsNCiAgICAgIGZvbnQtd2VpZ2h0OiA0MDA7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lIGlucHV0OmZvY3VzIHsNCiAgICAgIG91dGxpbmU6IDA7DQogICAgICBib3JkZXI6IDA7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lIC5mbGF0cGlja3ItdGltZS1zZXBhcmF0b3IsDQogICAgLmZsYXRwaWNrci10aW1lIC5mbGF0cGlja3ItYW0tcG0gew0KICAgICAgaGVpZ2h0OiBpbmhlcml0Ow0KICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgZmxvYXQ6IGxlZnQ7DQogICAgICBsaW5lLWhlaWdodDogaW5oZXJpdDsNCiAgICAgIGNvbG9yOiAjMzkzOTM5Ow0KICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICB3aWR0aDogMiU7DQogICAgICAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOw0KICAgICAgLW1vei11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIC1tcy11c2VyLXNlbGVjdDogbm9uZTsNCiAgICAgIHVzZXItc2VsZWN0OiBub25lOw0KICAgICAgLXdlYmtpdC1hbGlnbi1zZWxmOiBjZW50ZXI7DQogICAgICAtbXMtZmxleC1pdGVtLWFsaWduOiBjZW50ZXI7DQogICAgICBhbGlnbi1zZWxmOiBjZW50ZXI7DQogICAgfQ0KDQogICAgLmZsYXRwaWNrci10aW1lIC5mbGF0cGlja3ItYW0tcG0gew0KICAgICAgb3V0bGluZTogMDsNCiAgICAgIHdpZHRoOiAxOCU7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICBmb250LXdlaWdodDogNDAwOw0KICAgIH0NCg0KICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dDpob3ZlciwNCiAgICAuZmxhdHBpY2tyLXRpbWUgLmZsYXRwaWNrci1hbS1wbTpob3ZlciwNCiAgICAuZmxhdHBpY2tyLXRpbWUgaW5wdXQ6Zm9jdXMsDQogICAgLmZsYXRwaWNrci10aW1lIC5mbGF0cGlja3ItYW0tcG06Zm9jdXMgew0KICAgICAgYmFja2dyb3VuZDogI2YzZjNmMzsNCiAgICB9DQoNCiAgICAuZmxhdHBpY2tyLWlucHV0W3JlYWRvbmx5XSB7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgfQ0KDQogICAgQC13ZWJraXQta2V5ZnJhbWVzIGZwRmFkZUluRG93biB7DQogICAgICBmcm9tIHsNCiAgICAgICAgb3BhY2l0eTogMDsNCiAgICAgICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIC0yMHB4LCAwKTsNCiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAtMjBweCwgMCk7DQogICAgICB9DQoNCiAgICAgIHRvIHsNCiAgICAgICAgb3BhY2l0eTogMTsNCiAgICAgICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIDAsIDApOw0KICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIDAsIDApOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIEBrZXlmcmFtZXMgZnBGYWRlSW5Eb3duIHsNCiAgICAgIGZyb20gew0KICAgICAgICBvcGFjaXR5OiAwOw0KICAgICAgICAtd2Via2l0LXRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgLTIwcHgsIDApOw0KICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIC0yMHB4LCAwKTsNCiAgICAgIH0NCg0KICAgICAgdG8gew0KICAgICAgICBvcGFjaXR5OiAxOw0KICAgICAgICAtd2Via2l0LXRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgMCwgMCk7DQogICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgMCwgMCk7DQogICAgICB9DQogICAgfQ0KICA8L3N0eWxlPg0KICA8IS0tPHNjcmlwdCBzcmM9ImphdmFzY3JpcHRzL2ZsYXRwaWNrci5qcyIgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij48L3NjcmlwdD4tLT4NCiAgPHNjcmlwdD4NCiAgLyogZmxhdHBpY2tyIHY0LjUuMCwgQGxpY2Vuc2UgTUlUICovDQooZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgew0KICAgIHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpIDoNCiAgICB0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoZmFjdG9yeSkgOg0KICAgIChnbG9iYWwuZmxhdHBpY2tyID0gZmFjdG9yeSgpKTsNCn0odGhpcywgKGZ1bmN0aW9uICgpIHsgJ3VzZSBzdHJpY3QnOw0KDQogICAgdmFyIHBhZCA9IGZ1bmN0aW9uIHBhZChudW1iZXIpIHsNCiAgICAgIHJldHVybiAoIjAiICsgbnVtYmVyKS5zbGljZSgtMik7DQogICAgfTsNCiAgICB2YXIgaW50ID0gZnVuY3Rpb24gaW50KGJvb2wpIHsNCiAgICAgIHJldHVybiBib29sID09PSB0cnVlID8gMSA6IDA7DQogICAgfTsNCiAgICBmdW5jdGlvbiBkZWJvdW5jZShmdW5jLCB3YWl0LCBpbW1lZGlhdGUpIHsNCiAgICAgIGlmIChpbW1lZGlhdGUgPT09IHZvaWQgMCkgew0KICAgICAgICBpbW1lZGlhdGUgPSBmYWxzZTsNCiAgICAgIH0NCg0KICAgICAgdmFyIHRpbWVvdXQ7DQogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMsDQogICAgICAgICAgICBhcmdzID0gYXJndW1lbnRzOw0KICAgICAgICB0aW1lb3V0ICE9PSBudWxsICYmIGNsZWFyVGltZW91dCh0aW1lb3V0KTsNCiAgICAgICAgdGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICB0aW1lb3V0ID0gbnVsbDsNCiAgICAgICAgICBpZiAoIWltbWVkaWF0ZSkgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsNCiAgICAgICAgfSwgd2FpdCk7DQogICAgICAgIGlmIChpbW1lZGlhdGUgJiYgIXRpbWVvdXQpIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7DQogICAgICB9Ow0KICAgIH0NCiAgICB2YXIgYXJyYXlpZnkgPSBmdW5jdGlvbiBhcnJheWlmeShvYmopIHsNCiAgICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBBcnJheSA/IG9iaiA6IFtvYmpdOw0KICAgIH07DQoNCiAgICB2YXIgZG9fbm90aGluZyA9IGZ1bmN0aW9uIGRvX25vdGhpbmcoKSB7DQogICAgICByZXR1cm4gdW5kZWZpbmVkOw0KICAgIH07DQoNCiAgICB2YXIgbW9udGhUb1N0ciA9IGZ1bmN0aW9uIG1vbnRoVG9TdHIobW9udGhOdW1iZXIsIHNob3J0aGFuZCwgbG9jYWxlKSB7DQogICAgICByZXR1cm4gbG9jYWxlLm1vbnRoc1tzaG9ydGhhbmQgPyAic2hvcnRoYW5kIiA6ICJsb25naGFuZCJdW21vbnRoTnVtYmVyXTsNCiAgICB9Ow0KICAgIHZhciByZXZGb3JtYXQgPSB7DQogICAgICBEOiBkb19ub3RoaW5nLA0KICAgICAgRjogZnVuY3Rpb24gRihkYXRlT2JqLCBtb250aE5hbWUsIGxvY2FsZSkgew0KICAgICAgICBkYXRlT2JqLnNldE1vbnRoKGxvY2FsZS5tb250aHMubG9uZ2hhbmQuaW5kZXhPZihtb250aE5hbWUpKTsNCiAgICAgIH0sDQogICAgICBHOiBmdW5jdGlvbiBHKGRhdGVPYmosIGhvdXIpIHsNCiAgICAgICAgZGF0ZU9iai5zZXRIb3VycyhwYXJzZUZsb2F0KGhvdXIpKTsNCiAgICAgIH0sDQogICAgICBIOiBmdW5jdGlvbiBIKGRhdGVPYmosIGhvdXIpIHsNCiAgICAgICAgZGF0ZU9iai5zZXRIb3VycyhwYXJzZUZsb2F0KGhvdXIpKTsNCiAgICAgIH0sDQogICAgICBKOiBmdW5jdGlvbiBKKGRhdGVPYmosIGRheSkgew0KICAgICAgICBkYXRlT2JqLnNldERhdGUocGFyc2VGbG9hdChkYXkpKTsNCiAgICAgIH0sDQogICAgICBLOiBmdW5jdGlvbiBLKGRhdGVPYmosIGFtUE0sIGxvY2FsZSkgew0KICAgICAgICBkYXRlT2JqLnNldEhvdXJzKGRhdGVPYmouZ2V0SG91cnMoKSAlIDEyICsgMTIgKiBpbnQobmV3IFJlZ0V4cChsb2NhbGUuYW1QTVsxXSwgImkiKS50ZXN0KGFtUE0pKSk7DQogICAgICB9LA0KICAgICAgTTogZnVuY3Rpb24gTShkYXRlT2JqLCBzaG9ydE1vbnRoLCBsb2NhbGUpIHsNCiAgICAgICAgZGF0ZU9iai5zZXRNb250aChsb2NhbGUubW9udGhzLnNob3J0aGFuZC5pbmRleE9mKHNob3J0TW9udGgpKTsNCiAgICAgIH0sDQogICAgICBTOiBmdW5jdGlvbiBTKGRhdGVPYmosIHNlY29uZHMpIHsNCiAgICAgICAgZGF0ZU9iai5zZXRTZWNvbmRzKHBhcnNlRmxvYXQoc2Vjb25kcykpOw0KICAgICAgfSwNCiAgICAgIFU6IGZ1bmN0aW9uIFUoXywgdW5peFNlY29uZHMpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHBhcnNlRmxvYXQodW5peFNlY29uZHMpICogMTAwMCk7DQogICAgICB9LA0KICAgICAgVzogZnVuY3Rpb24gVyhkYXRlT2JqLCB3ZWVrTnVtKSB7DQogICAgICAgIHZhciB3ZWVrTnVtYmVyID0gcGFyc2VJbnQod2Vla051bSk7DQogICAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlT2JqLmdldEZ1bGxZZWFyKCksIDAsIDIgKyAod2Vla051bWJlciAtIDEpICogNywgMCwgMCwgMCwgMCk7DQogICAgICB9LA0KICAgICAgWTogZnVuY3Rpb24gWShkYXRlT2JqLCB5ZWFyKSB7DQogICAgICAgIGRhdGVPYmouc2V0RnVsbFllYXIocGFyc2VGbG9hdCh5ZWFyKSk7DQogICAgICB9LA0KICAgICAgWjogZnVuY3Rpb24gWihfLCBJU09EYXRlKSB7DQogICAgICAgIHJldHVybiBuZXcgRGF0ZShJU09EYXRlKTsNCiAgICAgIH0sDQogICAgICBkOiBmdW5jdGlvbiBkKGRhdGVPYmosIGRheSkgew0KICAgICAgICBkYXRlT2JqLnNldERhdGUocGFyc2VGbG9hdChkYXkpKTsNCiAgICAgIH0sDQogICAgICBoOiBmdW5jdGlvbiBoKGRhdGVPYmosIGhvdXIpIHsNCiAgICAgICAgZGF0ZU9iai5zZXRIb3VycyhwYXJzZUZsb2F0KGhvdXIpKTsNCiAgICAgIH0sDQogICAgICBpOiBmdW5jdGlvbiBpKGRhdGVPYmosIG1pbnV0ZXMpIHsNCiAgICAgICAgZGF0ZU9iai5zZXRNaW51dGVzKHBhcnNlRmxvYXQobWludXRlcykpOw0KICAgICAgfSwNCiAgICAgIGo6IGZ1bmN0aW9uIGooZGF0ZU9iaiwgZGF5KSB7DQogICAgICAgIGRhdGVPYmouc2V0RGF0ZShwYXJzZUZsb2F0KGRheSkpOw0KICAgICAgfSwNCiAgICAgIGw6IGRvX25vdGhpbmcsDQogICAgICBtOiBmdW5jdGlvbiBtKGRhdGVPYmosIG1vbnRoKSB7DQogICAgICAgIGRhdGVPYmouc2V0TW9udGgocGFyc2VGbG9hdChtb250aCkgLSAxKTsNCiAgICAgIH0sDQogICAgICBuOiBmdW5jdGlvbiBuKGRhdGVPYmosIG1vbnRoKSB7DQogICAgICAgIGRhdGVPYmouc2V0TW9udGgocGFyc2VGbG9hdChtb250aCkgLSAxKTsNCiAgICAgIH0sDQogICAgICBzOiBmdW5jdGlvbiBzKGRhdGVPYmosIHNlY29uZHMpIHsNCiAgICAgICAgZGF0ZU9iai5zZXRTZWNvbmRzKHBhcnNlRmxvYXQoc2Vjb25kcykpOw0KICAgICAgfSwNCiAgICAgIHc6IGRvX25vdGhpbmcsDQogICAgICB5OiBmdW5jdGlvbiB5KGRhdGVPYmosIHllYXIpIHsNCiAgICAgICAgZGF0ZU9iai5zZXRGdWxsWWVhcigyMDAwICsgcGFyc2VGbG9hdCh5ZWFyKSk7DQogICAgICB9DQogICAgfTsNCiAgICB2YXIgdG9rZW5SZWdleCA9IHsNCiAgICAgIEQ6ICIoXFx3KykiLA0KICAgICAgRjogIihcXHcrKSIsDQogICAgICBHOiAiKFxcZFxcZHxcXGQpIiwNCiAgICAgIEg6ICIoXFxkXFxkfFxcZCkiLA0KICAgICAgSjogIihcXGRcXGR8XFxkKVxcdysiLA0KICAgICAgSzogIiIsDQogICAgICBNOiAiKFxcdyspIiwNCiAgICAgIFM6ICIoXFxkXFxkfFxcZCkiLA0KICAgICAgVTogIiguKykiLA0KICAgICAgVzogIihcXGRcXGR8XFxkKSIsDQogICAgICBZOiAiKFxcZHs0fSkiLA0KICAgICAgWjogIiguKykiLA0KICAgICAgZDogIihcXGRcXGR8XFxkKSIsDQogICAgICBoOiAiKFxcZFxcZHxcXGQpIiwNCiAgICAgIGk6ICIoXFxkXFxkfFxcZCkiLA0KICAgICAgajogIihcXGRcXGR8XFxkKSIsDQogICAgICBsOiAiKFxcdyspIiwNCiAgICAgIG06ICIoXFxkXFxkfFxcZCkiLA0KICAgICAgbjogIihcXGRcXGR8XFxkKSIsDQogICAgICBzOiAiKFxcZFxcZHxcXGQpIiwNCiAgICAgIHc6ICIoXFxkXFxkfFxcZCkiLA0KICAgICAgeTogIihcXGR7Mn0pIg0KICAgIH07DQogICAgdmFyIGZvcm1hdHMgPSB7DQogICAgICBaOiBmdW5jdGlvbiBaKGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIGRhdGUudG9JU09TdHJpbmcoKTsNCiAgICAgIH0sDQogICAgICBEOiBmdW5jdGlvbiBEKGRhdGUsIGxvY2FsZSwgb3B0aW9ucykgew0KICAgICAgICByZXR1cm4gbG9jYWxlLndlZWtkYXlzLnNob3J0aGFuZFtmb3JtYXRzLncoZGF0ZSwgbG9jYWxlLCBvcHRpb25zKV07DQogICAgICB9LA0KICAgICAgRjogZnVuY3Rpb24gRihkYXRlLCBsb2NhbGUsIG9wdGlvbnMpIHsNCiAgICAgICAgcmV0dXJuIG1vbnRoVG9TdHIoZm9ybWF0cy5uKGRhdGUsIGxvY2FsZSwgb3B0aW9ucykgLSAxLCBmYWxzZSwgbG9jYWxlKTsNCiAgICAgIH0sDQogICAgICBHOiBmdW5jdGlvbiBHKGRhdGUsIGxvY2FsZSwgb3B0aW9ucykgew0KICAgICAgICByZXR1cm4gcGFkKGZvcm1hdHMuaChkYXRlLCBsb2NhbGUsIG9wdGlvbnMpKTsNCiAgICAgIH0sDQogICAgICBIOiBmdW5jdGlvbiBIKGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIHBhZChkYXRlLmdldEhvdXJzKCkpOw0KICAgICAgfSwNCiAgICAgIEo6IGZ1bmN0aW9uIEooZGF0ZSwgbG9jYWxlKSB7DQogICAgICAgIHJldHVybiBsb2NhbGUub3JkaW5hbCAhPT0gdW5kZWZpbmVkID8gZGF0ZS5nZXREYXRlKCkgKyBsb2NhbGUub3JkaW5hbChkYXRlLmdldERhdGUoKSkgOiBkYXRlLmdldERhdGUoKTsNCiAgICAgIH0sDQogICAgICBLOiBmdW5jdGlvbiBLKGRhdGUsIGxvY2FsZSkgew0KICAgICAgICByZXR1cm4gbG9jYWxlLmFtUE1baW50KGRhdGUuZ2V0SG91cnMoKSA+IDExKV07DQogICAgICB9LA0KICAgICAgTTogZnVuY3Rpb24gTShkYXRlLCBsb2NhbGUpIHsNCiAgICAgICAgcmV0dXJuIG1vbnRoVG9TdHIoZGF0ZS5nZXRNb250aCgpLCB0cnVlLCBsb2NhbGUpOw0KICAgICAgfSwNCiAgICAgIFM6IGZ1bmN0aW9uIFMoZGF0ZSkgew0KICAgICAgICByZXR1cm4gcGFkKGRhdGUuZ2V0U2Vjb25kcygpKTsNCiAgICAgIH0sDQogICAgICBVOiBmdW5jdGlvbiBVKGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIGRhdGUuZ2V0VGltZSgpIC8gMTAwMDsNCiAgICAgIH0sDQogICAgICBXOiBmdW5jdGlvbiBXKGRhdGUsIF8sIG9wdGlvbnMpIHsNCiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0V2VlayhkYXRlKTsNCiAgICAgIH0sDQogICAgICBZOiBmdW5jdGlvbiBZKGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RnVsbFllYXIoKTsNCiAgICAgIH0sDQogICAgICBkOiBmdW5jdGlvbiBkKGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIHBhZChkYXRlLmdldERhdGUoKSk7DQogICAgICB9LA0KICAgICAgaDogZnVuY3Rpb24gaChkYXRlKSB7DQogICAgICAgIHJldHVybiBkYXRlLmdldEhvdXJzKCkgJSAxMiA/IGRhdGUuZ2V0SG91cnMoKSAlIDEyIDogMTI7DQogICAgICB9LA0KICAgICAgaTogZnVuY3Rpb24gaShkYXRlKSB7DQogICAgICAgIHJldHVybiBwYWQoZGF0ZS5nZXRNaW51dGVzKCkpOw0KICAgICAgfSwNCiAgICAgIGo6IGZ1bmN0aW9uIGooZGF0ZSkgew0KICAgICAgICByZXR1cm4gZGF0ZS5nZXREYXRlKCk7DQogICAgICB9LA0KICAgICAgbDogZnVuY3Rpb24gbChkYXRlLCBsb2NhbGUpIHsNCiAgICAgICAgcmV0dXJuIGxvY2FsZS53ZWVrZGF5cy5sb25naGFuZFtkYXRlLmdldERheSgpXTsNCiAgICAgIH0sDQogICAgICBtOiBmdW5jdGlvbiBtKGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIHBhZChkYXRlLmdldE1vbnRoKCkgKyAxKTsNCiAgICAgIH0sDQogICAgICBuOiBmdW5jdGlvbiBuKGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIGRhdGUuZ2V0TW9udGgoKSArIDE7DQogICAgICB9LA0KICAgICAgczogZnVuY3Rpb24gcyhkYXRlKSB7DQogICAgICAgIHJldHVybiBkYXRlLmdldFNlY29uZHMoKTsNCiAgICAgIH0sDQogICAgICB3OiBmdW5jdGlvbiB3KGRhdGUpIHsNCiAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RGF5KCk7DQogICAgICB9LA0KICAgICAgeTogZnVuY3Rpb24geShkYXRlKSB7DQogICAgICAgIHJldHVybiBTdHJpbmcoZGF0ZS5nZXRGdWxsWWVhcigpKS5zdWJzdHJpbmcoMik7DQogICAgICB9DQogICAgfTsNCg0KICAgIHZhciBlbmdsaXNoID0gew0KICAgICAgd2Vla2RheXM6IHsNCiAgICAgICAgc2hvcnRoYW5kOiBbIlN1biIsICJNb24iLCAiVHVlIiwgIldlZCIsICJUaHUiLCAiRnJpIiwgIlNhdCJdLA0KICAgICAgICBsb25naGFuZDogWyJTdW5kYXkiLCAiTW9uZGF5IiwgIlR1ZXNkYXkiLCAiV2VkbmVzZGF5IiwgIlRodXJzZGF5IiwgIkZyaWRheSIsICJTYXR1cmRheSJdDQogICAgICB9LA0KICAgICAgbW9udGhzOiB7DQogICAgICAgIHNob3J0aGFuZDogWyJKYW4iLCAiRmViIiwgIk1hciIsICJBcHIiLCAiTWF5IiwgIkp1biIsICJKdWwiLCAiQXVnIiwgIlNlcCIsICJPY3QiLCAiTm92IiwgIkRlYyJdLA0KICAgICAgICBsb25naGFuZDogWyJKYW51YXJ5IiwgIkZlYnJ1YXJ5IiwgIk1hcmNoIiwgIkFwcmlsIiwgIk1heSIsICJKdW5lIiwgIkp1bHkiLCAiQXVndXN0IiwgIlNlcHRlbWJlciIsICJPY3RvYmVyIiwgIk5vdmVtYmVyIiwgIkRlY2VtYmVyIl0NCiAgICAgIH0sDQogICAgICBkYXlzSW5Nb250aDogWzMxLCAyOCwgMzEsIDMwLCAzMSwgMzAsIDMxLCAzMSwgMzAsIDMxLCAzMCwgMzFdLA0KICAgICAgZmlyc3REYXlPZldlZWs6IDAsDQogICAgICBvcmRpbmFsOiBmdW5jdGlvbiBvcmRpbmFsKG50aCkgew0KICAgICAgICB2YXIgcyA9IG50aCAlIDEwMDsNCiAgICAgICAgaWYgKHMgPiAzICYmIHMgPCAyMSkgcmV0dXJuICJ0aCI7DQoNCiAgICAgICAgc3dpdGNoIChzICUgMTApIHsNCiAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICByZXR1cm4gInN0IjsNCg0KICAgICAgICAgIGNhc2UgMjoNCiAgICAgICAgICAgIHJldHVybiAibmQiOw0KDQogICAgICAgICAgY2FzZSAzOg0KICAgICAgICAgICAgcmV0dXJuICJyZCI7DQoNCiAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgcmV0dXJuICJ0aCI7DQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICByYW5nZVNlcGFyYXRvcjogIiB0byAiLA0KICAgICAgd2Vla0FiYnJldmlhdGlvbjogIldrIiwNCiAgICAgIHNjcm9sbFRpdGxlOiAiU2Nyb2xsIHRvIGluY3JlbWVudCIsDQogICAgICB0b2dnbGVUaXRsZTogIkNsaWNrIHRvIHRvZ2dsZSIsDQogICAgICBhbVBNOiBbIkFNIiwgIlBNIl0sDQogICAgICB5ZWFyQXJpYUxhYmVsOiAiWWVhciINCiAgICB9Ow0KDQogICAgdmFyIGNyZWF0ZURhdGVGb3JtYXR0ZXIgPSBmdW5jdGlvbiBjcmVhdGVEYXRlRm9ybWF0dGVyKF9yZWYpIHsNCiAgICAgIHZhciBfcmVmJGNvbmZpZyA9IF9yZWYuY29uZmlnLA0KICAgICAgICAgIGNvbmZpZyA9IF9yZWYkY29uZmlnID09PSB2b2lkIDAgPyBkZWZhdWx0cyA6IF9yZWYkY29uZmlnLA0KICAgICAgICAgIF9yZWYkbDEwbiA9IF9yZWYubDEwbiwNCiAgICAgICAgICBsMTBuID0gX3JlZiRsMTBuID09PSB2b2lkIDAgPyBlbmdsaXNoIDogX3JlZiRsMTBuOw0KICAgICAgcmV0dXJuIGZ1bmN0aW9uIChkYXRlT2JqLCBmcm10LCBvdmVycmlkZUxvY2FsZSkgew0KICAgICAgICBpZiAoY29uZmlnLmZvcm1hdERhdGUgIT09IHVuZGVmaW5lZCkgcmV0dXJuIGNvbmZpZy5mb3JtYXREYXRlKGRhdGVPYmosIGZybXQpOw0KICAgICAgICB2YXIgbG9jYWxlID0gb3ZlcnJpZGVMb2NhbGUgfHwgbDEwbjsNCiAgICAgICAgcmV0dXJuIGZybXQuc3BsaXQoIiIpLm1hcChmdW5jdGlvbiAoYywgaSwgYXJyKSB7DQogICAgICAgICAgcmV0dXJuIGZvcm1hdHNbY10gJiYgYXJyW2kgLSAxXSAhPT0gIlxcIiA/IGZvcm1hdHNbY10oZGF0ZU9iaiwgbG9jYWxlLCBjb25maWcpIDogYyAhPT0gIlxcIiA/IGMgOiAiIjsNCiAgICAgICAgfSkuam9pbigiIik7DQogICAgICB9Ow0KICAgIH07DQogICAgdmFyIGNyZWF0ZURhdGVQYXJzZXIgPSBmdW5jdGlvbiBjcmVhdGVEYXRlUGFyc2VyKF9yZWYyKSB7DQogICAgICB2YXIgX3JlZjIkY29uZmlnID0gX3JlZjIuY29uZmlnLA0KICAgICAgICAgIGNvbmZpZyA9IF9yZWYyJGNvbmZpZyA9PT0gdm9pZCAwID8gZGVmYXVsdHMgOiBfcmVmMiRjb25maWcsDQogICAgICAgICAgX3JlZjIkbDEwbiA9IF9yZWYyLmwxMG4sDQogICAgICAgICAgbDEwbiA9IF9yZWYyJGwxMG4gPT09IHZvaWQgMCA/IGVuZ2xpc2ggOiBfcmVmMiRsMTBuOw0KICAgICAgcmV0dXJuIGZ1bmN0aW9uIChkYXRlLCBnaXZlbkZvcm1hdCwgdGltZWxlc3MpIHsNCiAgICAgICAgaWYgKGRhdGUgIT09IDAgJiYgIWRhdGUpIHJldHVybiB1bmRlZmluZWQ7DQogICAgICAgIHZhciBwYXJzZWREYXRlOw0KICAgICAgICB2YXIgZGF0ZV9vcmlnID0gZGF0ZTsNCiAgICAgICAgaWYgKGRhdGUgaW5zdGFuY2VvZiBEYXRlKSBwYXJzZWREYXRlID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO2Vsc2UgaWYgKHR5cGVvZiBkYXRlICE9PSAic3RyaW5nIiAmJiBkYXRlLnRvRml4ZWQgIT09IHVuZGVmaW5lZCkgcGFyc2VkRGF0ZSA9IG5ldyBEYXRlKGRhdGUpO2Vsc2UgaWYgKHR5cGVvZiBkYXRlID09PSAic3RyaW5nIikgew0KICAgICAgICAgIHZhciBmb3JtYXQgPSBnaXZlbkZvcm1hdCB8fCAoY29uZmlnIHx8IGRlZmF1bHRzKS5kYXRlRm9ybWF0Ow0KICAgICAgICAgIHZhciBkYXRlc3RyID0gU3RyaW5nKGRhdGUpLnRyaW0oKTsNCg0KICAgICAgICAgIGlmIChkYXRlc3RyID09PSAidG9kYXkiKSB7DQogICAgICAgICAgICBwYXJzZWREYXRlID0gbmV3IERhdGUoKTsNCiAgICAgICAgICAgIHRpbWVsZXNzID0gdHJ1ZTsNCiAgICAgICAgICB9IGVsc2UgaWYgKC9aJC8udGVzdChkYXRlc3RyKSB8fCAvR01UJC8udGVzdChkYXRlc3RyKSkgcGFyc2VkRGF0ZSA9IG5ldyBEYXRlKGRhdGUpO2Vsc2UgaWYgKGNvbmZpZyAmJiBjb25maWcucGFyc2VEYXRlKSBwYXJzZWREYXRlID0gY29uZmlnLnBhcnNlRGF0ZShkYXRlLCBmb3JtYXQpO2Vsc2Ugew0KICAgICAgICAgICAgcGFyc2VkRGF0ZSA9ICFjb25maWcgfHwgIWNvbmZpZy5ub0NhbGVuZGFyID8gbmV3IERhdGUobmV3IERhdGUoKS5nZXRGdWxsWWVhcigpLCAwLCAxLCAwLCAwLCAwLCAwKSA6IG5ldyBEYXRlKG5ldyBEYXRlKCkuc2V0SG91cnMoMCwgMCwgMCwgMCkpOw0KICAgICAgICAgICAgdmFyIG1hdGNoZWQsDQogICAgICAgICAgICAgICAgb3BzID0gW107DQoNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBtYXRjaEluZGV4ID0gMCwgcmVnZXhTdHIgPSAiIjsgaSA8IGZvcm1hdC5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICB2YXIgdG9rZW4gPSBmb3JtYXRbaV07DQogICAgICAgICAgICAgIHZhciBpc0JhY2tTbGFzaCA9IHRva2VuID09PSAiXFwiOw0KICAgICAgICAgICAgICB2YXIgZXNjYXBlZCA9IGZvcm1hdFtpIC0gMV0gPT09ICJcXCIgfHwgaXNCYWNrU2xhc2g7DQoNCiAgICAgICAgICAgICAgaWYgKHRva2VuUmVnZXhbdG9rZW5dICYmICFlc2NhcGVkKSB7DQogICAgICAgICAgICAgICAgcmVnZXhTdHIgKz0gdG9rZW5SZWdleFt0b2tlbl07DQogICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gbmV3IFJlZ0V4cChyZWdleFN0cikuZXhlYyhkYXRlKTsNCg0KICAgICAgICAgICAgICAgIGlmIChtYXRjaCAmJiAobWF0Y2hlZCA9IHRydWUpKSB7DQogICAgICAgICAgICAgICAgICBvcHNbdG9rZW4gIT09ICJZIiA/ICJwdXNoIiA6ICJ1bnNoaWZ0Il0oew0KICAgICAgICAgICAgICAgICAgICBmbjogcmV2Rm9ybWF0W3Rva2VuXSwNCiAgICAgICAgICAgICAgICAgICAgdmFsOiBtYXRjaFsrK21hdGNoSW5kZXhdDQogICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzQmFja1NsYXNoKSByZWdleFN0ciArPSAiLiI7DQoNCiAgICAgICAgICAgICAgb3BzLmZvckVhY2goZnVuY3Rpb24gKF9yZWYzKSB7DQogICAgICAgICAgICAgICAgdmFyIGZuID0gX3JlZjMuZm4sDQogICAgICAgICAgICAgICAgICAgIHZhbCA9IF9yZWYzLnZhbDsNCiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VkRGF0ZSA9IGZuKHBhcnNlZERhdGUsIHZhbCwgbDEwbikgfHwgcGFyc2VkRGF0ZTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHBhcnNlZERhdGUgPSBtYXRjaGVkID8gcGFyc2VkRGF0ZSA6IHVuZGVmaW5lZDsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIShwYXJzZWREYXRlIGluc3RhbmNlb2YgRGF0ZSAmJiAhaXNOYU4ocGFyc2VkRGF0ZS5nZXRUaW1lKCkpKSkgew0KICAgICAgICAgIGNvbmZpZy5lcnJvckhhbmRsZXIobmV3IEVycm9yKCJJbnZhbGlkIGRhdGUgcHJvdmlkZWQ6ICIgKyBkYXRlX29yaWcpKTsNCiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHRpbWVsZXNzID09PSB0cnVlKSBwYXJzZWREYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApOw0KICAgICAgICByZXR1cm4gcGFyc2VkRGF0ZTsNCiAgICAgIH07DQogICAgfTsNCiAgICBmdW5jdGlvbiBjb21wYXJlRGF0ZXMoZGF0ZTEsIGRhdGUyLCB0aW1lbGVzcykgew0KICAgICAgaWYgKHRpbWVsZXNzID09PSB2b2lkIDApIHsNCiAgICAgICAgdGltZWxlc3MgPSB0cnVlOw0KICAgICAgfQ0KDQogICAgICBpZiAodGltZWxlc3MgIT09IGZhbHNlKSB7DQogICAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlMS5nZXRUaW1lKCkpLnNldEhvdXJzKDAsIDAsIDAsIDApIC0gbmV3IERhdGUoZGF0ZTIuZ2V0VGltZSgpKS5zZXRIb3VycygwLCAwLCAwLCAwKTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIGRhdGUxLmdldFRpbWUoKSAtIGRhdGUyLmdldFRpbWUoKTsNCiAgICB9DQogICAgdmFyIGdldFdlZWsgPSBmdW5jdGlvbiBnZXRXZWVrKGdpdmVuRGF0ZSkgew0KICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShnaXZlbkRhdGUuZ2V0VGltZSgpKTsNCiAgICAgIGRhdGUuc2V0SG91cnMoMCwgMCwgMCwgMCk7DQogICAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyAzIC0gKGRhdGUuZ2V0RGF5KCkgKyA2KSAlIDcpOw0KICAgICAgdmFyIHdlZWsxID0gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCAwLCA0KTsNCiAgICAgIHJldHVybiAxICsgTWF0aC5yb3VuZCgoKGRhdGUuZ2V0VGltZSgpIC0gd2VlazEuZ2V0VGltZSgpKSAvIDg2NDAwMDAwIC0gMyArICh3ZWVrMS5nZXREYXkoKSArIDYpICUgNykgLyA3KTsNCiAgICB9Ow0KICAgIHZhciBpc0JldHdlZW4gPSBmdW5jdGlvbiBpc0JldHdlZW4odHMsIHRzMSwgdHMyKSB7DQogICAgICByZXR1cm4gdHMgPiBNYXRoLm1pbih0czEsIHRzMikgJiYgdHMgPCBNYXRoLm1heCh0czEsIHRzMik7DQogICAgfTsNCiAgICB2YXIgZHVyYXRpb24gPSB7DQogICAgICBEQVk6IDg2NDAwMDAwDQogICAgfTsNCg0KICAgIHZhciBkZWZhdWx0cyA9IHsNCiAgICAgIF9kaXNhYmxlOiBbXSwNCiAgICAgIF9lbmFibGU6IFtdLA0KICAgICAgYWxsb3dJbnB1dDogZmFsc2UsDQogICAgICBhbHRGb3JtYXQ6ICJGIGosIFkiLA0KICAgICAgYWx0SW5wdXQ6IGZhbHNlLA0KICAgICAgYWx0SW5wdXRDbGFzczogImZvcm0tY29udHJvbCBpbnB1dCIsDQogICAgICBhbmltYXRlOiB0eXBlb2Ygd2luZG93ID09PSAib2JqZWN0IiAmJiB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIikgPT09IC0xLA0KICAgICAgYXJpYURhdGVGb3JtYXQ6ICJGIGosIFkiLA0KICAgICAgY2xpY2tPcGVuczogdHJ1ZSwNCiAgICAgIGNsb3NlT25TZWxlY3Q6IHRydWUsDQogICAgICBjb25qdW5jdGlvbjogIiwgIiwNCiAgICAgIGRhdGVGb3JtYXQ6ICJZLW0tZCIsDQogICAgICBkZWZhdWx0SG91cjogMTIsDQogICAgICBkZWZhdWx0TWludXRlOiAwLA0KICAgICAgZGVmYXVsdFNlY29uZHM6IDAsDQogICAgICBkaXNhYmxlOiBbXSwNCiAgICAgIGRpc2FibGVNb2JpbGU6IGZhbHNlLA0KICAgICAgZW5hYmxlOiBbXSwNCiAgICAgIGVuYWJsZVNlY29uZHM6IGZhbHNlLA0KICAgICAgZW5hYmxlVGltZTogZmFsc2UsDQogICAgICBlcnJvckhhbmRsZXI6IGZ1bmN0aW9uIGVycm9ySGFuZGxlcihlcnIpIHsNCiAgICAgICAgcmV0dXJuIHR5cGVvZiBjb25zb2xlICE9PSAidW5kZWZpbmVkIiAmJiBjb25zb2xlLndhcm4oZXJyKTsNCiAgICAgIH0sDQogICAgICBnZXRXZWVrOiBnZXRXZWVrLA0KICAgICAgaG91ckluY3JlbWVudDogMSwNCiAgICAgIGlnbm9yZWRGb2N1c0VsZW1lbnRzOiBbXSwNCiAgICAgIGlubGluZTogZmFsc2UsDQogICAgICBsb2NhbGU6ICJkZWZhdWx0IiwNCiAgICAgIG1pbnV0ZUluY3JlbWVudDogNSwNCiAgICAgIG1vZGU6ICJzaW5nbGUiLA0KICAgICAgbmV4dEFycm93OiAiPHN2ZyB2ZXJzaW9uPScxLjEnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycgeG1sbnM6eGxpbms9J2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnIHZpZXdCb3g9JzAgMCAxNyAxNyc+PGc+PC9nPjxwYXRoIGQ9J00xMy4yMDcgOC40NzJsLTcuODU0IDcuODU0LTAuNzA3LTAuNzA3IDcuMTQ2LTcuMTQ2LTcuMTQ2LTcuMTQ4IDAuNzA3LTAuNzA3IDcuODU0IDcuODU0eicgLz48L3N2Zz4iLA0KICAgICAgbm9DYWxlbmRhcjogZmFsc2UsDQogICAgICBub3c6IG5ldyBEYXRlKCksDQogICAgICBvbkNoYW5nZTogW10sDQogICAgICBvbkNsb3NlOiBbXSwNCiAgICAgIG9uRGF5Q3JlYXRlOiBbXSwNCiAgICAgIG9uRGVzdHJveTogW10sDQogICAgICBvbktleURvd246IFtdLA0KICAgICAgb25Nb250aENoYW5nZTogW10sDQogICAgICBvbk9wZW46IFtdLA0KICAgICAgb25QYXJzZUNvbmZpZzogW10sDQogICAgICBvblJlYWR5OiBbXSwNCiAgICAgIG9uVmFsdWVVcGRhdGU6IFtdLA0KICAgICAgb25ZZWFyQ2hhbmdlOiBbXSwNCiAgICAgIG9uUHJlQ2FsZW5kYXJQb3NpdGlvbjogW10sDQogICAgICBwbHVnaW5zOiBbXSwNCiAgICAgIHBvc2l0aW9uOiAiYXV0byIsDQogICAgICBwb3NpdGlvbkVsZW1lbnQ6IHVuZGVmaW5lZCwNCiAgICAgIHByZXZBcnJvdzogIjxzdmcgdmVyc2lvbj0nMS4xJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHhtbG5zOnhsaW5rPSdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJyB2aWV3Qm94PScwIDAgMTcgMTcnPjxnPjwvZz48cGF0aCBkPSdNNS4yMDcgOC40NzFsNy4xNDYgNy4xNDctMC43MDcgMC43MDctNy44NTMtNy44NTQgNy44NTQtNy44NTMgMC43MDcgMC43MDctNy4xNDcgNy4xNDZ6JyAvPjwvc3ZnPiIsDQogICAgICBzaG9ydGhhbmRDdXJyZW50TW9udGg6IGZhbHNlLA0KICAgICAgc2hvd01vbnRoczogMSwNCiAgICAgIHN0YXRpYzogZmFsc2UsDQogICAgICB0aW1lXzI0aHI6IGZhbHNlLA0KICAgICAgd2Vla051bWJlcnM6IGZhbHNlLA0KICAgICAgd3JhcDogZmFsc2UNCiAgICB9Ow0KDQogICAgZnVuY3Rpb24gdG9nZ2xlQ2xhc3MoZWxlbSwgY2xhc3NOYW1lLCBib29sKSB7DQogICAgICBpZiAoYm9vbCA9PT0gdHJ1ZSkgcmV0dXJuIGVsZW0uY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpOw0KICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7DQogICAgfQ0KICAgIGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQodGFnLCBjbGFzc05hbWUsIGNvbnRlbnQpIHsNCiAgICAgIHZhciBlID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTsNCiAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZSB8fCAiIjsNCiAgICAgIGNvbnRlbnQgPSBjb250ZW50IHx8ICIiOw0KICAgICAgZS5jbGFzc05hbWUgPSBjbGFzc05hbWU7DQogICAgICBpZiAoY29udGVudCAhPT0gdW5kZWZpbmVkKSBlLnRleHRDb250ZW50ID0gY29udGVudDsNCiAgICAgIHJldHVybiBlOw0KICAgIH0NCiAgICBmdW5jdGlvbiBjbGVhck5vZGUobm9kZSkgew0KICAgICAgd2hpbGUgKG5vZGUuZmlyc3RDaGlsZCkgew0KICAgICAgICBub2RlLnJlbW92ZUNoaWxkKG5vZGUuZmlyc3RDaGlsZCk7DQogICAgICB9DQogICAgfQ0KICAgIGZ1bmN0aW9uIGZpbmRQYXJlbnQobm9kZSwgY29uZGl0aW9uKSB7DQogICAgICBpZiAoY29uZGl0aW9uKG5vZGUpKSByZXR1cm4gbm9kZTtlbHNlIGlmIChub2RlLnBhcmVudE5vZGUpIHJldHVybiBmaW5kUGFyZW50KG5vZGUucGFyZW50Tm9kZSwgY29uZGl0aW9uKTsNCiAgICAgIHJldHVybiB1bmRlZmluZWQ7DQogICAgfQ0KICAgIGZ1bmN0aW9uIGNyZWF0ZU51bWJlcklucHV0KGlucHV0Q2xhc3NOYW1lLCBvcHRzKSB7DQogICAgICB2YXIgd3JhcHBlciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJudW1JbnB1dFdyYXBwZXIiKSwNCiAgICAgICAgICBudW1JbnB1dCA9IGNyZWF0ZUVsZW1lbnQoImlucHV0IiwgIm51bUlucHV0ICIgKyBpbnB1dENsYXNzTmFtZSksDQogICAgICAgICAgYXJyb3dVcCA9IGNyZWF0ZUVsZW1lbnQoInNwYW4iLCAiYXJyb3dVcCIpLA0KICAgICAgICAgIGFycm93RG93biA9IGNyZWF0ZUVsZW1lbnQoInNwYW4iLCAiYXJyb3dEb3duIik7DQogICAgICBudW1JbnB1dC50eXBlID0gInRleHQiOw0KICAgICAgbnVtSW5wdXQucGF0dGVybiA9ICJcXGQqIjsNCiAgICAgIGlmIChvcHRzICE9PSB1bmRlZmluZWQpIGZvciAodmFyIGtleSBpbiBvcHRzKSB7DQogICAgICAgIG51bUlucHV0LnNldEF0dHJpYnV0ZShrZXksIG9wdHNba2V5XSk7DQogICAgICB9DQogICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKG51bUlucHV0KTsNCiAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoYXJyb3dVcCk7DQogICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKGFycm93RG93bik7DQogICAgICByZXR1cm4gd3JhcHBlcjsNCiAgICB9DQoNCiAgICBpZiAodHlwZW9mIE9iamVjdC5hc3NpZ24gIT09ICJmdW5jdGlvbiIpIHsNCiAgICAgIE9iamVjdC5hc3NpZ24gPSBmdW5jdGlvbiAodGFyZ2V0KSB7DQogICAgICAgIGlmICghdGFyZ2V0KSB7DQogICAgICAgICAgdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgY29udmVydCB1bmRlZmluZWQgb3IgbnVsbCB0byBvYmplY3QiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsNCiAgICAgICAgICBhcmdzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKCkgew0KICAgICAgICAgIHZhciBzb3VyY2UgPSBhcmdzW19pXTsNCg0KICAgICAgICAgIGlmIChzb3VyY2UpIHsNCiAgICAgICAgICAgIE9iamVjdC5rZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7DQogICAgICAgICAgICAgIHJldHVybiB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmdzLmxlbmd0aDsgX2krKykgew0KICAgICAgICAgIF9sb29wKCk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gdGFyZ2V0Ow0KICAgICAgfTsNCiAgICB9DQoNCiAgICB2YXIgREVCT1VOQ0VEX0NIQU5HRV9NUyA9IDMwMDsNCg0KICAgIGZ1bmN0aW9uIEZsYXRwaWNrckluc3RhbmNlKGVsZW1lbnQsIGluc3RhbmNlQ29uZmlnKSB7DQogICAgICB2YXIgc2VsZiA9IHsNCiAgICAgICAgY29uZmlnOiBPYmplY3QuYXNzaWduKHt9LCBmbGF0cGlja3IuZGVmYXVsdENvbmZpZyksDQogICAgICAgIGwxMG46IGVuZ2xpc2gNCiAgICAgIH07DQogICAgICBzZWxmLnBhcnNlRGF0ZSA9IGNyZWF0ZURhdGVQYXJzZXIoew0KICAgICAgICBjb25maWc6IHNlbGYuY29uZmlnLA0KICAgICAgICBsMTBuOiBzZWxmLmwxMG4NCiAgICAgIH0pOw0KICAgICAgc2VsZi5faGFuZGxlcnMgPSBbXTsNCiAgICAgIHNlbGYuX2JpbmQgPSBiaW5kOw0KICAgICAgc2VsZi5fc2V0SG91cnNGcm9tRGF0ZSA9IHNldEhvdXJzRnJvbURhdGU7DQogICAgICBzZWxmLl9wb3NpdGlvbkNhbGVuZGFyID0gcG9zaXRpb25DYWxlbmRhcjsNCiAgICAgIHNlbGYuY2hhbmdlTW9udGggPSBjaGFuZ2VNb250aDsNCiAgICAgIHNlbGYuY2hhbmdlWWVhciA9IGNoYW5nZVllYXI7DQogICAgICBzZWxmLmNsZWFyID0gY2xlYXI7DQogICAgICBzZWxmLmNsb3NlID0gY2xvc2U7DQogICAgICBzZWxmLl9jcmVhdGVFbGVtZW50ID0gY3JlYXRlRWxlbWVudDsNCiAgICAgIHNlbGYuZGVzdHJveSA9IGRlc3Ryb3k7DQogICAgICBzZWxmLmlzRW5hYmxlZCA9IGlzRW5hYmxlZDsNCiAgICAgIHNlbGYuanVtcFRvRGF0ZSA9IGp1bXBUb0RhdGU7DQogICAgICBzZWxmLm9wZW4gPSBvcGVuOw0KICAgICAgc2VsZi5yZWRyYXcgPSByZWRyYXc7DQogICAgICBzZWxmLnNldCA9IHNldDsNCiAgICAgIHNlbGYuc2V0RGF0ZSA9IHNldERhdGU7DQogICAgICBzZWxmLnRvZ2dsZSA9IHRvZ2dsZTsNCg0KICAgICAgZnVuY3Rpb24gc2V0dXBIZWxwZXJGdW5jdGlvbnMoKSB7DQogICAgICAgIHNlbGYudXRpbHMgPSB7DQogICAgICAgICAgZ2V0RGF5c0luTW9udGg6IGZ1bmN0aW9uIGdldERheXNJbk1vbnRoKG1vbnRoLCB5cikgew0KICAgICAgICAgICAgaWYgKG1vbnRoID09PSB2b2lkIDApIHsNCiAgICAgICAgICAgICAgbW9udGggPSBzZWxmLmN1cnJlbnRNb250aDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHlyID09PSB2b2lkIDApIHsNCiAgICAgICAgICAgICAgeXIgPSBzZWxmLmN1cnJlbnRZZWFyOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAobW9udGggPT09IDEgJiYgKHlyICUgNCA9PT0gMCAmJiB5ciAlIDEwMCAhPT0gMCB8fCB5ciAlIDQwMCA9PT0gMCkpIHJldHVybiAyOTsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLmwxMG4uZGF5c0luTW9udGhbbW9udGhdOw0KICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gaW5pdCgpIHsNCiAgICAgICAgc2VsZi5lbGVtZW50ID0gc2VsZi5pbnB1dCA9IGVsZW1lbnQ7DQogICAgICAgIHNlbGYuaXNPcGVuID0gZmFsc2U7DQogICAgICAgIHBhcnNlQ29uZmlnKCk7DQogICAgICAgIHNldHVwTG9jYWxlKCk7DQogICAgICAgIHNldHVwSW5wdXRzKCk7DQogICAgICAgIHNldHVwRGF0ZXMoKTsNCiAgICAgICAgc2V0dXBIZWxwZXJGdW5jdGlvbnMoKTsNCiAgICAgICAgaWYgKCFzZWxmLmlzTW9iaWxlKSBidWlsZCgpOw0KICAgICAgICBiaW5kRXZlbnRzKCk7DQoNCiAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggfHwgc2VsZi5jb25maWcubm9DYWxlbmRhcikgew0KICAgICAgICAgIGlmIChzZWxmLmNvbmZpZy5lbmFibGVUaW1lKSB7DQogICAgICAgICAgICBzZXRIb3Vyc0Zyb21EYXRlKHNlbGYuY29uZmlnLm5vQ2FsZW5kYXIgPyBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiB8fCBzZWxmLmNvbmZpZy5taW5EYXRlIDogdW5kZWZpbmVkKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICB1cGRhdGVWYWx1ZShmYWxzZSk7DQogICAgICAgIH0NCg0KICAgICAgICBzZXRDYWxlbmRhcldpZHRoKCk7DQogICAgICAgIHNlbGYuc2hvd1RpbWVJbnB1dCA9IHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPiAwIHx8IHNlbGYuY29uZmlnLm5vQ2FsZW5kYXI7DQogICAgICAgIHZhciBpc1NhZmFyaSA9IC9eKCg/IWNocm9tZXxhbmRyb2lkKS4pKnNhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7DQoNCiAgICAgICAgaWYgKCFzZWxmLmlzTW9iaWxlICYmIGlzU2FmYXJpKSB7DQogICAgICAgICAgcG9zaXRpb25DYWxlbmRhcigpOw0KICAgICAgICB9DQoNCiAgICAgICAgdHJpZ2dlckV2ZW50KCJvblJlYWR5Iik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGJpbmRUb0luc3RhbmNlKGZuKSB7DQogICAgICAgIHJldHVybiBmbi5iaW5kKHNlbGYpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzZXRDYWxlbmRhcldpZHRoKCkgew0KICAgICAgICB2YXIgY29uZmlnID0gc2VsZi5jb25maWc7DQogICAgICAgIGlmIChjb25maWcud2Vla051bWJlcnMgPT09IGZhbHNlICYmIGNvbmZpZy5zaG93TW9udGhzID09PSAxKSByZXR1cm47ZWxzZSBpZiAoY29uZmlnLm5vQ2FsZW5kYXIgIT09IHRydWUpIHsNCiAgICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOw0KICAgICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCg0KICAgICAgICAgICAgaWYgKHNlbGYuZGF5c0NvbnRhaW5lciAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgIHZhciBkYXlzV2lkdGggPSAoc2VsZi5kYXlzLm9mZnNldFdpZHRoICsgMSkgKiBjb25maWcuc2hvd01vbnRoczsNCiAgICAgICAgICAgICAgc2VsZi5kYXlzQ29udGFpbmVyLnN0eWxlLndpZHRoID0gZGF5c1dpZHRoICsgInB4IjsNCiAgICAgICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS53aWR0aCA9IGRheXNXaWR0aCArIChzZWxmLndlZWtXcmFwcGVyICE9PSB1bmRlZmluZWQgPyBzZWxmLndlZWtXcmFwcGVyLm9mZnNldFdpZHRoIDogMCkgKyAicHgiOw0KICAgICAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLnJlbW92ZVByb3BlcnR5KCJ2aXNpYmlsaXR5Iik7DQogICAgICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuc3R5bGUucmVtb3ZlUHJvcGVydHkoImRpc3BsYXkiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiB1cGRhdGVUaW1lKGUpIHsNCiAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPT09IDApIHJldHVybjsNCiAgICAgICAgaWYgKGUgIT09IHVuZGVmaW5lZCAmJiBlLnR5cGUgIT09ICJibHVyIikgdGltZVdyYXBwZXIoZSk7DQogICAgICAgIHNldEhvdXJzRnJvbUlucHV0cygpOw0KICAgICAgICB1cGRhdGVWYWx1ZSgpOw0KDQogICAgICAgIHNlbGYuX2RlYm91bmNlZENoYW5nZSgpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBhbXBtMm1pbGl0YXJ5KGhvdXIsIGFtUE0pIHsNCiAgICAgICAgcmV0dXJuIGhvdXIgJSAxMiArIDEyICogaW50KGFtUE0gPT09IHNlbGYubDEwbi5hbVBNWzFdKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gbWlsaXRhcnkyYW1wbShob3VyKSB7DQogICAgICAgIHN3aXRjaCAoaG91ciAlIDI0KSB7DQogICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgIGNhc2UgMTI6DQogICAgICAgICAgICByZXR1cm4gMTI7DQoNCiAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgcmV0dXJuIGhvdXIgJSAxMjsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzZXRIb3Vyc0Zyb21JbnB1dHMoKSB7DQogICAgICAgIGlmIChzZWxmLmhvdXJFbGVtZW50ID09PSB1bmRlZmluZWQgfHwgc2VsZi5taW51dGVFbGVtZW50ID09PSB1bmRlZmluZWQpIHJldHVybjsNCiAgICAgICAgdmFyIGhvdXJzID0gKHBhcnNlSW50KHNlbGYuaG91ckVsZW1lbnQudmFsdWUuc2xpY2UoLTIpLCAxMCkgfHwgMCkgJSAyNCwNCiAgICAgICAgICAgIG1pbnV0ZXMgPSAocGFyc2VJbnQoc2VsZi5taW51dGVFbGVtZW50LnZhbHVlLCAxMCkgfHwgMCkgJSA2MCwNCiAgICAgICAgICAgIHNlY29uZHMgPSBzZWxmLnNlY29uZEVsZW1lbnQgIT09IHVuZGVmaW5lZCA/IChwYXJzZUludChzZWxmLnNlY29uZEVsZW1lbnQudmFsdWUsIDEwKSB8fCAwKSAlIDYwIDogMDsNCg0KICAgICAgICBpZiAoc2VsZi5hbVBNICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICBob3VycyA9IGFtcG0ybWlsaXRhcnkoaG91cnMsIHNlbGYuYW1QTS50ZXh0Q29udGVudCk7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgbGltaXRNaW5Ib3VycyA9IHNlbGYuY29uZmlnLm1pblRpbWUgIT09IHVuZGVmaW5lZCB8fCBzZWxmLmNvbmZpZy5taW5EYXRlICYmIHNlbGYubWluRGF0ZUhhc1RpbWUgJiYgc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogJiYgY29tcGFyZURhdGVzKHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqLCBzZWxmLmNvbmZpZy5taW5EYXRlLCB0cnVlKSA9PT0gMDsNCiAgICAgICAgdmFyIGxpbWl0TWF4SG91cnMgPSBzZWxmLmNvbmZpZy5tYXhUaW1lICE9PSB1bmRlZmluZWQgfHwgc2VsZi5jb25maWcubWF4RGF0ZSAmJiBzZWxmLm1heERhdGVIYXNUaW1lICYmIHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqICYmIGNvbXBhcmVEYXRlcyhzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiwgc2VsZi5jb25maWcubWF4RGF0ZSwgdHJ1ZSkgPT09IDA7DQoNCiAgICAgICAgaWYgKGxpbWl0TWF4SG91cnMpIHsNCiAgICAgICAgICB2YXIgbWF4VGltZSA9IHNlbGYuY29uZmlnLm1heFRpbWUgIT09IHVuZGVmaW5lZCA/IHNlbGYuY29uZmlnLm1heFRpbWUgOiBzZWxmLmNvbmZpZy5tYXhEYXRlOw0KICAgICAgICAgIGhvdXJzID0gTWF0aC5taW4oaG91cnMsIG1heFRpbWUuZ2V0SG91cnMoKSk7DQogICAgICAgICAgaWYgKGhvdXJzID09PSBtYXhUaW1lLmdldEhvdXJzKCkpIG1pbnV0ZXMgPSBNYXRoLm1pbihtaW51dGVzLCBtYXhUaW1lLmdldE1pbnV0ZXMoKSk7DQogICAgICAgICAgaWYgKG1pbnV0ZXMgPT09IG1heFRpbWUuZ2V0TWludXRlcygpKSBzZWNvbmRzID0gTWF0aC5taW4oc2Vjb25kcywgbWF4VGltZS5nZXRTZWNvbmRzKCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGxpbWl0TWluSG91cnMpIHsNCiAgICAgICAgICB2YXIgbWluVGltZSA9IHNlbGYuY29uZmlnLm1pblRpbWUgIT09IHVuZGVmaW5lZCA/IHNlbGYuY29uZmlnLm1pblRpbWUgOiBzZWxmLmNvbmZpZy5taW5EYXRlOw0KICAgICAgICAgIGhvdXJzID0gTWF0aC5tYXgoaG91cnMsIG1pblRpbWUuZ2V0SG91cnMoKSk7DQogICAgICAgICAgaWYgKGhvdXJzID09PSBtaW5UaW1lLmdldEhvdXJzKCkpIG1pbnV0ZXMgPSBNYXRoLm1heChtaW51dGVzLCBtaW5UaW1lLmdldE1pbnV0ZXMoKSk7DQogICAgICAgICAgaWYgKG1pbnV0ZXMgPT09IG1pblRpbWUuZ2V0TWludXRlcygpKSBzZWNvbmRzID0gTWF0aC5tYXgoc2Vjb25kcywgbWluVGltZS5nZXRTZWNvbmRzKCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgc2V0SG91cnMoaG91cnMsIG1pbnV0ZXMsIHNlY29uZHMpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzZXRIb3Vyc0Zyb21EYXRlKGRhdGVPYmopIHsNCiAgICAgICAgdmFyIGRhdGUgPSBkYXRlT2JqIHx8IHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqOw0KICAgICAgICBpZiAoZGF0ZSkgc2V0SG91cnMoZGF0ZS5nZXRIb3VycygpLCBkYXRlLmdldE1pbnV0ZXMoKSwgZGF0ZS5nZXRTZWNvbmRzKCkpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzZXREZWZhdWx0SG91cnMoKSB7DQogICAgICAgIHZhciBob3VycyA9IHNlbGYuY29uZmlnLmRlZmF1bHRIb3VyOw0KICAgICAgICB2YXIgbWludXRlcyA9IHNlbGYuY29uZmlnLmRlZmF1bHRNaW51dGU7DQogICAgICAgIHZhciBzZWNvbmRzID0gc2VsZi5jb25maWcuZGVmYXVsdFNlY29uZHM7DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1pbkRhdGUgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgIHZhciBtaW5faHIgPSBzZWxmLmNvbmZpZy5taW5EYXRlLmdldEhvdXJzKCk7DQogICAgICAgICAgdmFyIG1pbl9taW51dGVzID0gc2VsZi5jb25maWcubWluRGF0ZS5nZXRNaW51dGVzKCk7DQogICAgICAgICAgaG91cnMgPSBNYXRoLm1heChob3VycywgbWluX2hyKTsNCiAgICAgICAgICBpZiAoaG91cnMgPT09IG1pbl9ocikgbWludXRlcyA9IE1hdGgubWF4KG1pbl9taW51dGVzLCBtaW51dGVzKTsNCiAgICAgICAgICBpZiAoaG91cnMgPT09IG1pbl9ociAmJiBtaW51dGVzID09PSBtaW5fbWludXRlcykgc2Vjb25kcyA9IHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0U2Vjb25kcygpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1heERhdGUgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgIHZhciBtYXhfaHIgPSBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldEhvdXJzKCk7DQogICAgICAgICAgdmFyIG1heF9taW51dGVzID0gc2VsZi5jb25maWcubWF4RGF0ZS5nZXRNaW51dGVzKCk7DQogICAgICAgICAgaG91cnMgPSBNYXRoLm1pbihob3VycywgbWF4X2hyKTsNCiAgICAgICAgICBpZiAoaG91cnMgPT09IG1heF9ocikgbWludXRlcyA9IE1hdGgubWluKG1heF9taW51dGVzLCBtaW51dGVzKTsNCiAgICAgICAgICBpZiAoaG91cnMgPT09IG1heF9ociAmJiBtaW51dGVzID09PSBtYXhfbWludXRlcykgc2Vjb25kcyA9IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0U2Vjb25kcygpOw0KICAgICAgICB9DQoNCiAgICAgICAgc2V0SG91cnMoaG91cnMsIG1pbnV0ZXMsIHNlY29uZHMpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzZXRIb3Vycyhob3VycywgbWludXRlcywgc2Vjb25kcykgew0KICAgICAgICBpZiAoc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgIHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqLnNldEhvdXJzKGhvdXJzICUgMjQsIG1pbnV0ZXMsIHNlY29uZHMgfHwgMCwgMCk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIXNlbGYuaG91ckVsZW1lbnQgfHwgIXNlbGYubWludXRlRWxlbWVudCB8fCBzZWxmLmlzTW9iaWxlKSByZXR1cm47DQogICAgICAgIHNlbGYuaG91ckVsZW1lbnQudmFsdWUgPSBwYWQoIXNlbGYuY29uZmlnLnRpbWVfMjRociA/ICgxMiArIGhvdXJzKSAlIDEyICsgMTIgKiBpbnQoaG91cnMgJSAxMiA9PT0gMCkgOiBob3Vycyk7DQogICAgICAgIHNlbGYubWludXRlRWxlbWVudC52YWx1ZSA9IHBhZChtaW51dGVzKTsNCiAgICAgICAgaWYgKHNlbGYuYW1QTSAhPT0gdW5kZWZpbmVkKSBzZWxmLmFtUE0udGV4dENvbnRlbnQgPSBzZWxmLmwxMG4uYW1QTVtpbnQoaG91cnMgPj0gMTIpXTsNCiAgICAgICAgaWYgKHNlbGYuc2Vjb25kRWxlbWVudCAhPT0gdW5kZWZpbmVkKSBzZWxmLnNlY29uZEVsZW1lbnQudmFsdWUgPSBwYWQoc2Vjb25kcyk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIG9uWWVhcklucHV0KGV2ZW50KSB7DQogICAgICAgIHZhciB5ZWFyID0gcGFyc2VJbnQoZXZlbnQudGFyZ2V0LnZhbHVlKSArIChldmVudC5kZWx0YSB8fCAwKTsNCg0KICAgICAgICBpZiAoeWVhciAvIDEwMDAgPiAxIHx8IGV2ZW50LmtleSA9PT0gIkVudGVyIiAmJiAhL1teXGRdLy50ZXN0KHllYXIudG9TdHJpbmcoKSkpIHsNCiAgICAgICAgICBjaGFuZ2VZZWFyKHllYXIpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGJpbmQoZWxlbWVudCwgZXZlbnQsIGhhbmRsZXIsIG9wdGlvbnMpIHsNCiAgICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgQXJyYXkpIHJldHVybiBldmVudC5mb3JFYWNoKGZ1bmN0aW9uIChldikgew0KICAgICAgICAgIHJldHVybiBiaW5kKGVsZW1lbnQsIGV2LCBoYW5kbGVyLCBvcHRpb25zKTsNCiAgICAgICAgfSk7DQogICAgICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgQXJyYXkpIHJldHVybiBlbGVtZW50LmZvckVhY2goZnVuY3Rpb24gKGVsKSB7DQogICAgICAgICAgcmV0dXJuIGJpbmQoZWwsIGV2ZW50LCBoYW5kbGVyLCBvcHRpb25zKTsNCiAgICAgICAgfSk7DQogICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgaGFuZGxlciwgb3B0aW9ucyk7DQoNCiAgICAgICAgc2VsZi5faGFuZGxlcnMucHVzaCh7DQogICAgICAgICAgZWxlbWVudDogZWxlbWVudCwNCiAgICAgICAgICBldmVudDogZXZlbnQsDQogICAgICAgICAgaGFuZGxlcjogaGFuZGxlciwNCiAgICAgICAgICBvcHRpb25zOiBvcHRpb25zDQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBvbkNsaWNrKGhhbmRsZXIpIHsNCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChldnQpIHsNCiAgICAgICAgICBldnQud2hpY2ggPT09IDEgJiYgaGFuZGxlcihldnQpOw0KICAgICAgICB9Ow0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiB0cmlnZ2VyQ2hhbmdlKCkgew0KICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uQ2hhbmdlIik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGJpbmRFdmVudHMoKSB7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy53cmFwKSB7DQogICAgICAgICAgWyJvcGVuIiwgImNsb3NlIiwgInRvZ2dsZSIsICJjbGVhciJdLmZvckVhY2goZnVuY3Rpb24gKGV2dCkgew0KICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChzZWxmLmVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgiW2RhdGEtIiArIGV2dCArICJdIiksIGZ1bmN0aW9uIChlbCkgew0KICAgICAgICAgICAgICByZXR1cm4gYmluZChlbCwgImNsaWNrIiwgc2VsZltldnRdKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYuaXNNb2JpbGUpIHsNCiAgICAgICAgICBzZXR1cE1vYmlsZSgpOw0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBkZWJvdW5jZWRSZXNpemUgPSBkZWJvdW5jZShvblJlc2l6ZSwgNTApOw0KICAgICAgICBzZWxmLl9kZWJvdW5jZWRDaGFuZ2UgPSBkZWJvdW5jZSh0cmlnZ2VyQ2hhbmdlLCBERUJPVU5DRURfQ0hBTkdFX01TKTsNCiAgICAgICAgaWYgKHNlbGYuZGF5c0NvbnRhaW5lciAmJiAhL2lQaG9uZXxpUGFkfGlQb2QvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSBiaW5kKHNlbGYuZGF5c0NvbnRhaW5lciwgIm1vdXNlb3ZlciIsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1vZGUgPT09ICJyYW5nZSIpIG9uTW91c2VPdmVyKGUudGFyZ2V0KTsNCiAgICAgICAgfSk7DQogICAgICAgIGJpbmQod2luZG93LmRvY3VtZW50LmJvZHksICJrZXlkb3duIiwgb25LZXlEb3duKTsNCiAgICAgICAgaWYgKCFzZWxmLmNvbmZpZy5zdGF0aWMpIGJpbmQoc2VsZi5faW5wdXQsICJrZXlkb3duIiwgb25LZXlEb3duKTsNCiAgICAgICAgaWYgKCFzZWxmLmNvbmZpZy5pbmxpbmUgJiYgIXNlbGYuY29uZmlnLnN0YXRpYykgYmluZCh3aW5kb3csICJyZXNpemUiLCBkZWJvdW5jZWRSZXNpemUpOw0KICAgICAgICBpZiAod2luZG93Lm9udG91Y2hzdGFydCAhPT0gdW5kZWZpbmVkKSBiaW5kKHdpbmRvdy5kb2N1bWVudCwgImNsaWNrIiwgZG9jdW1lbnRDbGljayk7ZWxzZSBiaW5kKHdpbmRvdy5kb2N1bWVudCwgIm1vdXNlZG93biIsIG9uQ2xpY2soZG9jdW1lbnRDbGljaykpOw0KICAgICAgICBiaW5kKHdpbmRvdy5kb2N1bWVudCwgImZvY3VzIiwgZG9jdW1lbnRDbGljaywgew0KICAgICAgICAgIGNhcHR1cmU6IHRydWUNCiAgICAgICAgfSk7DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmNsaWNrT3BlbnMgPT09IHRydWUpIHsNCiAgICAgICAgICBiaW5kKHNlbGYuX2lucHV0LCAiZm9jdXMiLCBzZWxmLm9wZW4pOw0KICAgICAgICAgIGJpbmQoc2VsZi5faW5wdXQsICJtb3VzZWRvd24iLCBvbkNsaWNrKHNlbGYub3BlbikpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYuZGF5c0NvbnRhaW5lciAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgYmluZChzZWxmLm1vbnRoTmF2LCAibW91c2Vkb3duIiwgb25DbGljayhvbk1vbnRoTmF2Q2xpY2spKTsNCiAgICAgICAgICBiaW5kKHNlbGYubW9udGhOYXYsIFsia2V5dXAiLCAiaW5jcmVtZW50Il0sIG9uWWVhcklucHV0KTsNCiAgICAgICAgICBiaW5kKHNlbGYuZGF5c0NvbnRhaW5lciwgIm1vdXNlZG93biIsIG9uQ2xpY2soc2VsZWN0RGF0ZSkpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYudGltZUNvbnRhaW5lciAhPT0gdW5kZWZpbmVkICYmIHNlbGYubWludXRlRWxlbWVudCAhPT0gdW5kZWZpbmVkICYmIHNlbGYuaG91ckVsZW1lbnQgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgIHZhciBzZWxUZXh0ID0gZnVuY3Rpb24gc2VsVGV4dChlKSB7DQogICAgICAgICAgICByZXR1cm4gZS50YXJnZXQuc2VsZWN0KCk7DQogICAgICAgICAgfTsNCg0KICAgICAgICAgIGJpbmQoc2VsZi50aW1lQ29udGFpbmVyLCBbImluY3JlbWVudCJdLCB1cGRhdGVUaW1lKTsNCiAgICAgICAgICBiaW5kKHNlbGYudGltZUNvbnRhaW5lciwgImJsdXIiLCB1cGRhdGVUaW1lLCB7DQogICAgICAgICAgICBjYXB0dXJlOiB0cnVlDQogICAgICAgICAgfSk7DQogICAgICAgICAgYmluZChzZWxmLnRpbWVDb250YWluZXIsICJtb3VzZWRvd24iLCBvbkNsaWNrKHRpbWVJbmNyZW1lbnQpKTsNCiAgICAgICAgICBiaW5kKFtzZWxmLmhvdXJFbGVtZW50LCBzZWxmLm1pbnV0ZUVsZW1lbnRdLCBbImZvY3VzIiwgImNsaWNrIl0sIHNlbFRleHQpOw0KICAgICAgICAgIGlmIChzZWxmLnNlY29uZEVsZW1lbnQgIT09IHVuZGVmaW5lZCkgYmluZChzZWxmLnNlY29uZEVsZW1lbnQsICJmb2N1cyIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLnNlY29uZEVsZW1lbnQgJiYgc2VsZi5zZWNvbmRFbGVtZW50LnNlbGVjdCgpOw0KICAgICAgICAgIH0pOw0KDQogICAgICAgICAgaWYgKHNlbGYuYW1QTSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBiaW5kKHNlbGYuYW1QTSwgIm1vdXNlZG93biIsIG9uQ2xpY2soZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgICAgdXBkYXRlVGltZShlKTsNCiAgICAgICAgICAgICAgdHJpZ2dlckNoYW5nZSgpOw0KICAgICAgICAgICAgfSkpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBqdW1wVG9EYXRlKGp1bXBEYXRlKSB7DQogICAgICAgIHZhciBqdW1wVG8gPSBqdW1wRGF0ZSAhPT0gdW5kZWZpbmVkID8gc2VsZi5wYXJzZURhdGUoanVtcERhdGUpIDogc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogfHwgKHNlbGYuY29uZmlnLm1pbkRhdGUgJiYgc2VsZi5jb25maWcubWluRGF0ZSA+IHNlbGYubm93ID8gc2VsZi5jb25maWcubWluRGF0ZSA6IHNlbGYuY29uZmlnLm1heERhdGUgJiYgc2VsZi5jb25maWcubWF4RGF0ZSA8IHNlbGYubm93ID8gc2VsZi5jb25maWcubWF4RGF0ZSA6IHNlbGYubm93KTsNCg0KICAgICAgICB0cnkgew0KICAgICAgICAgIGlmIChqdW1wVG8gIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgc2VsZi5jdXJyZW50WWVhciA9IGp1bXBUby5nZXRGdWxsWWVhcigpOw0KICAgICAgICAgICAgc2VsZi5jdXJyZW50TW9udGggPSBqdW1wVG8uZ2V0TW9udGgoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICBlLm1lc3NhZ2UgPSAiSW52YWxpZCBkYXRlIHN1cHBsaWVkOiAiICsganVtcFRvOw0KICAgICAgICAgIHNlbGYuY29uZmlnLmVycm9ySGFuZGxlcihlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHNlbGYucmVkcmF3KCk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHRpbWVJbmNyZW1lbnQoZSkgew0KICAgICAgICBpZiAofmUudGFyZ2V0LmNsYXNzTmFtZS5pbmRleE9mKCJhcnJvdyIpKSBpbmNyZW1lbnROdW1JbnB1dChlLCBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImFycm93VXAiKSA/IDEgOiAtMSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGluY3JlbWVudE51bUlucHV0KGUsIGRlbHRhLCBpbnB1dEVsZW0pIHsNCiAgICAgICAgdmFyIHRhcmdldCA9IGUgJiYgZS50YXJnZXQ7DQogICAgICAgIHZhciBpbnB1dCA9IGlucHV0RWxlbSB8fCB0YXJnZXQgJiYgdGFyZ2V0LnBhcmVudE5vZGUgJiYgdGFyZ2V0LnBhcmVudE5vZGUuZmlyc3RDaGlsZDsNCiAgICAgICAgdmFyIGV2ZW50ID0gY3JlYXRlRXZlbnQoImluY3JlbWVudCIpOw0KICAgICAgICBldmVudC5kZWx0YSA9IGRlbHRhOw0KICAgICAgICBpbnB1dCAmJiBpbnB1dC5kaXNwYXRjaEV2ZW50KGV2ZW50KTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gYnVpbGQoKSB7DQogICAgICAgIHZhciBmcmFnbWVudCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7DQogICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLWNhbGVuZGFyIik7DQogICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIudGFiSW5kZXggPSAtMTsNCg0KICAgICAgICBpZiAoIXNlbGYuY29uZmlnLm5vQ2FsZW5kYXIpIHsNCiAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChidWlsZE1vbnRoTmF2KCkpOw0KICAgICAgICAgIHNlbGYuaW5uZXJDb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLWlubmVyQ29udGFpbmVyIik7DQoNCiAgICAgICAgICBpZiAoc2VsZi5jb25maWcud2Vla051bWJlcnMpIHsNCiAgICAgICAgICAgIHZhciBfYnVpbGRXZWVrcyA9IGJ1aWxkV2Vla3MoKSwNCiAgICAgICAgICAgICAgICB3ZWVrV3JhcHBlciA9IF9idWlsZFdlZWtzLndlZWtXcmFwcGVyLA0KICAgICAgICAgICAgICAgIHdlZWtOdW1iZXJzID0gX2J1aWxkV2Vla3Mud2Vla051bWJlcnM7DQoNCiAgICAgICAgICAgIHNlbGYuaW5uZXJDb250YWluZXIuYXBwZW5kQ2hpbGQod2Vla1dyYXBwZXIpOw0KICAgICAgICAgICAgc2VsZi53ZWVrTnVtYmVycyA9IHdlZWtOdW1iZXJzOw0KICAgICAgICAgICAgc2VsZi53ZWVrV3JhcHBlciA9IHdlZWtXcmFwcGVyOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIHNlbGYuckNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3ItckNvbnRhaW5lciIpOw0KICAgICAgICAgIHNlbGYuckNvbnRhaW5lci5hcHBlbmRDaGlsZChidWlsZFdlZWtkYXlzKCkpOw0KDQogICAgICAgICAgaWYgKCFzZWxmLmRheXNDb250YWluZXIpIHsNCiAgICAgICAgICAgIHNlbGYuZGF5c0NvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3ItZGF5cyIpOw0KICAgICAgICAgICAgc2VsZi5kYXlzQ29udGFpbmVyLnRhYkluZGV4ID0gLTE7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgYnVpbGREYXlzKCk7DQogICAgICAgICAgc2VsZi5yQ29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGYuZGF5c0NvbnRhaW5lcik7DQogICAgICAgICAgc2VsZi5pbm5lckNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWxmLnJDb250YWluZXIpOw0KICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHNlbGYuaW5uZXJDb250YWluZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmVuYWJsZVRpbWUpIHsNCiAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChidWlsZFRpbWUoKSk7DQogICAgICAgIH0NCg0KICAgICAgICB0b2dnbGVDbGFzcyhzZWxmLmNhbGVuZGFyQ29udGFpbmVyLCAicmFuZ2VNb2RlIiwgc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIik7DQogICAgICAgIHRvZ2dsZUNsYXNzKHNlbGYuY2FsZW5kYXJDb250YWluZXIsICJhbmltYXRlIiwgc2VsZi5jb25maWcuYW5pbWF0ZSA9PT0gdHJ1ZSk7DQogICAgICAgIHRvZ2dsZUNsYXNzKHNlbGYuY2FsZW5kYXJDb250YWluZXIsICJtdWx0aU1vbnRoIiwgc2VsZi5jb25maWcuc2hvd01vbnRocyA+IDEpOw0KICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLmFwcGVuZENoaWxkKGZyYWdtZW50KTsNCiAgICAgICAgdmFyIGN1c3RvbUFwcGVuZCA9IHNlbGYuY29uZmlnLmFwcGVuZFRvICE9PSB1bmRlZmluZWQgJiYgc2VsZi5jb25maWcuYXBwZW5kVG8ubm9kZVR5cGUgIT09IHVuZGVmaW5lZDsNCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcuaW5saW5lIHx8IHNlbGYuY29uZmlnLnN0YXRpYykgew0KICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuY2xhc3NMaXN0LmFkZChzZWxmLmNvbmZpZy5pbmxpbmUgPyAiaW5saW5lIiA6ICJzdGF0aWMiKTsNCg0KICAgICAgICAgIGlmIChzZWxmLmNvbmZpZy5pbmxpbmUpIHsNCiAgICAgICAgICAgIGlmICghY3VzdG9tQXBwZW5kICYmIHNlbGYuZWxlbWVudC5wYXJlbnROb2RlKSBzZWxmLmVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsZi5jYWxlbmRhckNvbnRhaW5lciwgc2VsZi5faW5wdXQubmV4dFNpYmxpbmcpO2Vsc2UgaWYgKHNlbGYuY29uZmlnLmFwcGVuZFRvICE9PSB1bmRlZmluZWQpIHNlbGYuY29uZmlnLmFwcGVuZFRvLmFwcGVuZENoaWxkKHNlbGYuY2FsZW5kYXJDb250YWluZXIpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmIChzZWxmLmNvbmZpZy5zdGF0aWMpIHsNCiAgICAgICAgICAgIHZhciB3cmFwcGVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci13cmFwcGVyIik7DQogICAgICAgICAgICBpZiAoc2VsZi5lbGVtZW50LnBhcmVudE5vZGUpIHNlbGYuZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh3cmFwcGVyLCBzZWxmLmVsZW1lbnQpOw0KICAgICAgICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChzZWxmLmVsZW1lbnQpOw0KICAgICAgICAgICAgaWYgKHNlbGYuYWx0SW5wdXQpIHdyYXBwZXIuYXBwZW5kQ2hpbGQoc2VsZi5hbHRJbnB1dCk7DQogICAgICAgICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKHNlbGYuY2FsZW5kYXJDb250YWluZXIpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmICghc2VsZi5jb25maWcuc3RhdGljICYmICFzZWxmLmNvbmZpZy5pbmxpbmUpIChzZWxmLmNvbmZpZy5hcHBlbmRUbyAhPT0gdW5kZWZpbmVkID8gc2VsZi5jb25maWcuYXBwZW5kVG8gOiB3aW5kb3cuZG9jdW1lbnQuYm9keSkuYXBwZW5kQ2hpbGQoc2VsZi5jYWxlbmRhckNvbnRhaW5lcik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGNyZWF0ZURheShjbGFzc05hbWUsIGRhdGUsIGRheU51bWJlciwgaSkgew0KICAgICAgICB2YXIgZGF0ZUlzRW5hYmxlZCA9IGlzRW5hYmxlZChkYXRlLCB0cnVlKSwNCiAgICAgICAgICAgIGRheUVsZW1lbnQgPSBjcmVhdGVFbGVtZW50KCJzcGFuIiwgImZsYXRwaWNrci1kYXkgIiArIGNsYXNzTmFtZSwgZGF0ZS5nZXREYXRlKCkudG9TdHJpbmcoKSk7DQogICAgICAgIGRheUVsZW1lbnQuZGF0ZU9iaiA9IGRhdGU7DQogICAgICAgIGRheUVsZW1lbnQuJGkgPSBpOw0KICAgICAgICBkYXlFbGVtZW50LnNldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIsIHNlbGYuZm9ybWF0RGF0ZShkYXRlLCBzZWxmLmNvbmZpZy5hcmlhRGF0ZUZvcm1hdCkpOw0KDQogICAgICAgIGlmIChjbGFzc05hbWUuaW5kZXhPZigiaGlkZGVuIikgPT09IC0xICYmIGNvbXBhcmVEYXRlcyhkYXRlLCBzZWxmLm5vdykgPT09IDApIHsNCiAgICAgICAgICBzZWxmLnRvZGF5RGF0ZUVsZW0gPSBkYXlFbGVtZW50Ow0KICAgICAgICAgIGRheUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgidG9kYXkiKTsNCiAgICAgICAgICBkYXlFbGVtZW50LnNldEF0dHJpYnV0ZSgiYXJpYS1jdXJyZW50IiwgImRhdGUiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChkYXRlSXNFbmFibGVkKSB7DQogICAgICAgICAgZGF5RWxlbWVudC50YWJJbmRleCA9IC0xOw0KDQogICAgICAgICAgaWYgKGlzRGF0ZVNlbGVjdGVkKGRhdGUpKSB7DQogICAgICAgICAgICBkYXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoInNlbGVjdGVkIik7DQogICAgICAgICAgICBzZWxmLnNlbGVjdGVkRGF0ZUVsZW0gPSBkYXlFbGVtZW50Ow0KDQogICAgICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIikgew0KICAgICAgICAgICAgICB0b2dnbGVDbGFzcyhkYXlFbGVtZW50LCAic3RhcnRSYW5nZSIsIHNlbGYuc2VsZWN0ZWREYXRlc1swXSAmJiBjb21wYXJlRGF0ZXMoZGF0ZSwgc2VsZi5zZWxlY3RlZERhdGVzWzBdLCB0cnVlKSA9PT0gMCk7DQogICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKGRheUVsZW1lbnQsICJlbmRSYW5nZSIsIHNlbGYuc2VsZWN0ZWREYXRlc1sxXSAmJiBjb21wYXJlRGF0ZXMoZGF0ZSwgc2VsZi5zZWxlY3RlZERhdGVzWzFdLCB0cnVlKSA9PT0gMCk7DQogICAgICAgICAgICAgIGlmIChjbGFzc05hbWUgPT09ICJuZXh0TW9udGhEYXkiKSBkYXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoImluUmFuZ2UiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgZGF5RWxlbWVudC5jbGFzc0xpc3QuYWRkKCJkaXNhYmxlZCIpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1vZGUgPT09ICJyYW5nZSIpIHsNCiAgICAgICAgICBpZiAoaXNEYXRlSW5SYW5nZShkYXRlKSAmJiAhaXNEYXRlU2VsZWN0ZWQoZGF0ZSkpIGRheUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgiaW5SYW5nZSIpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYud2Vla051bWJlcnMgJiYgc2VsZi5jb25maWcuc2hvd01vbnRocyA9PT0gMSAmJiBjbGFzc05hbWUgIT09ICJwcmV2TW9udGhEYXkiICYmIGRheU51bWJlciAlIDcgPT09IDEpIHsNCiAgICAgICAgICBzZWxmLndlZWtOdW1iZXJzLmluc2VydEFkamFjZW50SFRNTCgiYmVmb3JlZW5kIiwgIjxzcGFuIGNsYXNzPSdmbGF0cGlja3ItZGF5Jz4iICsgc2VsZi5jb25maWcuZ2V0V2VlayhkYXRlKSArICI8L3NwYW4+Iik7DQogICAgICAgIH0NCg0KICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uRGF5Q3JlYXRlIiwgZGF5RWxlbWVudCk7DQogICAgICAgIHJldHVybiBkYXlFbGVtZW50Ow0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBmb2N1c09uRGF5RWxlbSh0YXJnZXROb2RlKSB7DQogICAgICAgIHRhcmdldE5vZGUuZm9jdXMoKTsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1vZGUgPT09ICJyYW5nZSIpIG9uTW91c2VPdmVyKHRhcmdldE5vZGUpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBnZXRGaXJzdEF2YWlsYWJsZURheShkZWx0YSkgew0KICAgICAgICB2YXIgc3RhcnRNb250aCA9IGRlbHRhID4gMCA/IDAgOiBzZWxmLmNvbmZpZy5zaG93TW9udGhzIC0gMTsNCiAgICAgICAgdmFyIGVuZE1vbnRoID0gZGVsdGEgPiAwID8gc2VsZi5jb25maWcuc2hvd01vbnRocyA6IC0xOw0KDQogICAgICAgIGZvciAodmFyIG0gPSBzdGFydE1vbnRoOyBtICE9IGVuZE1vbnRoOyBtICs9IGRlbHRhKSB7DQogICAgICAgICAgdmFyIG1vbnRoID0gc2VsZi5kYXlzQ29udGFpbmVyLmNoaWxkcmVuW21dOw0KICAgICAgICAgIHZhciBzdGFydEluZGV4ID0gZGVsdGEgPiAwID8gMCA6IG1vbnRoLmNoaWxkcmVuLmxlbmd0aCAtIDE7DQogICAgICAgICAgdmFyIGVuZEluZGV4ID0gZGVsdGEgPiAwID8gbW9udGguY2hpbGRyZW4ubGVuZ3RoIDogLTE7DQoNCiAgICAgICAgICBmb3IgKHZhciBpID0gc3RhcnRJbmRleDsgaSAhPSBlbmRJbmRleDsgaSArPSBkZWx0YSkgew0KICAgICAgICAgICAgdmFyIGMgPSBtb250aC5jaGlsZHJlbltpXTsNCiAgICAgICAgICAgIGlmIChjLmNsYXNzTmFtZS5pbmRleE9mKCJoaWRkZW4iKSA9PT0gLTEgJiYgaXNFbmFibGVkKGMuZGF0ZU9iaikpIHJldHVybiBjOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB1bmRlZmluZWQ7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGdldE5leHRBdmFpbGFibGVEYXkoY3VycmVudCwgZGVsdGEpIHsNCiAgICAgICAgdmFyIGdpdmVuTW9udGggPSBjdXJyZW50LmNsYXNzTmFtZS5pbmRleE9mKCJNb250aCIpID09PSAtMSA/IGN1cnJlbnQuZGF0ZU9iai5nZXRNb250aCgpIDogc2VsZi5jdXJyZW50TW9udGg7DQogICAgICAgIHZhciBlbmRNb250aCA9IGRlbHRhID4gMCA/IHNlbGYuY29uZmlnLnNob3dNb250aHMgOiAtMTsNCiAgICAgICAgdmFyIGxvb3BEZWx0YSA9IGRlbHRhID4gMCA/IDEgOiAtMTsNCg0KICAgICAgICBmb3IgKHZhciBtID0gZ2l2ZW5Nb250aCAtIHNlbGYuY3VycmVudE1vbnRoOyBtICE9IGVuZE1vbnRoOyBtICs9IGxvb3BEZWx0YSkgew0KICAgICAgICAgIHZhciBtb250aCA9IHNlbGYuZGF5c0NvbnRhaW5lci5jaGlsZHJlblttXTsNCiAgICAgICAgICB2YXIgc3RhcnRJbmRleCA9IGdpdmVuTW9udGggLSBzZWxmLmN1cnJlbnRNb250aCA9PT0gbSA/IGN1cnJlbnQuJGkgKyBkZWx0YSA6IGRlbHRhIDwgMCA/IG1vbnRoLmNoaWxkcmVuLmxlbmd0aCAtIDEgOiAwOw0KICAgICAgICAgIHZhciBudW1Nb250aERheXMgPSBtb250aC5jaGlsZHJlbi5sZW5ndGg7DQoNCiAgICAgICAgICBmb3IgKHZhciBpID0gc3RhcnRJbmRleDsgaSA+PSAwICYmIGkgPCBudW1Nb250aERheXMgJiYgaSAhPSAoZGVsdGEgPiAwID8gbnVtTW9udGhEYXlzIDogLTEpOyBpICs9IGxvb3BEZWx0YSkgew0KICAgICAgICAgICAgdmFyIGMgPSBtb250aC5jaGlsZHJlbltpXTsNCiAgICAgICAgICAgIGlmIChjLmNsYXNzTmFtZS5pbmRleE9mKCJoaWRkZW4iKSA9PT0gLTEgJiYgaXNFbmFibGVkKGMuZGF0ZU9iaikgJiYgTWF0aC5hYnMoY3VycmVudC4kaSAtIGkpID49IE1hdGguYWJzKGRlbHRhKSkgcmV0dXJuIGZvY3VzT25EYXlFbGVtKGMpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHNlbGYuY2hhbmdlTW9udGgobG9vcERlbHRhKTsNCiAgICAgICAgZm9jdXNPbkRheShnZXRGaXJzdEF2YWlsYWJsZURheShsb29wRGVsdGEpLCAwKTsNCiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gZm9jdXNPbkRheShjdXJyZW50LCBvZmZzZXQpIHsNCiAgICAgICAgdmFyIGRheUZvY3VzZWQgPSBpc0luVmlldyhkb2N1bWVudC5hY3RpdmVFbGVtZW50KTsNCiAgICAgICAgdmFyIHN0YXJ0RWxlbSA9IGN1cnJlbnQgIT09IHVuZGVmaW5lZCA/IGN1cnJlbnQgOiBkYXlGb2N1c2VkID8gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA6IHNlbGYuc2VsZWN0ZWREYXRlRWxlbSAhPT0gdW5kZWZpbmVkICYmIGlzSW5WaWV3KHNlbGYuc2VsZWN0ZWREYXRlRWxlbSkgPyBzZWxmLnNlbGVjdGVkRGF0ZUVsZW0gOiBzZWxmLnRvZGF5RGF0ZUVsZW0gIT09IHVuZGVmaW5lZCAmJiBpc0luVmlldyhzZWxmLnRvZGF5RGF0ZUVsZW0pID8gc2VsZi50b2RheURhdGVFbGVtIDogZ2V0Rmlyc3RBdmFpbGFibGVEYXkob2Zmc2V0ID4gMCA/IDEgOiAtMSk7DQogICAgICAgIGlmIChzdGFydEVsZW0gPT09IHVuZGVmaW5lZCkgcmV0dXJuIHNlbGYuX2lucHV0LmZvY3VzKCk7DQogICAgICAgIGlmICghZGF5Rm9jdXNlZCkgcmV0dXJuIGZvY3VzT25EYXlFbGVtKHN0YXJ0RWxlbSk7DQogICAgICAgIGdldE5leHRBdmFpbGFibGVEYXkoc3RhcnRFbGVtLCBvZmZzZXQpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBidWlsZE1vbnRoRGF5cyh5ZWFyLCBtb250aCkgew0KICAgICAgICB2YXIgZmlyc3RPZk1vbnRoID0gKG5ldyBEYXRlKHllYXIsIG1vbnRoLCAxKS5nZXREYXkoKSAtIHNlbGYubDEwbi5maXJzdERheU9mV2VlayArIDcpICUgNzsNCiAgICAgICAgdmFyIHByZXZNb250aERheXMgPSBzZWxmLnV0aWxzLmdldERheXNJbk1vbnRoKChtb250aCAtIDEgKyAxMikgJSAxMik7DQogICAgICAgIHZhciBkYXlzSW5Nb250aCA9IHNlbGYudXRpbHMuZ2V0RGF5c0luTW9udGgobW9udGgpLA0KICAgICAgICAgICAgZGF5cyA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksDQogICAgICAgICAgICBpc011bHRpTW9udGggPSBzZWxmLmNvbmZpZy5zaG93TW9udGhzID4gMSwNCiAgICAgICAgICAgIHByZXZNb250aERheUNsYXNzID0gaXNNdWx0aU1vbnRoID8gInByZXZNb250aERheSBoaWRkZW4iIDogInByZXZNb250aERheSIsDQogICAgICAgICAgICBuZXh0TW9udGhEYXlDbGFzcyA9IGlzTXVsdGlNb250aCA/ICJuZXh0TW9udGhEYXkgaGlkZGVuIiA6ICJuZXh0TW9udGhEYXkiOw0KICAgICAgICB2YXIgZGF5TnVtYmVyID0gcHJldk1vbnRoRGF5cyArIDEgLSBmaXJzdE9mTW9udGgsDQogICAgICAgICAgICBkYXlJbmRleCA9IDA7DQoNCiAgICAgICAgZm9yICg7IGRheU51bWJlciA8PSBwcmV2TW9udGhEYXlzOyBkYXlOdW1iZXIrKywgZGF5SW5kZXgrKykgew0KICAgICAgICAgIGRheXMuYXBwZW5kQ2hpbGQoY3JlYXRlRGF5KHByZXZNb250aERheUNsYXNzLCBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheU51bWJlciksIGRheU51bWJlciwgZGF5SW5kZXgpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAoZGF5TnVtYmVyID0gMTsgZGF5TnVtYmVyIDw9IGRheXNJbk1vbnRoOyBkYXlOdW1iZXIrKywgZGF5SW5kZXgrKykgew0KICAgICAgICAgIGRheXMuYXBwZW5kQ2hpbGQoY3JlYXRlRGF5KCIiLCBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgZGF5TnVtYmVyKSwgZGF5TnVtYmVyLCBkYXlJbmRleCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgZm9yICh2YXIgZGF5TnVtID0gZGF5c0luTW9udGggKyAxOyBkYXlOdW0gPD0gNDIgLSBmaXJzdE9mTW9udGggJiYgKHNlbGYuY29uZmlnLnNob3dNb250aHMgPT09IDEgfHwgZGF5SW5kZXggJSA3ICE9PSAwKTsgZGF5TnVtKyssIGRheUluZGV4KyspIHsNCiAgICAgICAgICBkYXlzLmFwcGVuZENoaWxkKGNyZWF0ZURheShuZXh0TW9udGhEYXlDbGFzcywgbmV3IERhdGUoeWVhciwgbW9udGggKyAxLCBkYXlOdW0gJSBkYXlzSW5Nb250aCksIGRheU51bSwgZGF5SW5kZXgpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBkYXlDb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZGF5Q29udGFpbmVyIik7DQogICAgICAgIGRheUNvbnRhaW5lci5hcHBlbmRDaGlsZChkYXlzKTsNCiAgICAgICAgcmV0dXJuIGRheUNvbnRhaW5lcjsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gYnVpbGREYXlzKCkgew0KICAgICAgICBpZiAoc2VsZi5kYXlzQ29udGFpbmVyID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBjbGVhck5vZGUoc2VsZi5kYXlzQ29udGFpbmVyKTsNCiAgICAgICAgaWYgKHNlbGYud2Vla051bWJlcnMpIGNsZWFyTm9kZShzZWxmLndlZWtOdW1iZXJzKTsNCiAgICAgICAgdmFyIGZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7DQoNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmNvbmZpZy5zaG93TW9udGhzOyBpKyspIHsNCiAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKHNlbGYuY3VycmVudFllYXIsIHNlbGYuY3VycmVudE1vbnRoLCAxKTsNCiAgICAgICAgICBkLnNldE1vbnRoKHNlbGYuY3VycmVudE1vbnRoICsgaSk7DQogICAgICAgICAgZnJhZy5hcHBlbmRDaGlsZChidWlsZE1vbnRoRGF5cyhkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSkpOw0KICAgICAgICB9DQoNCiAgICAgICAgc2VsZi5kYXlzQ29udGFpbmVyLmFwcGVuZENoaWxkKGZyYWcpOw0KICAgICAgICBzZWxmLmRheXMgPSBzZWxmLmRheXNDb250YWluZXIuZmlyc3RDaGlsZDsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gYnVpbGRNb250aCgpIHsNCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3ItbW9udGgiKTsNCiAgICAgICAgdmFyIG1vbnRoTmF2RnJhZ21lbnQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KICAgICAgICB2YXIgbW9udGhFbGVtZW50ID0gY3JlYXRlRWxlbWVudCgic3BhbiIsICJjdXItbW9udGgiKTsNCiAgICAgICAgbW9udGhFbGVtZW50LnRpdGxlID0gc2VsZi5sMTBuLnNjcm9sbFRpdGxlOw0KICAgICAgICB2YXIgeWVhcklucHV0ID0gY3JlYXRlTnVtYmVySW5wdXQoImN1ci15ZWFyIiwgew0KICAgICAgICAgIHRhYmluZGV4OiAiLTEiDQogICAgICAgIH0pOw0KICAgICAgICB2YXIgeWVhckVsZW1lbnQgPSB5ZWFySW5wdXQuY2hpbGROb2Rlc1swXTsNCiAgICAgICAgeWVhckVsZW1lbnQudGl0bGUgPSBzZWxmLmwxMG4uc2Nyb2xsVGl0bGU7DQogICAgICAgIHllYXJFbGVtZW50LnNldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIsIHNlbGYubDEwbi55ZWFyQXJpYUxhYmVsKTsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1pbkRhdGUpIHllYXJFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1taW4iLCBzZWxmLmNvbmZpZy5taW5EYXRlLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKSk7DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1heERhdGUpIHsNCiAgICAgICAgICB5ZWFyRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtbWF4Iiwgc2VsZi5jb25maWcubWF4RGF0ZS5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCkpOw0KICAgICAgICAgIHllYXJFbGVtZW50LmRpc2FibGVkID0gISFzZWxmLmNvbmZpZy5taW5EYXRlICYmIHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0RnVsbFllYXIoKSA9PT0gc2VsZi5jb25maWcubWF4RGF0ZS5nZXRGdWxsWWVhcigpOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGN1cnJlbnRNb250aCA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3ItY3VycmVudC1tb250aCIpOw0KICAgICAgICBjdXJyZW50TW9udGguYXBwZW5kQ2hpbGQobW9udGhFbGVtZW50KTsNCiAgICAgICAgY3VycmVudE1vbnRoLmFwcGVuZENoaWxkKHllYXJJbnB1dCk7DQogICAgICAgIG1vbnRoTmF2RnJhZ21lbnQuYXBwZW5kQ2hpbGQoY3VycmVudE1vbnRoKTsNCiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG1vbnRoTmF2RnJhZ21lbnQpOw0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgIGNvbnRhaW5lcjogY29udGFpbmVyLA0KICAgICAgICAgIHllYXJFbGVtZW50OiB5ZWFyRWxlbWVudCwNCiAgICAgICAgICBtb250aEVsZW1lbnQ6IG1vbnRoRWxlbWVudA0KICAgICAgICB9Ow0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBidWlsZE1vbnRocygpIHsNCiAgICAgICAgY2xlYXJOb2RlKHNlbGYubW9udGhOYXYpOw0KICAgICAgICBzZWxmLm1vbnRoTmF2LmFwcGVuZENoaWxkKHNlbGYucHJldk1vbnRoTmF2KTsNCg0KICAgICAgICBmb3IgKHZhciBtID0gc2VsZi5jb25maWcuc2hvd01vbnRoczsgbS0tOykgew0KICAgICAgICAgIHZhciBtb250aCA9IGJ1aWxkTW9udGgoKTsNCiAgICAgICAgICBzZWxmLnllYXJFbGVtZW50cy5wdXNoKG1vbnRoLnllYXJFbGVtZW50KTsNCiAgICAgICAgICBzZWxmLm1vbnRoRWxlbWVudHMucHVzaChtb250aC5tb250aEVsZW1lbnQpOw0KICAgICAgICAgIHNlbGYubW9udGhOYXYuYXBwZW5kQ2hpbGQobW9udGguY29udGFpbmVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHNlbGYubW9udGhOYXYuYXBwZW5kQ2hpbGQoc2VsZi5uZXh0TW9udGhOYXYpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBidWlsZE1vbnRoTmF2KCkgew0KICAgICAgICBzZWxmLm1vbnRoTmF2ID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci1tb250aHMiKTsNCiAgICAgICAgc2VsZi55ZWFyRWxlbWVudHMgPSBbXTsNCiAgICAgICAgc2VsZi5tb250aEVsZW1lbnRzID0gW107DQogICAgICAgIHNlbGYucHJldk1vbnRoTmF2ID0gY3JlYXRlRWxlbWVudCgic3BhbiIsICJmbGF0cGlja3ItcHJldi1tb250aCIpOw0KICAgICAgICBzZWxmLnByZXZNb250aE5hdi5pbm5lckhUTUwgPSBzZWxmLmNvbmZpZy5wcmV2QXJyb3c7DQogICAgICAgIHNlbGYubmV4dE1vbnRoTmF2ID0gY3JlYXRlRWxlbWVudCgic3BhbiIsICJmbGF0cGlja3ItbmV4dC1tb250aCIpOw0KICAgICAgICBzZWxmLm5leHRNb250aE5hdi5pbm5lckhUTUwgPSBzZWxmLmNvbmZpZy5uZXh0QXJyb3c7DQogICAgICAgIGJ1aWxkTW9udGhzKCk7DQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLCAiX2hpZGVQcmV2TW9udGhBcnJvdyIsIHsNCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9faGlkZVByZXZNb250aEFycm93Ow0KICAgICAgICAgIH0sDQogICAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoYm9vbCkgew0KICAgICAgICAgICAgaWYgKHNlbGYuX19oaWRlUHJldk1vbnRoQXJyb3cgIT09IGJvb2wpIHsNCiAgICAgICAgICAgICAgdG9nZ2xlQ2xhc3Moc2VsZi5wcmV2TW9udGhOYXYsICJkaXNhYmxlZCIsIGJvb2wpOw0KICAgICAgICAgICAgICBzZWxmLl9faGlkZVByZXZNb250aEFycm93ID0gYm9vbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZiwgIl9oaWRlTmV4dE1vbnRoQXJyb3ciLCB7DQogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5fX2hpZGVOZXh0TW9udGhBcnJvdzsNCiAgICAgICAgICB9LA0KICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGJvb2wpIHsNCiAgICAgICAgICAgIGlmIChzZWxmLl9faGlkZU5leHRNb250aEFycm93ICE9PSBib29sKSB7DQogICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKHNlbGYubmV4dE1vbnRoTmF2LCAiZGlzYWJsZWQiLCBib29sKTsNCiAgICAgICAgICAgICAgc2VsZi5fX2hpZGVOZXh0TW9udGhBcnJvdyA9IGJvb2w7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgc2VsZi5jdXJyZW50WWVhckVsZW1lbnQgPSBzZWxmLnllYXJFbGVtZW50c1swXTsNCiAgICAgICAgdXBkYXRlTmF2aWdhdGlvbkN1cnJlbnRNb250aCgpOw0KICAgICAgICByZXR1cm4gc2VsZi5tb250aE5hdjsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gYnVpbGRUaW1lKCkgew0KICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoImhhc1RpbWUiKTsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm5vQ2FsZW5kYXIpIHNlbGYuY2FsZW5kYXJDb250YWluZXIuY2xhc3NMaXN0LmFkZCgibm9DYWxlbmRhciIpOw0KICAgICAgICBzZWxmLnRpbWVDb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLXRpbWUiKTsNCiAgICAgICAgc2VsZi50aW1lQ29udGFpbmVyLnRhYkluZGV4ID0gLTE7DQogICAgICAgIHZhciBzZXBhcmF0b3IgPSBjcmVhdGVFbGVtZW50KCJzcGFuIiwgImZsYXRwaWNrci10aW1lLXNlcGFyYXRvciIsICI6Iik7DQogICAgICAgIHZhciBob3VySW5wdXQgPSBjcmVhdGVOdW1iZXJJbnB1dCgiZmxhdHBpY2tyLWhvdXIiKTsNCiAgICAgICAgc2VsZi5ob3VyRWxlbWVudCA9IGhvdXJJbnB1dC5jaGlsZE5vZGVzWzBdOw0KICAgICAgICB2YXIgbWludXRlSW5wdXQgPSBjcmVhdGVOdW1iZXJJbnB1dCgiZmxhdHBpY2tyLW1pbnV0ZSIpOw0KICAgICAgICBzZWxmLm1pbnV0ZUVsZW1lbnQgPSBtaW51dGVJbnB1dC5jaGlsZE5vZGVzWzBdOw0KICAgICAgICBzZWxmLmhvdXJFbGVtZW50LnRhYkluZGV4ID0gc2VsZi5taW51dGVFbGVtZW50LnRhYkluZGV4ID0gLTE7DQogICAgICAgIHNlbGYuaG91ckVsZW1lbnQudmFsdWUgPSBwYWQoc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogPyBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iai5nZXRIb3VycygpIDogc2VsZi5jb25maWcudGltZV8yNGhyID8gc2VsZi5jb25maWcuZGVmYXVsdEhvdXIgOiBtaWxpdGFyeTJhbXBtKHNlbGYuY29uZmlnLmRlZmF1bHRIb3VyKSk7DQogICAgICAgIHNlbGYubWludXRlRWxlbWVudC52YWx1ZSA9IHBhZChzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiA/IHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqLmdldE1pbnV0ZXMoKSA6IHNlbGYuY29uZmlnLmRlZmF1bHRNaW51dGUpOw0KICAgICAgICBzZWxmLmhvdXJFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1zdGVwIiwgc2VsZi5jb25maWcuaG91ckluY3JlbWVudC50b1N0cmluZygpKTsNCiAgICAgICAgc2VsZi5taW51dGVFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1zdGVwIiwgc2VsZi5jb25maWcubWludXRlSW5jcmVtZW50LnRvU3RyaW5nKCkpOw0KICAgICAgICBzZWxmLmhvdXJFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1taW4iLCBzZWxmLmNvbmZpZy50aW1lXzI0aHIgPyAiMCIgOiAiMSIpOw0KICAgICAgICBzZWxmLmhvdXJFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1tYXgiLCBzZWxmLmNvbmZpZy50aW1lXzI0aHIgPyAiMjMiIDogIjEyIik7DQogICAgICAgIHNlbGYubWludXRlRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtbWluIiwgIjAiKTsNCiAgICAgICAgc2VsZi5taW51dGVFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1tYXgiLCAiNTkiKTsNCiAgICAgICAgc2VsZi50aW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKGhvdXJJbnB1dCk7DQogICAgICAgIHNlbGYudGltZUNvbnRhaW5lci5hcHBlbmRDaGlsZChzZXBhcmF0b3IpOw0KICAgICAgICBzZWxmLnRpbWVDb250YWluZXIuYXBwZW5kQ2hpbGQobWludXRlSW5wdXQpOw0KICAgICAgICBpZiAoc2VsZi5jb25maWcudGltZV8yNGhyKSBzZWxmLnRpbWVDb250YWluZXIuY2xhc3NMaXN0LmFkZCgidGltZTI0aHIiKTsNCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcuZW5hYmxlU2Vjb25kcykgew0KICAgICAgICAgIHNlbGYudGltZUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJoYXNTZWNvbmRzIik7DQogICAgICAgICAgdmFyIHNlY29uZElucHV0ID0gY3JlYXRlTnVtYmVySW5wdXQoImZsYXRwaWNrci1zZWNvbmQiKTsNCiAgICAgICAgICBzZWxmLnNlY29uZEVsZW1lbnQgPSBzZWNvbmRJbnB1dC5jaGlsZE5vZGVzWzBdOw0KICAgICAgICAgIHNlbGYuc2Vjb25kRWxlbWVudC52YWx1ZSA9IHBhZChzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiA/IHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqLmdldFNlY29uZHMoKSA6IHNlbGYuY29uZmlnLmRlZmF1bHRTZWNvbmRzKTsNCiAgICAgICAgICBzZWxmLnNlY29uZEVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLXN0ZXAiLCBzZWxmLm1pbnV0ZUVsZW1lbnQuZ2V0QXR0cmlidXRlKCJkYXRhLXN0ZXAiKSk7DQogICAgICAgICAgc2VsZi5zZWNvbmRFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1taW4iLCBzZWxmLm1pbnV0ZUVsZW1lbnQuZ2V0QXR0cmlidXRlKCJkYXRhLW1pbiIpKTsNCiAgICAgICAgICBzZWxmLnNlY29uZEVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLW1heCIsIHNlbGYubWludXRlRWxlbWVudC5nZXRBdHRyaWJ1dGUoImRhdGEtbWF4IikpOw0KICAgICAgICAgIHNlbGYudGltZUNvbnRhaW5lci5hcHBlbmRDaGlsZChjcmVhdGVFbGVtZW50KCJzcGFuIiwgImZsYXRwaWNrci10aW1lLXNlcGFyYXRvciIsICI6IikpOw0KICAgICAgICAgIHNlbGYudGltZUNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWNvbmRJbnB1dCk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIXNlbGYuY29uZmlnLnRpbWVfMjRocikgew0KICAgICAgICAgIHNlbGYuYW1QTSA9IGNyZWF0ZUVsZW1lbnQoInNwYW4iLCAiZmxhdHBpY2tyLWFtLXBtIiwgc2VsZi5sMTBuLmFtUE1baW50KChzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiA/IHNlbGYuaG91ckVsZW1lbnQudmFsdWUgOiBzZWxmLmNvbmZpZy5kZWZhdWx0SG91cikgPiAxMSldKTsNCiAgICAgICAgICBzZWxmLmFtUE0udGl0bGUgPSBzZWxmLmwxMG4udG9nZ2xlVGl0bGU7DQogICAgICAgICAgc2VsZi5hbVBNLnRhYkluZGV4ID0gLTE7DQogICAgICAgICAgc2VsZi50aW1lQ29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGYuYW1QTSk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gc2VsZi50aW1lQ29udGFpbmVyOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBidWlsZFdlZWtkYXlzKCkgew0KICAgICAgICBpZiAoIXNlbGYud2Vla2RheUNvbnRhaW5lcikgc2VsZi53ZWVrZGF5Q29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci13ZWVrZGF5cyIpO2Vsc2UgY2xlYXJOb2RlKHNlbGYud2Vla2RheUNvbnRhaW5lcik7DQoNCiAgICAgICAgZm9yICh2YXIgaSA9IHNlbGYuY29uZmlnLnNob3dNb250aHM7IGktLTspIHsNCiAgICAgICAgICB2YXIgY29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci13ZWVrZGF5Y29udGFpbmVyIik7DQogICAgICAgICAgc2VsZi53ZWVrZGF5Q29udGFpbmVyLmFwcGVuZENoaWxkKGNvbnRhaW5lcik7DQogICAgICAgIH0NCg0KICAgICAgICB1cGRhdGVXZWVrZGF5cygpOw0KICAgICAgICByZXR1cm4gc2VsZi53ZWVrZGF5Q29udGFpbmVyOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiB1cGRhdGVXZWVrZGF5cygpIHsNCiAgICAgICAgdmFyIGZpcnN0RGF5T2ZXZWVrID0gc2VsZi5sMTBuLmZpcnN0RGF5T2ZXZWVrOw0KICAgICAgICB2YXIgd2Vla2RheXMgPSBzZWxmLmwxMG4ud2Vla2RheXMuc2hvcnRoYW5kLmNvbmNhdCgpOw0KDQogICAgICAgIGlmIChmaXJzdERheU9mV2VlayA+IDAgJiYgZmlyc3REYXlPZldlZWsgPCB3ZWVrZGF5cy5sZW5ndGgpIHsNCiAgICAgICAgICB3ZWVrZGF5cyA9IHdlZWtkYXlzLnNwbGljZShmaXJzdERheU9mV2Vlaywgd2Vla2RheXMubGVuZ3RoKS5jb25jYXQod2Vla2RheXMuc3BsaWNlKDAsIGZpcnN0RGF5T2ZXZWVrKSk7DQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKHZhciBpID0gc2VsZi5jb25maWcuc2hvd01vbnRoczsgaS0tOykgew0KICAgICAgICAgIHNlbGYud2Vla2RheUNvbnRhaW5lci5jaGlsZHJlbltpXS5pbm5lckhUTUwgPSAiXG4gICAgICA8c3BhbiBjbGFzcz1mbGF0cGlja3Itd2Vla2RheT5cbiAgICAgICAgIiArIHdlZWtkYXlzLmpvaW4oIjwvc3Bhbj48c3BhbiBjbGFzcz1mbGF0cGlja3Itd2Vla2RheT4iKSArICJcbiAgICAgIDwvc3Bhbj5cbiAgICAgICI7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gYnVpbGRXZWVrcygpIHsNCiAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJoYXNXZWVrcyIpOw0KICAgICAgICB2YXIgd2Vla1dyYXBwZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLXdlZWt3cmFwcGVyIik7DQogICAgICAgIHdlZWtXcmFwcGVyLmFwcGVuZENoaWxkKGNyZWF0ZUVsZW1lbnQoInNwYW4iLCAiZmxhdHBpY2tyLXdlZWtkYXkiLCBzZWxmLmwxMG4ud2Vla0FiYnJldmlhdGlvbikpOw0KICAgICAgICB2YXIgd2Vla051bWJlcnMgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLXdlZWtzIik7DQogICAgICAgIHdlZWtXcmFwcGVyLmFwcGVuZENoaWxkKHdlZWtOdW1iZXJzKTsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICB3ZWVrV3JhcHBlcjogd2Vla1dyYXBwZXIsDQogICAgICAgICAgd2Vla051bWJlcnM6IHdlZWtOdW1iZXJzDQogICAgICAgIH07DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGNoYW5nZU1vbnRoKHZhbHVlLCBpc19vZmZzZXQpIHsNCiAgICAgICAgaWYgKGlzX29mZnNldCA9PT0gdm9pZCAwKSB7DQogICAgICAgICAgaXNfb2Zmc2V0ID0gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBkZWx0YSA9IGlzX29mZnNldCA/IHZhbHVlIDogdmFsdWUgLSBzZWxmLmN1cnJlbnRNb250aDsNCiAgICAgICAgaWYgKGRlbHRhIDwgMCAmJiBzZWxmLl9oaWRlUHJldk1vbnRoQXJyb3cgPT09IHRydWUgfHwgZGVsdGEgPiAwICYmIHNlbGYuX2hpZGVOZXh0TW9udGhBcnJvdyA9PT0gdHJ1ZSkgcmV0dXJuOw0KICAgICAgICBzZWxmLmN1cnJlbnRNb250aCArPSBkZWx0YTsNCg0KICAgICAgICBpZiAoc2VsZi5jdXJyZW50TW9udGggPCAwIHx8IHNlbGYuY3VycmVudE1vbnRoID4gMTEpIHsNCiAgICAgICAgICBzZWxmLmN1cnJlbnRZZWFyICs9IHNlbGYuY3VycmVudE1vbnRoID4gMTEgPyAxIDogLTE7DQogICAgICAgICAgc2VsZi5jdXJyZW50TW9udGggPSAoc2VsZi5jdXJyZW50TW9udGggKyAxMikgJSAxMjsNCiAgICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uWWVhckNoYW5nZSIpOw0KICAgICAgICB9DQoNCiAgICAgICAgYnVpbGREYXlzKCk7DQogICAgICAgIHRyaWdnZXJFdmVudCgib25Nb250aENoYW5nZSIpOw0KICAgICAgICB1cGRhdGVOYXZpZ2F0aW9uQ3VycmVudE1vbnRoKCk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGNsZWFyKHRyaWdnZXJDaGFuZ2VFdmVudCkgew0KICAgICAgICBpZiAodHJpZ2dlckNoYW5nZUV2ZW50ID09PSB2b2lkIDApIHsNCiAgICAgICAgICB0cmlnZ2VyQ2hhbmdlRXZlbnQgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgc2VsZi5pbnB1dC52YWx1ZSA9ICIiOw0KICAgICAgICBpZiAoc2VsZi5hbHRJbnB1dCAhPT0gdW5kZWZpbmVkKSBzZWxmLmFsdElucHV0LnZhbHVlID0gIiI7DQogICAgICAgIGlmIChzZWxmLm1vYmlsZUlucHV0ICE9PSB1bmRlZmluZWQpIHNlbGYubW9iaWxlSW5wdXQudmFsdWUgPSAiIjsNCiAgICAgICAgc2VsZi5zZWxlY3RlZERhdGVzID0gW107DQogICAgICAgIHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqID0gdW5kZWZpbmVkOw0KICAgICAgICBzZWxmLnNob3dUaW1lSW5wdXQgPSBmYWxzZTsNCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcuZW5hYmxlVGltZSA9PT0gdHJ1ZSkgew0KICAgICAgICAgIHNldERlZmF1bHRIb3VycygpOw0KICAgICAgICB9DQoNCiAgICAgICAgc2VsZi5yZWRyYXcoKTsNCiAgICAgICAgaWYgKHRyaWdnZXJDaGFuZ2VFdmVudCkgdHJpZ2dlckV2ZW50KCJvbkNoYW5nZSIpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBjbG9zZSgpIHsNCiAgICAgICAgc2VsZi5pc09wZW4gPSBmYWxzZTsNCg0KICAgICAgICBpZiAoIXNlbGYuaXNNb2JpbGUpIHsNCiAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoIm9wZW4iKTsNCg0KICAgICAgICAgIHNlbGYuX2lucHV0LmNsYXNzTGlzdC5yZW1vdmUoImFjdGl2ZSIpOw0KICAgICAgICB9DQoNCiAgICAgICAgdHJpZ2dlckV2ZW50KCJvbkNsb3NlIik7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGRlc3Ryb3koKSB7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZyAhPT0gdW5kZWZpbmVkKSB0cmlnZ2VyRXZlbnQoIm9uRGVzdHJveSIpOw0KDQogICAgICAgIGZvciAodmFyIGkgPSBzZWxmLl9oYW5kbGVycy5sZW5ndGg7IGktLTspIHsNCiAgICAgICAgICB2YXIgaCA9IHNlbGYuX2hhbmRsZXJzW2ldOw0KICAgICAgICAgIGguZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGguZXZlbnQsIGguaGFuZGxlciwgaC5vcHRpb25zKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHNlbGYuX2hhbmRsZXJzID0gW107DQoNCiAgICAgICAgaWYgKHNlbGYubW9iaWxlSW5wdXQpIHsNCiAgICAgICAgICBpZiAoc2VsZi5tb2JpbGVJbnB1dC5wYXJlbnROb2RlKSBzZWxmLm1vYmlsZUlucHV0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2VsZi5tb2JpbGVJbnB1dCk7DQogICAgICAgICAgc2VsZi5tb2JpbGVJbnB1dCA9IHVuZGVmaW5lZDsNCiAgICAgICAgfSBlbHNlIGlmIChzZWxmLmNhbGVuZGFyQ29udGFpbmVyICYmIHNlbGYuY2FsZW5kYXJDb250YWluZXIucGFyZW50Tm9kZSkgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNlbGYuY2FsZW5kYXJDb250YWluZXIpOw0KDQogICAgICAgIGlmIChzZWxmLmFsdElucHV0KSB7DQogICAgICAgICAgc2VsZi5pbnB1dC50eXBlID0gInRleHQiOw0KICAgICAgICAgIGlmIChzZWxmLmFsdElucHV0LnBhcmVudE5vZGUpIHNlbGYuYWx0SW5wdXQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzZWxmLmFsdElucHV0KTsNCiAgICAgICAgICBkZWxldGUgc2VsZi5hbHRJbnB1dDsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLmlucHV0KSB7DQogICAgICAgICAgc2VsZi5pbnB1dC50eXBlID0gc2VsZi5pbnB1dC5fdHlwZTsNCiAgICAgICAgICBzZWxmLmlucHV0LmNsYXNzTGlzdC5yZW1vdmUoImZsYXRwaWNrci1pbnB1dCIpOw0KICAgICAgICAgIHNlbGYuaW5wdXQucmVtb3ZlQXR0cmlidXRlKCJyZWFkb25seSIpOw0KICAgICAgICAgIHNlbGYuaW5wdXQudmFsdWUgPSAiIjsNCiAgICAgICAgfQ0KDQogICAgICAgIFsiX3Nob3dUaW1lSW5wdXQiLCAibGF0ZXN0U2VsZWN0ZWREYXRlT2JqIiwgIl9oaWRlTmV4dE1vbnRoQXJyb3ciLCAiX2hpZGVQcmV2TW9udGhBcnJvdyIsICJfX2hpZGVOZXh0TW9udGhBcnJvdyIsICJfX2hpZGVQcmV2TW9udGhBcnJvdyIsICJpc01vYmlsZSIsICJpc09wZW4iLCAic2VsZWN0ZWREYXRlRWxlbSIsICJtaW5EYXRlSGFzVGltZSIsICJtYXhEYXRlSGFzVGltZSIsICJkYXlzIiwgImRheXNDb250YWluZXIiLCAiX2lucHV0IiwgIl9wb3NpdGlvbkVsZW1lbnQiLCAiaW5uZXJDb250YWluZXIiLCAickNvbnRhaW5lciIsICJtb250aE5hdiIsICJ0b2RheURhdGVFbGVtIiwgImNhbGVuZGFyQ29udGFpbmVyIiwgIndlZWtkYXlDb250YWluZXIiLCAicHJldk1vbnRoTmF2IiwgIm5leHRNb250aE5hdiIsICJjdXJyZW50TW9udGhFbGVtZW50IiwgImN1cnJlbnRZZWFyRWxlbWVudCIsICJuYXZpZ2F0aW9uQ3VycmVudE1vbnRoIiwgInNlbGVjdGVkRGF0ZUVsZW0iLCAiY29uZmlnIl0uZm9yRWFjaChmdW5jdGlvbiAoaykgew0KICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICBkZWxldGUgc2VsZltrXTsNCiAgICAgICAgICB9IGNhdGNoIChfKSB7fQ0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gaXNDYWxlbmRhckVsZW0oZWxlbSkgew0KICAgICAgICBpZiAoc2VsZi5jb25maWcuYXBwZW5kVG8gJiYgc2VsZi5jb25maWcuYXBwZW5kVG8uY29udGFpbnMoZWxlbSkpIHJldHVybiB0cnVlOw0KICAgICAgICByZXR1cm4gc2VsZi5jYWxlbmRhckNvbnRhaW5lci5jb250YWlucyhlbGVtKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDbGljayhlKSB7DQogICAgICAgIGlmIChzZWxmLmlzT3BlbiAmJiAhc2VsZi5jb25maWcuaW5saW5lKSB7DQogICAgICAgICAgdmFyIGlzQ2FsZW5kYXJFbGVtZW50ID0gaXNDYWxlbmRhckVsZW0oZS50YXJnZXQpOw0KICAgICAgICAgIHZhciBpc0lucHV0ID0gZS50YXJnZXQgPT09IHNlbGYuaW5wdXQgfHwgZS50YXJnZXQgPT09IHNlbGYuYWx0SW5wdXQgfHwgc2VsZi5lbGVtZW50LmNvbnRhaW5zKGUudGFyZ2V0KSB8fCBlLnBhdGggJiYgZS5wYXRoLmluZGV4T2YgJiYgKH5lLnBhdGguaW5kZXhPZihzZWxmLmlucHV0KSB8fCB+ZS5wYXRoLmluZGV4T2Yoc2VsZi5hbHRJbnB1dCkpOw0KICAgICAgICAgIHZhciBsb3N0Rm9jdXMgPSBlLnR5cGUgPT09ICJibHVyIiA/IGlzSW5wdXQgJiYgZS5yZWxhdGVkVGFyZ2V0ICYmICFpc0NhbGVuZGFyRWxlbShlLnJlbGF0ZWRUYXJnZXQpIDogIWlzSW5wdXQgJiYgIWlzQ2FsZW5kYXJFbGVtZW50Ow0KICAgICAgICAgIHZhciBpc0lnbm9yZWQgPSAhc2VsZi5jb25maWcuaWdub3JlZEZvY3VzRWxlbWVudHMuc29tZShmdW5jdGlvbiAoZWxlbSkgew0KICAgICAgICAgICAgcmV0dXJuIGVsZW0uY29udGFpbnMoZS50YXJnZXQpOw0KICAgICAgICAgIH0pOw0KDQogICAgICAgICAgaWYgKGxvc3RGb2N1cyAmJiBpc0lnbm9yZWQpIHsNCiAgICAgICAgICAgIHNlbGYuY2xvc2UoKTsNCg0KICAgICAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1vZGUgPT09ICJyYW5nZSIgJiYgc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA9PT0gMSkgew0KICAgICAgICAgICAgICBzZWxmLmNsZWFyKGZhbHNlKTsNCiAgICAgICAgICAgICAgc2VsZi5yZWRyYXcoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gY2hhbmdlWWVhcihuZXdZZWFyKSB7DQogICAgICAgIGlmICghbmV3WWVhciB8fCBzZWxmLmNvbmZpZy5taW5EYXRlICYmIG5ld1llYXIgPCBzZWxmLmNvbmZpZy5taW5EYXRlLmdldEZ1bGxZZWFyKCkgfHwgc2VsZi5jb25maWcubWF4RGF0ZSAmJiBuZXdZZWFyID4gc2VsZi5jb25maWcubWF4RGF0ZS5nZXRGdWxsWWVhcigpKSByZXR1cm47DQogICAgICAgIHZhciBuZXdZZWFyTnVtID0gbmV3WWVhciwNCiAgICAgICAgICAgIGlzTmV3WWVhciA9IHNlbGYuY3VycmVudFllYXIgIT09IG5ld1llYXJOdW07DQogICAgICAgIHNlbGYuY3VycmVudFllYXIgPSBuZXdZZWFyTnVtIHx8IHNlbGYuY3VycmVudFllYXI7DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1heERhdGUgJiYgc2VsZi5jdXJyZW50WWVhciA9PT0gc2VsZi5jb25maWcubWF4RGF0ZS5nZXRGdWxsWWVhcigpKSB7DQogICAgICAgICAgc2VsZi5jdXJyZW50TW9udGggPSBNYXRoLm1pbihzZWxmLmNvbmZpZy5tYXhEYXRlLmdldE1vbnRoKCksIHNlbGYuY3VycmVudE1vbnRoKTsNCiAgICAgICAgfSBlbHNlIGlmIChzZWxmLmNvbmZpZy5taW5EYXRlICYmIHNlbGYuY3VycmVudFllYXIgPT09IHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0RnVsbFllYXIoKSkgew0KICAgICAgICAgIHNlbGYuY3VycmVudE1vbnRoID0gTWF0aC5tYXgoc2VsZi5jb25maWcubWluRGF0ZS5nZXRNb250aCgpLCBzZWxmLmN1cnJlbnRNb250aCk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoaXNOZXdZZWFyKSB7DQogICAgICAgICAgc2VsZi5yZWRyYXcoKTsNCiAgICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uWWVhckNoYW5nZSIpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGlzRW5hYmxlZChkYXRlLCB0aW1lbGVzcykgew0KICAgICAgICBpZiAodGltZWxlc3MgPT09IHZvaWQgMCkgew0KICAgICAgICAgIHRpbWVsZXNzID0gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBkYXRlVG9DaGVjayA9IHNlbGYucGFyc2VEYXRlKGRhdGUsIHVuZGVmaW5lZCwgdGltZWxlc3MpOw0KICAgICAgICBpZiAoc2VsZi5jb25maWcubWluRGF0ZSAmJiBkYXRlVG9DaGVjayAmJiBjb21wYXJlRGF0ZXMoZGF0ZVRvQ2hlY2ssIHNlbGYuY29uZmlnLm1pbkRhdGUsIHRpbWVsZXNzICE9PSB1bmRlZmluZWQgPyB0aW1lbGVzcyA6ICFzZWxmLm1pbkRhdGVIYXNUaW1lKSA8IDAgfHwgc2VsZi5jb25maWcubWF4RGF0ZSAmJiBkYXRlVG9DaGVjayAmJiBjb21wYXJlRGF0ZXMoZGF0ZVRvQ2hlY2ssIHNlbGYuY29uZmlnLm1heERhdGUsIHRpbWVsZXNzICE9PSB1bmRlZmluZWQgPyB0aW1lbGVzcyA6ICFzZWxmLm1heERhdGVIYXNUaW1lKSA+IDApIHJldHVybiBmYWxzZTsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmVuYWJsZS5sZW5ndGggPT09IDAgJiYgc2VsZi5jb25maWcuZGlzYWJsZS5sZW5ndGggPT09IDApIHJldHVybiB0cnVlOw0KICAgICAgICBpZiAoZGF0ZVRvQ2hlY2sgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGZhbHNlOw0KICAgICAgICB2YXIgYm9vbCA9IHNlbGYuY29uZmlnLmVuYWJsZS5sZW5ndGggPiAwLA0KICAgICAgICAgICAgYXJyYXkgPSBib29sID8gc2VsZi5jb25maWcuZW5hYmxlIDogc2VsZi5jb25maWcuZGlzYWJsZTsNCg0KICAgICAgICBmb3IgKHZhciBpID0gMCwgZDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgZCA9IGFycmF5W2ldOw0KICAgICAgICAgIGlmICh0eXBlb2YgZCA9PT0gImZ1bmN0aW9uIiAmJiBkKGRhdGVUb0NoZWNrKSkgcmV0dXJuIGJvb2w7ZWxzZSBpZiAoZCBpbnN0YW5jZW9mIERhdGUgJiYgZGF0ZVRvQ2hlY2sgIT09IHVuZGVmaW5lZCAmJiBkLmdldFRpbWUoKSA9PT0gZGF0ZVRvQ2hlY2suZ2V0VGltZSgpKSByZXR1cm4gYm9vbDtlbHNlIGlmICh0eXBlb2YgZCA9PT0gInN0cmluZyIgJiYgZGF0ZVRvQ2hlY2sgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgdmFyIHBhcnNlZCA9IHNlbGYucGFyc2VEYXRlKGQsIHVuZGVmaW5lZCwgdHJ1ZSk7DQogICAgICAgICAgICByZXR1cm4gcGFyc2VkICYmIHBhcnNlZC5nZXRUaW1lKCkgPT09IGRhdGVUb0NoZWNrLmdldFRpbWUoKSA/IGJvb2wgOiAhYm9vbDsNCiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkID09PSAib2JqZWN0IiAmJiBkYXRlVG9DaGVjayAhPT0gdW5kZWZpbmVkICYmIGQuZnJvbSAmJiBkLnRvICYmIGRhdGVUb0NoZWNrLmdldFRpbWUoKSA+PSBkLmZyb20uZ2V0VGltZSgpICYmIGRhdGVUb0NoZWNrLmdldFRpbWUoKSA8PSBkLnRvLmdldFRpbWUoKSkgcmV0dXJuIGJvb2w7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gIWJvb2w7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGlzSW5WaWV3KGVsZW0pIHsNCiAgICAgICAgaWYgKHNlbGYuZGF5c0NvbnRhaW5lciAhPT0gdW5kZWZpbmVkKSByZXR1cm4gZWxlbS5jbGFzc05hbWUuaW5kZXhPZigiaGlkZGVuIikgPT09IC0xICYmIHNlbGYuZGF5c0NvbnRhaW5lci5jb250YWlucyhlbGVtKTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBvbktleURvd24oZSkgew0KICAgICAgICB2YXIgaXNJbnB1dCA9IGUudGFyZ2V0ID09PSBzZWxmLl9pbnB1dDsNCiAgICAgICAgdmFyIGFsbG93SW5wdXQgPSBzZWxmLmNvbmZpZy5hbGxvd0lucHV0Ow0KICAgICAgICB2YXIgYWxsb3dLZXlkb3duID0gc2VsZi5pc09wZW4gJiYgKCFhbGxvd0lucHV0IHx8ICFpc0lucHV0KTsNCiAgICAgICAgdmFyIGFsbG93SW5saW5lS2V5ZG93biA9IHNlbGYuY29uZmlnLmlubGluZSAmJiBpc0lucHV0ICYmICFhbGxvd0lucHV0Ow0KDQogICAgICAgIGlmIChlLmtleUNvZGUgPT09IDEzICYmIGlzSW5wdXQpIHsNCiAgICAgICAgICBpZiAoYWxsb3dJbnB1dCkgew0KICAgICAgICAgICAgc2VsZi5zZXREYXRlKHNlbGYuX2lucHV0LnZhbHVlLCB0cnVlLCBlLnRhcmdldCA9PT0gc2VsZi5hbHRJbnB1dCA/IHNlbGYuY29uZmlnLmFsdEZvcm1hdCA6IHNlbGYuY29uZmlnLmRhdGVGb3JtYXQpOw0KICAgICAgICAgICAgcmV0dXJuIGUudGFyZ2V0LmJsdXIoKTsNCiAgICAgICAgICB9IGVsc2Ugc2VsZi5vcGVuKCk7DQogICAgICAgIH0gZWxzZSBpZiAoaXNDYWxlbmRhckVsZW0oZS50YXJnZXQpIHx8IGFsbG93S2V5ZG93biB8fCBhbGxvd0lubGluZUtleWRvd24pIHsNCiAgICAgICAgICB2YXIgaXNUaW1lT2JqID0gISFzZWxmLnRpbWVDb250YWluZXIgJiYgc2VsZi50aW1lQ29udGFpbmVyLmNvbnRhaW5zKGUudGFyZ2V0KTsNCg0KICAgICAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7DQogICAgICAgICAgICBjYXNlIDEzOg0KICAgICAgICAgICAgICBpZiAoaXNUaW1lT2JqKSB1cGRhdGVUaW1lKCk7ZWxzZSBzZWxlY3REYXRlKGUpOw0KICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSAyNzoNCiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgICBmb2N1c0FuZENsb3NlKCk7DQogICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIDg6DQogICAgICAgICAgICBjYXNlIDQ2Og0KICAgICAgICAgICAgICBpZiAoaXNJbnB1dCAmJiAhc2VsZi5jb25maWcuYWxsb3dJbnB1dCkgew0KICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgICBzZWxmLmNsZWFyKCk7DQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSAzNzoNCiAgICAgICAgICAgIGNhc2UgMzk6DQogICAgICAgICAgICAgIGlmICghaXNUaW1lT2JqKSB7DQogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KDQogICAgICAgICAgICAgICAgaWYgKHNlbGYuZGF5c0NvbnRhaW5lciAhPT0gdW5kZWZpbmVkICYmIChhbGxvd0lucHV0ID09PSBmYWxzZSB8fCBpc0luVmlldyhkb2N1bWVudC5hY3RpdmVFbGVtZW50KSkpIHsNCiAgICAgICAgICAgICAgICAgIHZhciBfZGVsdGEgPSBlLmtleUNvZGUgPT09IDM5ID8gMSA6IC0xOw0KDQogICAgICAgICAgICAgICAgICBpZiAoIWUuY3RybEtleSkgZm9jdXNPbkRheSh1bmRlZmluZWQsIF9kZWx0YSk7ZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGNoYW5nZU1vbnRoKF9kZWx0YSk7DQogICAgICAgICAgICAgICAgICAgIGZvY3VzT25EYXkoZ2V0Rmlyc3RBdmFpbGFibGVEYXkoMSksIDApOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZWxmLmhvdXJFbGVtZW50KSBzZWxmLmhvdXJFbGVtZW50LmZvY3VzKCk7DQoNCiAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgMzg6DQogICAgICAgICAgICBjYXNlIDQwOg0KICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgIHZhciBkZWx0YSA9IGUua2V5Q29kZSA9PT0gNDAgPyAxIDogLTE7DQoNCiAgICAgICAgICAgICAgaWYgKHNlbGYuZGF5c0NvbnRhaW5lcikgew0KICAgICAgICAgICAgICAgIGlmIChlLmN0cmxLZXkpIHsNCiAgICAgICAgICAgICAgICAgIGNoYW5nZVllYXIoc2VsZi5jdXJyZW50WWVhciAtIGRlbHRhKTsNCiAgICAgICAgICAgICAgICAgIGZvY3VzT25EYXkoZ2V0Rmlyc3RBdmFpbGFibGVEYXkoMSksIDApOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzVGltZU9iaikgZm9jdXNPbkRheSh1bmRlZmluZWQsIGRlbHRhICogNyk7DQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VsZi5jb25maWcuZW5hYmxlVGltZSkgew0KICAgICAgICAgICAgICAgIGlmICghaXNUaW1lT2JqICYmIHNlbGYuaG91ckVsZW1lbnQpIHNlbGYuaG91ckVsZW1lbnQuZm9jdXMoKTsNCiAgICAgICAgICAgICAgICB1cGRhdGVUaW1lKGUpOw0KDQogICAgICAgICAgICAgICAgc2VsZi5fZGVib3VuY2VkQ2hhbmdlKCk7DQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSA5Og0KICAgICAgICAgICAgICBpZiAoIWlzVGltZU9iaikgYnJlYWs7DQogICAgICAgICAgICAgIHZhciBlbGVtcyA9IFtzZWxmLmhvdXJFbGVtZW50LCBzZWxmLm1pbnV0ZUVsZW1lbnQsIHNlbGYuc2Vjb25kRWxlbWVudCwgc2VsZi5hbVBNXS5maWx0ZXIoZnVuY3Rpb24gKHgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4geDsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIHZhciBpID0gZWxlbXMuaW5kZXhPZihlLnRhcmdldCk7DQoNCiAgICAgICAgICAgICAgaWYgKGkgIT09IC0xKSB7DQogICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IGVsZW1zW2kgKyAoZS5zaGlmdEtleSA/IC0xIDogMSldOw0KDQogICAgICAgICAgICAgICAgaWYgKHRhcmdldCAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgICAgICB0YXJnZXQuZm9jdXMoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYuYW1QTSAhPT0gdW5kZWZpbmVkICYmIGUudGFyZ2V0ID09PSBzZWxmLmFtUE0pIHsNCiAgICAgICAgICBzd2l0Y2ggKGUua2V5KSB7DQogICAgICAgICAgICBjYXNlIHNlbGYubDEwbi5hbVBNWzBdLmNoYXJBdCgwKToNCiAgICAgICAgICAgIGNhc2Ugc2VsZi5sMTBuLmFtUE1bMF0uY2hhckF0KDApLnRvTG93ZXJDYXNlKCk6DQogICAgICAgICAgICAgIHNlbGYuYW1QTS50ZXh0Q29udGVudCA9IHNlbGYubDEwbi5hbVBNWzBdOw0KICAgICAgICAgICAgICBzZXRIb3Vyc0Zyb21JbnB1dHMoKTsNCiAgICAgICAgICAgICAgdXBkYXRlVmFsdWUoKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2Ugc2VsZi5sMTBuLmFtUE1bMV0uY2hhckF0KDApOg0KICAgICAgICAgICAgY2FzZSBzZWxmLmwxMG4uYW1QTVsxXS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKToNCiAgICAgICAgICAgICAgc2VsZi5hbVBNLnRleHRDb250ZW50ID0gc2VsZi5sMTBuLmFtUE1bMV07DQogICAgICAgICAgICAgIHNldEhvdXJzRnJvbUlucHV0cygpOw0KICAgICAgICAgICAgICB1cGRhdGVWYWx1ZSgpOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uS2V5RG93biIsIGUpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBvbk1vdXNlT3ZlcihlbGVtKSB7DQogICAgICAgIGlmIChzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoICE9PSAxIHx8ICFlbGVtLmNsYXNzTGlzdC5jb250YWlucygiZmxhdHBpY2tyLWRheSIpIHx8IGVsZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCJkaXNhYmxlZCIpKSByZXR1cm47DQogICAgICAgIHZhciBob3ZlckRhdGUgPSBlbGVtLmRhdGVPYmouZ2V0VGltZSgpLA0KICAgICAgICAgICAgaW5pdGlhbERhdGUgPSBzZWxmLnBhcnNlRGF0ZShzZWxmLnNlbGVjdGVkRGF0ZXNbMF0sIHVuZGVmaW5lZCwgdHJ1ZSkuZ2V0VGltZSgpLA0KICAgICAgICAgICAgcmFuZ2VTdGFydERhdGUgPSBNYXRoLm1pbihob3ZlckRhdGUsIHNlbGYuc2VsZWN0ZWREYXRlc1swXS5nZXRUaW1lKCkpLA0KICAgICAgICAgICAgcmFuZ2VFbmREYXRlID0gTWF0aC5tYXgoaG92ZXJEYXRlLCBzZWxmLnNlbGVjdGVkRGF0ZXNbMF0uZ2V0VGltZSgpKTsNCiAgICAgICAgdmFyIGNvbnRhaW5zRGlzYWJsZWQgPSBmYWxzZTsNCiAgICAgICAgdmFyIG1pblJhbmdlID0gMCwNCiAgICAgICAgICAgIG1heFJhbmdlID0gMDsNCg0KICAgICAgICBmb3IgKHZhciB0ID0gcmFuZ2VTdGFydERhdGU7IHQgPCByYW5nZUVuZERhdGU7IHQgKz0gZHVyYXRpb24uREFZKSB7DQogICAgICAgICAgaWYgKCFpc0VuYWJsZWQobmV3IERhdGUodCksIHRydWUpKSB7DQogICAgICAgICAgICBjb250YWluc0Rpc2FibGVkID0gY29udGFpbnNEaXNhYmxlZCB8fCB0ID4gcmFuZ2VTdGFydERhdGUgJiYgdCA8IHJhbmdlRW5kRGF0ZTsNCiAgICAgICAgICAgIGlmICh0IDwgaW5pdGlhbERhdGUgJiYgKCFtaW5SYW5nZSB8fCB0ID4gbWluUmFuZ2UpKSBtaW5SYW5nZSA9IHQ7ZWxzZSBpZiAodCA+IGluaXRpYWxEYXRlICYmICghbWF4UmFuZ2UgfHwgdCA8IG1heFJhbmdlKSkgbWF4UmFuZ2UgPSB0Ow0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAodmFyIG0gPSAwOyBtIDwgc2VsZi5jb25maWcuc2hvd01vbnRoczsgbSsrKSB7DQogICAgICAgICAgdmFyIG1vbnRoID0gc2VsZi5kYXlzQ29udGFpbmVyLmNoaWxkcmVuW21dOw0KICAgICAgICAgIHZhciBwcmV2TW9udGggPSBzZWxmLmRheXNDb250YWluZXIuY2hpbGRyZW5bbSAtIDFdOw0KDQogICAgICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoaSwgbCkgew0KICAgICAgICAgICAgdmFyIGRheUVsZW0gPSBtb250aC5jaGlsZHJlbltpXSwNCiAgICAgICAgICAgICAgICBkYXRlID0gZGF5RWxlbS5kYXRlT2JqOw0KICAgICAgICAgICAgdmFyIHRpbWVzdGFtcCA9IGRhdGUuZ2V0VGltZSgpOw0KICAgICAgICAgICAgdmFyIG91dE9mUmFuZ2UgPSBtaW5SYW5nZSA+IDAgJiYgdGltZXN0YW1wIDwgbWluUmFuZ2UgfHwgbWF4UmFuZ2UgPiAwICYmIHRpbWVzdGFtcCA+IG1heFJhbmdlOw0KDQogICAgICAgICAgICBpZiAob3V0T2ZSYW5nZSkgew0KICAgICAgICAgICAgICBkYXlFbGVtLmNsYXNzTGlzdC5hZGQoIm5vdEFsbG93ZWQiKTsNCiAgICAgICAgICAgICAgWyJpblJhbmdlIiwgInN0YXJ0UmFuZ2UiLCAiZW5kUmFuZ2UiXS5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7DQogICAgICAgICAgICAgICAgZGF5RWxlbS5jbGFzc0xpc3QucmVtb3ZlKGMpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgcmV0dXJuICJjb250aW51ZSI7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRhaW5zRGlzYWJsZWQgJiYgIW91dE9mUmFuZ2UpIHJldHVybiAiY29udGludWUiOw0KDQogICAgICAgICAgICBbInN0YXJ0UmFuZ2UiLCAiaW5SYW5nZSIsICJlbmRSYW5nZSIsICJub3RBbGxvd2VkIl0uZm9yRWFjaChmdW5jdGlvbiAoYykgew0KICAgICAgICAgICAgICBkYXlFbGVtLmNsYXNzTGlzdC5yZW1vdmUoYyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZChob3ZlckRhdGUgPCBzZWxmLnNlbGVjdGVkRGF0ZXNbMF0uZ2V0VGltZSgpID8gInN0YXJ0UmFuZ2UiIDogImVuZFJhbmdlIik7DQoNCiAgICAgICAgICAgIGlmIChtb250aC5jb250YWlucyhlbGVtKSB8fCAhKG0gPiAwICYmIHByZXZNb250aCAmJiBwcmV2TW9udGgubGFzdENoaWxkLmRhdGVPYmouZ2V0VGltZSgpID49IHRpbWVzdGFtcCkpIHsNCiAgICAgICAgICAgICAgaWYgKGluaXRpYWxEYXRlIDwgaG92ZXJEYXRlICYmIHRpbWVzdGFtcCA9PT0gaW5pdGlhbERhdGUpIGRheUVsZW0uY2xhc3NMaXN0LmFkZCgic3RhcnRSYW5nZSIpO2Vsc2UgaWYgKGluaXRpYWxEYXRlID4gaG92ZXJEYXRlICYmIHRpbWVzdGFtcCA9PT0gaW5pdGlhbERhdGUpIGRheUVsZW0uY2xhc3NMaXN0LmFkZCgiZW5kUmFuZ2UiKTsNCiAgICAgICAgICAgICAgaWYgKHRpbWVzdGFtcCA+PSBtaW5SYW5nZSAmJiAobWF4UmFuZ2UgPT09IDAgfHwgdGltZXN0YW1wIDw9IG1heFJhbmdlKSAmJiBpc0JldHdlZW4odGltZXN0YW1wLCBpbml0aWFsRGF0ZSwgaG92ZXJEYXRlKSkgZGF5RWxlbS5jbGFzc0xpc3QuYWRkKCJpblJhbmdlIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfTsNCg0KICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbW9udGguY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSsrKSB7DQogICAgICAgICAgICB2YXIgX3JldCA9IF9sb29wKGksIGwpOw0KDQogICAgICAgICAgICBpZiAoX3JldCA9PT0gImNvbnRpbnVlIikgY29udGludWU7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIG9uUmVzaXplKCkgew0KICAgICAgICBpZiAoc2VsZi5pc09wZW4gJiYgIXNlbGYuY29uZmlnLnN0YXRpYyAmJiAhc2VsZi5jb25maWcuaW5saW5lKSBwb3NpdGlvbkNhbGVuZGFyKCk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIG9wZW4oZSwgcG9zaXRpb25FbGVtZW50KSB7DQogICAgICAgIGlmIChwb3NpdGlvbkVsZW1lbnQgPT09IHZvaWQgMCkgew0KICAgICAgICAgIHBvc2l0aW9uRWxlbWVudCA9IHNlbGYuX2lucHV0Ow0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGYuaXNNb2JpbGUgPT09IHRydWUpIHsNCiAgICAgICAgICBpZiAoZSkgew0KICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgZS50YXJnZXQgJiYgZS50YXJnZXQuYmx1cigpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgc2VsZi5tb2JpbGVJbnB1dCAhPT0gdW5kZWZpbmVkICYmIHNlbGYubW9iaWxlSW5wdXQuZm9jdXMoKTsNCiAgICAgICAgICB9LCAwKTsNCiAgICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uT3BlbiIpOw0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLl9pbnB1dC5kaXNhYmxlZCB8fCBzZWxmLmNvbmZpZy5pbmxpbmUpIHJldHVybjsNCiAgICAgICAgdmFyIHdhc09wZW4gPSBzZWxmLmlzT3BlbjsNCiAgICAgICAgc2VsZi5pc09wZW4gPSB0cnVlOw0KDQogICAgICAgIGlmICghd2FzT3Blbikgew0KICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuY2xhc3NMaXN0LmFkZCgib3BlbiIpOw0KDQogICAgICAgICAgc2VsZi5faW5wdXQuY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7DQoNCiAgICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uT3BlbiIpOw0KICAgICAgICAgIHBvc2l0aW9uQ2FsZW5kYXIocG9zaXRpb25FbGVtZW50KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5lbmFibGVUaW1lID09PSB0cnVlICYmIHNlbGYuY29uZmlnLm5vQ2FsZW5kYXIgPT09IHRydWUpIHsNCiAgICAgICAgICBpZiAoc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgc2VsZi5zZXREYXRlKHNlbGYuY29uZmlnLm1pbkRhdGUgIT09IHVuZGVmaW5lZCA/IG5ldyBEYXRlKHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0VGltZSgpKSA6IG5ldyBEYXRlKCksIGZhbHNlKTsNCiAgICAgICAgICAgIHNldERlZmF1bHRIb3VycygpOw0KICAgICAgICAgICAgdXBkYXRlVmFsdWUoKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpZiAoc2VsZi5jb25maWcuYWxsb3dJbnB1dCA9PT0gZmFsc2UgJiYgKGUgPT09IHVuZGVmaW5lZCB8fCAhc2VsZi50aW1lQ29udGFpbmVyLmNvbnRhaW5zKGUucmVsYXRlZFRhcmdldCkpKSB7DQogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuaG91ckVsZW1lbnQuc2VsZWN0KCk7DQogICAgICAgICAgICB9LCA1MCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIG1pbk1heERhdGVTZXR0ZXIodHlwZSkgew0KICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGRhdGUpIHsNCiAgICAgICAgICB2YXIgZGF0ZU9iaiA9IHNlbGYuY29uZmlnWyJfIiArIHR5cGUgKyAiRGF0ZSJdID0gc2VsZi5wYXJzZURhdGUoZGF0ZSwgc2VsZi5jb25maWcuZGF0ZUZvcm1hdCk7DQogICAgICAgICAgdmFyIGludmVyc2VEYXRlT2JqID0gc2VsZi5jb25maWdbIl8iICsgKHR5cGUgPT09ICJtaW4iID8gIm1heCIgOiAibWluIikgKyAiRGF0ZSJdOw0KDQogICAgICAgICAgaWYgKGRhdGVPYmogIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgc2VsZlt0eXBlID09PSAibWluIiA/ICJtaW5EYXRlSGFzVGltZSIgOiAibWF4RGF0ZUhhc1RpbWUiXSA9IGRhdGVPYmouZ2V0SG91cnMoKSA+IDAgfHwgZGF0ZU9iai5nZXRNaW51dGVzKCkgPiAwIHx8IGRhdGVPYmouZ2V0U2Vjb25kcygpID4gMDsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpZiAoc2VsZi5zZWxlY3RlZERhdGVzKSB7DQogICAgICAgICAgICBzZWxmLnNlbGVjdGVkRGF0ZXMgPSBzZWxmLnNlbGVjdGVkRGF0ZXMuZmlsdGVyKGZ1bmN0aW9uIChkKSB7DQogICAgICAgICAgICAgIHJldHVybiBpc0VuYWJsZWQoZCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGlmICghc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCAmJiB0eXBlID09PSAibWluIikgc2V0SG91cnNGcm9tRGF0ZShkYXRlT2JqKTsNCiAgICAgICAgICAgIHVwZGF0ZVZhbHVlKCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgaWYgKHNlbGYuZGF5c0NvbnRhaW5lcikgew0KICAgICAgICAgICAgcmVkcmF3KCk7DQogICAgICAgICAgICBpZiAoZGF0ZU9iaiAhPT0gdW5kZWZpbmVkKSBzZWxmLmN1cnJlbnRZZWFyRWxlbWVudFt0eXBlXSA9IGRhdGVPYmouZ2V0RnVsbFllYXIoKS50b1N0cmluZygpO2Vsc2Ugc2VsZi5jdXJyZW50WWVhckVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKHR5cGUpOw0KICAgICAgICAgICAgc2VsZi5jdXJyZW50WWVhckVsZW1lbnQuZGlzYWJsZWQgPSAhIWludmVyc2VEYXRlT2JqICYmIGRhdGVPYmogIT09IHVuZGVmaW5lZCAmJiBpbnZlcnNlRGF0ZU9iai5nZXRGdWxsWWVhcigpID09PSBkYXRlT2JqLmdldEZ1bGxZZWFyKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBwYXJzZUNvbmZpZygpIHsNCiAgICAgICAgdmFyIGJvb2xPcHRzID0gWyJ3cmFwIiwgIndlZWtOdW1iZXJzIiwgImFsbG93SW5wdXQiLCAiY2xpY2tPcGVucyIsICJ0aW1lXzI0aHIiLCAiZW5hYmxlVGltZSIsICJub0NhbGVuZGFyIiwgImFsdElucHV0IiwgInNob3J0aGFuZEN1cnJlbnRNb250aCIsICJpbmxpbmUiLCAic3RhdGljIiwgImVuYWJsZVNlY29uZHMiLCAiZGlzYWJsZU1vYmlsZSJdOw0KICAgICAgICB2YXIgaG9va3MgPSBbIm9uQ2hhbmdlIiwgIm9uQ2xvc2UiLCAib25EYXlDcmVhdGUiLCAib25EZXN0cm95IiwgIm9uS2V5RG93biIsICJvbk1vbnRoQ2hhbmdlIiwgIm9uT3BlbiIsICJvblBhcnNlQ29uZmlnIiwgIm9uUmVhZHkiLCAib25WYWx1ZVVwZGF0ZSIsICJvblllYXJDaGFuZ2UiLCAib25QcmVDYWxlbmRhclBvc2l0aW9uIl07DQogICAgICAgIHZhciB1c2VyQ29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgaW5zdGFuY2VDb25maWcsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZWxlbWVudC5kYXRhc2V0IHx8IHt9KSkpOw0KICAgICAgICB2YXIgZm9ybWF0cyQkMSA9IHt9Ow0KICAgICAgICBzZWxmLmNvbmZpZy5wYXJzZURhdGUgPSB1c2VyQ29uZmlnLnBhcnNlRGF0ZTsNCiAgICAgICAgc2VsZi5jb25maWcuZm9ybWF0RGF0ZSA9IHVzZXJDb25maWcuZm9ybWF0RGF0ZTsNCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYuY29uZmlnLCAiZW5hYmxlIiwgew0KICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLl9lbmFibGU7DQogICAgICAgICAgfSwNCiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChkYXRlcykgew0KICAgICAgICAgICAgc2VsZi5jb25maWcuX2VuYWJsZSA9IHBhcnNlRGF0ZVJ1bGVzKGRhdGVzKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5jb25maWcsICJkaXNhYmxlIiwgew0KICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLl9kaXNhYmxlOw0KICAgICAgICAgIH0sDQogICAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoZGF0ZXMpIHsNCiAgICAgICAgICAgIHNlbGYuY29uZmlnLl9kaXNhYmxlID0gcGFyc2VEYXRlUnVsZXMoZGF0ZXMpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIHZhciB0aW1lTW9kZSA9IHVzZXJDb25maWcubW9kZSA9PT0gInRpbWUiOw0KDQogICAgICAgIGlmICghdXNlckNvbmZpZy5kYXRlRm9ybWF0ICYmICh1c2VyQ29uZmlnLmVuYWJsZVRpbWUgfHwgdGltZU1vZGUpKSB7DQogICAgICAgICAgZm9ybWF0cyQkMS5kYXRlRm9ybWF0ID0gdXNlckNvbmZpZy5ub0NhbGVuZGFyIHx8IHRpbWVNb2RlID8gIkg6aSIgKyAodXNlckNvbmZpZy5lbmFibGVTZWNvbmRzID8gIjpTIiA6ICIiKSA6IGZsYXRwaWNrci5kZWZhdWx0Q29uZmlnLmRhdGVGb3JtYXQgKyAiIEg6aSIgKyAodXNlckNvbmZpZy5lbmFibGVTZWNvbmRzID8gIjpTIiA6ICIiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICh1c2VyQ29uZmlnLmFsdElucHV0ICYmICh1c2VyQ29uZmlnLmVuYWJsZVRpbWUgfHwgdGltZU1vZGUpICYmICF1c2VyQ29uZmlnLmFsdEZvcm1hdCkgew0KICAgICAgICAgIGZvcm1hdHMkJDEuYWx0Rm9ybWF0ID0gdXNlckNvbmZpZy5ub0NhbGVuZGFyIHx8IHRpbWVNb2RlID8gImg6aSIgKyAodXNlckNvbmZpZy5lbmFibGVTZWNvbmRzID8gIjpTIEsiIDogIiBLIikgOiBmbGF0cGlja3IuZGVmYXVsdENvbmZpZy5hbHRGb3JtYXQgKyAoIiBoOmkiICsgKHVzZXJDb25maWcuZW5hYmxlU2Vjb25kcyA/ICI6UyIgOiAiIikgKyAiIEsiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLmNvbmZpZywgIm1pbkRhdGUiLCB7DQogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcuX21pbkRhdGU7DQogICAgICAgICAgfSwNCiAgICAgICAgICBzZXQ6IG1pbk1heERhdGVTZXR0ZXIoIm1pbiIpDQogICAgICAgIH0pOw0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5jb25maWcsICJtYXhEYXRlIiwgew0KICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLl9tYXhEYXRlOw0KICAgICAgICAgIH0sDQogICAgICAgICAgc2V0OiBtaW5NYXhEYXRlU2V0dGVyKCJtYXgiKQ0KICAgICAgICB9KTsNCg0KICAgICAgICB2YXIgbWluTWF4VGltZVNldHRlciA9IGZ1bmN0aW9uIG1pbk1heFRpbWVTZXR0ZXIodHlwZSkgew0KICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsKSB7DQogICAgICAgICAgICBzZWxmLmNvbmZpZ1t0eXBlID09PSAibWluIiA/ICJfbWluVGltZSIgOiAiX21heFRpbWUiXSA9IHNlbGYucGFyc2VEYXRlKHZhbCwgIkg6aSIpOw0KICAgICAgICAgIH07DQogICAgICAgIH07DQoNCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYuY29uZmlnLCAibWluVGltZSIsIHsNCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5fbWluVGltZTsNCiAgICAgICAgICB9LA0KICAgICAgICAgIHNldDogbWluTWF4VGltZVNldHRlcigibWluIikNCiAgICAgICAgfSk7DQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLmNvbmZpZywgIm1heFRpbWUiLCB7DQogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcuX21heFRpbWU7DQogICAgICAgICAgfSwNCiAgICAgICAgICBzZXQ6IG1pbk1heFRpbWVTZXR0ZXIoIm1heCIpDQogICAgICAgIH0pOw0KDQogICAgICAgIGlmICh1c2VyQ29uZmlnLm1vZGUgPT09ICJ0aW1lIikgew0KICAgICAgICAgIHNlbGYuY29uZmlnLm5vQ2FsZW5kYXIgPSB0cnVlOw0KICAgICAgICAgIHNlbGYuY29uZmlnLmVuYWJsZVRpbWUgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgT2JqZWN0LmFzc2lnbihzZWxmLmNvbmZpZywgZm9ybWF0cyQkMSwgdXNlckNvbmZpZyk7DQoNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBib29sT3B0cy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgIHNlbGYuY29uZmlnW2Jvb2xPcHRzW2ldXSA9IHNlbGYuY29uZmlnW2Jvb2xPcHRzW2ldXSA9PT0gdHJ1ZSB8fCBzZWxmLmNvbmZpZ1tib29sT3B0c1tpXV0gPT09ICJ0cnVlIjsNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAodmFyIF9pID0gaG9va3MubGVuZ3RoOyBfaS0tOykgew0KICAgICAgICAgIGlmIChzZWxmLmNvbmZpZ1tob29rc1tfaV1dICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIHNlbGYuY29uZmlnW2hvb2tzW19pXV0gPSBhcnJheWlmeShzZWxmLmNvbmZpZ1tob29rc1tfaV1dIHx8IFtdKS5tYXAoYmluZFRvSW5zdGFuY2UpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHNlbGYuaXNNb2JpbGUgPSAhc2VsZi5jb25maWcuZGlzYWJsZU1vYmlsZSAmJiAhc2VsZi5jb25maWcuaW5saW5lICYmIHNlbGYuY29uZmlnLm1vZGUgPT09ICJzaW5nbGUiICYmICFzZWxmLmNvbmZpZy5kaXNhYmxlLmxlbmd0aCAmJiAhc2VsZi5jb25maWcuZW5hYmxlLmxlbmd0aCAmJiAhc2VsZi5jb25maWcud2Vla051bWJlcnMgJiYgL0FuZHJvaWR8d2ViT1N8aVBob25lfGlQYWR8aVBvZHxCbGFja0JlcnJ5fElFTW9iaWxlfE9wZXJhIE1pbmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOw0KDQogICAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IHNlbGYuY29uZmlnLnBsdWdpbnMubGVuZ3RoOyBfaTIrKykgew0KICAgICAgICAgIHZhciBwbHVnaW5Db25mID0gc2VsZi5jb25maWcucGx1Z2luc1tfaTJdKHNlbGYpIHx8IHt9Ow0KDQogICAgICAgICAgZm9yICh2YXIga2V5IGluIHBsdWdpbkNvbmYpIHsNCiAgICAgICAgICAgIGlmICh+aG9va3MuaW5kZXhPZihrZXkpKSB7DQogICAgICAgICAgICAgIHNlbGYuY29uZmlnW2tleV0gPSBhcnJheWlmeShwbHVnaW5Db25mW2tleV0pLm1hcChiaW5kVG9JbnN0YW5jZSkuY29uY2F0KHNlbGYuY29uZmlnW2tleV0pOw0KICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdXNlckNvbmZpZ1trZXldID09PSAidW5kZWZpbmVkIikgc2VsZi5jb25maWdba2V5XSA9IHBsdWdpbkNvbmZba2V5XTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uUGFyc2VDb25maWciKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gc2V0dXBMb2NhbGUoKSB7DQogICAgICAgIGlmICh0eXBlb2Ygc2VsZi5jb25maWcubG9jYWxlICE9PSAib2JqZWN0IiAmJiB0eXBlb2YgZmxhdHBpY2tyLmwxMG5zW3NlbGYuY29uZmlnLmxvY2FsZV0gPT09ICJ1bmRlZmluZWQiKSBzZWxmLmNvbmZpZy5lcnJvckhhbmRsZXIobmV3IEVycm9yKCJmbGF0cGlja3I6IGludmFsaWQgbG9jYWxlICIgKyBzZWxmLmNvbmZpZy5sb2NhbGUpKTsNCiAgICAgICAgc2VsZi5sMTBuID0gT2JqZWN0LmFzc2lnbih7fSwgZmxhdHBpY2tyLmwxMG5zLmRlZmF1bHQsIHR5cGVvZiBzZWxmLmNvbmZpZy5sb2NhbGUgPT09ICJvYmplY3QiID8gc2VsZi5jb25maWcubG9jYWxlIDogc2VsZi5jb25maWcubG9jYWxlICE9PSAiZGVmYXVsdCIgPyBmbGF0cGlja3IubDEwbnNbc2VsZi5jb25maWcubG9jYWxlXSA6IHVuZGVmaW5lZCk7DQogICAgICAgIHRva2VuUmVnZXguSyA9ICIoIiArIHNlbGYubDEwbi5hbVBNWzBdICsgInwiICsgc2VsZi5sMTBuLmFtUE1bMV0gKyAifCIgKyBzZWxmLmwxMG4uYW1QTVswXS50b0xvd2VyQ2FzZSgpICsgInwiICsgc2VsZi5sMTBuLmFtUE1bMV0udG9Mb3dlckNhc2UoKSArICIpIjsNCiAgICAgICAgc2VsZi5mb3JtYXREYXRlID0gY3JlYXRlRGF0ZUZvcm1hdHRlcihzZWxmKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gcG9zaXRpb25DYWxlbmRhcihjdXN0b21Qb3NpdGlvbkVsZW1lbnQpIHsNCiAgICAgICAgaWYgKHNlbGYuY2FsZW5kYXJDb250YWluZXIgPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uUHJlQ2FsZW5kYXJQb3NpdGlvbiIpOw0KICAgICAgICB2YXIgcG9zaXRpb25FbGVtZW50ID0gY3VzdG9tUG9zaXRpb25FbGVtZW50IHx8IHNlbGYuX3Bvc2l0aW9uRWxlbWVudDsNCiAgICAgICAgdmFyIGNhbGVuZGFySGVpZ2h0ID0gQXJyYXkucHJvdG90eXBlLnJlZHVjZS5jYWxsKHNlbGYuY2FsZW5kYXJDb250YWluZXIuY2hpbGRyZW4sIGZ1bmN0aW9uIChhY2MsIGNoaWxkKSB7DQogICAgICAgICAgcmV0dXJuIGFjYyArIGNoaWxkLm9mZnNldEhlaWdodDsNCiAgICAgICAgfSwgMCksDQogICAgICAgICAgICBjYWxlbmRhcldpZHRoID0gc2VsZi5jYWxlbmRhckNvbnRhaW5lci5vZmZzZXRXaWR0aCwNCiAgICAgICAgICAgIGNvbmZpZ1BvcyA9IHNlbGYuY29uZmlnLnBvc2l0aW9uLnNwbGl0KCIgIiksDQogICAgICAgICAgICBjb25maWdQb3NWZXJ0aWNhbCA9IGNvbmZpZ1Bvc1swXSwNCiAgICAgICAgICAgIGNvbmZpZ1Bvc0hvcml6b250YWwgPSBjb25maWdQb3MubGVuZ3RoID4gMSA/IGNvbmZpZ1Bvc1sxXSA6IG51bGwsDQogICAgICAgICAgICBpbnB1dEJvdW5kcyA9IHBvc2l0aW9uRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwNCiAgICAgICAgICAgIGRpc3RhbmNlRnJvbUJvdHRvbSA9IHdpbmRvdy5pbm5lckhlaWdodCAtIGlucHV0Qm91bmRzLmJvdHRvbSwNCiAgICAgICAgICAgIHNob3dPblRvcCA9IGNvbmZpZ1Bvc1ZlcnRpY2FsID09PSAiYWJvdmUiIHx8IGNvbmZpZ1Bvc1ZlcnRpY2FsICE9PSAiYmVsb3ciICYmIGRpc3RhbmNlRnJvbUJvdHRvbSA8IGNhbGVuZGFySGVpZ2h0ICYmIGlucHV0Qm91bmRzLnRvcCA+IGNhbGVuZGFySGVpZ2h0Ow0KICAgICAgICB2YXIgdG9wID0gd2luZG93LnBhZ2VZT2Zmc2V0ICsgaW5wdXRCb3VuZHMudG9wICsgKCFzaG93T25Ub3AgPyBwb3NpdGlvbkVsZW1lbnQub2Zmc2V0SGVpZ2h0ICsgMiA6IC1jYWxlbmRhckhlaWdodCAtIDIpOw0KICAgICAgICB0b2dnbGVDbGFzcyhzZWxmLmNhbGVuZGFyQ29udGFpbmVyLCAiYXJyb3dUb3AiLCAhc2hvd09uVG9wKTsNCiAgICAgICAgdG9nZ2xlQ2xhc3Moc2VsZi5jYWxlbmRhckNvbnRhaW5lciwgImFycm93Qm90dG9tIiwgc2hvd09uVG9wKTsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmlubGluZSkgcmV0dXJuOw0KICAgICAgICB2YXIgbGVmdCA9IHdpbmRvdy5wYWdlWE9mZnNldCArIGlucHV0Qm91bmRzLmxlZnQgLSAoY29uZmlnUG9zSG9yaXpvbnRhbCAhPSBudWxsICYmIGNvbmZpZ1Bvc0hvcml6b250YWwgPT09ICJjZW50ZXIiID8gKGNhbGVuZGFyV2lkdGggLSBpbnB1dEJvdW5kcy53aWR0aCkgLyAyIDogMCk7DQogICAgICAgIHZhciByaWdodCA9IHdpbmRvdy5kb2N1bWVudC5ib2R5Lm9mZnNldFdpZHRoIC0gaW5wdXRCb3VuZHMucmlnaHQ7DQogICAgICAgIHZhciByaWdodE1vc3QgPSBsZWZ0ICsgY2FsZW5kYXJXaWR0aCA+IHdpbmRvdy5kb2N1bWVudC5ib2R5Lm9mZnNldFdpZHRoOw0KICAgICAgICB0b2dnbGVDbGFzcyhzZWxmLmNhbGVuZGFyQ29udGFpbmVyLCAicmlnaHRNb3N0IiwgcmlnaHRNb3N0KTsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLnN0YXRpYykgcmV0dXJuOw0KICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLnRvcCA9IHRvcCArICJweCI7DQoNCiAgICAgICAgaWYgKCFyaWdodE1vc3QpIHsNCiAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLmxlZnQgPSBsZWZ0ICsgInB4IjsNCiAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLnJpZ2h0ID0gImF1dG8iOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuc3R5bGUubGVmdCA9ICJhdXRvIjsNCiAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLnJpZ2h0ID0gcmlnaHQgKyAicHgiOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHJlZHJhdygpIHsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm5vQ2FsZW5kYXIgfHwgc2VsZi5pc01vYmlsZSkgcmV0dXJuOw0KICAgICAgICB1cGRhdGVOYXZpZ2F0aW9uQ3VycmVudE1vbnRoKCk7DQogICAgICAgIGJ1aWxkRGF5cygpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBmb2N1c0FuZENsb3NlKCkgew0KICAgICAgICBzZWxmLl9pbnB1dC5mb2N1cygpOw0KDQogICAgICAgIGlmICh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIikgIT09IC0xIHx8IG5hdmlnYXRvci5tc01heFRvdWNoUG9pbnRzICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICBzZXRUaW1lb3V0KHNlbGYuY2xvc2UsIDApOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHNlbGYuY2xvc2UoKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzZWxlY3REYXRlKGUpIHsNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KDQogICAgICAgIHZhciBpc1NlbGVjdGFibGUgPSBmdW5jdGlvbiBpc1NlbGVjdGFibGUoZGF5KSB7DQogICAgICAgICAgcmV0dXJuIGRheS5jbGFzc0xpc3QgJiYgZGF5LmNsYXNzTGlzdC5jb250YWlucygiZmxhdHBpY2tyLWRheSIpICYmICFkYXkuY2xhc3NMaXN0LmNvbnRhaW5zKCJkaXNhYmxlZCIpICYmICFkYXkuY2xhc3NMaXN0LmNvbnRhaW5zKCJub3RBbGxvd2VkIik7DQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIHQgPSBmaW5kUGFyZW50KGUudGFyZ2V0LCBpc1NlbGVjdGFibGUpOw0KICAgICAgICBpZiAodCA9PT0gdW5kZWZpbmVkKSByZXR1cm47DQogICAgICAgIHZhciB0YXJnZXQgPSB0Ow0KICAgICAgICB2YXIgc2VsZWN0ZWREYXRlID0gc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogPSBuZXcgRGF0ZSh0YXJnZXQuZGF0ZU9iai5nZXRUaW1lKCkpOw0KICAgICAgICB2YXIgc2hvdWxkQ2hhbmdlTW9udGggPSAoc2VsZWN0ZWREYXRlLmdldE1vbnRoKCkgPCBzZWxmLmN1cnJlbnRNb250aCB8fCBzZWxlY3RlZERhdGUuZ2V0TW9udGgoKSA+IHNlbGYuY3VycmVudE1vbnRoICsgc2VsZi5jb25maWcuc2hvd01vbnRocyAtIDEpICYmIHNlbGYuY29uZmlnLm1vZGUgIT09ICJyYW5nZSI7DQogICAgICAgIHNlbGYuc2VsZWN0ZWREYXRlRWxlbSA9IHRhcmdldDsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1vZGUgPT09ICJzaW5nbGUiKSBzZWxmLnNlbGVjdGVkRGF0ZXMgPSBbc2VsZWN0ZWREYXRlXTtlbHNlIGlmIChzZWxmLmNvbmZpZy5tb2RlID09PSAibXVsdGlwbGUiKSB7DQogICAgICAgICAgdmFyIHNlbGVjdGVkSW5kZXggPSBpc0RhdGVTZWxlY3RlZChzZWxlY3RlZERhdGUpOw0KICAgICAgICAgIGlmIChzZWxlY3RlZEluZGV4KSBzZWxmLnNlbGVjdGVkRGF0ZXMuc3BsaWNlKHBhcnNlSW50KHNlbGVjdGVkSW5kZXgpLCAxKTtlbHNlIHNlbGYuc2VsZWN0ZWREYXRlcy5wdXNoKHNlbGVjdGVkRGF0ZSk7DQogICAgICAgIH0gZWxzZSBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIikgew0KICAgICAgICAgIGlmIChzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID09PSAyKSBzZWxmLmNsZWFyKGZhbHNlKTsNCiAgICAgICAgICBzZWxmLnNlbGVjdGVkRGF0ZXMucHVzaChzZWxlY3RlZERhdGUpOw0KICAgICAgICAgIGlmIChjb21wYXJlRGF0ZXMoc2VsZWN0ZWREYXRlLCBzZWxmLnNlbGVjdGVkRGF0ZXNbMF0sIHRydWUpICE9PSAwKSBzZWxmLnNlbGVjdGVkRGF0ZXMuc29ydChmdW5jdGlvbiAoYSwgYikgew0KICAgICAgICAgICAgcmV0dXJuIGEuZ2V0VGltZSgpIC0gYi5nZXRUaW1lKCk7DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgc2V0SG91cnNGcm9tSW5wdXRzKCk7DQoNCiAgICAgICAgaWYgKHNob3VsZENoYW5nZU1vbnRoKSB7DQogICAgICAgICAgdmFyIGlzTmV3WWVhciA9IHNlbGYuY3VycmVudFllYXIgIT09IHNlbGVjdGVkRGF0ZS5nZXRGdWxsWWVhcigpOw0KICAgICAgICAgIHNlbGYuY3VycmVudFllYXIgPSBzZWxlY3RlZERhdGUuZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICBzZWxmLmN1cnJlbnRNb250aCA9IHNlbGVjdGVkRGF0ZS5nZXRNb250aCgpOw0KICAgICAgICAgIGlmIChpc05ld1llYXIpIHRyaWdnZXJFdmVudCgib25ZZWFyQ2hhbmdlIik7DQogICAgICAgICAgdHJpZ2dlckV2ZW50KCJvbk1vbnRoQ2hhbmdlIik7DQogICAgICAgIH0NCg0KICAgICAgICB1cGRhdGVOYXZpZ2F0aW9uQ3VycmVudE1vbnRoKCk7DQogICAgICAgIGJ1aWxkRGF5cygpOw0KICAgICAgICBzZXREZWZhdWx0SG91cnMoKTsNCiAgICAgICAgdXBkYXRlVmFsdWUoKTsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmVuYWJsZVRpbWUpIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHJldHVybiBzZWxmLnNob3dUaW1lSW5wdXQgPSB0cnVlOw0KICAgICAgICB9LCA1MCk7DQoNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1vZGUgPT09ICJyYW5nZSIpIHsNCiAgICAgICAgICBpZiAoc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA9PT0gMSkgew0KICAgICAgICAgICAgb25Nb3VzZU92ZXIodGFyZ2V0KTsNCiAgICAgICAgICB9IGVsc2UgdXBkYXRlTmF2aWdhdGlvbkN1cnJlbnRNb250aCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCFzaG91bGRDaGFuZ2VNb250aCAmJiBzZWxmLmNvbmZpZy5tb2RlICE9PSAicmFuZ2UiICYmIHNlbGYuY29uZmlnLnNob3dNb250aHMgPT09IDEpIGZvY3VzT25EYXlFbGVtKHRhcmdldCk7ZWxzZSBzZWxmLnNlbGVjdGVkRGF0ZUVsZW0gJiYgc2VsZi5zZWxlY3RlZERhdGVFbGVtLmZvY3VzKCk7DQogICAgICAgIGlmIChzZWxmLmhvdXJFbGVtZW50ICE9PSB1bmRlZmluZWQpIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICAgIHJldHVybiBzZWxmLmhvdXJFbGVtZW50ICE9PSB1bmRlZmluZWQgJiYgc2VsZi5ob3VyRWxlbWVudC5zZWxlY3QoKTsNCiAgICAgICAgfSwgNDUxKTsNCg0KICAgICAgICBpZiAoc2VsZi5jb25maWcuY2xvc2VPblNlbGVjdCkgew0KICAgICAgICAgIHZhciBzaW5nbGUgPSBzZWxmLmNvbmZpZy5tb2RlID09PSAic2luZ2xlIiAmJiAhc2VsZi5jb25maWcuZW5hYmxlVGltZTsNCiAgICAgICAgICB2YXIgcmFuZ2UgPSBzZWxmLmNvbmZpZy5tb2RlID09PSAicmFuZ2UiICYmIHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPT09IDIgJiYgIXNlbGYuY29uZmlnLmVuYWJsZVRpbWU7DQoNCiAgICAgICAgICBpZiAoc2luZ2xlIHx8IHJhbmdlKSB7DQogICAgICAgICAgICBmb2N1c0FuZENsb3NlKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgdHJpZ2dlckNoYW5nZSgpOw0KICAgICAgfQ0KDQogICAgICB2YXIgQ0FMTEJBQ0tTID0gew0KICAgICAgICBsb2NhbGU6IFtzZXR1cExvY2FsZSwgdXBkYXRlV2Vla2RheXNdLA0KICAgICAgICBzaG93TW9udGhzOiBbYnVpbGRNb250aHMsIHNldENhbGVuZGFyV2lkdGgsIGJ1aWxkV2Vla2RheXNdDQogICAgICB9Ow0KDQogICAgICBmdW5jdGlvbiBzZXQob3B0aW9uLCB2YWx1ZSkgew0KICAgICAgICBpZiAob3B0aW9uICE9PSBudWxsICYmIHR5cGVvZiBvcHRpb24gPT09ICJvYmplY3QiKSBPYmplY3QuYXNzaWduKHNlbGYuY29uZmlnLCBvcHRpb24pO2Vsc2Ugew0KICAgICAgICAgIHNlbGYuY29uZmlnW29wdGlvbl0gPSB2YWx1ZTsNCiAgICAgICAgICBpZiAoQ0FMTEJBQ0tTW29wdGlvbl0gIT09IHVuZGVmaW5lZCkgQ0FMTEJBQ0tTW29wdGlvbl0uZm9yRWFjaChmdW5jdGlvbiAoeCkgew0KICAgICAgICAgICAgcmV0dXJuIHgoKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBzZWxmLnJlZHJhdygpOw0KICAgICAgICBqdW1wVG9EYXRlKCk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHNldFNlbGVjdGVkRGF0ZShpbnB1dERhdGUsIGZvcm1hdCkgew0KICAgICAgICB2YXIgZGF0ZXMgPSBbXTsNCiAgICAgICAgaWYgKGlucHV0RGF0ZSBpbnN0YW5jZW9mIEFycmF5KSBkYXRlcyA9IGlucHV0RGF0ZS5tYXAoZnVuY3Rpb24gKGQpIHsNCiAgICAgICAgICByZXR1cm4gc2VsZi5wYXJzZURhdGUoZCwgZm9ybWF0KTsNCiAgICAgICAgfSk7ZWxzZSBpZiAoaW5wdXREYXRlIGluc3RhbmNlb2YgRGF0ZSB8fCB0eXBlb2YgaW5wdXREYXRlID09PSAibnVtYmVyIikgZGF0ZXMgPSBbc2VsZi5wYXJzZURhdGUoaW5wdXREYXRlLCBmb3JtYXQpXTtlbHNlIGlmICh0eXBlb2YgaW5wdXREYXRlID09PSAic3RyaW5nIikgew0KICAgICAgICAgIHN3aXRjaCAoc2VsZi5jb25maWcubW9kZSkgew0KICAgICAgICAgICAgY2FzZSAic2luZ2xlIjoNCiAgICAgICAgICAgIGNhc2UgInRpbWUiOg0KICAgICAgICAgICAgICBkYXRlcyA9IFtzZWxmLnBhcnNlRGF0ZShpbnB1dERhdGUsIGZvcm1hdCldOw0KICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSAibXVsdGlwbGUiOg0KICAgICAgICAgICAgICBkYXRlcyA9IGlucHV0RGF0ZS5zcGxpdChzZWxmLmNvbmZpZy5jb25qdW5jdGlvbikubWFwKGZ1bmN0aW9uIChkYXRlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucGFyc2VEYXRlKGRhdGUsIGZvcm1hdCk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSAicmFuZ2UiOg0KICAgICAgICAgICAgICBkYXRlcyA9IGlucHV0RGF0ZS5zcGxpdChzZWxmLmwxMG4ucmFuZ2VTZXBhcmF0b3IpLm1hcChmdW5jdGlvbiAoZGF0ZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnBhcnNlRGF0ZShkYXRlLCBmb3JtYXQpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHNlbGYuY29uZmlnLmVycm9ySGFuZGxlcihuZXcgRXJyb3IoIkludmFsaWQgZGF0ZSBzdXBwbGllZDogIiArIEpTT04uc3RyaW5naWZ5KGlucHV0RGF0ZSkpKTsNCiAgICAgICAgc2VsZi5zZWxlY3RlZERhdGVzID0gZGF0ZXMuZmlsdGVyKGZ1bmN0aW9uIChkKSB7DQogICAgICAgICAgcmV0dXJuIGQgaW5zdGFuY2VvZiBEYXRlICYmIGlzRW5hYmxlZChkLCBmYWxzZSk7DQogICAgICAgIH0pOw0KICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIikgc2VsZi5zZWxlY3RlZERhdGVzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsNCiAgICAgICAgICByZXR1cm4gYS5nZXRUaW1lKCkgLSBiLmdldFRpbWUoKTsNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHNldERhdGUoZGF0ZSwgdHJpZ2dlckNoYW5nZSwgZm9ybWF0KSB7DQogICAgICAgIGlmICh0cmlnZ2VyQ2hhbmdlID09PSB2b2lkIDApIHsNCiAgICAgICAgICB0cmlnZ2VyQ2hhbmdlID0gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoZm9ybWF0ID09PSB2b2lkIDApIHsNCiAgICAgICAgICBmb3JtYXQgPSBzZWxmLmNvbmZpZy5kYXRlRm9ybWF0Ow0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGRhdGUgIT09IDAgJiYgIWRhdGUgfHwgZGF0ZSBpbnN0YW5jZW9mIEFycmF5ICYmIGRhdGUubGVuZ3RoID09PSAwKSByZXR1cm4gc2VsZi5jbGVhcih0cmlnZ2VyQ2hhbmdlKTsNCiAgICAgICAgc2V0U2VsZWN0ZWREYXRlKGRhdGUsIGZvcm1hdCk7DQogICAgICAgIHNlbGYuc2hvd1RpbWVJbnB1dCA9IHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPiAwOw0KICAgICAgICBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiA9IHNlbGYuc2VsZWN0ZWREYXRlc1swXTsNCiAgICAgICAgc2VsZi5yZWRyYXcoKTsNCiAgICAgICAganVtcFRvRGF0ZSgpOw0KICAgICAgICBzZXRIb3Vyc0Zyb21EYXRlKCk7DQogICAgICAgIHVwZGF0ZVZhbHVlKHRyaWdnZXJDaGFuZ2UpOw0KICAgICAgICBpZiAodHJpZ2dlckNoYW5nZSkgdHJpZ2dlckV2ZW50KCJvbkNoYW5nZSIpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBwYXJzZURhdGVSdWxlcyhhcnIpIHsNCiAgICAgICAgcmV0dXJuIGFyci5zbGljZSgpLm1hcChmdW5jdGlvbiAocnVsZSkgew0KICAgICAgICAgIGlmICh0eXBlb2YgcnVsZSA9PT0gInN0cmluZyIgfHwgdHlwZW9mIHJ1bGUgPT09ICJudW1iZXIiIHx8IHJ1bGUgaW5zdGFuY2VvZiBEYXRlKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5wYXJzZURhdGUocnVsZSwgdW5kZWZpbmVkLCB0cnVlKTsNCiAgICAgICAgICB9IGVsc2UgaWYgKHJ1bGUgJiYgdHlwZW9mIHJ1bGUgPT09ICJvYmplY3QiICYmIHJ1bGUuZnJvbSAmJiBydWxlLnRvKSByZXR1cm4gew0KICAgICAgICAgICAgZnJvbTogc2VsZi5wYXJzZURhdGUocnVsZS5mcm9tLCB1bmRlZmluZWQpLA0KICAgICAgICAgICAgdG86IHNlbGYucGFyc2VEYXRlKHJ1bGUudG8sIHVuZGVmaW5lZCkNCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgcmV0dXJuIHJ1bGU7DQogICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAoeCkgew0KICAgICAgICAgIHJldHVybiB4Ow0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gc2V0dXBEYXRlcygpIHsNCiAgICAgICAgc2VsZi5zZWxlY3RlZERhdGVzID0gW107DQogICAgICAgIHNlbGYubm93ID0gc2VsZi5wYXJzZURhdGUoc2VsZi5jb25maWcubm93KSB8fCBuZXcgRGF0ZSgpOw0KICAgICAgICB2YXIgcHJlbG9hZGVkRGF0ZSA9IHNlbGYuY29uZmlnLmRlZmF1bHREYXRlIHx8IChzZWxmLmlucHV0LnBsYWNlaG9sZGVyLmxlbmd0aCA+IDAgJiYgc2VsZi5pbnB1dC52YWx1ZSA9PT0gc2VsZi5pbnB1dC5wbGFjZWhvbGRlciA/IG51bGwgOiBzZWxmLmlucHV0LnZhbHVlKTsNCiAgICAgICAgaWYgKHByZWxvYWRlZERhdGUpIHNldFNlbGVjdGVkRGF0ZShwcmVsb2FkZWREYXRlLCBzZWxmLmNvbmZpZy5kYXRlRm9ybWF0KTsNCiAgICAgICAgdmFyIGluaXRpYWxEYXRlID0gc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA+IDAgPyBzZWxmLnNlbGVjdGVkRGF0ZXNbMF0gOiBzZWxmLmNvbmZpZy5taW5EYXRlICYmIHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0VGltZSgpID4gc2VsZi5ub3cuZ2V0VGltZSgpID8gc2VsZi5jb25maWcubWluRGF0ZSA6IHNlbGYuY29uZmlnLm1heERhdGUgJiYgc2VsZi5jb25maWcubWF4RGF0ZS5nZXRUaW1lKCkgPCBzZWxmLm5vdy5nZXRUaW1lKCkgPyBzZWxmLmNvbmZpZy5tYXhEYXRlIDogc2VsZi5ub3c7DQogICAgICAgIHNlbGYuY3VycmVudFllYXIgPSBpbml0aWFsRGF0ZS5nZXRGdWxsWWVhcigpOw0KICAgICAgICBzZWxmLmN1cnJlbnRNb250aCA9IGluaXRpYWxEYXRlLmdldE1vbnRoKCk7DQogICAgICAgIGlmIChzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID4gMCkgc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogPSBzZWxmLnNlbGVjdGVkRGF0ZXNbMF07DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5taW5UaW1lICE9PSB1bmRlZmluZWQpIHNlbGYuY29uZmlnLm1pblRpbWUgPSBzZWxmLnBhcnNlRGF0ZShzZWxmLmNvbmZpZy5taW5UaW1lLCAiSDppIik7DQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tYXhUaW1lICE9PSB1bmRlZmluZWQpIHNlbGYuY29uZmlnLm1heFRpbWUgPSBzZWxmLnBhcnNlRGF0ZShzZWxmLmNvbmZpZy5tYXhUaW1lLCAiSDppIik7DQogICAgICAgIHNlbGYubWluRGF0ZUhhc1RpbWUgPSAhIXNlbGYuY29uZmlnLm1pbkRhdGUgJiYgKHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0SG91cnMoKSA+IDAgfHwgc2VsZi5jb25maWcubWluRGF0ZS5nZXRNaW51dGVzKCkgPiAwIHx8IHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0U2Vjb25kcygpID4gMCk7DQogICAgICAgIHNlbGYubWF4RGF0ZUhhc1RpbWUgPSAhIXNlbGYuY29uZmlnLm1heERhdGUgJiYgKHNlbGYuY29uZmlnLm1heERhdGUuZ2V0SG91cnMoKSA+IDAgfHwgc2VsZi5jb25maWcubWF4RGF0ZS5nZXRNaW51dGVzKCkgPiAwIHx8IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0U2Vjb25kcygpID4gMCk7DQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLCAic2hvd1RpbWVJbnB1dCIsIHsNCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9zaG93VGltZUlucHV0Ow0KICAgICAgICAgIH0sDQogICAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoYm9vbCkgew0KICAgICAgICAgICAgc2VsZi5fc2hvd1RpbWVJbnB1dCA9IGJvb2w7DQogICAgICAgICAgICBpZiAoc2VsZi5jYWxlbmRhckNvbnRhaW5lcikgdG9nZ2xlQ2xhc3Moc2VsZi5jYWxlbmRhckNvbnRhaW5lciwgInNob3dUaW1lSW5wdXQiLCBib29sKTsNCiAgICAgICAgICAgIHNlbGYuaXNPcGVuICYmIHBvc2l0aW9uQ2FsZW5kYXIoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzZXR1cElucHV0cygpIHsNCiAgICAgICAgc2VsZi5pbnB1dCA9IHNlbGYuY29uZmlnLndyYXAgPyBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWlucHV0XSIpIDogZWxlbWVudDsNCg0KICAgICAgICBpZiAoIXNlbGYuaW5wdXQpIHsNCiAgICAgICAgICBzZWxmLmNvbmZpZy5lcnJvckhhbmRsZXIobmV3IEVycm9yKCJJbnZhbGlkIGlucHV0IGVsZW1lbnQgc3BlY2lmaWVkIikpOw0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIHNlbGYuaW5wdXQuX3R5cGUgPSBzZWxmLmlucHV0LnR5cGU7DQogICAgICAgIHNlbGYuaW5wdXQudHlwZSA9ICJ0ZXh0IjsNCiAgICAgICAgc2VsZi5pbnB1dC5jbGFzc0xpc3QuYWRkKCJmbGF0cGlja3ItaW5wdXQiKTsNCiAgICAgICAgc2VsZi5faW5wdXQgPSBzZWxmLmlucHV0Ow0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5hbHRJbnB1dCkgew0KICAgICAgICAgIHNlbGYuYWx0SW5wdXQgPSBjcmVhdGVFbGVtZW50KHNlbGYuaW5wdXQubm9kZU5hbWUsIHNlbGYuaW5wdXQuY2xhc3NOYW1lICsgIiAiICsgc2VsZi5jb25maWcuYWx0SW5wdXRDbGFzcyk7DQogICAgICAgICAgc2VsZi5faW5wdXQgPSBzZWxmLmFsdElucHV0Ow0KICAgICAgICAgIHNlbGYuYWx0SW5wdXQucGxhY2Vob2xkZXIgPSBzZWxmLmlucHV0LnBsYWNlaG9sZGVyOw0KICAgICAgICAgIHNlbGYuYWx0SW5wdXQuZGlzYWJsZWQgPSBzZWxmLmlucHV0LmRpc2FibGVkOw0KICAgICAgICAgIHNlbGYuYWx0SW5wdXQucmVxdWlyZWQgPSBzZWxmLmlucHV0LnJlcXVpcmVkOw0KICAgICAgICAgIHNlbGYuYWx0SW5wdXQudGFiSW5kZXggPSBzZWxmLmlucHV0LnRhYkluZGV4Ow0KICAgICAgICAgIHNlbGYuYWx0SW5wdXQudHlwZSA9ICJ0ZXh0IjsNCiAgICAgICAgICBzZWxmLmlucHV0LnNldEF0dHJpYnV0ZSgidHlwZSIsICJoaWRkZW4iKTsNCiAgICAgICAgICBpZiAoIXNlbGYuY29uZmlnLnN0YXRpYyAmJiBzZWxmLmlucHV0LnBhcmVudE5vZGUpIHNlbGYuaW5wdXQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsZi5hbHRJbnB1dCwgc2VsZi5pbnB1dC5uZXh0U2libGluZyk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIXNlbGYuY29uZmlnLmFsbG93SW5wdXQpIHNlbGYuX2lucHV0LnNldEF0dHJpYnV0ZSgicmVhZG9ubHkiLCAicmVhZG9ubHkiKTsNCiAgICAgICAgc2VsZi5fcG9zaXRpb25FbGVtZW50ID0gc2VsZi5jb25maWcucG9zaXRpb25FbGVtZW50IHx8IHNlbGYuX2lucHV0Ow0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBzZXR1cE1vYmlsZSgpIHsNCiAgICAgICAgdmFyIGlucHV0VHlwZSA9IHNlbGYuY29uZmlnLmVuYWJsZVRpbWUgPyBzZWxmLmNvbmZpZy5ub0NhbGVuZGFyID8gInRpbWUiIDogImRhdGV0aW1lLWxvY2FsIiA6ICJkYXRlIjsNCiAgICAgICAgc2VsZi5tb2JpbGVJbnB1dCA9IGNyZWF0ZUVsZW1lbnQoImlucHV0Iiwgc2VsZi5pbnB1dC5jbGFzc05hbWUgKyAiIGZsYXRwaWNrci1tb2JpbGUiKTsNCiAgICAgICAgc2VsZi5tb2JpbGVJbnB1dC5zdGVwID0gc2VsZi5pbnB1dC5nZXRBdHRyaWJ1dGUoInN0ZXAiKSB8fCAiYW55IjsNCiAgICAgICAgc2VsZi5tb2JpbGVJbnB1dC50YWJJbmRleCA9IDE7DQogICAgICAgIHNlbGYubW9iaWxlSW5wdXQudHlwZSA9IGlucHV0VHlwZTsNCiAgICAgICAgc2VsZi5tb2JpbGVJbnB1dC5kaXNhYmxlZCA9IHNlbGYuaW5wdXQuZGlzYWJsZWQ7DQogICAgICAgIHNlbGYubW9iaWxlSW5wdXQucmVxdWlyZWQgPSBzZWxmLmlucHV0LnJlcXVpcmVkOw0KICAgICAgICBzZWxmLm1vYmlsZUlucHV0LnBsYWNlaG9sZGVyID0gc2VsZi5pbnB1dC5wbGFjZWhvbGRlcjsNCiAgICAgICAgc2VsZi5tb2JpbGVGb3JtYXRTdHIgPSBpbnB1dFR5cGUgPT09ICJkYXRldGltZS1sb2NhbCIgPyAiWS1tLWRcXFRIOmk6UyIgOiBpbnB1dFR5cGUgPT09ICJkYXRlIiA/ICJZLW0tZCIgOiAiSDppOlMiOw0KDQogICAgICAgIGlmIChzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID4gMCkgew0KICAgICAgICAgIHNlbGYubW9iaWxlSW5wdXQuZGVmYXVsdFZhbHVlID0gc2VsZi5tb2JpbGVJbnB1dC52YWx1ZSA9IHNlbGYuZm9ybWF0RGF0ZShzZWxmLnNlbGVjdGVkRGF0ZXNbMF0sIHNlbGYubW9iaWxlRm9ybWF0U3RyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLmNvbmZpZy5taW5EYXRlKSBzZWxmLm1vYmlsZUlucHV0Lm1pbiA9IHNlbGYuZm9ybWF0RGF0ZShzZWxmLmNvbmZpZy5taW5EYXRlLCAiWS1tLWQiKTsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1heERhdGUpIHNlbGYubW9iaWxlSW5wdXQubWF4ID0gc2VsZi5mb3JtYXREYXRlKHNlbGYuY29uZmlnLm1heERhdGUsICJZLW0tZCIpOw0KICAgICAgICBzZWxmLmlucHV0LnR5cGUgPSAiaGlkZGVuIjsNCiAgICAgICAgaWYgKHNlbGYuYWx0SW5wdXQgIT09IHVuZGVmaW5lZCkgc2VsZi5hbHRJbnB1dC50eXBlID0gImhpZGRlbiI7DQoNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBpZiAoc2VsZi5pbnB1dC5wYXJlbnROb2RlKSBzZWxmLmlucHV0LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHNlbGYubW9iaWxlSW5wdXQsIHNlbGYuaW5wdXQubmV4dFNpYmxpbmcpOw0KICAgICAgICB9IGNhdGNoIChfYSkge30NCg0KICAgICAgICBiaW5kKHNlbGYubW9iaWxlSW5wdXQsICJjaGFuZ2UiLCBmdW5jdGlvbiAoZSkgew0KICAgICAgICAgIHNlbGYuc2V0RGF0ZShlLnRhcmdldC52YWx1ZSwgZmFsc2UsIHNlbGYubW9iaWxlRm9ybWF0U3RyKTsNCiAgICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uQ2hhbmdlIik7DQogICAgICAgICAgdHJpZ2dlckV2ZW50KCJvbkNsb3NlIik7DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiB0b2dnbGUoZSkgew0KICAgICAgICBpZiAoc2VsZi5pc09wZW4gPT09IHRydWUpIHJldHVybiBzZWxmLmNsb3NlKCk7DQogICAgICAgIHNlbGYub3BlbihlKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gdHJpZ2dlckV2ZW50KGV2ZW50LCBkYXRhKSB7DQogICAgICAgIHZhciBob29rcyA9IHNlbGYuY29uZmlnW2V2ZW50XTsNCg0KICAgICAgICBpZiAoaG9va3MgIT09IHVuZGVmaW5lZCAmJiBob29rcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGhvb2tzW2ldICYmIGkgPCBob29rcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaG9va3NbaV0oc2VsZi5zZWxlY3RlZERhdGVzLCBzZWxmLmlucHV0LnZhbHVlLCBzZWxmLCBkYXRhKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoZXZlbnQgPT09ICJvbkNoYW5nZSIpIHsNCiAgICAgICAgICBzZWxmLmlucHV0LmRpc3BhdGNoRXZlbnQoY3JlYXRlRXZlbnQoImNoYW5nZSIpKTsNCiAgICAgICAgICBzZWxmLmlucHV0LmRpc3BhdGNoRXZlbnQoY3JlYXRlRXZlbnQoImlucHV0IikpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIGNyZWF0ZUV2ZW50KG5hbWUpIHsNCiAgICAgICAgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgiRXZlbnQiKTsNCiAgICAgICAgZS5pbml0RXZlbnQobmFtZSwgdHJ1ZSwgdHJ1ZSk7DQogICAgICAgIHJldHVybiBlOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBpc0RhdGVTZWxlY3RlZChkYXRlKSB7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgaWYgKGNvbXBhcmVEYXRlcyhzZWxmLnNlbGVjdGVkRGF0ZXNbaV0sIGRhdGUpID09PSAwKSByZXR1cm4gIiIgKyBpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBpc0RhdGVJblJhbmdlKGRhdGUpIHsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1vZGUgIT09ICJyYW5nZSIgfHwgc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA8IDIpIHJldHVybiBmYWxzZTsNCiAgICAgICAgcmV0dXJuIGNvbXBhcmVEYXRlcyhkYXRlLCBzZWxmLnNlbGVjdGVkRGF0ZXNbMF0pID49IDAgJiYgY29tcGFyZURhdGVzKGRhdGUsIHNlbGYuc2VsZWN0ZWREYXRlc1sxXSkgPD0gMDsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gdXBkYXRlTmF2aWdhdGlvbkN1cnJlbnRNb250aCgpIHsNCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm5vQ2FsZW5kYXIgfHwgc2VsZi5pc01vYmlsZSB8fCAhc2VsZi5tb250aE5hdikgcmV0dXJuOw0KICAgICAgICBzZWxmLnllYXJFbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uICh5ZWFyRWxlbWVudCwgaSkgew0KICAgICAgICAgIHZhciBkID0gbmV3IERhdGUoc2VsZi5jdXJyZW50WWVhciwgc2VsZi5jdXJyZW50TW9udGgsIDEpOw0KICAgICAgICAgIGQuc2V0TW9udGgoc2VsZi5jdXJyZW50TW9udGggKyBpKTsNCiAgICAgICAgICBzZWxmLm1vbnRoRWxlbWVudHNbaV0udGV4dENvbnRlbnQgPSBtb250aFRvU3RyKGQuZ2V0TW9udGgoKSwgc2VsZi5jb25maWcuc2hvcnRoYW5kQ3VycmVudE1vbnRoLCBzZWxmLmwxMG4pICsgIiAiOw0KICAgICAgICAgIHllYXJFbGVtZW50LnZhbHVlID0gZC5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCk7DQogICAgICAgIH0pOw0KICAgICAgICBzZWxmLl9oaWRlUHJldk1vbnRoQXJyb3cgPSBzZWxmLmNvbmZpZy5taW5EYXRlICE9PSB1bmRlZmluZWQgJiYgKHNlbGYuY3VycmVudFllYXIgPT09IHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0RnVsbFllYXIoKSA/IHNlbGYuY3VycmVudE1vbnRoIDw9IHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0TW9udGgoKSA6IHNlbGYuY3VycmVudFllYXIgPCBzZWxmLmNvbmZpZy5taW5EYXRlLmdldEZ1bGxZZWFyKCkpOw0KICAgICAgICBzZWxmLl9oaWRlTmV4dE1vbnRoQXJyb3cgPSBzZWxmLmNvbmZpZy5tYXhEYXRlICE9PSB1bmRlZmluZWQgJiYgKHNlbGYuY3VycmVudFllYXIgPT09IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0RnVsbFllYXIoKSA/IHNlbGYuY3VycmVudE1vbnRoICsgMSA+IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0TW9udGgoKSA6IHNlbGYuY3VycmVudFllYXIgPiBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldEZ1bGxZZWFyKCkpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiB1cGRhdGVWYWx1ZSh0cmlnZ2VyQ2hhbmdlKSB7DQogICAgICAgIGlmICh0cmlnZ2VyQ2hhbmdlID09PSB2b2lkIDApIHsNCiAgICAgICAgICB0cmlnZ2VyQ2hhbmdlID0gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID09PSAwKSByZXR1cm4gc2VsZi5jbGVhcih0cmlnZ2VyQ2hhbmdlKTsNCg0KICAgICAgICBpZiAoc2VsZi5tb2JpbGVJbnB1dCAhPT0gdW5kZWZpbmVkICYmIHNlbGYubW9iaWxlRm9ybWF0U3RyKSB7DQogICAgICAgICAgc2VsZi5tb2JpbGVJbnB1dC52YWx1ZSA9IHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqICE9PSB1bmRlZmluZWQgPyBzZWxmLmZvcm1hdERhdGUoc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmosIHNlbGYubW9iaWxlRm9ybWF0U3RyKSA6ICIiOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGpvaW5DaGFyID0gc2VsZi5jb25maWcubW9kZSAhPT0gInJhbmdlIiA/IHNlbGYuY29uZmlnLmNvbmp1bmN0aW9uIDogc2VsZi5sMTBuLnJhbmdlU2VwYXJhdG9yOw0KICAgICAgICBzZWxmLmlucHV0LnZhbHVlID0gc2VsZi5zZWxlY3RlZERhdGVzLm1hcChmdW5jdGlvbiAoZE9iaikgew0KICAgICAgICAgIHJldHVybiBzZWxmLmZvcm1hdERhdGUoZE9iaiwgc2VsZi5jb25maWcuZGF0ZUZvcm1hdCk7DQogICAgICAgIH0pLmpvaW4oam9pbkNoYXIpOw0KDQogICAgICAgIGlmIChzZWxmLmFsdElucHV0ICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICBzZWxmLmFsdElucHV0LnZhbHVlID0gc2VsZi5zZWxlY3RlZERhdGVzLm1hcChmdW5jdGlvbiAoZE9iaikgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuZm9ybWF0RGF0ZShkT2JqLCBzZWxmLmNvbmZpZy5hbHRGb3JtYXQpOw0KICAgICAgICAgIH0pLmpvaW4oam9pbkNoYXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHRyaWdnZXJDaGFuZ2UgIT09IGZhbHNlKSB0cmlnZ2VyRXZlbnQoIm9uVmFsdWVVcGRhdGUiKTsNCiAgICAgIH0NCg0KICAgICAgZnVuY3Rpb24gb25Nb250aE5hdkNsaWNrKGUpIHsNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICB2YXIgaXNQcmV2TW9udGggPSBzZWxmLnByZXZNb250aE5hdi5jb250YWlucyhlLnRhcmdldCk7DQogICAgICAgIHZhciBpc05leHRNb250aCA9IHNlbGYubmV4dE1vbnRoTmF2LmNvbnRhaW5zKGUudGFyZ2V0KTsNCg0KICAgICAgICBpZiAoaXNQcmV2TW9udGggfHwgaXNOZXh0TW9udGgpIHsNCiAgICAgICAgICBjaGFuZ2VNb250aChpc1ByZXZNb250aCA/IC0xIDogMSk7DQogICAgICAgIH0gZWxzZSBpZiAoc2VsZi55ZWFyRWxlbWVudHMuaW5kZXhPZihlLnRhcmdldCkgPj0gMCkgew0KICAgICAgICAgIGUudGFyZ2V0LnNlbGVjdCgpOw0KICAgICAgICB9IGVsc2UgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiYXJyb3dVcCIpKSB7DQogICAgICAgICAgc2VsZi5jaGFuZ2VZZWFyKHNlbGYuY3VycmVudFllYXIgKyAxKTsNCiAgICAgICAgfSBlbHNlIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImFycm93RG93biIpKSB7DQogICAgICAgICAgc2VsZi5jaGFuZ2VZZWFyKHNlbGYuY3VycmVudFllYXIgLSAxKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiB0aW1lV3JhcHBlcihlKSB7DQogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgdmFyIGlzS2V5RG93biA9IGUudHlwZSA9PT0gImtleWRvd24iLA0KICAgICAgICAgICAgaW5wdXQgPSBlLnRhcmdldDsNCg0KICAgICAgICBpZiAoc2VsZi5hbVBNICE9PSB1bmRlZmluZWQgJiYgZS50YXJnZXQgPT09IHNlbGYuYW1QTSkgew0KICAgICAgICAgIHNlbGYuYW1QTS50ZXh0Q29udGVudCA9IHNlbGYubDEwbi5hbVBNW2ludChzZWxmLmFtUE0udGV4dENvbnRlbnQgPT09IHNlbGYubDEwbi5hbVBNWzBdKV07DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgbWluID0gcGFyc2VGbG9hdChpbnB1dC5nZXRBdHRyaWJ1dGUoImRhdGEtbWluIikpLA0KICAgICAgICAgICAgbWF4ID0gcGFyc2VGbG9hdChpbnB1dC5nZXRBdHRyaWJ1dGUoImRhdGEtbWF4IikpLA0KICAgICAgICAgICAgc3RlcCA9IHBhcnNlRmxvYXQoaW5wdXQuZ2V0QXR0cmlidXRlKCJkYXRhLXN0ZXAiKSksDQogICAgICAgICAgICBjdXJWYWx1ZSA9IHBhcnNlSW50KGlucHV0LnZhbHVlLCAxMCksDQogICAgICAgICAgICBkZWx0YSA9IGUuZGVsdGEgfHwgKGlzS2V5RG93biA/IGUud2hpY2ggPT09IDM4ID8gMSA6IC0xIDogMCk7DQogICAgICAgIHZhciBuZXdWYWx1ZSA9IGN1clZhbHVlICsgc3RlcCAqIGRlbHRhOw0KDQogICAgICAgIGlmICh0eXBlb2YgaW5wdXQudmFsdWUgIT09ICJ1bmRlZmluZWQiICYmIGlucHV0LnZhbHVlLmxlbmd0aCA9PT0gMikgew0KICAgICAgICAgIHZhciBpc0hvdXJFbGVtID0gaW5wdXQgPT09IHNlbGYuaG91ckVsZW1lbnQsDQogICAgICAgICAgICAgIGlzTWludXRlRWxlbSA9IGlucHV0ID09PSBzZWxmLm1pbnV0ZUVsZW1lbnQ7DQoNCiAgICAgICAgICBpZiAobmV3VmFsdWUgPCBtaW4pIHsNCiAgICAgICAgICAgIG5ld1ZhbHVlID0gbWF4ICsgbmV3VmFsdWUgKyBpbnQoIWlzSG91ckVsZW0pICsgKGludChpc0hvdXJFbGVtKSAmJiBpbnQoIXNlbGYuYW1QTSkpOw0KICAgICAgICAgICAgaWYgKGlzTWludXRlRWxlbSkgaW5jcmVtZW50TnVtSW5wdXQodW5kZWZpbmVkLCAtMSwgc2VsZi5ob3VyRWxlbWVudCk7DQogICAgICAgICAgfSBlbHNlIGlmIChuZXdWYWx1ZSA+IG1heCkgew0KICAgICAgICAgICAgbmV3VmFsdWUgPSBpbnB1dCA9PT0gc2VsZi5ob3VyRWxlbWVudCA/IG5ld1ZhbHVlIC0gbWF4IC0gaW50KCFzZWxmLmFtUE0pIDogbWluOw0KICAgICAgICAgICAgaWYgKGlzTWludXRlRWxlbSkgaW5jcmVtZW50TnVtSW5wdXQodW5kZWZpbmVkLCAxLCBzZWxmLmhvdXJFbGVtZW50KTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpZiAoc2VsZi5hbVBNICYmIGlzSG91ckVsZW0gJiYgKHN0ZXAgPT09IDEgPyBuZXdWYWx1ZSArIGN1clZhbHVlID09PSAyMyA6IE1hdGguYWJzKG5ld1ZhbHVlIC0gY3VyVmFsdWUpID4gc3RlcCkpIHsNCiAgICAgICAgICAgIHNlbGYuYW1QTS50ZXh0Q29udGVudCA9IHNlbGYubDEwbi5hbVBNW2ludChzZWxmLmFtUE0udGV4dENvbnRlbnQgPT09IHNlbGYubDEwbi5hbVBNWzBdKV07DQogICAgICAgICAgfQ0KDQogICAgICAgICAgaW5wdXQudmFsdWUgPSBwYWQobmV3VmFsdWUpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGluaXQoKTsNCiAgICAgIHJldHVybiBzZWxmOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIF9mbGF0cGlja3Iobm9kZUxpc3QsIGNvbmZpZykgew0KICAgICAgdmFyIG5vZGVzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwobm9kZUxpc3QpOw0KICAgICAgdmFyIGluc3RhbmNlcyA9IFtdOw0KDQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIHZhciBub2RlID0gbm9kZXNbaV07DQoNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBpZiAobm9kZS5nZXRBdHRyaWJ1dGUoImRhdGEtZnAtb21pdCIpICE9PSBudWxsKSBjb250aW51ZTsNCg0KICAgICAgICAgIGlmIChub2RlLl9mbGF0cGlja3IgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgbm9kZS5fZmxhdHBpY2tyLmRlc3Ryb3koKTsNCg0KICAgICAgICAgICAgbm9kZS5fZmxhdHBpY2tyID0gdW5kZWZpbmVkOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIG5vZGUuX2ZsYXRwaWNrciA9IEZsYXRwaWNrckluc3RhbmNlKG5vZGUsIGNvbmZpZyB8fCB7fSk7DQogICAgICAgICAgaW5zdGFuY2VzLnB1c2gobm9kZS5fZmxhdHBpY2tyKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIGluc3RhbmNlcy5sZW5ndGggPT09IDEgPyBpbnN0YW5jZXNbMF0gOiBpbnN0YW5jZXM7DQogICAgfQ0KDQogICAgaWYgKHR5cGVvZiBIVE1MRWxlbWVudCAhPT0gInVuZGVmaW5lZCIpIHsNCiAgICAgIEhUTUxDb2xsZWN0aW9uLnByb3RvdHlwZS5mbGF0cGlja3IgPSBOb2RlTGlzdC5wcm90b3R5cGUuZmxhdHBpY2tyID0gZnVuY3Rpb24gKGNvbmZpZykgew0KICAgICAgICByZXR1cm4gX2ZsYXRwaWNrcih0aGlzLCBjb25maWcpOw0KICAgICAgfTsNCg0KICAgICAgSFRNTEVsZW1lbnQucHJvdG90eXBlLmZsYXRwaWNrciA9IGZ1bmN0aW9uIChjb25maWcpIHsNCiAgICAgICAgcmV0dXJuIF9mbGF0cGlja3IoW3RoaXNdLCBjb25maWcpOw0KICAgICAgfTsNCiAgICB9DQoNCiAgICB2YXIgZmxhdHBpY2tyID0gZnVuY3Rpb24gZmxhdHBpY2tyKHNlbGVjdG9yLCBjb25maWcpIHsNCiAgICAgIGlmIChzZWxlY3RvciBpbnN0YW5jZW9mIE5vZGVMaXN0KSByZXR1cm4gX2ZsYXRwaWNrcihzZWxlY3RvciwgY29uZmlnKTtlbHNlIGlmICh0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciKSByZXR1cm4gX2ZsYXRwaWNrcih3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvciksIGNvbmZpZyk7DQogICAgICByZXR1cm4gX2ZsYXRwaWNrcihbc2VsZWN0b3JdLCBjb25maWcpOw0KICAgIH07DQoNCiAgICBmbGF0cGlja3IuZGVmYXVsdENvbmZpZyA9IGRlZmF1bHRzOw0KICAgIGZsYXRwaWNrci5sMTBucyA9IHsNCiAgICAgIGVuOiBPYmplY3QuYXNzaWduKHt9LCBlbmdsaXNoKSwNCiAgICAgIGRlZmF1bHQ6IE9iamVjdC5hc3NpZ24oe30sIGVuZ2xpc2gpDQogICAgfTsNCg0KICAgIGZsYXRwaWNrci5sb2NhbGl6ZSA9IGZ1bmN0aW9uIChsMTBuKSB7DQogICAgICBmbGF0cGlja3IubDEwbnMuZGVmYXVsdCA9IE9iamVjdC5hc3NpZ24oe30sIGZsYXRwaWNrci5sMTBucy5kZWZhdWx0LCBsMTBuKTsNCiAgICB9Ow0KDQogICAgZmxhdHBpY2tyLnNldERlZmF1bHRzID0gZnVuY3Rpb24gKGNvbmZpZykgew0KICAgICAgZmxhdHBpY2tyLmRlZmF1bHRDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBmbGF0cGlja3IuZGVmYXVsdENvbmZpZywgY29uZmlnKTsNCiAgICB9Ow0KDQogICAgZmxhdHBpY2tyLnBhcnNlRGF0ZSA9IGNyZWF0ZURhdGVQYXJzZXIoe30pOw0KICAgIGZsYXRwaWNrci5mb3JtYXREYXRlID0gY3JlYXRlRGF0ZUZvcm1hdHRlcih7fSk7DQogICAgZmxhdHBpY2tyLmNvbXBhcmVEYXRlcyA9IGNvbXBhcmVEYXRlczsNCg0KICAgIGlmICh0eXBlb2YgalF1ZXJ5ICE9PSAidW5kZWZpbmVkIikgew0KICAgICAgalF1ZXJ5LmZuLmZsYXRwaWNrciA9IGZ1bmN0aW9uIChjb25maWcpIHsNCiAgICAgICAgcmV0dXJuIF9mbGF0cGlja3IodGhpcywgY29uZmlnKTsNCiAgICAgIH07DQogICAgfQ0KDQogICAgRGF0ZS5wcm90b3R5cGUuZnBfaW5jciA9IGZ1bmN0aW9uIChkYXlzKSB7DQogICAgICByZXR1cm4gbmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLCB0aGlzLmdldE1vbnRoKCksIHRoaXMuZ2V0RGF0ZSgpICsgKHR5cGVvZiBkYXlzID09PSAic3RyaW5nIiA/IHBhcnNlSW50KGRheXMsIDEwKSA6IGRheXMpKTsNCiAgICB9Ow0KDQogICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiKSB7DQogICAgICB3aW5kb3cuZmxhdHBpY2tyID0gZmxhdHBpY2tyOw0KICAgIH0NCg0KICAgIHJldHVybiBmbGF0cGlja3I7DQoNCn0pKSk7DQo8L3NjcmlwdD4NCiAgPCEtLWh0dHBzOi8vam9zaHVham9obnNvbi5jby51ay9DaG9pY2VzLy0tPg0KICA8IS0tPGxpbmsgaHJlZj0ic3R5bGVzaGVldHMvY2hvaWNlcy5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+DQogIDxzdHlsZT4NCiAgICAvKj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCj0gICAgICAgICAgICBDaG9pY2VzICAgICAgICAgICAgPQ0KPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovDQouY2hvaWNlcyB7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgbWFyZ2luLWJvdHRvbTogMjRweDsNCiAgZm9udC1zaXplOiAxMnB4Ow0KfQ0KDQouY2hvaWNlczpmb2N1cyB7DQogIG91dGxpbmU6IG5vbmU7DQp9DQoNCi5jaG9pY2VzOmxhc3QtY2hpbGQgew0KICBtYXJnaW4tYm90dG9tOiAwOw0KfQ0KDQouY2hvaWNlcy5pcy1kaXNhYmxlZCAuY2hvaWNlc19faW5uZXIsDQouY2hvaWNlcy5pcy1kaXNhYmxlZCAuY2hvaWNlc19faW5wdXQgew0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjRUFFQUVBOw0KICBjdXJzb3I6IG5vdC1hbGxvd2VkOw0KICB1c2VyLXNlbGVjdDogbm9uZTsNCn0NCg0KLmNob2ljZXMuaXMtZGlzYWJsZWQgLmNob2ljZXNfX2l0ZW0gew0KICBjdXJzb3I6IG5vdC1hbGxvd2VkOw0KfQ0KDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0gew0KICBjdXJzb3I6IHBvaW50ZXI7DQp9DQoNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXSAuY2hvaWNlc19faW5uZXIgew0KICBwYWRkaW5nLWJvdHRvbTogNy41cHg7DQp9DQoNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXSAuY2hvaWNlc19faW5wdXQgew0KICBkaXNwbGF5OiBibG9jazsNCiAgd2lkdGg6IDEwMCU7DQogIHBhZGRpbmc6IDEwcHg7DQogIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjREREREREOw0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGOw0KICBtYXJnaW46IDA7DQp9DQoNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXSAuY2hvaWNlc19fYnV0dG9uIHsNCiAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1qRWlJR2hsYVdkb2REMGlNakVpSUhacFpYZENiM2c5SWpBZ01DQXlNU0F5TVNJZ2VHMXNibk05SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01EQXZjM1puSWo0OFp5Qm1hV3hzUFNJak1EQXdJaUJtYVd4c0xYSjFiR1U5SW1WMlpXNXZaR1FpUGp4d1lYUm9JR1E5SWsweUxqVTVNaTR3TkRSc01UZ3VNelkwSURFNExqTTJOQzB5TGpVME9DQXlMalUwT0V3dU1EUTBJREl1TlRreWVpSXZQanh3WVhSb0lHUTlJazB3SURFNExqTTJORXd4T0M0ek5qUWdNR3d5TGpVME9DQXlMalUwT0V3eUxqVTBPQ0F5TUM0NU1USjZJaTgrUEM5blBqd3ZjM1puUGc9PSk7DQogIHBhZGRpbmc6IDA7DQogIGJhY2tncm91bmQtc2l6ZTogOHB4Ow0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogNTAlOw0KICByaWdodDogMDsNCiAgbWFyZ2luLXRvcDogLTEwcHg7DQogIG1hcmdpbi1yaWdodDogMjVweDsNCiAgaGVpZ2h0OiAyMHB4Ow0KICB3aWR0aDogMjBweDsNCiAgYm9yZGVyLXJhZGl1czogMTBlbTsNCiAgb3BhY2l0eTogLjU7DQp9DQoNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXSAuY2hvaWNlc19fYnV0dG9uOmhvdmVyLA0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdIC5jaG9pY2VzX19idXR0b246Zm9jdXMgew0KICBvcGFjaXR5OiAxOw0KfQ0KDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0gLmNob2ljZXNfX2J1dHRvbjpmb2N1cyB7DQogIGJveC1zaGFkb3c6IDBweCAwcHggMHB4IDJweCAjMDBCQ0Q0Ow0KfQ0KDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl06YWZ0ZXIgew0KICBjb250ZW50OiAiIjsNCiAgaGVpZ2h0OiAwOw0KICB3aWR0aDogMDsNCiAgYm9yZGVyLXN0eWxlOiBzb2xpZDsNCiAgYm9yZGVyLWNvbG9yOiAjMzMzMzMzIHRyYW5zcGFyZW50IHRyYW5zcGFyZW50IHRyYW5zcGFyZW50Ow0KICBib3JkZXItd2lkdGg6IDVweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICByaWdodDogMTEuNXB4Ow0KICB0b3A6IDUwJTsNCiAgbWFyZ2luLXRvcDogLTIuNXB4Ow0KICBwb2ludGVyLWV2ZW50czogbm9uZTsNCn0NCg0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdLmlzLW9wZW46YWZ0ZXIgew0KICBib3JkZXItY29sb3I6IHRyYW5zcGFyZW50IHRyYW5zcGFyZW50ICMzMzMzMzMgdHJhbnNwYXJlbnQ7DQogIG1hcmdpbi10b3A6IC03LjVweDsNCn0NCg0KLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdW2Rpcj0icnRsIl06YWZ0ZXIgew0KICBsZWZ0OiAxMS41cHg7DQogIHJpZ2h0OiBhdXRvOw0KfQ0KDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl1bZGlyPSJydGwiXSAuY2hvaWNlc19fYnV0dG9uIHsNCiAgcmlnaHQ6IGF1dG87DQogIGxlZnQ6IDA7DQogIG1hcmdpbi1sZWZ0OiAyNXB4Ow0KICBtYXJnaW4tcmlnaHQ6IDA7DQp9DQoNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1tdWx0aXBsZSJdIC5jaG9pY2VzX19pbm5lciwNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InRleHQiXSAuY2hvaWNlc19faW5uZXIgew0KICBjdXJzb3I6IHRleHQ7DQp9DQoNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1tdWx0aXBsZSJdIC5jaG9pY2VzX19idXR0b24sDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJ0ZXh0Il0gLmNob2ljZXNfX2J1dHRvbiB7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICBtYXJnaW4tdG9wOiAwOw0KICBtYXJnaW4tcmlnaHQ6IC00cHg7DQogIG1hcmdpbi1ib3R0b206IDA7DQogIG1hcmdpbi1sZWZ0OiA4cHg7DQogIHBhZGRpbmctbGVmdDogMTZweDsNCiAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAjMDA4ZmExOw0KICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTWpFaUlHaGxhV2RvZEQwaU1qRWlJSFpwWlhkQ2IzZzlJakFnTUNBeU1TQXlNU0lnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JajQ4WnlCbWFXeHNQU0lqUmtaR0lpQm1hV3hzTFhKMWJHVTlJbVYyWlc1dlpHUWlQanh3WVhSb0lHUTlJazB5TGpVNU1pNHdORFJzTVRndU16WTBJREU0TGpNMk5DMHlMalUwT0NBeUxqVTBPRXd1TURRMElESXVOVGt5ZWlJdlBqeHdZWFJvSUdROUlrMHdJREU0TGpNMk5Fd3hPQzR6TmpRZ01Hd3lMalUwT0NBeUxqVTBPRXd5TGpVME9DQXlNQzQ1TVRKNklpOCtQQzluUGp3dmMzWm5QZz09KTsNCiAgYmFja2dyb3VuZC1zaXplOiA4cHg7DQogIHdpZHRoOiA4cHg7DQogIGxpbmUtaGVpZ2h0OiAxOw0KICBvcGFjaXR5OiAuNzU7DQogIGJvcmRlci1yYWRpdXM6IDA7DQp9DQoNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1tdWx0aXBsZSJdIC5jaG9pY2VzX19idXR0b246aG92ZXIsDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3QtbXVsdGlwbGUiXSAuY2hvaWNlc19fYnV0dG9uOmZvY3VzLA0KLmNob2ljZXNbZGF0YS10eXBlKj0idGV4dCJdIC5jaG9pY2VzX19idXR0b246aG92ZXIsDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJ0ZXh0Il0gLmNob2ljZXNfX2J1dHRvbjpmb2N1cyB7DQogIG9wYWNpdHk6IDE7DQp9DQoNCi5jaG9pY2VzX19pbm5lciB7DQogIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgd2lkdGg6IDEwMCU7DQogIGJhY2tncm91bmQtY29sb3I6ICNmOWY5Zjk7DQogIHBhZGRpbmc6IDcuNXB4IDcuNXB4IDMuNzVweDsNCiAgYm9yZGVyOiAxcHggc29saWQgI0RERERERDsNCiAgYm9yZGVyLXJhZGl1czogMi41cHg7DQogIGZvbnQtc2l6ZTogMTJweDsNCiAgbWluLWhlaWdodDogMjRweDsNCiAgb3ZlcmZsb3c6IGhpZGRlbjsNCn0NCg0KLmlzLWZvY3VzZWQgLmNob2ljZXNfX2lubmVyLA0KLmlzLW9wZW4gLmNob2ljZXNfX2lubmVyIHsNCiAgYm9yZGVyLWNvbG9yOiAjYjdiN2I3Ow0KfQ0KDQouaXMtb3BlbiAuY2hvaWNlc19faW5uZXIgew0KICBib3JkZXItcmFkaXVzOiAyLjVweCAyLjVweCAwIDA7DQp9DQoNCi5pcy1mbGlwcGVkLmlzLW9wZW4gLmNob2ljZXNfX2lubmVyIHsNCiAgYm9yZGVyLXJhZGl1czogMCAwIDIuNXB4IDIuNXB4Ow0KfQ0KDQouY2hvaWNlc19fbGlzdCB7DQogIG1hcmdpbjogMDsNCiAgcGFkZGluZy1sZWZ0OiAwOw0KICBsaXN0LXN0eWxlOiBub25lOw0KfQ0KDQouY2hvaWNlc19fbGlzdC0tc2luZ2xlIHsNCiAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICBwYWRkaW5nOiA0cHggMTZweCA0cHggNHB4Ow0KICB3aWR0aDogMTAwJTsNCn0NCg0KW2Rpcj0icnRsIl0gLmNob2ljZXNfX2xpc3QtLXNpbmdsZSB7DQogIHBhZGRpbmctcmlnaHQ6IDRweDsNCiAgcGFkZGluZy1sZWZ0OiAxNnB4Ow0KfQ0KDQouY2hvaWNlc19fbGlzdC0tc2luZ2xlIC5jaG9pY2VzX19pdGVtIHsNCiAgd2lkdGg6IDEwMCU7DQp9DQoNCi5jaG9pY2VzX19saXN0LS1tdWx0aXBsZSB7DQogIGRpc3BsYXk6IGlubGluZTsNCn0NCg0KLmNob2ljZXNfX2xpc3QtLW11bHRpcGxlIC5jaG9pY2VzX19pdGVtIHsNCiAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOw0KICBib3JkZXItcmFkaXVzOiAyMHB4Ow0KICBwYWRkaW5nOiA0cHggMTBweDsNCiAgZm9udC1zaXplOiAxMnB4Ow0KICBmb250LXdlaWdodDogNTAwOw0KICBtYXJnaW4tcmlnaHQ6IDMuNzVweDsNCiAgbWFyZ2luLWJvdHRvbTogMy43NXB4Ow0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDBCQ0Q0Ow0KICBib3JkZXI6IDFweCBzb2xpZCAjMDBhNWJiOw0KICBjb2xvcjogI0ZGRkZGRjsNCiAgd29yZC1icmVhazogYnJlYWstYWxsOw0KfQ0KDQouY2hvaWNlc19fbGlzdC0tbXVsdGlwbGUgLmNob2ljZXNfX2l0ZW1bZGF0YS1kZWxldGFibGVdIHsNCiAgcGFkZGluZy1yaWdodDogNXB4Ow0KfQ0KDQpbZGlyPSJydGwiXSAuY2hvaWNlc19fbGlzdC0tbXVsdGlwbGUgLmNob2ljZXNfX2l0ZW0gew0KICBtYXJnaW4tcmlnaHQ6IDA7DQogIG1hcmdpbi1sZWZ0OiAzLjc1cHg7DQp9DQoNCi5jaG9pY2VzX19saXN0LS1tdWx0aXBsZSAuY2hvaWNlc19faXRlbS5pcy1oaWdobGlnaHRlZCB7DQogIGJhY2tncm91bmQtY29sb3I6ICMwMGE1YmI7DQogIGJvcmRlcjogMXB4IHNvbGlkICMwMDhmYTE7DQp9DQoNCi5pcy1kaXNhYmxlZCAuY2hvaWNlc19fbGlzdC0tbXVsdGlwbGUgLmNob2ljZXNfX2l0ZW0gew0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjYWFhYWFhOw0KICBib3JkZXI6IDFweCBzb2xpZCAjOTE5MTkxOw0KfQ0KDQouY2hvaWNlc19fbGlzdC0tZHJvcGRvd24gew0KICBkaXNwbGF5OiBub25lOw0KICB6LWluZGV4OiAxOw0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHdpZHRoOiAxMDAlOw0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGOw0KICBib3JkZXI6IDFweCBzb2xpZCAjREREREREOw0KICB0b3A6IDEwMCU7DQogIG1hcmdpbi10b3A6IC0xcHg7DQogIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDIuNXB4Ow0KICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMi41cHg7DQogIG92ZXJmbG93OiBoaWRkZW47DQogIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsNCn0NCg0KLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duLmlzLWFjdGl2ZSB7DQogIGRpc3BsYXk6IGJsb2NrOw0KfQ0KDQouaXMtb3BlbiAuY2hvaWNlc19fbGlzdC0tZHJvcGRvd24gew0KICBib3JkZXItY29sb3I6ICNiN2I3Yjc7DQp9DQoNCi5pcy1mbGlwcGVkIC5jaG9pY2VzX19saXN0LS1kcm9wZG93biB7DQogIHRvcDogYXV0bzsNCiAgYm90dG9tOiAxMDAlOw0KICBtYXJnaW4tdG9wOiAwOw0KICBtYXJnaW4tYm90dG9tOiAtMXB4Ow0KICBib3JkZXItcmFkaXVzOiAuMjVyZW0gLjI1cmVtIDAgMDsNCn0NCg0KLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19saXN0IHsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KICBtYXgtaGVpZ2h0OiAzMDBweDsNCiAgb3ZlcmZsb3c6IGF1dG87DQogIC13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nOiB0b3VjaDsNCiAgd2lsbC1jaGFuZ2U6IHNjcm9sbC1wb3NpdGlvbjsNCn0NCg0KLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19pdGVtIHsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KICBwYWRkaW5nOiAxMHB4Ow0KICBmb250LXNpemU6IDEycHg7DQp9DQoNCltkaXI9InJ0bCJdIC5jaG9pY2VzX19saXN0LS1kcm9wZG93biAuY2hvaWNlc19faXRlbSB7DQogIHRleHQtYWxpZ246IHJpZ2h0Ow0KfQ0KDQpAbWVkaWEgKG1pbi13aWR0aDogNjQwcHgpIHsNCiAgLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19pdGVtLS1zZWxlY3RhYmxlIHsNCiAgICBwYWRkaW5nLXJpZ2h0OiAxMDBweDsNCiAgfQ0KDQogIC5jaG9pY2VzX19saXN0LS1kcm9wZG93biAuY2hvaWNlc19faXRlbS0tc2VsZWN0YWJsZTphZnRlciB7DQogICAgY29udGVudDogYXR0cihkYXRhLXNlbGVjdC10ZXh0KTsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgb3BhY2l0eTogMDsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgcmlnaHQ6IDEwcHg7DQogICAgdG9wOiA1MCU7DQogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01MCUpOw0KICB9DQoNCiAgW2Rpcj0icnRsIl0gLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19pdGVtLS1zZWxlY3RhYmxlIHsNCiAgICB0ZXh0LWFsaWduOiByaWdodDsNCiAgICBwYWRkaW5nLWxlZnQ6IDEwMHB4Ow0KICAgIHBhZGRpbmctcmlnaHQ6IDEwcHg7DQogIH0NCg0KICBbZGlyPSJydGwiXSAuY2hvaWNlc19fbGlzdC0tZHJvcGRvd24gLmNob2ljZXNfX2l0ZW0tLXNlbGVjdGFibGU6YWZ0ZXIgew0KICAgIHJpZ2h0OiBhdXRvOw0KICAgIGxlZnQ6IDEwcHg7DQogIH0NCn0NCg0KLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19pdGVtLS1zZWxlY3RhYmxlLmlzLWhpZ2hsaWdodGVkIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2YyZjJmMjsNCn0NCg0KLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19pdGVtLS1zZWxlY3RhYmxlLmlzLWhpZ2hsaWdodGVkOmFmdGVyIHsNCiAgb3BhY2l0eTogLjU7DQp9DQoNCi5jaG9pY2VzX19pdGVtIHsNCiAgY3Vyc29yOiBkZWZhdWx0Ow0KfQ0KDQouY2hvaWNlc19faXRlbS0tc2VsZWN0YWJsZSB7DQogIGN1cnNvcjogcG9pbnRlcjsNCn0NCg0KLmNob2ljZXNfX2l0ZW0tLWRpc2FibGVkIHsNCiAgY3Vyc29yOiBub3QtYWxsb3dlZDsNCiAgdXNlci1zZWxlY3Q6IG5vbmU7DQogIG9wYWNpdHk6IC41Ow0KfQ0KDQouY2hvaWNlc19faGVhZGluZyB7DQogIGZvbnQtd2VpZ2h0OiA2MDA7DQogIGZvbnQtc2l6ZTogMTJweDsNCiAgcGFkZGluZzogMTBweDsNCiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNmN2Y3Zjc7DQogIGNvbG9yOiBncmF5Ow0KfQ0KDQouY2hvaWNlc19fYnV0dG9uIHsNCiAgdGV4dC1pbmRlbnQ6IC05OTk5cHg7DQogIC13ZWJraXQtYXBwZWFyYW5jZTogbm9uZTsNCiAgYXBwZWFyYW5jZTogbm9uZTsNCiAgYm9yZGVyOiAwOw0KICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsNCiAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsNCiAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOw0KICBjdXJzb3I6IHBvaW50ZXI7DQp9DQoNCi5jaG9pY2VzX19idXR0b246Zm9jdXMgew0KICBvdXRsaW5lOiBub25lOw0KfQ0KDQouY2hvaWNlc19faW5wdXQgew0KICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogIHZlcnRpY2FsLWFsaWduOiBiYXNlbGluZTsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZjlmOTsNCiAgZm9udC1zaXplOiAxMnB4Ow0KICBtYXJnaW4tYm90dG9tOiA1cHg7DQogIGJvcmRlcjogMDsNCiAgYm9yZGVyLXJhZGl1czogMDsNCiAgbWF4LXdpZHRoOiAxMDAlOw0KICBwYWRkaW5nOiA0cHggMCA0cHggMnB4Ow0KfQ0KDQouY2hvaWNlc19faW5wdXQ6Zm9jdXMgew0KICBvdXRsaW5lOiAwOw0KfQ0KDQpbZGlyPSJydGwiXSAuY2hvaWNlc19faW5wdXQgew0KICBwYWRkaW5nLXJpZ2h0OiAycHg7DQogIHBhZGRpbmctbGVmdDogMDsNCn0NCg0KLmNob2ljZXNfX3BsYWNlaG9sZGVyIHsNCiAgb3BhY2l0eTogLjU7DQp9DQoNCi5jaG9pY2VzX19pbnB1dC5pcy1oaWRkZW4sDQouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0gLmNob2ljZXNfX2lucHV0LmlzLWhpZGRlbiwNCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1tdWx0aXBsZSJdIC5jaG9pY2VzX19pbnB1dC5pcy1oaWRkZW4gew0KICBkaXNwbGF5OiBub25lOw0KfQ0KDQovKj09PT09ICBFbmQgb2YgQ2hvaWNlcyAgPT09PT09Ki8NCg0KICA8L3N0eWxlPg0KICA8c2NyaXB0Pg0KICAvKiEgY2hvaWNlcy5qcyB2NC4xLjIgfCAoYykgMjAxOCBKb3NoIEpvaG5zb24gfCBodHRwczovL2dpdGh1Yi5jb20vanNoam9obnNvbi9DaG9pY2VzI3JlYWRtZSAqLw0KKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHsNCiAgIC8vQ29tbW9uSlMyDQoJaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKQ0KCQltb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTsNCiAgIC8vQU1EDQoJZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpDQoJCWRlZmluZShbXSwgZmFjdG9yeSk7DQogICAvL0NvbW1vbkpTDQoJZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpDQoJCWV4cG9ydHNbIkNob2ljZXMiXSA9IGZhY3RvcnkoKTsNCiAgIC8vV2luZG93DQoJZWxzZQ0KCQlyb290WyJDaG9pY2VzIl0gPSBmYWN0b3J5KCk7DQp9KSh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDogdGhpcywgZnVuY3Rpb24oKSB7DQpyZXR1cm4gLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcA0KLyoqKioqKi8gCS8vIFRoZSBtb2R1bGUgY2FjaGUNCi8qKioqKiovIAl2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9Ow0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBUaGUgcmVxdWlyZSBmdW5jdGlvbg0KLyoqKioqKi8gCWZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHsNCi8qKioqKiovDQovKioqKioqLyAJCS8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZQ0KLyoqKioqKi8gCQlpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkgew0KLyoqKioqKi8gCQkJcmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7DQovKioqKioqLyAJCX0NCi8qKioqKiovIAkJLy8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSkNCi8qKioqKiovIAkJdmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0gew0KLyoqKioqKi8gCQkJaTogbW9kdWxlSWQsDQovKioqKioqLyAJCQlsOiBmYWxzZSwNCi8qKioqKiovIAkJCWV4cG9ydHM6IHt9DQovKioqKioqLyAJCX07DQovKioqKioqLw0KLyoqKioqKi8gCQkvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb24NCi8qKioqKiovIAkJbW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7DQovKioqKioqLw0KLyoqKioqKi8gCQkvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkDQovKioqKioqLyAJCW1vZHVsZS5sID0gdHJ1ZTsNCi8qKioqKiovDQovKioqKioqLyAJCS8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlDQovKioqKioqLyAJCXJldHVybiBtb2R1bGUuZXhwb3J0czsNCi8qKioqKiovIAl9DQovKioqKioqLw0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKQ0KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7DQovKioqKioqLw0KLyoqKioqKi8gCS8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlDQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlczsNCi8qKioqKiovDQovKioqKioqLyAJLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzDQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7DQovKioqKioqLyAJCWlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHsNCi8qKioqKiovIAkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7DQovKioqKioqLyAJCQkJY29uZmlndXJhYmxlOiBmYWxzZSwNCi8qKioqKiovIAkJCQllbnVtZXJhYmxlOiB0cnVlLA0KLyoqKioqKi8gCQkJCWdldDogZ2V0dGVyDQovKioqKioqLyAJCQl9KTsNCi8qKioqKiovIAkJfQ0KLyoqKioqKi8gCX07DQovKioqKioqLw0KLyoqKioqKi8gCS8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzDQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7DQovKioqKioqLyAJCXZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgPw0KLyoqKioqKi8gCQkJZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDoNCi8qKioqKiovIAkJCWZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07DQovKioqKioqLyAJCV9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTsNCi8qKioqKiovIAkJcmV0dXJuIGdldHRlcjsNCi8qKioqKiovIAl9Ow0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwNCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07DQovKioqKioqLw0KLyoqKioqKi8gCS8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fDQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gIi9wdWJsaWMvYXNzZXRzL3NjcmlwdHMvIjsNCi8qKioqKiovDQovKioqKioqLyAJLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzDQovKioqKioqLyAJcmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMzcpOw0KLyoqKioqKi8gfSkNCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQovKioqKioqLyAoWw0KLyogMCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgc3RvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI2KSgnd2tzJyk7DQp2YXIgdWlkID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMyk7DQp2YXIgU3ltYm9sID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKS5TeW1ib2w7DQp2YXIgVVNFX1NZTUJPTCA9IHR5cGVvZiBTeW1ib2wgPT0gJ2Z1bmN0aW9uJzsNCg0KdmFyICRleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAobmFtZSkgew0KICByZXR1cm4gc3RvcmVbbmFtZV0gfHwgKHN0b3JlW25hbWVdID0NCiAgICBVU0VfU1lNQk9MICYmIFN5bWJvbFtuYW1lXSB8fCAoVVNFX1NZTUJPTCA/IFN5bWJvbCA6IHVpZCkoJ1N5bWJvbC4nICsgbmFtZSkpOw0KfTsNCg0KJGV4cG9ydHMuc3RvcmUgPSBzdG9yZTsNCg0KDQovKioqLyB9KSwNCi8qIDEgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KLyogZXNsaW50LWRpc2FibGUgKi8NCg0KdmFyIGdldFJhbmRvbU51bWJlciA9IGV4cG9ydHMuZ2V0UmFuZG9tTnVtYmVyID0gZnVuY3Rpb24gZ2V0UmFuZG9tTnVtYmVyKG1pbiwgbWF4KSB7DQogIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluKSArIG1pbik7DQp9Ow0KDQp2YXIgZ2VuZXJhdGVDaGFycyA9IGV4cG9ydHMuZ2VuZXJhdGVDaGFycyA9IGZ1bmN0aW9uIGdlbmVyYXRlQ2hhcnMobGVuZ3RoKSB7DQogIHZhciBjaGFycyA9ICcnOw0KDQogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICB2YXIgcmFuZG9tQ2hhciA9IGdldFJhbmRvbU51bWJlcigwLCAzNik7DQogICAgY2hhcnMgKz0gcmFuZG9tQ2hhci50b1N0cmluZygzNik7DQogIH0NCg0KICByZXR1cm4gY2hhcnM7DQp9Ow0KDQp2YXIgZ2VuZXJhdGVJZCA9IGV4cG9ydHMuZ2VuZXJhdGVJZCA9IGZ1bmN0aW9uIGdlbmVyYXRlSWQoZWxlbWVudCwgcHJlZml4KSB7DQogIHZhciBpZCA9IGVsZW1lbnQuaWQgfHwgZWxlbWVudC5uYW1lICYmIGVsZW1lbnQubmFtZSArICctJyArIGdlbmVyYXRlQ2hhcnMoMikgfHwgZ2VuZXJhdGVDaGFycyg0KTsNCiAgaWQgPSBpZC5yZXBsYWNlKC8oOnxcLnxcW3xcXXwsKS9nLCAnJyk7DQogIGlkID0gcHJlZml4ICsgJy0nICsgaWQ7DQoNCiAgcmV0dXJuIGlkOw0KfTsNCg0KdmFyIGdldFR5cGUgPSBleHBvcnRzLmdldFR5cGUgPSBmdW5jdGlvbiBnZXRUeXBlKG9iaikgew0KICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikuc2xpY2UoOCwgLTEpOw0KfTsNCg0KdmFyIGlzVHlwZSA9IGV4cG9ydHMuaXNUeXBlID0gZnVuY3Rpb24gaXNUeXBlKHR5cGUsIG9iaikgew0KICB2YXIgY2xhcyA9IGdldFR5cGUob2JqKTsNCiAgcmV0dXJuIG9iaiAhPT0gdW5kZWZpbmVkICYmIG9iaiAhPT0gbnVsbCAmJiBjbGFzID09PSB0eXBlOw0KfTsNCg0KdmFyIGlzRWxlbWVudCA9IGV4cG9ydHMuaXNFbGVtZW50ID0gZnVuY3Rpb24gaXNFbGVtZW50KGVsZW1lbnQpIHsNCiAgcmV0dXJuIGVsZW1lbnQgaW5zdGFuY2VvZiBFbGVtZW50Ow0KfTsNCg0KdmFyIGV4dGVuZCA9IGV4cG9ydHMuZXh0ZW5kID0gZnVuY3Rpb24gZXh0ZW5kKCkgew0KICB2YXIgZXh0ZW5kZWQgPSB7fTsNCiAgdmFyIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7DQoNCiAgLyoqDQogICAqIE1lcmdlIG9uZSBvYmplY3QgaW50byBhbm90aGVyDQogICAqIEBwYXJhbSAge09iamVjdH0gb2JqICBPYmplY3QgdG8gbWVyZ2UgaW50byBleHRlbmRlZCBvYmplY3QNCiAgICovDQogIHZhciBtZXJnZSA9IGZ1bmN0aW9uIG1lcmdlKG9iaikgew0KICAgIGZvciAodmFyIHByb3AgaW4gb2JqKSB7DQogICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIHsNCiAgICAgICAgLy8gSWYgZGVlcCBtZXJnZSBhbmQgcHJvcGVydHkgaXMgYW4gb2JqZWN0LCBtZXJnZSBwcm9wZXJ0aWVzDQogICAgICAgIGlmIChpc1R5cGUoJ09iamVjdCcsIG9ialtwcm9wXSkpIHsNCiAgICAgICAgICBleHRlbmRlZFtwcm9wXSA9IGV4dGVuZCh0cnVlLCBleHRlbmRlZFtwcm9wXSwgb2JqW3Byb3BdKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBleHRlbmRlZFtwcm9wXSA9IG9ialtwcm9wXTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfTsNCg0KICAvLyBMb29wIHRocm91Z2ggZWFjaCBwYXNzZWQgYXJndW1lbnQNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgew0KICAgIC8vIHN0b3JlIGFyZ3VtZW50IGF0IHBvc2l0aW9uIGkNCiAgICB2YXIgb2JqID0gYXJndW1lbnRzW2ldOw0KDQogICAgLy8gSWYgd2UgYXJlIGluIGZhY3QgZGVhbGluZyB3aXRoIGFuIG9iamVjdCwgbWVyZ2UgaXQuDQogICAgaWYgKGlzVHlwZSgnT2JqZWN0Jywgb2JqKSkgew0KICAgICAgbWVyZ2Uob2JqKTsNCiAgICB9DQogIH0NCg0KICByZXR1cm4gZXh0ZW5kZWQ7DQp9Ow0KDQp2YXIgd3JhcCA9IGV4cG9ydHMud3JhcCA9IGZ1bmN0aW9uIHdyYXAoZWxlbWVudCwgd3JhcHBlcikgew0KICB3cmFwcGVyID0gd3JhcHBlciB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCiAgaWYgKGVsZW1lbnQubmV4dFNpYmxpbmcpIHsNCiAgICBlbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHdyYXBwZXIsIGVsZW1lbnQubmV4dFNpYmxpbmcpOw0KICB9IGVsc2Ugew0KICAgIGVsZW1lbnQucGFyZW50Tm9kZS5hcHBlbmRDaGlsZCh3cmFwcGVyKTsNCiAgfQ0KICByZXR1cm4gd3JhcHBlci5hcHBlbmRDaGlsZChlbGVtZW50KTsNCn07DQoNCnZhciBmaW5kQW5jZXN0b3IgPSBleHBvcnRzLmZpbmRBbmNlc3RvciA9IGZ1bmN0aW9uIGZpbmRBbmNlc3RvcihlbCwgY2xzKSB7DQogIHdoaWxlICgoZWwgPSBlbC5wYXJlbnRFbGVtZW50KSAmJiAhZWwuY2xhc3NMaXN0LmNvbnRhaW5zKGNscykpIHt9DQogIHJldHVybiBlbDsNCn07DQoNCnZhciBmaW5kQW5jZXN0b3JCeUF0dHJOYW1lID0gZXhwb3J0cy5maW5kQW5jZXN0b3JCeUF0dHJOYW1lID0gZnVuY3Rpb24gZmluZEFuY2VzdG9yQnlBdHRyTmFtZShlbCwgYXR0cikgew0KICB2YXIgdGFyZ2V0ID0gZWw7DQoNCiAgd2hpbGUgKHRhcmdldCkgew0KICAgIGlmICh0YXJnZXQuaGFzQXR0cmlidXRlKGF0dHIpKSB7DQogICAgICByZXR1cm4gdGFyZ2V0Ow0KICAgIH0NCg0KICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnRFbGVtZW50Ow0KICB9DQoNCiAgcmV0dXJuIG51bGw7DQp9Ow0KDQp2YXIgZ2V0QWRqYWNlbnRFbCA9IGV4cG9ydHMuZ2V0QWRqYWNlbnRFbCA9IGZ1bmN0aW9uIGdldEFkamFjZW50RWwoc3RhcnRFbCwgY2xhc3NOYW1lKSB7DQogIHZhciBkaXJlY3Rpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IDE7DQoNCiAgaWYgKCFzdGFydEVsIHx8ICFjbGFzc05hbWUpIHJldHVybjsNCg0KICB2YXIgcGFyZW50ID0gc3RhcnRFbC5wYXJlbnROb2RlLnBhcmVudE5vZGU7DQogIHZhciBjaGlsZHJlbiA9IEFycmF5LmZyb20ocGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY2xhc3NOYW1lKSk7DQoNCiAgdmFyIHN0YXJ0UG9zID0gY2hpbGRyZW4uaW5kZXhPZihzdGFydEVsKTsNCiAgdmFyIG9wZXJhdG9yRGlyZWN0aW9uID0gZGlyZWN0aW9uID4gMCA/IDEgOiAtMTsNCg0KICByZXR1cm4gY2hpbGRyZW5bc3RhcnRQb3MgKyBvcGVyYXRvckRpcmVjdGlvbl07DQp9Ow0KDQp2YXIgaXNTY3JvbGxlZEludG9WaWV3ID0gZXhwb3J0cy5pc1Njcm9sbGVkSW50b1ZpZXcgPSBmdW5jdGlvbiBpc1Njcm9sbGVkSW50b1ZpZXcoZWwsIHBhcmVudCkgew0KICB2YXIgZGlyZWN0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAxOw0KDQogIGlmICghZWwpIHJldHVybjsNCg0KICB2YXIgaXNWaXNpYmxlID0gdm9pZCAwOw0KDQogIGlmIChkaXJlY3Rpb24gPiAwKSB7DQogICAgLy8gSW4gdmlldyBmcm9tIGJvdHRvbQ0KICAgIGlzVmlzaWJsZSA9IHBhcmVudC5zY3JvbGxUb3AgKyBwYXJlbnQub2Zmc2V0SGVpZ2h0ID49IGVsLm9mZnNldFRvcCArIGVsLm9mZnNldEhlaWdodDsNCiAgfSBlbHNlIHsNCiAgICAvLyBJbiB2aWV3IGZyb20gdG9wDQogICAgaXNWaXNpYmxlID0gZWwub2Zmc2V0VG9wID49IHBhcmVudC5zY3JvbGxUb3A7DQogIH0NCg0KICByZXR1cm4gaXNWaXNpYmxlOw0KfTsNCg0KdmFyIHN0cmlwSFRNTCA9IGV4cG9ydHMuc3RyaXBIVE1MID0gZnVuY3Rpb24gc3RyaXBIVE1MKGh0bWwpIHsNCiAgcmV0dXJuIGh0bWwucmVwbGFjZSgvJi9nLCAnJmFtcDsnKS5yZXBsYWNlKC8+L2csICcmcnQ7JykucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLyIvZywgJyZxdW90OycpOw0KfTsNCg0KdmFyIHN0clRvRWwgPSBleHBvcnRzLnN0clRvRWwgPSBmdW5jdGlvbiAoKSB7DQogIHZhciB0bXBFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICByZXR1cm4gZnVuY3Rpb24gKHN0cikgew0KICAgIHZhciBjbGVhbmVkSW5wdXQgPSBzdHIudHJpbSgpOw0KICAgIHZhciByID0gdm9pZCAwOw0KICAgIHRtcEVsLmlubmVySFRNTCA9IGNsZWFuZWRJbnB1dDsNCiAgICByID0gdG1wRWwuY2hpbGRyZW5bMF07DQoNCiAgICB3aGlsZSAodG1wRWwuZmlyc3RDaGlsZCkgew0KICAgICAgdG1wRWwucmVtb3ZlQ2hpbGQodG1wRWwuZmlyc3RDaGlsZCk7DQogICAgfQ0KDQogICAgcmV0dXJuIHI7DQogIH07DQp9KCk7DQoNCi8qKg0KICogRGV0ZXJtaW5lcyB0aGUgd2lkdGggb2YgYSBwYXNzZWQgaW5wdXQgYmFzZWQgb24gaXRzIHZhbHVlIGFuZCBwYXNzZXMNCiAqIGl0IHRvIHRoZSBzdXBwbGllZCBjYWxsYmFjayBmdW5jdGlvbi4NCiAqLw0KdmFyIGNhbGNXaWR0aE9mSW5wdXQgPSBleHBvcnRzLmNhbGNXaWR0aE9mSW5wdXQgPSBmdW5jdGlvbiBjYWxjV2lkdGhPZklucHV0KGlucHV0LCBjYWxsYmFjaykgew0KICB2YXIgdmFsdWUgPSBpbnB1dC52YWx1ZSB8fCBpbnB1dC5wbGFjZWhvbGRlcjsNCiAgdmFyIHdpZHRoID0gaW5wdXQub2Zmc2V0V2lkdGg7DQoNCiAgaWYgKHZhbHVlKSB7DQogICAgdmFyIHRlc3RFbCA9IHN0clRvRWwoJzxzcGFuPicgKyBzdHJpcEhUTUwodmFsdWUpICsgJzwvc3Bhbj4nKTsNCiAgICB0ZXN0RWwuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOw0KICAgIHRlc3RFbC5zdHlsZS5wYWRkaW5nID0gJzAnOw0KICAgIHRlc3RFbC5zdHlsZS50b3AgPSAnLTk5OTlweCc7DQogICAgdGVzdEVsLnN0eWxlLmxlZnQgPSAnLTk5OTlweCc7DQogICAgdGVzdEVsLnN0eWxlLndpZHRoID0gJ2F1dG8nOw0KICAgIHRlc3RFbC5zdHlsZS53aGl0ZVNwYWNlID0gJ3ByZSc7DQoNCiAgICBpZiAoZG9jdW1lbnQuYm9keS5jb250YWlucyhpbnB1dCkgJiYgd2luZG93LmdldENvbXB1dGVkU3R5bGUpIHsNCiAgICAgIHZhciBpbnB1dFN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoaW5wdXQpOw0KDQogICAgICBpZiAoaW5wdXRTdHlsZSkgew0KICAgICAgICB0ZXN0RWwuc3R5bGUuZm9udFNpemUgPSBpbnB1dFN0eWxlLmZvbnRTaXplOw0KICAgICAgICB0ZXN0RWwuc3R5bGUuZm9udEZhbWlseSA9IGlucHV0U3R5bGUuZm9udEZhbWlseTsNCiAgICAgICAgdGVzdEVsLnN0eWxlLmZvbnRXZWlnaHQgPSBpbnB1dFN0eWxlLmZvbnRXZWlnaHQ7DQogICAgICAgIHRlc3RFbC5zdHlsZS5mb250U3R5bGUgPSBpbnB1dFN0eWxlLmZvbnRTdHlsZTsNCiAgICAgICAgdGVzdEVsLnN0eWxlLmxldHRlclNwYWNpbmcgPSBpbnB1dFN0eWxlLmxldHRlclNwYWNpbmc7DQogICAgICAgIHRlc3RFbC5zdHlsZS50ZXh0VHJhbnNmb3JtID0gaW5wdXRTdHlsZS50ZXh0VHJhbnNmb3JtOw0KICAgICAgICB0ZXN0RWwuc3R5bGUucGFkZGluZyA9IGlucHV0U3R5bGUucGFkZGluZzsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRlc3RFbCk7DQoNCiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgew0KICAgICAgaWYgKHZhbHVlICYmIHRlc3RFbC5vZmZzZXRXaWR0aCAhPT0gaW5wdXQub2Zmc2V0V2lkdGgpIHsNCiAgICAgICAgd2lkdGggPSB0ZXN0RWwub2Zmc2V0V2lkdGggKyA0Ow0KICAgICAgfQ0KDQogICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRlc3RFbCk7DQoNCiAgICAgIGNhbGxiYWNrLmNhbGwodW5kZWZpbmVkLCB3aWR0aCArICdweCcpOw0KICAgIH0pOw0KICB9IGVsc2Ugew0KICAgIGNhbGxiYWNrLmNhbGwodW5kZWZpbmVkLCB3aWR0aCArICdweCcpOw0KICB9DQp9Ow0KDQp2YXIgc29ydEJ5QWxwaGEgPSBleHBvcnRzLnNvcnRCeUFscGhhID0gZnVuY3Rpb24gc29ydEJ5QWxwaGEoYSwgYikgew0KICB2YXIgbGFiZWxBID0gKGEubGFiZWwgfHwgYS52YWx1ZSkudG9Mb3dlckNhc2UoKTsNCiAgdmFyIGxhYmVsQiA9IChiLmxhYmVsIHx8IGIudmFsdWUpLnRvTG93ZXJDYXNlKCk7DQoNCiAgaWYgKGxhYmVsQSA8IGxhYmVsQikgew0KICAgIHJldHVybiAtMTsNCiAgfQ0KDQogIGlmIChsYWJlbEEgPiBsYWJlbEIpIHsNCiAgICByZXR1cm4gMTsNCiAgfQ0KDQogIHJldHVybiAwOw0KfTsNCg0KdmFyIHNvcnRCeVNjb3JlID0gZXhwb3J0cy5zb3J0QnlTY29yZSA9IGZ1bmN0aW9uIHNvcnRCeVNjb3JlKGEsIGIpIHsNCiAgcmV0dXJuIGEuc2NvcmUgLSBiLnNjb3JlOw0KfTsNCg0KdmFyIGRpc3BhdGNoRXZlbnQgPSBleHBvcnRzLmRpc3BhdGNoRXZlbnQgPSBmdW5jdGlvbiBkaXNwYXRjaEV2ZW50KGVsZW1lbnQsIHR5cGUpIHsNCiAgdmFyIGN1c3RvbUFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IG51bGw7DQoNCiAgdmFyIGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KHR5cGUsIHsNCiAgICBkZXRhaWw6IGN1c3RvbUFyZ3MsDQogICAgYnViYmxlczogdHJ1ZSwNCiAgICBjYW5jZWxhYmxlOiB0cnVlDQogIH0pOw0KDQogIHJldHVybiBlbGVtZW50LmRpc3BhdGNoRXZlbnQoZXZlbnQpOw0KfTsNCg0KdmFyIHJlZ2V4RmlsdGVyID0gZXhwb3J0cy5yZWdleEZpbHRlciA9IGZ1bmN0aW9uIHJlZ2V4RmlsdGVyKHZhbHVlLCByZWdleCkgew0KICBpZiAoIXZhbHVlIHx8ICFyZWdleCkgew0KICAgIHJldHVybiBmYWxzZTsNCiAgfQ0KDQogIHZhciBleHByZXNzaW9uID0gbmV3IFJlZ0V4cChyZWdleC5zb3VyY2UsICdpJyk7DQogIHJldHVybiBleHByZXNzaW9uLnRlc3QodmFsdWUpOw0KfTsNCg0KdmFyIGdldFdpbmRvd0hlaWdodCA9IGV4cG9ydHMuZ2V0V2luZG93SGVpZ2h0ID0gZnVuY3Rpb24gZ2V0V2luZG93SGVpZ2h0KCkgew0KICB2YXIgYm9keSA9IGRvY3VtZW50LmJvZHk7DQogIHZhciBodG1sID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Ow0KICByZXR1cm4gTWF0aC5tYXgoYm9keS5zY3JvbGxIZWlnaHQsIGJvZHkub2Zmc2V0SGVpZ2h0LCBodG1sLmNsaWVudEhlaWdodCwgaHRtbC5zY3JvbGxIZWlnaHQsIGh0bWwub2Zmc2V0SGVpZ2h0KTsNCn07DQoNCnZhciByZWR1Y2VUb1ZhbHVlcyA9IGV4cG9ydHMucmVkdWNlVG9WYWx1ZXMgPSBmdW5jdGlvbiByZWR1Y2VUb1ZhbHVlcyhpdGVtcykgew0KICB2YXIga2V5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAndmFsdWUnOw0KDQogIHZhciB2YWx1ZXMgPSBpdGVtcy5yZWR1Y2UoZnVuY3Rpb24gKHByZXYsIGN1cnJlbnQpIHsNCiAgICBwcmV2LnB1c2goY3VycmVudFtrZXldKTsNCiAgICByZXR1cm4gcHJldjsNCiAgfSwgW10pOw0KDQogIHJldHVybiB2YWx1ZXM7DQp9Ow0KDQp2YXIgZmV0Y2hGcm9tT2JqZWN0ID0gZXhwb3J0cy5mZXRjaEZyb21PYmplY3QgPSBmdW5jdGlvbiBmZXRjaEZyb21PYmplY3Qob2JqZWN0LCBwYXRoKSB7DQogIHZhciBpbmRleCA9IHBhdGguaW5kZXhPZignLicpOw0KDQogIGlmIChpbmRleCA+IC0xKSB7DQogICAgcmV0dXJuIGZldGNoRnJvbU9iamVjdChvYmplY3RbcGF0aC5zdWJzdHJpbmcoMCwgaW5kZXgpXSwgcGF0aC5zdWJzdHIoaW5kZXggKyAxKSk7DQogIH0NCg0KICByZXR1cm4gb2JqZWN0W3BhdGhdOw0KfTsNCg0KdmFyIGlzSUUxMSA9IGV4cG9ydHMuaXNJRTExID0gZnVuY3Rpb24gaXNJRTExKCkgew0KICByZXR1cm4gISEobmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvVHJpZGVudC8pICYmIG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL3J2WyA6XTExLykpOw0KfTsNCg0KdmFyIGV4aXN0c0luQXJyYXkgPSBleHBvcnRzLmV4aXN0c0luQXJyYXkgPSBmdW5jdGlvbiBleGlzdHNJbkFycmF5KGFycmF5LCB2YWx1ZSkgew0KICB2YXIga2V5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAndmFsdWUnOw0KICByZXR1cm4gYXJyYXkuc29tZShmdW5jdGlvbiAoaXRlbSkgew0KICAgIGlmIChpc1R5cGUoJ1N0cmluZycsIHZhbHVlKSkgew0KICAgICAgcmV0dXJuIGl0ZW1ba2V5XSA9PT0gdmFsdWUudHJpbSgpOw0KICAgIH0NCg0KICAgIHJldHVybiBpdGVtW2tleV0gPT09IHZhbHVlOw0KICB9KTsNCn07DQoNCnZhciBjbG9uZU9iamVjdCA9IGV4cG9ydHMuY2xvbmVPYmplY3QgPSBmdW5jdGlvbiBjbG9uZU9iamVjdChvYmopIHsNCiAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqKSk7DQp9Ow0KDQp2YXIgZG9LZXlzTWF0Y2ggPSBleHBvcnRzLmRvS2V5c01hdGNoID0gZnVuY3Rpb24gZG9LZXlzTWF0Y2goYSwgYikgew0KICB2YXIgYUtleXMgPSBPYmplY3Qua2V5cyhhKS5zb3J0KCk7DQogIHZhciBiS2V5cyA9IE9iamVjdC5rZXlzKGIpLnNvcnQoKTsNCiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGFLZXlzKSA9PT0gSlNPTi5zdHJpbmdpZnkoYktleXMpOw0KfTsNCg0KLyoqKi8gfSksDQovKiAyICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCnZhciBjb3JlID0gbW9kdWxlLmV4cG9ydHMgPSB7IHZlcnNpb246ICcyLjUuNycgfTsNCmlmICh0eXBlb2YgX19lID09ICdudW1iZXInKSBfX2UgPSBjb3JlOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVuZGVmDQoNCg0KLyoqKi8gfSksDQovKiAzICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy84NiNpc3N1ZWNvbW1lbnQtMTE1NzU5MDI4DQp2YXIgZ2xvYmFsID0gbW9kdWxlLmV4cG9ydHMgPSB0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGgNCiAgPyB3aW5kb3cgOiB0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aCA/IHNlbGYNCiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLW5ldy1mdW5jDQogIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTsNCmlmICh0eXBlb2YgX19nID09ICdudW1iZXInKSBfX2cgPSBnbG9iYWw7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5kZWYNCg0KDQovKioqLyB9KSwNCi8qIDQgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIGRQID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KTsNCnZhciBjcmVhdGVEZXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMik7DQptb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMTApID8gZnVuY3Rpb24gKG9iamVjdCwga2V5LCB2YWx1ZSkgew0KICByZXR1cm4gZFAuZihvYmplY3QsIGtleSwgY3JlYXRlRGVzYygxLCB2YWx1ZSkpOw0KfSA6IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsNCiAgb2JqZWN0W2tleV0gPSB2YWx1ZTsNCiAgcmV0dXJuIG9iamVjdDsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA1ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCmV4cG9ydHMuU0NST0xMSU5HX1NQRUVEID0gZXhwb3J0cy5LRVlfQ09ERVMgPSBleHBvcnRzLkFDVElPTl9UWVBFUyA9IGV4cG9ydHMuRVZFTlRTID0gZXhwb3J0cy5ERUZBVUxUX0NPTkZJRyA9IGV4cG9ydHMuREVGQVVMVF9DTEFTU05BTUVTID0gdW5kZWZpbmVkOw0KDQp2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsNCg0KdmFyIERFRkFVTFRfQ0xBU1NOQU1FUyA9IGV4cG9ydHMuREVGQVVMVF9DTEFTU05BTUVTID0gew0KICBjb250YWluZXJPdXRlcjogJ2Nob2ljZXMnLA0KICBjb250YWluZXJJbm5lcjogJ2Nob2ljZXNfX2lubmVyJywNCiAgaW5wdXQ6ICdjaG9pY2VzX19pbnB1dCcsDQogIGlucHV0Q2xvbmVkOiAnY2hvaWNlc19faW5wdXQtLWNsb25lZCcsDQogIGxpc3Q6ICdjaG9pY2VzX19saXN0JywNCiAgbGlzdEl0ZW1zOiAnY2hvaWNlc19fbGlzdC0tbXVsdGlwbGUnLA0KICBsaXN0U2luZ2xlOiAnY2hvaWNlc19fbGlzdC0tc2luZ2xlJywNCiAgbGlzdERyb3Bkb3duOiAnY2hvaWNlc19fbGlzdC0tZHJvcGRvd24nLA0KICBpdGVtOiAnY2hvaWNlc19faXRlbScsDQogIGl0ZW1TZWxlY3RhYmxlOiAnY2hvaWNlc19faXRlbS0tc2VsZWN0YWJsZScsDQogIGl0ZW1EaXNhYmxlZDogJ2Nob2ljZXNfX2l0ZW0tLWRpc2FibGVkJywNCiAgaXRlbUNob2ljZTogJ2Nob2ljZXNfX2l0ZW0tLWNob2ljZScsDQogIHBsYWNlaG9sZGVyOiAnY2hvaWNlc19fcGxhY2Vob2xkZXInLA0KICBncm91cDogJ2Nob2ljZXNfX2dyb3VwJywNCiAgZ3JvdXBIZWFkaW5nOiAnY2hvaWNlc19faGVhZGluZycsDQogIGJ1dHRvbjogJ2Nob2ljZXNfX2J1dHRvbicsDQogIGFjdGl2ZVN0YXRlOiAnaXMtYWN0aXZlJywNCiAgZm9jdXNTdGF0ZTogJ2lzLWZvY3VzZWQnLA0KICBvcGVuU3RhdGU6ICdpcy1vcGVuJywNCiAgZGlzYWJsZWRTdGF0ZTogJ2lzLWRpc2FibGVkJywNCiAgaGlnaGxpZ2h0ZWRTdGF0ZTogJ2lzLWhpZ2hsaWdodGVkJywNCiAgaGlkZGVuU3RhdGU6ICdpcy1oaWRkZW4nLA0KICBmbGlwcGVkU3RhdGU6ICdpcy1mbGlwcGVkJywNCiAgbG9hZGluZ1N0YXRlOiAnaXMtbG9hZGluZycsDQogIG5vUmVzdWx0czogJ2hhcy1uby1yZXN1bHRzJywNCiAgbm9DaG9pY2VzOiAnaGFzLW5vLWNob2ljZXMnDQp9Ow0KDQp2YXIgREVGQVVMVF9DT05GSUcgPSBleHBvcnRzLkRFRkFVTFRfQ09ORklHID0gew0KICBpdGVtczogW10sDQogIGNob2ljZXM6IFtdLA0KICBzaWxlbnQ6IGZhbHNlLA0KICByZW5kZXJDaG9pY2VMaW1pdDogLTEsDQogIG1heEl0ZW1Db3VudDogLTEsDQogIGFkZEl0ZW1zOiB0cnVlLA0KICByZW1vdmVJdGVtczogdHJ1ZSwNCiAgcmVtb3ZlSXRlbUJ1dHRvbjogZmFsc2UsDQogIGVkaXRJdGVtczogZmFsc2UsDQogIGR1cGxpY2F0ZUl0ZW1zQWxsb3dlZDogdHJ1ZSwNCiAgZGVsaW1pdGVyOiAnLCcsDQogIHBhc3RlOiB0cnVlLA0KICBzZWFyY2hFbmFibGVkOiB0cnVlLA0KICBzZWFyY2hDaG9pY2VzOiB0cnVlLA0KICBzZWFyY2hGbG9vcjogMSwNCiAgc2VhcmNoUmVzdWx0TGltaXQ6IDQsDQogIHNlYXJjaEZpZWxkczogWydsYWJlbCcsICd2YWx1ZSddLA0KICBwb3NpdGlvbjogJ2F1dG8nLA0KICByZXNldFNjcm9sbFBvc2l0aW9uOiB0cnVlLA0KICByZWdleEZpbHRlcjogbnVsbCwNCiAgc2hvdWxkU29ydDogdHJ1ZSwNCiAgc2hvdWxkU29ydEl0ZW1zOiBmYWxzZSwNCiAgc29ydEZuOiBfdXRpbHMuc29ydEJ5QWxwaGEsDQogIHBsYWNlaG9sZGVyOiB0cnVlLA0KICBwbGFjZWhvbGRlclZhbHVlOiBudWxsLA0KICBzZWFyY2hQbGFjZWhvbGRlclZhbHVlOiBudWxsLA0KICBwcmVwZW5kVmFsdWU6IG51bGwsDQogIGFwcGVuZFZhbHVlOiBudWxsLA0KICByZW5kZXJTZWxlY3RlZENob2ljZXM6ICdhdXRvJywNCiAgbG9hZGluZ1RleHQ6ICdMb2FkaW5nLi4uJywNCiAgbm9SZXN1bHRzVGV4dDogJ05vIHJlc3VsdHMgZm91bmQnLA0KICBub0Nob2ljZXNUZXh0OiAnTm8gY2hvaWNlcyB0byBjaG9vc2UgZnJvbScsDQogIGl0ZW1TZWxlY3RUZXh0OiAnUHJlc3MgdG8gc2VsZWN0JywNCiAgdW5pcXVlSXRlbVRleHQ6ICdPbmx5IHVuaXF1ZSB2YWx1ZXMgY2FuIGJlIGFkZGVkJywNCiAgYWRkSXRlbVRleHQ6IGZ1bmN0aW9uIGFkZEl0ZW1UZXh0KHZhbHVlKSB7DQogICAgcmV0dXJuICdQcmVzcyBFbnRlciB0byBhZGQgPGI+IicgKyAoMCwgX3V0aWxzLnN0cmlwSFRNTCkodmFsdWUpICsgJyI8L2I+JzsNCiAgfSwNCiAgbWF4SXRlbVRleHQ6IGZ1bmN0aW9uIG1heEl0ZW1UZXh0KG1heEl0ZW1Db3VudCkgew0KICAgIHJldHVybiAnT25seSAnICsgbWF4SXRlbUNvdW50ICsgJyB2YWx1ZXMgY2FuIGJlIGFkZGVkJzsNCiAgfSwNCiAgaXRlbUNvbXBhcmVyOiBmdW5jdGlvbiBpdGVtQ29tcGFyZXIoY2hvaWNlLCBpdGVtKSB7DQogICAgcmV0dXJuIGNob2ljZSA9PT0gaXRlbTsNCiAgfSwNCiAgZnVzZU9wdGlvbnM6IHsNCiAgICBpbmNsdWRlU2NvcmU6IHRydWUNCiAgfSwNCiAgY2FsbGJhY2tPbkluaXQ6IG51bGwsDQogIGNhbGxiYWNrT25DcmVhdGVUZW1wbGF0ZXM6IG51bGwsDQogIGNsYXNzTmFtZXM6IERFRkFVTFRfQ0xBU1NOQU1FUw0KfTsNCg0KdmFyIEVWRU5UUyA9IGV4cG9ydHMuRVZFTlRTID0gew0KICBzaG93RHJvcGRvd246ICdzaG93RHJvcGRvd24nLA0KICBoaWRlRHJvcGRvd246ICdoaWRlRHJvcGRvd24nLA0KICBjaGFuZ2U6ICdjaGFuZ2UnLA0KICBjaG9pY2U6ICdjaG9pY2UnLA0KICBzZWFyY2g6ICdzZWFyY2gnLA0KICBhZGRJdGVtOiAnYWRkSXRlbScsDQogIHJlbW92ZUl0ZW06ICdyZW1vdmVJdGVtJywNCiAgaGlnaGxpZ2h0SXRlbTogJ2hpZ2hsaWdodEl0ZW0nLA0KICBoaWdobGlnaHRDaG9pY2U6ICdoaWdobGlnaHRDaG9pY2UnDQp9Ow0KDQp2YXIgQUNUSU9OX1RZUEVTID0gZXhwb3J0cy5BQ1RJT05fVFlQRVMgPSB7DQogIEFERF9DSE9JQ0U6ICdBRERfQ0hPSUNFJywNCiAgRklMVEVSX0NIT0lDRVM6ICdGSUxURVJfQ0hPSUNFUycsDQogIEFDVElWQVRFX0NIT0lDRVM6ICdBQ1RJVkFURV9DSE9JQ0VTJywNCiAgQ0xFQVJfQ0hPSUNFUzogJ0NMRUFSX0NIT0lDRVMnLA0KICBBRERfR1JPVVA6ICdBRERfR1JPVVAnLA0KICBBRERfSVRFTTogJ0FERF9JVEVNJywNCiAgUkVNT1ZFX0lURU06ICdSRU1PVkVfSVRFTScsDQogIEhJR0hMSUdIVF9JVEVNOiAnSElHSExJR0hUX0lURU0nLA0KICBDTEVBUl9BTEw6ICdDTEVBUl9BTEwnDQp9Ow0KDQp2YXIgS0VZX0NPREVTID0gZXhwb3J0cy5LRVlfQ09ERVMgPSB7DQogIEJBQ0tfS0VZOiA0NiwNCiAgREVMRVRFX0tFWTogOCwNCiAgRU5URVJfS0VZOiAxMywNCiAgQV9LRVk6IDY1LA0KICBFU0NfS0VZOiAyNywNCiAgVVBfS0VZOiAzOCwNCiAgRE9XTl9LRVk6IDQwLA0KICBQQUdFX1VQX0tFWTogMzMsDQogIFBBR0VfRE9XTl9LRVk6IDM0DQp9Ow0KDQp2YXIgU0NST0xMSU5HX1NQRUVEID0gZXhwb3J0cy5TQ1JPTExJTkdfU1BFRUQgPSA0Ow0KDQovKioqLyB9KSwNCi8qIDYgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oMyk7DQp2YXIgY29yZSA9IF9fd2VicGFja19yZXF1aXJlX18oMik7DQp2YXIgaGlkZSA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7DQp2YXIgcmVkZWZpbmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI0KTsNCnZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE0KTsNCnZhciBQUk9UT1RZUEUgPSAncHJvdG90eXBlJzsNCg0KdmFyICRleHBvcnQgPSBmdW5jdGlvbiAodHlwZSwgbmFtZSwgc291cmNlKSB7DQogIHZhciBJU19GT1JDRUQgPSB0eXBlICYgJGV4cG9ydC5GOw0KICB2YXIgSVNfR0xPQkFMID0gdHlwZSAmICRleHBvcnQuRzsNCiAgdmFyIElTX1NUQVRJQyA9IHR5cGUgJiAkZXhwb3J0LlM7DQogIHZhciBJU19QUk9UTyA9IHR5cGUgJiAkZXhwb3J0LlA7DQogIHZhciBJU19CSU5EID0gdHlwZSAmICRleHBvcnQuQjsNCiAgdmFyIHRhcmdldCA9IElTX0dMT0JBTCA/IGdsb2JhbCA6IElTX1NUQVRJQyA/IGdsb2JhbFtuYW1lXSB8fCAoZ2xvYmFsW25hbWVdID0ge30pIDogKGdsb2JhbFtuYW1lXSB8fCB7fSlbUFJPVE9UWVBFXTsNCiAgdmFyIGV4cG9ydHMgPSBJU19HTE9CQUwgPyBjb3JlIDogY29yZVtuYW1lXSB8fCAoY29yZVtuYW1lXSA9IHt9KTsNCiAgdmFyIGV4cFByb3RvID0gZXhwb3J0c1tQUk9UT1RZUEVdIHx8IChleHBvcnRzW1BST1RPVFlQRV0gPSB7fSk7DQogIHZhciBrZXksIG93biwgb3V0LCBleHA7DQogIGlmIChJU19HTE9CQUwpIHNvdXJjZSA9IG5hbWU7DQogIGZvciAoa2V5IGluIHNvdXJjZSkgew0KICAgIC8vIGNvbnRhaW5zIGluIG5hdGl2ZQ0KICAgIG93biA9ICFJU19GT1JDRUQgJiYgdGFyZ2V0ICYmIHRhcmdldFtrZXldICE9PSB1bmRlZmluZWQ7DQogICAgLy8gZXhwb3J0IG5hdGl2ZSBvciBwYXNzZWQNCiAgICBvdXQgPSAob3duID8gdGFyZ2V0IDogc291cmNlKVtrZXldOw0KICAgIC8vIGJpbmQgdGltZXJzIHRvIGdsb2JhbCBmb3IgY2FsbCBmcm9tIGV4cG9ydCBjb250ZXh0DQogICAgZXhwID0gSVNfQklORCAmJiBvd24gPyBjdHgob3V0LCBnbG9iYWwpIDogSVNfUFJPVE8gJiYgdHlwZW9mIG91dCA9PSAnZnVuY3Rpb24nID8gY3R4KEZ1bmN0aW9uLmNhbGwsIG91dCkgOiBvdXQ7DQogICAgLy8gZXh0ZW5kIGdsb2JhbA0KICAgIGlmICh0YXJnZXQpIHJlZGVmaW5lKHRhcmdldCwga2V5LCBvdXQsIHR5cGUgJiAkZXhwb3J0LlUpOw0KICAgIC8vIGV4cG9ydA0KICAgIGlmIChleHBvcnRzW2tleV0gIT0gb3V0KSBoaWRlKGV4cG9ydHMsIGtleSwgZXhwKTsNCiAgICBpZiAoSVNfUFJPVE8gJiYgZXhwUHJvdG9ba2V5XSAhPSBvdXQpIGV4cFByb3RvW2tleV0gPSBvdXQ7DQogIH0NCn07DQpnbG9iYWwuY29yZSA9IGNvcmU7DQovLyB0eXBlIGJpdG1hcA0KJGV4cG9ydC5GID0gMTsgICAvLyBmb3JjZWQNCiRleHBvcnQuRyA9IDI7ICAgLy8gZ2xvYmFsDQokZXhwb3J0LlMgPSA0OyAgIC8vIHN0YXRpYw0KJGV4cG9ydC5QID0gODsgICAvLyBwcm90bw0KJGV4cG9ydC5CID0gMTY7ICAvLyBiaW5kDQokZXhwb3J0LlcgPSAzMjsgIC8vIHdyYXANCiRleHBvcnQuVSA9IDY0OyAgLy8gc2FmZQ0KJGV4cG9ydC5SID0gMTI4OyAvLyByZWFsIHByb3RvIG1ldGhvZCBmb3IgYGxpYnJhcnlgDQptb2R1bGUuZXhwb3J0cyA9ICRleHBvcnQ7DQoNCg0KLyoqKi8gfSksDQovKiA3ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7DQp2YXIgSUU4X0RPTV9ERUZJTkUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ0KTsNCnZhciB0b1ByaW1pdGl2ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNDUpOw0KdmFyIGRQID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Ow0KDQpleHBvcnRzLmYgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKSA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSA6IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpIHsNCiAgYW5PYmplY3QoTyk7DQogIFAgPSB0b1ByaW1pdGl2ZShQLCB0cnVlKTsNCiAgYW5PYmplY3QoQXR0cmlidXRlcyk7DQogIGlmIChJRThfRE9NX0RFRklORSkgdHJ5IHsNCiAgICByZXR1cm4gZFAoTywgUCwgQXR0cmlidXRlcyk7DQogIH0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfQ0KICBpZiAoJ2dldCcgaW4gQXR0cmlidXRlcyB8fCAnc2V0JyBpbiBBdHRyaWJ1dGVzKSB0aHJvdyBUeXBlRXJyb3IoJ0FjY2Vzc29ycyBub3Qgc3VwcG9ydGVkIScpOw0KICBpZiAoJ3ZhbHVlJyBpbiBBdHRyaWJ1dGVzKSBPW1BdID0gQXR0cmlidXRlcy52YWx1ZTsNCiAgcmV0dXJuIE87DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogOCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsNCiAgaWYgKCFpc09iamVjdChpdCkpIHRocm93IFR5cGVFcnJvcihpdCArICcgaXMgbm90IGFuIG9iamVjdCEnKTsNCiAgcmV0dXJuIGl0Ow0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDkgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsNCiAgcmV0dXJuIHR5cGVvZiBpdCA9PT0gJ29iamVjdCcgPyBpdCAhPT0gbnVsbCA6IHR5cGVvZiBpdCA9PT0gJ2Z1bmN0aW9uJzsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAxMCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyBUaGFuaydzIElFOCBmb3IgaGlzIGZ1bm55IGRlZmluZVByb3BlcnR5DQptb2R1bGUuZXhwb3J0cyA9ICFfX3dlYnBhY2tfcmVxdWlyZV9fKDIyKShmdW5jdGlvbiAoKSB7DQogIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdhJywgeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDc7IH0gfSkuYSAhPSA3Ow0KfSk7DQoNCg0KLyoqKi8gfSksDQovKiAxMSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQp2YXIgaGFzT3duUHJvcGVydHkgPSB7fS5oYXNPd25Qcm9wZXJ0eTsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0LCBrZXkpIHsNCiAgcmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwoaXQsIGtleSk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMTIgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoYml0bWFwLCB2YWx1ZSkgew0KICByZXR1cm4gew0KICAgIGVudW1lcmFibGU6ICEoYml0bWFwICYgMSksDQogICAgY29uZmlndXJhYmxlOiAhKGJpdG1hcCAmIDIpLA0KICAgIHdyaXRhYmxlOiAhKGJpdG1hcCAmIDQpLA0KICAgIHZhbHVlOiB2YWx1ZQ0KICB9Ow0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDEzICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7DQoNCnZhciBpZCA9IDA7DQp2YXIgcHggPSBNYXRoLnJhbmRvbSgpOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoa2V5KSB7DQogIHJldHVybiAnU3ltYm9sKCcuY29uY2F0KGtleSA9PT0gdW5kZWZpbmVkID8gJycgOiBrZXksICcpXycsICgrK2lkICsgcHgpLnRvU3RyaW5nKDM2KSk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMTQgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gb3B0aW9uYWwgLyBzaW1wbGUgY29udGV4dCBiaW5kaW5nDQp2YXIgYUZ1bmN0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Nik7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChmbiwgdGhhdCwgbGVuZ3RoKSB7DQogIGFGdW5jdGlvbihmbik7DQogIGlmICh0aGF0ID09PSB1bmRlZmluZWQpIHJldHVybiBmbjsNCiAgc3dpdGNoIChsZW5ndGgpIHsNCiAgICBjYXNlIDE6IHJldHVybiBmdW5jdGlvbiAoYSkgew0KICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSk7DQogICAgfTsNCiAgICBjYXNlIDI6IHJldHVybiBmdW5jdGlvbiAoYSwgYikgew0KICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYik7DQogICAgfTsNCiAgICBjYXNlIDM6IHJldHVybiBmdW5jdGlvbiAoYSwgYiwgYykgew0KICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYiwgYyk7DQogICAgfTsNCiAgfQ0KICByZXR1cm4gZnVuY3Rpb24gKC8qIC4uLmFyZ3MgKi8pIHsNCiAgICByZXR1cm4gZm4uYXBwbHkodGhhdCwgYXJndW1lbnRzKTsNCiAgfTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAxNSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQp2YXIgdG9TdHJpbmcgPSB7fS50b1N0cmluZzsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsNCiAgcmV0dXJuIHRvU3RyaW5nLmNhbGwoaXQpLnNsaWNlKDgsIC0xKTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAxNiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyA3LjEuMTMgVG9PYmplY3QoYXJndW1lbnQpDQp2YXIgZGVmaW5lZCA9IF9fd2VicGFja19yZXF1aXJlX18oMTcpOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsNCiAgcmV0dXJuIE9iamVjdChkZWZpbmVkKGl0KSk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMTcgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KLy8gNy4yLjEgUmVxdWlyZU9iamVjdENvZXJjaWJsZShhcmd1bWVudCkNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7DQogIGlmIChpdCA9PSB1bmRlZmluZWQpIHRocm93IFR5cGVFcnJvcigiQ2FuJ3QgY2FsbCBtZXRob2Qgb24gICIgKyBpdCk7DQogIHJldHVybiBpdDsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAxOCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyA3LjEuMTUgVG9MZW5ndGgNCnZhciB0b0ludGVnZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE5KTsNCnZhciBtaW4gPSBNYXRoLm1pbjsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7DQogIHJldHVybiBpdCA+IDAgPyBtaW4odG9JbnRlZ2VyKGl0KSwgMHgxZmZmZmZmZmZmZmZmZikgOiAwOyAvLyBwb3coMiwgNTMpIC0gMSA9PSA5MDA3MTk5MjU0NzQwOTkxDQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMTkgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KLy8gNy4xLjQgVG9JbnRlZ2VyDQp2YXIgY2VpbCA9IE1hdGguY2VpbDsNCnZhciBmbG9vciA9IE1hdGguZmxvb3I7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgew0KICByZXR1cm4gaXNOYU4oaXQgPSAraXQpID8gMCA6IChpdCA+IDAgPyBmbG9vciA6IGNlaWwpKGl0KTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAyMCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQptb2R1bGUuZXhwb3J0cyA9IHt9Ow0KDQoNCi8qKiovIH0pLA0KLyogMjEgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIHNoYXJlZCA9IF9fd2VicGFja19yZXF1aXJlX18oMjYpKCdrZXlzJyk7DQp2YXIgdWlkID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMyk7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXkpIHsNCiAgcmV0dXJuIHNoYXJlZFtrZXldIHx8IChzaGFyZWRba2V5XSA9IHVpZChrZXkpKTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAyMiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChleGVjKSB7DQogIHRyeSB7DQogICAgcmV0dXJuICEhZXhlYygpOw0KICB9IGNhdGNoIChlKSB7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCn07DQoNCg0KLyoqKi8gfSksDQovKiAyMyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpOw0KdmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKS5kb2N1bWVudDsNCi8vIHR5cGVvZiBkb2N1bWVudC5jcmVhdGVFbGVtZW50IGlzICdvYmplY3QnIGluIG9sZCBJRQ0KdmFyIGlzID0gaXNPYmplY3QoZG9jdW1lbnQpICYmIGlzT2JqZWN0KGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQpOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsNCiAgcmV0dXJuIGlzID8gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChpdCkgOiB7fTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAyNCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsNCnZhciBoaWRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTsNCnZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKTsNCnZhciBTUkMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzKSgnc3JjJyk7DQp2YXIgVE9fU1RSSU5HID0gJ3RvU3RyaW5nJzsNCnZhciAkdG9TdHJpbmcgPSBGdW5jdGlvbltUT19TVFJJTkddOw0KdmFyIFRQTCA9ICgnJyArICR0b1N0cmluZykuc3BsaXQoVE9fU1RSSU5HKTsNCg0KX193ZWJwYWNrX3JlcXVpcmVfXygyKS5pbnNwZWN0U291cmNlID0gZnVuY3Rpb24gKGl0KSB7DQogIHJldHVybiAkdG9TdHJpbmcuY2FsbChpdCk7DQp9Ow0KDQoobW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoTywga2V5LCB2YWwsIHNhZmUpIHsNCiAgdmFyIGlzRnVuY3Rpb24gPSB0eXBlb2YgdmFsID09ICdmdW5jdGlvbic7DQogIGlmIChpc0Z1bmN0aW9uKSBoYXModmFsLCAnbmFtZScpIHx8IGhpZGUodmFsLCAnbmFtZScsIGtleSk7DQogIGlmIChPW2tleV0gPT09IHZhbCkgcmV0dXJuOw0KICBpZiAoaXNGdW5jdGlvbikgaGFzKHZhbCwgU1JDKSB8fCBoaWRlKHZhbCwgU1JDLCBPW2tleV0gPyAnJyArIE9ba2V5XSA6IFRQTC5qb2luKFN0cmluZyhrZXkpKSk7DQogIGlmIChPID09PSBnbG9iYWwpIHsNCiAgICBPW2tleV0gPSB2YWw7DQogIH0gZWxzZSBpZiAoIXNhZmUpIHsNCiAgICBkZWxldGUgT1trZXldOw0KICAgIGhpZGUoTywga2V5LCB2YWwpOw0KICB9IGVsc2UgaWYgKE9ba2V5XSkgew0KICAgIE9ba2V5XSA9IHZhbDsNCiAgfSBlbHNlIHsNCiAgICBoaWRlKE8sIGtleSwgdmFsKTsNCiAgfQ0KLy8gYWRkIGZha2UgRnVuY3Rpb24jdG9TdHJpbmcgZm9yIGNvcnJlY3Qgd29yayB3cmFwcGVkIG1ldGhvZHMgLyBjb25zdHJ1Y3RvcnMgd2l0aCBtZXRob2RzIGxpa2UgTG9EYXNoIGlzTmF0aXZlDQp9KShGdW5jdGlvbi5wcm90b3R5cGUsIFRPX1NUUklORywgZnVuY3Rpb24gdG9TdHJpbmcoKSB7DQogIHJldHVybiB0eXBlb2YgdGhpcyA9PSAnZnVuY3Rpb24nICYmIHRoaXNbU1JDXSB8fCAkdG9TdHJpbmcuY2FsbCh0aGlzKTsNCn0pOw0KDQoNCi8qKiovIH0pLA0KLyogMjUgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gZmFsbGJhY2sgZm9yIG5vbi1hcnJheS1saWtlIEVTMyBhbmQgbm9uLWVudW1lcmFibGUgb2xkIFY4IHN0cmluZ3MNCnZhciBjb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1KTsNCi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnMNCm1vZHVsZS5leHBvcnRzID0gT2JqZWN0KCd6JykucHJvcGVydHlJc0VudW1lcmFibGUoMCkgPyBPYmplY3QgOiBmdW5jdGlvbiAoaXQpIHsNCiAgcmV0dXJuIGNvZihpdCkgPT0gJ1N0cmluZycgPyBpdC5zcGxpdCgnJykgOiBPYmplY3QoaXQpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDI2ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBjb3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKTsNCnZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOw0KdmFyIFNIQVJFRCA9ICdfX2NvcmUtanNfc2hhcmVkX18nOw0KdmFyIHN0b3JlID0gZ2xvYmFsW1NIQVJFRF0gfHwgKGdsb2JhbFtTSEFSRURdID0ge30pOw0KDQoobW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgew0KICByZXR1cm4gc3RvcmVba2V5XSB8fCAoc3RvcmVba2V5XSA9IHZhbHVlICE9PSB1bmRlZmluZWQgPyB2YWx1ZSA6IHt9KTsNCn0pKCd2ZXJzaW9ucycsIFtdKS5wdXNoKHsNCiAgdmVyc2lvbjogY29yZS52ZXJzaW9uLA0KICBtb2RlOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDI3KSA/ICdwdXJlJyA6ICdnbG9iYWwnLA0KICBjb3B5cmlnaHQ6ICfCqSAyMDE4IERlbmlzIFB1c2hrYXJldiAoemxvaXJvY2sucnUpJw0KfSk7DQoNCg0KLyoqKi8gfSksDQovKiAyNyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQptb2R1bGUuZXhwb3J0cyA9IGZhbHNlOw0KDQoNCi8qKiovIH0pLA0KLyogMjggKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gMjIuMS4zLjMxIEFycmF5LnByb3RvdHlwZVtAQHVuc2NvcGFibGVzXQ0KdmFyIFVOU0NPUEFCTEVTID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKSgndW5zY29wYWJsZXMnKTsNCnZhciBBcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlOw0KaWYgKEFycmF5UHJvdG9bVU5TQ09QQUJMRVNdID09IHVuZGVmaW5lZCkgX193ZWJwYWNrX3JlcXVpcmVfXyg0KShBcnJheVByb3RvLCBVTlNDT1BBQkxFUywge30pOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoa2V5KSB7DQogIEFycmF5UHJvdG9bVU5TQ09QQUJMRVNdW2tleV0gPSB0cnVlOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDI5ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIHRvIGluZGV4ZWQgb2JqZWN0LCB0b09iamVjdCB3aXRoIGZhbGxiYWNrIGZvciBub24tYXJyYXktbGlrZSBFUzMgc3RyaW5ncw0KdmFyIElPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI1KTsNCnZhciBkZWZpbmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNyk7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgew0KICByZXR1cm4gSU9iamVjdChkZWZpbmVkKGl0KSk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogMzAgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gZmFsc2UgLT4gQXJyYXkjaW5kZXhPZg0KLy8gdHJ1ZSAgLT4gQXJyYXkjaW5jbHVkZXMNCnZhciB0b0lPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI5KTsNCnZhciB0b0xlbmd0aCA9IF9fd2VicGFja19yZXF1aXJlX18oMTgpOw0KdmFyIHRvQWJzb2x1dGVJbmRleCA9IF9fd2VicGFja19yZXF1aXJlX18oNjApOw0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoSVNfSU5DTFVERVMpIHsNCiAgcmV0dXJuIGZ1bmN0aW9uICgkdGhpcywgZWwsIGZyb21JbmRleCkgew0KICAgIHZhciBPID0gdG9JT2JqZWN0KCR0aGlzKTsNCiAgICB2YXIgbGVuZ3RoID0gdG9MZW5ndGgoTy5sZW5ndGgpOw0KICAgIHZhciBpbmRleCA9IHRvQWJzb2x1dGVJbmRleChmcm9tSW5kZXgsIGxlbmd0aCk7DQogICAgdmFyIHZhbHVlOw0KICAgIC8vIEFycmF5I2luY2x1ZGVzIHVzZXMgU2FtZVZhbHVlWmVybyBlcXVhbGl0eSBhbGdvcml0aG0NCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlDQogICAgaWYgKElTX0lOQ0xVREVTICYmIGVsICE9IGVsKSB3aGlsZSAobGVuZ3RoID4gaW5kZXgpIHsNCiAgICAgIHZhbHVlID0gT1tpbmRleCsrXTsNCiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUNCiAgICAgIGlmICh2YWx1ZSAhPSB2YWx1ZSkgcmV0dXJuIHRydWU7DQogICAgLy8gQXJyYXkjaW5kZXhPZiBpZ25vcmVzIGhvbGVzLCBBcnJheSNpbmNsdWRlcyAtIG5vdA0KICAgIH0gZWxzZSBmb3IgKDtsZW5ndGggPiBpbmRleDsgaW5kZXgrKykgaWYgKElTX0lOQ0xVREVTIHx8IGluZGV4IGluIE8pIHsNCiAgICAgIGlmIChPW2luZGV4XSA9PT0gZWwpIHJldHVybiBJU19JTkNMVURFUyB8fCBpbmRleCB8fCAwOw0KICAgIH0gcmV0dXJuICFJU19JTkNMVURFUyAmJiAtMTsNCiAgfTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiAzMSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQovLyBJRSA4LSBkb24ndCBlbnVtIGJ1ZyBrZXlzDQptb2R1bGUuZXhwb3J0cyA9ICgNCiAgJ2NvbnN0cnVjdG9yLGhhc093blByb3BlcnR5LGlzUHJvdG90eXBlT2YscHJvcGVydHlJc0VudW1lcmFibGUsdG9Mb2NhbGVTdHJpbmcsdG9TdHJpbmcsdmFsdWVPZicNCikuc3BsaXQoJywnKTsNCg0KDQovKioqLyB9KSwNCi8qIDMyICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBkZWYgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpLmY7DQp2YXIgaGFzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMSk7DQp2YXIgVEFHID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKSgndG9TdHJpbmdUYWcnKTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQsIHRhZywgc3RhdCkgew0KICBpZiAoaXQgJiYgIWhhcyhpdCA9IHN0YXQgPyBpdCA6IGl0LnByb3RvdHlwZSwgVEFHKSkgZGVmKGl0LCBUQUcsIHsgY29uZmlndXJhYmxlOiB0cnVlLCB2YWx1ZTogdGFnIH0pOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDMzICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShfX3dlYnBhY2tfZXhwb3J0c19fLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7DQoNCi8vIEVYVEVSTkFMIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19mcmVlR2xvYmFsLmpzDQp2YXIgX2ZyZWVHbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc0KTsNCg0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19yb290LmpzDQoNCg0KLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBzZWxmYC4gKi8NCnZhciBmcmVlU2VsZiA9IHR5cGVvZiBzZWxmID09ICdvYmplY3QnICYmIHNlbGYgJiYgc2VsZi5PYmplY3QgPT09IE9iamVjdCAmJiBzZWxmOw0KDQovKiogVXNlZCBhcyBhIHJlZmVyZW5jZSB0byB0aGUgZ2xvYmFsIG9iamVjdC4gKi8NCnZhciByb290ID0gX2ZyZWVHbG9iYWxbImEiIC8qIGRlZmF1bHQgKi9dIHx8IGZyZWVTZWxmIHx8IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7DQoNCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIF9yb290ID0gKHJvb3QpOw0KDQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX1N5bWJvbC5qcw0KDQoNCi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLw0KdmFyIFN5bWJvbCA9IF9yb290LlN5bWJvbDsNCg0KLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgX1N5bWJvbCA9IChTeW1ib2wpOw0KDQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2dldFJhd1RhZy5qcw0KDQoNCi8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi8NCnZhciBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7DQoNCi8qKiBVc2VkIHRvIGNoZWNrIG9iamVjdHMgZm9yIG93biBwcm9wZXJ0aWVzLiAqLw0KdmFyIF9nZXRSYXdUYWdfaGFzT3duUHJvcGVydHkgPSBvYmplY3RQcm90by5oYXNPd25Qcm9wZXJ0eTsNCg0KLyoqDQogKiBVc2VkIHRvIHJlc29sdmUgdGhlDQogKiBbYHRvU3RyaW5nVGFnYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtb2JqZWN0LnByb3RvdHlwZS50b3N0cmluZykNCiAqIG9mIHZhbHVlcy4NCiAqLw0KdmFyIG5hdGl2ZU9iamVjdFRvU3RyaW5nID0gb2JqZWN0UHJvdG8udG9TdHJpbmc7DQoNCi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLw0KdmFyIHN5bVRvU3RyaW5nVGFnID0gX1N5bWJvbCA/IF9TeW1ib2wudG9TdHJpbmdUYWcgOiB1bmRlZmluZWQ7DQoNCi8qKg0KICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBiYXNlR2V0VGFnYCB3aGljaCBpZ25vcmVzIGBTeW1ib2wudG9TdHJpbmdUYWdgIHZhbHVlcy4NCiAqDQogKiBAcHJpdmF0ZQ0KICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuDQogKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSByYXcgYHRvU3RyaW5nVGFnYC4NCiAqLw0KZnVuY3Rpb24gZ2V0UmF3VGFnKHZhbHVlKSB7DQogIHZhciBpc093biA9IF9nZXRSYXdUYWdfaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgc3ltVG9TdHJpbmdUYWcpLA0KICAgICAgdGFnID0gdmFsdWVbc3ltVG9TdHJpbmdUYWddOw0KDQogIHRyeSB7DQogICAgdmFsdWVbc3ltVG9TdHJpbmdUYWddID0gdW5kZWZpbmVkOw0KICAgIHZhciB1bm1hc2tlZCA9IHRydWU7DQogIH0gY2F0Y2ggKGUpIHt9DQoNCiAgdmFyIHJlc3VsdCA9IG5hdGl2ZU9iamVjdFRvU3RyaW5nLmNhbGwodmFsdWUpOw0KICBpZiAodW5tYXNrZWQpIHsNCiAgICBpZiAoaXNPd24pIHsNCiAgICAgIHZhbHVlW3N5bVRvU3RyaW5nVGFnXSA9IHRhZzsNCiAgICB9IGVsc2Ugew0KICAgICAgZGVsZXRlIHZhbHVlW3N5bVRvU3RyaW5nVGFnXTsNCiAgICB9DQogIH0NCiAgcmV0dXJuIHJlc3VsdDsNCn0NCg0KLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgX2dldFJhd1RhZyA9IChnZXRSYXdUYWcpOw0KDQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX29iamVjdFRvU3RyaW5nLmpzDQovKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovDQp2YXIgX29iamVjdFRvU3RyaW5nX29iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTsNCg0KLyoqDQogKiBVc2VkIHRvIHJlc29sdmUgdGhlDQogKiBbYHRvU3RyaW5nVGFnYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtb2JqZWN0LnByb3RvdHlwZS50b3N0cmluZykNCiAqIG9mIHZhbHVlcy4NCiAqLw0KdmFyIF9vYmplY3RUb1N0cmluZ19uYXRpdmVPYmplY3RUb1N0cmluZyA9IF9vYmplY3RUb1N0cmluZ19vYmplY3RQcm90by50b1N0cmluZzsNCg0KLyoqDQogKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGEgc3RyaW5nIHVzaW5nIGBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nYC4NCiAqDQogKiBAcHJpdmF0ZQ0KICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29udmVydC4NCiAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBzdHJpbmcuDQogKi8NCmZ1bmN0aW9uIG9iamVjdFRvU3RyaW5nKHZhbHVlKSB7DQogIHJldHVybiBfb2JqZWN0VG9TdHJpbmdfbmF0aXZlT2JqZWN0VG9TdHJpbmcuY2FsbCh2YWx1ZSk7DQp9DQoNCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIF9vYmplY3RUb1N0cmluZyA9IChvYmplY3RUb1N0cmluZyk7DQoNCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYmFzZUdldFRhZy5qcw0KDQoNCg0KDQovKiogYE9iamVjdCN0b1N0cmluZ2AgcmVzdWx0IHJlZmVyZW5jZXMuICovDQp2YXIgbnVsbFRhZyA9ICdbb2JqZWN0IE51bGxdJywNCiAgICB1bmRlZmluZWRUYWcgPSAnW29iamVjdCBVbmRlZmluZWRdJzsNCg0KLyoqIEJ1aWx0LWluIHZhbHVlIHJlZmVyZW5jZXMuICovDQp2YXIgX2Jhc2VHZXRUYWdfc3ltVG9TdHJpbmdUYWcgPSBfU3ltYm9sID8gX1N5bWJvbC50b1N0cmluZ1RhZyA6IHVuZGVmaW5lZDsNCg0KLyoqDQogKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgZ2V0VGFnYCB3aXRob3V0IGZhbGxiYWNrcyBmb3IgYnVnZ3kgZW52aXJvbm1lbnRzLg0KICoNCiAqIEBwcml2YXRlDQogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBxdWVyeS4NCiAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGB0b1N0cmluZ1RhZ2AuDQogKi8NCmZ1bmN0aW9uIGJhc2VHZXRUYWcodmFsdWUpIHsNCiAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZFRhZyA6IG51bGxUYWc7DQogIH0NCiAgcmV0dXJuIChfYmFzZUdldFRhZ19zeW1Ub1N0cmluZ1RhZyAmJiBfYmFzZUdldFRhZ19zeW1Ub1N0cmluZ1RhZyBpbiBPYmplY3QodmFsdWUpKQ0KICAgID8gX2dldFJhd1RhZyh2YWx1ZSkNCiAgICA6IF9vYmplY3RUb1N0cmluZyh2YWx1ZSk7DQp9DQoNCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIF9iYXNlR2V0VGFnID0gKGJhc2VHZXRUYWcpOw0KDQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX292ZXJBcmcuanMNCi8qKg0KICogQ3JlYXRlcyBhIHVuYXJ5IGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2Agd2l0aCBpdHMgYXJndW1lbnQgdHJhbnNmb3JtZWQuDQogKg0KICogQHByaXZhdGUNCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHdyYXAuDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSB0cmFuc2Zvcm0gVGhlIGFyZ3VtZW50IHRyYW5zZm9ybS4NCiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLg0KICovDQpmdW5jdGlvbiBvdmVyQXJnKGZ1bmMsIHRyYW5zZm9ybSkgew0KICByZXR1cm4gZnVuY3Rpb24oYXJnKSB7DQogICAgcmV0dXJuIGZ1bmModHJhbnNmb3JtKGFyZykpOw0KICB9Ow0KfQ0KDQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBfb3ZlckFyZyA9IChvdmVyQXJnKTsNCg0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19nZXRQcm90b3R5cGUuanMNCg0KDQovKiogQnVpbHQtaW4gdmFsdWUgcmVmZXJlbmNlcy4gKi8NCnZhciBnZXRQcm90b3R5cGUgPSBfb3ZlckFyZyhPYmplY3QuZ2V0UHJvdG90eXBlT2YsIE9iamVjdCk7DQoNCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIF9nZXRQcm90b3R5cGUgPSAoZ2V0UHJvdG90eXBlKTsNCg0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL2lzT2JqZWN0TGlrZS5qcw0KLyoqDQogKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBvYmplY3QtbGlrZS4gQSB2YWx1ZSBpcyBvYmplY3QtbGlrZSBpZiBpdCdzIG5vdCBgbnVsbGANCiAqIGFuZCBoYXMgYSBgdHlwZW9mYCByZXN1bHQgb2YgIm9iamVjdCIuDQogKg0KICogQHN0YXRpYw0KICogQG1lbWJlck9mIF8NCiAqIEBzaW5jZSA0LjAuMA0KICogQGNhdGVnb3J5IExhbmcNCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLg0KICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UsIGVsc2UgYGZhbHNlYC4NCiAqIEBleGFtcGxlDQogKg0KICogXy5pc09iamVjdExpa2Uoe30pOw0KICogLy8gPT4gdHJ1ZQ0KICoNCiAqIF8uaXNPYmplY3RMaWtlKFsxLCAyLCAzXSk7DQogKiAvLyA9PiB0cnVlDQogKg0KICogXy5pc09iamVjdExpa2UoXy5ub29wKTsNCiAqIC8vID0+IGZhbHNlDQogKg0KICogXy5pc09iamVjdExpa2UobnVsbCk7DQogKiAvLyA9PiBmYWxzZQ0KICovDQpmdW5jdGlvbiBpc09iamVjdExpa2UodmFsdWUpIHsNCiAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnOw0KfQ0KDQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBsb2Rhc2hfZXNfaXNPYmplY3RMaWtlID0gKGlzT2JqZWN0TGlrZSk7DQoNCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9pc1BsYWluT2JqZWN0LmpzDQoNCg0KDQoNCi8qKiBgT2JqZWN0I3RvU3RyaW5nYCByZXN1bHQgcmVmZXJlbmNlcy4gKi8NCnZhciBvYmplY3RUYWcgPSAnW29iamVjdCBPYmplY3RdJzsNCg0KLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqLw0KdmFyIGZ1bmNQcm90byA9IEZ1bmN0aW9uLnByb3RvdHlwZSwNCiAgICBpc1BsYWluT2JqZWN0X29iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTsNCg0KLyoqIFVzZWQgdG8gcmVzb2x2ZSB0aGUgZGVjb21waWxlZCBzb3VyY2Ugb2YgZnVuY3Rpb25zLiAqLw0KdmFyIGZ1bmNUb1N0cmluZyA9IGZ1bmNQcm90by50b1N0cmluZzsNCg0KLyoqIFVzZWQgdG8gY2hlY2sgb2JqZWN0cyBmb3Igb3duIHByb3BlcnRpZXMuICovDQp2YXIgaXNQbGFpbk9iamVjdF9oYXNPd25Qcm9wZXJ0eSA9IGlzUGxhaW5PYmplY3Rfb2JqZWN0UHJvdG8uaGFzT3duUHJvcGVydHk7DQoNCi8qKiBVc2VkIHRvIGluZmVyIHRoZSBgT2JqZWN0YCBjb25zdHJ1Y3Rvci4gKi8NCnZhciBvYmplY3RDdG9yU3RyaW5nID0gZnVuY1RvU3RyaW5nLmNhbGwoT2JqZWN0KTsNCg0KLyoqDQogKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIHBsYWluIG9iamVjdCwgdGhhdCBpcywgYW4gb2JqZWN0IGNyZWF0ZWQgYnkgdGhlDQogKiBgT2JqZWN0YCBjb25zdHJ1Y3RvciBvciBvbmUgd2l0aCBhIGBbW1Byb3RvdHlwZV1dYCBvZiBgbnVsbGAuDQogKg0KICogQHN0YXRpYw0KICogQG1lbWJlck9mIF8NCiAqIEBzaW5jZSAwLjguMA0KICogQGNhdGVnb3J5IExhbmcNCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLg0KICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBwbGFpbiBvYmplY3QsIGVsc2UgYGZhbHNlYC4NCiAqIEBleGFtcGxlDQogKg0KICogZnVuY3Rpb24gRm9vKCkgew0KICogICB0aGlzLmEgPSAxOw0KICogfQ0KICoNCiAqIF8uaXNQbGFpbk9iamVjdChuZXcgRm9vKTsNCiAqIC8vID0+IGZhbHNlDQogKg0KICogXy5pc1BsYWluT2JqZWN0KFsxLCAyLCAzXSk7DQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqIF8uaXNQbGFpbk9iamVjdCh7ICd4JzogMCwgJ3knOiAwIH0pOw0KICogLy8gPT4gdHJ1ZQ0KICoNCiAqIF8uaXNQbGFpbk9iamVjdChPYmplY3QuY3JlYXRlKG51bGwpKTsNCiAqIC8vID0+IHRydWUNCiAqLw0KZnVuY3Rpb24gaXNQbGFpbk9iamVjdCh2YWx1ZSkgew0KICBpZiAoIWxvZGFzaF9lc19pc09iamVjdExpa2UodmFsdWUpIHx8IF9iYXNlR2V0VGFnKHZhbHVlKSAhPSBvYmplY3RUYWcpIHsNCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCiAgdmFyIHByb3RvID0gX2dldFByb3RvdHlwZSh2YWx1ZSk7DQogIGlmIChwcm90byA9PT0gbnVsbCkgew0KICAgIHJldHVybiB0cnVlOw0KICB9DQogIHZhciBDdG9yID0gaXNQbGFpbk9iamVjdF9oYXNPd25Qcm9wZXJ0eS5jYWxsKHByb3RvLCAnY29uc3RydWN0b3InKSAmJiBwcm90by5jb25zdHJ1Y3RvcjsNCiAgcmV0dXJuIHR5cGVvZiBDdG9yID09ICdmdW5jdGlvbicgJiYgQ3RvciBpbnN0YW5jZW9mIEN0b3IgJiYNCiAgICBmdW5jVG9TdHJpbmcuY2FsbChDdG9yKSA9PSBvYmplY3RDdG9yU3RyaW5nOw0KfQ0KDQovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBsb2Rhc2hfZXNfaXNQbGFpbk9iamVjdCA9IChpc1BsYWluT2JqZWN0KTsNCg0KLy8gRVhURVJOQUwgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9zeW1ib2wtb2JzZXJ2YWJsZS9lcy9pbmRleC5qcw0KdmFyIGVzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NSk7DQoNCi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlZHV4L2VzL2NyZWF0ZVN0b3JlLmpzDQoNCg0KDQovKioNCiAqIFRoZXNlIGFyZSBwcml2YXRlIGFjdGlvbiB0eXBlcyByZXNlcnZlZCBieSBSZWR1eC4NCiAqIEZvciBhbnkgdW5rbm93biBhY3Rpb25zLCB5b3UgbXVzdCByZXR1cm4gdGhlIGN1cnJlbnQgc3RhdGUuDQogKiBJZiB0aGUgY3VycmVudCBzdGF0ZSBpcyB1bmRlZmluZWQsIHlvdSBtdXN0IHJldHVybiB0aGUgaW5pdGlhbCBzdGF0ZS4NCiAqIERvIG5vdCByZWZlcmVuY2UgdGhlc2UgYWN0aW9uIHR5cGVzIGRpcmVjdGx5IGluIHlvdXIgY29kZS4NCiAqLw0KdmFyIEFjdGlvblR5cGVzID0gew0KICBJTklUOiAnQEByZWR1eC9JTklUJw0KDQogIC8qKg0KICAgKiBDcmVhdGVzIGEgUmVkdXggc3RvcmUgdGhhdCBob2xkcyB0aGUgc3RhdGUgdHJlZS4NCiAgICogVGhlIG9ubHkgd2F5IHRvIGNoYW5nZSB0aGUgZGF0YSBpbiB0aGUgc3RvcmUgaXMgdG8gY2FsbCBgZGlzcGF0Y2goKWAgb24gaXQuDQogICAqDQogICAqIFRoZXJlIHNob3VsZCBvbmx5IGJlIGEgc2luZ2xlIHN0b3JlIGluIHlvdXIgYXBwLiBUbyBzcGVjaWZ5IGhvdyBkaWZmZXJlbnQNCiAgICogcGFydHMgb2YgdGhlIHN0YXRlIHRyZWUgcmVzcG9uZCB0byBhY3Rpb25zLCB5b3UgbWF5IGNvbWJpbmUgc2V2ZXJhbCByZWR1Y2Vycw0KICAgKiBpbnRvIGEgc2luZ2xlIHJlZHVjZXIgZnVuY3Rpb24gYnkgdXNpbmcgYGNvbWJpbmVSZWR1Y2Vyc2AuDQogICAqDQogICAqIEBwYXJhbSB7RnVuY3Rpb259IHJlZHVjZXIgQSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlIG5leHQgc3RhdGUgdHJlZSwgZ2l2ZW4NCiAgICogdGhlIGN1cnJlbnQgc3RhdGUgdHJlZSBhbmQgdGhlIGFjdGlvbiB0byBoYW5kbGUuDQogICAqDQogICAqIEBwYXJhbSB7YW55fSBbcHJlbG9hZGVkU3RhdGVdIFRoZSBpbml0aWFsIHN0YXRlLiBZb3UgbWF5IG9wdGlvbmFsbHkgc3BlY2lmeSBpdA0KICAgKiB0byBoeWRyYXRlIHRoZSBzdGF0ZSBmcm9tIHRoZSBzZXJ2ZXIgaW4gdW5pdmVyc2FsIGFwcHMsIG9yIHRvIHJlc3RvcmUgYQ0KICAgKiBwcmV2aW91c2x5IHNlcmlhbGl6ZWQgdXNlciBzZXNzaW9uLg0KICAgKiBJZiB5b3UgdXNlIGBjb21iaW5lUmVkdWNlcnNgIHRvIHByb2R1Y2UgdGhlIHJvb3QgcmVkdWNlciBmdW5jdGlvbiwgdGhpcyBtdXN0IGJlDQogICAqIGFuIG9iamVjdCB3aXRoIHRoZSBzYW1lIHNoYXBlIGFzIGBjb21iaW5lUmVkdWNlcnNgIGtleXMuDQogICAqDQogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtlbmhhbmNlcl0gVGhlIHN0b3JlIGVuaGFuY2VyLiBZb3UgbWF5IG9wdGlvbmFsbHkgc3BlY2lmeSBpdA0KICAgKiB0byBlbmhhbmNlIHRoZSBzdG9yZSB3aXRoIHRoaXJkLXBhcnR5IGNhcGFiaWxpdGllcyBzdWNoIGFzIG1pZGRsZXdhcmUsDQogICAqIHRpbWUgdHJhdmVsLCBwZXJzaXN0ZW5jZSwgZXRjLiBUaGUgb25seSBzdG9yZSBlbmhhbmNlciB0aGF0IHNoaXBzIHdpdGggUmVkdXgNCiAgICogaXMgYGFwcGx5TWlkZGxld2FyZSgpYC4NCiAgICoNCiAgICogQHJldHVybnMge1N0b3JlfSBBIFJlZHV4IHN0b3JlIHRoYXQgbGV0cyB5b3UgcmVhZCB0aGUgc3RhdGUsIGRpc3BhdGNoIGFjdGlvbnMNCiAgICogYW5kIHN1YnNjcmliZSB0byBjaGFuZ2VzLg0KICAgKi8NCn07ZnVuY3Rpb24gY3JlYXRlU3RvcmVfY3JlYXRlU3RvcmUocmVkdWNlciwgcHJlbG9hZGVkU3RhdGUsIGVuaGFuY2VyKSB7DQogIHZhciBfcmVmMjsNCg0KICBpZiAodHlwZW9mIHByZWxvYWRlZFN0YXRlID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBlbmhhbmNlciA9PT0gJ3VuZGVmaW5lZCcpIHsNCiAgICBlbmhhbmNlciA9IHByZWxvYWRlZFN0YXRlOw0KICAgIHByZWxvYWRlZFN0YXRlID0gdW5kZWZpbmVkOw0KICB9DQoNCiAgaWYgKHR5cGVvZiBlbmhhbmNlciAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICBpZiAodHlwZW9mIGVuaGFuY2VyICE9PSAnZnVuY3Rpb24nKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIHRoZSBlbmhhbmNlciB0byBiZSBhIGZ1bmN0aW9uLicpOw0KICAgIH0NCg0KICAgIHJldHVybiBlbmhhbmNlcihjcmVhdGVTdG9yZV9jcmVhdGVTdG9yZSkocmVkdWNlciwgcHJlbG9hZGVkU3RhdGUpOw0KICB9DQoNCiAgaWYgKHR5cGVvZiByZWR1Y2VyICE9PSAnZnVuY3Rpb24nKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCB0aGUgcmVkdWNlciB0byBiZSBhIGZ1bmN0aW9uLicpOw0KICB9DQoNCiAgdmFyIGN1cnJlbnRSZWR1Y2VyID0gcmVkdWNlcjsNCiAgdmFyIGN1cnJlbnRTdGF0ZSA9IHByZWxvYWRlZFN0YXRlOw0KICB2YXIgY3VycmVudExpc3RlbmVycyA9IFtdOw0KICB2YXIgbmV4dExpc3RlbmVycyA9IGN1cnJlbnRMaXN0ZW5lcnM7DQogIHZhciBpc0Rpc3BhdGNoaW5nID0gZmFsc2U7DQoNCiAgZnVuY3Rpb24gZW5zdXJlQ2FuTXV0YXRlTmV4dExpc3RlbmVycygpIHsNCiAgICBpZiAobmV4dExpc3RlbmVycyA9PT0gY3VycmVudExpc3RlbmVycykgew0KICAgICAgbmV4dExpc3RlbmVycyA9IGN1cnJlbnRMaXN0ZW5lcnMuc2xpY2UoKTsNCiAgICB9DQogIH0NCg0KICAvKioNCiAgICogUmVhZHMgdGhlIHN0YXRlIHRyZWUgbWFuYWdlZCBieSB0aGUgc3RvcmUuDQogICAqDQogICAqIEByZXR1cm5zIHthbnl9IFRoZSBjdXJyZW50IHN0YXRlIHRyZWUgb2YgeW91ciBhcHBsaWNhdGlvbi4NCiAgICovDQogIGZ1bmN0aW9uIGdldFN0YXRlKCkgew0KICAgIHJldHVybiBjdXJyZW50U3RhdGU7DQogIH0NCg0KICAvKioNCiAgICogQWRkcyBhIGNoYW5nZSBsaXN0ZW5lci4gSXQgd2lsbCBiZSBjYWxsZWQgYW55IHRpbWUgYW4gYWN0aW9uIGlzIGRpc3BhdGNoZWQsDQogICAqIGFuZCBzb21lIHBhcnQgb2YgdGhlIHN0YXRlIHRyZWUgbWF5IHBvdGVudGlhbGx5IGhhdmUgY2hhbmdlZC4gWW91IG1heSB0aGVuDQogICAqIGNhbGwgYGdldFN0YXRlKClgIHRvIHJlYWQgdGhlIGN1cnJlbnQgc3RhdGUgdHJlZSBpbnNpZGUgdGhlIGNhbGxiYWNrLg0KICAgKg0KICAgKiBZb3UgbWF5IGNhbGwgYGRpc3BhdGNoKClgIGZyb20gYSBjaGFuZ2UgbGlzdGVuZXIsIHdpdGggdGhlIGZvbGxvd2luZw0KICAgKiBjYXZlYXRzOg0KICAgKg0KICAgKiAxLiBUaGUgc3Vic2NyaXB0aW9ucyBhcmUgc25hcHNob3R0ZWQganVzdCBiZWZvcmUgZXZlcnkgYGRpc3BhdGNoKClgIGNhbGwuDQogICAqIElmIHlvdSBzdWJzY3JpYmUgb3IgdW5zdWJzY3JpYmUgd2hpbGUgdGhlIGxpc3RlbmVycyBhcmUgYmVpbmcgaW52b2tlZCwgdGhpcw0KICAgKiB3aWxsIG5vdCBoYXZlIGFueSBlZmZlY3Qgb24gdGhlIGBkaXNwYXRjaCgpYCB0aGF0IGlzIGN1cnJlbnRseSBpbiBwcm9ncmVzcy4NCiAgICogSG93ZXZlciwgdGhlIG5leHQgYGRpc3BhdGNoKClgIGNhbGwsIHdoZXRoZXIgbmVzdGVkIG9yIG5vdCwgd2lsbCB1c2UgYSBtb3JlDQogICAqIHJlY2VudCBzbmFwc2hvdCBvZiB0aGUgc3Vic2NyaXB0aW9uIGxpc3QuDQogICAqDQogICAqIDIuIFRoZSBsaXN0ZW5lciBzaG91bGQgbm90IGV4cGVjdCB0byBzZWUgYWxsIHN0YXRlIGNoYW5nZXMsIGFzIHRoZSBzdGF0ZQ0KICAgKiBtaWdodCBoYXZlIGJlZW4gdXBkYXRlZCBtdWx0aXBsZSB0aW1lcyBkdXJpbmcgYSBuZXN0ZWQgYGRpc3BhdGNoKClgIGJlZm9yZQ0KICAgKiB0aGUgbGlzdGVuZXIgaXMgY2FsbGVkLiBJdCBpcywgaG93ZXZlciwgZ3VhcmFudGVlZCB0aGF0IGFsbCBzdWJzY3JpYmVycw0KICAgKiByZWdpc3RlcmVkIGJlZm9yZSB0aGUgYGRpc3BhdGNoKClgIHN0YXJ0ZWQgd2lsbCBiZSBjYWxsZWQgd2l0aCB0aGUgbGF0ZXN0DQogICAqIHN0YXRlIGJ5IHRoZSB0aW1lIGl0IGV4aXRzLg0KICAgKg0KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciBBIGNhbGxiYWNrIHRvIGJlIGludm9rZWQgb24gZXZlcnkgZGlzcGF0Y2guDQogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBmdW5jdGlvbiB0byByZW1vdmUgdGhpcyBjaGFuZ2UgbGlzdGVuZXIuDQogICAqLw0KICBmdW5jdGlvbiBzdWJzY3JpYmUobGlzdGVuZXIpIHsNCiAgICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIGxpc3RlbmVyIHRvIGJlIGEgZnVuY3Rpb24uJyk7DQogICAgfQ0KDQogICAgdmFyIGlzU3Vic2NyaWJlZCA9IHRydWU7DQoNCiAgICBlbnN1cmVDYW5NdXRhdGVOZXh0TGlzdGVuZXJzKCk7DQogICAgbmV4dExpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTsNCg0KICAgIHJldHVybiBmdW5jdGlvbiB1bnN1YnNjcmliZSgpIHsNCiAgICAgIGlmICghaXNTdWJzY3JpYmVkKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgaXNTdWJzY3JpYmVkID0gZmFsc2U7DQoNCiAgICAgIGVuc3VyZUNhbk11dGF0ZU5leHRMaXN0ZW5lcnMoKTsNCiAgICAgIHZhciBpbmRleCA9IG5leHRMaXN0ZW5lcnMuaW5kZXhPZihsaXN0ZW5lcik7DQogICAgICBuZXh0TGlzdGVuZXJzLnNwbGljZShpbmRleCwgMSk7DQogICAgfTsNCiAgfQ0KDQogIC8qKg0KICAgKiBEaXNwYXRjaGVzIGFuIGFjdGlvbi4gSXQgaXMgdGhlIG9ubHkgd2F5IHRvIHRyaWdnZXIgYSBzdGF0ZSBjaGFuZ2UuDQogICAqDQogICAqIFRoZSBgcmVkdWNlcmAgZnVuY3Rpb24sIHVzZWQgdG8gY3JlYXRlIHRoZSBzdG9yZSwgd2lsbCBiZSBjYWxsZWQgd2l0aCB0aGUNCiAgICogY3VycmVudCBzdGF0ZSB0cmVlIGFuZCB0aGUgZ2l2ZW4gYGFjdGlvbmAuIEl0cyByZXR1cm4gdmFsdWUgd2lsbA0KICAgKiBiZSBjb25zaWRlcmVkIHRoZSAqKm5leHQqKiBzdGF0ZSBvZiB0aGUgdHJlZSwgYW5kIHRoZSBjaGFuZ2UgbGlzdGVuZXJzDQogICAqIHdpbGwgYmUgbm90aWZpZWQuDQogICAqDQogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9ubHkgc3VwcG9ydHMgcGxhaW4gb2JqZWN0IGFjdGlvbnMuIElmIHlvdSB3YW50IHRvDQogICAqIGRpc3BhdGNoIGEgUHJvbWlzZSwgYW4gT2JzZXJ2YWJsZSwgYSB0aHVuaywgb3Igc29tZXRoaW5nIGVsc2UsIHlvdSBuZWVkIHRvDQogICAqIHdyYXAgeW91ciBzdG9yZSBjcmVhdGluZyBmdW5jdGlvbiBpbnRvIHRoZSBjb3JyZXNwb25kaW5nIG1pZGRsZXdhcmUuIEZvcg0KICAgKiBleGFtcGxlLCBzZWUgdGhlIGRvY3VtZW50YXRpb24gZm9yIHRoZSBgcmVkdXgtdGh1bmtgIHBhY2thZ2UuIEV2ZW4gdGhlDQogICAqIG1pZGRsZXdhcmUgd2lsbCBldmVudHVhbGx5IGRpc3BhdGNoIHBsYWluIG9iamVjdCBhY3Rpb25zIHVzaW5nIHRoaXMgbWV0aG9kLg0KICAgKg0KICAgKiBAcGFyYW0ge09iamVjdH0gYWN0aW9uIEEgcGxhaW4gb2JqZWN0IHJlcHJlc2VudGluZyDigJx3aGF0IGNoYW5nZWTigJ0uIEl0IGlzDQogICAqIGEgZ29vZCBpZGVhIHRvIGtlZXAgYWN0aW9ucyBzZXJpYWxpemFibGUgc28geW91IGNhbiByZWNvcmQgYW5kIHJlcGxheSB1c2VyDQogICAqIHNlc3Npb25zLCBvciB1c2UgdGhlIHRpbWUgdHJhdmVsbGluZyBgcmVkdXgtZGV2dG9vbHNgLiBBbiBhY3Rpb24gbXVzdCBoYXZlDQogICAqIGEgYHR5cGVgIHByb3BlcnR5IHdoaWNoIG1heSBub3QgYmUgYHVuZGVmaW5lZGAuIEl0IGlzIGEgZ29vZCBpZGVhIHRvIHVzZQ0KICAgKiBzdHJpbmcgY29uc3RhbnRzIGZvciBhY3Rpb24gdHlwZXMuDQogICAqDQogICAqIEByZXR1cm5zIHtPYmplY3R9IEZvciBjb252ZW5pZW5jZSwgdGhlIHNhbWUgYWN0aW9uIG9iamVjdCB5b3UgZGlzcGF0Y2hlZC4NCiAgICoNCiAgICogTm90ZSB0aGF0LCBpZiB5b3UgdXNlIGEgY3VzdG9tIG1pZGRsZXdhcmUsIGl0IG1heSB3cmFwIGBkaXNwYXRjaCgpYCB0bw0KICAgKiByZXR1cm4gc29tZXRoaW5nIGVsc2UgKGZvciBleGFtcGxlLCBhIFByb21pc2UgeW91IGNhbiBhd2FpdCkuDQogICAqLw0KICBmdW5jdGlvbiBkaXNwYXRjaChhY3Rpb24pIHsNCiAgICBpZiAoIWxvZGFzaF9lc19pc1BsYWluT2JqZWN0KGFjdGlvbikpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcignQWN0aW9ucyBtdXN0IGJlIHBsYWluIG9iamVjdHMuICcgKyAnVXNlIGN1c3RvbSBtaWRkbGV3YXJlIGZvciBhc3luYyBhY3Rpb25zLicpOw0KICAgIH0NCg0KICAgIGlmICh0eXBlb2YgYWN0aW9uLnR5cGUgPT09ICd1bmRlZmluZWQnKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FjdGlvbnMgbWF5IG5vdCBoYXZlIGFuIHVuZGVmaW5lZCAidHlwZSIgcHJvcGVydHkuICcgKyAnSGF2ZSB5b3UgbWlzc3BlbGxlZCBhIGNvbnN0YW50PycpOw0KICAgIH0NCg0KICAgIGlmIChpc0Rpc3BhdGNoaW5nKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZHVjZXJzIG1heSBub3QgZGlzcGF0Y2ggYWN0aW9ucy4nKTsNCiAgICB9DQoNCiAgICB0cnkgew0KICAgICAgaXNEaXNwYXRjaGluZyA9IHRydWU7DQogICAgICBjdXJyZW50U3RhdGUgPSBjdXJyZW50UmVkdWNlcihjdXJyZW50U3RhdGUsIGFjdGlvbik7DQogICAgfSBmaW5hbGx5IHsNCiAgICAgIGlzRGlzcGF0Y2hpbmcgPSBmYWxzZTsNCiAgICB9DQoNCiAgICB2YXIgbGlzdGVuZXJzID0gY3VycmVudExpc3RlbmVycyA9IG5leHRMaXN0ZW5lcnM7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0ZW5lcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgIHZhciBsaXN0ZW5lciA9IGxpc3RlbmVyc1tpXTsNCiAgICAgIGxpc3RlbmVyKCk7DQogICAgfQ0KDQogICAgcmV0dXJuIGFjdGlvbjsNCiAgfQ0KDQogIC8qKg0KICAgKiBSZXBsYWNlcyB0aGUgcmVkdWNlciBjdXJyZW50bHkgdXNlZCBieSB0aGUgc3RvcmUgdG8gY2FsY3VsYXRlIHRoZSBzdGF0ZS4NCiAgICoNCiAgICogWW91IG1pZ2h0IG5lZWQgdGhpcyBpZiB5b3VyIGFwcCBpbXBsZW1lbnRzIGNvZGUgc3BsaXR0aW5nIGFuZCB5b3Ugd2FudCB0bw0KICAgKiBsb2FkIHNvbWUgb2YgdGhlIHJlZHVjZXJzIGR5bmFtaWNhbGx5LiBZb3UgbWlnaHQgYWxzbyBuZWVkIHRoaXMgaWYgeW91DQogICAqIGltcGxlbWVudCBhIGhvdCByZWxvYWRpbmcgbWVjaGFuaXNtIGZvciBSZWR1eC4NCiAgICoNCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gbmV4dFJlZHVjZXIgVGhlIHJlZHVjZXIgZm9yIHRoZSBzdG9yZSB0byB1c2UgaW5zdGVhZC4NCiAgICogQHJldHVybnMge3ZvaWR9DQogICAqLw0KICBmdW5jdGlvbiByZXBsYWNlUmVkdWNlcihuZXh0UmVkdWNlcikgew0KICAgIGlmICh0eXBlb2YgbmV4dFJlZHVjZXIgIT09ICdmdW5jdGlvbicpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcignRXhwZWN0ZWQgdGhlIG5leHRSZWR1Y2VyIHRvIGJlIGEgZnVuY3Rpb24uJyk7DQogICAgfQ0KDQogICAgY3VycmVudFJlZHVjZXIgPSBuZXh0UmVkdWNlcjsNCiAgICBkaXNwYXRjaCh7IHR5cGU6IEFjdGlvblR5cGVzLklOSVQgfSk7DQogIH0NCg0KICAvKioNCiAgICogSW50ZXJvcGVyYWJpbGl0eSBwb2ludCBmb3Igb2JzZXJ2YWJsZS9yZWFjdGl2ZSBsaWJyYXJpZXMuDQogICAqIEByZXR1cm5zIHtvYnNlcnZhYmxlfSBBIG1pbmltYWwgb2JzZXJ2YWJsZSBvZiBzdGF0ZSBjaGFuZ2VzLg0KICAgKiBGb3IgbW9yZSBpbmZvcm1hdGlvbiwgc2VlIHRoZSBvYnNlcnZhYmxlIHByb3Bvc2FsOg0KICAgKiBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1vYnNlcnZhYmxlDQogICAqLw0KICBmdW5jdGlvbiBvYnNlcnZhYmxlKCkgew0KICAgIHZhciBfcmVmOw0KDQogICAgdmFyIG91dGVyU3Vic2NyaWJlID0gc3Vic2NyaWJlOw0KICAgIHJldHVybiBfcmVmID0gew0KICAgICAgLyoqDQogICAgICAgKiBUaGUgbWluaW1hbCBvYnNlcnZhYmxlIHN1YnNjcmlwdGlvbiBtZXRob2QuDQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JzZXJ2ZXIgQW55IG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIGFzIGFuIG9ic2VydmVyLg0KICAgICAgICogVGhlIG9ic2VydmVyIG9iamVjdCBzaG91bGQgaGF2ZSBhIGBuZXh0YCBtZXRob2QuDQogICAgICAgKiBAcmV0dXJucyB7c3Vic2NyaXB0aW9ufSBBbiBvYmplY3Qgd2l0aCBhbiBgdW5zdWJzY3JpYmVgIG1ldGhvZCB0aGF0IGNhbg0KICAgICAgICogYmUgdXNlZCB0byB1bnN1YnNjcmliZSB0aGUgb2JzZXJ2YWJsZSBmcm9tIHRoZSBzdG9yZSwgYW5kIHByZXZlbnQgZnVydGhlcg0KICAgICAgICogZW1pc3Npb24gb2YgdmFsdWVzIGZyb20gdGhlIG9ic2VydmFibGUuDQogICAgICAgKi8NCiAgICAgIHN1YnNjcmliZTogZnVuY3Rpb24gc3Vic2NyaWJlKG9ic2VydmVyKSB7DQogICAgICAgIGlmICh0eXBlb2Ygb2JzZXJ2ZXIgIT09ICdvYmplY3QnKSB7DQogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRXhwZWN0ZWQgdGhlIG9ic2VydmVyIHRvIGJlIGFuIG9iamVjdC4nKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIG9ic2VydmVTdGF0ZSgpIHsNCiAgICAgICAgICBpZiAob2JzZXJ2ZXIubmV4dCkgew0KICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChnZXRTdGF0ZSgpKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBvYnNlcnZlU3RhdGUoKTsNCiAgICAgICAgdmFyIHVuc3Vic2NyaWJlID0gb3V0ZXJTdWJzY3JpYmUob2JzZXJ2ZVN0YXRlKTsNCiAgICAgICAgcmV0dXJuIHsgdW5zdWJzY3JpYmU6IHVuc3Vic2NyaWJlIH07DQogICAgICB9DQogICAgfSwgX3JlZltlc1siYSIgLyogZGVmYXVsdCAqL11dID0gZnVuY3Rpb24gKCkgew0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfSwgX3JlZjsNCiAgfQ0KDQogIC8vIFdoZW4gYSBzdG9yZSBpcyBjcmVhdGVkLCBhbiAiSU5JVCIgYWN0aW9uIGlzIGRpc3BhdGNoZWQgc28gdGhhdCBldmVyeQ0KICAvLyByZWR1Y2VyIHJldHVybnMgdGhlaXIgaW5pdGlhbCBzdGF0ZS4gVGhpcyBlZmZlY3RpdmVseSBwb3B1bGF0ZXMNCiAgLy8gdGhlIGluaXRpYWwgc3RhdGUgdHJlZS4NCiAgZGlzcGF0Y2goeyB0eXBlOiBBY3Rpb25UeXBlcy5JTklUIH0pOw0KDQogIHJldHVybiBfcmVmMiA9IHsNCiAgICBkaXNwYXRjaDogZGlzcGF0Y2gsDQogICAgc3Vic2NyaWJlOiBzdWJzY3JpYmUsDQogICAgZ2V0U3RhdGU6IGdldFN0YXRlLA0KICAgIHJlcGxhY2VSZWR1Y2VyOiByZXBsYWNlUmVkdWNlcg0KICB9LCBfcmVmMltlc1siYSIgLyogZGVmYXVsdCAqL11dID0gb2JzZXJ2YWJsZSwgX3JlZjI7DQp9DQovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWR1eC9lcy91dGlscy93YXJuaW5nLmpzDQovKioNCiAqIFByaW50cyBhIHdhcm5pbmcgaW4gdGhlIGNvbnNvbGUgaWYgaXQgZXhpc3RzLg0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXNzYWdlIFRoZSB3YXJuaW5nIG1lc3NhZ2UuDQogKiBAcmV0dXJucyB7dm9pZH0NCiAqLw0KZnVuY3Rpb24gd2FybmluZ193YXJuaW5nKG1lc3NhZ2UpIHsNCiAgLyogZXNsaW50LWRpc2FibGUgbm8tY29uc29sZSAqLw0KICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBjb25zb2xlLmVycm9yID09PSAnZnVuY3Rpb24nKSB7DQogICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTsNCiAgfQ0KICAvKiBlc2xpbnQtZW5hYmxlIG5vLWNvbnNvbGUgKi8NCiAgdHJ5IHsNCiAgICAvLyBUaGlzIGVycm9yIHdhcyB0aHJvd24gYXMgYSBjb252ZW5pZW5jZSBzbyB0aGF0IGlmIHlvdSBlbmFibGUNCiAgICAvLyAiYnJlYWsgb24gYWxsIGV4Y2VwdGlvbnMiIGluIHlvdXIgY29uc29sZSwNCiAgICAvLyBpdCB3b3VsZCBwYXVzZSB0aGUgZXhlY3V0aW9uIGF0IHRoaXMgbGluZS4NCiAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7DQogICAgLyogZXNsaW50LWRpc2FibGUgbm8tZW1wdHkgKi8NCiAgfSBjYXRjaCAoZSkge30NCiAgLyogZXNsaW50LWVuYWJsZSBuby1lbXB0eSAqLw0KfQ0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVkdXgvZXMvY29tYmluZVJlZHVjZXJzLmpzDQoNCg0KDQoNCmZ1bmN0aW9uIGdldFVuZGVmaW5lZFN0YXRlRXJyb3JNZXNzYWdlKGtleSwgYWN0aW9uKSB7DQogIHZhciBhY3Rpb25UeXBlID0gYWN0aW9uICYmIGFjdGlvbi50eXBlOw0KICB2YXIgYWN0aW9uTmFtZSA9IGFjdGlvblR5cGUgJiYgJyInICsgYWN0aW9uVHlwZS50b1N0cmluZygpICsgJyInIHx8ICdhbiBhY3Rpb24nOw0KDQogIHJldHVybiAnR2l2ZW4gYWN0aW9uICcgKyBhY3Rpb25OYW1lICsgJywgcmVkdWNlciAiJyArIGtleSArICciIHJldHVybmVkIHVuZGVmaW5lZC4gJyArICdUbyBpZ25vcmUgYW4gYWN0aW9uLCB5b3UgbXVzdCBleHBsaWNpdGx5IHJldHVybiB0aGUgcHJldmlvdXMgc3RhdGUuICcgKyAnSWYgeW91IHdhbnQgdGhpcyByZWR1Y2VyIHRvIGhvbGQgbm8gdmFsdWUsIHlvdSBjYW4gcmV0dXJuIG51bGwgaW5zdGVhZCBvZiB1bmRlZmluZWQuJzsNCn0NCg0KZnVuY3Rpb24gZ2V0VW5leHBlY3RlZFN0YXRlU2hhcGVXYXJuaW5nTWVzc2FnZShpbnB1dFN0YXRlLCByZWR1Y2VycywgYWN0aW9uLCB1bmV4cGVjdGVkS2V5Q2FjaGUpIHsNCiAgdmFyIHJlZHVjZXJLZXlzID0gT2JqZWN0LmtleXMocmVkdWNlcnMpOw0KICB2YXIgYXJndW1lbnROYW1lID0gYWN0aW9uICYmIGFjdGlvbi50eXBlID09PSBBY3Rpb25UeXBlcy5JTklUID8gJ3ByZWxvYWRlZFN0YXRlIGFyZ3VtZW50IHBhc3NlZCB0byBjcmVhdGVTdG9yZScgOiAncHJldmlvdXMgc3RhdGUgcmVjZWl2ZWQgYnkgdGhlIHJlZHVjZXInOw0KDQogIGlmIChyZWR1Y2VyS2V5cy5sZW5ndGggPT09IDApIHsNCiAgICByZXR1cm4gJ1N0b3JlIGRvZXMgbm90IGhhdmUgYSB2YWxpZCByZWR1Y2VyLiBNYWtlIHN1cmUgdGhlIGFyZ3VtZW50IHBhc3NlZCAnICsgJ3RvIGNvbWJpbmVSZWR1Y2VycyBpcyBhbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGFyZSByZWR1Y2Vycy4nOw0KICB9DQoNCiAgaWYgKCFsb2Rhc2hfZXNfaXNQbGFpbk9iamVjdChpbnB1dFN0YXRlKSkgew0KICAgIHJldHVybiAnVGhlICcgKyBhcmd1bWVudE5hbWUgKyAnIGhhcyB1bmV4cGVjdGVkIHR5cGUgb2YgIicgKyB7fS50b1N0cmluZy5jYWxsKGlucHV0U3RhdGUpLm1hdGNoKC9ccyhbYS16fEEtWl0rKS8pWzFdICsgJyIuIEV4cGVjdGVkIGFyZ3VtZW50IHRvIGJlIGFuIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgJyArICgna2V5czogIicgKyByZWR1Y2VyS2V5cy5qb2luKCciLCAiJykgKyAnIicpOw0KICB9DQoNCiAgdmFyIHVuZXhwZWN0ZWRLZXlzID0gT2JqZWN0LmtleXMoaW5wdXRTdGF0ZSkuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHsNCiAgICByZXR1cm4gIXJlZHVjZXJzLmhhc093blByb3BlcnR5KGtleSkgJiYgIXVuZXhwZWN0ZWRLZXlDYWNoZVtrZXldOw0KICB9KTsNCg0KICB1bmV4cGVjdGVkS2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsNCiAgICB1bmV4cGVjdGVkS2V5Q2FjaGVba2V5XSA9IHRydWU7DQogIH0pOw0KDQogIGlmICh1bmV4cGVjdGVkS2V5cy5sZW5ndGggPiAwKSB7DQogICAgcmV0dXJuICdVbmV4cGVjdGVkICcgKyAodW5leHBlY3RlZEtleXMubGVuZ3RoID4gMSA/ICdrZXlzJyA6ICdrZXknKSArICcgJyArICgnIicgKyB1bmV4cGVjdGVkS2V5cy5qb2luKCciLCAiJykgKyAnIiBmb3VuZCBpbiAnICsgYXJndW1lbnROYW1lICsgJy4gJykgKyAnRXhwZWN0ZWQgdG8gZmluZCBvbmUgb2YgdGhlIGtub3duIHJlZHVjZXIga2V5cyBpbnN0ZWFkOiAnICsgKCciJyArIHJlZHVjZXJLZXlzLmpvaW4oJyIsICInKSArICciLiBVbmV4cGVjdGVkIGtleXMgd2lsbCBiZSBpZ25vcmVkLicpOw0KICB9DQp9DQoNCmZ1bmN0aW9uIGFzc2VydFJlZHVjZXJTaGFwZShyZWR1Y2Vycykgew0KICBPYmplY3Qua2V5cyhyZWR1Y2VycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7DQogICAgdmFyIHJlZHVjZXIgPSByZWR1Y2Vyc1trZXldOw0KICAgIHZhciBpbml0aWFsU3RhdGUgPSByZWR1Y2VyKHVuZGVmaW5lZCwgeyB0eXBlOiBBY3Rpb25UeXBlcy5JTklUIH0pOw0KDQogICAgaWYgKHR5cGVvZiBpbml0aWFsU3RhdGUgPT09ICd1bmRlZmluZWQnKSB7DQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZHVjZXIgIicgKyBrZXkgKyAnIiByZXR1cm5lZCB1bmRlZmluZWQgZHVyaW5nIGluaXRpYWxpemF0aW9uLiAnICsgJ0lmIHRoZSBzdGF0ZSBwYXNzZWQgdG8gdGhlIHJlZHVjZXIgaXMgdW5kZWZpbmVkLCB5b3UgbXVzdCAnICsgJ2V4cGxpY2l0bHkgcmV0dXJuIHRoZSBpbml0aWFsIHN0YXRlLiBUaGUgaW5pdGlhbCBzdGF0ZSBtYXkgJyArICdub3QgYmUgdW5kZWZpbmVkLiBJZiB5b3UgZG9uXCd0IHdhbnQgdG8gc2V0IGEgdmFsdWUgZm9yIHRoaXMgcmVkdWNlciwgJyArICd5b3UgY2FuIHVzZSBudWxsIGluc3RlYWQgb2YgdW5kZWZpbmVkLicpOw0KICAgIH0NCg0KICAgIHZhciB0eXBlID0gJ0BAcmVkdXgvUFJPQkVfVU5LTk9XTl9BQ1RJT05fJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZyg3KS5zcGxpdCgnJykuam9pbignLicpOw0KICAgIGlmICh0eXBlb2YgcmVkdWNlcih1bmRlZmluZWQsIHsgdHlwZTogdHlwZSB9KSA9PT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcignUmVkdWNlciAiJyArIGtleSArICciIHJldHVybmVkIHVuZGVmaW5lZCB3aGVuIHByb2JlZCB3aXRoIGEgcmFuZG9tIHR5cGUuICcgKyAoJ0RvblwndCB0cnkgdG8gaGFuZGxlICcgKyBBY3Rpb25UeXBlcy5JTklUICsgJyBvciBvdGhlciBhY3Rpb25zIGluICJyZWR1eC8qIiAnKSArICduYW1lc3BhY2UuIFRoZXkgYXJlIGNvbnNpZGVyZWQgcHJpdmF0ZS4gSW5zdGVhZCwgeW91IG11c3QgcmV0dXJuIHRoZSAnICsgJ2N1cnJlbnQgc3RhdGUgZm9yIGFueSB1bmtub3duIGFjdGlvbnMsIHVubGVzcyBpdCBpcyB1bmRlZmluZWQsICcgKyAnaW4gd2hpY2ggY2FzZSB5b3UgbXVzdCByZXR1cm4gdGhlIGluaXRpYWwgc3RhdGUsIHJlZ2FyZGxlc3Mgb2YgdGhlICcgKyAnYWN0aW9uIHR5cGUuIFRoZSBpbml0aWFsIHN0YXRlIG1heSBub3QgYmUgdW5kZWZpbmVkLCBidXQgY2FuIGJlIG51bGwuJyk7DQogICAgfQ0KICB9KTsNCn0NCg0KLyoqDQogKiBUdXJucyBhbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGFyZSBkaWZmZXJlbnQgcmVkdWNlciBmdW5jdGlvbnMsIGludG8gYSBzaW5nbGUNCiAqIHJlZHVjZXIgZnVuY3Rpb24uIEl0IHdpbGwgY2FsbCBldmVyeSBjaGlsZCByZWR1Y2VyLCBhbmQgZ2F0aGVyIHRoZWlyIHJlc3VsdHMNCiAqIGludG8gYSBzaW5nbGUgc3RhdGUgb2JqZWN0LCB3aG9zZSBrZXlzIGNvcnJlc3BvbmQgdG8gdGhlIGtleXMgb2YgdGhlIHBhc3NlZA0KICogcmVkdWNlciBmdW5jdGlvbnMuDQogKg0KICogQHBhcmFtIHtPYmplY3R9IHJlZHVjZXJzIEFuIG9iamVjdCB3aG9zZSB2YWx1ZXMgY29ycmVzcG9uZCB0byBkaWZmZXJlbnQNCiAqIHJlZHVjZXIgZnVuY3Rpb25zIHRoYXQgbmVlZCB0byBiZSBjb21iaW5lZCBpbnRvIG9uZS4gT25lIGhhbmR5IHdheSB0byBvYnRhaW4NCiAqIGl0IGlzIHRvIHVzZSBFUzYgYGltcG9ydCAqIGFzIHJlZHVjZXJzYCBzeW50YXguIFRoZSByZWR1Y2VycyBtYXkgbmV2ZXIgcmV0dXJuDQogKiB1bmRlZmluZWQgZm9yIGFueSBhY3Rpb24uIEluc3RlYWQsIHRoZXkgc2hvdWxkIHJldHVybiB0aGVpciBpbml0aWFsIHN0YXRlDQogKiBpZiB0aGUgc3RhdGUgcGFzc2VkIHRvIHRoZW0gd2FzIHVuZGVmaW5lZCwgYW5kIHRoZSBjdXJyZW50IHN0YXRlIGZvciBhbnkNCiAqIHVucmVjb2duaXplZCBhY3Rpb24uDQogKg0KICogQHJldHVybnMge0Z1bmN0aW9ufSBBIHJlZHVjZXIgZnVuY3Rpb24gdGhhdCBpbnZva2VzIGV2ZXJ5IHJlZHVjZXIgaW5zaWRlIHRoZQ0KICogcGFzc2VkIG9iamVjdCwgYW5kIGJ1aWxkcyBhIHN0YXRlIG9iamVjdCB3aXRoIHRoZSBzYW1lIHNoYXBlLg0KICovDQpmdW5jdGlvbiBjb21iaW5lUmVkdWNlcnMocmVkdWNlcnMpIHsNCiAgdmFyIHJlZHVjZXJLZXlzID0gT2JqZWN0LmtleXMocmVkdWNlcnMpOw0KICB2YXIgZmluYWxSZWR1Y2VycyA9IHt9Ow0KICBmb3IgKHZhciBpID0gMDsgaSA8IHJlZHVjZXJLZXlzLmxlbmd0aDsgaSsrKSB7DQogICAgdmFyIGtleSA9IHJlZHVjZXJLZXlzW2ldOw0KDQogICAgaWYgKGZhbHNlKSB7DQogICAgICBpZiAodHlwZW9mIHJlZHVjZXJzW2tleV0gPT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgIHdhcm5pbmcoJ05vIHJlZHVjZXIgcHJvdmlkZWQgZm9yIGtleSAiJyArIGtleSArICciJyk7DQogICAgICB9DQogICAgfQ0KDQogICAgaWYgKHR5cGVvZiByZWR1Y2Vyc1trZXldID09PSAnZnVuY3Rpb24nKSB7DQogICAgICBmaW5hbFJlZHVjZXJzW2tleV0gPSByZWR1Y2Vyc1trZXldOw0KICAgIH0NCiAgfQ0KICB2YXIgZmluYWxSZWR1Y2VyS2V5cyA9IE9iamVjdC5rZXlzKGZpbmFsUmVkdWNlcnMpOw0KDQogIHZhciB1bmV4cGVjdGVkS2V5Q2FjaGUgPSB2b2lkIDA7DQogIGlmIChmYWxzZSkgew0KICAgIHVuZXhwZWN0ZWRLZXlDYWNoZSA9IHt9Ow0KICB9DQoNCiAgdmFyIHNoYXBlQXNzZXJ0aW9uRXJyb3IgPSB2b2lkIDA7DQogIHRyeSB7DQogICAgYXNzZXJ0UmVkdWNlclNoYXBlKGZpbmFsUmVkdWNlcnMpOw0KICB9IGNhdGNoIChlKSB7DQogICAgc2hhcGVBc3NlcnRpb25FcnJvciA9IGU7DQogIH0NCg0KICByZXR1cm4gZnVuY3Rpb24gY29tYmluYXRpb24oKSB7DQogICAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsNCiAgICB2YXIgYWN0aW9uID0gYXJndW1lbnRzWzFdOw0KDQogICAgaWYgKHNoYXBlQXNzZXJ0aW9uRXJyb3IpIHsNCiAgICAgIHRocm93IHNoYXBlQXNzZXJ0aW9uRXJyb3I7DQogICAgfQ0KDQogICAgaWYgKGZhbHNlKSB7DQogICAgICB2YXIgd2FybmluZ01lc3NhZ2UgPSBnZXRVbmV4cGVjdGVkU3RhdGVTaGFwZVdhcm5pbmdNZXNzYWdlKHN0YXRlLCBmaW5hbFJlZHVjZXJzLCBhY3Rpb24sIHVuZXhwZWN0ZWRLZXlDYWNoZSk7DQogICAgICBpZiAod2FybmluZ01lc3NhZ2UpIHsNCiAgICAgICAgd2FybmluZyh3YXJuaW5nTWVzc2FnZSk7DQogICAgICB9DQogICAgfQ0KDQogICAgdmFyIGhhc0NoYW5nZWQgPSBmYWxzZTsNCiAgICB2YXIgbmV4dFN0YXRlID0ge307DQogICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGZpbmFsUmVkdWNlcktleXMubGVuZ3RoOyBfaSsrKSB7DQogICAgICB2YXIgX2tleSA9IGZpbmFsUmVkdWNlcktleXNbX2ldOw0KICAgICAgdmFyIHJlZHVjZXIgPSBmaW5hbFJlZHVjZXJzW19rZXldOw0KICAgICAgdmFyIHByZXZpb3VzU3RhdGVGb3JLZXkgPSBzdGF0ZVtfa2V5XTsNCiAgICAgIHZhciBuZXh0U3RhdGVGb3JLZXkgPSByZWR1Y2VyKHByZXZpb3VzU3RhdGVGb3JLZXksIGFjdGlvbik7DQogICAgICBpZiAodHlwZW9mIG5leHRTdGF0ZUZvcktleSA9PT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9IGdldFVuZGVmaW5lZFN0YXRlRXJyb3JNZXNzYWdlKF9rZXksIGFjdGlvbik7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpOw0KICAgICAgfQ0KICAgICAgbmV4dFN0YXRlW19rZXldID0gbmV4dFN0YXRlRm9yS2V5Ow0KICAgICAgaGFzQ2hhbmdlZCA9IGhhc0NoYW5nZWQgfHwgbmV4dFN0YXRlRm9yS2V5ICE9PSBwcmV2aW91c1N0YXRlRm9yS2V5Ow0KICAgIH0NCiAgICByZXR1cm4gaGFzQ2hhbmdlZCA/IG5leHRTdGF0ZSA6IHN0YXRlOw0KICB9Ow0KfQ0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVkdXgvZXMvYmluZEFjdGlvbkNyZWF0b3JzLmpzDQpmdW5jdGlvbiBiaW5kQWN0aW9uQ3JlYXRvcihhY3Rpb25DcmVhdG9yLCBkaXNwYXRjaCkgew0KICByZXR1cm4gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiBkaXNwYXRjaChhY3Rpb25DcmVhdG9yLmFwcGx5KHVuZGVmaW5lZCwgYXJndW1lbnRzKSk7DQogIH07DQp9DQoNCi8qKg0KICogVHVybnMgYW4gb2JqZWN0IHdob3NlIHZhbHVlcyBhcmUgYWN0aW9uIGNyZWF0b3JzLCBpbnRvIGFuIG9iamVjdCB3aXRoIHRoZQ0KICogc2FtZSBrZXlzLCBidXQgd2l0aCBldmVyeSBmdW5jdGlvbiB3cmFwcGVkIGludG8gYSBgZGlzcGF0Y2hgIGNhbGwgc28gdGhleQ0KICogbWF5IGJlIGludm9rZWQgZGlyZWN0bHkuIFRoaXMgaXMganVzdCBhIGNvbnZlbmllbmNlIG1ldGhvZCwgYXMgeW91IGNhbiBjYWxsDQogKiBgc3RvcmUuZGlzcGF0Y2goTXlBY3Rpb25DcmVhdG9ycy5kb1NvbWV0aGluZygpKWAgeW91cnNlbGYganVzdCBmaW5lLg0KICoNCiAqIEZvciBjb252ZW5pZW5jZSwgeW91IGNhbiBhbHNvIHBhc3MgYSBzaW5nbGUgZnVuY3Rpb24gYXMgdGhlIGZpcnN0IGFyZ3VtZW50LA0KICogYW5kIGdldCBhIGZ1bmN0aW9uIGluIHJldHVybi4NCiAqDQogKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdH0gYWN0aW9uQ3JlYXRvcnMgQW4gb2JqZWN0IHdob3NlIHZhbHVlcyBhcmUgYWN0aW9uDQogKiBjcmVhdG9yIGZ1bmN0aW9ucy4gT25lIGhhbmR5IHdheSB0byBvYnRhaW4gaXQgaXMgdG8gdXNlIEVTNiBgaW1wb3J0ICogYXNgDQogKiBzeW50YXguIFlvdSBtYXkgYWxzbyBwYXNzIGEgc2luZ2xlIGZ1bmN0aW9uLg0KICoNCiAqIEBwYXJhbSB7RnVuY3Rpb259IGRpc3BhdGNoIFRoZSBgZGlzcGF0Y2hgIGZ1bmN0aW9uIGF2YWlsYWJsZSBvbiB5b3VyIFJlZHV4DQogKiBzdG9yZS4NCiAqDQogKiBAcmV0dXJucyB7RnVuY3Rpb258T2JqZWN0fSBUaGUgb2JqZWN0IG1pbWlja2luZyB0aGUgb3JpZ2luYWwgb2JqZWN0LCBidXQgd2l0aA0KICogZXZlcnkgYWN0aW9uIGNyZWF0b3Igd3JhcHBlZCBpbnRvIHRoZSBgZGlzcGF0Y2hgIGNhbGwuIElmIHlvdSBwYXNzZWQgYQ0KICogZnVuY3Rpb24gYXMgYGFjdGlvbkNyZWF0b3JzYCwgdGhlIHJldHVybiB2YWx1ZSB3aWxsIGFsc28gYmUgYSBzaW5nbGUNCiAqIGZ1bmN0aW9uLg0KICovDQpmdW5jdGlvbiBiaW5kQWN0aW9uQ3JlYXRvcnMoYWN0aW9uQ3JlYXRvcnMsIGRpc3BhdGNoKSB7DQogIGlmICh0eXBlb2YgYWN0aW9uQ3JlYXRvcnMgPT09ICdmdW5jdGlvbicpIHsNCiAgICByZXR1cm4gYmluZEFjdGlvbkNyZWF0b3IoYWN0aW9uQ3JlYXRvcnMsIGRpc3BhdGNoKTsNCiAgfQ0KDQogIGlmICh0eXBlb2YgYWN0aW9uQ3JlYXRvcnMgIT09ICdvYmplY3QnIHx8IGFjdGlvbkNyZWF0b3JzID09PSBudWxsKSB7DQogICAgdGhyb3cgbmV3IEVycm9yKCdiaW5kQWN0aW9uQ3JlYXRvcnMgZXhwZWN0ZWQgYW4gb2JqZWN0IG9yIGEgZnVuY3Rpb24sIGluc3RlYWQgcmVjZWl2ZWQgJyArIChhY3Rpb25DcmVhdG9ycyA9PT0gbnVsbCA/ICdudWxsJyA6IHR5cGVvZiBhY3Rpb25DcmVhdG9ycykgKyAnLiAnICsgJ0RpZCB5b3Ugd3JpdGUgImltcG9ydCBBY3Rpb25DcmVhdG9ycyBmcm9tIiBpbnN0ZWFkIG9mICJpbXBvcnQgKiBhcyBBY3Rpb25DcmVhdG9ycyBmcm9tIj8nKTsNCiAgfQ0KDQogIHZhciBrZXlzID0gT2JqZWN0LmtleXMoYWN0aW9uQ3JlYXRvcnMpOw0KICB2YXIgYm91bmRBY3Rpb25DcmVhdG9ycyA9IHt9Ow0KICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsNCiAgICB2YXIga2V5ID0ga2V5c1tpXTsNCiAgICB2YXIgYWN0aW9uQ3JlYXRvciA9IGFjdGlvbkNyZWF0b3JzW2tleV07DQogICAgaWYgKHR5cGVvZiBhY3Rpb25DcmVhdG9yID09PSAnZnVuY3Rpb24nKSB7DQogICAgICBib3VuZEFjdGlvbkNyZWF0b3JzW2tleV0gPSBiaW5kQWN0aW9uQ3JlYXRvcihhY3Rpb25DcmVhdG9yLCBkaXNwYXRjaCk7DQogICAgfQ0KICB9DQogIHJldHVybiBib3VuZEFjdGlvbkNyZWF0b3JzOw0KfQ0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVkdXgvZXMvY29tcG9zZS5qcw0KLyoqDQogKiBDb21wb3NlcyBzaW5nbGUtYXJndW1lbnQgZnVuY3Rpb25zIGZyb20gcmlnaHQgdG8gbGVmdC4gVGhlIHJpZ2h0bW9zdA0KICogZnVuY3Rpb24gY2FuIHRha2UgbXVsdGlwbGUgYXJndW1lbnRzIGFzIGl0IHByb3ZpZGVzIHRoZSBzaWduYXR1cmUgZm9yDQogKiB0aGUgcmVzdWx0aW5nIGNvbXBvc2l0ZSBmdW5jdGlvbi4NCiAqDQogKiBAcGFyYW0gey4uLkZ1bmN0aW9ufSBmdW5jcyBUaGUgZnVuY3Rpb25zIHRvIGNvbXBvc2UuDQogKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgZnVuY3Rpb24gb2J0YWluZWQgYnkgY29tcG9zaW5nIHRoZSBhcmd1bWVudCBmdW5jdGlvbnMNCiAqIGZyb20gcmlnaHQgdG8gbGVmdC4gRm9yIGV4YW1wbGUsIGNvbXBvc2UoZiwgZywgaCkgaXMgaWRlbnRpY2FsIHRvIGRvaW5nDQogKiAoLi4uYXJncykgPT4gZihnKGgoLi4uYXJncykpKS4NCiAqLw0KDQpmdW5jdGlvbiBjb21wb3NlKCkgew0KICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgZnVuY3MgPSBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsNCiAgICBmdW5jc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTsNCiAgfQ0KDQogIGlmIChmdW5jcy5sZW5ndGggPT09IDApIHsNCiAgICByZXR1cm4gZnVuY3Rpb24gKGFyZykgew0KICAgICAgcmV0dXJuIGFyZzsNCiAgICB9Ow0KICB9DQoNCiAgaWYgKGZ1bmNzLmxlbmd0aCA9PT0gMSkgew0KICAgIHJldHVybiBmdW5jc1swXTsNCiAgfQ0KDQogIHJldHVybiBmdW5jcy5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24gKCkgew0KICAgICAgcmV0dXJuIGEoYi5hcHBseSh1bmRlZmluZWQsIGFyZ3VtZW50cykpOw0KICAgIH07DQogIH0pOw0KfQ0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVkdXgvZXMvYXBwbHlNaWRkbGV3YXJlLmpzDQp2YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9Ow0KDQoNCg0KLyoqDQogKiBDcmVhdGVzIGEgc3RvcmUgZW5oYW5jZXIgdGhhdCBhcHBsaWVzIG1pZGRsZXdhcmUgdG8gdGhlIGRpc3BhdGNoIG1ldGhvZA0KICogb2YgdGhlIFJlZHV4IHN0b3JlLiBUaGlzIGlzIGhhbmR5IGZvciBhIHZhcmlldHkgb2YgdGFza3MsIHN1Y2ggYXMgZXhwcmVzc2luZw0KICogYXN5bmNocm9ub3VzIGFjdGlvbnMgaW4gYSBjb25jaXNlIG1hbm5lciwgb3IgbG9nZ2luZyBldmVyeSBhY3Rpb24gcGF5bG9hZC4NCiAqDQogKiBTZWUgYHJlZHV4LXRodW5rYCBwYWNrYWdlIGFzIGFuIGV4YW1wbGUgb2YgdGhlIFJlZHV4IG1pZGRsZXdhcmUuDQogKg0KICogQmVjYXVzZSBtaWRkbGV3YXJlIGlzIHBvdGVudGlhbGx5IGFzeW5jaHJvbm91cywgdGhpcyBzaG91bGQgYmUgdGhlIGZpcnN0DQogKiBzdG9yZSBlbmhhbmNlciBpbiB0aGUgY29tcG9zaXRpb24gY2hhaW4uDQogKg0KICogTm90ZSB0aGF0IGVhY2ggbWlkZGxld2FyZSB3aWxsIGJlIGdpdmVuIHRoZSBgZGlzcGF0Y2hgIGFuZCBgZ2V0U3RhdGVgIGZ1bmN0aW9ucw0KICogYXMgbmFtZWQgYXJndW1lbnRzLg0KICoNCiAqIEBwYXJhbSB7Li4uRnVuY3Rpb259IG1pZGRsZXdhcmVzIFRoZSBtaWRkbGV3YXJlIGNoYWluIHRvIGJlIGFwcGxpZWQuDQogKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgc3RvcmUgZW5oYW5jZXIgYXBwbHlpbmcgdGhlIG1pZGRsZXdhcmUuDQogKi8NCmZ1bmN0aW9uIGFwcGx5TWlkZGxld2FyZSgpIHsNCiAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIG1pZGRsZXdhcmVzID0gQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7DQogICAgbWlkZGxld2FyZXNbX2tleV0gPSBhcmd1bWVudHNbX2tleV07DQogIH0NCg0KICByZXR1cm4gZnVuY3Rpb24gKGNyZWF0ZVN0b3JlKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uIChyZWR1Y2VyLCBwcmVsb2FkZWRTdGF0ZSwgZW5oYW5jZXIpIHsNCiAgICAgIHZhciBzdG9yZSA9IGNyZWF0ZVN0b3JlKHJlZHVjZXIsIHByZWxvYWRlZFN0YXRlLCBlbmhhbmNlcik7DQogICAgICB2YXIgX2Rpc3BhdGNoID0gc3RvcmUuZGlzcGF0Y2g7DQogICAgICB2YXIgY2hhaW4gPSBbXTsNCg0KICAgICAgdmFyIG1pZGRsZXdhcmVBUEkgPSB7DQogICAgICAgIGdldFN0YXRlOiBzdG9yZS5nZXRTdGF0ZSwNCiAgICAgICAgZGlzcGF0Y2g6IGZ1bmN0aW9uIGRpc3BhdGNoKGFjdGlvbikgew0KICAgICAgICAgIHJldHVybiBfZGlzcGF0Y2goYWN0aW9uKTsNCiAgICAgICAgfQ0KICAgICAgfTsNCiAgICAgIGNoYWluID0gbWlkZGxld2FyZXMubWFwKGZ1bmN0aW9uIChtaWRkbGV3YXJlKSB7DQogICAgICAgIHJldHVybiBtaWRkbGV3YXJlKG1pZGRsZXdhcmVBUEkpOw0KICAgICAgfSk7DQogICAgICBfZGlzcGF0Y2ggPSBjb21wb3NlLmFwcGx5KHVuZGVmaW5lZCwgY2hhaW4pKHN0b3JlLmRpc3BhdGNoKTsNCg0KICAgICAgcmV0dXJuIF9leHRlbmRzKHt9LCBzdG9yZSwgew0KICAgICAgICBkaXNwYXRjaDogX2Rpc3BhdGNoDQogICAgICB9KTsNCiAgICB9Ow0KICB9Ow0KfQ0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVkdXgvZXMvaW5kZXguanMNCi8qIGNvbmNhdGVkIGhhcm1vbnkgcmVleHBvcnQgKi9fX3dlYnBhY2tfcmVxdWlyZV9fLmQoX193ZWJwYWNrX2V4cG9ydHNfXywgImNyZWF0ZVN0b3JlIiwgZnVuY3Rpb24oKSB7IHJldHVybiBjcmVhdGVTdG9yZV9jcmVhdGVTdG9yZTsgfSk7DQovKiBjb25jYXRlZCBoYXJtb255IHJlZXhwb3J0ICovX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sICJjb21iaW5lUmVkdWNlcnMiLCBmdW5jdGlvbigpIHsgcmV0dXJuIGNvbWJpbmVSZWR1Y2VyczsgfSk7DQovKiBjb25jYXRlZCBoYXJtb255IHJlZXhwb3J0ICovX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sICJiaW5kQWN0aW9uQ3JlYXRvcnMiLCBmdW5jdGlvbigpIHsgcmV0dXJuIGJpbmRBY3Rpb25DcmVhdG9yczsgfSk7DQovKiBjb25jYXRlZCBoYXJtb255IHJlZXhwb3J0ICovX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sICJhcHBseU1pZGRsZXdhcmUiLCBmdW5jdGlvbigpIHsgcmV0dXJuIGFwcGx5TWlkZGxld2FyZTsgfSk7DQovKiBjb25jYXRlZCBoYXJtb255IHJlZXhwb3J0ICovX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sICJjb21wb3NlIiwgZnVuY3Rpb24oKSB7IHJldHVybiBjb21wb3NlOyB9KTsNCg0KDQoNCg0KDQoNCg0KLyoNCiogVGhpcyBpcyBhIGR1bW15IGZ1bmN0aW9uIHRvIGNoZWNrIGlmIHRoZSBmdW5jdGlvbiBuYW1lIGhhcyBiZWVuIGFsdGVyZWQgYnkgbWluaWZpY2F0aW9uLg0KKiBJZiB0aGUgZnVuY3Rpb24gaGFzIGJlZW4gbWluaWZpZWQgYW5kIE5PREVfRU5WICE9PSAncHJvZHVjdGlvbicsIHdhcm4gdGhlIHVzZXIuDQoqLw0KZnVuY3Rpb24gaXNDcnVzaGVkKCkge30NCg0KaWYgKGZhbHNlKSB7DQogIHdhcm5pbmcoJ1lvdSBhcmUgY3VycmVudGx5IHVzaW5nIG1pbmlmaWVkIGNvZGUgb3V0c2lkZSBvZiBOT0RFX0VOViA9PT0gXCdwcm9kdWN0aW9uXCcuICcgKyAnVGhpcyBtZWFucyB0aGF0IHlvdSBhcmUgcnVubmluZyBhIHNsb3dlciBkZXZlbG9wbWVudCBidWlsZCBvZiBSZWR1eC4gJyArICdZb3UgY2FuIHVzZSBsb29zZS1lbnZpZnkgKGh0dHBzOi8vZ2l0aHViLmNvbS96ZXJ0b3NoL2xvb3NlLWVudmlmeSkgZm9yIGJyb3dzZXJpZnkgJyArICdvciBEZWZpbmVQbHVnaW4gZm9yIHdlYnBhY2sgKGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzAwMzAwMzEpICcgKyAndG8gZW5zdXJlIHlvdSBoYXZlIHRoZSBjb3JyZWN0IGNvZGUgZm9yIHlvdXIgcHJvZHVjdGlvbiBidWlsZC4nKTsNCn0NCg0KDQoNCi8qKiovIH0pLA0KLyogMzQgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KdmFyIGc7DQoNCi8vIFRoaXMgd29ya3MgaW4gbm9uLXN0cmljdCBtb2RlDQpnID0gKGZ1bmN0aW9uKCkgew0KCXJldHVybiB0aGlzOw0KfSkoKTsNCg0KdHJ5IHsNCgkvLyBUaGlzIHdvcmtzIGlmIGV2YWwgaXMgYWxsb3dlZCAoc2VlIENTUCkNCglnID0gZyB8fCBGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpIHx8ICgxLGV2YWwpKCJ0aGlzIik7DQp9IGNhdGNoKGUpIHsNCgkvLyBUaGlzIHdvcmtzIGlmIHRoZSB3aW5kb3cgcmVmZXJlbmNlIGlzIGF2YWlsYWJsZQ0KCWlmKHR5cGVvZiB3aW5kb3cgPT09ICJvYmplY3QiKQ0KCQlnID0gd2luZG93Ow0KfQ0KDQovLyBnIGNhbiBzdGlsbCBiZSB1bmRlZmluZWQsIGJ1dCBub3RoaW5nIHRvIGRvIGFib3V0IGl0Li4uDQovLyBXZSByZXR1cm4gdW5kZWZpbmVkLCBpbnN0ZWFkIG9mIG5vdGhpbmcgaGVyZSwgc28gaXQncw0KLy8gZWFzaWVyIHRvIGhhbmRsZSB0aGlzIGNhc2UuIGlmKCFnbG9iYWwpIHsgLi4ufQ0KDQptb2R1bGUuZXhwb3J0cyA9IGc7DQoNCg0KLyoqKi8gfSksDQovKiAzNSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQoNCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOw0KDQp2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsNCg0KZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9DQoNCnZhciBXcmFwcGVkRWxlbWVudCA9IGZ1bmN0aW9uICgpIHsNCiAgZnVuY3Rpb24gV3JhcHBlZEVsZW1lbnQoX3JlZikgew0KICAgIHZhciBlbGVtZW50ID0gX3JlZi5lbGVtZW50LA0KICAgICAgICBjbGFzc05hbWVzID0gX3JlZi5jbGFzc05hbWVzOw0KDQogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFdyYXBwZWRFbGVtZW50KTsNCg0KICAgIE9iamVjdC5hc3NpZ24odGhpcywgeyBlbGVtZW50OiBlbGVtZW50LCBjbGFzc05hbWVzOiBjbGFzc05hbWVzIH0pOw0KDQogICAgaWYgKCEoMCwgX3V0aWxzLmlzRWxlbWVudCkoZWxlbWVudCkpIHsNCiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgZWxlbWVudCBwYXNzZWQnKTsNCiAgICB9DQoNCiAgICB0aGlzLmlzRGlzYWJsZWQgPSBmYWxzZTsNCiAgfQ0KDQogIF9jcmVhdGVDbGFzcyhXcmFwcGVkRWxlbWVudCwgW3sNCiAgICBrZXk6ICdjb25jZWFsJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gY29uY2VhbCgpIHsNCiAgICAgIC8vIEhpZGUgcGFzc2VkIGlucHV0DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLmNsYXNzTmFtZXMuaW5wdXQpOw0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5jbGFzc05hbWVzLmhpZGRlblN0YXRlKTsNCg0KICAgICAgLy8gUmVtb3ZlIGVsZW1lbnQgZnJvbSB0YWIgaW5kZXgNCiAgICAgIHRoaXMuZWxlbWVudC50YWJJbmRleCA9ICctMSc7DQoNCiAgICAgIC8vIEJhY2t1cCBvcmlnaW5hbCBzdHlsZXMgaWYgYW55DQogICAgICB2YXIgb3JpZ1N0eWxlID0gdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZSgnc3R5bGUnKTsNCg0KICAgICAgaWYgKG9yaWdTdHlsZSkgew0KICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWNob2ljZS1vcmlnLXN0eWxlJywgb3JpZ1N0eWxlKTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpOw0KICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1jaG9pY2UnLCAnYWN0aXZlJyk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAncmV2ZWFsJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gcmV2ZWFsKCkgew0KICAgICAgLy8gUmVpbnN0YXRlIHBhc3NlZCBlbGVtZW50DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmNsYXNzTmFtZXMuaW5wdXQpOw0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5jbGFzc05hbWVzLmhpZGRlblN0YXRlKTsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ3RhYmluZGV4Jyk7DQoNCiAgICAgIC8vIFJlY292ZXIgb3JpZ2luYWwgc3R5bGVzIGlmIGFueQ0KICAgICAgdmFyIG9yaWdTdHlsZSA9IHRoaXMuZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY2hvaWNlLW9yaWctc3R5bGUnKTsNCg0KICAgICAgaWYgKG9yaWdTdHlsZSkgew0KICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdkYXRhLWNob2ljZS1vcmlnLXN0eWxlJyk7DQogICAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgb3JpZ1N0eWxlKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7DQogICAgICB9DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWhpZGRlbicpOw0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1jaG9pY2UnKTsNCg0KICAgICAgLy8gUmUtYXNzaWduIHZhbHVlcyAtIHRoaXMgaXMgd2VpcmQsIEkga25vdw0KICAgICAgdGhpcy5lbGVtZW50LnZhbHVlID0gdGhpcy5lbGVtZW50LnZhbHVlOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2VuYWJsZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGVuYWJsZSgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7DQogICAgICB0aGlzLmVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTsNCiAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2Rpc2FibGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNhYmxlKCkgew0KICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7DQogICAgICB0aGlzLmVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlOw0KICAgICAgdGhpcy5pc0Rpc2FibGVkID0gdHJ1ZTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICd0cmlnZ2VyRXZlbnQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiB0cmlnZ2VyRXZlbnQoZXZlbnRUeXBlLCBkYXRhKSB7DQogICAgICAoMCwgX3V0aWxzLmRpc3BhdGNoRXZlbnQpKHRoaXMuZWxlbWVudCwgZXZlbnRUeXBlLCBkYXRhKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICd2YWx1ZScsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gdGhpcy5lbGVtZW50LnZhbHVlOw0KICAgIH0NCiAgfV0pOw0KDQogIHJldHVybiBXcmFwcGVkRWxlbWVudDsNCn0oKTsNCg0KZXhwb3J0cy5kZWZhdWx0ID0gV3JhcHBlZEVsZW1lbnQ7DQoNCi8qKiovIH0pLA0KLyogMzYgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KZXhwb3J0cy5URU1QTEFURVMgPSB1bmRlZmluZWQ7DQoNCnZhciBfY2xhc3NuYW1lcyA9IF9fd2VicGFja19yZXF1aXJlX18oODkpOw0KDQp2YXIgX2NsYXNzbmFtZXMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY2xhc3NuYW1lcyk7DQoNCnZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOw0KDQpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQ0KDQpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQ0KDQp2YXIgVEVNUExBVEVTID0gZXhwb3J0cy5URU1QTEFURVMgPSB7DQogIGNvbnRhaW5lck91dGVyOiBmdW5jdGlvbiBjb250YWluZXJPdXRlcihnbG9iYWxDbGFzc2VzLCBkaXJlY3Rpb24sIGlzU2VsZWN0RWxlbWVudCwgaXNTZWxlY3RPbmVFbGVtZW50LCBzZWFyY2hFbmFibGVkLCBwYXNzZWRFbGVtZW50VHlwZSkgew0KICAgIHZhciB0YWJJbmRleCA9IGlzU2VsZWN0T25lRWxlbWVudCA/ICd0YWJpbmRleD0iMCInIDogJyc7DQogICAgdmFyIHJvbGUgPSBpc1NlbGVjdEVsZW1lbnQgPyAncm9sZT0ibGlzdGJveCInIDogJyc7DQogICAgdmFyIGFyaWFBdXRvQ29tcGxldGUgPSAnJzsNCg0KICAgIGlmIChpc1NlbGVjdEVsZW1lbnQgJiYgc2VhcmNoRW5hYmxlZCkgew0KICAgICAgcm9sZSA9ICdyb2xlPSJjb21ib2JveCInOw0KICAgICAgYXJpYUF1dG9Db21wbGV0ZSA9ICdhcmlhLWF1dG9jb21wbGV0ZT0ibGlzdCInOw0KICAgIH0NCg0KICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9IicgKyBnbG9iYWxDbGFzc2VzLmNvbnRhaW5lck91dGVyICsgJyJcbiAgICAgICAgZGF0YS10eXBlPSInICsgcGFzc2VkRWxlbWVudFR5cGUgKyAnIlxuICAgICAgICAnICsgcm9sZSArICdcbiAgICAgICAgJyArIHRhYkluZGV4ICsgJ1xuICAgICAgICAnICsgYXJpYUF1dG9Db21wbGV0ZSArICdcbiAgICAgICAgYXJpYS1oYXNwb3B1cD0idHJ1ZSJcbiAgICAgICAgYXJpYS1leHBhbmRlZD0iZmFsc2UiXG4gICAgICAgIGRpcj0iJyArIGRpcmVjdGlvbiArICciXG4gICAgICAgID5cbiAgICAgIDwvZGl2PlxuICAgICcpOw0KICB9LA0KICBjb250YWluZXJJbm5lcjogZnVuY3Rpb24gY29udGFpbmVySW5uZXIoZ2xvYmFsQ2xhc3Nlcykgew0KICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXYgY2xhc3M9IicgKyBnbG9iYWxDbGFzc2VzLmNvbnRhaW5lcklubmVyICsgJyI+PC9kaXY+XG4gICAgJyk7DQogIH0sDQogIGl0ZW1MaXN0OiBmdW5jdGlvbiBpdGVtTGlzdChnbG9iYWxDbGFzc2VzLCBpc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICB2YXIgX2NsYXNzTmFtZXM7DQoNCiAgICB2YXIgbG9jYWxDbGFzc2VzID0gKDAsIF9jbGFzc25hbWVzMi5kZWZhdWx0KShnbG9iYWxDbGFzc2VzLmxpc3QsIChfY2xhc3NOYW1lcyA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXMsIGdsb2JhbENsYXNzZXMubGlzdFNpbmdsZSwgaXNTZWxlY3RPbmVFbGVtZW50KSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzLCBnbG9iYWxDbGFzc2VzLmxpc3RJdGVtcywgIWlzU2VsZWN0T25lRWxlbWVudCksIF9jbGFzc05hbWVzKSk7DQoNCiAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICA8ZGl2IGNsYXNzPSInICsgbG9jYWxDbGFzc2VzICsgJyI+PC9kaXY+XG4gICAgJyk7DQogIH0sDQogIHBsYWNlaG9sZGVyOiBmdW5jdGlvbiBwbGFjZWhvbGRlcihnbG9iYWxDbGFzc2VzLCB2YWx1ZSkgew0KICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXYgY2xhc3M9IicgKyBnbG9iYWxDbGFzc2VzLnBsYWNlaG9sZGVyICsgJyI+XG4gICAgICAgICcgKyB2YWx1ZSArICdcbiAgICAgIDwvZGl2PlxuICAgICcpOw0KICB9LA0KICBpdGVtOiBmdW5jdGlvbiBpdGVtKGdsb2JhbENsYXNzZXMsIGRhdGEsIHJlbW92ZUl0ZW1CdXR0b24pIHsNCiAgICB2YXIgX2NsYXNzTmFtZXMyOw0KDQogICAgdmFyIGFyaWFTZWxlY3RlZCA9IGRhdGEuYWN0aXZlID8gJ2FyaWEtc2VsZWN0ZWQ9InRydWUiJyA6ICcnOw0KICAgIHZhciBhcmlhRGlzYWJsZWQgPSBkYXRhLmRpc2FibGVkID8gJ2FyaWEtZGlzYWJsZWQ9InRydWUiJyA6ICcnOw0KDQogICAgdmFyIGxvY2FsQ2xhc3NlcyA9ICgwLCBfY2xhc3NuYW1lczIuZGVmYXVsdCkoZ2xvYmFsQ2xhc3Nlcy5pdGVtLCAoX2NsYXNzTmFtZXMyID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczIsIGdsb2JhbENsYXNzZXMuaGlnaGxpZ2h0ZWRTdGF0ZSwgZGF0YS5oaWdobGlnaHRlZCksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczIsIGdsb2JhbENsYXNzZXMuaXRlbVNlbGVjdGFibGUsICFkYXRhLmhpZ2hsaWdodGVkKSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzMiwgZ2xvYmFsQ2xhc3Nlcy5wbGFjZWhvbGRlciwgZGF0YS5wbGFjZWhvbGRlciksIF9jbGFzc05hbWVzMikpOw0KDQogICAgaWYgKHJlbW92ZUl0ZW1CdXR0b24pIHsNCiAgICAgIHZhciBfY2xhc3NOYW1lczM7DQoNCiAgICAgIGxvY2FsQ2xhc3NlcyA9ICgwLCBfY2xhc3NuYW1lczIuZGVmYXVsdCkoZ2xvYmFsQ2xhc3Nlcy5pdGVtLCAoX2NsYXNzTmFtZXMzID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczMsIGdsb2JhbENsYXNzZXMuaGlnaGxpZ2h0ZWRTdGF0ZSwgZGF0YS5oaWdobGlnaHRlZCksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczMsIGdsb2JhbENsYXNzZXMuaXRlbVNlbGVjdGFibGUsICFkYXRhLmRpc2FibGVkKSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzMywgZ2xvYmFsQ2xhc3Nlcy5wbGFjZWhvbGRlciwgZGF0YS5wbGFjZWhvbGRlciksIF9jbGFzc05hbWVzMykpOw0KDQogICAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzcz0iJyArIGxvY2FsQ2xhc3NlcyArICciXG4gICAgICAgICAgZGF0YS1pdGVtXG4gICAgICAgICAgZGF0YS1pZD0iJyArIGRhdGEuaWQgKyAnIlxuICAgICAgICAgIGRhdGEtdmFsdWU9IicgKyBkYXRhLnZhbHVlICsgJyJcbiAgICAgICAgICBkYXRhLWRlbGV0YWJsZVxuICAgICAgICAgICcgKyBhcmlhU2VsZWN0ZWQgKyAnXG4gICAgICAgICAgJyArIGFyaWFEaXNhYmxlZCArICdcbiAgICAgICAgICA+XG4gICAgICAgICAgJyArIGRhdGEubGFiZWwgKyAnPCEtLVxuICAgICAgIC0tPjxidXR0b25cbiAgICAgICAgICAgIHR5cGU9ImJ1dHRvbiJcbiAgICAgICAgICAgIGNsYXNzPSInICsgZ2xvYmFsQ2xhc3Nlcy5idXR0b24gKyAnIlxuICAgICAgICAgICAgZGF0YS1idXR0b25cbiAgICAgICAgICAgIGFyaWEtbGFiZWw9IlJlbW92ZSBpdGVtOiBcJycgKyBkYXRhLnZhbHVlICsgJ1wnIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgUmVtb3ZlIGl0ZW1cbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAnKTsNCiAgICB9DQoNCiAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzPSInICsgbG9jYWxDbGFzc2VzICsgJyJcbiAgICAgICAgZGF0YS1pdGVtXG4gICAgICAgIGRhdGEtaWQ9IicgKyBkYXRhLmlkICsgJyJcbiAgICAgICAgZGF0YS12YWx1ZT0iJyArIGRhdGEudmFsdWUgKyAnIlxuICAgICAgICAnICsgYXJpYVNlbGVjdGVkICsgJ1xuICAgICAgICAnICsgYXJpYURpc2FibGVkICsgJ1xuICAgICAgICA+XG4gICAgICAgICcgKyBkYXRhLmxhYmVsICsgJ1xuICAgICAgPC9kaXY+XG4gICAgJyk7DQogIH0sDQogIGNob2ljZUxpc3Q6IGZ1bmN0aW9uIGNob2ljZUxpc3QoZ2xvYmFsQ2xhc3NlcywgaXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgdmFyIGFyaWFNdWx0aVNlbGVjdGFibGUgPSAhaXNTZWxlY3RPbmVFbGVtZW50ID8gJ2FyaWEtbXVsdGlzZWxlY3RhYmxlPSJ0cnVlIicgOiAnJzsNCg0KICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9IicgKyBnbG9iYWxDbGFzc2VzLmxpc3QgKyAnIlxuICAgICAgICBkaXI9Imx0ciJcbiAgICAgICAgcm9sZT0ibGlzdGJveCJcbiAgICAgICAgJyArIGFyaWFNdWx0aVNlbGVjdGFibGUgKyAnXG4gICAgICAgID5cbiAgICAgIDwvZGl2PlxuICAgICcpOw0KICB9LA0KICBjaG9pY2VHcm91cDogZnVuY3Rpb24gY2hvaWNlR3JvdXAoZ2xvYmFsQ2xhc3NlcywgZGF0YSkgew0KICAgIHZhciBhcmlhRGlzYWJsZWQgPSBkYXRhLmRpc2FibGVkID8gJ2FyaWEtZGlzYWJsZWQ9InRydWUiJyA6ICcnOw0KICAgIHZhciBsb2NhbENsYXNzZXMgPSAoMCwgX2NsYXNzbmFtZXMyLmRlZmF1bHQpKGdsb2JhbENsYXNzZXMuZ3JvdXAsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgZ2xvYmFsQ2xhc3Nlcy5pdGVtRGlzYWJsZWQsIGRhdGEuZGlzYWJsZWQpKTsNCg0KICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9IicgKyBsb2NhbENsYXNzZXMgKyAnIlxuICAgICAgICBkYXRhLWdyb3VwXG4gICAgICAgIGRhdGEtaWQ9IicgKyBkYXRhLmlkICsgJyJcbiAgICAgICAgZGF0YS12YWx1ZT0iJyArIGRhdGEudmFsdWUgKyAnIlxuICAgICAgICByb2xlPSJncm91cCJcbiAgICAgICAgJyArIGFyaWFEaXNhYmxlZCArICdcbiAgICAgICAgPlxuICAgICAgICA8ZGl2IGNsYXNzPSInICsgZ2xvYmFsQ2xhc3Nlcy5ncm91cEhlYWRpbmcgKyAnIj4nICsgZGF0YS52YWx1ZSArICc8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICcpOw0KICB9LA0KICBjaG9pY2U6IGZ1bmN0aW9uIGNob2ljZShnbG9iYWxDbGFzc2VzLCBkYXRhLCBpdGVtU2VsZWN0VGV4dCkgew0KICAgIHZhciBfY2xhc3NOYW1lczU7DQoNCiAgICB2YXIgcm9sZSA9IGRhdGEuZ3JvdXBJZCA+IDAgPyAncm9sZT0idHJlZWl0ZW0iJyA6ICdyb2xlPSJvcHRpb24iJzsNCiAgICB2YXIgbG9jYWxDbGFzc2VzID0gKDAsIF9jbGFzc25hbWVzMi5kZWZhdWx0KShnbG9iYWxDbGFzc2VzLml0ZW0sIGdsb2JhbENsYXNzZXMuaXRlbUNob2ljZSwgKF9jbGFzc05hbWVzNSA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXM1LCBnbG9iYWxDbGFzc2VzLml0ZW1EaXNhYmxlZCwgZGF0YS5kaXNhYmxlZCksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczUsIGdsb2JhbENsYXNzZXMuaXRlbVNlbGVjdGFibGUsICFkYXRhLmRpc2FibGVkKSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzNSwgZ2xvYmFsQ2xhc3Nlcy5wbGFjZWhvbGRlciwgZGF0YS5wbGFjZWhvbGRlciksIF9jbGFzc05hbWVzNSkpOw0KDQogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPGRpdlxuICAgICAgICBjbGFzcz0iJyArIGxvY2FsQ2xhc3NlcyArICciXG4gICAgICAgIGRhdGEtc2VsZWN0LXRleHQ9IicgKyBpdGVtU2VsZWN0VGV4dCArICciXG4gICAgICAgIGRhdGEtY2hvaWNlXG4gICAgICAgIGRhdGEtaWQ9IicgKyBkYXRhLmlkICsgJyJcbiAgICAgICAgZGF0YS12YWx1ZT0iJyArIGRhdGEudmFsdWUgKyAnIlxuICAgICAgICAnICsgKGRhdGEuZGlzYWJsZWQgPyAnZGF0YS1jaG9pY2UtZGlzYWJsZWQgYXJpYS1kaXNhYmxlZD0idHJ1ZSInIDogJ2RhdGEtY2hvaWNlLXNlbGVjdGFibGUnKSArICdcbiAgICAgICAgaWQ9IicgKyBkYXRhLmVsZW1lbnRJZCArICciXG4gICAgICAgICcgKyByb2xlICsgJ1xuICAgICAgICA+XG4gICAgICAgICcgKyBkYXRhLmxhYmVsICsgJ1xuICAgICAgPC9kaXY+XG4gICAgJyk7DQogIH0sDQogIGlucHV0OiBmdW5jdGlvbiBpbnB1dChnbG9iYWxDbGFzc2VzKSB7DQogICAgdmFyIGxvY2FsQ2xhc3NlcyA9ICgwLCBfY2xhc3NuYW1lczIuZGVmYXVsdCkoZ2xvYmFsQ2xhc3Nlcy5pbnB1dCwgZ2xvYmFsQ2xhc3Nlcy5pbnB1dENsb25lZCk7DQoNCiAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICA8aW5wdXRcbiAgICAgICAgdHlwZT0idGV4dCJcbiAgICAgICAgY2xhc3M9IicgKyBsb2NhbENsYXNzZXMgKyAnIlxuICAgICAgICBhdXRvY29tcGxldGU9Im9mZiJcbiAgICAgICAgYXV0b2NhcGl0YWxpemU9Im9mZiJcbiAgICAgICAgc3BlbGxjaGVjaz0iZmFsc2UiXG4gICAgICAgIHJvbGU9InRleHRib3giXG4gICAgICAgIGFyaWEtYXV0b2NvbXBsZXRlPSJsaXN0IlxuICAgICAgICA+XG4gICAgJyk7DQogIH0sDQogIGRyb3Bkb3duOiBmdW5jdGlvbiBkcm9wZG93bihnbG9iYWxDbGFzc2VzKSB7DQogICAgdmFyIGxvY2FsQ2xhc3NlcyA9ICgwLCBfY2xhc3NuYW1lczIuZGVmYXVsdCkoZ2xvYmFsQ2xhc3Nlcy5saXN0LCBnbG9iYWxDbGFzc2VzLmxpc3REcm9wZG93bik7DQoNCiAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzPSInICsgbG9jYWxDbGFzc2VzICsgJyJcbiAgICAgICAgYXJpYS1leHBhbmRlZD0iZmFsc2UiXG4gICAgICAgID5cbiAgICAgIDwvZGl2PlxuICAgICcpOw0KICB9LA0KICBub3RpY2U6IGZ1bmN0aW9uIG5vdGljZShnbG9iYWxDbGFzc2VzLCBsYWJlbCkgew0KICAgIHZhciBfY2xhc3NOYW1lczY7DQoNCiAgICB2YXIgdHlwZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogJyc7DQoNCiAgICB2YXIgbG9jYWxDbGFzc2VzID0gKDAsIF9jbGFzc25hbWVzMi5kZWZhdWx0KShnbG9iYWxDbGFzc2VzLml0ZW0sIGdsb2JhbENsYXNzZXMuaXRlbUNob2ljZSwgKF9jbGFzc05hbWVzNiA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXM2LCBnbG9iYWxDbGFzc2VzLm5vUmVzdWx0cywgdHlwZSA9PT0gJ25vLXJlc3VsdHMnKSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzNiwgZ2xvYmFsQ2xhc3Nlcy5ub0Nob2ljZXMsIHR5cGUgPT09ICduby1jaG9pY2VzJyksIF9jbGFzc05hbWVzNikpOw0KDQogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPGRpdiBjbGFzcz0iJyArIGxvY2FsQ2xhc3NlcyArICciPlxuICAgICAgICAnICsgbGFiZWwgKyAnXG4gICAgICA8L2Rpdj5cbiAgICAnKTsNCiAgfSwNCiAgb3B0aW9uOiBmdW5jdGlvbiBvcHRpb24oZGF0YSkgew0KICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxvcHRpb24gdmFsdWU9IicgKyBkYXRhLnZhbHVlICsgJyIgJyArIChkYXRhLmFjdGl2ZSA/ICdzZWxlY3RlZCcgOiAnJykgKyAnICcgKyAoZGF0YS5kaXNhYmxlZCA/ICdkaXNhYmxlZCcgOiAnJykgKyAnPicgKyBkYXRhLmxhYmVsICsgJzwvb3B0aW9uPlxuICAgICcpOw0KICB9DQp9Ow0KDQpleHBvcnRzLmRlZmF1bHQgPSBURU1QTEFURVM7DQoNCi8qKiovIH0pLA0KLyogMzcgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM4KTsNCg0KDQovKioqLyB9KSwNCi8qIDM4ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsNCg0KdmFyIF9mdXNlID0gX193ZWJwYWNrX3JlcXVpcmVfXygzOSk7DQoNCnZhciBfZnVzZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9mdXNlKTsNCg0KdmFyIF9kZWVwbWVyZ2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQwKTsNCg0KdmFyIF9kZWVwbWVyZ2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZGVlcG1lcmdlKTsNCg0KX193ZWJwYWNrX3JlcXVpcmVfXyg0MSk7DQoNCnZhciBfc3RvcmUyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3Myk7DQoNCnZhciBfc3RvcmUzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfc3RvcmUyKTsNCg0KdmFyIF9jb21wb25lbnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4Mik7DQoNCnZhciBfY29uc3RhbnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsNCg0KdmFyIF90ZW1wbGF0ZXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM2KTsNCg0KdmFyIF9jaG9pY2VzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5MCk7DQoNCnZhciBfaXRlbXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkxKTsNCg0KdmFyIF9ncm91cHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkyKTsNCg0KdmFyIF9taXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5Myk7DQoNCnZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOw0KDQpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQ0KDQpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQ0KDQpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IGVsc2UgeyByZXR1cm4gQXJyYXkuZnJvbShhcnIpOyB9IH0NCg0KZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9DQoNCi8qKg0KICogQ2hvaWNlcw0KICogQGF1dGhvciBKb3NoIEpvaG5zb248am9zaEBqb3NodWFqb2huc29uLmNvLnVrPg0KICovDQp2YXIgQ2hvaWNlcyA9IGZ1bmN0aW9uICgpIHsNCiAgZnVuY3Rpb24gQ2hvaWNlcygpIHsNCiAgICB2YXIgZWxlbWVudCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJ1tkYXRhLWNob2ljZV0nOw0KICAgIHZhciB1c2VyQ29uZmlnID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsNCg0KICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDaG9pY2VzKTsNCg0KICAgIGlmICgoMCwgX3V0aWxzLmlzVHlwZSkoJ1N0cmluZycsIGVsZW1lbnQpKSB7DQogICAgICB2YXIgZWxlbWVudHMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZWxlbWVudCkpOw0KDQogICAgICAvLyBJZiB0aGVyZSBhcmUgbXVsdGlwbGUgZWxlbWVudHMsIGNyZWF0ZSBhIG5ldyBpbnN0YW5jZQ0KICAgICAgLy8gZm9yIGVhY2ggZWxlbWVudCBiZXNpZGVzIHRoZSBmaXJzdCBvbmUgKGFzIHRoYXQgYWxyZWFkeSBoYXMgYW4gaW5zdGFuY2UpDQogICAgICBpZiAoZWxlbWVudHMubGVuZ3RoID4gMSkgew0KICAgICAgICByZXR1cm4gdGhpcy5fZ2VuZXJhdGVJbnN0YW5jZXMoZWxlbWVudHMsIHVzZXJDb25maWcpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHRoaXMuY29uZmlnID0gX2RlZXBtZXJnZTIuZGVmYXVsdC5hbGwoW19jb25zdGFudHMuREVGQVVMVF9DT05GSUcsIENob2ljZXMudXNlckRlZmF1bHRzLCB1c2VyQ29uZmlnXSk7DQoNCiAgICBpZiAoISgwLCBfdXRpbHMuZG9LZXlzTWF0Y2gpKHRoaXMuY29uZmlnLCBfY29uc3RhbnRzLkRFRkFVTFRfQ09ORklHKSkgew0KICAgICAgY29uc29sZS53YXJuKCdVbmtub3duIGNvbmZpZyBvcHRpb24ocykgcGFzc2VkJyk7DQogICAgfQ0KDQogICAgaWYgKCFbJ2F1dG8nLCAnYWx3YXlzJ10uaW5jbHVkZXModGhpcy5jb25maWcucmVuZGVyU2VsZWN0ZWRDaG9pY2VzKSkgew0KICAgICAgdGhpcy5jb25maWcucmVuZGVyU2VsZWN0ZWRDaG9pY2VzID0gJ2F1dG8nOw0KICAgIH0NCg0KICAgIC8vIFJldHJpZXZlIHRyaWdnZXJpbmcgZWxlbWVudCAoaS5lLiBlbGVtZW50IHdpdGggJ2RhdGEtY2hvaWNlJyB0cmlnZ2VyKQ0KICAgIHZhciBwYXNzZWRFbGVtZW50ID0gKDAsIF91dGlscy5pc1R5cGUpKCdTdHJpbmcnLCBlbGVtZW50KSA/IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWxlbWVudCkgOiBlbGVtZW50Ow0KDQogICAgaWYgKCFwYXNzZWRFbGVtZW50KSB7DQogICAgICByZXR1cm4gY29uc29sZS5lcnJvcignQ291bGQgbm90IGZpbmQgcGFzc2VkIGVsZW1lbnQgb3IgcGFzc2VkIGVsZW1lbnQgd2FzIG9mIGFuIGludmFsaWQgdHlwZScpOw0KICAgIH0NCg0KICAgIHRoaXMuX2lzVGV4dEVsZW1lbnQgPSBwYXNzZWRFbGVtZW50LnR5cGUgPT09ICd0ZXh0JzsNCiAgICB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQgPSBwYXNzZWRFbGVtZW50LnR5cGUgPT09ICdzZWxlY3Qtb25lJzsNCiAgICB0aGlzLl9pc1NlbGVjdE11bHRpcGxlRWxlbWVudCA9IHBhc3NlZEVsZW1lbnQudHlwZSA9PT0gJ3NlbGVjdC1tdWx0aXBsZSc7DQogICAgdGhpcy5faXNTZWxlY3RFbGVtZW50ID0gdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50IHx8IHRoaXMuX2lzU2VsZWN0TXVsdGlwbGVFbGVtZW50Ow0KDQogICAgaWYgKHRoaXMuX2lzVGV4dEVsZW1lbnQpIHsNCiAgICAgIHRoaXMucGFzc2VkRWxlbWVudCA9IG5ldyBfY29tcG9uZW50cy5XcmFwcGVkSW5wdXQoew0KICAgICAgICBlbGVtZW50OiBwYXNzZWRFbGVtZW50LA0KICAgICAgICBjbGFzc05hbWVzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLA0KICAgICAgICBkZWxpbWl0ZXI6IHRoaXMuY29uZmlnLmRlbGltaXRlcg0KICAgICAgfSk7DQogICAgfSBlbHNlIGlmICh0aGlzLl9pc1NlbGVjdEVsZW1lbnQpIHsNCiAgICAgIHRoaXMucGFzc2VkRWxlbWVudCA9IG5ldyBfY29tcG9uZW50cy5XcmFwcGVkU2VsZWN0KHsNCiAgICAgICAgZWxlbWVudDogcGFzc2VkRWxlbWVudCwNCiAgICAgICAgY2xhc3NOYW1lczogdGhpcy5jb25maWcuY2xhc3NOYW1lcw0KICAgICAgfSk7DQogICAgfQ0KDQogICAgaWYgKCFwYXNzZWRFbGVtZW50KSB7DQogICAgICByZXR1cm4gY29uc29sZS5lcnJvcignUGFzc2VkIGVsZW1lbnQgd2FzIG9mIGFuIGludmFsaWQgdHlwZScpOw0KICAgIH0NCg0KICAgIGlmICh0aGlzLmNvbmZpZy5zaG91bGRTb3J0SXRlbXMgPT09IHRydWUgJiYgdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50ICYmICF0aGlzLmNvbmZpZy5zaWxlbnQpIHsNCiAgICAgIGNvbnNvbGUud2Fybigic2hvdWxkU29ydEVsZW1lbnRzOiBUeXBlIG9mIHBhc3NlZCBlbGVtZW50IGlzICdzZWxlY3Qtb25lJywgZmFsbGluZyBiYWNrIHRvIGZhbHNlLiIpOw0KICAgIH0NCg0KICAgIHRoaXMuaW5pdGlhbGlzZWQgPSBmYWxzZTsNCg0KICAgIHRoaXMuX3N0b3JlID0gbmV3IF9zdG9yZTMuZGVmYXVsdCh0aGlzLnJlbmRlcik7DQogICAgdGhpcy5faW5pdGlhbFN0YXRlID0ge307DQogICAgdGhpcy5fY3VycmVudFN0YXRlID0ge307DQogICAgdGhpcy5fcHJldlN0YXRlID0ge307DQogICAgdGhpcy5fY3VycmVudFZhbHVlID0gJyc7DQogICAgdGhpcy5fY2FuU2VhcmNoID0gdGhpcy5jb25maWcuc2VhcmNoRW5hYmxlZDsNCiAgICB0aGlzLl9pc1Njcm9sbGluZ09uSWUgPSBmYWxzZTsNCiAgICB0aGlzLl9oaWdobGlnaHRQb3NpdGlvbiA9IDA7DQogICAgdGhpcy5fd2FzVGFwID0gdHJ1ZTsNCiAgICB0aGlzLl9wbGFjZWhvbGRlclZhbHVlID0gdGhpcy5fZ2VuZXJhdGVQbGFjZWhvbGRlclZhbHVlKCk7DQogICAgdGhpcy5fYmFzZUlkID0gKDAsIF91dGlscy5nZW5lcmF0ZUlkKSh0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudCwgJ2Nob2ljZXMtJyk7DQogICAgdGhpcy5fZGlyZWN0aW9uID0gdGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkaXInKSB8fCAnbHRyJzsNCiAgICB0aGlzLl9pZE5hbWVzID0gew0KICAgICAgaXRlbUNob2ljZTogJ2l0ZW0tY2hvaWNlJw0KICAgIH07DQogICAgLy8gQXNzaWduIHByZXNldCBjaG9pY2VzIGZyb20gcGFzc2VkIG9iamVjdA0KICAgIHRoaXMuX3ByZXNldENob2ljZXMgPSB0aGlzLmNvbmZpZy5jaG9pY2VzOw0KICAgIC8vIEFzc2lnbiBwcmVzZXQgaXRlbXMgZnJvbSBwYXNzZWQgb2JqZWN0IGZpcnN0DQogICAgdGhpcy5fcHJlc2V0SXRlbXMgPSB0aGlzLmNvbmZpZy5pdGVtczsNCiAgICAvLyBUaGVuIGFkZCBhbnkgdmFsdWVzIHBhc3NlZCBmcm9tIGF0dHJpYnV0ZQ0KICAgIGlmICh0aGlzLnBhc3NlZEVsZW1lbnQudmFsdWUpIHsNCiAgICAgIHRoaXMuX3ByZXNldEl0ZW1zID0gdGhpcy5fcHJlc2V0SXRlbXMuY29uY2F0KHRoaXMucGFzc2VkRWxlbWVudC52YWx1ZS5zcGxpdCh0aGlzLmNvbmZpZy5kZWxpbWl0ZXIpKTsNCiAgICB9DQoNCiAgICB0aGlzLl9yZW5kZXIgPSB0aGlzLl9yZW5kZXIuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbkZvY3VzID0gdGhpcy5fb25Gb2N1cy5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uQmx1ciA9IHRoaXMuX29uQmx1ci5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uS2V5VXAgPSB0aGlzLl9vbktleVVwLmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25LZXlEb3duID0gdGhpcy5fb25LZXlEb3duLmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25DbGljayA9IHRoaXMuX29uQ2xpY2suYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vblRvdWNoTW92ZSA9IHRoaXMuX29uVG91Y2hNb3ZlLmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25Ub3VjaEVuZCA9IHRoaXMuX29uVG91Y2hFbmQuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbk1vdXNlRG93biA9IHRoaXMuX29uTW91c2VEb3duLmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25Nb3VzZU92ZXIgPSB0aGlzLl9vbk1vdXNlT3Zlci5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uRm9ybVJlc2V0ID0gdGhpcy5fb25Gb3JtUmVzZXQuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbkFLZXkgPSB0aGlzLl9vbkFLZXkuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbkVudGVyS2V5ID0gdGhpcy5fb25FbnRlcktleS5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uRXNjYXBlS2V5ID0gdGhpcy5fb25Fc2NhcGVLZXkuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbkRpcmVjdGlvbktleSA9IHRoaXMuX29uRGlyZWN0aW9uS2V5LmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25EZWxldGVLZXkgPSB0aGlzLl9vbkRlbGV0ZUtleS5iaW5kKHRoaXMpOw0KDQogICAgLy8gSWYgZWxlbWVudCBoYXMgYWxyZWFkeSBiZWVuIGluaXRpYWxpc2VkIHdpdGggQ2hvaWNlcywgZmFpbCBzaWxlbnRseQ0KICAgIGlmICh0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY2hvaWNlJykgPT09ICdhY3RpdmUnKSB7DQogICAgICBjb25zb2xlLndhcm4oJ1RyeWluZyB0byBpbml0aWFsaXNlIENob2ljZXMgb24gZWxlbWVudCBhbHJlYWR5IGluaXRpYWxpc2VkJyk7DQogICAgfQ0KDQogICAgLy8gTGV0J3MgZ28NCiAgICB0aGlzLmluaXQoKTsNCiAgfQ0KDQogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgPSAgICAgICAgICAgIFB1YmxpYyBmdW5jdGlvbnMgICAgICAgICAgICA9DQogID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8NCg0KICBfY3JlYXRlQ2xhc3MoQ2hvaWNlcywgW3sNCiAgICBrZXk6ICdpbml0JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdCgpIHsNCiAgICAgIGlmICh0aGlzLmluaXRpYWxpc2VkKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5fY3JlYXRlVGVtcGxhdGVzKCk7DQogICAgICB0aGlzLl9jcmVhdGVFbGVtZW50cygpOw0KICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7DQoNCiAgICAgIC8vIFNldCBpbml0aWFsIHN0YXRlIChXZSBuZWVkIHRvIGNsb25lIHRoZSBzdGF0ZSBiZWNhdXNlIHNvbWUgcmVkdWNlcnMNCiAgICAgIC8vIG1vZGlmeSB0aGUgaW5uZXIgb2JqZWN0cyBwcm9wZXJ0aWVzIGluIHRoZSBzdGF0ZSkg8J+kog0KICAgICAgdGhpcy5faW5pdGlhbFN0YXRlID0gKDAsIF91dGlscy5jbG9uZU9iamVjdCkodGhpcy5fc3RvcmUuc3RhdGUpOw0KICAgICAgdGhpcy5fc3RvcmUuc3Vic2NyaWJlKHRoaXMuX3JlbmRlcik7DQogICAgICB0aGlzLl9yZW5kZXIoKTsNCiAgICAgIHRoaXMuX2FkZEV2ZW50TGlzdGVuZXJzKCk7DQoNCiAgICAgIHZhciBzaG91bGREaXNhYmxlID0gIXRoaXMuY29uZmlnLmFkZEl0ZW1zIHx8IHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKTsNCg0KICAgICAgaWYgKHNob3VsZERpc2FibGUpIHsNCiAgICAgICAgdGhpcy5kaXNhYmxlKCk7DQogICAgICB9DQoNCiAgICAgIHRoaXMuaW5pdGlhbGlzZWQgPSB0cnVlOw0KDQogICAgICB2YXIgY2FsbGJhY2tPbkluaXQgPSB0aGlzLmNvbmZpZy5jYWxsYmFja09uSW5pdDsNCiAgICAgIC8vIFJ1biBjYWxsYmFjayBpZiBpdCBpcyBhIGZ1bmN0aW9uDQoNCiAgICAgIGlmIChjYWxsYmFja09uSW5pdCAmJiAoMCwgX3V0aWxzLmlzVHlwZSkoJ0Z1bmN0aW9uJywgY2FsbGJhY2tPbkluaXQpKSB7DQogICAgICAgIGNhbGxiYWNrT25Jbml0LmNhbGwodGhpcyk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnZGVzdHJveScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7DQogICAgICBpZiAoIXRoaXMuaW5pdGlhbGlzZWQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB0aGlzLl9yZW1vdmVFdmVudExpc3RlbmVycygpOw0KICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnJldmVhbCgpOw0KICAgICAgdGhpcy5jb250YWluZXJPdXRlci51bndyYXAodGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQpOw0KDQogICAgICBpZiAodGhpcy5faXNTZWxlY3RFbGVtZW50KSB7DQogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC5vcHRpb25zID0gdGhpcy5fcHJlc2V0Q2hvaWNlczsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5jbGVhclN0b3JlKCk7DQoNCiAgICAgIHRoaXMuY29uZmlnLnRlbXBsYXRlcyA9IG51bGw7DQogICAgICB0aGlzLmluaXRpYWxpc2VkID0gZmFsc2U7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnZW5hYmxlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZW5hYmxlKCkgew0KICAgICAgaWYgKHRoaXMucGFzc2VkRWxlbWVudC5pc0Rpc2FibGVkKSB7DQogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC5lbmFibGUoKTsNCiAgICAgIH0NCg0KICAgICAgaWYgKHRoaXMuY29udGFpbmVyT3V0ZXIuaXNEaXNhYmxlZCkgew0KICAgICAgICB0aGlzLl9hZGRFdmVudExpc3RlbmVycygpOw0KICAgICAgICB0aGlzLmlucHV0LmVuYWJsZSgpOw0KICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLmVuYWJsZSgpOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdkaXNhYmxlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzYWJsZSgpIHsNCiAgICAgIGlmICghdGhpcy5wYXNzZWRFbGVtZW50LmlzRGlzYWJsZWQpIHsNCiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LmRpc2FibGUoKTsNCiAgICAgIH0NCg0KICAgICAgaWYgKCF0aGlzLmNvbnRhaW5lck91dGVyLmlzRGlzYWJsZWQpIHsNCiAgICAgICAgdGhpcy5fcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsNCiAgICAgICAgdGhpcy5pbnB1dC5kaXNhYmxlKCk7DQogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZGlzYWJsZSgpOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdoaWdobGlnaHRJdGVtJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gaGlnaGxpZ2h0SXRlbShpdGVtKSB7DQogICAgICB2YXIgcnVuRXZlbnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHRydWU7DQoNCiAgICAgIGlmICghaXRlbSkgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgdmFyIGlkID0gaXRlbS5pZCwNCiAgICAgICAgICBfaXRlbSRncm91cElkID0gaXRlbS5ncm91cElkLA0KICAgICAgICAgIGdyb3VwSWQgPSBfaXRlbSRncm91cElkID09PSB1bmRlZmluZWQgPyAtMSA6IF9pdGVtJGdyb3VwSWQsDQogICAgICAgICAgX2l0ZW0kdmFsdWUgPSBpdGVtLnZhbHVlLA0KICAgICAgICAgIHZhbHVlID0gX2l0ZW0kdmFsdWUgPT09IHVuZGVmaW5lZCA/ICcnIDogX2l0ZW0kdmFsdWUsDQogICAgICAgICAgX2l0ZW0kbGFiZWwgPSBpdGVtLmxhYmVsLA0KICAgICAgICAgIGxhYmVsID0gX2l0ZW0kbGFiZWwgPT09IHVuZGVmaW5lZCA/ICcnIDogX2l0ZW0kbGFiZWw7DQoNCiAgICAgIHZhciBncm91cCA9IGdyb3VwSWQgPj0gMCA/IHRoaXMuX3N0b3JlLmdldEdyb3VwQnlJZChncm91cElkKSA6IG51bGw7DQoNCiAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfaXRlbXMuaGlnaGxpZ2h0SXRlbSkoaWQsIHRydWUpKTsNCg0KICAgICAgaWYgKHJ1bkV2ZW50KSB7DQogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMuaGlnaGxpZ2h0SXRlbSwgew0KICAgICAgICAgIGlkOiBpZCwNCiAgICAgICAgICB2YWx1ZTogdmFsdWUsDQogICAgICAgICAgbGFiZWw6IGxhYmVsLA0KICAgICAgICAgIGdyb3VwVmFsdWU6IGdyb3VwICYmIGdyb3VwLnZhbHVlID8gZ3JvdXAudmFsdWUgOiBudWxsDQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICd1bmhpZ2hsaWdodEl0ZW0nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiB1bmhpZ2hsaWdodEl0ZW0oaXRlbSkgew0KICAgICAgaWYgKCFpdGVtKSB7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICB2YXIgaWQgPSBpdGVtLmlkLA0KICAgICAgICAgIF9pdGVtJGdyb3VwSWQyID0gaXRlbS5ncm91cElkLA0KICAgICAgICAgIGdyb3VwSWQgPSBfaXRlbSRncm91cElkMiA9PT0gdW5kZWZpbmVkID8gLTEgOiBfaXRlbSRncm91cElkMiwNCiAgICAgICAgICBfaXRlbSR2YWx1ZTIgPSBpdGVtLnZhbHVlLA0KICAgICAgICAgIHZhbHVlID0gX2l0ZW0kdmFsdWUyID09PSB1bmRlZmluZWQgPyAnJyA6IF9pdGVtJHZhbHVlMiwNCiAgICAgICAgICBfaXRlbSRsYWJlbDIgPSBpdGVtLmxhYmVsLA0KICAgICAgICAgIGxhYmVsID0gX2l0ZW0kbGFiZWwyID09PSB1bmRlZmluZWQgPyAnJyA6IF9pdGVtJGxhYmVsMjsNCg0KICAgICAgdmFyIGdyb3VwID0gZ3JvdXBJZCA+PSAwID8gdGhpcy5fc3RvcmUuZ2V0R3JvdXBCeUlkKGdyb3VwSWQpIDogbnVsbDsNCg0KICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9pdGVtcy5oaWdobGlnaHRJdGVtKShpZCwgZmFsc2UpKTsNCiAgICAgIHRoaXMucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMuaGlnaGxpZ2h0SXRlbSwgew0KICAgICAgICBpZDogaWQsDQogICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgbGFiZWw6IGxhYmVsLA0KICAgICAgICBncm91cFZhbHVlOiBncm91cCAmJiBncm91cC52YWx1ZSA/IGdyb3VwLnZhbHVlIDogbnVsbA0KICAgICAgfSk7DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2hpZ2hsaWdodEFsbCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGhpZ2hsaWdodEFsbCgpIHsNCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7DQoNCiAgICAgIHRoaXMuX3N0b3JlLml0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIF90aGlzLmhpZ2hsaWdodEl0ZW0oaXRlbSk7DQogICAgICB9KTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3VuaGlnaGxpZ2h0QWxsJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gdW5oaWdobGlnaHRBbGwoKSB7DQogICAgICB2YXIgX3RoaXMyID0gdGhpczsNCg0KICAgICAgdGhpcy5fc3RvcmUuaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICByZXR1cm4gX3RoaXMyLnVuaGlnaGxpZ2h0SXRlbShpdGVtKTsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAncmVtb3ZlQWN0aXZlSXRlbXNCeVZhbHVlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlQWN0aXZlSXRlbXNCeVZhbHVlKHZhbHVlKSB7DQogICAgICB2YXIgX3RoaXMzID0gdGhpczsNCg0KICAgICAgdGhpcy5fc3RvcmUuYWN0aXZlSXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgIHJldHVybiBpdGVtLnZhbHVlID09PSB2YWx1ZTsNCiAgICAgIH0pLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIF90aGlzMy5fcmVtb3ZlSXRlbShpdGVtKTsNCiAgICAgIH0pOw0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdyZW1vdmVBY3RpdmVJdGVtcycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUFjdGl2ZUl0ZW1zKGV4Y2x1ZGVkSWQpIHsNCiAgICAgIHZhciBfdGhpczQgPSB0aGlzOw0KDQogICAgICB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtcy5maWx0ZXIoZnVuY3Rpb24gKF9yZWYpIHsNCiAgICAgICAgdmFyIGlkID0gX3JlZi5pZDsNCiAgICAgICAgcmV0dXJuIGlkICE9PSBleGNsdWRlZElkOw0KICAgICAgfSkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICByZXR1cm4gX3RoaXM0Ll9yZW1vdmVJdGVtKGl0ZW0pOw0KICAgICAgfSk7DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3JlbW92ZUhpZ2hsaWdodGVkSXRlbXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVIaWdobGlnaHRlZEl0ZW1zKCkgew0KICAgICAgdmFyIF90aGlzNSA9IHRoaXM7DQoNCiAgICAgIHZhciBydW5FdmVudCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7DQoNCiAgICAgIHRoaXMuX3N0b3JlLmhpZ2hsaWdodGVkQWN0aXZlSXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICBfdGhpczUuX3JlbW92ZUl0ZW0oaXRlbSk7DQogICAgICAgIC8vIElmIHRoaXMgYWN0aW9uIHdhcyBwZXJmb3JtZWQgYnkgdGhlIHVzZXINCiAgICAgICAgLy8gdHJpZ2dlciB0aGUgZXZlbnQNCiAgICAgICAgaWYgKHJ1bkV2ZW50KSB7DQogICAgICAgICAgX3RoaXM1Ll90cmlnZ2VyQ2hhbmdlKGl0ZW0udmFsdWUpOw0KICAgICAgICB9DQogICAgICB9KTsNCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnc2hvd0Ryb3Bkb3duJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvd0Ryb3Bkb3duKHByZXZlbnRJbnB1dEZvY3VzKSB7DQogICAgICB2YXIgX3RoaXM2ID0gdGhpczsNCg0KICAgICAgaWYgKHRoaXMuZHJvcGRvd24uaXNBY3RpdmUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7DQogICAgICAgIF90aGlzNi5kcm9wZG93bi5zaG93KCk7DQogICAgICAgIF90aGlzNi5jb250YWluZXJPdXRlci5vcGVuKF90aGlzNi5kcm9wZG93bi5kaXN0YW5jZUZyb21Ub3BXaW5kb3coKSk7DQoNCiAgICAgICAgaWYgKCFwcmV2ZW50SW5wdXRGb2N1cyAmJiBfdGhpczYuX2NhblNlYXJjaCkgew0KICAgICAgICAgIF90aGlzNi5pbnB1dC5mb2N1cygpOw0KICAgICAgICB9DQoNCiAgICAgICAgX3RoaXM2LnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLnNob3dEcm9wZG93biwge30pOw0KICAgICAgfSk7DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2hpZGVEcm9wZG93bicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGhpZGVEcm9wZG93bihwcmV2ZW50SW5wdXRCbHVyKSB7DQogICAgICB2YXIgX3RoaXM3ID0gdGhpczsNCg0KICAgICAgaWYgKCF0aGlzLmRyb3Bkb3duLmlzQWN0aXZlKSB7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgew0KICAgICAgICBfdGhpczcuZHJvcGRvd24uaGlkZSgpOw0KICAgICAgICBfdGhpczcuY29udGFpbmVyT3V0ZXIuY2xvc2UoKTsNCg0KICAgICAgICBpZiAoIXByZXZlbnRJbnB1dEJsdXIgJiYgX3RoaXM3Ll9jYW5TZWFyY2gpIHsNCiAgICAgICAgICBfdGhpczcuaW5wdXQucmVtb3ZlQWN0aXZlRGVzY2VuZGFudCgpOw0KICAgICAgICAgIF90aGlzNy5pbnB1dC5ibHVyKCk7DQogICAgICAgIH0NCg0KICAgICAgICBfdGhpczcucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMuaGlkZURyb3Bkb3duLCB7fSk7DQogICAgICB9KTsNCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAndG9nZ2xlRHJvcGRvd24nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiB0b2dnbGVEcm9wZG93bigpIHsNCiAgICAgIHRoaXMuZHJvcGRvd24uaXNBY3RpdmUgPyB0aGlzLmhpZGVEcm9wZG93bigpIDogdGhpcy5zaG93RHJvcGRvd24oKTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2dldFZhbHVlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoKSB7DQogICAgICB2YXIgdmFsdWVPbmx5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBmYWxzZTsNCg0KICAgICAgdmFyIHZhbHVlcyA9IHRoaXMuX3N0b3JlLmFjdGl2ZUl0ZW1zLnJlZHVjZShmdW5jdGlvbiAoc2VsZWN0ZWRJdGVtcywgaXRlbSkgew0KICAgICAgICB2YXIgaXRlbVZhbHVlID0gdmFsdWVPbmx5ID8gaXRlbS52YWx1ZSA6IGl0ZW07DQogICAgICAgIHNlbGVjdGVkSXRlbXMucHVzaChpdGVtVmFsdWUpOw0KICAgICAgICByZXR1cm4gc2VsZWN0ZWRJdGVtczsNCiAgICAgIH0sIFtdKTsNCg0KICAgICAgcmV0dXJuIHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCA/IHZhbHVlc1swXSA6IHZhbHVlczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdzZXRWYWx1ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFZhbHVlKGFyZ3MpIHsNCiAgICAgIHZhciBfdGhpczggPSB0aGlzOw0KDQogICAgICBpZiAoIXRoaXMuaW5pdGlhbGlzZWQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoYXJncykpLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgIHJldHVybiBfdGhpczguX3NldENob2ljZU9ySXRlbSh2YWx1ZSk7DQogICAgICB9KTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3NldENob2ljZUJ5VmFsdWUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDaG9pY2VCeVZhbHVlKHZhbHVlKSB7DQogICAgICB2YXIgX3RoaXM5ID0gdGhpczsNCg0KICAgICAgaWYgKCF0aGlzLmluaXRpYWxpc2VkIHx8IHRoaXMuX2lzVGV4dEVsZW1lbnQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIC8vIElmIG9ubHkgb25lIHZhbHVlIGhhcyBiZWVuIHBhc3NlZCwgY29udmVydCB0byBhcnJheQ0KICAgICAgdmFyIGNob2ljZVZhbHVlID0gKDAsIF91dGlscy5pc1R5cGUpKCdBcnJheScsIHZhbHVlKSA/IHZhbHVlIDogW3ZhbHVlXTsNCg0KICAgICAgLy8gTG9vcCB0aHJvdWdoIGVhY2ggdmFsdWUgYW5kDQogICAgICBjaG9pY2VWYWx1ZS5mb3JFYWNoKGZ1bmN0aW9uICh2YWwpIHsNCiAgICAgICAgcmV0dXJuIF90aGlzOS5fZmluZEFuZFNlbGVjdENob2ljZUJ5VmFsdWUodmFsKTsNCiAgICAgIH0pOw0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdzZXRDaG9pY2VzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q2hvaWNlcygpIHsNCiAgICAgIHZhciBjaG9pY2VzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTsNCiAgICAgIHZhciB2YWx1ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogJyc7DQoNCiAgICAgIHZhciBfdGhpczEwID0gdGhpczsNCg0KICAgICAgdmFyIGxhYmVsID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAnJzsNCiAgICAgIHZhciByZXBsYWNlQ2hvaWNlcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogZmFsc2U7DQoNCiAgICAgIGlmICghdGhpcy5faXNTZWxlY3RFbGVtZW50IHx8ICFjaG9pY2VzLmxlbmd0aCB8fCAhdmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIC8vIENsZWFyIGNob2ljZXMgaWYgbmVlZGVkDQogICAgICBpZiAocmVwbGFjZUNob2ljZXMpIHsNCiAgICAgICAgdGhpcy5fY2xlYXJDaG9pY2VzKCk7DQogICAgICB9DQoNCiAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIucmVtb3ZlTG9hZGluZ1N0YXRlKCk7DQogICAgICB2YXIgYWRkR3JvdXBzQW5kQ2hvaWNlcyA9IGZ1bmN0aW9uIGFkZEdyb3Vwc0FuZENob2ljZXMoZ3JvdXBPckNob2ljZSkgew0KICAgICAgICBpZiAoZ3JvdXBPckNob2ljZS5jaG9pY2VzKSB7DQogICAgICAgICAgX3RoaXMxMC5fYWRkR3JvdXAoew0KICAgICAgICAgICAgZ3JvdXA6IGdyb3VwT3JDaG9pY2UsDQogICAgICAgICAgICBpZDogZ3JvdXBPckNob2ljZS5pZCB8fCBudWxsLA0KICAgICAgICAgICAgdmFsdWVLZXk6IHZhbHVlLA0KICAgICAgICAgICAgbGFiZWxLZXk6IGxhYmVsDQogICAgICAgICAgfSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgX3RoaXMxMC5fYWRkQ2hvaWNlKHsNCiAgICAgICAgICAgIHZhbHVlOiBncm91cE9yQ2hvaWNlW3ZhbHVlXSwNCiAgICAgICAgICAgIGxhYmVsOiBncm91cE9yQ2hvaWNlW2xhYmVsXSwNCiAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IGdyb3VwT3JDaG9pY2Uuc2VsZWN0ZWQsDQogICAgICAgICAgICBpc0Rpc2FibGVkOiBncm91cE9yQ2hvaWNlLmRpc2FibGVkLA0KICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllczogZ3JvdXBPckNob2ljZS5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGdyb3VwT3JDaG9pY2UucGxhY2Vob2xkZXINCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfTsNCg0KICAgICAgY2hvaWNlcy5mb3JFYWNoKGFkZEdyb3Vwc0FuZENob2ljZXMpOw0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdjbGVhclN0b3JlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXJTdG9yZSgpIHsNCiAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfbWlzYy5jbGVhckFsbCkoKSk7DQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdjbGVhcklucHV0JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXJJbnB1dCgpIHsNCiAgICAgIHZhciBzaG91bGRTZXRJbnB1dFdpZHRoID0gIXRoaXMuX2lzU2VsZWN0T25lRWxlbWVudDsNCiAgICAgIHRoaXMuaW5wdXQuY2xlYXIoc2hvdWxkU2V0SW5wdXRXaWR0aCk7DQoNCiAgICAgIGlmICghdGhpcy5faXNUZXh0RWxlbWVudCAmJiB0aGlzLl9jYW5TZWFyY2gpIHsNCiAgICAgICAgdGhpcy5faXNTZWFyY2hpbmcgPSBmYWxzZTsNCiAgICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9jaG9pY2VzLmFjdGl2YXRlQ2hvaWNlcykodHJ1ZSkpOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdhamF4JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gYWpheChmbikgew0KICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOw0KDQogICAgICBpZiAoIXRoaXMuaW5pdGlhbGlzZWQgfHwgIXRoaXMuX2lzU2VsZWN0RWxlbWVudCB8fCAhZm4pIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICB9DQoNCiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiBfdGhpczExLl9oYW5kbGVMb2FkaW5nU3RhdGUodHJ1ZSk7DQogICAgICB9KTsNCiAgICAgIGZuKHRoaXMuX2FqYXhDYWxsYmFjaygpKTsNCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KDQogICAgLyogPT09PT0gIEVuZCBvZiBQdWJsaWMgZnVuY3Rpb25zICA9PT09PT0gKi8NCg0KICAgIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAgID0gICAgICAgICAgICAgICAgUHJpdmF0ZSBmdW5jdGlvbnMgICAgICAgICAgICA9DQogICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovDQoNCiAgfSwgew0KICAgIGtleTogJ19yZW5kZXInLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVuZGVyKCkgew0KICAgICAgdGhpcy5fY3VycmVudFN0YXRlID0gdGhpcy5fc3RvcmUuc3RhdGU7DQoNCiAgICAgIHZhciBzdGF0ZUNoYW5nZWQgPSB0aGlzLl9jdXJyZW50U3RhdGUuY2hvaWNlcyAhPT0gdGhpcy5fcHJldlN0YXRlLmNob2ljZXMgfHwgdGhpcy5fY3VycmVudFN0YXRlLmdyb3VwcyAhPT0gdGhpcy5fcHJldlN0YXRlLmdyb3VwcyB8fCB0aGlzLl9jdXJyZW50U3RhdGUuaXRlbXMgIT09IHRoaXMuX3ByZXZTdGF0ZS5pdGVtczsNCiAgICAgIHZhciBzaG91bGRSZW5kZXJDaG9pY2VzID0gdGhpcy5faXNTZWxlY3RFbGVtZW50Ow0KICAgICAgdmFyIHNob3VsZFJlbmRlckl0ZW1zID0gdGhpcy5fY3VycmVudFN0YXRlLml0ZW1zICE9PSB0aGlzLl9wcmV2U3RhdGUuaXRlbXM7DQoNCiAgICAgIGlmICghc3RhdGVDaGFuZ2VkKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgaWYgKHNob3VsZFJlbmRlckNob2ljZXMpIHsNCiAgICAgICAgdGhpcy5fcmVuZGVyQ2hvaWNlcygpOw0KICAgICAgfQ0KDQogICAgICBpZiAoc2hvdWxkUmVuZGVySXRlbXMpIHsNCiAgICAgICAgdGhpcy5fcmVuZGVySXRlbXMoKTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5fcHJldlN0YXRlID0gdGhpcy5fY3VycmVudFN0YXRlOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19yZW5kZXJDaG9pY2VzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlckNob2ljZXMoKSB7DQogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7DQoNCiAgICAgIHZhciBfc3RvcmUgPSB0aGlzLl9zdG9yZSwNCiAgICAgICAgICBhY3RpdmVHcm91cHMgPSBfc3RvcmUuYWN0aXZlR3JvdXBzLA0KICAgICAgICAgIGFjdGl2ZUNob2ljZXMgPSBfc3RvcmUuYWN0aXZlQ2hvaWNlczsNCg0KICAgICAgdmFyIGNob2ljZUxpc3RGcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCg0KICAgICAgdGhpcy5jaG9pY2VMaXN0LmNsZWFyKCk7DQoNCiAgICAgIGlmICh0aGlzLmNvbmZpZy5yZXNldFNjcm9sbFBvc2l0aW9uKSB7DQogICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7DQogICAgICAgICAgcmV0dXJuIF90aGlzMTIuY2hvaWNlTGlzdC5zY3JvbGxUb1RvcCgpOw0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgLy8gSWYgd2UgaGF2ZSBncm91cGVkIG9wdGlvbnMNCiAgICAgIGlmIChhY3RpdmVHcm91cHMubGVuZ3RoID49IDEgJiYgIXRoaXMuX2lzU2VhcmNoaW5nKSB7DQogICAgICAgIC8vIElmIHdlIGhhdmUgYSBwbGFjZWhvbGRlciBjaG9pY2UgYWxvbmcgd2l0aCBncm91cHMNCiAgICAgICAgdmFyIGFjdGl2ZVBsYWNlaG9sZGVycyA9IGFjdGl2ZUNob2ljZXMuZmlsdGVyKGZ1bmN0aW9uIChhY3RpdmVDaG9pY2UpIHsNCiAgICAgICAgICByZXR1cm4gYWN0aXZlQ2hvaWNlLnBsYWNlaG9sZGVyID09PSB0cnVlICYmIGFjdGl2ZUNob2ljZS5ncm91cElkID09PSAtMTsNCiAgICAgICAgfSk7DQogICAgICAgIGlmIChhY3RpdmVQbGFjZWhvbGRlcnMubGVuZ3RoID49IDEpIHsNCiAgICAgICAgICBjaG9pY2VMaXN0RnJhZ21lbnQgPSB0aGlzLl9jcmVhdGVDaG9pY2VzRnJhZ21lbnQoYWN0aXZlUGxhY2Vob2xkZXJzLCBjaG9pY2VMaXN0RnJhZ21lbnQpOw0KICAgICAgICB9DQogICAgICAgIGNob2ljZUxpc3RGcmFnbWVudCA9IHRoaXMuX2NyZWF0ZUdyb3Vwc0ZyYWdtZW50KGFjdGl2ZUdyb3VwcywgYWN0aXZlQ2hvaWNlcywgY2hvaWNlTGlzdEZyYWdtZW50KTsNCiAgICAgIH0gZWxzZSBpZiAoYWN0aXZlQ2hvaWNlcy5sZW5ndGggPj0gMSkgew0KICAgICAgICBjaG9pY2VMaXN0RnJhZ21lbnQgPSB0aGlzLl9jcmVhdGVDaG9pY2VzRnJhZ21lbnQoYWN0aXZlQ2hvaWNlcywgY2hvaWNlTGlzdEZyYWdtZW50KTsNCiAgICAgIH0NCg0KICAgICAgLy8gSWYgd2UgaGF2ZSBjaG9pY2VzIHRvIHNob3cNCiAgICAgIGlmIChjaG9pY2VMaXN0RnJhZ21lbnQuY2hpbGROb2RlcyAmJiBjaG9pY2VMaXN0RnJhZ21lbnQuY2hpbGROb2Rlcy5sZW5ndGggPiAwKSB7DQogICAgICAgIHZhciBhY3RpdmVJdGVtcyA9IHRoaXMuX3N0b3JlLmFjdGl2ZUl0ZW1zOw0KICAgICAgICB2YXIgY2FuQWRkSXRlbSA9IHRoaXMuX2NhbkFkZEl0ZW0oYWN0aXZlSXRlbXMsIHRoaXMuaW5wdXQudmFsdWUpOw0KDQogICAgICAgIC8vIC4uLmFuZCB3ZSBjYW4gc2VsZWN0IHRoZW0NCiAgICAgICAgaWYgKGNhbkFkZEl0ZW0ucmVzcG9uc2UpIHsNCiAgICAgICAgICAvLyAuLi5hcHBlbmQgdGhlbSBhbmQgaGlnaGxpZ2h0IHRoZSBmaXJzdCBjaG9pY2UNCiAgICAgICAgICB0aGlzLmNob2ljZUxpc3QuYXBwZW5kKGNob2ljZUxpc3RGcmFnbWVudCk7DQogICAgICAgICAgdGhpcy5faGlnaGxpZ2h0Q2hvaWNlKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgLy8gLi4ub3RoZXJ3aXNlIHNob3cgYSBub3RpY2UNCiAgICAgICAgICB0aGlzLmNob2ljZUxpc3QuYXBwZW5kKHRoaXMuX2dldFRlbXBsYXRlKCdub3RpY2UnLCBjYW5BZGRJdGVtLm5vdGljZSkpOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICAvLyBPdGhlcndpc2Ugc2hvdyBhIG5vdGljZQ0KICAgICAgICB2YXIgZHJvcGRvd25JdGVtID0gdm9pZCAwOw0KICAgICAgICB2YXIgbm90aWNlID0gdm9pZCAwOw0KDQogICAgICAgIGlmICh0aGlzLl9pc1NlYXJjaGluZykgew0KICAgICAgICAgIG5vdGljZSA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnRnVuY3Rpb24nLCB0aGlzLmNvbmZpZy5ub1Jlc3VsdHNUZXh0KSA/IHRoaXMuY29uZmlnLm5vUmVzdWx0c1RleHQoKSA6IHRoaXMuY29uZmlnLm5vUmVzdWx0c1RleHQ7DQoNCiAgICAgICAgICBkcm9wZG93bkl0ZW0gPSB0aGlzLl9nZXRUZW1wbGF0ZSgnbm90aWNlJywgbm90aWNlLCAnbm8tcmVzdWx0cycpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG5vdGljZSA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnRnVuY3Rpb24nLCB0aGlzLmNvbmZpZy5ub0Nob2ljZXNUZXh0KSA/IHRoaXMuY29uZmlnLm5vQ2hvaWNlc1RleHQoKSA6IHRoaXMuY29uZmlnLm5vQ2hvaWNlc1RleHQ7DQoNCiAgICAgICAgICBkcm9wZG93bkl0ZW0gPSB0aGlzLl9nZXRUZW1wbGF0ZSgnbm90aWNlJywgbm90aWNlLCAnbm8tY2hvaWNlcycpOw0KICAgICAgICB9DQoNCiAgICAgICAgdGhpcy5jaG9pY2VMaXN0LmFwcGVuZChkcm9wZG93bkl0ZW0pOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19yZW5kZXJJdGVtcycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW5kZXJJdGVtcygpIHsNCiAgICAgIHZhciBhY3RpdmVJdGVtcyA9IHRoaXMuX3N0b3JlLmFjdGl2ZUl0ZW1zIHx8IFtdOw0KICAgICAgdGhpcy5pdGVtTGlzdC5jbGVhcigpOw0KDQogICAgICAvLyBDcmVhdGUgYSBmcmFnbWVudCB0byBzdG9yZSBvdXIgbGlzdCBpdGVtcw0KICAgICAgLy8gKHNvIHdlIGRvbid0IGhhdmUgdG8gdXBkYXRlIHRoZSBET00gZm9yIGVhY2ggaXRlbSkNCiAgICAgIHZhciBpdGVtTGlzdEZyYWdtZW50ID0gdGhpcy5fY3JlYXRlSXRlbXNGcmFnbWVudChhY3RpdmVJdGVtcyk7DQoNCiAgICAgIC8vIElmIHdlIGhhdmUgaXRlbXMgdG8gYWRkLCBhcHBlbmQgdGhlbQ0KICAgICAgaWYgKGl0ZW1MaXN0RnJhZ21lbnQuY2hpbGROb2Rlcykgew0KICAgICAgICB0aGlzLml0ZW1MaXN0LmFwcGVuZChpdGVtTGlzdEZyYWdtZW50KTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfY3JlYXRlR3JvdXBzRnJhZ21lbnQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlR3JvdXBzRnJhZ21lbnQoZ3JvdXBzLCBjaG9pY2VzLCBmcmFnbWVudCkgew0KICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOw0KDQogICAgICB2YXIgZ3JvdXBGcmFnbWVudCA9IGZyYWdtZW50IHx8IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCiAgICAgIHZhciBnZXRHcm91cENob2ljZXMgPSBmdW5jdGlvbiBnZXRHcm91cENob2ljZXMoZ3JvdXApIHsNCiAgICAgICAgcmV0dXJuIGNob2ljZXMuZmlsdGVyKGZ1bmN0aW9uIChjaG9pY2UpIHsNCiAgICAgICAgICBpZiAoX3RoaXMxMy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgICAgICByZXR1cm4gY2hvaWNlLmdyb3VwSWQgPT09IGdyb3VwLmlkOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gY2hvaWNlLmdyb3VwSWQgPT09IGdyb3VwLmlkICYmIChfdGhpczEzLmNvbmZpZy5yZW5kZXJTZWxlY3RlZENob2ljZXMgPT09ICdhbHdheXMnIHx8ICFjaG9pY2Uuc2VsZWN0ZWQpOw0KICAgICAgICB9KTsNCiAgICAgIH07DQoNCiAgICAgIC8vIElmIHNvcnRpbmcgaXMgZW5hYmxlZCwgZmlsdGVyIGdyb3Vwcw0KICAgICAgaWYgKHRoaXMuY29uZmlnLnNob3VsZFNvcnQpIHsNCiAgICAgICAgZ3JvdXBzLnNvcnQodGhpcy5jb25maWcuc29ydEZuKTsNCiAgICAgIH0NCg0KICAgICAgZ3JvdXBzLmZvckVhY2goZnVuY3Rpb24gKGdyb3VwKSB7DQogICAgICAgIHZhciBncm91cENob2ljZXMgPSBnZXRHcm91cENob2ljZXMoZ3JvdXApOw0KICAgICAgICBpZiAoZ3JvdXBDaG9pY2VzLmxlbmd0aCA+PSAxKSB7DQogICAgICAgICAgdmFyIGRyb3Bkb3duR3JvdXAgPSBfdGhpczEzLl9nZXRUZW1wbGF0ZSgnY2hvaWNlR3JvdXAnLCBncm91cCk7DQogICAgICAgICAgZ3JvdXBGcmFnbWVudC5hcHBlbmRDaGlsZChkcm9wZG93bkdyb3VwKTsNCiAgICAgICAgICBfdGhpczEzLl9jcmVhdGVDaG9pY2VzRnJhZ21lbnQoZ3JvdXBDaG9pY2VzLCBncm91cEZyYWdtZW50LCB0cnVlKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQoNCiAgICAgIHJldHVybiBncm91cEZyYWdtZW50Ow0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19jcmVhdGVDaG9pY2VzRnJhZ21lbnQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlQ2hvaWNlc0ZyYWdtZW50KGNob2ljZXMsIGZyYWdtZW50KSB7DQogICAgICB2YXIgX3RoaXMxNCA9IHRoaXM7DQoNCiAgICAgIHZhciB3aXRoaW5Hcm91cCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogZmFsc2U7DQoNCiAgICAgIC8vIENyZWF0ZSBhIGZyYWdtZW50IHRvIHN0b3JlIG91ciBsaXN0IGl0ZW1zIChzbyB3ZSBkb24ndCBoYXZlIHRvIHVwZGF0ZSB0aGUgRE9NIGZvciBlYWNoIGl0ZW0pDQogICAgICB2YXIgY2hvaWNlc0ZyYWdtZW50ID0gZnJhZ21lbnQgfHwgZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KICAgICAgdmFyIF9jb25maWcgPSB0aGlzLmNvbmZpZywNCiAgICAgICAgICByZW5kZXJTZWxlY3RlZENob2ljZXMgPSBfY29uZmlnLnJlbmRlclNlbGVjdGVkQ2hvaWNlcywNCiAgICAgICAgICBzZWFyY2hSZXN1bHRMaW1pdCA9IF9jb25maWcuc2VhcmNoUmVzdWx0TGltaXQsDQogICAgICAgICAgcmVuZGVyQ2hvaWNlTGltaXQgPSBfY29uZmlnLnJlbmRlckNob2ljZUxpbWl0Ow0KDQogICAgICB2YXIgZmlsdGVyID0gdGhpcy5faXNTZWFyY2hpbmcgPyBfdXRpbHMuc29ydEJ5U2NvcmUgOiB0aGlzLmNvbmZpZy5zb3J0Rm47DQogICAgICB2YXIgYXBwZW5kQ2hvaWNlID0gZnVuY3Rpb24gYXBwZW5kQ2hvaWNlKGNob2ljZSkgew0KICAgICAgICB2YXIgc2hvdWxkUmVuZGVyID0gcmVuZGVyU2VsZWN0ZWRDaG9pY2VzID09PSAnYXV0bycgPyBfdGhpczE0Ll9pc1NlbGVjdE9uZUVsZW1lbnQgfHwgIWNob2ljZS5zZWxlY3RlZCA6IHRydWU7DQogICAgICAgIGlmIChzaG91bGRSZW5kZXIpIHsNCiAgICAgICAgICB2YXIgZHJvcGRvd25JdGVtID0gX3RoaXMxNC5fZ2V0VGVtcGxhdGUoJ2Nob2ljZScsIGNob2ljZSwgX3RoaXMxNC5jb25maWcuaXRlbVNlbGVjdFRleHQpOw0KICAgICAgICAgIGNob2ljZXNGcmFnbWVudC5hcHBlbmRDaGlsZChkcm9wZG93bkl0ZW0pOw0KICAgICAgICB9DQogICAgICB9Ow0KDQogICAgICB2YXIgcmVuZGVyZXJhYmxlQ2hvaWNlcyA9IGNob2ljZXM7DQoNCiAgICAgIGlmIChyZW5kZXJTZWxlY3RlZENob2ljZXMgPT09ICdhdXRvJyAmJiAhdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIHJlbmRlcmVyYWJsZUNob2ljZXMgPSBjaG9pY2VzLmZpbHRlcihmdW5jdGlvbiAoY2hvaWNlKSB7DQogICAgICAgICAgcmV0dXJuICFjaG9pY2Uuc2VsZWN0ZWQ7DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICAvLyBTcGxpdCBhcnJheSBpbnRvIHBsYWNlaG9sZGVycyBhbmQgIm5vcm1hbCIgY2hvaWNlcw0KDQogICAgICB2YXIgX3JlbmRlcmVyYWJsZUNob2ljZXMkID0gcmVuZGVyZXJhYmxlQ2hvaWNlcy5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgY2hvaWNlKSB7DQogICAgICAgIGlmIChjaG9pY2UucGxhY2Vob2xkZXIpIHsNCiAgICAgICAgICBhY2MucGxhY2Vob2xkZXJDaG9pY2VzLnB1c2goY2hvaWNlKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBhY2Mubm9ybWFsQ2hvaWNlcy5wdXNoKGNob2ljZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGFjYzsNCiAgICAgIH0sIHsgcGxhY2Vob2xkZXJDaG9pY2VzOiBbXSwgbm9ybWFsQ2hvaWNlczogW10gfSksDQogICAgICAgICAgcGxhY2Vob2xkZXJDaG9pY2VzID0gX3JlbmRlcmVyYWJsZUNob2ljZXMkLnBsYWNlaG9sZGVyQ2hvaWNlcywNCiAgICAgICAgICBub3JtYWxDaG9pY2VzID0gX3JlbmRlcmVyYWJsZUNob2ljZXMkLm5vcm1hbENob2ljZXM7DQoNCiAgICAgIC8vIElmIHNvcnRpbmcgaXMgZW5hYmxlZCBvciB0aGUgdXNlciBpcyBzZWFyY2hpbmcsIGZpbHRlciBjaG9pY2VzDQoNCg0KICAgICAgaWYgKHRoaXMuY29uZmlnLnNob3VsZFNvcnQgfHwgdGhpcy5faXNTZWFyY2hpbmcpIHsNCiAgICAgICAgbm9ybWFsQ2hvaWNlcy5zb3J0KGZpbHRlcik7DQogICAgICB9DQoNCiAgICAgIHZhciBjaG9pY2VMaW1pdCA9IHJlbmRlcmVyYWJsZUNob2ljZXMubGVuZ3RoOw0KDQogICAgICAvLyBQcmVwZW5kIHBsYWNlaG9sZWRlcg0KICAgICAgdmFyIHNvcnRlZENob2ljZXMgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHBsYWNlaG9sZGVyQ2hvaWNlcyksIF90b0NvbnN1bWFibGVBcnJheShub3JtYWxDaG9pY2VzKSk7DQoNCiAgICAgIGlmICh0aGlzLl9pc1NlYXJjaGluZykgew0KICAgICAgICBjaG9pY2VMaW1pdCA9IHNlYXJjaFJlc3VsdExpbWl0Ow0KICAgICAgfSBlbHNlIGlmIChyZW5kZXJDaG9pY2VMaW1pdCA+IDAgJiYgIXdpdGhpbkdyb3VwKSB7DQogICAgICAgIGNob2ljZUxpbWl0ID0gcmVuZGVyQ2hvaWNlTGltaXQ7DQogICAgICB9DQoNCiAgICAgIC8vIEFkZCBlYWNoIGNob2ljZSB0byBkcm9wZG93biB3aXRoaW4gcmFuZ2UNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hvaWNlTGltaXQ7IGkgKz0gMSkgew0KICAgICAgICBpZiAoc29ydGVkQ2hvaWNlc1tpXSkgew0KICAgICAgICAgIGFwcGVuZENob2ljZShzb3J0ZWRDaG9pY2VzW2ldKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICByZXR1cm4gY2hvaWNlc0ZyYWdtZW50Ow0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19jcmVhdGVJdGVtc0ZyYWdtZW50JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZUl0ZW1zRnJhZ21lbnQoaXRlbXMpIHsNCiAgICAgIHZhciBfdGhpczE1ID0gdGhpczsNCg0KICAgICAgdmFyIGZyYWdtZW50ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBudWxsOw0KDQogICAgICAvLyBDcmVhdGUgZnJhZ21lbnQgdG8gYWRkIGVsZW1lbnRzIHRvDQogICAgICB2YXIgX2NvbmZpZzIgPSB0aGlzLmNvbmZpZywNCiAgICAgICAgICBzaG91bGRTb3J0SXRlbXMgPSBfY29uZmlnMi5zaG91bGRTb3J0SXRlbXMsDQogICAgICAgICAgc29ydEZuID0gX2NvbmZpZzIuc29ydEZuLA0KICAgICAgICAgIHJlbW92ZUl0ZW1CdXR0b24gPSBfY29uZmlnMi5yZW1vdmVJdGVtQnV0dG9uOw0KDQogICAgICB2YXIgaXRlbUxpc3RGcmFnbWVudCA9IGZyYWdtZW50IHx8IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCg0KICAgICAgLy8gSWYgc29ydGluZyBpcyBlbmFibGVkLCBmaWx0ZXIgaXRlbXMNCiAgICAgIGlmIChzaG91bGRTb3J0SXRlbXMgJiYgIXRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICBpdGVtcy5zb3J0KHNvcnRGbik7DQogICAgICB9DQoNCiAgICAgIGlmICh0aGlzLl9pc1RleHRFbGVtZW50KSB7DQogICAgICAgIC8vIFVwZGF0ZSB0aGUgdmFsdWUgb2YgdGhlIGhpZGRlbiBpbnB1dA0KICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudmFsdWUgPSBpdGVtczsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIFVwZGF0ZSB0aGUgb3B0aW9ucyBvZiB0aGUgaGlkZGVuIGlucHV0DQogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC5vcHRpb25zID0gaXRlbXM7DQogICAgICB9DQoNCiAgICAgIHZhciBhZGRJdGVtVG9GcmFnbWVudCA9IGZ1bmN0aW9uIGFkZEl0ZW1Ub0ZyYWdtZW50KGl0ZW0pIHsNCiAgICAgICAgLy8gQ3JlYXRlIG5ldyBsaXN0IGVsZW1lbnQNCiAgICAgICAgdmFyIGxpc3RJdGVtID0gX3RoaXMxNS5fZ2V0VGVtcGxhdGUoJ2l0ZW0nLCBpdGVtLCByZW1vdmVJdGVtQnV0dG9uKTsNCiAgICAgICAgLy8gQXBwZW5kIGl0IHRvIGxpc3QNCiAgICAgICAgaXRlbUxpc3RGcmFnbWVudC5hcHBlbmRDaGlsZChsaXN0SXRlbSk7DQogICAgICB9Ow0KDQogICAgICAvLyBBZGQgZWFjaCBsaXN0IGl0ZW0gdG8gbGlzdA0KICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICByZXR1cm4gYWRkSXRlbVRvRnJhZ21lbnQoaXRlbSk7DQogICAgICB9KTsNCg0KICAgICAgcmV0dXJuIGl0ZW1MaXN0RnJhZ21lbnQ7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX3RyaWdnZXJDaGFuZ2UnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfdHJpZ2dlckNoYW5nZSh2YWx1ZSkgew0KICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLmNoYW5nZSwgew0KICAgICAgICB2YWx1ZTogdmFsdWUNCiAgICAgIH0pOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19zZWxlY3RQbGFjZWhvbGRlckNob2ljZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9zZWxlY3RQbGFjZWhvbGRlckNob2ljZSgpIHsNCiAgICAgIHZhciBwbGFjZWhvbGRlckNob2ljZSA9IHRoaXMuX3N0b3JlLnBsYWNlaG9sZGVyQ2hvaWNlOw0KDQogICAgICBpZiAocGxhY2Vob2xkZXJDaG9pY2UpIHsNCiAgICAgICAgdGhpcy5fYWRkSXRlbSh7DQogICAgICAgICAgdmFsdWU6IHBsYWNlaG9sZGVyQ2hvaWNlLnZhbHVlLA0KICAgICAgICAgIGxhYmVsOiBwbGFjZWhvbGRlckNob2ljZS5sYWJlbCwNCiAgICAgICAgICBjaG9pY2VJZDogcGxhY2Vob2xkZXJDaG9pY2UuaWQsDQogICAgICAgICAgZ3JvdXBJZDogcGxhY2Vob2xkZXJDaG9pY2UuZ3JvdXBJZCwNCiAgICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXJDaG9pY2UucGxhY2Vob2xkZXINCiAgICAgICAgfSk7DQoNCiAgICAgICAgdGhpcy5fdHJpZ2dlckNoYW5nZShwbGFjZWhvbGRlckNob2ljZS52YWx1ZSk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2hhbmRsZUJ1dHRvbkFjdGlvbicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVCdXR0b25BY3Rpb24oYWN0aXZlSXRlbXMsIGVsZW1lbnQpIHsNCiAgICAgIGlmICghYWN0aXZlSXRlbXMgfHwgIWVsZW1lbnQgfHwgIXRoaXMuY29uZmlnLnJlbW92ZUl0ZW1zIHx8ICF0aGlzLmNvbmZpZy5yZW1vdmVJdGVtQnV0dG9uKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdmFyIGl0ZW1JZCA9IGVsZW1lbnQucGFyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTsNCiAgICAgIHZhciBpdGVtVG9SZW1vdmUgPSBhY3RpdmVJdGVtcy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgIHJldHVybiBpdGVtLmlkID09PSBwYXJzZUludChpdGVtSWQsIDEwKTsNCiAgICAgIH0pOw0KDQogICAgICAvLyBSZW1vdmUgaXRlbSBhc3NvY2lhdGVkIHdpdGggYnV0dG9uDQogICAgICB0aGlzLl9yZW1vdmVJdGVtKGl0ZW1Ub1JlbW92ZSk7DQogICAgICB0aGlzLl90cmlnZ2VyQ2hhbmdlKGl0ZW1Ub1JlbW92ZS52YWx1ZSk7DQoNCiAgICAgIGlmICh0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgdGhpcy5fc2VsZWN0UGxhY2Vob2xkZXJDaG9pY2UoKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfaGFuZGxlSXRlbUFjdGlvbicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVJdGVtQWN0aW9uKGFjdGl2ZUl0ZW1zLCBlbGVtZW50KSB7DQogICAgICB2YXIgX3RoaXMxNiA9IHRoaXM7DQoNCiAgICAgIHZhciBoYXNTaGlmdEtleSA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogZmFsc2U7DQoNCiAgICAgIGlmICghYWN0aXZlSXRlbXMgfHwgIWVsZW1lbnQgfHwgIXRoaXMuY29uZmlnLnJlbW92ZUl0ZW1zIHx8IHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHZhciBwYXNzZWRJZCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7DQoNCiAgICAgIC8vIFdlIG9ubHkgd2FudCB0byBzZWxlY3Qgb25lIGl0ZW0gd2l0aCBhIGNsaWNrDQogICAgICAvLyBzbyB3ZSBkZXNlbGVjdCBhbnkgaXRlbXMgdGhhdCBhcmVuJ3QgdGhlIHRhcmdldA0KICAgICAgLy8gdW5sZXNzIHNoaWZ0IGlzIGJlaW5nIHByZXNzZWQNCiAgICAgIGFjdGl2ZUl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgaWYgKGl0ZW0uaWQgPT09IHBhcnNlSW50KHBhc3NlZElkLCAxMCkgJiYgIWl0ZW0uaGlnaGxpZ2h0ZWQpIHsNCiAgICAgICAgICBfdGhpczE2LmhpZ2hsaWdodEl0ZW0oaXRlbSk7DQogICAgICAgIH0gZWxzZSBpZiAoIWhhc1NoaWZ0S2V5ICYmIGl0ZW0uaGlnaGxpZ2h0ZWQpIHsNCiAgICAgICAgICBfdGhpczE2LnVuaGlnaGxpZ2h0SXRlbShpdGVtKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQoNCiAgICAgIC8vIEZvY3VzIGlucHV0IGFzIHdpdGhvdXQgZm9jdXMsIGEgdXNlciBjYW5ub3QgZG8gYW55dGhpbmcgd2l0aCBhDQogICAgICAvLyBoaWdobGlnaHRlZCBpdGVtDQogICAgICB0aGlzLmlucHV0LmZvY3VzKCk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2hhbmRsZUNob2ljZUFjdGlvbicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVDaG9pY2VBY3Rpb24oYWN0aXZlSXRlbXMsIGVsZW1lbnQpIHsNCiAgICAgIGlmICghYWN0aXZlSXRlbXMgfHwgIWVsZW1lbnQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICAvLyBJZiB3ZSBhcmUgY2xpY2tpbmcgb24gYW4gb3B0aW9uDQogICAgICB2YXIgaWQgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpOw0KICAgICAgdmFyIGNob2ljZSA9IHRoaXMuX3N0b3JlLmdldENob2ljZUJ5SWQoaWQpOw0KICAgICAgdmFyIHBhc3NlZEtleUNvZGUgPSBhY3RpdmVJdGVtc1swXSAmJiBhY3RpdmVJdGVtc1swXS5rZXlDb2RlID8gYWN0aXZlSXRlbXNbMF0ua2V5Q29kZSA6IG51bGw7DQogICAgICB2YXIgaGFzQWN0aXZlRHJvcGRvd24gPSB0aGlzLmRyb3Bkb3duLmlzQWN0aXZlOw0KDQogICAgICAvLyBVcGRhdGUgY2hvaWNlIGtleUNvZGUNCiAgICAgIGNob2ljZS5rZXlDb2RlID0gcGFzc2VkS2V5Q29kZTsNCg0KICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5jaG9pY2UsIHsNCiAgICAgICAgY2hvaWNlOiBjaG9pY2UNCiAgICAgIH0pOw0KDQogICAgICBpZiAoY2hvaWNlICYmICFjaG9pY2Uuc2VsZWN0ZWQgJiYgIWNob2ljZS5kaXNhYmxlZCkgew0KICAgICAgICB2YXIgY2FuQWRkSXRlbSA9IHRoaXMuX2NhbkFkZEl0ZW0oYWN0aXZlSXRlbXMsIGNob2ljZS52YWx1ZSk7DQoNCiAgICAgICAgaWYgKGNhbkFkZEl0ZW0ucmVzcG9uc2UpIHsNCiAgICAgICAgICB0aGlzLl9hZGRJdGVtKHsNCiAgICAgICAgICAgIHZhbHVlOiBjaG9pY2UudmFsdWUsDQogICAgICAgICAgICBsYWJlbDogY2hvaWNlLmxhYmVsLA0KICAgICAgICAgICAgY2hvaWNlSWQ6IGNob2ljZS5pZCwNCiAgICAgICAgICAgIGdyb3VwSWQ6IGNob2ljZS5ncm91cElkLA0KICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllczogY2hvaWNlLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgICBwbGFjZWhvbGRlcjogY2hvaWNlLnBsYWNlaG9sZGVyLA0KICAgICAgICAgICAga2V5Q29kZTogY2hvaWNlLmtleUNvZGUNCiAgICAgICAgICB9KTsNCg0KICAgICAgICAgIHRoaXMuX3RyaWdnZXJDaGFuZ2UoY2hvaWNlLnZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICB0aGlzLmNsZWFySW5wdXQoKTsNCg0KICAgICAgLy8gV2Ugd29udCB0byBjbG9zZSB0aGUgZHJvcGRvd24gaWYgd2UgYXJlIGRlYWxpbmcgd2l0aCBhIHNpbmdsZSBzZWxlY3QgYm94DQogICAgICBpZiAoaGFzQWN0aXZlRHJvcGRvd24gJiYgdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIHRoaXMuaGlkZURyb3Bkb3duKHRydWUpOw0KICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLmZvY3VzKCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2hhbmRsZUJhY2tzcGFjZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVCYWNrc3BhY2UoYWN0aXZlSXRlbXMpIHsNCiAgICAgIGlmICghdGhpcy5jb25maWcucmVtb3ZlSXRlbXMgfHwgIWFjdGl2ZUl0ZW1zKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdmFyIGxhc3RJdGVtID0gYWN0aXZlSXRlbXNbYWN0aXZlSXRlbXMubGVuZ3RoIC0gMV07DQogICAgICB2YXIgaGFzSGlnaGxpZ2h0ZWRJdGVtcyA9IGFjdGl2ZUl0ZW1zLnNvbWUoZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIGl0ZW0uaGlnaGxpZ2h0ZWQ7DQogICAgICB9KTsNCg0KICAgICAgLy8gSWYgZWRpdGluZyB0aGUgbGFzdCBpdGVtIGlzIGFsbG93ZWQgYW5kIHRoZXJlIGFyZSBub3Qgb3RoZXIgc2VsZWN0ZWQgaXRlbXMsDQogICAgICAvLyB3ZSBjYW4gZWRpdCB0aGUgaXRlbSB2YWx1ZS4gT3RoZXJ3aXNlIGlmIHdlIGNhbiByZW1vdmUgaXRlbXMsIHJlbW92ZSBhbGwgc2VsZWN0ZWQgaXRlbXMNCiAgICAgIGlmICh0aGlzLmNvbmZpZy5lZGl0SXRlbXMgJiYgIWhhc0hpZ2hsaWdodGVkSXRlbXMgJiYgbGFzdEl0ZW0pIHsNCiAgICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9IGxhc3RJdGVtLnZhbHVlOw0KICAgICAgICB0aGlzLmlucHV0LnNldFdpZHRoKCk7DQogICAgICAgIHRoaXMuX3JlbW92ZUl0ZW0obGFzdEl0ZW0pOw0KICAgICAgICB0aGlzLl90cmlnZ2VyQ2hhbmdlKGxhc3RJdGVtLnZhbHVlKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlmICghaGFzSGlnaGxpZ2h0ZWRJdGVtcykgew0KICAgICAgICAgIC8vIEhpZ2hsaWdodCBsYXN0IGl0ZW0gaWYgbm9uZSBhbHJlYWR5IGhpZ2hsaWdodGVkDQogICAgICAgICAgdGhpcy5oaWdobGlnaHRJdGVtKGxhc3RJdGVtLCBmYWxzZSk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5yZW1vdmVIaWdobGlnaHRlZEl0ZW1zKHRydWUpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19oYW5kbGVMb2FkaW5nU3RhdGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlTG9hZGluZ1N0YXRlKCkgew0KICAgICAgdmFyIGlzTG9hZGluZyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogdHJ1ZTsNCg0KICAgICAgdmFyIHBsYWNlaG9sZGVySXRlbSA9IHRoaXMuaXRlbUxpc3QuZ2V0Q2hpbGQoJy4nICsgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5wbGFjZWhvbGRlcik7DQoNCiAgICAgIGlmIChpc0xvYWRpbmcpIHsNCiAgICAgICAgdGhpcy5kaXNhYmxlKCk7DQogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuYWRkTG9hZGluZ1N0YXRlKCk7DQoNCiAgICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICAgIGlmICghcGxhY2Vob2xkZXJJdGVtKSB7DQogICAgICAgICAgICBwbGFjZWhvbGRlckl0ZW0gPSB0aGlzLl9nZXRUZW1wbGF0ZSgncGxhY2Vob2xkZXInLCB0aGlzLmNvbmZpZy5sb2FkaW5nVGV4dCk7DQogICAgICAgICAgICB0aGlzLml0ZW1MaXN0LmFwcGVuZChwbGFjZWhvbGRlckl0ZW0pOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBwbGFjZWhvbGRlckl0ZW0uaW5uZXJIVE1MID0gdGhpcy5jb25maWcubG9hZGluZ1RleHQ7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMuaW5wdXQucGxhY2Vob2xkZXIgPSB0aGlzLmNvbmZpZy5sb2FkaW5nVGV4dDsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5lbmFibGUoKTsNCiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5yZW1vdmVMb2FkaW5nU3RhdGUoKTsNCg0KICAgICAgICBpZiAodGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgICAgcGxhY2Vob2xkZXJJdGVtLmlubmVySFRNTCA9IHRoaXMuX3BsYWNlaG9sZGVyVmFsdWUgfHwgJyc7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy5pbnB1dC5wbGFjZWhvbGRlciA9IHRoaXMuX3BsYWNlaG9sZGVyVmFsdWUgfHwgJyc7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfaGFuZGxlU2VhcmNoJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZVNlYXJjaCh2YWx1ZSkgew0KICAgICAgaWYgKCF2YWx1ZSB8fCAhdGhpcy5pbnB1dC5pc0ZvY3Vzc2VkKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdmFyIGNob2ljZXMgPSB0aGlzLl9zdG9yZS5jaG9pY2VzOw0KICAgICAgdmFyIF9jb25maWczID0gdGhpcy5jb25maWcsDQogICAgICAgICAgc2VhcmNoRmxvb3IgPSBfY29uZmlnMy5zZWFyY2hGbG9vciwNCiAgICAgICAgICBzZWFyY2hDaG9pY2VzID0gX2NvbmZpZzMuc2VhcmNoQ2hvaWNlczsNCg0KICAgICAgdmFyIGhhc1VuYWN0aXZlQ2hvaWNlcyA9IGNob2ljZXMuc29tZShmdW5jdGlvbiAob3B0aW9uKSB7DQogICAgICAgIHJldHVybiAhb3B0aW9uLmFjdGl2ZTsNCiAgICAgIH0pOw0KDQogICAgICAvLyBDaGVjayB0aGF0IHdlIGhhdmUgYSB2YWx1ZSB0byBzZWFyY2ggYW5kIHRoZSBpbnB1dCB3YXMgYW4gYWxwaGFudW1lcmljIGNoYXJhY3Rlcg0KICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLmxlbmd0aCA+PSBzZWFyY2hGbG9vcikgew0KICAgICAgICB2YXIgcmVzdWx0Q291bnQgPSBzZWFyY2hDaG9pY2VzID8gdGhpcy5fc2VhcmNoQ2hvaWNlcyh2YWx1ZSkgOiAwOw0KICAgICAgICAvLyBUcmlnZ2VyIHNlYXJjaCBldmVudA0KICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLnNlYXJjaCwgew0KICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICByZXN1bHRDb3VudDogcmVzdWx0Q291bnQNCiAgICAgICAgfSk7DQogICAgICB9IGVsc2UgaWYgKGhhc1VuYWN0aXZlQ2hvaWNlcykgew0KICAgICAgICAvLyBPdGhlcndpc2UgcmVzZXQgY2hvaWNlcyB0byBhY3RpdmUNCiAgICAgICAgdGhpcy5faXNTZWFyY2hpbmcgPSBmYWxzZTsNCiAgICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9jaG9pY2VzLmFjdGl2YXRlQ2hvaWNlcykodHJ1ZSkpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19jYW5BZGRJdGVtJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NhbkFkZEl0ZW0oYWN0aXZlSXRlbXMsIHZhbHVlKSB7DQogICAgICB2YXIgY2FuQWRkSXRlbSA9IHRydWU7DQogICAgICB2YXIgbm90aWNlID0gKDAsIF91dGlscy5pc1R5cGUpKCdGdW5jdGlvbicsIHRoaXMuY29uZmlnLmFkZEl0ZW1UZXh0KSA/IHRoaXMuY29uZmlnLmFkZEl0ZW1UZXh0KHZhbHVlKSA6IHRoaXMuY29uZmlnLmFkZEl0ZW1UZXh0Ow0KDQogICAgICBpZiAoIXRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICB2YXIgaXNEdXBsaWNhdGVWYWx1ZSA9ICgwLCBfdXRpbHMuZXhpc3RzSW5BcnJheSkoYWN0aXZlSXRlbXMsIHZhbHVlKTsNCg0KICAgICAgICBpZiAodGhpcy5jb25maWcubWF4SXRlbUNvdW50ID4gMCAmJiB0aGlzLmNvbmZpZy5tYXhJdGVtQ291bnQgPD0gYWN0aXZlSXRlbXMubGVuZ3RoKSB7DQogICAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBtYXggZW50cnkgbGltaXQgYW5kIHdlIGhhdmUgcmVhY2hlZCB0aGF0IGxpbWl0DQogICAgICAgICAgLy8gZG9uJ3QgdXBkYXRlDQogICAgICAgICAgY2FuQWRkSXRlbSA9IGZhbHNlOw0KICAgICAgICAgIG5vdGljZSA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnRnVuY3Rpb24nLCB0aGlzLmNvbmZpZy5tYXhJdGVtVGV4dCkgPyB0aGlzLmNvbmZpZy5tYXhJdGVtVGV4dCh0aGlzLmNvbmZpZy5tYXhJdGVtQ291bnQpIDogdGhpcy5jb25maWcubWF4SXRlbVRleHQ7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAodGhpcy5jb25maWcucmVnZXhGaWx0ZXIgJiYgdGhpcy5faXNUZXh0RWxlbWVudCAmJiB0aGlzLmNvbmZpZy5hZGRJdGVtcyAmJiBjYW5BZGRJdGVtKSB7DQogICAgICAgICAgLy8gSWYgYSB1c2VyIGhhcyBzdXBwbGllZCBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBmaWx0ZXINCiAgICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB3ZSBjYW4gdXBkYXRlIGJhc2VkIG9uIHdoZXRoZXINCiAgICAgICAgICAvLyBvdXIgcmVndWxhciBleHByZXNzaW9uIHBhc3Nlcw0KICAgICAgICAgIGNhbkFkZEl0ZW0gPSAoMCwgX3V0aWxzLnJlZ2V4RmlsdGVyKSh2YWx1ZSwgdGhpcy5jb25maWcucmVnZXhGaWx0ZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCF0aGlzLmNvbmZpZy5kdXBsaWNhdGVJdGVtc0FsbG93ZWQgJiYgaXNEdXBsaWNhdGVWYWx1ZSAmJiBjYW5BZGRJdGVtKSB7DQogICAgICAgICAgY2FuQWRkSXRlbSA9IGZhbHNlOw0KICAgICAgICAgIG5vdGljZSA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnRnVuY3Rpb24nLCB0aGlzLmNvbmZpZy51bmlxdWVJdGVtVGV4dCkgPyB0aGlzLmNvbmZpZy51bmlxdWVJdGVtVGV4dCh2YWx1ZSkgOiB0aGlzLmNvbmZpZy51bmlxdWVJdGVtVGV4dDsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICByZXR1cm4gew0KICAgICAgICByZXNwb25zZTogY2FuQWRkSXRlbSwNCiAgICAgICAgbm90aWNlOiBub3RpY2UNCiAgICAgIH07DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2FqYXhDYWxsYmFjaycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9hamF4Q2FsbGJhY2soKSB7DQogICAgICB2YXIgX3RoaXMxNyA9IHRoaXM7DQoNCiAgICAgIHJldHVybiBmdW5jdGlvbiAocmVzdWx0cywgdmFsdWUsIGxhYmVsKSB7DQogICAgICAgIGlmICghcmVzdWx0cyB8fCAhdmFsdWUpIHsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgcGFyc2VkUmVzdWx0cyA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnT2JqZWN0JywgcmVzdWx0cykgPyBbcmVzdWx0c10gOiByZXN1bHRzOw0KDQogICAgICAgIGlmIChwYXJzZWRSZXN1bHRzICYmICgwLCBfdXRpbHMuaXNUeXBlKSgnQXJyYXknLCBwYXJzZWRSZXN1bHRzKSAmJiBwYXJzZWRSZXN1bHRzLmxlbmd0aCkgew0KICAgICAgICAgIC8vIFJlbW92ZSBsb2FkaW5nIHN0YXRlcy90ZXh0DQogICAgICAgICAgX3RoaXMxNy5faGFuZGxlTG9hZGluZ1N0YXRlKGZhbHNlKTsNCiAgICAgICAgICAvLyBBZGQgZWFjaCByZXN1bHQgYXMgYSBjaG9pY2UNCiAgICAgICAgICBwYXJzZWRSZXN1bHRzLmZvckVhY2goZnVuY3Rpb24gKHJlc3VsdCkgew0KICAgICAgICAgICAgaWYgKHJlc3VsdC5jaG9pY2VzKSB7DQogICAgICAgICAgICAgIF90aGlzMTcuX2FkZEdyb3VwKHsNCiAgICAgICAgICAgICAgICBncm91cDogcmVzdWx0LA0KICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaWQgfHwgbnVsbCwNCiAgICAgICAgICAgICAgICB2YWx1ZUtleTogdmFsdWUsDQogICAgICAgICAgICAgICAgbGFiZWxLZXk6IGxhYmVsDQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgX3RoaXMxNy5fYWRkQ2hvaWNlKHsNCiAgICAgICAgICAgICAgICB2YWx1ZTogKDAsIF91dGlscy5mZXRjaEZyb21PYmplY3QpKHJlc3VsdCwgdmFsdWUpLA0KICAgICAgICAgICAgICAgIGxhYmVsOiAoMCwgX3V0aWxzLmZldGNoRnJvbU9iamVjdCkocmVzdWx0LCBsYWJlbCksDQogICAgICAgICAgICAgICAgaXNTZWxlY3RlZDogcmVzdWx0LnNlbGVjdGVkLA0KICAgICAgICAgICAgICAgIGlzRGlzYWJsZWQ6IHJlc3VsdC5kaXNhYmxlZCwNCiAgICAgICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiByZXN1bHQuY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogcmVzdWx0LnBsYWNlaG9sZGVyDQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KDQogICAgICAgICAgaWYgKF90aGlzMTcuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICAgICAgX3RoaXMxNy5fc2VsZWN0UGxhY2Vob2xkZXJDaG9pY2UoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgLy8gTm8gcmVzdWx0cywgcmVtb3ZlIGxvYWRpbmcgc3RhdGUNCiAgICAgICAgICBfdGhpczE3Ll9oYW5kbGVMb2FkaW5nU3RhdGUoZmFsc2UpOw0KICAgICAgICB9DQogICAgICB9Ow0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19zZWFyY2hDaG9pY2VzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NlYXJjaENob2ljZXModmFsdWUpIHsNCiAgICAgIHZhciBuZXdWYWx1ZSA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnU3RyaW5nJywgdmFsdWUpID8gdmFsdWUudHJpbSgpIDogdmFsdWU7DQogICAgICB2YXIgY3VycmVudFZhbHVlID0gKDAsIF91dGlscy5pc1R5cGUpKCdTdHJpbmcnLCB0aGlzLl9jdXJyZW50VmFsdWUpID8gdGhpcy5fY3VycmVudFZhbHVlLnRyaW0oKSA6IHRoaXMuX2N1cnJlbnRWYWx1ZTsNCg0KICAgICAgaWYgKG5ld1ZhbHVlLmxlbmd0aCA8IDEgJiYgbmV3VmFsdWUgPT09IGN1cnJlbnRWYWx1ZSArICcgJykgew0KICAgICAgICByZXR1cm4gMDsNCiAgICAgIH0NCg0KICAgICAgLy8gSWYgbmV3IHZhbHVlIG1hdGNoZXMgdGhlIGRlc2lyZWQgbGVuZ3RoIGFuZCBpcyBub3QgdGhlIHNhbWUgYXMgdGhlIGN1cnJlbnQgdmFsdWUgd2l0aCBhIHNwYWNlDQogICAgICB2YXIgaGF5c3RhY2sgPSB0aGlzLl9zdG9yZS5zZWFyY2hhYmxlQ2hvaWNlczsNCiAgICAgIHZhciBuZWVkbGUgPSBuZXdWYWx1ZTsNCiAgICAgIHZhciBrZXlzID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0aGlzLmNvbmZpZy5zZWFyY2hGaWVsZHMpKTsNCiAgICAgIHZhciBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih0aGlzLmNvbmZpZy5mdXNlT3B0aW9ucywgeyBrZXlzOiBrZXlzIH0pOw0KICAgICAgdmFyIGZ1c2UgPSBuZXcgX2Z1c2UyLmRlZmF1bHQoaGF5c3RhY2ssIG9wdGlvbnMpOw0KICAgICAgdmFyIHJlc3VsdHMgPSBmdXNlLnNlYXJjaChuZWVkbGUpOw0KDQogICAgICB0aGlzLl9jdXJyZW50VmFsdWUgPSBuZXdWYWx1ZTsNCiAgICAgIHRoaXMuX2hpZ2hsaWdodFBvc2l0aW9uID0gMDsNCiAgICAgIHRoaXMuX2lzU2VhcmNoaW5nID0gdHJ1ZTsNCiAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfY2hvaWNlcy5maWx0ZXJDaG9pY2VzKShyZXN1bHRzKSk7DQoNCiAgICAgIHJldHVybiByZXN1bHRzLmxlbmd0aDsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfYWRkRXZlbnRMaXN0ZW5lcnMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfYWRkRXZlbnRMaXN0ZW5lcnMoKSB7DQogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMuX29uS2V5VXApOw0KICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX29uS2V5RG93bik7DQogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX29uQ2xpY2spOw0KICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcy5fb25Ub3VjaE1vdmUpOw0KICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLl9vblRvdWNoRW5kKTsNCiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuX29uTW91c2VEb3duKTsNCiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIHRoaXMuX29uTW91c2VPdmVyKTsNCg0KICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9vbkZvY3VzKTsNCiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOw0KICAgICAgfQ0KDQogICAgICB0aGlzLmlucHV0LmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9vbkZvY3VzKTsNCiAgICAgIHRoaXMuaW5wdXQuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5fb25CbHVyKTsNCg0KICAgICAgaWYgKHRoaXMuaW5wdXQuZWxlbWVudC5mb3JtKSB7DQogICAgICAgIHRoaXMuaW5wdXQuZWxlbWVudC5mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2V0JywgdGhpcy5fb25Gb3JtUmVzZXQpOw0KICAgICAgfQ0KDQogICAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXJzKCk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX3JlbW92ZUV2ZW50TGlzdGVuZXJzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbW92ZUV2ZW50TGlzdGVuZXJzKCkgew0KICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLl9vbktleVVwKTsNCiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9vbktleURvd24pOw0KICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9vbkNsaWNrKTsNCiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMuX29uVG91Y2hNb3ZlKTsNCiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5fb25Ub3VjaEVuZCk7DQogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLl9vbk1vdXNlRG93bik7DQogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCB0aGlzLl9vbk1vdXNlT3Zlcik7DQoNCiAgICAgIGlmICh0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fb25Gb2N1cyk7DQogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5fb25CbHVyKTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5pbnB1dC5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fb25Gb2N1cyk7DQogICAgICB0aGlzLmlucHV0LmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmx1cicsIHRoaXMuX29uQmx1cik7DQoNCiAgICAgIGlmICh0aGlzLmlucHV0LmVsZW1lbnQuZm9ybSkgew0KICAgICAgICB0aGlzLmlucHV0LmVsZW1lbnQuZm9ybS5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNldCcsIHRoaXMuX29uRm9ybVJlc2V0KTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5pbnB1dC5yZW1vdmVFdmVudExpc3RlbmVycygpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbktleURvd24nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25LZXlEb3duKGV2ZW50KSB7DQogICAgICB2YXIgX2tleURvd25BY3Rpb25zOw0KDQogICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0LA0KICAgICAgICAgIGtleUNvZGUgPSBldmVudC5rZXlDb2RlLA0KICAgICAgICAgIGN0cmxLZXkgPSBldmVudC5jdHJsS2V5LA0KICAgICAgICAgIG1ldGFLZXkgPSBldmVudC5tZXRhS2V5Ow0KDQoNCiAgICAgIGlmICh0YXJnZXQgIT09IHRoaXMuaW5wdXQuZWxlbWVudCAmJiAhdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmNvbnRhaW5zKHRhcmdldCkpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB2YXIgYWN0aXZlSXRlbXMgPSB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtczsNCiAgICAgIHZhciBoYXNGb2N1c2VkSW5wdXQgPSB0aGlzLmlucHV0LmlzRm9jdXNzZWQ7DQogICAgICB2YXIgaGFzQWN0aXZlRHJvcGRvd24gPSB0aGlzLmRyb3Bkb3duLmlzQWN0aXZlOw0KICAgICAgdmFyIGhhc0l0ZW1zID0gdGhpcy5pdGVtTGlzdC5oYXNDaGlsZHJlbjsNCiAgICAgIHZhciBrZXlTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGtleUNvZGUpOw0KDQogICAgICB2YXIgQkFDS19LRVkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5CQUNLX0tFWSwNCiAgICAgICAgICBERUxFVEVfS0VZID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuREVMRVRFX0tFWSwNCiAgICAgICAgICBFTlRFUl9LRVkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5FTlRFUl9LRVksDQogICAgICAgICAgQV9LRVkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5BX0tFWSwNCiAgICAgICAgICBFU0NfS0VZID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuRVNDX0tFWSwNCiAgICAgICAgICBVUF9LRVkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5VUF9LRVksDQogICAgICAgICAgRE9XTl9LRVkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5ET1dOX0tFWSwNCiAgICAgICAgICBQQUdFX1VQX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLlBBR0VfVVBfS0VZLA0KICAgICAgICAgIFBBR0VfRE9XTl9LRVkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5QQUdFX0RPV05fS0VZOw0KDQogICAgICB2YXIgaGFzQ3RybERvd25LZXlQcmVzc2VkID0gY3RybEtleSB8fCBtZXRhS2V5Ow0KDQogICAgICAvLyBJZiBhIHVzZXIgaXMgdHlwaW5nIGFuZCB0aGUgZHJvcGRvd24gaXMgbm90IGFjdGl2ZQ0KICAgICAgaWYgKCF0aGlzLl9pc1RleHRFbGVtZW50ICYmIC9bYS16QS1aMC05LV8gXS8udGVzdChrZXlTdHJpbmcpKSB7DQogICAgICAgIHRoaXMuc2hvd0Ryb3Bkb3duKCk7DQogICAgICB9DQoNCiAgICAgIC8vIE1hcCBrZXlzIHRvIGtleSBhY3Rpb25zDQogICAgICB2YXIga2V5RG93bkFjdGlvbnMgPSAoX2tleURvd25BY3Rpb25zID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIEFfS0VZLCB0aGlzLl9vbkFLZXkpLCBfZGVmaW5lUHJvcGVydHkoX2tleURvd25BY3Rpb25zLCBFTlRFUl9LRVksIHRoaXMuX29uRW50ZXJLZXkpLCBfZGVmaW5lUHJvcGVydHkoX2tleURvd25BY3Rpb25zLCBFU0NfS0VZLCB0aGlzLl9vbkVzY2FwZUtleSksIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIFVQX0tFWSwgdGhpcy5fb25EaXJlY3Rpb25LZXkpLCBfZGVmaW5lUHJvcGVydHkoX2tleURvd25BY3Rpb25zLCBQQUdFX1VQX0tFWSwgdGhpcy5fb25EaXJlY3Rpb25LZXkpLCBfZGVmaW5lUHJvcGVydHkoX2tleURvd25BY3Rpb25zLCBET1dOX0tFWSwgdGhpcy5fb25EaXJlY3Rpb25LZXkpLCBfZGVmaW5lUHJvcGVydHkoX2tleURvd25BY3Rpb25zLCBQQUdFX0RPV05fS0VZLCB0aGlzLl9vbkRpcmVjdGlvbktleSksIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIERFTEVURV9LRVksIHRoaXMuX29uRGVsZXRlS2V5KSwgX2RlZmluZVByb3BlcnR5KF9rZXlEb3duQWN0aW9ucywgQkFDS19LRVksIHRoaXMuX29uRGVsZXRlS2V5KSwgX2tleURvd25BY3Rpb25zKTsNCg0KICAgICAgLy8gSWYga2V5Y29kZSBoYXMgYSBmdW5jdGlvbiwgcnVuIGl0DQogICAgICBpZiAoa2V5RG93bkFjdGlvbnNba2V5Q29kZV0pIHsNCiAgICAgICAga2V5RG93bkFjdGlvbnNba2V5Q29kZV0oew0KICAgICAgICAgIGV2ZW50OiBldmVudCwNCiAgICAgICAgICB0YXJnZXQ6IHRhcmdldCwNCiAgICAgICAgICBrZXlDb2RlOiBrZXlDb2RlLA0KICAgICAgICAgIG1ldGFLZXk6IG1ldGFLZXksDQogICAgICAgICAgYWN0aXZlSXRlbXM6IGFjdGl2ZUl0ZW1zLA0KICAgICAgICAgIGhhc0ZvY3VzZWRJbnB1dDogaGFzRm9jdXNlZElucHV0LA0KICAgICAgICAgIGhhc0FjdGl2ZURyb3Bkb3duOiBoYXNBY3RpdmVEcm9wZG93biwNCiAgICAgICAgICBoYXNJdGVtczogaGFzSXRlbXMsDQogICAgICAgICAgaGFzQ3RybERvd25LZXlQcmVzc2VkOiBoYXNDdHJsRG93bktleVByZXNzZWQNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uS2V5VXAnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25LZXlVcChfcmVmMikgew0KICAgICAgdmFyIHRhcmdldCA9IF9yZWYyLnRhcmdldCwNCiAgICAgICAgICBrZXlDb2RlID0gX3JlZjIua2V5Q29kZTsNCg0KICAgICAgaWYgKHRhcmdldCAhPT0gdGhpcy5pbnB1dC5lbGVtZW50KSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdmFyIHZhbHVlID0gdGhpcy5pbnB1dC52YWx1ZTsNCiAgICAgIHZhciBhY3RpdmVJdGVtcyA9IHRoaXMuX3N0b3JlLmFjdGl2ZUl0ZW1zOw0KICAgICAgdmFyIGNhbkFkZEl0ZW0gPSB0aGlzLl9jYW5BZGRJdGVtKGFjdGl2ZUl0ZW1zLCB2YWx1ZSk7DQoNCiAgICAgIC8vIFdlIGFyZSB0eXBpbmcgaW50byBhIHRleHQgaW5wdXQgYW5kIGhhdmUgYSB2YWx1ZSwgd2Ugd2FudCB0byBzaG93IGEgZHJvcGRvd24NCiAgICAgIC8vIG5vdGljZS4gT3RoZXJ3aXNlIGhpZGUgdGhlIGRyb3Bkb3duDQogICAgICBpZiAodGhpcy5faXNUZXh0RWxlbWVudCkgew0KICAgICAgICBpZiAodmFsdWUpIHsNCiAgICAgICAgICBpZiAoY2FuQWRkSXRlbS5ub3RpY2UpIHsNCiAgICAgICAgICAgIHZhciBkcm9wZG93bkl0ZW0gPSB0aGlzLl9nZXRUZW1wbGF0ZSgnbm90aWNlJywgY2FuQWRkSXRlbS5ub3RpY2UpOw0KICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5lbGVtZW50LmlubmVySFRNTCA9IGRyb3Bkb3duSXRlbS5vdXRlckhUTUw7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgaWYgKGNhbkFkZEl0ZW0ucmVzcG9uc2UgPT09IHRydWUpIHsNCiAgICAgICAgICAgIHRoaXMuc2hvd0Ryb3Bkb3duKHRydWUpOw0KICAgICAgICAgIH0gZWxzZSBpZiAoIWNhbkFkZEl0ZW0ubm90aWNlKSB7DQogICAgICAgICAgICB0aGlzLmhpZGVEcm9wZG93bih0cnVlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy5oaWRlRHJvcGRvd24odHJ1ZSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHZhciBiYWNrS2V5ID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuQkFDS19LRVk7DQogICAgICAgIHZhciBkZWxldGVLZXkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5ERUxFVEVfS0VZOw0KDQogICAgICAgIC8vIElmIHVzZXIgaGFzIHJlbW92ZWQgdmFsdWUuLi4NCiAgICAgICAgaWYgKChrZXlDb2RlID09PSBiYWNrS2V5IHx8IGtleUNvZGUgPT09IGRlbGV0ZUtleSkgJiYgIXRhcmdldC52YWx1ZSkgew0KICAgICAgICAgIGlmICghdGhpcy5faXNUZXh0RWxlbWVudCAmJiB0aGlzLl9pc1NlYXJjaGluZykgew0KICAgICAgICAgICAgdGhpcy5faXNTZWFyY2hpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfY2hvaWNlcy5hY3RpdmF0ZUNob2ljZXMpKHRydWUpKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY2FuU2VhcmNoICYmIGNhbkFkZEl0ZW0ucmVzcG9uc2UpIHsNCiAgICAgICAgICB0aGlzLl9oYW5kbGVTZWFyY2godGhpcy5pbnB1dC52YWx1ZSk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgdGhpcy5fY2FuU2VhcmNoID0gdGhpcy5jb25maWcuc2VhcmNoRW5hYmxlZDsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25BS2V5JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uQUtleShfcmVmMykgew0KICAgICAgdmFyIGhhc0l0ZW1zID0gX3JlZjMuaGFzSXRlbXMsDQogICAgICAgICAgaGFzQ3RybERvd25LZXlQcmVzc2VkID0gX3JlZjMuaGFzQ3RybERvd25LZXlQcmVzc2VkOw0KDQogICAgICAvLyBJZiBDVFJMICsgQSBvciBDTUQgKyBBIGhhdmUgYmVlbiBwcmVzc2VkIGFuZCB0aGVyZSBhcmUgaXRlbXMgdG8gc2VsZWN0DQogICAgICBpZiAoaGFzQ3RybERvd25LZXlQcmVzc2VkICYmIGhhc0l0ZW1zKSB7DQogICAgICAgIHRoaXMuX2NhblNlYXJjaCA9IGZhbHNlOw0KICAgICAgICBpZiAodGhpcy5jb25maWcucmVtb3ZlSXRlbXMgJiYgIXRoaXMuaW5wdXQudmFsdWUgJiYgdGhpcy5pbnB1dC5lbGVtZW50ID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7DQogICAgICAgICAgLy8gSGlnaGxpZ2h0IGl0ZW1zDQogICAgICAgICAgdGhpcy5oaWdobGlnaHRBbGwoKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbkVudGVyS2V5JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRW50ZXJLZXkoX3JlZjQpIHsNCiAgICAgIHZhciBldmVudCA9IF9yZWY0LmV2ZW50LA0KICAgICAgICAgIHRhcmdldCA9IF9yZWY0LnRhcmdldCwNCiAgICAgICAgICBhY3RpdmVJdGVtcyA9IF9yZWY0LmFjdGl2ZUl0ZW1zLA0KICAgICAgICAgIGhhc0FjdGl2ZURyb3Bkb3duID0gX3JlZjQuaGFzQWN0aXZlRHJvcGRvd247DQogICAgICB2YXIgZW50ZXJLZXkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5FTlRFUl9LRVk7DQogICAgICAvLyBJZiBlbnRlciBrZXkgaXMgcHJlc3NlZCBhbmQgdGhlIGlucHV0IGhhcyBhIHZhbHVlDQoNCiAgICAgIGlmICh0aGlzLl9pc1RleHRFbGVtZW50ICYmIHRhcmdldC52YWx1ZSkgew0KICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmlucHV0LnZhbHVlOw0KICAgICAgICB2YXIgY2FuQWRkSXRlbSA9IHRoaXMuX2NhbkFkZEl0ZW0oYWN0aXZlSXRlbXMsIHZhbHVlKTsNCg0KICAgICAgICAvLyBBbGwgaXMgZ29vZCwgYWRkDQogICAgICAgIGlmIChjYW5BZGRJdGVtLnJlc3BvbnNlKSB7DQogICAgICAgICAgdGhpcy5oaWRlRHJvcGRvd24odHJ1ZSk7DQogICAgICAgICAgdGhpcy5fYWRkSXRlbSh7IHZhbHVlOiB2YWx1ZSB9KTsNCiAgICAgICAgICB0aGlzLl90cmlnZ2VyQ2hhbmdlKHZhbHVlKTsNCiAgICAgICAgICB0aGlzLmNsZWFySW5wdXQoKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBpZiAodGFyZ2V0Lmhhc0F0dHJpYnV0ZSgnZGF0YS1idXR0b24nKSkgew0KICAgICAgICB0aGlzLl9oYW5kbGVCdXR0b25BY3Rpb24oYWN0aXZlSXRlbXMsIHRhcmdldCk7DQogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICB9DQoNCiAgICAgIGlmIChoYXNBY3RpdmVEcm9wZG93bikgew0KICAgICAgICB2YXIgaGlnaGxpZ2h0ZWQgPSB0aGlzLmRyb3Bkb3duLmdldENoaWxkKCcuJyArIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuaGlnaGxpZ2h0ZWRTdGF0ZSk7DQoNCiAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIGhpZ2hsaWdodGVkIGNob2ljZQ0KICAgICAgICBpZiAoaGlnaGxpZ2h0ZWQpIHsNCiAgICAgICAgICAvLyBhZGQgZW50ZXIga2V5Q29kZSB2YWx1ZQ0KICAgICAgICAgIGlmIChhY3RpdmVJdGVtc1swXSkgew0KICAgICAgICAgICAgYWN0aXZlSXRlbXNbMF0ua2V5Q29kZSA9IGVudGVyS2V5OyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXBhcmFtLXJlYXNzaWduDQogICAgICAgICAgfQ0KICAgICAgICAgIHRoaXMuX2hhbmRsZUNob2ljZUFjdGlvbihhY3RpdmVJdGVtcywgaGlnaGxpZ2h0ZWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgIH0gZWxzZSBpZiAodGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIC8vIE9wZW4gc2luZ2xlIHNlbGVjdCBkcm9wZG93biBpZiBpdCdzIG5vdCBhY3RpdmUNCiAgICAgICAgdGhpcy5zaG93RHJvcGRvd24oKTsNCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25Fc2NhcGVLZXknLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Fc2NhcGVLZXkoX3JlZjUpIHsNCiAgICAgIHZhciBoYXNBY3RpdmVEcm9wZG93biA9IF9yZWY1Lmhhc0FjdGl2ZURyb3Bkb3duOw0KDQogICAgICBpZiAoaGFzQWN0aXZlRHJvcGRvd24pIHsNCiAgICAgICAgdGhpcy5oaWRlRHJvcGRvd24odHJ1ZSk7DQogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZm9jdXMoKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25EaXJlY3Rpb25LZXknLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25EaXJlY3Rpb25LZXkoX3JlZjYpIHsNCiAgICAgIHZhciBldmVudCA9IF9yZWY2LmV2ZW50LA0KICAgICAgICAgIGhhc0FjdGl2ZURyb3Bkb3duID0gX3JlZjYuaGFzQWN0aXZlRHJvcGRvd24sDQogICAgICAgICAga2V5Q29kZSA9IF9yZWY2LmtleUNvZGUsDQogICAgICAgICAgbWV0YUtleSA9IF9yZWY2Lm1ldGFLZXk7DQogICAgICB2YXIgZG93bktleSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkRPV05fS0VZLA0KICAgICAgICAgIHBhZ2VVcEtleSA9IF9jb25zdGFudHMuS0VZX0NPREVTLlBBR0VfVVBfS0VZLA0KICAgICAgICAgIHBhZ2VEb3duS2V5ID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuUEFHRV9ET1dOX0tFWTsNCg0KICAgICAgLy8gSWYgdXAgb3IgZG93biBrZXkgaXMgcHJlc3NlZCwgdHJhdmVyc2UgdGhyb3VnaCBvcHRpb25zDQoNCiAgICAgIGlmIChoYXNBY3RpdmVEcm9wZG93biB8fCB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgdGhpcy5zaG93RHJvcGRvd24oKTsNCiAgICAgICAgdGhpcy5fY2FuU2VhcmNoID0gZmFsc2U7DQoNCiAgICAgICAgdmFyIGRpcmVjdGlvbkludCA9IGtleUNvZGUgPT09IGRvd25LZXkgfHwga2V5Q29kZSA9PT0gcGFnZURvd25LZXkgPyAxIDogLTE7DQogICAgICAgIHZhciBza2lwS2V5ID0gbWV0YUtleSB8fCBrZXlDb2RlID09PSBwYWdlRG93bktleSB8fCBrZXlDb2RlID09PSBwYWdlVXBLZXk7DQogICAgICAgIHZhciBzZWxlY3RhYmxlQ2hvaWNlSWRlbnRpZmllciA9ICdbZGF0YS1jaG9pY2Utc2VsZWN0YWJsZV0nOw0KDQogICAgICAgIHZhciBuZXh0RWwgPSB2b2lkIDA7DQogICAgICAgIGlmIChza2lwS2V5KSB7DQogICAgICAgICAgaWYgKGRpcmVjdGlvbkludCA+IDApIHsNCiAgICAgICAgICAgIG5leHRFbCA9IEFycmF5LmZyb20odGhpcy5kcm9wZG93bi5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0YWJsZUNob2ljZUlkZW50aWZpZXIpKS5wb3AoKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbmV4dEVsID0gdGhpcy5kcm9wZG93bi5lbGVtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0YWJsZUNob2ljZUlkZW50aWZpZXIpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB2YXIgY3VycmVudEVsID0gdGhpcy5kcm9wZG93bi5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nICsgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5oaWdobGlnaHRlZFN0YXRlKTsNCiAgICAgICAgICBpZiAoY3VycmVudEVsKSB7DQogICAgICAgICAgICBuZXh0RWwgPSAoMCwgX3V0aWxzLmdldEFkamFjZW50RWwpKGN1cnJlbnRFbCwgc2VsZWN0YWJsZUNob2ljZUlkZW50aWZpZXIsIGRpcmVjdGlvbkludCk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIG5leHRFbCA9IHRoaXMuZHJvcGRvd24uZWxlbWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdGFibGVDaG9pY2VJZGVudGlmaWVyKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpZiAobmV4dEVsKSB7DQogICAgICAgICAgLy8gV2UgcHJldmVudCBkZWZhdWx0IHRvIHN0b3AgdGhlIGN1cnNvciBtb3ZpbmcNCiAgICAgICAgICAvLyB3aGVuIHByZXNzaW5nIHRoZSBhcnJvdw0KICAgICAgICAgIGlmICghKDAsIF91dGlscy5pc1Njcm9sbGVkSW50b1ZpZXcpKG5leHRFbCwgdGhpcy5jaG9pY2VMaXN0LmVsZW1lbnQsIGRpcmVjdGlvbkludCkpIHsNCiAgICAgICAgICAgIHRoaXMuY2hvaWNlTGlzdC5zY3JvbGxUb0Nob2ljZShuZXh0RWwsIGRpcmVjdGlvbkludCk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHRoaXMuX2hpZ2hsaWdodENob2ljZShuZXh0RWwpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUHJldmVudCBkZWZhdWx0IHRvIG1haW50YWluIGN1cnNvciBwb3NpdGlvbiB3aGlsc3QNCiAgICAgICAgLy8gdHJhdmVyc2luZyBkcm9wZG93biBvcHRpb25zDQogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uRGVsZXRlS2V5JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRGVsZXRlS2V5KF9yZWY3KSB7DQogICAgICB2YXIgZXZlbnQgPSBfcmVmNy5ldmVudCwNCiAgICAgICAgICB0YXJnZXQgPSBfcmVmNy50YXJnZXQsDQogICAgICAgICAgaGFzRm9jdXNlZElucHV0ID0gX3JlZjcuaGFzRm9jdXNlZElucHV0LA0KICAgICAgICAgIGFjdGl2ZUl0ZW1zID0gX3JlZjcuYWN0aXZlSXRlbXM7DQoNCiAgICAgIC8vIElmIGJhY2tzcGFjZSBvciBkZWxldGUga2V5IGlzIHByZXNzZWQgYW5kIHRoZSBpbnB1dCBoYXMgbm8gdmFsdWUNCiAgICAgIGlmIChoYXNGb2N1c2VkSW5wdXQgJiYgIXRhcmdldC52YWx1ZSAmJiAhdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIHRoaXMuX2hhbmRsZUJhY2tzcGFjZShhY3RpdmVJdGVtcyk7DQogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uVG91Y2hNb3ZlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uVG91Y2hNb3ZlKCkgew0KICAgICAgaWYgKHRoaXMuX3dhc1RhcCA9PT0gdHJ1ZSkgew0KICAgICAgICB0aGlzLl93YXNUYXAgPSBmYWxzZTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25Ub3VjaEVuZCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblRvdWNoRW5kKGV2ZW50KSB7DQogICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IHx8IGV2ZW50LnRvdWNoZXNbMF0udGFyZ2V0Ow0KDQogICAgICAvLyBJZiBhIHVzZXIgdGFwcGVkIHdpdGhpbiBvdXIgY29udGFpbmVyLi4uDQogICAgICBpZiAodGhpcy5fd2FzVGFwID09PSB0cnVlICYmIHRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5jb250YWlucyh0YXJnZXQpKSB7DQogICAgICAgIC8vIC4uLmFuZCB3ZSBhcmVuJ3QgZGVhbGluZyB3aXRoIGEgc2luZ2xlIHNlbGVjdCBib3gsIHNob3cgZHJvcGRvd24vZm9jdXMgaW5wdXQNCg0KICAgICAgICB2YXIgY29udGFpbmVyV2FzVGFyZ2V0ID0gdGFyZ2V0ID09PSB0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQgfHwgdGFyZ2V0ID09PSB0aGlzLmNvbnRhaW5lcklubmVyLmVsZW1lbnQ7DQoNCiAgICAgICAgaWYgKGNvbnRhaW5lcldhc1RhcmdldCAmJiAhdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgICAgaWYgKHRoaXMuX2lzVGV4dEVsZW1lbnQpIHsNCiAgICAgICAgICAgIC8vIElmIHRleHQgZWxlbWVudCwgd2Ugb25seSB3YW50IHRvIGZvY3VzIHRoZSBpbnB1dA0KICAgICAgICAgICAgdGhpcy5pbnB1dC5mb2N1cygpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBJZiBhIHNlbGVjdCBib3gsIHdlIHdhbnQgdG8gc2hvdyB0aGUgZHJvcGRvd24NCiAgICAgICAgICAgIHRoaXMuc2hvd0Ryb3Bkb3duKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vIFByZXZlbnRzIGZvY3VzIGV2ZW50IGZpcmluZw0KICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5fd2FzVGFwID0gdHJ1ZTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25Nb3VzZURvd24nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Nb3VzZURvd24oZXZlbnQpIHsNCiAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQsDQogICAgICAgICAgc2hpZnRLZXkgPSBldmVudC5zaGlmdEtleTsNCiAgICAgIC8vIElmIHdlIGhhdmUgb3VyIG1vdXNlIGRvd24gb24gdGhlIHNjcm9sbGJhciBhbmQgYXJlIG9uIElFMTEuLi4NCg0KICAgICAgaWYgKHRhcmdldCA9PT0gdGhpcy5jaG9pY2VMaXN0ICYmICgwLCBfdXRpbHMuaXNJRTExKSgpKSB7DQogICAgICAgIHRoaXMuX2lzU2Nyb2xsaW5nT25JZSA9IHRydWU7DQogICAgICB9DQoNCiAgICAgIGlmICghdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmNvbnRhaW5zKHRhcmdldCkgfHwgdGFyZ2V0ID09PSB0aGlzLmlucHV0LmVsZW1lbnQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB2YXIgYWN0aXZlSXRlbXMgPSB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtczsNCiAgICAgIHZhciBoYXNTaGlmdEtleSA9IHNoaWZ0S2V5Ow0KDQogICAgICB2YXIgYnV0dG9uVGFyZ2V0ID0gKDAsIF91dGlscy5maW5kQW5jZXN0b3JCeUF0dHJOYW1lKSh0YXJnZXQsICdkYXRhLWJ1dHRvbicpOw0KICAgICAgdmFyIGl0ZW1UYXJnZXQgPSAoMCwgX3V0aWxzLmZpbmRBbmNlc3RvckJ5QXR0ck5hbWUpKHRhcmdldCwgJ2RhdGEtaXRlbScpOw0KICAgICAgdmFyIGNob2ljZVRhcmdldCA9ICgwLCBfdXRpbHMuZmluZEFuY2VzdG9yQnlBdHRyTmFtZSkodGFyZ2V0LCAnZGF0YS1jaG9pY2UnKTsNCg0KICAgICAgaWYgKGJ1dHRvblRhcmdldCkgew0KICAgICAgICB0aGlzLl9oYW5kbGVCdXR0b25BY3Rpb24oYWN0aXZlSXRlbXMsIGJ1dHRvblRhcmdldCk7DQogICAgICB9IGVsc2UgaWYgKGl0ZW1UYXJnZXQpIHsNCiAgICAgICAgdGhpcy5faGFuZGxlSXRlbUFjdGlvbihhY3RpdmVJdGVtcywgaXRlbVRhcmdldCwgaGFzU2hpZnRLZXkpOw0KICAgICAgfSBlbHNlIGlmIChjaG9pY2VUYXJnZXQpIHsNCiAgICAgICAgdGhpcy5faGFuZGxlQ2hvaWNlQWN0aW9uKGFjdGl2ZUl0ZW1zLCBjaG9pY2VUYXJnZXQpOw0KICAgICAgfQ0KDQogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbk1vdXNlT3ZlcicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbk1vdXNlT3ZlcihfcmVmOCkgew0KICAgICAgdmFyIHRhcmdldCA9IF9yZWY4LnRhcmdldDsNCg0KICAgICAgdmFyIHRhcmdldFdpdGhpbkRyb3Bkb3duID0gdGFyZ2V0ID09PSB0aGlzLmRyb3Bkb3duIHx8IHRoaXMuZHJvcGRvd24uZWxlbWVudC5jb250YWlucyh0YXJnZXQpOw0KICAgICAgdmFyIHNob3VsZEhpZ2hsaWdodENob2ljZSA9IHRhcmdldFdpdGhpbkRyb3Bkb3duICYmIHRhcmdldC5oYXNBdHRyaWJ1dGUoJ2RhdGEtY2hvaWNlJyk7DQoNCiAgICAgIGlmIChzaG91bGRIaWdobGlnaHRDaG9pY2UpIHsNCiAgICAgICAgdGhpcy5faGlnaGxpZ2h0Q2hvaWNlKHRhcmdldCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX29uQ2xpY2snLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25DbGljayhfcmVmOSkgew0KICAgICAgdmFyIHRhcmdldCA9IF9yZWY5LnRhcmdldDsNCg0KICAgICAgaWYgKHRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5jb250YWlucyh0YXJnZXQpKSB7DQogICAgICAgIGlmICghdGhpcy5kcm9wZG93bi5pc0FjdGl2ZSAmJiAhdGhpcy5jb250YWluZXJPdXRlci5pc0Rpc2FibGVkKSB7DQogICAgICAgICAgaWYgKHRoaXMuX2lzVGV4dEVsZW1lbnQpIHsNCiAgICAgICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ICE9PSB0aGlzLmlucHV0LmVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgdGhpcy5pbnB1dC5mb2N1cygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0aGlzLnNob3dEcm9wZG93bigpOw0KICAgICAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5mb2N1cygpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQgJiYgdGFyZ2V0ICE9PSB0aGlzLmlucHV0LmVsZW1lbnQgJiYgIXRoaXMuZHJvcGRvd24uZWxlbWVudC5jb250YWlucyh0YXJnZXQpKSB7DQogICAgICAgICAgdGhpcy5oaWRlRHJvcGRvd24oKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdmFyIGhhc0hpZ2hsaWdodGVkSXRlbXMgPSB0aGlzLl9zdG9yZS5oaWdobGlnaHRlZEFjdGl2ZUl0ZW1zOw0KDQogICAgICAgIGlmIChoYXNIaWdobGlnaHRlZEl0ZW1zKSB7DQogICAgICAgICAgdGhpcy51bmhpZ2hsaWdodEFsbCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5yZW1vdmVGb2N1c1N0YXRlKCk7DQogICAgICAgIHRoaXMuaGlkZURyb3Bkb3duKHRydWUpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbkZvY3VzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRm9jdXMoX3JlZjEwKSB7DQogICAgICB2YXIgX3RoaXMxOCA9IHRoaXM7DQoNCiAgICAgIHZhciB0YXJnZXQgPSBfcmVmMTAudGFyZ2V0Ow0KDQogICAgICBpZiAoIXRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5jb250YWlucyh0YXJnZXQpKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdmFyIGZvY3VzQWN0aW9ucyA9IHsNCiAgICAgICAgdGV4dDogZnVuY3Rpb24gdGV4dCgpIHsNCiAgICAgICAgICBpZiAodGFyZ2V0ID09PSBfdGhpczE4LmlucHV0LmVsZW1lbnQpIHsNCiAgICAgICAgICAgIF90aGlzMTguY29udGFpbmVyT3V0ZXIuYWRkRm9jdXNTdGF0ZSgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgJ3NlbGVjdC1vbmUnOiBmdW5jdGlvbiBzZWxlY3RPbmUoKSB7DQogICAgICAgICAgX3RoaXMxOC5jb250YWluZXJPdXRlci5hZGRGb2N1c1N0YXRlKCk7DQogICAgICAgICAgaWYgKHRhcmdldCA9PT0gX3RoaXMxOC5pbnB1dC5lbGVtZW50KSB7DQogICAgICAgICAgICBfdGhpczE4LnNob3dEcm9wZG93bih0cnVlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgICdzZWxlY3QtbXVsdGlwbGUnOiBmdW5jdGlvbiBzZWxlY3RNdWx0aXBsZSgpIHsNCiAgICAgICAgICBpZiAodGFyZ2V0ID09PSBfdGhpczE4LmlucHV0LmVsZW1lbnQpIHsNCiAgICAgICAgICAgIF90aGlzMTguc2hvd0Ryb3Bkb3duKHRydWUpOw0KICAgICAgICAgICAgLy8gSWYgZWxlbWVudCBpcyBhIHNlbGVjdCBib3gsIHRoZSBmb2N1c2VkIGVsZW1lbnQgaXMgdGhlIGNvbnRhaW5lciBhbmQgdGhlIGRyb3Bkb3duDQogICAgICAgICAgICAvLyBpc24ndCBhbHJlYWR5IG9wZW4sIGZvY3VzIGFuZCBzaG93IGRyb3Bkb3duDQogICAgICAgICAgICBfdGhpczE4LmNvbnRhaW5lck91dGVyLmFkZEZvY3VzU3RhdGUoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH07DQoNCiAgICAgIGZvY3VzQWN0aW9uc1t0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC50eXBlXSgpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbkJsdXInLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25CbHVyKF9yZWYxMSkgew0KICAgICAgdmFyIF90aGlzMTkgPSB0aGlzOw0KDQogICAgICB2YXIgdGFyZ2V0ID0gX3JlZjExLnRhcmdldDsNCg0KICAgICAgLy8gSWYgdGFyZ2V0IGlzIHNvbWV0aGluZyB0aGF0IGNvbmNlcm5zIHVzDQogICAgICBpZiAodGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmNvbnRhaW5zKHRhcmdldCkgJiYgIXRoaXMuX2lzU2Nyb2xsaW5nT25JZSkgew0KICAgICAgICB2YXIgYWN0aXZlSXRlbXMgPSB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtczsNCiAgICAgICAgdmFyIGhhc0hpZ2hsaWdodGVkSXRlbXMgPSBhY3RpdmVJdGVtcy5zb21lKGZ1bmN0aW9uIChpdGVtKSB7DQogICAgICAgICAgcmV0dXJuIGl0ZW0uaGlnaGxpZ2h0ZWQ7DQogICAgICAgIH0pOw0KICAgICAgICB2YXIgYmx1ckFjdGlvbnMgPSB7DQogICAgICAgICAgdGV4dDogZnVuY3Rpb24gdGV4dCgpIHsNCiAgICAgICAgICAgIGlmICh0YXJnZXQgPT09IF90aGlzMTkuaW5wdXQuZWxlbWVudCkgew0KICAgICAgICAgICAgICBfdGhpczE5LmNvbnRhaW5lck91dGVyLnJlbW92ZUZvY3VzU3RhdGUoKTsNCiAgICAgICAgICAgICAgaWYgKGhhc0hpZ2hsaWdodGVkSXRlbXMpIHsNCiAgICAgICAgICAgICAgICBfdGhpczE5LnVuaGlnaGxpZ2h0QWxsKCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgX3RoaXMxOS5oaWRlRHJvcGRvd24odHJ1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSwNCiAgICAgICAgICAnc2VsZWN0LW9uZSc6IGZ1bmN0aW9uIHNlbGVjdE9uZSgpIHsNCiAgICAgICAgICAgIF90aGlzMTkuY29udGFpbmVyT3V0ZXIucmVtb3ZlRm9jdXNTdGF0ZSgpOw0KICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gX3RoaXMxOS5pbnB1dC5lbGVtZW50IHx8IHRhcmdldCA9PT0gX3RoaXMxOS5jb250YWluZXJPdXRlci5lbGVtZW50ICYmICFfdGhpczE5Ll9jYW5TZWFyY2gpIHsNCiAgICAgICAgICAgICAgX3RoaXMxOS5oaWRlRHJvcGRvd24odHJ1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSwNCiAgICAgICAgICAnc2VsZWN0LW11bHRpcGxlJzogZnVuY3Rpb24gc2VsZWN0TXVsdGlwbGUoKSB7DQogICAgICAgICAgICBpZiAodGFyZ2V0ID09PSBfdGhpczE5LmlucHV0LmVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgX3RoaXMxOS5jb250YWluZXJPdXRlci5yZW1vdmVGb2N1c1N0YXRlKCk7DQogICAgICAgICAgICAgIF90aGlzMTkuaGlkZURyb3Bkb3duKHRydWUpOw0KICAgICAgICAgICAgICBpZiAoaGFzSGlnaGxpZ2h0ZWRJdGVtcykgew0KICAgICAgICAgICAgICAgIF90aGlzMTkudW5oaWdobGlnaHRBbGwoKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICBibHVyQWN0aW9uc1t0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC50eXBlXSgpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8gT24gSUUxMSwgY2xpY2tpbmcgdGhlIHNjb2xsYmFyIGJsdXJzIG91ciBpbnB1dCBhbmQgdGh1cw0KICAgICAgICAvLyBjbG9zZXMgdGhlIGRyb3Bkb3duLiBUbyBzdG9wIHRoaXMsIHdlIHJlZm9jdXMgb3VyIGlucHV0DQogICAgICAgIC8vIGlmIHdlIGtub3cgd2UgYXJlIG9uIElFICphbmQqIGFyZSBzY3JvbGxpbmcuDQogICAgICAgIHRoaXMuX2lzU2Nyb2xsaW5nT25JZSA9IGZhbHNlOw0KICAgICAgICB0aGlzLmlucHV0LmVsZW1lbnQuZm9jdXMoKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25Gb3JtUmVzZXQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Gb3JtUmVzZXQoKSB7DQogICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX21pc2MucmVzZXRUbykodGhpcy5faW5pdGlhbFN0YXRlKSk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2hpZ2hsaWdodENob2ljZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9oaWdobGlnaHRDaG9pY2UoKSB7DQogICAgICB2YXIgX3RoaXMyMCA9IHRoaXM7DQoNCiAgICAgIHZhciBlbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogbnVsbDsNCg0KICAgICAgdmFyIGNob2ljZXMgPSBBcnJheS5mcm9tKHRoaXMuZHJvcGRvd24uZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1jaG9pY2Utc2VsZWN0YWJsZV0nKSk7DQoNCiAgICAgIGlmICghY2hvaWNlcy5sZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICB2YXIgcGFzc2VkRWwgPSBlbDsNCiAgICAgIHZhciBoaWdobGlnaHRlZENob2ljZXMgPSBBcnJheS5mcm9tKHRoaXMuZHJvcGRvd24uZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuaGlnaGxpZ2h0ZWRTdGF0ZSkpOw0KDQogICAgICAvLyBSZW1vdmUgYW55IGhpZ2hsaWdodGVkIGNob2ljZXMNCiAgICAgIGhpZ2hsaWdodGVkQ2hvaWNlcy5mb3JFYWNoKGZ1bmN0aW9uIChjaG9pY2UpIHsNCiAgICAgICAgY2hvaWNlLmNsYXNzTGlzdC5yZW1vdmUoX3RoaXMyMC5jb25maWcuY2xhc3NOYW1lcy5oaWdobGlnaHRlZFN0YXRlKTsNCiAgICAgICAgY2hvaWNlLnNldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcsICdmYWxzZScpOw0KICAgICAgfSk7DQoNCiAgICAgIGlmIChwYXNzZWRFbCkgew0KICAgICAgICB0aGlzLl9oaWdobGlnaHRQb3NpdGlvbiA9IGNob2ljZXMuaW5kZXhPZihwYXNzZWRFbCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICAvLyBIaWdobGlnaHQgY2hvaWNlIGJhc2VkIG9uIGxhc3Qga25vd24gaGlnaGxpZ2h0IGxvY2F0aW9uDQogICAgICAgIGlmIChjaG9pY2VzLmxlbmd0aCA+IHRoaXMuX2hpZ2hsaWdodFBvc2l0aW9uKSB7DQogICAgICAgICAgLy8gSWYgd2UgaGF2ZSBhbiBvcHRpb24gdG8gaGlnaGxpZ2h0DQogICAgICAgICAgcGFzc2VkRWwgPSBjaG9pY2VzW3RoaXMuX2hpZ2hsaWdodFBvc2l0aW9uXTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAvLyBPdGhlcndpc2UgaGlnaGxpZ2h0IHRoZSBvcHRpb24gYmVmb3JlDQogICAgICAgICAgcGFzc2VkRWwgPSBjaG9pY2VzW2Nob2ljZXMubGVuZ3RoIC0gMV07DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIXBhc3NlZEVsKSB7DQogICAgICAgICAgcGFzc2VkRWwgPSBjaG9pY2VzWzBdOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHBhc3NlZEVsLmNsYXNzTGlzdC5hZGQodGhpcy5jb25maWcuY2xhc3NOYW1lcy5oaWdobGlnaHRlZFN0YXRlKTsNCiAgICAgIHBhc3NlZEVsLnNldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcsICd0cnVlJyk7DQogICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLmhpZ2hsaWdodENob2ljZSwgeyBlbDogcGFzc2VkRWwgfSk7DQoNCiAgICAgIGlmICh0aGlzLmRyb3Bkb3duLmlzQWN0aXZlKSB7DQogICAgICAgIC8vIElFMTEgaWdub3JlcyBhcmlhLWxhYmVsIGFuZCBibG9ja3MgdmlydHVhbCBrZXlib2FyZA0KICAgICAgICAvLyBpZiBhcmlhLWFjdGl2ZWRlc2NlbmRhbnQgaXMgc2V0IHdpdGhvdXQgYSBkcm9wZG93bg0KICAgICAgICB0aGlzLmlucHV0LnNldEFjdGl2ZURlc2NlbmRhbnQocGFzc2VkRWwuaWQpOw0KICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLnNldEFjdGl2ZURlc2NlbmRhbnQocGFzc2VkRWwuaWQpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19hZGRJdGVtJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZEl0ZW0oX3JlZjEyKSB7DQogICAgICB2YXIgdmFsdWUgPSBfcmVmMTIudmFsdWUsDQogICAgICAgICAgX3JlZjEyJGxhYmVsID0gX3JlZjEyLmxhYmVsLA0KICAgICAgICAgIGxhYmVsID0gX3JlZjEyJGxhYmVsID09PSB1bmRlZmluZWQgPyBudWxsIDogX3JlZjEyJGxhYmVsLA0KICAgICAgICAgIF9yZWYxMiRjaG9pY2VJZCA9IF9yZWYxMi5jaG9pY2VJZCwNCiAgICAgICAgICBjaG9pY2VJZCA9IF9yZWYxMiRjaG9pY2VJZCA9PT0gdW5kZWZpbmVkID8gLTEgOiBfcmVmMTIkY2hvaWNlSWQsDQogICAgICAgICAgX3JlZjEyJGdyb3VwSWQgPSBfcmVmMTIuZ3JvdXBJZCwNCiAgICAgICAgICBncm91cElkID0gX3JlZjEyJGdyb3VwSWQgPT09IHVuZGVmaW5lZCA/IC0xIDogX3JlZjEyJGdyb3VwSWQsDQogICAgICAgICAgX3JlZjEyJGN1c3RvbVByb3BlcnRpID0gX3JlZjEyLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgY3VzdG9tUHJvcGVydGllcyA9IF9yZWYxMiRjdXN0b21Qcm9wZXJ0aSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IF9yZWYxMiRjdXN0b21Qcm9wZXJ0aSwNCiAgICAgICAgICBfcmVmMTIkcGxhY2Vob2xkZXIgPSBfcmVmMTIucGxhY2Vob2xkZXIsDQogICAgICAgICAgcGxhY2Vob2xkZXIgPSBfcmVmMTIkcGxhY2Vob2xkZXIgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZjEyJHBsYWNlaG9sZGVyLA0KICAgICAgICAgIF9yZWYxMiRrZXlDb2RlID0gX3JlZjEyLmtleUNvZGUsDQogICAgICAgICAga2V5Q29kZSA9IF9yZWYxMiRrZXlDb2RlID09PSB1bmRlZmluZWQgPyBudWxsIDogX3JlZjEyJGtleUNvZGU7DQoNCiAgICAgIHZhciBwYXNzZWRWYWx1ZSA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnU3RyaW5nJywgdmFsdWUpID8gdmFsdWUudHJpbSgpIDogdmFsdWU7DQoNCiAgICAgIHZhciBwYXNzZWRLZXlDb2RlID0ga2V5Q29kZTsNCiAgICAgIHZhciBwYXNzZWRDdXN0b21Qcm9wZXJ0aWVzID0gY3VzdG9tUHJvcGVydGllczsNCiAgICAgIHZhciBpdGVtcyA9IHRoaXMuX3N0b3JlLml0ZW1zOw0KICAgICAgdmFyIHBhc3NlZExhYmVsID0gbGFiZWwgfHwgcGFzc2VkVmFsdWU7DQogICAgICB2YXIgcGFzc2VkT3B0aW9uSWQgPSBwYXJzZUludChjaG9pY2VJZCwgMTApIHx8IC0xOw0KICAgICAgdmFyIGdyb3VwID0gZ3JvdXBJZCA+PSAwID8gdGhpcy5fc3RvcmUuZ2V0R3JvdXBCeUlkKGdyb3VwSWQpIDogbnVsbDsNCiAgICAgIHZhciBpZCA9IGl0ZW1zID8gaXRlbXMubGVuZ3RoICsgMSA6IDE7DQoNCiAgICAgIC8vIElmIGEgcHJlcGVuZGVkIHZhbHVlIGhhcyBiZWVuIHBhc3NlZCwgcHJlcGVuZCBpdA0KICAgICAgaWYgKHRoaXMuY29uZmlnLnByZXBlbmRWYWx1ZSkgew0KICAgICAgICBwYXNzZWRWYWx1ZSA9IHRoaXMuY29uZmlnLnByZXBlbmRWYWx1ZSArIHBhc3NlZFZhbHVlLnRvU3RyaW5nKCk7DQogICAgICB9DQoNCiAgICAgIC8vIElmIGFuIGFwcGVuZGVkIHZhbHVlIGhhcyBiZWVuIHBhc3NlZCwgYXBwZW5kIGl0DQogICAgICBpZiAodGhpcy5jb25maWcuYXBwZW5kVmFsdWUpIHsNCiAgICAgICAgcGFzc2VkVmFsdWUgKz0gdGhpcy5jb25maWcuYXBwZW5kVmFsdWUudG9TdHJpbmcoKTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9pdGVtcy5hZGRJdGVtKSh7DQogICAgICAgIHZhbHVlOiBwYXNzZWRWYWx1ZSwNCiAgICAgICAgbGFiZWw6IHBhc3NlZExhYmVsLA0KICAgICAgICBpZDogaWQsDQogICAgICAgIGNob2ljZUlkOiBwYXNzZWRPcHRpb25JZCwNCiAgICAgICAgZ3JvdXBJZDogZ3JvdXBJZCwNCiAgICAgICAgY3VzdG9tUHJvcGVydGllczogY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyLA0KICAgICAgICBrZXlDb2RlOiBwYXNzZWRLZXlDb2RlDQogICAgICB9KSk7DQoNCiAgICAgIGlmICh0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgdGhpcy5yZW1vdmVBY3RpdmVJdGVtcyhpZCk7DQogICAgICB9DQoNCiAgICAgIC8vIFRyaWdnZXIgY2hhbmdlIGV2ZW50DQogICAgICBpZiAoZ3JvdXAgJiYgZ3JvdXAudmFsdWUpIHsNCiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5hZGRJdGVtLCB7DQogICAgICAgICAgaWQ6IGlkLA0KICAgICAgICAgIHZhbHVlOiBwYXNzZWRWYWx1ZSwNCiAgICAgICAgICBsYWJlbDogcGFzc2VkTGFiZWwsDQogICAgICAgICAgY3VzdG9tUHJvcGVydGllczogcGFzc2VkQ3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICBncm91cFZhbHVlOiBncm91cC52YWx1ZSwNCiAgICAgICAgICBrZXlDb2RlOiBwYXNzZWRLZXlDb2RlDQogICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5hZGRJdGVtLCB7DQogICAgICAgICAgaWQ6IGlkLA0KICAgICAgICAgIHZhbHVlOiBwYXNzZWRWYWx1ZSwNCiAgICAgICAgICBsYWJlbDogcGFzc2VkTGFiZWwsDQogICAgICAgICAgY3VzdG9tUHJvcGVydGllczogcGFzc2VkQ3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICBrZXlDb2RlOiBwYXNzZWRLZXlDb2RlDQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfcmVtb3ZlSXRlbScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW1vdmVJdGVtKGl0ZW0pIHsNCiAgICAgIGlmICghaXRlbSB8fCAhKDAsIF91dGlscy5pc1R5cGUpKCdPYmplY3QnLCBpdGVtKSkgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgdmFyIGlkID0gaXRlbS5pZCwNCiAgICAgICAgICB2YWx1ZSA9IGl0ZW0udmFsdWUsDQogICAgICAgICAgbGFiZWwgPSBpdGVtLmxhYmVsLA0KICAgICAgICAgIGNob2ljZUlkID0gaXRlbS5jaG9pY2VJZCwNCiAgICAgICAgICBncm91cElkID0gaXRlbS5ncm91cElkOw0KDQogICAgICB2YXIgZ3JvdXAgPSBncm91cElkID49IDAgPyB0aGlzLl9zdG9yZS5nZXRHcm91cEJ5SWQoZ3JvdXBJZCkgOiBudWxsOw0KDQogICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX2l0ZW1zLnJlbW92ZUl0ZW0pKGlkLCBjaG9pY2VJZCkpOw0KDQogICAgICBpZiAoZ3JvdXAgJiYgZ3JvdXAudmFsdWUpIHsNCiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5yZW1vdmVJdGVtLCB7DQogICAgICAgICAgaWQ6IGlkLA0KICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICBsYWJlbDogbGFiZWwsDQogICAgICAgICAgZ3JvdXBWYWx1ZTogZ3JvdXAudmFsdWUNCiAgICAgICAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLnJlbW92ZUl0ZW0sIHsNCiAgICAgICAgICBpZDogaWQsDQogICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgIGxhYmVsOiBsYWJlbA0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2FkZENob2ljZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9hZGRDaG9pY2UoX3JlZjEzKSB7DQogICAgICB2YXIgdmFsdWUgPSBfcmVmMTMudmFsdWUsDQogICAgICAgICAgX3JlZjEzJGxhYmVsID0gX3JlZjEzLmxhYmVsLA0KICAgICAgICAgIGxhYmVsID0gX3JlZjEzJGxhYmVsID09PSB1bmRlZmluZWQgPyBudWxsIDogX3JlZjEzJGxhYmVsLA0KICAgICAgICAgIF9yZWYxMyRpc1NlbGVjdGVkID0gX3JlZjEzLmlzU2VsZWN0ZWQsDQogICAgICAgICAgaXNTZWxlY3RlZCA9IF9yZWYxMyRpc1NlbGVjdGVkID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYxMyRpc1NlbGVjdGVkLA0KICAgICAgICAgIF9yZWYxMyRpc0Rpc2FibGVkID0gX3JlZjEzLmlzRGlzYWJsZWQsDQogICAgICAgICAgaXNEaXNhYmxlZCA9IF9yZWYxMyRpc0Rpc2FibGVkID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYxMyRpc0Rpc2FibGVkLA0KICAgICAgICAgIF9yZWYxMyRncm91cElkID0gX3JlZjEzLmdyb3VwSWQsDQogICAgICAgICAgZ3JvdXBJZCA9IF9yZWYxMyRncm91cElkID09PSB1bmRlZmluZWQgPyAtMSA6IF9yZWYxMyRncm91cElkLA0KICAgICAgICAgIF9yZWYxMyRjdXN0b21Qcm9wZXJ0aSA9IF9yZWYxMy5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXMgPSBfcmVmMTMkY3VzdG9tUHJvcGVydGkgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBfcmVmMTMkY3VzdG9tUHJvcGVydGksDQogICAgICAgICAgX3JlZjEzJHBsYWNlaG9sZGVyID0gX3JlZjEzLnBsYWNlaG9sZGVyLA0KICAgICAgICAgIHBsYWNlaG9sZGVyID0gX3JlZjEzJHBsYWNlaG9sZGVyID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYxMyRwbGFjZWhvbGRlciwNCiAgICAgICAgICBfcmVmMTMka2V5Q29kZSA9IF9yZWYxMy5rZXlDb2RlLA0KICAgICAgICAgIGtleUNvZGUgPSBfcmVmMTMka2V5Q29kZSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IF9yZWYxMyRrZXlDb2RlOw0KDQogICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyB8fCB2YWx1ZSA9PT0gbnVsbCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBpZA0KICAgICAgdmFyIGNob2ljZXMgPSB0aGlzLl9zdG9yZS5jaG9pY2VzOw0KICAgICAgdmFyIGNob2ljZUxhYmVsID0gbGFiZWwgfHwgdmFsdWU7DQogICAgICB2YXIgY2hvaWNlSWQgPSBjaG9pY2VzID8gY2hvaWNlcy5sZW5ndGggKyAxIDogMTsNCiAgICAgIHZhciBjaG9pY2VFbGVtZW50SWQgPSB0aGlzLl9iYXNlSWQgKyAnLScgKyB0aGlzLl9pZE5hbWVzLml0ZW1DaG9pY2UgKyAnLScgKyBjaG9pY2VJZDsNCg0KICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9jaG9pY2VzLmFkZENob2ljZSkoew0KICAgICAgICB2YWx1ZTogdmFsdWUsDQogICAgICAgIGxhYmVsOiBjaG9pY2VMYWJlbCwNCiAgICAgICAgaWQ6IGNob2ljZUlkLA0KICAgICAgICBncm91cElkOiBncm91cElkLA0KICAgICAgICBkaXNhYmxlZDogaXNEaXNhYmxlZCwNCiAgICAgICAgZWxlbWVudElkOiBjaG9pY2VFbGVtZW50SWQsDQogICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlciwNCiAgICAgICAga2V5Q29kZToga2V5Q29kZQ0KICAgICAgfSkpOw0KDQogICAgICBpZiAoaXNTZWxlY3RlZCkgew0KICAgICAgICB0aGlzLl9hZGRJdGVtKHsNCiAgICAgICAgICB2YWx1ZTogdmFsdWUsDQogICAgICAgICAgbGFiZWw6IGNob2ljZUxhYmVsLA0KICAgICAgICAgIGNob2ljZUlkOiBjaG9pY2VJZCwNCiAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBjdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlciwNCiAgICAgICAgICBrZXlDb2RlOiBrZXlDb2RlDQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19jbGVhckNob2ljZXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfY2xlYXJDaG9pY2VzKCkgew0KICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9jaG9pY2VzLmNsZWFyQ2hvaWNlcykoKSk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2FkZEdyb3VwJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZEdyb3VwKF9yZWYxNCkgew0KICAgICAgdmFyIF90aGlzMjEgPSB0aGlzOw0KDQogICAgICB2YXIgZ3JvdXAgPSBfcmVmMTQuZ3JvdXAsDQogICAgICAgICAgaWQgPSBfcmVmMTQuaWQsDQogICAgICAgICAgX3JlZjE0JHZhbHVlS2V5ID0gX3JlZjE0LnZhbHVlS2V5LA0KICAgICAgICAgIHZhbHVlS2V5ID0gX3JlZjE0JHZhbHVlS2V5ID09PSB1bmRlZmluZWQgPyAndmFsdWUnIDogX3JlZjE0JHZhbHVlS2V5LA0KICAgICAgICAgIF9yZWYxNCRsYWJlbEtleSA9IF9yZWYxNC5sYWJlbEtleSwNCiAgICAgICAgICBsYWJlbEtleSA9IF9yZWYxNCRsYWJlbEtleSA9PT0gdW5kZWZpbmVkID8gJ2xhYmVsJyA6IF9yZWYxNCRsYWJlbEtleTsNCg0KICAgICAgdmFyIGdyb3VwQ2hvaWNlcyA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnT2JqZWN0JywgZ3JvdXApID8gZ3JvdXAuY2hvaWNlcyA6IEFycmF5LmZyb20oZ3JvdXAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ09QVElPTicpKTsNCiAgICAgIHZhciBncm91cElkID0gaWQgfHwgTWF0aC5mbG9vcihuZXcgRGF0ZSgpLnZhbHVlT2YoKSAqIE1hdGgucmFuZG9tKCkpOw0KICAgICAgdmFyIGlzRGlzYWJsZWQgPSBncm91cC5kaXNhYmxlZCA/IGdyb3VwLmRpc2FibGVkIDogZmFsc2U7DQoNCiAgICAgIGlmIChncm91cENob2ljZXMpIHsNCiAgICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9ncm91cHMuYWRkR3JvdXApKGdyb3VwLmxhYmVsLCBncm91cElkLCB0cnVlLCBpc0Rpc2FibGVkKSk7DQoNCiAgICAgICAgdmFyIGFkZEdyb3VwQ2hvaWNlcyA9IGZ1bmN0aW9uIGFkZEdyb3VwQ2hvaWNlcyhjaG9pY2UpIHsNCiAgICAgICAgICB2YXIgaXNPcHREaXNhYmxlZCA9IGNob2ljZS5kaXNhYmxlZCB8fCBjaG9pY2UucGFyZW50Tm9kZSAmJiBjaG9pY2UucGFyZW50Tm9kZS5kaXNhYmxlZDsNCg0KICAgICAgICAgIF90aGlzMjEuX2FkZENob2ljZSh7DQogICAgICAgICAgICB2YWx1ZTogY2hvaWNlW3ZhbHVlS2V5XSwNCiAgICAgICAgICAgIGxhYmVsOiAoMCwgX3V0aWxzLmlzVHlwZSkoJ09iamVjdCcsIGNob2ljZSkgPyBjaG9pY2VbbGFiZWxLZXldIDogY2hvaWNlLmlubmVySFRNTCwNCiAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IGNob2ljZS5zZWxlY3RlZCwNCiAgICAgICAgICAgIGlzRGlzYWJsZWQ6IGlzT3B0RGlzYWJsZWQsDQogICAgICAgICAgICBncm91cElkOiBncm91cElkLA0KICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllczogY2hvaWNlLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgICBwbGFjZWhvbGRlcjogY2hvaWNlLnBsYWNlaG9sZGVyDQogICAgICAgICAgfSk7DQogICAgICAgIH07DQoNCiAgICAgICAgZ3JvdXBDaG9pY2VzLmZvckVhY2goYWRkR3JvdXBDaG9pY2VzKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfZ3JvdXBzLmFkZEdyb3VwKShncm91cC5sYWJlbCwgZ3JvdXAuaWQsIGZhbHNlLCBncm91cC5kaXNhYmxlZCkpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19nZXRUZW1wbGF0ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRUZW1wbGF0ZSh0ZW1wbGF0ZSkgew0KICAgICAgdmFyIF90ZW1wbGF0ZXMkdGVtcGxhdGU7DQoNCiAgICAgIGlmICghdGVtcGxhdGUpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICB9DQoNCiAgICAgIHZhciBfY29uZmlnNCA9IHRoaXMuY29uZmlnLA0KICAgICAgICAgIHRlbXBsYXRlcyA9IF9jb25maWc0LnRlbXBsYXRlcywNCiAgICAgICAgICBjbGFzc05hbWVzID0gX2NvbmZpZzQuY2xhc3NOYW1lczsNCg0KICAgICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBBcnJheShfbGVuID4gMSA/IF9sZW4gLSAxIDogMCksIF9rZXkgPSAxOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7DQogICAgICAgIGFyZ3NbX2tleSAtIDFdID0gYXJndW1lbnRzW19rZXldOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gKF90ZW1wbGF0ZXMkdGVtcGxhdGUgPSB0ZW1wbGF0ZXNbdGVtcGxhdGVdKS5jYWxsLmFwcGx5KF90ZW1wbGF0ZXMkdGVtcGxhdGUsIFt0aGlzLCBjbGFzc05hbWVzXS5jb25jYXQoYXJncykpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19jcmVhdGVUZW1wbGF0ZXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlVGVtcGxhdGVzKCkgew0KICAgICAgdmFyIGNhbGxiYWNrT25DcmVhdGVUZW1wbGF0ZXMgPSB0aGlzLmNvbmZpZy5jYWxsYmFja09uQ3JlYXRlVGVtcGxhdGVzOw0KDQogICAgICB2YXIgdXNlclRlbXBsYXRlcyA9IHt9Ow0KDQogICAgICBpZiAoY2FsbGJhY2tPbkNyZWF0ZVRlbXBsYXRlcyAmJiAoMCwgX3V0aWxzLmlzVHlwZSkoJ0Z1bmN0aW9uJywgY2FsbGJhY2tPbkNyZWF0ZVRlbXBsYXRlcykpIHsNCiAgICAgICAgdXNlclRlbXBsYXRlcyA9IGNhbGxiYWNrT25DcmVhdGVUZW1wbGF0ZXMuY2FsbCh0aGlzLCBfdXRpbHMuc3RyVG9FbCk7DQogICAgICB9DQoNCiAgICAgIHRoaXMuY29uZmlnLnRlbXBsYXRlcyA9ICgwLCBfdXRpbHMuZXh0ZW5kKShfdGVtcGxhdGVzLlRFTVBMQVRFUywgdXNlclRlbXBsYXRlcyk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2NyZWF0ZUVsZW1lbnRzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZUVsZW1lbnRzKCkgew0KICAgICAgdGhpcy5jb250YWluZXJPdXRlciA9IG5ldyBfY29tcG9uZW50cy5Db250YWluZXIoew0KICAgICAgICBlbGVtZW50OiB0aGlzLl9nZXRUZW1wbGF0ZSgnY29udGFpbmVyT3V0ZXInLCB0aGlzLl9kaXJlY3Rpb24sIHRoaXMuX2lzU2VsZWN0RWxlbWVudCwgdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50LCB0aGlzLmNvbmZpZy5zZWFyY2hFbmFibGVkLCB0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC50eXBlKSwNCiAgICAgICAgY2xhc3NOYW1lczogdGhpcy5jb25maWcuY2xhc3NOYW1lcywNCiAgICAgICAgdHlwZTogdGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQudHlwZSwNCiAgICAgICAgcG9zaXRpb246IHRoaXMuY29uZmlnLnBvc2l0aW9uDQogICAgICB9KTsNCg0KICAgICAgdGhpcy5jb250YWluZXJJbm5lciA9IG5ldyBfY29tcG9uZW50cy5Db250YWluZXIoew0KICAgICAgICBlbGVtZW50OiB0aGlzLl9nZXRUZW1wbGF0ZSgnY29udGFpbmVySW5uZXInKSwNCiAgICAgICAgY2xhc3NOYW1lczogdGhpcy5jb25maWcuY2xhc3NOYW1lcywNCiAgICAgICAgdHlwZTogdGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQudHlwZSwNCiAgICAgICAgcG9zaXRpb246IHRoaXMuY29uZmlnLnBvc2l0aW9uDQogICAgICB9KTsNCg0KICAgICAgdGhpcy5pbnB1dCA9IG5ldyBfY29tcG9uZW50cy5JbnB1dCh7DQogICAgICAgIGVsZW1lbnQ6IHRoaXMuX2dldFRlbXBsYXRlKCdpbnB1dCcpLA0KICAgICAgICBjbGFzc05hbWVzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLA0KICAgICAgICB0eXBlOiB0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC50eXBlDQogICAgICB9KTsNCg0KICAgICAgdGhpcy5jaG9pY2VMaXN0ID0gbmV3IF9jb21wb25lbnRzLkxpc3Qoew0KICAgICAgICBlbGVtZW50OiB0aGlzLl9nZXRUZW1wbGF0ZSgnY2hvaWNlTGlzdCcsIHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkNCiAgICAgIH0pOw0KDQogICAgICB0aGlzLml0ZW1MaXN0ID0gbmV3IF9jb21wb25lbnRzLkxpc3Qoew0KICAgICAgICBlbGVtZW50OiB0aGlzLl9nZXRUZW1wbGF0ZSgnaXRlbUxpc3QnLCB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpDQogICAgICB9KTsNCg0KICAgICAgdGhpcy5kcm9wZG93biA9IG5ldyBfY29tcG9uZW50cy5Ecm9wZG93bih7DQogICAgICAgIGVsZW1lbnQ6IHRoaXMuX2dldFRlbXBsYXRlKCdkcm9wZG93bicpLA0KICAgICAgICBjbGFzc05hbWVzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLA0KICAgICAgICB0eXBlOiB0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC50eXBlDQogICAgICB9KTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfY3JlYXRlU3RydWN0dXJlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZVN0cnVjdHVyZSgpIHsNCiAgICAgIC8vIEhpZGUgb3JpZ2luYWwgZWxlbWVudA0KICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LmNvbmNlYWwoKTsNCiAgICAgIC8vIFdyYXAgaW5wdXQgaW4gY29udGFpbmVyIHByZXNlcnZpbmcgRE9NIG9yZGVyaW5nDQogICAgICB0aGlzLmNvbnRhaW5lcklubmVyLndyYXAodGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQpOw0KICAgICAgLy8gV3JhcHBlciBpbm5lciBjb250YWluZXIgd2l0aCBvdXRlciBjb250YWluZXINCiAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIud3JhcCh0aGlzLmNvbnRhaW5lcklubmVyLmVsZW1lbnQpOw0KDQogICAgICBpZiAodGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7DQogICAgICAgIHRoaXMuaW5wdXQucGxhY2Vob2xkZXIgPSB0aGlzLmNvbmZpZy5zZWFyY2hQbGFjZWhvbGRlclZhbHVlIHx8ICcnOw0KICAgICAgfSBlbHNlIGlmICh0aGlzLl9wbGFjZWhvbGRlclZhbHVlKSB7DQogICAgICAgIHRoaXMuaW5wdXQucGxhY2Vob2xkZXIgPSB0aGlzLl9wbGFjZWhvbGRlclZhbHVlOw0KICAgICAgICB0aGlzLmlucHV0LnNldFdpZHRoKHRydWUpOw0KICAgICAgfQ0KDQogICAgICB0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5jb250YWluZXJJbm5lci5lbGVtZW50KTsNCiAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmRyb3Bkb3duLmVsZW1lbnQpOw0KICAgICAgdGhpcy5jb250YWluZXJJbm5lci5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuaXRlbUxpc3QuZWxlbWVudCk7DQoNCiAgICAgIGlmICghdGhpcy5faXNUZXh0RWxlbWVudCkgew0KICAgICAgICB0aGlzLmRyb3Bkb3duLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5jaG9pY2VMaXN0LmVsZW1lbnQpOw0KICAgICAgfQ0KDQogICAgICBpZiAoIXRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgew0KICAgICAgICB0aGlzLmNvbnRhaW5lcklubmVyLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5pbnB1dC5lbGVtZW50KTsNCiAgICAgIH0gZWxzZSBpZiAodGhpcy5jb25maWcuc2VhcmNoRW5hYmxlZCkgew0KICAgICAgICB0aGlzLmRyb3Bkb3duLmVsZW1lbnQuaW5zZXJ0QmVmb3JlKHRoaXMuaW5wdXQuZWxlbWVudCwgdGhpcy5kcm9wZG93bi5lbGVtZW50LmZpcnN0Q2hpbGQpOw0KICAgICAgfQ0KDQogICAgICBpZiAodGhpcy5faXNTZWxlY3RFbGVtZW50KSB7DQogICAgICAgIHRoaXMuX2FkZFByZWRlZmluZWRDaG9pY2VzKCk7DQogICAgICB9IGVsc2UgaWYgKHRoaXMuX2lzVGV4dEVsZW1lbnQpIHsNCiAgICAgICAgdGhpcy5fYWRkUHJlZGVmaW5lZEl0ZW1zKCk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2FkZFByZWRlZmluZWRDaG9pY2VzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZFByZWRlZmluZWRDaG9pY2VzKCkgew0KICAgICAgdmFyIF90aGlzMjIgPSB0aGlzOw0KDQogICAgICB2YXIgcGFzc2VkR3JvdXBzID0gdGhpcy5wYXNzZWRFbGVtZW50Lm9wdGlvbkdyb3VwczsNCg0KICAgICAgdGhpcy5faGlnaGxpZ2h0UG9zaXRpb24gPSAwOw0KICAgICAgdGhpcy5faXNTZWFyY2hpbmcgPSBmYWxzZTsNCg0KICAgICAgaWYgKHBhc3NlZEdyb3VwcyAmJiBwYXNzZWRHcm91cHMubGVuZ3RoKSB7DQogICAgICAgIC8vIElmIHdlIGhhdmUgYSBwbGFjZWhvbGRlciBvcHRpb24NCiAgICAgICAgdmFyIHBsYWNlaG9sZGVyQ2hvaWNlID0gdGhpcy5wYXNzZWRFbGVtZW50LnBsYWNlaG9sZGVyT3B0aW9uOw0KICAgICAgICBpZiAocGxhY2Vob2xkZXJDaG9pY2UgJiYgcGxhY2Vob2xkZXJDaG9pY2UucGFyZW50Tm9kZS50YWdOYW1lID09PSAnU0VMRUNUJykgew0KICAgICAgICAgIHRoaXMuX2FkZENob2ljZSh7DQogICAgICAgICAgICB2YWx1ZTogcGxhY2Vob2xkZXJDaG9pY2UudmFsdWUsDQogICAgICAgICAgICBsYWJlbDogcGxhY2Vob2xkZXJDaG9pY2UuaW5uZXJIVE1MLA0KICAgICAgICAgICAgaXNTZWxlY3RlZDogcGxhY2Vob2xkZXJDaG9pY2Uuc2VsZWN0ZWQsDQogICAgICAgICAgICBpc0Rpc2FibGVkOiBwbGFjZWhvbGRlckNob2ljZS5kaXNhYmxlZCwNCiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiB0cnVlDQogICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBwYXNzZWRHcm91cHMuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXApIHsNCiAgICAgICAgICByZXR1cm4gX3RoaXMyMi5fYWRkR3JvdXAoew0KICAgICAgICAgICAgZ3JvdXA6IGdyb3VwLA0KICAgICAgICAgICAgaWQ6IGdyb3VwLmlkIHx8IG51bGwNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB2YXIgcGFzc2VkT3B0aW9ucyA9IHRoaXMucGFzc2VkRWxlbWVudC5vcHRpb25zOw0KICAgICAgICB2YXIgZmlsdGVyID0gdGhpcy5jb25maWcuc29ydEZuOw0KICAgICAgICB2YXIgYWxsQ2hvaWNlcyA9IHRoaXMuX3ByZXNldENob2ljZXM7DQoNCiAgICAgICAgLy8gQ3JlYXRlIGFycmF5IG9mIG9wdGlvbnMgZnJvbSBvcHRpb24gZWxlbWVudHMNCiAgICAgICAgcGFzc2VkT3B0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChvKSB7DQogICAgICAgICAgYWxsQ2hvaWNlcy5wdXNoKHsNCiAgICAgICAgICAgIHZhbHVlOiBvLnZhbHVlLA0KICAgICAgICAgICAgbGFiZWw6IG8uaW5uZXJIVE1MLA0KICAgICAgICAgICAgc2VsZWN0ZWQ6IG8uc2VsZWN0ZWQsDQogICAgICAgICAgICBkaXNhYmxlZDogby5kaXNhYmxlZCB8fCBvLnBhcmVudE5vZGUuZGlzYWJsZWQsDQogICAgICAgICAgICBwbGFjZWhvbGRlcjogby5oYXNBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJykNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gSWYgc29ydGluZyBpcyBlbmFibGVkIG9yIHRoZSB1c2VyIGlzIHNlYXJjaGluZywgZmlsdGVyIGNob2ljZXMNCiAgICAgICAgaWYgKHRoaXMuY29uZmlnLnNob3VsZFNvcnQpIHsNCiAgICAgICAgICBhbGxDaG9pY2VzLnNvcnQoZmlsdGVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIERldGVybWluZSB3aGV0aGVyIHRoZXJlIGlzIGEgc2VsZWN0ZWQgY2hvaWNlDQogICAgICAgIHZhciBoYXNTZWxlY3RlZENob2ljZSA9IGFsbENob2ljZXMuc29tZShmdW5jdGlvbiAoY2hvaWNlKSB7DQogICAgICAgICAgcmV0dXJuIGNob2ljZS5zZWxlY3RlZDsNCiAgICAgICAgfSk7DQogICAgICAgIHZhciBoYW5kbGVDaG9pY2UgPSBmdW5jdGlvbiBoYW5kbGVDaG9pY2UoY2hvaWNlLCBpbmRleCkgew0KICAgICAgICAgIHZhciB2YWx1ZSA9IGNob2ljZS52YWx1ZSwNCiAgICAgICAgICAgICAgbGFiZWwgPSBjaG9pY2UubGFiZWwsDQogICAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXMgPSBjaG9pY2UuY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXIgPSBjaG9pY2UucGxhY2Vob2xkZXI7DQoNCg0KICAgICAgICAgIGlmIChfdGhpczIyLl9pc1NlbGVjdEVsZW1lbnQpIHsNCiAgICAgICAgICAgIC8vIElmIHRoZSBjaG9pY2UgaXMgYWN0dWFsbHkgYSBncm91cA0KICAgICAgICAgICAgaWYgKGNob2ljZS5jaG9pY2VzKSB7DQogICAgICAgICAgICAgIF90aGlzMjIuX2FkZEdyb3VwKHsNCiAgICAgICAgICAgICAgICBncm91cDogY2hvaWNlLA0KICAgICAgICAgICAgICAgIGlkOiBjaG9pY2UuaWQgfHwgbnVsbA0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGEgc2VsZWN0ZWQgY2hvaWNlIGFscmVhZHkgb3IgdGhlIGNob2ljZSBpcyBub3QNCiAgICAgICAgICAgICAgLy8gdGhlIGZpcnN0IGluIHRoZSBhcnJheSwgYWRkIGVhY2ggY2hvaWNlIG5vcm1hbGx5DQogICAgICAgICAgICAgIC8vIE90aGVyd2lzZSBwcmUtc2VsZWN0IHRoZSBmaXJzdCBjaG9pY2UgaW4gdGhlIGFycmF5IGlmIGl0J3MgYSBzaW5nbGUgc2VsZWN0DQogICAgICAgICAgICAgIHZhciBzaG91bGRQcmVzZWxlY3QgPSBfdGhpczIyLl9pc1NlbGVjdE9uZUVsZW1lbnQgJiYgIWhhc1NlbGVjdGVkQ2hvaWNlICYmIGluZGV4ID09PSAwOw0KICAgICAgICAgICAgICB2YXIgaXNTZWxlY3RlZCA9IHNob3VsZFByZXNlbGVjdCA/IHRydWUgOiBjaG9pY2Uuc2VsZWN0ZWQ7DQogICAgICAgICAgICAgIHZhciBpc0Rpc2FibGVkID0gc2hvdWxkUHJlc2VsZWN0ID8gZmFsc2UgOiBjaG9pY2UuZGlzYWJsZWQ7DQoNCiAgICAgICAgICAgICAgX3RoaXMyMi5fYWRkQ2hvaWNlKHsNCiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsDQogICAgICAgICAgICAgICAgbGFiZWw6IGxhYmVsLA0KICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IGlzU2VsZWN0ZWQsDQogICAgICAgICAgICAgICAgaXNEaXNhYmxlZDogaXNEaXNhYmxlZCwNCiAgICAgICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBjdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlcg0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgX3RoaXMyMi5fYWRkQ2hvaWNlKHsNCiAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgICAgICBsYWJlbDogbGFiZWwsDQogICAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IGNob2ljZS5zZWxlY3RlZCwNCiAgICAgICAgICAgICAgaXNEaXNhYmxlZDogY2hvaWNlLmRpc2FibGVkLA0KICAgICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBjdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXINCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICAvLyBBZGQgZWFjaCBjaG9pY2UNCiAgICAgICAgYWxsQ2hvaWNlcy5mb3JFYWNoKGZ1bmN0aW9uIChjaG9pY2UsIGluZGV4KSB7DQogICAgICAgICAgcmV0dXJuIGhhbmRsZUNob2ljZShjaG9pY2UsIGluZGV4KTsNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2FkZFByZWRlZmluZWRJdGVtcycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9hZGRQcmVkZWZpbmVkSXRlbXMoKSB7DQogICAgICB2YXIgX3RoaXMyMyA9IHRoaXM7DQoNCiAgICAgIHZhciBoYW5kbGVQcmVzZXRJdGVtID0gZnVuY3Rpb24gaGFuZGxlUHJlc2V0SXRlbShpdGVtKSB7DQogICAgICAgIHZhciBpdGVtVHlwZSA9ICgwLCBfdXRpbHMuZ2V0VHlwZSkoaXRlbSk7DQogICAgICAgIGlmIChpdGVtVHlwZSA9PT0gJ09iamVjdCcgJiYgaXRlbS52YWx1ZSkgew0KICAgICAgICAgIF90aGlzMjMuX2FkZEl0ZW0oew0KICAgICAgICAgICAgdmFsdWU6IGl0ZW0udmFsdWUsDQogICAgICAgICAgICBsYWJlbDogaXRlbS5sYWJlbCwNCiAgICAgICAgICAgIGNob2ljZUlkOiBpdGVtLmlkLA0KICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllczogaXRlbS5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGl0ZW0ucGxhY2Vob2xkZXINCiAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIGlmIChpdGVtVHlwZSA9PT0gJ1N0cmluZycpIHsNCiAgICAgICAgICBfdGhpczIzLl9hZGRJdGVtKHsNCiAgICAgICAgICAgIHZhbHVlOiBpdGVtDQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH07DQoNCiAgICAgIHRoaXMuX3ByZXNldEl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIGhhbmRsZVByZXNldEl0ZW0oaXRlbSk7DQogICAgICB9KTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfc2V0Q2hvaWNlT3JJdGVtJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NldENob2ljZU9ySXRlbShpdGVtKSB7DQogICAgICB2YXIgX3RoaXMyNCA9IHRoaXM7DQoNCiAgICAgIHZhciBpdGVtVHlwZSA9ICgwLCBfdXRpbHMuZ2V0VHlwZSkoaXRlbSkudG9Mb3dlckNhc2UoKTsNCiAgICAgIHZhciBoYW5kbGVUeXBlID0gew0KICAgICAgICBvYmplY3Q6IGZ1bmN0aW9uIG9iamVjdCgpIHsNCiAgICAgICAgICBpZiAoIWl0ZW0udmFsdWUpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyBJZiB3ZSBhcmUgZGVhbGluZyB3aXRoIGEgc2VsZWN0IGlucHV0LCB3ZSBuZWVkIHRvIGNyZWF0ZSBhbiBvcHRpb24gZmlyc3QNCiAgICAgICAgICAvLyB0aGF0IGlzIHRoZW4gc2VsZWN0ZWQuIEZvciB0ZXh0IGlucHV0cyB3ZSBjYW4ganVzdCBhZGQgaXRlbXMgbm9ybWFsbHkuDQogICAgICAgICAgaWYgKCFfdGhpczI0Ll9pc1RleHRFbGVtZW50KSB7DQogICAgICAgICAgICBfdGhpczI0Ll9hZGRDaG9pY2Uoew0KICAgICAgICAgICAgICB2YWx1ZTogaXRlbS52YWx1ZSwNCiAgICAgICAgICAgICAgbGFiZWw6IGl0ZW0ubGFiZWwsDQogICAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IHRydWUsDQogICAgICAgICAgICAgIGlzRGlzYWJsZWQ6IGZhbHNlLA0KICAgICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBpdGVtLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBpdGVtLnBsYWNlaG9sZGVyDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgX3RoaXMyNC5fYWRkSXRlbSh7DQogICAgICAgICAgICAgIHZhbHVlOiBpdGVtLnZhbHVlLA0KICAgICAgICAgICAgICBsYWJlbDogaXRlbS5sYWJlbCwNCiAgICAgICAgICAgICAgY2hvaWNlSWQ6IGl0ZW0uaWQsDQogICAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGl0ZW0uY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGl0ZW0ucGxhY2Vob2xkZXINCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgc3RyaW5nOiBmdW5jdGlvbiBzdHJpbmcoKSB7DQogICAgICAgICAgaWYgKCFfdGhpczI0Ll9pc1RleHRFbGVtZW50KSB7DQogICAgICAgICAgICBfdGhpczI0Ll9hZGRDaG9pY2Uoew0KICAgICAgICAgICAgICB2YWx1ZTogaXRlbSwNCiAgICAgICAgICAgICAgbGFiZWw6IGl0ZW0sDQogICAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IHRydWUsDQogICAgICAgICAgICAgIGlzRGlzYWJsZWQ6IGZhbHNlDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgX3RoaXMyNC5fYWRkSXRlbSh7DQogICAgICAgICAgICAgIHZhbHVlOiBpdGVtDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH07DQoNCiAgICAgIGhhbmRsZVR5cGVbaXRlbVR5cGVdKCk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2ZpbmRBbmRTZWxlY3RDaG9pY2VCeVZhbHVlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpbmRBbmRTZWxlY3RDaG9pY2VCeVZhbHVlKHZhbCkgew0KICAgICAgdmFyIF90aGlzMjUgPSB0aGlzOw0KDQogICAgICB2YXIgY2hvaWNlcyA9IHRoaXMuX3N0b3JlLmNob2ljZXM7DQogICAgICAvLyBDaGVjayAndmFsdWUnIHByb3BlcnR5IGV4aXN0cyBhbmQgdGhlIGNob2ljZSBpc24ndCBhbHJlYWR5IHNlbGVjdGVkDQogICAgICB2YXIgZm91bmRDaG9pY2UgPSBjaG9pY2VzLmZpbmQoZnVuY3Rpb24gKGNob2ljZSkgew0KICAgICAgICByZXR1cm4gX3RoaXMyNS5jb25maWcuaXRlbUNvbXBhcmVyKGNob2ljZS52YWx1ZSwgdmFsKTsNCiAgICAgIH0pOw0KDQogICAgICBpZiAoZm91bmRDaG9pY2UgJiYgIWZvdW5kQ2hvaWNlLnNlbGVjdGVkKSB7DQogICAgICAgIHRoaXMuX2FkZEl0ZW0oew0KICAgICAgICAgIHZhbHVlOiBmb3VuZENob2ljZS52YWx1ZSwNCiAgICAgICAgICBsYWJlbDogZm91bmRDaG9pY2UubGFiZWwsDQogICAgICAgICAgaWQ6IGZvdW5kQ2hvaWNlLmlkLA0KICAgICAgICAgIGdyb3VwSWQ6IGZvdW5kQ2hvaWNlLmdyb3VwSWQsDQogICAgICAgICAgY3VzdG9tUHJvcGVydGllczogZm91bmRDaG9pY2UuY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICBwbGFjZWhvbGRlcjogZm91bmRDaG9pY2UucGxhY2Vob2xkZXIsDQogICAgICAgICAga2V5Q29kZTogZm91bmRDaG9pY2Uua2V5Q29kZQ0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfZ2VuZXJhdGVJbnN0YW5jZXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2VuZXJhdGVJbnN0YW5jZXMoZWxlbWVudHMsIGNvbmZpZykgew0KICAgICAgcmV0dXJuIGVsZW1lbnRzLnJlZHVjZShmdW5jdGlvbiAoaW5zdGFuY2VzLCBlbGVtZW50KSB7DQogICAgICAgIGluc3RhbmNlcy5wdXNoKG5ldyBDaG9pY2VzKGVsZW1lbnQsIGNvbmZpZykpOw0KICAgICAgICByZXR1cm4gaW5zdGFuY2VzOw0KICAgICAgfSwgW3RoaXNdKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfZ2VuZXJhdGVQbGFjZWhvbGRlclZhbHVlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dlbmVyYXRlUGxhY2Vob2xkZXJWYWx1ZSgpIHsNCiAgICAgIGlmICh0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gdGhpcy5jb25maWcucGxhY2Vob2xkZXIgPyB0aGlzLmNvbmZpZy5wbGFjZWhvbGRlclZhbHVlIHx8IHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LmdldEF0dHJpYnV0ZSgncGxhY2Vob2xkZXInKSA6IGZhbHNlOw0KICAgIH0NCg0KICAgIC8qID09PT09ICBFbmQgb2YgUHJpdmF0ZSBmdW5jdGlvbnMgID09PT09PSAqLw0KDQogIH1dKTsNCg0KICByZXR1cm4gQ2hvaWNlczsNCn0oKTsNCg0KQ2hvaWNlcy51c2VyRGVmYXVsdHMgPSB7fTsNCi8vIFdlIGNhbm5vdCBleHBvcnQgZGVmYXVsdCBoZXJlIGR1ZSB0byBXZWJwYWNrOiBodHRwczovL2dpdGh1Yi5jb20vd2VicGFjay93ZWJwYWNrL2lzc3Vlcy8zOTI5DQptb2R1bGUuZXhwb3J0cyA9IENob2ljZXM7DQoNCi8qKiovIH0pLA0KLyogMzkgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLyohDQogKiBGdXNlLmpzIHYzLjIuMCAtIExpZ2h0d2VpZ2h0IGZ1enp5LXNlYXJjaCAoaHR0cDovL2Z1c2Vqcy5pbykNCiAqDQogKiBDb3B5cmlnaHQgKGMpIDIwMTItMjAxNyBLaXJvbGxvcyBSaXNrIChodHRwOi8va2lyby5tZSkNCiAqIEFsbCBSaWdodHMgUmVzZXJ2ZWQuIEFwYWNoZSBTb2Z0d2FyZSBMaWNlbnNlIDIuMA0KICoNCiAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICovDQooZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkgew0KCWlmKHRydWUpDQoJCW1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOw0KCWVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKQ0KCQlkZWZpbmUoIkZ1c2UiLCBbXSwgZmFjdG9yeSk7DQoJZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpDQoJCWV4cG9ydHNbIkZ1c2UiXSA9IGZhY3RvcnkoKTsNCgllbHNlDQoJCXJvb3RbIkZ1c2UiXSA9IGZhY3RvcnkoKTsNCn0pKHRoaXMsIGZ1bmN0aW9uKCkgew0KcmV0dXJuIC8qKioqKiovIChmdW5jdGlvbihtb2R1bGVzKSB7IC8vIHdlYnBhY2tCb290c3RyYXANCi8qKioqKiovIAkvLyBUaGUgbW9kdWxlIGNhY2hlDQovKioqKioqLyAJdmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTsNCi8qKioqKiovDQovKioqKioqLyAJLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb24NCi8qKioqKiovIAlmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7DQovKioqKioqLw0KLyoqKioqKi8gCQkvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGUNCi8qKioqKiovIAkJaWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHsNCi8qKioqKiovIAkJCXJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzOw0KLyoqKioqKi8gCQl9DQovKioqKioqLyAJCS8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpDQovKioqKioqLyAJCXZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHsNCi8qKioqKiovIAkJCWk6IG1vZHVsZUlkLA0KLyoqKioqKi8gCQkJbDogZmFsc2UsDQovKioqKioqLyAJCQlleHBvcnRzOiB7fQ0KLyoqKioqKi8gCQl9Ow0KLyoqKioqKi8NCi8qKioqKiovIAkJLy8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uDQovKioqKioqLyAJCW1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pOw0KLyoqKioqKi8NCi8qKioqKiovIAkJLy8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZA0KLyoqKioqKi8gCQltb2R1bGUubCA9IHRydWU7DQovKioqKioqLw0KLyoqKioqKi8gCQkvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZQ0KLyoqKioqKi8gCQlyZXR1cm4gbW9kdWxlLmV4cG9ydHM7DQovKioqKioqLyAJfQ0KLyoqKioqKi8NCi8qKioqKiovDQovKioqKioqLyAJLy8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXykNCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzOw0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZQ0KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7DQovKioqKioqLw0KLyoqKioqKi8gCS8vIGlkZW50aXR5IGZ1bmN0aW9uIGZvciBjYWxsaW5nIGhhcm1vbnkgaW1wb3J0cyB3aXRoIHRoZSBjb3JyZWN0IGNvbnRleHQNCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLmkgPSBmdW5jdGlvbih2YWx1ZSkgeyByZXR1cm4gdmFsdWU7IH07DQovKioqKioqLw0KLyoqKioqKi8gCS8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0cw0KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikgew0KLyoqKioqKi8gCQlpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7DQovKioqKioqLyAJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgew0KLyoqKioqKi8gCQkJCWNvbmZpZ3VyYWJsZTogZmFsc2UsDQovKioqKioqLyAJCQkJZW51bWVyYWJsZTogdHJ1ZSwNCi8qKioqKiovIAkJCQlnZXQ6IGdldHRlcg0KLyoqKioqKi8gCQkJfSk7DQovKioqKioqLyAJCX0NCi8qKioqKiovIAl9Ow0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlcw0KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkgew0KLyoqKioqKi8gCQl2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID8NCi8qKioqKiovIAkJCWZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6DQovKioqKioqLyAJCQlmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9Ow0KLyoqKioqKi8gCQlfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7DQovKioqKioqLyAJCXJldHVybiBnZXR0ZXI7DQovKioqKioqLyAJfTsNCi8qKioqKiovDQovKioqKioqLyAJLy8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsDQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9Ow0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfXw0KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ucCA9ICIiOw0KLyoqKioqKi8NCi8qKioqKiovIAkvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHMNCi8qKioqKiovIAlyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSA4KTsNCi8qKioqKiovIH0pDQovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KLyoqKioqKi8gKFsNCi8qIDAgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9iaikgew0KICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IEFycmF5XSc7DQp9Ow0KDQovKioqLyB9KSwNCi8qIDEgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOw0KDQpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0NCg0KdmFyIGJpdGFwUmVnZXhTZWFyY2ggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOw0KdmFyIGJpdGFwU2VhcmNoID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KTsNCnZhciBwYXR0ZXJuQWxwaGFiZXQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpOw0KDQp2YXIgQml0YXAgPSBmdW5jdGlvbiAoKSB7DQogIGZ1bmN0aW9uIEJpdGFwKHBhdHRlcm4sIF9yZWYpIHsNCiAgICB2YXIgX3JlZiRsb2NhdGlvbiA9IF9yZWYubG9jYXRpb24sDQogICAgICAgIGxvY2F0aW9uID0gX3JlZiRsb2NhdGlvbiA9PT0gdW5kZWZpbmVkID8gMCA6IF9yZWYkbG9jYXRpb24sDQogICAgICAgIF9yZWYkZGlzdGFuY2UgPSBfcmVmLmRpc3RhbmNlLA0KICAgICAgICBkaXN0YW5jZSA9IF9yZWYkZGlzdGFuY2UgPT09IHVuZGVmaW5lZCA/IDEwMCA6IF9yZWYkZGlzdGFuY2UsDQogICAgICAgIF9yZWYkdGhyZXNob2xkID0gX3JlZi50aHJlc2hvbGQsDQogICAgICAgIHRocmVzaG9sZCA9IF9yZWYkdGhyZXNob2xkID09PSB1bmRlZmluZWQgPyAwLjYgOiBfcmVmJHRocmVzaG9sZCwNCiAgICAgICAgX3JlZiRtYXhQYXR0ZXJuTGVuZ3RoID0gX3JlZi5tYXhQYXR0ZXJuTGVuZ3RoLA0KICAgICAgICBtYXhQYXR0ZXJuTGVuZ3RoID0gX3JlZiRtYXhQYXR0ZXJuTGVuZ3RoID09PSB1bmRlZmluZWQgPyAzMiA6IF9yZWYkbWF4UGF0dGVybkxlbmd0aCwNCiAgICAgICAgX3JlZiRpc0Nhc2VTZW5zaXRpdmUgPSBfcmVmLmlzQ2FzZVNlbnNpdGl2ZSwNCiAgICAgICAgaXNDYXNlU2Vuc2l0aXZlID0gX3JlZiRpc0Nhc2VTZW5zaXRpdmUgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiRpc0Nhc2VTZW5zaXRpdmUsDQogICAgICAgIF9yZWYkdG9rZW5TZXBhcmF0b3IgPSBfcmVmLnRva2VuU2VwYXJhdG9yLA0KICAgICAgICB0b2tlblNlcGFyYXRvciA9IF9yZWYkdG9rZW5TZXBhcmF0b3IgPT09IHVuZGVmaW5lZCA/IC8gKy9nIDogX3JlZiR0b2tlblNlcGFyYXRvciwNCiAgICAgICAgX3JlZiRmaW5kQWxsTWF0Y2hlcyA9IF9yZWYuZmluZEFsbE1hdGNoZXMsDQogICAgICAgIGZpbmRBbGxNYXRjaGVzID0gX3JlZiRmaW5kQWxsTWF0Y2hlcyA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmJGZpbmRBbGxNYXRjaGVzLA0KICAgICAgICBfcmVmJG1pbk1hdGNoQ2hhckxlbmcgPSBfcmVmLm1pbk1hdGNoQ2hhckxlbmd0aCwNCiAgICAgICAgbWluTWF0Y2hDaGFyTGVuZ3RoID0gX3JlZiRtaW5NYXRjaENoYXJMZW5nID09PSB1bmRlZmluZWQgPyAxIDogX3JlZiRtaW5NYXRjaENoYXJMZW5nOw0KDQogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEJpdGFwKTsNCg0KICAgIHRoaXMub3B0aW9ucyA9IHsNCiAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwNCiAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZSwNCiAgICAgIHRocmVzaG9sZDogdGhyZXNob2xkLA0KICAgICAgbWF4UGF0dGVybkxlbmd0aDogbWF4UGF0dGVybkxlbmd0aCwNCiAgICAgIGlzQ2FzZVNlbnNpdGl2ZTogaXNDYXNlU2Vuc2l0aXZlLA0KICAgICAgdG9rZW5TZXBhcmF0b3I6IHRva2VuU2VwYXJhdG9yLA0KICAgICAgZmluZEFsbE1hdGNoZXM6IGZpbmRBbGxNYXRjaGVzLA0KICAgICAgbWluTWF0Y2hDaGFyTGVuZ3RoOiBtaW5NYXRjaENoYXJMZW5ndGgNCiAgICB9Ow0KDQogICAgdGhpcy5wYXR0ZXJuID0gdGhpcy5vcHRpb25zLmlzQ2FzZVNlbnNpdGl2ZSA/IHBhdHRlcm4gOiBwYXR0ZXJuLnRvTG93ZXJDYXNlKCk7DQoNCiAgICBpZiAodGhpcy5wYXR0ZXJuLmxlbmd0aCA8PSBtYXhQYXR0ZXJuTGVuZ3RoKSB7DQogICAgICB0aGlzLnBhdHRlcm5BbHBoYWJldCA9IHBhdHRlcm5BbHBoYWJldCh0aGlzLnBhdHRlcm4pOw0KICAgIH0NCiAgfQ0KDQogIF9jcmVhdGVDbGFzcyhCaXRhcCwgW3sNCiAgICBrZXk6ICdzZWFyY2gnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzZWFyY2godGV4dCkgew0KICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuaXNDYXNlU2Vuc2l0aXZlKSB7DQogICAgICAgIHRleHQgPSB0ZXh0LnRvTG93ZXJDYXNlKCk7DQogICAgICB9DQoNCiAgICAgIC8vIEV4YWN0IG1hdGNoDQogICAgICBpZiAodGhpcy5wYXR0ZXJuID09PSB0ZXh0KSB7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgaXNNYXRjaDogdHJ1ZSwNCiAgICAgICAgICBzY29yZTogMCwNCiAgICAgICAgICBtYXRjaGVkSW5kaWNlczogW1swLCB0ZXh0Lmxlbmd0aCAtIDFdXQ0KICAgICAgICB9Ow0KICAgICAgfQ0KDQogICAgICAvLyBXaGVuIHBhdHRlcm4gbGVuZ3RoIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWFjaGluZSB3b3JkIGxlbmd0aCwganVzdCBkbyBhIGEgcmVnZXggY29tcGFyaXNvbg0KICAgICAgdmFyIF9vcHRpb25zID0gdGhpcy5vcHRpb25zLA0KICAgICAgICAgIG1heFBhdHRlcm5MZW5ndGggPSBfb3B0aW9ucy5tYXhQYXR0ZXJuTGVuZ3RoLA0KICAgICAgICAgIHRva2VuU2VwYXJhdG9yID0gX29wdGlvbnMudG9rZW5TZXBhcmF0b3I7DQoNCiAgICAgIGlmICh0aGlzLnBhdHRlcm4ubGVuZ3RoID4gbWF4UGF0dGVybkxlbmd0aCkgew0KICAgICAgICByZXR1cm4gYml0YXBSZWdleFNlYXJjaCh0ZXh0LCB0aGlzLnBhdHRlcm4sIHRva2VuU2VwYXJhdG9yKTsNCiAgICAgIH0NCg0KICAgICAgLy8gT3RoZXJ3aXNlLCB1c2UgQml0YXAgYWxnb3JpdGhtDQogICAgICB2YXIgX29wdGlvbnMyID0gdGhpcy5vcHRpb25zLA0KICAgICAgICAgIGxvY2F0aW9uID0gX29wdGlvbnMyLmxvY2F0aW9uLA0KICAgICAgICAgIGRpc3RhbmNlID0gX29wdGlvbnMyLmRpc3RhbmNlLA0KICAgICAgICAgIHRocmVzaG9sZCA9IF9vcHRpb25zMi50aHJlc2hvbGQsDQogICAgICAgICAgZmluZEFsbE1hdGNoZXMgPSBfb3B0aW9uczIuZmluZEFsbE1hdGNoZXMsDQogICAgICAgICAgbWluTWF0Y2hDaGFyTGVuZ3RoID0gX29wdGlvbnMyLm1pbk1hdGNoQ2hhckxlbmd0aDsNCg0KICAgICAgcmV0dXJuIGJpdGFwU2VhcmNoKHRleHQsIHRoaXMucGF0dGVybiwgdGhpcy5wYXR0ZXJuQWxwaGFiZXQsIHsNCiAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uLA0KICAgICAgICBkaXN0YW5jZTogZGlzdGFuY2UsDQogICAgICAgIHRocmVzaG9sZDogdGhyZXNob2xkLA0KICAgICAgICBmaW5kQWxsTWF0Y2hlczogZmluZEFsbE1hdGNoZXMsDQogICAgICAgIG1pbk1hdGNoQ2hhckxlbmd0aDogbWluTWF0Y2hDaGFyTGVuZ3RoDQogICAgICB9KTsNCiAgICB9DQogIH1dKTsNCg0KICByZXR1cm4gQml0YXA7DQp9KCk7DQoNCi8vIGxldCB4ID0gbmV3IEJpdGFwKCJvZCBtbiB3YXIiLCB7fSkNCi8vIGxldCByZXN1bHQgPSB4LnNlYXJjaCgiT2xkIE1hbidzIFdhciIpDQovLyBjb25zb2xlLmxvZyhyZXN1bHQpDQoNCm1vZHVsZS5leHBvcnRzID0gQml0YXA7DQoNCi8qKiovIH0pLA0KLyogMiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KdmFyIGlzQXJyYXkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApOw0KDQp2YXIgZGVlcFZhbHVlID0gZnVuY3Rpb24gZGVlcFZhbHVlKG9iaiwgcGF0aCwgbGlzdCkgew0KICBpZiAoIXBhdGgpIHsNCiAgICAvLyBJZiB0aGVyZSdzIG5vIHBhdGggbGVmdCwgd2UndmUgZ290dGVuIHRvIHRoZSBvYmplY3Qgd2UgY2FyZSBhYm91dC4NCiAgICBsaXN0LnB1c2gob2JqKTsNCiAgfSBlbHNlIHsNCiAgICB2YXIgZG90SW5kZXggPSBwYXRoLmluZGV4T2YoJy4nKTsNCiAgICB2YXIgZmlyc3RTZWdtZW50ID0gcGF0aDsNCiAgICB2YXIgcmVtYWluaW5nID0gbnVsbDsNCg0KICAgIGlmIChkb3RJbmRleCAhPT0gLTEpIHsNCiAgICAgIGZpcnN0U2VnbWVudCA9IHBhdGguc2xpY2UoMCwgZG90SW5kZXgpOw0KICAgICAgcmVtYWluaW5nID0gcGF0aC5zbGljZShkb3RJbmRleCArIDEpOw0KICAgIH0NCg0KICAgIHZhciB2YWx1ZSA9IG9ialtmaXJzdFNlZ21lbnRdOw0KDQogICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQpIHsNCiAgICAgIGlmICghcmVtYWluaW5nICYmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpKSB7DQogICAgICAgIGxpc3QucHVzaCh2YWx1ZS50b1N0cmluZygpKTsNCiAgICAgIH0gZWxzZSBpZiAoaXNBcnJheSh2YWx1ZSkpIHsNCiAgICAgICAgLy8gU2VhcmNoIGVhY2ggaXRlbSBpbiB0aGUgYXJyYXkuDQogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB2YWx1ZS5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkgew0KICAgICAgICAgIGRlZXBWYWx1ZSh2YWx1ZVtpXSwgcmVtYWluaW5nLCBsaXN0KTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmIChyZW1haW5pbmcpIHsNCiAgICAgICAgLy8gQW4gb2JqZWN0LiBSZWN1cnNlIGZ1cnRoZXIuDQogICAgICAgIGRlZXBWYWx1ZSh2YWx1ZSwgcmVtYWluaW5nLCBsaXN0KTsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICByZXR1cm4gbGlzdDsNCn07DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9iaiwgcGF0aCkgew0KICByZXR1cm4gZGVlcFZhbHVlKG9iaiwgcGF0aCwgW10pOw0KfTsNCg0KLyoqKi8gfSksDQovKiAzICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHsNCiAgdmFyIG1hdGNobWFzayA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107DQogIHZhciBtaW5NYXRjaENoYXJMZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDE7DQoNCiAgdmFyIG1hdGNoZWRJbmRpY2VzID0gW107DQogIHZhciBzdGFydCA9IC0xOw0KICB2YXIgZW5kID0gLTE7DQogIHZhciBpID0gMDsNCg0KICBmb3IgKHZhciBsZW4gPSBtYXRjaG1hc2subGVuZ3RoOyBpIDwgbGVuOyBpICs9IDEpIHsNCiAgICB2YXIgbWF0Y2ggPSBtYXRjaG1hc2tbaV07DQogICAgaWYgKG1hdGNoICYmIHN0YXJ0ID09PSAtMSkgew0KICAgICAgc3RhcnQgPSBpOw0KICAgIH0gZWxzZSBpZiAoIW1hdGNoICYmIHN0YXJ0ICE9PSAtMSkgew0KICAgICAgZW5kID0gaSAtIDE7DQogICAgICBpZiAoZW5kIC0gc3RhcnQgKyAxID49IG1pbk1hdGNoQ2hhckxlbmd0aCkgew0KICAgICAgICBtYXRjaGVkSW5kaWNlcy5wdXNoKFtzdGFydCwgZW5kXSk7DQogICAgICB9DQogICAgICBzdGFydCA9IC0xOw0KICAgIH0NCiAgfQ0KDQogIC8vIChpLTEgLSBzdGFydCkgKyAxID0+IGkgLSBzdGFydA0KICBpZiAobWF0Y2htYXNrW2kgLSAxXSAmJiBpIC0gc3RhcnQgPj0gbWluTWF0Y2hDaGFyTGVuZ3RoKSB7DQogICAgbWF0Y2hlZEluZGljZXMucHVzaChbc3RhcnQsIGkgLSAxXSk7DQogIH0NCg0KICByZXR1cm4gbWF0Y2hlZEluZGljZXM7DQp9Ow0KDQovKioqLyB9KSwNCi8qIDQgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHBhdHRlcm4pIHsNCiAgdmFyIG1hc2sgPSB7fTsNCiAgdmFyIGxlbiA9IHBhdHRlcm4ubGVuZ3RoOw0KDQogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpICs9IDEpIHsNCiAgICBtYXNrW3BhdHRlcm4uY2hhckF0KGkpXSA9IDA7DQogIH0NCg0KICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgbGVuOyBfaSArPSAxKSB7DQogICAgbWFza1twYXR0ZXJuLmNoYXJBdChfaSldIHw9IDEgPDwgbGVuIC0gX2kgLSAxOw0KICB9DQoNCiAgcmV0dXJuIG1hc2s7DQp9Ow0KDQovKioqLyB9KSwNCi8qIDUgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCnZhciBTUEVDSUFMX0NIQVJTX1JFR0VYID0gL1tcLVxbXF1cL1x7XH1cKFwpXCpcK1w/XC5cXFxeXCRcfF0vZzsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAodGV4dCwgcGF0dGVybikgew0KICB2YXIgdG9rZW5TZXBhcmF0b3IgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IC8gKy9nOw0KDQogIHZhciByZWdleCA9IG5ldyBSZWdFeHAocGF0dGVybi5yZXBsYWNlKFNQRUNJQUxfQ0hBUlNfUkVHRVgsICdcXCQmJykucmVwbGFjZSh0b2tlblNlcGFyYXRvciwgJ3wnKSk7DQogIHZhciBtYXRjaGVzID0gdGV4dC5tYXRjaChyZWdleCk7DQogIHZhciBpc01hdGNoID0gISFtYXRjaGVzOw0KICB2YXIgbWF0Y2hlZEluZGljZXMgPSBbXTsNCg0KICBpZiAoaXNNYXRjaCkgew0KICAgIGZvciAodmFyIGkgPSAwLCBtYXRjaGVzTGVuID0gbWF0Y2hlcy5sZW5ndGg7IGkgPCBtYXRjaGVzTGVuOyBpICs9IDEpIHsNCiAgICAgIHZhciBtYXRjaCA9IG1hdGNoZXNbaV07DQogICAgICBtYXRjaGVkSW5kaWNlcy5wdXNoKFt0ZXh0LmluZGV4T2YobWF0Y2gpLCBtYXRjaC5sZW5ndGggLSAxXSk7DQogICAgfQ0KICB9DQoNCiAgcmV0dXJuIHsNCiAgICAvLyBUT0RPOiByZXZpc2l0IHRoaXMgc2NvcmUNCiAgICBzY29yZTogaXNNYXRjaCA/IDAuNSA6IDEsDQogICAgaXNNYXRjaDogaXNNYXRjaCwNCiAgICBtYXRjaGVkSW5kaWNlczogbWF0Y2hlZEluZGljZXMNCiAgfTsNCn07DQoNCi8qKiovIH0pLA0KLyogNiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAocGF0dGVybiwgX3JlZikgew0KICB2YXIgX3JlZiRlcnJvcnMgPSBfcmVmLmVycm9ycywNCiAgICAgIGVycm9ycyA9IF9yZWYkZXJyb3JzID09PSB1bmRlZmluZWQgPyAwIDogX3JlZiRlcnJvcnMsDQogICAgICBfcmVmJGN1cnJlbnRMb2NhdGlvbiA9IF9yZWYuY3VycmVudExvY2F0aW9uLA0KICAgICAgY3VycmVudExvY2F0aW9uID0gX3JlZiRjdXJyZW50TG9jYXRpb24gPT09IHVuZGVmaW5lZCA/IDAgOiBfcmVmJGN1cnJlbnRMb2NhdGlvbiwNCiAgICAgIF9yZWYkZXhwZWN0ZWRMb2NhdGlvbiA9IF9yZWYuZXhwZWN0ZWRMb2NhdGlvbiwNCiAgICAgIGV4cGVjdGVkTG9jYXRpb24gPSBfcmVmJGV4cGVjdGVkTG9jYXRpb24gPT09IHVuZGVmaW5lZCA/IDAgOiBfcmVmJGV4cGVjdGVkTG9jYXRpb24sDQogICAgICBfcmVmJGRpc3RhbmNlID0gX3JlZi5kaXN0YW5jZSwNCiAgICAgIGRpc3RhbmNlID0gX3JlZiRkaXN0YW5jZSA9PT0gdW5kZWZpbmVkID8gMTAwIDogX3JlZiRkaXN0YW5jZTsNCg0KICB2YXIgYWNjdXJhY3kgPSBlcnJvcnMgLyBwYXR0ZXJuLmxlbmd0aDsNCiAgdmFyIHByb3hpbWl0eSA9IE1hdGguYWJzKGV4cGVjdGVkTG9jYXRpb24gLSBjdXJyZW50TG9jYXRpb24pOw0KDQogIGlmICghZGlzdGFuY2UpIHsNCiAgICAvLyBEb2RnZSBkaXZpZGUgYnkgemVybyBlcnJvci4NCiAgICByZXR1cm4gcHJveGltaXR5ID8gMS4wIDogYWNjdXJhY3k7DQogIH0NCg0KICByZXR1cm4gYWNjdXJhY3kgKyBwcm94aW1pdHkgLyBkaXN0YW5jZTsNCn07DQoNCi8qKiovIH0pLA0KLyogNyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KdmFyIGJpdGFwU2NvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOw0KdmFyIG1hdGNoZWRJbmRpY2VzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAodGV4dCwgcGF0dGVybiwgcGF0dGVybkFscGhhYmV0LCBfcmVmKSB7DQogIHZhciBfcmVmJGxvY2F0aW9uID0gX3JlZi5sb2NhdGlvbiwNCiAgICAgIGxvY2F0aW9uID0gX3JlZiRsb2NhdGlvbiA9PT0gdW5kZWZpbmVkID8gMCA6IF9yZWYkbG9jYXRpb24sDQogICAgICBfcmVmJGRpc3RhbmNlID0gX3JlZi5kaXN0YW5jZSwNCiAgICAgIGRpc3RhbmNlID0gX3JlZiRkaXN0YW5jZSA9PT0gdW5kZWZpbmVkID8gMTAwIDogX3JlZiRkaXN0YW5jZSwNCiAgICAgIF9yZWYkdGhyZXNob2xkID0gX3JlZi50aHJlc2hvbGQsDQogICAgICB0aHJlc2hvbGQgPSBfcmVmJHRocmVzaG9sZCA9PT0gdW5kZWZpbmVkID8gMC42IDogX3JlZiR0aHJlc2hvbGQsDQogICAgICBfcmVmJGZpbmRBbGxNYXRjaGVzID0gX3JlZi5maW5kQWxsTWF0Y2hlcywNCiAgICAgIGZpbmRBbGxNYXRjaGVzID0gX3JlZiRmaW5kQWxsTWF0Y2hlcyA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmJGZpbmRBbGxNYXRjaGVzLA0KICAgICAgX3JlZiRtaW5NYXRjaENoYXJMZW5nID0gX3JlZi5taW5NYXRjaENoYXJMZW5ndGgsDQogICAgICBtaW5NYXRjaENoYXJMZW5ndGggPSBfcmVmJG1pbk1hdGNoQ2hhckxlbmcgPT09IHVuZGVmaW5lZCA/IDEgOiBfcmVmJG1pbk1hdGNoQ2hhckxlbmc7DQoNCiAgdmFyIGV4cGVjdGVkTG9jYXRpb24gPSBsb2NhdGlvbjsNCiAgLy8gU2V0IHN0YXJ0aW5nIGxvY2F0aW9uIGF0IGJlZ2lubmluZyB0ZXh0IGFuZCBpbml0aWFsaXplIHRoZSBhbHBoYWJldC4NCiAgdmFyIHRleHRMZW4gPSB0ZXh0Lmxlbmd0aDsNCiAgLy8gSGlnaGVzdCBzY29yZSBiZXlvbmQgd2hpY2ggd2UgZ2l2ZSB1cC4NCiAgdmFyIGN1cnJlbnRUaHJlc2hvbGQgPSB0aHJlc2hvbGQ7DQogIC8vIElzIHRoZXJlIGEgbmVhcmJ5IGV4YWN0IG1hdGNoPyAoc3BlZWR1cCkNCiAgdmFyIGJlc3RMb2NhdGlvbiA9IHRleHQuaW5kZXhPZihwYXR0ZXJuLCBleHBlY3RlZExvY2F0aW9uKTsNCg0KICB2YXIgcGF0dGVybkxlbiA9IHBhdHRlcm4ubGVuZ3RoOw0KDQogIC8vIGEgbWFzayBvZiB0aGUgbWF0Y2hlcw0KICB2YXIgbWF0Y2hNYXNrID0gW107DQogIGZvciAodmFyIGkgPSAwOyBpIDwgdGV4dExlbjsgaSArPSAxKSB7DQogICAgbWF0Y2hNYXNrW2ldID0gMDsNCiAgfQ0KDQogIGlmIChiZXN0TG9jYXRpb24gIT09IC0xKSB7DQogICAgdmFyIHNjb3JlID0gYml0YXBTY29yZShwYXR0ZXJuLCB7DQogICAgICBlcnJvcnM6IDAsDQogICAgICBjdXJyZW50TG9jYXRpb246IGJlc3RMb2NhdGlvbiwNCiAgICAgIGV4cGVjdGVkTG9jYXRpb246IGV4cGVjdGVkTG9jYXRpb24sDQogICAgICBkaXN0YW5jZTogZGlzdGFuY2UNCiAgICB9KTsNCiAgICBjdXJyZW50VGhyZXNob2xkID0gTWF0aC5taW4oc2NvcmUsIGN1cnJlbnRUaHJlc2hvbGQpOw0KDQogICAgLy8gV2hhdCBhYm91dCBpbiB0aGUgb3RoZXIgZGlyZWN0aW9uPyAoc3BlZWQgdXApDQogICAgYmVzdExvY2F0aW9uID0gdGV4dC5sYXN0SW5kZXhPZihwYXR0ZXJuLCBleHBlY3RlZExvY2F0aW9uICsgcGF0dGVybkxlbik7DQoNCiAgICBpZiAoYmVzdExvY2F0aW9uICE9PSAtMSkgew0KICAgICAgdmFyIF9zY29yZSA9IGJpdGFwU2NvcmUocGF0dGVybiwgew0KICAgICAgICBlcnJvcnM6IDAsDQogICAgICAgIGN1cnJlbnRMb2NhdGlvbjogYmVzdExvY2F0aW9uLA0KICAgICAgICBleHBlY3RlZExvY2F0aW9uOiBleHBlY3RlZExvY2F0aW9uLA0KICAgICAgICBkaXN0YW5jZTogZGlzdGFuY2UNCiAgICAgIH0pOw0KICAgICAgY3VycmVudFRocmVzaG9sZCA9IE1hdGgubWluKF9zY29yZSwgY3VycmVudFRocmVzaG9sZCk7DQogICAgfQ0KICB9DQoNCiAgLy8gUmVzZXQgdGhlIGJlc3QgbG9jYXRpb24NCiAgYmVzdExvY2F0aW9uID0gLTE7DQoNCiAgdmFyIGxhc3RCaXRBcnIgPSBbXTsNCiAgdmFyIGZpbmFsU2NvcmUgPSAxOw0KICB2YXIgYmluTWF4ID0gcGF0dGVybkxlbiArIHRleHRMZW47DQoNCiAgdmFyIG1hc2sgPSAxIDw8IHBhdHRlcm5MZW4gLSAxOw0KDQogIGZvciAodmFyIF9pID0gMDsgX2kgPCBwYXR0ZXJuTGVuOyBfaSArPSAxKSB7DQogICAgLy8gU2NhbiBmb3IgdGhlIGJlc3QgbWF0Y2g7IGVhY2ggaXRlcmF0aW9uIGFsbG93cyBmb3Igb25lIG1vcmUgZXJyb3IuDQogICAgLy8gUnVuIGEgYmluYXJ5IHNlYXJjaCB0byBkZXRlcm1pbmUgaG93IGZhciBmcm9tIHRoZSBtYXRjaCBsb2NhdGlvbiB3ZSBjYW4gc3RyYXkNCiAgICAvLyBhdCB0aGlzIGVycm9yIGxldmVsLg0KICAgIHZhciBiaW5NaW4gPSAwOw0KICAgIHZhciBiaW5NaWQgPSBiaW5NYXg7DQoNCiAgICB3aGlsZSAoYmluTWluIDwgYmluTWlkKSB7DQogICAgICB2YXIgX3Njb3JlMyA9IGJpdGFwU2NvcmUocGF0dGVybiwgew0KICAgICAgICBlcnJvcnM6IF9pLA0KICAgICAgICBjdXJyZW50TG9jYXRpb246IGV4cGVjdGVkTG9jYXRpb24gKyBiaW5NaWQsDQogICAgICAgIGV4cGVjdGVkTG9jYXRpb246IGV4cGVjdGVkTG9jYXRpb24sDQogICAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZQ0KICAgICAgfSk7DQoNCiAgICAgIGlmIChfc2NvcmUzIDw9IGN1cnJlbnRUaHJlc2hvbGQpIHsNCiAgICAgICAgYmluTWluID0gYmluTWlkOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgYmluTWF4ID0gYmluTWlkOw0KICAgICAgfQ0KDQogICAgICBiaW5NaWQgPSBNYXRoLmZsb29yKChiaW5NYXggLSBiaW5NaW4pIC8gMiArIGJpbk1pbik7DQogICAgfQ0KDQogICAgLy8gVXNlIHRoZSByZXN1bHQgZnJvbSB0aGlzIGl0ZXJhdGlvbiBhcyB0aGUgbWF4aW11bSBmb3IgdGhlIG5leHQuDQogICAgYmluTWF4ID0gYmluTWlkOw0KDQogICAgdmFyIHN0YXJ0ID0gTWF0aC5tYXgoMSwgZXhwZWN0ZWRMb2NhdGlvbiAtIGJpbk1pZCArIDEpOw0KICAgIHZhciBmaW5pc2ggPSBmaW5kQWxsTWF0Y2hlcyA/IHRleHRMZW4gOiBNYXRoLm1pbihleHBlY3RlZExvY2F0aW9uICsgYmluTWlkLCB0ZXh0TGVuKSArIHBhdHRlcm5MZW47DQoNCiAgICAvLyBJbml0aWFsaXplIHRoZSBiaXQgYXJyYXkNCiAgICB2YXIgYml0QXJyID0gQXJyYXkoZmluaXNoICsgMik7DQoNCiAgICBiaXRBcnJbZmluaXNoICsgMV0gPSAoMSA8PCBfaSkgLSAxOw0KDQogICAgZm9yICh2YXIgaiA9IGZpbmlzaDsgaiA+PSBzdGFydDsgaiAtPSAxKSB7DQogICAgICB2YXIgY3VycmVudExvY2F0aW9uID0gaiAtIDE7DQogICAgICB2YXIgY2hhck1hdGNoID0gcGF0dGVybkFscGhhYmV0W3RleHQuY2hhckF0KGN1cnJlbnRMb2NhdGlvbildOw0KDQogICAgICBpZiAoY2hhck1hdGNoKSB7DQogICAgICAgIG1hdGNoTWFza1tjdXJyZW50TG9jYXRpb25dID0gMTsNCiAgICAgIH0NCg0KICAgICAgLy8gRmlyc3QgcGFzczogZXhhY3QgbWF0Y2gNCiAgICAgIGJpdEFycltqXSA9IChiaXRBcnJbaiArIDFdIDw8IDEgfCAxKSAmIGNoYXJNYXRjaDsNCg0KICAgICAgLy8gU3Vic2VxdWVudCBwYXNzZXM6IGZ1enp5IG1hdGNoDQogICAgICBpZiAoX2kgIT09IDApIHsNCiAgICAgICAgYml0QXJyW2pdIHw9IChsYXN0Qml0QXJyW2ogKyAxXSB8IGxhc3RCaXRBcnJbal0pIDw8IDEgfCAxIHwgbGFzdEJpdEFycltqICsgMV07DQogICAgICB9DQoNCiAgICAgIGlmIChiaXRBcnJbal0gJiBtYXNrKSB7DQogICAgICAgIGZpbmFsU2NvcmUgPSBiaXRhcFNjb3JlKHBhdHRlcm4sIHsNCiAgICAgICAgICBlcnJvcnM6IF9pLA0KICAgICAgICAgIGN1cnJlbnRMb2NhdGlvbjogY3VycmVudExvY2F0aW9uLA0KICAgICAgICAgIGV4cGVjdGVkTG9jYXRpb246IGV4cGVjdGVkTG9jYXRpb24sDQogICAgICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlDQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIFRoaXMgbWF0Y2ggd2lsbCBhbG1vc3QgY2VydGFpbmx5IGJlIGJldHRlciB0aGFuIGFueSBleGlzdGluZyBtYXRjaC4NCiAgICAgICAgLy8gQnV0IGNoZWNrIGFueXdheS4NCiAgICAgICAgaWYgKGZpbmFsU2NvcmUgPD0gY3VycmVudFRocmVzaG9sZCkgew0KICAgICAgICAgIC8vIEluZGVlZCBpdCBpcw0KICAgICAgICAgIGN1cnJlbnRUaHJlc2hvbGQgPSBmaW5hbFNjb3JlOw0KICAgICAgICAgIGJlc3RMb2NhdGlvbiA9IGN1cnJlbnRMb2NhdGlvbjsNCg0KICAgICAgICAgIC8vIEFscmVhZHkgcGFzc2VkIGBsb2NgLCBkb3duaGlsbCBmcm9tIGhlcmUgb24gaW4uDQogICAgICAgICAgaWYgKGJlc3RMb2NhdGlvbiA8PSBleHBlY3RlZExvY2F0aW9uKSB7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyBXaGVuIHBhc3NpbmcgYGJlc3RMb2NhdGlvbmAsIGRvbid0IGV4Y2VlZCBvdXIgY3VycmVudCBkaXN0YW5jZSBmcm9tIGBleHBlY3RlZExvY2F0aW9uYC4NCiAgICAgICAgICBzdGFydCA9IE1hdGgubWF4KDEsIDIgKiBleHBlY3RlZExvY2F0aW9uIC0gYmVzdExvY2F0aW9uKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCg0KICAgIC8vIE5vIGhvcGUgZm9yIGEgKGJldHRlcikgbWF0Y2ggYXQgZ3JlYXRlciBlcnJvciBsZXZlbHMuDQogICAgdmFyIF9zY29yZTIgPSBiaXRhcFNjb3JlKHBhdHRlcm4sIHsNCiAgICAgIGVycm9yczogX2kgKyAxLA0KICAgICAgY3VycmVudExvY2F0aW9uOiBleHBlY3RlZExvY2F0aW9uLA0KICAgICAgZXhwZWN0ZWRMb2NhdGlvbjogZXhwZWN0ZWRMb2NhdGlvbiwNCiAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZQ0KICAgIH0pOw0KDQogICAgaWYgKF9zY29yZTIgPiBjdXJyZW50VGhyZXNob2xkKSB7DQogICAgICBicmVhazsNCiAgICB9DQoNCiAgICBsYXN0Qml0QXJyID0gYml0QXJyOw0KICB9DQoNCiAgLy8gQ291bnQgZXhhY3QgbWF0Y2hlcyAodGhvc2Ugd2l0aCBhIHNjb3JlIG9mIDApIHRvIGJlICJhbG1vc3QiIGV4YWN0DQogIHJldHVybiB7DQogICAgaXNNYXRjaDogYmVzdExvY2F0aW9uID49IDAsDQogICAgc2NvcmU6IGZpbmFsU2NvcmUgPT09IDAgPyAwLjAwMSA6IGZpbmFsU2NvcmUsDQogICAgbWF0Y2hlZEluZGljZXM6IG1hdGNoZWRJbmRpY2VzKG1hdGNoTWFzaywgbWluTWF0Y2hDaGFyTGVuZ3RoKQ0KICB9Ow0KfTsNCg0KLyoqKi8gfSksDQovKiA4ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsNCg0KZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9DQoNCnZhciBCaXRhcCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7DQp2YXIgZGVlcFZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKTsNCnZhciBpc0FycmF5ID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKTsNCg0KdmFyIEZ1c2UgPSBmdW5jdGlvbiAoKSB7DQogIGZ1bmN0aW9uIEZ1c2UobGlzdCwgX3JlZikgew0KICAgIHZhciBfcmVmJGxvY2F0aW9uID0gX3JlZi5sb2NhdGlvbiwNCiAgICAgICAgbG9jYXRpb24gPSBfcmVmJGxvY2F0aW9uID09PSB1bmRlZmluZWQgPyAwIDogX3JlZiRsb2NhdGlvbiwNCiAgICAgICAgX3JlZiRkaXN0YW5jZSA9IF9yZWYuZGlzdGFuY2UsDQogICAgICAgIGRpc3RhbmNlID0gX3JlZiRkaXN0YW5jZSA9PT0gdW5kZWZpbmVkID8gMTAwIDogX3JlZiRkaXN0YW5jZSwNCiAgICAgICAgX3JlZiR0aHJlc2hvbGQgPSBfcmVmLnRocmVzaG9sZCwNCiAgICAgICAgdGhyZXNob2xkID0gX3JlZiR0aHJlc2hvbGQgPT09IHVuZGVmaW5lZCA/IDAuNiA6IF9yZWYkdGhyZXNob2xkLA0KICAgICAgICBfcmVmJG1heFBhdHRlcm5MZW5ndGggPSBfcmVmLm1heFBhdHRlcm5MZW5ndGgsDQogICAgICAgIG1heFBhdHRlcm5MZW5ndGggPSBfcmVmJG1heFBhdHRlcm5MZW5ndGggPT09IHVuZGVmaW5lZCA/IDMyIDogX3JlZiRtYXhQYXR0ZXJuTGVuZ3RoLA0KICAgICAgICBfcmVmJGNhc2VTZW5zaXRpdmUgPSBfcmVmLmNhc2VTZW5zaXRpdmUsDQogICAgICAgIGNhc2VTZW5zaXRpdmUgPSBfcmVmJGNhc2VTZW5zaXRpdmUgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiRjYXNlU2Vuc2l0aXZlLA0KICAgICAgICBfcmVmJHRva2VuU2VwYXJhdG9yID0gX3JlZi50b2tlblNlcGFyYXRvciwNCiAgICAgICAgdG9rZW5TZXBhcmF0b3IgPSBfcmVmJHRva2VuU2VwYXJhdG9yID09PSB1bmRlZmluZWQgPyAvICsvZyA6IF9yZWYkdG9rZW5TZXBhcmF0b3IsDQogICAgICAgIF9yZWYkZmluZEFsbE1hdGNoZXMgPSBfcmVmLmZpbmRBbGxNYXRjaGVzLA0KICAgICAgICBmaW5kQWxsTWF0Y2hlcyA9IF9yZWYkZmluZEFsbE1hdGNoZXMgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiRmaW5kQWxsTWF0Y2hlcywNCiAgICAgICAgX3JlZiRtaW5NYXRjaENoYXJMZW5nID0gX3JlZi5taW5NYXRjaENoYXJMZW5ndGgsDQogICAgICAgIG1pbk1hdGNoQ2hhckxlbmd0aCA9IF9yZWYkbWluTWF0Y2hDaGFyTGVuZyA9PT0gdW5kZWZpbmVkID8gMSA6IF9yZWYkbWluTWF0Y2hDaGFyTGVuZywNCiAgICAgICAgX3JlZiRpZCA9IF9yZWYuaWQsDQogICAgICAgIGlkID0gX3JlZiRpZCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IF9yZWYkaWQsDQogICAgICAgIF9yZWYka2V5cyA9IF9yZWYua2V5cywNCiAgICAgICAga2V5cyA9IF9yZWYka2V5cyA9PT0gdW5kZWZpbmVkID8gW10gOiBfcmVmJGtleXMsDQogICAgICAgIF9yZWYkc2hvdWxkU29ydCA9IF9yZWYuc2hvdWxkU29ydCwNCiAgICAgICAgc2hvdWxkU29ydCA9IF9yZWYkc2hvdWxkU29ydCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IF9yZWYkc2hvdWxkU29ydCwNCiAgICAgICAgX3JlZiRnZXRGbiA9IF9yZWYuZ2V0Rm4sDQogICAgICAgIGdldEZuID0gX3JlZiRnZXRGbiA9PT0gdW5kZWZpbmVkID8gZGVlcFZhbHVlIDogX3JlZiRnZXRGbiwNCiAgICAgICAgX3JlZiRzb3J0Rm4gPSBfcmVmLnNvcnRGbiwNCiAgICAgICAgc29ydEZuID0gX3JlZiRzb3J0Rm4gPT09IHVuZGVmaW5lZCA/IGZ1bmN0aW9uIChhLCBiKSB7DQogICAgICByZXR1cm4gYS5zY29yZSAtIGIuc2NvcmU7DQogICAgfSA6IF9yZWYkc29ydEZuLA0KICAgICAgICBfcmVmJHRva2VuaXplID0gX3JlZi50b2tlbml6ZSwNCiAgICAgICAgdG9rZW5pemUgPSBfcmVmJHRva2VuaXplID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkdG9rZW5pemUsDQogICAgICAgIF9yZWYkbWF0Y2hBbGxUb2tlbnMgPSBfcmVmLm1hdGNoQWxsVG9rZW5zLA0KICAgICAgICBtYXRjaEFsbFRva2VucyA9IF9yZWYkbWF0Y2hBbGxUb2tlbnMgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiRtYXRjaEFsbFRva2VucywNCiAgICAgICAgX3JlZiRpbmNsdWRlTWF0Y2hlcyA9IF9yZWYuaW5jbHVkZU1hdGNoZXMsDQogICAgICAgIGluY2x1ZGVNYXRjaGVzID0gX3JlZiRpbmNsdWRlTWF0Y2hlcyA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmJGluY2x1ZGVNYXRjaGVzLA0KICAgICAgICBfcmVmJGluY2x1ZGVTY29yZSA9IF9yZWYuaW5jbHVkZVNjb3JlLA0KICAgICAgICBpbmNsdWRlU2NvcmUgPSBfcmVmJGluY2x1ZGVTY29yZSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmJGluY2x1ZGVTY29yZSwNCiAgICAgICAgX3JlZiR2ZXJib3NlID0gX3JlZi52ZXJib3NlLA0KICAgICAgICB2ZXJib3NlID0gX3JlZiR2ZXJib3NlID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkdmVyYm9zZTsNCg0KICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBGdXNlKTsNCg0KICAgIHRoaXMub3B0aW9ucyA9IHsNCiAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwNCiAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZSwNCiAgICAgIHRocmVzaG9sZDogdGhyZXNob2xkLA0KICAgICAgbWF4UGF0dGVybkxlbmd0aDogbWF4UGF0dGVybkxlbmd0aCwNCiAgICAgIGlzQ2FzZVNlbnNpdGl2ZTogY2FzZVNlbnNpdGl2ZSwNCiAgICAgIHRva2VuU2VwYXJhdG9yOiB0b2tlblNlcGFyYXRvciwNCiAgICAgIGZpbmRBbGxNYXRjaGVzOiBmaW5kQWxsTWF0Y2hlcywNCiAgICAgIG1pbk1hdGNoQ2hhckxlbmd0aDogbWluTWF0Y2hDaGFyTGVuZ3RoLA0KICAgICAgaWQ6IGlkLA0KICAgICAga2V5czoga2V5cywNCiAgICAgIGluY2x1ZGVNYXRjaGVzOiBpbmNsdWRlTWF0Y2hlcywNCiAgICAgIGluY2x1ZGVTY29yZTogaW5jbHVkZVNjb3JlLA0KICAgICAgc2hvdWxkU29ydDogc2hvdWxkU29ydCwNCiAgICAgIGdldEZuOiBnZXRGbiwNCiAgICAgIHNvcnRGbjogc29ydEZuLA0KICAgICAgdmVyYm9zZTogdmVyYm9zZSwNCiAgICAgIHRva2VuaXplOiB0b2tlbml6ZSwNCiAgICAgIG1hdGNoQWxsVG9rZW5zOiBtYXRjaEFsbFRva2Vucw0KICAgIH07DQoNCiAgICB0aGlzLnNldENvbGxlY3Rpb24obGlzdCk7DQogIH0NCg0KICBfY3JlYXRlQ2xhc3MoRnVzZSwgW3sNCiAgICBrZXk6ICdzZXRDb2xsZWN0aW9uJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q29sbGVjdGlvbihsaXN0KSB7DQogICAgICB0aGlzLmxpc3QgPSBsaXN0Ow0KICAgICAgcmV0dXJuIGxpc3Q7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnc2VhcmNoJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VhcmNoKHBhdHRlcm4pIHsNCiAgICAgIHRoaXMuX2xvZygnLS0tLS0tLS0tXG5TZWFyY2ggcGF0dGVybjogIicgKyBwYXR0ZXJuICsgJyInKTsNCg0KICAgICAgdmFyIF9wcmVwYXJlU2VhcmNoZXJzMiA9IHRoaXMuX3ByZXBhcmVTZWFyY2hlcnMocGF0dGVybiksDQogICAgICAgICAgdG9rZW5TZWFyY2hlcnMgPSBfcHJlcGFyZVNlYXJjaGVyczIudG9rZW5TZWFyY2hlcnMsDQogICAgICAgICAgZnVsbFNlYXJjaGVyID0gX3ByZXBhcmVTZWFyY2hlcnMyLmZ1bGxTZWFyY2hlcjsNCg0KICAgICAgdmFyIF9zZWFyY2gyID0gdGhpcy5fc2VhcmNoKHRva2VuU2VhcmNoZXJzLCBmdWxsU2VhcmNoZXIpLA0KICAgICAgICAgIHdlaWdodHMgPSBfc2VhcmNoMi53ZWlnaHRzLA0KICAgICAgICAgIHJlc3VsdHMgPSBfc2VhcmNoMi5yZXN1bHRzOw0KDQogICAgICB0aGlzLl9jb21wdXRlU2NvcmUod2VpZ2h0cywgcmVzdWx0cyk7DQoNCiAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2hvdWxkU29ydCkgew0KICAgICAgICB0aGlzLl9zb3J0KHJlc3VsdHMpOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gdGhpcy5fZm9ybWF0KHJlc3VsdHMpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19wcmVwYXJlU2VhcmNoZXJzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3ByZXBhcmVTZWFyY2hlcnMoKSB7DQogICAgICB2YXIgcGF0dGVybiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJyc7DQoNCiAgICAgIHZhciB0b2tlblNlYXJjaGVycyA9IFtdOw0KDQogICAgICBpZiAodGhpcy5vcHRpb25zLnRva2VuaXplKSB7DQogICAgICAgIC8vIFRva2VuaXplIG9uIHRoZSBzZXBhcmF0b3INCiAgICAgICAgdmFyIHRva2VucyA9IHBhdHRlcm4uc3BsaXQodGhpcy5vcHRpb25zLnRva2VuU2VwYXJhdG9yKTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRva2Vucy5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkgew0KICAgICAgICAgIHRva2VuU2VhcmNoZXJzLnB1c2gobmV3IEJpdGFwKHRva2Vuc1tpXSwgdGhpcy5vcHRpb25zKSk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgdmFyIGZ1bGxTZWFyY2hlciA9IG5ldyBCaXRhcChwYXR0ZXJuLCB0aGlzLm9wdGlvbnMpOw0KDQogICAgICByZXR1cm4geyB0b2tlblNlYXJjaGVyczogdG9rZW5TZWFyY2hlcnMsIGZ1bGxTZWFyY2hlcjogZnVsbFNlYXJjaGVyIH07DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX3NlYXJjaCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9zZWFyY2goKSB7DQogICAgICB2YXIgdG9rZW5TZWFyY2hlcnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOw0KICAgICAgdmFyIGZ1bGxTZWFyY2hlciA9IGFyZ3VtZW50c1sxXTsNCg0KICAgICAgdmFyIGxpc3QgPSB0aGlzLmxpc3Q7DQogICAgICB2YXIgcmVzdWx0TWFwID0ge307DQogICAgICB2YXIgcmVzdWx0cyA9IFtdOw0KDQogICAgICAvLyBDaGVjayB0aGUgZmlyc3QgaXRlbSBpbiB0aGUgbGlzdCwgaWYgaXQncyBhIHN0cmluZywgdGhlbiB3ZSBhc3N1bWUNCiAgICAgIC8vIHRoYXQgZXZlcnkgaXRlbSBpbiB0aGUgbGlzdCBpcyBhbHNvIGEgc3RyaW5nLCBhbmQgdGh1cyBpdCdzIGEgZmxhdHRlbmVkIGFycmF5Lg0KICAgICAgaWYgKHR5cGVvZiBsaXN0WzBdID09PSAnc3RyaW5nJykgew0KICAgICAgICAvLyBJdGVyYXRlIG92ZXIgZXZlcnkgaXRlbQ0KICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbGlzdC5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkgew0KICAgICAgICAgIHRoaXMuX2FuYWx5emUoew0KICAgICAgICAgICAga2V5OiAnJywNCiAgICAgICAgICAgIHZhbHVlOiBsaXN0W2ldLA0KICAgICAgICAgICAgcmVjb3JkOiBpLA0KICAgICAgICAgICAgaW5kZXg6IGkNCiAgICAgICAgICB9LCB7DQogICAgICAgICAgICByZXN1bHRNYXA6IHJlc3VsdE1hcCwNCiAgICAgICAgICAgIHJlc3VsdHM6IHJlc3VsdHMsDQogICAgICAgICAgICB0b2tlblNlYXJjaGVyczogdG9rZW5TZWFyY2hlcnMsDQogICAgICAgICAgICBmdWxsU2VhcmNoZXI6IGZ1bGxTZWFyY2hlcg0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHsgd2VpZ2h0czogbnVsbCwgcmVzdWx0czogcmVzdWx0cyB9Ow0KICAgICAgfQ0KDQogICAgICAvLyBPdGhlcndpc2UsIHRoZSBmaXJzdCBpdGVtIGlzIGFuIE9iamVjdCAoaG9wZWZ1bGx5KSwgYW5kIHRodXMgdGhlIHNlYXJjaGluZw0KICAgICAgLy8gaXMgZG9uZSBvbiB0aGUgdmFsdWVzIG9mIHRoZSBrZXlzIG9mIGVhY2ggaXRlbS4NCiAgICAgIHZhciB3ZWlnaHRzID0ge307DQogICAgICBmb3IgKHZhciBfaSA9IDAsIF9sZW4gPSBsaXN0Lmxlbmd0aDsgX2kgPCBfbGVuOyBfaSArPSAxKSB7DQogICAgICAgIHZhciBpdGVtID0gbGlzdFtfaV07DQogICAgICAgIC8vIEl0ZXJhdGUgb3ZlciBldmVyeSBrZXkNCiAgICAgICAgZm9yICh2YXIgaiA9IDAsIGtleXNMZW4gPSB0aGlzLm9wdGlvbnMua2V5cy5sZW5ndGg7IGogPCBrZXlzTGVuOyBqICs9IDEpIHsNCiAgICAgICAgICB2YXIga2V5ID0gdGhpcy5vcHRpb25zLmtleXNbal07DQogICAgICAgICAgaWYgKHR5cGVvZiBrZXkgIT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICB3ZWlnaHRzW2tleS5uYW1lXSA9IHsNCiAgICAgICAgICAgICAgd2VpZ2h0OiAxIC0ga2V5LndlaWdodCB8fCAxDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgaWYgKGtleS53ZWlnaHQgPD0gMCB8fCBrZXkud2VpZ2h0ID4gMSkgew0KICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0tleSB3ZWlnaHQgaGFzIHRvIGJlID4gMCBhbmQgPD0gMScpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAga2V5ID0ga2V5Lm5hbWU7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHdlaWdodHNba2V5XSA9IHsNCiAgICAgICAgICAgICAgd2VpZ2h0OiAxDQogICAgICAgICAgICB9Ow0KICAgICAgICAgIH0NCg0KICAgICAgICAgIHRoaXMuX2FuYWx5emUoew0KICAgICAgICAgICAga2V5OiBrZXksDQogICAgICAgICAgICB2YWx1ZTogdGhpcy5vcHRpb25zLmdldEZuKGl0ZW0sIGtleSksDQogICAgICAgICAgICByZWNvcmQ6IGl0ZW0sDQogICAgICAgICAgICBpbmRleDogX2kNCiAgICAgICAgICB9LCB7DQogICAgICAgICAgICByZXN1bHRNYXA6IHJlc3VsdE1hcCwNCiAgICAgICAgICAgIHJlc3VsdHM6IHJlc3VsdHMsDQogICAgICAgICAgICB0b2tlblNlYXJjaGVyczogdG9rZW5TZWFyY2hlcnMsDQogICAgICAgICAgICBmdWxsU2VhcmNoZXI6IGZ1bGxTZWFyY2hlcg0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIHJldHVybiB7IHdlaWdodHM6IHdlaWdodHMsIHJlc3VsdHM6IHJlc3VsdHMgfTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfYW5hbHl6ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9hbmFseXplKF9yZWYyLCBfcmVmMykgew0KICAgICAgdmFyIGtleSA9IF9yZWYyLmtleSwNCiAgICAgICAgICBfcmVmMiRhcnJheUluZGV4ID0gX3JlZjIuYXJyYXlJbmRleCwNCiAgICAgICAgICBhcnJheUluZGV4ID0gX3JlZjIkYXJyYXlJbmRleCA9PT0gdW5kZWZpbmVkID8gLTEgOiBfcmVmMiRhcnJheUluZGV4LA0KICAgICAgICAgIHZhbHVlID0gX3JlZjIudmFsdWUsDQogICAgICAgICAgcmVjb3JkID0gX3JlZjIucmVjb3JkLA0KICAgICAgICAgIGluZGV4ID0gX3JlZjIuaW5kZXg7DQogICAgICB2YXIgX3JlZjMkdG9rZW5TZWFyY2hlcnMgPSBfcmVmMy50b2tlblNlYXJjaGVycywNCiAgICAgICAgICB0b2tlblNlYXJjaGVycyA9IF9yZWYzJHRva2VuU2VhcmNoZXJzID09PSB1bmRlZmluZWQgPyBbXSA6IF9yZWYzJHRva2VuU2VhcmNoZXJzLA0KICAgICAgICAgIF9yZWYzJGZ1bGxTZWFyY2hlciA9IF9yZWYzLmZ1bGxTZWFyY2hlciwNCiAgICAgICAgICBmdWxsU2VhcmNoZXIgPSBfcmVmMyRmdWxsU2VhcmNoZXIgPT09IHVuZGVmaW5lZCA/IFtdIDogX3JlZjMkZnVsbFNlYXJjaGVyLA0KICAgICAgICAgIF9yZWYzJHJlc3VsdE1hcCA9IF9yZWYzLnJlc3VsdE1hcCwNCiAgICAgICAgICByZXN1bHRNYXAgPSBfcmVmMyRyZXN1bHRNYXAgPT09IHVuZGVmaW5lZCA/IHt9IDogX3JlZjMkcmVzdWx0TWFwLA0KICAgICAgICAgIF9yZWYzJHJlc3VsdHMgPSBfcmVmMy5yZXN1bHRzLA0KICAgICAgICAgIHJlc3VsdHMgPSBfcmVmMyRyZXN1bHRzID09PSB1bmRlZmluZWQgPyBbXSA6IF9yZWYzJHJlc3VsdHM7DQoNCiAgICAgIC8vIENoZWNrIGlmIHRoZSB0ZXh2YWx1ZXQgY2FuIGJlIHNlYXJjaGVkDQogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHZhciBleGlzdHMgPSBmYWxzZTsNCiAgICAgIHZhciBhdmVyYWdlU2NvcmUgPSAtMTsNCiAgICAgIHZhciBudW1UZXh0TWF0Y2hlcyA9IDA7DQoNCiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7DQogICAgICAgIHRoaXMuX2xvZygnXG5LZXk6ICcgKyAoa2V5ID09PSAnJyA/ICctJyA6IGtleSkpOw0KDQogICAgICAgIHZhciBtYWluU2VhcmNoUmVzdWx0ID0gZnVsbFNlYXJjaGVyLnNlYXJjaCh2YWx1ZSk7DQogICAgICAgIHRoaXMuX2xvZygnRnVsbCB0ZXh0OiAiJyArIHZhbHVlICsgJyIsIHNjb3JlOiAnICsgbWFpblNlYXJjaFJlc3VsdC5zY29yZSk7DQoNCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy50b2tlbml6ZSkgew0KICAgICAgICAgIHZhciB3b3JkcyA9IHZhbHVlLnNwbGl0KHRoaXMub3B0aW9ucy50b2tlblNlcGFyYXRvcik7DQogICAgICAgICAgdmFyIHNjb3JlcyA9IFtdOw0KDQogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b2tlblNlYXJjaGVycy5sZW5ndGg7IGkgKz0gMSkgew0KICAgICAgICAgICAgdmFyIHRva2VuU2VhcmNoZXIgPSB0b2tlblNlYXJjaGVyc1tpXTsNCg0KICAgICAgICAgICAgdGhpcy5fbG9nKCdcblBhdHRlcm46ICInICsgdG9rZW5TZWFyY2hlci5wYXR0ZXJuICsgJyInKTsNCg0KICAgICAgICAgICAgLy8gbGV0IHRva2VuU2NvcmVzID0gW10NCiAgICAgICAgICAgIHZhciBoYXNNYXRjaEluVGV4dCA9IGZhbHNlOw0KDQogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHdvcmRzLmxlbmd0aDsgaiArPSAxKSB7DQogICAgICAgICAgICAgIHZhciB3b3JkID0gd29yZHNbal07DQogICAgICAgICAgICAgIHZhciB0b2tlblNlYXJjaFJlc3VsdCA9IHRva2VuU2VhcmNoZXIuc2VhcmNoKHdvcmQpOw0KICAgICAgICAgICAgICB2YXIgb2JqID0ge307DQogICAgICAgICAgICAgIGlmICh0b2tlblNlYXJjaFJlc3VsdC5pc01hdGNoKSB7DQogICAgICAgICAgICAgICAgb2JqW3dvcmRdID0gdG9rZW5TZWFyY2hSZXN1bHQuc2NvcmU7DQogICAgICAgICAgICAgICAgZXhpc3RzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBoYXNNYXRjaEluVGV4dCA9IHRydWU7DQogICAgICAgICAgICAgICAgc2NvcmVzLnB1c2godG9rZW5TZWFyY2hSZXN1bHQuc2NvcmUpOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG9ialt3b3JkXSA9IDE7DQogICAgICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMubWF0Y2hBbGxUb2tlbnMpIHsNCiAgICAgICAgICAgICAgICAgIHNjb3Jlcy5wdXNoKDEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB0aGlzLl9sb2coJ1Rva2VuOiAiJyArIHdvcmQgKyAnIiwgc2NvcmU6ICcgKyBvYmpbd29yZF0pOw0KICAgICAgICAgICAgICAvLyB0b2tlblNjb3Jlcy5wdXNoKG9iaikNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGhhc01hdGNoSW5UZXh0KSB7DQogICAgICAgICAgICAgIG51bVRleHRNYXRjaGVzICs9IDE7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgYXZlcmFnZVNjb3JlID0gc2NvcmVzWzBdOw0KICAgICAgICAgIHZhciBzY29yZXNMZW4gPSBzY29yZXMubGVuZ3RoOw0KICAgICAgICAgIGZvciAodmFyIF9pMiA9IDE7IF9pMiA8IHNjb3Jlc0xlbjsgX2kyICs9IDEpIHsNCiAgICAgICAgICAgIGF2ZXJhZ2VTY29yZSArPSBzY29yZXNbX2kyXTsNCiAgICAgICAgICB9DQogICAgICAgICAgYXZlcmFnZVNjb3JlID0gYXZlcmFnZVNjb3JlIC8gc2NvcmVzTGVuOw0KDQogICAgICAgICAgdGhpcy5fbG9nKCdUb2tlbiBzY29yZSBhdmVyYWdlOicsIGF2ZXJhZ2VTY29yZSk7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgZmluYWxTY29yZSA9IG1haW5TZWFyY2hSZXN1bHQuc2NvcmU7DQogICAgICAgIGlmIChhdmVyYWdlU2NvcmUgPiAtMSkgew0KICAgICAgICAgIGZpbmFsU2NvcmUgPSAoZmluYWxTY29yZSArIGF2ZXJhZ2VTY29yZSkgLyAyOw0KICAgICAgICB9DQoNCiAgICAgICAgdGhpcy5fbG9nKCdTY29yZSBhdmVyYWdlOicsIGZpbmFsU2NvcmUpOw0KDQogICAgICAgIHZhciBjaGVja1RleHRNYXRjaGVzID0gdGhpcy5vcHRpb25zLnRva2VuaXplICYmIHRoaXMub3B0aW9ucy5tYXRjaEFsbFRva2VucyA/IG51bVRleHRNYXRjaGVzID49IHRva2VuU2VhcmNoZXJzLmxlbmd0aCA6IHRydWU7DQoNCiAgICAgICAgdGhpcy5fbG9nKCdcbkNoZWNrIE1hdGNoZXM6ICcgKyBjaGVja1RleHRNYXRjaGVzKTsNCg0KICAgICAgICAvLyBJZiBhIG1hdGNoIGlzIGZvdW5kLCBhZGQgdGhlIGl0ZW0gdG8gPHJhd1Jlc3VsdHM+LCBpbmNsdWRpbmcgaXRzIHNjb3JlDQogICAgICAgIGlmICgoZXhpc3RzIHx8IG1haW5TZWFyY2hSZXN1bHQuaXNNYXRjaCkgJiYgY2hlY2tUZXh0TWF0Y2hlcykgew0KICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBpdGVtIGFscmVhZHkgZXhpc3RzIGluIG91ciByZXN1bHRzDQogICAgICAgICAgdmFyIGV4aXN0aW5nUmVzdWx0ID0gcmVzdWx0TWFwW2luZGV4XTsNCiAgICAgICAgICBpZiAoZXhpc3RpbmdSZXN1bHQpIHsNCiAgICAgICAgICAgIC8vIFVzZSB0aGUgbG93ZXN0IHNjb3JlDQogICAgICAgICAgICAvLyBleGlzdGluZ1Jlc3VsdC5zY29yZSwgYml0YXBSZXN1bHQuc2NvcmUNCiAgICAgICAgICAgIGV4aXN0aW5nUmVzdWx0Lm91dHB1dC5wdXNoKHsNCiAgICAgICAgICAgICAga2V5OiBrZXksDQogICAgICAgICAgICAgIGFycmF5SW5kZXg6IGFycmF5SW5kZXgsDQogICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwNCiAgICAgICAgICAgICAgc2NvcmU6IGZpbmFsU2NvcmUsDQogICAgICAgICAgICAgIG1hdGNoZWRJbmRpY2VzOiBtYWluU2VhcmNoUmVzdWx0Lm1hdGNoZWRJbmRpY2VzDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gQWRkIGl0IHRvIHRoZSByYXcgcmVzdWx0IGxpc3QNCiAgICAgICAgICAgIHJlc3VsdE1hcFtpbmRleF0gPSB7DQogICAgICAgICAgICAgIGl0ZW06IHJlY29yZCwNCiAgICAgICAgICAgICAgb3V0cHV0OiBbew0KICAgICAgICAgICAgICAgIGtleToga2V5LA0KICAgICAgICAgICAgICAgIGFycmF5SW5kZXg6IGFycmF5SW5kZXgsDQogICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLA0KICAgICAgICAgICAgICAgIHNjb3JlOiBmaW5hbFNjb3JlLA0KICAgICAgICAgICAgICAgIG1hdGNoZWRJbmRpY2VzOiBtYWluU2VhcmNoUmVzdWx0Lm1hdGNoZWRJbmRpY2VzDQogICAgICAgICAgICAgIH1dDQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICByZXN1bHRzLnB1c2gocmVzdWx0TWFwW2luZGV4XSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKGlzQXJyYXkodmFsdWUpKSB7DQogICAgICAgIGZvciAodmFyIF9pMyA9IDAsIGxlbiA9IHZhbHVlLmxlbmd0aDsgX2kzIDwgbGVuOyBfaTMgKz0gMSkgew0KICAgICAgICAgIHRoaXMuX2FuYWx5emUoew0KICAgICAgICAgICAga2V5OiBrZXksDQogICAgICAgICAgICBhcnJheUluZGV4OiBfaTMsDQogICAgICAgICAgICB2YWx1ZTogdmFsdWVbX2kzXSwNCiAgICAgICAgICAgIHJlY29yZDogcmVjb3JkLA0KICAgICAgICAgICAgaW5kZXg6IGluZGV4DQogICAgICAgICAgfSwgew0KICAgICAgICAgICAgcmVzdWx0TWFwOiByZXN1bHRNYXAsDQogICAgICAgICAgICByZXN1bHRzOiByZXN1bHRzLA0KICAgICAgICAgICAgdG9rZW5TZWFyY2hlcnM6IHRva2VuU2VhcmNoZXJzLA0KICAgICAgICAgICAgZnVsbFNlYXJjaGVyOiBmdWxsU2VhcmNoZXINCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19jb21wdXRlU2NvcmUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfY29tcHV0ZVNjb3JlKHdlaWdodHMsIHJlc3VsdHMpIHsNCiAgICAgIHRoaXMuX2xvZygnXG5cbkNvbXB1dGluZyBzY29yZTpcbicpOw0KDQogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcmVzdWx0cy5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkgew0KICAgICAgICB2YXIgb3V0cHV0ID0gcmVzdWx0c1tpXS5vdXRwdXQ7DQogICAgICAgIHZhciBzY29yZUxlbiA9IG91dHB1dC5sZW5ndGg7DQoNCiAgICAgICAgdmFyIHRvdGFsU2NvcmUgPSAwOw0KICAgICAgICB2YXIgYmVzdFNjb3JlID0gMTsNCg0KICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNjb3JlTGVuOyBqICs9IDEpIHsNCiAgICAgICAgICB2YXIgd2VpZ2h0ID0gd2VpZ2h0cyA/IHdlaWdodHNbb3V0cHV0W2pdLmtleV0ud2VpZ2h0IDogMTsNCiAgICAgICAgICB2YXIgc2NvcmUgPSB3ZWlnaHQgPT09IDEgPyBvdXRwdXRbal0uc2NvcmUgOiBvdXRwdXRbal0uc2NvcmUgfHwgMC4wMDE7DQogICAgICAgICAgdmFyIG5TY29yZSA9IHNjb3JlICogd2VpZ2h0Ow0KDQogICAgICAgICAgaWYgKHdlaWdodCAhPT0gMSkgew0KICAgICAgICAgICAgYmVzdFNjb3JlID0gTWF0aC5taW4oYmVzdFNjb3JlLCBuU2NvcmUpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBvdXRwdXRbal0ublNjb3JlID0gblNjb3JlOw0KICAgICAgICAgICAgdG90YWxTY29yZSArPSBuU2NvcmU7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmVzdWx0c1tpXS5zY29yZSA9IGJlc3RTY29yZSA9PT0gMSA/IHRvdGFsU2NvcmUgLyBzY29yZUxlbiA6IGJlc3RTY29yZTsNCg0KICAgICAgICB0aGlzLl9sb2cocmVzdWx0c1tpXSk7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX3NvcnQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfc29ydChyZXN1bHRzKSB7DQogICAgICB0aGlzLl9sb2coJ1xuXG5Tb3J0aW5nLi4uLicpOw0KICAgICAgcmVzdWx0cy5zb3J0KHRoaXMub3B0aW9ucy5zb3J0Rm4pOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19mb3JtYXQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfZm9ybWF0KHJlc3VsdHMpIHsNCiAgICAgIHZhciBmaW5hbE91dHB1dCA9IFtdOw0KDQogICAgICB0aGlzLl9sb2coJ1xuXG5PdXRwdXQ6XG5cbicsIEpTT04uc3RyaW5naWZ5KHJlc3VsdHMpKTsNCg0KICAgICAgdmFyIHRyYW5zZm9ybWVycyA9IFtdOw0KDQogICAgICBpZiAodGhpcy5vcHRpb25zLmluY2x1ZGVNYXRjaGVzKSB7DQogICAgICAgIHRyYW5zZm9ybWVycy5wdXNoKGZ1bmN0aW9uIChyZXN1bHQsIGRhdGEpIHsNCiAgICAgICAgICB2YXIgb3V0cHV0ID0gcmVzdWx0Lm91dHB1dDsNCiAgICAgICAgICBkYXRhLm1hdGNoZXMgPSBbXTsNCg0KICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBvdXRwdXQubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDEpIHsNCiAgICAgICAgICAgIHZhciBpdGVtID0gb3V0cHV0W2ldOw0KDQogICAgICAgICAgICBpZiAoaXRlbS5tYXRjaGVkSW5kaWNlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhciBvYmogPSB7DQogICAgICAgICAgICAgIGluZGljZXM6IGl0ZW0ubWF0Y2hlZEluZGljZXMsDQogICAgICAgICAgICAgIHZhbHVlOiBpdGVtLnZhbHVlDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgaWYgKGl0ZW0ua2V5KSB7DQogICAgICAgICAgICAgIG9iai5rZXkgPSBpdGVtLmtleTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KCdhcnJheUluZGV4JykgJiYgaXRlbS5hcnJheUluZGV4ID4gLTEpIHsNCiAgICAgICAgICAgICAgb2JqLmFycmF5SW5kZXggPSBpdGVtLmFycmF5SW5kZXg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBkYXRhLm1hdGNoZXMucHVzaChvYmopOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5jbHVkZVNjb3JlKSB7DQogICAgICAgIHRyYW5zZm9ybWVycy5wdXNoKGZ1bmN0aW9uIChyZXN1bHQsIGRhdGEpIHsNCiAgICAgICAgICBkYXRhLnNjb3JlID0gcmVzdWx0LnNjb3JlOw0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHJlc3VsdHMubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDEpIHsNCiAgICAgICAgdmFyIHJlc3VsdCA9IHJlc3VsdHNbaV07DQoNCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZCkgew0KICAgICAgICAgIHJlc3VsdC5pdGVtID0gdGhpcy5vcHRpb25zLmdldEZuKHJlc3VsdC5pdGVtLCB0aGlzLm9wdGlvbnMuaWQpWzBdOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCF0cmFuc2Zvcm1lcnMubGVuZ3RoKSB7DQogICAgICAgICAgZmluYWxPdXRwdXQucHVzaChyZXN1bHQuaXRlbSk7DQogICAgICAgICAgY29udGludWU7DQogICAgICAgIH0NCg0KICAgICAgICB2YXIgZGF0YSA9IHsNCiAgICAgICAgICBpdGVtOiByZXN1bHQuaXRlbQ0KICAgICAgICB9Ow0KDQogICAgICAgIGZvciAodmFyIGogPSAwLCBfbGVuMiA9IHRyYW5zZm9ybWVycy5sZW5ndGg7IGogPCBfbGVuMjsgaiArPSAxKSB7DQogICAgICAgICAgdHJhbnNmb3JtZXJzW2pdKHJlc3VsdCwgZGF0YSk7DQogICAgICAgIH0NCg0KICAgICAgICBmaW5hbE91dHB1dC5wdXNoKGRhdGEpOw0KICAgICAgfQ0KDQogICAgICByZXR1cm4gZmluYWxPdXRwdXQ7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX2xvZycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9sb2coKSB7DQogICAgICBpZiAodGhpcy5vcHRpb25zLnZlcmJvc2UpIHsNCiAgICAgICAgdmFyIF9jb25zb2xlOw0KDQogICAgICAgIChfY29uc29sZSA9IGNvbnNvbGUpLmxvZy5hcHBseShfY29uc29sZSwgYXJndW1lbnRzKTsNCiAgICAgIH0NCiAgICB9DQogIH1dKTsNCg0KICByZXR1cm4gRnVzZTsNCn0oKTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBGdXNlOw0KDQovKioqLyB9KQ0KLyoqKioqKi8gXSk7DQp9KTsNCi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZ1c2UuanMubWFwDQoNCi8qKiovIH0pLA0KLyogNDAgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KT2JqZWN0LmRlZmluZVByb3BlcnR5KF9fd2VicGFja19leHBvcnRzX18sICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsNCnZhciBpc01lcmdlYWJsZU9iamVjdCA9IGZ1bmN0aW9uIGlzTWVyZ2VhYmxlT2JqZWN0KHZhbHVlKSB7DQoJcmV0dXJuIGlzTm9uTnVsbE9iamVjdCh2YWx1ZSkNCgkJJiYgIWlzU3BlY2lhbCh2YWx1ZSkNCn07DQoNCmZ1bmN0aW9uIGlzTm9uTnVsbE9iamVjdCh2YWx1ZSkgew0KCXJldHVybiAhIXZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcNCn0NCg0KZnVuY3Rpb24gaXNTcGVjaWFsKHZhbHVlKSB7DQoJdmFyIHN0cmluZ1ZhbHVlID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKTsNCg0KCXJldHVybiBzdHJpbmdWYWx1ZSA9PT0gJ1tvYmplY3QgUmVnRXhwXScNCgkJfHwgc3RyaW5nVmFsdWUgPT09ICdbb2JqZWN0IERhdGVdJw0KCQl8fCBpc1JlYWN0RWxlbWVudCh2YWx1ZSkNCn0NCg0KLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWFjdC9ibG9iL2I1YWM5NjNmYjc5MWQxMjk4ZTdmMzk2MjM2MzgzYmM5NTVmOTE2YzEvc3JjL2lzb21vcnBoaWMvY2xhc3NpYy9lbGVtZW50L1JlYWN0RWxlbWVudC5qcyNMMjEtTDI1DQp2YXIgY2FuVXNlU3ltYm9sID0gdHlwZW9mIFN5bWJvbCA9PT0gJ2Z1bmN0aW9uJyAmJiBTeW1ib2wuZm9yOw0KdmFyIFJFQUNUX0VMRU1FTlRfVFlQRSA9IGNhblVzZVN5bWJvbCA/IFN5bWJvbC5mb3IoJ3JlYWN0LmVsZW1lbnQnKSA6IDB4ZWFjNzsNCg0KZnVuY3Rpb24gaXNSZWFjdEVsZW1lbnQodmFsdWUpIHsNCglyZXR1cm4gdmFsdWUuJCR0eXBlb2YgPT09IFJFQUNUX0VMRU1FTlRfVFlQRQ0KfQ0KDQpmdW5jdGlvbiBlbXB0eVRhcmdldCh2YWwpIHsNCglyZXR1cm4gQXJyYXkuaXNBcnJheSh2YWwpID8gW10gOiB7fQ0KfQ0KDQpmdW5jdGlvbiBjbG9uZVVubGVzc090aGVyd2lzZVNwZWNpZmllZCh2YWx1ZSwgb3B0aW9ucykgew0KCXJldHVybiAob3B0aW9ucy5jbG9uZSAhPT0gZmFsc2UgJiYgb3B0aW9ucy5pc01lcmdlYWJsZU9iamVjdCh2YWx1ZSkpDQoJCT8gZGVlcG1lcmdlKGVtcHR5VGFyZ2V0KHZhbHVlKSwgdmFsdWUsIG9wdGlvbnMpDQoJCTogdmFsdWUNCn0NCg0KZnVuY3Rpb24gZGVmYXVsdEFycmF5TWVyZ2UodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpIHsNCglyZXR1cm4gdGFyZ2V0LmNvbmNhdChzb3VyY2UpLm1hcChmdW5jdGlvbihlbGVtZW50KSB7DQoJCXJldHVybiBjbG9uZVVubGVzc090aGVyd2lzZVNwZWNpZmllZChlbGVtZW50LCBvcHRpb25zKQ0KCX0pDQp9DQoNCmZ1bmN0aW9uIG1lcmdlT2JqZWN0KHRhcmdldCwgc291cmNlLCBvcHRpb25zKSB7DQoJdmFyIGRlc3RpbmF0aW9uID0ge307DQoJaWYgKG9wdGlvbnMuaXNNZXJnZWFibGVPYmplY3QodGFyZ2V0KSkgew0KCQlPYmplY3Qua2V5cyh0YXJnZXQpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7DQoJCQlkZXN0aW5hdGlvbltrZXldID0gY2xvbmVVbmxlc3NPdGhlcndpc2VTcGVjaWZpZWQodGFyZ2V0W2tleV0sIG9wdGlvbnMpOw0KCQl9KTsNCgl9DQoJT2JqZWN0LmtleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgew0KCQlpZiAoIW9wdGlvbnMuaXNNZXJnZWFibGVPYmplY3Qoc291cmNlW2tleV0pIHx8ICF0YXJnZXRba2V5XSkgew0KCQkJZGVzdGluYXRpb25ba2V5XSA9IGNsb25lVW5sZXNzT3RoZXJ3aXNlU3BlY2lmaWVkKHNvdXJjZVtrZXldLCBvcHRpb25zKTsNCgkJfSBlbHNlIHsNCgkJCWRlc3RpbmF0aW9uW2tleV0gPSBkZWVwbWVyZ2UodGFyZ2V0W2tleV0sIHNvdXJjZVtrZXldLCBvcHRpb25zKTsNCgkJfQ0KCX0pOw0KCXJldHVybiBkZXN0aW5hdGlvbg0KfQ0KDQpmdW5jdGlvbiBkZWVwbWVyZ2UodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpIHsNCglvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsNCglvcHRpb25zLmFycmF5TWVyZ2UgPSBvcHRpb25zLmFycmF5TWVyZ2UgfHwgZGVmYXVsdEFycmF5TWVyZ2U7DQoJb3B0aW9ucy5pc01lcmdlYWJsZU9iamVjdCA9IG9wdGlvbnMuaXNNZXJnZWFibGVPYmplY3QgfHwgaXNNZXJnZWFibGVPYmplY3Q7DQoNCgl2YXIgc291cmNlSXNBcnJheSA9IEFycmF5LmlzQXJyYXkoc291cmNlKTsNCgl2YXIgdGFyZ2V0SXNBcnJheSA9IEFycmF5LmlzQXJyYXkodGFyZ2V0KTsNCgl2YXIgc291cmNlQW5kVGFyZ2V0VHlwZXNNYXRjaCA9IHNvdXJjZUlzQXJyYXkgPT09IHRhcmdldElzQXJyYXk7DQoNCglpZiAoIXNvdXJjZUFuZFRhcmdldFR5cGVzTWF0Y2gpIHsNCgkJcmV0dXJuIGNsb25lVW5sZXNzT3RoZXJ3aXNlU3BlY2lmaWVkKHNvdXJjZSwgb3B0aW9ucykNCgl9IGVsc2UgaWYgKHNvdXJjZUlzQXJyYXkpIHsNCgkJcmV0dXJuIG9wdGlvbnMuYXJyYXlNZXJnZSh0YXJnZXQsIHNvdXJjZSwgb3B0aW9ucykNCgl9IGVsc2Ugew0KCQlyZXR1cm4gbWVyZ2VPYmplY3QodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpDQoJfQ0KfQ0KDQpkZWVwbWVyZ2UuYWxsID0gZnVuY3Rpb24gZGVlcG1lcmdlQWxsKGFycmF5LCBvcHRpb25zKSB7DQoJaWYgKCFBcnJheS5pc0FycmF5KGFycmF5KSkgew0KCQl0aHJvdyBuZXcgRXJyb3IoJ2ZpcnN0IGFyZ3VtZW50IHNob3VsZCBiZSBhbiBhcnJheScpDQoJfQ0KDQoJcmV0dXJuIGFycmF5LnJlZHVjZShmdW5jdGlvbihwcmV2LCBuZXh0KSB7DQoJCXJldHVybiBkZWVwbWVyZ2UocHJldiwgbmV4dCwgb3B0aW9ucykNCgl9LCB7fSkNCn07DQoNCnZhciBkZWVwbWVyZ2VfMSA9IGRlZXBtZXJnZTsNCg0KLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyBfX3dlYnBhY2tfZXhwb3J0c19fWyJkZWZhdWx0Il0gPSAoZGVlcG1lcmdlXzEpOw0KDQoNCi8qKiovIH0pLA0KLyogNDEgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCl9fd2VicGFja19yZXF1aXJlX18oNDIpOw0KDQpfX3dlYnBhY2tfcmVxdWlyZV9fKDUxKTsNCg0KX193ZWJwYWNrX3JlcXVpcmVfXyg3MCk7DQoNCl9fd2VicGFja19yZXF1aXJlX18oNzIpOw0KDQovKioqLyB9KSwNCi8qIDQyICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCl9fd2VicGFja19yZXF1aXJlX18oNDMpOw0KbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpLkFycmF5LmZpbmQ7DQoNCg0KLyoqKi8gfSksDQovKiA0MyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCi8vIDIyLjEuMy44IEFycmF5LnByb3RvdHlwZS5maW5kKHByZWRpY2F0ZSwgdGhpc0FyZyA9IHVuZGVmaW5lZCkNCnZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsNCnZhciAkZmluZCA9IF9fd2VicGFja19yZXF1aXJlX18oNDcpKDUpOw0KdmFyIEtFWSA9ICdmaW5kJzsNCnZhciBmb3JjZWQgPSB0cnVlOw0KLy8gU2hvdWxkbid0IHNraXAgaG9sZXMNCmlmIChLRVkgaW4gW10pIEFycmF5KDEpW0tFWV0oZnVuY3Rpb24gKCkgeyBmb3JjZWQgPSBmYWxzZTsgfSk7DQokZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIGZvcmNlZCwgJ0FycmF5Jywgew0KICBmaW5kOiBmdW5jdGlvbiBmaW5kKGNhbGxiYWNrZm4gLyogLCB0aGF0ID0gdW5kZWZpbmVkICovKSB7DQogICAgcmV0dXJuICRmaW5kKHRoaXMsIGNhbGxiYWNrZm4sIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsNCiAgfQ0KfSk7DQpfX3dlYnBhY2tfcmVxdWlyZV9fKDI4KShLRVkpOw0KDQoNCi8qKiovIH0pLA0KLyogNDQgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KbW9kdWxlLmV4cG9ydHMgPSAhX193ZWJwYWNrX3JlcXVpcmVfXygxMCkgJiYgIV9fd2VicGFja19yZXF1aXJlX18oMjIpKGZ1bmN0aW9uICgpIHsNCiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfX3dlYnBhY2tfcmVxdWlyZV9fKDIzKSgnZGl2JyksICdhJywgeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDc7IH0gfSkuYSAhPSA3Ow0KfSk7DQoNCg0KLyoqKi8gfSksDQovKiA0NSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyA3LjEuMSBUb1ByaW1pdGl2ZShpbnB1dCBbLCBQcmVmZXJyZWRUeXBlXSkNCnZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOSk7DQovLyBpbnN0ZWFkIG9mIHRoZSBFUzYgc3BlYyB2ZXJzaW9uLCB3ZSBkaWRuJ3QgaW1wbGVtZW50IEBAdG9QcmltaXRpdmUgY2FzZQ0KLy8gYW5kIHRoZSBzZWNvbmQgYXJndW1lbnQgLSBmbGFnIC0gcHJlZmVycmVkIHR5cGUgaXMgYSBzdHJpbmcNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0LCBTKSB7DQogIGlmICghaXNPYmplY3QoaXQpKSByZXR1cm4gaXQ7DQogIHZhciBmbiwgdmFsOw0KICBpZiAoUyAmJiB0eXBlb2YgKGZuID0gaXQudG9TdHJpbmcpID09ICdmdW5jdGlvbicgJiYgIWlzT2JqZWN0KHZhbCA9IGZuLmNhbGwoaXQpKSkgcmV0dXJuIHZhbDsNCiAgaWYgKHR5cGVvZiAoZm4gPSBpdC52YWx1ZU9mKSA9PSAnZnVuY3Rpb24nICYmICFpc09iamVjdCh2YWwgPSBmbi5jYWxsKGl0KSkpIHJldHVybiB2YWw7DQogIGlmICghUyAmJiB0eXBlb2YgKGZuID0gaXQudG9TdHJpbmcpID09ICdmdW5jdGlvbicgJiYgIWlzT2JqZWN0KHZhbCA9IGZuLmNhbGwoaXQpKSkgcmV0dXJuIHZhbDsNCiAgdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA0NiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgew0KICBpZiAodHlwZW9mIGl0ICE9ICdmdW5jdGlvbicpIHRocm93IFR5cGVFcnJvcihpdCArICcgaXMgbm90IGEgZnVuY3Rpb24hJyk7DQogIHJldHVybiBpdDsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA0NyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyAwIC0+IEFycmF5I2ZvckVhY2gNCi8vIDEgLT4gQXJyYXkjbWFwDQovLyAyIC0+IEFycmF5I2ZpbHRlcg0KLy8gMyAtPiBBcnJheSNzb21lDQovLyA0IC0+IEFycmF5I2V2ZXJ5DQovLyA1IC0+IEFycmF5I2ZpbmQNCi8vIDYgLT4gQXJyYXkjZmluZEluZGV4DQp2YXIgY3R4ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNCk7DQp2YXIgSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjUpOw0KdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNik7DQp2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE4KTsNCnZhciBhc2MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4KTsNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKFRZUEUsICRjcmVhdGUpIHsNCiAgdmFyIElTX01BUCA9IFRZUEUgPT0gMTsNCiAgdmFyIElTX0ZJTFRFUiA9IFRZUEUgPT0gMjsNCiAgdmFyIElTX1NPTUUgPSBUWVBFID09IDM7DQogIHZhciBJU19FVkVSWSA9IFRZUEUgPT0gNDsNCiAgdmFyIElTX0ZJTkRfSU5ERVggPSBUWVBFID09IDY7DQogIHZhciBOT19IT0xFUyA9IFRZUEUgPT0gNSB8fCBJU19GSU5EX0lOREVYOw0KICB2YXIgY3JlYXRlID0gJGNyZWF0ZSB8fCBhc2M7DQogIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIGNhbGxiYWNrZm4sIHRoYXQpIHsNCiAgICB2YXIgTyA9IHRvT2JqZWN0KCR0aGlzKTsNCiAgICB2YXIgc2VsZiA9IElPYmplY3QoTyk7DQogICAgdmFyIGYgPSBjdHgoY2FsbGJhY2tmbiwgdGhhdCwgMyk7DQogICAgdmFyIGxlbmd0aCA9IHRvTGVuZ3RoKHNlbGYubGVuZ3RoKTsNCiAgICB2YXIgaW5kZXggPSAwOw0KICAgIHZhciByZXN1bHQgPSBJU19NQVAgPyBjcmVhdGUoJHRoaXMsIGxlbmd0aCkgOiBJU19GSUxURVIgPyBjcmVhdGUoJHRoaXMsIDApIDogdW5kZWZpbmVkOw0KICAgIHZhciB2YWwsIHJlczsNCiAgICBmb3IgKDtsZW5ndGggPiBpbmRleDsgaW5kZXgrKykgaWYgKE5PX0hPTEVTIHx8IGluZGV4IGluIHNlbGYpIHsNCiAgICAgIHZhbCA9IHNlbGZbaW5kZXhdOw0KICAgICAgcmVzID0gZih2YWwsIGluZGV4LCBPKTsNCiAgICAgIGlmIChUWVBFKSB7DQogICAgICAgIGlmIChJU19NQVApIHJlc3VsdFtpbmRleF0gPSByZXM7ICAgLy8gbWFwDQogICAgICAgIGVsc2UgaWYgKHJlcykgc3dpdGNoIChUWVBFKSB7DQogICAgICAgICAgY2FzZSAzOiByZXR1cm4gdHJ1ZTsgICAgICAgICAgICAgLy8gc29tZQ0KICAgICAgICAgIGNhc2UgNTogcmV0dXJuIHZhbDsgICAgICAgICAgICAgIC8vIGZpbmQNCiAgICAgICAgICBjYXNlIDY6IHJldHVybiBpbmRleDsgICAgICAgICAgICAvLyBmaW5kSW5kZXgNCiAgICAgICAgICBjYXNlIDI6IHJlc3VsdC5wdXNoKHZhbCk7ICAgICAgICAvLyBmaWx0ZXINCiAgICAgICAgfSBlbHNlIGlmIChJU19FVkVSWSkgcmV0dXJuIGZhbHNlOyAvLyBldmVyeQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gSVNfRklORF9JTkRFWCA/IC0xIDogSVNfU09NRSB8fCBJU19FVkVSWSA/IElTX0VWRVJZIDogcmVzdWx0Ow0KICB9Ow0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDQ4ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIDkuNC4yLjMgQXJyYXlTcGVjaWVzQ3JlYXRlKG9yaWdpbmFsQXJyYXksIGxlbmd0aCkNCnZhciBzcGVjaWVzQ29uc3RydWN0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ5KTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob3JpZ2luYWwsIGxlbmd0aCkgew0KICByZXR1cm4gbmV3IChzcGVjaWVzQ29uc3RydWN0b3Iob3JpZ2luYWwpKShsZW5ndGgpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDQ5ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOSk7DQp2YXIgaXNBcnJheSA9IF9fd2VicGFja19yZXF1aXJlX18oNTApOw0KdmFyIFNQRUNJRVMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApKCdzcGVjaWVzJyk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9yaWdpbmFsKSB7DQogIHZhciBDOw0KICBpZiAoaXNBcnJheShvcmlnaW5hbCkpIHsNCiAgICBDID0gb3JpZ2luYWwuY29uc3RydWN0b3I7DQogICAgLy8gY3Jvc3MtcmVhbG0gZmFsbGJhY2sNCiAgICBpZiAodHlwZW9mIEMgPT0gJ2Z1bmN0aW9uJyAmJiAoQyA9PT0gQXJyYXkgfHwgaXNBcnJheShDLnByb3RvdHlwZSkpKSBDID0gdW5kZWZpbmVkOw0KICAgIGlmIChpc09iamVjdChDKSkgew0KICAgICAgQyA9IENbU1BFQ0lFU107DQogICAgICBpZiAoQyA9PT0gbnVsbCkgQyA9IHVuZGVmaW5lZDsNCiAgICB9DQogIH0gcmV0dXJuIEMgPT09IHVuZGVmaW5lZCA/IEFycmF5IDogQzsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA1MCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyA3LjIuMiBJc0FycmF5KGFyZ3VtZW50KQ0KdmFyIGNvZiA9IF9fd2VicGFja19yZXF1aXJlX18oMTUpOw0KbW9kdWxlLmV4cG9ydHMgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uIGlzQXJyYXkoYXJnKSB7DQogIHJldHVybiBjb2YoYXJnKSA9PSAnQXJyYXknOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDUxICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCl9fd2VicGFja19yZXF1aXJlX18oNTIpOw0KX193ZWJwYWNrX3JlcXVpcmVfXyg2Myk7DQptb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMikuQXJyYXkuZnJvbTsNCg0KDQovKioqLyB9KSwNCi8qIDUyICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KdmFyICRhdCA9IF9fd2VicGFja19yZXF1aXJlX18oNTMpKHRydWUpOw0KDQovLyAyMS4xLjMuMjcgU3RyaW5nLnByb3RvdHlwZVtAQGl0ZXJhdG9yXSgpDQpfX3dlYnBhY2tfcmVxdWlyZV9fKDU0KShTdHJpbmcsICdTdHJpbmcnLCBmdW5jdGlvbiAoaXRlcmF0ZWQpIHsNCiAgdGhpcy5fdCA9IFN0cmluZyhpdGVyYXRlZCk7IC8vIHRhcmdldA0KICB0aGlzLl9pID0gMDsgICAgICAgICAgICAgICAgLy8gbmV4dCBpbmRleA0KLy8gMjEuMS41LjIuMSAlU3RyaW5nSXRlcmF0b3JQcm90b3R5cGUlLm5leHQoKQ0KfSwgZnVuY3Rpb24gKCkgew0KICB2YXIgTyA9IHRoaXMuX3Q7DQogIHZhciBpbmRleCA9IHRoaXMuX2k7DQogIHZhciBwb2ludDsNCiAgaWYgKGluZGV4ID49IE8ubGVuZ3RoKSByZXR1cm4geyB2YWx1ZTogdW5kZWZpbmVkLCBkb25lOiB0cnVlIH07DQogIHBvaW50ID0gJGF0KE8sIGluZGV4KTsNCiAgdGhpcy5faSArPSBwb2ludC5sZW5ndGg7DQogIHJldHVybiB7IHZhbHVlOiBwb2ludCwgZG9uZTogZmFsc2UgfTsNCn0pOw0KDQoNCi8qKiovIH0pLA0KLyogNTMgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIHRvSW50ZWdlciA9IF9fd2VicGFja19yZXF1aXJlX18oMTkpOw0KdmFyIGRlZmluZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3KTsNCi8vIHRydWUgIC0+IFN0cmluZyNhdA0KLy8gZmFsc2UgLT4gU3RyaW5nI2NvZGVQb2ludEF0DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChUT19TVFJJTkcpIHsNCiAgcmV0dXJuIGZ1bmN0aW9uICh0aGF0LCBwb3MpIHsNCiAgICB2YXIgcyA9IFN0cmluZyhkZWZpbmVkKHRoYXQpKTsNCiAgICB2YXIgaSA9IHRvSW50ZWdlcihwb3MpOw0KICAgIHZhciBsID0gcy5sZW5ndGg7DQogICAgdmFyIGEsIGI7DQogICAgaWYgKGkgPCAwIHx8IGkgPj0gbCkgcmV0dXJuIFRPX1NUUklORyA/ICcnIDogdW5kZWZpbmVkOw0KICAgIGEgPSBzLmNoYXJDb2RlQXQoaSk7DQogICAgcmV0dXJuIGEgPCAweGQ4MDAgfHwgYSA+IDB4ZGJmZiB8fCBpICsgMSA9PT0gbCB8fCAoYiA9IHMuY2hhckNvZGVBdChpICsgMSkpIDwgMHhkYzAwIHx8IGIgPiAweGRmZmYNCiAgICAgID8gVE9fU1RSSU5HID8gcy5jaGFyQXQoaSkgOiBhDQogICAgICA6IFRPX1NUUklORyA/IHMuc2xpY2UoaSwgaSArIDIpIDogKGEgLSAweGQ4MDAgPDwgMTApICsgKGIgLSAweGRjMDApICsgMHgxMDAwMDsNCiAgfTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA1NCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCnZhciBMSUJSQVJZID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNyk7DQp2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNik7DQp2YXIgcmVkZWZpbmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI0KTsNCnZhciBoaWRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTsNCnZhciBJdGVyYXRvcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwKTsNCnZhciAkaXRlckNyZWF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNTUpOw0KdmFyIHNldFRvU3RyaW5nVGFnID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMik7DQp2YXIgZ2V0UHJvdG90eXBlT2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYyKTsNCnZhciBJVEVSQVRPUiA9IF9fd2VicGFja19yZXF1aXJlX18oMCkoJ2l0ZXJhdG9yJyk7DQp2YXIgQlVHR1kgPSAhKFtdLmtleXMgJiYgJ25leHQnIGluIFtdLmtleXMoKSk7IC8vIFNhZmFyaSBoYXMgYnVnZ3kgaXRlcmF0b3JzIHcvbyBgbmV4dGANCnZhciBGRl9JVEVSQVRPUiA9ICdAQGl0ZXJhdG9yJzsNCnZhciBLRVlTID0gJ2tleXMnOw0KdmFyIFZBTFVFUyA9ICd2YWx1ZXMnOw0KDQp2YXIgcmV0dXJuVGhpcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH07DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKEJhc2UsIE5BTUUsIENvbnN0cnVjdG9yLCBuZXh0LCBERUZBVUxULCBJU19TRVQsIEZPUkNFRCkgew0KICAkaXRlckNyZWF0ZShDb25zdHJ1Y3RvciwgTkFNRSwgbmV4dCk7DQogIHZhciBnZXRNZXRob2QgPSBmdW5jdGlvbiAoa2luZCkgew0KICAgIGlmICghQlVHR1kgJiYga2luZCBpbiBwcm90bykgcmV0dXJuIHByb3RvW2tpbmRdOw0KICAgIHN3aXRjaCAoa2luZCkgew0KICAgICAgY2FzZSBLRVlTOiByZXR1cm4gZnVuY3Rpb24ga2V5cygpIHsgcmV0dXJuIG5ldyBDb25zdHJ1Y3Rvcih0aGlzLCBraW5kKTsgfTsNCiAgICAgIGNhc2UgVkFMVUVTOiByZXR1cm4gZnVuY3Rpb24gdmFsdWVzKCkgeyByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOyB9Ow0KICAgIH0gcmV0dXJuIGZ1bmN0aW9uIGVudHJpZXMoKSB7IHJldHVybiBuZXcgQ29uc3RydWN0b3IodGhpcywga2luZCk7IH07DQogIH07DQogIHZhciBUQUcgPSBOQU1FICsgJyBJdGVyYXRvcic7DQogIHZhciBERUZfVkFMVUVTID0gREVGQVVMVCA9PSBWQUxVRVM7DQogIHZhciBWQUxVRVNfQlVHID0gZmFsc2U7DQogIHZhciBwcm90byA9IEJhc2UucHJvdG90eXBlOw0KICB2YXIgJG5hdGl2ZSA9IHByb3RvW0lURVJBVE9SXSB8fCBwcm90b1tGRl9JVEVSQVRPUl0gfHwgREVGQVVMVCAmJiBwcm90b1tERUZBVUxUXTsNCiAgdmFyICRkZWZhdWx0ID0gJG5hdGl2ZSB8fCBnZXRNZXRob2QoREVGQVVMVCk7DQogIHZhciAkZW50cmllcyA9IERFRkFVTFQgPyAhREVGX1ZBTFVFUyA/ICRkZWZhdWx0IDogZ2V0TWV0aG9kKCdlbnRyaWVzJykgOiB1bmRlZmluZWQ7DQogIHZhciAkYW55TmF0aXZlID0gTkFNRSA9PSAnQXJyYXknID8gcHJvdG8uZW50cmllcyB8fCAkbmF0aXZlIDogJG5hdGl2ZTsNCiAgdmFyIG1ldGhvZHMsIGtleSwgSXRlcmF0b3JQcm90b3R5cGU7DQogIC8vIEZpeCBuYXRpdmUNCiAgaWYgKCRhbnlOYXRpdmUpIHsNCiAgICBJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvdHlwZU9mKCRhbnlOYXRpdmUuY2FsbChuZXcgQmFzZSgpKSk7DQogICAgaWYgKEl0ZXJhdG9yUHJvdG90eXBlICE9PSBPYmplY3QucHJvdG90eXBlICYmIEl0ZXJhdG9yUHJvdG90eXBlLm5leHQpIHsNCiAgICAgIC8vIFNldCBAQHRvU3RyaW5nVGFnIHRvIG5hdGl2ZSBpdGVyYXRvcnMNCiAgICAgIHNldFRvU3RyaW5nVGFnKEl0ZXJhdG9yUHJvdG90eXBlLCBUQUcsIHRydWUpOw0KICAgICAgLy8gZml4IGZvciBzb21lIG9sZCBlbmdpbmVzDQogICAgICBpZiAoIUxJQlJBUlkgJiYgdHlwZW9mIEl0ZXJhdG9yUHJvdG90eXBlW0lURVJBVE9SXSAhPSAnZnVuY3Rpb24nKSBoaWRlKEl0ZXJhdG9yUHJvdG90eXBlLCBJVEVSQVRPUiwgcmV0dXJuVGhpcyk7DQogICAgfQ0KICB9DQogIC8vIGZpeCBBcnJheSN7dmFsdWVzLCBAQGl0ZXJhdG9yfS5uYW1lIGluIFY4IC8gRkYNCiAgaWYgKERFRl9WQUxVRVMgJiYgJG5hdGl2ZSAmJiAkbmF0aXZlLm5hbWUgIT09IFZBTFVFUykgew0KICAgIFZBTFVFU19CVUcgPSB0cnVlOw0KICAgICRkZWZhdWx0ID0gZnVuY3Rpb24gdmFsdWVzKCkgeyByZXR1cm4gJG5hdGl2ZS5jYWxsKHRoaXMpOyB9Ow0KICB9DQogIC8vIERlZmluZSBpdGVyYXRvcg0KICBpZiAoKCFMSUJSQVJZIHx8IEZPUkNFRCkgJiYgKEJVR0dZIHx8IFZBTFVFU19CVUcgfHwgIXByb3RvW0lURVJBVE9SXSkpIHsNCiAgICBoaWRlKHByb3RvLCBJVEVSQVRPUiwgJGRlZmF1bHQpOw0KICB9DQogIC8vIFBsdWcgZm9yIGxpYnJhcnkNCiAgSXRlcmF0b3JzW05BTUVdID0gJGRlZmF1bHQ7DQogIEl0ZXJhdG9yc1tUQUddID0gcmV0dXJuVGhpczsNCiAgaWYgKERFRkFVTFQpIHsNCiAgICBtZXRob2RzID0gew0KICAgICAgdmFsdWVzOiBERUZfVkFMVUVTID8gJGRlZmF1bHQgOiBnZXRNZXRob2QoVkFMVUVTKSwNCiAgICAgIGtleXM6IElTX1NFVCA/ICRkZWZhdWx0IDogZ2V0TWV0aG9kKEtFWVMpLA0KICAgICAgZW50cmllczogJGVudHJpZXMNCiAgICB9Ow0KICAgIGlmIChGT1JDRUQpIGZvciAoa2V5IGluIG1ldGhvZHMpIHsNCiAgICAgIGlmICghKGtleSBpbiBwcm90bykpIHJlZGVmaW5lKHByb3RvLCBrZXksIG1ldGhvZHNba2V5XSk7DQogICAgfSBlbHNlICRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogKEJVR0dZIHx8IFZBTFVFU19CVUcpLCBOQU1FLCBtZXRob2RzKTsNCiAgfQ0KICByZXR1cm4gbWV0aG9kczsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA1NSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCnZhciBjcmVhdGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU2KTsNCnZhciBkZXNjcmlwdG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMik7DQp2YXIgc2V0VG9TdHJpbmdUYWcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMyKTsNCnZhciBJdGVyYXRvclByb3RvdHlwZSA9IHt9Ow0KDQovLyAyNS4xLjIuMS4xICVJdGVyYXRvclByb3RvdHlwZSVbQEBpdGVyYXRvcl0oKQ0KX193ZWJwYWNrX3JlcXVpcmVfXyg0KShJdGVyYXRvclByb3RvdHlwZSwgX193ZWJwYWNrX3JlcXVpcmVfXygwKSgnaXRlcmF0b3InKSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBOQU1FLCBuZXh0KSB7DQogIENvbnN0cnVjdG9yLnByb3RvdHlwZSA9IGNyZWF0ZShJdGVyYXRvclByb3RvdHlwZSwgeyBuZXh0OiBkZXNjcmlwdG9yKDEsIG5leHQpIH0pOw0KICBzZXRUb1N0cmluZ1RhZyhDb25zdHJ1Y3RvciwgTkFNRSArICcgSXRlcmF0b3InKTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA1NiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyAxOS4xLjIuMiAvIDE1LjIuMy41IE9iamVjdC5jcmVhdGUoTyBbLCBQcm9wZXJ0aWVzXSkNCnZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7DQp2YXIgZFBzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1Nyk7DQp2YXIgZW51bUJ1Z0tleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMxKTsNCnZhciBJRV9QUk9UTyA9IF9fd2VicGFja19yZXF1aXJlX18oMjEpKCdJRV9QUk9UTycpOw0KdmFyIEVtcHR5ID0gZnVuY3Rpb24gKCkgeyAvKiBlbXB0eSAqLyB9Ow0KdmFyIFBST1RPVFlQRSA9ICdwcm90b3R5cGUnOw0KDQovLyBDcmVhdGUgb2JqZWN0IHdpdGggZmFrZSBgbnVsbGAgcHJvdG90eXBlOiB1c2UgaWZyYW1lIE9iamVjdCB3aXRoIGNsZWFyZWQgcHJvdG90eXBlDQp2YXIgY3JlYXRlRGljdCA9IGZ1bmN0aW9uICgpIHsNCiAgLy8gVGhyYXNoLCB3YXN0ZSBhbmQgc29kb215OiBJRSBHQyBidWcNCiAgdmFyIGlmcmFtZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjMpKCdpZnJhbWUnKTsNCiAgdmFyIGkgPSBlbnVtQnVnS2V5cy5sZW5ndGg7DQogIHZhciBsdCA9ICc8JzsNCiAgdmFyIGd0ID0gJz4nOw0KICB2YXIgaWZyYW1lRG9jdW1lbnQ7DQogIGlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxKS5hcHBlbmRDaGlsZChpZnJhbWUpOw0KICBpZnJhbWUuc3JjID0gJ2phdmFzY3JpcHQ6JzsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1zY3JpcHQtdXJsDQogIC8vIGNyZWF0ZURpY3QgPSBpZnJhbWUuY29udGVudFdpbmRvdy5PYmplY3Q7DQogIC8vIGh0bWwucmVtb3ZlQ2hpbGQoaWZyYW1lKTsNCiAgaWZyYW1lRG9jdW1lbnQgPSBpZnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudDsNCiAgaWZyYW1lRG9jdW1lbnQub3BlbigpOw0KICBpZnJhbWVEb2N1bWVudC53cml0ZShsdCArICdzY3JpcHQnICsgZ3QgKyAnZG9jdW1lbnQuRj1PYmplY3QnICsgbHQgKyAnL3NjcmlwdCcgKyBndCk7DQogIGlmcmFtZURvY3VtZW50LmNsb3NlKCk7DQogIGNyZWF0ZURpY3QgPSBpZnJhbWVEb2N1bWVudC5GOw0KICB3aGlsZSAoaS0tKSBkZWxldGUgY3JlYXRlRGljdFtQUk9UT1RZUEVdW2VudW1CdWdLZXlzW2ldXTsNCiAgcmV0dXJuIGNyZWF0ZURpY3QoKTsNCn07DQoNCm1vZHVsZS5leHBvcnRzID0gT2JqZWN0LmNyZWF0ZSB8fCBmdW5jdGlvbiBjcmVhdGUoTywgUHJvcGVydGllcykgew0KICB2YXIgcmVzdWx0Ow0KICBpZiAoTyAhPT0gbnVsbCkgew0KICAgIEVtcHR5W1BST1RPVFlQRV0gPSBhbk9iamVjdChPKTsNCiAgICByZXN1bHQgPSBuZXcgRW1wdHkoKTsNCiAgICBFbXB0eVtQUk9UT1RZUEVdID0gbnVsbDsNCiAgICAvLyBhZGQgIl9fcHJvdG9fXyIgZm9yIE9iamVjdC5nZXRQcm90b3R5cGVPZiBwb2x5ZmlsbA0KICAgIHJlc3VsdFtJRV9QUk9UT10gPSBPOw0KICB9IGVsc2UgcmVzdWx0ID0gY3JlYXRlRGljdCgpOw0KICByZXR1cm4gUHJvcGVydGllcyA9PT0gdW5kZWZpbmVkID8gcmVzdWx0IDogZFBzKHJlc3VsdCwgUHJvcGVydGllcyk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNTcgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIGRQID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KTsNCnZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7DQp2YXIgZ2V0S2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oNTgpOw0KDQptb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMTApID8gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMgOiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKE8sIFByb3BlcnRpZXMpIHsNCiAgYW5PYmplY3QoTyk7DQogIHZhciBrZXlzID0gZ2V0S2V5cyhQcm9wZXJ0aWVzKTsNCiAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoOw0KICB2YXIgaSA9IDA7DQogIHZhciBQOw0KICB3aGlsZSAobGVuZ3RoID4gaSkgZFAuZihPLCBQID0ga2V5c1tpKytdLCBQcm9wZXJ0aWVzW1BdKTsNCiAgcmV0dXJuIE87DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNTggKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gMTkuMS4yLjE0IC8gMTUuMi4zLjE0IE9iamVjdC5rZXlzKE8pDQp2YXIgJGtleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU5KTsNCnZhciBlbnVtQnVnS2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oMzEpOw0KDQptb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uIGtleXMoTykgew0KICByZXR1cm4gJGtleXMoTywgZW51bUJ1Z0tleXMpOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDU5ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKTsNCnZhciB0b0lPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI5KTsNCnZhciBhcnJheUluZGV4T2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMwKShmYWxzZSk7DQp2YXIgSUVfUFJPVE8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxKSgnSUVfUFJPVE8nKTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqZWN0LCBuYW1lcykgew0KICB2YXIgTyA9IHRvSU9iamVjdChvYmplY3QpOw0KICB2YXIgaSA9IDA7DQogIHZhciByZXN1bHQgPSBbXTsNCiAgdmFyIGtleTsNCiAgZm9yIChrZXkgaW4gTykgaWYgKGtleSAhPSBJRV9QUk9UTykgaGFzKE8sIGtleSkgJiYgcmVzdWx0LnB1c2goa2V5KTsNCiAgLy8gRG9uJ3QgZW51bSBidWcgJiBoaWRkZW4ga2V5cw0KICB3aGlsZSAobmFtZXMubGVuZ3RoID4gaSkgaWYgKGhhcyhPLCBrZXkgPSBuYW1lc1tpKytdKSkgew0KICAgIH5hcnJheUluZGV4T2YocmVzdWx0LCBrZXkpIHx8IHJlc3VsdC5wdXNoKGtleSk7DQogIH0NCiAgcmV0dXJuIHJlc3VsdDsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA2MCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQp2YXIgdG9JbnRlZ2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOSk7DQp2YXIgbWF4ID0gTWF0aC5tYXg7DQp2YXIgbWluID0gTWF0aC5taW47DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpbmRleCwgbGVuZ3RoKSB7DQogIGluZGV4ID0gdG9JbnRlZ2VyKGluZGV4KTsNCiAgcmV0dXJuIGluZGV4IDwgMCA/IG1heChpbmRleCArIGxlbmd0aCwgMCkgOiBtaW4oaW5kZXgsIGxlbmd0aCk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNjEgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKS5kb2N1bWVudDsNCm1vZHVsZS5leHBvcnRzID0gZG9jdW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Ow0KDQoNCi8qKiovIH0pLA0KLyogNjIgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KLy8gMTkuMS4yLjkgLyAxNS4yLjMuMiBPYmplY3QuZ2V0UHJvdG90eXBlT2YoTykNCnZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKTsNCnZhciB0b09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMTYpOw0KdmFyIElFX1BST1RPID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMSkoJ0lFX1BST1RPJyk7DQp2YXIgT2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOw0KDQptb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiAoTykgew0KICBPID0gdG9PYmplY3QoTyk7DQogIGlmIChoYXMoTywgSUVfUFJPVE8pKSByZXR1cm4gT1tJRV9QUk9UT107DQogIGlmICh0eXBlb2YgTy5jb25zdHJ1Y3RvciA9PSAnZnVuY3Rpb24nICYmIE8gaW5zdGFuY2VvZiBPLmNvbnN0cnVjdG9yKSB7DQogICAgcmV0dXJuIE8uY29uc3RydWN0b3IucHJvdG90eXBlOw0KICB9IHJldHVybiBPIGluc3RhbmNlb2YgT2JqZWN0ID8gT2JqZWN0UHJvdG8gOiBudWxsOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDYzICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KdmFyIGN0eCA9IF9fd2VicGFja19yZXF1aXJlX18oMTQpOw0KdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOw0KdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNik7DQp2YXIgY2FsbCA9IF9fd2VicGFja19yZXF1aXJlX18oNjQpOw0KdmFyIGlzQXJyYXlJdGVyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2NSk7DQp2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE4KTsNCnZhciBjcmVhdGVQcm9wZXJ0eSA9IF9fd2VicGFja19yZXF1aXJlX18oNjYpOw0KdmFyIGdldEl0ZXJGbiA9IF9fd2VicGFja19yZXF1aXJlX18oNjcpOw0KDQokZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICFfX3dlYnBhY2tfcmVxdWlyZV9fKDY5KShmdW5jdGlvbiAoaXRlcikgeyBBcnJheS5mcm9tKGl0ZXIpOyB9KSwgJ0FycmF5Jywgew0KICAvLyAyMi4xLjIuMSBBcnJheS5mcm9tKGFycmF5TGlrZSwgbWFwZm4gPSB1bmRlZmluZWQsIHRoaXNBcmcgPSB1bmRlZmluZWQpDQogIGZyb206IGZ1bmN0aW9uIGZyb20oYXJyYXlMaWtlIC8qICwgbWFwZm4gPSB1bmRlZmluZWQsIHRoaXNBcmcgPSB1bmRlZmluZWQgKi8pIHsNCiAgICB2YXIgTyA9IHRvT2JqZWN0KGFycmF5TGlrZSk7DQogICAgdmFyIEMgPSB0eXBlb2YgdGhpcyA9PSAnZnVuY3Rpb24nID8gdGhpcyA6IEFycmF5Ow0KICAgIHZhciBhTGVuID0gYXJndW1lbnRzLmxlbmd0aDsNCiAgICB2YXIgbWFwZm4gPSBhTGVuID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsNCiAgICB2YXIgbWFwcGluZyA9IG1hcGZuICE9PSB1bmRlZmluZWQ7DQogICAgdmFyIGluZGV4ID0gMDsNCiAgICB2YXIgaXRlckZuID0gZ2V0SXRlckZuKE8pOw0KICAgIHZhciBsZW5ndGgsIHJlc3VsdCwgc3RlcCwgaXRlcmF0b3I7DQogICAgaWYgKG1hcHBpbmcpIG1hcGZuID0gY3R4KG1hcGZuLCBhTGVuID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZCwgMik7DQogICAgLy8gaWYgb2JqZWN0IGlzbid0IGl0ZXJhYmxlIG9yIGl0J3MgYXJyYXkgd2l0aCBkZWZhdWx0IGl0ZXJhdG9yIC0gdXNlIHNpbXBsZSBjYXNlDQogICAgaWYgKGl0ZXJGbiAhPSB1bmRlZmluZWQgJiYgIShDID09IEFycmF5ICYmIGlzQXJyYXlJdGVyKGl0ZXJGbikpKSB7DQogICAgICBmb3IgKGl0ZXJhdG9yID0gaXRlckZuLmNhbGwoTyksIHJlc3VsdCA9IG5ldyBDKCk7ICEoc3RlcCA9IGl0ZXJhdG9yLm5leHQoKSkuZG9uZTsgaW5kZXgrKykgew0KICAgICAgICBjcmVhdGVQcm9wZXJ0eShyZXN1bHQsIGluZGV4LCBtYXBwaW5nID8gY2FsbChpdGVyYXRvciwgbWFwZm4sIFtzdGVwLnZhbHVlLCBpbmRleF0sIHRydWUpIDogc3RlcC52YWx1ZSk7DQogICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKTsNCiAgICAgIGZvciAocmVzdWx0ID0gbmV3IEMobGVuZ3RoKTsgbGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIHsNCiAgICAgICAgY3JlYXRlUHJvcGVydHkocmVzdWx0LCBpbmRleCwgbWFwcGluZyA/IG1hcGZuKE9baW5kZXhdLCBpbmRleCkgOiBPW2luZGV4XSk7DQogICAgICB9DQogICAgfQ0KICAgIHJlc3VsdC5sZW5ndGggPSBpbmRleDsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQp9KTsNCg0KDQovKioqLyB9KSwNCi8qIDY0ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIGNhbGwgc29tZXRoaW5nIG9uIGl0ZXJhdG9yIHN0ZXAgd2l0aCBzYWZlIGNsb3Npbmcgb24gZXJyb3INCnZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7DQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdGVyYXRvciwgZm4sIHZhbHVlLCBlbnRyaWVzKSB7DQogIHRyeSB7DQogICAgcmV0dXJuIGVudHJpZXMgPyBmbihhbk9iamVjdCh2YWx1ZSlbMF0sIHZhbHVlWzFdKSA6IGZuKHZhbHVlKTsNCiAgLy8gNy40LjYgSXRlcmF0b3JDbG9zZShpdGVyYXRvciwgY29tcGxldGlvbikNCiAgfSBjYXRjaCAoZSkgew0KICAgIHZhciByZXQgPSBpdGVyYXRvclsncmV0dXJuJ107DQogICAgaWYgKHJldCAhPT0gdW5kZWZpbmVkKSBhbk9iamVjdChyZXQuY2FsbChpdGVyYXRvcikpOw0KICAgIHRocm93IGU7DQogIH0NCn07DQoNCg0KLyoqKi8gfSksDQovKiA2NSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQovLyBjaGVjayBvbiBkZWZhdWx0IEFycmF5IGl0ZXJhdG9yDQp2YXIgSXRlcmF0b3JzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMCk7DQp2YXIgSVRFUkFUT1IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApKCdpdGVyYXRvcicpOw0KdmFyIEFycmF5UHJvdG8gPSBBcnJheS5wcm90b3R5cGU7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7DQogIHJldHVybiBpdCAhPT0gdW5kZWZpbmVkICYmIChJdGVyYXRvcnMuQXJyYXkgPT09IGl0IHx8IEFycmF5UHJvdG9bSVRFUkFUT1JdID09PSBpdCk7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNjYgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQp2YXIgJGRlZmluZVByb3BlcnR5ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KTsNCnZhciBjcmVhdGVEZXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMik7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9iamVjdCwgaW5kZXgsIHZhbHVlKSB7DQogIGlmIChpbmRleCBpbiBvYmplY3QpICRkZWZpbmVQcm9wZXJ0eS5mKG9iamVjdCwgaW5kZXgsIGNyZWF0ZURlc2MoMCwgdmFsdWUpKTsNCiAgZWxzZSBvYmplY3RbaW5kZXhdID0gdmFsdWU7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNjcgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIGNsYXNzb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY4KTsNCnZhciBJVEVSQVRPUiA9IF9fd2VicGFja19yZXF1aXJlX18oMCkoJ2l0ZXJhdG9yJyk7DQp2YXIgSXRlcmF0b3JzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMCk7DQptb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMikuZ2V0SXRlcmF0b3JNZXRob2QgPSBmdW5jdGlvbiAoaXQpIHsNCiAgaWYgKGl0ICE9IHVuZGVmaW5lZCkgcmV0dXJuIGl0W0lURVJBVE9SXQ0KICAgIHx8IGl0WydAQGl0ZXJhdG9yJ10NCiAgICB8fCBJdGVyYXRvcnNbY2xhc3NvZihpdCldOw0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDY4ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCi8vIGdldHRpbmcgdGFnIGZyb20gMTkuMS4zLjYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZygpDQp2YXIgY29mID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNSk7DQp2YXIgVEFHID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKSgndG9TdHJpbmdUYWcnKTsNCi8vIEVTMyB3cm9uZyBoZXJlDQp2YXIgQVJHID0gY29mKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGFyZ3VtZW50czsgfSgpKSA9PSAnQXJndW1lbnRzJzsNCg0KLy8gZmFsbGJhY2sgZm9yIElFMTEgU2NyaXB0IEFjY2VzcyBEZW5pZWQgZXJyb3INCnZhciB0cnlHZXQgPSBmdW5jdGlvbiAoaXQsIGtleSkgew0KICB0cnkgew0KICAgIHJldHVybiBpdFtrZXldOw0KICB9IGNhdGNoIChlKSB7IC8qIGVtcHR5ICovIH0NCn07DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7DQogIHZhciBPLCBULCBCOw0KICByZXR1cm4gaXQgPT09IHVuZGVmaW5lZCA/ICdVbmRlZmluZWQnIDogaXQgPT09IG51bGwgPyAnTnVsbCcNCiAgICAvLyBAQHRvU3RyaW5nVGFnIGNhc2UNCiAgICA6IHR5cGVvZiAoVCA9IHRyeUdldChPID0gT2JqZWN0KGl0KSwgVEFHKSkgPT0gJ3N0cmluZycgPyBUDQogICAgLy8gYnVpbHRpblRhZyBjYXNlDQogICAgOiBBUkcgPyBjb2YoTykNCiAgICAvLyBFUzMgYXJndW1lbnRzIGZhbGxiYWNrDQogICAgOiAoQiA9IGNvZihPKSkgPT0gJ09iamVjdCcgJiYgdHlwZW9mIE8uY2FsbGVlID09ICdmdW5jdGlvbicgPyAnQXJndW1lbnRzJyA6IEI7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNjkgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KdmFyIElURVJBVE9SID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKSgnaXRlcmF0b3InKTsNCnZhciBTQUZFX0NMT1NJTkcgPSBmYWxzZTsNCg0KdHJ5IHsNCiAgdmFyIHJpdGVyID0gWzddW0lURVJBVE9SXSgpOw0KICByaXRlclsncmV0dXJuJ10gPSBmdW5jdGlvbiAoKSB7IFNBRkVfQ0xPU0lORyA9IHRydWU7IH07DQogIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby10aHJvdy1saXRlcmFsDQogIEFycmF5LmZyb20ocml0ZXIsIGZ1bmN0aW9uICgpIHsgdGhyb3cgMjsgfSk7DQp9IGNhdGNoIChlKSB7IC8qIGVtcHR5ICovIH0NCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZXhlYywgc2tpcENsb3NpbmcpIHsNCiAgaWYgKCFza2lwQ2xvc2luZyAmJiAhU0FGRV9DTE9TSU5HKSByZXR1cm4gZmFsc2U7DQogIHZhciBzYWZlID0gZmFsc2U7DQogIHRyeSB7DQogICAgdmFyIGFyciA9IFs3XTsNCiAgICB2YXIgaXRlciA9IGFycltJVEVSQVRPUl0oKTsNCiAgICBpdGVyLm5leHQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB7IGRvbmU6IHNhZmUgPSB0cnVlIH07IH07DQogICAgYXJyW0lURVJBVE9SXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGl0ZXI7IH07DQogICAgZXhlYyhhcnIpOw0KICB9IGNhdGNoIChlKSB7IC8qIGVtcHR5ICovIH0NCiAgcmV0dXJuIHNhZmU7DQp9Ow0KDQoNCi8qKiovIH0pLA0KLyogNzAgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KX193ZWJwYWNrX3JlcXVpcmVfXyg3MSk7DQptb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMikuQXJyYXkuaW5jbHVkZXM7DQoNCg0KLyoqKi8gfSksDQovKiA3MSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L0FycmF5LnByb3RvdHlwZS5pbmNsdWRlcw0KdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOw0KdmFyICRpbmNsdWRlcyA9IF9fd2VicGFja19yZXF1aXJlX18oMzApKHRydWUpOw0KDQokZXhwb3J0KCRleHBvcnQuUCwgJ0FycmF5Jywgew0KICBpbmNsdWRlczogZnVuY3Rpb24gaW5jbHVkZXMoZWwgLyogLCBmcm9tSW5kZXggPSAwICovKSB7DQogICAgcmV0dXJuICRpbmNsdWRlcyh0aGlzLCBlbCwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpOw0KICB9DQp9KTsNCg0KX193ZWJwYWNrX3JlcXVpcmVfXygyOCkoJ2luY2x1ZGVzJyk7DQoNCg0KLyoqKi8gfSksDQovKiA3MiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgew0KDQovLyBQb2x5ZmlsbCBmb3IgY3JlYXRpbmcgQ3VzdG9tRXZlbnRzIG9uIElFOS8xMC8xMQ0KDQovLyBjb2RlIHB1bGxlZCBmcm9tOg0KLy8gaHR0cHM6Ly9naXRodWIuY29tL2Q0dG9jY2hpbmkvY3VzdG9tZXZlbnQtcG9seWZpbGwNCi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9DdXN0b21FdmVudCNQb2x5ZmlsbA0KDQp0cnkgew0KICAgIHZhciBjZSA9IG5ldyB3aW5kb3cuQ3VzdG9tRXZlbnQoJ3Rlc3QnKTsNCiAgICBjZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgIGlmIChjZS5kZWZhdWx0UHJldmVudGVkICE9PSB0cnVlKSB7DQogICAgICAgIC8vIElFIGhhcyBwcm9ibGVtcyB3aXRoIC5wcmV2ZW50RGVmYXVsdCgpIG9uIGN1c3RvbSBldmVudHMNCiAgICAgICAgLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yMzM0OTE5MQ0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBwcmV2ZW50IGRlZmF1bHQnKTsNCiAgICB9DQp9IGNhdGNoKGUpIHsNCiAgdmFyIEN1c3RvbUV2ZW50ID0gZnVuY3Rpb24oZXZlbnQsIHBhcmFtcykgew0KICAgIHZhciBldnQsIG9yaWdQcmV2ZW50Ow0KICAgIHBhcmFtcyA9IHBhcmFtcyB8fCB7DQogICAgICBidWJibGVzOiBmYWxzZSwNCiAgICAgIGNhbmNlbGFibGU6IGZhbHNlLA0KICAgICAgZGV0YWlsOiB1bmRlZmluZWQNCiAgICB9Ow0KDQogICAgZXZ0ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoIkN1c3RvbUV2ZW50Iik7DQogICAgZXZ0LmluaXRDdXN0b21FdmVudChldmVudCwgcGFyYW1zLmJ1YmJsZXMsIHBhcmFtcy5jYW5jZWxhYmxlLCBwYXJhbXMuZGV0YWlsKTsNCiAgICBvcmlnUHJldmVudCA9IGV2dC5wcmV2ZW50RGVmYXVsdDsNCiAgICBldnQucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbiAoKSB7DQogICAgICBvcmlnUHJldmVudC5jYWxsKHRoaXMpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdkZWZhdWx0UHJldmVudGVkJywgew0KICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgIH0gY2F0Y2goZSkgew0KICAgICAgICB0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSB0cnVlOw0KICAgICAgfQ0KICAgIH07DQogICAgcmV0dXJuIGV2dDsNCiAgfTsNCg0KICBDdXN0b21FdmVudC5wcm90b3R5cGUgPSB3aW5kb3cuRXZlbnQucHJvdG90eXBlOw0KICB3aW5kb3cuQ3VzdG9tRXZlbnQgPSBDdXN0b21FdmVudDsgLy8gZXhwb3NlIGRlZmluaXRpb24gdG8gd2luZG93DQp9DQoNCg0KLyoqKi8gfSksDQovKiA3MyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQoNCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOw0KDQp2YXIgX3JlZHV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMyk7DQoNCnZhciBfaW5kZXggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc4KTsNCg0KdmFyIF9pbmRleDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pbmRleCk7DQoNCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9DQoNCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gZWxzZSB7IHJldHVybiBBcnJheS5mcm9tKGFycik7IH0gfQ0KDQpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0NCg0KdmFyIFN0b3JlID0gZnVuY3Rpb24gKCkgew0KICBmdW5jdGlvbiBTdG9yZSgpIHsNCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3RvcmUpOw0KDQogICAgdGhpcy5fc3RvcmUgPSAoMCwgX3JlZHV4LmNyZWF0ZVN0b3JlKShfaW5kZXgyLmRlZmF1bHQsIHdpbmRvdy5kZXZUb29sc0V4dGVuc2lvbiA/IHdpbmRvdy5kZXZUb29sc0V4dGVuc2lvbigpIDogdW5kZWZpbmVkKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBTdWJzY3JpYmUgc3RvcmUgdG8gZnVuY3Rpb24gY2FsbCAod3JhcHBlZCBSZWR1eCBtZXRob2QpDQogICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBvbkNoYW5nZSBGdW5jdGlvbiB0byB0cmlnZ2VyIHdoZW4gc3RhdGUgY2hhbmdlcw0KICAgKiBAcmV0dXJuDQogICAqLw0KDQoNCiAgX2NyZWF0ZUNsYXNzKFN0b3JlLCBbew0KICAgIGtleTogJ3N1YnNjcmliZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHN1YnNjcmliZShvbkNoYW5nZSkgew0KICAgICAgdGhpcy5fc3RvcmUuc3Vic2NyaWJlKG9uQ2hhbmdlKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBEaXNwYXRjaCBldmVudCB0byBzdG9yZSAod3JhcHBlZCBSZWR1eCBtZXRob2QpDQogICAgICogQHBhcmFtICB7RnVuY3Rpb259IGFjdGlvbiBBY3Rpb24gZnVuY3Rpb24gdG8gdHJpZ2dlcg0KICAgICAqIEByZXR1cm4NCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnZGlzcGF0Y2gnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNwYXRjaChhY3Rpb24pIHsNCiAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKGFjdGlvbik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IHN0b3JlIG9iamVjdCAod3JhcHBpbmcgUmVkdXggbWV0aG9kKQ0KICAgICAqIEByZXR1cm4ge09iamVjdH0gU3RhdGUNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnZ2V0Q2hvaWNlQnlJZCcsDQoNCg0KICAgIC8qKg0KICAgICAqIEdldCBzaW5nbGUgY2hvaWNlIGJ5IGl0J3MgSUQNCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IEZvdW5kIGNob2ljZQ0KICAgICAqLw0KICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDaG9pY2VCeUlkKGlkKSB7DQogICAgICBpZiAoaWQpIHsNCiAgICAgICAgdmFyIGNob2ljZXMgPSB0aGlzLmFjdGl2ZUNob2ljZXM7DQogICAgICAgIHZhciBmb3VuZENob2ljZSA9IGNob2ljZXMuZmluZChmdW5jdGlvbiAoY2hvaWNlKSB7DQogICAgICAgICAgcmV0dXJuIGNob2ljZS5pZCA9PT0gcGFyc2VJbnQoaWQsIDEwKTsNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBmb3VuZENob2ljZTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgZ3JvdXAgYnkgZ3JvdXAgaWQNCiAgICAgKiBAcGFyYW0gIHtOdW1iZXJ9IGlkIEdyb3VwIElEDQogICAgICogQHJldHVybiB7T2JqZWN0fSAgICBHcm91cCBkYXRhDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2dldEdyb3VwQnlJZCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEdyb3VwQnlJZChpZCkgew0KICAgICAgcmV0dXJuIHRoaXMuZ3JvdXBzLmZpbmQoZnVuY3Rpb24gKGdyb3VwKSB7DQogICAgICAgIHJldHVybiBncm91cC5pZCA9PT0gcGFyc2VJbnQoaWQsIDEwKTsNCiAgICAgIH0pOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3N0YXRlJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiB0aGlzLl9zdG9yZS5nZXRTdGF0ZSgpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCBpdGVtcyBmcm9tIHN0b3JlDQogICAgICogQHJldHVybiB7QXJyYXl9IEl0ZW0gb2JqZWN0cw0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdpdGVtcycsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gdGhpcy5zdGF0ZS5pdGVtczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgYWN0aXZlIGl0ZW1zIGZyb20gc3RvcmUNCiAgICAgKiBAcmV0dXJuIHtBcnJheX0gSXRlbSBvYmplY3RzDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2FjdGl2ZUl0ZW1zJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiB0aGlzLml0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICByZXR1cm4gaXRlbS5hY3RpdmUgPT09IHRydWU7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgaGlnaGxpZ2h0ZWQgaXRlbXMgZnJvbSBzdG9yZQ0KICAgICAqIEByZXR1cm4ge0FycmF5fSBJdGVtIG9iamVjdHMNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnaGlnaGxpZ2h0ZWRBY3RpdmVJdGVtcycsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gdGhpcy5pdGVtcy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgcmV0dXJuIGl0ZW0uYWN0aXZlICYmIGl0ZW0uaGlnaGxpZ2h0ZWQ7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgY2hvaWNlcyBmcm9tIHN0b3JlDQogICAgICogQHJldHVybiB7QXJyYXl9IE9wdGlvbiBvYmplY3RzDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2Nob2ljZXMnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuY2hvaWNlczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgYWN0aXZlIGNob2ljZXMgZnJvbSBzdG9yZQ0KICAgICAqIEByZXR1cm4ge0FycmF5fSBPcHRpb24gb2JqZWN0cw0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdhY3RpdmVDaG9pY2VzJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHZhciBjaG9pY2VzID0gdGhpcy5jaG9pY2VzOw0KICAgICAgdmFyIHZhbHVlcyA9IGNob2ljZXMuZmlsdGVyKGZ1bmN0aW9uIChjaG9pY2UpIHsNCiAgICAgICAgcmV0dXJuIGNob2ljZS5hY3RpdmUgPT09IHRydWU7DQogICAgICB9KTsNCg0KICAgICAgcmV0dXJuIHZhbHVlczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgc2VsZWN0YWJsZSBjaG9pY2VzIGZyb20gc3RvcmUNCiAgICAgKiBAcmV0dXJuIHtBcnJheX0gT3B0aW9uIG9iamVjdHMNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnc2VsZWN0YWJsZUNob2ljZXMnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIHRoaXMuY2hvaWNlcy5maWx0ZXIoZnVuY3Rpb24gKGNob2ljZSkgew0KICAgICAgICByZXR1cm4gY2hvaWNlLmRpc2FibGVkICE9PSB0cnVlOw0KICAgICAgfSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IGNob2ljZXMgdGhhdCBjYW4gYmUgc2VhcmNoZWQgKGV4Y2x1ZGluZyBwbGFjZWhvbGRlcnMpDQogICAgICogQHJldHVybiB7QXJyYXl9IE9wdGlvbiBvYmplY3RzDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ3NlYXJjaGFibGVDaG9pY2VzJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGFibGVDaG9pY2VzLmZpbHRlcihmdW5jdGlvbiAoY2hvaWNlKSB7DQogICAgICAgIHJldHVybiBjaG9pY2UucGxhY2Vob2xkZXIgIT09IHRydWU7DQogICAgICB9KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBHZXQgcGxhY2Vob2xkZXIgY2hvaWNlIGZyb20gc3RvcmUNCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IEZvdW5kIHBsYWNlaG9sZGVyDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ3BsYWNlaG9sZGVyQ2hvaWNlJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMuY2hvaWNlcykpLnJldmVyc2UoKS5maW5kKGZ1bmN0aW9uIChjaG9pY2UpIHsNCiAgICAgICAgcmV0dXJuIGNob2ljZS5wbGFjZWhvbGRlciA9PT0gdHJ1ZTsNCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEdldCBncm91cHMgZnJvbSBzdG9yZQ0KICAgICAqIEByZXR1cm4ge0FycmF5fSBHcm91cCBvYmplY3RzDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2dyb3VwcycsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gdGhpcy5zdGF0ZS5ncm91cHM7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogR2V0IGFjdGl2ZSBncm91cHMgZnJvbSBzdG9yZQ0KICAgICAqIEByZXR1cm4ge0FycmF5fSBHcm91cCBvYmplY3RzDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2FjdGl2ZUdyb3VwcycsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICB2YXIgZ3JvdXBzID0gdGhpcy5ncm91cHM7DQogICAgICB2YXIgY2hvaWNlcyA9IHRoaXMuY2hvaWNlczsNCg0KICAgICAgcmV0dXJuIGdyb3Vwcy5maWx0ZXIoZnVuY3Rpb24gKGdyb3VwKSB7DQogICAgICAgIHZhciBpc0FjdGl2ZSA9IGdyb3VwLmFjdGl2ZSA9PT0gdHJ1ZSAmJiBncm91cC5kaXNhYmxlZCA9PT0gZmFsc2U7DQogICAgICAgIHZhciBoYXNBY3RpdmVPcHRpb25zID0gY2hvaWNlcy5zb21lKGZ1bmN0aW9uIChjaG9pY2UpIHsNCiAgICAgICAgICByZXR1cm4gY2hvaWNlLmFjdGl2ZSA9PT0gdHJ1ZSAmJiBjaG9pY2UuZGlzYWJsZWQgPT09IGZhbHNlOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIGlzQWN0aXZlICYmIGhhc0FjdGl2ZU9wdGlvbnM7DQogICAgICB9LCBbXSk7DQogICAgfQ0KICB9XSk7DQoNCiAgcmV0dXJuIFN0b3JlOw0KfSgpOw0KDQpleHBvcnRzLmRlZmF1bHQgPSBTdG9yZTsNCg0KLyoqKi8gfSksDQovKiA3NCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQovKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24oZ2xvYmFsKSB7LyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBnbG9iYWxgIGZyb20gTm9kZS5qcy4gKi8NCnZhciBmcmVlR2xvYmFsID0gdHlwZW9mIGdsb2JhbCA9PSAnb2JqZWN0JyAmJiBnbG9iYWwgJiYgZ2xvYmFsLk9iamVjdCA9PT0gT2JqZWN0ICYmIGdsb2JhbDsNCg0KLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyBfX3dlYnBhY2tfZXhwb3J0c19fWyJhIl0gPSAoZnJlZUdsb2JhbCk7DQoNCi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbChfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKDM0KSkpDQoNCi8qKiovIH0pLA0KLyogNzUgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKGdsb2JhbCwgbW9kdWxlKSB7LyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fcG9ueWZpbGxfanNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oNzcpOw0KLyogZ2xvYmFsIHdpbmRvdyAqLw0KDQoNCnZhciByb290Ow0KDQppZiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnKSB7DQogIHJvb3QgPSBzZWxmOw0KfSBlbHNlIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgew0KICByb290ID0gd2luZG93Ow0KfSBlbHNlIGlmICh0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykgew0KICByb290ID0gZ2xvYmFsOw0KfSBlbHNlIGlmICh0cnVlKSB7DQogIHJvb3QgPSBtb2R1bGU7DQp9IGVsc2Ugew0KICByb290ID0gRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTsNCn0NCg0KdmFyIHJlc3VsdCA9IE9iamVjdChfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX3BvbnlmaWxsX2pzX19bImEiIC8qIGRlZmF1bHQgKi9dKShyb290KTsNCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gX193ZWJwYWNrX2V4cG9ydHNfX1siYSJdID0gKHJlc3VsdCk7DQoNCi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbChfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKDM0KSwgX193ZWJwYWNrX3JlcXVpcmVfXyg3NikobW9kdWxlKSkpDQoNCi8qKiovIH0pLA0KLyogNzYgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvcmlnaW5hbE1vZHVsZSkgew0KCWlmKCFvcmlnaW5hbE1vZHVsZS53ZWJwYWNrUG9seWZpbGwpIHsNCgkJdmFyIG1vZHVsZSA9IE9iamVjdC5jcmVhdGUob3JpZ2luYWxNb2R1bGUpOw0KCQkvLyBtb2R1bGUucGFyZW50ID0gdW5kZWZpbmVkIGJ5IGRlZmF1bHQNCgkJaWYoIW1vZHVsZS5jaGlsZHJlbikgbW9kdWxlLmNoaWxkcmVuID0gW107DQoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShtb2R1bGUsICJsb2FkZWQiLCB7DQoJCQllbnVtZXJhYmxlOiB0cnVlLA0KCQkJZ2V0OiBmdW5jdGlvbigpIHsNCgkJCQlyZXR1cm4gbW9kdWxlLmw7DQoJCQl9DQoJCX0pOw0KCQlPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kdWxlLCAiaWQiLCB7DQoJCQllbnVtZXJhYmxlOiB0cnVlLA0KCQkJZ2V0OiBmdW5jdGlvbigpIHsNCgkJCQlyZXR1cm4gbW9kdWxlLmk7DQoJCQl9DQoJCX0pOw0KCQlPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kdWxlLCAiZXhwb3J0cyIsIHsNCgkJCWVudW1lcmFibGU6IHRydWUsDQoJCX0pOw0KCQltb2R1bGUud2VicGFja1BvbHlmaWxsID0gMTsNCgl9DQoJcmV0dXJuIG1vZHVsZTsNCn07DQoNCg0KLyoqKi8gfSksDQovKiA3NyAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQovKiBoYXJtb255IGV4cG9ydCAoaW1tdXRhYmxlKSAqLyBfX3dlYnBhY2tfZXhwb3J0c19fWyJhIl0gPSBzeW1ib2xPYnNlcnZhYmxlUG9ueWZpbGw7DQpmdW5jdGlvbiBzeW1ib2xPYnNlcnZhYmxlUG9ueWZpbGwocm9vdCkgew0KCXZhciByZXN1bHQ7DQoJdmFyIFN5bWJvbCA9IHJvb3QuU3ltYm9sOw0KDQoJaWYgKHR5cGVvZiBTeW1ib2wgPT09ICdmdW5jdGlvbicpIHsNCgkJaWYgKFN5bWJvbC5vYnNlcnZhYmxlKSB7DQoJCQlyZXN1bHQgPSBTeW1ib2wub2JzZXJ2YWJsZTsNCgkJfSBlbHNlIHsNCgkJCXJlc3VsdCA9IFN5bWJvbCgnb2JzZXJ2YWJsZScpOw0KCQkJU3ltYm9sLm9ic2VydmFibGUgPSByZXN1bHQ7DQoJCX0NCgl9IGVsc2Ugew0KCQlyZXN1bHQgPSAnQEBvYnNlcnZhYmxlJzsNCgl9DQoNCglyZXR1cm4gcmVzdWx0Ow0KfTsNCg0KDQovKioqLyB9KSwNCi8qIDc4ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCg0KdmFyIF9yZWR1eCA9IF9fd2VicGFja19yZXF1aXJlX18oMzMpOw0KDQp2YXIgX2l0ZW1zID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3OSk7DQoNCnZhciBfaXRlbXMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaXRlbXMpOw0KDQp2YXIgX2dyb3VwcyA9IF9fd2VicGFja19yZXF1aXJlX18oODApOw0KDQp2YXIgX2dyb3VwczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9ncm91cHMpOw0KDQp2YXIgX2Nob2ljZXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgxKTsNCg0KdmFyIF9jaG9pY2VzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2Nob2ljZXMpOw0KDQp2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsNCg0KZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0NCg0KdmFyIGFwcFJlZHVjZXIgPSAoMCwgX3JlZHV4LmNvbWJpbmVSZWR1Y2Vycykoew0KICBpdGVtczogX2l0ZW1zMi5kZWZhdWx0LA0KICBncm91cHM6IF9ncm91cHMyLmRlZmF1bHQsDQogIGNob2ljZXM6IF9jaG9pY2VzMi5kZWZhdWx0DQp9KTsNCg0KdmFyIHJvb3RSZWR1Y2VyID0gZnVuY3Rpb24gcm9vdFJlZHVjZXIocGFzc2VkU3RhdGUsIGFjdGlvbikgew0KICB2YXIgc3RhdGUgPSBwYXNzZWRTdGF0ZTsNCiAgLy8gSWYgd2UgYXJlIGNsZWFyaW5nIGFsbCBpdGVtcywgZ3JvdXBzIGFuZCBvcHRpb25zIHdlIHJlYXNzaWduDQogIC8vIHN0YXRlIGFuZCB0aGVuIHBhc3MgdGhhdCBzdGF0ZSB0byBvdXIgcHJvcGVyIHJlZHVjZXIuIFRoaXMgaXNuJ3QNCiAgLy8gbXV0YXRpbmcgb3VyIGFjdHVhbCBzdGF0ZQ0KICAvLyBTZWU6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzM1NjQxOTkyDQogIGlmIChhY3Rpb24udHlwZSA9PT0gJ0NMRUFSX0FMTCcpIHsNCiAgICBzdGF0ZSA9IHVuZGVmaW5lZDsNCiAgfSBlbHNlIGlmIChhY3Rpb24udHlwZSA9PT0gJ1JFU0VUX1RPJykgew0KICAgIHJldHVybiAoMCwgX3V0aWxzLmNsb25lT2JqZWN0KShhY3Rpb24uc3RhdGUpOw0KICB9DQoNCiAgcmV0dXJuIGFwcFJlZHVjZXIoc3RhdGUsIGFjdGlvbik7DQp9Ow0KDQpleHBvcnRzLmRlZmF1bHQgPSByb290UmVkdWNlcjsNCg0KLyoqKi8gfSksDQovKiA3OSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQpleHBvcnRzLmRlZmF1bHQgPSBpdGVtczsNCg0KZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSBlbHNlIHsgcmV0dXJuIEFycmF5LmZyb20oYXJyKTsgfSB9DQoNCnZhciBkZWZhdWx0U3RhdGUgPSBleHBvcnRzLmRlZmF1bHRTdGF0ZSA9IFtdOw0KDQpmdW5jdGlvbiBpdGVtcygpIHsNCiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBkZWZhdWx0U3RhdGU7DQogIHZhciBhY3Rpb24gPSBhcmd1bWVudHNbMV07DQoNCiAgc3dpdGNoIChhY3Rpb24udHlwZSkgew0KICAgIGNhc2UgJ0FERF9JVEVNJzoNCiAgICAgIHsNCiAgICAgICAgLy8gQWRkIG9iamVjdCB0byBpdGVtcyBhcnJheQ0KICAgICAgICB2YXIgbmV3U3RhdGUgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlKSwgW3sNCiAgICAgICAgICBpZDogYWN0aW9uLmlkLA0KICAgICAgICAgIGNob2ljZUlkOiBhY3Rpb24uY2hvaWNlSWQsDQogICAgICAgICAgZ3JvdXBJZDogYWN0aW9uLmdyb3VwSWQsDQogICAgICAgICAgdmFsdWU6IGFjdGlvbi52YWx1ZSwNCiAgICAgICAgICBsYWJlbDogYWN0aW9uLmxhYmVsLA0KICAgICAgICAgIGFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICBoaWdobGlnaHRlZDogZmFsc2UsDQogICAgICAgICAgY3VzdG9tUHJvcGVydGllczogYWN0aW9uLmN1c3RvbVByb3BlcnRpZXMsDQogICAgICAgICAgcGxhY2Vob2xkZXI6IGFjdGlvbi5wbGFjZWhvbGRlciB8fCBmYWxzZSwNCiAgICAgICAgICBrZXlDb2RlOiBudWxsDQogICAgICAgIH1dKTsNCg0KICAgICAgICByZXR1cm4gbmV3U3RhdGUubWFwKGZ1bmN0aW9uIChvYmopIHsNCiAgICAgICAgICB2YXIgaXRlbSA9IG9iajsNCiAgICAgICAgICBpdGVtLmhpZ2hsaWdodGVkID0gZmFsc2U7DQogICAgICAgICAgcmV0dXJuIGl0ZW07DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgY2FzZSAnUkVNT1ZFX0lURU0nOg0KICAgICAgew0KICAgICAgICAvLyBTZXQgaXRlbSB0byBpbmFjdGl2ZQ0KICAgICAgICByZXR1cm4gc3RhdGUubWFwKGZ1bmN0aW9uIChvYmopIHsNCiAgICAgICAgICB2YXIgaXRlbSA9IG9iajsNCiAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gYWN0aW9uLmlkKSB7DQogICAgICAgICAgICBpdGVtLmFjdGl2ZSA9IGZhbHNlOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gaXRlbTsNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICBjYXNlICdISUdITElHSFRfSVRFTSc6DQogICAgICB7DQogICAgICAgIHJldHVybiBzdGF0ZS5tYXAoZnVuY3Rpb24gKG9iaikgew0KICAgICAgICAgIHZhciBpdGVtID0gb2JqOw0KICAgICAgICAgIGlmIChpdGVtLmlkID09PSBhY3Rpb24uaWQpIHsNCiAgICAgICAgICAgIGl0ZW0uaGlnaGxpZ2h0ZWQgPSBhY3Rpb24uaGlnaGxpZ2h0ZWQ7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiBpdGVtOw0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgIGRlZmF1bHQ6DQogICAgICB7DQogICAgICAgIHJldHVybiBzdGF0ZTsNCiAgICAgIH0NCiAgfQ0KfQ0KDQovKioqLyB9KSwNCi8qIDgwICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCmV4cG9ydHMuZGVmYXVsdCA9IGdyb3VwczsNCg0KZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSBlbHNlIHsgcmV0dXJuIEFycmF5LmZyb20oYXJyKTsgfSB9DQoNCnZhciBkZWZhdWx0U3RhdGUgPSBleHBvcnRzLmRlZmF1bHRTdGF0ZSA9IFtdOw0KDQpmdW5jdGlvbiBncm91cHMoKSB7DQogIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZGVmYXVsdFN0YXRlOw0KICB2YXIgYWN0aW9uID0gYXJndW1lbnRzWzFdOw0KDQogIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHsNCiAgICBjYXNlICdBRERfR1JPVVAnOg0KICAgICAgew0KICAgICAgICByZXR1cm4gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShzdGF0ZSksIFt7DQogICAgICAgICAgaWQ6IGFjdGlvbi5pZCwNCiAgICAgICAgICB2YWx1ZTogYWN0aW9uLnZhbHVlLA0KICAgICAgICAgIGFjdGl2ZTogYWN0aW9uLmFjdGl2ZSwNCiAgICAgICAgICBkaXNhYmxlZDogYWN0aW9uLmRpc2FibGVkDQogICAgICAgIH1dKTsNCiAgICAgIH0NCg0KICAgIGNhc2UgJ0NMRUFSX0NIT0lDRVMnOg0KICAgICAgew0KICAgICAgICByZXR1cm4gW107DQogICAgICB9DQoNCiAgICBkZWZhdWx0Og0KICAgICAgew0KICAgICAgICByZXR1cm4gc3RhdGU7DQogICAgICB9DQogIH0NCn0NCg0KLyoqKi8gfSksDQovKiA4MSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQpleHBvcnRzLmRlZmF1bHQgPSBjaG9pY2VzOw0KDQpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IGVsc2UgeyByZXR1cm4gQXJyYXkuZnJvbShhcnIpOyB9IH0NCg0KdmFyIGRlZmF1bHRTdGF0ZSA9IGV4cG9ydHMuZGVmYXVsdFN0YXRlID0gW107DQoNCmZ1bmN0aW9uIGNob2ljZXMoKSB7DQogIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZGVmYXVsdFN0YXRlOw0KICB2YXIgYWN0aW9uID0gYXJndW1lbnRzWzFdOw0KDQogIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHsNCiAgICBjYXNlICdBRERfQ0hPSUNFJzoNCiAgICAgIHsNCiAgICAgICAgLyoNCiAgICAgICAgICAgIEEgZGlzYWJsZWQgY2hvaWNlIGFwcGVhcnMgaW4gdGhlIGNob2ljZSBkcm9wZG93biBidXQgY2Fubm90IGJlIHNlbGVjdGVkDQogICAgICAgICAgICBBIHNlbGVjdGVkIGNob2ljZSBoYXMgYmVlbiBhZGRlZCB0byB0aGUgcGFzc2VkIGlucHV0J3MgdmFsdWUgKGFkZGVkIGFzIGFuIGl0ZW0pDQogICAgICAgICAgICBBbiBhY3RpdmUgY2hvaWNlIGFwcGVhcnMgd2l0aGluIHRoZSBjaG9pY2UgZHJvcGRvd24NCiAgICAgICAgICovDQogICAgICAgIHJldHVybiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlKSwgW3sNCiAgICAgICAgICBpZDogYWN0aW9uLmlkLA0KICAgICAgICAgIGVsZW1lbnRJZDogYWN0aW9uLmVsZW1lbnRJZCwNCiAgICAgICAgICBncm91cElkOiBhY3Rpb24uZ3JvdXBJZCwNCiAgICAgICAgICB2YWx1ZTogYWN0aW9uLnZhbHVlLA0KICAgICAgICAgIGxhYmVsOiBhY3Rpb24ubGFiZWwgfHwgYWN0aW9uLnZhbHVlLA0KICAgICAgICAgIGRpc2FibGVkOiBhY3Rpb24uZGlzYWJsZWQgfHwgZmFsc2UsDQogICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlLA0KICAgICAgICAgIGFjdGl2ZTogdHJ1ZSwNCiAgICAgICAgICBzY29yZTogOTk5OSwNCiAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBhY3Rpb24uY3VzdG9tUHJvcGVydGllcywNCiAgICAgICAgICBwbGFjZWhvbGRlcjogYWN0aW9uLnBsYWNlaG9sZGVyIHx8IGZhbHNlLA0KICAgICAgICAgIGtleUNvZGU6IG51bGwNCiAgICAgICAgfV0pOw0KICAgICAgfQ0KDQogICAgY2FzZSAnQUREX0lURU0nOg0KICAgICAgew0KICAgICAgICAvLyBJZiBhbGwgY2hvaWNlcyBuZWVkIHRvIGJlIGFjdGl2YXRlZA0KICAgICAgICBpZiAoYWN0aW9uLmFjdGl2YXRlT3B0aW9ucykgew0KICAgICAgICAgIHJldHVybiBzdGF0ZS5tYXAoZnVuY3Rpb24gKG9iaikgew0KICAgICAgICAgICAgdmFyIGNob2ljZSA9IG9iajsNCiAgICAgICAgICAgIGNob2ljZS5hY3RpdmUgPSBhY3Rpb24uYWN0aXZlOw0KICAgICAgICAgICAgcmV0dXJuIGNob2ljZTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFdoZW4gYW4gaXRlbSBpcyBhZGRlZCBhbmQgaXQgaGFzIGFuIGFzc29jaWF0ZWQgY2hvaWNlLA0KICAgICAgICAvLyB3ZSB3YW50IHRvIGRpc2FibGUgaXQgc28gaXQgY2FuJ3QgYmUgY2hvc2VuIGFnYWluDQogICAgICAgIGlmIChhY3Rpb24uY2hvaWNlSWQgPiAtMSkgew0KICAgICAgICAgIHJldHVybiBzdGF0ZS5tYXAoZnVuY3Rpb24gKG9iaikgew0KICAgICAgICAgICAgdmFyIGNob2ljZSA9IG9iajsNCiAgICAgICAgICAgIGlmIChjaG9pY2UuaWQgPT09IHBhcnNlSW50KGFjdGlvbi5jaG9pY2VJZCwgMTApKSB7DQogICAgICAgICAgICAgIGNob2ljZS5zZWxlY3RlZCA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gY2hvaWNlOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHN0YXRlOw0KICAgICAgfQ0KDQogICAgY2FzZSAnUkVNT1ZFX0lURU0nOg0KICAgICAgew0KICAgICAgICAvLyBXaGVuIGFuIGl0ZW0gaXMgcmVtb3ZlZCBhbmQgaXQgaGFzIGFuIGFzc29jaWF0ZWQgY2hvaWNlLA0KICAgICAgICAvLyB3ZSB3YW50IHRvIHJlLWVuYWJsZSBpdCBzbyBpdCBjYW4gYmUgY2hvc2VuIGFnYWluDQogICAgICAgIGlmIChhY3Rpb24uY2hvaWNlSWQgPiAtMSkgew0KICAgICAgICAgIHJldHVybiBzdGF0ZS5tYXAoZnVuY3Rpb24gKG9iaikgew0KICAgICAgICAgICAgdmFyIGNob2ljZSA9IG9iajsNCiAgICAgICAgICAgIGlmIChjaG9pY2UuaWQgPT09IHBhcnNlSW50KGFjdGlvbi5jaG9pY2VJZCwgMTApKSB7DQogICAgICAgICAgICAgIGNob2ljZS5zZWxlY3RlZCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGNob2ljZTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBzdGF0ZTsNCiAgICAgIH0NCg0KICAgIGNhc2UgJ0ZJTFRFUl9DSE9JQ0VTJzoNCiAgICAgIHsNCiAgICAgICAgcmV0dXJuIHN0YXRlLm1hcChmdW5jdGlvbiAob2JqKSB7DQogICAgICAgICAgdmFyIGNob2ljZSA9IG9iajsNCiAgICAgICAgICAvLyBTZXQgYWN0aXZlIHN0YXRlIGJhc2VkIG9uIHdoZXRoZXIgY2hvaWNlIGlzDQogICAgICAgICAgLy8gd2l0aGluIGZpbHRlcmVkIHJlc3VsdHMNCiAgICAgICAgICBjaG9pY2UuYWN0aXZlID0gYWN0aW9uLnJlc3VsdHMuc29tZShmdW5jdGlvbiAoX3JlZikgew0KICAgICAgICAgICAgdmFyIGl0ZW0gPSBfcmVmLml0ZW0sDQogICAgICAgICAgICAgICAgc2NvcmUgPSBfcmVmLnNjb3JlOw0KDQogICAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gY2hvaWNlLmlkKSB7DQogICAgICAgICAgICAgIGNob2ljZS5zY29yZSA9IHNjb3JlOw0KICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICB9KTsNCg0KICAgICAgICAgIHJldHVybiBjaG9pY2U7DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgY2FzZSAnQUNUSVZBVEVfQ0hPSUNFUyc6DQogICAgICB7DQogICAgICAgIHJldHVybiBzdGF0ZS5tYXAoZnVuY3Rpb24gKG9iaikgew0KICAgICAgICAgIHZhciBjaG9pY2UgPSBvYmo7DQogICAgICAgICAgY2hvaWNlLmFjdGl2ZSA9IGFjdGlvbi5hY3RpdmU7DQogICAgICAgICAgcmV0dXJuIGNob2ljZTsNCiAgICAgICAgfSk7DQogICAgICB9DQoNCiAgICBjYXNlICdDTEVBUl9DSE9JQ0VTJzoNCiAgICAgIHsNCiAgICAgICAgcmV0dXJuIGRlZmF1bHRTdGF0ZTsNCiAgICAgIH0NCg0KICAgIGRlZmF1bHQ6DQogICAgICB7DQogICAgICAgIHJldHVybiBzdGF0ZTsNCiAgICAgIH0NCiAgfQ0KfQ0KDQovKioqLyB9KSwNCi8qIDgyICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCmV4cG9ydHMuV3JhcHBlZFNlbGVjdCA9IGV4cG9ydHMuV3JhcHBlZElucHV0ID0gZXhwb3J0cy5MaXN0ID0gZXhwb3J0cy5JbnB1dCA9IGV4cG9ydHMuQ29udGFpbmVyID0gZXhwb3J0cy5Ecm9wZG93biA9IHVuZGVmaW5lZDsNCg0KdmFyIF9kcm9wZG93biA9IF9fd2VicGFja19yZXF1aXJlX18oODMpOw0KDQp2YXIgX2Ryb3Bkb3duMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2Ryb3Bkb3duKTsNCg0KdmFyIF9jb250YWluZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg0KTsNCg0KdmFyIF9jb250YWluZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY29udGFpbmVyKTsNCg0KdmFyIF9pbnB1dCA9IF9fd2VicGFja19yZXF1aXJlX18oODUpOw0KDQp2YXIgX2lucHV0MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2lucHV0KTsNCg0KdmFyIF9saXN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4Nik7DQoNCnZhciBfbGlzdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9saXN0KTsNCg0KdmFyIF93cmFwcGVkSW5wdXQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg3KTsNCg0KdmFyIF93cmFwcGVkSW5wdXQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfd3JhcHBlZElucHV0KTsNCg0KdmFyIF93cmFwcGVkU2VsZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4OCk7DQoNCnZhciBfd3JhcHBlZFNlbGVjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF93cmFwcGVkU2VsZWN0KTsNCg0KZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0NCg0KZXhwb3J0cy5Ecm9wZG93biA9IF9kcm9wZG93bjIuZGVmYXVsdDsNCmV4cG9ydHMuQ29udGFpbmVyID0gX2NvbnRhaW5lcjIuZGVmYXVsdDsNCmV4cG9ydHMuSW5wdXQgPSBfaW5wdXQyLmRlZmF1bHQ7DQpleHBvcnRzLkxpc3QgPSBfbGlzdDIuZGVmYXVsdDsNCmV4cG9ydHMuV3JhcHBlZElucHV0ID0gX3dyYXBwZWRJbnB1dDIuZGVmYXVsdDsNCmV4cG9ydHMuV3JhcHBlZFNlbGVjdCA9IF93cmFwcGVkU2VsZWN0Mi5kZWZhdWx0Ow0KDQovKioqLyB9KSwNCi8qIDgzICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCg0KdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7DQoNCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQ0KDQp2YXIgRHJvcGRvd24gPSBmdW5jdGlvbiAoKSB7DQogIGZ1bmN0aW9uIERyb3Bkb3duKF9yZWYpIHsNCiAgICB2YXIgZWxlbWVudCA9IF9yZWYuZWxlbWVudCwNCiAgICAgICAgdHlwZSA9IF9yZWYudHlwZSwNCiAgICAgICAgY2xhc3NOYW1lcyA9IF9yZWYuY2xhc3NOYW1lczsNCg0KICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEcm9wZG93bik7DQoNCiAgICBPYmplY3QuYXNzaWduKHRoaXMsIHsgZWxlbWVudDogZWxlbWVudCwgdHlwZTogdHlwZSwgY2xhc3NOYW1lczogY2xhc3NOYW1lcyB9KTsNCg0KICAgIHRoaXMuaXNBY3RpdmUgPSBmYWxzZTsNCiAgfQ0KDQogIC8qKg0KICAgKiBEZXRlcm1pbmUgaG93IGZhciB0aGUgdG9wIG9mIG91ciBlbGVtZW50IGlzIGZyb20NCiAgICogdGhlIHRvcCBvZiB0aGUgd2luZG93DQogICAqIEByZXR1cm4ge051bWJlcn0gVmVydGljYWwgcG9zaXRpb24NCiAgICovDQoNCg0KICBfY3JlYXRlQ2xhc3MoRHJvcGRvd24sIFt7DQogICAga2V5OiAnZGlzdGFuY2VGcm9tVG9wV2luZG93JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzdGFuY2VGcm9tVG9wV2luZG93KCkgew0KICAgICAgdGhpcy5kaW1lbnNpb25zID0gdGhpcy5lbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgdGhpcy5wb3NpdGlvbiA9IE1hdGguY2VpbCh0aGlzLmRpbWVuc2lvbnMudG9wICsgd2luZG93LnBhZ2VZT2Zmc2V0ICsgdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodCk7DQogICAgICByZXR1cm4gdGhpcy5wb3NpdGlvbjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBGaW5kIGVsZW1lbnQgdGhhdCBtYXRjaGVzIHBhc3NlZCBzZWxlY3Rvcg0KICAgICAqIEByZXR1cm4ge0hUTUxFbGVtZW50fQ0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdnZXRDaGlsZCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENoaWxkKHNlbGVjdG9yKSB7DQogICAgICByZXR1cm4gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFNob3cgZHJvcGRvd24gdG8gdXNlciBieSBhZGRpbmcgYWN0aXZlIHN0YXRlIGNsYXNzDQogICAgICogQHJldHVybiB7T2JqZWN0fSBDbGFzcyBpbnN0YW5jZQ0KICAgICAqIEBwdWJsaWMNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnc2hvdycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNob3coKSB7DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLmNsYXNzTmFtZXMuYWN0aXZlU3RhdGUpOw0KICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICd0cnVlJyk7DQogICAgICB0aGlzLmlzQWN0aXZlID0gdHJ1ZTsNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEhpZGUgZHJvcGRvd24gZnJvbSB1c2VyDQogICAgICogQHJldHVybiB7T2JqZWN0fSBDbGFzcyBpbnN0YW5jZQ0KICAgICAqIEBwdWJsaWMNCiAgICAgKi8NCg0KICB9LCB7DQogICAga2V5OiAnaGlkZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGhpZGUoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmNsYXNzTmFtZXMuYWN0aXZlU3RhdGUpOw0KICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICdmYWxzZScpOw0KICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICB9XSk7DQoNCiAgcmV0dXJuIERyb3Bkb3duOw0KfSgpOw0KDQpleHBvcnRzLmRlZmF1bHQgPSBEcm9wZG93bjsNCg0KLyoqKi8gfSksDQovKiA4NCAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQoNCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOw0KDQp2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsNCg0KZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9DQoNCnZhciBDb250YWluZXIgPSBmdW5jdGlvbiAoKSB7DQogIGZ1bmN0aW9uIENvbnRhaW5lcihfcmVmKSB7DQogICAgdmFyIGVsZW1lbnQgPSBfcmVmLmVsZW1lbnQsDQogICAgICAgIHR5cGUgPSBfcmVmLnR5cGUsDQogICAgICAgIGNsYXNzTmFtZXMgPSBfcmVmLmNsYXNzTmFtZXMsDQogICAgICAgIHBvc2l0aW9uID0gX3JlZi5wb3NpdGlvbjsNCg0KICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDb250YWluZXIpOw0KDQogICAgT2JqZWN0LmFzc2lnbih0aGlzLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIGNsYXNzTmFtZXM6IGNsYXNzTmFtZXMsIHR5cGU6IHR5cGUsIHBvc2l0aW9uOiBwb3NpdGlvbiB9KTsNCg0KICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7DQogICAgdGhpcy5pc0ZsaXBwZWQgPSBmYWxzZTsNCiAgICB0aGlzLmlzRm9jdXNzZWQgPSBmYWxzZTsNCiAgICB0aGlzLmlzRGlzYWJsZWQgPSBmYWxzZTsNCiAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOw0KDQogICAgdGhpcy5fb25Gb2N1cyA9IHRoaXMuX29uRm9jdXMuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbkJsdXIgPSB0aGlzLl9vbkJsdXIuYmluZCh0aGlzKTsNCiAgfQ0KDQogIC8qKg0KICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzDQogICAqLw0KDQoNCiAgX2NyZWF0ZUNsYXNzKENvbnRhaW5lciwgW3sNCiAgICBrZXk6ICdhZGRFdmVudExpc3RlbmVycycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXJzKCkgew0KICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fb25Gb2N1cyk7DQogICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIHRoaXMuX29uQmx1cik7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVtb3ZlIGV2ZW50IGxpc3RlbmVycw0KICAgICAqLw0KDQogICAgLyoqICovDQoNCiAgfSwgew0KICAgIGtleTogJ3JlbW92ZUV2ZW50TGlzdGVuZXJzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9vbkZvY3VzKTsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5fb25CbHVyKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBEZXRlcm1pbmUgd2hldGhlciBjb250YWluZXIgc2hvdWxkIGJlIGZsaXBwZWQNCiAgICAgKiBiYXNlZCBvbiBwYXNzZWQgZHJvcGRvd24gcG9zaXRpb24NCiAgICAgKiBAcGFyYW0ge051bWJlcn0gZHJvcGRvd25Qb3MNCiAgICAgKiBAcmV0dXJucw0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdzaG91bGRGbGlwJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvdWxkRmxpcChkcm9wZG93blBvcykgew0KICAgICAgdmFyIHdpbmRvd0hlaWdodCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogKDAsIF91dGlscy5nZXRXaW5kb3dIZWlnaHQpKCk7DQoNCiAgICAgIGlmIChkcm9wZG93blBvcyA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCg0KICAgICAgLy8gSWYgZmxpcCBpcyBlbmFibGVkIGFuZCB0aGUgZHJvcGRvd24gYm90dG9tIHBvc2l0aW9uIGlzDQogICAgICAvLyBncmVhdGVyIHRoYW4gdGhlIHdpbmRvdyBoZWlnaHQgZmxpcCB0aGUgZHJvcGRvd24uDQogICAgICB2YXIgc2hvdWxkRmxpcCA9IGZhbHNlOw0KICAgICAgaWYgKHRoaXMucG9zaXRpb24gPT09ICdhdXRvJykgew0KICAgICAgICBzaG91bGRGbGlwID0gZHJvcGRvd25Qb3MgPj0gd2luZG93SGVpZ2h0Ow0KICAgICAgfSBlbHNlIGlmICh0aGlzLnBvc2l0aW9uID09PSAndG9wJykgew0KICAgICAgICBzaG91bGRGbGlwID0gdHJ1ZTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHNob3VsZEZsaXA7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2V0IGFjdGl2ZSBkZXNjZW5kYW50IGF0dHJpYnV0ZQ0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBhY3RpdmVEZXNjZW5kYW50IElEIG9mIGFjdGl2ZSBkZXNjZW5kYW50DQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ3NldEFjdGl2ZURlc2NlbmRhbnQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRBY3RpdmVEZXNjZW5kYW50KGFjdGl2ZURlc2NlbmRhbnRJRCkgew0KICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1hY3RpdmVkZXNjZW5kYW50JywgYWN0aXZlRGVzY2VuZGFudElEKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZW1vdmUgYWN0aXZlIGRlc2NlbmRhbnQgYXR0cmlidXRlDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ3JlbW92ZUFjdGl2ZURlc2NlbmRhbnQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVBY3RpdmVEZXNjZW5kYW50KCkgew0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1hY3RpdmVkZXNjZW5kYW50Jyk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnb3BlbicsDQogICAgdmFsdWU6IGZ1bmN0aW9uIG9wZW4oZHJvcGRvd25Qb3MpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuY2xhc3NOYW1lcy5vcGVuU3RhdGUpOw0KICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICd0cnVlJyk7DQogICAgICB0aGlzLmlzT3BlbiA9IHRydWU7DQoNCiAgICAgIGlmICh0aGlzLnNob3VsZEZsaXAoZHJvcGRvd25Qb3MpKSB7DQogICAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuY2xhc3NOYW1lcy5mbGlwcGVkU3RhdGUpOw0KICAgICAgICB0aGlzLmlzRmxpcHBlZCA9IHRydWU7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnY2xvc2UnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9zZSgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2xhc3NOYW1lcy5vcGVuU3RhdGUpOw0KICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICdmYWxzZScpOw0KICAgICAgdGhpcy5yZW1vdmVBY3RpdmVEZXNjZW5kYW50KCk7DQogICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlOw0KDQogICAgICAvLyBBIGRyb3Bkb3duIGZsaXBzIGlmIGl0IGRvZXMgbm90IGhhdmUgc3BhY2Ugd2l0aGluIHRoZSBwYWdlDQogICAgICBpZiAodGhpcy5pc0ZsaXBwZWQpIHsNCiAgICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5jbGFzc05hbWVzLmZsaXBwZWRTdGF0ZSk7DQogICAgICAgIHRoaXMuaXNGbGlwcGVkID0gZmFsc2U7DQogICAgICB9DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnZm9jdXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBmb2N1cygpIHsNCiAgICAgIGlmICghdGhpcy5pc0ZvY3Vzc2VkKSB7DQogICAgICAgIHRoaXMuZWxlbWVudC5mb2N1cygpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2FkZEZvY3VzU3RhdGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRGb2N1c1N0YXRlKCkgew0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5jbGFzc05hbWVzLmZvY3VzU3RhdGUpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3JlbW92ZUZvY3VzU3RhdGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVGb2N1c1N0YXRlKCkgew0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5jbGFzc05hbWVzLmZvY3VzU3RhdGUpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlbW92ZSBkaXNhYmxlZCBzdGF0ZQ0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdlbmFibGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBlbmFibGUoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmNsYXNzTmFtZXMuZGlzYWJsZWRTdGF0ZSk7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWRpc2FibGVkJyk7DQogICAgICBpZiAodGhpcy50eXBlID09PSAnc2VsZWN0LW9uZScpIHsNCiAgICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpOw0KICAgICAgfQ0KICAgICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2V0IGRpc2FibGVkIHN0YXRlDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2Rpc2FibGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNhYmxlKCkgew0KICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5jbGFzc05hbWVzLmRpc2FibGVkU3RhdGUpOw0KICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1kaXNhYmxlZCcsICd0cnVlJyk7DQogICAgICBpZiAodGhpcy50eXBlID09PSAnc2VsZWN0LW9uZScpIHsNCiAgICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnLTEnKTsNCiAgICAgIH0NCiAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IHRydWU7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnd3JhcCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHdyYXAoZWxlbWVudCkgew0KICAgICAgKDAsIF91dGlscy53cmFwKShlbGVtZW50LCB0aGlzLmVsZW1lbnQpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3Vud3JhcCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHVud3JhcChlbGVtZW50KSB7DQogICAgICAvLyBNb3ZlIHBhc3NlZCBlbGVtZW50IG91dHNpZGUgdGhpcyBlbGVtZW50DQogICAgICB0aGlzLmVsZW1lbnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZWxlbWVudCwgdGhpcy5lbGVtZW50KTsNCiAgICAgIC8vIFJlbW92ZSB0aGlzIGVsZW1lbnQNCiAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQWRkIGxvYWRpbmcgc3RhdGUgdG8gZWxlbWVudA0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdhZGRMb2FkaW5nU3RhdGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRMb2FkaW5nU3RhdGUoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLmNsYXNzTmFtZXMubG9hZGluZ1N0YXRlKTsNCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtYnVzeScsICd0cnVlJyk7DQogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmVtb3ZlIGxvYWRpbmcgc3RhdGUgZnJvbSBlbGVtZW50DQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ3JlbW92ZUxvYWRpbmdTdGF0ZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUxvYWRpbmdTdGF0ZSgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2xhc3NOYW1lcy5sb2FkaW5nU3RhdGUpOw0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1idXN5Jyk7DQogICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFNldCBmb2N1c3NlZCBzdGF0ZQ0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdfb25Gb2N1cycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkZvY3VzKCkgew0KICAgICAgdGhpcy5pc0ZvY3Vzc2VkID0gdHJ1ZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBSZW1vdmUgYmx1cnJlZCBzdGF0ZQ0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdfb25CbHVyJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uQmx1cigpIHsNCiAgICAgIHRoaXMuaXNGb2N1c3NlZCA9IGZhbHNlOw0KICAgIH0NCiAgfV0pOw0KDQogIHJldHVybiBDb250YWluZXI7DQp9KCk7DQoNCmV4cG9ydHMuZGVmYXVsdCA9IENvbnRhaW5lcjsNCg0KLyoqKi8gfSksDQovKiA4NSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQoNCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOw0KDQp2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsNCg0KZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9DQoNCnZhciBJbnB1dCA9IGZ1bmN0aW9uICgpIHsNCiAgZnVuY3Rpb24gSW5wdXQoX3JlZikgew0KICAgIHZhciBlbGVtZW50ID0gX3JlZi5lbGVtZW50LA0KICAgICAgICB0eXBlID0gX3JlZi50eXBlLA0KICAgICAgICBjbGFzc05hbWVzID0gX3JlZi5jbGFzc05hbWVzLA0KICAgICAgICBwbGFjZWhvbGRlclZhbHVlID0gX3JlZi5wbGFjZWhvbGRlclZhbHVlOw0KDQogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIElucHV0KTsNCg0KICAgIE9iamVjdC5hc3NpZ24odGhpcywgeyBlbGVtZW50OiBlbGVtZW50LCB0eXBlOiB0eXBlLCBjbGFzc05hbWVzOiBjbGFzc05hbWVzLCBwbGFjZWhvbGRlclZhbHVlOiBwbGFjZWhvbGRlclZhbHVlIH0pOw0KDQogICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDsNCiAgICB0aGlzLmNsYXNzTmFtZXMgPSBjbGFzc05hbWVzOw0KICAgIHRoaXMuaXNGb2N1c3NlZCA9IHRoaXMuZWxlbWVudCA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsNCiAgICB0aGlzLmlzRGlzYWJsZWQgPSBmYWxzZTsNCg0KICAgIC8vIEJpbmQgZXZlbnQgbGlzdGVuZXJzDQogICAgdGhpcy5fb25QYXN0ZSA9IHRoaXMuX29uUGFzdGUuYmluZCh0aGlzKTsNCiAgICB0aGlzLl9vbklucHV0ID0gdGhpcy5fb25JbnB1dC5iaW5kKHRoaXMpOw0KICAgIHRoaXMuX29uRm9jdXMgPSB0aGlzLl9vbkZvY3VzLmJpbmQodGhpcyk7DQogICAgdGhpcy5fb25CbHVyID0gdGhpcy5fb25CbHVyLmJpbmQodGhpcyk7DQogIH0NCg0KICBfY3JlYXRlQ2xhc3MoSW5wdXQsIFt7DQogICAga2V5OiAnYWRkRXZlbnRMaXN0ZW5lcnMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVycygpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHRoaXMuX29uSW5wdXQpOw0KICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Bhc3RlJywgdGhpcy5fb25QYXN0ZSk7DQogICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9vbkZvY3VzKTsNCiAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5fb25CbHVyKTsNCg0KICAgICAgaWYgKHRoaXMuZWxlbWVudC5mb3JtKSB7DQogICAgICAgIHRoaXMuZWxlbWVudC5mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2V0JywgdGhpcy5fb25Gb3JtUmVzZXQpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3JlbW92ZUV2ZW50TGlzdGVuZXJzJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB0aGlzLl9vbklucHV0KTsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdwYXN0ZScsIHRoaXMuX29uUGFzdGUpOw0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fb25Gb2N1cyk7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmx1cicsIHRoaXMuX29uQmx1cik7DQoNCiAgICAgIGlmICh0aGlzLmVsZW1lbnQuZm9ybSkgew0KICAgICAgICB0aGlzLmVsZW1lbnQuZm9ybS5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNldCcsIHRoaXMuX29uRm9ybVJlc2V0KTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdlbmFibGUnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBlbmFibGUoKSB7DQogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpOw0KICAgICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnZGlzYWJsZScsDQogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2FibGUoKSB7DQogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTsNCiAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IHRydWU7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnZm9jdXMnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBmb2N1cygpIHsNCiAgICAgIGlmICghdGhpcy5pc0ZvY3Vzc2VkKSB7DQogICAgICAgIHRoaXMuZWxlbWVudC5mb2N1cygpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2JsdXInLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBibHVyKCkgew0KICAgICAgaWYgKHRoaXMuaXNGb2N1c3NlZCkgew0KICAgICAgICB0aGlzLmVsZW1lbnQuYmx1cigpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFNldCB2YWx1ZSBvZiBpbnB1dCB0byBibGFuaw0KICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2xhc3MgaW5zdGFuY2UNCiAgICAgKiBAcHVibGljDQogICAgICovDQoNCiAgfSwgew0KICAgIGtleTogJ2NsZWFyJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXIoKSB7DQogICAgICB2YXIgc2V0V2lkdGggPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHRydWU7DQoNCiAgICAgIGlmICh0aGlzLmVsZW1lbnQudmFsdWUpIHsNCiAgICAgICAgdGhpcy5lbGVtZW50LnZhbHVlID0gJyc7DQogICAgICB9DQoNCiAgICAgIGlmIChzZXRXaWR0aCkgew0KICAgICAgICB0aGlzLnNldFdpZHRoKCk7DQogICAgICB9DQoNCiAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFNldCB0aGUgY29ycmVjdCBpbnB1dCB3aWR0aCBiYXNlZCBvbiBwbGFjZWhvbGRlcg0KICAgICAqIHZhbHVlIG9yIGlucHV0IHZhbHVlDQogICAgICogQHJldHVybg0KICAgICAqLw0KDQogIH0sIHsNCiAgICBrZXk6ICdzZXRXaWR0aCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFdpZHRoKGVuZm9yY2VXaWR0aCkgew0KICAgICAgdmFyIF90aGlzID0gdGhpczsNCg0KICAgICAgdmFyIGNhbGxiYWNrID0gZnVuY3Rpb24gY2FsbGJhY2sod2lkdGgpIHsNCiAgICAgICAgX3RoaXMuZWxlbWVudC5zdHlsZS53aWR0aCA9IHdpZHRoOw0KICAgICAgfTsNCg0KICAgICAgaWYgKHRoaXMuX3BsYWNlaG9sZGVyVmFsdWUpIHsNCiAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBwbGFjZWhvbGRlciwgd2Ugb25seSB3YW50IHRvIHNldCB0aGUgd2lkdGggb2YgdGhlIGlucHV0IHdoZW4gaXQgaXMgYSBncmVhdGVyDQogICAgICAgIC8vIGxlbmd0aCB0aGFuIDc1JSBvZiB0aGUgcGxhY2Vob2xkZXIuIFRoaXMgc3RvcHMgdGhlIGlucHV0IGp1bXBpbmcgYXJvdW5kLg0KICAgICAgICB2YXIgdmFsdWVIYXNEZXNpcmVkTGVuZ3RoID0gdGhpcy5lbGVtZW50LnZhbHVlLmxlbmd0aCA+PSB0aGlzLl9wbGFjZWhvbGRlclZhbHVlLmxlbmd0aCAvIDEuMjU7DQoNCiAgICAgICAgaWYgKHRoaXMuZWxlbWVudC52YWx1ZSAmJiB2YWx1ZUhhc0Rlc2lyZWRMZW5ndGggfHwgZW5mb3JjZVdpZHRoKSB7DQogICAgICAgICAgdGhpcy5jYWxjV2lkdGgoY2FsbGJhY2spOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBwbGFjZWhvbGRlciwgcmVzaXplIGlucHV0IHRvIGNvbnRlbnRzDQogICAgICAgIHRoaXMuY2FsY1dpZHRoKGNhbGxiYWNrKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdjYWxjV2lkdGgnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBjYWxjV2lkdGgoY2FsbGJhY2spIHsNCiAgICAgIHJldHVybiAoMCwgX3V0aWxzLmNhbGNXaWR0aE9mSW5wdXQpKHRoaXMuZWxlbWVudCwgY2FsbGJhY2spOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3NldEFjdGl2ZURlc2NlbmRhbnQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRBY3RpdmVEZXNjZW5kYW50KGFjdGl2ZURlc2NlbmRhbnRJRCkgew0KICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1hY3RpdmVkZXNjZW5kYW50JywgYWN0aXZlRGVzY2VuZGFudElEKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdyZW1vdmVBY3RpdmVEZXNjZW5kYW50JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlQWN0aXZlRGVzY2VuZGFudCgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vbklucHV0JywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uSW5wdXQoKSB7DQogICAgICBpZiAodGhpcy50eXBlICE9PSAnc2VsZWN0LW9uZScpIHsNCiAgICAgICAgdGhpcy5zZXRXaWR0aCgpOw0KICAgICAgfQ0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ19vblBhc3RlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uUGFzdGUoZXZlbnQpIHsNCiAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7DQogICAgICAvLyBEaXNhYmxlIHBhc3RpbmcgaW50byB0aGUgaW5wdXQgaWYgb3B0aW9uIGhhcyBiZWVuIHNldA0KDQogICAgICBpZiAodGFyZ2V0ID09PSB0aGlzLmVsZW1lbnQgJiYgdGhpcy5wcmV2ZW50UGFzdGUpIHsNCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgIH0NCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25Gb2N1cycsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkZvY3VzKCkgew0KICAgICAgdGhpcy5pc0ZvY3Vzc2VkID0gdHJ1ZTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfb25CbHVyJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uQmx1cigpIHsNCiAgICAgIHRoaXMuaXNGb2N1c3NlZCA9IGZhbHNlOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3BsYWNlaG9sZGVyJywNCiAgICBzZXQ6IGZ1bmN0aW9uIHNldChwbGFjZWhvbGRlcikgew0KICAgICAgdGhpcy5lbGVtZW50LnBsYWNlaG9sZGVyID0gcGxhY2Vob2xkZXI7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAndmFsdWUnLA0KICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7DQogICAgICB0aGlzLmVsZW1lbnQudmFsdWUgPSAnJyArIHZhbHVlOw0KICAgIH0sDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gKDAsIF91dGlscy5zdHJpcEhUTUwpKHRoaXMuZWxlbWVudC52YWx1ZSk7DQogICAgfQ0KICB9XSk7DQoNCiAgcmV0dXJuIElucHV0Ow0KfSgpOw0KDQpleHBvcnRzLmRlZmF1bHQgPSBJbnB1dDsNCg0KLyoqKi8gfSksDQovKiA4NiAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQoNCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOw0KDQp2YXIgX2NvbnN0YW50cyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7DQoNCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQ0KDQp2YXIgTGlzdCA9IGZ1bmN0aW9uICgpIHsNCiAgZnVuY3Rpb24gTGlzdChfcmVmKSB7DQogICAgdmFyIGVsZW1lbnQgPSBfcmVmLmVsZW1lbnQ7DQoNCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTGlzdCk7DQoNCiAgICBPYmplY3QuYXNzaWduKHRoaXMsIHsgZWxlbWVudDogZWxlbWVudCB9KTsNCg0KICAgIHRoaXMuc2Nyb2xsUG9zID0gdGhpcy5lbGVtZW50LnNjcm9sbFRvcDsNCiAgICB0aGlzLmhlaWdodCA9IHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHQ7DQogICAgdGhpcy5oYXNDaGlsZHJlbiA9ICEhdGhpcy5lbGVtZW50LmNoaWxkcmVuOw0KICB9DQoNCiAgX2NyZWF0ZUNsYXNzKExpc3QsIFt7DQogICAga2V5OiAnY2xlYXInLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhcigpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5pbm5lckhUTUwgPSAnJzsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdhcHBlbmQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBhcHBlbmQobm9kZSkgew0KICAgICAgdGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKG5vZGUpOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ2dldENoaWxkJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2hpbGQoc2VsZWN0b3IpIHsNCiAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnc2Nyb2xsVG9Ub3AnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBzY3JvbGxUb1RvcCgpIHsNCiAgICAgIHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgPSAwOw0KICAgIH0NCiAgfSwgew0KICAgIGtleTogJ3Njcm9sbFRvQ2hvaWNlJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gc2Nyb2xsVG9DaG9pY2UoY2hvaWNlLCBkaXJlY3Rpb24pIHsNCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7DQoNCiAgICAgIGlmICghY2hvaWNlKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgdmFyIGRyb3Bkb3duSGVpZ2h0ID0gdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodDsNCiAgICAgIHZhciBjaG9pY2VIZWlnaHQgPSBjaG9pY2Uub2Zmc2V0SGVpZ2h0Ow0KICAgICAgLy8gRGlzdGFuY2UgZnJvbSBib3R0b20gb2YgZWxlbWVudCB0byB0b3Agb2YgcGFyZW50DQogICAgICB2YXIgY2hvaWNlUG9zID0gY2hvaWNlLm9mZnNldFRvcCArIGNob2ljZUhlaWdodDsNCiAgICAgIC8vIFNjcm9sbCBwb3NpdGlvbiBvZiBkcm9wZG93bg0KICAgICAgdmFyIGNvbnRhaW5lclNjcm9sbFBvcyA9IHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgKyBkcm9wZG93bkhlaWdodDsNCiAgICAgIC8vIERpZmZlcmVuY2UgYmV0d2VlbiB0aGUgY2hvaWNlIGFuZCBzY3JvbGwgcG9zaXRpb24NCiAgICAgIHZhciBlbmRwb2ludCA9IGRpcmVjdGlvbiA+IDAgPyB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wICsgY2hvaWNlUG9zIC0gY29udGFpbmVyU2Nyb2xsUG9zIDogY2hvaWNlLm9mZnNldFRvcDsNCg0KICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICh0aW1lKSB7DQogICAgICAgIF90aGlzLl9hbmltYXRlU2Nyb2xsKHRpbWUsIGVuZHBvaW50LCBkaXJlY3Rpb24pOw0KICAgICAgfSk7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX3Njcm9sbERvd24nLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBfc2Nyb2xsRG93bihzY3JvbGxQb3MsIHN0cmVuZ3RoLCBlbmRwb2ludCkgew0KICAgICAgdmFyIGVhc2luZyA9IChlbmRwb2ludCAtIHNjcm9sbFBvcykgLyBzdHJlbmd0aDsNCiAgICAgIHZhciBkaXN0YW5jZSA9IGVhc2luZyA+IDEgPyBlYXNpbmcgOiAxOw0KDQogICAgICB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wID0gc2Nyb2xsUG9zICsgZGlzdGFuY2U7DQogICAgfQ0KICB9LCB7DQogICAga2V5OiAnX3Njcm9sbFVwJywNCiAgICB2YWx1ZTogZnVuY3Rpb24gX3Njcm9sbFVwKHNjcm9sbFBvcywgc3RyZW5ndGgsIGVuZHBvaW50KSB7DQogICAgICB2YXIgZWFzaW5nID0gKHNjcm9sbFBvcyAtIGVuZHBvaW50KSAvIHN0cmVuZ3RoOw0KICAgICAgdmFyIGRpc3RhbmNlID0gZWFzaW5nID4gMSA/IGVhc2luZyA6IDE7DQoNCiAgICAgIHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgPSBzY3JvbGxQb3MgLSBkaXN0YW5jZTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdfYW5pbWF0ZVNjcm9sbCcsDQogICAgdmFsdWU6IGZ1bmN0aW9uIF9hbmltYXRlU2Nyb2xsKHRpbWUsIGVuZHBvaW50LCBkaXJlY3Rpb24pIHsNCiAgICAgIHZhciBfdGhpczIgPSB0aGlzOw0KDQogICAgICB2YXIgc3RyZW5ndGggPSBfY29uc3RhbnRzLlNDUk9MTElOR19TUEVFRDsNCiAgICAgIHZhciBjaG9pY2VMaXN0U2Nyb2xsVG9wID0gdGhpcy5lbGVtZW50LnNjcm9sbFRvcDsNCiAgICAgIHZhciBjb250aW51ZUFuaW1hdGlvbiA9IGZhbHNlOw0KDQogICAgICBpZiAoZGlyZWN0aW9uID4gMCkgew0KICAgICAgICB0aGlzLl9zY3JvbGxEb3duKGNob2ljZUxpc3RTY3JvbGxUb3AsIHN0cmVuZ3RoLCBlbmRwb2ludCk7DQoNCiAgICAgICAgaWYgKGNob2ljZUxpc3RTY3JvbGxUb3AgPCBlbmRwb2ludCkgew0KICAgICAgICAgIGNvbnRpbnVlQW5pbWF0aW9uID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5fc2Nyb2xsVXAoY2hvaWNlTGlzdFNjcm9sbFRvcCwgc3RyZW5ndGgsIGVuZHBvaW50KTsNCg0KICAgICAgICBpZiAoY2hvaWNlTGlzdFNjcm9sbFRvcCA+IGVuZHBvaW50KSB7DQogICAgICAgICAgY29udGludWVBbmltYXRpb24gPSB0cnVlOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGlmIChjb250aW51ZUFuaW1hdGlvbikgew0KICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgew0KICAgICAgICAgIF90aGlzMi5fYW5pbWF0ZVNjcm9sbCh0aW1lLCBlbmRwb2ludCwgZGlyZWN0aW9uKTsNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfQ0KICB9XSk7DQoNCiAgcmV0dXJuIExpc3Q7DQp9KCk7DQoNCmV4cG9ydHMuZGVmYXVsdCA9IExpc3Q7DQoNCi8qKiovIH0pLA0KLyogODcgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KDQp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsNCg0KdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQob2JqZWN0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHsgaWYgKG9iamVjdCA9PT0gbnVsbCkgb2JqZWN0ID0gRnVuY3Rpb24ucHJvdG90eXBlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IHJldHVybiBnZXQocGFyZW50LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpOyB9IH0gZWxzZSBpZiAoInZhbHVlIiBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfTsNCg0KdmFyIF93cmFwcGVkRWxlbWVudCA9IF9fd2VicGFja19yZXF1aXJlX18oMzUpOw0KDQp2YXIgX3dyYXBwZWRFbGVtZW50MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3dyYXBwZWRFbGVtZW50KTsNCg0KdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7DQoNCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9DQoNCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQ0KDQpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmICghc2VsZikgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpID8gY2FsbCA6IHNlbGY7IH0NCg0KZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0NCg0KdmFyIFdyYXBwZWRJbnB1dCA9IGZ1bmN0aW9uIChfV3JhcHBlZEVsZW1lbnQpIHsNCiAgX2luaGVyaXRzKFdyYXBwZWRJbnB1dCwgX1dyYXBwZWRFbGVtZW50KTsNCg0KICBmdW5jdGlvbiBXcmFwcGVkSW5wdXQoX3JlZikgew0KICAgIHZhciBlbGVtZW50ID0gX3JlZi5lbGVtZW50LA0KICAgICAgICBjbGFzc05hbWVzID0gX3JlZi5jbGFzc05hbWVzLA0KICAgICAgICBkZWxpbWl0ZXIgPSBfcmVmLmRlbGltaXRlcjsNCg0KICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBXcmFwcGVkSW5wdXQpOw0KDQogICAgdmFyIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgKFdyYXBwZWRJbnB1dC5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKFdyYXBwZWRJbnB1dCkpLmNhbGwodGhpcywgeyBlbGVtZW50OiBlbGVtZW50LCBjbGFzc05hbWVzOiBjbGFzc05hbWVzIH0pKTsNCg0KICAgIF90aGlzLmRlbGltaXRlciA9IGRlbGltaXRlcjsNCiAgICByZXR1cm4gX3RoaXM7DQogIH0NCg0KICBfY3JlYXRlQ2xhc3MoV3JhcHBlZElucHV0LCBbew0KICAgIGtleTogJ3ZhbHVlJywNCiAgICBzZXQ6IGZ1bmN0aW9uIHNldChpdGVtcykgew0KICAgICAgdmFyIGl0ZW1zRmlsdGVyZWQgPSAoMCwgX3V0aWxzLnJlZHVjZVRvVmFsdWVzKShpdGVtcyk7DQogICAgICB2YXIgaXRlbXNGaWx0ZXJlZFN0cmluZyA9IGl0ZW1zRmlsdGVyZWQuam9pbih0aGlzLmRlbGltaXRlcik7DQoNCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgaXRlbXNGaWx0ZXJlZFN0cmluZyk7DQogICAgICB0aGlzLmVsZW1lbnQudmFsdWUgPSBpdGVtc0ZpbHRlcmVkU3RyaW5nOw0KICAgIH0NCg0KICAgIC8vIEB0b2RvIGZpZ3VyZSBvdXQgd2h5IHdlIG5lZWQgdGhpcz8gUGVyaGFwcyBhIGJhYmVsIGlzc3VlDQogICAgLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIF9nZXQoV3JhcHBlZElucHV0LnByb3RvdHlwZS5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKFdyYXBwZWRJbnB1dC5wcm90b3R5cGUpLCAndmFsdWUnLCB0aGlzKTsNCiAgICB9DQogIH1dKTsNCg0KICByZXR1cm4gV3JhcHBlZElucHV0Ow0KfShfd3JhcHBlZEVsZW1lbnQyLmRlZmF1bHQpOw0KDQpleHBvcnRzLmRlZmF1bHQgPSBXcmFwcGVkSW5wdXQ7DQoNCi8qKiovIH0pLA0KLyogODggKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KDQp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsNCg0KdmFyIF93cmFwcGVkRWxlbWVudCA9IF9fd2VicGFja19yZXF1aXJlX18oMzUpOw0KDQp2YXIgX3dyYXBwZWRFbGVtZW50MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3dyYXBwZWRFbGVtZW50KTsNCg0KdmFyIF90ZW1wbGF0ZXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM2KTsNCg0KdmFyIF90ZW1wbGF0ZXMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdGVtcGxhdGVzKTsNCg0KZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0NCg0KZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9DQoNCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikgPyBjYWxsIDogc2VsZjsgfQ0KDQpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIDogc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQ0KDQp2YXIgV3JhcHBlZFNlbGVjdCA9IGZ1bmN0aW9uIChfV3JhcHBlZEVsZW1lbnQpIHsNCiAgX2luaGVyaXRzKFdyYXBwZWRTZWxlY3QsIF9XcmFwcGVkRWxlbWVudCk7DQoNCiAgZnVuY3Rpb24gV3JhcHBlZFNlbGVjdChfcmVmKSB7DQogICAgdmFyIGVsZW1lbnQgPSBfcmVmLmVsZW1lbnQsDQogICAgICAgIGNsYXNzTmFtZXMgPSBfcmVmLmNsYXNzTmFtZXM7DQoNCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgV3JhcHBlZFNlbGVjdCk7DQoNCiAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgKFdyYXBwZWRTZWxlY3QuX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihXcmFwcGVkU2VsZWN0KSkuY2FsbCh0aGlzLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIGNsYXNzTmFtZXM6IGNsYXNzTmFtZXMgfSkpOw0KICB9DQoNCiAgX2NyZWF0ZUNsYXNzKFdyYXBwZWRTZWxlY3QsIFt7DQogICAga2V5OiAnYXBwZW5kRG9jRnJhZ21lbnQnLA0KICAgIHZhbHVlOiBmdW5jdGlvbiBhcHBlbmREb2NGcmFnbWVudChmcmFnbWVudCkgew0KICAgICAgdGhpcy5lbGVtZW50LmlubmVySFRNTCA9ICcnOw0KICAgICAgdGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKGZyYWdtZW50KTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdwbGFjZWhvbGRlck9wdGlvbicsDQogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7DQogICAgICByZXR1cm4gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ29wdGlvbltwbGFjZWhvbGRlcl0nKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdvcHRpb25Hcm91cHMnLA0KICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgew0KICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5lbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdPUFRHUk9VUCcpKTsNCiAgICB9DQogIH0sIHsNCiAgICBrZXk6ICdvcHRpb25zJywNCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsNCiAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuZWxlbWVudC5vcHRpb25zKTsNCiAgICB9LA0KICAgIHNldDogZnVuY3Rpb24gc2V0KG9wdGlvbnMpIHsNCiAgICAgIHZhciBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCiAgICAgIHZhciBhZGRPcHRpb25Ub0ZyYWdtZW50ID0gZnVuY3Rpb24gYWRkT3B0aW9uVG9GcmFnbWVudChkYXRhKSB7DQogICAgICAgIC8vIENyZWF0ZSBhIHN0YW5kYXJkIHNlbGVjdCBvcHRpb24NCiAgICAgICAgdmFyIHRlbXBsYXRlID0gX3RlbXBsYXRlczIuZGVmYXVsdC5vcHRpb24oZGF0YSk7DQogICAgICAgIC8vIEFwcGVuZCBpdCB0byBmcmFnbWVudA0KICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZCh0ZW1wbGF0ZSk7DQogICAgICB9Ow0KDQogICAgICAvLyBBZGQgZWFjaCBsaXN0IGl0ZW0gdG8gbGlzdA0KICAgICAgb3B0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChvcHRpb25EYXRhKSB7DQogICAgICAgIHJldHVybiBhZGRPcHRpb25Ub0ZyYWdtZW50KG9wdGlvbkRhdGEpOw0KICAgICAgfSk7DQoNCiAgICAgIHRoaXMuYXBwZW5kRG9jRnJhZ21lbnQoZnJhZ21lbnQpOw0KICAgIH0NCiAgfV0pOw0KDQogIHJldHVybiBXcmFwcGVkU2VsZWN0Ow0KfShfd3JhcHBlZEVsZW1lbnQyLmRlZmF1bHQpOw0KDQpleHBvcnRzLmRlZmF1bHQgPSBXcmFwcGVkU2VsZWN0Ow0KDQovKioqLyB9KSwNCi8qIDg5ICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCnZhciBfX1dFQlBBQ0tfQU1EX0RFRklORV9BUlJBWV9fLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXzsvKiENCiAgQ29weXJpZ2h0IChjKSAyMDE2IEplZCBXYXRzb24uDQogIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoTUlUKSwgc2VlDQogIGh0dHA6Ly9qZWR3YXRzb24uZ2l0aHViLmlvL2NsYXNzbmFtZXMNCiovDQovKiBnbG9iYWwgZGVmaW5lICovDQoNCihmdW5jdGlvbiAoKSB7DQoJJ3VzZSBzdHJpY3QnOw0KDQoJdmFyIGhhc093biA9IHt9Lmhhc093blByb3BlcnR5Ow0KDQoJZnVuY3Rpb24gY2xhc3NOYW1lcyAoKSB7DQoJCXZhciBjbGFzc2VzID0gW107DQoNCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsNCgkJCXZhciBhcmcgPSBhcmd1bWVudHNbaV07DQoJCQlpZiAoIWFyZykgY29udGludWU7DQoNCgkJCXZhciBhcmdUeXBlID0gdHlwZW9mIGFyZzsNCg0KCQkJaWYgKGFyZ1R5cGUgPT09ICdzdHJpbmcnIHx8IGFyZ1R5cGUgPT09ICdudW1iZXInKSB7DQoJCQkJY2xhc3Nlcy5wdXNoKGFyZyk7DQoJCQl9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoYXJnKSkgew0KCQkJCWNsYXNzZXMucHVzaChjbGFzc05hbWVzLmFwcGx5KG51bGwsIGFyZykpOw0KCQkJfSBlbHNlIGlmIChhcmdUeXBlID09PSAnb2JqZWN0Jykgew0KCQkJCWZvciAodmFyIGtleSBpbiBhcmcpIHsNCgkJCQkJaWYgKGhhc093bi5jYWxsKGFyZywga2V5KSAmJiBhcmdba2V5XSkgew0KCQkJCQkJY2xhc3Nlcy5wdXNoKGtleSk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gY2xhc3Nlcy5qb2luKCcgJyk7DQoJfQ0KDQoJaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7DQoJCW1vZHVsZS5leHBvcnRzID0gY2xhc3NOYW1lczsNCgl9IGVsc2UgaWYgKHRydWUpIHsNCgkJLy8gcmVnaXN0ZXIgYXMgJ2NsYXNzbmFtZXMnLCBjb25zaXN0ZW50IHdpdGggbnBtIHBhY2thZ2UgbmFtZQ0KCQkhKF9fV0VCUEFDS19BTURfREVGSU5FX0FSUkFZX18gPSBbXSwgX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gPSAoZnVuY3Rpb24gKCkgew0KCQkJcmV0dXJuIGNsYXNzTmFtZXM7DQoJCX0pLmFwcGx5KGV4cG9ydHMsIF9fV0VCUEFDS19BTURfREVGSU5FX0FSUkFZX18pLA0KCQkJCV9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fICE9PSB1bmRlZmluZWQgJiYgKG1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18pKTsNCgl9IGVsc2Ugew0KCQl3aW5kb3cuY2xhc3NOYW1lcyA9IGNsYXNzTmFtZXM7DQoJfQ0KfSgpKTsNCg0KDQovKioqLyB9KSwNCi8qIDkwICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCmV4cG9ydHMuY2xlYXJDaG9pY2VzID0gZXhwb3J0cy5hY3RpdmF0ZUNob2ljZXMgPSBleHBvcnRzLmZpbHRlckNob2ljZXMgPSBleHBvcnRzLmFkZENob2ljZSA9IHVuZGVmaW5lZDsNCg0KdmFyIF9jb25zdGFudHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOw0KDQp2YXIgYWRkQ2hvaWNlID0gZXhwb3J0cy5hZGRDaG9pY2UgPSBmdW5jdGlvbiBhZGRDaG9pY2UoX3JlZikgew0KICB2YXIgdmFsdWUgPSBfcmVmLnZhbHVlLA0KICAgICAgbGFiZWwgPSBfcmVmLmxhYmVsLA0KICAgICAgaWQgPSBfcmVmLmlkLA0KICAgICAgZ3JvdXBJZCA9IF9yZWYuZ3JvdXBJZCwNCiAgICAgIGRpc2FibGVkID0gX3JlZi5kaXNhYmxlZCwNCiAgICAgIGVsZW1lbnRJZCA9IF9yZWYuZWxlbWVudElkLA0KICAgICAgY3VzdG9tUHJvcGVydGllcyA9IF9yZWYuY3VzdG9tUHJvcGVydGllcywNCiAgICAgIHBsYWNlaG9sZGVyID0gX3JlZi5wbGFjZWhvbGRlciwNCiAgICAgIGtleUNvZGUgPSBfcmVmLmtleUNvZGU7DQogIHJldHVybiB7DQogICAgdHlwZTogX2NvbnN0YW50cy5BQ1RJT05fVFlQRVMuQUREX0NIT0lDRSwNCiAgICB2YWx1ZTogdmFsdWUsDQogICAgbGFiZWw6IGxhYmVsLA0KICAgIGlkOiBpZCwNCiAgICBncm91cElkOiBncm91cElkLA0KICAgIGRpc2FibGVkOiBkaXNhYmxlZCwNCiAgICBlbGVtZW50SWQ6IGVsZW1lbnRJZCwNCiAgICBjdXN0b21Qcm9wZXJ0aWVzOiBjdXN0b21Qcm9wZXJ0aWVzLA0KICAgIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlciwNCiAgICBrZXlDb2RlOiBrZXlDb2RlDQogIH07DQp9Ow0KDQp2YXIgZmlsdGVyQ2hvaWNlcyA9IGV4cG9ydHMuZmlsdGVyQ2hvaWNlcyA9IGZ1bmN0aW9uIGZpbHRlckNob2ljZXMocmVzdWx0cykgew0KICByZXR1cm4gew0KICAgIHR5cGU6IF9jb25zdGFudHMuQUNUSU9OX1RZUEVTLkZJTFRFUl9DSE9JQ0VTLA0KICAgIHJlc3VsdHM6IHJlc3VsdHMNCiAgfTsNCn07DQoNCnZhciBhY3RpdmF0ZUNob2ljZXMgPSBleHBvcnRzLmFjdGl2YXRlQ2hvaWNlcyA9IGZ1bmN0aW9uIGFjdGl2YXRlQ2hvaWNlcygpIHsNCiAgdmFyIGFjdGl2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogdHJ1ZTsNCiAgcmV0dXJuIHsNCiAgICB0eXBlOiBfY29uc3RhbnRzLkFDVElPTl9UWVBFUy5BQ1RJVkFURV9DSE9JQ0VTLA0KICAgIGFjdGl2ZTogYWN0aXZlDQogIH07DQp9Ow0KDQp2YXIgY2xlYXJDaG9pY2VzID0gZXhwb3J0cy5jbGVhckNob2ljZXMgPSBmdW5jdGlvbiBjbGVhckNob2ljZXMoKSB7DQogIHJldHVybiB7DQogICAgdHlwZTogX2NvbnN0YW50cy5BQ1RJT05fVFlQRVMuQ0xFQVJfQ0hPSUNFUw0KICB9Ow0KfTsNCg0KLyoqKi8gfSksDQovKiA5MSAqLw0KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgew0KDQoidXNlIHN0cmljdCI7DQoNCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgew0KICB2YWx1ZTogdHJ1ZQ0KfSk7DQpleHBvcnRzLmhpZ2hsaWdodEl0ZW0gPSBleHBvcnRzLnJlbW92ZUl0ZW0gPSBleHBvcnRzLmFkZEl0ZW0gPSB1bmRlZmluZWQ7DQoNCnZhciBfY29uc3RhbnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1KTsNCg0KdmFyIGFkZEl0ZW0gPSBleHBvcnRzLmFkZEl0ZW0gPSBmdW5jdGlvbiBhZGRJdGVtKF9yZWYpIHsNCiAgdmFyIHZhbHVlID0gX3JlZi52YWx1ZSwNCiAgICAgIGxhYmVsID0gX3JlZi5sYWJlbCwNCiAgICAgIGlkID0gX3JlZi5pZCwNCiAgICAgIGNob2ljZUlkID0gX3JlZi5jaG9pY2VJZCwNCiAgICAgIGdyb3VwSWQgPSBfcmVmLmdyb3VwSWQsDQogICAgICBjdXN0b21Qcm9wZXJ0aWVzID0gX3JlZi5jdXN0b21Qcm9wZXJ0aWVzLA0KICAgICAgcGxhY2Vob2xkZXIgPSBfcmVmLnBsYWNlaG9sZGVyLA0KICAgICAga2V5Q29kZSA9IF9yZWYua2V5Q29kZTsNCiAgcmV0dXJuIHsNCiAgICB0eXBlOiBfY29uc3RhbnRzLkFDVElPTl9UWVBFUy5BRERfSVRFTSwNCiAgICB2YWx1ZTogdmFsdWUsDQogICAgbGFiZWw6IGxhYmVsLA0KICAgIGlkOiBpZCwNCiAgICBjaG9pY2VJZDogY2hvaWNlSWQsDQogICAgZ3JvdXBJZDogZ3JvdXBJZCwNCiAgICBjdXN0b21Qcm9wZXJ0aWVzOiBjdXN0b21Qcm9wZXJ0aWVzLA0KICAgIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlciwNCiAgICBrZXlDb2RlOiBrZXlDb2RlDQogIH07DQp9Ow0KDQp2YXIgcmVtb3ZlSXRlbSA9IGV4cG9ydHMucmVtb3ZlSXRlbSA9IGZ1bmN0aW9uIHJlbW92ZUl0ZW0oaWQsIGNob2ljZUlkKSB7DQogIHJldHVybiB7DQogICAgdHlwZTogX2NvbnN0YW50cy5BQ1RJT05fVFlQRVMuUkVNT1ZFX0lURU0sDQogICAgaWQ6IGlkLA0KICAgIGNob2ljZUlkOiBjaG9pY2VJZA0KICB9Ow0KfTsNCg0KdmFyIGhpZ2hsaWdodEl0ZW0gPSBleHBvcnRzLmhpZ2hsaWdodEl0ZW0gPSBmdW5jdGlvbiBoaWdobGlnaHRJdGVtKGlkLCBoaWdobGlnaHRlZCkgew0KICByZXR1cm4gew0KICAgIHR5cGU6IF9jb25zdGFudHMuQUNUSU9OX1RZUEVTLkhJR0hMSUdIVF9JVEVNLA0KICAgIGlkOiBpZCwNCiAgICBoaWdobGlnaHRlZDogaGlnaGxpZ2h0ZWQNCiAgfTsNCn07DQoNCi8qKiovIH0pLA0KLyogOTIgKi8NCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsNCg0KInVzZSBzdHJpY3QiOw0KDQoNCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsNCiAgdmFsdWU6IHRydWUNCn0pOw0KZXhwb3J0cy5hZGRHcm91cCA9IHVuZGVmaW5lZDsNCg0KdmFyIF9jb25zdGFudHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOw0KDQovKiBlc2xpbnQtZGlzYWJsZSBpbXBvcnQvcHJlZmVyLWRlZmF1bHQtZXhwb3J0ICovDQp2YXIgYWRkR3JvdXAgPSBleHBvcnRzLmFkZEdyb3VwID0gZnVuY3Rpb24gYWRkR3JvdXAodmFsdWUsIGlkLCBhY3RpdmUsIGRpc2FibGVkKSB7DQogIHJldHVybiB7DQogICAgdHlwZTogX2NvbnN0YW50cy5BQ1RJT05fVFlQRVMuQUREX0dST1VQLA0KICAgIHZhbHVlOiB2YWx1ZSwNCiAgICBpZDogaWQsDQogICAgYWN0aXZlOiBhY3RpdmUsDQogICAgZGlzYWJsZWQ6IGRpc2FibGVkDQogIH07DQp9Ow0KDQovKioqLyB9KSwNCi8qIDkzICovDQovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7DQoNCiJ1c2Ugc3RyaWN0IjsNCg0KDQpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7DQogIHZhbHVlOiB0cnVlDQp9KTsNCnZhciBjbGVhckFsbCA9IGV4cG9ydHMuY2xlYXJBbGwgPSBmdW5jdGlvbiBjbGVhckFsbCgpIHsNCiAgcmV0dXJuIHsNCiAgICB0eXBlOiAnQ0xFQVJfQUxMJw0KICB9Ow0KfTsNCg0KdmFyIHJlc2V0VG8gPSBleHBvcnRzLnJlc2V0VG8gPSBmdW5jdGlvbiByZXNldFRvKHN0YXRlKSB7DQogIHJldHVybiB7DQogICAgdHlwZTogJ1JFU0VUX1RPJywNCiAgICBzdGF0ZTogc3RhdGUNCiAgfTsNCn07DQoNCi8qKiovIH0pDQovKioqKioqLyBdKTsNCn0pOw0KLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2hvaWNlcy5qcy5tYXANCiAgPC9zY3JpcHQ+DQoNCiAgPCEtLVRyYXZlbCBMZWFkZXJzIENvbnRlbnQtLT4NCiAgPCEtLTxzY3JpcHQgc3JjPSJqYXZhc2NyaXB0cy9jb21wbGVhdC12ZW5kb3ItZGVidWctcGFyc2VyLmpzIj48L3NjcmlwdD4tLT4NCiAgPHNjcmlwdD4vKioqDQoqIENvbXBsZWF0IFZlbmRvciBEZWJ1ZyBwYXJzZXIgZm9yIEphdmFTY3JpcHQNCioNCiogQ29weXJpZ2h0IChjKSAyMDE0IFRvZGQgSGFtYmxleSAoTUlUIExpY2Vuc2UpLg0KKg0KKi8NCiAgICAvKmpzaGludA0KICAgICAgbGF4Y29tbWE6dHJ1ZQ0KICAgICAgbGF4YnJlYWs6dHJ1ZQ0KICAgICAgZXFudWxsOnRydWUNCiAgICAgIGxvb3BmdW5jOnRydWUNCiAgICAgIHN1Yjp0cnVlDQogICAgKi8NCiAgICA7IChmdW5jdGlvbiAoKSB7DQogICAgICAidXNlIHN0cmljdCI7DQoNCiAgICAgIC8vIG9ubHkgcnVuIHdoZW4gdGhlIHN1YnN0cigpIGZ1bmN0aW9uIGlzIGJyb2tlbg0KICAgICAgaWYgKCdhYicuc3Vic3RyKC0xKSAhPSAnYicpIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqICBHZXQgdGhlIHN1YnN0cmluZyBvZiBhIHN0cmluZw0KICAgICAgICAgKiAgQHBhcmFtICB7aW50ZWdlcn0gIHN0YXJ0ICAgd2hlcmUgdG8gc3RhcnQgdGhlIHN1YnN0cmluZw0KICAgICAgICAgKiAgQHBhcmFtICB7aW50ZWdlcn0gIGxlbmd0aCAgaG93IG1hbnkgY2hhcmFjdGVycyB0byByZXR1cm4NCiAgICAgICAgICogIEByZXR1cm4ge3N0cmluZ30NCiAgICAgICAgICovDQogICAgICAgIFN0cmluZy5wcm90b3R5cGUuc3Vic3RyID0gZnVuY3Rpb24gKHN1YnN0cikgew0KICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoc3RhcnQsIGxlbmd0aCkgew0KICAgICAgICAgICAgLy8gZGlkIHdlIGdldCBhIG5lZ2F0aXZlIHN0YXJ0LCBjYWxjdWxhdGUgaG93IG11Y2ggaXQgaXMNCiAgICAgICAgICAgIC8vIGZyb20gdGhlIGJlZ2lubmluZyBvZiB0aGUgc3RyaW5nDQogICAgICAgICAgICBpZiAoc3RhcnQgPCAwKSB7DQogICAgICAgICAgICAgIHN0YXJ0ID0gdGhpcy5sZW5ndGggKyBzdGFydDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gY2FsbCB0aGUgb3JpZ2luYWwgZnVuY3Rpb24NCiAgICAgICAgICAgIHJldHVybiBzdWJzdHIuY2FsbCh0aGlzLCBzdGFydCwgbGVuZ3RoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0oU3RyaW5nLnByb3RvdHlwZS5zdWJzdHIpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiByaWdodEFsaWduWmVyb1BhZGRpbmcoaW5wdXRTdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuICgnMDAnICsgaW5wdXRTdHJpbmcpLnN1YnN0cigtMik7DQogICAgICB9DQoNCiAgICAgIC8vIGxvZyBjYXRlZ29yeQ0KICAgICAgLy8gbG9nIGxldmVsDQogICAgICAvLyBsb2cgZGF0ZVRpbWUNCiAgICAgIC8vIGxvZyB0ZXh0DQogICAgICBmdW5jdGlvbiBwYXJzZURlYnVnTG9nKGxvZ1RleHQpIHsNCiAgICAgICAgdmFyIGxvZ0xpbmVzID0gbG9nVGV4dC5zcGxpdCgnXG4nKTsNCiAgICAgICAgdmFyIGxvZ0VudHJpZXMgPSBbXTsNCiAgICAgICAgdmFyIGxvZ0VudHJ5TnVtYmVyID0gLTE7DQogICAgICAgIC8vIGV4YW1wbGUgbG9nIGVudHJpZXM6DQogICAgICAgIC8vIFtXIzM3OTkgKDYwKSBXUksxXSAtLSB7UmVxdWVzdH0gLS0gPERlYnVnPiAtLSAxMS8yMS8xNCAxNTozNzo1Ny45MTQgLS0gUS83VkEvMjYqQzcNCiAgICAgICAgLy8ge2xvZyBpbmZvfSAtLSA8bG9nIGxldmVsPiAtLSBsb2cgdGltZSAtLSBsb2cgdGV4dA0KICAgICAgICAvLyB7SW5mb3JtYXRpb25DbGFzc2lmaWNhdGlvbn0gLS0gPEluZm8+IC0tIDEyLzI2LzEzIDIzOjUxOjA0Ljg3MCAtLSBUaGlzIExvZyBDb250YWlucyBQcml2aWxlZ2VkIEluZm9ybWF0aW9uLg0KICAgICAgICAvLyA8bG9nIGxldmVsPiAtLSBsb2cgdGltZSAtLSBsb2cgdGV4dA0KICAgICAgICAvLyA8U3RhdHVzPiAtLSAxMi8yNi8xMyAyMzo1MTowNi4zMjEgLS0gQ29ubmVjdGVkLg0KICAgICAgICB2YXIgY3VycmVudFdvcmtmbG93ID0gJyc7DQogICAgICAgIHZhciBjdXJyZW50UHJvY2VzcyA9ICcnOw0KICAgICAgICB2YXIgY3VycmVudFJvdXRpbmUgPSAnJzsNCiAgICAgICAgdmFyIGN1cnJlbnRMb2NhdG9yID0gJyc7DQoNCiAgICAgICAgdmFyIGxvZ0VudHJ5UmVnRXggPSAvXig/OltcW11XIyhbMC05XSspIFtcKF0oWzAtOV0rKVtcKV0gW0EtWlxkXSo/V1JLKFswLTldKylbXF1dIC0tICk/KD86W1x7XShbXlx9XSspW1x9XSAtLSApPyg/OltcPF0oW0EtWmEtel0rKVtcPl0gLS0gKSg/OihbMC05XXsxLDJ9KVwvKFswLTldezEsMn0pXC8oWzAtOV17Mn0pIChbMC05XXsxLDJ9KTooWzAtOV17Mn0pOihbMC05XXsyfSkuKFswLTldezN9KSAtLSApKC4rKS87DQogICAgICAgIHZhciBsb2dTZXBhcmF0b3JSZWdFeCA9IC9eW1wtXXsyMH0oW1xkXSspXC8oW1xkXSspXC8oW1xkXSspIChbXGRdKyk6KFtcZF0rKTooW1xkXSspIChbQVBdTSkgW1woXVVUQ1tcKV1bXC1dezIwfS87DQogICAgICAgIHZhciByb3V0aW5lTmFtZVJlZ0V4ID0gL1JvdXRpbmUgKFtBLVphLXpfXSspLzsNCiAgICAgICAgdmFyIG5hbWVSZWdFeCA9IC8iKFteIl0rKSIvOw0KICAgICAgICBmb3IgKHZhciBsaW5lTnVtYmVyID0gMDsgbGluZU51bWJlciA8IGxvZ0xpbmVzLmxlbmd0aDsgbGluZU51bWJlcisrKSB7DQogICAgICAgICAgaWYgKGxvZ0VudHJ5UmVnRXgudGVzdChsb2dMaW5lc1tsaW5lTnVtYmVyXSkpIHsNCiAgICAgICAgICAgIGxvZ0VudHJ5TnVtYmVyKys7DQogICAgICAgICAgICB2YXIgbG9nTWF0Y2ggPSBsb2dFbnRyeVJlZ0V4LmV4ZWMobG9nTGluZXNbbGluZU51bWJlcl0pOw0KICAgICAgICAgICAgdmFyIGN1cnJlbnRMb2dFbnRyeSA9IGN1cnJlbnRMb2dFbnRyeSA9IHsNCiAgICAgICAgICAgICAgbGluZU51bWJlcjogbGluZU51bWJlciArIDEsDQogICAgICAgICAgICAgIHdvcmtlcjogcGFyc2VJbnQobG9nTWF0Y2hbMV0gfHwgJy0xJyksDQogICAgICAgICAgICAgIGFnZW5jeTogcGFyc2VJbnQobG9nTWF0Y2hbMl0gfHwgJy0xJyksDQogICAgICAgICAgICAgIHdvcmtzdGF0aW9uOiBwYXJzZUludChsb2dNYXRjaFszXSB8fCAnLTEnKSwNCiAgICAgICAgICAgICAgY2F0ZWdvcnk6IGxvZ01hdGNoWzRdIHx8ICcnLA0KICAgICAgICAgICAgICBsZXZlbDogbG9nTWF0Y2hbNV0sDQogICAgICAgICAgICAgIGRhdGVUaW1lOiBuZXcgRGF0ZShEYXRlLlVUQyhwYXJzZUludCgnMjAnICsgbG9nTWF0Y2hbOF0sIDEwKSwgcGFyc2VJbnQobG9nTWF0Y2hbNl0sIDEwKSAtIDEsIHBhcnNlSW50KGxvZ01hdGNoWzddLCAxMCksIHBhcnNlSW50KGxvZ01hdGNoWzldLCAxMCksIHBhcnNlSW50KGxvZ01hdGNoWzEwXSwgMTApLCBwYXJzZUludChsb2dNYXRjaFsxMV0sIDEwKSwgcGFyc2VJbnQobG9nTWF0Y2hbMTJdLCAxMCkpKSwNCiAgICAgICAgICAgICAgZGF0ZVRpbWVUZXh0OiAnMjAnICsgbG9nTWF0Y2hbOF0gKyAnLScgKyByaWdodEFsaWduWmVyb1BhZGRpbmcobG9nTWF0Y2hbNl0pICsgJy0nICsgcmlnaHRBbGlnblplcm9QYWRkaW5nKGxvZ01hdGNoWzddKSArICcgJyArIHJpZ2h0QWxpZ25aZXJvUGFkZGluZyhsb2dNYXRjaFs5XSkgKyAnOicgKyBsb2dNYXRjaFsxMF0gKyAnOicgKyBsb2dNYXRjaFsxMV0gKyAnLicgKyBsb2dNYXRjaFsxMl0sDQogICAgICAgICAgICAgIHRleHQ6IGxvZ01hdGNoWzEzXS5yZXBsYWNlKC8gIC9nLCAiICZuYnNwOyIpLA0KICAgICAgICAgICAgICB3b3JrZmxvdzogY3VycmVudFdvcmtmbG93LA0KICAgICAgICAgICAgICBwcm9jZXNzOiBjdXJyZW50UHJvY2VzcywNCiAgICAgICAgICAgICAgcm91dGluZTogY3VycmVudFJvdXRpbmUsDQogICAgICAgICAgICAgIHBuckxvY2F0b3I6IGN1cnJlbnRMb2NhdG9yDQogICAgICAgICAgICB9DQogICAgICAgICAgICBsb2dFbnRyaWVzW2xvZ0VudHJ5TnVtYmVyXSA9IGN1cnJlbnRMb2dFbnRyeTsNCiAgICAgICAgICAgIHN3aXRjaCAoY3VycmVudExvZ0VudHJ5LmNhdGVnb3J5KSB7DQogICAgICAgICAgICAgIGNhc2UgJ1F1ZXVlUHJvY2Vzcyc6DQogICAgICAgICAgICAgICAgaWYgKG5hbWVSZWdFeC50ZXN0KGN1cnJlbnRMb2dFbnRyeS50ZXh0KSkgew0KICAgICAgICAgICAgICAgICAgdmFyIG5hbWVNYXRjaCA9IG5hbWVSZWdFeC5leGVjKGN1cnJlbnRMb2dFbnRyeS50ZXh0KTsNCiAgICAgICAgICAgICAgICAgIC8vIHNldCB3b3JrZmxvdw0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LndvcmtmbG93ID0gY3VycmVudFdvcmtmbG93ID0gbmFtZU1hdGNoWzFdOw0KICAgICAgICAgICAgICAgICAgLy8gY2xlYXIgcHJvY2VzcyBhbmQgcm91dGluZQ0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnByb2Nlc3MgPSBjdXJyZW50UHJvY2VzcyA9ICcnOw0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnJvdXRpbmUgPSBjdXJyZW50Um91dGluZSA9ICcnOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBhbGVydCgnd29ya2Zsb3cgbmFtZSBub3QgZm91bmQ6JyArIGN1cnJlbnRMb2dFbnRyeS50ZXh0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgIGNhc2UgJ1Byb2Nlc3NFeGVjdXRlJzoNCiAgICAgICAgICAgICAgICBpZiAobmFtZVJlZ0V4LnRlc3QoY3VycmVudExvZ0VudHJ5LnRleHQpKSB7DQogICAgICAgICAgICAgICAgICB2YXIgbmFtZU1hdGNoID0gbmFtZVJlZ0V4LmV4ZWMoY3VycmVudExvZ0VudHJ5LnRleHQpOw0KICAgICAgICAgICAgICAgICAgLy8gc2V0IHByb2Nlc3MNCiAgICAgICAgICAgICAgICAgIGN1cnJlbnRMb2dFbnRyeS5wcm9jZXNzID0gY3VycmVudFByb2Nlc3MgPSBuYW1lTWF0Y2hbMV07DQogICAgICAgICAgICAgICAgICAvLyBjbGVhciByb3V0aW5lDQogICAgICAgICAgICAgICAgICBjdXJyZW50TG9nRW50cnkucm91dGluZSA9IGN1cnJlbnRSb3V0aW5lID0gJyc7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGFsZXJ0KCdwcm9jZXNzIG5hbWUgbm90IGZvdW5kOicgKyBjdXJyZW50TG9nRW50cnkudGV4dCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICBjYXNlICdQbnJUZXN0c0V4ZWN1dGUnOg0KICAgICAgICAgICAgICAgIC8vIHJvdXRpbmUNCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudExvZ0VudHJ5LnRleHQgPT09ICdBbGwgcm91dGluZXMgZmluaXNoZWQuJykgew0KICAgICAgICAgICAgICAgICAgLy8gY2xlYXINCiAgICAgICAgICAgICAgICAgIGN1cnJlbnRMb2dFbnRyeS5yb3V0aW5lID0gY3VycmVudFJvdXRpbmUgPSAnJzsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgaWYgKHJvdXRpbmVOYW1lUmVnRXgudGVzdChjdXJyZW50TG9nRW50cnkudGV4dCkpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWVNYXRjaCA9IHJvdXRpbmVOYW1lUmVnRXguZXhlYyhjdXJyZW50TG9nRW50cnkudGV4dCk7DQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMb2dFbnRyeS5yb3V0aW5lID0gY3VycmVudFJvdXRpbmUgPSBuYW1lTWF0Y2hbMV07DQogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5hbWVSZWdFeC50ZXN0KGN1cnJlbnRMb2dFbnRyeS50ZXh0KSkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZU1hdGNoID0gbmFtZVJlZ0V4LmV4ZWMoY3VycmVudExvZ0VudHJ5LnRleHQpOw0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50TG9nRW50cnkucm91dGluZSA9IGN1cnJlbnRSb3V0aW5lID0gbmFtZU1hdGNoWzFdOw0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ3JvdXRpbmUgbmFtZSBub3QgZm91bmQ6JyArIGN1cnJlbnRMb2dFbnRyeS50ZXh0KTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgIGNhc2UgJyc6DQogICAgICAgICAgICAgICAgLy8gY2hlY2sgZm9yIGxldmVsID0gJ2RlYnVnJyBhbmQgcHJlc2VuY2Ugb2YgImVuY291bnRlcmVkIiBpbiB0ZXh0DQogICAgICAgICAgICAgICAgaWYgKChjdXJyZW50TG9nRW50cnkubGV2ZWwgPT09ICdEZWJ1ZycpICYmIChjdXJyZW50TG9nRW50cnkudGV4dC5zdWJzdHIoMCwgMTEpID09PSAnRW5jb3VudGVyZWQnKSkgew0KICAgICAgICAgICAgICAgICAgLy8gc2V0IGxvY2F0b3INCiAgICAgICAgICAgICAgICAgIGN1cnJlbnRMb2dFbnRyeS5wbnJMb2NhdG9yID0gY3VycmVudExvY2F0b3IgPSBjdXJyZW50TG9nRW50cnkudGV4dC5zdWJzdHIoMTIpOw0KICAgICAgICAgICAgICAgICAgLy8gY2xlYXIgd29ya2Zsb3csIHByb2Nlc3MgYW5kIHJvdXRpbmUNCiAgICAgICAgICAgICAgICAgIC8vIGN1cnJlbnRMb2dFbnRyeS53b3JrZmxvdyA9IGN1cnJlbnRXb3JrZmxvdyA9ICcnOw0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnByb2Nlc3MgPSBjdXJyZW50UHJvY2VzcyA9ICcnOw0KICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnJvdXRpbmUgPSBjdXJyZW50Um91dGluZSA9ICcnOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgIH0gZWxzZSBpZiAobG9nRW50cnlOdW1iZXIgPiAtMSkgew0KICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0xMS8yMS8yMDE0IDM6Mzc6NTcgUE0gKFVUQyktLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAgICAgaWYgKGxvZ1NlcGFyYXRvclJlZ0V4LnRlc3QobG9nTGluZXNbbGluZU51bWJlcl0pKSB7DQogICAgICAgICAgICAgIGN1cnJlbnRXb3JrZmxvdyA9ICcnOw0KICAgICAgICAgICAgICBjdXJyZW50UHJvY2VzcyA9ICcnOw0KICAgICAgICAgICAgICBjdXJyZW50Um91dGluZSA9ICcnOw0KICAgICAgICAgICAgICBjdXJyZW50TG9jYXRvciA9ICcnOw0KDQogICAgICAgICAgICAgIHZhciBsb2dNYXRjaCA9IGxvZ1NlcGFyYXRvclJlZ0V4LmV4ZWMobG9nTGluZXNbbGluZU51bWJlcl0pOw0KICAgICAgICAgICAgICAvL15bXC1dezIwfShbXGRdKylcLyhbXGRdKylcLyhbXGRdKykgKFtcZF0rKTooW1xkXSspOihbXGRdKykgKFtBUF1NKSBbXChdVVRDW1wpXVtcLV17MjB9DQogICAgICAgICAgICAgIGxvZ0VudHJ5TnVtYmVyKys7DQogICAgICAgICAgICAgIGxvZ0VudHJpZXNbbG9nRW50cnlOdW1iZXJdID0gew0KICAgICAgICAgICAgICAgIGxpbmVOdW1iZXI6IGxpbmVOdW1iZXIgKyAxLA0KICAgICAgICAgICAgICAgIHdvcmtlcjogLTEsDQogICAgICAgICAgICAgICAgYWdlbmN5OiAtMSwNCiAgICAgICAgICAgICAgICB3b3Jrc3RhdGlvbjogLTEsDQogICAgICAgICAgICAgICAgY2F0ZWdvcnk6ICdTZXBhcmF0b3InLA0KICAgICAgICAgICAgICAgIGxldmVsOiAnJywNCiAgICAgICAgICAgICAgICBkYXRlVGltZTogbmV3IERhdGUoRGF0ZS5VVEMocGFyc2VJbnQobG9nTWF0Y2hbM10sIDEwKSwgcGFyc2VJbnQobG9nTWF0Y2hbMV0sIDEwKSAtIDEsIHBhcnNlSW50KGxvZ01hdGNoWzJdLCAxMCksIChwYXJzZUludChsb2dNYXRjaFs0XSwgMTApICsgKChsb2dNYXRjaFs3XSA9PSAnUE0nKSA/IDEyIDogMCkpLCBwYXJzZUludChsb2dNYXRjaFs1XSwgMTApLCBwYXJzZUludChsb2dNYXRjaFs2XSwgMTApLCAwKSksDQogICAgICAgICAgICAgICAgZGF0ZVRpbWVUZXh0OiBsb2dNYXRjaFszXSArICctJyArIHJpZ2h0QWxpZ25aZXJvUGFkZGluZyhsb2dNYXRjaFsxXSkgKyAnLScgKyByaWdodEFsaWduWmVyb1BhZGRpbmcobG9nTWF0Y2hbMl0pICsgJyAnICsgcmlnaHRBbGlnblplcm9QYWRkaW5nKChwYXJzZUludChsb2dNYXRjaFs0XSwgMTApICsgKChsb2dNYXRjaFs3XSA9PSAnUE0nKSA/IDEyIDogMCkpLnRvU3RyaW5nKCkpICsgJzonICsgbG9nTWF0Y2hbNV0gKyAnOicgKyBsb2dNYXRjaFs2XSArICcuMDAwJywNCiAgICAgICAgICAgICAgICB0ZXh0OiBsb2dMaW5lc1tsaW5lTnVtYmVyXSwNCiAgICAgICAgICAgICAgICB3b3JrZmxvdzogY3VycmVudFdvcmtmbG93LA0KICAgICAgICAgICAgICAgIHByb2Nlc3M6IGN1cnJlbnRQcm9jZXNzLA0KICAgICAgICAgICAgICAgIHJvdXRpbmU6IGN1cnJlbnRSb3V0aW5lLA0KICAgICAgICAgICAgICAgIHBuckxvY2F0b3I6IGN1cnJlbnRMb2NhdG9yDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGxvZ0VudHJpZXNbbG9nRW50cnlOdW1iZXJdLnRleHQgKz0gJ1xuJyArIGxvZ0xpbmVzW2xpbmVOdW1iZXJdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbG9nRW50cmllczsNCiAgICAgIH0NCg0KICAgICAgdmFyIGNvbXBsZWF0VmVuZG9yRGVidWcgPSB7DQogICAgICAgIHBhcnNlTG9nOiBwYXJzZURlYnVnTG9nDQogICAgICB9Ow0KDQogICAgICAvKiBleHBvc2VkICovDQogICAgICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHsNCiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBjb21wbGVhdFZlbmRvckRlYnVnOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5jb21wbGVhdFZlbmRvckRlYnVnID0gY29tcGxlYXRWZW5kb3JEZWJ1ZzsNCiAgICAgIH0NCg0KICAgIH0pLmNhbGwoZnVuY3Rpb24gKCkgew0KICAgICAgcmV0dXJuIHRoaXMgfHwgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogZ2xvYmFsKTsNCiAgICB9KCkpOw0KICA8L3NjcmlwdD4NCiAgPCEtLTxzY3JpcHQgc3JjPSJqYXZhc2NyaXB0cy93c3Bhbi1kaXItcGFyc2VyLmpzIj48L3NjcmlwdD4tLT4NCiAgPHNjcmlwdD4vKioqDQoqIERJUiBwYXJzZXIgZm9yIEphdmFTY3JpcHQNCioNCiogQ29weXJpZ2h0IChjKSAyMDE0IFRvZGQgSGFtYmxleSAoTUlUIExpY2Vuc2UpLg0KKg0KKi8NCiAgICAvKmpzaGludA0KICAgICAgbGF4Y29tbWE6dHJ1ZQ0KICAgICAgbGF4YnJlYWs6dHJ1ZQ0KICAgICAgZXFudWxsOnRydWUNCiAgICAgIGxvb3BmdW5jOnRydWUNCiAgICAgIHN1Yjp0cnVlDQogICAgKi8NCiAgICA7IChmdW5jdGlvbiAoKSB7DQogICAgICAidXNlIHN0cmljdCI7DQoNCiAgICAgIGZ1bmN0aW9uIHJpYmJvbihmZWVkKSB7DQogICAgICAgIHZhciBfc2xvdCA9IG51bGw7DQogICAgICAgIHZhciBvcmcgPSBmZWVkICsgJyc7DQogICAgICAgIHZhciBwb3MgPSAwOw0KDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgc2F2ZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgX3Nsb3QgPSBwb3M7DQogICAgICAgICAgfQ0KICAgICAgICAgICwgbG9hZDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcG9zID0gX3Nsb3Q7DQogICAgICAgICAgICBmZWVkID0gb3JnLnNsaWNlKHBvcyk7DQogICAgICAgICAgfQ0KICAgICAgICAgICwgYWR2YW5jZTogZnVuY3Rpb24gKG4pIHsNCiAgICAgICAgICAgIHBvcyArPSAodHlwZW9mIG4gPT09ICdzdHJpbmcnKSA/IG4ubGVuZ3RoIDogbjsNCiAgICAgICAgICAgIGlmIChwb3MgPiAwKSB7DQogICAgICAgICAgICAgIHJldHVybiAoZmVlZCA9IG9yZy5zbGljZShwb3MpKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHJldHVybiBmZWVkID0gJyc7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgICwgcmVhZDogZnVuY3Rpb24gKG4pIHsNCiAgICAgICAgICAgIHZhciBpbmZvID0gZmVlZC5zdWJzdHJpbmcoMCwgbik7DQogICAgICAgICAgICB0aGlzLmFkdmFuY2Uobik7DQogICAgICAgICAgICByZXR1cm4gaW5mbzsNCiAgICAgICAgICB9DQogICAgICAgICAgLCBsb29rYmVoaW5kOiBmdW5jdGlvbiAobmNoYXJzKSB7DQogICAgICAgICAgICBuY2hhcnMgPSBuY2hhcnMgPT0gbnVsbCA/IDEgOiBuY2hhcnM7DQogICAgICAgICAgICByZXR1cm4gb3JnLnNsaWNlKHBvcyAtIG5jaGFycywgcG9zKTsNCiAgICAgICAgICB9DQogICAgICAgICAgLCBzdGFydHNXaXRoOiBmdW5jdGlvbiAocykgew0KICAgICAgICAgICAgcmV0dXJuIGZlZWQuc3Vic3RyaW5nKDAsIHMubGVuZ3RoKSA9PT0gczsNCiAgICAgICAgICB9DQogICAgICAgICAgLCB2YWx1ZU9mOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICByZXR1cm4gZmVlZDsNCiAgICAgICAgICB9DQogICAgICAgICAgLCB0b1N0cmluZzogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIGZlZWQ7DQogICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgfQ0KDQogICAgICAvKioqKioqKioqIHRyZWUgKioqKioqKioqKioqKioqLw0KICAgICAgLy9odHRwczovL2dpdGh1Yi5jb20vc3Bpa2VicmVobS9hcmJvcmVhbA0KDQogICAgICBmdW5jdGlvbiBpbmNsdWRlKGFycmF5LCBpdGVtKSB7DQogICAgICAgIHJldHVybiBhcnJheS5pbmRleE9mKGl0ZW0pID4gLTE7DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIF90cmF2ZXJzZURvd24oY29udGV4dCwgaXRlcmF0b3IpIHsNCiAgICAgICAgdmFyIGRvQ29udGludWUgPSB0cnVlOw0KDQogICAgICAgIChmdW5jdGlvbiB3YWxrRG93bihub2RlKSB7DQogICAgICAgICAgdmFyIGksIG5ld0NvbnRleHQ7DQoNCiAgICAgICAgICBpZiAoIWRvQ29udGludWUpIHJldHVybjsNCg0KICAgICAgICAgIGlmIChpdGVyYXRvcihub2RlKSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgIC8vYnJlYWsgdGhlIHRyYXZlcnNhbCBsb29wIGlmIHRoZSBpdGVyYXRvciByZXR1cm5zIGEgZmFsc3kgdmFsdWUNCiAgICAgICAgICAgIGRvQ29udGludWUgPSBmYWxzZTsNCiAgICAgICAgICB9DQogICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICBuZXdDb250ZXh0ID0gbm9kZS5jaGlsZHJlbltpXTsNCiAgICAgICAgICAgICAgd2Fsa0Rvd24obmV3Q29udGV4dCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9KShjb250ZXh0KTsNCiAgICAgIH0NCg0KDQogICAgICBmdW5jdGlvbiBfdHJhdmVyc2VVcChjb250ZXh0LCBpdGVyYXRvcikgew0KICAgICAgICB2YXIgaSwgbm9kZSwgZG9Db250aW51ZTsNCg0KICAgICAgICB3aGlsZSAoY29udGV4dCkgew0KICAgICAgICAgIGlmIChpdGVyYXRvcihjb250ZXh0KSA9PT0gZmFsc2UpIHJldHVybjsNCg0KICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb250ZXh0LmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBub2RlID0gY29udGV4dC5jaGlsZHJlbltpXTsNCiAgICAgICAgICAgIGlmIChpdGVyYXRvcihub2RlKSA9PT0gZmFsc2UpIHJldHVybjsNCiAgICAgICAgICB9DQogICAgICAgICAgY29udGV4dCA9IGNvbnRleHQucGFyZW50Ow0KICAgICAgICB9DQogICAgICB9DQoNCg0KICAgICAgZnVuY3Rpb24gX3RyYXZlcnNlKGNvbnRleHQsIGl0ZXJhdG9yLCBjYWxsYmFjaykgew0KICAgICAgICB2YXIgdmlzaXRlZCA9IFtdLA0KICAgICAgICAgIGNhbGxJdGVyYXRvciA9IGZ1bmN0aW9uIChub2RlKSB7DQogICAgICAgICAgICB2YXIgaWQgPSBub2RlLmlkLA0KICAgICAgICAgICAgICByZXR1cm5lZDsNCg0KICAgICAgICAgICAgaWYgKCFpbmNsdWRlKHZpc2l0ZWQsIGlkKSkgew0KICAgICAgICAgICAgICByZXR1cm5lZCA9IGl0ZXJhdG9yLmNhbGwobm9kZSwgbm9kZSk7DQogICAgICAgICAgICAgIHZpc2l0ZWQucHVzaChpZCk7DQoNCiAgICAgICAgICAgICAgaWYgKHJldHVybmVkID09PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5lZDsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgaSwgbm9kZTsNCg0KICAgICAgICBjYWxsYmFjayhjb250ZXh0LCBjYWxsSXRlcmF0b3IpOw0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBfcmVtb3ZlQ2hpbGQobm9kZSkgew0KICAgICAgICB2YXIgcGFyZW50ID0gbm9kZS5wYXJlbnQsDQogICAgICAgICAgY2hpbGQsDQogICAgICAgICAgaTsNCg0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGFyZW50LmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgY2hpbGQgPSBwYXJlbnQuY2hpbGRyZW5baV07DQoNCiAgICAgICAgICBpZiAoY2hpbGQgPT09IG5vZGUpIHsNCiAgICAgICAgICAgIHJldHVybiBwYXJlbnQuY2hpbGRyZW4uc3BsaWNlKGksIDEpLnNoaWZ0KCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIG5vZGVJZChwYXJlbnQsIHNlcGFyYXRvcikgew0KICAgICAgICBzZXBhcmF0b3IgPSBzZXBhcmF0b3IgfHwgJy8nOw0KICAgICAgICBpZiAocGFyZW50KSB7DQogICAgICAgICAgcmV0dXJuIFtwYXJlbnQuaWQsIHBhcmVudC5jaGlsZHJlbi5sZW5ndGhdLmpvaW4oc2VwYXJhdG9yKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gJzAnOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIERJUlRyZWUocGFyZW50LCBkYXRhLCBpZCkgew0KICAgICAgICB0aGlzLmRlcHRoID0gcGFyZW50ID8gcGFyZW50LmRlcHRoICsgMSA6IDA7DQogICAgICAgIHRoaXMuZGF0YSA9IGRhdGEgfHwge307DQogICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50IHx8IG51bGw7DQogICAgICAgIHRoaXMuaWQgPSBpZCB8fCBub2RlSWQocGFyZW50KTsNCiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOw0KICAgICAgfQ0KDQogICAgICBESVJUcmVlLnByb3RvdHlwZS5hcHBlbmRDaGlsZCA9IGZ1bmN0aW9uIChkYXRhLCBpZCkgew0KICAgICAgICB2YXIgY2hpbGQgPSBuZXcgRElSVHJlZSh0aGlzLCBkYXRhLCBpZCk7DQogICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7DQogICAgICAgIHJldHVybiBjaGlsZDsNCiAgICAgIH07DQoNCiAgICAgIERJUlRyZWUucHJvdG90eXBlLnJlbW92ZUNoaWxkID0gZnVuY3Rpb24gKGFyZykgew0KICAgICAgICBpZiAodHlwZW9mIGFyZyA9PT0gJ251bWJlcicgJiYgdGhpcy5jaGlsZHJlblthcmddKSB7DQogICAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW4uc3BsaWNlKGFyZywgMSkuc2hpZnQoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoYXJnIGluc3RhbmNlb2YgRElSVHJlZSkgew0KICAgICAgICAgIHJldHVybiBfcmVtb3ZlQ2hpbGQoYXJnKTsNCiAgICAgICAgfQ0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgYXJndW1lbnQgIiArIGFyZyk7DQogICAgICB9Ow0KDQogICAgICBESVJUcmVlLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiBfcmVtb3ZlQ2hpbGQodGhpcyk7DQogICAgICB9Ow0KDQoNCiAgICAgIERJUlRyZWUucHJvdG90eXBlLnJvb3QgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBub2RlID0gdGhpczsNCg0KICAgICAgICBpZiAoIW5vZGUucGFyZW50KSB7DQogICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCg0KICAgICAgICB3aGlsZSAobm9kZS5wYXJlbnQpIHsNCiAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnQ7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG5vZGU7DQogICAgICB9Ow0KDQogICAgICBESVJUcmVlLnByb3RvdHlwZS5pc1Jvb3QgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiAhdGhpcy5wYXJlbnQ7DQogICAgICB9Ow0KDQogICAgICBESVJUcmVlLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGxpbmVzID0gW107DQoNCiAgICAgICAgdGhpcy50cmF2ZXJzZURvd24oZnVuY3Rpb24gKG5vZGUpIHsNCiAgICAgICAgICB2YXIgc2VwYXJhdG9yID0gJ3wtICcsIGluZGVudGF0aW9uID0gJycsIGk7DQoNCiAgICAgICAgICBpZiAobm9kZS5kZXB0aCA9PT0gMCkgew0KICAgICAgICAgICAgbGluZXMucHVzaChub2RlLmlkKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQogICAgICAgICAgZm9yIChpID0gMDsgaSA8IG5vZGUuZGVwdGg7IGkrKykgew0KICAgICAgICAgICAgaW5kZW50YXRpb24gKz0gJ3wnOw0KICAgICAgICAgIH0NCiAgICAgICAgICBsaW5lcy5wdXNoKGluZGVudGF0aW9uICsgc2VwYXJhdG9yICsgbm9kZS5kYXRhLnBhdGggKyAoKG5vZGUuZGF0YS52YWx1ZSkgPyAnID0gJyArIG5vZGUuZGF0YS52YWx1ZSA6ICcnKSk7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gbGluZXMuam9pbigiXG4iKTsNCiAgICAgIH07DQoNCiAgICAgIERJUlRyZWUucHJvdG90eXBlLnRvWE1MID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgbGluZXMgPSBbXTsNCg0KICAgICAgICAoZnVuY3Rpb24gd2Fsa0Rvd25YTUwobm9kZSkgew0KICAgICAgICAgIHZhciBpbmRlbnRhdGlvbiA9ICcnDQogICAgICAgICAgdmFyIGk7DQogICAgICAgICAgdmFyIG5vZGVOYW1lID0gbm9kZS5kYXRhLm5hbWUucmVwbGFjZSgvXC8vZywgJycpOw0KDQogICAgICAgICAgZm9yIChpID0gMDsgaSA8IG5vZGUuZGVwdGg7IGkrKykgew0KICAgICAgICAgICAgaW5kZW50YXRpb24gKz0gJyAgJzsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpZiAobm9kZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBsaW5lcy5wdXNoKGluZGVudGF0aW9uICsgIjwiICsgbm9kZU5hbWUgKyAiPiIpOw0KICAgICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBub2RlLmNoaWxkcmVuLmxlbmd0aDsgYysrKSB7DQogICAgICAgICAgICAgIHdhbGtEb3duWE1MKG5vZGUuY2hpbGRyZW5bY10pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbGluZXMucHVzaChpbmRlbnRhdGlvbiArICI8LyIgKyBub2RlTmFtZSArICI+Iik7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGxpbmVzLnB1c2goaW5kZW50YXRpb24gKyAiPCIgKyBub2RlTmFtZSArICI+IiArIG5vZGUuZGF0YS52YWx1ZSArICI8LyIgKyBub2RlTmFtZSArICI+Iik7DQogICAgICAgICAgfQ0KDQogICAgICAgIH0pKHRoaXMpOw0KICAgICAgICByZXR1cm4gbGluZXMuam9pbigiXG4iKTsNCiAgICAgIH07DQoNCiAgICAgIERJUlRyZWUucHJvdG90eXBlLnRyYXZlcnNlRG93biA9IGZ1bmN0aW9uIChpdGVyYXRvcikgew0KICAgICAgICBfdHJhdmVyc2UodGhpcywgaXRlcmF0b3IsIF90cmF2ZXJzZURvd24pOw0KICAgICAgfTsNCg0KICAgICAgLyoqKioqKioqKiB0cmVlICoqKioqKioqKioqKioqKi8NCg0KICAgICAgZnVuY3Rpb24gZ2V0VmFyaWFibGVMZW5ndGhTdHJpbmcoZGlyUmVzcG9uc2UpIHsNCiAgICAgICAgdmFyIGZpcnN0Q2hhciA9IGRpclJlc3BvbnNlLnJlYWQoMSk7DQogICAgICAgIHZhciByZWFkTGVuZ3RoID0gcGFyc2VJbnQoZmlyc3RDaGFyKTsNCiAgICAgICAgaWYgKCFpc05hTihyZWFkTGVuZ3RoKSkgew0KICAgICAgICAgIHJldHVybiBkaXJSZXNwb25zZS5yZWFkKHJlYWRMZW5ndGgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiBmaXJzdENoYXI7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHZhciBnZXRTZWN0aW9uVHlwZUNvZGUgPSBnZXRWYXJpYWJsZUxlbmd0aFN0cmluZzsNCg0KICAgICAgZnVuY3Rpb24gZ2V0VmFyaWFibGVMZW5ndGhOdW1iZXIoZGlyUmVzcG9uc2UpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlSW50KGdldFZhcmlhYmxlTGVuZ3RoU3RyaW5nKGRpclJlc3BvbnNlKSk7DQogICAgICB9DQogICAgICB2YXIgZ2V0U2VjdGlvbkxlbmd0aCA9IGdldFZhcmlhYmxlTGVuZ3RoTnVtYmVyOw0KICAgICAgdmFyIGdldEVsZW1lbnRDb3VudCA9IGdldFZhcmlhYmxlTGVuZ3RoTnVtYmVyOw0KDQogICAgICBmdW5jdGlvbiBwYXJzZURJUlNlY3Rpb24obXNnVGV4dCwgcGFyZW50KSB7DQogICAgICAgIGlmIChtc2dUZXh0LnN0YXJ0c1dpdGgoJyonKSB8fCBtc2dUZXh0LnN0YXJ0c1dpdGgoJy4nKSkgew0KICAgICAgICAgIC8vIG11bHRpcGxlIGl0ZW0gc2VjdGlvbiAob3Igc3Vic2VjdGlvbikNCiAgICAgICAgICB2YXIgYXJyYXlUeXBlID0gbXNnVGV4dC5yZWFkKDEpOw0KICAgICAgICAgIHZhciBlbGVtZW50Q291bnQgPSBnZXRFbGVtZW50Q291bnQobXNnVGV4dCk7DQogICAgICAgICAgdmFyIHNlY3Rpb25UeXBlID0gZ2V0U2VjdGlvblR5cGVDb2RlKG1zZ1RleHQpOw0KICAgICAgICAgIHZhciBzZWN0aW9uVGV4dCA9IHJpYmJvbihtc2dUZXh0LnJlYWQoZ2V0U2VjdGlvbkxlbmd0aChtc2dUZXh0KSkpOw0KDQogICAgICAgICAgdmFyIG5vZGUgPSBwYXJlbnQuYXBwZW5kQ2hpbGQoeyBuYW1lOiBzZWN0aW9uVHlwZSwgcGF0aDogcGFyZW50LmRhdGEucGF0aCArICcuJyArIHNlY3Rpb25UeXBlIH0pOw0KDQogICAgICAgICAgZm9yICh2YXIgZWxlbWVudENvdW50ZXIgPSAwOyBlbGVtZW50Q291bnRlciA8IGVsZW1lbnRDb3VudDsgZWxlbWVudENvdW50ZXIrKykgew0KICAgICAgICAgICAgcGFyc2VESVJTZWN0aW9uKHNlY3Rpb25UZXh0LCBub2RlKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB2YXIgc2VjdGlvblR5cGUgPSBtc2dUZXh0LnJlYWQoMSkNCiAgICAgICAgICBpZiAoc2VjdGlvblR5cGUgIT0gJz4nICYmIHNlY3Rpb25UeXBlICE9ICcwJykgew0KICAgICAgICAgICAgdmFyIHNlY3Rpb25TdGFydE51bWJlciA9IHBhcnNlSW50KHNlY3Rpb25UeXBlKTsgLy8gaXMgdGhlIHNlY3Rpb24gc3RhcnQgYSBudW1iZXI/ICBpZiBpdCBpcyAtIGl0IGlzbid0IHJlYWxseSB0aGUgc2VjdGlvbiB0eXBlLiAgcmVhZCB0aGUgbnVtYmVyIG9mIGNoYXJhY3RlcnMgaW4gdGhlIHNlY3Rpb24gbnVtYmVyIHRvIGdldCB0aGUgc2VjdGlvbiB0eXBlDQogICAgICAgICAgICBpZiAoIWlzTmFOKHNlY3Rpb25TdGFydE51bWJlcikpIHsNCiAgICAgICAgICAgICAgc2VjdGlvblR5cGUgPSBtc2dUZXh0LnJlYWQoc2VjdGlvblN0YXJ0TnVtYmVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBzZWN0aW9uVGV4dCA9IHJpYmJvbihtc2dUZXh0LnJlYWQoZ2V0U2VjdGlvbkxlbmd0aChtc2dUZXh0KSkpOw0KICAgICAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKHsgbmFtZTogc2VjdGlvblR5cGUsIHZhbHVlOiBzZWN0aW9uVGV4dCwgcGF0aDogcGFyZW50LmRhdGEucGF0aCArICcuJyArIHNlY3Rpb25UeXBlIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBmdW5jdGlvbiBwYXJzZURJUk1lc3NhZ2UoZGlyVGV4dCkgew0KICAgICAgICBkaXJUZXh0ID0gKHR5cGVvZiBkaXJUZXh0ID09PSAnc3RyaW5nJykgPyByaWJib24oZGlyVGV4dCkgOiBkaXJUZXh0Ow0KDQogICAgICAgIHZhciBtc2dUcmVlOw0KDQogICAgICAgIGlmICgvKC4qP1wkXGQrKShcZClbQS1aXSsvLnRlc3QoZGlyVGV4dC50b1N0cmluZygpKSkgew0KICAgICAgICAgIC8vZmluZCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBESVIgZGF0YS4NCiAgICAgICAgICAvL2l0IHdpbGwgbG9vayBzb21ldGhpbmcgbGlrZSB0aGlzOg0KICAgICAgICAgIC8vJDAwMDAwMDAwMDAwMjE2M1BOUjUxMTE3NUgyMzlNMjNBREcNCiAgICAgICAgICBkaXJUZXh0LmFkdmFuY2UoLyguKj9cJFxkKykoXGQpW0EtWl0rLy5leGVjKGRpclRleHQudG9TdHJpbmcoKSlbMV0pOw0KDQogICAgICAgICAgdmFyIHR5cGVMZW5ndGggPSBwYXJzZUludChkaXJUZXh0LnJlYWQoMSkpOw0KICAgICAgICAgIHZhciBtc2dUeXBlID0gZGlyVGV4dC5yZWFkKHR5cGVMZW5ndGgpOw0KDQogICAgICAgICAgLy9ESVJUcmVlIChwYXJlbnQsIGRhdGEsIGlkKQ0KICAgICAgICAgIG1zZ1RyZWUgPSBuZXcgRElSVHJlZShudWxsLCB7IG5hbWU6IG1zZ1R5cGUsIHBhdGg6IG1zZ1R5cGUgfSwgbXNnVHlwZSk7DQoNCiAgICAgICAgICB2YXIgbXNnVGV4dCA9IHJpYmJvbihkaXJUZXh0LnJlYWQoZ2V0U2VjdGlvbkxlbmd0aChkaXJUZXh0KSkpOw0KDQogICAgICAgICAgdmFyIHN0YXJ0TGVuZ3RoID0gbXNnVGV4dC50b1N0cmluZygpLmxlbmd0aDsNCiAgICAgICAgICB3aGlsZSAobXNnVGV4dC50b1N0cmluZygpLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHBhcnNlRElSU2VjdGlvbihtc2dUZXh0LCBtc2dUcmVlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gbXNnVHJlZTsNCiAgICAgIH0NCg0KICAgICAgdmFyIHdzcGFuRElSID0gew0KICAgICAgICBwYXJzZURJUk1lc3NhZ2U6IHBhcnNlRElSTWVzc2FnZQ0KICAgICAgfTsNCg0KICAgICAgLyogZXhwb3NlZCAqLw0KDQogICAgICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHsNCiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSB3c3BhbkRJUjsNCiAgICAgIH0NCiAgICAgIGVsc2Ugew0KICAgICAgICB0aGlzLndzcGFuRElSID0gd3NwYW5ESVI7DQogICAgICB9DQoNCiAgICB9KS5jYWxsKGZ1bmN0aW9uICgpIHsNCiAgICAgIHJldHVybiB0aGlzIHx8ICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IGdsb2JhbCk7DQogICAgfSgpKTsNCiAgPC9zY3JpcHQ+DQogIDwhLS0gc3ludGF4IGhpZ2hsaWdoZXIgLS0+DQogIDxzdHlsZT4NCiAgLyoNCg0KT3JpZ2luYWwgaGlnaGxpZ2h0LmpzIHN0eWxlIChjKSBJdmFuIFNhZ2FsYWV2IDxtYW5pYWNAc29mdHdhcmVtYW5pYWNzLm9yZz4NCg0KKi8NCg0KLmhsanMgew0KICBkaXNwbGF5OiBibG9jazsNCiAgb3ZlcmZsb3cteDogYXV0bzsNCiAgcGFkZGluZzogMC41ZW07DQogIGJhY2tncm91bmQ6ICNGMEYwRjA7DQp9DQoNCg0KLyogQmFzZSBjb2xvcjogc2F0dXJhdGlvbiAwOyAqLw0KDQouaGxqcywNCi5obGpzLXN1YnN0IHsNCiAgY29sb3I6ICM0NDQ7DQp9DQoNCi5obGpzLWNvbW1lbnQgew0KICBjb2xvcjogIzg4ODg4ODsNCn0NCg0KLmhsanMta2V5d29yZCwNCi5obGpzLWF0dHJpYnV0ZSwNCi5obGpzLXNlbGVjdG9yLXRhZywNCi5obGpzLW1ldGEta2V5d29yZCwNCi5obGpzLWRvY3RhZywNCi5obGpzLW5hbWUgew0KICBmb250LXdlaWdodDogYm9sZDsNCn0NCg0KDQovKiBVc2VyIGNvbG9yOiBodWU6IDAgKi8NCg0KLmhsanMtdHlwZSwNCi5obGpzLXN0cmluZywNCi5obGpzLW51bWJlciwNCi5obGpzLXNlbGVjdG9yLWlkLA0KLmhsanMtc2VsZWN0b3ItY2xhc3MsDQouaGxqcy1xdW90ZSwNCi5obGpzLXRlbXBsYXRlLXRhZywNCi5obGpzLWRlbGV0aW9uIHsNCiAgY29sb3I6ICM4ODAwMDA7DQp9DQoNCi5obGpzLXRpdGxlLA0KLmhsanMtc2VjdGlvbiB7DQogIGNvbG9yOiAjODgwMDAwOw0KICBmb250LXdlaWdodDogYm9sZDsNCn0NCg0KLmhsanMtcmVnZXhwLA0KLmhsanMtc3ltYm9sLA0KLmhsanMtdmFyaWFibGUsDQouaGxqcy10ZW1wbGF0ZS12YXJpYWJsZSwNCi5obGpzLWxpbmssDQouaGxqcy1zZWxlY3Rvci1hdHRyLA0KLmhsanMtc2VsZWN0b3ItcHNldWRvIHsNCiAgY29sb3I6ICNCQzYwNjA7DQp9DQoNCg0KLyogTGFuZ3VhZ2UgY29sb3I6IGh1ZTogOTA7ICovDQoNCi5obGpzLWxpdGVyYWwgew0KICBjb2xvcjogIzc4QTk2MDsNCn0NCg0KLmhsanMtYnVpbHRfaW4sDQouaGxqcy1idWxsZXQsDQouaGxqcy1jb2RlLA0KLmhsanMtYWRkaXRpb24gew0KICBjb2xvcjogIzM5NzMwMDsNCn0NCg0KDQovKiBNZXRhIGNvbG9yOiBodWU6IDIwMCAqLw0KDQouaGxqcy1tZXRhIHsNCiAgY29sb3I6ICMxZjcxOTk7DQp9DQoNCi5obGpzLW1ldGEtc3RyaW5nIHsNCiAgY29sb3I6ICM0ZDk5YmY7DQp9DQoNCg0KLyogTWlzYyBlZmZlY3RzICovDQoNCi5obGpzLWVtcGhhc2lzIHsNCiAgZm9udC1zdHlsZTogaXRhbGljOw0KfQ0KDQouaGxqcy1zdHJvbmcgew0KICBmb250LXdlaWdodDogYm9sZDsNCn0NCg0KICA8L3N0eWxlPg0KICA8c2NyaXB0Pg0KICAvKiEgaGlnaGxpZ2h0LmpzIHY5LjEyLjAgfCBCU0QzIExpY2Vuc2UgfCBnaXQuaW8vaGxqc2xpY2Vuc2UgKi8NCgkhZnVuY3Rpb24oZSl7dmFyIG49Im9iamVjdCI9PXR5cGVvZiB3aW5kb3cmJndpbmRvd3x8Im9iamVjdCI9PXR5cGVvZiBzZWxmJiZzZWxmOyJ1bmRlZmluZWQiIT10eXBlb2YgZXhwb3J0cz9lKGV4cG9ydHMpOm4mJihuLmhsanM9ZSh7fSksImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZCYmZGVmaW5lKFtdLGZ1bmN0aW9uKCl7cmV0dXJuIG4uaGxqc30pKX0oZnVuY3Rpb24oZSl7ZnVuY3Rpb24gbihlKXtyZXR1cm4gZS5yZXBsYWNlKC8mL2csIiZhbXA7IikucmVwbGFjZSgvPC9nLCImbHQ7IikucmVwbGFjZSgvPi9nLCImZ3Q7Iil9ZnVuY3Rpb24gdChlKXtyZXR1cm4gZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpfWZ1bmN0aW9uIHIoZSxuKXt2YXIgdD1lJiZlLmV4ZWMobik7cmV0dXJuIHQmJjA9PT10LmluZGV4fWZ1bmN0aW9uIGEoZSl7cmV0dXJuIGsudGVzdChlKX1mdW5jdGlvbiBpKGUpe3ZhciBuLHQscixpLG89ZS5jbGFzc05hbWUrIiAiO2lmKG8rPWUucGFyZW50Tm9kZT9lLnBhcmVudE5vZGUuY2xhc3NOYW1lOiIiLHQ9Qi5leGVjKG8pKXJldHVybiB3KHRbMV0pP3RbMV06Im5vLWhpZ2hsaWdodCI7Zm9yKG89by5zcGxpdCgvXHMrLyksbj0wLHI9by5sZW5ndGg7cj5uO24rKylpZihpPW9bbl0sYShpKXx8dyhpKSlyZXR1cm4gaX1mdW5jdGlvbiBvKGUpe3ZhciBuLHQ9e30scj1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7Zm9yKG4gaW4gZSl0W25dPWVbbl07cmV0dXJuIHIuZm9yRWFjaChmdW5jdGlvbihlKXtmb3IobiBpbiBlKXRbbl09ZVtuXX0pLHR9ZnVuY3Rpb24gdShlKXt2YXIgbj1bXTtyZXR1cm4gZnVuY3Rpb24gcihlLGEpe2Zvcih2YXIgaT1lLmZpcnN0Q2hpbGQ7aTtpPWkubmV4dFNpYmxpbmcpMz09PWkubm9kZVR5cGU/YSs9aS5ub2RlVmFsdWUubGVuZ3RoOjE9PT1pLm5vZGVUeXBlJiYobi5wdXNoKHtldmVudDoic3RhcnQiLG9mZnNldDphLG5vZGU6aX0pLGE9cihpLGEpLHQoaSkubWF0Y2goL2JyfGhyfGltZ3xpbnB1dC8pfHxuLnB1c2goe2V2ZW50OiJzdG9wIixvZmZzZXQ6YSxub2RlOml9KSk7cmV0dXJuIGF9KGUsMCksbn1mdW5jdGlvbiBjKGUscixhKXtmdW5jdGlvbiBpKCl7cmV0dXJuIGUubGVuZ3RoJiZyLmxlbmd0aD9lWzBdLm9mZnNldCE9PXJbMF0ub2Zmc2V0P2VbMF0ub2Zmc2V0PHJbMF0ub2Zmc2V0P2U6cjoic3RhcnQiPT09clswXS5ldmVudD9lOnI6ZS5sZW5ndGg/ZTpyfWZ1bmN0aW9uIG8oZSl7ZnVuY3Rpb24gcihlKXtyZXR1cm4iICIrZS5ub2RlTmFtZSsnPSInK24oZS52YWx1ZSkucmVwbGFjZSgnIicsIiZxdW90OyIpKyciJ31zKz0iPCIrdChlKStFLm1hcC5jYWxsKGUuYXR0cmlidXRlcyxyKS5qb2luKCIiKSsiPiJ9ZnVuY3Rpb24gdShlKXtzKz0iPC8iK3QoZSkrIj4ifWZ1bmN0aW9uIGMoZSl7KCJzdGFydCI9PT1lLmV2ZW50P286dSkoZS5ub2RlKX1mb3IodmFyIGw9MCxzPSIiLGY9W107ZS5sZW5ndGh8fHIubGVuZ3RoOyl7dmFyIGc9aSgpO2lmKHMrPW4oYS5zdWJzdHJpbmcobCxnWzBdLm9mZnNldCkpLGw9Z1swXS5vZmZzZXQsZz09PWUpe2YucmV2ZXJzZSgpLmZvckVhY2godSk7ZG8gYyhnLnNwbGljZSgwLDEpWzBdKSxnPWkoKTt3aGlsZShnPT09ZSYmZy5sZW5ndGgmJmdbMF0ub2Zmc2V0PT09bCk7Zi5yZXZlcnNlKCkuZm9yRWFjaChvKX1lbHNlInN0YXJ0Ij09PWdbMF0uZXZlbnQ/Zi5wdXNoKGdbMF0ubm9kZSk6Zi5wb3AoKSxjKGcuc3BsaWNlKDAsMSlbMF0pfXJldHVybiBzK24oYS5zdWJzdHIobCkpfWZ1bmN0aW9uIGwoZSl7cmV0dXJuIGUudiYmIWUuY2FjaGVkX3ZhcmlhbnRzJiYoZS5jYWNoZWRfdmFyaWFudHM9ZS52Lm1hcChmdW5jdGlvbihuKXtyZXR1cm4gbyhlLHt2Om51bGx9LG4pfSkpLGUuY2FjaGVkX3ZhcmlhbnRzfHxlLmVXJiZbbyhlKV18fFtlXX1mdW5jdGlvbiBzKGUpe2Z1bmN0aW9uIG4oZSl7cmV0dXJuIGUmJmUuc291cmNlfHxlfWZ1bmN0aW9uIHQodCxyKXtyZXR1cm4gbmV3IFJlZ0V4cChuKHQpLCJtIisoZS5jST8iaSI6IiIpKyhyPyJnIjoiIikpfWZ1bmN0aW9uIHIoYSxpKXtpZighYS5jb21waWxlZCl7aWYoYS5jb21waWxlZD0hMCxhLms9YS5rfHxhLmJLLGEuayl7dmFyIG89e30sdT1mdW5jdGlvbihuLHQpe2UuY0kmJih0PXQudG9Mb3dlckNhc2UoKSksdC5zcGxpdCgiICIpLmZvckVhY2goZnVuY3Rpb24oZSl7dmFyIHQ9ZS5zcGxpdCgifCIpO29bdFswXV09W24sdFsxXT9OdW1iZXIodFsxXSk6MV19KX07InN0cmluZyI9PXR5cGVvZiBhLms/dSgia2V5d29yZCIsYS5rKTp4KGEuaykuZm9yRWFjaChmdW5jdGlvbihlKXt1KGUsYS5rW2VdKX0pLGEuaz1vfWEubFI9dChhLmx8fC9cdysvLCEwKSxpJiYoYS5iSyYmKGEuYj0iXFxiKCIrYS5iSy5zcGxpdCgiICIpLmpvaW4oInwiKSsiKVxcYiIpLGEuYnx8KGEuYj0vXEJ8XGIvKSxhLmJSPXQoYS5iKSxhLmV8fGEuZVd8fChhLmU9L1xCfFxiLyksYS5lJiYoYS5lUj10KGEuZSkpLGEudEU9bihhLmUpfHwiIixhLmVXJiZpLnRFJiYoYS50RSs9KGEuZT8ifCI6IiIpK2kudEUpKSxhLmkmJihhLmlSPXQoYS5pKSksbnVsbD09YS5yJiYoYS5yPTEpLGEuY3x8KGEuYz1bXSksYS5jPUFycmF5LnByb3RvdHlwZS5jb25jYXQuYXBwbHkoW10sYS5jLm1hcChmdW5jdGlvbihlKXtyZXR1cm4gbCgic2VsZiI9PT1lP2E6ZSl9KSksYS5jLmZvckVhY2goZnVuY3Rpb24oZSl7cihlLGEpfSksYS5zdGFydHMmJnIoYS5zdGFydHMsaSk7dmFyIGM9YS5jLm1hcChmdW5jdGlvbihlKXtyZXR1cm4gZS5iSz8iXFwuPygiK2UuYisiKVxcLj8iOmUuYn0pLmNvbmNhdChbYS50RSxhLmldKS5tYXAobikuZmlsdGVyKEJvb2xlYW4pO2EudD1jLmxlbmd0aD90KGMuam9pbigifCIpLCEwKTp7ZXhlYzpmdW5jdGlvbigpe3JldHVybiBudWxsfX19fXIoZSl9ZnVuY3Rpb24gZihlLHQsYSxpKXtmdW5jdGlvbiBvKGUsbil7dmFyIHQsYTtmb3IodD0wLGE9bi5jLmxlbmd0aDthPnQ7dCsrKWlmKHIobi5jW3RdLmJSLGUpKXJldHVybiBuLmNbdF19ZnVuY3Rpb24gdShlLG4pe2lmKHIoZS5lUixuKSl7Zm9yKDtlLmVuZHNQYXJlbnQmJmUucGFyZW50OyllPWUucGFyZW50O3JldHVybiBlfXJldHVybiBlLmVXP3UoZS5wYXJlbnQsbik6dm9pZCAwfWZ1bmN0aW9uIGMoZSxuKXtyZXR1cm4hYSYmcihuLmlSLGUpfWZ1bmN0aW9uIGwoZSxuKXt2YXIgdD1OLmNJP25bMF0udG9Mb3dlckNhc2UoKTpuWzBdO3JldHVybiBlLmsuaGFzT3duUHJvcGVydHkodCkmJmUua1t0XX1mdW5jdGlvbiBwKGUsbix0LHIpe3ZhciBhPXI/IiI6SS5jbGFzc1ByZWZpeCxpPSc8c3BhbiBjbGFzcz0iJythLG89dD8iIjpDO3JldHVybiBpKz1lKyciPicsaStuK299ZnVuY3Rpb24gaCgpe3ZhciBlLHQscixhO2lmKCFFLmspcmV0dXJuIG4oayk7Zm9yKGE9IiIsdD0wLEUubFIubGFzdEluZGV4PTAscj1FLmxSLmV4ZWMoayk7cjspYSs9bihrLnN1YnN0cmluZyh0LHIuaW5kZXgpKSxlPWwoRSxyKSxlPyhCKz1lWzFdLGErPXAoZVswXSxuKHJbMF0pKSk6YSs9bihyWzBdKSx0PUUubFIubGFzdEluZGV4LHI9RS5sUi5leGVjKGspO3JldHVybiBhK24oay5zdWJzdHIodCkpfWZ1bmN0aW9uIGQoKXt2YXIgZT0ic3RyaW5nIj09dHlwZW9mIEUuc0w7aWYoZSYmIXlbRS5zTF0pcmV0dXJuIG4oayk7dmFyIHQ9ZT9mKEUuc0wsaywhMCx4W0Uuc0xdKTpnKGssRS5zTC5sZW5ndGg/RS5zTDp2b2lkIDApO3JldHVybiBFLnI+MCYmKEIrPXQuciksZSYmKHhbRS5zTF09dC50b3ApLHAodC5sYW5ndWFnZSx0LnZhbHVlLCExLCEwKX1mdW5jdGlvbiBiKCl7TCs9bnVsbCE9RS5zTD9kKCk6aCgpLGs9IiJ9ZnVuY3Rpb24gdihlKXtMKz1lLmNOP3AoZS5jTiwiIiwhMCk6IiIsRT1PYmplY3QuY3JlYXRlKGUse3BhcmVudDp7dmFsdWU6RX19KX1mdW5jdGlvbiBtKGUsbil7aWYoays9ZSxudWxsPT1uKXJldHVybiBiKCksMDt2YXIgdD1vKG4sRSk7aWYodClyZXR1cm4gdC5za2lwP2srPW46KHQuZUImJihrKz1uKSxiKCksdC5yQnx8dC5lQnx8KGs9bikpLHYodCxuKSx0LnJCPzA6bi5sZW5ndGg7dmFyIHI9dShFLG4pO2lmKHIpe3ZhciBhPUU7YS5za2lwP2srPW46KGEuckV8fGEuZUV8fChrKz1uKSxiKCksYS5lRSYmKGs9bikpO2RvIEUuY04mJihMKz1DKSxFLnNraXB8fChCKz1FLnIpLEU9RS5wYXJlbnQ7d2hpbGUoRSE9PXIucGFyZW50KTtyZXR1cm4gci5zdGFydHMmJnYoci5zdGFydHMsIiIpLGEuckU/MDpuLmxlbmd0aH1pZihjKG4sRSkpdGhyb3cgbmV3IEVycm9yKCdJbGxlZ2FsIGxleGVtZSAiJytuKyciIGZvciBtb2RlICInKyhFLmNOfHwiPHVubmFtZWQ+IikrJyInKTtyZXR1cm4gays9bixuLmxlbmd0aHx8MX12YXIgTj13KGUpO2lmKCFOKXRocm93IG5ldyBFcnJvcignVW5rbm93biBsYW5ndWFnZTogIicrZSsnIicpO3MoTik7dmFyIFIsRT1pfHxOLHg9e30sTD0iIjtmb3IoUj1FO1IhPT1OO1I9Ui5wYXJlbnQpUi5jTiYmKEw9cChSLmNOLCIiLCEwKStMKTt2YXIgaz0iIixCPTA7dHJ5e2Zvcih2YXIgTSxqLE89MDs7KXtpZihFLnQubGFzdEluZGV4PU8sTT1FLnQuZXhlYyh0KSwhTSlicmVhaztqPW0odC5zdWJzdHJpbmcoTyxNLmluZGV4KSxNWzBdKSxPPU0uaW5kZXgran1mb3IobSh0LnN1YnN0cihPKSksUj1FO1IucGFyZW50O1I9Ui5wYXJlbnQpUi5jTiYmKEwrPUMpO3JldHVybntyOkIsdmFsdWU6TCxsYW5ndWFnZTplLHRvcDpFfX1jYXRjaChUKXtpZihULm1lc3NhZ2UmJi0xIT09VC5tZXNzYWdlLmluZGV4T2YoIklsbGVnYWwiKSlyZXR1cm57cjowLHZhbHVlOm4odCl9O3Rocm93IFR9fWZ1bmN0aW9uIGcoZSx0KXt0PXR8fEkubGFuZ3VhZ2VzfHx4KHkpO3ZhciByPXtyOjAsdmFsdWU6bihlKX0sYT1yO3JldHVybiB0LmZpbHRlcih3KS5mb3JFYWNoKGZ1bmN0aW9uKG4pe3ZhciB0PWYobixlLCExKTt0Lmxhbmd1YWdlPW4sdC5yPmEuciYmKGE9dCksdC5yPnIuciYmKGE9cixyPXQpfSksYS5sYW5ndWFnZSYmKHIuc2Vjb25kX2Jlc3Q9YSkscn1mdW5jdGlvbiBwKGUpe3JldHVybiBJLnRhYlJlcGxhY2V8fEkudXNlQlI/ZS5yZXBsYWNlKE0sZnVuY3Rpb24oZSxuKXtyZXR1cm4gSS51c2VCUiYmIlxuIj09PWU/Ijxicj4iOkkudGFiUmVwbGFjZT9uLnJlcGxhY2UoL1x0L2csSS50YWJSZXBsYWNlKToiIn0pOmV9ZnVuY3Rpb24gaChlLG4sdCl7dmFyIHI9bj9MW25dOnQsYT1bZS50cmltKCldO3JldHVybiBlLm1hdGNoKC9cYmhsanNcYi8pfHxhLnB1c2goImhsanMiKSwtMT09PWUuaW5kZXhPZihyKSYmYS5wdXNoKHIpLGEuam9pbigiICIpLnRyaW0oKX1mdW5jdGlvbiBkKGUpe3ZhciBuLHQscixvLGwscz1pKGUpO2Eocyl8fChJLnVzZUJSPyhuPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIsImRpdiIpLG4uaW5uZXJIVE1MPWUuaW5uZXJIVE1MLnJlcGxhY2UoL1xuL2csIiIpLnJlcGxhY2UoLzxiclsgXC9dKj4vZywiXG4iKSk6bj1lLGw9bi50ZXh0Q29udGVudCxyPXM/ZihzLGwsITApOmcobCksdD11KG4pLHQubGVuZ3RoJiYobz1kb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiLCJkaXYiKSxvLmlubmVySFRNTD1yLnZhbHVlLHIudmFsdWU9Yyh0LHUobyksbCkpLHIudmFsdWU9cChyLnZhbHVlKSxlLmlubmVySFRNTD1yLnZhbHVlLGUuY2xhc3NOYW1lPWgoZS5jbGFzc05hbWUscyxyLmxhbmd1YWdlKSxlLnJlc3VsdD17bGFuZ3VhZ2U6ci5sYW5ndWFnZSxyZTpyLnJ9LHIuc2Vjb25kX2Jlc3QmJihlLnNlY29uZF9iZXN0PXtsYW5ndWFnZTpyLnNlY29uZF9iZXN0Lmxhbmd1YWdlLHJlOnIuc2Vjb25kX2Jlc3Qucn0pKX1mdW5jdGlvbiBiKGUpe0k9byhJLGUpfWZ1bmN0aW9uIHYoKXtpZighdi5jYWxsZWQpe3YuY2FsbGVkPSEwO3ZhciBlPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoInByZSBjb2RlIik7RS5mb3JFYWNoLmNhbGwoZSxkKX19ZnVuY3Rpb24gbSgpe2FkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLHYsITEpLGFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLHYsITEpfWZ1bmN0aW9uIE4obix0KXt2YXIgcj15W25dPXQoZSk7ci5hbGlhc2VzJiZyLmFsaWFzZXMuZm9yRWFjaChmdW5jdGlvbihlKXtMW2VdPW59KX1mdW5jdGlvbiBSKCl7cmV0dXJuIHgoeSl9ZnVuY3Rpb24gdyhlKXtyZXR1cm4gZT0oZXx8IiIpLnRvTG93ZXJDYXNlKCkseVtlXXx8eVtMW2VdXX12YXIgRT1bXSx4PU9iamVjdC5rZXlzLHk9e30sTD17fSxrPS9eKG5vLT9oaWdobGlnaHR8cGxhaW58dGV4dCkkL2ksQj0vXGJsYW5nKD86dWFnZSk/LShbXHctXSspXGIvaSxNPS8oKF4oPFtePl0rPnxcdHwpK3woPzpcbikpKS9nbSxDPSI8L3NwYW4+IixJPXtjbGFzc1ByZWZpeDoiaGxqcy0iLHRhYlJlcGxhY2U6bnVsbCx1c2VCUjohMSxsYW5ndWFnZXM6dm9pZCAwfTtyZXR1cm4gZS5oaWdobGlnaHQ9ZixlLmhpZ2hsaWdodEF1dG89ZyxlLmZpeE1hcmt1cD1wLGUuaGlnaGxpZ2h0QmxvY2s9ZCxlLmNvbmZpZ3VyZT1iLGUuaW5pdEhpZ2hsaWdodGluZz12LGUuaW5pdEhpZ2hsaWdodGluZ09uTG9hZD1tLGUucmVnaXN0ZXJMYW5ndWFnZT1OLGUubGlzdExhbmd1YWdlcz1SLGUuZ2V0TGFuZ3VhZ2U9dyxlLmluaGVyaXQ9byxlLklSPSJbYS16QS1aXVxcdyoiLGUuVUlSPSJbYS16QS1aX11cXHcqIixlLk5SPSJcXGJcXGQrKFxcLlxcZCspPyIsZS5DTlI9IigtPykoXFxiMFt4WF1bYS1mQS1GMC05XSt8KFxcYlxcZCsoXFwuXFxkKik/fFxcLlxcZCspKFtlRV1bLStdP1xcZCspPykiLGUuQk5SPSJcXGIoMGJbMDFdKykiLGUuUlNSPSIhfCE9fCE9PXwlfCU9fCZ8JiZ8Jj18XFwqfFxcKj18XFwrfFxcKz18LHwtfC09fC89fC98Onw7fDw8fDw8PXw8PXw8fD09PXw9PXw9fD4+Pj18Pj49fD49fD4+Pnw+Pnw+fFxcP3xcXFt8XFx7fFxcKHxcXF58XFxePXxcXHx8XFx8PXxcXHxcXHx8fiIsZS5CRT17YjoiXFxcXFtcXHNcXFNdIixyOjB9LGUuQVNNPXtjTjoic3RyaW5nIixiOiInIixlOiInIixpOiJcXG4iLGM6W2UuQkVdfSxlLlFTTT17Y046InN0cmluZyIsYjonIicsZTonIicsaToiXFxuIixjOltlLkJFXX0sZS5QV009e2I6L1xiKGF8YW58dGhlfGFyZXxJJ218aXNuJ3R8ZG9uJ3R8ZG9lc24ndHx3b24ndHxidXR8anVzdHxzaG91bGR8cHJldHR5fHNpbXBseXxlbm91Z2h8Z29ubmF8Z29pbmd8d3RmfHNvfHN1Y2h8d2lsbHx5b3V8eW91cnx0aGV5fGxpa2V8bW9yZSlcYi99LGUuQz1mdW5jdGlvbihuLHQscil7dmFyIGE9ZS5pbmhlcml0KHtjTjoiY29tbWVudCIsYjpuLGU6dCxjOltdfSxyfHx7fSk7cmV0dXJuIGEuYy5wdXNoKGUuUFdNKSxhLmMucHVzaCh7Y046ImRvY3RhZyIsYjoiKD86VE9ET3xGSVhNRXxOT1RFfEJVR3xYWFgpOiIscjowfSksYX0sZS5DTENNPWUuQygiLy8iLCIkIiksZS5DQkNNPWUuQygiL1xcKiIsIlxcKi8iKSxlLkhDTT1lLkMoIiMiLCIkIiksZS5OTT17Y046Im51bWJlciIsYjplLk5SLHI6MH0sZS5DTk09e2NOOiJudW1iZXIiLGI6ZS5DTlIscjowfSxlLkJOTT17Y046Im51bWJlciIsYjplLkJOUixyOjB9LGUuQ1NTTk09e2NOOiJudW1iZXIiLGI6ZS5OUisiKCV8ZW18ZXh8Y2h8cmVtfHZ3fHZofHZtaW58dm1heHxjbXxtbXxpbnxwdHxwY3xweHxkZWd8Z3JhZHxyYWR8dHVybnxzfG1zfEh6fGtIenxkcGl8ZHBjbXxkcHB4KT8iLHI6MH0sZS5STT17Y046InJlZ2V4cCIsYjovXC8vLGU6L1wvW2dpbXV5XSovLGk6L1xuLyxjOltlLkJFLHtiOi9cWy8sZTovXF0vLHI6MCxjOltlLkJFXX1dfSxlLlRNPXtjTjoidGl0bGUiLGI6ZS5JUixyOjB9LGUuVVRNPXtjTjoidGl0bGUiLGI6ZS5VSVIscjowfSxlLk1FVEhPRF9HVUFSRD17YjoiXFwuXFxzKiIrZS5VSVIscjowfSxlfSk7aGxqcy5yZWdpc3Rlckxhbmd1YWdlKCJqc29uIixmdW5jdGlvbihlKXt2YXIgaT17bGl0ZXJhbDoidHJ1ZSBmYWxzZSBudWxsIn0sbj1bZS5RU00sZS5DTk1dLHI9e2U6IiwiLGVXOiEwLGVFOiEwLGM6bixrOml9LHQ9e2I6InsiLGU6In0iLGM6W3tjTjoiYXR0ciIsYjovIi8sZTovIi8sYzpbZS5CRV0saToiXFxuIn0sZS5pbmhlcml0KHIse2I6LzovfSldLGk6IlxcUyJ9LGM9e2I6IlxcWyIsZToiXFxdIixjOltlLmluaGVyaXQocildLGk6IlxcUyJ9O3JldHVybiBuLnNwbGljZShuLmxlbmd0aCwwLHQsYykse2M6bixrOmksaToiXFxTIn19KTtobGpzLnJlZ2lzdGVyTGFuZ3VhZ2UoInhtbCIsZnVuY3Rpb24ocyl7dmFyIGU9IltBLVphLXowLTlcXC5fOi1dKyIsdD17ZVc6ITAsaTovPC8scjowLGM6W3tjTjoiYXR0ciIsYjplLHI6MH0se2I6Lz1ccyovLHI6MCxjOlt7Y046InN0cmluZyIsZW5kc1BhcmVudDohMCx2Olt7YjovIi8sZTovIi99LHtiOi8nLyxlOi8nL30se2I6L1teXHMiJz08PmBdKy99XX1dfV19O3JldHVybnthbGlhc2VzOlsiaHRtbCIsInhodG1sIiwicnNzIiwiYXRvbSIsInhqYiIsInhzZCIsInhzbCIsInBsaXN0Il0sY0k6ITAsYzpbe2NOOiJtZXRhIixiOiI8IURPQ1RZUEUiLGU6Ij4iLHI6MTAsYzpbe2I6IlxcWyIsZToiXFxdIn1dfSxzLkMoIjwhLS0iLCItLT4iLHtyOjEwfSkse2I6IjxcXCFcXFtDREFUQVxcWyIsZToiXFxdXFxdPiIscjoxMH0se2I6LzxcPyhwaHApPy8sZTovXD8+LyxzTDoicGhwIixjOlt7YjoiL1xcKiIsZToiXFwqLyIsc2tpcDohMH1dfSx7Y046InRhZyIsYjoiPHN0eWxlKD89XFxzfD58JCkiLGU6Ij4iLGs6e25hbWU6InN0eWxlIn0sYzpbdF0sc3RhcnRzOntlOiI8L3N0eWxlPiIsckU6ITAsc0w6WyJjc3MiLCJ4bWwiXX19LHtjTjoidGFnIixiOiI8c2NyaXB0KD89XFxzfD58JCkiLGU6Ij4iLGs6e25hbWU6InNjcmlwdCJ9LGM6W3RdLHN0YXJ0czp7ZToiPCIrIi9zY3JpcHQ+IixyRTohMCxzTDpbImFjdGlvbnNjcmlwdCIsImphdmFzY3JpcHQiLCJoYW5kbGViYXJzIiwieG1sIl19fSx7Y046Im1ldGEiLHY6W3tiOi88XD94bWwvLGU6L1w/Pi8scjoxMH0se2I6LzxcP1x3Ky8sZTovXD8+L31dfSx7Y046InRhZyIsYjoiPC8/IixlOiIvPz4iLGM6W3tjTjoibmFtZSIsYjovW15cLz48XHNdKy8scjowfSx0XX1dfX0pOw0KICA8L3NjcmlwdD4NCjwvaGVhZD4NCg0KPGJvZHk+DQogIDxkaXYgaWQ9ImlucHV0ZGl2IiBzdHlsZT0id2lkdGg6MTAwJTsgbWFyZ2luOiAwIGF1dG87IHBhZGRpbmc6IDAgMCAxMHB4OyI+DQogICAgPHVsIGNsYXNzPSJ0YWJzIiBkYXRhLXBlcnNpc3Q9InRydWUiIGlkPSJ0YWJzbGlzdCI+DQogICAgICA8bGkgaWQ9InRhYjEiPg0KICAgICAgICA8YSBpZD0idGFiMWxpbmsiIGhyZWY9IiNzZWFyY2h2aWV3Ij5TZWFyY2g8L2E+DQogICAgICA8L2xpPg0KICAgICAgPGxpIGlkPSJ0YWIyIj4NCiAgICAgICAgPGEgaWQ9InRhYjJsaW5rIiBocmVmPSIjZmlsdGVydmlldyI+RmlsdGVyPC9hPg0KICAgICAgPC9saT4NCiAgICAgIDxsaSBpZD0idGFiMyI+DQogICAgICAgIDxhIGlkPSJ0YWIzbGluayIgaHJlZj0iI3NldHRpbmdzdmlldyI+U2V0dGluZ3M8L2E+DQogICAgICA8L2xpPg0KICAgICAgPGxpIGlkPSJ0YWI0Ij4NCiAgICAgICAgPGEgaWQ9InRhYjRsaW5rIiBocmVmPSIjaW5mb3ZpZXciPkluZm88L2E+DQogICAgICA8L2xpPg0KICAgIDwvdWw+DQogICAgPGRpdiBjbGFzcz0idGFiY29udGVudHMiPg0KICAgICAgPGRpdiBpZD0ic2VhcmNodmlldyI+DQogICAgICAgIDxmb3JtIGlkPSJzZWFyY2giPg0KICAgICAgICAgIDxkaXYgY2xhc3M9InN0cmluZyBpbnB1dCBvcHRpb25hbCBzdHJpbmdpc2ggc2VhcmNoX2Zvcm1fZmllbGQgc2VhcmNoX3N0cmluZyIgaWQ9InFfc2VhcmNoX2lucHV0Ij4NCiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfc2VhcmNoIiBjbGFzcz0ibGFiZWwiPlNlYXJjaDo8L2xhYmVsPg0KICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJzZWFyY2giIHBsYWNlaG9sZGVyPSJTZWFyY2ggbG9nIiBuYW1lPSJxW3NlYXJjaF0iIGlkPSJxX3NlYXJjaCIgLz4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWxlY3QgaW5wdXQgb3B0aW9uYWwgc2VhcmNoX2Zvcm1fZmllbGQgc2VhcmNoX3NlbGVjdCIgaWQ9InFfY29sdW1uX2lucHV0Ij4NCiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfY29sdW1uIiBjbGFzcz0ibGFiZWwiPkNvbHVtbihzKTo8L2xhYmVsPg0KICAgICAgICAgICAgPHNlbGVjdCBuYW1lPSJxW2NvbHVtbl0iIGlkPSJxX2NvbHVtbiIgbXVsdGlwbGU9Im11bHRpcGxlIiBzaXplPSI1Ij4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ibGluZU51bWJlciI+TGluZTwvb3B0aW9uPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJ3b3JrZXIiPldvcmtlcjwvb3B0aW9uPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJ3b3Jrc3RhdGlvbiI+V29ya3N0YXRpb248L29wdGlvbj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0id29ya2Zsb3ciPldvcmtmbG93PC9vcHRpb24+DQogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9InByb2Nlc3MiPlByb2Nlc3M8L29wdGlvbj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0icm91dGluZSI+Um91dGluZTwvb3B0aW9uPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJwbnJMb2NhdG9yIj5Mb2NhdG9yPC9vcHRpb24+DQogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImNhdGVnb3J5Ij5DYXRlZ29yeTwvb3B0aW9uPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJsZXZlbCI+TGV2ZWw8L29wdGlvbj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iZGF0ZVRpbWVUZXh0Ij5EYXRlL1RpbWU8L29wdGlvbj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0idGV4dCI+VGV4dDwvb3B0aW9uPg0KICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0iYnV0dG9ucyI+DQogICAgICAgICAgICA8aW5wdXQgbmFtZT0iYXBwbHlfc2VhcmNoX2J0biIgaWQ9ImFwcGx5X3NlYXJjaF9idG4iIGNsYXNzPSJzdWJtaXRfYnRuIiB0eXBlPSJzdWJtaXQiIHZhbHVlPSJTZWFyY2giIC8+DQogICAgICAgICAgICA8aW5wdXQgbmFtZT0iY2xlYXJfc2VhcmNoX2J0biIgaWQ9ImNsZWFyX3NlYXJjaF9idG4iIGNsYXNzPSJyZXNldF9idG4iIHR5cGU9ImJ1dHRvbiIgdmFsdWU9IkNsZWFyIiAvPg0KICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Zvcm0+DQogICAgICA8L2Rpdj4NCiAgICAgIDxkaXYgaWQ9ImZpbHRlcnZpZXciPg0KICAgICAgICA8Zm9ybSBpZD0iZmlsdGVyIj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJudW1iZXJfcmFuZ2UgaW5wdXQgb3B0aW9uYWwgZmlsdGVyX2Zvcm1fZmllbGQgZmlsdGVyX251bWJlcl9yYW5nZSIgaWQ9InFfbGluZV9udW1iZXJfaW5wdXQiPg0KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJsYWJlbCI+TGluZTwvbGFiZWw+DQogICAgICAgICAgICA8aW5wdXQgc2l6ZT0iMTIiIG1heGxlbmd0aD0iMTAiIHBsYWNlaG9sZGVyPSJGcm9tIiB2YWx1ZT0iIiB0eXBlPSJudW1iZXIiIG5hbWU9InFbbGluZV9udW1iZXJfZ3RlcV0iDQogICAgICAgICAgICAgIGlkPSJxX2xpbmVfbnVtYmVyX2d0ZXEiPg0KICAgICAgICAgICAgPGlucHV0IHNpemU9IjEyIiBtYXhsZW5ndGg9IjEwIiBwbGFjZWhvbGRlcj0iVG8iIHZhbHVlPSIiIHR5cGU9Im51bWJlciIgbmFtZT0icVtsaW5lX251bWJlcl9sdGVxXSINCiAgICAgICAgICAgICAgaWQ9InFfbGluZV9udW1iZXJfbHRlcSI+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0ic2VsZWN0IGlucHV0IG9wdGlvbmFsIGZpbHRlcl9mb3JtX2ZpZWxkIGZpbHRlcl9zZWxlY3QiIGlkPSJxX3dvcmtlcl9pbnB1dCI+DQogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX3dvcmtlciIgY2xhc3M9ImxhYmVsIj5Xb3JrZXI6PC9sYWJlbD4NCiAgICAgICAgICAgIDxzZWxlY3QgbmFtZT0icVt3b3JrZXJfZXFdIiBpZD0icV93b3JrZXIiPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJBbGwiPkFsbDwvb3B0aW9uPg0KICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0ic2VsZWN0IGlucHV0IG9wdGlvbmFsIGZpbHRlcl9mb3JtX2ZpZWxkIGZpbHRlcl9zZWxlY3QiIGlkPSJxX3dvcmtzdGF0aW9uX2lucHV0Ij4NCiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfd29ya3N0YXRpb24iIGNsYXNzPSJsYWJlbCI+V29ya3N0YXRpb246PC9sYWJlbD4NCiAgICAgICAgICAgIDxzZWxlY3QgbmFtZT0icVt3b3Jrc3RhdGlvbl9lcV0iIGlkPSJxX3dvcmtzdGF0aW9uIj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQWxsIj5BbGw8L29wdGlvbj4NCiAgICAgICAgICAgIDwvc2VsZWN0Pg0KICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgIDxkaXYgY2xhc3M9InNlbGVjdCBpbnB1dCBvcHRpb25hbCBmaWx0ZXJfZm9ybV9maWVsZCBmaWx0ZXJfc2VsZWN0IiBpZD0icV93b3JrZmxvd19pbnB1dCI+DQogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX3dvcmtmbG93IiBjbGFzcz0ibGFiZWwiPldvcmtmbG93OjwvbGFiZWw+DQogICAgICAgICAgICA8c2VsZWN0IG5hbWU9InFbd29ya2Zsb3dfZXFdIiBpZD0icV93b3JrZmxvdyI+DQogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkFsbCI+QWxsPC9vcHRpb24+DQogICAgICAgICAgICA8L3NlbGVjdD4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWxlY3QgaW5wdXQgb3B0aW9uYWwgZmlsdGVyX2Zvcm1fZmllbGQgZmlsdGVyX3NlbGVjdCIgaWQ9InFfcHJvY2Vzc19pbnB1dCI+DQogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX3Byb2Nlc3MiIGNsYXNzPSJsYWJlbCI+UHJvY2Vzczo8L2xhYmVsPg0KICAgICAgICAgICAgPHNlbGVjdCBuYW1lPSJxW3Byb2Nlc3NfZXFdIiBpZD0icV9wcm9jZXNzIj4NCiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQWxsIj5BbGw8L29wdGlvbj4NCiAgICAgICAgICAgIDwvc2VsZWN0Pg0KICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgIDxkaXYgY2xhc3M9InNlbGVjdCBpbnB1dCBvcHRpb25hbCBmaWx0ZXJfZm9ybV9maWVsZCBmaWx0ZXJfc2VsZWN0IiBpZD0icV9jYXRlZ29yeV9pbnB1dCI+DQogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX2NhdGVnb3J5IiBjbGFzcz0ibGFiZWwiPkNhdGVnb3J5OjwvbGFiZWw+DQogICAgICAgICAgICA8c2VsZWN0IG5hbWU9InFbY2F0ZWdvcnlfZXFdIiBpZD0icV9jYXRlZ29yeSI+DQogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkFsbCI+QWxsPC9vcHRpb24+DQogICAgICAgICAgICA8L3NlbGVjdD4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWxlY3QgaW5wdXQgb3B0aW9uYWwgZmlsdGVyX2Zvcm1fZmllbGQgZmlsdGVyX3NlbGVjdCIgaWQ9InFfbGV2ZWxfaW5wdXQiPg0KICAgICAgICAgICAgPGxhYmVsIGZvcj0icV9sZXZlbCIgY2xhc3M9ImxhYmVsIj5MZXZlbDo8L2xhYmVsPg0KICAgICAgICAgICAgPHNlbGVjdCBuYW1lPSJxW2xldmVsX2VxXSIgaWQ9InFfbGV2ZWwiPg0KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJBbGwiPkFsbDwvb3B0aW9uPg0KICAgICAgICAgICAgPC9zZWxlY3Q+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0iZGF0ZV9yYW5nZSBpbnB1dCBvcHRpb25hbCBmaWx0ZXJfZm9ybV9maWVsZCBmaWx0ZXJfZGF0ZV9yYW5nZSIgaWQ9InFfZGF0ZV90aW1lX2lucHV0Ij4NCiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ibGFiZWwiPkRhdGUvVGltZTo8L2xhYmVsPg0KICAgICAgICAgICAgPGlucHV0IGNsYXNzPSJkYXRlcGlja2VyIiBzaXplPSIxMiIgbWF4bGVuZ3RoPSIxMCIgcGxhY2Vob2xkZXI9IkZyb20iIHZhbHVlPSIiIHR5cGU9InRleHQiDQogICAgICAgICAgICAgIG5hbWU9InFbZGF0ZV90aW1lX2d0ZXFdIiBpZD0icV9kYXRlX3RpbWVfZ3RlcSI+DQogICAgICAgICAgICA8aW5wdXQgY2xhc3M9ImRhdGVwaWNrZXIiIHNpemU9IjEyIiBtYXhsZW5ndGg9IjEwIiBwbGFjZWhvbGRlcj0iVG8iIHZhbHVlPSIiIHR5cGU9InRleHQiDQogICAgICAgICAgICAgIG5hbWU9InFbZGF0ZV90aW1lX2x0ZXFdIiBpZD0icV9kYXRlX3RpbWVfbHRlcSI+DQogICAgICAgICAgPC9kaXY+DQogICAgICAgICAgPGRpdiBjbGFzcz0iYnV0dG9ucyI+DQogICAgICAgICAgICA8aW5wdXQgbmFtZT0iYXBwbHlfZmlsdGVyc19idG4iIGlkPSJhcHBseV9maWx0ZXJzX2J0biIgY2xhc3M9InN1Ym1pdF9idG4iIHR5cGU9InN1Ym1pdCIgdmFsdWU9IkZpbHRlciIgLz4NCiAgICAgICAgICAgIDxpbnB1dCBuYW1lPSJjbGVhcl9maWx0ZXJzX2J0biIgaWQ9ImNsZWFyX2ZpbHRlcnNfYnRuIiBjbGFzcz0icmVzZXRfYnRuIiB0eXBlPSJidXR0b24iIHZhbHVlPSJDbGVhciIgLz4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC9mb3JtPg0KICAgICAgPC9kaXY+DQogICAgICA8ZGl2IGlkPSJzZXR0aW5nc3ZpZXciPg0KICAgICAgICA8Zm9ybSBpZD0ic2V0dGluZ3MiPg0KICAgICAgICAgIDxmaWVsZHNldCBpZD0iY29sdW1uc3Rvc2hvdyI+DQogICAgICAgICAgICA8bGVnZW5kPkNvbHVtbnMgdG8gc2hvdzwvbGVnZW5kPg0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZyBpdGVtIGNvbnRhaW5lciI+DQogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibGluZW9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+TGluZTogPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9ImxpbmVOdW1iZXJvbm9mZnN3aXRjaCIgY2xhc3M9Im9ub2Zmc3dpdGNoLWNoZWNrYm94Ig0KICAgICAgICAgICAgICAgICAgICBpZD0ibGluZU51bWJlcm9ub2Zmc3dpdGNoIiBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJsaW5lTnVtYmVyb25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPg0KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9Indvcmtlcm9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+V29ya2VyOiA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0id29ya2Vyb25vZmZzd2l0Y2giIGNsYXNzPSJvbm9mZnN3aXRjaC1jaGVja2JveCIgaWQ9Indvcmtlcm9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0id29ya2Vyb25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPg0KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9IndvcmtzdGF0aW9ub25vZmZzd2l0Y2giIGNsYXNzPSJpdGVtIj5Xb3Jrc3RhdGlvbjogPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9IndvcmtzdGF0aW9ub25vZmZzd2l0Y2giIGNsYXNzPSJvbm9mZnN3aXRjaC1jaGVja2JveCINCiAgICAgICAgICAgICAgICAgICAgaWQ9IndvcmtzdGF0aW9ub25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJ3b3Jrc3RhdGlvbm9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+V29ya2Zsb3c6IDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giDQogICAgICAgICAgICAgICAgICAgIGlkPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIiBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwcm9jZXNzb25vZmZzd2l0Y2giIGNsYXNzPSJpdGVtIj5Qcm9jZXNzOiA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0icHJvY2Vzc29ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giIGlkPSJwcm9jZXNzb25vZmZzd2l0Y2giDQogICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ+DQogICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9Im9ub2Zmc3dpdGNoLWxhYmVsIiBmb3I9InByb2Nlc3Nvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1pbm5lciI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtc3dpdGNoIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZyBpdGVtIGNvbnRhaW5lciI+DQogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0icm91dGluZW9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+Um91dGluZTogPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9InJvdXRpbmVvbm9mZnN3aXRjaCIgY2xhc3M9Im9ub2Zmc3dpdGNoLWNoZWNrYm94IiBpZD0icm91dGluZW9ub2Zmc3dpdGNoIg0KICAgICAgICAgICAgICAgICAgICBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJyb3V0aW5lb25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPg0KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InBuckxvY2F0b3Jvbm9mZnN3aXRjaCIgY2xhc3M9Iml0ZW0iPkxvY2F0b3I6IDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJwbnJMb2NhdG9yb25vZmZzd2l0Y2giIGNsYXNzPSJvbm9mZnN3aXRjaC1jaGVja2JveCINCiAgICAgICAgICAgICAgICAgICAgaWQ9InBuckxvY2F0b3Jvbm9mZnN3aXRjaCIgY2hlY2tlZD4NCiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0icG5yTG9jYXRvcm9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjYXRlZ29yeW9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+Q2F0ZWdvcnk6IDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJjYXRlZ29yeW9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giDQogICAgICAgICAgICAgICAgICAgIGlkPSJjYXRlZ29yeW9ub2Zmc3dpdGNoIiBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJjYXRlZ29yeW9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJsZXZlbG9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+TGV2ZWw6IDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJsZXZlbG9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giIGlkPSJsZXZlbG9ub2Zmc3dpdGNoIg0KICAgICAgICAgICAgICAgICAgICBjaGVja2VkPg0KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJsZXZlbG9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4NCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJkYXRlVGltZVRleHRvbm9mZnN3aXRjaCIgY2xhc3M9Iml0ZW0iPkRhdGUvVGltZTogPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9ImRhdGVUaW1lVGV4dG9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giDQogICAgICAgICAgICAgICAgICAgIGlkPSJkYXRlVGltZVRleHRvbm9mZnN3aXRjaCIgY2hlY2tlZD4NCiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0iZGF0ZVRpbWVUZXh0b25vZmZzd2l0Y2giPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPg0KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InRleHRvbm9mZnN3aXRjaCIgY2xhc3M9Iml0ZW0iPiBUZXh0OiA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9ub2Zmc3dpdGNoIj4NCiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0idGV4dG9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giIGlkPSJ0ZXh0b25vZmZzd2l0Y2giDQogICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ+DQogICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9Im9ub2Zmc3dpdGNoLWxhYmVsIiBmb3I9InRleHRvbm9mZnN3aXRjaCI+DQogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1pbm5lciI+PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtc3dpdGNoIj48L3NwYW4+DQogICAgICAgICAgICAgICAgICA8L2xhYmVsPg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgIDwvZmllbGRzZXQ+DQogICAgICAgIDwvZm9ybT4NCiAgICAgIDwvZGl2Pg0KICAgICAgPGRpdiBpZD0iaW5mb3ZpZXciPg0KICAgICAgICA8ZGl2IGlkPSJpbmZvIj4NCiAgICAgICAgICA8ZGl2IGlkPSJpbmZvRmlsZSIgY2xhc3M9ImluZm8iPjxzcGFuIGNsYXNzPSJpbmZvTGFiZWwiPkZpbGUgbmFtZTogPC9zcGFuPjxzcGFuIGlkPSJpbmZvRmlsZW5hbWUiPjwvc3Bhbj4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICA8ZGl2IGlkPSJpbmZvU2VhcmNoIiBjbGFzcz0iaW5mbyBoaWRkZW4iPjxzcGFuIGNsYXNzPSJpbmZvTGFiZWwiPlNlYXJjaCBmb3IgPC9zcGFuPjxzcGFuDQogICAgICAgICAgICAgIGlkPSJpbmZvU2VhcmNoVGV4dCI+PC9zcGFuPjwvZGl2Pg0KICAgICAgICAgIDxkaXYgaWQ9ImluZm9TZWFyY2hDb2x1bW5zIiBjbGFzcz0iaW5mbyBoaWRkZW4iPjxzcGFuIGNsYXNzPSJpbmZvTGFiZWwiPmluIGNvbHVtbnM6IDwvc3Bhbj48c3Bhbg0KICAgICAgICAgICAgICBpZD0iaW5mb1NlYXJjaENvbHVtbnNUZXh0Ij48L3NwYW4+PC9kaXY+DQogICAgICAgICAgPGRpdiBpZD0iaW5mb0ZpbHRlciIgY2xhc3M9ImluZm8gaGlkZGVuIj48c3BhbiBjbGFzcz0iaW5mb0xhYmVsIj5GaWx0ZXJzOiA8L3NwYW4+PHNwYW4NCiAgICAgICAgICAgICAgaWQ9ImluZm9GaWx0ZXJUZXh0Ij48L3NwYW4+PC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQogIDwvZGl2Pg0KICA8ZGl2IGlkPSJsb2d0YWJsZSI+DQogICAgPGRpdiBpZD0icGFnZWRpdiI+DQogICAgICA8dWwgY2xhc3M9InBhZ2luYXRpb24iPjwvdWw+DQogICAgPC9kaXY+DQogICAgPGRpdiBpZD0iZGF0YSI+DQogICAgICA8dGFibGUgY2xhc3M9Imxpc3RhYmxlIHNvcnRhYmxlIj4NCiAgICAgICAgPGNvbGdyb3VwPg0KICAgICAgICAgIDxjb2wgY2xhc3M9ImxpbmVOdW1iZXIiIC8+DQogICAgICAgICAgPGNvbCBjbGFzcz0id29ya2VyIiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9IndvcmtzdGF0aW9uIiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9IndvcmtmbG93IiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9InByb2Nlc3MiIC8+DQogICAgICAgICAgPGNvbCBjbGFzcz0icm91dGluZSIgLz4NCiAgICAgICAgICA8Y29sIGNsYXNzPSJwbnJMb2NhdG9yIiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9ImNhdGVnb3J5IiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9ImxldmVsIiAvPg0KICAgICAgICAgIDxjb2wgY2xhc3M9ImRhdGVUaW1lVGV4dCIgLz4NCiAgICAgICAgICA8Y29sIGNsYXNzPSJ0ZXh0IiAvPg0KICAgICAgICA8L2NvbGdyb3VwPg0KICAgICAgICA8dGhlYWQ+DQogICAgICAgICAgPHRyPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IGxpbmVOdW1iZXIiIGRhdGEtc29ydD0ibGluZU51bWJlciI+TGluZTwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgd29ya2VyIiBkYXRhLXNvcnQ9IndvcmtlciI+V29ya2VyPC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0ic29ydCB3b3Jrc3RhdGlvbiIgZGF0YS1zb3J0PSJ3b3Jrc3RhdGlvbiI+V29ya3N0YXRpb248L3RoPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IHdvcmtmbG93IiBkYXRhLXNvcnQ9IndvcmtmbG93Ij5Xb3JrZmxvdzwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgcHJvY2VzcyIgZGF0YS1zb3J0PSJwcm9jZXNzIj5Qcm9jZXNzPC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0ic29ydCByb3V0aW5lIiBkYXRhLXNvcnQ9InJvdXRpbmUiPlJvdXRpbmU8L3RoPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IHBuckxvY2F0b3IiIGRhdGEtc29ydD0icG5yTG9jYXRvciI+TG9jYXRvcjwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgY2F0ZWdvcnkiIGRhdGEtc29ydD0iY2F0ZWdvcnkiPkNhdGVnb3J5PC90aD4NCiAgICAgICAgICAgIDx0aCBjbGFzcz0ic29ydCBsZXZlbCIgZGF0YS1zb3J0PSJsZXZlbCI+TGV2ZWw8L3RoPg0KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IGRhdGVUaW1lVGV4dCIgZGF0YS1zb3J0PSJkYXRlVGltZVRleHQiPkRhdGUvVGltZTwvdGg+DQogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgdGV4dCIgZGF0YS1zb3J0PSJ0ZXh0Ij5UZXh0PC90aD4NCiAgICAgICAgICA8L3RyPg0KICAgICAgICA8L3RoZWFkPg0KICAgICAgICA8dGJvZHkgY2xhc3M9Imxpc3QiPg0KICAgICAgICAgIDx0cj4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0ibGluZU51bWJlciI+PC90ZD4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0id29ya2VyIj48L3RkPg0KICAgICAgICAgICAgPHRkIGNsYXNzPSJ3b3Jrc3RhdGlvbiI+PC90ZD4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0id29ya2Zsb3ciPjwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9InByb2Nlc3MiPjwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9InJvdXRpbmUiPjwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9InBuckxvY2F0b3IiPjwvdGQ+DQogICAgICAgICAgICA8dGQgY2xhc3M9ImNhdGVnb3J5Ij48L3RkPg0KICAgICAgICAgICAgPHRkIGNsYXNzPSJsZXZlbCI+PC90ZD4NCiAgICAgICAgICAgIDx0ZCBjbGFzcz0iZGF0ZVRpbWVUZXh0Ij48L3RkPg0KICAgICAgICAgICAgPHRkIGNsYXNzPSJ0ZXh0Ij48L3RkPg0KICAgICAgICAgIDwvdHI+DQogICAgICAgIDwvdGJvZHk+DQogICAgICA8L3RhYmxlPg0KICAgIDwvZGl2Pg0KICA8L2Rpdj4NCiAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KICAgIC8vbGlzdA0KICAgIHZhciBvcHRpb25zID0gew0KICAgICAgdmFsdWVOYW1lczogWydsaW5lTnVtYmVyJywgJ3dvcmtlcicsICd3b3Jrc3RhdGlvbicsICdjYXRlZ29yeScsICdsZXZlbCcsICdkYXRlVGltZVRleHQnLCAndGV4dCcsICd3b3JrZmxvdycsDQogICAgICAgICdwcm9jZXNzJywgJ3JvdXRpbmUnLCAncG5yTG9jYXRvcicNCiAgICAgIF0sDQogICAgICBwYWdlOiAyMCwNCiAgICAgIHBsdWdpbnM6IFtMaXN0UGFnaW5hdGlvbih7DQogICAgICAgIG91dGVyV2luZG93OiAyDQogICAgICB9KV0NCiAgICB9Ow0KICAgIC8vIEluaXQgbGlzdA0KICAgIHZhciBsb2dUYWJsZSA9IG5ldyBMaXN0KCdsb2d0YWJsZScsIG9wdGlvbnMpOw0KICAgIGxvZ1RhYmxlLm9uKCd1cGRhdGVkJywgaGlnaGxpZ2h0WG1sKTsNCiAgICBsb2dUYWJsZS5vbigndXBkYXRlZCcsIGNvbnZlcnRESVIpOw0KICAgIGxvZ1RhYmxlLm9uKCd1cGRhdGVkJywgdXBkYXRlQ29sdW1ucyk7DQoNCiAgICAvLyBHRFNYIExvZyBoYW5kbGluZw0KICAgIC8qDQogICAgZnVuY3Rpb24gcHJvY2Vzc1RleHRCb3goZSkgew0KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgcHJvY2Vzc0xvZ1RleHQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ3RleHQnKS52YWx1ZSk7DQogICAgICBpbmZvLmZpbGVOYW1lID0gJ0NvcHkvUGFzdGUnOw0KICAgICAgc2hvd0luZm8oKTsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgKi8NCg0KICAgIGZ1bmN0aW9uIHByZXR0eVhtbCh4bWxUZXh0KSB7DQogICAgICB2YXIgZm9ybWF0ID0gcmVxdWlyZSgneG1sLWZvcm1hdHRlcicpOw0KDQogICAgICB2YXIgb3B0aW9ucyA9IHsNCiAgICAgICAgaW5kZW50YXRpb246ICcgICcsDQogICAgICAgIHN0cmlwQ29tbWVudHM6IHRydWUNCiAgICAgIH07DQogICAgICByZXR1cm4gZm9ybWF0KHhtbFRleHQsIG9wdGlvbnMpOw0KICAgIH0NCg0KICAgIC8vIHV0aWxpdHkgZnVuY3Rpb24gdG8gcHJvY2VzcyBsb2cgdGV4dA0KICAgIGZ1bmN0aW9uIHByb2Nlc3NMb2dUZXh0KGxvZ1RleHQpIHsNCiAgICAgIGlmIChsb2dUZXh0Lmxlbmd0aCA+IDApIHsNCiAgICAgICAgdmFyIGxvZ0FycmF5ID0gY29tcGxlYXRWZW5kb3JEZWJ1Zy5wYXJzZUxvZyhsb2dUZXh0KTsNCiAgICAgIH0NCiAgICAgIGxvZ1RhYmxlLmNsZWFyKCk7DQogICAgICBsb2dUYWJsZS5hZGQobG9nQXJyYXkpOw0KICAgICAgYnVpbGRGaWx0ZXJzKGxvZ0FycmF5KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBoaWdobGlnaHRYbWwoKSB7DQogICAgICB2YXIgdGV4dE5vZGVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndGV4dCcpOw0KICAgICAgdmFyIHhtbE5vZGVzID0gQXJyYXkucHJvdG90eXBlLmZpbHRlci5jYWxsKHRleHROb2RlcywgZnVuY3Rpb24gKG5vZGUpIHsNCiAgICAgICAgcmV0dXJuIG5vZGUuY2hpbGROb2RlcyAmJiBub2RlLmNoaWxkTm9kZXNbMF0gJiYgbm9kZS5jaGlsZE5vZGVzWzBdLm5vZGVUeXBlICE9PSBOb2RlLlRFWFRfTk9ERQ0KICAgICAgfSk7DQogICAgICB4bWxOb2Rlcy5mb3JFYWNoKGVsZW1lbnQgPT4gew0KICAgICAgICBpZiAoZWxlbWVudC5jaGlsZE5vZGVzWzBdLnRhZ05hbWUgJiYgZWxlbWVudC5jaGlsZE5vZGVzWzBdLnRhZ05hbWUudG9Mb3dlckNhc2UoKSAhPT0gJ3ByZScpIHsNCiAgICAgICAgICB2YXIgcHJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncHJlJyk7DQogICAgICAgICAgdmFyIGNvZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjb2RlJyk7DQogICAgICAgICAgY29kZS5jbGFzc05hbWUgPSAneG1sJzsNCiAgICAgICAgICBwcmUuYXBwZW5kQ2hpbGQoY29kZSk7DQogICAgICAgICAgdmFyIHhtbCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHByZXR0eVhtbChlbGVtZW50LmlubmVySFRNTCkpOw0KICAgICAgICAgIGNvZGUuYXBwZW5kQ2hpbGQoeG1sKTsNCiAgICAgICAgICBlbGVtZW50LnJlbW92ZUNoaWxkKGVsZW1lbnQuY2hpbGROb2Rlc1swXSk7DQogICAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChwcmUpOw0KICAgICAgICAgIGhsanMuaGlnaGxpZ2h0QmxvY2soY29kZSk7DQogICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5jaGlsZE5vZGVzWzBdLm5vZGVUeXBlID09PSBOb2RlLkNPTU1FTlRfTk9ERSkgew0KCQkgIHZhciBwcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwcmUnKTsNCiAgICAgICAgICB2YXIgY29kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NvZGUnKTsNCgkJICBjb2RlLmNsYXNzTmFtZSA9ICd4bWwnOw0KICAgICAgICAgIHByZS5hcHBlbmRDaGlsZChjb2RlKTsNCgkJICB2YXIgeG1sVGV4dCA9ICIiOw0KCQkgIHdoaWxlKGVsZW1lbnQuY2hpbGROb2Rlcy5sZW5ndGggPiAwKQ0KCQkgIHsNCgkJCWlmIChlbGVtZW50LmNoaWxkTm9kZXNbMF0ubm9kZVR5cGUgPT0gTm9kZS5FTEVNRU5UX05PREUpDQoJCQl7DQoJCQkgIHhtbFRleHQgPSBuZXcgWE1MU2VyaWFsaXplcigpLnNlcmlhbGl6ZVRvU3RyaW5nKGVsZW1lbnQuY2hpbGROb2Rlc1swXSkucmVwbGFjZSgvPFthLXpcZF0rOi9pZywgIjwiKS5yZXBsYWNlKC88XC9bYS16XGRdKzovaWcsICI8LyIpOw0KCQkJfQ0KCQkgICAgZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmNoaWxkTm9kZXNbMF0pOw0KCQkgIH0NCgkJICB2YXIgeG1sID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocHJldHR5WG1sKHhtbFRleHQpKTsNCgkJICBjb2RlLmFwcGVuZENoaWxkKHhtbCk7DQoJCSAgZWxlbWVudC5hcHBlbmRDaGlsZChwcmUpOw0KCQkgIGhsanMuaGlnaGxpZ2h0QmxvY2soY29kZSk7DQoJCX0NCiAgICAgIH0pOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGNvbnZlcnRESVIoKSB7DQogICAgICB2YXIgdGV4dE5vZGVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndGV4dCcpOw0KICAgICAgdmFyIGRpck5vZGVzID0gQXJyYXkuZnJvbSh0ZXh0Tm9kZXMpLmZpbHRlcihub2RlID0+IChub2RlLmlubmVyVGV4dCB8fCBub2RlLnRleHRDb250ZW50KS5zdWJzdHJpbmcoMCwgMykgPT09ICdESVInKTsNCiAgICAgIGRpck5vZGVzLmZvckVhY2goZWxlbWVudCA9PiB7DQogICAgICAgIHZhciBESVJUcmVlID0gd3NwYW5ESVIucGFyc2VESVJNZXNzYWdlKGVsZW1lbnQuaW5uZXJUZXh0IHx8IGVsZW1lbnQudGV4dENvbnRlbnQpOw0KICAgICAgICBpZiAoRElSVHJlZSkgew0KICAgICAgICAgIHZhciBwcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwcmUnKTsNCiAgICAgICAgICB2YXIgY29kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NvZGUnKTsNCiAgICAgICAgICBjb2RlLmNsYXNzTmFtZSA9ICd4bWwnOw0KICAgICAgICAgIHByZS5hcHBlbmRDaGlsZChjb2RlKTsNCiAgICAgICAgICB2YXIgcGxhaW5YTUwgPSBESVJUcmVlLnRvWE1MKCk7DQogICAgICAgICAgdmFyIHhtbCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHBsYWluWE1MKTsNCiAgICAgICAgICBjb2RlLmFwcGVuZENoaWxkKHhtbCk7DQogICAgICAgICAgZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmNoaWxkTm9kZXNbMF0pOw0KICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQocHJlKTsNCiAgICAgICAgICBobGpzLmhpZ2hsaWdodEJsb2NrKGNvZGUpOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9DQoNCiAgICAvL2h0dHA6Ly9qc2ZpZGRsZS5uZXQvMEdpUzAvbkRWWWQvDQogICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgIGFkZEV2ZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWIxbGluaycpLCAnY2xpY2snLCByZXNpemVEYXRhKTsNCiAgICAgIGFkZEV2ZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWIybGluaycpLCAnY2xpY2snLCByZXNpemVEYXRhKTsNCiAgICAgIGFkZEV2ZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWIzbGluaycpLCAnY2xpY2snLCByZXNpemVEYXRhKTsNCiAgICAgIGFkZEV2ZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWI0bGluaycpLCAnY2xpY2snLCByZXNpemVEYXRhKTsNCg0KICAgICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlcicpLCAnc3VibWl0JywgYXBwbHlGaWx0ZXJzKTsNCiAgICAgIGFkZEV2ZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbGVhcl9maWx0ZXJzX2J0bicpLCAnY2xpY2snLCBjbGVhckZpbHRlcnMpOw0KICAgICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaCcpLCAnc3VibWl0JywgYXBwbHlTZWFyY2gpOw0KICAgICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyX3NlYXJjaF9idG4nKSwgJ2NsaWNrJywgY2xlYXJTZWFyY2gpOw0KICAgICAgaW5pdENvbHVtbnMoKTsNCiAgICAgIHVwZGF0ZUluZm8oKTsNCiAgICAgIHJlc2l6ZURhdGEoKTsNCiAgICAgIHByb2Nlc3NMb2dUZXh0KGAlTE9HVEVYVCVgKTsNCiAgICAgIHNob3dJbmZvKCk7DQogICAgfQ0KDQogICAgd2luZG93Lm9ucmVzaXplID0gcmVzaXplRGF0YTsNCg0KICAgIGZ1bmN0aW9uIHJlc2l6ZURhdGEoKSB7DQogICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgIHJlc2l6ZUVsZW1lbnRIZWlnaHQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEnKSkNCiAgICAgIH0sIDUwKTsNCiAgICB9DQoNCiAgICAvKiogaW5mbyAqKi8NCiAgICB2YXIgaW5mbyA9IHsNCiAgICAgIGZpbGVOYW1lOiAnJUZJTEVOQU1FJScsDQogICAgICBzZWFyY2hUZXh0OiAnJywNCiAgICAgIHNlYXJjaENvbHVtbnM6IFtdLA0KICAgICAgZmlsdGVyczogW10NCiAgICB9Ow0KDQogICAgZnVuY3Rpb24gc2hvd0luZm8oKSB7DQogICAgICB1cGRhdGVJbmZvKCk7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiNGxpbmsnKS5jbGljaygpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHVwZGF0ZUluZm8oKSB7DQogICAgICB2YXIgZmlsZU5hbWVEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5mb0ZpbGVuYW1lJyk7DQogICAgICBmaWxlTmFtZURpdi5pbm5lclRleHQgPSBpbmZvLmZpbGVOYW1lOw0KICAgICAgdmFyIHNlYXJjaERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvU2VhcmNoJyk7DQogICAgICB2YXIgc2VhcmNoQ29sdW1uc0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvU2VhcmNoQ29sdW1ucycpOw0KICAgICAgaWYgKGluZm8uc2VhcmNoVGV4dC5sZW5ndGggPT0gMCkgew0KICAgICAgICBzZWFyY2hEaXYuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7DQogICAgICAgIHNlYXJjaENvbHVtbnNEaXYuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzZWFyY2hEaXYuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7DQogICAgICAgIHZhciBzZWFyY2hUZXh0RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luZm9TZWFyY2hUZXh0Jyk7DQogICAgICAgIHNlYXJjaFRleHREaXYuaW5uZXJUZXh0ID0gaW5mby5zZWFyY2hUZXh0Ow0KICAgICAgICBzZWFyY2hDb2x1bW5zRGl2LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOw0KICAgICAgICB2YXIgc2VhcmNoQ29sdW1uc1RleHREaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5mb1NlYXJjaENvbHVtbnNUZXh0Jyk7DQogICAgICAgIGlmIChpbmZvLnNlYXJjaENvbHVtbnMubGVuZ3RoID4gMCkgew0KICAgICAgICAgIHNlYXJjaENvbHVtbnNUZXh0RGl2LmlubmVyVGV4dCA9IGluZm8uc2VhcmNoQ29sdW1ucy5qb2luKCcsICcpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHNlYXJjaENvbHVtbnNUZXh0RGl2LmlubmVyVGV4dCA9ICdBbGwnOw0KICAgICAgICB9DQogICAgICB9DQogICAgICB2YXIgZmlsdGVyRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luZm9GaWx0ZXInKTsNCiAgICAgIGlmIChpbmZvLmZpbHRlcnMubGVuZ3RoID09IDApIHsNCiAgICAgICAgZmlsdGVyRGl2LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZmlsdGVyRGl2LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOw0KICAgICAgICB2YXIgZmlsdGVyVGV4dERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvRmlsdGVyVGV4dCcpOw0KICAgICAgICBmaWx0ZXJUZXh0RGl2LmlubmVySFRNTCA9IGluZm8uZmlsdGVycy5qb2luKCcgYW5kICcpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKiBTZXR0aW5ncyAqKi8NCiAgICBmdW5jdGlvbiBpbml0Q29sdW1ucygpIHsNCiAgICAgIHZhciB0YmwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZGF0YSA+IHRhYmxlJyk7DQogICAgICB2YXIgY29scyA9IEFycmF5LmZyb20odGJsLnF1ZXJ5U2VsZWN0b3JBbGwoJ2NvbCcpKTsNCiAgICAgIGNvbHMuZm9yRWFjaChjb2wgPT4gew0KICAgICAgICB2YXIgY29sTmFtZSA9IGNvbC5jbGFzc05hbWU7DQogICAgICAgIHZhciBjaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbE5hbWUgKyAnb25vZmZzd2l0Y2gnKTsNCiAgICAgICAgaWYgKGNoZWNrYm94KSB7DQogICAgICAgICAgdmFyIGRpc3BsYXlNb2RlID0gKGNoZWNrYm94LmNoZWNrZWQpID8gJ3RhYmxlLWNlbGwnIDogJ25vbmUnOw0KICAgICAgICAgIEFycmF5LmZyb20odGJsLnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgY29sTmFtZSkpLmZvckVhY2goY2VsbCA9PiBjZWxsLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5TW9kZSk7DQogICAgICAgICAgYWRkRXZlbnQoY2hlY2tib3gsICdjaGFuZ2UnLCB0b2dnbGVDb2x1bW4pOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiB1cGRhdGVDb2x1bW5zKCkgew0KICAgICAgdmFyIHRibCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkYXRhID4gdGFibGUnKTsNCiAgICAgIHZhciBjb2xzID0gQXJyYXkuZnJvbSh0YmwucXVlcnlTZWxlY3RvckFsbCgnY29sJykpOw0KICAgICAgY29scy5mb3JFYWNoKGNvbCA9PiB7DQogICAgICAgIHZhciBjb2xOYW1lID0gY29sLmNsYXNzTmFtZTsNCiAgICAgICAgdmFyIGNoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29sTmFtZSArICdvbm9mZnN3aXRjaCcpOw0KICAgICAgICBpZiAoY2hlY2tib3gpIHsNCiAgICAgICAgICB2YXIgZGlzcGxheU1vZGUgPSAoY2hlY2tib3guY2hlY2tlZCkgPyAndGFibGUtY2VsbCcgOiAnbm9uZSc7DQogICAgICAgICAgQXJyYXkuZnJvbSh0YmwucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjb2xOYW1lKSkuZm9yRWFjaChjZWxsID0+IGNlbGwuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXlNb2RlKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdG9nZ2xlQ29sdW1uKGV2dCkgew0KICAgICAgdmFyIGNoZWNrYm94ID0gZXZ0LnRhcmdldDsNCiAgICAgIHZhciBjb2xOYW1lID0gY2hlY2tib3guaWQucmVwbGFjZSgnb25vZmZzd2l0Y2gnLCAnJyk7DQogICAgICB2YXIgdGJsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2RhdGEgPiB0YWJsZScpOw0KICAgICAgdmFyIGRpc3BsYXlNb2RlID0gKGNoZWNrYm94LmNoZWNrZWQpID8gJ3RhYmxlLWNlbGwnIDogJ25vbmUnOw0KICAgICAgQXJyYXkuZnJvbSh0YmwucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjb2xOYW1lKSkuZm9yRWFjaChjZWxsID0+IGNlbGwuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXlNb2RlKTsNCiAgICAgIHJlc2l6ZURhdGEoKTsNCiAgICB9DQoNCiAgICAvKiogU2VhcmNoICoqLw0KICAgIC8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzExODIxMjYxL2hvdy10by1nZXQtYWxsLXNlbGVjdGVkLXZhbHVlcy1mcm9tLXNlbGVjdC1tdWx0aXBsZS1tdWx0aXBsZQ0KICAgIGZ1bmN0aW9uIGdldFNlbGVjdFZhbHVlcyhzZWxlY3QpIHsNCiAgICAgIHZhciByZXN1bHQgPSBbXTsNCiAgICAgIHZhciBvcHRpb25zID0gc2VsZWN0ICYmIHNlbGVjdC5vcHRpb25zOw0KICAgICAgdmFyIG9wdDsNCg0KICAgICAgZm9yICh2YXIgaSA9IDAsIGlMZW4gPSBvcHRpb25zLmxlbmd0aDsgaSA8IGlMZW47IGkrKykgew0KICAgICAgICBvcHQgPSBvcHRpb25zW2ldOw0KDQogICAgICAgIGlmIChvcHQuc2VsZWN0ZWQpIHsNCiAgICAgICAgICByZXN1bHQucHVzaChvcHQudmFsdWUgfHwgb3B0LnRleHQpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEyODAyNzM5L2Rlc2VsZWN0LXNlbGVjdGVkLW9wdGlvbnMtaW4tc2VsZWN0LW1lbnUtd2l0aC1tdWx0aXBsZS1hbmQtb3B0Z3JvdXBzDQogICAgZnVuY3Rpb24gY2xlYXJTZWxlY3RlZChzZWxlY3QpIHsNCiAgICAgIHZhciBvcHRpb25zID0gc2VsZWN0ICYmIHNlbGVjdC5vcHRpb25zOw0KDQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgb3B0aW9uc1tpXS5zZWxlY3RlZCA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFwcGx5U2VhcmNoKGUpIHsNCiAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgIHZhciBjb2x1bW5zID0gZ2V0U2VsZWN0VmFsdWVzKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX2NvbHVtbicpKTsNCiAgICAgIHZhciBzZWFyY2hUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Ffc2VhcmNoJykudmFsdWU7DQogICAgICBpZiAoY29sdW1ucy5sZW5ndGggPiAwKSB7DQogICAgICAgIGxvZ1RhYmxlLnNlYXJjaChzZWFyY2hUZXh0LCBjb2x1bW5zKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGxvZ1RhYmxlLnNlYXJjaChzZWFyY2hUZXh0KTsNCiAgICAgIH0NCiAgICAgIGluZm8uc2VhcmNoQ29sdW1ucyA9IGNvbHVtbnM7DQogICAgICBpbmZvLnNlYXJjaFRleHQgPSBzZWFyY2hUZXh0Ow0KICAgICAgc2hvd0luZm8oKTsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBjbGVhclNlYXJjaCgpIHsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3NlYXJjaCcpLnZhbHVlID0gJyc7DQogICAgICBjb2x1bW5DaG9pY2VzLnJlbW92ZUFjdGl2ZUl0ZW1zKCk7DQogICAgICBpbmZvLnNlYXJjaENvbHVtbnMgPSBbXTsNCiAgICAgIGluZm8uc2VhcmNoVGV4dCA9ICcnOw0KICAgICAgdXBkYXRlSW5mbygpOw0KICAgICAgbG9nVGFibGUuc2VhcmNoKCk7IC8vIFNob3cgYWxsIGl0ZW1zIGluIGxpc3QNCiAgICB9DQoNCiAgICAvKiogRW5kIHNlYXJjaCAqKi8NCg0KICAgIC8qKiBmaWx0ZXJzICoqLw0KICAgIC8vIGluaXQgZGF0ZXBpY2tlcnM6DQogICAgZmxhdHBpY2tyKCIuZGF0ZXBpY2tlciIsIHsNCiAgICAgIGVuYWJsZVRpbWU6IHRydWUsDQogICAgICBkYXRlRm9ybWF0OiAiWS1tLWQgSDppIg0KICAgIH0pOw0KDQogICAgY29uc3QgY29sdW1uQ2hvaWNlcyA9IG5ldyBDaG9pY2VzKCcjcV9jb2x1bW4nLCB7DQogICAgICByZW1vdmVJdGVtQnV0dG9uOiB0cnVlLA0KICAgICAgZHVwbGljYXRlSXRlbXNBbGxvd2VkOiBmYWxzZQ0KICAgIH0pDQogICAgY29uc3Qgd29ya2VyQ2hvaWNlcyA9IG5ldyBDaG9pY2VzKCcjcV93b3JrZXInLCB7DQogICAgICBkdXBsaWNhdGVJdGVtc0FsbG93ZWQ6IGZhbHNlDQogICAgfSk7DQogICAgY29uc3Qgd29ya3N0YXRpb25DaG9pY2VzID0gbmV3IENob2ljZXMoJyNxX3dvcmtzdGF0aW9uJywgew0KICAgICAgZHVwbGljYXRlSXRlbXNBbGxvd2VkOiBmYWxzZQ0KICAgIH0pOw0KICAgIGNvbnN0IHdvcmtmbG93Q2hvaWNlcyA9IG5ldyBDaG9pY2VzKCcjcV93b3JrZmxvdycsIHsNCiAgICAgIGR1cGxpY2F0ZUl0ZW1zQWxsb3dlZDogZmFsc2UNCiAgICB9KTsNCiAgICBjb25zdCBwcm9jZXNzQ2hvaWNlcyA9IG5ldyBDaG9pY2VzKCcjcV9wcm9jZXNzJywgew0KICAgICAgZHVwbGljYXRlSXRlbXNBbGxvd2VkOiBmYWxzZQ0KICAgIH0pOw0KICAgIGNvbnN0IGNhdGVnb3J5Q2hvaWNlcyA9IG5ldyBDaG9pY2VzKCcjcV9jYXRlZ29yeScsIHsNCiAgICAgIGR1cGxpY2F0ZUl0ZW1zQWxsb3dlZDogZmFsc2UNCiAgICB9KTsNCiAgICBjb25zdCBsZXZlbENob2ljZXMgPSBuZXcgQ2hvaWNlcygnI3FfbGV2ZWwnLCB7DQogICAgICBkdXBsaWNhdGVJdGVtc0FsbG93ZWQ6IGZhbHNlDQogICAgfSk7DQoNCiAgICBmdW5jdGlvbiBwb3B1bGF0ZUNob2ljZXMoY2hvaWNlQm94LCB2YWx1ZXMpIHsNCiAgICAgIGNob2ljZXMgPSB2YWx1ZXMubWFwKCh2YWwpID0+IHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICB2YWx1ZTogdmFsLnRvU3RyaW5nKCksDQogICAgICAgICAgbGFiZWw6IHZhbC50b1N0cmluZygpLA0KICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZQ0KICAgICAgICB9Ow0KICAgICAgfSk7DQogICAgICBjaG9pY2VzLnVuc2hpZnQoew0KICAgICAgICB2YWx1ZTogJ0FsbCcsDQogICAgICAgIGxhYmVsOiAnQWxsJywNCiAgICAgICAgc2VsZWN0ZWQ6IHRydWUNCiAgICAgIH0pOw0KICAgICAgY2hvaWNlQm94LnNldENob2ljZXMoY2hvaWNlcywgJ3ZhbHVlJywgJ2xhYmVsJywgdHJ1ZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gcmVtb3ZlT3B0aW9ucyhzZWxlY3Rib3gpIHsNCiAgICAgIHZhciBpOw0KICAgICAgZm9yIChpID0gc2VsZWN0Ym94Lm9wdGlvbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsNCiAgICAgICAgc2VsZWN0Ym94LnJlbW92ZShpKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBhZGRPcHRpb24oc2VsZWN0LCB0ZXh0LCB2YWx1ZSwgc2VsZWN0ZWQpIHsNCiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpOw0KICAgICAgZWwudGV4dENvbnRlbnQgPSB0ZXh0Ow0KICAgICAgZWwudmFsdWUgPSB2YWx1ZTsNCiAgICAgIGVsLnNlbGVjdGVkID0gc2VsZWN0ZWQ7DQogICAgICBzZWxlY3QuYXBwZW5kQ2hpbGQoZWwpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHBvcHVsYXRlU2VsZWN0KGVsZW1lbnRJZCwgdmFsdWVzKSB7DQogICAgICB2YXIgc2VsZWN0Qm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKTsNCiAgICAgIHJlbW92ZU9wdGlvbnMoc2VsZWN0Qm94KTsNCiAgICAgIGFkZE9wdGlvbihzZWxlY3RCb3gsICdBbGwnLCAnQWxsJywgdHJ1ZSk7DQoNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIHZhciBvcHQgPSB2YWx1ZXNbaV07DQogICAgICAgIGFkZE9wdGlvbihzZWxlY3RCb3gsIG9wdCwgb3B0LCBmYWxzZSk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYnVpbGRGaWx0ZXJzKGxvZ1RhYmxlKSB7DQogICAgICBsZXQgd29ya2VycyA9IFsuLi5uZXcgU2V0KGxvZ1RhYmxlLm1hcChpdGVtID0+IGl0ZW0ud29ya2VyKSldLnNvcnQoKTsNCiAgICAgIHBvcHVsYXRlU2VsZWN0KCdxX3dvcmtlcicsIHdvcmtlcnMpOw0KICAgICAgcG9wdWxhdGVDaG9pY2VzKHdvcmtlckNob2ljZXMsIHdvcmtlcnMpOw0KICAgICAgbGV0IHdvcmtzdGF0aW9ucyA9IFsuLi5uZXcgU2V0KGxvZ1RhYmxlLm1hcChpdGVtID0+IGl0ZW0ud29ya3N0YXRpb24pKV0uc29ydCgpOw0KICAgICAgcG9wdWxhdGVTZWxlY3QoJ3Ffd29ya3N0YXRpb24nLCB3b3Jrc3RhdGlvbnMpOw0KICAgICAgcG9wdWxhdGVDaG9pY2VzKHdvcmtzdGF0aW9uQ2hvaWNlcywgd29ya3N0YXRpb25zKTsNCiAgICAgIGxldCB3b3JrZmxvd3MgPSBbLi4ubmV3IFNldChsb2dUYWJsZS5tYXAoaXRlbSA9PiBpdGVtLndvcmtmbG93KSldLnNvcnQoKTsNCiAgICAgIHBvcHVsYXRlU2VsZWN0KCdxX3dvcmtmbG93Jywgd29ya2Zsb3dzKTsNCiAgICAgIHBvcHVsYXRlQ2hvaWNlcyh3b3JrZmxvd0Nob2ljZXMsIHdvcmtmbG93cyk7DQogICAgICBsZXQgcHJvY2Vzc2VzID0gWy4uLm5ldyBTZXQobG9nVGFibGUubWFwKGl0ZW0gPT4gaXRlbS5wcm9jZXNzKSldLnNvcnQoKTsNCiAgICAgIHBvcHVsYXRlU2VsZWN0KCdxX3Byb2Nlc3MnLCBwcm9jZXNzZXMpOw0KICAgICAgcG9wdWxhdGVDaG9pY2VzKHByb2Nlc3NDaG9pY2VzLCBwcm9jZXNzZXMpOw0KICAgICAgbGV0IGNhdGVnb3JpZXMgPSBbLi4ubmV3IFNldChsb2dUYWJsZS5tYXAoaXRlbSA9PiBpdGVtLmNhdGVnb3J5KSldLnNvcnQoKTsNCiAgICAgIHBvcHVsYXRlU2VsZWN0KCdxX2NhdGVnb3J5JywgY2F0ZWdvcmllcyk7DQogICAgICBwb3B1bGF0ZUNob2ljZXMoY2F0ZWdvcnlDaG9pY2VzLCBjYXRlZ29yaWVzKTsNCiAgICAgIGxldCBsZXZlbHMgPSBbLi4ubmV3IFNldChsb2dUYWJsZS5tYXAoaXRlbSA9PiBpdGVtLmxldmVsKSldLnNvcnQoKTsNCiAgICAgIHBvcHVsYXRlU2VsZWN0KCdxX2xldmVsJywgbGV2ZWxzKTsNCiAgICAgIHBvcHVsYXRlQ2hvaWNlcyhsZXZlbENob2ljZXMsIGxldmVscyk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ2V0SW50ZWdlclZhbHVlKGVsZW1lbnRJZCkgew0KICAgICAgdmFyIGZvcm1WYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpLnZhbHVlOw0KICAgICAgaWYgKE51bWJlci5pc05hTihmb3JtVmFsKSkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBuZXcgTnVtYmVyKGZvcm1WYWwpLnZhbHVlT2YoKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZWxlY3RWYWx1ZShlbGVtZW50SWQpIHsNCiAgICAgIHZhciBzZWxlY3RCb3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpOw0KICAgICAgcmV0dXJuIHNlbGVjdEJveC5vcHRpb25zW3NlbGVjdEJveC5zZWxlY3RlZEluZGV4XS52YWx1ZTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZWxlY3RGaWx0ZXIoZWxlbWVudElkKSB7DQogICAgICB2YXIgdmFsdWUgPSBzZWxlY3RWYWx1ZShlbGVtZW50SWQpOw0KICAgICAgaWYgKHZhbHVlID09ICdBbGwnKSB7DQogICAgICAgIHJldHVybiB0cnVlRmlsdGVyOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWwpIHsNCiAgICAgICAgICByZXR1cm4gKHZhbCA9PSB2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiB0cnVlRmlsdGVyKCkgew0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gbGVzc1RoYW5GaWx0ZXIodXBwZXJMaW1pdCkgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWwpIHsNCiAgICAgICAgcmV0dXJuICh2YWwgPD0gdXBwZXJMaW1pdCk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZ3JlYXRlclRoYW5GaWx0ZXIobG93ZXJMaW1pdCkgew0KICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWwpIHsNCiAgICAgICAgcmV0dXJuICh2YWwgPj0gbG93ZXJMaW1pdCk7DQogICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gYmV0d2VlbkZpbHRlcihsb3dlckxpbWl0LCB1cHBlckxpbWl0KSB7DQogICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbCkgew0KICAgICAgICByZXR1cm4gKHZhbCA+PSBsb3dlckxpbWl0ICYmIHZhbCA8PSB1cHBlckxpbWl0KTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBzZWxlY3RGaWx0ZXJUZXh0KGZpbHRlcnMsIGVsZW1lbnROYW1lLCBlbGVtZW50SWQpIHsNCiAgICAgIHZhciB2YWx1ZSA9IHNlbGVjdFZhbHVlKGVsZW1lbnRJZCk7DQogICAgICBpZiAodmFsdWUgIT0gJ0FsbCcpIHsNCiAgICAgICAgZmlsdGVycy5wdXNoKGA8Yj4ke2VsZW1lbnROYW1lfTwvYj4gaXMgIiR7dmFsdWV9ImApOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGFwcGx5RmlsdGVycyhlKSB7DQogICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICBpbmZvLmZpbHRlcnMgPSBbXTsNCiAgICAgIHZhciBsaW5lRmlsdGVyOw0KICAgICAgdmFyIGRhdGVGaWx0ZXI7DQogICAgICB2YXIgbGluZUdyZWF0ZXJUaGFuID0gZ2V0SW50ZWdlclZhbHVlKCdxX2xpbmVfbnVtYmVyX2d0ZXEnKTsNCiAgICAgIHZhciBsaW5lTGVzc1RoYW4gPSBnZXRJbnRlZ2VyVmFsdWUoJ3FfbGluZV9udW1iZXJfbHRlcScpOw0KICAgICAgaWYgKGxpbmVMZXNzVGhhbiA9PSAwICYmIGxpbmVHcmVhdGVyVGhhbiA9PSAwKSB7DQogICAgICAgIGxpbmVGaWx0ZXIgPSB0cnVlRmlsdGVyOw0KICAgICAgfSBlbHNlIGlmIChsaW5lTGVzc1RoYW4gPT0gMCkgew0KICAgICAgICBsaW5lRmlsdGVyID0gZ3JlYXRlclRoYW5GaWx0ZXIobGluZUdyZWF0ZXJUaGFuKTsNCiAgICAgICAgaW5mby5maWx0ZXJzLnB1c2goYDxiPkxpbmUgbnVtYmVyPC9iPiBpcyBncmVhdGVyIHRoYW4gJHtsaW5lR3JlYXRlclRoYW59YCk7DQogICAgICB9IGVsc2UgaWYgKGxpbmVHcmVhdGVyVGhhbiA9PSAwKSB7DQogICAgICAgIGxpbmVGaWx0ZXIgPSBsZXNzVGhhbkZpbHRlcihsaW5lTGVzc1RoYW4pOw0KICAgICAgICBpbmZvLmZpbHRlcnMucHVzaChgPGI+TGluZSBudW1iZXI8L2I+IGlzIGxlc3MgdGhhbiAke2xpbmVMZXNzVGhhbn1gKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGxpbmVGaWx0ZXIgPSBiZXR3ZWVuRmlsdGVyKGxpbmVHcmVhdGVyVGhhbiwgbGluZUxlc3NUaGFuKTsNCiAgICAgICAgaW5mby5maWx0ZXJzLnB1c2goYDxiPkxpbmUgbnVtYmVyPC9iPiBpcyBiZXR3ZWVuICR7bGluZUxlc3NUaGFufSBhbmQgJHtsaW5lR3JlYXRlclRoYW59YCk7DQogICAgICB9DQogICAgICB2YXIgd29ya2VyRmlsdGVyID0gc2VsZWN0RmlsdGVyKCdxX3dvcmtlcicpOw0KICAgICAgc2VsZWN0RmlsdGVyVGV4dChpbmZvLmZpbHRlcnMsICdXb3JrZXInLCAncV93b3JrZXInKTsNCiAgICAgIHZhciB3b3Jrc3RhdGlvbkZpbHRlciA9IHNlbGVjdEZpbHRlcigncV93b3Jrc3RhdGlvbicpOw0KICAgICAgc2VsZWN0RmlsdGVyVGV4dChpbmZvLmZpbHRlcnMsICdXb3Jrc3RhdGlvbicsICdxX3dvcmtzdGF0aW9uJyk7DQogICAgICB2YXIgd29ya2Zsb3dGaWx0ZXIgPSBzZWxlY3RGaWx0ZXIoJ3Ffd29ya2Zsb3cnKTsNCiAgICAgIHNlbGVjdEZpbHRlclRleHQoaW5mby5maWx0ZXJzLCAnV29ya2Zsb3cnLCAncV93b3JrZmxvdycpOw0KICAgICAgdmFyIHByb2Nlc3NGaWx0ZXIgPSBzZWxlY3RGaWx0ZXIoJ3FfcHJvY2VzcycpOw0KICAgICAgc2VsZWN0RmlsdGVyVGV4dChpbmZvLmZpbHRlcnMsICdQcm9jZXNzJywgJ3FfcHJvY2VzcycpOw0KICAgICAgdmFyIGNhdGVnb3J5RmlsdGVyID0gc2VsZWN0RmlsdGVyKCdxX2NhdGVnb3J5Jyk7DQogICAgICBzZWxlY3RGaWx0ZXJUZXh0KGluZm8uZmlsdGVycywgJ0NhdGVnb3J5JywgJ3FfY2F0ZWdvcnknKTsNCiAgICAgIHZhciBsZXZlbEZpbHRlciA9IHNlbGVjdEZpbHRlcigncV9sZXZlbCcpOw0KICAgICAgc2VsZWN0RmlsdGVyVGV4dChpbmZvLmZpbHRlcnMsICdMZXZlbCcsICdxX2xldmVsJyk7DQogICAgICB2YXIgZGF0ZUdyZWF0ZXJUaGFuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FfZGF0ZV90aW1lX2d0ZXEnKS52YWx1ZTsNCiAgICAgIHZhciBkYXRlTGVzc1RoYW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9kYXRlX3RpbWVfbHRlcScpLnZhbHVlOw0KICAgICAgaWYgKGRhdGVHcmVhdGVyVGhhbiAhPSAnJyAmJiBkYXRlTGVzc1RoYW4gIT0gJycpIHsNCiAgICAgICAgZGF0ZUZpbHRlciA9IGJldHdlZW5GaWx0ZXIobmV3IERhdGUoZGF0ZUdyZWF0ZXJUaGFuKSwgbmV3IERhdGUoZGF0ZUxlc3NUaGFuKSk7DQogICAgICAgIGluZm8uZmlsdGVycy5wdXNoKGA8Yj5EYXRlL1RpbWU8L2I+IGlzIGJldHdlZW4gJHtkYXRlTGVzc1RoYW59IGFuZCAke2RhdGVHcmVhdGVyVGhhbn1gKTsNCiAgICAgIH0gZWxzZSBpZiAoZGF0ZUdyZWF0ZXJUaGFuICE9ICcnKSB7DQogICAgICAgIGRhdGVGaWx0ZXIgPSBncmVhdGVyVGhhbkZpbHRlcihuZXcgRGF0ZShkYXRlR3JlYXRlclRoYW4pKTsNCiAgICAgICAgaW5mby5maWx0ZXJzLnB1c2goYDxiPkRhdGUvVGltZTwvYj4gaXMgZ3JlYXRlciB0aGFuICR7ZGF0ZUdyZWF0ZXJUaGFufWApOw0KICAgICAgfSBlbHNlIGlmIChkYXRlTGVzc1RoYW4gIT0gJycpIHsNCiAgICAgICAgZGF0ZUZpbHRlciA9IGxlc3NUaGFuRmlsdGVyKG5ldyBEYXRlKGRhdGVMZXNzVGhhbikpOw0KICAgICAgICBpbmZvLmZpbHRlcnMucHVzaChgPGI+RGF0ZS9UaW1lPC9iPiBpcyBsZXNzIHRoYW4gJHtkYXRlTGVzc1RoYW59YCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBkYXRlRmlsdGVyID0gdHJ1ZUZpbHRlcjsNCiAgICAgIH0NCiAgICAgIGxvZ1RhYmxlLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICBpdGVtVmFsdWVzID0gaXRlbS52YWx1ZXMoKTsNCiAgICAgICAgdmFyIGxpbmVJbkJvdW5kcyA9IGxpbmVGaWx0ZXIoaXRlbVZhbHVlcy5saW5lTnVtYmVyKTsNCiAgICAgICAgdmFyIHdvcmtlclZhbGlkID0gd29ya2VyRmlsdGVyKGl0ZW1WYWx1ZXMud29ya2VyKTsNCiAgICAgICAgdmFyIHdvcmtzdGF0aW9uVmFsaWQgPSB3b3Jrc3RhdGlvbkZpbHRlcihpdGVtVmFsdWVzLndvcmtzdGF0aW9uKTsNCiAgICAgICAgdmFyIHdvcmtmbG93VmFsaWQgPSB3b3JrZmxvd0ZpbHRlcihpdGVtVmFsdWVzLndvcmtmbG93KTsNCiAgICAgICAgdmFyIHByb2Nlc3NWYWxpZCA9IHByb2Nlc3NGaWx0ZXIoaXRlbVZhbHVlcy5wcm9jZXNzKTsNCiAgICAgICAgdmFyIGNhdGVnb3J5VmFsaWQgPSBjYXRlZ29yeUZpbHRlcihpdGVtVmFsdWVzLmNhdGVnb3J5KTsNCiAgICAgICAgdmFyIGxldmVsVmFsaWQgPSBsZXZlbEZpbHRlcihpdGVtVmFsdWVzLmxldmVsKTsNCiAgICAgICAgdmFyIGRhdGVWYWxpZCA9IGRhdGVGaWx0ZXIoaXRlbVZhbHVlcy5kYXRlVGltZSk7DQogICAgICAgIHJldHVybiBsaW5lSW5Cb3VuZHMgJiYgd29ya2VyVmFsaWQgJiYgd29ya3N0YXRpb25WYWxpZCAmJiB3b3JrZmxvd1ZhbGlkICYmIHByb2Nlc3NWYWxpZCAmJiBjYXRlZ29yeVZhbGlkICYmDQogICAgICAgICAgbGV2ZWxWYWxpZCAmJiBkYXRlVmFsaWQ7DQogICAgICB9KTsNCiAgICAgIHNob3dJbmZvKCk7DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gY2xlYXJGaWx0ZXJzKCkgew0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FfbGluZV9udW1iZXJfZ3RlcScpLnZhbHVlID0gJyc7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9saW5lX251bWJlcl9sdGVxJykudmFsdWUgPSAnJzsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3dvcmtlcicpLnZhbHVlID0gJ0FsbCc7DQogICAgICB3b3JrZXJDaG9pY2VzLnNldENob2ljZUJ5VmFsdWUoJ0FsbCcpOw0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Ffd29ya3N0YXRpb24nKS52YWx1ZSA9ICdBbGwnOw0KICAgICAgd29ya3N0YXRpb25DaG9pY2VzLnNldENob2ljZUJ5VmFsdWUoJ0FsbCcpOw0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Ffd29ya2Zsb3cnKS52YWx1ZSA9ICdBbGwnOw0KICAgICAgd29ya2Zsb3dDaG9pY2VzLnNldENob2ljZUJ5VmFsdWUoJ0FsbCcpOw0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FfcHJvY2VzcycpLnZhbHVlID0gJ0FsbCc7DQogICAgICBwcm9jZXNzQ2hvaWNlcy5zZXRDaG9pY2VCeVZhbHVlKCdBbGwnKTsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX2NhdGVnb3J5JykudmFsdWUgPSAnQWxsJzsNCiAgICAgIGNhdGVnb3J5Q2hvaWNlcy5zZXRDaG9pY2VCeVZhbHVlKCdBbGwnKTsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX2xldmVsJykudmFsdWUgPSAnQWxsJzsNCiAgICAgIGxldmVsQ2hvaWNlcy5zZXRDaG9pY2VCeVZhbHVlKCdBbGwnKTsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX2RhdGVfdGltZV9ndGVxJykudmFsdWUgPSAnJzsNCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX2RhdGVfdGltZV9sdGVxJykudmFsdWUgPSAnJzsNCiAgICAgIGluZm8uZmlsdGVycyA9IFtdOw0KICAgICAgdXBkYXRlSW5mbygpOw0KICAgICAgbG9nVGFibGUuZmlsdGVyKCk7DQogICAgfQ0KICAgIC8qKiBlbmQgZmlsdGVycyAqKi8NCg0KICAgIC8vZGlzcGxheSBoYW5kbGluZw0KICAgIC8vaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMzA4MC9zZXR0aW5nLXRoZS1oZWlnaHQtb2YtYS1kaXYtZHluYW1pY2FsbHkNCiAgICBmdW5jdGlvbiByZXNpemVFbGVtZW50SGVpZ2h0KGVsZW1lbnQpIHsNCiAgICAgIHZhciBoZWlnaHQgPSAwOw0KICAgICAgdmFyIGJvZHkgPSB3aW5kb3cuZG9jdW1lbnQuYm9keTsNCiAgICAgIGlmICh3aW5kb3cuaW5uZXJIZWlnaHQpIHsNCiAgICAgICAgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0Ow0KICAgICAgfSBlbHNlIGlmIChib2R5LnBhcmVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KSB7DQogICAgICAgIGhlaWdodCA9IGJvZHkucGFyZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7DQogICAgICB9IGVsc2UgaWYgKGJvZHkgJiYgYm9keS5jbGllbnRIZWlnaHQpIHsNCiAgICAgICAgaGVpZ2h0ID0gYm9keS5jbGllbnRIZWlnaHQ7DQogICAgICB9DQogICAgICBlbGVtZW50LnN0eWxlLmhlaWdodCA9ICgoKGhlaWdodCAtIGVsZW1lbnQub2Zmc2V0VG9wKSkgKyAicHgiKTsNCiAgICB9DQoNCiAgICAvLyBhZGQgZXZlbnQgY3Jvc3MgYnJvd3Nlcg0KICAgIC8vaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMDE0OTk2My9hZGRpbmctZXZlbnQtbGlzdGVuZXItY3Jvc3MtYnJvd3Nlcg0KICAgIGZ1bmN0aW9uIGFkZEV2ZW50KGVsZW0sIGV2ZW50LCBmbikgew0KICAgICAgaWYgKGVsZW0uYWRkRXZlbnRMaXN0ZW5lcikgew0KICAgICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGZuLCBmYWxzZSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBlbGVtLmF0dGFjaEV2ZW50KCJvbiIgKyBldmVudCwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgIC8vIHNldCB0aGUgdGhpcyBwb2ludGVyIHNhbWUgYXMgYWRkRXZlbnRMaXN0ZW5lciB3aGVuIGZuIGlzIGNhbGxlZA0KICAgICAgICAgIHJldHVybiAoZm4uY2FsbChlbGVtLCB3aW5kb3cuZXZlbnQpKTsNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfQ0KICA8L3NjcmlwdD4NCjwvYm9keT4NCg0KPC9odG1sPg==';

  var logs = [];
  var selectedLogs = [];
  var currentHref = document.location.href;
  var old_fetch = unsafeWindow.fetch;

  function jsonHandler(json) {
    if (json.body != null) {
      console.log('json id: ' + json.id);
      const found = logs.find(log => log.id == json.id);
      if (found == null) {
        logs.push(json);
        console.log('logs count: ' + logs.length);
        populateSelectedLogs(currentHref);
        updateTableViewButton();
      }
    }
  }

  function populateSelectedLogs(href) {
    var queryParts = href.split('?');
    selectedLogs = [];
    if (queryParts.length > 1) {
      var query = queryParts[1].split('&');
      var parameters = { id: '', sid: [] };
      for (var i = 0; i < query.length; i++) {
        var parameterParts = query[i].split('=');
        if (parameterParts[0] == 'id') {
          parameters.id = parameterParts[1];
        } else if (parameterParts[0] == 'sid') {
          var sid = parameterParts[1];
          parameters.sid.push(sid);
          const found = logs.find(log => log.id == sid);
          if (found != null) {
            selectedLogs.push(found);
          }
        }
      }
    }
    console.log('selected log count: ' + selectedLogs.length);
  }

  function getContent() {
    if (selectedLogs.length == 0) {
      return null;
    } else {
      return selectedLogs.map(log => log.body).join('\r\n');
    }
  }

  function getRecordLocator() {
    const labels = Array.from(document.querySelectorAll('label'));
    const recordLocatorLabel = labels.find(el => el.textContent === 'Record Locator');
    return recordLocatorLabel.nextSibling.querySelector('input').value;
  }

  function getAgencyName() {
    return document.getElementById('agency-combo').value;
  }

  function getGds(content) {
    return content.includes('<PNRBFManagement') && content.includes('<OwningCRS>1G</OwningCRS>') ? 'Galileo' :
           content.includes('<PNRBFManagement') && content.includes('<OwningCRS>1V</OwningCRS>') ? 'Apollo' :
           content.includes('DIR0DPN') ? 'Worldspan' :
           content.includes('SD000766') ? 'Sabre' :
           content.includes('http://xml.amadeus.com/') ? 'Amadeus' :
           'Unknown';
  }

  function getFileDate(content) {
    var logDateMatches = content.match(new RegExp('([\\d]+)/([\\d]+)/([\\d]+) ([\\d]+):([\\d]+):([\\d]+)\\.([\\d]+)'));
    var make2Characters = function (str) { return ('0' + str).substring(str.length - 1) };
    var logDateText = '20' + logDateMatches[3] + '_' + make2Characters(logDateMatches[1]) + '_' + make2Characters(logDateMatches[2]) + '_' + make2Characters(logDateMatches[4]) + '_' + make2Characters(logDateMatches[5]) + '_' + logDateMatches[6];
    return logDateText;
  }

  function getWorkflowName(content) {
    var processRegex = new RegExp('(Workflow:|Name:) "([^"]+)"', 'g');
    var processMatches = [...content.matchAll(processRegex)];
    var processMatch = processMatches.find((element) => { return (element[2] !== 'Determine PNR Type' && element[2] !== 'Determine PNR Type - IC Offline (ALTOUR)' && element[2] !== 'Determine PNR Type - IC Online (ALTOUR)') });
    var process = processMatch ? processMatch[2] : 'Unknown';

    return process;
  }

  function getFilename(content) {
    if (content == null) {
      console.log('filename: null');
      return null;
    } else {
      var filenameParts = [getRecordLocator(), getAgencyName().replace(' ', ''), getGds(content), getFileDate(content), getWorkflowName(content)];
      return (filenameParts.join('-') + '.log');
    }
  }

  function updateTableViewButton() {
    const buttons = Array.from(document.querySelectorAll('button'));
    const snippetsButton = buttons.find(el => el.textContent === 'All Snippets' || el.textContent === 'First 15 Snippets');

    var tableViewButton = document.getElementById('TableViewButton');

    if (tableViewButton == null) {
      const snippetsParent = snippetsButton.parentNode;
      const buttonContainer = snippetsParent.parentNode;

      const tableViewDiv = document.createElement("div");
      tableViewDiv.classList.add("MuiGrid-root");
      tableViewDiv.classList.add("MuiGrid-item");

      tableViewButton = document.createElement("button");
      tableViewButton.id = "TableViewButton";
      tableViewButton.classList.add("MuiButtonBase-root");
      tableViewButton.classList.add("MuiButton-root");
      tableViewButton.classList.add("MuiButton-contained");
      tableViewButton.classList.add("MuiButton-containedSizeSmall");
      tableViewButton.classList.add("MuiButton-sizeSmall");
      tableViewDiv.appendChild(tableViewButton);

      var spanDownload = document.createElement("span");
      tableViewButton.classList.add("MuiButton-label");
      spanDownload.innerText = "View as Table";
      tableViewButton.appendChild(spanDownload);

      buttonContainer.appendChild(tableViewDiv);
    }

    var content = getContent();
    if (content != null) {
      if (tableViewButton.classList.contains('Mui-disabled')) {
        tableViewButton.classList.remove('Mui-disabled');
      }
      tableViewButton.onclick = function () {
        // https://stackoverflow.com/questions/11965087/open-a-new-tab-window-and-write-something-to-it#11967627
        // https://stackoverflow.com/a/38866224 - addresses special handling of $$
        // replace \ with \\ in content to avoid occasional errors about octal escape sequences in template literals
        var tab = window.open('about:blank', '_blank');
        tab.document.write(atob(htmlContent).replace('%FILENAME%', getFilename(content)).split('%LOGTEXT%').join(content.replace(/\\/g, '\\\\').replace(/`/g, '\\`'))); // where 'html' is a variable containing your HTML
        tab.document.close(); // to finish loading the page
      };
    } else {
      if (!tableViewButton.classList.contains('Mui-disabled')) {
        tableViewButton.classList.add('Mui-disabled');
      }
    }
  }

  // clone the response to be handled by the original handler
  function responseHandler(response) {
    var clonedResponse = response.clone();
    response.json().then(jsonHandler);
    return clonedResponse;
  }

  // replace the fetch event to allow the script to get log information
  unsafeWindow.fetch = function (resource, init) {
    console.log('request resource: ' + resource);
    return old_fetch(resource, init).then(responseHandler);
  }

  // https://stackoverflow.com/questions/3522090/event-when-window-location-href-changes
  var bodyList = document.querySelector("body")

  var observer = new MutationObserver(function (mutations) {
    mutations.forEach(function (mutation) {
      if (currentHref != document.location.href) {
        currentHref = document.location.href;
        /* Changed ! your code here */
        console.log(`currentHref: ${currentHref}`);
        populateSelectedLogs(currentHref);
        updateTableViewButton();
      }
    });
  });

  var config = {
    childList: true,
    subtree: true
  };

  observer.observe(bodyList, config);
})();