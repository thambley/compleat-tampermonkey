// ==UserScript==
// @name         View Log
// @namespace    https://support.concurcompleat.com/Logs/Snippet/
// @updateURL    https://github.com/thambley/tampermonkey-scripts/raw/master/View%20Log.user.js
// @version      0.22
// @description  View formatted log text
// @author       thambley@tlcorporate.com
// @match        https://support.concurcompleat.com/Logs/Snippet*
// @match        https://support.concurcompleat.com/logs/Snippet*
// @match        https://support.gdsx.com/logs/Snippet*
// @match        https://support.gdsx.com/Logs/Snippet*
// @grant        none
// ==/UserScript==

(function () {
  var logInfo = document.querySelector('.log-info');
  if (logInfo == null) {
    return;
  }
  var htmlContent = 'PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KCjxoZWFkPgogIDxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgogIDx0aXRsZT5sb2cgdG8gaHRtbCB1cGxvYWQ8L3RpdGxlPgogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy9sb2ctdG8taHRtbC5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+CiAgPHN0eWxlPgogICAgYm9keSB7CiAgICAgIGZvbnQtZmFtaWx5OiBzYW5zLXNlcmlmOwogICAgICBmb250LXNpemU6IDEycHg7CiAgICAgIG1hcmdpbjogMHB4OwogICAgfQoKICAgIC5jb250YWluZXIgewogICAgICBtaW4taGVpZ2h0OiA1MHB4OwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBkaXNwbGF5OiAtd2Via2l0LWZsZXg7CiAgICAgIGZsZXgtd3JhcDogd3JhcDsKICAgICAgZmxleC1kaXJlY3Rpb246IHJvdzsKICAgICAganVzdGlmeS1jb250ZW50OiBmbGV4LXN0YXJ0OwogICAgICBhbGlnbi1pdGVtczogYXV0bzsKICAgICAgYWxpZ24tY29udGVudDogY2VudGVyOwogICAgfQoKICAgIC5jb250YWluZXI6YWZ0ZXIgewogICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgLypjb250ZW50OiAiIGludmlzaWJsZSBub2RlICI7Ki8KICAgICAgZmxleDogOTk5IDk5OSBhdXRvOwogICAgfQoKICAgIC5pdGVtIHsKICAgICAgZmxleDogMCAwIGF1dG87CiAgICAgIG1hcmdpbjogNXB4OwogICAgfQoKICAgIC5wYWdlZGl2IHsKICAgICAgYm9yZGVyOiAxcHggc29saWQgd2hpdGU7CiAgICB9CgogICAgLmluZm8gewogICAgICBkaXNwbGF5OiB0YWJsZS1jZWxsOwogICAgICBwYWRkaW5nOiA1cHg7CiAgICB9CgogICAgLmhpZGRlbiB7CiAgICAgIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKICAgIH0KCiAgICAuaW5mb0xhYmVsIHsKICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgIHBhZGRpbmc6IDVweDsKICAgIH0KCiAgICAjZGF0YSB7CiAgICAgIGNsZWFyOiBib3RoOwogICAgICBvdmVyZmxvdzogYXV0bzsKICAgICAgd2lkdGg6IDEwMCU7CiAgICB9CgogICAgLnN1Ym1pdF9idG4gewogICAgICBib3JkZXItcmFkaXVzOiAyMDBweDsKICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgZm9udC1zaXplOiAxLjBlbTsKICAgICAgZm9udC1mYW1pbHk6ICdIZWx2ZXRpY2EgTmV1ZScsIEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgIGxpbmUtaGVpZ2h0OiAxMnB4OwogICAgICBtYXJnaW4tcmlnaHQ6IDNweDsKICAgICAgcGFkZGluZzogN3B4IDE2cHggNnB4OwogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgICAgIGJhY2tncm91bmQtY29sb3I6ICM4MzhhOTA7CiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IGxpbmVhci1ncmFkaWVudCgxODBkZWcsICM4MzhhOTAsICM0MTQ1NDkpOwogICAgICB0ZXh0LXNoYWRvdzogIzAwMCAwIDFweCAwOwogICAgICBib3gtc2hhZG93OiAwIDFweCAxcHggcmdiYSgwLCAwLCAwLCAwLjEpLCAwIDFweCAwIDBweCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMikgaW5zZXQ7CiAgICAgIGJvcmRlcjogc29saWQgMXB4ICM0ODRlNTM7CiAgICAgIGJvcmRlci1jb2xvcjogIzQ4NGU1MzsKICAgICAgYm9yZGVyLXRvcC1jb2xvcjogIzYxNmE3MTsKICAgICAgYm9yZGVyLXJpZ2h0LWNvbG9yOiAjNDg0ZTUzOwogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjMzYzYjNmOwogICAgICBib3JkZXItbGVmdC1jb2xvcjogIzQ4NGU1MzsKICAgICAgY29sb3I6ICNlZmVmZWY7CiAgICAgIGN1cnNvcjogcG9pbnRlcgogICAgfQoKICAgIC5yZXNldF9idG4gewogICAgICBib3JkZXItcmFkaXVzOiAyMDBweDsKICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgZm9udC1zaXplOiAxLjBlbTsKICAgICAgZm9udC1mYW1pbHk6ICdIZWx2ZXRpY2EgTmV1ZScsIEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgIGxpbmUtaGVpZ2h0OiAxMnB4OwogICAgICBtYXJnaW4tcmlnaHQ6IDNweDsKICAgICAgcGFkZGluZzogN3B4IDE2cHggNnB4OwogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7CiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IGxpbmVhci1ncmFkaWVudCgxODBkZWcsICNmZmYsICNFN0U3RTcpOwogICAgICBib3gtc2hhZG93OiAwIDFweCAxcHggcmdiYSgwLCAwLCAwLCAwLjEpLCAwIDFweCAwIDAgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjgpIGluc2V0OwogICAgICBib3JkZXI6IHNvbGlkIDFweCAjYzdjN2M3OwogICAgICBib3JkZXItY29sb3I6ICNjN2M3Yzc7CiAgICAgIGJvcmRlci10b3AtY29sb3I6ICNkM2QzZDM7CiAgICAgIGJvcmRlci1yaWdodC1jb2xvcjogI2M3YzdjNzsKICAgICAgYm9yZGVyLWJvdHRvbS1jb2xvcjogI2MyYzJjMjsKICAgICAgYm9yZGVyLWxlZnQtY29sb3I6ICNjN2M3Yzc7CiAgICAgIHRleHQtc2hhZG93OiAjZmZmIDAgMXB4IDA7CiAgICAgIGNvbG9yOiAjNUU2NDY5CiAgICB9CiAgPC9zdHlsZT4KICA8IS0tPGxpbmsgaHJlZj0ic3R5bGVzaGVldHMvc2VhcmNoLmNzcyIgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgLz4tLT4KICA8c3R5bGU+CiAgICBmb3JtI3NlYXJjaCAuc2VhcmNoX2Zvcm1fZmllbGQgewogICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgICBjbGVhcjogYm90aAogICAgfQoKICAgIGZvcm0jc2VhcmNoIGlucHV0W3R5cGU9dGV4dF0sCiAgICBmb3JtI3NlYXJjaCBpbnB1dFt0eXBlPWVtYWlsXSwKICAgIGZvcm0jc2VhcmNoIGlucHV0W3R5cGU9bnVtYmVyXSwKICAgIGZvcm0jc2VhcmNoIGlucHV0W3R5cGU9dXJsXSwKICAgIGZvcm0jc2VhcmNoIGlucHV0W3R5cGU9dGVsXSwKICAgIGZvcm0jc2VhcmNoIGlucHV0W3R5cGU9ZGF0ZV0sCiAgICBmb3JtI3NlYXJjaCBpbnB1dFt0eXBlPXRpbWVdLAogICAgZm9ybSNzZWFyY2ggdGV4dGFyZWEgewogICAgICAvKiB3aWR0aDogY2FsYyg4MCUgLSAyMnB4KTsqLwogICAgICBib3JkZXI6IDFweCBzb2xpZCAjYzlkMGQ2OwogICAgICBib3JkZXItcmFkaXVzOiAzcHg7CiAgICAgIGZvbnQtc2l6ZTogMC45NWVtOwogICAgICBmb250LWZhbWlseTogJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgb3V0bGluZTogbm9uZTsKICAgICAgcGFkZGluZzogOHB4IDEwcHggN3B4CiAgICB9CgogICAgZm9ybSNzZWFyY2ggLmJ1dHRvbnMgewogICAgICBtYXJnaW4tdG9wOiAxNXB4CiAgICB9CgogICAgZm9ybSNzZWFyY2ggc2VsZWN0IHsKICAgICAgd2lkdGg6IDI0MHB4CiAgICB9CiAgPC9zdHlsZT4KICA8IS0tPGxpbmsgaHJlZj0ic3R5bGVzaGVldHMvZmlsdGVyLmNzcyIgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgLz4tLT4KICA8c3R5bGU+CiAgICBmb3JtI2ZpbHRlciAuZmlsdGVyX2Zvcm1fZmllbGQgewogICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgICBjbGVhcjogYm90aAogICAgfQoKICAgIGZvcm0jZmlsdGVyIGlucHV0W3R5cGU9dGV4dF0sCiAgICBmb3JtI2ZpbHRlciBpbnB1dFt0eXBlPWVtYWlsXSwKICAgIGZvcm0jZmlsdGVyIGlucHV0W3R5cGU9bnVtYmVyXSwKICAgIGZvcm0jZmlsdGVyIGlucHV0W3R5cGU9dXJsXSwKICAgIGZvcm0jZmlsdGVyIGlucHV0W3R5cGU9dGVsXSwKICAgIGZvcm0jZmlsdGVyIGlucHV0W3R5cGU9ZGF0ZV0sCiAgICBmb3JtI2ZpbHRlciBpbnB1dFt0eXBlPXRpbWVdLAogICAgZm9ybSNmaWx0ZXIgdGV4dGFyZWEgewogICAgICAvKiB3aWR0aDogY2FsYyg4MCUgLSAyMnB4KTsqLwogICAgICBib3JkZXI6IDFweCBzb2xpZCAjYzlkMGQ2OwogICAgICBib3JkZXItcmFkaXVzOiAzcHg7CiAgICAgIGZvbnQtc2l6ZTogMC45NWVtOwogICAgICBmb250LWZhbWlseTogJ0hlbHZldGljYSBOZXVlJywgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgb3V0bGluZTogbm9uZTsKICAgICAgcGFkZGluZzogOHB4IDEwcHggN3B4CiAgICB9CgogICAgZm9ybSNmaWx0ZXIgLmJ1dHRvbnMgewogICAgICBtYXJnaW4tdG9wOiAxNXB4CiAgICB9CgogICAgZm9ybSNmaWx0ZXIgc2VsZWN0IHsKICAgICAgd2lkdGg6IDI0MHB4CiAgICB9CiAgPC9zdHlsZT4KICA8IS0tPGxpbmsgaHJlZj0ic3R5bGVzaGVldHMvb25vZmYuY3NzIiByZWw9InN0eWxlc2hlZXQiIHR5cGU9InRleHQvY3NzIiAvPi0tPgogIDxzdHlsZT4KICAgIC8qIGh0dHBzOi8vcHJvdG8uaW8vZnJlZWJpZXMvb25vZmYvICovCgogICAgLm9ub2Zmc3dpdGNoIHsKICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICB3aWR0aDogNzBweDsKICAgICAgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsKICAgICAgLW1vei11c2VyLXNlbGVjdDogbm9uZTsKICAgICAgLW1zLXVzZXItc2VsZWN0OiBub25lOwogICAgfQoKICAgIC5vbm9mZnN3aXRjaC1jaGVja2JveCB7CiAgICAgIGRpc3BsYXk6IG5vbmU7CiAgICB9CgogICAgLm9ub2Zmc3dpdGNoLWxhYmVsIHsKICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgYm9yZGVyOiAycHggc29saWQgIzk5OTk5OTsKICAgICAgYm9yZGVyLXJhZGl1czogMTVweDsKICAgIH0KCiAgICAub25vZmZzd2l0Y2gtaW5uZXIgewogICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgd2lkdGg6IDIwMCU7CiAgICAgIG1hcmdpbi1sZWZ0OiAtMTAwJTsKICAgICAgdHJhbnNpdGlvbjogbWFyZ2luIDAuM3MgZWFzZS1pbiAwczsKICAgIH0KCiAgICAub25vZmZzd2l0Y2gtaW5uZXI6YmVmb3JlLAogICAgLm9ub2Zmc3dpdGNoLWlubmVyOmFmdGVyIHsKICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgIGZsb2F0OiBsZWZ0OwogICAgICB3aWR0aDogNTAlOwogICAgICBoZWlnaHQ6IDI1cHg7CiAgICAgIHBhZGRpbmc6IDA7CiAgICAgIGxpbmUtaGVpZ2h0OiAyNXB4OwogICAgICBmb250LXNpemU6IDEycHg7CiAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgZm9udC1mYW1pbHk6IFRyZWJ1Y2hldCwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgfQoKICAgIC5vbm9mZnN3aXRjaC1pbm5lcjpiZWZvcmUgewogICAgICBjb250ZW50OiAiT04iOwogICAgICBwYWRkaW5nLWxlZnQ6IDEwcHg7CiAgICAgIGJhY2tncm91bmQtY29sb3I6ICMzNEE3QzE7CiAgICAgIGNvbG9yOiAjRkZGRkZGOwogICAgfQoKICAgIC5vbm9mZnN3aXRjaC1pbm5lcjphZnRlciB7CiAgICAgIGNvbnRlbnQ6ICJPRkYiOwogICAgICBwYWRkaW5nLXJpZ2h0OiAxMHB4OwogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRUVFRUVFOwogICAgICBjb2xvcjogIzk5OTk5OTsKICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7CiAgICB9CgogICAgLm9ub2Zmc3dpdGNoLXN3aXRjaCB7CiAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICB3aWR0aDogMTVweDsKICAgICAgbWFyZ2luOiA1cHg7CiAgICAgIGJhY2tncm91bmQ6ICNGRkZGRkY7CiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgdG9wOiAwOwogICAgICBib3R0b206IDA7CiAgICAgIHJpZ2h0OiA0MXB4OwogICAgICBib3JkZXI6IDJweCBzb2xpZCAjOTk5OTk5OwogICAgICBib3JkZXItcmFkaXVzOiAxNXB4OwogICAgICB0cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlLWluIDBzOwogICAgfQoKICAgIC5vbm9mZnN3aXRjaC1jaGVja2JveDpjaGVja2VkKy5vbm9mZnN3aXRjaC1sYWJlbCAub25vZmZzd2l0Y2gtaW5uZXIgewogICAgICBtYXJnaW4tbGVmdDogMDsKICAgIH0KCiAgICAub25vZmZzd2l0Y2gtY2hlY2tib3g6Y2hlY2tlZCsub25vZmZzd2l0Y2gtbGFiZWwgLm9ub2Zmc3dpdGNoLXN3aXRjaCB7CiAgICAgIHJpZ2h0OiAwcHg7CiAgICB9CiAgPC9zdHlsZT4KICA8IS0taHR0cDovL3d3dy5saXN0anMuY29tLy0tPgogIDwhLS08bGluayBocmVmPSJzdHlsZXNoZWV0cy9saXN0LmNzcyIgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgLz4tLT4KICA8c3R5bGU+CiAgICAvKiB0YWJsZXMgKi8KICAgIHRhYmxlLmxpc3RhYmxlIHRyOmhvdmVyIHRkIHsKICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2YyZjJmMjsKICAgIH0KCiAgICB0YWJsZS5saXN0YWJsZSB0ZCwKICAgIHRhYmxlLmxpc3RhYmxlIHRoIHsKICAgICAgcGFkZGluZzogNXB4OwogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsKICAgIH0KCiAgICB0YWJsZS5saXN0YWJsZSB7CiAgICAgIGJhY2tncm91bmQtY29sb3I6IGJsYWNrOwogICAgfQoKICAgIHRkLnRleHQgewogICAgICB3aGl0ZS1zcGFjZTogcHJlOwogICAgICBmb250LWZhbWlseTogY291cmllciBuZXc7CiAgICB9CgogICAgLnBhZ2luYXRpb24gbGkgewogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgIHBhZGRpbmc6IDVweDsKICAgIH0KCiAgICAucGFnaW5hdGlvbiBsaS5hY3RpdmUgewogICAgICBib3JkZXI6IDFweCBzb2xpZCBibGFjazsKICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgfQoKICAgIC5wYWdpbmF0aW9uIGxpIGEucGFnZSB7CiAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgIGNvbG9yOiBibGFjazsKICAgIH0KCiAgICAuc2VhcmNoIHsKICAgICAgYm9yZGVyOiBzb2xpZCAxcHggI2NjYzsKICAgICAgYm9yZGVyLXJhZGl1czogNXB4OwogICAgICBwYWRkaW5nOiA3cHggMTRweDsKICAgICAgbWFyZ2luLXRvcDogMTBweAogICAgfQoKICAgIHRhYmxlLnNvcnRhYmxlIHRoZWFkIHRyIC5zb3J0IHsKICAgICAgdGV4dC1hbGlnbjogbGVmdDsKICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEZRQUpBSUFBQUNNdE1QLy8veUg1QkFFQUFBRUFMQUFBQUFBVkFBa0FBQUlYakkrQXl3bmFZbmhVTW9xdDNnWlhQbVZnOTR5SlZRQUFPdz09KTsKICAgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICAgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyIHJpZ2h0OwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgIHBhZGRpbmctcmlnaHQ6IDIwcHg7CiAgICB9CgogICAgdGFibGUuc29ydGFibGUgdGhlYWQgdHIgLmFzYyB7CiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhGUUFFQUlBQUFDTXRNUC8vL3lINUJBRUFBQUVBTEFBQUFBQVZBQVFBQUFJTmpCK2dDK2pQMnB0bjBXc2tMUUE3KTsKICAgIH0KCiAgICB0YWJsZS5zb3J0YWJsZSB0aGVhZCB0ciAuZGVzYyB7CiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhGUUFFQUlBQUFDTXRNUC8vL3lINUJBRUFBQUVBTEFBQUFBQVZBQVFBQUFJTmpJOEJ5YTJ3bklOVU1vcFpBUUE3KTsKICAgIH0KCiAgICB0YWJsZS5zb3J0YWJsZSB0aGVhZCB0ciAuYXNjLAogICAgdGFibGUuc29ydGFibGUgdGhlYWQgdHIgLmRlc2MgewogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjOGRiZGQ4OwogICAgfQogIDwvc3R5bGU+CiAgPCEtLTxzY3JpcHQgc3JjPSJqYXZhc2NyaXB0cy9saXN0LmpzIj48L3NjcmlwdD4tLT4KICA8c2NyaXB0PgogIC8vIExpc3QuanMgdjEuMy4wIChodHRwOi8vd3d3Lmxpc3Rqcy5jb20pIGJ5IEpvbm55IFN0csO2bWJlcmcgKGh0dHA6Ly9qYXZ2ZS5jb20pCihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciK28rIiciKTt0aHJvdyBmLmNvZGU9Ik1PRFVMRV9OT1RfRk9VTkQiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09ImZ1bmN0aW9uIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24oIHdpbmRvdywgdW5kZWZpbmVkICkgewoidXNlIHN0cmljdCI7Cgp2YXIgZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQsCiAgZ2V0QnlDbGFzcyA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL2dldC1ieS1jbGFzcycpLAogIGV4dGVuZCA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL2V4dGVuZCcpLAogIGluZGV4T2YgPSByZXF1aXJlKCcuL3NyYy91dGlscy9pbmRleC1vZicpLAogIGV2ZW50cyA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL2V2ZW50cycpLAogIHRvU3RyaW5nID0gcmVxdWlyZSgnLi9zcmMvdXRpbHMvdG8tc3RyaW5nJyksCiAgbmF0dXJhbFNvcnQgPSByZXF1aXJlKCcuL3NyYy91dGlscy9uYXR1cmFsLXNvcnQnKSwKICBjbGFzc2VzID0gcmVxdWlyZSgnLi9zcmMvdXRpbHMvY2xhc3NlcycpLAogIGdldEF0dHJpYnV0ZSA9IHJlcXVpcmUoJy4vc3JjL3V0aWxzL2dldC1hdHRyaWJ1dGUnKSwKICB0b0FycmF5ID0gcmVxdWlyZSgnLi9zcmMvdXRpbHMvdG8tYXJyYXknKTsKCnZhciBMaXN0ID0gZnVuY3Rpb24oaWQsIG9wdGlvbnMsIHZhbHVlcykgewoKICB2YXIgc2VsZiA9IHRoaXMsCiAgICBpbml0LAogICAgSXRlbSA9IHJlcXVpcmUoJy4vc3JjL2l0ZW0nKShzZWxmKSwKICAgIGFkZEFzeW5jID0gcmVxdWlyZSgnLi9zcmMvYWRkLWFzeW5jJykoc2VsZik7CgogIGluaXQgPSB7CiAgICBzdGFydDogZnVuY3Rpb24oKSB7CiAgICAgIHNlbGYubGlzdENsYXNzICAgICAgPSAibGlzdCI7CiAgICAgIHNlbGYuc2VhcmNoQ2xhc3MgICAgPSAic2VhcmNoIjsKICAgICAgc2VsZi5zb3J0Q2xhc3MgICAgICA9ICJzb3J0IjsKICAgICAgc2VsZi5wYWdlICAgICAgICAgICA9IDEwMDAwOwogICAgICBzZWxmLmkgICAgICAgICAgICAgID0gMTsKICAgICAgc2VsZi5pdGVtcyAgICAgICAgICA9IFtdOwogICAgICBzZWxmLnZpc2libGVJdGVtcyAgID0gW107CiAgICAgIHNlbGYubWF0Y2hpbmdJdGVtcyAgPSBbXTsKICAgICAgc2VsZi5zZWFyY2hlZCAgICAgICA9IGZhbHNlOwogICAgICBzZWxmLmZpbHRlcmVkICAgICAgID0gZmFsc2U7CiAgICAgIHNlbGYuc2VhcmNoQ29sdW1ucyAgPSB1bmRlZmluZWQ7CiAgICAgIHNlbGYuaGFuZGxlcnMgICAgICAgPSB7ICd1cGRhdGVkJzogW10gfTsKICAgICAgc2VsZi5wbHVnaW5zICAgICAgICA9IHt9OwogICAgICBzZWxmLnZhbHVlTmFtZXMgICAgID0gW107CiAgICAgIHNlbGYudXRpbHMgICAgICAgICAgPSB7CiAgICAgICAgZ2V0QnlDbGFzczogZ2V0QnlDbGFzcywKICAgICAgICBleHRlbmQ6IGV4dGVuZCwKICAgICAgICBpbmRleE9mOiBpbmRleE9mLAogICAgICAgIGV2ZW50czogZXZlbnRzLAogICAgICAgIHRvU3RyaW5nOiB0b1N0cmluZywKICAgICAgICBuYXR1cmFsU29ydDogbmF0dXJhbFNvcnQsCiAgICAgICAgY2xhc3NlczogY2xhc3NlcywKICAgICAgICBnZXRBdHRyaWJ1dGU6IGdldEF0dHJpYnV0ZSwKICAgICAgICB0b0FycmF5OiB0b0FycmF5CiAgICAgIH07CgogICAgICBzZWxmLnV0aWxzLmV4dGVuZChzZWxmLCBvcHRpb25zKTsKCiAgICAgIHNlbGYubGlzdENvbnRhaW5lciA9ICh0eXBlb2YoaWQpID09PSAnc3RyaW5nJykgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkgOiBpZDsKICAgICAgaWYgKCFzZWxmLmxpc3RDb250YWluZXIpIHsgcmV0dXJuOyB9CiAgICAgIHNlbGYubGlzdCAgICAgICA9IGdldEJ5Q2xhc3Moc2VsZi5saXN0Q29udGFpbmVyLCBzZWxmLmxpc3RDbGFzcywgdHJ1ZSk7CgogICAgICBzZWxmLnBhcnNlICAgICAgPSByZXF1aXJlKCcuL3NyYy9wYXJzZScpKHNlbGYpOwogICAgICBzZWxmLnRlbXBsYXRlciAgPSByZXF1aXJlKCcuL3NyYy90ZW1wbGF0ZXInKShzZWxmKTsKICAgICAgc2VsZi5zZWFyY2ggICAgID0gcmVxdWlyZSgnLi9zcmMvc2VhcmNoJykoc2VsZik7CiAgICAgIHNlbGYuZmlsdGVyICAgICA9IHJlcXVpcmUoJy4vc3JjL2ZpbHRlcicpKHNlbGYpOwogICAgICBzZWxmLnNvcnQgICAgICAgPSByZXF1aXJlKCcuL3NyYy9zb3J0Jykoc2VsZik7CgogICAgICB0aGlzLmhhbmRsZXJzKCk7CiAgICAgIHRoaXMuaXRlbXMoKTsKICAgICAgc2VsZi51cGRhdGUoKTsKICAgICAgdGhpcy5wbHVnaW5zKCk7CiAgICB9LAogICAgaGFuZGxlcnM6IGZ1bmN0aW9uKCkgewogICAgICBmb3IgKHZhciBoYW5kbGVyIGluIHNlbGYuaGFuZGxlcnMpIHsKICAgICAgICBpZiAoc2VsZltoYW5kbGVyXSkgewogICAgICAgICAgc2VsZi5vbihoYW5kbGVyLCBzZWxmW2hhbmRsZXJdKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBpdGVtczogZnVuY3Rpb24oKSB7CiAgICAgIHNlbGYucGFyc2Uoc2VsZi5saXN0KTsKICAgICAgaWYgKHZhbHVlcyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgc2VsZi5hZGQodmFsdWVzKTsKICAgICAgfQogICAgfSwKICAgIHBsdWdpbnM6IGZ1bmN0aW9uKCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGYucGx1Z2lucy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBwbHVnaW4gPSBzZWxmLnBsdWdpbnNbaV07CiAgICAgICAgc2VsZltwbHVnaW4ubmFtZV0gPSBwbHVnaW47CiAgICAgICAgcGx1Z2luLmluaXQoc2VsZiwgTGlzdCk7CiAgICAgIH0KICAgIH0KICB9OwoKICAvKgogICogUmUtcGFyc2UgdGhlIExpc3QsIHVzZSBpZiBodG1sIGhhdmUgY2hhbmdlZAogICovCiAgdGhpcy5yZUluZGV4ID0gZnVuY3Rpb24oKSB7CiAgICBzZWxmLml0ZW1zICAgICAgICAgID0gW107CiAgICBzZWxmLnZpc2libGVJdGVtcyAgID0gW107CiAgICBzZWxmLm1hdGNoaW5nSXRlbXMgID0gW107CiAgICBzZWxmLnNlYXJjaGVkICAgICAgID0gZmFsc2U7CiAgICBzZWxmLmZpbHRlcmVkICAgICAgID0gZmFsc2U7CiAgICBzZWxmLnBhcnNlKHNlbGYubGlzdCk7CiAgfTsKCiAgdGhpcy50b0pTT04gPSBmdW5jdGlvbigpIHsKICAgIHZhciBqc29uID0gW107CiAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBzZWxmLml0ZW1zLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAganNvbi5wdXNoKHNlbGYuaXRlbXNbaV0udmFsdWVzKCkpOwogICAgfQogICAgcmV0dXJuIGpzb247CiAgfTsKCgogIC8qCiAgKiBBZGQgb2JqZWN0IHRvIGxpc3QKICAqLwogIHRoaXMuYWRkID0gZnVuY3Rpb24odmFsdWVzLCBjYWxsYmFjaykgewogICAgaWYgKHZhbHVlcy5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgIGFkZEFzeW5jKHZhbHVlcywgY2FsbGJhY2spOwogICAgICByZXR1cm47CiAgICB9CiAgICB2YXIgYWRkZWQgPSBbXSwKICAgICAgbm90Q3JlYXRlID0gZmFsc2U7CiAgICBpZiAodmFsdWVzWzBdID09PSB1bmRlZmluZWQpewogICAgICB2YWx1ZXMgPSBbdmFsdWVzXTsKICAgIH0KICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IHZhbHVlcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgIHZhciBpdGVtID0gbnVsbDsKICAgICAgbm90Q3JlYXRlID0gKHNlbGYuaXRlbXMubGVuZ3RoID4gc2VsZi5wYWdlKSA/IHRydWUgOiBmYWxzZTsKICAgICAgaXRlbSA9IG5ldyBJdGVtKHZhbHVlc1tpXSwgdW5kZWZpbmVkLCBub3RDcmVhdGUpOwogICAgICBzZWxmLml0ZW1zLnB1c2goaXRlbSk7CiAgICAgIGFkZGVkLnB1c2goaXRlbSk7CiAgICB9CiAgICBzZWxmLnVwZGF0ZSgpOwogICAgcmV0dXJuIGFkZGVkOwogIH07CgoJdGhpcy5zaG93ID0gZnVuY3Rpb24oaSwgcGFnZSkgewoJCXRoaXMuaSA9IGk7CgkJdGhpcy5wYWdlID0gcGFnZTsKCQlzZWxmLnVwZGF0ZSgpOwogICAgcmV0dXJuIHNlbGY7Cgl9OwoKICAvKiBSZW1vdmVzIG9iamVjdCBmcm9tIGxpc3QuCiAgKiBMb29wcyB0aHJvdWdoIHRoZSBsaXN0IGFuZCByZW1vdmVzIG9iamVjdHMgd2hlcmUKICAqIHByb3BlcnR5ICJ2YWx1ZW5hbWUiID09PSB2YWx1ZQogICovCiAgdGhpcy5yZW1vdmUgPSBmdW5jdGlvbih2YWx1ZU5hbWUsIHZhbHVlLCBvcHRpb25zKSB7CiAgICB2YXIgZm91bmQgPSAwOwogICAgZm9yICh2YXIgaSA9IDAsIGlsID0gc2VsZi5pdGVtcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgIGlmIChzZWxmLml0ZW1zW2ldLnZhbHVlcygpW3ZhbHVlTmFtZV0gPT0gdmFsdWUpIHsKICAgICAgICBzZWxmLnRlbXBsYXRlci5yZW1vdmUoc2VsZi5pdGVtc1tpXSwgb3B0aW9ucyk7CiAgICAgICAgc2VsZi5pdGVtcy5zcGxpY2UoaSwxKTsKICAgICAgICBpbC0tOwogICAgICAgIGktLTsKICAgICAgICBmb3VuZCsrOwogICAgICB9CiAgICB9CiAgICBzZWxmLnVwZGF0ZSgpOwogICAgcmV0dXJuIGZvdW5kOwogIH07CgogIC8qIEdldHMgdGhlIG9iamVjdHMgaW4gdGhlIGxpc3Qgd2hpY2gKICAqIHByb3BlcnR5ICJ2YWx1ZU5hbWUiID09PSB2YWx1ZQogICovCiAgdGhpcy5nZXQgPSBmdW5jdGlvbih2YWx1ZU5hbWUsIHZhbHVlKSB7CiAgICB2YXIgbWF0Y2hlZEl0ZW1zID0gW107CiAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBzZWxmLml0ZW1zLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgdmFyIGl0ZW0gPSBzZWxmLml0ZW1zW2ldOwogICAgICBpZiAoaXRlbS52YWx1ZXMoKVt2YWx1ZU5hbWVdID09IHZhbHVlKSB7CiAgICAgICAgbWF0Y2hlZEl0ZW1zLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBtYXRjaGVkSXRlbXM7CiAgfTsKCiAgLyoKICAqIEdldCBzaXplIG9mIHRoZSBsaXN0CiAgKi8KICB0aGlzLnNpemUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBzZWxmLml0ZW1zLmxlbmd0aDsKICB9OwoKICAvKgogICogUmVtb3ZlcyBhbGwgaXRlbXMgZnJvbSB0aGUgbGlzdAogICovCiAgdGhpcy5jbGVhciA9IGZ1bmN0aW9uKCkgewogICAgc2VsZi50ZW1wbGF0ZXIuY2xlYXIoKTsKICAgIHNlbGYuaXRlbXMgPSBbXTsKICAgIHJldHVybiBzZWxmOwogIH07CgogIHRoaXMub24gPSBmdW5jdGlvbihldmVudCwgY2FsbGJhY2spIHsKICAgIHNlbGYuaGFuZGxlcnNbZXZlbnRdLnB1c2goY2FsbGJhY2spOwogICAgcmV0dXJuIHNlbGY7CiAgfTsKCiAgdGhpcy5vZmYgPSBmdW5jdGlvbihldmVudCwgY2FsbGJhY2spIHsKICAgIHZhciBlID0gc2VsZi5oYW5kbGVyc1tldmVudF07CiAgICB2YXIgaW5kZXggPSBpbmRleE9mKGUsIGNhbGxiYWNrKTsKICAgIGlmIChpbmRleCA+IC0xKSB7CiAgICAgIGUuc3BsaWNlKGluZGV4LCAxKTsKICAgIH0KICAgIHJldHVybiBzZWxmOwogIH07CgogIHRoaXMudHJpZ2dlciA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICB2YXIgaSA9IHNlbGYuaGFuZGxlcnNbZXZlbnRdLmxlbmd0aDsKICAgIHdoaWxlKGktLSkgewogICAgICBzZWxmLmhhbmRsZXJzW2V2ZW50XVtpXShzZWxmKTsKICAgIH0KICAgIHJldHVybiBzZWxmOwogIH07CgogIHRoaXMucmVzZXQgPSB7CiAgICBmaWx0ZXI6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgaXMgPSBzZWxmLml0ZW1zLAogICAgICAgIGlsID0gaXMubGVuZ3RoOwogICAgICB3aGlsZSAoaWwtLSkgewogICAgICAgIGlzW2lsXS5maWx0ZXJlZCA9IGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiBzZWxmOwogICAgfSwKICAgIHNlYXJjaDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBpcyA9IHNlbGYuaXRlbXMsCiAgICAgICAgaWwgPSBpcy5sZW5ndGg7CiAgICAgIHdoaWxlIChpbC0tKSB7CiAgICAgICAgaXNbaWxdLmZvdW5kID0gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CiAgfTsKCiAgdGhpcy51cGRhdGUgPSBmdW5jdGlvbigpIHsKICAgIHZhciBpcyA9IHNlbGYuaXRlbXMsCgkJCWlsID0gaXMubGVuZ3RoOwoKICAgIHNlbGYudmlzaWJsZUl0ZW1zID0gW107CiAgICBzZWxmLm1hdGNoaW5nSXRlbXMgPSBbXTsKICAgIHNlbGYudGVtcGxhdGVyLmNsZWFyKCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlsOyBpKyspIHsKICAgICAgaWYgKGlzW2ldLm1hdGNoaW5nKCkgJiYgKChzZWxmLm1hdGNoaW5nSXRlbXMubGVuZ3RoKzEpID49IHNlbGYuaSAmJiBzZWxmLnZpc2libGVJdGVtcy5sZW5ndGggPCBzZWxmLnBhZ2UpKSB7CiAgICAgICAgaXNbaV0uc2hvdygpOwogICAgICAgIHNlbGYudmlzaWJsZUl0ZW1zLnB1c2goaXNbaV0pOwogICAgICAgIHNlbGYubWF0Y2hpbmdJdGVtcy5wdXNoKGlzW2ldKTsKICAgICAgfSBlbHNlIGlmIChpc1tpXS5tYXRjaGluZygpKSB7CiAgICAgICAgc2VsZi5tYXRjaGluZ0l0ZW1zLnB1c2goaXNbaV0pOwogICAgICAgIGlzW2ldLmhpZGUoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpc1tpXS5oaWRlKCk7CiAgICAgIH0KICAgIH0KICAgIHNlbGYudHJpZ2dlcigndXBkYXRlZCcpOwogICAgcmV0dXJuIHNlbGY7CiAgfTsKCiAgaW5pdC5zdGFydCgpOwp9OwoKCi8vIEFNRCBzdXBwb3J0CmlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICBkZWZpbmUoZnVuY3Rpb24gKCkgeyByZXR1cm4gTGlzdDsgfSk7Cn0KbW9kdWxlLmV4cG9ydHMgPSBMaXN0Owp3aW5kb3cuTGlzdCA9IExpc3Q7Cgp9KSh3aW5kb3cpOwoKfSx7Ii4vc3JjL2FkZC1hc3luYyI6MiwiLi9zcmMvZmlsdGVyIjozLCIuL3NyYy9pdGVtIjo0LCIuL3NyYy9wYXJzZSI6NSwiLi9zcmMvc2VhcmNoIjo2LCIuL3NyYy9zb3J0Ijo3LCIuL3NyYy90ZW1wbGF0ZXIiOjgsIi4vc3JjL3V0aWxzL2NsYXNzZXMiOjksIi4vc3JjL3V0aWxzL2V2ZW50cyI6MTAsIi4vc3JjL3V0aWxzL2V4dGVuZCI6MTEsIi4vc3JjL3V0aWxzL2dldC1hdHRyaWJ1dGUiOjEyLCIuL3NyYy91dGlscy9nZXQtYnktY2xhc3MiOjEzLCIuL3NyYy91dGlscy9pbmRleC1vZiI6MTQsIi4vc3JjL3V0aWxzL25hdHVyYWwtc29ydCI6MTUsIi4vc3JjL3V0aWxzL3RvLWFycmF5IjoxNiwiLi9zcmMvdXRpbHMvdG8tc3RyaW5nIjoxN31dLDI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGxpc3QpIHsKICB2YXIgYWRkQXN5bmMgPSBmdW5jdGlvbih2YWx1ZXMsIGNhbGxiYWNrLCBpdGVtcykgewogICAgdmFyIHZhbHVlc1RvQWRkID0gdmFsdWVzLnNwbGljZSgwLCA1MCk7CiAgICBpdGVtcyA9IGl0ZW1zIHx8IFtdOwogICAgaXRlbXMgPSBpdGVtcy5jb25jYXQobGlzdC5hZGQodmFsdWVzVG9BZGQpKTsKICAgIGlmICh2YWx1ZXMubGVuZ3RoID4gMCkgewogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGFkZEFzeW5jKHZhbHVlcywgY2FsbGJhY2ssIGl0ZW1zKTsKICAgICAgfSwgMSk7CiAgICB9IGVsc2UgewogICAgICBsaXN0LnVwZGF0ZSgpOwogICAgICBjYWxsYmFjayhpdGVtcyk7CiAgICB9CiAgfTsKICByZXR1cm4gYWRkQXN5bmM7Cn07Cgp9LHt9XSwzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihsaXN0KSB7CgogIC8vIEFkZCBoYW5kbGVycwogIGxpc3QuaGFuZGxlcnMuZmlsdGVyU3RhcnQgPSBsaXN0LmhhbmRsZXJzLmZpbHRlclN0YXJ0IHx8IFtdOwogIGxpc3QuaGFuZGxlcnMuZmlsdGVyQ29tcGxldGUgPSBsaXN0LmhhbmRsZXJzLmZpbHRlckNvbXBsZXRlIHx8IFtdOwoKICByZXR1cm4gZnVuY3Rpb24oZmlsdGVyRnVuY3Rpb24pIHsKICAgIGxpc3QudHJpZ2dlcignZmlsdGVyU3RhcnQnKTsKICAgIGxpc3QuaSA9IDE7IC8vIFJlc2V0IHBhZ2luZwogICAgbGlzdC5yZXNldC5maWx0ZXIoKTsKICAgIGlmIChmaWx0ZXJGdW5jdGlvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGxpc3QuZmlsdGVyZWQgPSBmYWxzZTsKICAgIH0gZWxzZSB7CiAgICAgIGxpc3QuZmlsdGVyZWQgPSB0cnVlOwogICAgICB2YXIgaXMgPSBsaXN0Lml0ZW1zOwogICAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBpcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgdmFyIGl0ZW0gPSBpc1tpXTsKICAgICAgICBpZiAoZmlsdGVyRnVuY3Rpb24oaXRlbSkpIHsKICAgICAgICAgIGl0ZW0uZmlsdGVyZWQgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpdGVtLmZpbHRlcmVkID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBsaXN0LnVwZGF0ZSgpOwogICAgbGlzdC50cmlnZ2VyKCdmaWx0ZXJDb21wbGV0ZScpOwogICAgcmV0dXJuIGxpc3QudmlzaWJsZUl0ZW1zOwogIH07Cn07Cgp9LHt9XSw0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihsaXN0KSB7CiAgcmV0dXJuIGZ1bmN0aW9uKGluaXRWYWx1ZXMsIGVsZW1lbnQsIG5vdENyZWF0ZSkgewogICAgdmFyIGl0ZW0gPSB0aGlzOwoKICAgIHRoaXMuX3ZhbHVlcyA9IHt9OwoKICAgIHRoaXMuZm91bmQgPSBmYWxzZTsgLy8gU2hvdyBpZiBsaXN0LnNlYXJjaGVkID09IHRydWUgYW5kIHRoaXMuZm91bmQgPT0gdHJ1ZQogICAgdGhpcy5maWx0ZXJlZCA9IGZhbHNlOy8vIFNob3cgaWYgbGlzdC5maWx0ZXJlZCA9PSB0cnVlIGFuZCB0aGlzLmZpbHRlcmVkID09IHRydWUKCiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKGluaXRWYWx1ZXMsIGVsZW1lbnQsIG5vdENyZWF0ZSkgewogICAgICBpZiAoZWxlbWVudCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKG5vdENyZWF0ZSkgewogICAgICAgICAgaXRlbS52YWx1ZXMoaW5pdFZhbHVlcywgbm90Q3JlYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaXRlbS52YWx1ZXMoaW5pdFZhbHVlcyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGl0ZW0uZWxtID0gZWxlbWVudDsKICAgICAgICB2YXIgdmFsdWVzID0gbGlzdC50ZW1wbGF0ZXIuZ2V0KGl0ZW0sIGluaXRWYWx1ZXMpOwogICAgICAgIGl0ZW0udmFsdWVzKHZhbHVlcyk7CiAgICAgIH0KICAgIH07CgogICAgdGhpcy52YWx1ZXMgPSBmdW5jdGlvbihuZXdWYWx1ZXMsIG5vdENyZWF0ZSkgewogICAgICBpZiAobmV3VmFsdWVzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBmb3IodmFyIG5hbWUgaW4gbmV3VmFsdWVzKSB7CiAgICAgICAgICBpdGVtLl92YWx1ZXNbbmFtZV0gPSBuZXdWYWx1ZXNbbmFtZV07CiAgICAgICAgfQogICAgICAgIGlmIChub3RDcmVhdGUgIT09IHRydWUpIHsKICAgICAgICAgIGxpc3QudGVtcGxhdGVyLnNldChpdGVtLCBpdGVtLnZhbHVlcygpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGl0ZW0uX3ZhbHVlczsKICAgICAgfQogICAgfTsKCiAgICB0aGlzLnNob3cgPSBmdW5jdGlvbigpIHsKICAgICAgbGlzdC50ZW1wbGF0ZXIuc2hvdyhpdGVtKTsKICAgIH07CgogICAgdGhpcy5oaWRlID0gZnVuY3Rpb24oKSB7CiAgICAgIGxpc3QudGVtcGxhdGVyLmhpZGUoaXRlbSk7CiAgICB9OwoKICAgIHRoaXMubWF0Y2hpbmcgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICgKICAgICAgICAobGlzdC5maWx0ZXJlZCAmJiBsaXN0LnNlYXJjaGVkICYmIGl0ZW0uZm91bmQgJiYgaXRlbS5maWx0ZXJlZCkgfHwKICAgICAgICAobGlzdC5maWx0ZXJlZCAmJiAhbGlzdC5zZWFyY2hlZCAmJiBpdGVtLmZpbHRlcmVkKSB8fAogICAgICAgICghbGlzdC5maWx0ZXJlZCAmJiBsaXN0LnNlYXJjaGVkICYmIGl0ZW0uZm91bmQpIHx8CiAgICAgICAgKCFsaXN0LmZpbHRlcmVkICYmICFsaXN0LnNlYXJjaGVkKQogICAgICApOwogICAgfTsKCiAgICB0aGlzLnZpc2libGUgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIChpdGVtLmVsbSAmJiAoaXRlbS5lbG0ucGFyZW50Tm9kZSA9PSBsaXN0Lmxpc3QpKSA/IHRydWUgOiBmYWxzZTsKICAgIH07CgogICAgaW5pdChpbml0VmFsdWVzLCBlbGVtZW50LCBub3RDcmVhdGUpOwogIH07Cn07Cgp9LHt9XSw1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihsaXN0KSB7CgogIHZhciBJdGVtID0gcmVxdWlyZSgnLi9pdGVtJykobGlzdCk7CgogIHZhciBnZXRDaGlsZHJlbiA9IGZ1bmN0aW9uKHBhcmVudCkgewogICAgdmFyIG5vZGVzID0gcGFyZW50LmNoaWxkTm9kZXMsCiAgICAgIGl0ZW1zID0gW107CiAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBub2Rlcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgIC8vIE9ubHkgdGV4dG5vZGVzIGhhdmUgYSBkYXRhIGF0dHJpYnV0ZQogICAgICBpZiAobm9kZXNbaV0uZGF0YSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaXRlbXMucHVzaChub2Rlc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBpdGVtczsKICB9OwoKICB2YXIgcGFyc2UgPSBmdW5jdGlvbihpdGVtRWxlbWVudHMsIHZhbHVlTmFtZXMpIHsKICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IGl0ZW1FbGVtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgIGxpc3QuaXRlbXMucHVzaChuZXcgSXRlbSh2YWx1ZU5hbWVzLCBpdGVtRWxlbWVudHNbaV0pKTsKICAgIH0KICB9OwogIHZhciBwYXJzZUFzeW5jID0gZnVuY3Rpb24oaXRlbUVsZW1lbnRzLCB2YWx1ZU5hbWVzKSB7CiAgICB2YXIgaXRlbXNUb0luZGV4ID0gaXRlbUVsZW1lbnRzLnNwbGljZSgwLCA1MCk7IC8vIFRPRE86IElmIDwgMTAwIGl0ZW1zLCB3aGF0IGhhcHBlbnMgaW4gSUUgZXRjPwogICAgcGFyc2UoaXRlbXNUb0luZGV4LCB2YWx1ZU5hbWVzKTsKICAgIGlmIChpdGVtRWxlbWVudHMubGVuZ3RoID4gMCkgewogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHBhcnNlQXN5bmMoaXRlbUVsZW1lbnRzLCB2YWx1ZU5hbWVzKTsKICAgICAgfSwgMSk7CiAgICB9IGVsc2UgewogICAgICBsaXN0LnVwZGF0ZSgpOwogICAgICBsaXN0LnRyaWdnZXIoJ3BhcnNlQ29tcGxldGUnKTsKICAgIH0KICB9OwoKICBsaXN0LmhhbmRsZXJzLnBhcnNlQ29tcGxldGUgPSBsaXN0LmhhbmRsZXJzLnBhcnNlQ29tcGxldGUgfHwgW107CgogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHZhciBpdGVtc1RvSW5kZXggPSBnZXRDaGlsZHJlbihsaXN0Lmxpc3QpLAogICAgICB2YWx1ZU5hbWVzID0gbGlzdC52YWx1ZU5hbWVzOwoKICAgIGlmIChsaXN0LmluZGV4QXN5bmMpIHsKICAgICAgcGFyc2VBc3luYyhpdGVtc1RvSW5kZXgsIHZhbHVlTmFtZXMpOwogICAgfSBlbHNlIHsKICAgICAgcGFyc2UoaXRlbXNUb0luZGV4LCB2YWx1ZU5hbWVzKTsKICAgIH0KICB9Owp9OwoKfSx7Ii4vaXRlbSI6NH1dLDY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGxpc3QpIHsKICB2YXIgaXRlbSwKICAgIHRleHQsCiAgICBjb2x1bW5zLAogICAgc2VhcmNoU3RyaW5nLAogICAgY3VzdG9tU2VhcmNoOwoKICB2YXIgcHJlcGFyZSA9IHsKICAgIHJlc2V0TGlzdDogZnVuY3Rpb24oKSB7CiAgICAgIGxpc3QuaSA9IDE7CiAgICAgIGxpc3QudGVtcGxhdGVyLmNsZWFyKCk7CiAgICAgIGN1c3RvbVNlYXJjaCA9IHVuZGVmaW5lZDsKICAgIH0sCiAgICBzZXRPcHRpb25zOiBmdW5jdGlvbihhcmdzKSB7CiAgICAgIGlmIChhcmdzLmxlbmd0aCA9PSAyICYmIGFyZ3NbMV0gaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgIGNvbHVtbnMgPSBhcmdzWzFdOwogICAgICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID09IDIgJiYgdHlwZW9mKGFyZ3NbMV0pID09ICJmdW5jdGlvbiIpIHsKICAgICAgICBjb2x1bW5zID0gdW5kZWZpbmVkOwogICAgICAgIGN1c3RvbVNlYXJjaCA9IGFyZ3NbMV07CiAgICAgIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPT0gMykgewogICAgICAgIGNvbHVtbnMgPSBhcmdzWzFdOwogICAgICAgIGN1c3RvbVNlYXJjaCA9IGFyZ3NbMl07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29sdW1ucyA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgfSwKICAgIHNldENvbHVtbnM6IGZ1bmN0aW9uKCkgewogICAgICBpZiAobGlzdC5pdGVtcy5sZW5ndGggPT09IDApIHJldHVybjsKICAgICAgaWYgKGNvbHVtbnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGNvbHVtbnMgPSAobGlzdC5zZWFyY2hDb2x1bW5zID09PSB1bmRlZmluZWQpID8gcHJlcGFyZS50b0FycmF5KGxpc3QuaXRlbXNbMF0udmFsdWVzKCkpIDogbGlzdC5zZWFyY2hDb2x1bW5zOwogICAgICB9CiAgICB9LAogICAgc2V0U2VhcmNoU3RyaW5nOiBmdW5jdGlvbihzKSB7CiAgICAgIHMgPSBsaXN0LnV0aWxzLnRvU3RyaW5nKHMpLnRvTG93ZXJDYXNlKCk7CiAgICAgIHMgPSBzLnJlcGxhY2UoL1stW1xde30oKSorPy4sXFxeJHwjXS9nLCAiXFwkJiIpOyAvLyBFc2NhcGUgcmVndWxhciBleHByZXNzaW9uIGNoYXJhY3RlcnMKICAgICAgc2VhcmNoU3RyaW5nID0gczsKICAgIH0sCiAgICB0b0FycmF5OiBmdW5jdGlvbih2YWx1ZXMpIHsKICAgICAgdmFyIHRtcENvbHVtbiA9IFtdOwogICAgICBmb3IgKHZhciBuYW1lIGluIHZhbHVlcykgewogICAgICAgIHRtcENvbHVtbi5wdXNoKG5hbWUpOwogICAgICB9CiAgICAgIHJldHVybiB0bXBDb2x1bW47CiAgICB9CiAgfTsKICB2YXIgc2VhcmNoID0gewogICAgbGlzdDogZnVuY3Rpb24oKSB7CiAgICAgIGZvciAodmFyIGsgPSAwLCBrbCA9IGxpc3QuaXRlbXMubGVuZ3RoOyBrIDwga2w7IGsrKykgewogICAgICAgIHNlYXJjaC5pdGVtKGxpc3QuaXRlbXNba10pOwogICAgICB9CiAgICB9LAogICAgaXRlbTogZnVuY3Rpb24oaXRlbSkgewogICAgICBpdGVtLmZvdW5kID0gZmFsc2U7CiAgICAgIGZvciAodmFyIGogPSAwLCBqbCA9IGNvbHVtbnMubGVuZ3RoOyBqIDwgamw7IGorKykgewogICAgICAgIGlmIChzZWFyY2gudmFsdWVzKGl0ZW0udmFsdWVzKCksIGNvbHVtbnNbal0pKSB7CiAgICAgICAgICBpdGVtLmZvdW5kID0gdHJ1ZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICB2YWx1ZXM6IGZ1bmN0aW9uKHZhbHVlcywgY29sdW1uKSB7CiAgICAgIGlmICh2YWx1ZXMuaGFzT3duUHJvcGVydHkoY29sdW1uKSkgewogICAgICAgIHRleHQgPSBsaXN0LnV0aWxzLnRvU3RyaW5nKHZhbHVlc1tjb2x1bW5dKS50b0xvd2VyQ2FzZSgpOwogICAgICAgIGlmICgoc2VhcmNoU3RyaW5nICE9PSAiIikgJiYgKHRleHQuc2VhcmNoKHNlYXJjaFN0cmluZykgPiAtMSkpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgcmVzZXQ6IGZ1bmN0aW9uKCkgewogICAgICBsaXN0LnJlc2V0LnNlYXJjaCgpOwogICAgICBsaXN0LnNlYXJjaGVkID0gZmFsc2U7CiAgICB9CiAgfTsKCiAgdmFyIHNlYXJjaE1ldGhvZCA9IGZ1bmN0aW9uKHN0cikgewogICAgbGlzdC50cmlnZ2VyKCdzZWFyY2hTdGFydCcpOwoKICAgIHByZXBhcmUucmVzZXRMaXN0KCk7CiAgICBwcmVwYXJlLnNldFNlYXJjaFN0cmluZyhzdHIpOwogICAgcHJlcGFyZS5zZXRPcHRpb25zKGFyZ3VtZW50cyk7IC8vIHN0ciwgY29sc3xzZWFyY2hGdW5jdGlvbiwgc2VhcmNoRnVuY3Rpb24KICAgIHByZXBhcmUuc2V0Q29sdW1ucygpOwoKICAgIGlmIChzZWFyY2hTdHJpbmcgPT09ICIiICkgewogICAgICBzZWFyY2gucmVzZXQoKTsKICAgIH0gZWxzZSB7CiAgICAgIGxpc3Quc2VhcmNoZWQgPSB0cnVlOwogICAgICBpZiAoY3VzdG9tU2VhcmNoKSB7CiAgICAgICAgY3VzdG9tU2VhcmNoKHNlYXJjaFN0cmluZywgY29sdW1ucyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VhcmNoLmxpc3QoKTsKICAgICAgfQogICAgfQoKICAgIGxpc3QudXBkYXRlKCk7CiAgICBsaXN0LnRyaWdnZXIoJ3NlYXJjaENvbXBsZXRlJyk7CiAgICByZXR1cm4gbGlzdC52aXNpYmxlSXRlbXM7CiAgfTsKCiAgbGlzdC5oYW5kbGVycy5zZWFyY2hTdGFydCA9IGxpc3QuaGFuZGxlcnMuc2VhcmNoU3RhcnQgfHwgW107CiAgbGlzdC5oYW5kbGVycy5zZWFyY2hDb21wbGV0ZSA9IGxpc3QuaGFuZGxlcnMuc2VhcmNoQ29tcGxldGUgfHwgW107CgogIGxpc3QudXRpbHMuZXZlbnRzLmJpbmQobGlzdC51dGlscy5nZXRCeUNsYXNzKGxpc3QubGlzdENvbnRhaW5lciwgbGlzdC5zZWFyY2hDbGFzcyksICdrZXl1cCcsIGZ1bmN0aW9uKGUpIHsKICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQsIC8vIElFIGhhdmUgc3JjRWxlbWVudAogICAgICBhbHJlYWR5Q2xlYXJlZCA9ICh0YXJnZXQudmFsdWUgPT09ICIiICYmICFsaXN0LnNlYXJjaGVkKTsKICAgIGlmICghYWxyZWFkeUNsZWFyZWQpIHsgLy8gSWYgb25pbnB1dCBhbHJlYWR5IGhhdmUgcmVzZXR0ZWQgdGhlIGxpc3QsIGRvIG5vdGhpbmcKICAgICAgc2VhcmNoTWV0aG9kKHRhcmdldC52YWx1ZSk7CiAgICB9CiAgfSk7CgogIC8vIFVzZWQgdG8gZGV0ZWN0IGNsaWNrIG9uIEhUTUw1IGNsZWFyIGJ1dHRvbgogIGxpc3QudXRpbHMuZXZlbnRzLmJpbmQobGlzdC51dGlscy5nZXRCeUNsYXNzKGxpc3QubGlzdENvbnRhaW5lciwgbGlzdC5zZWFyY2hDbGFzcyksICdpbnB1dCcsIGZ1bmN0aW9uKGUpIHsKICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQ7CiAgICBpZiAodGFyZ2V0LnZhbHVlID09PSAiIikgewogICAgICBzZWFyY2hNZXRob2QoJycpOwogICAgfQogIH0pOwoKICByZXR1cm4gc2VhcmNoTWV0aG9kOwp9OwoKfSx7fV0sNzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obGlzdCkgewogIGxpc3Quc29ydEZ1bmN0aW9uID0gbGlzdC5zb3J0RnVuY3Rpb24gfHwgZnVuY3Rpb24oaXRlbUEsIGl0ZW1CLCBvcHRpb25zKSB7CiAgICBvcHRpb25zLmRlc2MgPSBvcHRpb25zLm9yZGVyID09ICJkZXNjIiA/IHRydWUgOiBmYWxzZTsgLy8gTmF0dXJhbCBzb3J0IHVzZXMgdGhpcyBmb3JtYXQKICAgIHJldHVybiBsaXN0LnV0aWxzLm5hdHVyYWxTb3J0KGl0ZW1BLnZhbHVlcygpW29wdGlvbnMudmFsdWVOYW1lXSwgaXRlbUIudmFsdWVzKClbb3B0aW9ucy52YWx1ZU5hbWVdLCBvcHRpb25zKTsKICB9OwoKICB2YXIgYnV0dG9ucyA9IHsKICAgIGVsczogdW5kZWZpbmVkLAogICAgY2xlYXI6IGZ1bmN0aW9uKCkgewogICAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBidXR0b25zLmVscy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgICAgbGlzdC51dGlscy5jbGFzc2VzKGJ1dHRvbnMuZWxzW2ldKS5yZW1vdmUoJ2FzYycpOwogICAgICAgIGxpc3QudXRpbHMuY2xhc3NlcyhidXR0b25zLmVsc1tpXSkucmVtb3ZlKCdkZXNjJyk7CiAgICAgIH0KICAgIH0sCiAgICBnZXRPcmRlcjogZnVuY3Rpb24oYnRuKSB7CiAgICAgIHZhciBwcmVkZWZpbmVkT3JkZXIgPSBsaXN0LnV0aWxzLmdldEF0dHJpYnV0ZShidG4sICdkYXRhLW9yZGVyJyk7CiAgICAgIGlmIChwcmVkZWZpbmVkT3JkZXIgPT0gImFzYyIgfHwgcHJlZGVmaW5lZE9yZGVyID09ICJkZXNjIikgewogICAgICAgIHJldHVybiBwcmVkZWZpbmVkT3JkZXI7CiAgICAgIH0gZWxzZSBpZiAobGlzdC51dGlscy5jbGFzc2VzKGJ0bikuaGFzKCdkZXNjJykpIHsKICAgICAgICByZXR1cm4gImFzYyI7CiAgICAgIH0gZWxzZSBpZiAobGlzdC51dGlscy5jbGFzc2VzKGJ0bikuaGFzKCdhc2MnKSkgewogICAgICAgIHJldHVybiAiZGVzYyI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICJhc2MiOwogICAgICB9CiAgICB9LAogICAgZ2V0SW5TZW5zaXRpdmU6IGZ1bmN0aW9uKGJ0biwgb3B0aW9ucykgewogICAgICB2YXIgaW5zZW5zaXRpdmUgPSBsaXN0LnV0aWxzLmdldEF0dHJpYnV0ZShidG4sICdkYXRhLWluc2Vuc2l0aXZlJyk7CiAgICAgIGlmIChpbnNlbnNpdGl2ZSA9PT0gImZhbHNlIikgewogICAgICAgIG9wdGlvbnMuaW5zZW5zaXRpdmUgPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvcHRpb25zLmluc2Vuc2l0aXZlID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIHNldE9yZGVyOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IGJ1dHRvbnMuZWxzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICB2YXIgYnRuID0gYnV0dG9ucy5lbHNbaV07CiAgICAgICAgaWYgKGxpc3QudXRpbHMuZ2V0QXR0cmlidXRlKGJ0biwgJ2RhdGEtc29ydCcpICE9PSBvcHRpb25zLnZhbHVlTmFtZSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHZhciBwcmVkZWZpbmVkT3JkZXIgPSBsaXN0LnV0aWxzLmdldEF0dHJpYnV0ZShidG4sICdkYXRhLW9yZGVyJyk7CiAgICAgICAgaWYgKHByZWRlZmluZWRPcmRlciA9PSAiYXNjIiB8fCBwcmVkZWZpbmVkT3JkZXIgPT0gImRlc2MiKSB7CiAgICAgICAgICBpZiAocHJlZGVmaW5lZE9yZGVyID09IG9wdGlvbnMub3JkZXIpIHsKICAgICAgICAgICAgbGlzdC51dGlscy5jbGFzc2VzKGJ0bikuYWRkKG9wdGlvbnMub3JkZXIpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsaXN0LnV0aWxzLmNsYXNzZXMoYnRuKS5hZGQob3B0aW9ucy5vcmRlcik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKICB2YXIgc29ydCA9IGZ1bmN0aW9uKCkgewogICAgbGlzdC50cmlnZ2VyKCdzb3J0U3RhcnQnKTsKICAgIHZhciBvcHRpb25zID0ge307CgogICAgdmFyIHRhcmdldCA9IGFyZ3VtZW50c1swXS5jdXJyZW50VGFyZ2V0IHx8IGFyZ3VtZW50c1swXS5zcmNFbGVtZW50IHx8IHVuZGVmaW5lZDsKCiAgICBpZiAodGFyZ2V0KSB7CiAgICAgIG9wdGlvbnMudmFsdWVOYW1lID0gbGlzdC51dGlscy5nZXRBdHRyaWJ1dGUodGFyZ2V0LCAnZGF0YS1zb3J0Jyk7CiAgICAgIGJ1dHRvbnMuZ2V0SW5TZW5zaXRpdmUodGFyZ2V0LCBvcHRpb25zKTsKICAgICAgb3B0aW9ucy5vcmRlciA9IGJ1dHRvbnMuZ2V0T3JkZXIodGFyZ2V0KTsKICAgIH0gZWxzZSB7CiAgICAgIG9wdGlvbnMgPSBhcmd1bWVudHNbMV0gfHwgb3B0aW9uczsKICAgICAgb3B0aW9ucy52YWx1ZU5hbWUgPSBhcmd1bWVudHNbMF07CiAgICAgIG9wdGlvbnMub3JkZXIgPSBvcHRpb25zLm9yZGVyIHx8ICJhc2MiOwogICAgICBvcHRpb25zLmluc2Vuc2l0aXZlID0gKHR5cGVvZiBvcHRpb25zLmluc2Vuc2l0aXZlID09ICJ1bmRlZmluZWQiKSA/IHRydWUgOiBvcHRpb25zLmluc2Vuc2l0aXZlOwogICAgfQogICAgYnV0dG9ucy5jbGVhcigpOwogICAgYnV0dG9ucy5zZXRPcmRlcihvcHRpb25zKTsKCiAgICBvcHRpb25zLnNvcnRGdW5jdGlvbiA9IG9wdGlvbnMuc29ydEZ1bmN0aW9uIHx8IGxpc3Quc29ydEZ1bmN0aW9uOwogICAgbGlzdC5pdGVtcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgdmFyIG11bHQgPSAob3B0aW9ucy5vcmRlciA9PT0gJ2Rlc2MnKSA/IC0xIDogMTsKICAgICAgcmV0dXJuIChvcHRpb25zLnNvcnRGdW5jdGlvbihhLCBiLCBvcHRpb25zKSAqIG11bHQpOwogICAgfSk7CiAgICBsaXN0LnVwZGF0ZSgpOwogICAgbGlzdC50cmlnZ2VyKCdzb3J0Q29tcGxldGUnKTsKICB9OwoKICAvLyBBZGQgaGFuZGxlcnMKICBsaXN0LmhhbmRsZXJzLnNvcnRTdGFydCA9IGxpc3QuaGFuZGxlcnMuc29ydFN0YXJ0IHx8IFtdOwogIGxpc3QuaGFuZGxlcnMuc29ydENvbXBsZXRlID0gbGlzdC5oYW5kbGVycy5zb3J0Q29tcGxldGUgfHwgW107CgogIGJ1dHRvbnMuZWxzID0gbGlzdC51dGlscy5nZXRCeUNsYXNzKGxpc3QubGlzdENvbnRhaW5lciwgbGlzdC5zb3J0Q2xhc3MpOwogIGxpc3QudXRpbHMuZXZlbnRzLmJpbmQoYnV0dG9ucy5lbHMsICdjbGljaycsIHNvcnQpOwogIGxpc3Qub24oJ3NlYXJjaFN0YXJ0JywgYnV0dG9ucy5jbGVhcik7CiAgbGlzdC5vbignZmlsdGVyU3RhcnQnLCBidXR0b25zLmNsZWFyKTsKCiAgcmV0dXJuIHNvcnQ7Cn07Cgp9LHt9XSw4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIFRlbXBsYXRlciA9IGZ1bmN0aW9uKGxpc3QpIHsKICB2YXIgaXRlbVNvdXJjZSwKICAgIHRlbXBsYXRlciA9IHRoaXM7CgogIHZhciBpbml0ID0gZnVuY3Rpb24oKSB7CiAgICBpdGVtU291cmNlID0gdGVtcGxhdGVyLmdldEl0ZW1Tb3VyY2UobGlzdC5pdGVtKTsKICAgIGlmIChpdGVtU291cmNlKSB7CiAgICAgIGl0ZW1Tb3VyY2UgPSB0ZW1wbGF0ZXIuY2xlYXJTb3VyY2VJdGVtKGl0ZW1Tb3VyY2UsIGxpc3QudmFsdWVOYW1lcyk7CiAgICB9CiAgfTsKCiAgdGhpcy5jbGVhclNvdXJjZUl0ZW0gPSBmdW5jdGlvbihlbCwgdmFsdWVOYW1lcykgewogICAgZm9yKHZhciBpID0gMCwgaWwgPSB2YWx1ZU5hbWVzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgdmFyIGVsbTsKICAgICAgaWYgKHZhbHVlTmFtZXNbaV0uZGF0YSkgewogICAgICAgIGZvciAodmFyIGogPSAwLCBqbCA9IHZhbHVlTmFtZXNbaV0uZGF0YS5sZW5ndGg7IGogPCBqbDsgaisrKSB7CiAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtJyt2YWx1ZU5hbWVzW2ldLmRhdGFbal0sICcnKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFsdWVOYW1lc1tpXS5hdHRyICYmIHZhbHVlTmFtZXNbaV0ubmFtZSkgewogICAgICAgIGVsbSA9IGxpc3QudXRpbHMuZ2V0QnlDbGFzcyhlbCwgdmFsdWVOYW1lc1tpXS5uYW1lLCB0cnVlKTsKICAgICAgICBpZiAoZWxtKSB7CiAgICAgICAgICBlbG0uc2V0QXR0cmlidXRlKHZhbHVlTmFtZXNbaV0uYXR0ciwgIiIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBlbG0gPSBsaXN0LnV0aWxzLmdldEJ5Q2xhc3MoZWwsIHZhbHVlTmFtZXNbaV0sIHRydWUpOwogICAgICAgIGlmIChlbG0pIHsKICAgICAgICAgIGVsbS5pbm5lckhUTUwgPSAiIjsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxtID0gdW5kZWZpbmVkOwogICAgfQogICAgcmV0dXJuIGVsOwogIH07CgogIHRoaXMuZ2V0SXRlbVNvdXJjZSA9IGZ1bmN0aW9uKGl0ZW0pIHsKICAgIGlmIChpdGVtID09PSB1bmRlZmluZWQpIHsKICAgICAgdmFyIG5vZGVzID0gbGlzdC5saXN0LmNoaWxkTm9kZXMsCiAgICAgICAgaXRlbXMgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBpbCA9IG5vZGVzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICAvLyBPbmx5IHRleHRub2RlcyBoYXZlIGEgZGF0YSBhdHRyaWJ1dGUKICAgICAgICBpZiAobm9kZXNbaV0uZGF0YSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gbm9kZXNbaV0uY2xvbmVOb2RlKHRydWUpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmICgvPHRyW1xzPl0vZy5leGVjKGl0ZW0pKSB7CiAgICAgIHZhciB0Ym9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3Rib2R5Jyk7CiAgICAgIHRib2R5LmlubmVySFRNTCA9IGl0ZW07CiAgICAgIHJldHVybiB0Ym9keS5maXJzdENoaWxkOwogICAgfSBlbHNlIGlmIChpdGVtLmluZGV4T2YoIjwiKSAhPT0gLTEpIHsKICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBkaXYuaW5uZXJIVE1MID0gaXRlbTsKICAgICAgcmV0dXJuIGRpdi5maXJzdENoaWxkOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHNvdXJjZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxpc3QuaXRlbSk7CiAgICAgIGlmIChzb3VyY2UpIHsKICAgICAgICByZXR1cm4gc291cmNlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH07CgogIHRoaXMuZ2V0ID0gZnVuY3Rpb24oaXRlbSwgdmFsdWVOYW1lcykgewogICAgdGVtcGxhdGVyLmNyZWF0ZShpdGVtKTsKICAgIHZhciB2YWx1ZXMgPSB7fTsKICAgIGZvcih2YXIgaSA9IDAsIGlsID0gdmFsdWVOYW1lcy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7CiAgICAgIHZhciBlbG07CiAgICAgIGlmICh2YWx1ZU5hbWVzW2ldLmRhdGEpIHsKICAgICAgICBmb3IgKHZhciBqID0gMCwgamwgPSB2YWx1ZU5hbWVzW2ldLmRhdGEubGVuZ3RoOyBqIDwgamw7IGorKykgewogICAgICAgICAgdmFsdWVzW3ZhbHVlTmFtZXNbaV0uZGF0YVtqXV0gPSBsaXN0LnV0aWxzLmdldEF0dHJpYnV0ZShpdGVtLmVsbSwgJ2RhdGEtJyt2YWx1ZU5hbWVzW2ldLmRhdGFbal0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh2YWx1ZU5hbWVzW2ldLmF0dHIgJiYgdmFsdWVOYW1lc1tpXS5uYW1lKSB7CiAgICAgICAgZWxtID0gbGlzdC51dGlscy5nZXRCeUNsYXNzKGl0ZW0uZWxtLCB2YWx1ZU5hbWVzW2ldLm5hbWUsIHRydWUpOwogICAgICAgIHZhbHVlc1t2YWx1ZU5hbWVzW2ldLm5hbWVdID0gZWxtID8gbGlzdC51dGlscy5nZXRBdHRyaWJ1dGUoZWxtLCB2YWx1ZU5hbWVzW2ldLmF0dHIpIDogIiI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWxtID0gbGlzdC51dGlscy5nZXRCeUNsYXNzKGl0ZW0uZWxtLCB2YWx1ZU5hbWVzW2ldLCB0cnVlKTsKICAgICAgICB2YWx1ZXNbdmFsdWVOYW1lc1tpXV0gPSBlbG0gPyBlbG0uaW5uZXJIVE1MIDogIiI7CiAgICAgIH0KICAgICAgZWxtID0gdW5kZWZpbmVkOwogICAgfQogICAgcmV0dXJuIHZhbHVlczsKICB9OwoKICB0aGlzLnNldCA9IGZ1bmN0aW9uKGl0ZW0sIHZhbHVlcykgewogICAgdmFyIGdldFZhbHVlTmFtZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIGlsID0gbGlzdC52YWx1ZU5hbWVzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICBpZiAobGlzdC52YWx1ZU5hbWVzW2ldLmRhdGEpIHsKICAgICAgICAgIHZhciBkYXRhID0gbGlzdC52YWx1ZU5hbWVzW2ldLmRhdGE7CiAgICAgICAgICBmb3IgKHZhciBqID0gMCwgamwgPSBkYXRhLmxlbmd0aDsgaiA8IGpsOyBqKyspIHsKICAgICAgICAgICAgaWYgKGRhdGFbal0gPT09IG5hbWUpIHsKICAgICAgICAgICAgICByZXR1cm4geyBkYXRhOiBuYW1lIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGxpc3QudmFsdWVOYW1lc1tpXS5hdHRyICYmIGxpc3QudmFsdWVOYW1lc1tpXS5uYW1lICYmIGxpc3QudmFsdWVOYW1lc1tpXS5uYW1lID09IG5hbWUpIHsKICAgICAgICAgIHJldHVybiBsaXN0LnZhbHVlTmFtZXNbaV07CiAgICAgICAgfSBlbHNlIGlmIChsaXN0LnZhbHVlTmFtZXNbaV0gPT09IG5hbWUpIHsKICAgICAgICAgIHJldHVybiBuYW1lOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIHZhciBzZXRWYWx1ZSA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICAgIHZhciBlbG07CiAgICAgIHZhciB2YWx1ZU5hbWUgPSBnZXRWYWx1ZU5hbWUobmFtZSk7CiAgICAgIGlmICghdmFsdWVOYW1lKQogICAgICAgIHJldHVybjsKICAgICAgaWYgKHZhbHVlTmFtZS5kYXRhKSB7CiAgICAgICAgaXRlbS5lbG0uc2V0QXR0cmlidXRlKCdkYXRhLScrdmFsdWVOYW1lLmRhdGEsIHZhbHVlKTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZU5hbWUuYXR0ciAmJiB2YWx1ZU5hbWUubmFtZSkgewogICAgICAgIGVsbSA9IGxpc3QudXRpbHMuZ2V0QnlDbGFzcyhpdGVtLmVsbSwgdmFsdWVOYW1lLm5hbWUsIHRydWUpOwogICAgICAgIGlmIChlbG0pIHsKICAgICAgICAgIGVsbS5zZXRBdHRyaWJ1dGUodmFsdWVOYW1lLmF0dHIsIHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWxtID0gbGlzdC51dGlscy5nZXRCeUNsYXNzKGl0ZW0uZWxtLCB2YWx1ZU5hbWUsIHRydWUpOwogICAgICAgIGlmIChlbG0pIHsKICAgICAgICAgIGVsbS5pbm5lckhUTUwgPSB2YWx1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxtID0gdW5kZWZpbmVkOwogICAgfTsKICAgIGlmICghdGVtcGxhdGVyLmNyZWF0ZShpdGVtKSkgewogICAgICBmb3IodmFyIHYgaW4gdmFsdWVzKSB7CiAgICAgICAgaWYgKHZhbHVlcy5oYXNPd25Qcm9wZXJ0eSh2KSkgewogICAgICAgICAgc2V0VmFsdWUodiwgdmFsdWVzW3ZdKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICB0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uKGl0ZW0pIHsKICAgIGlmIChpdGVtLmVsbSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmIChpdGVtU291cmNlID09PSB1bmRlZmluZWQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgbGlzdCBuZWVkIHRvIGhhdmUgYXQgbGlzdCBvbmUgaXRlbSBvbiBpbml0IG90aGVyd2lzZSB5b3UnbGwgaGF2ZSB0byBhZGQgYSB0ZW1wbGF0ZS4iKTsKICAgIH0KICAgIC8qIElmIGl0ZW0gc291cmNlIGRvZXMgbm90IGV4aXN0cywgdXNlIHRoZSBmaXJzdCBpdGVtIGluIGxpc3QgYXMKICAgIHNvdXJjZSBmb3IgbmV3IGl0ZW1zICovCiAgICB2YXIgbmV3SXRlbSA9IGl0ZW1Tb3VyY2UuY2xvbmVOb2RlKHRydWUpOwogICAgbmV3SXRlbS5yZW1vdmVBdHRyaWJ1dGUoJ2lkJyk7CiAgICBpdGVtLmVsbSA9IG5ld0l0ZW07CiAgICB0ZW1wbGF0ZXIuc2V0KGl0ZW0sIGl0ZW0udmFsdWVzKCkpOwogICAgcmV0dXJuIHRydWU7CiAgfTsKICB0aGlzLnJlbW92ZSA9IGZ1bmN0aW9uKGl0ZW0pIHsKICAgIGlmIChpdGVtLmVsbS5wYXJlbnROb2RlID09PSBsaXN0Lmxpc3QpIHsKICAgICAgbGlzdC5saXN0LnJlbW92ZUNoaWxkKGl0ZW0uZWxtKTsKICAgIH0KICB9OwogIHRoaXMuc2hvdyA9IGZ1bmN0aW9uKGl0ZW0pIHsKICAgIHRlbXBsYXRlci5jcmVhdGUoaXRlbSk7CiAgICBsaXN0Lmxpc3QuYXBwZW5kQ2hpbGQoaXRlbS5lbG0pOwogIH07CiAgdGhpcy5oaWRlID0gZnVuY3Rpb24oaXRlbSkgewogICAgaWYgKGl0ZW0uZWxtICE9PSB1bmRlZmluZWQgJiYgaXRlbS5lbG0ucGFyZW50Tm9kZSA9PT0gbGlzdC5saXN0KSB7CiAgICAgIGxpc3QubGlzdC5yZW1vdmVDaGlsZChpdGVtLmVsbSk7CiAgICB9CiAgfTsKICB0aGlzLmNsZWFyID0gZnVuY3Rpb24oKSB7CiAgICAvKiAuaW5uZXJIVE1MID0gJyc7IGZ1Y2tzIHVwIElFICovCiAgICBpZiAobGlzdC5saXN0Lmhhc0NoaWxkTm9kZXMoKSkgewogICAgICB3aGlsZSAobGlzdC5saXN0LmNoaWxkTm9kZXMubGVuZ3RoID49IDEpCiAgICAgIHsKICAgICAgICBsaXN0Lmxpc3QucmVtb3ZlQ2hpbGQobGlzdC5saXN0LmZpcnN0Q2hpbGQpOwogICAgICB9CiAgICB9CiAgfTsKCiAgaW5pdCgpOwp9OwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihsaXN0KSB7CiAgcmV0dXJuIG5ldyBUZW1wbGF0ZXIobGlzdCk7Cn07Cgp9LHt9XSw5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoqCiAqIE1vZHVsZSBkZXBlbmRlbmNpZXMuCiAqLwoKdmFyIGluZGV4ID0gcmVxdWlyZSgnLi9pbmRleC1vZicpOwoKLyoqCiAqIFdoaXRlc3BhY2UgcmVnZXhwLgogKi8KCnZhciByZSA9IC9ccysvOwoKLyoqCiAqIHRvU3RyaW5nIHJlZmVyZW5jZS4KICovCgp2YXIgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwoKLyoqCiAqIFdyYXAgYGVsYCBpbiBhIGBDbGFzc0xpc3RgLgogKgogKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0KICogQGFwaSBwdWJsaWMKICovCgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGVsKXsKICByZXR1cm4gbmV3IENsYXNzTGlzdChlbCk7Cn07CgovKioKICogSW5pdGlhbGl6ZSBhIG5ldyBDbGFzc0xpc3QgZm9yIGBlbGAuCiAqCiAqIEBwYXJhbSB7RWxlbWVudH0gZWwKICogQGFwaSBwcml2YXRlCiAqLwoKZnVuY3Rpb24gQ2xhc3NMaXN0KGVsKSB7CiAgaWYgKCFlbCB8fCAhZWwubm9kZVR5cGUpIHsKICAgIHRocm93IG5ldyBFcnJvcignQSBET00gZWxlbWVudCByZWZlcmVuY2UgaXMgcmVxdWlyZWQnKTsKICB9CiAgdGhpcy5lbCA9IGVsOwogIHRoaXMubGlzdCA9IGVsLmNsYXNzTGlzdDsKfQoKLyoqCiAqIEFkZCBjbGFzcyBgbmFtZWAgaWYgbm90IGFscmVhZHkgcHJlc2VudC4KICoKICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICogQHJldHVybiB7Q2xhc3NMaXN0fQogKiBAYXBpIHB1YmxpYwogKi8KCkNsYXNzTGlzdC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24obmFtZSl7CiAgLy8gY2xhc3NMaXN0CiAgaWYgKHRoaXMubGlzdCkgewogICAgdGhpcy5saXN0LmFkZChuYW1lKTsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgLy8gZmFsbGJhY2sKICB2YXIgYXJyID0gdGhpcy5hcnJheSgpOwogIHZhciBpID0gaW5kZXgoYXJyLCBuYW1lKTsKICBpZiAoIX5pKSBhcnIucHVzaChuYW1lKTsKICB0aGlzLmVsLmNsYXNzTmFtZSA9IGFyci5qb2luKCcgJyk7CiAgcmV0dXJuIHRoaXM7Cn07CgovKioKICogUmVtb3ZlIGNsYXNzIGBuYW1lYCB3aGVuIHByZXNlbnQsIG9yCiAqIHBhc3MgYSByZWd1bGFyIGV4cHJlc3Npb24gdG8gcmVtb3ZlCiAqIGFueSB3aGljaCBtYXRjaC4KICoKICogQHBhcmFtIHtTdHJpbmd8UmVnRXhwfSBuYW1lCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0KICogQGFwaSBwdWJsaWMKICovCgpDbGFzc0xpc3QucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKG5hbWUpewogIGlmICgnW29iamVjdCBSZWdFeHBdJyA9PSB0b1N0cmluZy5jYWxsKG5hbWUpKSB7CiAgICByZXR1cm4gdGhpcy5yZW1vdmVNYXRjaGluZyhuYW1lKTsKICB9CgogIC8vIGNsYXNzTGlzdAogIGlmICh0aGlzLmxpc3QpIHsKICAgIHRoaXMubGlzdC5yZW1vdmUobmFtZSk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8vIGZhbGxiYWNrCiAgdmFyIGFyciA9IHRoaXMuYXJyYXkoKTsKICB2YXIgaSA9IGluZGV4KGFyciwgbmFtZSk7CiAgaWYgKH5pKSBhcnIuc3BsaWNlKGksIDEpOwogIHRoaXMuZWwuY2xhc3NOYW1lID0gYXJyLmpvaW4oJyAnKTsKICByZXR1cm4gdGhpczsKfTsKCi8qKgogKiBSZW1vdmUgYWxsIGNsYXNzZXMgbWF0Y2hpbmcgYHJlYC4KICoKICogQHBhcmFtIHtSZWdFeHB9IHJlCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0KICogQGFwaSBwcml2YXRlCiAqLwoKQ2xhc3NMaXN0LnByb3RvdHlwZS5yZW1vdmVNYXRjaGluZyA9IGZ1bmN0aW9uKHJlKXsKICB2YXIgYXJyID0gdGhpcy5hcnJheSgpOwogIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICBpZiAocmUudGVzdChhcnJbaV0pKSB7CiAgICAgIHRoaXMucmVtb3ZlKGFycltpXSk7CiAgICB9CiAgfQogIHJldHVybiB0aGlzOwp9OwoKLyoqCiAqIFRvZ2dsZSBjbGFzcyBgbmFtZWAsIGNhbiBmb3JjZSBzdGF0ZSB2aWEgYGZvcmNlYC4KICoKICogRm9yIGJyb3dzZXJzIHRoYXQgc3VwcG9ydCBjbGFzc0xpc3QsIGJ1dCBkbyBub3Qgc3VwcG9ydCBgZm9yY2VgIHlldCwKICogdGhlIG1pc3Rha2Ugd2lsbCBiZSBkZXRlY3RlZCBhbmQgY29ycmVjdGVkLgogKgogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogKiBAcGFyYW0ge0Jvb2xlYW59IGZvcmNlCiAqIEByZXR1cm4ge0NsYXNzTGlzdH0KICogQGFwaSBwdWJsaWMKICovCgpDbGFzc0xpc3QucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKG5hbWUsIGZvcmNlKXsKICAvLyBjbGFzc0xpc3QKICBpZiAodGhpcy5saXN0KSB7CiAgICBpZiAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBmb3JjZSkgewogICAgICBpZiAoZm9yY2UgIT09IHRoaXMubGlzdC50b2dnbGUobmFtZSwgZm9yY2UpKSB7CiAgICAgICAgdGhpcy5saXN0LnRvZ2dsZShuYW1lKTsgLy8gdG9nZ2xlIGFnYWluIHRvIGNvcnJlY3QKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5saXN0LnRvZ2dsZShuYW1lKTsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH0KCiAgLy8gZmFsbGJhY2sKICBpZiAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBmb3JjZSkgewogICAgaWYgKCFmb3JjZSkgewogICAgICB0aGlzLnJlbW92ZShuYW1lKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuYWRkKG5hbWUpOwogICAgfQogIH0gZWxzZSB7CiAgICBpZiAodGhpcy5oYXMobmFtZSkpIHsKICAgICAgdGhpcy5yZW1vdmUobmFtZSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmFkZChuYW1lKTsKICAgIH0KICB9CgogIHJldHVybiB0aGlzOwp9OwoKLyoqCiAqIFJldHVybiBhbiBhcnJheSBvZiBjbGFzc2VzLgogKgogKiBAcmV0dXJuIHtBcnJheX0KICogQGFwaSBwdWJsaWMKICovCgpDbGFzc0xpc3QucHJvdG90eXBlLmFycmF5ID0gZnVuY3Rpb24oKXsKICB2YXIgY2xhc3NOYW1lID0gdGhpcy5lbC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykgfHwgJyc7CiAgdmFyIHN0ciA9IGNsYXNzTmFtZS5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpOwogIHZhciBhcnIgPSBzdHIuc3BsaXQocmUpOwogIGlmICgnJyA9PT0gYXJyWzBdKSBhcnIuc2hpZnQoKTsKICByZXR1cm4gYXJyOwp9OwoKLyoqCiAqIENoZWNrIGlmIGNsYXNzIGBuYW1lYCBpcyBwcmVzZW50LgogKgogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9CiAqIEBhcGkgcHVibGljCiAqLwoKQ2xhc3NMaXN0LnByb3RvdHlwZS5oYXMgPQpDbGFzc0xpc3QucHJvdG90eXBlLmNvbnRhaW5zID0gZnVuY3Rpb24obmFtZSl7CiAgcmV0dXJuIHRoaXMubGlzdCA/IHRoaXMubGlzdC5jb250YWlucyhuYW1lKSA6ICEhIH5pbmRleCh0aGlzLmFycmF5KCksIG5hbWUpOwp9OwoKfSx7Ii4vaW5kZXgtb2YiOjE0fV0sMTA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgYmluZCA9IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyID8gJ2FkZEV2ZW50TGlzdGVuZXInIDogJ2F0dGFjaEV2ZW50JywKICAgIHVuYmluZCA9IHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyID8gJ3JlbW92ZUV2ZW50TGlzdGVuZXInIDogJ2RldGFjaEV2ZW50JywKICAgIHByZWZpeCA9IGJpbmQgIT09ICdhZGRFdmVudExpc3RlbmVyJyA/ICdvbicgOiAnJywKICAgIHRvQXJyYXkgPSByZXF1aXJlKCcuL3RvLWFycmF5Jyk7CgovKioKICogQmluZCBgZWxgIGV2ZW50IGB0eXBlYCB0byBgZm5gLgogKgogKiBAcGFyYW0ge0VsZW1lbnR9IGVsLCBOb2RlTGlzdCwgSFRNTENvbGxlY3Rpb24gb3IgQXJyYXkKICogQHBhcmFtIHtTdHJpbmd9IHR5cGUKICogQHBhcmFtIHtGdW5jdGlvbn0gZm4KICogQHBhcmFtIHtCb29sZWFufSBjYXB0dXJlCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy5iaW5kID0gZnVuY3Rpb24oZWwsIHR5cGUsIGZuLCBjYXB0dXJlKXsKICBlbCA9IHRvQXJyYXkoZWwpOwogIGZvciAoIHZhciBpID0gMDsgaSA8IGVsLmxlbmd0aDsgaSsrICkgewogICAgZWxbaV1bYmluZF0ocHJlZml4ICsgdHlwZSwgZm4sIGNhcHR1cmUgfHwgZmFsc2UpOwogIH0KfTsKCi8qKgogKiBVbmJpbmQgYGVsYCBldmVudCBgdHlwZWAncyBjYWxsYmFjayBgZm5gLgogKgogKiBAcGFyYW0ge0VsZW1lbnR9IGVsLCBOb2RlTGlzdCwgSFRNTENvbGxlY3Rpb24gb3IgQXJyYXkKICogQHBhcmFtIHtTdHJpbmd9IHR5cGUKICogQHBhcmFtIHtGdW5jdGlvbn0gZm4KICogQHBhcmFtIHtCb29sZWFufSBjYXB0dXJlCiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy51bmJpbmQgPSBmdW5jdGlvbihlbCwgdHlwZSwgZm4sIGNhcHR1cmUpewogIGVsID0gdG9BcnJheShlbCk7CiAgZm9yICggdmFyIGkgPSAwOyBpIDwgZWwubGVuZ3RoOyBpKysgKSB7CiAgICBlbFtpXVt1bmJpbmRdKHByZWZpeCArIHR5cGUsIGZuLCBjYXB0dXJlIHx8IGZhbHNlKTsKICB9Cn07Cgp9LHsiLi90by1hcnJheSI6MTZ9XSwxMTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8qCiAqIFNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9leHRlbmQKICovCgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGV4dGVuZCAob2JqZWN0KSB7CiAgICAvLyBUYWtlcyBhbiB1bmxpbWl0ZWQgbnVtYmVyIG9mIGV4dGVuZGVycy4KICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKCiAgICAvLyBGb3IgZWFjaCBleHRlbmRlciwgY29weSB0aGVpciBwcm9wZXJ0aWVzIG9uIG91ciBvYmplY3QuCiAgICBmb3IgKHZhciBpID0gMCwgc291cmNlOyBzb3VyY2UgPSBhcmdzW2ldOyBpKyspIHsKICAgICAgICBpZiAoIXNvdXJjZSkgY29udGludWU7CiAgICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gc291cmNlKSB7CiAgICAgICAgICAgIG9iamVjdFtwcm9wZXJ0eV0gPSBzb3VyY2VbcHJvcGVydHldOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2JqZWN0Owp9OwoKfSx7fV0sMTI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovKioKICogQSBjcm9zcy1icm93c2VyIGltcGxlbWVudGF0aW9uIG9mIGdldEF0dHJpYnV0ZS4KICogU291cmNlIGZvdW5kIGhlcmU6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzM3NTUzNDMvMzYxMzM3IHdyaXR0ZW4gYnkgVml2aW4gUGFsaWF0aAogKgogKiBSZXR1cm4gdGhlIHZhbHVlIGZvciBgYXR0cmAgYXQgYGVsZW1lbnRgLgogKgogKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAqIEBwYXJhbSB7U3RyaW5nfSBhdHRyCiAqIEBhcGkgcHVibGljCiAqLwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihlbCwgYXR0cikgewogIHZhciByZXN1bHQgPSAoZWwuZ2V0QXR0cmlidXRlICYmIGVsLmdldEF0dHJpYnV0ZShhdHRyKSkgfHwgbnVsbDsKICBpZiggIXJlc3VsdCApIHsKICAgIHZhciBhdHRycyA9IGVsLmF0dHJpYnV0ZXM7CiAgICB2YXIgbGVuZ3RoID0gYXR0cnMubGVuZ3RoOwogICAgZm9yKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChhdHRyW2ldICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZihhdHRyW2ldLm5vZGVOYW1lID09PSBhdHRyKSB7CiAgICAgICAgICByZXN1bHQgPSBhdHRyW2ldLm5vZGVWYWx1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuIHJlc3VsdDsKfTsKCn0se31dLDEzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoqCiAqIEEgY3Jvc3MtYnJvd3NlciBpbXBsZW1lbnRhdGlvbiBvZiBnZXRFbGVtZW50c0J5Q2xhc3MuCiAqIEhlYXZpbHkgYmFzZWQgb24gRHVzdGluIERpYXoncyBmdW5jdGlvbjogaHR0cDovL2R1c3RpbmRpYXouY29tL2dldGVsZW1lbnRzYnljbGFzcy4KICoKICogRmluZCBhbGwgZWxlbWVudHMgd2l0aCBjbGFzcyBgY2xhc3NOYW1lYCBpbnNpZGUgYGNvbnRhaW5lcmAuCiAqIFVzZSBgc2luZ2xlID0gdHJ1ZWAgdG8gaW5jcmVhc2UgcGVyZm9ybWFuY2UgaW4gb2xkZXIgYnJvd3NlcnMKICogd2hlbiBvbmx5IG9uZSBlbGVtZW50IGlzIG5lZWRlZC4KICoKICogQHBhcmFtIHtTdHJpbmd9IGNsYXNzTmFtZQogKiBAcGFyYW0ge0VsZW1lbnR9IGNvbnRhaW5lcgogKiBAcGFyYW0ge0Jvb2xlYW59IHNpbmdsZQogKiBAYXBpIHB1YmxpYwogKi8KCm1vZHVsZS5leHBvcnRzID0gKGZ1bmN0aW9uKCkgewogIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oY29udGFpbmVyLCBjbGFzc05hbWUsIHNpbmdsZSkgewogICAgICBpZiAoc2luZ2xlKSB7CiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSlbMF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSk7CiAgICAgIH0KICAgIH07CiAgfSBlbHNlIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oY29udGFpbmVyLCBjbGFzc05hbWUsIHNpbmdsZSkgewogICAgICBjbGFzc05hbWUgPSAnLicgKyBjbGFzc05hbWU7CiAgICAgIGlmIChzaW5nbGUpIHsKICAgICAgICByZXR1cm4gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoY2xhc3NOYW1lKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoY2xhc3NOYW1lKTsKICAgICAgfQogICAgfTsKICB9IGVsc2UgewogICAgcmV0dXJuIGZ1bmN0aW9uKGNvbnRhaW5lciwgY2xhc3NOYW1lLCBzaW5nbGUpIHsKICAgICAgdmFyIGNsYXNzRWxlbWVudHMgPSBbXSwKICAgICAgICB0YWcgPSAnKic7CiAgICAgIGlmIChjb250YWluZXIgPT09IG51bGwpIHsKICAgICAgICBjb250YWluZXIgPSBkb2N1bWVudDsKICAgICAgfQogICAgICB2YXIgZWxzID0gY29udGFpbmVyLmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZyk7CiAgICAgIHZhciBlbHNMZW4gPSBlbHMubGVuZ3RoOwogICAgICB2YXIgcGF0dGVybiA9IG5ldyBSZWdFeHAoIihefFxccykiK2NsYXNzTmFtZSsiKFxcc3wkKSIpOwogICAgICBmb3IgKHZhciBpID0gMCwgaiA9IDA7IGkgPCBlbHNMZW47IGkrKykgewogICAgICAgIGlmICggcGF0dGVybi50ZXN0KGVsc1tpXS5jbGFzc05hbWUpICkgewogICAgICAgICAgaWYgKHNpbmdsZSkgewogICAgICAgICAgICByZXR1cm4gZWxzW2ldOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2xhc3NFbGVtZW50c1tqXSA9IGVsc1tpXTsKICAgICAgICAgICAgaisrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gY2xhc3NFbGVtZW50czsKICAgIH07CiAgfQp9KSgpOwoKfSx7fV0sMTQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgaW5kZXhPZiA9IFtdLmluZGV4T2Y7Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGFyciwgb2JqKXsKICBpZiAoaW5kZXhPZikgcmV0dXJuIGFyci5pbmRleE9mKG9iaik7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyArK2kpIHsKICAgIGlmIChhcnJbaV0gPT09IG9iaikgcmV0dXJuIGk7CiAgfQogIHJldHVybiAtMTsKfTsKCn0se31dLDE1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoKICogTmF0dXJhbCBTb3J0IGFsZ29yaXRobSBmb3IgSmF2YXNjcmlwdCAtIFZlcnNpb24gMC44LjEgLSBSZWxlYXNlZCB1bmRlciBNSVQgbGljZW5zZQogKiBBdXRob3I6IEppbSBQYWxtZXIgKGJhc2VkIG9uIGNodW5raW5nIGlkZWEgZnJvbSBEYXZlIEtvZWxsZSkKICovCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYSwgYiwgb3B0cykgewogICAgdmFyIHJlID0gLyheKFsrXC1dP1xkKyg/OlwuXGQqKT8oPzpbZUVdWytcLV0/XGQrKT8oPz1cRHxcc3wkKSl8XjB4W1xkYS1mQS1GXSskfFxkKykvZywKICAgICAgICBzcmUgPSAvXlxzK3xccyskL2csICAgLy8gdHJpbSBwcmUtcG9zdCB3aGl0ZXNwYWNlCiAgICAgICAgc25yZSA9IC9ccysvZywgICAgICAgIC8vIG5vcm1hbGl6ZSBhbGwgd2hpdGVzcGFjZSB0byBzaW5nbGUgJyAnIGNoYXJhY3RlcgogICAgICAgIGRyZSA9IC8oXihbXHcgXSssP1tcdyBdKyk/W1x3IF0rLD9bXHcgXStcZCs6XGQrKDpcZCspP1tcdyBdP3xeXGR7MSw0fVtcL1wtXVxkezEsNH1bXC9cLV1cZHsxLDR9fF5cdyssIFx3KyBcZCssIFxkezR9KS8sCiAgICAgICAgaHJlID0gL14weFswLTlhLWZdKyQvaSwKICAgICAgICBvcmUgPSAvXjAvLAogICAgICAgIG9wdGlvbnMgPSBvcHRzIHx8IHt9LAogICAgICAgIGkgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgICAgIHJldHVybiAob3B0aW9ucy5pbnNlbnNpdGl2ZSAmJiAoJycgKyBzKS50b0xvd2VyQ2FzZSgpIHx8ICcnICsgcykucmVwbGFjZShzcmUsICcnKTsKICAgICAgICB9LAogICAgICAgIC8vIGNvbnZlcnQgYWxsIHRvIHN0cmluZ3Mgc3RyaXAgd2hpdGVzcGFjZQogICAgICAgIHggPSBpKGEpLAogICAgICAgIHkgPSBpKGIpLAogICAgICAgIC8vIGNodW5rL3Rva2VuaXplCiAgICAgICAgeE4gPSB4LnJlcGxhY2UocmUsICdcMCQxXDAnKS5yZXBsYWNlKC9cMCQvLCcnKS5yZXBsYWNlKC9eXDAvLCcnKS5zcGxpdCgnXDAnKSwKICAgICAgICB5TiA9IHkucmVwbGFjZShyZSwgJ1wwJDFcMCcpLnJlcGxhY2UoL1wwJC8sJycpLnJlcGxhY2UoL15cMC8sJycpLnNwbGl0KCdcMCcpLAogICAgICAgIC8vIG51bWVyaWMsIGhleCBvciBkYXRlIGRldGVjdGlvbgogICAgICAgIHhEID0gcGFyc2VJbnQoeC5tYXRjaChocmUpLCAxNikgfHwgKHhOLmxlbmd0aCAhPT0gMSAmJiBEYXRlLnBhcnNlKHgpKSwKICAgICAgICB5RCA9IHBhcnNlSW50KHkubWF0Y2goaHJlKSwgMTYpIHx8IHhEICYmIHkubWF0Y2goZHJlKSAmJiBEYXRlLnBhcnNlKHkpIHx8IG51bGwsCiAgICAgICAgbm9ybUNodW5rID0gZnVuY3Rpb24ocywgbCkgewogICAgICAgICAgIC8vIG5vcm1hbGl6ZSBzcGFjZXM7IGZpbmQgZmxvYXRzIG5vdCBzdGFydGluZyB3aXRoICcwJywgc3RyaW5nIG9yIDAgaWYgbm90IGRlZmluZWQgKENsaW50IFByaWVzdCkKICAgICAgICAgICByZXR1cm4gKCFzLm1hdGNoKG9yZSkgfHwgbCA9PSAxKSAmJiBwYXJzZUZsb2F0KHMpIHx8IHMucmVwbGFjZShzbnJlLCAnICcpLnJlcGxhY2Uoc3JlLCAnJykgfHwgMDsKICAgICAgICB9LAogICAgICAgIG9GeE5jTCwgb0Z5TmNMOwogICAvLyBmaXJzdCB0cnkgYW5kIHNvcnQgSGV4IGNvZGVzIG9yIERhdGVzCiAgIGlmICh5RCkgewogICAgICAgaWYgKHhEIDwgeUQpIHsgcmV0dXJuIC0xOyB9CiAgICAgICBlbHNlIGlmICh4RCA+IHlEKSB7IHJldHVybiAxOyB9CiAgIH0KICAgLy8gbmF0dXJhbCBzb3J0aW5nIHRocm91Z2ggc3BsaXQgbnVtZXJpYyBzdHJpbmdzIGFuZCBkZWZhdWx0IHN0cmluZ3MKICAgZm9yKHZhciBjTG9jID0gMCwgeE5sID0geE4ubGVuZ3RoLCB5TmwgPSB5Ti5sZW5ndGgsIG51bVMgPSBNYXRoLm1heCh4TmwsIHlObCk7IGNMb2MgPCBudW1TOyBjTG9jKyspIHsKICAgICAgIG9GeE5jTCA9IG5vcm1DaHVuayh4TltjTG9jXSB8fCAnJywgeE5sKTsKICAgICAgIG9GeU5jTCA9IG5vcm1DaHVuayh5TltjTG9jXSB8fCAnJywgeU5sKTsKICAgICAgIC8vIGhhbmRsZSBudW1lcmljIHZzIHN0cmluZyBjb21wYXJpc29uIC0gbnVtYmVyIDwgc3RyaW5nIC0gKEt5bGUgQWRhbXMpCiAgICAgICBpZiAoaXNOYU4ob0Z4TmNMKSAhPT0gaXNOYU4ob0Z5TmNMKSkgewogICAgICAgICAgIHJldHVybiBpc05hTihvRnhOY0wpID8gMSA6IC0xOwogICAgICAgfQogICAgICAgLy8gaWYgdW5pY29kZSB1c2UgbG9jYWxlIGNvbXBhcmlzb24KICAgICAgIGlmICgvW15ceDAwLVx4ODBdLy50ZXN0KG9GeE5jTCArIG9GeU5jTCkgJiYgb0Z4TmNMLmxvY2FsZUNvbXBhcmUpIHsKICAgICAgICAgICB2YXIgY29tcCA9IG9GeE5jTC5sb2NhbGVDb21wYXJlKG9GeU5jTCk7CiAgICAgICAgICAgcmV0dXJuIGNvbXAgLyBNYXRoLmFicyhjb21wKTsKICAgICAgIH0KICAgICAgIGlmIChvRnhOY0wgPCBvRnlOY0wpIHsgcmV0dXJuIC0xOyB9CiAgICAgICBlbHNlIGlmIChvRnhOY0wgPiBvRnlOY0wpIHsgcmV0dXJuIDE7IH0KICAgfQogICAgcmV0dXJuIDA7Cn07Cgp9LHt9XSwxNjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8qKgogKiBTb3VyY2U6IGh0dHBzOi8vZ2l0aHViLmNvbS90aW1veGxleS90by1hcnJheQogKgogKiBDb252ZXJ0IGFuIGFycmF5LWxpa2Ugb2JqZWN0IGludG8gYW4gYEFycmF5YC4KICogSWYgYGNvbGxlY3Rpb25gIGlzIGFscmVhZHkgYW4gYEFycmF5YCwgdGhlbiB3aWxsIHJldHVybiBhIGNsb25lIG9mIGBjb2xsZWN0aW9uYC4KICoKICogQHBhcmFtIHtBcnJheSB8IE1peGVkfSBjb2xsZWN0aW9uIEFuIGBBcnJheWAgb3IgYXJyYXktbGlrZSBvYmplY3QgdG8gY29udmVydCBlLmcuIGBhcmd1bWVudHNgIG9yIGBOb2RlTGlzdGAKICogQHJldHVybiB7QXJyYXl9IE5haXZlIGNvbnZlcnNpb24gb2YgYGNvbGxlY3Rpb25gIHRvIGEgbmV3IGBBcnJheWAuCiAqIEBhcGkgcHVibGljCiAqLwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiB0b0FycmF5KGNvbGxlY3Rpb24pIHsKICBpZiAodHlwZW9mIGNvbGxlY3Rpb24gPT09ICd1bmRlZmluZWQnKSByZXR1cm4gW107CiAgaWYgKGNvbGxlY3Rpb24gPT09IG51bGwpIHJldHVybiBbbnVsbF07CiAgaWYgKGNvbGxlY3Rpb24gPT09IHdpbmRvdykgcmV0dXJuIFt3aW5kb3ddOwogIGlmICh0eXBlb2YgY29sbGVjdGlvbiA9PT0gJ3N0cmluZycpIHJldHVybiBbY29sbGVjdGlvbl07CiAgaWYgKGlzQXJyYXkoY29sbGVjdGlvbikpIHJldHVybiBjb2xsZWN0aW9uOwogIGlmICh0eXBlb2YgY29sbGVjdGlvbi5sZW5ndGggIT0gJ251bWJlcicpIHJldHVybiBbY29sbGVjdGlvbl07CiAgaWYgKHR5cGVvZiBjb2xsZWN0aW9uID09PSAnZnVuY3Rpb24nICYmIGNvbGxlY3Rpb24gaW5zdGFuY2VvZiBGdW5jdGlvbikgcmV0dXJuIFtjb2xsZWN0aW9uXTsKCiAgdmFyIGFyciA9IFtdOwogIGZvciAodmFyIGkgPSAwOyBpIDwgY29sbGVjdGlvbi5sZW5ndGg7IGkrKykgewogICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChjb2xsZWN0aW9uLCBpKSB8fCBpIGluIGNvbGxlY3Rpb24pIHsKICAgICAgYXJyLnB1c2goY29sbGVjdGlvbltpXSk7CiAgICB9CiAgfQogIGlmICghYXJyLmxlbmd0aCkgcmV0dXJuIFtdOwogIHJldHVybiBhcnI7Cn07CgpmdW5jdGlvbiBpc0FycmF5KGFycikgewogIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKSA9PT0gIltvYmplY3QgQXJyYXldIjsKfQoKfSx7fV0sMTc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHMpIHsKICBzID0gKHMgPT09IHVuZGVmaW5lZCkgPyAiIiA6IHM7CiAgcyA9IChzID09PSBudWxsKSA/ICIiIDogczsKICBzID0gcy50b1N0cmluZygpOwogIHJldHVybiBzOwp9OwoKfSx7fV19LHt9LFsxXSk7CgogIDwvc2NyaXB0PgogIDxzY3JpcHQ+CiAgOyhmdW5jdGlvbigpewoKLyoqCiAqIFJlcXVpcmUgdGhlIGdpdmVuIHBhdGguCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoCiAqIEByZXR1cm4ge09iamVjdH0gZXhwb3J0cwogKiBAYXBpIHB1YmxpYwogKi8KCmZ1bmN0aW9uIHJlcXVpcmUocGF0aCwgcGFyZW50LCBvcmlnKSB7CiAgdmFyIHJlc29sdmVkID0gcmVxdWlyZS5yZXNvbHZlKHBhdGgpOwoKICAvLyBsb29rdXAgZmFpbGVkCiAgaWYgKG51bGwgPT0gcmVzb2x2ZWQpIHsKICAgIG9yaWcgPSBvcmlnIHx8IHBhdGg7CiAgICBwYXJlbnQgPSBwYXJlbnQgfHwgJ3Jvb3QnOwogICAgdmFyIGVyciA9IG5ldyBFcnJvcignRmFpbGVkIHRvIHJlcXVpcmUgIicgKyBvcmlnICsgJyIgZnJvbSAiJyArIHBhcmVudCArICciJyk7CiAgICBlcnIucGF0aCA9IG9yaWc7CiAgICBlcnIucGFyZW50ID0gcGFyZW50OwogICAgZXJyLnJlcXVpcmUgPSB0cnVlOwogICAgdGhyb3cgZXJyOwogIH0KCiAgdmFyIG1vZHVsZSA9IHJlcXVpcmUubW9kdWxlc1tyZXNvbHZlZF07CgogIC8vIHBlcmZvcm0gcmVhbCByZXF1aXJlKCkKICAvLyBieSBpbnZva2luZyB0aGUgbW9kdWxlJ3MKICAvLyByZWdpc3RlcmVkIGZ1bmN0aW9uCiAgaWYgKCFtb2R1bGUuX3Jlc29sdmluZyAmJiAhbW9kdWxlLmV4cG9ydHMpIHsKICAgIHZhciBtb2QgPSB7fTsKICAgIG1vZC5leHBvcnRzID0ge307CiAgICBtb2QuY2xpZW50ID0gbW9kLmNvbXBvbmVudCA9IHRydWU7CiAgICBtb2R1bGUuX3Jlc29sdmluZyA9IHRydWU7CiAgICBtb2R1bGUuY2FsbCh0aGlzLCBtb2QuZXhwb3J0cywgcmVxdWlyZS5yZWxhdGl2ZShyZXNvbHZlZCksIG1vZCk7CiAgICBkZWxldGUgbW9kdWxlLl9yZXNvbHZpbmc7CiAgICBtb2R1bGUuZXhwb3J0cyA9IG1vZC5leHBvcnRzOwogIH0KCiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwp9CgovKioKICogUmVnaXN0ZXJlZCBtb2R1bGVzLgogKi8KCnJlcXVpcmUubW9kdWxlcyA9IHt9OwoKLyoqCiAqIFJlZ2lzdGVyZWQgYWxpYXNlcy4KICovCgpyZXF1aXJlLmFsaWFzZXMgPSB7fTsKCi8qKgogKiBSZXNvbHZlIGBwYXRoYC4KICoKICogTG9va3VwOgogKgogKiAgIC0gUEFUSC9pbmRleC5qcwogKiAgIC0gUEFUSC5qcwogKiAgIC0gUEFUSAogKgogKiBAcGFyYW0ge1N0cmluZ30gcGF0aAogKiBAcmV0dXJuIHtTdHJpbmd9IHBhdGggb3IgbnVsbAogKiBAYXBpIHByaXZhdGUKICovCgpyZXF1aXJlLnJlc29sdmUgPSBmdW5jdGlvbihwYXRoKSB7CiAgaWYgKHBhdGguY2hhckF0KDApID09PSAnLycpIHBhdGggPSBwYXRoLnNsaWNlKDEpOwoKICB2YXIgcGF0aHMgPSBbCiAgICBwYXRoLAogICAgcGF0aCArICcuanMnLAogICAgcGF0aCArICcuanNvbicsCiAgICBwYXRoICsgJy9pbmRleC5qcycsCiAgICBwYXRoICsgJy9pbmRleC5qc29uJwogIF07CgogIGZvciAodmFyIGkgPSAwOyBpIDwgcGF0aHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBwYXRoID0gcGF0aHNbaV07CiAgICBpZiAocmVxdWlyZS5tb2R1bGVzLmhhc093blByb3BlcnR5KHBhdGgpKSByZXR1cm4gcGF0aDsKICAgIGlmIChyZXF1aXJlLmFsaWFzZXMuaGFzT3duUHJvcGVydHkocGF0aCkpIHJldHVybiByZXF1aXJlLmFsaWFzZXNbcGF0aF07CiAgfQp9OwoKLyoqCiAqIE5vcm1hbGl6ZSBgcGF0aGAgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgcGF0aC4KICoKICogQHBhcmFtIHtTdHJpbmd9IGN1cnIKICogQHBhcmFtIHtTdHJpbmd9IHBhdGgKICogQHJldHVybiB7U3RyaW5nfQogKiBAYXBpIHByaXZhdGUKICovCgpyZXF1aXJlLm5vcm1hbGl6ZSA9IGZ1bmN0aW9uKGN1cnIsIHBhdGgpIHsKICB2YXIgc2VncyA9IFtdOwoKICBpZiAoJy4nICE9IHBhdGguY2hhckF0KDApKSByZXR1cm4gcGF0aDsKCiAgY3VyciA9IGN1cnIuc3BsaXQoJy8nKTsKICBwYXRoID0gcGF0aC5zcGxpdCgnLycpOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGgubGVuZ3RoOyArK2kpIHsKICAgIGlmICgnLi4nID09IHBhdGhbaV0pIHsKICAgICAgY3Vyci5wb3AoKTsKICAgIH0gZWxzZSBpZiAoJy4nICE9IHBhdGhbaV0gJiYgJycgIT0gcGF0aFtpXSkgewogICAgICBzZWdzLnB1c2gocGF0aFtpXSk7CiAgICB9CiAgfQoKICByZXR1cm4gY3Vyci5jb25jYXQoc2Vncykuam9pbignLycpOwp9OwoKLyoqCiAqIFJlZ2lzdGVyIG1vZHVsZSBhdCBgcGF0aGAgd2l0aCBjYWxsYmFjayBgZGVmaW5pdGlvbmAuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoCiAqIEBwYXJhbSB7RnVuY3Rpb259IGRlZmluaXRpb24KICogQGFwaSBwcml2YXRlCiAqLwoKcmVxdWlyZS5yZWdpc3RlciA9IGZ1bmN0aW9uKHBhdGgsIGRlZmluaXRpb24pIHsKICByZXF1aXJlLm1vZHVsZXNbcGF0aF0gPSBkZWZpbml0aW9uOwp9OwoKLyoqCiAqIEFsaWFzIGEgbW9kdWxlIGRlZmluaXRpb24uCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBmcm9tCiAqIEBwYXJhbSB7U3RyaW5nfSB0bwogKiBAYXBpIHByaXZhdGUKICovCgpyZXF1aXJlLmFsaWFzID0gZnVuY3Rpb24oZnJvbSwgdG8pIHsKICBpZiAoIXJlcXVpcmUubW9kdWxlcy5oYXNPd25Qcm9wZXJ0eShmcm9tKSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gYWxpYXMgIicgKyBmcm9tICsgJyIsIGl0IGRvZXMgbm90IGV4aXN0Jyk7CiAgfQogIHJlcXVpcmUuYWxpYXNlc1t0b10gPSBmcm9tOwp9OwoKLyoqCiAqIFJldHVybiBhIHJlcXVpcmUgZnVuY3Rpb24gcmVsYXRpdmUgdG8gdGhlIGBwYXJlbnRgIHBhdGguCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXJlbnQKICogQHJldHVybiB7RnVuY3Rpb259CiAqIEBhcGkgcHJpdmF0ZQogKi8KCnJlcXVpcmUucmVsYXRpdmUgPSBmdW5jdGlvbihwYXJlbnQpIHsKICB2YXIgcCA9IHJlcXVpcmUubm9ybWFsaXplKHBhcmVudCwgJy4uJyk7CgogIC8qKgogICAqIGxhc3RJbmRleE9mIGhlbHBlci4KICAgKi8KCiAgZnVuY3Rpb24gbGFzdEluZGV4T2YoYXJyLCBvYmopIHsKICAgIHZhciBpID0gYXJyLmxlbmd0aDsKICAgIHdoaWxlIChpLS0pIHsKICAgICAgaWYgKGFycltpXSA9PT0gb2JqKSByZXR1cm4gaTsKICAgIH0KICAgIHJldHVybiAtMTsKICB9CgogIC8qKgogICAqIFRoZSByZWxhdGl2ZSByZXF1aXJlKCkgaXRzZWxmLgogICAqLwoKICBmdW5jdGlvbiBsb2NhbFJlcXVpcmUocGF0aCkgewogICAgdmFyIHJlc29sdmVkID0gbG9jYWxSZXF1aXJlLnJlc29sdmUocGF0aCk7CiAgICByZXR1cm4gcmVxdWlyZShyZXNvbHZlZCwgcGFyZW50LCBwYXRoKTsKICB9CgogIC8qKgogICAqIFJlc29sdmUgcmVsYXRpdmUgdG8gdGhlIHBhcmVudC4KICAgKi8KCiAgbG9jYWxSZXF1aXJlLnJlc29sdmUgPSBmdW5jdGlvbihwYXRoKSB7CiAgICB2YXIgYyA9IHBhdGguY2hhckF0KDApOwogICAgaWYgKCcvJyA9PSBjKSByZXR1cm4gcGF0aC5zbGljZSgxKTsKICAgIGlmICgnLicgPT0gYykgcmV0dXJuIHJlcXVpcmUubm9ybWFsaXplKHAsIHBhdGgpOwoKICAgIC8vIHJlc29sdmUgZGVwcyBieSByZXR1cm5pbmcKICAgIC8vIHRoZSBkZXAgaW4gdGhlIG5lYXJlc3QgImRlcHMiCiAgICAvLyBkaXJlY3RvcnkKICAgIHZhciBzZWdzID0gcGFyZW50LnNwbGl0KCcvJyk7CiAgICB2YXIgaSA9IGxhc3RJbmRleE9mKHNlZ3MsICdkZXBzJykgKyAxOwogICAgaWYgKCFpKSBpID0gMDsKICAgIHBhdGggPSBzZWdzLnNsaWNlKDAsIGkgKyAxKS5qb2luKCcvJykgKyAnL2RlcHMvJyArIHBhdGg7CiAgICByZXR1cm4gcGF0aDsKICB9OwoKICAvKioKICAgKiBDaGVjayBpZiBtb2R1bGUgaXMgZGVmaW5lZCBhdCBgcGF0aGAuCiAgICovCgogIGxvY2FsUmVxdWlyZS5leGlzdHMgPSBmdW5jdGlvbihwYXRoKSB7CiAgICByZXR1cm4gcmVxdWlyZS5tb2R1bGVzLmhhc093blByb3BlcnR5KGxvY2FsUmVxdWlyZS5yZXNvbHZlKHBhdGgpKTsKICB9OwoKICByZXR1cm4gbG9jYWxSZXF1aXJlOwp9OwpyZXF1aXJlLnJlZ2lzdGVyKCJjb21wb25lbnQtY2xhc3Nlcy9pbmRleC5qcyIsIGZ1bmN0aW9uKGV4cG9ydHMsIHJlcXVpcmUsIG1vZHVsZSl7Ci8qKgogKiBNb2R1bGUgZGVwZW5kZW5jaWVzLgogKi8KCnZhciBpbmRleCA9IHJlcXVpcmUoJ2luZGV4b2YnKTsKCi8qKgogKiBXaGl0ZXNwYWNlIHJlZ2V4cC4KICovCgp2YXIgcmUgPSAvXHMrLzsKCi8qKgogKiB0b1N0cmluZyByZWZlcmVuY2UuCiAqLwoKdmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKCi8qKgogKiBXcmFwIGBlbGAgaW4gYSBgQ2xhc3NMaXN0YC4KICoKICogQHBhcmFtIHtFbGVtZW50fSBlbAogKiBAcmV0dXJuIHtDbGFzc0xpc3R9CiAqIEBhcGkgcHVibGljCiAqLwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihlbCl7CiAgcmV0dXJuIG5ldyBDbGFzc0xpc3QoZWwpOwp9OwoKLyoqCiAqIEluaXRpYWxpemUgYSBuZXcgQ2xhc3NMaXN0IGZvciBgZWxgLgogKgogKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAqIEBhcGkgcHJpdmF0ZQogKi8KCmZ1bmN0aW9uIENsYXNzTGlzdChlbCkgewogIGlmICghZWwpIHRocm93IG5ldyBFcnJvcignQSBET00gZWxlbWVudCByZWZlcmVuY2UgaXMgcmVxdWlyZWQnKTsKICB0aGlzLmVsID0gZWw7CiAgdGhpcy5saXN0ID0gZWwuY2xhc3NMaXN0Owp9CgovKioKICogQWRkIGNsYXNzIGBuYW1lYCBpZiBub3QgYWxyZWFkeSBwcmVzZW50LgogKgogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9CiAqIEBhcGkgcHVibGljCiAqLwoKQ2xhc3NMaXN0LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihuYW1lKXsKICAvLyBjbGFzc0xpc3QKICBpZiAodGhpcy5saXN0KSB7CiAgICB0aGlzLmxpc3QuYWRkKG5hbWUpOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICAvLyBmYWxsYmFjawogIHZhciBhcnIgPSB0aGlzLmFycmF5KCk7CiAgdmFyIGkgPSBpbmRleChhcnIsIG5hbWUpOwogIGlmICghfmkpIGFyci5wdXNoKG5hbWUpOwogIHRoaXMuZWwuY2xhc3NOYW1lID0gYXJyLmpvaW4oJyAnKTsKICByZXR1cm4gdGhpczsKfTsKCi8qKgogKiBSZW1vdmUgY2xhc3MgYG5hbWVgIHdoZW4gcHJlc2VudCwgb3IKICogcGFzcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byByZW1vdmUKICogYW55IHdoaWNoIG1hdGNoLgogKgogKiBAcGFyYW0ge1N0cmluZ3xSZWdFeHB9IG5hbWUKICogQHJldHVybiB7Q2xhc3NMaXN0fQogKiBAYXBpIHB1YmxpYwogKi8KCkNsYXNzTGlzdC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24obmFtZSl7CiAgaWYgKCdbb2JqZWN0IFJlZ0V4cF0nID09IHRvU3RyaW5nLmNhbGwobmFtZSkpIHsKICAgIHJldHVybiB0aGlzLnJlbW92ZU1hdGNoaW5nKG5hbWUpOwogIH0KCiAgLy8gY2xhc3NMaXN0CiAgaWYgKHRoaXMubGlzdCkgewogICAgdGhpcy5saXN0LnJlbW92ZShuYW1lKTsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgLy8gZmFsbGJhY2sKICB2YXIgYXJyID0gdGhpcy5hcnJheSgpOwogIHZhciBpID0gaW5kZXgoYXJyLCBuYW1lKTsKICBpZiAofmkpIGFyci5zcGxpY2UoaSwgMSk7CiAgdGhpcy5lbC5jbGFzc05hbWUgPSBhcnIuam9pbignICcpOwogIHJldHVybiB0aGlzOwp9OwoKLyoqCiAqIFJlbW92ZSBhbGwgY2xhc3NlcyBtYXRjaGluZyBgcmVgLgogKgogKiBAcGFyYW0ge1JlZ0V4cH0gcmUKICogQHJldHVybiB7Q2xhc3NMaXN0fQogKiBAYXBpIHByaXZhdGUKICovCgpDbGFzc0xpc3QucHJvdG90eXBlLnJlbW92ZU1hdGNoaW5nID0gZnVuY3Rpb24ocmUpewogIHZhciBhcnIgPSB0aGlzLmFycmF5KCk7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgIGlmIChyZS50ZXN0KGFycltpXSkpIHsKICAgICAgdGhpcy5yZW1vdmUoYXJyW2ldKTsKICAgIH0KICB9CiAgcmV0dXJuIHRoaXM7Cn07CgovKioKICogVG9nZ2xlIGNsYXNzIGBuYW1lYCwgY2FuIGZvcmNlIHN0YXRlIHZpYSBgZm9yY2VgLgogKgogKiBGb3IgYnJvd3NlcnMgdGhhdCBzdXBwb3J0IGNsYXNzTGlzdCwgYnV0IGRvIG5vdCBzdXBwb3J0IGBmb3JjZWAgeWV0LAogKiB0aGUgbWlzdGFrZSB3aWxsIGJlIGRldGVjdGVkIGFuZCBjb3JyZWN0ZWQuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAqIEBwYXJhbSB7Qm9vbGVhbn0gZm9yY2UKICogQHJldHVybiB7Q2xhc3NMaXN0fQogKiBAYXBpIHB1YmxpYwogKi8KCkNsYXNzTGlzdC5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24obmFtZSwgZm9yY2UpewogIC8vIGNsYXNzTGlzdAogIGlmICh0aGlzLmxpc3QpIHsKICAgIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGZvcmNlKSB7CiAgICAgIGlmIChmb3JjZSAhPT0gdGhpcy5saXN0LnRvZ2dsZShuYW1lLCBmb3JjZSkpIHsKICAgICAgICB0aGlzLmxpc3QudG9nZ2xlKG5hbWUpOyAvLyB0b2dnbGUgYWdhaW4gdG8gY29ycmVjdAogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmxpc3QudG9nZ2xlKG5hbWUpOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfQoKICAvLyBmYWxsYmFjawogIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGZvcmNlKSB7CiAgICBpZiAoIWZvcmNlKSB7CiAgICAgIHRoaXMucmVtb3ZlKG5hbWUpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5hZGQobmFtZSk7CiAgICB9CiAgfSBlbHNlIHsKICAgIGlmICh0aGlzLmhhcyhuYW1lKSkgewogICAgICB0aGlzLnJlbW92ZShuYW1lKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuYWRkKG5hbWUpOwogICAgfQogIH0KCiAgcmV0dXJuIHRoaXM7Cn07CgovKioKICogUmV0dXJuIGFuIGFycmF5IG9mIGNsYXNzZXMuCiAqCiAqIEByZXR1cm4ge0FycmF5fQogKiBAYXBpIHB1YmxpYwogKi8KCkNsYXNzTGlzdC5wcm90b3R5cGUuYXJyYXkgPSBmdW5jdGlvbigpewogIHZhciBzdHIgPSB0aGlzLmVsLmNsYXNzTmFtZS5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpOwogIHZhciBhcnIgPSBzdHIuc3BsaXQocmUpOwogIGlmICgnJyA9PT0gYXJyWzBdKSBhcnIuc2hpZnQoKTsKICByZXR1cm4gYXJyOwp9OwoKLyoqCiAqIENoZWNrIGlmIGNsYXNzIGBuYW1lYCBpcyBwcmVzZW50LgogKgogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogKiBAcmV0dXJuIHtDbGFzc0xpc3R9CiAqIEBhcGkgcHVibGljCiAqLwoKQ2xhc3NMaXN0LnByb3RvdHlwZS5oYXMgPQpDbGFzc0xpc3QucHJvdG90eXBlLmNvbnRhaW5zID0gZnVuY3Rpb24obmFtZSl7CiAgcmV0dXJuIHRoaXMubGlzdAogICAgPyB0aGlzLmxpc3QuY29udGFpbnMobmFtZSkKICAgIDogISEgfmluZGV4KHRoaXMuYXJyYXkoKSwgbmFtZSk7Cn07Cgp9KTsKcmVxdWlyZS5yZWdpc3RlcigiY29tcG9uZW50LWV2ZW50L2luZGV4LmpzIiwgZnVuY3Rpb24oZXhwb3J0cywgcmVxdWlyZSwgbW9kdWxlKXsKdmFyIGJpbmQgPSB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciA/ICdhZGRFdmVudExpc3RlbmVyJyA6ICdhdHRhY2hFdmVudCcsCiAgICB1bmJpbmQgPSB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lciA/ICdyZW1vdmVFdmVudExpc3RlbmVyJyA6ICdkZXRhY2hFdmVudCcsCiAgICBwcmVmaXggPSBiaW5kICE9PSAnYWRkRXZlbnRMaXN0ZW5lcicgPyAnb24nIDogJyc7CgovKioKICogQmluZCBgZWxgIGV2ZW50IGB0eXBlYCB0byBgZm5gLgogKgogKiBAcGFyYW0ge0VsZW1lbnR9IGVsCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAqIEBwYXJhbSB7Qm9vbGVhbn0gY2FwdHVyZQogKiBAcmV0dXJuIHtGdW5jdGlvbn0KICogQGFwaSBwdWJsaWMKICovCgpleHBvcnRzLmJpbmQgPSBmdW5jdGlvbihlbCwgdHlwZSwgZm4sIGNhcHR1cmUpewogIGVsW2JpbmRdKHByZWZpeCArIHR5cGUsIGZuLCBjYXB0dXJlIHx8IGZhbHNlKTsKICByZXR1cm4gZm47Cn07CgovKioKICogVW5iaW5kIGBlbGAgZXZlbnQgYHR5cGVgJ3MgY2FsbGJhY2sgYGZuYC4KICoKICogQHBhcmFtIHtFbGVtZW50fSBlbAogKiBAcGFyYW0ge1N0cmluZ30gdHlwZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogKiBAcGFyYW0ge0Jvb2xlYW59IGNhcHR1cmUKICogQHJldHVybiB7RnVuY3Rpb259CiAqIEBhcGkgcHVibGljCiAqLwoKZXhwb3J0cy51bmJpbmQgPSBmdW5jdGlvbihlbCwgdHlwZSwgZm4sIGNhcHR1cmUpewogIGVsW3VuYmluZF0ocHJlZml4ICsgdHlwZSwgZm4sIGNhcHR1cmUgfHwgZmFsc2UpOwogIHJldHVybiBmbjsKfTsKfSk7CnJlcXVpcmUucmVnaXN0ZXIoImNvbXBvbmVudC1pbmRleG9mL2luZGV4LmpzIiwgZnVuY3Rpb24oZXhwb3J0cywgcmVxdWlyZSwgbW9kdWxlKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihhcnIsIG9iail7CiAgaWYgKGFyci5pbmRleE9mKSByZXR1cm4gYXJyLmluZGV4T2Yob2JqKTsKICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7ICsraSkgewogICAgaWYgKGFycltpXSA9PT0gb2JqKSByZXR1cm4gaTsKICB9CiAgcmV0dXJuIC0xOwp9Owp9KTsKcmVxdWlyZS5yZWdpc3RlcigibGlzdC5wYWdpbmF0aW9uLmpzL2luZGV4LmpzIiwgZnVuY3Rpb24oZXhwb3J0cywgcmVxdWlyZSwgbW9kdWxlKXsKdmFyIGNsYXNzZXMgPSByZXF1aXJlKCdjbGFzc2VzJyksCiAgICBldmVudHMgPSByZXF1aXJlKCdldmVudCcpOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCiAgICB2YXIgcGFnaW5nTGlzdCwKICAgICAgICBsaXN0OwoKICAgIHZhciByZWZyZXNoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGl0ZW0sCiAgICAgICAgICAgIGwgPSBsaXN0Lm1hdGNoaW5nSXRlbXMubGVuZ3RoLAogICAgICAgICAgICBpbmRleCA9IGxpc3QuaSwKICAgICAgICAgICAgcGFnZSA9IGxpc3QucGFnZSwKICAgICAgICAgICAgcGFnZXMgPSBNYXRoLmNlaWwobCAvIHBhZ2UpLAogICAgICAgICAgICBjdXJyZW50UGFnZSA9IE1hdGguY2VpbCgoaW5kZXggLyBwYWdlKSksCiAgICAgICAgICAgIGlubmVyV2luZG93ID0gb3B0aW9ucy5pbm5lcldpbmRvdyB8fCAyLAogICAgICAgICAgICBsZWZ0ID0gb3B0aW9ucy5sZWZ0IHx8IG9wdGlvbnMub3V0ZXJXaW5kb3cgfHwgMCwKICAgICAgICAgICAgcmlnaHQgPSBvcHRpb25zLnJpZ2h0IHx8IG9wdGlvbnMub3V0ZXJXaW5kb3cgfHwgMDsKCiAgICAgICAgcmlnaHQgPSBwYWdlcyAtIHJpZ2h0OwoKICAgICAgICBwYWdpbmdMaXN0LmNsZWFyKCk7CiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gcGFnZXM7IGkrKykgewogICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gKGN1cnJlbnRQYWdlID09PSBpKSA/ICJhY3RpdmUiIDogIiI7CgogICAgICAgICAgICAvL2NvbnNvbGUubG9nKGksIGxlZnQsIHJpZ2h0LCBjdXJyZW50UGFnZSwgKGN1cnJlbnRQYWdlIC0gaW5uZXJXaW5kb3cpLCAoY3VycmVudFBhZ2UgKyBpbm5lcldpbmRvdyksIGNsYXNzTmFtZSk7CgogICAgICAgICAgICBpZiAoaXMubnVtYmVyKGksIGxlZnQsIHJpZ2h0LCBjdXJyZW50UGFnZSwgaW5uZXJXaW5kb3cpKSB7CiAgICAgICAgICAgICAgICBpdGVtID0gcGFnaW5nTGlzdC5hZGQoewogICAgICAgICAgICAgICAgICAgIHBhZ2U6IGksCiAgICAgICAgICAgICAgICAgICAgZG90dGVkOiBmYWxzZQogICAgICAgICAgICAgICAgfSlbMF07CiAgICAgICAgICAgICAgICBpZiAoY2xhc3NOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3NlcyhpdGVtLmVsbSkuYWRkKGNsYXNzTmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhZGRFdmVudChpdGVtLmVsbSwgaSwgcGFnZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXMuZG90dGVkKGksIGxlZnQsIHJpZ2h0LCBjdXJyZW50UGFnZSwgaW5uZXJXaW5kb3csIHBhZ2luZ0xpc3Quc2l6ZSgpKSkgewogICAgICAgICAgICAgICAgaXRlbSA9IHBhZ2luZ0xpc3QuYWRkKHsKICAgICAgICAgICAgICAgICAgICBwYWdlOiAiLi4uIiwKICAgICAgICAgICAgICAgICAgICBkb3R0ZWQ6IHRydWUKICAgICAgICAgICAgICAgIH0pWzBdOwogICAgICAgICAgICAgICAgY2xhc3NlcyhpdGVtLmVsbSkuYWRkKCJkaXNhYmxlZCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgaXMgPSB7CiAgICAgICAgbnVtYmVyOiBmdW5jdGlvbihpLCBsZWZ0LCByaWdodCwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93KSB7CiAgICAgICAgICAgcmV0dXJuIHRoaXMubGVmdChpLCBsZWZ0KSB8fCB0aGlzLnJpZ2h0KGksIHJpZ2h0KSB8fCB0aGlzLmlubmVyV2luZG93KGksIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdyk7CiAgICAgICAgfSwKICAgICAgICBsZWZ0OiBmdW5jdGlvbihpLCBsZWZ0KSB7CiAgICAgICAgICAgIHJldHVybiAoaSA8PSBsZWZ0KTsKICAgICAgICB9LAogICAgICAgIHJpZ2h0OiBmdW5jdGlvbihpLCByaWdodCkgewogICAgICAgICAgICByZXR1cm4gKGkgPiByaWdodCk7CiAgICAgICAgfSwKICAgICAgICBpbm5lcldpbmRvdzogZnVuY3Rpb24oaSwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93KSB7CiAgICAgICAgICAgIHJldHVybiAoIGkgPj0gKGN1cnJlbnRQYWdlIC0gaW5uZXJXaW5kb3cpICYmIGkgPD0gKGN1cnJlbnRQYWdlICsgaW5uZXJXaW5kb3cpKTsKICAgICAgICB9LAogICAgICAgIGRvdHRlZDogZnVuY3Rpb24oaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdywgY3VycmVudFBhZ2VJdGVtKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRvdHRlZExlZnQoaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdykgfHwgKHRoaXMuZG90dGVkUmlnaHQoaSwgbGVmdCwgcmlnaHQsIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdywgY3VycmVudFBhZ2VJdGVtKSk7CiAgICAgICAgfSwKICAgICAgICBkb3R0ZWRMZWZ0OiBmdW5jdGlvbihpLCBsZWZ0LCByaWdodCwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93KSB7CiAgICAgICAgICAgIHJldHVybiAoKGkgPT0gKGxlZnQgKyAxKSkgJiYgIXRoaXMuaW5uZXJXaW5kb3coaSwgY3VycmVudFBhZ2UsIGlubmVyV2luZG93KSAmJiAhdGhpcy5yaWdodChpLCByaWdodCkpOwogICAgICAgIH0sCiAgICAgICAgZG90dGVkUmlnaHQ6IGZ1bmN0aW9uKGksIGxlZnQsIHJpZ2h0LCBjdXJyZW50UGFnZSwgaW5uZXJXaW5kb3csIGN1cnJlbnRQYWdlSXRlbSkgewogICAgICAgICAgICBpZiAocGFnaW5nTGlzdC5pdGVtc1tjdXJyZW50UGFnZUl0ZW0tMV0udmFsdWVzKCkuZG90dGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKChpID09IChyaWdodCkpICYmICF0aGlzLmlubmVyV2luZG93KGksIGN1cnJlbnRQYWdlLCBpbm5lcldpbmRvdykgJiYgIXRoaXMucmlnaHQoaSwgcmlnaHQpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CgogICAgdmFyIGFkZEV2ZW50ID0gZnVuY3Rpb24oZWxtLCBpLCBwYWdlKSB7CiAgICAgICBldmVudHMuYmluZChlbG0sICdjbGljaycsIGZ1bmN0aW9uKCkgewogICAgICAgICAgIGxpc3Quc2hvdygoaS0xKSpwYWdlICsgMSwgcGFnZSk7CiAgICAgICB9KTsKICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgICBpbml0OiBmdW5jdGlvbihwYXJlbnRMaXN0KSB7CiAgICAgICAgICAgIGxpc3QgPSBwYXJlbnRMaXN0OwogICAgICAgICAgICBwYWdpbmdMaXN0ID0gbmV3IExpc3QobGlzdC5saXN0Q29udGFpbmVyLmlkLCB7CiAgICAgICAgICAgICAgICBsaXN0Q2xhc3M6IG9wdGlvbnMucGFnaW5hdGlvbkNsYXNzIHx8ICdwYWdpbmF0aW9uJywKICAgICAgICAgICAgICAgIGl0ZW06ICI8bGk+PGEgY2xhc3M9J3BhZ2UnIGhyZWY9J2phdmFzY3JpcHQ6ZnVuY3Rpb24gWigpe1o9XCJcIn1aKCknPjwvYT48L2xpPiIsCiAgICAgICAgICAgICAgICB2YWx1ZU5hbWVzOiBbJ3BhZ2UnLCAnZG90dGVkJ10sCiAgICAgICAgICAgICAgICBzZWFyY2hDbGFzczogJ3BhZ2luYXRpb24tc2VhcmNoLXRoYXQtaXMtbm90LXN1cHBvc2VkLXRvLWV4aXN0JywKICAgICAgICAgICAgICAgIHNvcnRDbGFzczogJ3BhZ2luYXRpb24tc29ydC10aGF0LWlzLW5vdC1zdXBwb3NlZC10by1leGlzdCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGxpc3Qub24oJ3VwZGF0ZWQnLCByZWZyZXNoKTsKICAgICAgICAgICAgcmVmcmVzaCgpOwogICAgICAgIH0sCiAgICAgICAgbmFtZTogb3B0aW9ucy5uYW1lIHx8ICJwYWdpbmF0aW9uIgogICAgfTsKfTsKCn0pOwoKCgoKCgpyZXF1aXJlLmFsaWFzKCJjb21wb25lbnQtY2xhc3Nlcy9pbmRleC5qcyIsICJsaXN0LnBhZ2luYXRpb24uanMvZGVwcy9jbGFzc2VzL2luZGV4LmpzIik7CnJlcXVpcmUuYWxpYXMoImNvbXBvbmVudC1jbGFzc2VzL2luZGV4LmpzIiwgImNsYXNzZXMvaW5kZXguanMiKTsKcmVxdWlyZS5hbGlhcygiY29tcG9uZW50LWluZGV4b2YvaW5kZXguanMiLCAiY29tcG9uZW50LWNsYXNzZXMvZGVwcy9pbmRleG9mL2luZGV4LmpzIik7CgpyZXF1aXJlLmFsaWFzKCJjb21wb25lbnQtZXZlbnQvaW5kZXguanMiLCAibGlzdC5wYWdpbmF0aW9uLmpzL2RlcHMvZXZlbnQvaW5kZXguanMiKTsKcmVxdWlyZS5hbGlhcygiY29tcG9uZW50LWV2ZW50L2luZGV4LmpzIiwgImV2ZW50L2luZGV4LmpzIik7CgpyZXF1aXJlLmFsaWFzKCJjb21wb25lbnQtaW5kZXhvZi9pbmRleC5qcyIsICJsaXN0LnBhZ2luYXRpb24uanMvZGVwcy9pbmRleG9mL2luZGV4LmpzIik7CnJlcXVpcmUuYWxpYXMoImNvbXBvbmVudC1pbmRleG9mL2luZGV4LmpzIiwgImluZGV4b2YvaW5kZXguanMiKTsKCnJlcXVpcmUuYWxpYXMoImxpc3QucGFnaW5hdGlvbi5qcy9pbmRleC5qcyIsICJsaXN0LnBhZ2luYXRpb24uanMvaW5kZXguanMiKTtpZiAodHlwZW9mIGV4cG9ydHMgPT0gIm9iamVjdCIpIHsKICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImxpc3QucGFnaW5hdGlvbi5qcyIpOwp9IGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT0gImZ1bmN0aW9uIiAmJiBkZWZpbmUuYW1kKSB7CiAgZGVmaW5lKGZ1bmN0aW9uKCl7IHJldHVybiByZXF1aXJlKCJsaXN0LnBhZ2luYXRpb24uanMiKTsgfSk7Cn0gZWxzZSB7CiAgdGhpc1siTGlzdFBhZ2luYXRpb24iXSA9IHJlcXVpcmUoImxpc3QucGFnaW5hdGlvbi5qcyIpOwp9fSkoKTsKICA8L3NjcmlwdD4KICA8IS0taHR0cDovL3d3dy5tZW51Y29vbC5jb20vdGFiYmVkLWNvbnRlbnQtLT4KICA8IS0tPGxpbmsgaHJlZj0ic3R5bGVzaGVldHMvdGFiY29udGVudC5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+CiAgPHN0eWxlPgogICAgLyogVGFiIENvbnRlbnQgLSBtZW51Y29vbC5jb20gKi8KICAgIHVsLnRhYnMgewogICAgICBwYWRkaW5nOiAxNHB4IDAgOHB4OwogICAgICBtYXJnaW46IDA7CiAgICAgIGZvbnQtc2l6ZTogMDsKICAgICAgbGlzdC1zdHlsZS10eXBlOiBub25lOwogICAgICB0ZXh0LWFsaWduOiBsZWZ0OwogICAgICAvKnNldCB0byBsZWZ0LCBjZW50ZXIsIG9yIHJpZ2h0IHRvIGFsaWduIHRoZSB0YWJzIGFzIGRlc2lyZWQqLwogICAgICBiYWNrZ3JvdW5kOiAjREREREUzOwogICAgICBib3JkZXI6IDFweCBzb2xpZCAjQ0NDOwogICAgICBib3JkZXItYm90dG9tOiBub25lOwogICAgICBib3JkZXItcmFkaXVzOiAycHggMnB4IDAgMDsKICAgICAgcGFkZGluZy1sZWZ0OiAxMHB4OwogICAgICAvKiBPZmZzZXQgb2YgdGhlIGZpcnN0IHRhYiAqLwogICAgfQoKICAgIHVsLnRhYnMgbGkgewogICAgICBkaXNwbGF5OiBpbmxpbmU7CiAgICAgIG1hcmdpbjogMDsKICAgICAgbWFyZ2luLXJpZ2h0OiAycHg7CiAgICAgIC8qZGlzdGFuY2UgYmV0d2VlbiB0YWJzKi8KICAgICAgZm9udDogbm9ybWFsIDEycHggVmVyZGFuYTsKICAgIH0KCiAgICB1bC50YWJzIGxpIGEgewogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgcGFkZGluZzogOHB4IDIycHg7CiAgICAgIGNvbG9yOiAjMDAwOwogICAgICBib3JkZXItcmFkaXVzOiAzcHggM3B4IDAgMDsKICAgICAgb3V0bGluZTogbm9uZTsKICAgIH0KCiAgICB1bC50YWJzIGxpIGE6aG92ZXIgewogICAgICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTsKICAgICAgY29sb3I6ICMwMDA7CiAgICB9CgogICAgdWwudGFicyBsaS5zZWxlY3RlZCBhIHsKICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICB0b3A6IDBweDsKICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgIGJhY2tncm91bmQ6ICNGRkY7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNBQUE7CiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjRkZGOwogICAgICBjb2xvcjogIzAwMDsKICAgIH0KCiAgICB1bC50YWJzIGxpLnNlbGVjdGVkIGE6aG92ZXIsCiAgICB1bC50YWJzIGxpLnNlbGVjdGVkIGE6aG92ZXIgewogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgICB9CgogICAgZGl2LnRhYmNvbnRlbnRzIHsKICAgICAgYm9yZGVyOiAxcHggc29saWQgI0NDQzsKICAgICAgcGFkZGluZzogMTVweDsKICAgICAgYm9yZGVyLXRvcC1jb2xvcjogI0FBQTsKICAgICAgYmFja2dyb3VuZC1jb2xvcjogI0ZGRjsKICAgICAgYm9yZGVyLXJhZGl1czogMCAwIDJweCAycHg7CiAgICB9CiAgPC9zdHlsZT4KICA8IS0tPHNjcmlwdCBzcmM9ImphdmFzY3JpcHRzL3RhYmNvbnRlbnQuanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+LS0+CiAgPHNjcmlwdD4KICAgIC8qIGh0dHA6Ly93d3cubWVudWNvb2wuY29tL3RhYmJlZC1jb250ZW50IEZyZWUgdG8gdXNlLiB2MjAxMy43LjYgKi8KICAgIChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBwcmV2ZW50RGVmYXVsdCA9IGZ1bmN0aW9uIChldnQpIHsKICAgICAgICBpZiAoZXZ0ICYmIGV2dC5zdG9wUHJvcGFnYXRpb24pIHsKICAgICAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICB9CiAgICAgICAgaWYgKGV2dCAmJiBldnQucHJldmVudERlZmF1bHQpIHsKICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgICBhZGRFdmVudCA9IGZ1bmN0aW9uIChlbGVtLCBldmVudE5hbWUsIGZuKSB7CiAgICAgICAgICBpZiAoZWxlbS5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZuLCBmYWxzZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbGVtLmF0dGFjaEV2ZW50KCJvbiIgKyBldmVudE5hbWUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAvLyBzZXQgdGhlIHRoaXMgcG9pbnRlciBzYW1lIGFzIGFkZEV2ZW50TGlzdGVuZXIgd2hlbiBmbiBpcyBjYWxsZWQKICAgICAgICAgICAgICByZXR1cm4gKGZuLmNhbGwoZWxlbSwgd2luZG93LmV2ZW50KSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaGFzQ2xhc3MgPSBmdW5jdGlvbiAoZWxlbSwgY2xhc3NOYW1lKSB7CiAgICAgICAgICB2YXIgY2xhc3NQYXR0ZXJuID0gbmV3IFJlZ0V4cCgiKF58ICkiICsgY2xhc3NOYW1lICsgIiggfCQpIik7CiAgICAgICAgICByZXR1cm4gY2xhc3NQYXR0ZXJuLnRlc3QoZWxlbS5jbGFzc05hbWUpID8gdHJ1ZSA6IGZhbHNlOwogICAgICAgIH0sCiAgICAgICAgYWRkQ2xhc3MgPSBmdW5jdGlvbiAoZWxlbSwgY2xhc3NOYW1lLCBmaXJzdCkgewogICAgICAgICAgaWYgKCFoYXNDbGFzcyhlbGVtLCBjbGFzc05hbWUpKSB7CiAgICAgICAgICAgIGlmIChlbGVtLmNsYXNzTmFtZSA9PSAiIikgewogICAgICAgICAgICAgIGVsZW0uY2xhc3NOYW1lID0gY2xhc3NOYW1lOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZpcnN0KSB7CiAgICAgICAgICAgICAgZWxlbS5jbGFzc05hbWUgPSBjbGFzc05hbWUgKyAiICIgKyBlbGVtLmNsYXNzTmFtZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBlbGVtLmNsYXNzTmFtZSArPSAiICIgKyBjbGFzc05hbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHJlbW92ZUNsYXNzID0gZnVuY3Rpb24gKGVsZW0sIGNsYXNzTmFtZSkgewogICAgICAgICAgdmFyIGNsYXNzUGF0dGVybiA9IG5ldyBSZWdFeHAoIihefCApIiArIGNsYXNzTmFtZSArICIoIHwkKSIpOwogICAgICAgICAgZWxlbS5jbGFzc05hbWUgPSBlbGVtLmNsYXNzTmFtZS5yZXBsYWNlKGNsYXNzUGF0dGVybiwgIiQxIik7CiAgICAgICAgICBlbGVtLmNsYXNzTmFtZSA9IGVsZW0uY2xhc3NOYW1lLnJlcGxhY2UoLyAkLywgIiIpCiAgICAgICAgfSwKICAgICAgICBwYWdlTmFtZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBwYXRoID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lOwogICAgICAgICAgdmFyIGxhc3RQYXJ0ID0gJyc7CiAgICAgICAgICBpZiAocGF0aC5pbmRleE9mKCIvIikgIT0gLTEpIHsKICAgICAgICAgICAgcGF0aFBhcnRzID0gcGF0aC5zcGxpdCgiLyIpLmZpbHRlcihwYXJ0ID0+IHBhcnQubGVuZ3RoID4gMCk7CiAgICAgICAgICAgIGxhc3RQYXJ0ID0gcGF0aFBhcnRzW3BhdGhQYXJ0cy5sZW5ndGggLSAxXSB8fCAicm9vdCI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsYXN0UGFydCA9IHBhdGggfHwgInJvb3QiOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGxhc3RQYXJ0LmluZGV4T2YoIi4iKSAhPSAtMSkgewogICAgICAgICAgICBsYXN0UGFydCA9IGxhc3RQYXJ0LnN1YnN0cmluZygwLCBsYXN0UGFydC5pbmRleE9mKCIuIikpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGxhc3RQYXJ0Lmxlbmd0aCA+IDIwKSB7CiAgICAgICAgICAgIGxhc3RQYXJ0ID0gbGFzdFBhcnQuc3Vic3RyaW5nKGxhc3RQYXJ0Lmxlbmd0aCAtIDE5KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBsYXN0UGFydDsKICAgICAgICB9LAogICAgICAgIGNvb2tpZU5hbWUgPSAibWkiICsgcGFnZU5hbWUoKSwKICAgICAgICBUYWJHcm91cCA9IGZ1bmN0aW9uIChlbGVtLCBpbmRleCkgewogICAgICAgICAgdGhpcy5pbml0KGVsZW0sIGluZGV4KQogICAgICAgIH07CiAgICAgIFRhYkdyb3VwLnByb3RvdHlwZSA9IHsKICAgICAgICBsb2FkU2VsZWN0ZWRUYWI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBjb29raWVQYXR0ZXJuID0gbmV3IFJlZ0V4cChjb29raWVOYW1lICsgdGhpcy5pbmRleCArICI9KFxcZCspIiksCiAgICAgICAgICAgIGNvb2tpZU1hdGNoID0gZG9jdW1lbnQuY29va2llLm1hdGNoKGNvb2tpZVBhdHRlcm4pOwogICAgICAgICAgcmV0dXJuIGNvb2tpZU1hdGNoID8gY29va2llTWF0Y2hbMV0gOiB0aGlzLmdldFNlbGVjdGVkSW5kZXgoKQogICAgICAgIH0sCiAgICAgICAgZ2V0U2VsZWN0ZWRJbmRleDogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGMgPSB0aGlzLnRhYnMubGVuZ3RoOwogICAgICAgICAgZm9yICh2YXIgYiA9IDA7IGIgPCBjOyBiKyspIHsKICAgICAgICAgICAgaWYgKGhhc0NsYXNzKHRoaXMudGFic1tiXS5wYXJlbnROb2RlLCAic2VsZWN0ZWQiKSkgewogICAgICAgICAgICAgIHJldHVybiBiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9LAogICAgICAgIHNlbGVjdFRhYjogZnVuY3Rpb24gKHRhYkxpbmssIHVwZGF0ZUNvb2tpZSkgewogICAgICAgICAgdmFyIHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYkxpbmsudGFyZ2V0SWQpOwogICAgICAgICAgaWYgKCF0YXJnZXQpIHJldHVybjsKICAgICAgICAgIHRoaXMuc2hvd1RhYih0YXJnZXQpOwogICAgICAgICAgZm9yICh2YXIgYSA9IDA7IGEgPCB0aGlzLnRhYnMubGVuZ3RoOyBhKyspCiAgICAgICAgICAgIGlmICh0aGlzLnRhYnNbYV0gPT0gdGFiTGluaykgewogICAgICAgICAgICAgIGFkZENsYXNzKHRhYkxpbmsucGFyZW50Tm9kZSwgInNlbGVjdGVkIik7CiAgICAgICAgICAgICAgaWYgKHVwZGF0ZUNvb2tpZSAmJiB0aGlzLmRhdGFQZXJzaXN0KSB7CiAgICAgICAgICAgICAgICB0aGlzLnN0b3JlU2VsZWN0ZWRUYWIodGhpcy5pbmRleCwgYSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlbW92ZUNsYXNzKHRoaXMudGFic1thXS5wYXJlbnROb2RlLCAic2VsZWN0ZWQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc3RvcmVTZWxlY3RlZFRhYjogZnVuY3Rpb24gKHRhYkdyb3VwSW5kZXgsIHRhYkluZGV4KSB7CiAgICAgICAgICBkb2N1bWVudC5jb29raWUgPSBjb29raWVOYW1lICsgdGFiR3JvdXBJbmRleCArICI9IiArIHRhYkluZGV4ICsgIjsgcGF0aD0vIgogICAgICAgIH0sCiAgICAgICAgc2hvd1RhYjogZnVuY3Rpb24gKHRhcmdldCkgewogICAgICAgICAgZm9yICh2YXIgYSA9IDA7IGEgPCB0aGlzLnRhcmdldHMubGVuZ3RoOyBhKyspIHsKICAgICAgICAgICAgdGhpcy50YXJnZXRzW2FdLnN0eWxlLmRpc3BsYXkgPSB0aGlzLnRhcmdldHNbYV0uaWQgPT0gdGFyZ2V0LmlkID8gImJsb2NrIiA6ICJub25lIjsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGluaXRUYWJzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aGlzLnRhcmdldHMgPSBbXTsKICAgICAgICAgIHZhciB0YWJHcm91cCA9IHRoaXM7CiAgICAgICAgICBmb3IgKHZhciBhID0gMDsgYSA8IHRoaXMudGFicy5sZW5ndGg7IGErKykgewogICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50YWJzW2FdLnRhcmdldElkKTsKICAgICAgICAgICAgaWYgKHRhcmdldCkgewogICAgICAgICAgICAgIHRoaXMudGFyZ2V0cy5wdXNoKHRhcmdldCk7CiAgICAgICAgICAgICAgYWRkRXZlbnQodGhpcy50YWJzW2FdLCAiY2xpY2siLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICB2YXIgdGFiTGluayA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAodGFiTGluayA9PT0gd2luZG93KSB7CiAgICAgICAgICAgICAgICAgIHRhYkxpbmsgPSB3aW5kb3cuZXZlbnQuc3JjRWxlbWVudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRhYkdyb3VwLnNlbGVjdFRhYih0YWJMaW5rLCAxKTsKICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0KGV2dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGVsZW0sIGluZGV4KSB7CiAgICAgICAgICB0aGlzLmluZGV4ID0gaW5kZXg7CiAgICAgICAgICB0aGlzLnRhYnMgPSBbXTsKICAgICAgICAgIHZhciBsaW5rcyA9IGVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoImEiKSwKICAgICAgICAgICAgYW5jaG9yUGF0dGVybiA9IC8jKFteP10rKS87CiAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgbGlua3MubGVuZ3RoOyBjKyspIHsKICAgICAgICAgICAgdmFyIHRhYkxpbmsgPSBsaW5rc1tjXTsKICAgICAgICAgICAgdmFyIGhyZWYgPSB0YWJMaW5rLmdldEF0dHJpYnV0ZSgiaHJlZiIpOwogICAgICAgICAgICBpZiAoaHJlZi5pbmRleE9mKCIjIikgPT0gLTEpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgYW5jaG9yTWF0Y2ggPSBocmVmLm1hdGNoKGFuY2hvclBhdHRlcm4pOwogICAgICAgICAgICAgIGlmIChhbmNob3JNYXRjaCkgewogICAgICAgICAgICAgICAgaHJlZiA9IGFuY2hvck1hdGNoWzFdOwogICAgICAgICAgICAgICAgdGFiTGluay50YXJnZXRJZCA9IGhyZWY7CiAgICAgICAgICAgICAgICB0aGlzLnRhYnMucHVzaCh0YWJMaW5rKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZGF0YVBlcnNpc3QgPSBlbGVtLmdldEF0dHJpYnV0ZSgiZGF0YS1wZXJzaXN0IikgfHwgIiI7CiAgICAgICAgICB0aGlzLmRhdGFQZXJzaXN0ID0gZGF0YVBlcnNpc3QudG9Mb3dlckNhc2UoKSA9PSAidHJ1ZSIgPyAxIDogMDsKICAgICAgICAgIHRoaXMuaW5pdFRhYnMoKTsKICAgICAgICAgIHRoaXMuaW5pdFNlbGVjdGVkVGFiKCkKICAgICAgICB9LAogICAgICAgIGluaXRTZWxlY3RlZFRhYjogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHNlbGVjdGVkVGFiSW5kZXggPSB0aGlzLmRhdGFQZXJzaXN0ID8gcGFyc2VJbnQodGhpcy5sb2FkU2VsZWN0ZWRUYWIoKSkgOiB0aGlzLmdldFNlbGVjdGVkSW5kZXgoKTsKICAgICAgICAgIGlmIChzZWxlY3RlZFRhYkluZGV4ID49IHRoaXMudGFicy5sZW5ndGgpIHsKICAgICAgICAgICAgc2VsZWN0ZWRUYWJJbmRleCA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnNlbGVjdFRhYih0aGlzLnRhYnNbc2VsZWN0ZWRUYWJJbmRleF0sIDApOwogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIHRhYkdyb3VwcyA9IFtdLAogICAgICAgIGRvY3VtZW50UmVhZHkgPSBmdW5jdGlvbiAoZnVuYykgewogICAgICAgICAgdmFyIHN0YXJ0aW5nID0gZmFsc2U7CgogICAgICAgICAgZnVuY3Rpb24gc3RhcnRGdW5jKCkgewogICAgICAgICAgICBpZiAoc3RhcnRpbmcpIHJldHVybjsKICAgICAgICAgICAgc3RhcnRpbmcgPSB0cnVlOwogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmMsIDQpCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgc3RhcnRGdW5jLCBmYWxzZSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LmF0dGFjaEV2ZW50KSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdmFyIHRvcGxldmVsID0gd2luZG93LmZyYW1lRWxlbWVudCA9PSBudWxsOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7IH0KICAgICAgICAgICAgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCAmJiB0b3BsZXZlbCkgewogICAgICAgICAgICAgIGZ1bmN0aW9uIGRvU2Nyb2xsQ2hlY2soKSB7CiAgICAgICAgICAgICAgICBpZiAoc3RhcnRpbmcpIHJldHVybjsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCgibGVmdCIpOwogICAgICAgICAgICAgICAgICBzdGFydEZ1bmMoKQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGRvU2Nyb2xsQ2hlY2ssIDEwKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBkb1Njcm9sbENoZWNrKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBkb2N1bWVudC5hdHRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIgJiYgc3RhcnRGdW5jKCkKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICAgIGFkZEV2ZW50KHdpbmRvdywgImxvYWQiLCBzdGFydEZ1bmMpCiAgICAgICAgfSwKICAgICAgICBpbml0VGFiR3JvdXBzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHBvc3NpYmxlVGFiR3JvdXBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInVsIiksCiAgICAgICAgICAgIGUgPSBwb3NzaWJsZVRhYkdyb3Vwcy5sZW5ndGg7CiAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgZTsgYysrKSB7CiAgICAgICAgICAgIGlmIChoYXNDbGFzcyhwb3NzaWJsZVRhYkdyb3Vwc1tjXSwgInRhYnMiKSkgewogICAgICAgICAgICAgIHRhYkdyb3Vwcy5wdXNoKG5ldyBUYWJHcm91cChwb3NzaWJsZVRhYkdyb3Vwc1tjXSwgYykpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgZG9jdW1lbnRSZWFkeShpbml0VGFiR3JvdXBzKTsKICAgICAgcmV0dXJuIHt9CiAgICB9KSgpCgogIDwvc2NyaXB0PgogIDwhLS1YTUwgRm9ybWF0dGVyLS0+CiAgPCEtLTxzY3JpcHQgc3JjPSJqYXZhc2NyaXB0cy94bWwtZm9ybWF0dGVyLmpzIj48L3NjcmlwdD4tLT4KICA8c2NyaXB0PgogICAgcmVxdWlyZSA9IChmdW5jdGlvbiBlKHQsIG4sIHIpIHsgZnVuY3Rpb24gcyhvLCB1KSB7IGlmICghbltvXSkgeyBpZiAoIXRbb10pIHsgdmFyIGEgPSB0eXBlb2YgcmVxdWlyZSA9PSAiZnVuY3Rpb24iICYmIHJlcXVpcmU7IGlmICghdSAmJiBhKSByZXR1cm4gYShvLCAhMCk7IGlmIChpKSByZXR1cm4gaShvLCAhMCk7IHZhciBmID0gbmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIgKyBvICsgIiciKTsgdGhyb3cgZi5jb2RlID0gIk1PRFVMRV9OT1RfRk9VTkQiLCBmIH0gdmFyIGwgPSBuW29dID0geyBleHBvcnRzOiB7fSB9OyB0W29dWzBdLmNhbGwobC5leHBvcnRzLCBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IHRbb11bMV1bZV07IHJldHVybiBzKG4gPyBuIDogZSkgfSwgbCwgbC5leHBvcnRzLCBlLCB0LCBuLCByKSB9IHJldHVybiBuW29dLmV4cG9ydHMgfSB2YXIgaSA9IHR5cGVvZiByZXF1aXJlID09ICJmdW5jdGlvbiIgJiYgcmVxdWlyZTsgZm9yICh2YXIgbyA9IDA7IG8gPCByLmxlbmd0aDsgbysrKXMocltvXSk7IHJldHVybiBzIH0pKHsKICAgICAgMTogW2Z1bmN0aW9uIChyZXF1aXJlLCBtb2R1bGUsIGV4cG9ydHMpIHsKCiAgICAgIH0sIHt9XSwgMjogW2Z1bmN0aW9uIChyZXF1aXJlLCBtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBkZWJ1ZygpIHsKICAgICAgICAgICAgLy8gZW1wdHkgbW9jayBvZiBkZWJ1ZyBtb2R1bGUgZm9yIGJyb3dzZXIgdXNhZ2UKICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgfSwge31dLCAzOiBbZnVuY3Rpb24gKHJlcXVpcmUsIG1vZHVsZSwgZXhwb3J0cykgewoKICAgICAgICAvKioKICAgICAgICAgKiBNb2R1bGUgZGVwZW5kZW5jaWVzLgogICAgICAgICAqLwoKICAgICAgICB2YXIgZGVidWcgPSByZXF1aXJlKCdkZWJ1ZycpKCd4bWwtcGFyc2VyJyk7CgogICAgICAgIC8qKgogICAgICAgICAqIEV4cG9zZSBgcGFyc2VgLgogICAgICAgICAqLwoKICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IHBhcnNlOwoKICAgICAgICAvKioKICAgICAgICAgKiBQYXJzZSB0aGUgZ2l2ZW4gc3RyaW5nIG9mIGB4bWxgLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHhtbAogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10KICAgICAgICAgKiAgQGNvbmZpZyB7Qm9vbGVhbn0gW3RyaW09dHJ1ZV0KICAgICAgICAgKiAgQGNvbmZpZyB7Qm9vbGVhbn0gW3N0cmlwQ29tbWVudHM9dHJ1ZV0KICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9CiAgICAgICAgICogQGFwaSBwdWJsaWMKICAgICAgICAgKi8KCiAgICAgICAgZnVuY3Rpb24gcGFyc2UoeG1sLCBvcHRpb25zKSB7CgogICAgICAgICAgLy8gdHJpbSBjb250ZW50CiAgICAgICAgICBpZiAoIW9wdGlvbnMgfHwgb3B0aW9ucy50cmltKSB7CiAgICAgICAgICAgIHhtbCA9IHhtbC50cmltKCk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gc3RyaXAgY29tbWVudHMKICAgICAgICAgIGlmICghb3B0aW9ucyB8fCBvcHRpb25zLnN0cmlwQ29tbWVudHMpIHsKICAgICAgICAgICAgeG1sID0geG1sLnJlcGxhY2UoLzwhLS1bXHNcU10qPy0tPi9nLCAnJyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGRvY3VtZW50KCk7CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBYTUwgZG9jdW1lbnQuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBkb2N1bWVudCgpIHsKCiAgICAgICAgICAgIHZhciBkZWNsID0gZGVjbGFyYXRpb24oKTsKICAgICAgICAgICAgdmFyIGNoaWxkOwogICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBbXTsKICAgICAgICAgICAgdmFyIGRvY3VtZW50Um9vdE5vZGU7CgogICAgICAgICAgICB3aGlsZSAoY2hpbGQgPSBuZXh0Um9vdENoaWxkKCkpIHsKICAgICAgICAgICAgICBpZiAoY2hpbGQubmFtZSAhPT0gJyNjb21tZW50JykgewogICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50Um9vdE5vZGUpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGb3VuZCBtdWx0aXBsZSByb290IG5vZGVzJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkb2N1bWVudFJvb3ROb2RlID0gY2hpbGQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goY2hpbGQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGRlY2xhcmF0aW9uOiBkZWNsLAogICAgICAgICAgICAgIHJvb3Q6IGRvY3VtZW50Um9vdE5vZGUsCiAgICAgICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBEZWNsYXJhdGlvbi4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGRlY2xhcmF0aW9uKCkgewogICAgICAgICAgICB2YXIgbSA9IG1hdGNoKC9ePFw/eG1sXHMqLyk7CiAgICAgICAgICAgIGlmICghbSkgcmV0dXJuOwoKICAgICAgICAgICAgLy8gdGFnCiAgICAgICAgICAgIHZhciBub2RlID0gewogICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHt9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBhdHRyaWJ1dGVzCiAgICAgICAgICAgIHdoaWxlICghKGVvcygpIHx8IGlzKCc/PicpKSkgewogICAgICAgICAgICAgIHZhciBhdHRyID0gYXR0cmlidXRlKCk7CiAgICAgICAgICAgICAgaWYgKCFhdHRyKSByZXR1cm4gbm9kZTsKICAgICAgICAgICAgICBub2RlLmF0dHJpYnV0ZXNbYXR0ci5uYW1lXSA9IGF0dHIudmFsdWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1hdGNoKC9cPz5ccyovKTsKCiAgICAgICAgICAgIHJldHVybiBub2RlOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogVGFnLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdGFnKCkgewogICAgICAgICAgICBkZWJ1ZygndGFnICVqJywgeG1sKTsKICAgICAgICAgICAgdmFyIG0gPSBtYXRjaCgvXjwoW1x3LTouXSspXHMqLyk7CiAgICAgICAgICAgIGlmICghbSkgcmV0dXJuOwoKICAgICAgICAgICAgLy8gbmFtZQogICAgICAgICAgICB2YXIgbm9kZSA9IHsKICAgICAgICAgICAgICBuYW1lOiBtWzFdLAogICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHt9LAogICAgICAgICAgICAgIGNoaWxkcmVuOiBbXQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gYXR0cmlidXRlcwogICAgICAgICAgICB3aGlsZSAoIShlb3MoKSB8fCBpcygnPicpIHx8IGlzKCc/PicpIHx8IGlzKCcvPicpKSkgewogICAgICAgICAgICAgIHZhciBhdHRyID0gYXR0cmlidXRlKCk7CiAgICAgICAgICAgICAgaWYgKCFhdHRyKSByZXR1cm4gbm9kZTsKICAgICAgICAgICAgICBub2RlLmF0dHJpYnV0ZXNbYXR0ci5uYW1lXSA9IGF0dHIudmFsdWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHNlbGYgY2xvc2luZyB0YWcKICAgICAgICAgICAgaWYgKG1hdGNoKC9eXHMqXC8+LykpIHsKICAgICAgICAgICAgICBub2RlLmNoaWxkcmVuID0gbnVsbDsKICAgICAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWF0Y2goL1w/Pz4vKTsKCiAgICAgICAgICAgIC8vIGNoaWxkcmVuCiAgICAgICAgICAgIHZhciBjaGlsZDsKICAgICAgICAgICAgd2hpbGUgKGNoaWxkID0gbmV4dENoaWxkKCkpIHsKICAgICAgICAgICAgICBub2RlLmNoaWxkcmVuLnB1c2goY2hpbGQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBjbG9zaW5nCiAgICAgICAgICAgIG1hdGNoKC9ePFwvW1x3LTouXSs+Lyk7CgogICAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBuZXh0Q2hpbGQoKSB7CiAgICAgICAgICAgIHJldHVybiB0YWcoKSB8fCBjb250ZW50KCkgfHwgY29tbWVudCgpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIG5leHRSb290Q2hpbGQoKSB7CiAgICAgICAgICAgIHJldHVybiB0YWcoKSB8fCBjb21tZW50KCk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY29tbWVudCgpIHsKICAgICAgICAgICAgdmFyIG0gPSBtYXRjaCgvXjwhLS1bXHNcU10qPy0tPi8pOwogICAgICAgICAgICBpZiAobSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBuYW1lOiAnI2NvbW1lbnQnLAogICAgICAgICAgICAgICAgY29udGVudDogbVswXQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRleHQgY29udGVudC4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGNvbnRlbnQoKSB7CiAgICAgICAgICAgIGRlYnVnKCdjb250ZW50ICVqJywgeG1sKTsKICAgICAgICAgICAgdmFyIG0gPSBtYXRjaCgvXihbXjxdKykvKTsKICAgICAgICAgICAgaWYgKG0pIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgbmFtZTogJyN0ZXh0JywKICAgICAgICAgICAgICAgIGNvbnRlbnQ6IG1bMV0KICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBdHRyaWJ1dGUuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBhdHRyaWJ1dGUoKSB7CiAgICAgICAgICAgIGRlYnVnKCdhdHRyaWJ1dGUgJWonLCB4bWwpOwogICAgICAgICAgICB2YXIgbSA9IG1hdGNoKC8oW1x3Oi1dKylccyo9XHMqKCJbXiJdKiJ8J1teJ10qJ3xcdyspXHMqLyk7CiAgICAgICAgICAgIGlmICghbSkgcmV0dXJuOwogICAgICAgICAgICByZXR1cm4geyBuYW1lOiBtWzFdLCB2YWx1ZTogc3RyaXAobVsyXSkgfQogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogU3RyaXAgcXVvdGVzIGZyb20gYHZhbGAuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBzdHJpcCh2YWwpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbC5yZXBsYWNlKC9eWyciXXxbJyJdJC9nLCAnJyk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBNYXRjaCBgcmVgIGFuZCBhZHZhbmNlIHRoZSBzdHJpbmcuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBtYXRjaChyZSkgewogICAgICAgICAgICB2YXIgbSA9IHhtbC5tYXRjaChyZSk7CiAgICAgICAgICAgIGlmICghbSkgcmV0dXJuOwogICAgICAgICAgICB4bWwgPSB4bWwuc2xpY2UobVswXS5sZW5ndGgpOwogICAgICAgICAgICByZXR1cm4gbTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEVuZC1vZi1zb3VyY2UuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBlb3MoKSB7CiAgICAgICAgICAgIHJldHVybiAwID09IHhtbC5sZW5ndGg7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDaGVjayBmb3IgYHByZWZpeGAuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBpcyhwcmVmaXgpIHsKICAgICAgICAgICAgcmV0dXJuIDAgPT0geG1sLmluZGV4T2YocHJlZml4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICB9LCB7ICJkZWJ1ZyI6IDIgfV0sICJ4bWwtZm9ybWF0dGVyIjogW2Z1bmN0aW9uIChyZXF1aXJlLCBtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgICBmdW5jdGlvbiBuZXdMaW5lKG91dHB1dCkgewogICAgICAgICAgb3V0cHV0LmNvbnRlbnQgKz0gJ1xuJzsKICAgICAgICAgIHZhciBpOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IG91dHB1dC5sZXZlbDsgaSsrKSB7CiAgICAgICAgICAgIG91dHB1dC5jb250ZW50ICs9IG91dHB1dC5vcHRpb25zLmluZGVudGF0aW9uOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYXBwZW5kQ29udGVudChvdXRwdXQsIGNvbnRlbnQpIHsKICAgICAgICAgIG91dHB1dC5jb250ZW50ICs9IGNvbnRlbnQ7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBwcm9jZXNzTm9kZShub2RlLCBvdXRwdXQsIHByZXNlcnZlU3BhY2UpIHsKICAgICAgICAgIGlmIChub2RlLm5hbWUgPT09ICcjdGV4dCcgfHwgbm9kZS5uYW1lID09PSAnI2NvbW1lbnQnKSB7CiAgICAgICAgICAgIHByb2Nlc3NDb250ZW50Tm9kZShub2RlLCBvdXRwdXQsIHByZXNlcnZlU3BhY2UpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gQXNzdW1pbmcgdGhhdCB3ZSBvbmx5IGhhdmUgMyB0eXBlcyBvZiBub2RlICgjdGV4dCwgI2NvbW1lbnQgYW5kIGVsZW1lbnQpCiAgICAgICAgICAgIHByb2Nlc3NFbGVtZW50KG5vZGUsIG91dHB1dCwgcHJlc2VydmVTcGFjZSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gKG5vZGUubmFtZSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBwcm9jZXNzQ29udGVudE5vZGUobm9kZSwgb3V0cHV0LCBwcmVzZXJ2ZVNwYWNlKSB7CiAgICAgICAgICBpZiAoIXByZXNlcnZlU3BhY2UgJiYgb3V0cHV0LmNvbnRlbnQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAvLyBuZXdMaW5lKG91dHB1dCk7CiAgICAgICAgICB9CiAgICAgICAgICBhcHBlbmRDb250ZW50KG91dHB1dCwgbm9kZS5jb250ZW50KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NFbGVtZW50KG5vZGUsIG91dHB1dCwgcHJlc2VydmVTcGFjZSkgewogICAgICAgICAgaWYgKCFwcmVzZXJ2ZVNwYWNlICYmIG91dHB1dC5jb250ZW50Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgbmV3TGluZShvdXRwdXQpOwogICAgICAgICAgfQoKICAgICAgICAgIGFwcGVuZENvbnRlbnQob3V0cHV0LCAnPCcgKyBub2RlLm5hbWUpOwogICAgICAgICAgcHJvY2Vzc0F0dHJpYnV0ZXMob3V0cHV0LCBub2RlLmF0dHJpYnV0ZXMpOwoKICAgICAgICAgIGlmIChub2RlLmNoaWxkcmVuID09PSBudWxsKSB7CiAgICAgICAgICAgIC8vIHNlbGYtY2xvc2luZyBub2RlCiAgICAgICAgICAgIGFwcGVuZENvbnRlbnQob3V0cHV0LCAnLz4nKTsKICAgICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICBhcHBlbmRDb250ZW50KG91dHB1dCwgJz4nKTsKCiAgICAgICAgICAgIG91dHB1dC5sZXZlbCsrOwoKICAgICAgICAgICAgdmFyIG5vZGVQcmVzZXJ2ZVNwYWNlID0gbm9kZS5hdHRyaWJ1dGVzWyd4bWw6c3BhY2UnXSA9PT0gJ3ByZXNlcnZlJzsKICAgICAgICAgICAgdmFyIGxhc3RDaGlsZFR5cGU7CiAgICAgICAgICAgIG5vZGUuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgICAgICBsYXN0Q2hpbGRUeXBlID0gcHJvY2Vzc05vZGUoY2hpbGQsIG91dHB1dCwgcHJlc2VydmVTcGFjZSB8fCBub2RlUHJlc2VydmVTcGFjZSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgb3V0cHV0LmxldmVsLS07CgogICAgICAgICAgICBpZiAoIXByZXNlcnZlU3BhY2UgJiYgIW5vZGVQcmVzZXJ2ZVNwYWNlICYmIGxhc3RDaGlsZFR5cGUgIT09ICcjdGV4dCcgJiYgbGFzdENoaWxkVHlwZSAhPT0gJyNjb21tZW50JykgewogICAgICAgICAgICAgIG5ld0xpbmUob3V0cHV0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhcHBlbmRDb250ZW50KG91dHB1dCwgJzwvJyArIG5vZGUubmFtZSArICc+Jyk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBwcm9jZXNzQXR0cmlidXRlcyhvdXRwdXQsIGF0dHJpYnV0ZXMpIHsKICAgICAgICAgIE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLmZvckVhY2goZnVuY3Rpb24gKGF0dHIpIHsKICAgICAgICAgICAgYXBwZW5kQ29udGVudChvdXRwdXQsICcgJyArIGF0dHIgKyAnPSInICsgYXR0cmlidXRlc1thdHRyXSArICciJyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NEZWNsYXJhdGlvbihkZWNsYXJhdGlvbiwgb3V0cHV0KSB7CiAgICAgICAgICBpZiAoZGVjbGFyYXRpb24pIHsKICAgICAgICAgICAgYXBwZW5kQ29udGVudChvdXRwdXQsICc8P3htbCcpOwogICAgICAgICAgICBwcm9jZXNzQXR0cmlidXRlcyhvdXRwdXQsIGRlY2xhcmF0aW9uLmF0dHJpYnV0ZXMpOwogICAgICAgICAgICBhcHBlbmRDb250ZW50KG91dHB1dCwgJz8+Jyk7CiAgICAgICAgICB9CiAgICAgICAgfQoKCiAgICAgICAgLyoqCiAgICAgICAgICogQ29udmVydHMgdGhlIGdpdmVuIFhNTCBpbnRvIGh1bWFuIHJlYWRhYmxlIGZvcm1hdC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB4bWwKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgICAqICBAY29uZmlnIHtCb29sZWFufSBbZGVidWc9ZmFsc2VdIGRpc3BsYXlzIGEgdHJlZSBvZiB0aGUgcGFyc2VkIFhNTCBiZWZvcmUgZm9ybWF0dGluZwogICAgICAgICAqICBAY29uZmlnIHtTdHJpbmd9IFtpbmRlbnRhdGlvbj0nICAgICddIFRoZSB2YWx1ZSB1c2VkIGZvciBpbmRlbnRhdGlvbgogICAgICAgICAqICBAY29uZmlnIHtCb29sZWFufSBbc3RyaXBDb21tZW50cz1mYWxzZV0gVHJ1ZSB0byBzdHJpcCB0aGUgY29tbWVudHMKICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGZvcm1hdCh4bWwsIG9wdGlvbnMpIHsKCiAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICAgIG9wdGlvbnMuZGVidWcgPSBvcHRpb25zLmRlYnVnID09PSB0cnVlOwogICAgICAgICAgb3B0aW9ucy5pbmRlbnRhdGlvbiA9IG9wdGlvbnMuaW5kZW50YXRpb24gfHwgJyAgICAnOwogICAgICAgICAgb3B0aW9ucy5zdHJpcENvbW1lbnRzID0gb3B0aW9ucy5zdHJpcENvbW1lbnRzID09PSB0cnVlOwoKICAgICAgICAgIHZhciBwYXJzZSA9IHJlcXVpcmUoJ3htbC1wYXJzZXIteG8nKTsKICAgICAgICAgIHZhciBwYXJzZWRYbWwgPSBwYXJzZSh4bWwsIHsgc3RyaXBDb21tZW50czogb3B0aW9ucy5zdHJpcENvbW1lbnRzIH0pOwoKICAgICAgICAgIGlmIChvcHRpb25zLmRlYnVnKSB7CiAgICAgICAgICAgIHZhciBpbnNwZWN0ID0gcmVxdWlyZSgndXRpbCcpLmluc3BlY3Q7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGluc3BlY3QocGFyc2VkWG1sLCB7IGNvbG9yczogdHJ1ZSwgZGVwdGg6IEluZmluaXR5IH0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgb3V0cHV0ID0geyBjb250ZW50OiAnJywgbGV2ZWw6IDAsIG9wdGlvbnM6IG9wdGlvbnMgfTsKCiAgICAgICAgICBwcm9jZXNzRGVjbGFyYXRpb24ocGFyc2VkWG1sLmRlY2xhcmF0aW9uLCBvdXRwdXQpOwoKICAgICAgICAgIHBhcnNlZFhtbC5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICAgICAgICBwcm9jZXNzTm9kZShjaGlsZCwgb3V0cHV0LCBmYWxzZSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm4gb3V0cHV0LmNvbnRlbnQ7CiAgICAgICAgfQoKCiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmb3JtYXQ7CiAgICAgIH0sIHsgInV0aWwiOiAxLCAieG1sLXBhcnNlci14byI6IDMgfV0KICAgIH0sIHt9LCBbXSk7CgogIDwvc2NyaXB0PgogIDwhLS1odHRwczovL2ZsYXRwaWNrci5qcy5vcmcvLS0+CiAgPCEtLTxsaW5rIGhyZWY9InN0eWxlc2hlZXRzL2ZsYXRwaWNrci5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+CiAgPHN0eWxlPgogICAgLmZsYXRwaWNrci1jYWxlbmRhciB7CiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50OwogICAgICBvcGFjaXR5OiAwOwogICAgICBkaXNwbGF5OiBub25lOwogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgIHZpc2liaWxpdHk6IGhpZGRlbjsKICAgICAgcGFkZGluZzogMDsKICAgICAgLXdlYmtpdC1hbmltYXRpb246IG5vbmU7CiAgICAgIGFuaW1hdGlvbjogbm9uZTsKICAgICAgZGlyZWN0aW9uOiBsdHI7CiAgICAgIGJvcmRlcjogMDsKICAgICAgZm9udC1zaXplOiAxNHB4OwogICAgICBsaW5lLWhlaWdodDogMjRweDsKICAgICAgYm9yZGVyLXJhZGl1czogNXB4OwogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgIHdpZHRoOiAzMDcuODc1cHg7CiAgICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgLW1zLXRvdWNoLWFjdGlvbjogbWFuaXB1bGF0aW9uOwogICAgICB0b3VjaC1hY3Rpb246IG1hbmlwdWxhdGlvbjsKICAgICAgYmFja2dyb3VuZDogI2ZmZjsKICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiAxcHggMCAwICNlNmU2ZTYsIC0xcHggMCAwICNlNmU2ZTYsIDAgMXB4IDAgI2U2ZTZlNiwgMCAtMXB4IDAgI2U2ZTZlNiwgMCAzcHggMTNweCByZ2JhKDAsIDAsIDAsIDAuMDgpOwogICAgICBib3gtc2hhZG93OiAxcHggMCAwICNlNmU2ZTYsIC0xcHggMCAwICNlNmU2ZTYsIDAgMXB4IDAgI2U2ZTZlNiwgMCAtMXB4IDAgI2U2ZTZlNiwgMCAzcHggMTNweCByZ2JhKDAsIDAsIDAsIDAuMDgpOwogICAgfQoKICAgIC5mbGF0cGlja3ItY2FsZW5kYXIub3BlbiwKICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuaW5saW5lIHsKICAgICAgb3BhY2l0eTogMTsKICAgICAgbWF4LWhlaWdodDogNjQwcHg7CiAgICAgIHZpc2liaWxpdHk6IHZpc2libGU7CiAgICB9CgogICAgLmZsYXRwaWNrci1jYWxlbmRhci5vcGVuIHsKICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICB6LWluZGV4OiA5OTk5OTsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmFuaW1hdGUub3BlbiB7CiAgICAgIC13ZWJraXQtYW5pbWF0aW9uOiBmcEZhZGVJbkRvd24gMzAwbXMgY3ViaWMtYmV6aWVyKDAuMjMsIDEsIDAuMzIsIDEpOwogICAgICBhbmltYXRpb246IGZwRmFkZUluRG93biAzMDBtcyBjdWJpYy1iZXppZXIoMC4yMywgMSwgMC4zMiwgMSk7CiAgICB9CgogICAgLmZsYXRwaWNrci1jYWxlbmRhci5pbmxpbmUgewogICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICB0b3A6IDJweDsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLnN0YXRpYyB7CiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgdG9wOiBjYWxjKDEwMCUgKyAycHgpOwogICAgfQoKICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuc3RhdGljLm9wZW4gewogICAgICB6LWluZGV4OiA5OTk7CiAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgfQoKICAgIC5mbGF0cGlja3ItY2FsZW5kYXIubXVsdGlNb250aCAuZmxhdHBpY2tyLWRheXMgLmRheUNvbnRhaW5lcjpudGgtY2hpbGQobisxKSAuZmxhdHBpY2tyLWRheS5pblJhbmdlOm50aC1jaGlsZCg3bis3KSB7CiAgICAgIC13ZWJraXQtYm94LXNoYWRvdzogbm9uZSAhaW1wb3J0YW50OwogICAgICBib3gtc2hhZG93OiBub25lICFpbXBvcnRhbnQ7CiAgICB9CgogICAgLmZsYXRwaWNrci1jYWxlbmRhci5tdWx0aU1vbnRoIC5mbGF0cGlja3ItZGF5cyAuZGF5Q29udGFpbmVyOm50aC1jaGlsZChuKzIpIC5mbGF0cGlja3ItZGF5LmluUmFuZ2U6bnRoLWNoaWxkKDduKzEpIHsKICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiAtMnB4IDAgMCAjZTZlNmU2LCA1cHggMCAwICNlNmU2ZTY7CiAgICAgIGJveC1zaGFkb3c6IC0ycHggMCAwICNlNmU2ZTYsIDVweCAwIDAgI2U2ZTZlNjsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyIC5oYXNXZWVrcyAuZGF5Q29udGFpbmVyLAogICAgLmZsYXRwaWNrci1jYWxlbmRhciAuaGFzVGltZSAuZGF5Q29udGFpbmVyIHsKICAgICAgYm9yZGVyLWJvdHRvbTogMDsKICAgICAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDA7CiAgICAgIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDA7CiAgICB9CgogICAgLmZsYXRwaWNrci1jYWxlbmRhciAuaGFzV2Vla3MgLmRheUNvbnRhaW5lciB7CiAgICAgIGJvcmRlci1sZWZ0OiAwOwogICAgfQoKICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuc2hvd1RpbWVJbnB1dC5oYXNUaW1lIC5mbGF0cGlja3ItdGltZSB7CiAgICAgIGhlaWdodDogNDBweDsKICAgICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlNmU2ZTY7CiAgICB9CgogICAgLmZsYXRwaWNrci1jYWxlbmRhci5ub0NhbGVuZGFyLmhhc1RpbWUgLmZsYXRwaWNrci10aW1lIHsKICAgICAgaGVpZ2h0OiBhdXRvOwogICAgfQoKICAgIC5mbGF0cGlja3ItY2FsZW5kYXI6YmVmb3JlLAogICAgLmZsYXRwaWNrci1jYWxlbmRhcjphZnRlciB7CiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgICBib3JkZXI6IHNvbGlkIHRyYW5zcGFyZW50OwogICAgICBjb250ZW50OiAnJzsKICAgICAgaGVpZ2h0OiAwOwogICAgICB3aWR0aDogMDsKICAgICAgbGVmdDogMjJweDsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLnJpZ2h0TW9zdDpiZWZvcmUsCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLnJpZ2h0TW9zdDphZnRlciB7CiAgICAgIGxlZnQ6IGF1dG87CiAgICAgIHJpZ2h0OiAyMnB4OwogICAgfQoKICAgIC5mbGF0cGlja3ItY2FsZW5kYXI6YmVmb3JlIHsKICAgICAgYm9yZGVyLXdpZHRoOiA1cHg7CiAgICAgIG1hcmdpbjogMCAtNXB4OwogICAgfQoKICAgIC5mbGF0cGlja3ItY2FsZW5kYXI6YWZ0ZXIgewogICAgICBib3JkZXItd2lkdGg6IDRweDsKICAgICAgbWFyZ2luOiAwIC00cHg7CiAgICB9CgogICAgLmZsYXRwaWNrci1jYWxlbmRhci5hcnJvd1RvcDpiZWZvcmUsCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmFycm93VG9wOmFmdGVyIHsKICAgICAgYm90dG9tOiAxMDAlOwogICAgfQoKICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dUb3A6YmVmb3JlIHsKICAgICAgYm9yZGVyLWJvdHRvbS1jb2xvcjogI2U2ZTZlNjsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmFycm93VG9wOmFmdGVyIHsKICAgICAgYm9yZGVyLWJvdHRvbS1jb2xvcjogI2ZmZjsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWNhbGVuZGFyLmFycm93Qm90dG9tOmJlZm9yZSwKICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dCb3R0b206YWZ0ZXIgewogICAgICB0b3A6IDEwMCU7CiAgICB9CgogICAgLmZsYXRwaWNrci1jYWxlbmRhci5hcnJvd0JvdHRvbTpiZWZvcmUgewogICAgICBib3JkZXItdG9wLWNvbG9yOiAjZTZlNmU2OwogICAgfQoKICAgIC5mbGF0cGlja3ItY2FsZW5kYXIuYXJyb3dCb3R0b206YWZ0ZXIgewogICAgICBib3JkZXItdG9wLWNvbG9yOiAjZmZmOwogICAgfQoKICAgIC5mbGF0cGlja3ItY2FsZW5kYXI6Zm9jdXMgewogICAgICBvdXRsaW5lOiAwOwogICAgfQoKICAgIC5mbGF0cGlja3Itd3JhcHBlciB7CiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgfQoKICAgIC5mbGF0cGlja3ItbW9udGhzIHsKICAgICAgZGlzcGxheTogLXdlYmtpdC1ib3g7CiAgICAgIGRpc3BsYXk6IC13ZWJraXQtZmxleDsKICAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICB9CgogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1tb250aCB7CiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50OwogICAgICBjb2xvcjogcmdiYSgwLCAwLCAwLCAwLjkpOwogICAgICBmaWxsOiByZ2JhKDAsIDAsIDAsIDAuOSk7CiAgICAgIGhlaWdodDogMjhweDsKICAgICAgbGluZS1oZWlnaHQ6IDE7CiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOwogICAgICAtbW96LXVzZXItc2VsZWN0OiBub25lOwogICAgICAtbXMtdXNlci1zZWxlY3Q6IG5vbmU7CiAgICAgIHVzZXItc2VsZWN0OiBub25lOwogICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAtd2Via2l0LWJveC1mbGV4OiAxOwogICAgICAtd2Via2l0LWZsZXg6IDE7CiAgICAgIC1tcy1mbGV4OiAxOwogICAgICBmbGV4OiAxOwogICAgfQoKICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItcHJldi1tb250aCwKICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aCB7CiAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgIHRvcDogMHB4OwogICAgICBsaW5lLWhlaWdodDogMTZweDsKICAgICAgaGVpZ2h0OiAyOHB4OwogICAgICBwYWRkaW5nOiAxMHB4OwogICAgICB6LWluZGV4OiAzOwogICAgICBjb2xvcjogcmdiYSgwLCAwLCAwLCAwLjkpOwogICAgICBmaWxsOiByZ2JhKDAsIDAsIDAsIDAuOSk7CiAgICB9CgogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1wcmV2LW1vbnRoLmRpc2FibGVkLAogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoLmRpc2FibGVkIHsKICAgICAgZGlzcGxheTogbm9uZTsKICAgIH0KCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGggaSwKICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aCBpIHsKICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgfQoKICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItcHJldi1tb250aC5mbGF0cGlja3ItcHJldi1tb250aCwKICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aC5mbGF0cGlja3ItcHJldi1tb250aCB7CiAgICAgIC8qCiAgICAgIC8qcnRsOmJlZ2luOmlnbm9yZSovCiAgICAgIC8qCiAgICAgICovCiAgICAgIGxlZnQ6IDA7CiAgICAgIC8qCiAgICAgIC8qcnRsOmVuZDppZ25vcmUqLwogICAgICAvKgogICAgICAqLwogICAgfQoKICAgIC8qCiAgICAgIC8qcnRsOmJlZ2luOmlnbm9yZSovCiAgICAvKgogICAgICAvKnJ0bDplbmQ6aWdub3JlKi8KICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItcHJldi1tb250aC5mbGF0cGlja3ItbmV4dC1tb250aCwKICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aC5mbGF0cGlja3ItbmV4dC1tb250aCB7CiAgICAgIC8qCiAgICAgIC8qcnRsOmJlZ2luOmlnbm9yZSovCiAgICAgIC8qCiAgICAgICovCiAgICAgIHJpZ2h0OiAwOwogICAgICAvKgogICAgICAvKnJ0bDplbmQ6aWdub3JlKi8KICAgICAgLyoKICAgICAgKi8KICAgIH0KCiAgICAvKgogICAgICAvKnJ0bDpiZWdpbjppZ25vcmUqLwogICAgLyoKICAgICAgLypydGw6ZW5kOmlnbm9yZSovCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGg6aG92ZXIsCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLW5leHQtbW9udGg6aG92ZXIgewogICAgICBjb2xvcjogIzk1OWVhOTsKICAgIH0KCiAgICAuZmxhdHBpY2tyLW1vbnRocyAuZmxhdHBpY2tyLXByZXYtbW9udGg6aG92ZXIgc3ZnLAogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1uZXh0LW1vbnRoOmhvdmVyIHN2ZyB7CiAgICAgIGZpbGw6ICNmNjQ3NDc7CiAgICB9CgogICAgLmZsYXRwaWNrci1tb250aHMgLmZsYXRwaWNrci1wcmV2LW1vbnRoIHN2ZywKICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aCBzdmcgewogICAgICB3aWR0aDogMTRweDsKICAgICAgaGVpZ2h0OiAxNHB4OwogICAgfQoKICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItcHJldi1tb250aCBzdmcgcGF0aCwKICAgIC5mbGF0cGlja3ItbW9udGhzIC5mbGF0cGlja3ItbmV4dC1tb250aCBzdmcgcGF0aCB7CiAgICAgIC13ZWJraXQtdHJhbnNpdGlvbjogZmlsbCAwLjFzOwogICAgICB0cmFuc2l0aW9uOiBmaWxsIDAuMXM7CiAgICAgIGZpbGw6IGluaGVyaXQ7CiAgICB9CgogICAgLm51bUlucHV0V3JhcHBlciB7CiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgaGVpZ2h0OiBhdXRvOwogICAgfQoKICAgIC5udW1JbnB1dFdyYXBwZXIgaW5wdXQsCiAgICAubnVtSW5wdXRXcmFwcGVyIHNwYW4gewogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICB9CgogICAgLm51bUlucHV0V3JhcHBlciBpbnB1dCB7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgfQoKICAgIC5udW1JbnB1dFdyYXBwZXIgaW5wdXQ6Oi1tcy1jbGVhciB7CiAgICAgIGRpc3BsYXk6IG5vbmU7CiAgICB9CgogICAgLm51bUlucHV0V3JhcHBlciBzcGFuIHsKICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICByaWdodDogMDsKICAgICAgd2lkdGg6IDE0cHg7CiAgICAgIHBhZGRpbmc6IDAgNHB4IDAgMnB4OwogICAgICBoZWlnaHQ6IDUwJTsKICAgICAgbGluZS1oZWlnaHQ6IDUwJTsKICAgICAgb3BhY2l0eTogMDsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDU3LCA1NywgNTcsIDAuMTUpOwogICAgICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICB9CgogICAgLm51bUlucHV0V3JhcHBlciBzcGFuOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjEpOwogICAgfQoKICAgIC5udW1JbnB1dFdyYXBwZXIgc3BhbjphY3RpdmUgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMik7CiAgICB9CgogICAgLm51bUlucHV0V3JhcHBlciBzcGFuOmFmdGVyIHsKICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgIGNvbnRlbnQ6ICIiOwogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB9CgogICAgLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93VXAgewogICAgICB0b3A6IDA7CiAgICAgIGJvcmRlci1ib3R0b206IDA7CiAgICB9CgogICAgLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93VXA6YWZ0ZXIgewogICAgICBib3JkZXItbGVmdDogNHB4IHNvbGlkIHRyYW5zcGFyZW50OwogICAgICBib3JkZXItcmlnaHQ6IDRweCBzb2xpZCB0cmFuc3BhcmVudDsKICAgICAgYm9yZGVyLWJvdHRvbTogNHB4IHNvbGlkIHJnYmEoNTcsIDU3LCA1NywgMC42KTsKICAgICAgdG9wOiAyNiU7CiAgICB9CgogICAgLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93RG93biB7CiAgICAgIHRvcDogNTAlOwogICAgfQoKICAgIC5udW1JbnB1dFdyYXBwZXIgc3Bhbi5hcnJvd0Rvd246YWZ0ZXIgewogICAgICBib3JkZXItbGVmdDogNHB4IHNvbGlkIHRyYW5zcGFyZW50OwogICAgICBib3JkZXItcmlnaHQ6IDRweCBzb2xpZCB0cmFuc3BhcmVudDsKICAgICAgYm9yZGVyLXRvcDogNHB4IHNvbGlkIHJnYmEoNTcsIDU3LCA1NywgMC42KTsKICAgICAgdG9wOiA0MCU7CiAgICB9CgogICAgLm51bUlucHV0V3JhcHBlciBzcGFuIHN2ZyB7CiAgICAgIHdpZHRoOiBpbmhlcml0OwogICAgICBoZWlnaHQ6IGF1dG87CiAgICB9CgogICAgLm51bUlucHV0V3JhcHBlciBzcGFuIHN2ZyBwYXRoIHsKICAgICAgZmlsbDogcmdiYSgwLCAwLCAwLCAwLjUpOwogICAgfQoKICAgIC5udW1JbnB1dFdyYXBwZXI6aG92ZXIgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMDUpOwogICAgfQoKICAgIC5udW1JbnB1dFdyYXBwZXI6aG92ZXIgc3BhbiB7CiAgICAgIG9wYWNpdHk6IDE7CiAgICB9CgogICAgLmZsYXRwaWNrci1jdXJyZW50LW1vbnRoIHsKICAgICAgZm9udC1zaXplOiAxMzUlOwogICAgICBsaW5lLWhlaWdodDogaW5oZXJpdDsKICAgICAgZm9udC13ZWlnaHQ6IDMwMDsKICAgICAgY29sb3I6IGluaGVyaXQ7CiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgd2lkdGg6IDc1JTsKICAgICAgbGVmdDogMTIuNSU7CiAgICAgIHBhZGRpbmc6IDYuMTZweCAwIDAgMDsKICAgICAgbGluZS1oZWlnaHQ6IDE7CiAgICAgIGhlaWdodDogMjhweDsKICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwcHgsIDBweCwgMHB4KTsKICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwcHgsIDBweCwgMHB4KTsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggc3Bhbi5jdXItbW9udGggewogICAgICBmb250LWZhbWlseTogaW5oZXJpdDsKICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgY29sb3I6IGluaGVyaXQ7CiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgICAgbWFyZ2luLWxlZnQ6IDAuNWNoOwogICAgICBwYWRkaW5nOiAwOwogICAgfQoKICAgIC5mbGF0cGlja3ItY3VycmVudC1tb250aCBzcGFuLmN1ci1tb250aDpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC4wNSk7CiAgICB9CgogICAgLmZsYXRwaWNrci1jdXJyZW50LW1vbnRoIC5udW1JbnB1dFdyYXBwZXIgewogICAgICB3aWR0aDogNmNoOwogICAgICB3aWR0aDogN2NoXDA7CiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWN1cnJlbnQtbW9udGggLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93VXA6YWZ0ZXIgewogICAgICBib3JkZXItYm90dG9tLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuOSk7CiAgICB9CgogICAgLmZsYXRwaWNrci1jdXJyZW50LW1vbnRoIC5udW1JbnB1dFdyYXBwZXIgc3Bhbi5hcnJvd0Rvd246YWZ0ZXIgewogICAgICBib3JkZXItdG9wLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuOSk7CiAgICB9CgogICAgLmZsYXRwaWNrci1jdXJyZW50LW1vbnRoIGlucHV0LmN1ci15ZWFyIHsKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgY29sb3I6IGluaGVyaXQ7CiAgICAgIGN1cnNvcjogdGV4dDsKICAgICAgcGFkZGluZzogMCAwIDAgMC41Y2g7CiAgICAgIG1hcmdpbjogMDsKICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICBmb250LXNpemU6IGluaGVyaXQ7CiAgICAgIGZvbnQtZmFtaWx5OiBpbmhlcml0OwogICAgICBmb250LXdlaWdodDogMzAwOwogICAgICBsaW5lLWhlaWdodDogaW5oZXJpdDsKICAgICAgaGVpZ2h0OiBhdXRvOwogICAgICBib3JkZXI6IDA7CiAgICAgIGJvcmRlci1yYWRpdXM6IDA7CiAgICAgIHZlcnRpY2FsLWFsaWduOiBpbml0aWFsOwogICAgfQoKICAgIC5mbGF0cGlja3ItY3VycmVudC1tb250aCBpbnB1dC5jdXIteWVhcjpmb2N1cyB7CiAgICAgIG91dGxpbmU6IDA7CiAgICB9CgogICAgLmZsYXRwaWNrci1jdXJyZW50LW1vbnRoIGlucHV0LmN1ci15ZWFyW2Rpc2FibGVkXSwKICAgIC5mbGF0cGlja3ItY3VycmVudC1tb250aCBpbnB1dC5jdXIteWVhcltkaXNhYmxlZF06aG92ZXIgewogICAgICBmb250LXNpemU6IDEwMCU7CiAgICAgIGNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNSk7CiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50OwogICAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgIH0KCiAgICAuZmxhdHBpY2tyLXdlZWtkYXlzIHsKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIGRpc3BsYXk6IC13ZWJraXQtYm94OwogICAgICBkaXNwbGF5OiAtd2Via2l0LWZsZXg7CiAgICAgIGRpc3BsYXk6IC1tcy1mbGV4Ym94OwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAtd2Via2l0LWJveC1hbGlnbjogY2VudGVyOwogICAgICAtd2Via2l0LWFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIC1tcy1mbGV4LWFsaWduOiBjZW50ZXI7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGhlaWdodDogMjhweDsKICAgIH0KCiAgICAuZmxhdHBpY2tyLXdlZWtkYXlzIC5mbGF0cGlja3Itd2Vla2RheWNvbnRhaW5lciB7CiAgICAgIGRpc3BsYXk6IC13ZWJraXQtYm94OwogICAgICBkaXNwbGF5OiAtd2Via2l0LWZsZXg7CiAgICAgIGRpc3BsYXk6IC1tcy1mbGV4Ym94OwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAtd2Via2l0LWJveC1mbGV4OiAxOwogICAgICAtd2Via2l0LWZsZXg6IDE7CiAgICAgIC1tcy1mbGV4OiAxOwogICAgICBmbGV4OiAxOwogICAgfQoKICAgIHNwYW4uZmxhdHBpY2tyLXdlZWtkYXkgewogICAgICBjdXJzb3I6IGRlZmF1bHQ7CiAgICAgIGZvbnQtc2l6ZTogOTAlOwogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsKICAgICAgY29sb3I6IHJnYmEoMCwgMCwgMCwgMC41NCk7CiAgICAgIGxpbmUtaGVpZ2h0OiAxOwogICAgICBtYXJnaW46IDA7CiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgIC13ZWJraXQtYm94LWZsZXg6IDE7CiAgICAgIC13ZWJraXQtZmxleDogMTsKICAgICAgLW1zLWZsZXg6IDE7CiAgICAgIGZsZXg6IDE7CiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkZXI7CiAgICB9CgogICAgLmRheUNvbnRhaW5lciwKICAgIC5mbGF0cGlja3Itd2Vla3MgewogICAgICBwYWRkaW5nOiAxcHggMCAwIDA7CiAgICB9CgogICAgLmZsYXRwaWNrci1kYXlzIHsKICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICBkaXNwbGF5OiAtd2Via2l0LWJveDsKICAgICAgZGlzcGxheTogLXdlYmtpdC1mbGV4OwogICAgICBkaXNwbGF5OiAtbXMtZmxleGJveDsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgLXdlYmtpdC1ib3gtYWxpZ246IHN0YXJ0OwogICAgICAtd2Via2l0LWFsaWduLWl0ZW1zOiBmbGV4LXN0YXJ0OwogICAgICAtbXMtZmxleC1hbGlnbjogc3RhcnQ7CiAgICAgIGFsaWduLWl0ZW1zOiBmbGV4LXN0YXJ0OwogICAgICB3aWR0aDogMzA3Ljg3NXB4OwogICAgfQoKICAgIC5mbGF0cGlja3ItZGF5czpmb2N1cyB7CiAgICAgIG91dGxpbmU6IDA7CiAgICB9CgogICAgLmRheUNvbnRhaW5lciB7CiAgICAgIHBhZGRpbmc6IDA7CiAgICAgIG91dGxpbmU6IDA7CiAgICAgIHRleHQtYWxpZ246IGxlZnQ7CiAgICAgIHdpZHRoOiAzMDcuODc1cHg7CiAgICAgIG1pbi13aWR0aDogMzA3Ljg3NXB4OwogICAgICBtYXgtd2lkdGg6IDMwNy44NzVweDsKICAgICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgIGRpc3BsYXk6IC1tcy1mbGV4Ym94OwogICAgICBkaXNwbGF5OiAtd2Via2l0LWJveDsKICAgICAgZGlzcGxheTogLXdlYmtpdC1mbGV4OwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAtd2Via2l0LWZsZXgtd3JhcDogd3JhcDsKICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICAtbXMtZmxleC13cmFwOiB3cmFwOwogICAgICAtbXMtZmxleC1wYWNrOiBqdXN0aWZ5OwogICAgICAtd2Via2l0LWp1c3RpZnktY29udGVudDogc3BhY2UtYXJvdW5kOwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWFyb3VuZDsKICAgICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDBweCwgMHB4LCAwcHgpOwogICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDBweCwgMHB4LCAwcHgpOwogICAgICBvcGFjaXR5OiAxOwogICAgfQoKICAgIC5kYXlDb250YWluZXIrLmRheUNvbnRhaW5lciB7CiAgICAgIC13ZWJraXQtYm94LXNoYWRvdzogLTFweCAwIDAgI2U2ZTZlNjsKICAgICAgYm94LXNoYWRvdzogLTFweCAwIDAgI2U2ZTZlNjsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWRheSB7CiAgICAgIGJhY2tncm91bmQ6IG5vbmU7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50OwogICAgICBib3JkZXItcmFkaXVzOiAxNTBweDsKICAgICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICBjb2xvcjogIzM5MzkzOTsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICBmb250LXdlaWdodDogNDAwOwogICAgICB3aWR0aDogMTQuMjg1NzE0MyU7CiAgICAgIC13ZWJraXQtZmxleC1iYXNpczogMTQuMjg1NzE0MyU7CiAgICAgIC1tcy1mbGV4LXByZWZlcnJlZC1zaXplOiAxNC4yODU3MTQzJTsKICAgICAgZmxleC1iYXNpczogMTQuMjg1NzE0MyU7CiAgICAgIG1heC13aWR0aDogMzlweDsKICAgICAgaGVpZ2h0OiAzOXB4OwogICAgICBsaW5lLWhlaWdodDogMzlweDsKICAgICAgbWFyZ2luOiAwOwogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgLXdlYmtpdC1ib3gtcGFjazogY2VudGVyOwogICAgICAtd2Via2l0LWp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAtbXMtZmxleC1wYWNrOiBjZW50ZXI7CiAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICB9CgogICAgLmZsYXRwaWNrci1kYXkuaW5SYW5nZSwKICAgIC5mbGF0cGlja3ItZGF5LnByZXZNb250aERheS5pblJhbmdlLAogICAgLmZsYXRwaWNrci1kYXkubmV4dE1vbnRoRGF5LmluUmFuZ2UsCiAgICAuZmxhdHBpY2tyLWRheS50b2RheS5pblJhbmdlLAogICAgLmZsYXRwaWNrci1kYXkucHJldk1vbnRoRGF5LnRvZGF5LmluUmFuZ2UsCiAgICAuZmxhdHBpY2tyLWRheS5uZXh0TW9udGhEYXkudG9kYXkuaW5SYW5nZSwKICAgIC5mbGF0cGlja3ItZGF5OmhvdmVyLAogICAgLmZsYXRwaWNrci1kYXkucHJldk1vbnRoRGF5OmhvdmVyLAogICAgLmZsYXRwaWNrci1kYXkubmV4dE1vbnRoRGF5OmhvdmVyLAogICAgLmZsYXRwaWNrci1kYXk6Zm9jdXMsCiAgICAuZmxhdHBpY2tyLWRheS5wcmV2TW9udGhEYXk6Zm9jdXMsCiAgICAuZmxhdHBpY2tyLWRheS5uZXh0TW9udGhEYXk6Zm9jdXMgewogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgIG91dGxpbmU6IDA7CiAgICAgIGJhY2tncm91bmQ6ICNlNmU2ZTY7CiAgICAgIGJvcmRlci1jb2xvcjogI2U2ZTZlNjsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWRheS50b2RheSB7CiAgICAgIGJvcmRlci1jb2xvcjogIzk1OWVhOTsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWRheS50b2RheTpob3ZlciwKICAgIC5mbGF0cGlja3ItZGF5LnRvZGF5OmZvY3VzIHsKICAgICAgYm9yZGVyLWNvbG9yOiAjOTU5ZWE5OwogICAgICBiYWNrZ3JvdW5kOiAjOTU5ZWE5OwogICAgICBjb2xvcjogI2ZmZjsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZCwKICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2UsCiAgICAuZmxhdHBpY2tyLWRheS5lbmRSYW5nZSwKICAgIC5mbGF0cGlja3ItZGF5LnNlbGVjdGVkLmluUmFuZ2UsCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlLmluUmFuZ2UsCiAgICAuZmxhdHBpY2tyLWRheS5lbmRSYW5nZS5pblJhbmdlLAogICAgLmZsYXRwaWNrci1kYXkuc2VsZWN0ZWQ6Zm9jdXMsCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlOmZvY3VzLAogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2U6Zm9jdXMsCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZDpob3ZlciwKICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2U6aG92ZXIsCiAgICAuZmxhdHBpY2tyLWRheS5lbmRSYW5nZTpob3ZlciwKICAgIC5mbGF0cGlja3ItZGF5LnNlbGVjdGVkLnByZXZNb250aERheSwKICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2UucHJldk1vbnRoRGF5LAogICAgLmZsYXRwaWNrci1kYXkuZW5kUmFuZ2UucHJldk1vbnRoRGF5LAogICAgLmZsYXRwaWNrci1kYXkuc2VsZWN0ZWQubmV4dE1vbnRoRGF5LAogICAgLmZsYXRwaWNrci1kYXkuc3RhcnRSYW5nZS5uZXh0TW9udGhEYXksCiAgICAuZmxhdHBpY2tyLWRheS5lbmRSYW5nZS5uZXh0TW9udGhEYXkgewogICAgICBiYWNrZ3JvdW5kOiAjNTY5ZmY3OwogICAgICAtd2Via2l0LWJveC1zaGFkb3c6IG5vbmU7CiAgICAgIGJveC1zaGFkb3c6IG5vbmU7CiAgICAgIGNvbG9yOiAjZmZmOwogICAgICBib3JkZXItY29sb3I6ICM1NjlmZjc7CiAgICB9CgogICAgLmZsYXRwaWNrci1kYXkuc2VsZWN0ZWQuc3RhcnRSYW5nZSwKICAgIC5mbGF0cGlja3ItZGF5LnN0YXJ0UmFuZ2Uuc3RhcnRSYW5nZSwKICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlLnN0YXJ0UmFuZ2UgewogICAgICBib3JkZXItcmFkaXVzOiA1MHB4IDAgMCA1MHB4OwogICAgfQoKICAgIC5mbGF0cGlja3ItZGF5LnNlbGVjdGVkLmVuZFJhbmdlLAogICAgLmZsYXRwaWNrci1kYXkuc3RhcnRSYW5nZS5lbmRSYW5nZSwKICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlLmVuZFJhbmdlIHsKICAgICAgYm9yZGVyLXJhZGl1czogMCA1MHB4IDUwcHggMDsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWRheS5zZWxlY3RlZC5zdGFydFJhbmdlKy5lbmRSYW5nZTpub3QoOm50aC1jaGlsZCg3bisxKSksCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlLnN0YXJ0UmFuZ2UrLmVuZFJhbmdlOm5vdCg6bnRoLWNoaWxkKDduKzEpKSwKICAgIC5mbGF0cGlja3ItZGF5LmVuZFJhbmdlLnN0YXJ0UmFuZ2UrLmVuZFJhbmdlOm5vdCg6bnRoLWNoaWxkKDduKzEpKSB7CiAgICAgIC13ZWJraXQtYm94LXNoYWRvdzogLTEwcHggMCAwICM1NjlmZjc7CiAgICAgIGJveC1zaGFkb3c6IC0xMHB4IDAgMCAjNTY5ZmY3OwogICAgfQoKICAgIC5mbGF0cGlja3ItZGF5LnNlbGVjdGVkLnN0YXJ0UmFuZ2UuZW5kUmFuZ2UsCiAgICAuZmxhdHBpY2tyLWRheS5zdGFydFJhbmdlLnN0YXJ0UmFuZ2UuZW5kUmFuZ2UsCiAgICAuZmxhdHBpY2tyLWRheS5lbmRSYW5nZS5zdGFydFJhbmdlLmVuZFJhbmdlIHsKICAgICAgYm9yZGVyLXJhZGl1czogNTBweDsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWRheS5pblJhbmdlIHsKICAgICAgYm9yZGVyLXJhZGl1czogMDsKICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiAtNXB4IDAgMCAjZTZlNmU2LCA1cHggMCAwICNlNmU2ZTY7CiAgICAgIGJveC1zaGFkb3c6IC01cHggMCAwICNlNmU2ZTYsIDVweCAwIDAgI2U2ZTZlNjsKICAgIH0KCiAgICAuZmxhdHBpY2tyLWRheS5kaXNhYmxlZCwKICAgIC5mbGF0cGlja3ItZGF5LmRpc2FibGVkOmhvdmVyLAogICAgLmZsYXRwaWNrci1kYXkucHJldk1vbnRoRGF5LAogICAgLmZsYXRwaWNrci1kYXkubmV4dE1vbnRoRGF5LAogICAgLmZsYXRwaWNrci1kYXkubm90QWxsb3dlZCwKICAgIC5mbGF0cGlja3ItZGF5Lm5vdEFsbG93ZWQucHJldk1vbnRoRGF5LAogICAgLmZsYXRwaWNrci1kYXkubm90QWxsb3dlZC5uZXh0TW9udGhEYXkgewogICAgICBjb2xvcjogcmdiYSg1NywgNTcsIDU3LCAwLjMpOwogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsKICAgICAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgICAgY3Vyc29yOiBkZWZhdWx0OwogICAgfQoKICAgIC5mbGF0cGlja3ItZGF5LmRpc2FibGVkLAogICAgLmZsYXRwaWNrci1kYXkuZGlzYWJsZWQ6aG92ZXIgewogICAgICBjdXJzb3I6IG5vdC1hbGxvd2VkOwogICAgICBjb2xvcjogcmdiYSg1NywgNTcsIDU3LCAwLjEpOwogICAgfQoKICAgIC5mbGF0cGlja3ItZGF5LndlZWsuc2VsZWN0ZWQgewogICAgICBib3JkZXItcmFkaXVzOiAwOwogICAgICAtd2Via2l0LWJveC1zaGFkb3c6IC01cHggMCAwICM1NjlmZjcsIDVweCAwIDAgIzU2OWZmNzsKICAgICAgYm94LXNoYWRvdzogLTVweCAwIDAgIzU2OWZmNywgNXB4IDAgMCAjNTY5ZmY3OwogICAgfQoKICAgIC5mbGF0cGlja3ItZGF5LmhpZGRlbiB7CiAgICAgIHZpc2liaWxpdHk6IGhpZGRlbjsKICAgIH0KCiAgICAucmFuZ2VNb2RlIC5mbGF0cGlja3ItZGF5IHsKICAgICAgbWFyZ2luLXRvcDogMXB4OwogICAgfQoKICAgIC5mbGF0cGlja3Itd2Vla3dyYXBwZXIgewogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgIGZsb2F0OiBsZWZ0OwogICAgfQoKICAgIC5mbGF0cGlja3Itd2Vla3dyYXBwZXIgLmZsYXRwaWNrci13ZWVrcyB7CiAgICAgIHBhZGRpbmc6IDAgMTJweDsKICAgICAgLXdlYmtpdC1ib3gtc2hhZG93OiAxcHggMCAwICNlNmU2ZTY7CiAgICAgIGJveC1zaGFkb3c6IDFweCAwIDAgI2U2ZTZlNjsKICAgIH0KCiAgICAuZmxhdHBpY2tyLXdlZWt3cmFwcGVyIC5mbGF0cGlja3Itd2Vla2RheSB7CiAgICAgIGZsb2F0OiBub25lOwogICAgICB3aWR0aDogMTAwJTsKICAgICAgbGluZS1oZWlnaHQ6IDI4cHg7CiAgICB9CgogICAgLmZsYXRwaWNrci13ZWVrd3JhcHBlciBzcGFuLmZsYXRwaWNrci1kYXksCiAgICAuZmxhdHBpY2tyLXdlZWt3cmFwcGVyIHNwYW4uZmxhdHBpY2tyLWRheTpob3ZlciB7CiAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICB3aWR0aDogMTAwJTsKICAgICAgbWF4LXdpZHRoOiBub25lOwogICAgICBjb2xvcjogcmdiYSg1NywgNTcsIDU3LCAwLjMpOwogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsKICAgICAgY3Vyc29yOiBkZWZhdWx0OwogICAgICBib3JkZXI6IG5vbmU7CiAgICB9CgogICAgLmZsYXRwaWNrci1pbm5lckNvbnRhaW5lciB7CiAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICBkaXNwbGF5OiAtd2Via2l0LWJveDsKICAgICAgZGlzcGxheTogLXdlYmtpdC1mbGV4OwogICAgICBkaXNwbGF5OiAtbXMtZmxleGJveDsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgfQoKICAgIC5mbGF0cGlja3ItckNvbnRhaW5lciB7CiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgICAgcGFkZGluZzogMDsKICAgICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgfQoKICAgIC5mbGF0cGlja3ItdGltZSB7CiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgb3V0bGluZTogMDsKICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgIGhlaWdodDogMDsKICAgICAgbGluZS1oZWlnaHQ6IDQwcHg7CiAgICAgIG1heC1oZWlnaHQ6IDQwcHg7CiAgICAgIC13ZWJraXQtYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgZGlzcGxheTogLXdlYmtpdC1ib3g7CiAgICAgIGRpc3BsYXk6IC13ZWJraXQtZmxleDsKICAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICB9CgogICAgLmZsYXRwaWNrci10aW1lOmFmdGVyIHsKICAgICAgY29udGVudDogIiI7CiAgICAgIGRpc3BsYXk6IHRhYmxlOwogICAgICBjbGVhcjogYm90aDsKICAgIH0KCiAgICAuZmxhdHBpY2tyLXRpbWUgLm51bUlucHV0V3JhcHBlciB7CiAgICAgIC13ZWJraXQtYm94LWZsZXg6IDE7CiAgICAgIC13ZWJraXQtZmxleDogMTsKICAgICAgLW1zLWZsZXg6IDE7CiAgICAgIGZsZXg6IDE7CiAgICAgIHdpZHRoOiA0MCU7CiAgICAgIGhlaWdodDogNDBweDsKICAgICAgZmxvYXQ6IGxlZnQ7CiAgICB9CgogICAgLmZsYXRwaWNrci10aW1lIC5udW1JbnB1dFdyYXBwZXIgc3Bhbi5hcnJvd1VwOmFmdGVyIHsKICAgICAgYm9yZGVyLWJvdHRvbS1jb2xvcjogIzM5MzkzOTsKICAgIH0KCiAgICAuZmxhdHBpY2tyLXRpbWUgLm51bUlucHV0V3JhcHBlciBzcGFuLmFycm93RG93bjphZnRlciB7CiAgICAgIGJvcmRlci10b3AtY29sb3I6ICMzOTM5Mzk7CiAgICB9CgogICAgLmZsYXRwaWNrci10aW1lLmhhc1NlY29uZHMgLm51bUlucHV0V3JhcHBlciB7CiAgICAgIHdpZHRoOiAyNiU7CiAgICB9CgogICAgLmZsYXRwaWNrci10aW1lLnRpbWUyNGhyIC5udW1JbnB1dFdyYXBwZXIgewogICAgICB3aWR0aDogNDklOwogICAgfQoKICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dCB7CiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50OwogICAgICAtd2Via2l0LWJveC1zaGFkb3c6IG5vbmU7CiAgICAgIGJveC1zaGFkb3c6IG5vbmU7CiAgICAgIGJvcmRlcjogMDsKICAgICAgYm9yZGVyLXJhZGl1czogMDsKICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICBtYXJnaW46IDA7CiAgICAgIHBhZGRpbmc6IDA7CiAgICAgIGhlaWdodDogaW5oZXJpdDsKICAgICAgbGluZS1oZWlnaHQ6IGluaGVyaXQ7CiAgICAgIGNvbG9yOiAjMzkzOTM5OwogICAgICBmb250LXNpemU6IDE0cHg7CiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgfQoKICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dC5mbGF0cGlja3ItaG91ciB7CiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgfQoKICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dC5mbGF0cGlja3ItbWludXRlLAogICAgLmZsYXRwaWNrci10aW1lIGlucHV0LmZsYXRwaWNrci1zZWNvbmQgewogICAgICBmb250LXdlaWdodDogNDAwOwogICAgfQoKICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dDpmb2N1cyB7CiAgICAgIG91dGxpbmU6IDA7CiAgICAgIGJvcmRlcjogMDsKICAgIH0KCiAgICAuZmxhdHBpY2tyLXRpbWUgLmZsYXRwaWNrci10aW1lLXNlcGFyYXRvciwKICAgIC5mbGF0cGlja3ItdGltZSAuZmxhdHBpY2tyLWFtLXBtIHsKICAgICAgaGVpZ2h0OiBpbmhlcml0OwogICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgIGZsb2F0OiBsZWZ0OwogICAgICBsaW5lLWhlaWdodDogaW5oZXJpdDsKICAgICAgY29sb3I6ICMzOTM5Mzk7CiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICB3aWR0aDogMiU7CiAgICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7CiAgICAgIC1tb3otdXNlci1zZWxlY3Q6IG5vbmU7CiAgICAgIC1tcy11c2VyLXNlbGVjdDogbm9uZTsKICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7CiAgICAgIC13ZWJraXQtYWxpZ24tc2VsZjogY2VudGVyOwogICAgICAtbXMtZmxleC1pdGVtLWFsaWduOiBjZW50ZXI7CiAgICAgIGFsaWduLXNlbGY6IGNlbnRlcjsKICAgIH0KCiAgICAuZmxhdHBpY2tyLXRpbWUgLmZsYXRwaWNrci1hbS1wbSB7CiAgICAgIG91dGxpbmU6IDA7CiAgICAgIHdpZHRoOiAxOCU7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICBmb250LXdlaWdodDogNDAwOwogICAgfQoKICAgIC5mbGF0cGlja3ItdGltZSBpbnB1dDpob3ZlciwKICAgIC5mbGF0cGlja3ItdGltZSAuZmxhdHBpY2tyLWFtLXBtOmhvdmVyLAogICAgLmZsYXRwaWNrci10aW1lIGlucHV0OmZvY3VzLAogICAgLmZsYXRwaWNrci10aW1lIC5mbGF0cGlja3ItYW0tcG06Zm9jdXMgewogICAgICBiYWNrZ3JvdW5kOiAjZjNmM2YzOwogICAgfQoKICAgIC5mbGF0cGlja3ItaW5wdXRbcmVhZG9ubHldIHsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgfQoKICAgIEAtd2Via2l0LWtleWZyYW1lcyBmcEZhZGVJbkRvd24gewogICAgICBmcm9tIHsKICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAtMjBweCwgMCk7CiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAtMjBweCwgMCk7CiAgICAgIH0KCiAgICAgIHRvIHsKICAgICAgICBvcGFjaXR5OiAxOwogICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAwLCAwKTsKICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIDAsIDApOwogICAgICB9CiAgICB9CgogICAgQGtleWZyYW1lcyBmcEZhZGVJbkRvd24gewogICAgICBmcm9tIHsKICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAtMjBweCwgMCk7CiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAtMjBweCwgMCk7CiAgICAgIH0KCiAgICAgIHRvIHsKICAgICAgICBvcGFjaXR5OiAxOwogICAgICAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAwLCAwKTsKICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIDAsIDApOwogICAgICB9CiAgICB9CiAgPC9zdHlsZT4KICA8IS0tPHNjcmlwdCBzcmM9ImphdmFzY3JpcHRzL2ZsYXRwaWNrci5qcyIgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij48L3NjcmlwdD4tLT4KICA8c2NyaXB0PgogIC8qIGZsYXRwaWNrciB2NC41LjAsIEBsaWNlbnNlIE1JVCAqLwooZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgewogICAgdHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnID8gbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCkgOgogICAgdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDoKICAgIChnbG9iYWwuZmxhdHBpY2tyID0gZmFjdG9yeSgpKTsKfSh0aGlzLCAoZnVuY3Rpb24gKCkgeyAndXNlIHN0cmljdCc7CgogICAgdmFyIHBhZCA9IGZ1bmN0aW9uIHBhZChudW1iZXIpIHsKICAgICAgcmV0dXJuICgiMCIgKyBudW1iZXIpLnNsaWNlKC0yKTsKICAgIH07CiAgICB2YXIgaW50ID0gZnVuY3Rpb24gaW50KGJvb2wpIHsKICAgICAgcmV0dXJuIGJvb2wgPT09IHRydWUgPyAxIDogMDsKICAgIH07CiAgICBmdW5jdGlvbiBkZWJvdW5jZShmdW5jLCB3YWl0LCBpbW1lZGlhdGUpIHsKICAgICAgaWYgKGltbWVkaWF0ZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgaW1tZWRpYXRlID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIHZhciB0aW1lb3V0OwogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBjb250ZXh0ID0gdGhpcywKICAgICAgICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgICAgICB0aW1lb3V0ICE9PSBudWxsICYmIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgICB0aW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgICBpZiAoIWltbWVkaWF0ZSkgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICB9LCB3YWl0KTsKICAgICAgICBpZiAoaW1tZWRpYXRlICYmICF0aW1lb3V0KSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICB9OwogICAgfQogICAgdmFyIGFycmF5aWZ5ID0gZnVuY3Rpb24gYXJyYXlpZnkob2JqKSB7CiAgICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBBcnJheSA/IG9iaiA6IFtvYmpdOwogICAgfTsKCiAgICB2YXIgZG9fbm90aGluZyA9IGZ1bmN0aW9uIGRvX25vdGhpbmcoKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9OwoKICAgIHZhciBtb250aFRvU3RyID0gZnVuY3Rpb24gbW9udGhUb1N0cihtb250aE51bWJlciwgc2hvcnRoYW5kLCBsb2NhbGUpIHsKICAgICAgcmV0dXJuIGxvY2FsZS5tb250aHNbc2hvcnRoYW5kID8gInNob3J0aGFuZCIgOiAibG9uZ2hhbmQiXVttb250aE51bWJlcl07CiAgICB9OwogICAgdmFyIHJldkZvcm1hdCA9IHsKICAgICAgRDogZG9fbm90aGluZywKICAgICAgRjogZnVuY3Rpb24gRihkYXRlT2JqLCBtb250aE5hbWUsIGxvY2FsZSkgewogICAgICAgIGRhdGVPYmouc2V0TW9udGgobG9jYWxlLm1vbnRocy5sb25naGFuZC5pbmRleE9mKG1vbnRoTmFtZSkpOwogICAgICB9LAogICAgICBHOiBmdW5jdGlvbiBHKGRhdGVPYmosIGhvdXIpIHsKICAgICAgICBkYXRlT2JqLnNldEhvdXJzKHBhcnNlRmxvYXQoaG91cikpOwogICAgICB9LAogICAgICBIOiBmdW5jdGlvbiBIKGRhdGVPYmosIGhvdXIpIHsKICAgICAgICBkYXRlT2JqLnNldEhvdXJzKHBhcnNlRmxvYXQoaG91cikpOwogICAgICB9LAogICAgICBKOiBmdW5jdGlvbiBKKGRhdGVPYmosIGRheSkgewogICAgICAgIGRhdGVPYmouc2V0RGF0ZShwYXJzZUZsb2F0KGRheSkpOwogICAgICB9LAogICAgICBLOiBmdW5jdGlvbiBLKGRhdGVPYmosIGFtUE0sIGxvY2FsZSkgewogICAgICAgIGRhdGVPYmouc2V0SG91cnMoZGF0ZU9iai5nZXRIb3VycygpICUgMTIgKyAxMiAqIGludChuZXcgUmVnRXhwKGxvY2FsZS5hbVBNWzFdLCAiaSIpLnRlc3QoYW1QTSkpKTsKICAgICAgfSwKICAgICAgTTogZnVuY3Rpb24gTShkYXRlT2JqLCBzaG9ydE1vbnRoLCBsb2NhbGUpIHsKICAgICAgICBkYXRlT2JqLnNldE1vbnRoKGxvY2FsZS5tb250aHMuc2hvcnRoYW5kLmluZGV4T2Yoc2hvcnRNb250aCkpOwogICAgICB9LAogICAgICBTOiBmdW5jdGlvbiBTKGRhdGVPYmosIHNlY29uZHMpIHsKICAgICAgICBkYXRlT2JqLnNldFNlY29uZHMocGFyc2VGbG9hdChzZWNvbmRzKSk7CiAgICAgIH0sCiAgICAgIFU6IGZ1bmN0aW9uIFUoXywgdW5peFNlY29uZHMpIHsKICAgICAgICByZXR1cm4gbmV3IERhdGUocGFyc2VGbG9hdCh1bml4U2Vjb25kcykgKiAxMDAwKTsKICAgICAgfSwKICAgICAgVzogZnVuY3Rpb24gVyhkYXRlT2JqLCB3ZWVrTnVtKSB7CiAgICAgICAgdmFyIHdlZWtOdW1iZXIgPSBwYXJzZUludCh3ZWVrTnVtKTsKICAgICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZU9iai5nZXRGdWxsWWVhcigpLCAwLCAyICsgKHdlZWtOdW1iZXIgLSAxKSAqIDcsIDAsIDAsIDAsIDApOwogICAgICB9LAogICAgICBZOiBmdW5jdGlvbiBZKGRhdGVPYmosIHllYXIpIHsKICAgICAgICBkYXRlT2JqLnNldEZ1bGxZZWFyKHBhcnNlRmxvYXQoeWVhcikpOwogICAgICB9LAogICAgICBaOiBmdW5jdGlvbiBaKF8sIElTT0RhdGUpIHsKICAgICAgICByZXR1cm4gbmV3IERhdGUoSVNPRGF0ZSk7CiAgICAgIH0sCiAgICAgIGQ6IGZ1bmN0aW9uIGQoZGF0ZU9iaiwgZGF5KSB7CiAgICAgICAgZGF0ZU9iai5zZXREYXRlKHBhcnNlRmxvYXQoZGF5KSk7CiAgICAgIH0sCiAgICAgIGg6IGZ1bmN0aW9uIGgoZGF0ZU9iaiwgaG91cikgewogICAgICAgIGRhdGVPYmouc2V0SG91cnMocGFyc2VGbG9hdChob3VyKSk7CiAgICAgIH0sCiAgICAgIGk6IGZ1bmN0aW9uIGkoZGF0ZU9iaiwgbWludXRlcykgewogICAgICAgIGRhdGVPYmouc2V0TWludXRlcyhwYXJzZUZsb2F0KG1pbnV0ZXMpKTsKICAgICAgfSwKICAgICAgajogZnVuY3Rpb24gaihkYXRlT2JqLCBkYXkpIHsKICAgICAgICBkYXRlT2JqLnNldERhdGUocGFyc2VGbG9hdChkYXkpKTsKICAgICAgfSwKICAgICAgbDogZG9fbm90aGluZywKICAgICAgbTogZnVuY3Rpb24gbShkYXRlT2JqLCBtb250aCkgewogICAgICAgIGRhdGVPYmouc2V0TW9udGgocGFyc2VGbG9hdChtb250aCkgLSAxKTsKICAgICAgfSwKICAgICAgbjogZnVuY3Rpb24gbihkYXRlT2JqLCBtb250aCkgewogICAgICAgIGRhdGVPYmouc2V0TW9udGgocGFyc2VGbG9hdChtb250aCkgLSAxKTsKICAgICAgfSwKICAgICAgczogZnVuY3Rpb24gcyhkYXRlT2JqLCBzZWNvbmRzKSB7CiAgICAgICAgZGF0ZU9iai5zZXRTZWNvbmRzKHBhcnNlRmxvYXQoc2Vjb25kcykpOwogICAgICB9LAogICAgICB3OiBkb19ub3RoaW5nLAogICAgICB5OiBmdW5jdGlvbiB5KGRhdGVPYmosIHllYXIpIHsKICAgICAgICBkYXRlT2JqLnNldEZ1bGxZZWFyKDIwMDAgKyBwYXJzZUZsb2F0KHllYXIpKTsKICAgICAgfQogICAgfTsKICAgIHZhciB0b2tlblJlZ2V4ID0gewogICAgICBEOiAiKFxcdyspIiwKICAgICAgRjogIihcXHcrKSIsCiAgICAgIEc6ICIoXFxkXFxkfFxcZCkiLAogICAgICBIOiAiKFxcZFxcZHxcXGQpIiwKICAgICAgSjogIihcXGRcXGR8XFxkKVxcdysiLAogICAgICBLOiAiIiwKICAgICAgTTogIihcXHcrKSIsCiAgICAgIFM6ICIoXFxkXFxkfFxcZCkiLAogICAgICBVOiAiKC4rKSIsCiAgICAgIFc6ICIoXFxkXFxkfFxcZCkiLAogICAgICBZOiAiKFxcZHs0fSkiLAogICAgICBaOiAiKC4rKSIsCiAgICAgIGQ6ICIoXFxkXFxkfFxcZCkiLAogICAgICBoOiAiKFxcZFxcZHxcXGQpIiwKICAgICAgaTogIihcXGRcXGR8XFxkKSIsCiAgICAgIGo6ICIoXFxkXFxkfFxcZCkiLAogICAgICBsOiAiKFxcdyspIiwKICAgICAgbTogIihcXGRcXGR8XFxkKSIsCiAgICAgIG46ICIoXFxkXFxkfFxcZCkiLAogICAgICBzOiAiKFxcZFxcZHxcXGQpIiwKICAgICAgdzogIihcXGRcXGR8XFxkKSIsCiAgICAgIHk6ICIoXFxkezJ9KSIKICAgIH07CiAgICB2YXIgZm9ybWF0cyA9IHsKICAgICAgWjogZnVuY3Rpb24gWihkYXRlKSB7CiAgICAgICAgcmV0dXJuIGRhdGUudG9JU09TdHJpbmcoKTsKICAgICAgfSwKICAgICAgRDogZnVuY3Rpb24gRChkYXRlLCBsb2NhbGUsIG9wdGlvbnMpIHsKICAgICAgICByZXR1cm4gbG9jYWxlLndlZWtkYXlzLnNob3J0aGFuZFtmb3JtYXRzLncoZGF0ZSwgbG9jYWxlLCBvcHRpb25zKV07CiAgICAgIH0sCiAgICAgIEY6IGZ1bmN0aW9uIEYoZGF0ZSwgbG9jYWxlLCBvcHRpb25zKSB7CiAgICAgICAgcmV0dXJuIG1vbnRoVG9TdHIoZm9ybWF0cy5uKGRhdGUsIGxvY2FsZSwgb3B0aW9ucykgLSAxLCBmYWxzZSwgbG9jYWxlKTsKICAgICAgfSwKICAgICAgRzogZnVuY3Rpb24gRyhkYXRlLCBsb2NhbGUsIG9wdGlvbnMpIHsKICAgICAgICByZXR1cm4gcGFkKGZvcm1hdHMuaChkYXRlLCBsb2NhbGUsIG9wdGlvbnMpKTsKICAgICAgfSwKICAgICAgSDogZnVuY3Rpb24gSChkYXRlKSB7CiAgICAgICAgcmV0dXJuIHBhZChkYXRlLmdldEhvdXJzKCkpOwogICAgICB9LAogICAgICBKOiBmdW5jdGlvbiBKKGRhdGUsIGxvY2FsZSkgewogICAgICAgIHJldHVybiBsb2NhbGUub3JkaW5hbCAhPT0gdW5kZWZpbmVkID8gZGF0ZS5nZXREYXRlKCkgKyBsb2NhbGUub3JkaW5hbChkYXRlLmdldERhdGUoKSkgOiBkYXRlLmdldERhdGUoKTsKICAgICAgfSwKICAgICAgSzogZnVuY3Rpb24gSyhkYXRlLCBsb2NhbGUpIHsKICAgICAgICByZXR1cm4gbG9jYWxlLmFtUE1baW50KGRhdGUuZ2V0SG91cnMoKSA+IDExKV07CiAgICAgIH0sCiAgICAgIE06IGZ1bmN0aW9uIE0oZGF0ZSwgbG9jYWxlKSB7CiAgICAgICAgcmV0dXJuIG1vbnRoVG9TdHIoZGF0ZS5nZXRNb250aCgpLCB0cnVlLCBsb2NhbGUpOwogICAgICB9LAogICAgICBTOiBmdW5jdGlvbiBTKGRhdGUpIHsKICAgICAgICByZXR1cm4gcGFkKGRhdGUuZ2V0U2Vjb25kcygpKTsKICAgICAgfSwKICAgICAgVTogZnVuY3Rpb24gVShkYXRlKSB7CiAgICAgICAgcmV0dXJuIGRhdGUuZ2V0VGltZSgpIC8gMTAwMDsKICAgICAgfSwKICAgICAgVzogZnVuY3Rpb24gVyhkYXRlLCBfLCBvcHRpb25zKSB7CiAgICAgICAgcmV0dXJuIG9wdGlvbnMuZ2V0V2VlayhkYXRlKTsKICAgICAgfSwKICAgICAgWTogZnVuY3Rpb24gWShkYXRlKSB7CiAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RnVsbFllYXIoKTsKICAgICAgfSwKICAgICAgZDogZnVuY3Rpb24gZChkYXRlKSB7CiAgICAgICAgcmV0dXJuIHBhZChkYXRlLmdldERhdGUoKSk7CiAgICAgIH0sCiAgICAgIGg6IGZ1bmN0aW9uIGgoZGF0ZSkgewogICAgICAgIHJldHVybiBkYXRlLmdldEhvdXJzKCkgJSAxMiA/IGRhdGUuZ2V0SG91cnMoKSAlIDEyIDogMTI7CiAgICAgIH0sCiAgICAgIGk6IGZ1bmN0aW9uIGkoZGF0ZSkgewogICAgICAgIHJldHVybiBwYWQoZGF0ZS5nZXRNaW51dGVzKCkpOwogICAgICB9LAogICAgICBqOiBmdW5jdGlvbiBqKGRhdGUpIHsKICAgICAgICByZXR1cm4gZGF0ZS5nZXREYXRlKCk7CiAgICAgIH0sCiAgICAgIGw6IGZ1bmN0aW9uIGwoZGF0ZSwgbG9jYWxlKSB7CiAgICAgICAgcmV0dXJuIGxvY2FsZS53ZWVrZGF5cy5sb25naGFuZFtkYXRlLmdldERheSgpXTsKICAgICAgfSwKICAgICAgbTogZnVuY3Rpb24gbShkYXRlKSB7CiAgICAgICAgcmV0dXJuIHBhZChkYXRlLmdldE1vbnRoKCkgKyAxKTsKICAgICAgfSwKICAgICAgbjogZnVuY3Rpb24gbihkYXRlKSB7CiAgICAgICAgcmV0dXJuIGRhdGUuZ2V0TW9udGgoKSArIDE7CiAgICAgIH0sCiAgICAgIHM6IGZ1bmN0aW9uIHMoZGF0ZSkgewogICAgICAgIHJldHVybiBkYXRlLmdldFNlY29uZHMoKTsKICAgICAgfSwKICAgICAgdzogZnVuY3Rpb24gdyhkYXRlKSB7CiAgICAgICAgcmV0dXJuIGRhdGUuZ2V0RGF5KCk7CiAgICAgIH0sCiAgICAgIHk6IGZ1bmN0aW9uIHkoZGF0ZSkgewogICAgICAgIHJldHVybiBTdHJpbmcoZGF0ZS5nZXRGdWxsWWVhcigpKS5zdWJzdHJpbmcoMik7CiAgICAgIH0KICAgIH07CgogICAgdmFyIGVuZ2xpc2ggPSB7CiAgICAgIHdlZWtkYXlzOiB7CiAgICAgICAgc2hvcnRoYW5kOiBbIlN1biIsICJNb24iLCAiVHVlIiwgIldlZCIsICJUaHUiLCAiRnJpIiwgIlNhdCJdLAogICAgICAgIGxvbmdoYW5kOiBbIlN1bmRheSIsICJNb25kYXkiLCAiVHVlc2RheSIsICJXZWRuZXNkYXkiLCAiVGh1cnNkYXkiLCAiRnJpZGF5IiwgIlNhdHVyZGF5Il0KICAgICAgfSwKICAgICAgbW9udGhzOiB7CiAgICAgICAgc2hvcnRoYW5kOiBbIkphbiIsICJGZWIiLCAiTWFyIiwgIkFwciIsICJNYXkiLCAiSnVuIiwgIkp1bCIsICJBdWciLCAiU2VwIiwgIk9jdCIsICJOb3YiLCAiRGVjIl0sCiAgICAgICAgbG9uZ2hhbmQ6IFsiSmFudWFyeSIsICJGZWJydWFyeSIsICJNYXJjaCIsICJBcHJpbCIsICJNYXkiLCAiSnVuZSIsICJKdWx5IiwgIkF1Z3VzdCIsICJTZXB0ZW1iZXIiLCAiT2N0b2JlciIsICJOb3ZlbWJlciIsICJEZWNlbWJlciJdCiAgICAgIH0sCiAgICAgIGRheXNJbk1vbnRoOiBbMzEsIDI4LCAzMSwgMzAsIDMxLCAzMCwgMzEsIDMxLCAzMCwgMzEsIDMwLCAzMV0sCiAgICAgIGZpcnN0RGF5T2ZXZWVrOiAwLAogICAgICBvcmRpbmFsOiBmdW5jdGlvbiBvcmRpbmFsKG50aCkgewogICAgICAgIHZhciBzID0gbnRoICUgMTAwOwogICAgICAgIGlmIChzID4gMyAmJiBzIDwgMjEpIHJldHVybiAidGgiOwoKICAgICAgICBzd2l0Y2ggKHMgJSAxMCkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICByZXR1cm4gInN0IjsKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiAibmQiOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgcmV0dXJuICJyZCI7CgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuICJ0aCI7CiAgICAgICAgfQogICAgICB9LAogICAgICByYW5nZVNlcGFyYXRvcjogIiB0byAiLAogICAgICB3ZWVrQWJicmV2aWF0aW9uOiAiV2siLAogICAgICBzY3JvbGxUaXRsZTogIlNjcm9sbCB0byBpbmNyZW1lbnQiLAogICAgICB0b2dnbGVUaXRsZTogIkNsaWNrIHRvIHRvZ2dsZSIsCiAgICAgIGFtUE06IFsiQU0iLCAiUE0iXSwKICAgICAgeWVhckFyaWFMYWJlbDogIlllYXIiCiAgICB9OwoKICAgIHZhciBjcmVhdGVEYXRlRm9ybWF0dGVyID0gZnVuY3Rpb24gY3JlYXRlRGF0ZUZvcm1hdHRlcihfcmVmKSB7CiAgICAgIHZhciBfcmVmJGNvbmZpZyA9IF9yZWYuY29uZmlnLAogICAgICAgICAgY29uZmlnID0gX3JlZiRjb25maWcgPT09IHZvaWQgMCA/IGRlZmF1bHRzIDogX3JlZiRjb25maWcsCiAgICAgICAgICBfcmVmJGwxMG4gPSBfcmVmLmwxMG4sCiAgICAgICAgICBsMTBuID0gX3JlZiRsMTBuID09PSB2b2lkIDAgPyBlbmdsaXNoIDogX3JlZiRsMTBuOwogICAgICByZXR1cm4gZnVuY3Rpb24gKGRhdGVPYmosIGZybXQsIG92ZXJyaWRlTG9jYWxlKSB7CiAgICAgICAgaWYgKGNvbmZpZy5mb3JtYXREYXRlICE9PSB1bmRlZmluZWQpIHJldHVybiBjb25maWcuZm9ybWF0RGF0ZShkYXRlT2JqLCBmcm10KTsKICAgICAgICB2YXIgbG9jYWxlID0gb3ZlcnJpZGVMb2NhbGUgfHwgbDEwbjsKICAgICAgICByZXR1cm4gZnJtdC5zcGxpdCgiIikubWFwKGZ1bmN0aW9uIChjLCBpLCBhcnIpIHsKICAgICAgICAgIHJldHVybiBmb3JtYXRzW2NdICYmIGFycltpIC0gMV0gIT09ICJcXCIgPyBmb3JtYXRzW2NdKGRhdGVPYmosIGxvY2FsZSwgY29uZmlnKSA6IGMgIT09ICJcXCIgPyBjIDogIiI7CiAgICAgICAgfSkuam9pbigiIik7CiAgICAgIH07CiAgICB9OwogICAgdmFyIGNyZWF0ZURhdGVQYXJzZXIgPSBmdW5jdGlvbiBjcmVhdGVEYXRlUGFyc2VyKF9yZWYyKSB7CiAgICAgIHZhciBfcmVmMiRjb25maWcgPSBfcmVmMi5jb25maWcsCiAgICAgICAgICBjb25maWcgPSBfcmVmMiRjb25maWcgPT09IHZvaWQgMCA/IGRlZmF1bHRzIDogX3JlZjIkY29uZmlnLAogICAgICAgICAgX3JlZjIkbDEwbiA9IF9yZWYyLmwxMG4sCiAgICAgICAgICBsMTBuID0gX3JlZjIkbDEwbiA9PT0gdm9pZCAwID8gZW5nbGlzaCA6IF9yZWYyJGwxMG47CiAgICAgIHJldHVybiBmdW5jdGlvbiAoZGF0ZSwgZ2l2ZW5Gb3JtYXQsIHRpbWVsZXNzKSB7CiAgICAgICAgaWYgKGRhdGUgIT09IDAgJiYgIWRhdGUpIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgdmFyIHBhcnNlZERhdGU7CiAgICAgICAgdmFyIGRhdGVfb3JpZyA9IGRhdGU7CiAgICAgICAgaWYgKGRhdGUgaW5zdGFuY2VvZiBEYXRlKSBwYXJzZWREYXRlID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO2Vsc2UgaWYgKHR5cGVvZiBkYXRlICE9PSAic3RyaW5nIiAmJiBkYXRlLnRvRml4ZWQgIT09IHVuZGVmaW5lZCkgcGFyc2VkRGF0ZSA9IG5ldyBEYXRlKGRhdGUpO2Vsc2UgaWYgKHR5cGVvZiBkYXRlID09PSAic3RyaW5nIikgewogICAgICAgICAgdmFyIGZvcm1hdCA9IGdpdmVuRm9ybWF0IHx8IChjb25maWcgfHwgZGVmYXVsdHMpLmRhdGVGb3JtYXQ7CiAgICAgICAgICB2YXIgZGF0ZXN0ciA9IFN0cmluZyhkYXRlKS50cmltKCk7CgogICAgICAgICAgaWYgKGRhdGVzdHIgPT09ICJ0b2RheSIpIHsKICAgICAgICAgICAgcGFyc2VkRGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgIHRpbWVsZXNzID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAoL1okLy50ZXN0KGRhdGVzdHIpIHx8IC9HTVQkLy50ZXN0KGRhdGVzdHIpKSBwYXJzZWREYXRlID0gbmV3IERhdGUoZGF0ZSk7ZWxzZSBpZiAoY29uZmlnICYmIGNvbmZpZy5wYXJzZURhdGUpIHBhcnNlZERhdGUgPSBjb25maWcucGFyc2VEYXRlKGRhdGUsIGZvcm1hdCk7ZWxzZSB7CiAgICAgICAgICAgIHBhcnNlZERhdGUgPSAhY29uZmlnIHx8ICFjb25maWcubm9DYWxlbmRhciA/IG5ldyBEYXRlKG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSwgMCwgMSwgMCwgMCwgMCwgMCkgOiBuZXcgRGF0ZShuZXcgRGF0ZSgpLnNldEhvdXJzKDAsIDAsIDAsIDApKTsKICAgICAgICAgICAgdmFyIG1hdGNoZWQsCiAgICAgICAgICAgICAgICBvcHMgPSBbXTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBtYXRjaEluZGV4ID0gMCwgcmVnZXhTdHIgPSAiIjsgaSA8IGZvcm1hdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIHZhciB0b2tlbiA9IGZvcm1hdFtpXTsKICAgICAgICAgICAgICB2YXIgaXNCYWNrU2xhc2ggPSB0b2tlbiA9PT0gIlxcIjsKICAgICAgICAgICAgICB2YXIgZXNjYXBlZCA9IGZvcm1hdFtpIC0gMV0gPT09ICJcXCIgfHwgaXNCYWNrU2xhc2g7CgogICAgICAgICAgICAgIGlmICh0b2tlblJlZ2V4W3Rva2VuXSAmJiAhZXNjYXBlZCkgewogICAgICAgICAgICAgICAgcmVnZXhTdHIgKz0gdG9rZW5SZWdleFt0b2tlbl07CiAgICAgICAgICAgICAgICB2YXIgbWF0Y2ggPSBuZXcgUmVnRXhwKHJlZ2V4U3RyKS5leGVjKGRhdGUpOwoKICAgICAgICAgICAgICAgIGlmIChtYXRjaCAmJiAobWF0Y2hlZCA9IHRydWUpKSB7CiAgICAgICAgICAgICAgICAgIG9wc1t0b2tlbiAhPT0gIlkiID8gInB1c2giIDogInVuc2hpZnQiXSh7CiAgICAgICAgICAgICAgICAgICAgZm46IHJldkZvcm1hdFt0b2tlbl0sCiAgICAgICAgICAgICAgICAgICAgdmFsOiBtYXRjaFsrK21hdGNoSW5kZXhdCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzQmFja1NsYXNoKSByZWdleFN0ciArPSAiLiI7CgogICAgICAgICAgICAgIG9wcy5mb3JFYWNoKGZ1bmN0aW9uIChfcmVmMykgewogICAgICAgICAgICAgICAgdmFyIGZuID0gX3JlZjMuZm4sCiAgICAgICAgICAgICAgICAgICAgdmFsID0gX3JlZjMudmFsOwogICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlZERhdGUgPSBmbihwYXJzZWREYXRlLCB2YWwsIGwxMG4pIHx8IHBhcnNlZERhdGU7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBhcnNlZERhdGUgPSBtYXRjaGVkID8gcGFyc2VkRGF0ZSA6IHVuZGVmaW5lZDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghKHBhcnNlZERhdGUgaW5zdGFuY2VvZiBEYXRlICYmICFpc05hTihwYXJzZWREYXRlLmdldFRpbWUoKSkpKSB7CiAgICAgICAgICBjb25maWcuZXJyb3JIYW5kbGVyKG5ldyBFcnJvcigiSW52YWxpZCBkYXRlIHByb3ZpZGVkOiAiICsgZGF0ZV9vcmlnKSk7CiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRpbWVsZXNzID09PSB0cnVlKSBwYXJzZWREYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApOwogICAgICAgIHJldHVybiBwYXJzZWREYXRlOwogICAgICB9OwogICAgfTsKICAgIGZ1bmN0aW9uIGNvbXBhcmVEYXRlcyhkYXRlMSwgZGF0ZTIsIHRpbWVsZXNzKSB7CiAgICAgIGlmICh0aW1lbGVzcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGltZWxlc3MgPSB0cnVlOwogICAgICB9CgogICAgICBpZiAodGltZWxlc3MgIT09IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUxLmdldFRpbWUoKSkuc2V0SG91cnMoMCwgMCwgMCwgMCkgLSBuZXcgRGF0ZShkYXRlMi5nZXRUaW1lKCkpLnNldEhvdXJzKDAsIDAsIDAsIDApOwogICAgICB9CgogICAgICByZXR1cm4gZGF0ZTEuZ2V0VGltZSgpIC0gZGF0ZTIuZ2V0VGltZSgpOwogICAgfQogICAgdmFyIGdldFdlZWsgPSBmdW5jdGlvbiBnZXRXZWVrKGdpdmVuRGF0ZSkgewogICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGdpdmVuRGF0ZS5nZXRUaW1lKCkpOwogICAgICBkYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApOwogICAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyAzIC0gKGRhdGUuZ2V0RGF5KCkgKyA2KSAlIDcpOwogICAgICB2YXIgd2VlazEgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIDAsIDQpOwogICAgICByZXR1cm4gMSArIE1hdGgucm91bmQoKChkYXRlLmdldFRpbWUoKSAtIHdlZWsxLmdldFRpbWUoKSkgLyA4NjQwMDAwMCAtIDMgKyAod2VlazEuZ2V0RGF5KCkgKyA2KSAlIDcpIC8gNyk7CiAgICB9OwogICAgdmFyIGlzQmV0d2VlbiA9IGZ1bmN0aW9uIGlzQmV0d2Vlbih0cywgdHMxLCB0czIpIHsKICAgICAgcmV0dXJuIHRzID4gTWF0aC5taW4odHMxLCB0czIpICYmIHRzIDwgTWF0aC5tYXgodHMxLCB0czIpOwogICAgfTsKICAgIHZhciBkdXJhdGlvbiA9IHsKICAgICAgREFZOiA4NjQwMDAwMAogICAgfTsKCiAgICB2YXIgZGVmYXVsdHMgPSB7CiAgICAgIF9kaXNhYmxlOiBbXSwKICAgICAgX2VuYWJsZTogW10sCiAgICAgIGFsbG93SW5wdXQ6IGZhbHNlLAogICAgICBhbHRGb3JtYXQ6ICJGIGosIFkiLAogICAgICBhbHRJbnB1dDogZmFsc2UsCiAgICAgIGFsdElucHV0Q2xhc3M6ICJmb3JtLWNvbnRyb2wgaW5wdXQiLAogICAgICBhbmltYXRlOiB0eXBlb2Ygd2luZG93ID09PSAib2JqZWN0IiAmJiB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIikgPT09IC0xLAogICAgICBhcmlhRGF0ZUZvcm1hdDogIkYgaiwgWSIsCiAgICAgIGNsaWNrT3BlbnM6IHRydWUsCiAgICAgIGNsb3NlT25TZWxlY3Q6IHRydWUsCiAgICAgIGNvbmp1bmN0aW9uOiAiLCAiLAogICAgICBkYXRlRm9ybWF0OiAiWS1tLWQiLAogICAgICBkZWZhdWx0SG91cjogMTIsCiAgICAgIGRlZmF1bHRNaW51dGU6IDAsCiAgICAgIGRlZmF1bHRTZWNvbmRzOiAwLAogICAgICBkaXNhYmxlOiBbXSwKICAgICAgZGlzYWJsZU1vYmlsZTogZmFsc2UsCiAgICAgIGVuYWJsZTogW10sCiAgICAgIGVuYWJsZVNlY29uZHM6IGZhbHNlLAogICAgICBlbmFibGVUaW1lOiBmYWxzZSwKICAgICAgZXJyb3JIYW5kbGVyOiBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZXJyKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiBjb25zb2xlICE9PSAidW5kZWZpbmVkIiAmJiBjb25zb2xlLndhcm4oZXJyKTsKICAgICAgfSwKICAgICAgZ2V0V2VlazogZ2V0V2VlaywKICAgICAgaG91ckluY3JlbWVudDogMSwKICAgICAgaWdub3JlZEZvY3VzRWxlbWVudHM6IFtdLAogICAgICBpbmxpbmU6IGZhbHNlLAogICAgICBsb2NhbGU6ICJkZWZhdWx0IiwKICAgICAgbWludXRlSW5jcmVtZW50OiA1LAogICAgICBtb2RlOiAic2luZ2xlIiwKICAgICAgbmV4dEFycm93OiAiPHN2ZyB2ZXJzaW9uPScxLjEnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycgeG1sbnM6eGxpbms9J2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnIHZpZXdCb3g9JzAgMCAxNyAxNyc+PGc+PC9nPjxwYXRoIGQ9J00xMy4yMDcgOC40NzJsLTcuODU0IDcuODU0LTAuNzA3LTAuNzA3IDcuMTQ2LTcuMTQ2LTcuMTQ2LTcuMTQ4IDAuNzA3LTAuNzA3IDcuODU0IDcuODU0eicgLz48L3N2Zz4iLAogICAgICBub0NhbGVuZGFyOiBmYWxzZSwKICAgICAgbm93OiBuZXcgRGF0ZSgpLAogICAgICBvbkNoYW5nZTogW10sCiAgICAgIG9uQ2xvc2U6IFtdLAogICAgICBvbkRheUNyZWF0ZTogW10sCiAgICAgIG9uRGVzdHJveTogW10sCiAgICAgIG9uS2V5RG93bjogW10sCiAgICAgIG9uTW9udGhDaGFuZ2U6IFtdLAogICAgICBvbk9wZW46IFtdLAogICAgICBvblBhcnNlQ29uZmlnOiBbXSwKICAgICAgb25SZWFkeTogW10sCiAgICAgIG9uVmFsdWVVcGRhdGU6IFtdLAogICAgICBvblllYXJDaGFuZ2U6IFtdLAogICAgICBvblByZUNhbGVuZGFyUG9zaXRpb246IFtdLAogICAgICBwbHVnaW5zOiBbXSwKICAgICAgcG9zaXRpb246ICJhdXRvIiwKICAgICAgcG9zaXRpb25FbGVtZW50OiB1bmRlZmluZWQsCiAgICAgIHByZXZBcnJvdzogIjxzdmcgdmVyc2lvbj0nMS4xJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHhtbG5zOnhsaW5rPSdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJyB2aWV3Qm94PScwIDAgMTcgMTcnPjxnPjwvZz48cGF0aCBkPSdNNS4yMDcgOC40NzFsNy4xNDYgNy4xNDctMC43MDcgMC43MDctNy44NTMtNy44NTQgNy44NTQtNy44NTMgMC43MDcgMC43MDctNy4xNDcgNy4xNDZ6JyAvPjwvc3ZnPiIsCiAgICAgIHNob3J0aGFuZEN1cnJlbnRNb250aDogZmFsc2UsCiAgICAgIHNob3dNb250aHM6IDEsCiAgICAgIHN0YXRpYzogZmFsc2UsCiAgICAgIHRpbWVfMjRocjogZmFsc2UsCiAgICAgIHdlZWtOdW1iZXJzOiBmYWxzZSwKICAgICAgd3JhcDogZmFsc2UKICAgIH07CgogICAgZnVuY3Rpb24gdG9nZ2xlQ2xhc3MoZWxlbSwgY2xhc3NOYW1lLCBib29sKSB7CiAgICAgIGlmIChib29sID09PSB0cnVlKSByZXR1cm4gZWxlbS5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7CiAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpOwogICAgfQogICAgZnVuY3Rpb24gY3JlYXRlRWxlbWVudCh0YWcsIGNsYXNzTmFtZSwgY29udGVudCkgewogICAgICB2YXIgZSA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7CiAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZSB8fCAiIjsKICAgICAgY29udGVudCA9IGNvbnRlbnQgfHwgIiI7CiAgICAgIGUuY2xhc3NOYW1lID0gY2xhc3NOYW1lOwogICAgICBpZiAoY29udGVudCAhPT0gdW5kZWZpbmVkKSBlLnRleHRDb250ZW50ID0gY29udGVudDsKICAgICAgcmV0dXJuIGU7CiAgICB9CiAgICBmdW5jdGlvbiBjbGVhck5vZGUobm9kZSkgewogICAgICB3aGlsZSAobm9kZS5maXJzdENoaWxkKSB7CiAgICAgICAgbm9kZS5yZW1vdmVDaGlsZChub2RlLmZpcnN0Q2hpbGQpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBmaW5kUGFyZW50KG5vZGUsIGNvbmRpdGlvbikgewogICAgICBpZiAoY29uZGl0aW9uKG5vZGUpKSByZXR1cm4gbm9kZTtlbHNlIGlmIChub2RlLnBhcmVudE5vZGUpIHJldHVybiBmaW5kUGFyZW50KG5vZGUucGFyZW50Tm9kZSwgY29uZGl0aW9uKTsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGZ1bmN0aW9uIGNyZWF0ZU51bWJlcklucHV0KGlucHV0Q2xhc3NOYW1lLCBvcHRzKSB7CiAgICAgIHZhciB3cmFwcGVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgIm51bUlucHV0V3JhcHBlciIpLAogICAgICAgICAgbnVtSW5wdXQgPSBjcmVhdGVFbGVtZW50KCJpbnB1dCIsICJudW1JbnB1dCAiICsgaW5wdXRDbGFzc05hbWUpLAogICAgICAgICAgYXJyb3dVcCA9IGNyZWF0ZUVsZW1lbnQoInNwYW4iLCAiYXJyb3dVcCIpLAogICAgICAgICAgYXJyb3dEb3duID0gY3JlYXRlRWxlbWVudCgic3BhbiIsICJhcnJvd0Rvd24iKTsKICAgICAgbnVtSW5wdXQudHlwZSA9ICJ0ZXh0IjsKICAgICAgbnVtSW5wdXQucGF0dGVybiA9ICJcXGQqIjsKICAgICAgaWYgKG9wdHMgIT09IHVuZGVmaW5lZCkgZm9yICh2YXIga2V5IGluIG9wdHMpIHsKICAgICAgICBudW1JbnB1dC5zZXRBdHRyaWJ1dGUoa2V5LCBvcHRzW2tleV0pOwogICAgICB9CiAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQobnVtSW5wdXQpOwogICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKGFycm93VXApOwogICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKGFycm93RG93bik7CiAgICAgIHJldHVybiB3cmFwcGVyOwogICAgfQoKICAgIGlmICh0eXBlb2YgT2JqZWN0LmFzc2lnbiAhPT0gImZ1bmN0aW9uIikgewogICAgICBPYmplY3QuYXNzaWduID0gZnVuY3Rpb24gKHRhcmdldCkgewogICAgICAgIGlmICghdGFyZ2V0KSB7CiAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCBjb252ZXJ0IHVuZGVmaW5lZCBvciBudWxsIHRvIG9iamVjdCIpOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiA+IDEgPyBfbGVuIC0gMSA6IDApLCBfa2V5ID0gMTsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICAgICAgYXJnc1tfa2V5IC0gMV0gPSBhcmd1bWVudHNbX2tleV07CiAgICAgICAgfQoKICAgICAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcCgpIHsKICAgICAgICAgIHZhciBzb3VyY2UgPSBhcmdzW19pXTsKCiAgICAgICAgICBpZiAoc291cmNlKSB7CiAgICAgICAgICAgIE9iamVjdC5rZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmdzLmxlbmd0aDsgX2krKykgewogICAgICAgICAgX2xvb3AoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgIH07CiAgICB9CgogICAgdmFyIERFQk9VTkNFRF9DSEFOR0VfTVMgPSAzMDA7CgogICAgZnVuY3Rpb24gRmxhdHBpY2tySW5zdGFuY2UoZWxlbWVudCwgaW5zdGFuY2VDb25maWcpIHsKICAgICAgdmFyIHNlbGYgPSB7CiAgICAgICAgY29uZmlnOiBPYmplY3QuYXNzaWduKHt9LCBmbGF0cGlja3IuZGVmYXVsdENvbmZpZyksCiAgICAgICAgbDEwbjogZW5nbGlzaAogICAgICB9OwogICAgICBzZWxmLnBhcnNlRGF0ZSA9IGNyZWF0ZURhdGVQYXJzZXIoewogICAgICAgIGNvbmZpZzogc2VsZi5jb25maWcsCiAgICAgICAgbDEwbjogc2VsZi5sMTBuCiAgICAgIH0pOwogICAgICBzZWxmLl9oYW5kbGVycyA9IFtdOwogICAgICBzZWxmLl9iaW5kID0gYmluZDsKICAgICAgc2VsZi5fc2V0SG91cnNGcm9tRGF0ZSA9IHNldEhvdXJzRnJvbURhdGU7CiAgICAgIHNlbGYuX3Bvc2l0aW9uQ2FsZW5kYXIgPSBwb3NpdGlvbkNhbGVuZGFyOwogICAgICBzZWxmLmNoYW5nZU1vbnRoID0gY2hhbmdlTW9udGg7CiAgICAgIHNlbGYuY2hhbmdlWWVhciA9IGNoYW5nZVllYXI7CiAgICAgIHNlbGYuY2xlYXIgPSBjbGVhcjsKICAgICAgc2VsZi5jbG9zZSA9IGNsb3NlOwogICAgICBzZWxmLl9jcmVhdGVFbGVtZW50ID0gY3JlYXRlRWxlbWVudDsKICAgICAgc2VsZi5kZXN0cm95ID0gZGVzdHJveTsKICAgICAgc2VsZi5pc0VuYWJsZWQgPSBpc0VuYWJsZWQ7CiAgICAgIHNlbGYuanVtcFRvRGF0ZSA9IGp1bXBUb0RhdGU7CiAgICAgIHNlbGYub3BlbiA9IG9wZW47CiAgICAgIHNlbGYucmVkcmF3ID0gcmVkcmF3OwogICAgICBzZWxmLnNldCA9IHNldDsKICAgICAgc2VsZi5zZXREYXRlID0gc2V0RGF0ZTsKICAgICAgc2VsZi50b2dnbGUgPSB0b2dnbGU7CgogICAgICBmdW5jdGlvbiBzZXR1cEhlbHBlckZ1bmN0aW9ucygpIHsKICAgICAgICBzZWxmLnV0aWxzID0gewogICAgICAgICAgZ2V0RGF5c0luTW9udGg6IGZ1bmN0aW9uIGdldERheXNJbk1vbnRoKG1vbnRoLCB5cikgewogICAgICAgICAgICBpZiAobW9udGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIG1vbnRoID0gc2VsZi5jdXJyZW50TW9udGg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh5ciA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgeXIgPSBzZWxmLmN1cnJlbnRZZWFyOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobW9udGggPT09IDEgJiYgKHlyICUgNCA9PT0gMCAmJiB5ciAlIDEwMCAhPT0gMCB8fCB5ciAlIDQwMCA9PT0gMCkpIHJldHVybiAyOTsKICAgICAgICAgICAgcmV0dXJuIHNlbGYubDEwbi5kYXlzSW5Nb250aFttb250aF07CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICBzZWxmLmVsZW1lbnQgPSBzZWxmLmlucHV0ID0gZWxlbWVudDsKICAgICAgICBzZWxmLmlzT3BlbiA9IGZhbHNlOwogICAgICAgIHBhcnNlQ29uZmlnKCk7CiAgICAgICAgc2V0dXBMb2NhbGUoKTsKICAgICAgICBzZXR1cElucHV0cygpOwogICAgICAgIHNldHVwRGF0ZXMoKTsKICAgICAgICBzZXR1cEhlbHBlckZ1bmN0aW9ucygpOwogICAgICAgIGlmICghc2VsZi5pc01vYmlsZSkgYnVpbGQoKTsKICAgICAgICBiaW5kRXZlbnRzKCk7CgogICAgICAgIGlmIChzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoIHx8IHNlbGYuY29uZmlnLm5vQ2FsZW5kYXIpIHsKICAgICAgICAgIGlmIChzZWxmLmNvbmZpZy5lbmFibGVUaW1lKSB7CiAgICAgICAgICAgIHNldEhvdXJzRnJvbURhdGUoc2VsZi5jb25maWcubm9DYWxlbmRhciA/IHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqIHx8IHNlbGYuY29uZmlnLm1pbkRhdGUgOiB1bmRlZmluZWQpOwogICAgICAgICAgfQoKICAgICAgICAgIHVwZGF0ZVZhbHVlKGZhbHNlKTsKICAgICAgICB9CgogICAgICAgIHNldENhbGVuZGFyV2lkdGgoKTsKICAgICAgICBzZWxmLnNob3dUaW1lSW5wdXQgPSBzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID4gMCB8fCBzZWxmLmNvbmZpZy5ub0NhbGVuZGFyOwogICAgICAgIHZhciBpc1NhZmFyaSA9IC9eKCg/IWNocm9tZXxhbmRyb2lkKS4pKnNhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7CgogICAgICAgIGlmICghc2VsZi5pc01vYmlsZSAmJiBpc1NhZmFyaSkgewogICAgICAgICAgcG9zaXRpb25DYWxlbmRhcigpOwogICAgICAgIH0KCiAgICAgICAgdHJpZ2dlckV2ZW50KCJvblJlYWR5Iik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGJpbmRUb0luc3RhbmNlKGZuKSB7CiAgICAgICAgcmV0dXJuIGZuLmJpbmQoc2VsZik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHNldENhbGVuZGFyV2lkdGgoKSB7CiAgICAgICAgdmFyIGNvbmZpZyA9IHNlbGYuY29uZmlnOwogICAgICAgIGlmIChjb25maWcud2Vla051bWJlcnMgPT09IGZhbHNlICYmIGNvbmZpZy5zaG93TW9udGhzID09PSAxKSByZXR1cm47ZWxzZSBpZiAoY29uZmlnLm5vQ2FsZW5kYXIgIT09IHRydWUpIHsKICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKICAgICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCiAgICAgICAgICAgIGlmIChzZWxmLmRheXNDb250YWluZXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHZhciBkYXlzV2lkdGggPSAoc2VsZi5kYXlzLm9mZnNldFdpZHRoICsgMSkgKiBjb25maWcuc2hvd01vbnRoczsKICAgICAgICAgICAgICBzZWxmLmRheXNDb250YWluZXIuc3R5bGUud2lkdGggPSBkYXlzV2lkdGggKyAicHgiOwogICAgICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuc3R5bGUud2lkdGggPSBkYXlzV2lkdGggKyAoc2VsZi53ZWVrV3JhcHBlciAhPT0gdW5kZWZpbmVkID8gc2VsZi53ZWVrV3JhcHBlci5vZmZzZXRXaWR0aCA6IDApICsgInB4IjsKICAgICAgICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnN0eWxlLnJlbW92ZVByb3BlcnR5KCJ2aXNpYmlsaXR5Iik7CiAgICAgICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgiZGlzcGxheSIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZVRpbWUoZSkgewogICAgICAgIGlmIChzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICAgICAgaWYgKGUgIT09IHVuZGVmaW5lZCAmJiBlLnR5cGUgIT09ICJibHVyIikgdGltZVdyYXBwZXIoZSk7CiAgICAgICAgc2V0SG91cnNGcm9tSW5wdXRzKCk7CiAgICAgICAgdXBkYXRlVmFsdWUoKTsKCiAgICAgICAgc2VsZi5fZGVib3VuY2VkQ2hhbmdlKCk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGFtcG0ybWlsaXRhcnkoaG91ciwgYW1QTSkgewogICAgICAgIHJldHVybiBob3VyICUgMTIgKyAxMiAqIGludChhbVBNID09PSBzZWxmLmwxMG4uYW1QTVsxXSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG1pbGl0YXJ5MmFtcG0oaG91cikgewogICAgICAgIHN3aXRjaCAoaG91ciAlIDI0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICByZXR1cm4gMTI7CgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuIGhvdXIgJSAxMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHNldEhvdXJzRnJvbUlucHV0cygpIHsKICAgICAgICBpZiAoc2VsZi5ob3VyRWxlbWVudCA9PT0gdW5kZWZpbmVkIHx8IHNlbGYubWludXRlRWxlbWVudCA9PT0gdW5kZWZpbmVkKSByZXR1cm47CiAgICAgICAgdmFyIGhvdXJzID0gKHBhcnNlSW50KHNlbGYuaG91ckVsZW1lbnQudmFsdWUuc2xpY2UoLTIpLCAxMCkgfHwgMCkgJSAyNCwKICAgICAgICAgICAgbWludXRlcyA9IChwYXJzZUludChzZWxmLm1pbnV0ZUVsZW1lbnQudmFsdWUsIDEwKSB8fCAwKSAlIDYwLAogICAgICAgICAgICBzZWNvbmRzID0gc2VsZi5zZWNvbmRFbGVtZW50ICE9PSB1bmRlZmluZWQgPyAocGFyc2VJbnQoc2VsZi5zZWNvbmRFbGVtZW50LnZhbHVlLCAxMCkgfHwgMCkgJSA2MCA6IDA7CgogICAgICAgIGlmIChzZWxmLmFtUE0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaG91cnMgPSBhbXBtMm1pbGl0YXJ5KGhvdXJzLCBzZWxmLmFtUE0udGV4dENvbnRlbnQpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGxpbWl0TWluSG91cnMgPSBzZWxmLmNvbmZpZy5taW5UaW1lICE9PSB1bmRlZmluZWQgfHwgc2VsZi5jb25maWcubWluRGF0ZSAmJiBzZWxmLm1pbkRhdGVIYXNUaW1lICYmIHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqICYmIGNvbXBhcmVEYXRlcyhzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiwgc2VsZi5jb25maWcubWluRGF0ZSwgdHJ1ZSkgPT09IDA7CiAgICAgICAgdmFyIGxpbWl0TWF4SG91cnMgPSBzZWxmLmNvbmZpZy5tYXhUaW1lICE9PSB1bmRlZmluZWQgfHwgc2VsZi5jb25maWcubWF4RGF0ZSAmJiBzZWxmLm1heERhdGVIYXNUaW1lICYmIHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqICYmIGNvbXBhcmVEYXRlcyhzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiwgc2VsZi5jb25maWcubWF4RGF0ZSwgdHJ1ZSkgPT09IDA7CgogICAgICAgIGlmIChsaW1pdE1heEhvdXJzKSB7CiAgICAgICAgICB2YXIgbWF4VGltZSA9IHNlbGYuY29uZmlnLm1heFRpbWUgIT09IHVuZGVmaW5lZCA/IHNlbGYuY29uZmlnLm1heFRpbWUgOiBzZWxmLmNvbmZpZy5tYXhEYXRlOwogICAgICAgICAgaG91cnMgPSBNYXRoLm1pbihob3VycywgbWF4VGltZS5nZXRIb3VycygpKTsKICAgICAgICAgIGlmIChob3VycyA9PT0gbWF4VGltZS5nZXRIb3VycygpKSBtaW51dGVzID0gTWF0aC5taW4obWludXRlcywgbWF4VGltZS5nZXRNaW51dGVzKCkpOwogICAgICAgICAgaWYgKG1pbnV0ZXMgPT09IG1heFRpbWUuZ2V0TWludXRlcygpKSBzZWNvbmRzID0gTWF0aC5taW4oc2Vjb25kcywgbWF4VGltZS5nZXRTZWNvbmRzKCkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGxpbWl0TWluSG91cnMpIHsKICAgICAgICAgIHZhciBtaW5UaW1lID0gc2VsZi5jb25maWcubWluVGltZSAhPT0gdW5kZWZpbmVkID8gc2VsZi5jb25maWcubWluVGltZSA6IHNlbGYuY29uZmlnLm1pbkRhdGU7CiAgICAgICAgICBob3VycyA9IE1hdGgubWF4KGhvdXJzLCBtaW5UaW1lLmdldEhvdXJzKCkpOwogICAgICAgICAgaWYgKGhvdXJzID09PSBtaW5UaW1lLmdldEhvdXJzKCkpIG1pbnV0ZXMgPSBNYXRoLm1heChtaW51dGVzLCBtaW5UaW1lLmdldE1pbnV0ZXMoKSk7CiAgICAgICAgICBpZiAobWludXRlcyA9PT0gbWluVGltZS5nZXRNaW51dGVzKCkpIHNlY29uZHMgPSBNYXRoLm1heChzZWNvbmRzLCBtaW5UaW1lLmdldFNlY29uZHMoKSk7CiAgICAgICAgfQoKICAgICAgICBzZXRIb3Vycyhob3VycywgbWludXRlcywgc2Vjb25kcyk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHNldEhvdXJzRnJvbURhdGUoZGF0ZU9iaikgewogICAgICAgIHZhciBkYXRlID0gZGF0ZU9iaiB8fCBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iajsKICAgICAgICBpZiAoZGF0ZSkgc2V0SG91cnMoZGF0ZS5nZXRIb3VycygpLCBkYXRlLmdldE1pbnV0ZXMoKSwgZGF0ZS5nZXRTZWNvbmRzKCkpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzZXREZWZhdWx0SG91cnMoKSB7CiAgICAgICAgdmFyIGhvdXJzID0gc2VsZi5jb25maWcuZGVmYXVsdEhvdXI7CiAgICAgICAgdmFyIG1pbnV0ZXMgPSBzZWxmLmNvbmZpZy5kZWZhdWx0TWludXRlOwogICAgICAgIHZhciBzZWNvbmRzID0gc2VsZi5jb25maWcuZGVmYXVsdFNlY29uZHM7CgogICAgICAgIGlmIChzZWxmLmNvbmZpZy5taW5EYXRlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBtaW5faHIgPSBzZWxmLmNvbmZpZy5taW5EYXRlLmdldEhvdXJzKCk7CiAgICAgICAgICB2YXIgbWluX21pbnV0ZXMgPSBzZWxmLmNvbmZpZy5taW5EYXRlLmdldE1pbnV0ZXMoKTsKICAgICAgICAgIGhvdXJzID0gTWF0aC5tYXgoaG91cnMsIG1pbl9ocik7CiAgICAgICAgICBpZiAoaG91cnMgPT09IG1pbl9ocikgbWludXRlcyA9IE1hdGgubWF4KG1pbl9taW51dGVzLCBtaW51dGVzKTsKICAgICAgICAgIGlmIChob3VycyA9PT0gbWluX2hyICYmIG1pbnV0ZXMgPT09IG1pbl9taW51dGVzKSBzZWNvbmRzID0gc2VsZi5jb25maWcubWluRGF0ZS5nZXRTZWNvbmRzKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5jb25maWcubWF4RGF0ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB2YXIgbWF4X2hyID0gc2VsZi5jb25maWcubWF4RGF0ZS5nZXRIb3VycygpOwogICAgICAgICAgdmFyIG1heF9taW51dGVzID0gc2VsZi5jb25maWcubWF4RGF0ZS5nZXRNaW51dGVzKCk7CiAgICAgICAgICBob3VycyA9IE1hdGgubWluKGhvdXJzLCBtYXhfaHIpOwogICAgICAgICAgaWYgKGhvdXJzID09PSBtYXhfaHIpIG1pbnV0ZXMgPSBNYXRoLm1pbihtYXhfbWludXRlcywgbWludXRlcyk7CiAgICAgICAgICBpZiAoaG91cnMgPT09IG1heF9ociAmJiBtaW51dGVzID09PSBtYXhfbWludXRlcykgc2Vjb25kcyA9IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0U2Vjb25kcygpOwogICAgICAgIH0KCiAgICAgICAgc2V0SG91cnMoaG91cnMsIG1pbnV0ZXMsIHNlY29uZHMpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzZXRIb3Vycyhob3VycywgbWludXRlcywgc2Vjb25kcykgewogICAgICAgIGlmIChzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iai5zZXRIb3Vycyhob3VycyAlIDI0LCBtaW51dGVzLCBzZWNvbmRzIHx8IDAsIDApOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzZWxmLmhvdXJFbGVtZW50IHx8ICFzZWxmLm1pbnV0ZUVsZW1lbnQgfHwgc2VsZi5pc01vYmlsZSkgcmV0dXJuOwogICAgICAgIHNlbGYuaG91ckVsZW1lbnQudmFsdWUgPSBwYWQoIXNlbGYuY29uZmlnLnRpbWVfMjRociA/ICgxMiArIGhvdXJzKSAlIDEyICsgMTIgKiBpbnQoaG91cnMgJSAxMiA9PT0gMCkgOiBob3Vycyk7CiAgICAgICAgc2VsZi5taW51dGVFbGVtZW50LnZhbHVlID0gcGFkKG1pbnV0ZXMpOwogICAgICAgIGlmIChzZWxmLmFtUE0gIT09IHVuZGVmaW5lZCkgc2VsZi5hbVBNLnRleHRDb250ZW50ID0gc2VsZi5sMTBuLmFtUE1baW50KGhvdXJzID49IDEyKV07CiAgICAgICAgaWYgKHNlbGYuc2Vjb25kRWxlbWVudCAhPT0gdW5kZWZpbmVkKSBzZWxmLnNlY29uZEVsZW1lbnQudmFsdWUgPSBwYWQoc2Vjb25kcyk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG9uWWVhcklucHV0KGV2ZW50KSB7CiAgICAgICAgdmFyIHllYXIgPSBwYXJzZUludChldmVudC50YXJnZXQudmFsdWUpICsgKGV2ZW50LmRlbHRhIHx8IDApOwoKICAgICAgICBpZiAoeWVhciAvIDEwMDAgPiAxIHx8IGV2ZW50LmtleSA9PT0gIkVudGVyIiAmJiAhL1teXGRdLy50ZXN0KHllYXIudG9TdHJpbmcoKSkpIHsKICAgICAgICAgIGNoYW5nZVllYXIoeWVhcik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBiaW5kKGVsZW1lbnQsIGV2ZW50LCBoYW5kbGVyLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgQXJyYXkpIHJldHVybiBldmVudC5mb3JFYWNoKGZ1bmN0aW9uIChldikgewogICAgICAgICAgcmV0dXJuIGJpbmQoZWxlbWVudCwgZXYsIGhhbmRsZXIsIG9wdGlvbnMpOwogICAgICAgIH0pOwogICAgICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgQXJyYXkpIHJldHVybiBlbGVtZW50LmZvckVhY2goZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICByZXR1cm4gYmluZChlbCwgZXZlbnQsIGhhbmRsZXIsIG9wdGlvbnMpOwogICAgICAgIH0pOwogICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgaGFuZGxlciwgb3B0aW9ucyk7CgogICAgICAgIHNlbGYuX2hhbmRsZXJzLnB1c2goewogICAgICAgICAgZWxlbWVudDogZWxlbWVudCwKICAgICAgICAgIGV2ZW50OiBldmVudCwKICAgICAgICAgIGhhbmRsZXI6IGhhbmRsZXIsCiAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG9uQ2xpY2soaGFuZGxlcikgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICBldnQud2hpY2ggPT09IDEgJiYgaGFuZGxlcihldnQpOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHRyaWdnZXJDaGFuZ2UoKSB7CiAgICAgICAgdHJpZ2dlckV2ZW50KCJvbkNoYW5nZSIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBiaW5kRXZlbnRzKCkgewogICAgICAgIGlmIChzZWxmLmNvbmZpZy53cmFwKSB7CiAgICAgICAgICBbIm9wZW4iLCAiY2xvc2UiLCAidG9nZ2xlIiwgImNsZWFyIl0uZm9yRWFjaChmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoc2VsZi5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLSIgKyBldnQgKyAiXSIpLCBmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgICByZXR1cm4gYmluZChlbCwgImNsaWNrIiwgc2VsZltldnRdKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChzZWxmLmlzTW9iaWxlKSB7CiAgICAgICAgICBzZXR1cE1vYmlsZSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRlYm91bmNlZFJlc2l6ZSA9IGRlYm91bmNlKG9uUmVzaXplLCA1MCk7CiAgICAgICAgc2VsZi5fZGVib3VuY2VkQ2hhbmdlID0gZGVib3VuY2UodHJpZ2dlckNoYW5nZSwgREVCT1VOQ0VEX0NIQU5HRV9NUyk7CiAgICAgICAgaWYgKHNlbGYuZGF5c0NvbnRhaW5lciAmJiAhL2lQaG9uZXxpUGFkfGlQb2QvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSBiaW5kKHNlbGYuZGF5c0NvbnRhaW5lciwgIm1vdXNlb3ZlciIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIikgb25Nb3VzZU92ZXIoZS50YXJnZXQpOwogICAgICAgIH0pOwogICAgICAgIGJpbmQod2luZG93LmRvY3VtZW50LmJvZHksICJrZXlkb3duIiwgb25LZXlEb3duKTsKICAgICAgICBpZiAoIXNlbGYuY29uZmlnLnN0YXRpYykgYmluZChzZWxmLl9pbnB1dCwgImtleWRvd24iLCBvbktleURvd24pOwogICAgICAgIGlmICghc2VsZi5jb25maWcuaW5saW5lICYmICFzZWxmLmNvbmZpZy5zdGF0aWMpIGJpbmQod2luZG93LCAicmVzaXplIiwgZGVib3VuY2VkUmVzaXplKTsKICAgICAgICBpZiAod2luZG93Lm9udG91Y2hzdGFydCAhPT0gdW5kZWZpbmVkKSBiaW5kKHdpbmRvdy5kb2N1bWVudCwgImNsaWNrIiwgZG9jdW1lbnRDbGljayk7ZWxzZSBiaW5kKHdpbmRvdy5kb2N1bWVudCwgIm1vdXNlZG93biIsIG9uQ2xpY2soZG9jdW1lbnRDbGljaykpOwogICAgICAgIGJpbmQod2luZG93LmRvY3VtZW50LCAiZm9jdXMiLCBkb2N1bWVudENsaWNrLCB7CiAgICAgICAgICBjYXB0dXJlOiB0cnVlCiAgICAgICAgfSk7CgogICAgICAgIGlmIChzZWxmLmNvbmZpZy5jbGlja09wZW5zID09PSB0cnVlKSB7CiAgICAgICAgICBiaW5kKHNlbGYuX2lucHV0LCAiZm9jdXMiLCBzZWxmLm9wZW4pOwogICAgICAgICAgYmluZChzZWxmLl9pbnB1dCwgIm1vdXNlZG93biIsIG9uQ2xpY2soc2VsZi5vcGVuKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5kYXlzQ29udGFpbmVyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGJpbmQoc2VsZi5tb250aE5hdiwgIm1vdXNlZG93biIsIG9uQ2xpY2sob25Nb250aE5hdkNsaWNrKSk7CiAgICAgICAgICBiaW5kKHNlbGYubW9udGhOYXYsIFsia2V5dXAiLCAiaW5jcmVtZW50Il0sIG9uWWVhcklucHV0KTsKICAgICAgICAgIGJpbmQoc2VsZi5kYXlzQ29udGFpbmVyLCAibW91c2Vkb3duIiwgb25DbGljayhzZWxlY3REYXRlKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi50aW1lQ29udGFpbmVyICE9PSB1bmRlZmluZWQgJiYgc2VsZi5taW51dGVFbGVtZW50ICE9PSB1bmRlZmluZWQgJiYgc2VsZi5ob3VyRWxlbWVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB2YXIgc2VsVGV4dCA9IGZ1bmN0aW9uIHNlbFRleHQoZSkgewogICAgICAgICAgICByZXR1cm4gZS50YXJnZXQuc2VsZWN0KCk7CiAgICAgICAgICB9OwoKICAgICAgICAgIGJpbmQoc2VsZi50aW1lQ29udGFpbmVyLCBbImluY3JlbWVudCJdLCB1cGRhdGVUaW1lKTsKICAgICAgICAgIGJpbmQoc2VsZi50aW1lQ29udGFpbmVyLCAiYmx1ciIsIHVwZGF0ZVRpbWUsIHsKICAgICAgICAgICAgY2FwdHVyZTogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgICBiaW5kKHNlbGYudGltZUNvbnRhaW5lciwgIm1vdXNlZG93biIsIG9uQ2xpY2sodGltZUluY3JlbWVudCkpOwogICAgICAgICAgYmluZChbc2VsZi5ob3VyRWxlbWVudCwgc2VsZi5taW51dGVFbGVtZW50XSwgWyJmb2N1cyIsICJjbGljayJdLCBzZWxUZXh0KTsKICAgICAgICAgIGlmIChzZWxmLnNlY29uZEVsZW1lbnQgIT09IHVuZGVmaW5lZCkgYmluZChzZWxmLnNlY29uZEVsZW1lbnQsICJmb2N1cyIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuc2Vjb25kRWxlbWVudCAmJiBzZWxmLnNlY29uZEVsZW1lbnQuc2VsZWN0KCk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoc2VsZi5hbVBNICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgYmluZChzZWxmLmFtUE0sICJtb3VzZWRvd24iLCBvbkNsaWNrKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgdXBkYXRlVGltZShlKTsKICAgICAgICAgICAgICB0cmlnZ2VyQ2hhbmdlKCk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGp1bXBUb0RhdGUoanVtcERhdGUpIHsKICAgICAgICB2YXIganVtcFRvID0ganVtcERhdGUgIT09IHVuZGVmaW5lZCA/IHNlbGYucGFyc2VEYXRlKGp1bXBEYXRlKSA6IHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqIHx8IChzZWxmLmNvbmZpZy5taW5EYXRlICYmIHNlbGYuY29uZmlnLm1pbkRhdGUgPiBzZWxmLm5vdyA/IHNlbGYuY29uZmlnLm1pbkRhdGUgOiBzZWxmLmNvbmZpZy5tYXhEYXRlICYmIHNlbGYuY29uZmlnLm1heERhdGUgPCBzZWxmLm5vdyA/IHNlbGYuY29uZmlnLm1heERhdGUgOiBzZWxmLm5vdyk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoanVtcFRvICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgc2VsZi5jdXJyZW50WWVhciA9IGp1bXBUby5nZXRGdWxsWWVhcigpOwogICAgICAgICAgICBzZWxmLmN1cnJlbnRNb250aCA9IGp1bXBUby5nZXRNb250aCgpOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGUubWVzc2FnZSA9ICJJbnZhbGlkIGRhdGUgc3VwcGxpZWQ6ICIgKyBqdW1wVG87CiAgICAgICAgICBzZWxmLmNvbmZpZy5lcnJvckhhbmRsZXIoZSk7CiAgICAgICAgfQoKICAgICAgICBzZWxmLnJlZHJhdygpOwogICAgICB9CgogICAgICBmdW5jdGlvbiB0aW1lSW5jcmVtZW50KGUpIHsKICAgICAgICBpZiAofmUudGFyZ2V0LmNsYXNzTmFtZS5pbmRleE9mKCJhcnJvdyIpKSBpbmNyZW1lbnROdW1JbnB1dChlLCBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImFycm93VXAiKSA/IDEgOiAtMSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGluY3JlbWVudE51bUlucHV0KGUsIGRlbHRhLCBpbnB1dEVsZW0pIHsKICAgICAgICB2YXIgdGFyZ2V0ID0gZSAmJiBlLnRhcmdldDsKICAgICAgICB2YXIgaW5wdXQgPSBpbnB1dEVsZW0gfHwgdGFyZ2V0ICYmIHRhcmdldC5wYXJlbnROb2RlICYmIHRhcmdldC5wYXJlbnROb2RlLmZpcnN0Q2hpbGQ7CiAgICAgICAgdmFyIGV2ZW50ID0gY3JlYXRlRXZlbnQoImluY3JlbWVudCIpOwogICAgICAgIGV2ZW50LmRlbHRhID0gZGVsdGE7CiAgICAgICAgaW5wdXQgJiYgaW5wdXQuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGJ1aWxkKCkgewogICAgICAgIHZhciBmcmFnbWVudCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CiAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3ItY2FsZW5kYXIiKTsKICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnRhYkluZGV4ID0gLTE7CgogICAgICAgIGlmICghc2VsZi5jb25maWcubm9DYWxlbmRhcikgewogICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoYnVpbGRNb250aE5hdigpKTsKICAgICAgICAgIHNlbGYuaW5uZXJDb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLWlubmVyQ29udGFpbmVyIik7CgogICAgICAgICAgaWYgKHNlbGYuY29uZmlnLndlZWtOdW1iZXJzKSB7CiAgICAgICAgICAgIHZhciBfYnVpbGRXZWVrcyA9IGJ1aWxkV2Vla3MoKSwKICAgICAgICAgICAgICAgIHdlZWtXcmFwcGVyID0gX2J1aWxkV2Vla3Mud2Vla1dyYXBwZXIsCiAgICAgICAgICAgICAgICB3ZWVrTnVtYmVycyA9IF9idWlsZFdlZWtzLndlZWtOdW1iZXJzOwoKICAgICAgICAgICAgc2VsZi5pbm5lckNvbnRhaW5lci5hcHBlbmRDaGlsZCh3ZWVrV3JhcHBlcik7CiAgICAgICAgICAgIHNlbGYud2Vla051bWJlcnMgPSB3ZWVrTnVtYmVyczsKICAgICAgICAgICAgc2VsZi53ZWVrV3JhcHBlciA9IHdlZWtXcmFwcGVyOwogICAgICAgICAgfQoKICAgICAgICAgIHNlbGYuckNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3ItckNvbnRhaW5lciIpOwogICAgICAgICAgc2VsZi5yQ29udGFpbmVyLmFwcGVuZENoaWxkKGJ1aWxkV2Vla2RheXMoKSk7CgogICAgICAgICAgaWYgKCFzZWxmLmRheXNDb250YWluZXIpIHsKICAgICAgICAgICAgc2VsZi5kYXlzQ29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci1kYXlzIik7CiAgICAgICAgICAgIHNlbGYuZGF5c0NvbnRhaW5lci50YWJJbmRleCA9IC0xOwogICAgICAgICAgfQoKICAgICAgICAgIGJ1aWxkRGF5cygpOwogICAgICAgICAgc2VsZi5yQ29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGYuZGF5c0NvbnRhaW5lcik7CiAgICAgICAgICBzZWxmLmlubmVyQ29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGYuckNvbnRhaW5lcik7CiAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChzZWxmLmlubmVyQ29udGFpbmVyKTsKICAgICAgICB9CgogICAgICAgIGlmIChzZWxmLmNvbmZpZy5lbmFibGVUaW1lKSB7CiAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChidWlsZFRpbWUoKSk7CiAgICAgICAgfQoKICAgICAgICB0b2dnbGVDbGFzcyhzZWxmLmNhbGVuZGFyQ29udGFpbmVyLCAicmFuZ2VNb2RlIiwgc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIik7CiAgICAgICAgdG9nZ2xlQ2xhc3Moc2VsZi5jYWxlbmRhckNvbnRhaW5lciwgImFuaW1hdGUiLCBzZWxmLmNvbmZpZy5hbmltYXRlID09PSB0cnVlKTsKICAgICAgICB0b2dnbGVDbGFzcyhzZWxmLmNhbGVuZGFyQ29udGFpbmVyLCAibXVsdGlNb250aCIsIHNlbGYuY29uZmlnLnNob3dNb250aHMgPiAxKTsKICAgICAgICBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLmFwcGVuZENoaWxkKGZyYWdtZW50KTsKICAgICAgICB2YXIgY3VzdG9tQXBwZW5kID0gc2VsZi5jb25maWcuYXBwZW5kVG8gIT09IHVuZGVmaW5lZCAmJiBzZWxmLmNvbmZpZy5hcHBlbmRUby5ub2RlVHlwZSAhPT0gdW5kZWZpbmVkOwoKICAgICAgICBpZiAoc2VsZi5jb25maWcuaW5saW5lIHx8IHNlbGYuY29uZmlnLnN0YXRpYykgewogICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKHNlbGYuY29uZmlnLmlubGluZSA/ICJpbmxpbmUiIDogInN0YXRpYyIpOwoKICAgICAgICAgIGlmIChzZWxmLmNvbmZpZy5pbmxpbmUpIHsKICAgICAgICAgICAgaWYgKCFjdXN0b21BcHBlbmQgJiYgc2VsZi5lbGVtZW50LnBhcmVudE5vZGUpIHNlbGYuZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzZWxmLmNhbGVuZGFyQ29udGFpbmVyLCBzZWxmLl9pbnB1dC5uZXh0U2libGluZyk7ZWxzZSBpZiAoc2VsZi5jb25maWcuYXBwZW5kVG8gIT09IHVuZGVmaW5lZCkgc2VsZi5jb25maWcuYXBwZW5kVG8uYXBwZW5kQ2hpbGQoc2VsZi5jYWxlbmRhckNvbnRhaW5lcik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHNlbGYuY29uZmlnLnN0YXRpYykgewogICAgICAgICAgICB2YXIgd3JhcHBlciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3Itd3JhcHBlciIpOwogICAgICAgICAgICBpZiAoc2VsZi5lbGVtZW50LnBhcmVudE5vZGUpIHNlbGYuZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh3cmFwcGVyLCBzZWxmLmVsZW1lbnQpOwogICAgICAgICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKHNlbGYuZWxlbWVudCk7CiAgICAgICAgICAgIGlmIChzZWxmLmFsdElucHV0KSB3cmFwcGVyLmFwcGVuZENoaWxkKHNlbGYuYWx0SW5wdXQpOwogICAgICAgICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKHNlbGYuY2FsZW5kYXJDb250YWluZXIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCFzZWxmLmNvbmZpZy5zdGF0aWMgJiYgIXNlbGYuY29uZmlnLmlubGluZSkgKHNlbGYuY29uZmlnLmFwcGVuZFRvICE9PSB1bmRlZmluZWQgPyBzZWxmLmNvbmZpZy5hcHBlbmRUbyA6IHdpbmRvdy5kb2N1bWVudC5ib2R5KS5hcHBlbmRDaGlsZChzZWxmLmNhbGVuZGFyQ29udGFpbmVyKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY3JlYXRlRGF5KGNsYXNzTmFtZSwgZGF0ZSwgZGF5TnVtYmVyLCBpKSB7CiAgICAgICAgdmFyIGRhdGVJc0VuYWJsZWQgPSBpc0VuYWJsZWQoZGF0ZSwgdHJ1ZSksCiAgICAgICAgICAgIGRheUVsZW1lbnQgPSBjcmVhdGVFbGVtZW50KCJzcGFuIiwgImZsYXRwaWNrci1kYXkgIiArIGNsYXNzTmFtZSwgZGF0ZS5nZXREYXRlKCkudG9TdHJpbmcoKSk7CiAgICAgICAgZGF5RWxlbWVudC5kYXRlT2JqID0gZGF0ZTsKICAgICAgICBkYXlFbGVtZW50LiRpID0gaTsKICAgICAgICBkYXlFbGVtZW50LnNldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIsIHNlbGYuZm9ybWF0RGF0ZShkYXRlLCBzZWxmLmNvbmZpZy5hcmlhRGF0ZUZvcm1hdCkpOwoKICAgICAgICBpZiAoY2xhc3NOYW1lLmluZGV4T2YoImhpZGRlbiIpID09PSAtMSAmJiBjb21wYXJlRGF0ZXMoZGF0ZSwgc2VsZi5ub3cpID09PSAwKSB7CiAgICAgICAgICBzZWxmLnRvZGF5RGF0ZUVsZW0gPSBkYXlFbGVtZW50OwogICAgICAgICAgZGF5RWxlbWVudC5jbGFzc0xpc3QuYWRkKCJ0b2RheSIpOwogICAgICAgICAgZGF5RWxlbWVudC5zZXRBdHRyaWJ1dGUoImFyaWEtY3VycmVudCIsICJkYXRlIik7CiAgICAgICAgfQoKICAgICAgICBpZiAoZGF0ZUlzRW5hYmxlZCkgewogICAgICAgICAgZGF5RWxlbWVudC50YWJJbmRleCA9IC0xOwoKICAgICAgICAgIGlmIChpc0RhdGVTZWxlY3RlZChkYXRlKSkgewogICAgICAgICAgICBkYXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoInNlbGVjdGVkIik7CiAgICAgICAgICAgIHNlbGYuc2VsZWN0ZWREYXRlRWxlbSA9IGRheUVsZW1lbnQ7CgogICAgICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIikgewogICAgICAgICAgICAgIHRvZ2dsZUNsYXNzKGRheUVsZW1lbnQsICJzdGFydFJhbmdlIiwgc2VsZi5zZWxlY3RlZERhdGVzWzBdICYmIGNvbXBhcmVEYXRlcyhkYXRlLCBzZWxmLnNlbGVjdGVkRGF0ZXNbMF0sIHRydWUpID09PSAwKTsKICAgICAgICAgICAgICB0b2dnbGVDbGFzcyhkYXlFbGVtZW50LCAiZW5kUmFuZ2UiLCBzZWxmLnNlbGVjdGVkRGF0ZXNbMV0gJiYgY29tcGFyZURhdGVzKGRhdGUsIHNlbGYuc2VsZWN0ZWREYXRlc1sxXSwgdHJ1ZSkgPT09IDApOwogICAgICAgICAgICAgIGlmIChjbGFzc05hbWUgPT09ICJuZXh0TW9udGhEYXkiKSBkYXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoImluUmFuZ2UiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkYXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoImRpc2FibGVkIik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIikgewogICAgICAgICAgaWYgKGlzRGF0ZUluUmFuZ2UoZGF0ZSkgJiYgIWlzRGF0ZVNlbGVjdGVkKGRhdGUpKSBkYXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoImluUmFuZ2UiKTsKICAgICAgICB9CgogICAgICAgIGlmIChzZWxmLndlZWtOdW1iZXJzICYmIHNlbGYuY29uZmlnLnNob3dNb250aHMgPT09IDEgJiYgY2xhc3NOYW1lICE9PSAicHJldk1vbnRoRGF5IiAmJiBkYXlOdW1iZXIgJSA3ID09PSAxKSB7CiAgICAgICAgICBzZWxmLndlZWtOdW1iZXJzLmluc2VydEFkamFjZW50SFRNTCgiYmVmb3JlZW5kIiwgIjxzcGFuIGNsYXNzPSdmbGF0cGlja3ItZGF5Jz4iICsgc2VsZi5jb25maWcuZ2V0V2VlayhkYXRlKSArICI8L3NwYW4+Iik7CiAgICAgICAgfQoKICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uRGF5Q3JlYXRlIiwgZGF5RWxlbWVudCk7CiAgICAgICAgcmV0dXJuIGRheUVsZW1lbnQ7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGZvY3VzT25EYXlFbGVtKHRhcmdldE5vZGUpIHsKICAgICAgICB0YXJnZXROb2RlLmZvY3VzKCk7CiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1vZGUgPT09ICJyYW5nZSIpIG9uTW91c2VPdmVyKHRhcmdldE5vZGUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBnZXRGaXJzdEF2YWlsYWJsZURheShkZWx0YSkgewogICAgICAgIHZhciBzdGFydE1vbnRoID0gZGVsdGEgPiAwID8gMCA6IHNlbGYuY29uZmlnLnNob3dNb250aHMgLSAxOwogICAgICAgIHZhciBlbmRNb250aCA9IGRlbHRhID4gMCA/IHNlbGYuY29uZmlnLnNob3dNb250aHMgOiAtMTsKCiAgICAgICAgZm9yICh2YXIgbSA9IHN0YXJ0TW9udGg7IG0gIT0gZW5kTW9udGg7IG0gKz0gZGVsdGEpIHsKICAgICAgICAgIHZhciBtb250aCA9IHNlbGYuZGF5c0NvbnRhaW5lci5jaGlsZHJlblttXTsKICAgICAgICAgIHZhciBzdGFydEluZGV4ID0gZGVsdGEgPiAwID8gMCA6IG1vbnRoLmNoaWxkcmVuLmxlbmd0aCAtIDE7CiAgICAgICAgICB2YXIgZW5kSW5kZXggPSBkZWx0YSA+IDAgPyBtb250aC5jaGlsZHJlbi5sZW5ndGggOiAtMTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gc3RhcnRJbmRleDsgaSAhPSBlbmRJbmRleDsgaSArPSBkZWx0YSkgewogICAgICAgICAgICB2YXIgYyA9IG1vbnRoLmNoaWxkcmVuW2ldOwogICAgICAgICAgICBpZiAoYy5jbGFzc05hbWUuaW5kZXhPZigiaGlkZGVuIikgPT09IC0xICYmIGlzRW5hYmxlZChjLmRhdGVPYmopKSByZXR1cm4gYzsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGdldE5leHRBdmFpbGFibGVEYXkoY3VycmVudCwgZGVsdGEpIHsKICAgICAgICB2YXIgZ2l2ZW5Nb250aCA9IGN1cnJlbnQuY2xhc3NOYW1lLmluZGV4T2YoIk1vbnRoIikgPT09IC0xID8gY3VycmVudC5kYXRlT2JqLmdldE1vbnRoKCkgOiBzZWxmLmN1cnJlbnRNb250aDsKICAgICAgICB2YXIgZW5kTW9udGggPSBkZWx0YSA+IDAgPyBzZWxmLmNvbmZpZy5zaG93TW9udGhzIDogLTE7CiAgICAgICAgdmFyIGxvb3BEZWx0YSA9IGRlbHRhID4gMCA/IDEgOiAtMTsKCiAgICAgICAgZm9yICh2YXIgbSA9IGdpdmVuTW9udGggLSBzZWxmLmN1cnJlbnRNb250aDsgbSAhPSBlbmRNb250aDsgbSArPSBsb29wRGVsdGEpIHsKICAgICAgICAgIHZhciBtb250aCA9IHNlbGYuZGF5c0NvbnRhaW5lci5jaGlsZHJlblttXTsKICAgICAgICAgIHZhciBzdGFydEluZGV4ID0gZ2l2ZW5Nb250aCAtIHNlbGYuY3VycmVudE1vbnRoID09PSBtID8gY3VycmVudC4kaSArIGRlbHRhIDogZGVsdGEgPCAwID8gbW9udGguY2hpbGRyZW4ubGVuZ3RoIC0gMSA6IDA7CiAgICAgICAgICB2YXIgbnVtTW9udGhEYXlzID0gbW9udGguY2hpbGRyZW4ubGVuZ3RoOwoKICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydEluZGV4OyBpID49IDAgJiYgaSA8IG51bU1vbnRoRGF5cyAmJiBpICE9IChkZWx0YSA+IDAgPyBudW1Nb250aERheXMgOiAtMSk7IGkgKz0gbG9vcERlbHRhKSB7CiAgICAgICAgICAgIHZhciBjID0gbW9udGguY2hpbGRyZW5baV07CiAgICAgICAgICAgIGlmIChjLmNsYXNzTmFtZS5pbmRleE9mKCJoaWRkZW4iKSA9PT0gLTEgJiYgaXNFbmFibGVkKGMuZGF0ZU9iaikgJiYgTWF0aC5hYnMoY3VycmVudC4kaSAtIGkpID49IE1hdGguYWJzKGRlbHRhKSkgcmV0dXJuIGZvY3VzT25EYXlFbGVtKGMpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc2VsZi5jaGFuZ2VNb250aChsb29wRGVsdGEpOwogICAgICAgIGZvY3VzT25EYXkoZ2V0Rmlyc3RBdmFpbGFibGVEYXkobG9vcERlbHRhKSwgMCk7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZm9jdXNPbkRheShjdXJyZW50LCBvZmZzZXQpIHsKICAgICAgICB2YXIgZGF5Rm9jdXNlZCA9IGlzSW5WaWV3KGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpOwogICAgICAgIHZhciBzdGFydEVsZW0gPSBjdXJyZW50ICE9PSB1bmRlZmluZWQgPyBjdXJyZW50IDogZGF5Rm9jdXNlZCA/IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgOiBzZWxmLnNlbGVjdGVkRGF0ZUVsZW0gIT09IHVuZGVmaW5lZCAmJiBpc0luVmlldyhzZWxmLnNlbGVjdGVkRGF0ZUVsZW0pID8gc2VsZi5zZWxlY3RlZERhdGVFbGVtIDogc2VsZi50b2RheURhdGVFbGVtICE9PSB1bmRlZmluZWQgJiYgaXNJblZpZXcoc2VsZi50b2RheURhdGVFbGVtKSA/IHNlbGYudG9kYXlEYXRlRWxlbSA6IGdldEZpcnN0QXZhaWxhYmxlRGF5KG9mZnNldCA+IDAgPyAxIDogLTEpOwogICAgICAgIGlmIChzdGFydEVsZW0gPT09IHVuZGVmaW5lZCkgcmV0dXJuIHNlbGYuX2lucHV0LmZvY3VzKCk7CiAgICAgICAgaWYgKCFkYXlGb2N1c2VkKSByZXR1cm4gZm9jdXNPbkRheUVsZW0oc3RhcnRFbGVtKTsKICAgICAgICBnZXROZXh0QXZhaWxhYmxlRGF5KHN0YXJ0RWxlbSwgb2Zmc2V0KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYnVpbGRNb250aERheXMoeWVhciwgbW9udGgpIHsKICAgICAgICB2YXIgZmlyc3RPZk1vbnRoID0gKG5ldyBEYXRlKHllYXIsIG1vbnRoLCAxKS5nZXREYXkoKSAtIHNlbGYubDEwbi5maXJzdERheU9mV2VlayArIDcpICUgNzsKICAgICAgICB2YXIgcHJldk1vbnRoRGF5cyA9IHNlbGYudXRpbHMuZ2V0RGF5c0luTW9udGgoKG1vbnRoIC0gMSArIDEyKSAlIDEyKTsKICAgICAgICB2YXIgZGF5c0luTW9udGggPSBzZWxmLnV0aWxzLmdldERheXNJbk1vbnRoKG1vbnRoKSwKICAgICAgICAgICAgZGF5cyA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksCiAgICAgICAgICAgIGlzTXVsdGlNb250aCA9IHNlbGYuY29uZmlnLnNob3dNb250aHMgPiAxLAogICAgICAgICAgICBwcmV2TW9udGhEYXlDbGFzcyA9IGlzTXVsdGlNb250aCA/ICJwcmV2TW9udGhEYXkgaGlkZGVuIiA6ICJwcmV2TW9udGhEYXkiLAogICAgICAgICAgICBuZXh0TW9udGhEYXlDbGFzcyA9IGlzTXVsdGlNb250aCA/ICJuZXh0TW9udGhEYXkgaGlkZGVuIiA6ICJuZXh0TW9udGhEYXkiOwogICAgICAgIHZhciBkYXlOdW1iZXIgPSBwcmV2TW9udGhEYXlzICsgMSAtIGZpcnN0T2ZNb250aCwKICAgICAgICAgICAgZGF5SW5kZXggPSAwOwoKICAgICAgICBmb3IgKDsgZGF5TnVtYmVyIDw9IHByZXZNb250aERheXM7IGRheU51bWJlcisrLCBkYXlJbmRleCsrKSB7CiAgICAgICAgICBkYXlzLmFwcGVuZENoaWxkKGNyZWF0ZURheShwcmV2TW9udGhEYXlDbGFzcywgbmV3IERhdGUoeWVhciwgbW9udGggLSAxLCBkYXlOdW1iZXIpLCBkYXlOdW1iZXIsIGRheUluZGV4KSk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKGRheU51bWJlciA9IDE7IGRheU51bWJlciA8PSBkYXlzSW5Nb250aDsgZGF5TnVtYmVyKyssIGRheUluZGV4KyspIHsKICAgICAgICAgIGRheXMuYXBwZW5kQ2hpbGQoY3JlYXRlRGF5KCIiLCBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgZGF5TnVtYmVyKSwgZGF5TnVtYmVyLCBkYXlJbmRleCkpOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgZGF5TnVtID0gZGF5c0luTW9udGggKyAxOyBkYXlOdW0gPD0gNDIgLSBmaXJzdE9mTW9udGggJiYgKHNlbGYuY29uZmlnLnNob3dNb250aHMgPT09IDEgfHwgZGF5SW5kZXggJSA3ICE9PSAwKTsgZGF5TnVtKyssIGRheUluZGV4KyspIHsKICAgICAgICAgIGRheXMuYXBwZW5kQ2hpbGQoY3JlYXRlRGF5KG5leHRNb250aERheUNsYXNzLCBuZXcgRGF0ZSh5ZWFyLCBtb250aCArIDEsIGRheU51bSAlIGRheXNJbk1vbnRoKSwgZGF5TnVtLCBkYXlJbmRleCkpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRheUNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJkYXlDb250YWluZXIiKTsKICAgICAgICBkYXlDb250YWluZXIuYXBwZW5kQ2hpbGQoZGF5cyk7CiAgICAgICAgcmV0dXJuIGRheUNvbnRhaW5lcjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYnVpbGREYXlzKCkgewogICAgICAgIGlmIChzZWxmLmRheXNDb250YWluZXIgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY2xlYXJOb2RlKHNlbGYuZGF5c0NvbnRhaW5lcik7CiAgICAgICAgaWYgKHNlbGYud2Vla051bWJlcnMpIGNsZWFyTm9kZShzZWxmLndlZWtOdW1iZXJzKTsKICAgICAgICB2YXIgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxmLmNvbmZpZy5zaG93TW9udGhzOyBpKyspIHsKICAgICAgICAgIHZhciBkID0gbmV3IERhdGUoc2VsZi5jdXJyZW50WWVhciwgc2VsZi5jdXJyZW50TW9udGgsIDEpOwogICAgICAgICAgZC5zZXRNb250aChzZWxmLmN1cnJlbnRNb250aCArIGkpOwogICAgICAgICAgZnJhZy5hcHBlbmRDaGlsZChidWlsZE1vbnRoRGF5cyhkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSkpOwogICAgICAgIH0KCiAgICAgICAgc2VsZi5kYXlzQ29udGFpbmVyLmFwcGVuZENoaWxkKGZyYWcpOwogICAgICAgIHNlbGYuZGF5cyA9IHNlbGYuZGF5c0NvbnRhaW5lci5maXJzdENoaWxkOwogICAgICB9CgogICAgICBmdW5jdGlvbiBidWlsZE1vbnRoKCkgewogICAgICAgIHZhciBjb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLW1vbnRoIik7CiAgICAgICAgdmFyIG1vbnRoTmF2RnJhZ21lbnQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgICAgIHZhciBtb250aEVsZW1lbnQgPSBjcmVhdGVFbGVtZW50KCJzcGFuIiwgImN1ci1tb250aCIpOwogICAgICAgIG1vbnRoRWxlbWVudC50aXRsZSA9IHNlbGYubDEwbi5zY3JvbGxUaXRsZTsKICAgICAgICB2YXIgeWVhcklucHV0ID0gY3JlYXRlTnVtYmVySW5wdXQoImN1ci15ZWFyIiwgewogICAgICAgICAgdGFiaW5kZXg6ICItMSIKICAgICAgICB9KTsKICAgICAgICB2YXIgeWVhckVsZW1lbnQgPSB5ZWFySW5wdXQuY2hpbGROb2Rlc1swXTsKICAgICAgICB5ZWFyRWxlbWVudC50aXRsZSA9IHNlbGYubDEwbi5zY3JvbGxUaXRsZTsKICAgICAgICB5ZWFyRWxlbWVudC5zZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWwiLCBzZWxmLmwxMG4ueWVhckFyaWFMYWJlbCk7CiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1pbkRhdGUpIHllYXJFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1taW4iLCBzZWxmLmNvbmZpZy5taW5EYXRlLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKSk7CgogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tYXhEYXRlKSB7CiAgICAgICAgICB5ZWFyRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtbWF4Iiwgc2VsZi5jb25maWcubWF4RGF0ZS5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCkpOwogICAgICAgICAgeWVhckVsZW1lbnQuZGlzYWJsZWQgPSAhIXNlbGYuY29uZmlnLm1pbkRhdGUgJiYgc2VsZi5jb25maWcubWluRGF0ZS5nZXRGdWxsWWVhcigpID09PSBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldEZ1bGxZZWFyKCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY3VycmVudE1vbnRoID0gY3JlYXRlRWxlbWVudCgiZGl2IiwgImZsYXRwaWNrci1jdXJyZW50LW1vbnRoIik7CiAgICAgICAgY3VycmVudE1vbnRoLmFwcGVuZENoaWxkKG1vbnRoRWxlbWVudCk7CiAgICAgICAgY3VycmVudE1vbnRoLmFwcGVuZENoaWxkKHllYXJJbnB1dCk7CiAgICAgICAgbW9udGhOYXZGcmFnbWVudC5hcHBlbmRDaGlsZChjdXJyZW50TW9udGgpOwogICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChtb250aE5hdkZyYWdtZW50KTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgY29udGFpbmVyOiBjb250YWluZXIsCiAgICAgICAgICB5ZWFyRWxlbWVudDogeWVhckVsZW1lbnQsCiAgICAgICAgICBtb250aEVsZW1lbnQ6IG1vbnRoRWxlbWVudAogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGJ1aWxkTW9udGhzKCkgewogICAgICAgIGNsZWFyTm9kZShzZWxmLm1vbnRoTmF2KTsKICAgICAgICBzZWxmLm1vbnRoTmF2LmFwcGVuZENoaWxkKHNlbGYucHJldk1vbnRoTmF2KTsKCiAgICAgICAgZm9yICh2YXIgbSA9IHNlbGYuY29uZmlnLnNob3dNb250aHM7IG0tLTspIHsKICAgICAgICAgIHZhciBtb250aCA9IGJ1aWxkTW9udGgoKTsKICAgICAgICAgIHNlbGYueWVhckVsZW1lbnRzLnB1c2gobW9udGgueWVhckVsZW1lbnQpOwogICAgICAgICAgc2VsZi5tb250aEVsZW1lbnRzLnB1c2gobW9udGgubW9udGhFbGVtZW50KTsKICAgICAgICAgIHNlbGYubW9udGhOYXYuYXBwZW5kQ2hpbGQobW9udGguY29udGFpbmVyKTsKICAgICAgICB9CgogICAgICAgIHNlbGYubW9udGhOYXYuYXBwZW5kQ2hpbGQoc2VsZi5uZXh0TW9udGhOYXYpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBidWlsZE1vbnRoTmF2KCkgewogICAgICAgIHNlbGYubW9udGhOYXYgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLW1vbnRocyIpOwogICAgICAgIHNlbGYueWVhckVsZW1lbnRzID0gW107CiAgICAgICAgc2VsZi5tb250aEVsZW1lbnRzID0gW107CiAgICAgICAgc2VsZi5wcmV2TW9udGhOYXYgPSBjcmVhdGVFbGVtZW50KCJzcGFuIiwgImZsYXRwaWNrci1wcmV2LW1vbnRoIik7CiAgICAgICAgc2VsZi5wcmV2TW9udGhOYXYuaW5uZXJIVE1MID0gc2VsZi5jb25maWcucHJldkFycm93OwogICAgICAgIHNlbGYubmV4dE1vbnRoTmF2ID0gY3JlYXRlRWxlbWVudCgic3BhbiIsICJmbGF0cGlja3ItbmV4dC1tb250aCIpOwogICAgICAgIHNlbGYubmV4dE1vbnRoTmF2LmlubmVySFRNTCA9IHNlbGYuY29uZmlnLm5leHRBcnJvdzsKICAgICAgICBidWlsZE1vbnRocygpOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLCAiX2hpZGVQcmV2TW9udGhBcnJvdyIsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gc2VsZi5fX2hpZGVQcmV2TW9udGhBcnJvdzsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChib29sKSB7CiAgICAgICAgICAgIGlmIChzZWxmLl9faGlkZVByZXZNb250aEFycm93ICE9PSBib29sKSB7CiAgICAgICAgICAgICAgdG9nZ2xlQ2xhc3Moc2VsZi5wcmV2TW9udGhOYXYsICJkaXNhYmxlZCIsIGJvb2wpOwogICAgICAgICAgICAgIHNlbGYuX19oaWRlUHJldk1vbnRoQXJyb3cgPSBib29sOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYsICJfaGlkZU5leHRNb250aEFycm93IiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmLl9faGlkZU5leHRNb250aEFycm93OwogICAgICAgICAgfSwKICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGJvb2wpIHsKICAgICAgICAgICAgaWYgKHNlbGYuX19oaWRlTmV4dE1vbnRoQXJyb3cgIT09IGJvb2wpIHsKICAgICAgICAgICAgICB0b2dnbGVDbGFzcyhzZWxmLm5leHRNb250aE5hdiwgImRpc2FibGVkIiwgYm9vbCk7CiAgICAgICAgICAgICAgc2VsZi5fX2hpZGVOZXh0TW9udGhBcnJvdyA9IGJvb2w7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBzZWxmLmN1cnJlbnRZZWFyRWxlbWVudCA9IHNlbGYueWVhckVsZW1lbnRzWzBdOwogICAgICAgIHVwZGF0ZU5hdmlnYXRpb25DdXJyZW50TW9udGgoKTsKICAgICAgICByZXR1cm4gc2VsZi5tb250aE5hdjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYnVpbGRUaW1lKCkgewogICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuY2xhc3NMaXN0LmFkZCgiaGFzVGltZSIpOwogICAgICAgIGlmIChzZWxmLmNvbmZpZy5ub0NhbGVuZGFyKSBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoIm5vQ2FsZW5kYXIiKTsKICAgICAgICBzZWxmLnRpbWVDb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLXRpbWUiKTsKICAgICAgICBzZWxmLnRpbWVDb250YWluZXIudGFiSW5kZXggPSAtMTsKICAgICAgICB2YXIgc2VwYXJhdG9yID0gY3JlYXRlRWxlbWVudCgic3BhbiIsICJmbGF0cGlja3ItdGltZS1zZXBhcmF0b3IiLCAiOiIpOwogICAgICAgIHZhciBob3VySW5wdXQgPSBjcmVhdGVOdW1iZXJJbnB1dCgiZmxhdHBpY2tyLWhvdXIiKTsKICAgICAgICBzZWxmLmhvdXJFbGVtZW50ID0gaG91cklucHV0LmNoaWxkTm9kZXNbMF07CiAgICAgICAgdmFyIG1pbnV0ZUlucHV0ID0gY3JlYXRlTnVtYmVySW5wdXQoImZsYXRwaWNrci1taW51dGUiKTsKICAgICAgICBzZWxmLm1pbnV0ZUVsZW1lbnQgPSBtaW51dGVJbnB1dC5jaGlsZE5vZGVzWzBdOwogICAgICAgIHNlbGYuaG91ckVsZW1lbnQudGFiSW5kZXggPSBzZWxmLm1pbnV0ZUVsZW1lbnQudGFiSW5kZXggPSAtMTsKICAgICAgICBzZWxmLmhvdXJFbGVtZW50LnZhbHVlID0gcGFkKHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqID8gc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmouZ2V0SG91cnMoKSA6IHNlbGYuY29uZmlnLnRpbWVfMjRociA/IHNlbGYuY29uZmlnLmRlZmF1bHRIb3VyIDogbWlsaXRhcnkyYW1wbShzZWxmLmNvbmZpZy5kZWZhdWx0SG91cikpOwogICAgICAgIHNlbGYubWludXRlRWxlbWVudC52YWx1ZSA9IHBhZChzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiA/IHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqLmdldE1pbnV0ZXMoKSA6IHNlbGYuY29uZmlnLmRlZmF1bHRNaW51dGUpOwogICAgICAgIHNlbGYuaG91ckVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLXN0ZXAiLCBzZWxmLmNvbmZpZy5ob3VySW5jcmVtZW50LnRvU3RyaW5nKCkpOwogICAgICAgIHNlbGYubWludXRlRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtc3RlcCIsIHNlbGYuY29uZmlnLm1pbnV0ZUluY3JlbWVudC50b1N0cmluZygpKTsKICAgICAgICBzZWxmLmhvdXJFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1taW4iLCBzZWxmLmNvbmZpZy50aW1lXzI0aHIgPyAiMCIgOiAiMSIpOwogICAgICAgIHNlbGYuaG91ckVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLW1heCIsIHNlbGYuY29uZmlnLnRpbWVfMjRociA/ICIyMyIgOiAiMTIiKTsKICAgICAgICBzZWxmLm1pbnV0ZUVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLW1pbiIsICIwIik7CiAgICAgICAgc2VsZi5taW51dGVFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1tYXgiLCAiNTkiKTsKICAgICAgICBzZWxmLnRpbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoaG91cklucHV0KTsKICAgICAgICBzZWxmLnRpbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoc2VwYXJhdG9yKTsKICAgICAgICBzZWxmLnRpbWVDb250YWluZXIuYXBwZW5kQ2hpbGQobWludXRlSW5wdXQpOwogICAgICAgIGlmIChzZWxmLmNvbmZpZy50aW1lXzI0aHIpIHNlbGYudGltZUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJ0aW1lMjRociIpOwoKICAgICAgICBpZiAoc2VsZi5jb25maWcuZW5hYmxlU2Vjb25kcykgewogICAgICAgICAgc2VsZi50aW1lQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoImhhc1NlY29uZHMiKTsKICAgICAgICAgIHZhciBzZWNvbmRJbnB1dCA9IGNyZWF0ZU51bWJlcklucHV0KCJmbGF0cGlja3Itc2Vjb25kIik7CiAgICAgICAgICBzZWxmLnNlY29uZEVsZW1lbnQgPSBzZWNvbmRJbnB1dC5jaGlsZE5vZGVzWzBdOwogICAgICAgICAgc2VsZi5zZWNvbmRFbGVtZW50LnZhbHVlID0gcGFkKHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqID8gc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmouZ2V0U2Vjb25kcygpIDogc2VsZi5jb25maWcuZGVmYXVsdFNlY29uZHMpOwogICAgICAgICAgc2VsZi5zZWNvbmRFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1zdGVwIiwgc2VsZi5taW51dGVFbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS1zdGVwIikpOwogICAgICAgICAgc2VsZi5zZWNvbmRFbGVtZW50LnNldEF0dHJpYnV0ZSgiZGF0YS1taW4iLCBzZWxmLm1pbnV0ZUVsZW1lbnQuZ2V0QXR0cmlidXRlKCJkYXRhLW1pbiIpKTsKICAgICAgICAgIHNlbGYuc2Vjb25kRWxlbWVudC5zZXRBdHRyaWJ1dGUoImRhdGEtbWF4Iiwgc2VsZi5taW51dGVFbGVtZW50LmdldEF0dHJpYnV0ZSgiZGF0YS1tYXgiKSk7CiAgICAgICAgICBzZWxmLnRpbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoY3JlYXRlRWxlbWVudCgic3BhbiIsICJmbGF0cGlja3ItdGltZS1zZXBhcmF0b3IiLCAiOiIpKTsKICAgICAgICAgIHNlbGYudGltZUNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWNvbmRJbnB1dCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXNlbGYuY29uZmlnLnRpbWVfMjRocikgewogICAgICAgICAgc2VsZi5hbVBNID0gY3JlYXRlRWxlbWVudCgic3BhbiIsICJmbGF0cGlja3ItYW0tcG0iLCBzZWxmLmwxMG4uYW1QTVtpbnQoKHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqID8gc2VsZi5ob3VyRWxlbWVudC52YWx1ZSA6IHNlbGYuY29uZmlnLmRlZmF1bHRIb3VyKSA+IDExKV0pOwogICAgICAgICAgc2VsZi5hbVBNLnRpdGxlID0gc2VsZi5sMTBuLnRvZ2dsZVRpdGxlOwogICAgICAgICAgc2VsZi5hbVBNLnRhYkluZGV4ID0gLTE7CiAgICAgICAgICBzZWxmLnRpbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoc2VsZi5hbVBNKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzZWxmLnRpbWVDb250YWluZXI7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGJ1aWxkV2Vla2RheXMoKSB7CiAgICAgICAgaWYgKCFzZWxmLndlZWtkYXlDb250YWluZXIpIHNlbGYud2Vla2RheUNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3Itd2Vla2RheXMiKTtlbHNlIGNsZWFyTm9kZShzZWxmLndlZWtkYXlDb250YWluZXIpOwoKICAgICAgICBmb3IgKHZhciBpID0gc2VsZi5jb25maWcuc2hvd01vbnRoczsgaS0tOykgewogICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3Itd2Vla2RheWNvbnRhaW5lciIpOwogICAgICAgICAgc2VsZi53ZWVrZGF5Q29udGFpbmVyLmFwcGVuZENoaWxkKGNvbnRhaW5lcik7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVXZWVrZGF5cygpOwogICAgICAgIHJldHVybiBzZWxmLndlZWtkYXlDb250YWluZXI7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZVdlZWtkYXlzKCkgewogICAgICAgIHZhciBmaXJzdERheU9mV2VlayA9IHNlbGYubDEwbi5maXJzdERheU9mV2VlazsKICAgICAgICB2YXIgd2Vla2RheXMgPSBzZWxmLmwxMG4ud2Vla2RheXMuc2hvcnRoYW5kLmNvbmNhdCgpOwoKICAgICAgICBpZiAoZmlyc3REYXlPZldlZWsgPiAwICYmIGZpcnN0RGF5T2ZXZWVrIDwgd2Vla2RheXMubGVuZ3RoKSB7CiAgICAgICAgICB3ZWVrZGF5cyA9IHdlZWtkYXlzLnNwbGljZShmaXJzdERheU9mV2Vlaywgd2Vla2RheXMubGVuZ3RoKS5jb25jYXQod2Vla2RheXMuc3BsaWNlKDAsIGZpcnN0RGF5T2ZXZWVrKSk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciBpID0gc2VsZi5jb25maWcuc2hvd01vbnRoczsgaS0tOykgewogICAgICAgICAgc2VsZi53ZWVrZGF5Q29udGFpbmVyLmNoaWxkcmVuW2ldLmlubmVySFRNTCA9ICJcbiAgICAgIDxzcGFuIGNsYXNzPWZsYXRwaWNrci13ZWVrZGF5PlxuICAgICAgICAiICsgd2Vla2RheXMuam9pbigiPC9zcGFuPjxzcGFuIGNsYXNzPWZsYXRwaWNrci13ZWVrZGF5PiIpICsgIlxuICAgICAgPC9zcGFuPlxuICAgICAgIjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGJ1aWxkV2Vla3MoKSB7CiAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCJoYXNXZWVrcyIpOwogICAgICAgIHZhciB3ZWVrV3JhcHBlciA9IGNyZWF0ZUVsZW1lbnQoImRpdiIsICJmbGF0cGlja3Itd2Vla3dyYXBwZXIiKTsKICAgICAgICB3ZWVrV3JhcHBlci5hcHBlbmRDaGlsZChjcmVhdGVFbGVtZW50KCJzcGFuIiwgImZsYXRwaWNrci13ZWVrZGF5Iiwgc2VsZi5sMTBuLndlZWtBYmJyZXZpYXRpb24pKTsKICAgICAgICB2YXIgd2Vla051bWJlcnMgPSBjcmVhdGVFbGVtZW50KCJkaXYiLCAiZmxhdHBpY2tyLXdlZWtzIik7CiAgICAgICAgd2Vla1dyYXBwZXIuYXBwZW5kQ2hpbGQod2Vla051bWJlcnMpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICB3ZWVrV3JhcHBlcjogd2Vla1dyYXBwZXIsCiAgICAgICAgICB3ZWVrTnVtYmVyczogd2Vla051bWJlcnMKICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBjaGFuZ2VNb250aCh2YWx1ZSwgaXNfb2Zmc2V0KSB7CiAgICAgICAgaWYgKGlzX29mZnNldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBpc19vZmZzZXQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRlbHRhID0gaXNfb2Zmc2V0ID8gdmFsdWUgOiB2YWx1ZSAtIHNlbGYuY3VycmVudE1vbnRoOwogICAgICAgIGlmIChkZWx0YSA8IDAgJiYgc2VsZi5faGlkZVByZXZNb250aEFycm93ID09PSB0cnVlIHx8IGRlbHRhID4gMCAmJiBzZWxmLl9oaWRlTmV4dE1vbnRoQXJyb3cgPT09IHRydWUpIHJldHVybjsKICAgICAgICBzZWxmLmN1cnJlbnRNb250aCArPSBkZWx0YTsKCiAgICAgICAgaWYgKHNlbGYuY3VycmVudE1vbnRoIDwgMCB8fCBzZWxmLmN1cnJlbnRNb250aCA+IDExKSB7CiAgICAgICAgICBzZWxmLmN1cnJlbnRZZWFyICs9IHNlbGYuY3VycmVudE1vbnRoID4gMTEgPyAxIDogLTE7CiAgICAgICAgICBzZWxmLmN1cnJlbnRNb250aCA9IChzZWxmLmN1cnJlbnRNb250aCArIDEyKSAlIDEyOwogICAgICAgICAgdHJpZ2dlckV2ZW50KCJvblllYXJDaGFuZ2UiKTsKICAgICAgICB9CgogICAgICAgIGJ1aWxkRGF5cygpOwogICAgICAgIHRyaWdnZXJFdmVudCgib25Nb250aENoYW5nZSIpOwogICAgICAgIHVwZGF0ZU5hdmlnYXRpb25DdXJyZW50TW9udGgoKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY2xlYXIodHJpZ2dlckNoYW5nZUV2ZW50KSB7CiAgICAgICAgaWYgKHRyaWdnZXJDaGFuZ2VFdmVudCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICB0cmlnZ2VyQ2hhbmdlRXZlbnQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgc2VsZi5pbnB1dC52YWx1ZSA9ICIiOwogICAgICAgIGlmIChzZWxmLmFsdElucHV0ICE9PSB1bmRlZmluZWQpIHNlbGYuYWx0SW5wdXQudmFsdWUgPSAiIjsKICAgICAgICBpZiAoc2VsZi5tb2JpbGVJbnB1dCAhPT0gdW5kZWZpbmVkKSBzZWxmLm1vYmlsZUlucHV0LnZhbHVlID0gIiI7CiAgICAgICAgc2VsZi5zZWxlY3RlZERhdGVzID0gW107CiAgICAgICAgc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogPSB1bmRlZmluZWQ7CiAgICAgICAgc2VsZi5zaG93VGltZUlucHV0ID0gZmFsc2U7CgogICAgICAgIGlmIChzZWxmLmNvbmZpZy5lbmFibGVUaW1lID09PSB0cnVlKSB7CiAgICAgICAgICBzZXREZWZhdWx0SG91cnMoKTsKICAgICAgICB9CgogICAgICAgIHNlbGYucmVkcmF3KCk7CiAgICAgICAgaWYgKHRyaWdnZXJDaGFuZ2VFdmVudCkgdHJpZ2dlckV2ZW50KCJvbkNoYW5nZSIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgICBzZWxmLmlzT3BlbiA9IGZhbHNlOwoKICAgICAgICBpZiAoIXNlbGYuaXNNb2JpbGUpIHsKICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgib3BlbiIpOwoKICAgICAgICAgIHNlbGYuX2lucHV0LmNsYXNzTGlzdC5yZW1vdmUoImFjdGl2ZSIpOwogICAgICAgIH0KCiAgICAgICAgdHJpZ2dlckV2ZW50KCJvbkNsb3NlIik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgaWYgKHNlbGYuY29uZmlnICE9PSB1bmRlZmluZWQpIHRyaWdnZXJFdmVudCgib25EZXN0cm95Iik7CgogICAgICAgIGZvciAodmFyIGkgPSBzZWxmLl9oYW5kbGVycy5sZW5ndGg7IGktLTspIHsKICAgICAgICAgIHZhciBoID0gc2VsZi5faGFuZGxlcnNbaV07CiAgICAgICAgICBoLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihoLmV2ZW50LCBoLmhhbmRsZXIsIGgub3B0aW9ucyk7CiAgICAgICAgfQoKICAgICAgICBzZWxmLl9oYW5kbGVycyA9IFtdOwoKICAgICAgICBpZiAoc2VsZi5tb2JpbGVJbnB1dCkgewogICAgICAgICAgaWYgKHNlbGYubW9iaWxlSW5wdXQucGFyZW50Tm9kZSkgc2VsZi5tb2JpbGVJbnB1dC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNlbGYubW9iaWxlSW5wdXQpOwogICAgICAgICAgc2VsZi5tb2JpbGVJbnB1dCA9IHVuZGVmaW5lZDsKICAgICAgICB9IGVsc2UgaWYgKHNlbGYuY2FsZW5kYXJDb250YWluZXIgJiYgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5wYXJlbnROb2RlKSBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2VsZi5jYWxlbmRhckNvbnRhaW5lcik7CgogICAgICAgIGlmIChzZWxmLmFsdElucHV0KSB7CiAgICAgICAgICBzZWxmLmlucHV0LnR5cGUgPSAidGV4dCI7CiAgICAgICAgICBpZiAoc2VsZi5hbHRJbnB1dC5wYXJlbnROb2RlKSBzZWxmLmFsdElucHV0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2VsZi5hbHRJbnB1dCk7CiAgICAgICAgICBkZWxldGUgc2VsZi5hbHRJbnB1dDsKICAgICAgICB9CgogICAgICAgIGlmIChzZWxmLmlucHV0KSB7CiAgICAgICAgICBzZWxmLmlucHV0LnR5cGUgPSBzZWxmLmlucHV0Ll90eXBlOwogICAgICAgICAgc2VsZi5pbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCJmbGF0cGlja3ItaW5wdXQiKTsKICAgICAgICAgIHNlbGYuaW5wdXQucmVtb3ZlQXR0cmlidXRlKCJyZWFkb25seSIpOwogICAgICAgICAgc2VsZi5pbnB1dC52YWx1ZSA9ICIiOwogICAgICAgIH0KCiAgICAgICAgWyJfc2hvd1RpbWVJbnB1dCIsICJsYXRlc3RTZWxlY3RlZERhdGVPYmoiLCAiX2hpZGVOZXh0TW9udGhBcnJvdyIsICJfaGlkZVByZXZNb250aEFycm93IiwgIl9faGlkZU5leHRNb250aEFycm93IiwgIl9faGlkZVByZXZNb250aEFycm93IiwgImlzTW9iaWxlIiwgImlzT3BlbiIsICJzZWxlY3RlZERhdGVFbGVtIiwgIm1pbkRhdGVIYXNUaW1lIiwgIm1heERhdGVIYXNUaW1lIiwgImRheXMiLCAiZGF5c0NvbnRhaW5lciIsICJfaW5wdXQiLCAiX3Bvc2l0aW9uRWxlbWVudCIsICJpbm5lckNvbnRhaW5lciIsICJyQ29udGFpbmVyIiwgIm1vbnRoTmF2IiwgInRvZGF5RGF0ZUVsZW0iLCAiY2FsZW5kYXJDb250YWluZXIiLCAid2Vla2RheUNvbnRhaW5lciIsICJwcmV2TW9udGhOYXYiLCAibmV4dE1vbnRoTmF2IiwgImN1cnJlbnRNb250aEVsZW1lbnQiLCAiY3VycmVudFllYXJFbGVtZW50IiwgIm5hdmlnYXRpb25DdXJyZW50TW9udGgiLCAic2VsZWN0ZWREYXRlRWxlbSIsICJjb25maWciXS5mb3JFYWNoKGZ1bmN0aW9uIChrKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBkZWxldGUgc2VsZltrXTsKICAgICAgICAgIH0gY2F0Y2ggKF8pIHt9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGlzQ2FsZW5kYXJFbGVtKGVsZW0pIHsKICAgICAgICBpZiAoc2VsZi5jb25maWcuYXBwZW5kVG8gJiYgc2VsZi5jb25maWcuYXBwZW5kVG8uY29udGFpbnMoZWxlbSkpIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBzZWxmLmNhbGVuZGFyQ29udGFpbmVyLmNvbnRhaW5zKGVsZW0pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkb2N1bWVudENsaWNrKGUpIHsKICAgICAgICBpZiAoc2VsZi5pc09wZW4gJiYgIXNlbGYuY29uZmlnLmlubGluZSkgewogICAgICAgICAgdmFyIGlzQ2FsZW5kYXJFbGVtZW50ID0gaXNDYWxlbmRhckVsZW0oZS50YXJnZXQpOwogICAgICAgICAgdmFyIGlzSW5wdXQgPSBlLnRhcmdldCA9PT0gc2VsZi5pbnB1dCB8fCBlLnRhcmdldCA9PT0gc2VsZi5hbHRJbnB1dCB8fCBzZWxmLmVsZW1lbnQuY29udGFpbnMoZS50YXJnZXQpIHx8IGUucGF0aCAmJiBlLnBhdGguaW5kZXhPZiAmJiAofmUucGF0aC5pbmRleE9mKHNlbGYuaW5wdXQpIHx8IH5lLnBhdGguaW5kZXhPZihzZWxmLmFsdElucHV0KSk7CiAgICAgICAgICB2YXIgbG9zdEZvY3VzID0gZS50eXBlID09PSAiYmx1ciIgPyBpc0lucHV0ICYmIGUucmVsYXRlZFRhcmdldCAmJiAhaXNDYWxlbmRhckVsZW0oZS5yZWxhdGVkVGFyZ2V0KSA6ICFpc0lucHV0ICYmICFpc0NhbGVuZGFyRWxlbWVudDsKICAgICAgICAgIHZhciBpc0lnbm9yZWQgPSAhc2VsZi5jb25maWcuaWdub3JlZEZvY3VzRWxlbWVudHMuc29tZShmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICByZXR1cm4gZWxlbS5jb250YWlucyhlLnRhcmdldCk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAobG9zdEZvY3VzICYmIGlzSWdub3JlZCkgewogICAgICAgICAgICBzZWxmLmNsb3NlKCk7CgogICAgICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIiAmJiBzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgc2VsZi5jbGVhcihmYWxzZSk7CiAgICAgICAgICAgICAgc2VsZi5yZWRyYXcoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gY2hhbmdlWWVhcihuZXdZZWFyKSB7CiAgICAgICAgaWYgKCFuZXdZZWFyIHx8IHNlbGYuY29uZmlnLm1pbkRhdGUgJiYgbmV3WWVhciA8IHNlbGYuY29uZmlnLm1pbkRhdGUuZ2V0RnVsbFllYXIoKSB8fCBzZWxmLmNvbmZpZy5tYXhEYXRlICYmIG5ld1llYXIgPiBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldEZ1bGxZZWFyKCkpIHJldHVybjsKICAgICAgICB2YXIgbmV3WWVhck51bSA9IG5ld1llYXIsCiAgICAgICAgICAgIGlzTmV3WWVhciA9IHNlbGYuY3VycmVudFllYXIgIT09IG5ld1llYXJOdW07CiAgICAgICAgc2VsZi5jdXJyZW50WWVhciA9IG5ld1llYXJOdW0gfHwgc2VsZi5jdXJyZW50WWVhcjsKCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1heERhdGUgJiYgc2VsZi5jdXJyZW50WWVhciA9PT0gc2VsZi5jb25maWcubWF4RGF0ZS5nZXRGdWxsWWVhcigpKSB7CiAgICAgICAgICBzZWxmLmN1cnJlbnRNb250aCA9IE1hdGgubWluKHNlbGYuY29uZmlnLm1heERhdGUuZ2V0TW9udGgoKSwgc2VsZi5jdXJyZW50TW9udGgpOwogICAgICAgIH0gZWxzZSBpZiAoc2VsZi5jb25maWcubWluRGF0ZSAmJiBzZWxmLmN1cnJlbnRZZWFyID09PSBzZWxmLmNvbmZpZy5taW5EYXRlLmdldEZ1bGxZZWFyKCkpIHsKICAgICAgICAgIHNlbGYuY3VycmVudE1vbnRoID0gTWF0aC5tYXgoc2VsZi5jb25maWcubWluRGF0ZS5nZXRNb250aCgpLCBzZWxmLmN1cnJlbnRNb250aCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNOZXdZZWFyKSB7CiAgICAgICAgICBzZWxmLnJlZHJhdygpOwogICAgICAgICAgdHJpZ2dlckV2ZW50KCJvblllYXJDaGFuZ2UiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGlzRW5hYmxlZChkYXRlLCB0aW1lbGVzcykgewogICAgICAgIGlmICh0aW1lbGVzcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICB0aW1lbGVzcyA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICB2YXIgZGF0ZVRvQ2hlY2sgPSBzZWxmLnBhcnNlRGF0ZShkYXRlLCB1bmRlZmluZWQsIHRpbWVsZXNzKTsKICAgICAgICBpZiAoc2VsZi5jb25maWcubWluRGF0ZSAmJiBkYXRlVG9DaGVjayAmJiBjb21wYXJlRGF0ZXMoZGF0ZVRvQ2hlY2ssIHNlbGYuY29uZmlnLm1pbkRhdGUsIHRpbWVsZXNzICE9PSB1bmRlZmluZWQgPyB0aW1lbGVzcyA6ICFzZWxmLm1pbkRhdGVIYXNUaW1lKSA8IDAgfHwgc2VsZi5jb25maWcubWF4RGF0ZSAmJiBkYXRlVG9DaGVjayAmJiBjb21wYXJlRGF0ZXMoZGF0ZVRvQ2hlY2ssIHNlbGYuY29uZmlnLm1heERhdGUsIHRpbWVsZXNzICE9PSB1bmRlZmluZWQgPyB0aW1lbGVzcyA6ICFzZWxmLm1heERhdGVIYXNUaW1lKSA+IDApIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoc2VsZi5jb25maWcuZW5hYmxlLmxlbmd0aCA9PT0gMCAmJiBzZWxmLmNvbmZpZy5kaXNhYmxlLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKGRhdGVUb0NoZWNrID09PSB1bmRlZmluZWQpIHJldHVybiBmYWxzZTsKICAgICAgICB2YXIgYm9vbCA9IHNlbGYuY29uZmlnLmVuYWJsZS5sZW5ndGggPiAwLAogICAgICAgICAgICBhcnJheSA9IGJvb2wgPyBzZWxmLmNvbmZpZy5lbmFibGUgOiBzZWxmLmNvbmZpZy5kaXNhYmxlOwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgZDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBkID0gYXJyYXlbaV07CiAgICAgICAgICBpZiAodHlwZW9mIGQgPT09ICJmdW5jdGlvbiIgJiYgZChkYXRlVG9DaGVjaykpIHJldHVybiBib29sO2Vsc2UgaWYgKGQgaW5zdGFuY2VvZiBEYXRlICYmIGRhdGVUb0NoZWNrICE9PSB1bmRlZmluZWQgJiYgZC5nZXRUaW1lKCkgPT09IGRhdGVUb0NoZWNrLmdldFRpbWUoKSkgcmV0dXJuIGJvb2w7ZWxzZSBpZiAodHlwZW9mIGQgPT09ICJzdHJpbmciICYmIGRhdGVUb0NoZWNrICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdmFyIHBhcnNlZCA9IHNlbGYucGFyc2VEYXRlKGQsIHVuZGVmaW5lZCwgdHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBwYXJzZWQgJiYgcGFyc2VkLmdldFRpbWUoKSA9PT0gZGF0ZVRvQ2hlY2suZ2V0VGltZSgpID8gYm9vbCA6ICFib29sOwogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZCA9PT0gIm9iamVjdCIgJiYgZGF0ZVRvQ2hlY2sgIT09IHVuZGVmaW5lZCAmJiBkLmZyb20gJiYgZC50byAmJiBkYXRlVG9DaGVjay5nZXRUaW1lKCkgPj0gZC5mcm9tLmdldFRpbWUoKSAmJiBkYXRlVG9DaGVjay5nZXRUaW1lKCkgPD0gZC50by5nZXRUaW1lKCkpIHJldHVybiBib29sOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICFib29sOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpc0luVmlldyhlbGVtKSB7CiAgICAgICAgaWYgKHNlbGYuZGF5c0NvbnRhaW5lciAhPT0gdW5kZWZpbmVkKSByZXR1cm4gZWxlbS5jbGFzc05hbWUuaW5kZXhPZigiaGlkZGVuIikgPT09IC0xICYmIHNlbGYuZGF5c0NvbnRhaW5lci5jb250YWlucyhlbGVtKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG9uS2V5RG93bihlKSB7CiAgICAgICAgdmFyIGlzSW5wdXQgPSBlLnRhcmdldCA9PT0gc2VsZi5faW5wdXQ7CiAgICAgICAgdmFyIGFsbG93SW5wdXQgPSBzZWxmLmNvbmZpZy5hbGxvd0lucHV0OwogICAgICAgIHZhciBhbGxvd0tleWRvd24gPSBzZWxmLmlzT3BlbiAmJiAoIWFsbG93SW5wdXQgfHwgIWlzSW5wdXQpOwogICAgICAgIHZhciBhbGxvd0lubGluZUtleWRvd24gPSBzZWxmLmNvbmZpZy5pbmxpbmUgJiYgaXNJbnB1dCAmJiAhYWxsb3dJbnB1dDsKCiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMTMgJiYgaXNJbnB1dCkgewogICAgICAgICAgaWYgKGFsbG93SW5wdXQpIHsKICAgICAgICAgICAgc2VsZi5zZXREYXRlKHNlbGYuX2lucHV0LnZhbHVlLCB0cnVlLCBlLnRhcmdldCA9PT0gc2VsZi5hbHRJbnB1dCA/IHNlbGYuY29uZmlnLmFsdEZvcm1hdCA6IHNlbGYuY29uZmlnLmRhdGVGb3JtYXQpOwogICAgICAgICAgICByZXR1cm4gZS50YXJnZXQuYmx1cigpOwogICAgICAgICAgfSBlbHNlIHNlbGYub3BlbigpOwogICAgICAgIH0gZWxzZSBpZiAoaXNDYWxlbmRhckVsZW0oZS50YXJnZXQpIHx8IGFsbG93S2V5ZG93biB8fCBhbGxvd0lubGluZUtleWRvd24pIHsKICAgICAgICAgIHZhciBpc1RpbWVPYmogPSAhIXNlbGYudGltZUNvbnRhaW5lciAmJiBzZWxmLnRpbWVDb250YWluZXIuY29udGFpbnMoZS50YXJnZXQpOwoKICAgICAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7CiAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgaWYgKGlzVGltZU9iaikgdXBkYXRlVGltZSgpO2Vsc2Ugc2VsZWN0RGF0ZShlKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgIGZvY3VzQW5kQ2xvc2UoKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgY2FzZSA0NjoKICAgICAgICAgICAgICBpZiAoaXNJbnB1dCAmJiAhc2VsZi5jb25maWcuYWxsb3dJbnB1dCkgewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgc2VsZi5jbGVhcigpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDM3OgogICAgICAgICAgICBjYXNlIDM5OgogICAgICAgICAgICAgIGlmICghaXNUaW1lT2JqKSB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICAgICAgaWYgKHNlbGYuZGF5c0NvbnRhaW5lciAhPT0gdW5kZWZpbmVkICYmIChhbGxvd0lucHV0ID09PSBmYWxzZSB8fCBpc0luVmlldyhkb2N1bWVudC5hY3RpdmVFbGVtZW50KSkpIHsKICAgICAgICAgICAgICAgICAgdmFyIF9kZWx0YSA9IGUua2V5Q29kZSA9PT0gMzkgPyAxIDogLTE7CgogICAgICAgICAgICAgICAgICBpZiAoIWUuY3RybEtleSkgZm9jdXNPbkRheSh1bmRlZmluZWQsIF9kZWx0YSk7ZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY2hhbmdlTW9udGgoX2RlbHRhKTsKICAgICAgICAgICAgICAgICAgICBmb2N1c09uRGF5KGdldEZpcnN0QXZhaWxhYmxlRGF5KDEpLCAwKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VsZi5ob3VyRWxlbWVudCkgc2VsZi5ob3VyRWxlbWVudC5mb2N1cygpOwoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgIHZhciBkZWx0YSA9IGUua2V5Q29kZSA9PT0gNDAgPyAxIDogLTE7CgogICAgICAgICAgICAgIGlmIChzZWxmLmRheXNDb250YWluZXIpIHsKICAgICAgICAgICAgICAgIGlmIChlLmN0cmxLZXkpIHsKICAgICAgICAgICAgICAgICAgY2hhbmdlWWVhcihzZWxmLmN1cnJlbnRZZWFyIC0gZGVsdGEpOwogICAgICAgICAgICAgICAgICBmb2N1c09uRGF5KGdldEZpcnN0QXZhaWxhYmxlRGF5KDEpLCAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzVGltZU9iaikgZm9jdXNPbkRheSh1bmRlZmluZWQsIGRlbHRhICogNyk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZWxmLmNvbmZpZy5lbmFibGVUaW1lKSB7CiAgICAgICAgICAgICAgICBpZiAoIWlzVGltZU9iaiAmJiBzZWxmLmhvdXJFbGVtZW50KSBzZWxmLmhvdXJFbGVtZW50LmZvY3VzKCk7CiAgICAgICAgICAgICAgICB1cGRhdGVUaW1lKGUpOwoKICAgICAgICAgICAgICAgIHNlbGYuX2RlYm91bmNlZENoYW5nZSgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgaWYgKCFpc1RpbWVPYmopIGJyZWFrOwogICAgICAgICAgICAgIHZhciBlbGVtcyA9IFtzZWxmLmhvdXJFbGVtZW50LCBzZWxmLm1pbnV0ZUVsZW1lbnQsIHNlbGYuc2Vjb25kRWxlbWVudCwgc2VsZi5hbVBNXS5maWx0ZXIoZnVuY3Rpb24gKHgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB4OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHZhciBpID0gZWxlbXMuaW5kZXhPZihlLnRhcmdldCk7CgogICAgICAgICAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IGVsZW1zW2kgKyAoZS5zaGlmdEtleSA/IC0xIDogMSldOwoKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgIHRhcmdldC5mb2N1cygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGYuYW1QTSAhPT0gdW5kZWZpbmVkICYmIGUudGFyZ2V0ID09PSBzZWxmLmFtUE0pIHsKICAgICAgICAgIHN3aXRjaCAoZS5rZXkpIHsKICAgICAgICAgICAgY2FzZSBzZWxmLmwxMG4uYW1QTVswXS5jaGFyQXQoMCk6CiAgICAgICAgICAgIGNhc2Ugc2VsZi5sMTBuLmFtUE1bMF0uY2hhckF0KDApLnRvTG93ZXJDYXNlKCk6CiAgICAgICAgICAgICAgc2VsZi5hbVBNLnRleHRDb250ZW50ID0gc2VsZi5sMTBuLmFtUE1bMF07CiAgICAgICAgICAgICAgc2V0SG91cnNGcm9tSW5wdXRzKCk7CiAgICAgICAgICAgICAgdXBkYXRlVmFsdWUoKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2Ugc2VsZi5sMTBuLmFtUE1bMV0uY2hhckF0KDApOgogICAgICAgICAgICBjYXNlIHNlbGYubDEwbi5hbVBNWzFdLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpOgogICAgICAgICAgICAgIHNlbGYuYW1QTS50ZXh0Q29udGVudCA9IHNlbGYubDEwbi5hbVBNWzFdOwogICAgICAgICAgICAgIHNldEhvdXJzRnJvbUlucHV0cygpOwogICAgICAgICAgICAgIHVwZGF0ZVZhbHVlKCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uS2V5RG93biIsIGUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBvbk1vdXNlT3ZlcihlbGVtKSB7CiAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggIT09IDEgfHwgIWVsZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCJmbGF0cGlja3ItZGF5IikgfHwgZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoImRpc2FibGVkIikpIHJldHVybjsKICAgICAgICB2YXIgaG92ZXJEYXRlID0gZWxlbS5kYXRlT2JqLmdldFRpbWUoKSwKICAgICAgICAgICAgaW5pdGlhbERhdGUgPSBzZWxmLnBhcnNlRGF0ZShzZWxmLnNlbGVjdGVkRGF0ZXNbMF0sIHVuZGVmaW5lZCwgdHJ1ZSkuZ2V0VGltZSgpLAogICAgICAgICAgICByYW5nZVN0YXJ0RGF0ZSA9IE1hdGgubWluKGhvdmVyRGF0ZSwgc2VsZi5zZWxlY3RlZERhdGVzWzBdLmdldFRpbWUoKSksCiAgICAgICAgICAgIHJhbmdlRW5kRGF0ZSA9IE1hdGgubWF4KGhvdmVyRGF0ZSwgc2VsZi5zZWxlY3RlZERhdGVzWzBdLmdldFRpbWUoKSk7CiAgICAgICAgdmFyIGNvbnRhaW5zRGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICB2YXIgbWluUmFuZ2UgPSAwLAogICAgICAgICAgICBtYXhSYW5nZSA9IDA7CgogICAgICAgIGZvciAodmFyIHQgPSByYW5nZVN0YXJ0RGF0ZTsgdCA8IHJhbmdlRW5kRGF0ZTsgdCArPSBkdXJhdGlvbi5EQVkpIHsKICAgICAgICAgIGlmICghaXNFbmFibGVkKG5ldyBEYXRlKHQpLCB0cnVlKSkgewogICAgICAgICAgICBjb250YWluc0Rpc2FibGVkID0gY29udGFpbnNEaXNhYmxlZCB8fCB0ID4gcmFuZ2VTdGFydERhdGUgJiYgdCA8IHJhbmdlRW5kRGF0ZTsKICAgICAgICAgICAgaWYgKHQgPCBpbml0aWFsRGF0ZSAmJiAoIW1pblJhbmdlIHx8IHQgPiBtaW5SYW5nZSkpIG1pblJhbmdlID0gdDtlbHNlIGlmICh0ID4gaW5pdGlhbERhdGUgJiYgKCFtYXhSYW5nZSB8fCB0IDwgbWF4UmFuZ2UpKSBtYXhSYW5nZSA9IHQ7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciBtID0gMDsgbSA8IHNlbGYuY29uZmlnLnNob3dNb250aHM7IG0rKykgewogICAgICAgICAgdmFyIG1vbnRoID0gc2VsZi5kYXlzQ29udGFpbmVyLmNoaWxkcmVuW21dOwogICAgICAgICAgdmFyIHByZXZNb250aCA9IHNlbGYuZGF5c0NvbnRhaW5lci5jaGlsZHJlblttIC0gMV07CgogICAgICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoaSwgbCkgewogICAgICAgICAgICB2YXIgZGF5RWxlbSA9IG1vbnRoLmNoaWxkcmVuW2ldLAogICAgICAgICAgICAgICAgZGF0ZSA9IGRheUVsZW0uZGF0ZU9iajsKICAgICAgICAgICAgdmFyIHRpbWVzdGFtcCA9IGRhdGUuZ2V0VGltZSgpOwogICAgICAgICAgICB2YXIgb3V0T2ZSYW5nZSA9IG1pblJhbmdlID4gMCAmJiB0aW1lc3RhbXAgPCBtaW5SYW5nZSB8fCBtYXhSYW5nZSA+IDAgJiYgdGltZXN0YW1wID4gbWF4UmFuZ2U7CgogICAgICAgICAgICBpZiAob3V0T2ZSYW5nZSkgewogICAgICAgICAgICAgIGRheUVsZW0uY2xhc3NMaXN0LmFkZCgibm90QWxsb3dlZCIpOwogICAgICAgICAgICAgIFsiaW5SYW5nZSIsICJzdGFydFJhbmdlIiwgImVuZFJhbmdlIl0uZm9yRWFjaChmdW5jdGlvbiAoYykgewogICAgICAgICAgICAgICAgZGF5RWxlbS5jbGFzc0xpc3QucmVtb3ZlKGMpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybiAiY29udGludWUiOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRhaW5zRGlzYWJsZWQgJiYgIW91dE9mUmFuZ2UpIHJldHVybiAiY29udGludWUiOwoKICAgICAgICAgICAgWyJzdGFydFJhbmdlIiwgImluUmFuZ2UiLCAiZW5kUmFuZ2UiLCAibm90QWxsb3dlZCJdLmZvckVhY2goZnVuY3Rpb24gKGMpIHsKICAgICAgICAgICAgICBkYXlFbGVtLmNsYXNzTGlzdC5yZW1vdmUoYyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoaG92ZXJEYXRlIDwgc2VsZi5zZWxlY3RlZERhdGVzWzBdLmdldFRpbWUoKSA/ICJzdGFydFJhbmdlIiA6ICJlbmRSYW5nZSIpOwoKICAgICAgICAgICAgaWYgKG1vbnRoLmNvbnRhaW5zKGVsZW0pIHx8ICEobSA+IDAgJiYgcHJldk1vbnRoICYmIHByZXZNb250aC5sYXN0Q2hpbGQuZGF0ZU9iai5nZXRUaW1lKCkgPj0gdGltZXN0YW1wKSkgewogICAgICAgICAgICAgIGlmIChpbml0aWFsRGF0ZSA8IGhvdmVyRGF0ZSAmJiB0aW1lc3RhbXAgPT09IGluaXRpYWxEYXRlKSBkYXlFbGVtLmNsYXNzTGlzdC5hZGQoInN0YXJ0UmFuZ2UiKTtlbHNlIGlmIChpbml0aWFsRGF0ZSA+IGhvdmVyRGF0ZSAmJiB0aW1lc3RhbXAgPT09IGluaXRpYWxEYXRlKSBkYXlFbGVtLmNsYXNzTGlzdC5hZGQoImVuZFJhbmdlIik7CiAgICAgICAgICAgICAgaWYgKHRpbWVzdGFtcCA+PSBtaW5SYW5nZSAmJiAobWF4UmFuZ2UgPT09IDAgfHwgdGltZXN0YW1wIDw9IG1heFJhbmdlKSAmJiBpc0JldHdlZW4odGltZXN0YW1wLCBpbml0aWFsRGF0ZSwgaG92ZXJEYXRlKSkgZGF5RWxlbS5jbGFzc0xpc3QuYWRkKCJpblJhbmdlIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBtb250aC5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgdmFyIF9yZXQgPSBfbG9vcChpLCBsKTsKCiAgICAgICAgICAgIGlmIChfcmV0ID09PSAiY29udGludWUiKSBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG9uUmVzaXplKCkgewogICAgICAgIGlmIChzZWxmLmlzT3BlbiAmJiAhc2VsZi5jb25maWcuc3RhdGljICYmICFzZWxmLmNvbmZpZy5pbmxpbmUpIHBvc2l0aW9uQ2FsZW5kYXIoKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gb3BlbihlLCBwb3NpdGlvbkVsZW1lbnQpIHsKICAgICAgICBpZiAocG9zaXRpb25FbGVtZW50ID09PSB2b2lkIDApIHsKICAgICAgICAgIHBvc2l0aW9uRWxlbWVudCA9IHNlbGYuX2lucHV0OwogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGYuaXNNb2JpbGUgPT09IHRydWUpIHsKICAgICAgICAgIGlmIChlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgZS50YXJnZXQgJiYgZS50YXJnZXQuYmx1cigpOwogICAgICAgICAgfQoKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBzZWxmLm1vYmlsZUlucHV0ICE9PSB1bmRlZmluZWQgJiYgc2VsZi5tb2JpbGVJbnB1dC5mb2N1cygpOwogICAgICAgICAgfSwgMCk7CiAgICAgICAgICB0cmlnZ2VyRXZlbnQoIm9uT3BlbiIpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGYuX2lucHV0LmRpc2FibGVkIHx8IHNlbGYuY29uZmlnLmlubGluZSkgcmV0dXJuOwogICAgICAgIHZhciB3YXNPcGVuID0gc2VsZi5pc09wZW47CiAgICAgICAgc2VsZi5pc09wZW4gPSB0cnVlOwoKICAgICAgICBpZiAoIXdhc09wZW4pIHsKICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuY2xhc3NMaXN0LmFkZCgib3BlbiIpOwoKICAgICAgICAgIHNlbGYuX2lucHV0LmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOwoKICAgICAgICAgIHRyaWdnZXJFdmVudCgib25PcGVuIik7CiAgICAgICAgICBwb3NpdGlvbkNhbGVuZGFyKHBvc2l0aW9uRWxlbWVudCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5jb25maWcuZW5hYmxlVGltZSA9PT0gdHJ1ZSAmJiBzZWxmLmNvbmZpZy5ub0NhbGVuZGFyID09PSB0cnVlKSB7CiAgICAgICAgICBpZiAoc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBzZWxmLnNldERhdGUoc2VsZi5jb25maWcubWluRGF0ZSAhPT0gdW5kZWZpbmVkID8gbmV3IERhdGUoc2VsZi5jb25maWcubWluRGF0ZS5nZXRUaW1lKCkpIDogbmV3IERhdGUoKSwgZmFsc2UpOwogICAgICAgICAgICBzZXREZWZhdWx0SG91cnMoKTsKICAgICAgICAgICAgdXBkYXRlVmFsdWUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc2VsZi5jb25maWcuYWxsb3dJbnB1dCA9PT0gZmFsc2UgJiYgKGUgPT09IHVuZGVmaW5lZCB8fCAhc2VsZi50aW1lQ29udGFpbmVyLmNvbnRhaW5zKGUucmVsYXRlZFRhcmdldCkpKSB7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBzZWxmLmhvdXJFbGVtZW50LnNlbGVjdCgpOwogICAgICAgICAgICB9LCA1MCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBtaW5NYXhEYXRlU2V0dGVyKHR5cGUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGRhdGUpIHsKICAgICAgICAgIHZhciBkYXRlT2JqID0gc2VsZi5jb25maWdbIl8iICsgdHlwZSArICJEYXRlIl0gPSBzZWxmLnBhcnNlRGF0ZShkYXRlLCBzZWxmLmNvbmZpZy5kYXRlRm9ybWF0KTsKICAgICAgICAgIHZhciBpbnZlcnNlRGF0ZU9iaiA9IHNlbGYuY29uZmlnWyJfIiArICh0eXBlID09PSAibWluIiA/ICJtYXgiIDogIm1pbiIpICsgIkRhdGUiXTsKCiAgICAgICAgICBpZiAoZGF0ZU9iaiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHNlbGZbdHlwZSA9PT0gIm1pbiIgPyAibWluRGF0ZUhhc1RpbWUiIDogIm1heERhdGVIYXNUaW1lIl0gPSBkYXRlT2JqLmdldEhvdXJzKCkgPiAwIHx8IGRhdGVPYmouZ2V0TWludXRlcygpID4gMCB8fCBkYXRlT2JqLmdldFNlY29uZHMoKSA+IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcykgewogICAgICAgICAgICBzZWxmLnNlbGVjdGVkRGF0ZXMgPSBzZWxmLnNlbGVjdGVkRGF0ZXMuZmlsdGVyKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGlzRW5hYmxlZChkKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmICghc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCAmJiB0eXBlID09PSAibWluIikgc2V0SG91cnNGcm9tRGF0ZShkYXRlT2JqKTsKICAgICAgICAgICAgdXBkYXRlVmFsdWUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc2VsZi5kYXlzQ29udGFpbmVyKSB7CiAgICAgICAgICAgIHJlZHJhdygpOwogICAgICAgICAgICBpZiAoZGF0ZU9iaiAhPT0gdW5kZWZpbmVkKSBzZWxmLmN1cnJlbnRZZWFyRWxlbWVudFt0eXBlXSA9IGRhdGVPYmouZ2V0RnVsbFllYXIoKS50b1N0cmluZygpO2Vsc2Ugc2VsZi5jdXJyZW50WWVhckVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKHR5cGUpOwogICAgICAgICAgICBzZWxmLmN1cnJlbnRZZWFyRWxlbWVudC5kaXNhYmxlZCA9ICEhaW52ZXJzZURhdGVPYmogJiYgZGF0ZU9iaiAhPT0gdW5kZWZpbmVkICYmIGludmVyc2VEYXRlT2JqLmdldEZ1bGxZZWFyKCkgPT09IGRhdGVPYmouZ2V0RnVsbFllYXIoKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBwYXJzZUNvbmZpZygpIHsKICAgICAgICB2YXIgYm9vbE9wdHMgPSBbIndyYXAiLCAid2Vla051bWJlcnMiLCAiYWxsb3dJbnB1dCIsICJjbGlja09wZW5zIiwgInRpbWVfMjRociIsICJlbmFibGVUaW1lIiwgIm5vQ2FsZW5kYXIiLCAiYWx0SW5wdXQiLCAic2hvcnRoYW5kQ3VycmVudE1vbnRoIiwgImlubGluZSIsICJzdGF0aWMiLCAiZW5hYmxlU2Vjb25kcyIsICJkaXNhYmxlTW9iaWxlIl07CiAgICAgICAgdmFyIGhvb2tzID0gWyJvbkNoYW5nZSIsICJvbkNsb3NlIiwgIm9uRGF5Q3JlYXRlIiwgIm9uRGVzdHJveSIsICJvbktleURvd24iLCAib25Nb250aENoYW5nZSIsICJvbk9wZW4iLCAib25QYXJzZUNvbmZpZyIsICJvblJlYWR5IiwgIm9uVmFsdWVVcGRhdGUiLCAib25ZZWFyQ2hhbmdlIiwgIm9uUHJlQ2FsZW5kYXJQb3NpdGlvbiJdOwogICAgICAgIHZhciB1c2VyQ29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgaW5zdGFuY2VDb25maWcsIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZWxlbWVudC5kYXRhc2V0IHx8IHt9KSkpOwogICAgICAgIHZhciBmb3JtYXRzJCQxID0ge307CiAgICAgICAgc2VsZi5jb25maWcucGFyc2VEYXRlID0gdXNlckNvbmZpZy5wYXJzZURhdGU7CiAgICAgICAgc2VsZi5jb25maWcuZm9ybWF0RGF0ZSA9IHVzZXJDb25maWcuZm9ybWF0RGF0ZTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5jb25maWcsICJlbmFibGUiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLl9lbmFibGU7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoZGF0ZXMpIHsKICAgICAgICAgICAgc2VsZi5jb25maWcuX2VuYWJsZSA9IHBhcnNlRGF0ZVJ1bGVzKGRhdGVzKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5jb25maWcsICJkaXNhYmxlIiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5fZGlzYWJsZTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChkYXRlcykgewogICAgICAgICAgICBzZWxmLmNvbmZpZy5fZGlzYWJsZSA9IHBhcnNlRGF0ZVJ1bGVzKGRhdGVzKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB2YXIgdGltZU1vZGUgPSB1c2VyQ29uZmlnLm1vZGUgPT09ICJ0aW1lIjsKCiAgICAgICAgaWYgKCF1c2VyQ29uZmlnLmRhdGVGb3JtYXQgJiYgKHVzZXJDb25maWcuZW5hYmxlVGltZSB8fCB0aW1lTW9kZSkpIHsKICAgICAgICAgIGZvcm1hdHMkJDEuZGF0ZUZvcm1hdCA9IHVzZXJDb25maWcubm9DYWxlbmRhciB8fCB0aW1lTW9kZSA/ICJIOmkiICsgKHVzZXJDb25maWcuZW5hYmxlU2Vjb25kcyA/ICI6UyIgOiAiIikgOiBmbGF0cGlja3IuZGVmYXVsdENvbmZpZy5kYXRlRm9ybWF0ICsgIiBIOmkiICsgKHVzZXJDb25maWcuZW5hYmxlU2Vjb25kcyA/ICI6UyIgOiAiIik7CiAgICAgICAgfQoKICAgICAgICBpZiAodXNlckNvbmZpZy5hbHRJbnB1dCAmJiAodXNlckNvbmZpZy5lbmFibGVUaW1lIHx8IHRpbWVNb2RlKSAmJiAhdXNlckNvbmZpZy5hbHRGb3JtYXQpIHsKICAgICAgICAgIGZvcm1hdHMkJDEuYWx0Rm9ybWF0ID0gdXNlckNvbmZpZy5ub0NhbGVuZGFyIHx8IHRpbWVNb2RlID8gImg6aSIgKyAodXNlckNvbmZpZy5lbmFibGVTZWNvbmRzID8gIjpTIEsiIDogIiBLIikgOiBmbGF0cGlja3IuZGVmYXVsdENvbmZpZy5hbHRGb3JtYXQgKyAoIiBoOmkiICsgKHVzZXJDb25maWcuZW5hYmxlU2Vjb25kcyA/ICI6UyIgOiAiIikgKyAiIEsiKTsKICAgICAgICB9CgogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLmNvbmZpZywgIm1pbkRhdGUiLCB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLl9taW5EYXRlOwogICAgICAgICAgfSwKICAgICAgICAgIHNldDogbWluTWF4RGF0ZVNldHRlcigibWluIikKICAgICAgICB9KTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5jb25maWcsICJtYXhEYXRlIiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5fbWF4RGF0ZTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXQ6IG1pbk1heERhdGVTZXR0ZXIoIm1heCIpCiAgICAgICAgfSk7CgogICAgICAgIHZhciBtaW5NYXhUaW1lU2V0dGVyID0gZnVuY3Rpb24gbWluTWF4VGltZVNldHRlcih0eXBlKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgICBzZWxmLmNvbmZpZ1t0eXBlID09PSAibWluIiA/ICJfbWluVGltZSIgOiAiX21heFRpbWUiXSA9IHNlbGYucGFyc2VEYXRlKHZhbCwgIkg6aSIpOwogICAgICAgICAgfTsKICAgICAgICB9OwoKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2VsZi5jb25maWcsICJtaW5UaW1lIiwgewogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5fbWluVGltZTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXQ6IG1pbk1heFRpbWVTZXR0ZXIoIm1pbiIpCiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlbGYuY29uZmlnLCAibWF4VGltZSIsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcuX21heFRpbWU7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0OiBtaW5NYXhUaW1lU2V0dGVyKCJtYXgiKQogICAgICAgIH0pOwoKICAgICAgICBpZiAodXNlckNvbmZpZy5tb2RlID09PSAidGltZSIpIHsKICAgICAgICAgIHNlbGYuY29uZmlnLm5vQ2FsZW5kYXIgPSB0cnVlOwogICAgICAgICAgc2VsZi5jb25maWcuZW5hYmxlVGltZSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBPYmplY3QuYXNzaWduKHNlbGYuY29uZmlnLCBmb3JtYXRzJCQxLCB1c2VyQ29uZmlnKTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBib29sT3B0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgc2VsZi5jb25maWdbYm9vbE9wdHNbaV1dID0gc2VsZi5jb25maWdbYm9vbE9wdHNbaV1dID09PSB0cnVlIHx8IHNlbGYuY29uZmlnW2Jvb2xPcHRzW2ldXSA9PT0gInRydWUiOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgX2kgPSBob29rcy5sZW5ndGg7IF9pLS07KSB7CiAgICAgICAgICBpZiAoc2VsZi5jb25maWdbaG9va3NbX2ldXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHNlbGYuY29uZmlnW2hvb2tzW19pXV0gPSBhcnJheWlmeShzZWxmLmNvbmZpZ1tob29rc1tfaV1dIHx8IFtdKS5tYXAoYmluZFRvSW5zdGFuY2UpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc2VsZi5pc01vYmlsZSA9ICFzZWxmLmNvbmZpZy5kaXNhYmxlTW9iaWxlICYmICFzZWxmLmNvbmZpZy5pbmxpbmUgJiYgc2VsZi5jb25maWcubW9kZSA9PT0gInNpbmdsZSIgJiYgIXNlbGYuY29uZmlnLmRpc2FibGUubGVuZ3RoICYmICFzZWxmLmNvbmZpZy5lbmFibGUubGVuZ3RoICYmICFzZWxmLmNvbmZpZy53ZWVrTnVtYmVycyAmJiAvQW5kcm9pZHx3ZWJPU3xpUGhvbmV8aVBhZHxpUG9kfEJsYWNrQmVycnl8SUVNb2JpbGV8T3BlcmEgTWluaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7CgogICAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IHNlbGYuY29uZmlnLnBsdWdpbnMubGVuZ3RoOyBfaTIrKykgewogICAgICAgICAgdmFyIHBsdWdpbkNvbmYgPSBzZWxmLmNvbmZpZy5wbHVnaW5zW19pMl0oc2VsZikgfHwge307CgogICAgICAgICAgZm9yICh2YXIga2V5IGluIHBsdWdpbkNvbmYpIHsKICAgICAgICAgICAgaWYgKH5ob29rcy5pbmRleE9mKGtleSkpIHsKICAgICAgICAgICAgICBzZWxmLmNvbmZpZ1trZXldID0gYXJyYXlpZnkocGx1Z2luQ29uZltrZXldKS5tYXAoYmluZFRvSW5zdGFuY2UpLmNvbmNhdChzZWxmLmNvbmZpZ1trZXldKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdXNlckNvbmZpZ1trZXldID09PSAidW5kZWZpbmVkIikgc2VsZi5jb25maWdba2V5XSA9IHBsdWdpbkNvbmZba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRyaWdnZXJFdmVudCgib25QYXJzZUNvbmZpZyIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzZXR1cExvY2FsZSgpIHsKICAgICAgICBpZiAodHlwZW9mIHNlbGYuY29uZmlnLmxvY2FsZSAhPT0gIm9iamVjdCIgJiYgdHlwZW9mIGZsYXRwaWNrci5sMTBuc1tzZWxmLmNvbmZpZy5sb2NhbGVdID09PSAidW5kZWZpbmVkIikgc2VsZi5jb25maWcuZXJyb3JIYW5kbGVyKG5ldyBFcnJvcigiZmxhdHBpY2tyOiBpbnZhbGlkIGxvY2FsZSAiICsgc2VsZi5jb25maWcubG9jYWxlKSk7CiAgICAgICAgc2VsZi5sMTBuID0gT2JqZWN0LmFzc2lnbih7fSwgZmxhdHBpY2tyLmwxMG5zLmRlZmF1bHQsIHR5cGVvZiBzZWxmLmNvbmZpZy5sb2NhbGUgPT09ICJvYmplY3QiID8gc2VsZi5jb25maWcubG9jYWxlIDogc2VsZi5jb25maWcubG9jYWxlICE9PSAiZGVmYXVsdCIgPyBmbGF0cGlja3IubDEwbnNbc2VsZi5jb25maWcubG9jYWxlXSA6IHVuZGVmaW5lZCk7CiAgICAgICAgdG9rZW5SZWdleC5LID0gIigiICsgc2VsZi5sMTBuLmFtUE1bMF0gKyAifCIgKyBzZWxmLmwxMG4uYW1QTVsxXSArICJ8IiArIHNlbGYubDEwbi5hbVBNWzBdLnRvTG93ZXJDYXNlKCkgKyAifCIgKyBzZWxmLmwxMG4uYW1QTVsxXS50b0xvd2VyQ2FzZSgpICsgIikiOwogICAgICAgIHNlbGYuZm9ybWF0RGF0ZSA9IGNyZWF0ZURhdGVGb3JtYXR0ZXIoc2VsZik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHBvc2l0aW9uQ2FsZW5kYXIoY3VzdG9tUG9zaXRpb25FbGVtZW50KSB7CiAgICAgICAgaWYgKHNlbGYuY2FsZW5kYXJDb250YWluZXIgPT09IHVuZGVmaW5lZCkgcmV0dXJuOwogICAgICAgIHRyaWdnZXJFdmVudCgib25QcmVDYWxlbmRhclBvc2l0aW9uIik7CiAgICAgICAgdmFyIHBvc2l0aW9uRWxlbWVudCA9IGN1c3RvbVBvc2l0aW9uRWxlbWVudCB8fCBzZWxmLl9wb3NpdGlvbkVsZW1lbnQ7CiAgICAgICAgdmFyIGNhbGVuZGFySGVpZ2h0ID0gQXJyYXkucHJvdG90eXBlLnJlZHVjZS5jYWxsKHNlbGYuY2FsZW5kYXJDb250YWluZXIuY2hpbGRyZW4sIGZ1bmN0aW9uIChhY2MsIGNoaWxkKSB7CiAgICAgICAgICByZXR1cm4gYWNjICsgY2hpbGQub2Zmc2V0SGVpZ2h0OwogICAgICAgIH0sIDApLAogICAgICAgICAgICBjYWxlbmRhcldpZHRoID0gc2VsZi5jYWxlbmRhckNvbnRhaW5lci5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgY29uZmlnUG9zID0gc2VsZi5jb25maWcucG9zaXRpb24uc3BsaXQoIiAiKSwKICAgICAgICAgICAgY29uZmlnUG9zVmVydGljYWwgPSBjb25maWdQb3NbMF0sCiAgICAgICAgICAgIGNvbmZpZ1Bvc0hvcml6b250YWwgPSBjb25maWdQb3MubGVuZ3RoID4gMSA/IGNvbmZpZ1Bvc1sxXSA6IG51bGwsCiAgICAgICAgICAgIGlucHV0Qm91bmRzID0gcG9zaXRpb25FbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLAogICAgICAgICAgICBkaXN0YW5jZUZyb21Cb3R0b20gPSB3aW5kb3cuaW5uZXJIZWlnaHQgLSBpbnB1dEJvdW5kcy5ib3R0b20sCiAgICAgICAgICAgIHNob3dPblRvcCA9IGNvbmZpZ1Bvc1ZlcnRpY2FsID09PSAiYWJvdmUiIHx8IGNvbmZpZ1Bvc1ZlcnRpY2FsICE9PSAiYmVsb3ciICYmIGRpc3RhbmNlRnJvbUJvdHRvbSA8IGNhbGVuZGFySGVpZ2h0ICYmIGlucHV0Qm91bmRzLnRvcCA+IGNhbGVuZGFySGVpZ2h0OwogICAgICAgIHZhciB0b3AgPSB3aW5kb3cucGFnZVlPZmZzZXQgKyBpbnB1dEJvdW5kcy50b3AgKyAoIXNob3dPblRvcCA/IHBvc2l0aW9uRWxlbWVudC5vZmZzZXRIZWlnaHQgKyAyIDogLWNhbGVuZGFySGVpZ2h0IC0gMik7CiAgICAgICAgdG9nZ2xlQ2xhc3Moc2VsZi5jYWxlbmRhckNvbnRhaW5lciwgImFycm93VG9wIiwgIXNob3dPblRvcCk7CiAgICAgICAgdG9nZ2xlQ2xhc3Moc2VsZi5jYWxlbmRhckNvbnRhaW5lciwgImFycm93Qm90dG9tIiwgc2hvd09uVG9wKTsKICAgICAgICBpZiAoc2VsZi5jb25maWcuaW5saW5lKSByZXR1cm47CiAgICAgICAgdmFyIGxlZnQgPSB3aW5kb3cucGFnZVhPZmZzZXQgKyBpbnB1dEJvdW5kcy5sZWZ0IC0gKGNvbmZpZ1Bvc0hvcml6b250YWwgIT0gbnVsbCAmJiBjb25maWdQb3NIb3Jpem9udGFsID09PSAiY2VudGVyIiA/IChjYWxlbmRhcldpZHRoIC0gaW5wdXRCb3VuZHMud2lkdGgpIC8gMiA6IDApOwogICAgICAgIHZhciByaWdodCA9IHdpbmRvdy5kb2N1bWVudC5ib2R5Lm9mZnNldFdpZHRoIC0gaW5wdXRCb3VuZHMucmlnaHQ7CiAgICAgICAgdmFyIHJpZ2h0TW9zdCA9IGxlZnQgKyBjYWxlbmRhcldpZHRoID4gd2luZG93LmRvY3VtZW50LmJvZHkub2Zmc2V0V2lkdGg7CiAgICAgICAgdG9nZ2xlQ2xhc3Moc2VsZi5jYWxlbmRhckNvbnRhaW5lciwgInJpZ2h0TW9zdCIsIHJpZ2h0TW9zdCk7CiAgICAgICAgaWYgKHNlbGYuY29uZmlnLnN0YXRpYykgcmV0dXJuOwogICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuc3R5bGUudG9wID0gdG9wICsgInB4IjsKCiAgICAgICAgaWYgKCFyaWdodE1vc3QpIHsKICAgICAgICAgIHNlbGYuY2FsZW5kYXJDb250YWluZXIuc3R5bGUubGVmdCA9IGxlZnQgKyAicHgiOwogICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS5yaWdodCA9ICJhdXRvIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gImF1dG8iOwogICAgICAgICAgc2VsZi5jYWxlbmRhckNvbnRhaW5lci5zdHlsZS5yaWdodCA9IHJpZ2h0ICsgInB4IjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHJlZHJhdygpIHsKICAgICAgICBpZiAoc2VsZi5jb25maWcubm9DYWxlbmRhciB8fCBzZWxmLmlzTW9iaWxlKSByZXR1cm47CiAgICAgICAgdXBkYXRlTmF2aWdhdGlvbkN1cnJlbnRNb250aCgpOwogICAgICAgIGJ1aWxkRGF5cygpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBmb2N1c0FuZENsb3NlKCkgewogICAgICAgIHNlbGYuX2lucHV0LmZvY3VzKCk7CgogICAgICAgIGlmICh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIikgIT09IC0xIHx8IG5hdmlnYXRvci5tc01heFRvdWNoUG9pbnRzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHNldFRpbWVvdXQoc2VsZi5jbG9zZSwgMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNlbGYuY2xvc2UoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHNlbGVjdERhdGUoZSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICB2YXIgaXNTZWxlY3RhYmxlID0gZnVuY3Rpb24gaXNTZWxlY3RhYmxlKGRheSkgewogICAgICAgICAgcmV0dXJuIGRheS5jbGFzc0xpc3QgJiYgZGF5LmNsYXNzTGlzdC5jb250YWlucygiZmxhdHBpY2tyLWRheSIpICYmICFkYXkuY2xhc3NMaXN0LmNvbnRhaW5zKCJkaXNhYmxlZCIpICYmICFkYXkuY2xhc3NMaXN0LmNvbnRhaW5zKCJub3RBbGxvd2VkIik7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIHQgPSBmaW5kUGFyZW50KGUudGFyZ2V0LCBpc1NlbGVjdGFibGUpOwogICAgICAgIGlmICh0ID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgICAgICB2YXIgdGFyZ2V0ID0gdDsKICAgICAgICB2YXIgc2VsZWN0ZWREYXRlID0gc2VsZi5sYXRlc3RTZWxlY3RlZERhdGVPYmogPSBuZXcgRGF0ZSh0YXJnZXQuZGF0ZU9iai5nZXRUaW1lKCkpOwogICAgICAgIHZhciBzaG91bGRDaGFuZ2VNb250aCA9IChzZWxlY3RlZERhdGUuZ2V0TW9udGgoKSA8IHNlbGYuY3VycmVudE1vbnRoIHx8IHNlbGVjdGVkRGF0ZS5nZXRNb250aCgpID4gc2VsZi5jdXJyZW50TW9udGggKyBzZWxmLmNvbmZpZy5zaG93TW9udGhzIC0gMSkgJiYgc2VsZi5jb25maWcubW9kZSAhPT0gInJhbmdlIjsKICAgICAgICBzZWxmLnNlbGVjdGVkRGF0ZUVsZW0gPSB0YXJnZXQ7CiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1vZGUgPT09ICJzaW5nbGUiKSBzZWxmLnNlbGVjdGVkRGF0ZXMgPSBbc2VsZWN0ZWREYXRlXTtlbHNlIGlmIChzZWxmLmNvbmZpZy5tb2RlID09PSAibXVsdGlwbGUiKSB7CiAgICAgICAgICB2YXIgc2VsZWN0ZWRJbmRleCA9IGlzRGF0ZVNlbGVjdGVkKHNlbGVjdGVkRGF0ZSk7CiAgICAgICAgICBpZiAoc2VsZWN0ZWRJbmRleCkgc2VsZi5zZWxlY3RlZERhdGVzLnNwbGljZShwYXJzZUludChzZWxlY3RlZEluZGV4KSwgMSk7ZWxzZSBzZWxmLnNlbGVjdGVkRGF0ZXMucHVzaChzZWxlY3RlZERhdGUpOwogICAgICAgIH0gZWxzZSBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIikgewogICAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPT09IDIpIHNlbGYuY2xlYXIoZmFsc2UpOwogICAgICAgICAgc2VsZi5zZWxlY3RlZERhdGVzLnB1c2goc2VsZWN0ZWREYXRlKTsKICAgICAgICAgIGlmIChjb21wYXJlRGF0ZXMoc2VsZWN0ZWREYXRlLCBzZWxmLnNlbGVjdGVkRGF0ZXNbMF0sIHRydWUpICE9PSAwKSBzZWxmLnNlbGVjdGVkRGF0ZXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYS5nZXRUaW1lKCkgLSBiLmdldFRpbWUoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBzZXRIb3Vyc0Zyb21JbnB1dHMoKTsKCiAgICAgICAgaWYgKHNob3VsZENoYW5nZU1vbnRoKSB7CiAgICAgICAgICB2YXIgaXNOZXdZZWFyID0gc2VsZi5jdXJyZW50WWVhciAhPT0gc2VsZWN0ZWREYXRlLmdldEZ1bGxZZWFyKCk7CiAgICAgICAgICBzZWxmLmN1cnJlbnRZZWFyID0gc2VsZWN0ZWREYXRlLmdldEZ1bGxZZWFyKCk7CiAgICAgICAgICBzZWxmLmN1cnJlbnRNb250aCA9IHNlbGVjdGVkRGF0ZS5nZXRNb250aCgpOwogICAgICAgICAgaWYgKGlzTmV3WWVhcikgdHJpZ2dlckV2ZW50KCJvblllYXJDaGFuZ2UiKTsKICAgICAgICAgIHRyaWdnZXJFdmVudCgib25Nb250aENoYW5nZSIpOwogICAgICAgIH0KCiAgICAgICAgdXBkYXRlTmF2aWdhdGlvbkN1cnJlbnRNb250aCgpOwogICAgICAgIGJ1aWxkRGF5cygpOwogICAgICAgIHNldERlZmF1bHRIb3VycygpOwogICAgICAgIHVwZGF0ZVZhbHVlKCk7CiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmVuYWJsZVRpbWUpIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHNlbGYuc2hvd1RpbWVJbnB1dCA9IHRydWU7CiAgICAgICAgfSwgNTApOwoKICAgICAgICBpZiAoc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIikgewogICAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgb25Nb3VzZU92ZXIodGFyZ2V0KTsKICAgICAgICAgIH0gZWxzZSB1cGRhdGVOYXZpZ2F0aW9uQ3VycmVudE1vbnRoKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXNob3VsZENoYW5nZU1vbnRoICYmIHNlbGYuY29uZmlnLm1vZGUgIT09ICJyYW5nZSIgJiYgc2VsZi5jb25maWcuc2hvd01vbnRocyA9PT0gMSkgZm9jdXNPbkRheUVsZW0odGFyZ2V0KTtlbHNlIHNlbGYuc2VsZWN0ZWREYXRlRWxlbSAmJiBzZWxmLnNlbGVjdGVkRGF0ZUVsZW0uZm9jdXMoKTsKICAgICAgICBpZiAoc2VsZi5ob3VyRWxlbWVudCAhPT0gdW5kZWZpbmVkKSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBzZWxmLmhvdXJFbGVtZW50ICE9PSB1bmRlZmluZWQgJiYgc2VsZi5ob3VyRWxlbWVudC5zZWxlY3QoKTsKICAgICAgICB9LCA0NTEpOwoKICAgICAgICBpZiAoc2VsZi5jb25maWcuY2xvc2VPblNlbGVjdCkgewogICAgICAgICAgdmFyIHNpbmdsZSA9IHNlbGYuY29uZmlnLm1vZGUgPT09ICJzaW5nbGUiICYmICFzZWxmLmNvbmZpZy5lbmFibGVUaW1lOwogICAgICAgICAgdmFyIHJhbmdlID0gc2VsZi5jb25maWcubW9kZSA9PT0gInJhbmdlIiAmJiBzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID09PSAyICYmICFzZWxmLmNvbmZpZy5lbmFibGVUaW1lOwoKICAgICAgICAgIGlmIChzaW5nbGUgfHwgcmFuZ2UpIHsKICAgICAgICAgICAgZm9jdXNBbmRDbG9zZSgpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdHJpZ2dlckNoYW5nZSgpOwogICAgICB9CgogICAgICB2YXIgQ0FMTEJBQ0tTID0gewogICAgICAgIGxvY2FsZTogW3NldHVwTG9jYWxlLCB1cGRhdGVXZWVrZGF5c10sCiAgICAgICAgc2hvd01vbnRoczogW2J1aWxkTW9udGhzLCBzZXRDYWxlbmRhcldpZHRoLCBidWlsZFdlZWtkYXlzXQogICAgICB9OwoKICAgICAgZnVuY3Rpb24gc2V0KG9wdGlvbiwgdmFsdWUpIHsKICAgICAgICBpZiAob3B0aW9uICE9PSBudWxsICYmIHR5cGVvZiBvcHRpb24gPT09ICJvYmplY3QiKSBPYmplY3QuYXNzaWduKHNlbGYuY29uZmlnLCBvcHRpb24pO2Vsc2UgewogICAgICAgICAgc2VsZi5jb25maWdbb3B0aW9uXSA9IHZhbHVlOwogICAgICAgICAgaWYgKENBTExCQUNLU1tvcHRpb25dICE9PSB1bmRlZmluZWQpIENBTExCQUNLU1tvcHRpb25dLmZvckVhY2goZnVuY3Rpb24gKHgpIHsKICAgICAgICAgICAgcmV0dXJuIHgoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBzZWxmLnJlZHJhdygpOwogICAgICAgIGp1bXBUb0RhdGUoKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gc2V0U2VsZWN0ZWREYXRlKGlucHV0RGF0ZSwgZm9ybWF0KSB7CiAgICAgICAgdmFyIGRhdGVzID0gW107CiAgICAgICAgaWYgKGlucHV0RGF0ZSBpbnN0YW5jZW9mIEFycmF5KSBkYXRlcyA9IGlucHV0RGF0ZS5tYXAoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgIHJldHVybiBzZWxmLnBhcnNlRGF0ZShkLCBmb3JtYXQpOwogICAgICAgIH0pO2Vsc2UgaWYgKGlucHV0RGF0ZSBpbnN0YW5jZW9mIERhdGUgfHwgdHlwZW9mIGlucHV0RGF0ZSA9PT0gIm51bWJlciIpIGRhdGVzID0gW3NlbGYucGFyc2VEYXRlKGlucHV0RGF0ZSwgZm9ybWF0KV07ZWxzZSBpZiAodHlwZW9mIGlucHV0RGF0ZSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIHN3aXRjaCAoc2VsZi5jb25maWcubW9kZSkgewogICAgICAgICAgICBjYXNlICJzaW5nbGUiOgogICAgICAgICAgICBjYXNlICJ0aW1lIjoKICAgICAgICAgICAgICBkYXRlcyA9IFtzZWxmLnBhcnNlRGF0ZShpbnB1dERhdGUsIGZvcm1hdCldOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAibXVsdGlwbGUiOgogICAgICAgICAgICAgIGRhdGVzID0gaW5wdXREYXRlLnNwbGl0KHNlbGYuY29uZmlnLmNvbmp1bmN0aW9uKS5tYXAoZnVuY3Rpb24gKGRhdGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnBhcnNlRGF0ZShkYXRlLCBmb3JtYXQpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAicmFuZ2UiOgogICAgICAgICAgICAgIGRhdGVzID0gaW5wdXREYXRlLnNwbGl0KHNlbGYubDEwbi5yYW5nZVNlcGFyYXRvcikubWFwKGZ1bmN0aW9uIChkYXRlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5wYXJzZURhdGUoZGF0ZSwgZm9ybWF0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHNlbGYuY29uZmlnLmVycm9ySGFuZGxlcihuZXcgRXJyb3IoIkludmFsaWQgZGF0ZSBzdXBwbGllZDogIiArIEpTT04uc3RyaW5naWZ5KGlucHV0RGF0ZSkpKTsKICAgICAgICBzZWxmLnNlbGVjdGVkRGF0ZXMgPSBkYXRlcy5maWx0ZXIoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgIHJldHVybiBkIGluc3RhbmNlb2YgRGF0ZSAmJiBpc0VuYWJsZWQoZCwgZmFsc2UpOwogICAgICAgIH0pOwogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tb2RlID09PSAicmFuZ2UiKSBzZWxmLnNlbGVjdGVkRGF0ZXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgcmV0dXJuIGEuZ2V0VGltZSgpIC0gYi5nZXRUaW1lKCk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHNldERhdGUoZGF0ZSwgdHJpZ2dlckNoYW5nZSwgZm9ybWF0KSB7CiAgICAgICAgaWYgKHRyaWdnZXJDaGFuZ2UgPT09IHZvaWQgMCkgewogICAgICAgICAgdHJpZ2dlckNoYW5nZSA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGZvcm1hdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBmb3JtYXQgPSBzZWxmLmNvbmZpZy5kYXRlRm9ybWF0OwogICAgICAgIH0KCiAgICAgICAgaWYgKGRhdGUgIT09IDAgJiYgIWRhdGUgfHwgZGF0ZSBpbnN0YW5jZW9mIEFycmF5ICYmIGRhdGUubGVuZ3RoID09PSAwKSByZXR1cm4gc2VsZi5jbGVhcih0cmlnZ2VyQ2hhbmdlKTsKICAgICAgICBzZXRTZWxlY3RlZERhdGUoZGF0ZSwgZm9ybWF0KTsKICAgICAgICBzZWxmLnNob3dUaW1lSW5wdXQgPSBzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID4gMDsKICAgICAgICBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiA9IHNlbGYuc2VsZWN0ZWREYXRlc1swXTsKICAgICAgICBzZWxmLnJlZHJhdygpOwogICAgICAgIGp1bXBUb0RhdGUoKTsKICAgICAgICBzZXRIb3Vyc0Zyb21EYXRlKCk7CiAgICAgICAgdXBkYXRlVmFsdWUodHJpZ2dlckNoYW5nZSk7CiAgICAgICAgaWYgKHRyaWdnZXJDaGFuZ2UpIHRyaWdnZXJFdmVudCgib25DaGFuZ2UiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcGFyc2VEYXRlUnVsZXMoYXJyKSB7CiAgICAgICAgcmV0dXJuIGFyci5zbGljZSgpLm1hcChmdW5jdGlvbiAocnVsZSkgewogICAgICAgICAgaWYgKHR5cGVvZiBydWxlID09PSAic3RyaW5nIiB8fCB0eXBlb2YgcnVsZSA9PT0gIm51bWJlciIgfHwgcnVsZSBpbnN0YW5jZW9mIERhdGUpIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGYucGFyc2VEYXRlKHJ1bGUsIHVuZGVmaW5lZCwgdHJ1ZSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHJ1bGUgJiYgdHlwZW9mIHJ1bGUgPT09ICJvYmplY3QiICYmIHJ1bGUuZnJvbSAmJiBydWxlLnRvKSByZXR1cm4gewogICAgICAgICAgICBmcm9tOiBzZWxmLnBhcnNlRGF0ZShydWxlLmZyb20sIHVuZGVmaW5lZCksCiAgICAgICAgICAgIHRvOiBzZWxmLnBhcnNlRGF0ZShydWxlLnRvLCB1bmRlZmluZWQpCiAgICAgICAgICB9OwoKICAgICAgICAgIHJldHVybiBydWxlOwogICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAoeCkgewogICAgICAgICAgcmV0dXJuIHg7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHNldHVwRGF0ZXMoKSB7CiAgICAgICAgc2VsZi5zZWxlY3RlZERhdGVzID0gW107CiAgICAgICAgc2VsZi5ub3cgPSBzZWxmLnBhcnNlRGF0ZShzZWxmLmNvbmZpZy5ub3cpIHx8IG5ldyBEYXRlKCk7CiAgICAgICAgdmFyIHByZWxvYWRlZERhdGUgPSBzZWxmLmNvbmZpZy5kZWZhdWx0RGF0ZSB8fCAoc2VsZi5pbnB1dC5wbGFjZWhvbGRlci5sZW5ndGggPiAwICYmIHNlbGYuaW5wdXQudmFsdWUgPT09IHNlbGYuaW5wdXQucGxhY2Vob2xkZXIgPyBudWxsIDogc2VsZi5pbnB1dC52YWx1ZSk7CiAgICAgICAgaWYgKHByZWxvYWRlZERhdGUpIHNldFNlbGVjdGVkRGF0ZShwcmVsb2FkZWREYXRlLCBzZWxmLmNvbmZpZy5kYXRlRm9ybWF0KTsKICAgICAgICB2YXIgaW5pdGlhbERhdGUgPSBzZWxmLnNlbGVjdGVkRGF0ZXMubGVuZ3RoID4gMCA/IHNlbGYuc2VsZWN0ZWREYXRlc1swXSA6IHNlbGYuY29uZmlnLm1pbkRhdGUgJiYgc2VsZi5jb25maWcubWluRGF0ZS5nZXRUaW1lKCkgPiBzZWxmLm5vdy5nZXRUaW1lKCkgPyBzZWxmLmNvbmZpZy5taW5EYXRlIDogc2VsZi5jb25maWcubWF4RGF0ZSAmJiBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldFRpbWUoKSA8IHNlbGYubm93LmdldFRpbWUoKSA/IHNlbGYuY29uZmlnLm1heERhdGUgOiBzZWxmLm5vdzsKICAgICAgICBzZWxmLmN1cnJlbnRZZWFyID0gaW5pdGlhbERhdGUuZ2V0RnVsbFllYXIoKTsKICAgICAgICBzZWxmLmN1cnJlbnRNb250aCA9IGluaXRpYWxEYXRlLmdldE1vbnRoKCk7CiAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPiAwKSBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiA9IHNlbGYuc2VsZWN0ZWREYXRlc1swXTsKICAgICAgICBpZiAoc2VsZi5jb25maWcubWluVGltZSAhPT0gdW5kZWZpbmVkKSBzZWxmLmNvbmZpZy5taW5UaW1lID0gc2VsZi5wYXJzZURhdGUoc2VsZi5jb25maWcubWluVGltZSwgIkg6aSIpOwogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tYXhUaW1lICE9PSB1bmRlZmluZWQpIHNlbGYuY29uZmlnLm1heFRpbWUgPSBzZWxmLnBhcnNlRGF0ZShzZWxmLmNvbmZpZy5tYXhUaW1lLCAiSDppIik7CiAgICAgICAgc2VsZi5taW5EYXRlSGFzVGltZSA9ICEhc2VsZi5jb25maWcubWluRGF0ZSAmJiAoc2VsZi5jb25maWcubWluRGF0ZS5nZXRIb3VycygpID4gMCB8fCBzZWxmLmNvbmZpZy5taW5EYXRlLmdldE1pbnV0ZXMoKSA+IDAgfHwgc2VsZi5jb25maWcubWluRGF0ZS5nZXRTZWNvbmRzKCkgPiAwKTsKICAgICAgICBzZWxmLm1heERhdGVIYXNUaW1lID0gISFzZWxmLmNvbmZpZy5tYXhEYXRlICYmIChzZWxmLmNvbmZpZy5tYXhEYXRlLmdldEhvdXJzKCkgPiAwIHx8IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0TWludXRlcygpID4gMCB8fCBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldFNlY29uZHMoKSA+IDApOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZWxmLCAic2hvd1RpbWVJbnB1dCIsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2hvd1RpbWVJbnB1dDsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChib29sKSB7CiAgICAgICAgICAgIHNlbGYuX3Nob3dUaW1lSW5wdXQgPSBib29sOwogICAgICAgICAgICBpZiAoc2VsZi5jYWxlbmRhckNvbnRhaW5lcikgdG9nZ2xlQ2xhc3Moc2VsZi5jYWxlbmRhckNvbnRhaW5lciwgInNob3dUaW1lSW5wdXQiLCBib29sKTsKICAgICAgICAgICAgc2VsZi5pc09wZW4gJiYgcG9zaXRpb25DYWxlbmRhcigpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzZXR1cElucHV0cygpIHsKICAgICAgICBzZWxmLmlucHV0ID0gc2VsZi5jb25maWcud3JhcCA/IGVsZW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtaW5wdXRdIikgOiBlbGVtZW50OwoKICAgICAgICBpZiAoIXNlbGYuaW5wdXQpIHsKICAgICAgICAgIHNlbGYuY29uZmlnLmVycm9ySGFuZGxlcihuZXcgRXJyb3IoIkludmFsaWQgaW5wdXQgZWxlbWVudCBzcGVjaWZpZWQiKSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBzZWxmLmlucHV0Ll90eXBlID0gc2VsZi5pbnB1dC50eXBlOwogICAgICAgIHNlbGYuaW5wdXQudHlwZSA9ICJ0ZXh0IjsKICAgICAgICBzZWxmLmlucHV0LmNsYXNzTGlzdC5hZGQoImZsYXRwaWNrci1pbnB1dCIpOwogICAgICAgIHNlbGYuX2lucHV0ID0gc2VsZi5pbnB1dDsKCiAgICAgICAgaWYgKHNlbGYuY29uZmlnLmFsdElucHV0KSB7CiAgICAgICAgICBzZWxmLmFsdElucHV0ID0gY3JlYXRlRWxlbWVudChzZWxmLmlucHV0Lm5vZGVOYW1lLCBzZWxmLmlucHV0LmNsYXNzTmFtZSArICIgIiArIHNlbGYuY29uZmlnLmFsdElucHV0Q2xhc3MpOwogICAgICAgICAgc2VsZi5faW5wdXQgPSBzZWxmLmFsdElucHV0OwogICAgICAgICAgc2VsZi5hbHRJbnB1dC5wbGFjZWhvbGRlciA9IHNlbGYuaW5wdXQucGxhY2Vob2xkZXI7CiAgICAgICAgICBzZWxmLmFsdElucHV0LmRpc2FibGVkID0gc2VsZi5pbnB1dC5kaXNhYmxlZDsKICAgICAgICAgIHNlbGYuYWx0SW5wdXQucmVxdWlyZWQgPSBzZWxmLmlucHV0LnJlcXVpcmVkOwogICAgICAgICAgc2VsZi5hbHRJbnB1dC50YWJJbmRleCA9IHNlbGYuaW5wdXQudGFiSW5kZXg7CiAgICAgICAgICBzZWxmLmFsdElucHV0LnR5cGUgPSAidGV4dCI7CiAgICAgICAgICBzZWxmLmlucHV0LnNldEF0dHJpYnV0ZSgidHlwZSIsICJoaWRkZW4iKTsKICAgICAgICAgIGlmICghc2VsZi5jb25maWcuc3RhdGljICYmIHNlbGYuaW5wdXQucGFyZW50Tm9kZSkgc2VsZi5pbnB1dC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzZWxmLmFsdElucHV0LCBzZWxmLmlucHV0Lm5leHRTaWJsaW5nKTsKICAgICAgICB9CgogICAgICAgIGlmICghc2VsZi5jb25maWcuYWxsb3dJbnB1dCkgc2VsZi5faW5wdXQuc2V0QXR0cmlidXRlKCJyZWFkb25seSIsICJyZWFkb25seSIpOwogICAgICAgIHNlbGYuX3Bvc2l0aW9uRWxlbWVudCA9IHNlbGYuY29uZmlnLnBvc2l0aW9uRWxlbWVudCB8fCBzZWxmLl9pbnB1dDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gc2V0dXBNb2JpbGUoKSB7CiAgICAgICAgdmFyIGlucHV0VHlwZSA9IHNlbGYuY29uZmlnLmVuYWJsZVRpbWUgPyBzZWxmLmNvbmZpZy5ub0NhbGVuZGFyID8gInRpbWUiIDogImRhdGV0aW1lLWxvY2FsIiA6ICJkYXRlIjsKICAgICAgICBzZWxmLm1vYmlsZUlucHV0ID0gY3JlYXRlRWxlbWVudCgiaW5wdXQiLCBzZWxmLmlucHV0LmNsYXNzTmFtZSArICIgZmxhdHBpY2tyLW1vYmlsZSIpOwogICAgICAgIHNlbGYubW9iaWxlSW5wdXQuc3RlcCA9IHNlbGYuaW5wdXQuZ2V0QXR0cmlidXRlKCJzdGVwIikgfHwgImFueSI7CiAgICAgICAgc2VsZi5tb2JpbGVJbnB1dC50YWJJbmRleCA9IDE7CiAgICAgICAgc2VsZi5tb2JpbGVJbnB1dC50eXBlID0gaW5wdXRUeXBlOwogICAgICAgIHNlbGYubW9iaWxlSW5wdXQuZGlzYWJsZWQgPSBzZWxmLmlucHV0LmRpc2FibGVkOwogICAgICAgIHNlbGYubW9iaWxlSW5wdXQucmVxdWlyZWQgPSBzZWxmLmlucHV0LnJlcXVpcmVkOwogICAgICAgIHNlbGYubW9iaWxlSW5wdXQucGxhY2Vob2xkZXIgPSBzZWxmLmlucHV0LnBsYWNlaG9sZGVyOwogICAgICAgIHNlbGYubW9iaWxlRm9ybWF0U3RyID0gaW5wdXRUeXBlID09PSAiZGF0ZXRpbWUtbG9jYWwiID8gIlktbS1kXFxUSDppOlMiIDogaW5wdXRUeXBlID09PSAiZGF0ZSIgPyAiWS1tLWQiIDogIkg6aTpTIjsKCiAgICAgICAgaWYgKHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBzZWxmLm1vYmlsZUlucHV0LmRlZmF1bHRWYWx1ZSA9IHNlbGYubW9iaWxlSW5wdXQudmFsdWUgPSBzZWxmLmZvcm1hdERhdGUoc2VsZi5zZWxlY3RlZERhdGVzWzBdLCBzZWxmLm1vYmlsZUZvcm1hdFN0cik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5jb25maWcubWluRGF0ZSkgc2VsZi5tb2JpbGVJbnB1dC5taW4gPSBzZWxmLmZvcm1hdERhdGUoc2VsZi5jb25maWcubWluRGF0ZSwgIlktbS1kIik7CiAgICAgICAgaWYgKHNlbGYuY29uZmlnLm1heERhdGUpIHNlbGYubW9iaWxlSW5wdXQubWF4ID0gc2VsZi5mb3JtYXREYXRlKHNlbGYuY29uZmlnLm1heERhdGUsICJZLW0tZCIpOwogICAgICAgIHNlbGYuaW5wdXQudHlwZSA9ICJoaWRkZW4iOwogICAgICAgIGlmIChzZWxmLmFsdElucHV0ICE9PSB1bmRlZmluZWQpIHNlbGYuYWx0SW5wdXQudHlwZSA9ICJoaWRkZW4iOwoKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKHNlbGYuaW5wdXQucGFyZW50Tm9kZSkgc2VsZi5pbnB1dC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzZWxmLm1vYmlsZUlucHV0LCBzZWxmLmlucHV0Lm5leHRTaWJsaW5nKTsKICAgICAgICB9IGNhdGNoIChfYSkge30KCiAgICAgICAgYmluZChzZWxmLm1vYmlsZUlucHV0LCAiY2hhbmdlIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHNlbGYuc2V0RGF0ZShlLnRhcmdldC52YWx1ZSwgZmFsc2UsIHNlbGYubW9iaWxlRm9ybWF0U3RyKTsKICAgICAgICAgIHRyaWdnZXJFdmVudCgib25DaGFuZ2UiKTsKICAgICAgICAgIHRyaWdnZXJFdmVudCgib25DbG9zZSIpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBmdW5jdGlvbiB0b2dnbGUoZSkgewogICAgICAgIGlmIChzZWxmLmlzT3BlbiA9PT0gdHJ1ZSkgcmV0dXJuIHNlbGYuY2xvc2UoKTsKICAgICAgICBzZWxmLm9wZW4oZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHRyaWdnZXJFdmVudChldmVudCwgZGF0YSkgewogICAgICAgIHZhciBob29rcyA9IHNlbGYuY29uZmlnW2V2ZW50XTsKCiAgICAgICAgaWYgKGhvb2tzICE9PSB1bmRlZmluZWQgJiYgaG9va3MubGVuZ3RoID4gMCkgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGhvb2tzW2ldICYmIGkgPCBob29rcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBob29rc1tpXShzZWxmLnNlbGVjdGVkRGF0ZXMsIHNlbGYuaW5wdXQudmFsdWUsIHNlbGYsIGRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGV2ZW50ID09PSAib25DaGFuZ2UiKSB7CiAgICAgICAgICBzZWxmLmlucHV0LmRpc3BhdGNoRXZlbnQoY3JlYXRlRXZlbnQoImNoYW5nZSIpKTsKICAgICAgICAgIHNlbGYuaW5wdXQuZGlzcGF0Y2hFdmVudChjcmVhdGVFdmVudCgiaW5wdXQiKSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBjcmVhdGVFdmVudChuYW1lKSB7CiAgICAgICAgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgiRXZlbnQiKTsKICAgICAgICBlLmluaXRFdmVudChuYW1lLCB0cnVlLCB0cnVlKTsKICAgICAgICByZXR1cm4gZTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaXNEYXRlU2VsZWN0ZWQoZGF0ZSkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoY29tcGFyZURhdGVzKHNlbGYuc2VsZWN0ZWREYXRlc1tpXSwgZGF0ZSkgPT09IDApIHJldHVybiAiIiArIGk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGlzRGF0ZUluUmFuZ2UoZGF0ZSkgewogICAgICAgIGlmIChzZWxmLmNvbmZpZy5tb2RlICE9PSAicmFuZ2UiIHx8IHNlbGYuc2VsZWN0ZWREYXRlcy5sZW5ndGggPCAyKSByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIGNvbXBhcmVEYXRlcyhkYXRlLCBzZWxmLnNlbGVjdGVkRGF0ZXNbMF0pID49IDAgJiYgY29tcGFyZURhdGVzKGRhdGUsIHNlbGYuc2VsZWN0ZWREYXRlc1sxXSkgPD0gMDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gdXBkYXRlTmF2aWdhdGlvbkN1cnJlbnRNb250aCgpIHsKICAgICAgICBpZiAoc2VsZi5jb25maWcubm9DYWxlbmRhciB8fCBzZWxmLmlzTW9iaWxlIHx8ICFzZWxmLm1vbnRoTmF2KSByZXR1cm47CiAgICAgICAgc2VsZi55ZWFyRWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAoeWVhckVsZW1lbnQsIGkpIHsKICAgICAgICAgIHZhciBkID0gbmV3IERhdGUoc2VsZi5jdXJyZW50WWVhciwgc2VsZi5jdXJyZW50TW9udGgsIDEpOwogICAgICAgICAgZC5zZXRNb250aChzZWxmLmN1cnJlbnRNb250aCArIGkpOwogICAgICAgICAgc2VsZi5tb250aEVsZW1lbnRzW2ldLnRleHRDb250ZW50ID0gbW9udGhUb1N0cihkLmdldE1vbnRoKCksIHNlbGYuY29uZmlnLnNob3J0aGFuZEN1cnJlbnRNb250aCwgc2VsZi5sMTBuKSArICIgIjsKICAgICAgICAgIHllYXJFbGVtZW50LnZhbHVlID0gZC5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCk7CiAgICAgICAgfSk7CiAgICAgICAgc2VsZi5faGlkZVByZXZNb250aEFycm93ID0gc2VsZi5jb25maWcubWluRGF0ZSAhPT0gdW5kZWZpbmVkICYmIChzZWxmLmN1cnJlbnRZZWFyID09PSBzZWxmLmNvbmZpZy5taW5EYXRlLmdldEZ1bGxZZWFyKCkgPyBzZWxmLmN1cnJlbnRNb250aCA8PSBzZWxmLmNvbmZpZy5taW5EYXRlLmdldE1vbnRoKCkgOiBzZWxmLmN1cnJlbnRZZWFyIDwgc2VsZi5jb25maWcubWluRGF0ZS5nZXRGdWxsWWVhcigpKTsKICAgICAgICBzZWxmLl9oaWRlTmV4dE1vbnRoQXJyb3cgPSBzZWxmLmNvbmZpZy5tYXhEYXRlICE9PSB1bmRlZmluZWQgJiYgKHNlbGYuY3VycmVudFllYXIgPT09IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0RnVsbFllYXIoKSA/IHNlbGYuY3VycmVudE1vbnRoICsgMSA+IHNlbGYuY29uZmlnLm1heERhdGUuZ2V0TW9udGgoKSA6IHNlbGYuY3VycmVudFllYXIgPiBzZWxmLmNvbmZpZy5tYXhEYXRlLmdldEZ1bGxZZWFyKCkpOwogICAgICB9CgogICAgICBmdW5jdGlvbiB1cGRhdGVWYWx1ZSh0cmlnZ2VyQ2hhbmdlKSB7CiAgICAgICAgaWYgKHRyaWdnZXJDaGFuZ2UgPT09IHZvaWQgMCkgewogICAgICAgICAgdHJpZ2dlckNoYW5nZSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5zZWxlY3RlZERhdGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHNlbGYuY2xlYXIodHJpZ2dlckNoYW5nZSk7CgogICAgICAgIGlmIChzZWxmLm1vYmlsZUlucHV0ICE9PSB1bmRlZmluZWQgJiYgc2VsZi5tb2JpbGVGb3JtYXRTdHIpIHsKICAgICAgICAgIHNlbGYubW9iaWxlSW5wdXQudmFsdWUgPSBzZWxmLmxhdGVzdFNlbGVjdGVkRGF0ZU9iaiAhPT0gdW5kZWZpbmVkID8gc2VsZi5mb3JtYXREYXRlKHNlbGYubGF0ZXN0U2VsZWN0ZWREYXRlT2JqLCBzZWxmLm1vYmlsZUZvcm1hdFN0cikgOiAiIjsKICAgICAgICB9CgogICAgICAgIHZhciBqb2luQ2hhciA9IHNlbGYuY29uZmlnLm1vZGUgIT09ICJyYW5nZSIgPyBzZWxmLmNvbmZpZy5jb25qdW5jdGlvbiA6IHNlbGYubDEwbi5yYW5nZVNlcGFyYXRvcjsKICAgICAgICBzZWxmLmlucHV0LnZhbHVlID0gc2VsZi5zZWxlY3RlZERhdGVzLm1hcChmdW5jdGlvbiAoZE9iaikgewogICAgICAgICAgcmV0dXJuIHNlbGYuZm9ybWF0RGF0ZShkT2JqLCBzZWxmLmNvbmZpZy5kYXRlRm9ybWF0KTsKICAgICAgICB9KS5qb2luKGpvaW5DaGFyKTsKCiAgICAgICAgaWYgKHNlbGYuYWx0SW5wdXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgc2VsZi5hbHRJbnB1dC52YWx1ZSA9IHNlbGYuc2VsZWN0ZWREYXRlcy5tYXAoZnVuY3Rpb24gKGRPYmopIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZm9ybWF0RGF0ZShkT2JqLCBzZWxmLmNvbmZpZy5hbHRGb3JtYXQpOwogICAgICAgICAgfSkuam9pbihqb2luQ2hhcik7CiAgICAgICAgfQoKICAgICAgICBpZiAodHJpZ2dlckNoYW5nZSAhPT0gZmFsc2UpIHRyaWdnZXJFdmVudCgib25WYWx1ZVVwZGF0ZSIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBvbk1vbnRoTmF2Q2xpY2soZSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2YXIgaXNQcmV2TW9udGggPSBzZWxmLnByZXZNb250aE5hdi5jb250YWlucyhlLnRhcmdldCk7CiAgICAgICAgdmFyIGlzTmV4dE1vbnRoID0gc2VsZi5uZXh0TW9udGhOYXYuY29udGFpbnMoZS50YXJnZXQpOwoKICAgICAgICBpZiAoaXNQcmV2TW9udGggfHwgaXNOZXh0TW9udGgpIHsKICAgICAgICAgIGNoYW5nZU1vbnRoKGlzUHJldk1vbnRoID8gLTEgOiAxKTsKICAgICAgICB9IGVsc2UgaWYgKHNlbGYueWVhckVsZW1lbnRzLmluZGV4T2YoZS50YXJnZXQpID49IDApIHsKICAgICAgICAgIGUudGFyZ2V0LnNlbGVjdCgpOwogICAgICAgIH0gZWxzZSBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJhcnJvd1VwIikpIHsKICAgICAgICAgIHNlbGYuY2hhbmdlWWVhcihzZWxmLmN1cnJlbnRZZWFyICsgMSk7CiAgICAgICAgfSBlbHNlIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImFycm93RG93biIpKSB7CiAgICAgICAgICBzZWxmLmNoYW5nZVllYXIoc2VsZi5jdXJyZW50WWVhciAtIDEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gdGltZVdyYXBwZXIoZSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB2YXIgaXNLZXlEb3duID0gZS50eXBlID09PSAia2V5ZG93biIsCiAgICAgICAgICAgIGlucHV0ID0gZS50YXJnZXQ7CgogICAgICAgIGlmIChzZWxmLmFtUE0gIT09IHVuZGVmaW5lZCAmJiBlLnRhcmdldCA9PT0gc2VsZi5hbVBNKSB7CiAgICAgICAgICBzZWxmLmFtUE0udGV4dENvbnRlbnQgPSBzZWxmLmwxMG4uYW1QTVtpbnQoc2VsZi5hbVBNLnRleHRDb250ZW50ID09PSBzZWxmLmwxMG4uYW1QTVswXSldOwogICAgICAgIH0KCiAgICAgICAgdmFyIG1pbiA9IHBhcnNlRmxvYXQoaW5wdXQuZ2V0QXR0cmlidXRlKCJkYXRhLW1pbiIpKSwKICAgICAgICAgICAgbWF4ID0gcGFyc2VGbG9hdChpbnB1dC5nZXRBdHRyaWJ1dGUoImRhdGEtbWF4IikpLAogICAgICAgICAgICBzdGVwID0gcGFyc2VGbG9hdChpbnB1dC5nZXRBdHRyaWJ1dGUoImRhdGEtc3RlcCIpKSwKICAgICAgICAgICAgY3VyVmFsdWUgPSBwYXJzZUludChpbnB1dC52YWx1ZSwgMTApLAogICAgICAgICAgICBkZWx0YSA9IGUuZGVsdGEgfHwgKGlzS2V5RG93biA/IGUud2hpY2ggPT09IDM4ID8gMSA6IC0xIDogMCk7CiAgICAgICAgdmFyIG5ld1ZhbHVlID0gY3VyVmFsdWUgKyBzdGVwICogZGVsdGE7CgogICAgICAgIGlmICh0eXBlb2YgaW5wdXQudmFsdWUgIT09ICJ1bmRlZmluZWQiICYmIGlucHV0LnZhbHVlLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgdmFyIGlzSG91ckVsZW0gPSBpbnB1dCA9PT0gc2VsZi5ob3VyRWxlbWVudCwKICAgICAgICAgICAgICBpc01pbnV0ZUVsZW0gPSBpbnB1dCA9PT0gc2VsZi5taW51dGVFbGVtZW50OwoKICAgICAgICAgIGlmIChuZXdWYWx1ZSA8IG1pbikgewogICAgICAgICAgICBuZXdWYWx1ZSA9IG1heCArIG5ld1ZhbHVlICsgaW50KCFpc0hvdXJFbGVtKSArIChpbnQoaXNIb3VyRWxlbSkgJiYgaW50KCFzZWxmLmFtUE0pKTsKICAgICAgICAgICAgaWYgKGlzTWludXRlRWxlbSkgaW5jcmVtZW50TnVtSW5wdXQodW5kZWZpbmVkLCAtMSwgc2VsZi5ob3VyRWxlbWVudCk7CiAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbHVlID4gbWF4KSB7CiAgICAgICAgICAgIG5ld1ZhbHVlID0gaW5wdXQgPT09IHNlbGYuaG91ckVsZW1lbnQgPyBuZXdWYWx1ZSAtIG1heCAtIGludCghc2VsZi5hbVBNKSA6IG1pbjsKICAgICAgICAgICAgaWYgKGlzTWludXRlRWxlbSkgaW5jcmVtZW50TnVtSW5wdXQodW5kZWZpbmVkLCAxLCBzZWxmLmhvdXJFbGVtZW50KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc2VsZi5hbVBNICYmIGlzSG91ckVsZW0gJiYgKHN0ZXAgPT09IDEgPyBuZXdWYWx1ZSArIGN1clZhbHVlID09PSAyMyA6IE1hdGguYWJzKG5ld1ZhbHVlIC0gY3VyVmFsdWUpID4gc3RlcCkpIHsKICAgICAgICAgICAgc2VsZi5hbVBNLnRleHRDb250ZW50ID0gc2VsZi5sMTBuLmFtUE1baW50KHNlbGYuYW1QTS50ZXh0Q29udGVudCA9PT0gc2VsZi5sMTBuLmFtUE1bMF0pXTsKICAgICAgICAgIH0KCiAgICAgICAgICBpbnB1dC52YWx1ZSA9IHBhZChuZXdWYWx1ZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpbml0KCk7CiAgICAgIHJldHVybiBzZWxmOwogICAgfQoKICAgIGZ1bmN0aW9uIF9mbGF0cGlja3Iobm9kZUxpc3QsIGNvbmZpZykgewogICAgICB2YXIgbm9kZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChub2RlTGlzdCk7CiAgICAgIHZhciBpbnN0YW5jZXMgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKG5vZGUuZ2V0QXR0cmlidXRlKCJkYXRhLWZwLW9taXQiKSAhPT0gbnVsbCkgY29udGludWU7CgogICAgICAgICAgaWYgKG5vZGUuX2ZsYXRwaWNrciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIG5vZGUuX2ZsYXRwaWNrci5kZXN0cm95KCk7CgogICAgICAgICAgICBub2RlLl9mbGF0cGlja3IgPSB1bmRlZmluZWQ7CiAgICAgICAgICB9CgogICAgICAgICAgbm9kZS5fZmxhdHBpY2tyID0gRmxhdHBpY2tySW5zdGFuY2Uobm9kZSwgY29uZmlnIHx8IHt9KTsKICAgICAgICAgIGluc3RhbmNlcy5wdXNoKG5vZGUuX2ZsYXRwaWNrcik7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBpbnN0YW5jZXMubGVuZ3RoID09PSAxID8gaW5zdGFuY2VzWzBdIDogaW5zdGFuY2VzOwogICAgfQoKICAgIGlmICh0eXBlb2YgSFRNTEVsZW1lbnQgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIEhUTUxDb2xsZWN0aW9uLnByb3RvdHlwZS5mbGF0cGlja3IgPSBOb2RlTGlzdC5wcm90b3R5cGUuZmxhdHBpY2tyID0gZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgIHJldHVybiBfZmxhdHBpY2tyKHRoaXMsIGNvbmZpZyk7CiAgICAgIH07CgogICAgICBIVE1MRWxlbWVudC5wcm90b3R5cGUuZmxhdHBpY2tyID0gZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgIHJldHVybiBfZmxhdHBpY2tyKFt0aGlzXSwgY29uZmlnKTsKICAgICAgfTsKICAgIH0KCiAgICB2YXIgZmxhdHBpY2tyID0gZnVuY3Rpb24gZmxhdHBpY2tyKHNlbGVjdG9yLCBjb25maWcpIHsKICAgICAgaWYgKHNlbGVjdG9yIGluc3RhbmNlb2YgTm9kZUxpc3QpIHJldHVybiBfZmxhdHBpY2tyKHNlbGVjdG9yLCBjb25maWcpO2Vsc2UgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIpIHJldHVybiBfZmxhdHBpY2tyKHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKSwgY29uZmlnKTsKICAgICAgcmV0dXJuIF9mbGF0cGlja3IoW3NlbGVjdG9yXSwgY29uZmlnKTsKICAgIH07CgogICAgZmxhdHBpY2tyLmRlZmF1bHRDb25maWcgPSBkZWZhdWx0czsKICAgIGZsYXRwaWNrci5sMTBucyA9IHsKICAgICAgZW46IE9iamVjdC5hc3NpZ24oe30sIGVuZ2xpc2gpLAogICAgICBkZWZhdWx0OiBPYmplY3QuYXNzaWduKHt9LCBlbmdsaXNoKQogICAgfTsKCiAgICBmbGF0cGlja3IubG9jYWxpemUgPSBmdW5jdGlvbiAobDEwbikgewogICAgICBmbGF0cGlja3IubDEwbnMuZGVmYXVsdCA9IE9iamVjdC5hc3NpZ24oe30sIGZsYXRwaWNrci5sMTBucy5kZWZhdWx0LCBsMTBuKTsKICAgIH07CgogICAgZmxhdHBpY2tyLnNldERlZmF1bHRzID0gZnVuY3Rpb24gKGNvbmZpZykgewogICAgICBmbGF0cGlja3IuZGVmYXVsdENvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIGZsYXRwaWNrci5kZWZhdWx0Q29uZmlnLCBjb25maWcpOwogICAgfTsKCiAgICBmbGF0cGlja3IucGFyc2VEYXRlID0gY3JlYXRlRGF0ZVBhcnNlcih7fSk7CiAgICBmbGF0cGlja3IuZm9ybWF0RGF0ZSA9IGNyZWF0ZURhdGVGb3JtYXR0ZXIoe30pOwogICAgZmxhdHBpY2tyLmNvbXBhcmVEYXRlcyA9IGNvbXBhcmVEYXRlczsKCiAgICBpZiAodHlwZW9mIGpRdWVyeSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgalF1ZXJ5LmZuLmZsYXRwaWNrciA9IGZ1bmN0aW9uIChjb25maWcpIHsKICAgICAgICByZXR1cm4gX2ZsYXRwaWNrcih0aGlzLCBjb25maWcpOwogICAgICB9OwogICAgfQoKICAgIERhdGUucHJvdG90eXBlLmZwX2luY3IgPSBmdW5jdGlvbiAoZGF5cykgewogICAgICByZXR1cm4gbmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLCB0aGlzLmdldE1vbnRoKCksIHRoaXMuZ2V0RGF0ZSgpICsgKHR5cGVvZiBkYXlzID09PSAic3RyaW5nIiA/IHBhcnNlSW50KGRheXMsIDEwKSA6IGRheXMpKTsKICAgIH07CgogICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIHdpbmRvdy5mbGF0cGlja3IgPSBmbGF0cGlja3I7CiAgICB9CgogICAgcmV0dXJuIGZsYXRwaWNrcjsKCn0pKSk7Cjwvc2NyaXB0PgogIDwhLS1odHRwczovL2pvc2h1YWpvaG5zb24uY28udWsvQ2hvaWNlcy8tLT4KICA8IS0tPGxpbmsgaHJlZj0ic3R5bGVzaGVldHMvY2hvaWNlcy5jc3MiIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIC8+LS0+CiAgPHN0eWxlPgogICAgLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Cj0gICAgICAgICAgICBDaG9pY2VzICAgICAgICAgICAgPQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KLmNob2ljZXMgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBtYXJnaW4tYm90dG9tOiAyNHB4OwogIGZvbnQtc2l6ZTogMTJweDsKfQoKLmNob2ljZXM6Zm9jdXMgewogIG91dGxpbmU6IG5vbmU7Cn0KCi5jaG9pY2VzOmxhc3QtY2hpbGQgewogIG1hcmdpbi1ib3R0b206IDA7Cn0KCi5jaG9pY2VzLmlzLWRpc2FibGVkIC5jaG9pY2VzX19pbm5lciwKLmNob2ljZXMuaXMtZGlzYWJsZWQgLmNob2ljZXNfX2lucHV0IHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjRUFFQUVBOwogIGN1cnNvcjogbm90LWFsbG93ZWQ7CiAgdXNlci1zZWxlY3Q6IG5vbmU7Cn0KCi5jaG9pY2VzLmlzLWRpc2FibGVkIC5jaG9pY2VzX19pdGVtIHsKICBjdXJzb3I6IG5vdC1hbGxvd2VkOwp9CgouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0gewogIGN1cnNvcjogcG9pbnRlcjsKfQoKLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdIC5jaG9pY2VzX19pbm5lciB7CiAgcGFkZGluZy1ib3R0b206IDcuNXB4Owp9CgouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0gLmNob2ljZXNfX2lucHV0IHsKICBkaXNwbGF5OiBibG9jazsKICB3aWR0aDogMTAwJTsKICBwYWRkaW5nOiAxMHB4OwogIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjREREREREOwogIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7CiAgbWFyZ2luOiAwOwp9CgouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0gLmNob2ljZXNfX2J1dHRvbiB7CiAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1qRWlJR2hsYVdkb2REMGlNakVpSUhacFpYZENiM2c5SWpBZ01DQXlNU0F5TVNJZ2VHMXNibk05SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01EQXZjM1puSWo0OFp5Qm1hV3hzUFNJak1EQXdJaUJtYVd4c0xYSjFiR1U5SW1WMlpXNXZaR1FpUGp4d1lYUm9JR1E5SWsweUxqVTVNaTR3TkRSc01UZ3VNelkwSURFNExqTTJOQzB5TGpVME9DQXlMalUwT0V3dU1EUTBJREl1TlRreWVpSXZQanh3WVhSb0lHUTlJazB3SURFNExqTTJORXd4T0M0ek5qUWdNR3d5TGpVME9DQXlMalUwT0V3eUxqVTBPQ0F5TUM0NU1USjZJaTgrUEM5blBqd3ZjM1puUGc9PSk7CiAgcGFkZGluZzogMDsKICBiYWNrZ3JvdW5kLXNpemU6IDhweDsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiA1MCU7CiAgcmlnaHQ6IDA7CiAgbWFyZ2luLXRvcDogLTEwcHg7CiAgbWFyZ2luLXJpZ2h0OiAyNXB4OwogIGhlaWdodDogMjBweDsKICB3aWR0aDogMjBweDsKICBib3JkZXItcmFkaXVzOiAxMGVtOwogIG9wYWNpdHk6IC41Owp9CgouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0gLmNob2ljZXNfX2J1dHRvbjpob3ZlciwKLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdIC5jaG9pY2VzX19idXR0b246Zm9jdXMgewogIG9wYWNpdHk6IDE7Cn0KCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXSAuY2hvaWNlc19fYnV0dG9uOmZvY3VzIHsKICBib3gtc2hhZG93OiAwcHggMHB4IDBweCAycHggIzAwQkNENDsKfQoKLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdOmFmdGVyIHsKICBjb250ZW50OiAiIjsKICBoZWlnaHQ6IDA7CiAgd2lkdGg6IDA7CiAgYm9yZGVyLXN0eWxlOiBzb2xpZDsKICBib3JkZXItY29sb3I6ICMzMzMzMzMgdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQ7CiAgYm9yZGVyLXdpZHRoOiA1cHg7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHJpZ2h0OiAxMS41cHg7CiAgdG9wOiA1MCU7CiAgbWFyZ2luLXRvcDogLTIuNXB4OwogIHBvaW50ZXItZXZlbnRzOiBub25lOwp9CgouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3Qtb25lIl0uaXMtb3BlbjphZnRlciB7CiAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCAjMzMzMzMzIHRyYW5zcGFyZW50OwogIG1hcmdpbi10b3A6IC03LjVweDsKfQoKLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdW2Rpcj0icnRsIl06YWZ0ZXIgewogIGxlZnQ6IDExLjVweDsKICByaWdodDogYXV0bzsKfQoKLmNob2ljZXNbZGF0YS10eXBlKj0ic2VsZWN0LW9uZSJdW2Rpcj0icnRsIl0gLmNob2ljZXNfX2J1dHRvbiB7CiAgcmlnaHQ6IGF1dG87CiAgbGVmdDogMDsKICBtYXJnaW4tbGVmdDogMjVweDsKICBtYXJnaW4tcmlnaHQ6IDA7Cn0KCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1tdWx0aXBsZSJdIC5jaG9pY2VzX19pbm5lciwKLmNob2ljZXNbZGF0YS10eXBlKj0idGV4dCJdIC5jaG9pY2VzX19pbm5lciB7CiAgY3Vyc29yOiB0ZXh0Owp9CgouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3QtbXVsdGlwbGUiXSAuY2hvaWNlc19fYnV0dG9uLAouY2hvaWNlc1tkYXRhLXR5cGUqPSJ0ZXh0Il0gLmNob2ljZXNfX2J1dHRvbiB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICBtYXJnaW4tdG9wOiAwOwogIG1hcmdpbi1yaWdodDogLTRweDsKICBtYXJnaW4tYm90dG9tOiAwOwogIG1hcmdpbi1sZWZ0OiA4cHg7CiAgcGFkZGluZy1sZWZ0OiAxNnB4OwogIGJvcmRlci1sZWZ0OiAxcHggc29saWQgIzAwOGZhMTsKICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTWpFaUlHaGxhV2RvZEQwaU1qRWlJSFpwWlhkQ2IzZzlJakFnTUNBeU1TQXlNU0lnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JajQ4WnlCbWFXeHNQU0lqUmtaR0lpQm1hV3hzTFhKMWJHVTlJbVYyWlc1dlpHUWlQanh3WVhSb0lHUTlJazB5TGpVNU1pNHdORFJzTVRndU16WTBJREU0TGpNMk5DMHlMalUwT0NBeUxqVTBPRXd1TURRMElESXVOVGt5ZWlJdlBqeHdZWFJvSUdROUlrMHdJREU0TGpNMk5Fd3hPQzR6TmpRZ01Hd3lMalUwT0NBeUxqVTBPRXd5TGpVME9DQXlNQzQ1TVRKNklpOCtQQzluUGp3dmMzWm5QZz09KTsKICBiYWNrZ3JvdW5kLXNpemU6IDhweDsKICB3aWR0aDogOHB4OwogIGxpbmUtaGVpZ2h0OiAxOwogIG9wYWNpdHk6IC43NTsKICBib3JkZXItcmFkaXVzOiAwOwp9CgouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3QtbXVsdGlwbGUiXSAuY2hvaWNlc19fYnV0dG9uOmhvdmVyLAouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3QtbXVsdGlwbGUiXSAuY2hvaWNlc19fYnV0dG9uOmZvY3VzLAouY2hvaWNlc1tkYXRhLXR5cGUqPSJ0ZXh0Il0gLmNob2ljZXNfX2J1dHRvbjpob3ZlciwKLmNob2ljZXNbZGF0YS10eXBlKj0idGV4dCJdIC5jaG9pY2VzX19idXR0b246Zm9jdXMgewogIG9wYWNpdHk6IDE7Cn0KCi5jaG9pY2VzX19pbm5lciB7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHZlcnRpY2FsLWFsaWduOiB0b3A7CiAgd2lkdGg6IDEwMCU7CiAgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZjlmOTsKICBwYWRkaW5nOiA3LjVweCA3LjVweCAzLjc1cHg7CiAgYm9yZGVyOiAxcHggc29saWQgI0RERERERDsKICBib3JkZXItcmFkaXVzOiAyLjVweDsKICBmb250LXNpemU6IDEycHg7CiAgbWluLWhlaWdodDogMjRweDsKICBvdmVyZmxvdzogaGlkZGVuOwp9CgouaXMtZm9jdXNlZCAuY2hvaWNlc19faW5uZXIsCi5pcy1vcGVuIC5jaG9pY2VzX19pbm5lciB7CiAgYm9yZGVyLWNvbG9yOiAjYjdiN2I3Owp9CgouaXMtb3BlbiAuY2hvaWNlc19faW5uZXIgewogIGJvcmRlci1yYWRpdXM6IDIuNXB4IDIuNXB4IDAgMDsKfQoKLmlzLWZsaXBwZWQuaXMtb3BlbiAuY2hvaWNlc19faW5uZXIgewogIGJvcmRlci1yYWRpdXM6IDAgMCAyLjVweCAyLjVweDsKfQoKLmNob2ljZXNfX2xpc3QgewogIG1hcmdpbjogMDsKICBwYWRkaW5nLWxlZnQ6IDA7CiAgbGlzdC1zdHlsZTogbm9uZTsKfQoKLmNob2ljZXNfX2xpc3QtLXNpbmdsZSB7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHBhZGRpbmc6IDRweCAxNnB4IDRweCA0cHg7CiAgd2lkdGg6IDEwMCU7Cn0KCltkaXI9InJ0bCJdIC5jaG9pY2VzX19saXN0LS1zaW5nbGUgewogIHBhZGRpbmctcmlnaHQ6IDRweDsKICBwYWRkaW5nLWxlZnQ6IDE2cHg7Cn0KCi5jaG9pY2VzX19saXN0LS1zaW5nbGUgLmNob2ljZXNfX2l0ZW0gewogIHdpZHRoOiAxMDAlOwp9CgouY2hvaWNlc19fbGlzdC0tbXVsdGlwbGUgewogIGRpc3BsYXk6IGlubGluZTsKfQoKLmNob2ljZXNfX2xpc3QtLW11bHRpcGxlIC5jaG9pY2VzX19pdGVtIHsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsKICBib3JkZXItcmFkaXVzOiAyMHB4OwogIHBhZGRpbmc6IDRweCAxMHB4OwogIGZvbnQtc2l6ZTogMTJweDsKICBmb250LXdlaWdodDogNTAwOwogIG1hcmdpbi1yaWdodDogMy43NXB4OwogIG1hcmdpbi1ib3R0b206IDMuNzVweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDBCQ0Q0OwogIGJvcmRlcjogMXB4IHNvbGlkICMwMGE1YmI7CiAgY29sb3I6ICNGRkZGRkY7CiAgd29yZC1icmVhazogYnJlYWstYWxsOwp9CgouY2hvaWNlc19fbGlzdC0tbXVsdGlwbGUgLmNob2ljZXNfX2l0ZW1bZGF0YS1kZWxldGFibGVdIHsKICBwYWRkaW5nLXJpZ2h0OiA1cHg7Cn0KCltkaXI9InJ0bCJdIC5jaG9pY2VzX19saXN0LS1tdWx0aXBsZSAuY2hvaWNlc19faXRlbSB7CiAgbWFyZ2luLXJpZ2h0OiAwOwogIG1hcmdpbi1sZWZ0OiAzLjc1cHg7Cn0KCi5jaG9pY2VzX19saXN0LS1tdWx0aXBsZSAuY2hvaWNlc19faXRlbS5pcy1oaWdobGlnaHRlZCB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzAwYTViYjsKICBib3JkZXI6IDFweCBzb2xpZCAjMDA4ZmExOwp9CgouaXMtZGlzYWJsZWQgLmNob2ljZXNfX2xpc3QtLW11bHRpcGxlIC5jaG9pY2VzX19pdGVtIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjYWFhYWFhOwogIGJvcmRlcjogMXB4IHNvbGlkICM5MTkxOTE7Cn0KCi5jaG9pY2VzX19saXN0LS1kcm9wZG93biB7CiAgZGlzcGxheTogbm9uZTsKICB6LWluZGV4OiAxOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB3aWR0aDogMTAwJTsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGOwogIGJvcmRlcjogMXB4IHNvbGlkICNEREREREQ7CiAgdG9wOiAxMDAlOwogIG1hcmdpbi10b3A6IC0xcHg7CiAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMi41cHg7CiAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDIuNXB4OwogIG92ZXJmbG93OiBoaWRkZW47CiAgd29yZC1icmVhazogYnJlYWstYWxsOwp9CgouY2hvaWNlc19fbGlzdC0tZHJvcGRvd24uaXMtYWN0aXZlIHsKICBkaXNwbGF5OiBibG9jazsKfQoKLmlzLW9wZW4gLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIHsKICBib3JkZXItY29sb3I6ICNiN2I3Yjc7Cn0KCi5pcy1mbGlwcGVkIC5jaG9pY2VzX19saXN0LS1kcm9wZG93biB7CiAgdG9wOiBhdXRvOwogIGJvdHRvbTogMTAwJTsKICBtYXJnaW4tdG9wOiAwOwogIG1hcmdpbi1ib3R0b206IC0xcHg7CiAgYm9yZGVyLXJhZGl1czogLjI1cmVtIC4yNXJlbSAwIDA7Cn0KCi5jaG9pY2VzX19saXN0LS1kcm9wZG93biAuY2hvaWNlc19fbGlzdCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIG1heC1oZWlnaHQ6IDMwMHB4OwogIG92ZXJmbG93OiBhdXRvOwogIC13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nOiB0b3VjaDsKICB3aWxsLWNoYW5nZTogc2Nyb2xsLXBvc2l0aW9uOwp9CgouY2hvaWNlc19fbGlzdC0tZHJvcGRvd24gLmNob2ljZXNfX2l0ZW0gewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBwYWRkaW5nOiAxMHB4OwogIGZvbnQtc2l6ZTogMTJweDsKfQoKW2Rpcj0icnRsIl0gLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19pdGVtIHsKICB0ZXh0LWFsaWduOiByaWdodDsKfQoKQG1lZGlhIChtaW4td2lkdGg6IDY0MHB4KSB7CiAgLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19pdGVtLS1zZWxlY3RhYmxlIHsKICAgIHBhZGRpbmctcmlnaHQ6IDEwMHB4OwogIH0KCiAgLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19pdGVtLS1zZWxlY3RhYmxlOmFmdGVyIHsKICAgIGNvbnRlbnQ6IGF0dHIoZGF0YS1zZWxlY3QtdGV4dCk7CiAgICBmb250LXNpemU6IDEycHg7CiAgICBvcGFjaXR5OiAwOwogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgcmlnaHQ6IDEwcHg7CiAgICB0b3A6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsKICB9CgogIFtkaXI9InJ0bCJdIC5jaG9pY2VzX19saXN0LS1kcm9wZG93biAuY2hvaWNlc19faXRlbS0tc2VsZWN0YWJsZSB7CiAgICB0ZXh0LWFsaWduOiByaWdodDsKICAgIHBhZGRpbmctbGVmdDogMTAwcHg7CiAgICBwYWRkaW5nLXJpZ2h0OiAxMHB4OwogIH0KCiAgW2Rpcj0icnRsIl0gLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19pdGVtLS1zZWxlY3RhYmxlOmFmdGVyIHsKICAgIHJpZ2h0OiBhdXRvOwogICAgbGVmdDogMTBweDsKICB9Cn0KCi5jaG9pY2VzX19saXN0LS1kcm9wZG93biAuY2hvaWNlc19faXRlbS0tc2VsZWN0YWJsZS5pcy1oaWdobGlnaHRlZCB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2YyZjJmMjsKfQoKLmNob2ljZXNfX2xpc3QtLWRyb3Bkb3duIC5jaG9pY2VzX19pdGVtLS1zZWxlY3RhYmxlLmlzLWhpZ2hsaWdodGVkOmFmdGVyIHsKICBvcGFjaXR5OiAuNTsKfQoKLmNob2ljZXNfX2l0ZW0gewogIGN1cnNvcjogZGVmYXVsdDsKfQoKLmNob2ljZXNfX2l0ZW0tLXNlbGVjdGFibGUgewogIGN1cnNvcjogcG9pbnRlcjsKfQoKLmNob2ljZXNfX2l0ZW0tLWRpc2FibGVkIHsKICBjdXJzb3I6IG5vdC1hbGxvd2VkOwogIHVzZXItc2VsZWN0OiBub25lOwogIG9wYWNpdHk6IC41Owp9CgouY2hvaWNlc19faGVhZGluZyB7CiAgZm9udC13ZWlnaHQ6IDYwMDsKICBmb250LXNpemU6IDEycHg7CiAgcGFkZGluZzogMTBweDsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2Y3ZjdmNzsKICBjb2xvcjogZ3JheTsKfQoKLmNob2ljZXNfX2J1dHRvbiB7CiAgdGV4dC1pbmRlbnQ6IC05OTk5cHg7CiAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOwogIGFwcGVhcmFuY2U6IG5vbmU7CiAgYm9yZGVyOiAwOwogIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwogIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CiAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwogIGN1cnNvcjogcG9pbnRlcjsKfQoKLmNob2ljZXNfX2J1dHRvbjpmb2N1cyB7CiAgb3V0bGluZTogbm9uZTsKfQoKLmNob2ljZXNfX2lucHV0IHsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOwogIGJhY2tncm91bmQtY29sb3I6ICNmOWY5Zjk7CiAgZm9udC1zaXplOiAxMnB4OwogIG1hcmdpbi1ib3R0b206IDVweDsKICBib3JkZXI6IDA7CiAgYm9yZGVyLXJhZGl1czogMDsKICBtYXgtd2lkdGg6IDEwMCU7CiAgcGFkZGluZzogNHB4IDAgNHB4IDJweDsKfQoKLmNob2ljZXNfX2lucHV0OmZvY3VzIHsKICBvdXRsaW5lOiAwOwp9CgpbZGlyPSJydGwiXSAuY2hvaWNlc19faW5wdXQgewogIHBhZGRpbmctcmlnaHQ6IDJweDsKICBwYWRkaW5nLWxlZnQ6IDA7Cn0KCi5jaG9pY2VzX19wbGFjZWhvbGRlciB7CiAgb3BhY2l0eTogLjU7Cn0KCi5jaG9pY2VzX19pbnB1dC5pcy1oaWRkZW4sCi5jaG9pY2VzW2RhdGEtdHlwZSo9InNlbGVjdC1vbmUiXSAuY2hvaWNlc19faW5wdXQuaXMtaGlkZGVuLAouY2hvaWNlc1tkYXRhLXR5cGUqPSJzZWxlY3QtbXVsdGlwbGUiXSAuY2hvaWNlc19faW5wdXQuaXMtaGlkZGVuIHsKICBkaXNwbGF5OiBub25lOwp9CgovKj09PT09ICBFbmQgb2YgQ2hvaWNlcyAgPT09PT09Ki8KCiAgPC9zdHlsZT4KICA8c2NyaXB0PgogIC8qISBjaG9pY2VzLmpzIHY0LjEuMiB8IChjKSAyMDE4IEpvc2ggSm9obnNvbiB8IGh0dHBzOi8vZ2l0aHViLmNvbS9qc2hqb2huc29uL0Nob2ljZXMjcmVhZG1lICovIAooZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkgewogICAvL0NvbW1vbkpTMgoJaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKQoJCW1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOwogICAvL0FNRAoJZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpCgkJZGVmaW5lKFtdLCBmYWN0b3J5KTsKICAgLy9Db21tb25KUwoJZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpCgkJZXhwb3J0c1siQ2hvaWNlcyJdID0gZmFjdG9yeSgpOwogICAvL1dpbmRvdwoJZWxzZQoJCXJvb3RbIkNob2ljZXMiXSA9IGZhY3RvcnkoKTsKfSkodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHRoaXMsIGZ1bmN0aW9uKCkgewpyZXR1cm4gLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcAovKioqKioqLyAJLy8gVGhlIG1vZHVsZSBjYWNoZQovKioqKioqLyAJdmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTsKLyoqKioqKi8KLyoqKioqKi8gCS8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uCi8qKioqKiovIAlmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7Ci8qKioqKiovCi8qKioqKiovIAkJLy8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlCi8qKioqKiovIAkJaWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHsKLyoqKioqKi8gCQkJcmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7Ci8qKioqKiovIAkJfQovKioqKioqLyAJCS8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpCi8qKioqKiovIAkJdmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0gewovKioqKioqLyAJCQlpOiBtb2R1bGVJZCwKLyoqKioqKi8gCQkJbDogZmFsc2UsCi8qKioqKiovIAkJCWV4cG9ydHM6IHt9Ci8qKioqKiovIAkJfTsKLyoqKioqKi8KLyoqKioqKi8gCQkvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb24KLyoqKioqKi8gCQltb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTsKLyoqKioqKi8KLyoqKioqKi8gCQkvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkCi8qKioqKiovIAkJbW9kdWxlLmwgPSB0cnVlOwovKioqKioqLwovKioqKioqLyAJCS8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlCi8qKioqKiovIAkJcmV0dXJuIG1vZHVsZS5leHBvcnRzOwovKioqKioqLyAJfQovKioqKioqLwovKioqKioqLwovKioqKioqLyAJLy8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXykKLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7Ci8qKioqKiovCi8qKioqKiovIAkvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlczsKLyoqKioqKi8KLyoqKioqKi8gCS8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0cwovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7Ci8qKioqKiovIAkJaWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkgewovKioqKioqLyAJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgewovKioqKioqLyAJCQkJY29uZmlndXJhYmxlOiBmYWxzZSwKLyoqKioqKi8gCQkJCWVudW1lcmFibGU6IHRydWUsCi8qKioqKiovIAkJCQlnZXQ6IGdldHRlcgovKioqKioqLyAJCQl9KTsKLyoqKioqKi8gCQl9Ci8qKioqKiovIAl9OwovKioqKioqLwovKioqKioqLyAJLy8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXMKLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkgewovKioqKioqLyAJCXZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgPwovKioqKioqLyAJCQlmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOgovKioqKioqLyAJCQlmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9OwovKioqKioqLyAJCV9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTsKLyoqKioqKi8gCQlyZXR1cm4gZ2V0dGVyOwovKioqKioqLyAJfTsKLyoqKioqKi8KLyoqKioqKi8gCS8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbAovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9OwovKioqKioqLwovKioqKioqLyAJLy8gX193ZWJwYWNrX3B1YmxpY19wYXRoX18KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ucCA9ICIvcHVibGljL2Fzc2V0cy9zY3JpcHRzLyI7Ci8qKioqKiovCi8qKioqKiovIAkvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHMKLyoqKioqKi8gCXJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDM3KTsKLyoqKioqKi8gfSkKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyoqKioqKi8gKFsKLyogMCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7Cgp2YXIgc3RvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI2KSgnd2tzJyk7CnZhciB1aWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzKTsKdmFyIFN5bWJvbCA9IF9fd2VicGFja19yZXF1aXJlX18oMykuU3ltYm9sOwp2YXIgVVNFX1NZTUJPTCA9IHR5cGVvZiBTeW1ib2wgPT0gJ2Z1bmN0aW9uJzsKCnZhciAkZXhwb3J0cyA9IG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG5hbWUpIHsKICByZXR1cm4gc3RvcmVbbmFtZV0gfHwgKHN0b3JlW25hbWVdID0KICAgIFVTRV9TWU1CT0wgJiYgU3ltYm9sW25hbWVdIHx8IChVU0VfU1lNQk9MID8gU3ltYm9sIDogdWlkKSgnU3ltYm9sLicgKyBuYW1lKSk7Cn07CgokZXhwb3J0cy5zdG9yZSA9IHN0b3JlOwoKCi8qKiovIH0pLAovKiAxICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Ci8qIGVzbGludC1kaXNhYmxlICovCgp2YXIgZ2V0UmFuZG9tTnVtYmVyID0gZXhwb3J0cy5nZXRSYW5kb21OdW1iZXIgPSBmdW5jdGlvbiBnZXRSYW5kb21OdW1iZXIobWluLCBtYXgpIHsKICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikgKyBtaW4pOwp9OwoKdmFyIGdlbmVyYXRlQ2hhcnMgPSBleHBvcnRzLmdlbmVyYXRlQ2hhcnMgPSBmdW5jdGlvbiBnZW5lcmF0ZUNoYXJzKGxlbmd0aCkgewogIHZhciBjaGFycyA9ICcnOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICB2YXIgcmFuZG9tQ2hhciA9IGdldFJhbmRvbU51bWJlcigwLCAzNik7CiAgICBjaGFycyArPSByYW5kb21DaGFyLnRvU3RyaW5nKDM2KTsKICB9CgogIHJldHVybiBjaGFyczsKfTsKCnZhciBnZW5lcmF0ZUlkID0gZXhwb3J0cy5nZW5lcmF0ZUlkID0gZnVuY3Rpb24gZ2VuZXJhdGVJZChlbGVtZW50LCBwcmVmaXgpIHsKICB2YXIgaWQgPSBlbGVtZW50LmlkIHx8IGVsZW1lbnQubmFtZSAmJiBlbGVtZW50Lm5hbWUgKyAnLScgKyBnZW5lcmF0ZUNoYXJzKDIpIHx8IGdlbmVyYXRlQ2hhcnMoNCk7CiAgaWQgPSBpZC5yZXBsYWNlKC8oOnxcLnxcW3xcXXwsKS9nLCAnJyk7CiAgaWQgPSBwcmVmaXggKyAnLScgKyBpZDsKCiAgcmV0dXJuIGlkOwp9OwoKdmFyIGdldFR5cGUgPSBleHBvcnRzLmdldFR5cGUgPSBmdW5jdGlvbiBnZXRUeXBlKG9iaikgewogIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKS5zbGljZSg4LCAtMSk7Cn07Cgp2YXIgaXNUeXBlID0gZXhwb3J0cy5pc1R5cGUgPSBmdW5jdGlvbiBpc1R5cGUodHlwZSwgb2JqKSB7CiAgdmFyIGNsYXMgPSBnZXRUeXBlKG9iaik7CiAgcmV0dXJuIG9iaiAhPT0gdW5kZWZpbmVkICYmIG9iaiAhPT0gbnVsbCAmJiBjbGFzID09PSB0eXBlOwp9OwoKdmFyIGlzRWxlbWVudCA9IGV4cG9ydHMuaXNFbGVtZW50ID0gZnVuY3Rpb24gaXNFbGVtZW50KGVsZW1lbnQpIHsKICByZXR1cm4gZWxlbWVudCBpbnN0YW5jZW9mIEVsZW1lbnQ7Cn07Cgp2YXIgZXh0ZW5kID0gZXhwb3J0cy5leHRlbmQgPSBmdW5jdGlvbiBleHRlbmQoKSB7CiAgdmFyIGV4dGVuZGVkID0ge307CiAgdmFyIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7CgogIC8qKgogICAqIE1lcmdlIG9uZSBvYmplY3QgaW50byBhbm90aGVyCiAgICogQHBhcmFtICB7T2JqZWN0fSBvYmogIE9iamVjdCB0byBtZXJnZSBpbnRvIGV4dGVuZGVkIG9iamVjdAogICAqLwogIHZhciBtZXJnZSA9IGZ1bmN0aW9uIG1lcmdlKG9iaikgewogICAgZm9yICh2YXIgcHJvcCBpbiBvYmopIHsKICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSB7CiAgICAgICAgLy8gSWYgZGVlcCBtZXJnZSBhbmQgcHJvcGVydHkgaXMgYW4gb2JqZWN0LCBtZXJnZSBwcm9wZXJ0aWVzCiAgICAgICAgaWYgKGlzVHlwZSgnT2JqZWN0Jywgb2JqW3Byb3BdKSkgewogICAgICAgICAgZXh0ZW5kZWRbcHJvcF0gPSBleHRlbmQodHJ1ZSwgZXh0ZW5kZWRbcHJvcF0sIG9ialtwcm9wXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGV4dGVuZGVkW3Byb3BdID0gb2JqW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8vIExvb3AgdGhyb3VnaCBlYWNoIHBhc3NlZCBhcmd1bWVudAogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgIC8vIHN0b3JlIGFyZ3VtZW50IGF0IHBvc2l0aW9uIGkKICAgIHZhciBvYmogPSBhcmd1bWVudHNbaV07CgogICAgLy8gSWYgd2UgYXJlIGluIGZhY3QgZGVhbGluZyB3aXRoIGFuIG9iamVjdCwgbWVyZ2UgaXQuCiAgICBpZiAoaXNUeXBlKCdPYmplY3QnLCBvYmopKSB7CiAgICAgIG1lcmdlKG9iaik7CiAgICB9CiAgfQoKICByZXR1cm4gZXh0ZW5kZWQ7Cn07Cgp2YXIgd3JhcCA9IGV4cG9ydHMud3JhcCA9IGZ1bmN0aW9uIHdyYXAoZWxlbWVudCwgd3JhcHBlcikgewogIHdyYXBwZXIgPSB3cmFwcGVyIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIGlmIChlbGVtZW50Lm5leHRTaWJsaW5nKSB7CiAgICBlbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHdyYXBwZXIsIGVsZW1lbnQubmV4dFNpYmxpbmcpOwogIH0gZWxzZSB7CiAgICBlbGVtZW50LnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQod3JhcHBlcik7CiAgfQogIHJldHVybiB3cmFwcGVyLmFwcGVuZENoaWxkKGVsZW1lbnQpOwp9OwoKdmFyIGZpbmRBbmNlc3RvciA9IGV4cG9ydHMuZmluZEFuY2VzdG9yID0gZnVuY3Rpb24gZmluZEFuY2VzdG9yKGVsLCBjbHMpIHsKICB3aGlsZSAoKGVsID0gZWwucGFyZW50RWxlbWVudCkgJiYgIWVsLmNsYXNzTGlzdC5jb250YWlucyhjbHMpKSB7fQogIHJldHVybiBlbDsKfTsKCnZhciBmaW5kQW5jZXN0b3JCeUF0dHJOYW1lID0gZXhwb3J0cy5maW5kQW5jZXN0b3JCeUF0dHJOYW1lID0gZnVuY3Rpb24gZmluZEFuY2VzdG9yQnlBdHRyTmFtZShlbCwgYXR0cikgewogIHZhciB0YXJnZXQgPSBlbDsKCiAgd2hpbGUgKHRhcmdldCkgewogICAgaWYgKHRhcmdldC5oYXNBdHRyaWJ1dGUoYXR0cikpIHsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50RWxlbWVudDsKICB9CgogIHJldHVybiBudWxsOwp9OwoKdmFyIGdldEFkamFjZW50RWwgPSBleHBvcnRzLmdldEFkamFjZW50RWwgPSBmdW5jdGlvbiBnZXRBZGphY2VudEVsKHN0YXJ0RWwsIGNsYXNzTmFtZSkgewogIHZhciBkaXJlY3Rpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IDE7CgogIGlmICghc3RhcnRFbCB8fCAhY2xhc3NOYW1lKSByZXR1cm47CgogIHZhciBwYXJlbnQgPSBzdGFydEVsLnBhcmVudE5vZGUucGFyZW50Tm9kZTsKICB2YXIgY2hpbGRyZW4gPSBBcnJheS5mcm9tKHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKGNsYXNzTmFtZSkpOwoKICB2YXIgc3RhcnRQb3MgPSBjaGlsZHJlbi5pbmRleE9mKHN0YXJ0RWwpOwogIHZhciBvcGVyYXRvckRpcmVjdGlvbiA9IGRpcmVjdGlvbiA+IDAgPyAxIDogLTE7CgogIHJldHVybiBjaGlsZHJlbltzdGFydFBvcyArIG9wZXJhdG9yRGlyZWN0aW9uXTsKfTsKCnZhciBpc1Njcm9sbGVkSW50b1ZpZXcgPSBleHBvcnRzLmlzU2Nyb2xsZWRJbnRvVmlldyA9IGZ1bmN0aW9uIGlzU2Nyb2xsZWRJbnRvVmlldyhlbCwgcGFyZW50KSB7CiAgdmFyIGRpcmVjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogMTsKCiAgaWYgKCFlbCkgcmV0dXJuOwoKICB2YXIgaXNWaXNpYmxlID0gdm9pZCAwOwoKICBpZiAoZGlyZWN0aW9uID4gMCkgewogICAgLy8gSW4gdmlldyBmcm9tIGJvdHRvbQogICAgaXNWaXNpYmxlID0gcGFyZW50LnNjcm9sbFRvcCArIHBhcmVudC5vZmZzZXRIZWlnaHQgPj0gZWwub2Zmc2V0VG9wICsgZWwub2Zmc2V0SGVpZ2h0OwogIH0gZWxzZSB7CiAgICAvLyBJbiB2aWV3IGZyb20gdG9wCiAgICBpc1Zpc2libGUgPSBlbC5vZmZzZXRUb3AgPj0gcGFyZW50LnNjcm9sbFRvcDsKICB9CgogIHJldHVybiBpc1Zpc2libGU7Cn07Cgp2YXIgc3RyaXBIVE1MID0gZXhwb3J0cy5zdHJpcEhUTUwgPSBmdW5jdGlvbiBzdHJpcEhUTUwoaHRtbCkgewogIHJldHVybiBodG1sLnJlcGxhY2UoLyYvZywgJyZhbXA7JykucmVwbGFjZSgvPi9nLCAnJnJ0OycpLnJlcGxhY2UoLzwvZywgJyZsdDsnKS5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKfTsKCnZhciBzdHJUb0VsID0gZXhwb3J0cy5zdHJUb0VsID0gZnVuY3Rpb24gKCkgewogIHZhciB0bXBFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIHJldHVybiBmdW5jdGlvbiAoc3RyKSB7CiAgICB2YXIgY2xlYW5lZElucHV0ID0gc3RyLnRyaW0oKTsKICAgIHZhciByID0gdm9pZCAwOwogICAgdG1wRWwuaW5uZXJIVE1MID0gY2xlYW5lZElucHV0OwogICAgciA9IHRtcEVsLmNoaWxkcmVuWzBdOwoKICAgIHdoaWxlICh0bXBFbC5maXJzdENoaWxkKSB7CiAgICAgIHRtcEVsLnJlbW92ZUNoaWxkKHRtcEVsLmZpcnN0Q2hpbGQpOwogICAgfQoKICAgIHJldHVybiByOwogIH07Cn0oKTsKCi8qKgogKiBEZXRlcm1pbmVzIHRoZSB3aWR0aCBvZiBhIHBhc3NlZCBpbnB1dCBiYXNlZCBvbiBpdHMgdmFsdWUgYW5kIHBhc3NlcwogKiBpdCB0byB0aGUgc3VwcGxpZWQgY2FsbGJhY2sgZnVuY3Rpb24uCiAqLwp2YXIgY2FsY1dpZHRoT2ZJbnB1dCA9IGV4cG9ydHMuY2FsY1dpZHRoT2ZJbnB1dCA9IGZ1bmN0aW9uIGNhbGNXaWR0aE9mSW5wdXQoaW5wdXQsIGNhbGxiYWNrKSB7CiAgdmFyIHZhbHVlID0gaW5wdXQudmFsdWUgfHwgaW5wdXQucGxhY2Vob2xkZXI7CiAgdmFyIHdpZHRoID0gaW5wdXQub2Zmc2V0V2lkdGg7CgogIGlmICh2YWx1ZSkgewogICAgdmFyIHRlc3RFbCA9IHN0clRvRWwoJzxzcGFuPicgKyBzdHJpcEhUTUwodmFsdWUpICsgJzwvc3Bhbj4nKTsKICAgIHRlc3RFbC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CiAgICB0ZXN0RWwuc3R5bGUucGFkZGluZyA9ICcwJzsKICAgIHRlc3RFbC5zdHlsZS50b3AgPSAnLTk5OTlweCc7CiAgICB0ZXN0RWwuc3R5bGUubGVmdCA9ICctOTk5OXB4JzsKICAgIHRlc3RFbC5zdHlsZS53aWR0aCA9ICdhdXRvJzsKICAgIHRlc3RFbC5zdHlsZS53aGl0ZVNwYWNlID0gJ3ByZSc7CgogICAgaWYgKGRvY3VtZW50LmJvZHkuY29udGFpbnMoaW5wdXQpICYmIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKSB7CiAgICAgIHZhciBpbnB1dFN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoaW5wdXQpOwoKICAgICAgaWYgKGlucHV0U3R5bGUpIHsKICAgICAgICB0ZXN0RWwuc3R5bGUuZm9udFNpemUgPSBpbnB1dFN0eWxlLmZvbnRTaXplOwogICAgICAgIHRlc3RFbC5zdHlsZS5mb250RmFtaWx5ID0gaW5wdXRTdHlsZS5mb250RmFtaWx5OwogICAgICAgIHRlc3RFbC5zdHlsZS5mb250V2VpZ2h0ID0gaW5wdXRTdHlsZS5mb250V2VpZ2h0OwogICAgICAgIHRlc3RFbC5zdHlsZS5mb250U3R5bGUgPSBpbnB1dFN0eWxlLmZvbnRTdHlsZTsKICAgICAgICB0ZXN0RWwuc3R5bGUubGV0dGVyU3BhY2luZyA9IGlucHV0U3R5bGUubGV0dGVyU3BhY2luZzsKICAgICAgICB0ZXN0RWwuc3R5bGUudGV4dFRyYW5zZm9ybSA9IGlucHV0U3R5bGUudGV4dFRyYW5zZm9ybTsKICAgICAgICB0ZXN0RWwuc3R5bGUucGFkZGluZyA9IGlucHV0U3R5bGUucGFkZGluZzsKICAgICAgfQogICAgfQoKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGVzdEVsKTsKCiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICBpZiAodmFsdWUgJiYgdGVzdEVsLm9mZnNldFdpZHRoICE9PSBpbnB1dC5vZmZzZXRXaWR0aCkgewogICAgICAgIHdpZHRoID0gdGVzdEVsLm9mZnNldFdpZHRoICsgNDsKICAgICAgfQoKICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0ZXN0RWwpOwoKICAgICAgY2FsbGJhY2suY2FsbCh1bmRlZmluZWQsIHdpZHRoICsgJ3B4Jyk7CiAgICB9KTsKICB9IGVsc2UgewogICAgY2FsbGJhY2suY2FsbCh1bmRlZmluZWQsIHdpZHRoICsgJ3B4Jyk7CiAgfQp9OwoKdmFyIHNvcnRCeUFscGhhID0gZXhwb3J0cy5zb3J0QnlBbHBoYSA9IGZ1bmN0aW9uIHNvcnRCeUFscGhhKGEsIGIpIHsKICB2YXIgbGFiZWxBID0gKGEubGFiZWwgfHwgYS52YWx1ZSkudG9Mb3dlckNhc2UoKTsKICB2YXIgbGFiZWxCID0gKGIubGFiZWwgfHwgYi52YWx1ZSkudG9Mb3dlckNhc2UoKTsKCiAgaWYgKGxhYmVsQSA8IGxhYmVsQikgewogICAgcmV0dXJuIC0xOwogIH0KCiAgaWYgKGxhYmVsQSA+IGxhYmVsQikgewogICAgcmV0dXJuIDE7CiAgfQoKICByZXR1cm4gMDsKfTsKCnZhciBzb3J0QnlTY29yZSA9IGV4cG9ydHMuc29ydEJ5U2NvcmUgPSBmdW5jdGlvbiBzb3J0QnlTY29yZShhLCBiKSB7CiAgcmV0dXJuIGEuc2NvcmUgLSBiLnNjb3JlOwp9OwoKdmFyIGRpc3BhdGNoRXZlbnQgPSBleHBvcnRzLmRpc3BhdGNoRXZlbnQgPSBmdW5jdGlvbiBkaXNwYXRjaEV2ZW50KGVsZW1lbnQsIHR5cGUpIHsKICB2YXIgY3VzdG9tQXJncyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogbnVsbDsKCiAgdmFyIGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KHR5cGUsIHsKICAgIGRldGFpbDogY3VzdG9tQXJncywKICAgIGJ1YmJsZXM6IHRydWUsCiAgICBjYW5jZWxhYmxlOiB0cnVlCiAgfSk7CgogIHJldHVybiBlbGVtZW50LmRpc3BhdGNoRXZlbnQoZXZlbnQpOwp9OwoKdmFyIHJlZ2V4RmlsdGVyID0gZXhwb3J0cy5yZWdleEZpbHRlciA9IGZ1bmN0aW9uIHJlZ2V4RmlsdGVyKHZhbHVlLCByZWdleCkgewogIGlmICghdmFsdWUgfHwgIXJlZ2V4KSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICB2YXIgZXhwcmVzc2lvbiA9IG5ldyBSZWdFeHAocmVnZXguc291cmNlLCAnaScpOwogIHJldHVybiBleHByZXNzaW9uLnRlc3QodmFsdWUpOwp9OwoKdmFyIGdldFdpbmRvd0hlaWdodCA9IGV4cG9ydHMuZ2V0V2luZG93SGVpZ2h0ID0gZnVuY3Rpb24gZ2V0V2luZG93SGVpZ2h0KCkgewogIHZhciBib2R5ID0gZG9jdW1lbnQuYm9keTsKICB2YXIgaHRtbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICByZXR1cm4gTWF0aC5tYXgoYm9keS5zY3JvbGxIZWlnaHQsIGJvZHkub2Zmc2V0SGVpZ2h0LCBodG1sLmNsaWVudEhlaWdodCwgaHRtbC5zY3JvbGxIZWlnaHQsIGh0bWwub2Zmc2V0SGVpZ2h0KTsKfTsKCnZhciByZWR1Y2VUb1ZhbHVlcyA9IGV4cG9ydHMucmVkdWNlVG9WYWx1ZXMgPSBmdW5jdGlvbiByZWR1Y2VUb1ZhbHVlcyhpdGVtcykgewogIHZhciBrZXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICd2YWx1ZSc7CgogIHZhciB2YWx1ZXMgPSBpdGVtcy5yZWR1Y2UoZnVuY3Rpb24gKHByZXYsIGN1cnJlbnQpIHsKICAgIHByZXYucHVzaChjdXJyZW50W2tleV0pOwogICAgcmV0dXJuIHByZXY7CiAgfSwgW10pOwoKICByZXR1cm4gdmFsdWVzOwp9OwoKdmFyIGZldGNoRnJvbU9iamVjdCA9IGV4cG9ydHMuZmV0Y2hGcm9tT2JqZWN0ID0gZnVuY3Rpb24gZmV0Y2hGcm9tT2JqZWN0KG9iamVjdCwgcGF0aCkgewogIHZhciBpbmRleCA9IHBhdGguaW5kZXhPZignLicpOwoKICBpZiAoaW5kZXggPiAtMSkgewogICAgcmV0dXJuIGZldGNoRnJvbU9iamVjdChvYmplY3RbcGF0aC5zdWJzdHJpbmcoMCwgaW5kZXgpXSwgcGF0aC5zdWJzdHIoaW5kZXggKyAxKSk7CiAgfQoKICByZXR1cm4gb2JqZWN0W3BhdGhdOwp9OwoKdmFyIGlzSUUxMSA9IGV4cG9ydHMuaXNJRTExID0gZnVuY3Rpb24gaXNJRTExKCkgewogIHJldHVybiAhIShuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9UcmlkZW50LykgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvcnZbIDpdMTEvKSk7Cn07Cgp2YXIgZXhpc3RzSW5BcnJheSA9IGV4cG9ydHMuZXhpc3RzSW5BcnJheSA9IGZ1bmN0aW9uIGV4aXN0c0luQXJyYXkoYXJyYXksIHZhbHVlKSB7CiAgdmFyIGtleSA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogJ3ZhbHVlJzsKICByZXR1cm4gYXJyYXkuc29tZShmdW5jdGlvbiAoaXRlbSkgewogICAgaWYgKGlzVHlwZSgnU3RyaW5nJywgdmFsdWUpKSB7CiAgICAgIHJldHVybiBpdGVtW2tleV0gPT09IHZhbHVlLnRyaW0oKTsKICAgIH0KCiAgICByZXR1cm4gaXRlbVtrZXldID09PSB2YWx1ZTsKICB9KTsKfTsKCnZhciBjbG9uZU9iamVjdCA9IGV4cG9ydHMuY2xvbmVPYmplY3QgPSBmdW5jdGlvbiBjbG9uZU9iamVjdChvYmopIHsKICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTsKfTsKCnZhciBkb0tleXNNYXRjaCA9IGV4cG9ydHMuZG9LZXlzTWF0Y2ggPSBmdW5jdGlvbiBkb0tleXNNYXRjaChhLCBiKSB7CiAgdmFyIGFLZXlzID0gT2JqZWN0LmtleXMoYSkuc29ydCgpOwogIHZhciBiS2V5cyA9IE9iamVjdC5rZXlzKGIpLnNvcnQoKTsKICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoYUtleXMpID09PSBKU09OLnN0cmluZ2lmeShiS2V5cyk7Cn07CgovKioqLyB9KSwKLyogMiAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7Cgp2YXIgY29yZSA9IG1vZHVsZS5leHBvcnRzID0geyB2ZXJzaW9uOiAnMi41LjcnIH07CmlmICh0eXBlb2YgX19lID09ICdudW1iZXInKSBfX2UgPSBjb3JlOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVuZGVmCgoKLyoqKi8gfSksCi8qIDMgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKLy8gaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMvaXNzdWVzLzg2I2lzc3VlY29tbWVudC0xMTU3NTkwMjgKdmFyIGdsb2JhbCA9IG1vZHVsZS5leHBvcnRzID0gdHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoCiAgPyB3aW5kb3cgOiB0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aCA/IHNlbGYKICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tbmV3LWZ1bmMKICA6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7CmlmICh0eXBlb2YgX19nID09ICdudW1iZXInKSBfX2cgPSBnbG9iYWw7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5kZWYKCgovKioqLyB9KSwKLyogNCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7Cgp2YXIgZFAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOwp2YXIgY3JlYXRlRGVzYyA9IF9fd2VicGFja19yZXF1aXJlX18oMTIpOwptb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMTApID8gZnVuY3Rpb24gKG9iamVjdCwga2V5LCB2YWx1ZSkgewogIHJldHVybiBkUC5mKG9iamVjdCwga2V5LCBjcmVhdGVEZXNjKDEsIHZhbHVlKSk7Cn0gOiBmdW5jdGlvbiAob2JqZWN0LCBrZXksIHZhbHVlKSB7CiAgb2JqZWN0W2tleV0gPSB2YWx1ZTsKICByZXR1cm4gb2JqZWN0Owp9OwoKCi8qKiovIH0pLAovKiA1ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuU0NST0xMSU5HX1NQRUVEID0gZXhwb3J0cy5LRVlfQ09ERVMgPSBleHBvcnRzLkFDVElPTl9UWVBFUyA9IGV4cG9ydHMuRVZFTlRTID0gZXhwb3J0cy5ERUZBVUxUX0NPTkZJRyA9IGV4cG9ydHMuREVGQVVMVF9DTEFTU05BTUVTID0gdW5kZWZpbmVkOwoKdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7Cgp2YXIgREVGQVVMVF9DTEFTU05BTUVTID0gZXhwb3J0cy5ERUZBVUxUX0NMQVNTTkFNRVMgPSB7CiAgY29udGFpbmVyT3V0ZXI6ICdjaG9pY2VzJywKICBjb250YWluZXJJbm5lcjogJ2Nob2ljZXNfX2lubmVyJywKICBpbnB1dDogJ2Nob2ljZXNfX2lucHV0JywKICBpbnB1dENsb25lZDogJ2Nob2ljZXNfX2lucHV0LS1jbG9uZWQnLAogIGxpc3Q6ICdjaG9pY2VzX19saXN0JywKICBsaXN0SXRlbXM6ICdjaG9pY2VzX19saXN0LS1tdWx0aXBsZScsCiAgbGlzdFNpbmdsZTogJ2Nob2ljZXNfX2xpc3QtLXNpbmdsZScsCiAgbGlzdERyb3Bkb3duOiAnY2hvaWNlc19fbGlzdC0tZHJvcGRvd24nLAogIGl0ZW06ICdjaG9pY2VzX19pdGVtJywKICBpdGVtU2VsZWN0YWJsZTogJ2Nob2ljZXNfX2l0ZW0tLXNlbGVjdGFibGUnLAogIGl0ZW1EaXNhYmxlZDogJ2Nob2ljZXNfX2l0ZW0tLWRpc2FibGVkJywKICBpdGVtQ2hvaWNlOiAnY2hvaWNlc19faXRlbS0tY2hvaWNlJywKICBwbGFjZWhvbGRlcjogJ2Nob2ljZXNfX3BsYWNlaG9sZGVyJywKICBncm91cDogJ2Nob2ljZXNfX2dyb3VwJywKICBncm91cEhlYWRpbmc6ICdjaG9pY2VzX19oZWFkaW5nJywKICBidXR0b246ICdjaG9pY2VzX19idXR0b24nLAogIGFjdGl2ZVN0YXRlOiAnaXMtYWN0aXZlJywKICBmb2N1c1N0YXRlOiAnaXMtZm9jdXNlZCcsCiAgb3BlblN0YXRlOiAnaXMtb3BlbicsCiAgZGlzYWJsZWRTdGF0ZTogJ2lzLWRpc2FibGVkJywKICBoaWdobGlnaHRlZFN0YXRlOiAnaXMtaGlnaGxpZ2h0ZWQnLAogIGhpZGRlblN0YXRlOiAnaXMtaGlkZGVuJywKICBmbGlwcGVkU3RhdGU6ICdpcy1mbGlwcGVkJywKICBsb2FkaW5nU3RhdGU6ICdpcy1sb2FkaW5nJywKICBub1Jlc3VsdHM6ICdoYXMtbm8tcmVzdWx0cycsCiAgbm9DaG9pY2VzOiAnaGFzLW5vLWNob2ljZXMnCn07Cgp2YXIgREVGQVVMVF9DT05GSUcgPSBleHBvcnRzLkRFRkFVTFRfQ09ORklHID0gewogIGl0ZW1zOiBbXSwKICBjaG9pY2VzOiBbXSwKICBzaWxlbnQ6IGZhbHNlLAogIHJlbmRlckNob2ljZUxpbWl0OiAtMSwKICBtYXhJdGVtQ291bnQ6IC0xLAogIGFkZEl0ZW1zOiB0cnVlLAogIHJlbW92ZUl0ZW1zOiB0cnVlLAogIHJlbW92ZUl0ZW1CdXR0b246IGZhbHNlLAogIGVkaXRJdGVtczogZmFsc2UsCiAgZHVwbGljYXRlSXRlbXNBbGxvd2VkOiB0cnVlLAogIGRlbGltaXRlcjogJywnLAogIHBhc3RlOiB0cnVlLAogIHNlYXJjaEVuYWJsZWQ6IHRydWUsCiAgc2VhcmNoQ2hvaWNlczogdHJ1ZSwKICBzZWFyY2hGbG9vcjogMSwKICBzZWFyY2hSZXN1bHRMaW1pdDogNCwKICBzZWFyY2hGaWVsZHM6IFsnbGFiZWwnLCAndmFsdWUnXSwKICBwb3NpdGlvbjogJ2F1dG8nLAogIHJlc2V0U2Nyb2xsUG9zaXRpb246IHRydWUsCiAgcmVnZXhGaWx0ZXI6IG51bGwsCiAgc2hvdWxkU29ydDogdHJ1ZSwKICBzaG91bGRTb3J0SXRlbXM6IGZhbHNlLAogIHNvcnRGbjogX3V0aWxzLnNvcnRCeUFscGhhLAogIHBsYWNlaG9sZGVyOiB0cnVlLAogIHBsYWNlaG9sZGVyVmFsdWU6IG51bGwsCiAgc2VhcmNoUGxhY2Vob2xkZXJWYWx1ZTogbnVsbCwKICBwcmVwZW5kVmFsdWU6IG51bGwsCiAgYXBwZW5kVmFsdWU6IG51bGwsCiAgcmVuZGVyU2VsZWN0ZWRDaG9pY2VzOiAnYXV0bycsCiAgbG9hZGluZ1RleHQ6ICdMb2FkaW5nLi4uJywKICBub1Jlc3VsdHNUZXh0OiAnTm8gcmVzdWx0cyBmb3VuZCcsCiAgbm9DaG9pY2VzVGV4dDogJ05vIGNob2ljZXMgdG8gY2hvb3NlIGZyb20nLAogIGl0ZW1TZWxlY3RUZXh0OiAnUHJlc3MgdG8gc2VsZWN0JywKICB1bmlxdWVJdGVtVGV4dDogJ09ubHkgdW5pcXVlIHZhbHVlcyBjYW4gYmUgYWRkZWQnLAogIGFkZEl0ZW1UZXh0OiBmdW5jdGlvbiBhZGRJdGVtVGV4dCh2YWx1ZSkgewogICAgcmV0dXJuICdQcmVzcyBFbnRlciB0byBhZGQgPGI+IicgKyAoMCwgX3V0aWxzLnN0cmlwSFRNTCkodmFsdWUpICsgJyI8L2I+JzsKICB9LAogIG1heEl0ZW1UZXh0OiBmdW5jdGlvbiBtYXhJdGVtVGV4dChtYXhJdGVtQ291bnQpIHsKICAgIHJldHVybiAnT25seSAnICsgbWF4SXRlbUNvdW50ICsgJyB2YWx1ZXMgY2FuIGJlIGFkZGVkJzsKICB9LAogIGl0ZW1Db21wYXJlcjogZnVuY3Rpb24gaXRlbUNvbXBhcmVyKGNob2ljZSwgaXRlbSkgewogICAgcmV0dXJuIGNob2ljZSA9PT0gaXRlbTsKICB9LAogIGZ1c2VPcHRpb25zOiB7CiAgICBpbmNsdWRlU2NvcmU6IHRydWUKICB9LAogIGNhbGxiYWNrT25Jbml0OiBudWxsLAogIGNhbGxiYWNrT25DcmVhdGVUZW1wbGF0ZXM6IG51bGwsCiAgY2xhc3NOYW1lczogREVGQVVMVF9DTEFTU05BTUVTCn07Cgp2YXIgRVZFTlRTID0gZXhwb3J0cy5FVkVOVFMgPSB7CiAgc2hvd0Ryb3Bkb3duOiAnc2hvd0Ryb3Bkb3duJywKICBoaWRlRHJvcGRvd246ICdoaWRlRHJvcGRvd24nLAogIGNoYW5nZTogJ2NoYW5nZScsCiAgY2hvaWNlOiAnY2hvaWNlJywKICBzZWFyY2g6ICdzZWFyY2gnLAogIGFkZEl0ZW06ICdhZGRJdGVtJywKICByZW1vdmVJdGVtOiAncmVtb3ZlSXRlbScsCiAgaGlnaGxpZ2h0SXRlbTogJ2hpZ2hsaWdodEl0ZW0nLAogIGhpZ2hsaWdodENob2ljZTogJ2hpZ2hsaWdodENob2ljZScKfTsKCnZhciBBQ1RJT05fVFlQRVMgPSBleHBvcnRzLkFDVElPTl9UWVBFUyA9IHsKICBBRERfQ0hPSUNFOiAnQUREX0NIT0lDRScsCiAgRklMVEVSX0NIT0lDRVM6ICdGSUxURVJfQ0hPSUNFUycsCiAgQUNUSVZBVEVfQ0hPSUNFUzogJ0FDVElWQVRFX0NIT0lDRVMnLAogIENMRUFSX0NIT0lDRVM6ICdDTEVBUl9DSE9JQ0VTJywKICBBRERfR1JPVVA6ICdBRERfR1JPVVAnLAogIEFERF9JVEVNOiAnQUREX0lURU0nLAogIFJFTU9WRV9JVEVNOiAnUkVNT1ZFX0lURU0nLAogIEhJR0hMSUdIVF9JVEVNOiAnSElHSExJR0hUX0lURU0nLAogIENMRUFSX0FMTDogJ0NMRUFSX0FMTCcKfTsKCnZhciBLRVlfQ09ERVMgPSBleHBvcnRzLktFWV9DT0RFUyA9IHsKICBCQUNLX0tFWTogNDYsCiAgREVMRVRFX0tFWTogOCwKICBFTlRFUl9LRVk6IDEzLAogIEFfS0VZOiA2NSwKICBFU0NfS0VZOiAyNywKICBVUF9LRVk6IDM4LAogIERPV05fS0VZOiA0MCwKICBQQUdFX1VQX0tFWTogMzMsCiAgUEFHRV9ET1dOX0tFWTogMzQKfTsKCnZhciBTQ1JPTExJTkdfU1BFRUQgPSBleHBvcnRzLlNDUk9MTElOR19TUEVFRCA9IDQ7CgovKioqLyB9KSwKLyogNiAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7Cgp2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsKdmFyIGNvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOwp2YXIgaGlkZSA9IF9fd2VicGFja19yZXF1aXJlX18oNCk7CnZhciByZWRlZmluZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjQpOwp2YXIgY3R4ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNCk7CnZhciBQUk9UT1RZUEUgPSAncHJvdG90eXBlJzsKCnZhciAkZXhwb3J0ID0gZnVuY3Rpb24gKHR5cGUsIG5hbWUsIHNvdXJjZSkgewogIHZhciBJU19GT1JDRUQgPSB0eXBlICYgJGV4cG9ydC5GOwogIHZhciBJU19HTE9CQUwgPSB0eXBlICYgJGV4cG9ydC5HOwogIHZhciBJU19TVEFUSUMgPSB0eXBlICYgJGV4cG9ydC5TOwogIHZhciBJU19QUk9UTyA9IHR5cGUgJiAkZXhwb3J0LlA7CiAgdmFyIElTX0JJTkQgPSB0eXBlICYgJGV4cG9ydC5COwogIHZhciB0YXJnZXQgPSBJU19HTE9CQUwgPyBnbG9iYWwgOiBJU19TVEFUSUMgPyBnbG9iYWxbbmFtZV0gfHwgKGdsb2JhbFtuYW1lXSA9IHt9KSA6IChnbG9iYWxbbmFtZV0gfHwge30pW1BST1RPVFlQRV07CiAgdmFyIGV4cG9ydHMgPSBJU19HTE9CQUwgPyBjb3JlIDogY29yZVtuYW1lXSB8fCAoY29yZVtuYW1lXSA9IHt9KTsKICB2YXIgZXhwUHJvdG8gPSBleHBvcnRzW1BST1RPVFlQRV0gfHwgKGV4cG9ydHNbUFJPVE9UWVBFXSA9IHt9KTsKICB2YXIga2V5LCBvd24sIG91dCwgZXhwOwogIGlmIChJU19HTE9CQUwpIHNvdXJjZSA9IG5hbWU7CiAgZm9yIChrZXkgaW4gc291cmNlKSB7CiAgICAvLyBjb250YWlucyBpbiBuYXRpdmUKICAgIG93biA9ICFJU19GT1JDRUQgJiYgdGFyZ2V0ICYmIHRhcmdldFtrZXldICE9PSB1bmRlZmluZWQ7CiAgICAvLyBleHBvcnQgbmF0aXZlIG9yIHBhc3NlZAogICAgb3V0ID0gKG93biA/IHRhcmdldCA6IHNvdXJjZSlba2V5XTsKICAgIC8vIGJpbmQgdGltZXJzIHRvIGdsb2JhbCBmb3IgY2FsbCBmcm9tIGV4cG9ydCBjb250ZXh0CiAgICBleHAgPSBJU19CSU5EICYmIG93biA/IGN0eChvdXQsIGdsb2JhbCkgOiBJU19QUk9UTyAmJiB0eXBlb2Ygb3V0ID09ICdmdW5jdGlvbicgPyBjdHgoRnVuY3Rpb24uY2FsbCwgb3V0KSA6IG91dDsKICAgIC8vIGV4dGVuZCBnbG9iYWwKICAgIGlmICh0YXJnZXQpIHJlZGVmaW5lKHRhcmdldCwga2V5LCBvdXQsIHR5cGUgJiAkZXhwb3J0LlUpOwogICAgLy8gZXhwb3J0CiAgICBpZiAoZXhwb3J0c1trZXldICE9IG91dCkgaGlkZShleHBvcnRzLCBrZXksIGV4cCk7CiAgICBpZiAoSVNfUFJPVE8gJiYgZXhwUHJvdG9ba2V5XSAhPSBvdXQpIGV4cFByb3RvW2tleV0gPSBvdXQ7CiAgfQp9OwpnbG9iYWwuY29yZSA9IGNvcmU7Ci8vIHR5cGUgYml0bWFwCiRleHBvcnQuRiA9IDE7ICAgLy8gZm9yY2VkCiRleHBvcnQuRyA9IDI7ICAgLy8gZ2xvYmFsCiRleHBvcnQuUyA9IDQ7ICAgLy8gc3RhdGljCiRleHBvcnQuUCA9IDg7ICAgLy8gcHJvdG8KJGV4cG9ydC5CID0gMTY7ICAvLyBiaW5kCiRleHBvcnQuVyA9IDMyOyAgLy8gd3JhcAokZXhwb3J0LlUgPSA2NDsgIC8vIHNhZmUKJGV4cG9ydC5SID0gMTI4OyAvLyByZWFsIHByb3RvIG1ldGhvZCBmb3IgYGxpYnJhcnlgCm1vZHVsZS5leHBvcnRzID0gJGV4cG9ydDsKCgovKioqLyB9KSwKLyogNyAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7Cgp2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpOwp2YXIgSUU4X0RPTV9ERUZJTkUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ0KTsKdmFyIHRvUHJpbWl0aXZlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NSk7CnZhciBkUCA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKCmV4cG9ydHMuZiA9IF9fd2VicGFja19yZXF1aXJlX18oMTApID8gT2JqZWN0LmRlZmluZVByb3BlcnR5IDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoTywgUCwgQXR0cmlidXRlcykgewogIGFuT2JqZWN0KE8pOwogIFAgPSB0b1ByaW1pdGl2ZShQLCB0cnVlKTsKICBhbk9iamVjdChBdHRyaWJ1dGVzKTsKICBpZiAoSUU4X0RPTV9ERUZJTkUpIHRyeSB7CiAgICByZXR1cm4gZFAoTywgUCwgQXR0cmlidXRlcyk7CiAgfSBjYXRjaCAoZSkgeyAvKiBlbXB0eSAqLyB9CiAgaWYgKCdnZXQnIGluIEF0dHJpYnV0ZXMgfHwgJ3NldCcgaW4gQXR0cmlidXRlcykgdGhyb3cgVHlwZUVycm9yKCdBY2Nlc3NvcnMgbm90IHN1cHBvcnRlZCEnKTsKICBpZiAoJ3ZhbHVlJyBpbiBBdHRyaWJ1dGVzKSBPW1BdID0gQXR0cmlidXRlcy52YWx1ZTsKICByZXR1cm4gTzsKfTsKCgovKioqLyB9KSwKLyogOCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7Cgp2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogIGlmICghaXNPYmplY3QoaXQpKSB0aHJvdyBUeXBlRXJyb3IoaXQgKyAnIGlzIG5vdCBhbiBvYmplY3QhJyk7CiAgcmV0dXJuIGl0Owp9OwoKCi8qKiovIH0pLAovKiA5ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgcmV0dXJuIHR5cGVvZiBpdCA9PT0gJ29iamVjdCcgPyBpdCAhPT0gbnVsbCA6IHR5cGVvZiBpdCA9PT0gJ2Z1bmN0aW9uJzsKfTsKCgovKioqLyB9KSwKLyogMTAgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKLy8gVGhhbmsncyBJRTggZm9yIGhpcyBmdW5ueSBkZWZpbmVQcm9wZXJ0eQptb2R1bGUuZXhwb3J0cyA9ICFfX3dlYnBhY2tfcmVxdWlyZV9fKDIyKShmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgJ2EnLCB7IGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gNzsgfSB9KS5hICE9IDc7Cn0pOwoKCi8qKiovIH0pLAovKiAxMSAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7Cgp2YXIgaGFzT3duUHJvcGVydHkgPSB7fS5oYXNPd25Qcm9wZXJ0eTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQsIGtleSkgewogIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKGl0LCBrZXkpOwp9OwoKCi8qKiovIH0pLAovKiAxMiAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChiaXRtYXAsIHZhbHVlKSB7CiAgcmV0dXJuIHsKICAgIGVudW1lcmFibGU6ICEoYml0bWFwICYgMSksCiAgICBjb25maWd1cmFibGU6ICEoYml0bWFwICYgMiksCiAgICB3cml0YWJsZTogIShiaXRtYXAgJiA0KSwKICAgIHZhbHVlOiB2YWx1ZQogIH07Cn07CgoKLyoqKi8gfSksCi8qIDEzICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCnZhciBpZCA9IDA7CnZhciBweCA9IE1hdGgucmFuZG9tKCk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSkgewogIHJldHVybiAnU3ltYm9sKCcuY29uY2F0KGtleSA9PT0gdW5kZWZpbmVkID8gJycgOiBrZXksICcpXycsICgrK2lkICsgcHgpLnRvU3RyaW5nKDM2KSk7Cn07CgoKLyoqKi8gfSksCi8qIDE0ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCi8vIG9wdGlvbmFsIC8gc2ltcGxlIGNvbnRleHQgYmluZGluZwp2YXIgYUZ1bmN0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Nik7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGZuLCB0aGF0LCBsZW5ndGgpIHsKICBhRnVuY3Rpb24oZm4pOwogIGlmICh0aGF0ID09PSB1bmRlZmluZWQpIHJldHVybiBmbjsKICBzd2l0Y2ggKGxlbmd0aCkgewogICAgY2FzZSAxOiByZXR1cm4gZnVuY3Rpb24gKGEpIHsKICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSk7CiAgICB9OwogICAgY2FzZSAyOiByZXR1cm4gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYik7CiAgICB9OwogICAgY2FzZSAzOiByZXR1cm4gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYiwgYyk7CiAgICB9OwogIH0KICByZXR1cm4gZnVuY3Rpb24gKC8qIC4uLmFyZ3MgKi8pIHsKICAgIHJldHVybiBmbi5hcHBseSh0aGF0LCBhcmd1bWVudHMpOwogIH07Cn07CgoKLyoqKi8gfSksCi8qIDE1ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCnZhciB0b1N0cmluZyA9IHt9LnRvU3RyaW5nOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICByZXR1cm4gdG9TdHJpbmcuY2FsbChpdCkuc2xpY2UoOCwgLTEpOwp9OwoKCi8qKiovIH0pLAovKiAxNiAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgovLyA3LjEuMTMgVG9PYmplY3QoYXJndW1lbnQpCnZhciBkZWZpbmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgcmV0dXJuIE9iamVjdChkZWZpbmVkKGl0KSk7Cn07CgoKLyoqKi8gfSksCi8qIDE3ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCi8vIDcuMi4xIFJlcXVpcmVPYmplY3RDb2VyY2libGUoYXJndW1lbnQpCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgaWYgKGl0ID09IHVuZGVmaW5lZCkgdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBjYWxsIG1ldGhvZCBvbiAgIiArIGl0KTsKICByZXR1cm4gaXQ7Cn07CgoKLyoqKi8gfSksCi8qIDE4ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCi8vIDcuMS4xNSBUb0xlbmd0aAp2YXIgdG9JbnRlZ2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOSk7CnZhciBtaW4gPSBNYXRoLm1pbjsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICByZXR1cm4gaXQgPiAwID8gbWluKHRvSW50ZWdlcihpdCksIDB4MWZmZmZmZmZmZmZmZmYpIDogMDsgLy8gcG93KDIsIDUzKSAtIDEgPT0gOTAwNzE5OTI1NDc0MDk5MQp9OwoKCi8qKiovIH0pLAovKiAxOSAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7CgovLyA3LjEuNCBUb0ludGVnZXIKdmFyIGNlaWwgPSBNYXRoLmNlaWw7CnZhciBmbG9vciA9IE1hdGguZmxvb3I7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7CiAgcmV0dXJuIGlzTmFOKGl0ID0gK2l0KSA/IDAgOiAoaXQgPiAwID8gZmxvb3IgOiBjZWlsKShpdCk7Cn07CgoKLyoqKi8gfSksCi8qIDIwICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCm1vZHVsZS5leHBvcnRzID0ge307CgoKLyoqKi8gfSksCi8qIDIxICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCnZhciBzaGFyZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI2KSgna2V5cycpOwp2YXIgdWlkID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGtleSkgewogIHJldHVybiBzaGFyZWRba2V5XSB8fCAoc2hhcmVkW2tleV0gPSB1aWQoa2V5KSk7Cn07CgoKLyoqKi8gfSksCi8qIDIyICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGV4ZWMpIHsKICB0cnkgewogICAgcmV0dXJuICEhZXhlYygpOwogIH0gY2F0Y2ggKGUpIHsKICAgIHJldHVybiB0cnVlOwogIH0KfTsKCgovKioqLyB9KSwKLyogMjMgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5KTsKdmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKS5kb2N1bWVudDsKLy8gdHlwZW9mIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgaXMgJ29iamVjdCcgaW4gb2xkIElFCnZhciBpcyA9IGlzT2JqZWN0KGRvY3VtZW50KSAmJiBpc09iamVjdChkb2N1bWVudC5jcmVhdGVFbGVtZW50KTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICByZXR1cm4gaXMgPyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGl0KSA6IHt9Owp9OwoKCi8qKiovIH0pLAovKiAyNCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7Cgp2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsKdmFyIGhpZGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpOwp2YXIgaGFzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMSk7CnZhciBTUkMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzKSgnc3JjJyk7CnZhciBUT19TVFJJTkcgPSAndG9TdHJpbmcnOwp2YXIgJHRvU3RyaW5nID0gRnVuY3Rpb25bVE9fU1RSSU5HXTsKdmFyIFRQTCA9ICgnJyArICR0b1N0cmluZykuc3BsaXQoVE9fU1RSSU5HKTsKCl9fd2VicGFja19yZXF1aXJlX18oMikuaW5zcGVjdFNvdXJjZSA9IGZ1bmN0aW9uIChpdCkgewogIHJldHVybiAkdG9TdHJpbmcuY2FsbChpdCk7Cn07CgoobW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoTywga2V5LCB2YWwsIHNhZmUpIHsKICB2YXIgaXNGdW5jdGlvbiA9IHR5cGVvZiB2YWwgPT0gJ2Z1bmN0aW9uJzsKICBpZiAoaXNGdW5jdGlvbikgaGFzKHZhbCwgJ25hbWUnKSB8fCBoaWRlKHZhbCwgJ25hbWUnLCBrZXkpOwogIGlmIChPW2tleV0gPT09IHZhbCkgcmV0dXJuOwogIGlmIChpc0Z1bmN0aW9uKSBoYXModmFsLCBTUkMpIHx8IGhpZGUodmFsLCBTUkMsIE9ba2V5XSA/ICcnICsgT1trZXldIDogVFBMLmpvaW4oU3RyaW5nKGtleSkpKTsKICBpZiAoTyA9PT0gZ2xvYmFsKSB7CiAgICBPW2tleV0gPSB2YWw7CiAgfSBlbHNlIGlmICghc2FmZSkgewogICAgZGVsZXRlIE9ba2V5XTsKICAgIGhpZGUoTywga2V5LCB2YWwpOwogIH0gZWxzZSBpZiAoT1trZXldKSB7CiAgICBPW2tleV0gPSB2YWw7CiAgfSBlbHNlIHsKICAgIGhpZGUoTywga2V5LCB2YWwpOwogIH0KLy8gYWRkIGZha2UgRnVuY3Rpb24jdG9TdHJpbmcgZm9yIGNvcnJlY3Qgd29yayB3cmFwcGVkIG1ldGhvZHMgLyBjb25zdHJ1Y3RvcnMgd2l0aCBtZXRob2RzIGxpa2UgTG9EYXNoIGlzTmF0aXZlCn0pKEZ1bmN0aW9uLnByb3RvdHlwZSwgVE9fU1RSSU5HLCBmdW5jdGlvbiB0b1N0cmluZygpIHsKICByZXR1cm4gdHlwZW9mIHRoaXMgPT0gJ2Z1bmN0aW9uJyAmJiB0aGlzW1NSQ10gfHwgJHRvU3RyaW5nLmNhbGwodGhpcyk7Cn0pOwoKCi8qKiovIH0pLAovKiAyNSAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgovLyBmYWxsYmFjayBmb3Igbm9uLWFycmF5LWxpa2UgRVMzIGFuZCBub24tZW51bWVyYWJsZSBvbGQgVjggc3RyaW5ncwp2YXIgY29mID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNSk7Ci8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnMKbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QoJ3onKS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgwKSA/IE9iamVjdCA6IGZ1bmN0aW9uIChpdCkgewogIHJldHVybiBjb2YoaXQpID09ICdTdHJpbmcnID8gaXQuc3BsaXQoJycpIDogT2JqZWN0KGl0KTsKfTsKCgovKioqLyB9KSwKLyogMjYgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKdmFyIGNvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOwp2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsKdmFyIFNIQVJFRCA9ICdfX2NvcmUtanNfc2hhcmVkX18nOwp2YXIgc3RvcmUgPSBnbG9iYWxbU0hBUkVEXSB8fCAoZ2xvYmFsW1NIQVJFRF0gPSB7fSk7CgoobW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogIHJldHVybiBzdG9yZVtrZXldIHx8IChzdG9yZVtrZXldID0gdmFsdWUgIT09IHVuZGVmaW5lZCA/IHZhbHVlIDoge30pOwp9KSgndmVyc2lvbnMnLCBbXSkucHVzaCh7CiAgdmVyc2lvbjogY29yZS52ZXJzaW9uLAogIG1vZGU6IF9fd2VicGFja19yZXF1aXJlX18oMjcpID8gJ3B1cmUnIDogJ2dsb2JhbCcsCiAgY29weXJpZ2h0OiAnwqkgMjAxOCBEZW5pcyBQdXNoa2FyZXYgKHpsb2lyb2NrLnJ1KScKfSk7CgoKLyoqKi8gfSksCi8qIDI3ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCm1vZHVsZS5leHBvcnRzID0gZmFsc2U7CgoKLyoqKi8gfSksCi8qIDI4ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCi8vIDIyLjEuMy4zMSBBcnJheS5wcm90b3R5cGVbQEB1bnNjb3BhYmxlc10KdmFyIFVOU0NPUEFCTEVTID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKSgndW5zY29wYWJsZXMnKTsKdmFyIEFycmF5UHJvdG8gPSBBcnJheS5wcm90b3R5cGU7CmlmIChBcnJheVByb3RvW1VOU0NPUEFCTEVTXSA9PSB1bmRlZmluZWQpIF9fd2VicGFja19yZXF1aXJlX18oNCkoQXJyYXlQcm90bywgVU5TQ09QQUJMRVMsIHt9KTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoa2V5KSB7CiAgQXJyYXlQcm90b1tVTlNDT1BBQkxFU11ba2V5XSA9IHRydWU7Cn07CgoKLyoqKi8gfSksCi8qIDI5ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCi8vIHRvIGluZGV4ZWQgb2JqZWN0LCB0b09iamVjdCB3aXRoIGZhbGxiYWNrIGZvciBub24tYXJyYXktbGlrZSBFUzMgc3RyaW5ncwp2YXIgSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjUpOwp2YXIgZGVmaW5lZCA9IF9fd2VicGFja19yZXF1aXJlX18oMTcpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogIHJldHVybiBJT2JqZWN0KGRlZmluZWQoaXQpKTsKfTsKCgovKioqLyB9KSwKLyogMzAgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKLy8gZmFsc2UgLT4gQXJyYXkjaW5kZXhPZgovLyB0cnVlICAtPiBBcnJheSNpbmNsdWRlcwp2YXIgdG9JT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOSk7CnZhciB0b0xlbmd0aCA9IF9fd2VicGFja19yZXF1aXJlX18oMTgpOwp2YXIgdG9BYnNvbHV0ZUluZGV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MCk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKElTX0lOQ0xVREVTKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICgkdGhpcywgZWwsIGZyb21JbmRleCkgewogICAgdmFyIE8gPSB0b0lPYmplY3QoJHRoaXMpOwogICAgdmFyIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKTsKICAgIHZhciBpbmRleCA9IHRvQWJzb2x1dGVJbmRleChmcm9tSW5kZXgsIGxlbmd0aCk7CiAgICB2YXIgdmFsdWU7CiAgICAvLyBBcnJheSNpbmNsdWRlcyB1c2VzIFNhbWVWYWx1ZVplcm8gZXF1YWxpdHkgYWxnb3JpdGhtCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlCiAgICBpZiAoSVNfSU5DTFVERVMgJiYgZWwgIT0gZWwpIHdoaWxlIChsZW5ndGggPiBpbmRleCkgewogICAgICB2YWx1ZSA9IE9baW5kZXgrK107CiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUKICAgICAgaWYgKHZhbHVlICE9IHZhbHVlKSByZXR1cm4gdHJ1ZTsKICAgIC8vIEFycmF5I2luZGV4T2YgaWdub3JlcyBob2xlcywgQXJyYXkjaW5jbHVkZXMgLSBub3QKICAgIH0gZWxzZSBmb3IgKDtsZW5ndGggPiBpbmRleDsgaW5kZXgrKykgaWYgKElTX0lOQ0xVREVTIHx8IGluZGV4IGluIE8pIHsKICAgICAgaWYgKE9baW5kZXhdID09PSBlbCkgcmV0dXJuIElTX0lOQ0xVREVTIHx8IGluZGV4IHx8IDA7CiAgICB9IHJldHVybiAhSVNfSU5DTFVERVMgJiYgLTE7CiAgfTsKfTsKCgovKioqLyB9KSwKLyogMzEgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKLy8gSUUgOC0gZG9uJ3QgZW51bSBidWcga2V5cwptb2R1bGUuZXhwb3J0cyA9ICgKICAnY29uc3RydWN0b3IsaGFzT3duUHJvcGVydHksaXNQcm90b3R5cGVPZixwcm9wZXJ0eUlzRW51bWVyYWJsZSx0b0xvY2FsZVN0cmluZyx0b1N0cmluZyx2YWx1ZU9mJwopLnNwbGl0KCcsJyk7CgoKLyoqKi8gfSksCi8qIDMyICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCnZhciBkZWYgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpLmY7CnZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKTsKdmFyIFRBRyA9IF9fd2VicGFja19yZXF1aXJlX18oMCkoJ3RvU3RyaW5nVGFnJyk7Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwgdGFnLCBzdGF0KSB7CiAgaWYgKGl0ICYmICFoYXMoaXQgPSBzdGF0ID8gaXQgOiBpdC5wcm90b3R5cGUsIFRBRykpIGRlZihpdCwgVEFHLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgdmFsdWU6IHRhZyB9KTsKfTsKCgovKioqLyB9KSwKLyogMzMgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpPYmplY3QuZGVmaW5lUHJvcGVydHkoX193ZWJwYWNrX2V4cG9ydHNfXywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoKLy8gRVhURVJOQUwgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2ZyZWVHbG9iYWwuanMKdmFyIF9mcmVlR2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NCk7CgovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX3Jvb3QuanMKCgovKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYHNlbGZgLiAqLwp2YXIgZnJlZVNlbGYgPSB0eXBlb2Ygc2VsZiA9PSAnb2JqZWN0JyAmJiBzZWxmICYmIHNlbGYuT2JqZWN0ID09PSBPYmplY3QgJiYgc2VsZjsKCi8qKiBVc2VkIGFzIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0LiAqLwp2YXIgcm9vdCA9IF9mcmVlR2xvYmFsWyJhIiAvKiBkZWZhdWx0ICovXSB8fCBmcmVlU2VsZiB8fCBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOwoKLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgX3Jvb3QgPSAocm9vdCk7CgovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX1N5bWJvbC5qcwoKCi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLwp2YXIgU3ltYm9sID0gX3Jvb3QuU3ltYm9sOwoKLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgX1N5bWJvbCA9IChTeW1ib2wpOwoKLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19nZXRSYXdUYWcuanMKCgovKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovCnZhciBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7CgovKiogVXNlZCB0byBjaGVjayBvYmplY3RzIGZvciBvd24gcHJvcGVydGllcy4gKi8KdmFyIF9nZXRSYXdUYWdfaGFzT3duUHJvcGVydHkgPSBvYmplY3RQcm90by5oYXNPd25Qcm9wZXJ0eTsKCi8qKgogKiBVc2VkIHRvIHJlc29sdmUgdGhlCiAqIFtgdG9TdHJpbmdUYWdgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3QucHJvdG90eXBlLnRvc3RyaW5nKQogKiBvZiB2YWx1ZXMuCiAqLwp2YXIgbmF0aXZlT2JqZWN0VG9TdHJpbmcgPSBvYmplY3RQcm90by50b1N0cmluZzsKCi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLwp2YXIgc3ltVG9TdHJpbmdUYWcgPSBfU3ltYm9sID8gX1N5bWJvbC50b1N0cmluZ1RhZyA6IHVuZGVmaW5lZDsKCi8qKgogKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VHZXRUYWdgIHdoaWNoIGlnbm9yZXMgYFN5bWJvbC50b1N0cmluZ1RhZ2AgdmFsdWVzLgogKgogKiBAcHJpdmF0ZQogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBxdWVyeS4KICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgcmF3IGB0b1N0cmluZ1RhZ2AuCiAqLwpmdW5jdGlvbiBnZXRSYXdUYWcodmFsdWUpIHsKICB2YXIgaXNPd24gPSBfZ2V0UmF3VGFnX2hhc093blByb3BlcnR5LmNhbGwodmFsdWUsIHN5bVRvU3RyaW5nVGFnKSwKICAgICAgdGFnID0gdmFsdWVbc3ltVG9TdHJpbmdUYWddOwoKICB0cnkgewogICAgdmFsdWVbc3ltVG9TdHJpbmdUYWddID0gdW5kZWZpbmVkOwogICAgdmFyIHVubWFza2VkID0gdHJ1ZTsKICB9IGNhdGNoIChlKSB7fQoKICB2YXIgcmVzdWx0ID0gbmF0aXZlT2JqZWN0VG9TdHJpbmcuY2FsbCh2YWx1ZSk7CiAgaWYgKHVubWFza2VkKSB7CiAgICBpZiAoaXNPd24pIHsKICAgICAgdmFsdWVbc3ltVG9TdHJpbmdUYWddID0gdGFnOwogICAgfSBlbHNlIHsKICAgICAgZGVsZXRlIHZhbHVlW3N5bVRvU3RyaW5nVGFnXTsKICAgIH0KICB9CiAgcmV0dXJuIHJlc3VsdDsKfQoKLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgX2dldFJhd1RhZyA9IChnZXRSYXdUYWcpOwoKLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19vYmplY3RUb1N0cmluZy5qcwovKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovCnZhciBfb2JqZWN0VG9TdHJpbmdfb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOwoKLyoqCiAqIFVzZWQgdG8gcmVzb2x2ZSB0aGUKICogW2B0b1N0cmluZ1RhZ2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5wcm90b3R5cGUudG9zdHJpbmcpCiAqIG9mIHZhbHVlcy4KICovCnZhciBfb2JqZWN0VG9TdHJpbmdfbmF0aXZlT2JqZWN0VG9TdHJpbmcgPSBfb2JqZWN0VG9TdHJpbmdfb2JqZWN0UHJvdG8udG9TdHJpbmc7CgovKioKICogQ29udmVydHMgYHZhbHVlYCB0byBhIHN0cmluZyB1c2luZyBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZ2AuCiAqCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuCiAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBzdHJpbmcuCiAqLwpmdW5jdGlvbiBvYmplY3RUb1N0cmluZyh2YWx1ZSkgewogIHJldHVybiBfb2JqZWN0VG9TdHJpbmdfbmF0aXZlT2JqZWN0VG9TdHJpbmcuY2FsbCh2YWx1ZSk7Cn0KCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIF9vYmplY3RUb1N0cmluZyA9IChvYmplY3RUb1N0cmluZyk7CgovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2Jhc2VHZXRUYWcuanMKCgoKCi8qKiBgT2JqZWN0I3RvU3RyaW5nYCByZXN1bHQgcmVmZXJlbmNlcy4gKi8KdmFyIG51bGxUYWcgPSAnW29iamVjdCBOdWxsXScsCiAgICB1bmRlZmluZWRUYWcgPSAnW29iamVjdCBVbmRlZmluZWRdJzsKCi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLwp2YXIgX2Jhc2VHZXRUYWdfc3ltVG9TdHJpbmdUYWcgPSBfU3ltYm9sID8gX1N5bWJvbC50b1N0cmluZ1RhZyA6IHVuZGVmaW5lZDsKCi8qKgogKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgZ2V0VGFnYCB3aXRob3V0IGZhbGxiYWNrcyBmb3IgYnVnZ3kgZW52aXJvbm1lbnRzLgogKgogKiBAcHJpdmF0ZQogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBxdWVyeS4KICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgYHRvU3RyaW5nVGFnYC4KICovCmZ1bmN0aW9uIGJhc2VHZXRUYWcodmFsdWUpIHsKICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWRUYWcgOiBudWxsVGFnOwogIH0KICByZXR1cm4gKF9iYXNlR2V0VGFnX3N5bVRvU3RyaW5nVGFnICYmIF9iYXNlR2V0VGFnX3N5bVRvU3RyaW5nVGFnIGluIE9iamVjdCh2YWx1ZSkpCiAgICA/IF9nZXRSYXdUYWcodmFsdWUpCiAgICA6IF9vYmplY3RUb1N0cmluZyh2YWx1ZSk7Cn0KCi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIF9iYXNlR2V0VGFnID0gKGJhc2VHZXRUYWcpOwoKLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19vdmVyQXJnLmpzCi8qKgogKiBDcmVhdGVzIGEgdW5hcnkgZnVuY3Rpb24gdGhhdCBpbnZva2VzIGBmdW5jYCB3aXRoIGl0cyBhcmd1bWVudCB0cmFuc2Zvcm1lZC4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gd3JhcC4KICogQHBhcmFtIHtGdW5jdGlvbn0gdHJhbnNmb3JtIFRoZSBhcmd1bWVudCB0cmFuc2Zvcm0uCiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLgogKi8KZnVuY3Rpb24gb3ZlckFyZyhmdW5jLCB0cmFuc2Zvcm0pIHsKICByZXR1cm4gZnVuY3Rpb24oYXJnKSB7CiAgICByZXR1cm4gZnVuYyh0cmFuc2Zvcm0oYXJnKSk7CiAgfTsKfQoKLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgX292ZXJBcmcgPSAob3ZlckFyZyk7CgovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2dldFByb3RvdHlwZS5qcwoKCi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLwp2YXIgZ2V0UHJvdG90eXBlID0gX292ZXJBcmcoT2JqZWN0LmdldFByb3RvdHlwZU9mLCBPYmplY3QpOwoKLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgX2dldFByb3RvdHlwZSA9IChnZXRQcm90b3R5cGUpOwoKLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL2lzT2JqZWN0TGlrZS5qcwovKioKICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UuIEEgdmFsdWUgaXMgb2JqZWN0LWxpa2UgaWYgaXQncyBub3QgYG51bGxgCiAqIGFuZCBoYXMgYSBgdHlwZW9mYCByZXN1bHQgb2YgIm9iamVjdCIuCiAqCiAqIEBzdGF0aWMKICogQG1lbWJlck9mIF8KICogQHNpbmNlIDQuMC4wCiAqIEBjYXRlZ29yeSBMYW5nCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBvYmplY3QtbGlrZSwgZWxzZSBgZmFsc2VgLgogKiBAZXhhbXBsZQogKgogKiBfLmlzT2JqZWN0TGlrZSh7fSk7CiAqIC8vID0+IHRydWUKICoKICogXy5pc09iamVjdExpa2UoWzEsIDIsIDNdKTsKICogLy8gPT4gdHJ1ZQogKgogKiBfLmlzT2JqZWN0TGlrZShfLm5vb3ApOwogKiAvLyA9PiBmYWxzZQogKgogKiBfLmlzT2JqZWN0TGlrZShudWxsKTsKICogLy8gPT4gZmFsc2UKICovCmZ1bmN0aW9uIGlzT2JqZWN0TGlrZSh2YWx1ZSkgewogIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JzsKfQoKLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgbG9kYXNoX2VzX2lzT2JqZWN0TGlrZSA9IChpc09iamVjdExpa2UpOwoKLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL2lzUGxhaW5PYmplY3QuanMKCgoKCi8qKiBgT2JqZWN0I3RvU3RyaW5nYCByZXN1bHQgcmVmZXJlbmNlcy4gKi8KdmFyIG9iamVjdFRhZyA9ICdbb2JqZWN0IE9iamVjdF0nOwoKLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqLwp2YXIgZnVuY1Byb3RvID0gRnVuY3Rpb24ucHJvdG90eXBlLAogICAgaXNQbGFpbk9iamVjdF9vYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7CgovKiogVXNlZCB0byByZXNvbHZlIHRoZSBkZWNvbXBpbGVkIHNvdXJjZSBvZiBmdW5jdGlvbnMuICovCnZhciBmdW5jVG9TdHJpbmcgPSBmdW5jUHJvdG8udG9TdHJpbmc7CgovKiogVXNlZCB0byBjaGVjayBvYmplY3RzIGZvciBvd24gcHJvcGVydGllcy4gKi8KdmFyIGlzUGxhaW5PYmplY3RfaGFzT3duUHJvcGVydHkgPSBpc1BsYWluT2JqZWN0X29iamVjdFByb3RvLmhhc093blByb3BlcnR5OwoKLyoqIFVzZWQgdG8gaW5mZXIgdGhlIGBPYmplY3RgIGNvbnN0cnVjdG9yLiAqLwp2YXIgb2JqZWN0Q3RvclN0cmluZyA9IGZ1bmNUb1N0cmluZy5jYWxsKE9iamVjdCk7CgovKioKICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBwbGFpbiBvYmplY3QsIHRoYXQgaXMsIGFuIG9iamVjdCBjcmVhdGVkIGJ5IHRoZQogKiBgT2JqZWN0YCBjb25zdHJ1Y3RvciBvciBvbmUgd2l0aCBhIGBbW1Byb3RvdHlwZV1dYCBvZiBgbnVsbGAuCiAqCiAqIEBzdGF0aWMKICogQG1lbWJlck9mIF8KICogQHNpbmNlIDAuOC4wCiAqIEBjYXRlZ29yeSBMYW5nCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHBsYWluIG9iamVjdCwgZWxzZSBgZmFsc2VgLgogKiBAZXhhbXBsZQogKgogKiBmdW5jdGlvbiBGb28oKSB7CiAqICAgdGhpcy5hID0gMTsKICogfQogKgogKiBfLmlzUGxhaW5PYmplY3QobmV3IEZvbyk7CiAqIC8vID0+IGZhbHNlCiAqCiAqIF8uaXNQbGFpbk9iamVjdChbMSwgMiwgM10pOwogKiAvLyA9PiBmYWxzZQogKgogKiBfLmlzUGxhaW5PYmplY3QoeyAneCc6IDAsICd5JzogMCB9KTsKICogLy8gPT4gdHJ1ZQogKgogKiBfLmlzUGxhaW5PYmplY3QoT2JqZWN0LmNyZWF0ZShudWxsKSk7CiAqIC8vID0+IHRydWUKICovCmZ1bmN0aW9uIGlzUGxhaW5PYmplY3QodmFsdWUpIHsKICBpZiAoIWxvZGFzaF9lc19pc09iamVjdExpa2UodmFsdWUpIHx8IF9iYXNlR2V0VGFnKHZhbHVlKSAhPSBvYmplY3RUYWcpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgdmFyIHByb3RvID0gX2dldFByb3RvdHlwZSh2YWx1ZSk7CiAgaWYgKHByb3RvID09PSBudWxsKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgdmFyIEN0b3IgPSBpc1BsYWluT2JqZWN0X2hhc093blByb3BlcnR5LmNhbGwocHJvdG8sICdjb25zdHJ1Y3RvcicpICYmIHByb3RvLmNvbnN0cnVjdG9yOwogIHJldHVybiB0eXBlb2YgQ3RvciA9PSAnZnVuY3Rpb24nICYmIEN0b3IgaW5zdGFuY2VvZiBDdG9yICYmCiAgICBmdW5jVG9TdHJpbmcuY2FsbChDdG9yKSA9PSBvYmplY3RDdG9yU3RyaW5nOwp9CgovKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBsb2Rhc2hfZXNfaXNQbGFpbk9iamVjdCA9IChpc1BsYWluT2JqZWN0KTsKCi8vIEVYVEVSTkFMIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvc3ltYm9sLW9ic2VydmFibGUvZXMvaW5kZXguanMKdmFyIGVzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NSk7CgovLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWR1eC9lcy9jcmVhdGVTdG9yZS5qcwoKCgovKioKICogVGhlc2UgYXJlIHByaXZhdGUgYWN0aW9uIHR5cGVzIHJlc2VydmVkIGJ5IFJlZHV4LgogKiBGb3IgYW55IHVua25vd24gYWN0aW9ucywgeW91IG11c3QgcmV0dXJuIHRoZSBjdXJyZW50IHN0YXRlLgogKiBJZiB0aGUgY3VycmVudCBzdGF0ZSBpcyB1bmRlZmluZWQsIHlvdSBtdXN0IHJldHVybiB0aGUgaW5pdGlhbCBzdGF0ZS4KICogRG8gbm90IHJlZmVyZW5jZSB0aGVzZSBhY3Rpb24gdHlwZXMgZGlyZWN0bHkgaW4geW91ciBjb2RlLgogKi8KdmFyIEFjdGlvblR5cGVzID0gewogIElOSVQ6ICdAQHJlZHV4L0lOSVQnCgogIC8qKgogICAqIENyZWF0ZXMgYSBSZWR1eCBzdG9yZSB0aGF0IGhvbGRzIHRoZSBzdGF0ZSB0cmVlLgogICAqIFRoZSBvbmx5IHdheSB0byBjaGFuZ2UgdGhlIGRhdGEgaW4gdGhlIHN0b3JlIGlzIHRvIGNhbGwgYGRpc3BhdGNoKClgIG9uIGl0LgogICAqCiAgICogVGhlcmUgc2hvdWxkIG9ubHkgYmUgYSBzaW5nbGUgc3RvcmUgaW4geW91ciBhcHAuIFRvIHNwZWNpZnkgaG93IGRpZmZlcmVudAogICAqIHBhcnRzIG9mIHRoZSBzdGF0ZSB0cmVlIHJlc3BvbmQgdG8gYWN0aW9ucywgeW91IG1heSBjb21iaW5lIHNldmVyYWwgcmVkdWNlcnMKICAgKiBpbnRvIGEgc2luZ2xlIHJlZHVjZXIgZnVuY3Rpb24gYnkgdXNpbmcgYGNvbWJpbmVSZWR1Y2Vyc2AuCiAgICoKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSByZWR1Y2VyIEEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBuZXh0IHN0YXRlIHRyZWUsIGdpdmVuCiAgICogdGhlIGN1cnJlbnQgc3RhdGUgdHJlZSBhbmQgdGhlIGFjdGlvbiB0byBoYW5kbGUuCiAgICoKICAgKiBAcGFyYW0ge2FueX0gW3ByZWxvYWRlZFN0YXRlXSBUaGUgaW5pdGlhbCBzdGF0ZS4gWW91IG1heSBvcHRpb25hbGx5IHNwZWNpZnkgaXQKICAgKiB0byBoeWRyYXRlIHRoZSBzdGF0ZSBmcm9tIHRoZSBzZXJ2ZXIgaW4gdW5pdmVyc2FsIGFwcHMsIG9yIHRvIHJlc3RvcmUgYQogICAqIHByZXZpb3VzbHkgc2VyaWFsaXplZCB1c2VyIHNlc3Npb24uCiAgICogSWYgeW91IHVzZSBgY29tYmluZVJlZHVjZXJzYCB0byBwcm9kdWNlIHRoZSByb290IHJlZHVjZXIgZnVuY3Rpb24sIHRoaXMgbXVzdCBiZQogICAqIGFuIG9iamVjdCB3aXRoIHRoZSBzYW1lIHNoYXBlIGFzIGBjb21iaW5lUmVkdWNlcnNgIGtleXMuCiAgICoKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbZW5oYW5jZXJdIFRoZSBzdG9yZSBlbmhhbmNlci4gWW91IG1heSBvcHRpb25hbGx5IHNwZWNpZnkgaXQKICAgKiB0byBlbmhhbmNlIHRoZSBzdG9yZSB3aXRoIHRoaXJkLXBhcnR5IGNhcGFiaWxpdGllcyBzdWNoIGFzIG1pZGRsZXdhcmUsCiAgICogdGltZSB0cmF2ZWwsIHBlcnNpc3RlbmNlLCBldGMuIFRoZSBvbmx5IHN0b3JlIGVuaGFuY2VyIHRoYXQgc2hpcHMgd2l0aCBSZWR1eAogICAqIGlzIGBhcHBseU1pZGRsZXdhcmUoKWAuCiAgICoKICAgKiBAcmV0dXJucyB7U3RvcmV9IEEgUmVkdXggc3RvcmUgdGhhdCBsZXRzIHlvdSByZWFkIHRoZSBzdGF0ZSwgZGlzcGF0Y2ggYWN0aW9ucwogICAqIGFuZCBzdWJzY3JpYmUgdG8gY2hhbmdlcy4KICAgKi8KfTtmdW5jdGlvbiBjcmVhdGVTdG9yZV9jcmVhdGVTdG9yZShyZWR1Y2VyLCBwcmVsb2FkZWRTdGF0ZSwgZW5oYW5jZXIpIHsKICB2YXIgX3JlZjI7CgogIGlmICh0eXBlb2YgcHJlbG9hZGVkU3RhdGUgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGVuaGFuY2VyID09PSAndW5kZWZpbmVkJykgewogICAgZW5oYW5jZXIgPSBwcmVsb2FkZWRTdGF0ZTsKICAgIHByZWxvYWRlZFN0YXRlID0gdW5kZWZpbmVkOwogIH0KCiAgaWYgKHR5cGVvZiBlbmhhbmNlciAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIGlmICh0eXBlb2YgZW5oYW5jZXIgIT09ICdmdW5jdGlvbicpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCB0aGUgZW5oYW5jZXIgdG8gYmUgYSBmdW5jdGlvbi4nKTsKICAgIH0KCiAgICByZXR1cm4gZW5oYW5jZXIoY3JlYXRlU3RvcmVfY3JlYXRlU3RvcmUpKHJlZHVjZXIsIHByZWxvYWRlZFN0YXRlKTsKICB9CgogIGlmICh0eXBlb2YgcmVkdWNlciAhPT0gJ2Z1bmN0aW9uJykgewogICAgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCB0aGUgcmVkdWNlciB0byBiZSBhIGZ1bmN0aW9uLicpOwogIH0KCiAgdmFyIGN1cnJlbnRSZWR1Y2VyID0gcmVkdWNlcjsKICB2YXIgY3VycmVudFN0YXRlID0gcHJlbG9hZGVkU3RhdGU7CiAgdmFyIGN1cnJlbnRMaXN0ZW5lcnMgPSBbXTsKICB2YXIgbmV4dExpc3RlbmVycyA9IGN1cnJlbnRMaXN0ZW5lcnM7CiAgdmFyIGlzRGlzcGF0Y2hpbmcgPSBmYWxzZTsKCiAgZnVuY3Rpb24gZW5zdXJlQ2FuTXV0YXRlTmV4dExpc3RlbmVycygpIHsKICAgIGlmIChuZXh0TGlzdGVuZXJzID09PSBjdXJyZW50TGlzdGVuZXJzKSB7CiAgICAgIG5leHRMaXN0ZW5lcnMgPSBjdXJyZW50TGlzdGVuZXJzLnNsaWNlKCk7CiAgICB9CiAgfQoKICAvKioKICAgKiBSZWFkcyB0aGUgc3RhdGUgdHJlZSBtYW5hZ2VkIGJ5IHRoZSBzdG9yZS4KICAgKgogICAqIEByZXR1cm5zIHthbnl9IFRoZSBjdXJyZW50IHN0YXRlIHRyZWUgb2YgeW91ciBhcHBsaWNhdGlvbi4KICAgKi8KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHsKICAgIHJldHVybiBjdXJyZW50U3RhdGU7CiAgfQoKICAvKioKICAgKiBBZGRzIGEgY2hhbmdlIGxpc3RlbmVyLiBJdCB3aWxsIGJlIGNhbGxlZCBhbnkgdGltZSBhbiBhY3Rpb24gaXMgZGlzcGF0Y2hlZCwKICAgKiBhbmQgc29tZSBwYXJ0IG9mIHRoZSBzdGF0ZSB0cmVlIG1heSBwb3RlbnRpYWxseSBoYXZlIGNoYW5nZWQuIFlvdSBtYXkgdGhlbgogICAqIGNhbGwgYGdldFN0YXRlKClgIHRvIHJlYWQgdGhlIGN1cnJlbnQgc3RhdGUgdHJlZSBpbnNpZGUgdGhlIGNhbGxiYWNrLgogICAqCiAgICogWW91IG1heSBjYWxsIGBkaXNwYXRjaCgpYCBmcm9tIGEgY2hhbmdlIGxpc3RlbmVyLCB3aXRoIHRoZSBmb2xsb3dpbmcKICAgKiBjYXZlYXRzOgogICAqCiAgICogMS4gVGhlIHN1YnNjcmlwdGlvbnMgYXJlIHNuYXBzaG90dGVkIGp1c3QgYmVmb3JlIGV2ZXJ5IGBkaXNwYXRjaCgpYCBjYWxsLgogICAqIElmIHlvdSBzdWJzY3JpYmUgb3IgdW5zdWJzY3JpYmUgd2hpbGUgdGhlIGxpc3RlbmVycyBhcmUgYmVpbmcgaW52b2tlZCwgdGhpcwogICAqIHdpbGwgbm90IGhhdmUgYW55IGVmZmVjdCBvbiB0aGUgYGRpc3BhdGNoKClgIHRoYXQgaXMgY3VycmVudGx5IGluIHByb2dyZXNzLgogICAqIEhvd2V2ZXIsIHRoZSBuZXh0IGBkaXNwYXRjaCgpYCBjYWxsLCB3aGV0aGVyIG5lc3RlZCBvciBub3QsIHdpbGwgdXNlIGEgbW9yZQogICAqIHJlY2VudCBzbmFwc2hvdCBvZiB0aGUgc3Vic2NyaXB0aW9uIGxpc3QuCiAgICoKICAgKiAyLiBUaGUgbGlzdGVuZXIgc2hvdWxkIG5vdCBleHBlY3QgdG8gc2VlIGFsbCBzdGF0ZSBjaGFuZ2VzLCBhcyB0aGUgc3RhdGUKICAgKiBtaWdodCBoYXZlIGJlZW4gdXBkYXRlZCBtdWx0aXBsZSB0aW1lcyBkdXJpbmcgYSBuZXN0ZWQgYGRpc3BhdGNoKClgIGJlZm9yZQogICAqIHRoZSBsaXN0ZW5lciBpcyBjYWxsZWQuIEl0IGlzLCBob3dldmVyLCBndWFyYW50ZWVkIHRoYXQgYWxsIHN1YnNjcmliZXJzCiAgICogcmVnaXN0ZXJlZCBiZWZvcmUgdGhlIGBkaXNwYXRjaCgpYCBzdGFydGVkIHdpbGwgYmUgY2FsbGVkIHdpdGggdGhlIGxhdGVzdAogICAqIHN0YXRlIGJ5IHRoZSB0aW1lIGl0IGV4aXRzLgogICAqCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIgQSBjYWxsYmFjayB0byBiZSBpbnZva2VkIG9uIGV2ZXJ5IGRpc3BhdGNoLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBmdW5jdGlvbiB0byByZW1vdmUgdGhpcyBjaGFuZ2UgbGlzdGVuZXIuCiAgICovCiAgZnVuY3Rpb24gc3Vic2NyaWJlKGxpc3RlbmVyKSB7CiAgICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignRXhwZWN0ZWQgbGlzdGVuZXIgdG8gYmUgYSBmdW5jdGlvbi4nKTsKICAgIH0KCiAgICB2YXIgaXNTdWJzY3JpYmVkID0gdHJ1ZTsKCiAgICBlbnN1cmVDYW5NdXRhdGVOZXh0TGlzdGVuZXJzKCk7CiAgICBuZXh0TGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOwoKICAgIHJldHVybiBmdW5jdGlvbiB1bnN1YnNjcmliZSgpIHsKICAgICAgaWYgKCFpc1N1YnNjcmliZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlzU3Vic2NyaWJlZCA9IGZhbHNlOwoKICAgICAgZW5zdXJlQ2FuTXV0YXRlTmV4dExpc3RlbmVycygpOwogICAgICB2YXIgaW5kZXggPSBuZXh0TGlzdGVuZXJzLmluZGV4T2YobGlzdGVuZXIpOwogICAgICBuZXh0TGlzdGVuZXJzLnNwbGljZShpbmRleCwgMSk7CiAgICB9OwogIH0KCiAgLyoqCiAgICogRGlzcGF0Y2hlcyBhbiBhY3Rpb24uIEl0IGlzIHRoZSBvbmx5IHdheSB0byB0cmlnZ2VyIGEgc3RhdGUgY2hhbmdlLgogICAqCiAgICogVGhlIGByZWR1Y2VyYCBmdW5jdGlvbiwgdXNlZCB0byBjcmVhdGUgdGhlIHN0b3JlLCB3aWxsIGJlIGNhbGxlZCB3aXRoIHRoZQogICAqIGN1cnJlbnQgc3RhdGUgdHJlZSBhbmQgdGhlIGdpdmVuIGBhY3Rpb25gLiBJdHMgcmV0dXJuIHZhbHVlIHdpbGwKICAgKiBiZSBjb25zaWRlcmVkIHRoZSAqKm5leHQqKiBzdGF0ZSBvZiB0aGUgdHJlZSwgYW5kIHRoZSBjaGFuZ2UgbGlzdGVuZXJzCiAgICogd2lsbCBiZSBub3RpZmllZC4KICAgKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9ubHkgc3VwcG9ydHMgcGxhaW4gb2JqZWN0IGFjdGlvbnMuIElmIHlvdSB3YW50IHRvCiAgICogZGlzcGF0Y2ggYSBQcm9taXNlLCBhbiBPYnNlcnZhYmxlLCBhIHRodW5rLCBvciBzb21ldGhpbmcgZWxzZSwgeW91IG5lZWQgdG8KICAgKiB3cmFwIHlvdXIgc3RvcmUgY3JlYXRpbmcgZnVuY3Rpb24gaW50byB0aGUgY29ycmVzcG9uZGluZyBtaWRkbGV3YXJlLiBGb3IKICAgKiBleGFtcGxlLCBzZWUgdGhlIGRvY3VtZW50YXRpb24gZm9yIHRoZSBgcmVkdXgtdGh1bmtgIHBhY2thZ2UuIEV2ZW4gdGhlCiAgICogbWlkZGxld2FyZSB3aWxsIGV2ZW50dWFsbHkgZGlzcGF0Y2ggcGxhaW4gb2JqZWN0IGFjdGlvbnMgdXNpbmcgdGhpcyBtZXRob2QuCiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gYWN0aW9uIEEgcGxhaW4gb2JqZWN0IHJlcHJlc2VudGluZyDigJx3aGF0IGNoYW5nZWTigJ0uIEl0IGlzCiAgICogYSBnb29kIGlkZWEgdG8ga2VlcCBhY3Rpb25zIHNlcmlhbGl6YWJsZSBzbyB5b3UgY2FuIHJlY29yZCBhbmQgcmVwbGF5IHVzZXIKICAgKiBzZXNzaW9ucywgb3IgdXNlIHRoZSB0aW1lIHRyYXZlbGxpbmcgYHJlZHV4LWRldnRvb2xzYC4gQW4gYWN0aW9uIG11c3QgaGF2ZQogICAqIGEgYHR5cGVgIHByb3BlcnR5IHdoaWNoIG1heSBub3QgYmUgYHVuZGVmaW5lZGAuIEl0IGlzIGEgZ29vZCBpZGVhIHRvIHVzZQogICAqIHN0cmluZyBjb25zdGFudHMgZm9yIGFjdGlvbiB0eXBlcy4KICAgKgogICAqIEByZXR1cm5zIHtPYmplY3R9IEZvciBjb252ZW5pZW5jZSwgdGhlIHNhbWUgYWN0aW9uIG9iamVjdCB5b3UgZGlzcGF0Y2hlZC4KICAgKgogICAqIE5vdGUgdGhhdCwgaWYgeW91IHVzZSBhIGN1c3RvbSBtaWRkbGV3YXJlLCBpdCBtYXkgd3JhcCBgZGlzcGF0Y2goKWAgdG8KICAgKiByZXR1cm4gc29tZXRoaW5nIGVsc2UgKGZvciBleGFtcGxlLCBhIFByb21pc2UgeW91IGNhbiBhd2FpdCkuCiAgICovCiAgZnVuY3Rpb24gZGlzcGF0Y2goYWN0aW9uKSB7CiAgICBpZiAoIWxvZGFzaF9lc19pc1BsYWluT2JqZWN0KGFjdGlvbikpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdBY3Rpb25zIG11c3QgYmUgcGxhaW4gb2JqZWN0cy4gJyArICdVc2UgY3VzdG9tIG1pZGRsZXdhcmUgZm9yIGFzeW5jIGFjdGlvbnMuJyk7CiAgICB9CgogICAgaWYgKHR5cGVvZiBhY3Rpb24udHlwZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdBY3Rpb25zIG1heSBub3QgaGF2ZSBhbiB1bmRlZmluZWQgInR5cGUiIHByb3BlcnR5LiAnICsgJ0hhdmUgeW91IG1pc3NwZWxsZWQgYSBjb25zdGFudD8nKTsKICAgIH0KCiAgICBpZiAoaXNEaXNwYXRjaGluZykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZHVjZXJzIG1heSBub3QgZGlzcGF0Y2ggYWN0aW9ucy4nKTsKICAgIH0KCiAgICB0cnkgewogICAgICBpc0Rpc3BhdGNoaW5nID0gdHJ1ZTsKICAgICAgY3VycmVudFN0YXRlID0gY3VycmVudFJlZHVjZXIoY3VycmVudFN0YXRlLCBhY3Rpb24pOwogICAgfSBmaW5hbGx5IHsKICAgICAgaXNEaXNwYXRjaGluZyA9IGZhbHNlOwogICAgfQoKICAgIHZhciBsaXN0ZW5lcnMgPSBjdXJyZW50TGlzdGVuZXJzID0gbmV4dExpc3RlbmVyczsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdGVuZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBsaXN0ZW5lciA9IGxpc3RlbmVyc1tpXTsKICAgICAgbGlzdGVuZXIoKTsKICAgIH0KCiAgICByZXR1cm4gYWN0aW9uOwogIH0KCiAgLyoqCiAgICogUmVwbGFjZXMgdGhlIHJlZHVjZXIgY3VycmVudGx5IHVzZWQgYnkgdGhlIHN0b3JlIHRvIGNhbGN1bGF0ZSB0aGUgc3RhdGUuCiAgICoKICAgKiBZb3UgbWlnaHQgbmVlZCB0aGlzIGlmIHlvdXIgYXBwIGltcGxlbWVudHMgY29kZSBzcGxpdHRpbmcgYW5kIHlvdSB3YW50IHRvCiAgICogbG9hZCBzb21lIG9mIHRoZSByZWR1Y2VycyBkeW5hbWljYWxseS4gWW91IG1pZ2h0IGFsc28gbmVlZCB0aGlzIGlmIHlvdQogICAqIGltcGxlbWVudCBhIGhvdCByZWxvYWRpbmcgbWVjaGFuaXNtIGZvciBSZWR1eC4KICAgKgogICAqIEBwYXJhbSB7RnVuY3Rpb259IG5leHRSZWR1Y2VyIFRoZSByZWR1Y2VyIGZvciB0aGUgc3RvcmUgdG8gdXNlIGluc3RlYWQuCiAgICogQHJldHVybnMge3ZvaWR9CiAgICovCiAgZnVuY3Rpb24gcmVwbGFjZVJlZHVjZXIobmV4dFJlZHVjZXIpIHsKICAgIGlmICh0eXBlb2YgbmV4dFJlZHVjZXIgIT09ICdmdW5jdGlvbicpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCB0aGUgbmV4dFJlZHVjZXIgdG8gYmUgYSBmdW5jdGlvbi4nKTsKICAgIH0KCiAgICBjdXJyZW50UmVkdWNlciA9IG5leHRSZWR1Y2VyOwogICAgZGlzcGF0Y2goeyB0eXBlOiBBY3Rpb25UeXBlcy5JTklUIH0pOwogIH0KCiAgLyoqCiAgICogSW50ZXJvcGVyYWJpbGl0eSBwb2ludCBmb3Igb2JzZXJ2YWJsZS9yZWFjdGl2ZSBsaWJyYXJpZXMuCiAgICogQHJldHVybnMge29ic2VydmFibGV9IEEgbWluaW1hbCBvYnNlcnZhYmxlIG9mIHN0YXRlIGNoYW5nZXMuCiAgICogRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZSB0aGUgb2JzZXJ2YWJsZSBwcm9wb3NhbDoKICAgKiBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1vYnNlcnZhYmxlCiAgICovCiAgZnVuY3Rpb24gb2JzZXJ2YWJsZSgpIHsKICAgIHZhciBfcmVmOwoKICAgIHZhciBvdXRlclN1YnNjcmliZSA9IHN1YnNjcmliZTsKICAgIHJldHVybiBfcmVmID0gewogICAgICAvKioKICAgICAgICogVGhlIG1pbmltYWwgb2JzZXJ2YWJsZSBzdWJzY3JpcHRpb24gbWV0aG9kLgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JzZXJ2ZXIgQW55IG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIGFzIGFuIG9ic2VydmVyLgogICAgICAgKiBUaGUgb2JzZXJ2ZXIgb2JqZWN0IHNob3VsZCBoYXZlIGEgYG5leHRgIG1ldGhvZC4KICAgICAgICogQHJldHVybnMge3N1YnNjcmlwdGlvbn0gQW4gb2JqZWN0IHdpdGggYW4gYHVuc3Vic2NyaWJlYCBtZXRob2QgdGhhdCBjYW4KICAgICAgICogYmUgdXNlZCB0byB1bnN1YnNjcmliZSB0aGUgb2JzZXJ2YWJsZSBmcm9tIHRoZSBzdG9yZSwgYW5kIHByZXZlbnQgZnVydGhlcgogICAgICAgKiBlbWlzc2lvbiBvZiB2YWx1ZXMgZnJvbSB0aGUgb2JzZXJ2YWJsZS4KICAgICAgICovCiAgICAgIHN1YnNjcmliZTogZnVuY3Rpb24gc3Vic2NyaWJlKG9ic2VydmVyKSB7CiAgICAgICAgaWYgKHR5cGVvZiBvYnNlcnZlciAhPT0gJ29iamVjdCcpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkIHRoZSBvYnNlcnZlciB0byBiZSBhbiBvYmplY3QuJyk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBvYnNlcnZlU3RhdGUoKSB7CiAgICAgICAgICBpZiAob2JzZXJ2ZXIubmV4dCkgewogICAgICAgICAgICBvYnNlcnZlci5uZXh0KGdldFN0YXRlKCkpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgb2JzZXJ2ZVN0YXRlKCk7CiAgICAgICAgdmFyIHVuc3Vic2NyaWJlID0gb3V0ZXJTdWJzY3JpYmUob2JzZXJ2ZVN0YXRlKTsKICAgICAgICByZXR1cm4geyB1bnN1YnNjcmliZTogdW5zdWJzY3JpYmUgfTsKICAgICAgfQogICAgfSwgX3JlZltlc1siYSIgLyogZGVmYXVsdCAqL11dID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpczsKICAgIH0sIF9yZWY7CiAgfQoKICAvLyBXaGVuIGEgc3RvcmUgaXMgY3JlYXRlZCwgYW4gIklOSVQiIGFjdGlvbiBpcyBkaXNwYXRjaGVkIHNvIHRoYXQgZXZlcnkKICAvLyByZWR1Y2VyIHJldHVybnMgdGhlaXIgaW5pdGlhbCBzdGF0ZS4gVGhpcyBlZmZlY3RpdmVseSBwb3B1bGF0ZXMKICAvLyB0aGUgaW5pdGlhbCBzdGF0ZSB0cmVlLgogIGRpc3BhdGNoKHsgdHlwZTogQWN0aW9uVHlwZXMuSU5JVCB9KTsKCiAgcmV0dXJuIF9yZWYyID0gewogICAgZGlzcGF0Y2g6IGRpc3BhdGNoLAogICAgc3Vic2NyaWJlOiBzdWJzY3JpYmUsCiAgICBnZXRTdGF0ZTogZ2V0U3RhdGUsCiAgICByZXBsYWNlUmVkdWNlcjogcmVwbGFjZVJlZHVjZXIKICB9LCBfcmVmMltlc1siYSIgLyogZGVmYXVsdCAqL11dID0gb2JzZXJ2YWJsZSwgX3JlZjI7Cn0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVkdXgvZXMvdXRpbHMvd2FybmluZy5qcwovKioKICogUHJpbnRzIGEgd2FybmluZyBpbiB0aGUgY29uc29sZSBpZiBpdCBleGlzdHMuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBtZXNzYWdlIFRoZSB3YXJuaW5nIG1lc3NhZ2UuCiAqIEByZXR1cm5zIHt2b2lkfQogKi8KZnVuY3Rpb24gd2FybmluZ193YXJuaW5nKG1lc3NhZ2UpIHsKICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovCiAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgY29uc29sZS5lcnJvciA9PT0gJ2Z1bmN0aW9uJykgewogICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTsKICB9CiAgLyogZXNsaW50LWVuYWJsZSBuby1jb25zb2xlICovCiAgdHJ5IHsKICAgIC8vIFRoaXMgZXJyb3Igd2FzIHRocm93biBhcyBhIGNvbnZlbmllbmNlIHNvIHRoYXQgaWYgeW91IGVuYWJsZQogICAgLy8gImJyZWFrIG9uIGFsbCBleGNlcHRpb25zIiBpbiB5b3VyIGNvbnNvbGUsCiAgICAvLyBpdCB3b3VsZCBwYXVzZSB0aGUgZXhlY3V0aW9uIGF0IHRoaXMgbGluZS4KICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsKICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWVtcHR5ICovCiAgfSBjYXRjaCAoZSkge30KICAvKiBlc2xpbnQtZW5hYmxlIG5vLWVtcHR5ICovCn0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVkdXgvZXMvY29tYmluZVJlZHVjZXJzLmpzCgoKCgpmdW5jdGlvbiBnZXRVbmRlZmluZWRTdGF0ZUVycm9yTWVzc2FnZShrZXksIGFjdGlvbikgewogIHZhciBhY3Rpb25UeXBlID0gYWN0aW9uICYmIGFjdGlvbi50eXBlOwogIHZhciBhY3Rpb25OYW1lID0gYWN0aW9uVHlwZSAmJiAnIicgKyBhY3Rpb25UeXBlLnRvU3RyaW5nKCkgKyAnIicgfHwgJ2FuIGFjdGlvbic7CgogIHJldHVybiAnR2l2ZW4gYWN0aW9uICcgKyBhY3Rpb25OYW1lICsgJywgcmVkdWNlciAiJyArIGtleSArICciIHJldHVybmVkIHVuZGVmaW5lZC4gJyArICdUbyBpZ25vcmUgYW4gYWN0aW9uLCB5b3UgbXVzdCBleHBsaWNpdGx5IHJldHVybiB0aGUgcHJldmlvdXMgc3RhdGUuICcgKyAnSWYgeW91IHdhbnQgdGhpcyByZWR1Y2VyIHRvIGhvbGQgbm8gdmFsdWUsIHlvdSBjYW4gcmV0dXJuIG51bGwgaW5zdGVhZCBvZiB1bmRlZmluZWQuJzsKfQoKZnVuY3Rpb24gZ2V0VW5leHBlY3RlZFN0YXRlU2hhcGVXYXJuaW5nTWVzc2FnZShpbnB1dFN0YXRlLCByZWR1Y2VycywgYWN0aW9uLCB1bmV4cGVjdGVkS2V5Q2FjaGUpIHsKICB2YXIgcmVkdWNlcktleXMgPSBPYmplY3Qua2V5cyhyZWR1Y2Vycyk7CiAgdmFyIGFyZ3VtZW50TmFtZSA9IGFjdGlvbiAmJiBhY3Rpb24udHlwZSA9PT0gQWN0aW9uVHlwZXMuSU5JVCA/ICdwcmVsb2FkZWRTdGF0ZSBhcmd1bWVudCBwYXNzZWQgdG8gY3JlYXRlU3RvcmUnIDogJ3ByZXZpb3VzIHN0YXRlIHJlY2VpdmVkIGJ5IHRoZSByZWR1Y2VyJzsKCiAgaWYgKHJlZHVjZXJLZXlzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuICdTdG9yZSBkb2VzIG5vdCBoYXZlIGEgdmFsaWQgcmVkdWNlci4gTWFrZSBzdXJlIHRoZSBhcmd1bWVudCBwYXNzZWQgJyArICd0byBjb21iaW5lUmVkdWNlcnMgaXMgYW4gb2JqZWN0IHdob3NlIHZhbHVlcyBhcmUgcmVkdWNlcnMuJzsKICB9CgogIGlmICghbG9kYXNoX2VzX2lzUGxhaW5PYmplY3QoaW5wdXRTdGF0ZSkpIHsKICAgIHJldHVybiAnVGhlICcgKyBhcmd1bWVudE5hbWUgKyAnIGhhcyB1bmV4cGVjdGVkIHR5cGUgb2YgIicgKyB7fS50b1N0cmluZy5jYWxsKGlucHV0U3RhdGUpLm1hdGNoKC9ccyhbYS16fEEtWl0rKS8pWzFdICsgJyIuIEV4cGVjdGVkIGFyZ3VtZW50IHRvIGJlIGFuIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgJyArICgna2V5czogIicgKyByZWR1Y2VyS2V5cy5qb2luKCciLCAiJykgKyAnIicpOwogIH0KCiAgdmFyIHVuZXhwZWN0ZWRLZXlzID0gT2JqZWN0LmtleXMoaW5wdXRTdGF0ZSkuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHsKICAgIHJldHVybiAhcmVkdWNlcnMuaGFzT3duUHJvcGVydHkoa2V5KSAmJiAhdW5leHBlY3RlZEtleUNhY2hlW2tleV07CiAgfSk7CgogIHVuZXhwZWN0ZWRLZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgdW5leHBlY3RlZEtleUNhY2hlW2tleV0gPSB0cnVlOwogIH0pOwoKICBpZiAodW5leHBlY3RlZEtleXMubGVuZ3RoID4gMCkgewogICAgcmV0dXJuICdVbmV4cGVjdGVkICcgKyAodW5leHBlY3RlZEtleXMubGVuZ3RoID4gMSA/ICdrZXlzJyA6ICdrZXknKSArICcgJyArICgnIicgKyB1bmV4cGVjdGVkS2V5cy5qb2luKCciLCAiJykgKyAnIiBmb3VuZCBpbiAnICsgYXJndW1lbnROYW1lICsgJy4gJykgKyAnRXhwZWN0ZWQgdG8gZmluZCBvbmUgb2YgdGhlIGtub3duIHJlZHVjZXIga2V5cyBpbnN0ZWFkOiAnICsgKCciJyArIHJlZHVjZXJLZXlzLmpvaW4oJyIsICInKSArICciLiBVbmV4cGVjdGVkIGtleXMgd2lsbCBiZSBpZ25vcmVkLicpOwogIH0KfQoKZnVuY3Rpb24gYXNzZXJ0UmVkdWNlclNoYXBlKHJlZHVjZXJzKSB7CiAgT2JqZWN0LmtleXMocmVkdWNlcnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgdmFyIHJlZHVjZXIgPSByZWR1Y2Vyc1trZXldOwogICAgdmFyIGluaXRpYWxTdGF0ZSA9IHJlZHVjZXIodW5kZWZpbmVkLCB7IHR5cGU6IEFjdGlvblR5cGVzLklOSVQgfSk7CgogICAgaWYgKHR5cGVvZiBpbml0aWFsU3RhdGUgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignUmVkdWNlciAiJyArIGtleSArICciIHJldHVybmVkIHVuZGVmaW5lZCBkdXJpbmcgaW5pdGlhbGl6YXRpb24uICcgKyAnSWYgdGhlIHN0YXRlIHBhc3NlZCB0byB0aGUgcmVkdWNlciBpcyB1bmRlZmluZWQsIHlvdSBtdXN0ICcgKyAnZXhwbGljaXRseSByZXR1cm4gdGhlIGluaXRpYWwgc3RhdGUuIFRoZSBpbml0aWFsIHN0YXRlIG1heSAnICsgJ25vdCBiZSB1bmRlZmluZWQuIElmIHlvdSBkb25cJ3Qgd2FudCB0byBzZXQgYSB2YWx1ZSBmb3IgdGhpcyByZWR1Y2VyLCAnICsgJ3lvdSBjYW4gdXNlIG51bGwgaW5zdGVhZCBvZiB1bmRlZmluZWQuJyk7CiAgICB9CgogICAgdmFyIHR5cGUgPSAnQEByZWR1eC9QUk9CRV9VTktOT1dOX0FDVElPTl8nICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpLnNwbGl0KCcnKS5qb2luKCcuJyk7CiAgICBpZiAodHlwZW9mIHJlZHVjZXIodW5kZWZpbmVkLCB7IHR5cGU6IHR5cGUgfSkgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignUmVkdWNlciAiJyArIGtleSArICciIHJldHVybmVkIHVuZGVmaW5lZCB3aGVuIHByb2JlZCB3aXRoIGEgcmFuZG9tIHR5cGUuICcgKyAoJ0RvblwndCB0cnkgdG8gaGFuZGxlICcgKyBBY3Rpb25UeXBlcy5JTklUICsgJyBvciBvdGhlciBhY3Rpb25zIGluICJyZWR1eC8qIiAnKSArICduYW1lc3BhY2UuIFRoZXkgYXJlIGNvbnNpZGVyZWQgcHJpdmF0ZS4gSW5zdGVhZCwgeW91IG11c3QgcmV0dXJuIHRoZSAnICsgJ2N1cnJlbnQgc3RhdGUgZm9yIGFueSB1bmtub3duIGFjdGlvbnMsIHVubGVzcyBpdCBpcyB1bmRlZmluZWQsICcgKyAnaW4gd2hpY2ggY2FzZSB5b3UgbXVzdCByZXR1cm4gdGhlIGluaXRpYWwgc3RhdGUsIHJlZ2FyZGxlc3Mgb2YgdGhlICcgKyAnYWN0aW9uIHR5cGUuIFRoZSBpbml0aWFsIHN0YXRlIG1heSBub3QgYmUgdW5kZWZpbmVkLCBidXQgY2FuIGJlIG51bGwuJyk7CiAgICB9CiAgfSk7Cn0KCi8qKgogKiBUdXJucyBhbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGFyZSBkaWZmZXJlbnQgcmVkdWNlciBmdW5jdGlvbnMsIGludG8gYSBzaW5nbGUKICogcmVkdWNlciBmdW5jdGlvbi4gSXQgd2lsbCBjYWxsIGV2ZXJ5IGNoaWxkIHJlZHVjZXIsIGFuZCBnYXRoZXIgdGhlaXIgcmVzdWx0cwogKiBpbnRvIGEgc2luZ2xlIHN0YXRlIG9iamVjdCwgd2hvc2Uga2V5cyBjb3JyZXNwb25kIHRvIHRoZSBrZXlzIG9mIHRoZSBwYXNzZWQKICogcmVkdWNlciBmdW5jdGlvbnMuCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSByZWR1Y2VycyBBbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGNvcnJlc3BvbmQgdG8gZGlmZmVyZW50CiAqIHJlZHVjZXIgZnVuY3Rpb25zIHRoYXQgbmVlZCB0byBiZSBjb21iaW5lZCBpbnRvIG9uZS4gT25lIGhhbmR5IHdheSB0byBvYnRhaW4KICogaXQgaXMgdG8gdXNlIEVTNiBgaW1wb3J0ICogYXMgcmVkdWNlcnNgIHN5bnRheC4gVGhlIHJlZHVjZXJzIG1heSBuZXZlciByZXR1cm4KICogdW5kZWZpbmVkIGZvciBhbnkgYWN0aW9uLiBJbnN0ZWFkLCB0aGV5IHNob3VsZCByZXR1cm4gdGhlaXIgaW5pdGlhbCBzdGF0ZQogKiBpZiB0aGUgc3RhdGUgcGFzc2VkIHRvIHRoZW0gd2FzIHVuZGVmaW5lZCwgYW5kIHRoZSBjdXJyZW50IHN0YXRlIGZvciBhbnkKICogdW5yZWNvZ25pemVkIGFjdGlvbi4KICoKICogQHJldHVybnMge0Z1bmN0aW9ufSBBIHJlZHVjZXIgZnVuY3Rpb24gdGhhdCBpbnZva2VzIGV2ZXJ5IHJlZHVjZXIgaW5zaWRlIHRoZQogKiBwYXNzZWQgb2JqZWN0LCBhbmQgYnVpbGRzIGEgc3RhdGUgb2JqZWN0IHdpdGggdGhlIHNhbWUgc2hhcGUuCiAqLwpmdW5jdGlvbiBjb21iaW5lUmVkdWNlcnMocmVkdWNlcnMpIHsKICB2YXIgcmVkdWNlcktleXMgPSBPYmplY3Qua2V5cyhyZWR1Y2Vycyk7CiAgdmFyIGZpbmFsUmVkdWNlcnMgPSB7fTsKICBmb3IgKHZhciBpID0gMDsgaSA8IHJlZHVjZXJLZXlzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIga2V5ID0gcmVkdWNlcktleXNbaV07CgogICAgaWYgKGZhbHNlKSB7CiAgICAgIGlmICh0eXBlb2YgcmVkdWNlcnNba2V5XSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICB3YXJuaW5nKCdObyByZWR1Y2VyIHByb3ZpZGVkIGZvciBrZXkgIicgKyBrZXkgKyAnIicpOwogICAgICB9CiAgICB9CgogICAgaWYgKHR5cGVvZiByZWR1Y2Vyc1trZXldID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIGZpbmFsUmVkdWNlcnNba2V5XSA9IHJlZHVjZXJzW2tleV07CiAgICB9CiAgfQogIHZhciBmaW5hbFJlZHVjZXJLZXlzID0gT2JqZWN0LmtleXMoZmluYWxSZWR1Y2Vycyk7CgogIHZhciB1bmV4cGVjdGVkS2V5Q2FjaGUgPSB2b2lkIDA7CiAgaWYgKGZhbHNlKSB7CiAgICB1bmV4cGVjdGVkS2V5Q2FjaGUgPSB7fTsKICB9CgogIHZhciBzaGFwZUFzc2VydGlvbkVycm9yID0gdm9pZCAwOwogIHRyeSB7CiAgICBhc3NlcnRSZWR1Y2VyU2hhcGUoZmluYWxSZWR1Y2Vycyk7CiAgfSBjYXRjaCAoZSkgewogICAgc2hhcGVBc3NlcnRpb25FcnJvciA9IGU7CiAgfQoKICByZXR1cm4gZnVuY3Rpb24gY29tYmluYXRpb24oKSB7CiAgICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50c1sxXTsKCiAgICBpZiAoc2hhcGVBc3NlcnRpb25FcnJvcikgewogICAgICB0aHJvdyBzaGFwZUFzc2VydGlvbkVycm9yOwogICAgfQoKICAgIGlmIChmYWxzZSkgewogICAgICB2YXIgd2FybmluZ01lc3NhZ2UgPSBnZXRVbmV4cGVjdGVkU3RhdGVTaGFwZVdhcm5pbmdNZXNzYWdlKHN0YXRlLCBmaW5hbFJlZHVjZXJzLCBhY3Rpb24sIHVuZXhwZWN0ZWRLZXlDYWNoZSk7CiAgICAgIGlmICh3YXJuaW5nTWVzc2FnZSkgewogICAgICAgIHdhcm5pbmcod2FybmluZ01lc3NhZ2UpOwogICAgICB9CiAgICB9CgogICAgdmFyIGhhc0NoYW5nZWQgPSBmYWxzZTsKICAgIHZhciBuZXh0U3RhdGUgPSB7fTsKICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBmaW5hbFJlZHVjZXJLZXlzLmxlbmd0aDsgX2krKykgewogICAgICB2YXIgX2tleSA9IGZpbmFsUmVkdWNlcktleXNbX2ldOwogICAgICB2YXIgcmVkdWNlciA9IGZpbmFsUmVkdWNlcnNbX2tleV07CiAgICAgIHZhciBwcmV2aW91c1N0YXRlRm9yS2V5ID0gc3RhdGVbX2tleV07CiAgICAgIHZhciBuZXh0U3RhdGVGb3JLZXkgPSByZWR1Y2VyKHByZXZpb3VzU3RhdGVGb3JLZXksIGFjdGlvbik7CiAgICAgIGlmICh0eXBlb2YgbmV4dFN0YXRlRm9yS2V5ID09PSAndW5kZWZpbmVkJykgewogICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSBnZXRVbmRlZmluZWRTdGF0ZUVycm9yTWVzc2FnZShfa2V5LCBhY3Rpb24pOwogICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpOwogICAgICB9CiAgICAgIG5leHRTdGF0ZVtfa2V5XSA9IG5leHRTdGF0ZUZvcktleTsKICAgICAgaGFzQ2hhbmdlZCA9IGhhc0NoYW5nZWQgfHwgbmV4dFN0YXRlRm9yS2V5ICE9PSBwcmV2aW91c1N0YXRlRm9yS2V5OwogICAgfQogICAgcmV0dXJuIGhhc0NoYW5nZWQgPyBuZXh0U3RhdGUgOiBzdGF0ZTsKICB9Owp9Ci8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlZHV4L2VzL2JpbmRBY3Rpb25DcmVhdG9ycy5qcwpmdW5jdGlvbiBiaW5kQWN0aW9uQ3JlYXRvcihhY3Rpb25DcmVhdG9yLCBkaXNwYXRjaCkgewogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gZGlzcGF0Y2goYWN0aW9uQ3JlYXRvci5hcHBseSh1bmRlZmluZWQsIGFyZ3VtZW50cykpOwogIH07Cn0KCi8qKgogKiBUdXJucyBhbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGFyZSBhY3Rpb24gY3JlYXRvcnMsIGludG8gYW4gb2JqZWN0IHdpdGggdGhlCiAqIHNhbWUga2V5cywgYnV0IHdpdGggZXZlcnkgZnVuY3Rpb24gd3JhcHBlZCBpbnRvIGEgYGRpc3BhdGNoYCBjYWxsIHNvIHRoZXkKICogbWF5IGJlIGludm9rZWQgZGlyZWN0bHkuIFRoaXMgaXMganVzdCBhIGNvbnZlbmllbmNlIG1ldGhvZCwgYXMgeW91IGNhbiBjYWxsCiAqIGBzdG9yZS5kaXNwYXRjaChNeUFjdGlvbkNyZWF0b3JzLmRvU29tZXRoaW5nKCkpYCB5b3Vyc2VsZiBqdXN0IGZpbmUuCiAqCiAqIEZvciBjb252ZW5pZW5jZSwgeW91IGNhbiBhbHNvIHBhc3MgYSBzaW5nbGUgZnVuY3Rpb24gYXMgdGhlIGZpcnN0IGFyZ3VtZW50LAogKiBhbmQgZ2V0IGEgZnVuY3Rpb24gaW4gcmV0dXJuLgogKgogKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdH0gYWN0aW9uQ3JlYXRvcnMgQW4gb2JqZWN0IHdob3NlIHZhbHVlcyBhcmUgYWN0aW9uCiAqIGNyZWF0b3IgZnVuY3Rpb25zLiBPbmUgaGFuZHkgd2F5IHRvIG9idGFpbiBpdCBpcyB0byB1c2UgRVM2IGBpbXBvcnQgKiBhc2AKICogc3ludGF4LiBZb3UgbWF5IGFsc28gcGFzcyBhIHNpbmdsZSBmdW5jdGlvbi4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gZGlzcGF0Y2ggVGhlIGBkaXNwYXRjaGAgZnVuY3Rpb24gYXZhaWxhYmxlIG9uIHlvdXIgUmVkdXgKICogc3RvcmUuCiAqCiAqIEByZXR1cm5zIHtGdW5jdGlvbnxPYmplY3R9IFRoZSBvYmplY3QgbWltaWNraW5nIHRoZSBvcmlnaW5hbCBvYmplY3QsIGJ1dCB3aXRoCiAqIGV2ZXJ5IGFjdGlvbiBjcmVhdG9yIHdyYXBwZWQgaW50byB0aGUgYGRpc3BhdGNoYCBjYWxsLiBJZiB5b3UgcGFzc2VkIGEKICogZnVuY3Rpb24gYXMgYGFjdGlvbkNyZWF0b3JzYCwgdGhlIHJldHVybiB2YWx1ZSB3aWxsIGFsc28gYmUgYSBzaW5nbGUKICogZnVuY3Rpb24uCiAqLwpmdW5jdGlvbiBiaW5kQWN0aW9uQ3JlYXRvcnMoYWN0aW9uQ3JlYXRvcnMsIGRpc3BhdGNoKSB7CiAgaWYgKHR5cGVvZiBhY3Rpb25DcmVhdG9ycyA9PT0gJ2Z1bmN0aW9uJykgewogICAgcmV0dXJuIGJpbmRBY3Rpb25DcmVhdG9yKGFjdGlvbkNyZWF0b3JzLCBkaXNwYXRjaCk7CiAgfQoKICBpZiAodHlwZW9mIGFjdGlvbkNyZWF0b3JzICE9PSAnb2JqZWN0JyB8fCBhY3Rpb25DcmVhdG9ycyA9PT0gbnVsbCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdiaW5kQWN0aW9uQ3JlYXRvcnMgZXhwZWN0ZWQgYW4gb2JqZWN0IG9yIGEgZnVuY3Rpb24sIGluc3RlYWQgcmVjZWl2ZWQgJyArIChhY3Rpb25DcmVhdG9ycyA9PT0gbnVsbCA/ICdudWxsJyA6IHR5cGVvZiBhY3Rpb25DcmVhdG9ycykgKyAnLiAnICsgJ0RpZCB5b3Ugd3JpdGUgImltcG9ydCBBY3Rpb25DcmVhdG9ycyBmcm9tIiBpbnN0ZWFkIG9mICJpbXBvcnQgKiBhcyBBY3Rpb25DcmVhdG9ycyBmcm9tIj8nKTsKICB9CgogIHZhciBrZXlzID0gT2JqZWN0LmtleXMoYWN0aW9uQ3JlYXRvcnMpOwogIHZhciBib3VuZEFjdGlvbkNyZWF0b3JzID0ge307CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIga2V5ID0ga2V5c1tpXTsKICAgIHZhciBhY3Rpb25DcmVhdG9yID0gYWN0aW9uQ3JlYXRvcnNba2V5XTsKICAgIGlmICh0eXBlb2YgYWN0aW9uQ3JlYXRvciA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBib3VuZEFjdGlvbkNyZWF0b3JzW2tleV0gPSBiaW5kQWN0aW9uQ3JlYXRvcihhY3Rpb25DcmVhdG9yLCBkaXNwYXRjaCk7CiAgICB9CiAgfQogIHJldHVybiBib3VuZEFjdGlvbkNyZWF0b3JzOwp9Ci8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlZHV4L2VzL2NvbXBvc2UuanMKLyoqCiAqIENvbXBvc2VzIHNpbmdsZS1hcmd1bWVudCBmdW5jdGlvbnMgZnJvbSByaWdodCB0byBsZWZ0LiBUaGUgcmlnaHRtb3N0CiAqIGZ1bmN0aW9uIGNhbiB0YWtlIG11bHRpcGxlIGFyZ3VtZW50cyBhcyBpdCBwcm92aWRlcyB0aGUgc2lnbmF0dXJlIGZvcgogKiB0aGUgcmVzdWx0aW5nIGNvbXBvc2l0ZSBmdW5jdGlvbi4KICoKICogQHBhcmFtIHsuLi5GdW5jdGlvbn0gZnVuY3MgVGhlIGZ1bmN0aW9ucyB0byBjb21wb3NlLgogKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgZnVuY3Rpb24gb2J0YWluZWQgYnkgY29tcG9zaW5nIHRoZSBhcmd1bWVudCBmdW5jdGlvbnMKICogZnJvbSByaWdodCB0byBsZWZ0LiBGb3IgZXhhbXBsZSwgY29tcG9zZShmLCBnLCBoKSBpcyBpZGVudGljYWwgdG8gZG9pbmcKICogKC4uLmFyZ3MpID0+IGYoZyhoKC4uLmFyZ3MpKSkuCiAqLwoKZnVuY3Rpb24gY29tcG9zZSgpIHsKICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgZnVuY3MgPSBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgIGZ1bmNzW19rZXldID0gYXJndW1lbnRzW19rZXldOwogIH0KCiAgaWYgKGZ1bmNzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIGZ1bmN0aW9uIChhcmcpIHsKICAgICAgcmV0dXJuIGFyZzsKICAgIH07CiAgfQoKICBpZiAoZnVuY3MubGVuZ3RoID09PSAxKSB7CiAgICByZXR1cm4gZnVuY3NbMF07CiAgfQoKICByZXR1cm4gZnVuY3MucmVkdWNlKGZ1bmN0aW9uIChhLCBiKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gYShiLmFwcGx5KHVuZGVmaW5lZCwgYXJndW1lbnRzKSk7CiAgICB9OwogIH0pOwp9Ci8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlZHV4L2VzL2FwcGx5TWlkZGxld2FyZS5qcwp2YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9OwoKCgovKioKICogQ3JlYXRlcyBhIHN0b3JlIGVuaGFuY2VyIHRoYXQgYXBwbGllcyBtaWRkbGV3YXJlIHRvIHRoZSBkaXNwYXRjaCBtZXRob2QKICogb2YgdGhlIFJlZHV4IHN0b3JlLiBUaGlzIGlzIGhhbmR5IGZvciBhIHZhcmlldHkgb2YgdGFza3MsIHN1Y2ggYXMgZXhwcmVzc2luZwogKiBhc3luY2hyb25vdXMgYWN0aW9ucyBpbiBhIGNvbmNpc2UgbWFubmVyLCBvciBsb2dnaW5nIGV2ZXJ5IGFjdGlvbiBwYXlsb2FkLgogKgogKiBTZWUgYHJlZHV4LXRodW5rYCBwYWNrYWdlIGFzIGFuIGV4YW1wbGUgb2YgdGhlIFJlZHV4IG1pZGRsZXdhcmUuCiAqCiAqIEJlY2F1c2UgbWlkZGxld2FyZSBpcyBwb3RlbnRpYWxseSBhc3luY2hyb25vdXMsIHRoaXMgc2hvdWxkIGJlIHRoZSBmaXJzdAogKiBzdG9yZSBlbmhhbmNlciBpbiB0aGUgY29tcG9zaXRpb24gY2hhaW4uCiAqCiAqIE5vdGUgdGhhdCBlYWNoIG1pZGRsZXdhcmUgd2lsbCBiZSBnaXZlbiB0aGUgYGRpc3BhdGNoYCBhbmQgYGdldFN0YXRlYCBmdW5jdGlvbnMKICogYXMgbmFtZWQgYXJndW1lbnRzLgogKgogKiBAcGFyYW0gey4uLkZ1bmN0aW9ufSBtaWRkbGV3YXJlcyBUaGUgbWlkZGxld2FyZSBjaGFpbiB0byBiZSBhcHBsaWVkLgogKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgc3RvcmUgZW5oYW5jZXIgYXBwbHlpbmcgdGhlIG1pZGRsZXdhcmUuCiAqLwpmdW5jdGlvbiBhcHBseU1pZGRsZXdhcmUoKSB7CiAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIG1pZGRsZXdhcmVzID0gQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICBtaWRkbGV3YXJlc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTsKICB9CgogIHJldHVybiBmdW5jdGlvbiAoY3JlYXRlU3RvcmUpIHsKICAgIHJldHVybiBmdW5jdGlvbiAocmVkdWNlciwgcHJlbG9hZGVkU3RhdGUsIGVuaGFuY2VyKSB7CiAgICAgIHZhciBzdG9yZSA9IGNyZWF0ZVN0b3JlKHJlZHVjZXIsIHByZWxvYWRlZFN0YXRlLCBlbmhhbmNlcik7CiAgICAgIHZhciBfZGlzcGF0Y2ggPSBzdG9yZS5kaXNwYXRjaDsKICAgICAgdmFyIGNoYWluID0gW107CgogICAgICB2YXIgbWlkZGxld2FyZUFQSSA9IHsKICAgICAgICBnZXRTdGF0ZTogc3RvcmUuZ2V0U3RhdGUsCiAgICAgICAgZGlzcGF0Y2g6IGZ1bmN0aW9uIGRpc3BhdGNoKGFjdGlvbikgewogICAgICAgICAgcmV0dXJuIF9kaXNwYXRjaChhY3Rpb24pOwogICAgICAgIH0KICAgICAgfTsKICAgICAgY2hhaW4gPSBtaWRkbGV3YXJlcy5tYXAoZnVuY3Rpb24gKG1pZGRsZXdhcmUpIHsKICAgICAgICByZXR1cm4gbWlkZGxld2FyZShtaWRkbGV3YXJlQVBJKTsKICAgICAgfSk7CiAgICAgIF9kaXNwYXRjaCA9IGNvbXBvc2UuYXBwbHkodW5kZWZpbmVkLCBjaGFpbikoc3RvcmUuZGlzcGF0Y2gpOwoKICAgICAgcmV0dXJuIF9leHRlbmRzKHt9LCBzdG9yZSwgewogICAgICAgIGRpc3BhdGNoOiBfZGlzcGF0Y2gKICAgICAgfSk7CiAgICB9OwogIH07Cn0KLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVkdXgvZXMvaW5kZXguanMKLyogY29uY2F0ZWQgaGFybW9ueSByZWV4cG9ydCAqL19fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiY3JlYXRlU3RvcmUiLCBmdW5jdGlvbigpIHsgcmV0dXJuIGNyZWF0ZVN0b3JlX2NyZWF0ZVN0b3JlOyB9KTsKLyogY29uY2F0ZWQgaGFybW9ueSByZWV4cG9ydCAqL19fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiY29tYmluZVJlZHVjZXJzIiwgZnVuY3Rpb24oKSB7IHJldHVybiBjb21iaW5lUmVkdWNlcnM7IH0pOwovKiBjb25jYXRlZCBoYXJtb255IHJlZXhwb3J0ICovX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sICJiaW5kQWN0aW9uQ3JlYXRvcnMiLCBmdW5jdGlvbigpIHsgcmV0dXJuIGJpbmRBY3Rpb25DcmVhdG9yczsgfSk7Ci8qIGNvbmNhdGVkIGhhcm1vbnkgcmVleHBvcnQgKi9fX3dlYnBhY2tfcmVxdWlyZV9fLmQoX193ZWJwYWNrX2V4cG9ydHNfXywgImFwcGx5TWlkZGxld2FyZSIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gYXBwbHlNaWRkbGV3YXJlOyB9KTsKLyogY29uY2F0ZWQgaGFybW9ueSByZWV4cG9ydCAqL19fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiY29tcG9zZSIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gY29tcG9zZTsgfSk7CgoKCgoKCgovKgoqIFRoaXMgaXMgYSBkdW1teSBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgZnVuY3Rpb24gbmFtZSBoYXMgYmVlbiBhbHRlcmVkIGJ5IG1pbmlmaWNhdGlvbi4KKiBJZiB0aGUgZnVuY3Rpb24gaGFzIGJlZW4gbWluaWZpZWQgYW5kIE5PREVfRU5WICE9PSAncHJvZHVjdGlvbicsIHdhcm4gdGhlIHVzZXIuCiovCmZ1bmN0aW9uIGlzQ3J1c2hlZCgpIHt9CgppZiAoZmFsc2UpIHsKICB3YXJuaW5nKCdZb3UgYXJlIGN1cnJlbnRseSB1c2luZyBtaW5pZmllZCBjb2RlIG91dHNpZGUgb2YgTk9ERV9FTlYgPT09IFwncHJvZHVjdGlvblwnLiAnICsgJ1RoaXMgbWVhbnMgdGhhdCB5b3UgYXJlIHJ1bm5pbmcgYSBzbG93ZXIgZGV2ZWxvcG1lbnQgYnVpbGQgb2YgUmVkdXguICcgKyAnWW91IGNhbiB1c2UgbG9vc2UtZW52aWZ5IChodHRwczovL2dpdGh1Yi5jb20vemVydG9zaC9sb29zZS1lbnZpZnkpIGZvciBicm93c2VyaWZ5ICcgKyAnb3IgRGVmaW5lUGx1Z2luIGZvciB3ZWJwYWNrIChodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzMwMDMwMDMxKSAnICsgJ3RvIGVuc3VyZSB5b3UgaGF2ZSB0aGUgY29ycmVjdCBjb2RlIGZvciB5b3VyIHByb2R1Y3Rpb24gYnVpbGQuJyk7Cn0KCgoKLyoqKi8gfSksCi8qIDM0ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCnZhciBnOwoKLy8gVGhpcyB3b3JrcyBpbiBub24tc3RyaWN0IG1vZGUKZyA9IChmdW5jdGlvbigpIHsKCXJldHVybiB0aGlzOwp9KSgpOwoKdHJ5IHsKCS8vIFRoaXMgd29ya3MgaWYgZXZhbCBpcyBhbGxvd2VkIChzZWUgQ1NQKQoJZyA9IGcgfHwgRnVuY3Rpb24oInJldHVybiB0aGlzIikoKSB8fCAoMSxldmFsKSgidGhpcyIpOwp9IGNhdGNoKGUpIHsKCS8vIFRoaXMgd29ya3MgaWYgdGhlIHdpbmRvdyByZWZlcmVuY2UgaXMgYXZhaWxhYmxlCglpZih0eXBlb2Ygd2luZG93ID09PSAib2JqZWN0IikKCQlnID0gd2luZG93Owp9CgovLyBnIGNhbiBzdGlsbCBiZSB1bmRlZmluZWQsIGJ1dCBub3RoaW5nIHRvIGRvIGFib3V0IGl0Li4uCi8vIFdlIHJldHVybiB1bmRlZmluZWQsIGluc3RlYWQgb2Ygbm90aGluZyBoZXJlLCBzbyBpdCdzCi8vIGVhc2llciB0byBoYW5kbGUgdGhpcyBjYXNlLiBpZighZ2xvYmFsKSB7IC4uLn0KCm1vZHVsZS5leHBvcnRzID0gZzsKCgovKioqLyB9KSwKLyogMzUgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCnZhciBXcmFwcGVkRWxlbWVudCA9IGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBXcmFwcGVkRWxlbWVudChfcmVmKSB7CiAgICB2YXIgZWxlbWVudCA9IF9yZWYuZWxlbWVudCwKICAgICAgICBjbGFzc05hbWVzID0gX3JlZi5jbGFzc05hbWVzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBXcmFwcGVkRWxlbWVudCk7CgogICAgT2JqZWN0LmFzc2lnbih0aGlzLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIGNsYXNzTmFtZXM6IGNsYXNzTmFtZXMgfSk7CgogICAgaWYgKCEoMCwgX3V0aWxzLmlzRWxlbWVudCkoZWxlbWVudCkpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignSW52YWxpZCBlbGVtZW50IHBhc3NlZCcpOwogICAgfQoKICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFdyYXBwZWRFbGVtZW50LCBbewogICAga2V5OiAnY29uY2VhbCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29uY2VhbCgpIHsKICAgICAgLy8gSGlkZSBwYXNzZWQgaW5wdXQKICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5jbGFzc05hbWVzLmlucHV0KTsKICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5jbGFzc05hbWVzLmhpZGRlblN0YXRlKTsKCiAgICAgIC8vIFJlbW92ZSBlbGVtZW50IGZyb20gdGFiIGluZGV4CiAgICAgIHRoaXMuZWxlbWVudC50YWJJbmRleCA9ICctMSc7CgogICAgICAvLyBCYWNrdXAgb3JpZ2luYWwgc3R5bGVzIGlmIGFueQogICAgICB2YXIgb3JpZ1N0eWxlID0gdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZSgnc3R5bGUnKTsKCiAgICAgIGlmIChvcmlnU3R5bGUpIHsKICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWNob2ljZS1vcmlnLXN0eWxlJywgb3JpZ1N0eWxlKTsKICAgICAgfQoKICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpOwogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWNob2ljZScsICdhY3RpdmUnKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdyZXZlYWwnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJldmVhbCgpIHsKICAgICAgLy8gUmVpbnN0YXRlIHBhc3NlZCBlbGVtZW50CiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2xhc3NOYW1lcy5pbnB1dCk7CiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2xhc3NOYW1lcy5oaWRkZW5TdGF0ZSk7CiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ3RhYmluZGV4Jyk7CgogICAgICAvLyBSZWNvdmVyIG9yaWdpbmFsIHN0eWxlcyBpZiBhbnkKICAgICAgdmFyIG9yaWdTdHlsZSA9IHRoaXMuZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY2hvaWNlLW9yaWctc3R5bGUnKTsKCiAgICAgIGlmIChvcmlnU3R5bGUpIHsKICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdkYXRhLWNob2ljZS1vcmlnLXN0eWxlJyk7CiAgICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBvcmlnU3R5bGUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7CiAgICAgIH0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nKTsKICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1jaG9pY2UnKTsKCiAgICAgIC8vIFJlLWFzc2lnbiB2YWx1ZXMgLSB0aGlzIGlzIHdlaXJkLCBJIGtub3cKICAgICAgdGhpcy5lbGVtZW50LnZhbHVlID0gdGhpcy5lbGVtZW50LnZhbHVlOwogICAgfQogIH0sIHsKICAgIGtleTogJ2VuYWJsZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gZW5hYmxlKCkgewogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpOwogICAgICB0aGlzLmVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAnZGlzYWJsZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzYWJsZSgpIHsKICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7CiAgICAgIHRoaXMuZWxlbWVudC5kaXNhYmxlZCA9IHRydWU7CiAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IHRydWU7CiAgICB9CiAgfSwgewogICAga2V5OiAndHJpZ2dlckV2ZW50JywKICAgIHZhbHVlOiBmdW5jdGlvbiB0cmlnZ2VyRXZlbnQoZXZlbnRUeXBlLCBkYXRhKSB7CiAgICAgICgwLCBfdXRpbHMuZGlzcGF0Y2hFdmVudCkodGhpcy5lbGVtZW50LCBldmVudFR5cGUsIGRhdGEpOwogICAgfQogIH0sIHsKICAgIGtleTogJ3ZhbHVlJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5lbGVtZW50LnZhbHVlOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFdyYXBwZWRFbGVtZW50Owp9KCk7CgpleHBvcnRzLmRlZmF1bHQgPSBXcmFwcGVkRWxlbWVudDsKCi8qKiovIH0pLAovKiAzNiAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlRFTVBMQVRFUyA9IHVuZGVmaW5lZDsKCnZhciBfY2xhc3NuYW1lcyA9IF9fd2VicGFja19yZXF1aXJlX18oODkpOwoKdmFyIF9jbGFzc25hbWVzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NsYXNzbmFtZXMpOwoKdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCnZhciBURU1QTEFURVMgPSBleHBvcnRzLlRFTVBMQVRFUyA9IHsKICBjb250YWluZXJPdXRlcjogZnVuY3Rpb24gY29udGFpbmVyT3V0ZXIoZ2xvYmFsQ2xhc3NlcywgZGlyZWN0aW9uLCBpc1NlbGVjdEVsZW1lbnQsIGlzU2VsZWN0T25lRWxlbWVudCwgc2VhcmNoRW5hYmxlZCwgcGFzc2VkRWxlbWVudFR5cGUpIHsKICAgIHZhciB0YWJJbmRleCA9IGlzU2VsZWN0T25lRWxlbWVudCA/ICd0YWJpbmRleD0iMCInIDogJyc7CiAgICB2YXIgcm9sZSA9IGlzU2VsZWN0RWxlbWVudCA/ICdyb2xlPSJsaXN0Ym94IicgOiAnJzsKICAgIHZhciBhcmlhQXV0b0NvbXBsZXRlID0gJyc7CgogICAgaWYgKGlzU2VsZWN0RWxlbWVudCAmJiBzZWFyY2hFbmFibGVkKSB7CiAgICAgIHJvbGUgPSAncm9sZT0iY29tYm9ib3giJzsKICAgICAgYXJpYUF1dG9Db21wbGV0ZSA9ICdhcmlhLWF1dG9jb21wbGV0ZT0ibGlzdCInOwogICAgfQoKICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9IicgKyBnbG9iYWxDbGFzc2VzLmNvbnRhaW5lck91dGVyICsgJyJcbiAgICAgICAgZGF0YS10eXBlPSInICsgcGFzc2VkRWxlbWVudFR5cGUgKyAnIlxuICAgICAgICAnICsgcm9sZSArICdcbiAgICAgICAgJyArIHRhYkluZGV4ICsgJ1xuICAgICAgICAnICsgYXJpYUF1dG9Db21wbGV0ZSArICdcbiAgICAgICAgYXJpYS1oYXNwb3B1cD0idHJ1ZSJcbiAgICAgICAgYXJpYS1leHBhbmRlZD0iZmFsc2UiXG4gICAgICAgIGRpcj0iJyArIGRpcmVjdGlvbiArICciXG4gICAgICAgID5cbiAgICAgIDwvZGl2PlxuICAgICcpOwogIH0sCiAgY29udGFpbmVySW5uZXI6IGZ1bmN0aW9uIGNvbnRhaW5lcklubmVyKGdsb2JhbENsYXNzZXMpIHsKICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXYgY2xhc3M9IicgKyBnbG9iYWxDbGFzc2VzLmNvbnRhaW5lcklubmVyICsgJyI+PC9kaXY+XG4gICAgJyk7CiAgfSwKICBpdGVtTGlzdDogZnVuY3Rpb24gaXRlbUxpc3QoZ2xvYmFsQ2xhc3NlcywgaXNTZWxlY3RPbmVFbGVtZW50KSB7CiAgICB2YXIgX2NsYXNzTmFtZXM7CgogICAgdmFyIGxvY2FsQ2xhc3NlcyA9ICgwLCBfY2xhc3NuYW1lczIuZGVmYXVsdCkoZ2xvYmFsQ2xhc3Nlcy5saXN0LCAoX2NsYXNzTmFtZXMgPSB7fSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzLCBnbG9iYWxDbGFzc2VzLmxpc3RTaW5nbGUsIGlzU2VsZWN0T25lRWxlbWVudCksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lcywgZ2xvYmFsQ2xhc3Nlcy5saXN0SXRlbXMsICFpc1NlbGVjdE9uZUVsZW1lbnQpLCBfY2xhc3NOYW1lcykpOwoKICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXYgY2xhc3M9IicgKyBsb2NhbENsYXNzZXMgKyAnIj48L2Rpdj5cbiAgICAnKTsKICB9LAogIHBsYWNlaG9sZGVyOiBmdW5jdGlvbiBwbGFjZWhvbGRlcihnbG9iYWxDbGFzc2VzLCB2YWx1ZSkgewogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPGRpdiBjbGFzcz0iJyArIGdsb2JhbENsYXNzZXMucGxhY2Vob2xkZXIgKyAnIj5cbiAgICAgICAgJyArIHZhbHVlICsgJ1xuICAgICAgPC9kaXY+XG4gICAgJyk7CiAgfSwKICBpdGVtOiBmdW5jdGlvbiBpdGVtKGdsb2JhbENsYXNzZXMsIGRhdGEsIHJlbW92ZUl0ZW1CdXR0b24pIHsKICAgIHZhciBfY2xhc3NOYW1lczI7CgogICAgdmFyIGFyaWFTZWxlY3RlZCA9IGRhdGEuYWN0aXZlID8gJ2FyaWEtc2VsZWN0ZWQ9InRydWUiJyA6ICcnOwogICAgdmFyIGFyaWFEaXNhYmxlZCA9IGRhdGEuZGlzYWJsZWQgPyAnYXJpYS1kaXNhYmxlZD0idHJ1ZSInIDogJyc7CgogICAgdmFyIGxvY2FsQ2xhc3NlcyA9ICgwLCBfY2xhc3NuYW1lczIuZGVmYXVsdCkoZ2xvYmFsQ2xhc3Nlcy5pdGVtLCAoX2NsYXNzTmFtZXMyID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczIsIGdsb2JhbENsYXNzZXMuaGlnaGxpZ2h0ZWRTdGF0ZSwgZGF0YS5oaWdobGlnaHRlZCksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczIsIGdsb2JhbENsYXNzZXMuaXRlbVNlbGVjdGFibGUsICFkYXRhLmhpZ2hsaWdodGVkKSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzMiwgZ2xvYmFsQ2xhc3Nlcy5wbGFjZWhvbGRlciwgZGF0YS5wbGFjZWhvbGRlciksIF9jbGFzc05hbWVzMikpOwoKICAgIGlmIChyZW1vdmVJdGVtQnV0dG9uKSB7CiAgICAgIHZhciBfY2xhc3NOYW1lczM7CgogICAgICBsb2NhbENsYXNzZXMgPSAoMCwgX2NsYXNzbmFtZXMyLmRlZmF1bHQpKGdsb2JhbENsYXNzZXMuaXRlbSwgKF9jbGFzc05hbWVzMyA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXMzLCBnbG9iYWxDbGFzc2VzLmhpZ2hsaWdodGVkU3RhdGUsIGRhdGEuaGlnaGxpZ2h0ZWQpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXMzLCBnbG9iYWxDbGFzc2VzLml0ZW1TZWxlY3RhYmxlLCAhZGF0YS5kaXNhYmxlZCksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczMsIGdsb2JhbENsYXNzZXMucGxhY2Vob2xkZXIsIGRhdGEucGxhY2Vob2xkZXIpLCBfY2xhc3NOYW1lczMpKTsKCiAgICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzPSInICsgbG9jYWxDbGFzc2VzICsgJyJcbiAgICAgICAgICBkYXRhLWl0ZW1cbiAgICAgICAgICBkYXRhLWlkPSInICsgZGF0YS5pZCArICciXG4gICAgICAgICAgZGF0YS12YWx1ZT0iJyArIGRhdGEudmFsdWUgKyAnIlxuICAgICAgICAgIGRhdGEtZGVsZXRhYmxlXG4gICAgICAgICAgJyArIGFyaWFTZWxlY3RlZCArICdcbiAgICAgICAgICAnICsgYXJpYURpc2FibGVkICsgJ1xuICAgICAgICAgID5cbiAgICAgICAgICAnICsgZGF0YS5sYWJlbCArICc8IS0tXG4gICAgICAgLS0+PGJ1dHRvblxuICAgICAgICAgICAgdHlwZT0iYnV0dG9uIlxuICAgICAgICAgICAgY2xhc3M9IicgKyBnbG9iYWxDbGFzc2VzLmJ1dHRvbiArICciXG4gICAgICAgICAgICBkYXRhLWJ1dHRvblxuICAgICAgICAgICAgYXJpYS1sYWJlbD0iUmVtb3ZlIGl0ZW06IFwnJyArIGRhdGEudmFsdWUgKyAnXCciXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICBSZW1vdmUgaXRlbVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICcpOwogICAgfQoKICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9IicgKyBsb2NhbENsYXNzZXMgKyAnIlxuICAgICAgICBkYXRhLWl0ZW1cbiAgICAgICAgZGF0YS1pZD0iJyArIGRhdGEuaWQgKyAnIlxuICAgICAgICBkYXRhLXZhbHVlPSInICsgZGF0YS52YWx1ZSArICciXG4gICAgICAgICcgKyBhcmlhU2VsZWN0ZWQgKyAnXG4gICAgICAgICcgKyBhcmlhRGlzYWJsZWQgKyAnXG4gICAgICAgID5cbiAgICAgICAgJyArIGRhdGEubGFiZWwgKyAnXG4gICAgICA8L2Rpdj5cbiAgICAnKTsKICB9LAogIGNob2ljZUxpc3Q6IGZ1bmN0aW9uIGNob2ljZUxpc3QoZ2xvYmFsQ2xhc3NlcywgaXNTZWxlY3RPbmVFbGVtZW50KSB7CiAgICB2YXIgYXJpYU11bHRpU2VsZWN0YWJsZSA9ICFpc1NlbGVjdE9uZUVsZW1lbnQgPyAnYXJpYS1tdWx0aXNlbGVjdGFibGU9InRydWUiJyA6ICcnOwoKICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9IicgKyBnbG9iYWxDbGFzc2VzLmxpc3QgKyAnIlxuICAgICAgICBkaXI9Imx0ciJcbiAgICAgICAgcm9sZT0ibGlzdGJveCJcbiAgICAgICAgJyArIGFyaWFNdWx0aVNlbGVjdGFibGUgKyAnXG4gICAgICAgID5cbiAgICAgIDwvZGl2PlxuICAgICcpOwogIH0sCiAgY2hvaWNlR3JvdXA6IGZ1bmN0aW9uIGNob2ljZUdyb3VwKGdsb2JhbENsYXNzZXMsIGRhdGEpIHsKICAgIHZhciBhcmlhRGlzYWJsZWQgPSBkYXRhLmRpc2FibGVkID8gJ2FyaWEtZGlzYWJsZWQ9InRydWUiJyA6ICcnOwogICAgdmFyIGxvY2FsQ2xhc3NlcyA9ICgwLCBfY2xhc3NuYW1lczIuZGVmYXVsdCkoZ2xvYmFsQ2xhc3Nlcy5ncm91cCwgX2RlZmluZVByb3BlcnR5KHt9LCBnbG9iYWxDbGFzc2VzLml0ZW1EaXNhYmxlZCwgZGF0YS5kaXNhYmxlZCkpOwoKICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9IicgKyBsb2NhbENsYXNzZXMgKyAnIlxuICAgICAgICBkYXRhLWdyb3VwXG4gICAgICAgIGRhdGEtaWQ9IicgKyBkYXRhLmlkICsgJyJcbiAgICAgICAgZGF0YS12YWx1ZT0iJyArIGRhdGEudmFsdWUgKyAnIlxuICAgICAgICByb2xlPSJncm91cCJcbiAgICAgICAgJyArIGFyaWFEaXNhYmxlZCArICdcbiAgICAgICAgPlxuICAgICAgICA8ZGl2IGNsYXNzPSInICsgZ2xvYmFsQ2xhc3Nlcy5ncm91cEhlYWRpbmcgKyAnIj4nICsgZGF0YS52YWx1ZSArICc8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICcpOwogIH0sCiAgY2hvaWNlOiBmdW5jdGlvbiBjaG9pY2UoZ2xvYmFsQ2xhc3NlcywgZGF0YSwgaXRlbVNlbGVjdFRleHQpIHsKICAgIHZhciBfY2xhc3NOYW1lczU7CgogICAgdmFyIHJvbGUgPSBkYXRhLmdyb3VwSWQgPiAwID8gJ3JvbGU9InRyZWVpdGVtIicgOiAncm9sZT0ib3B0aW9uIic7CiAgICB2YXIgbG9jYWxDbGFzc2VzID0gKDAsIF9jbGFzc25hbWVzMi5kZWZhdWx0KShnbG9iYWxDbGFzc2VzLml0ZW0sIGdsb2JhbENsYXNzZXMuaXRlbUNob2ljZSwgKF9jbGFzc05hbWVzNSA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXM1LCBnbG9iYWxDbGFzc2VzLml0ZW1EaXNhYmxlZCwgZGF0YS5kaXNhYmxlZCksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczUsIGdsb2JhbENsYXNzZXMuaXRlbVNlbGVjdGFibGUsICFkYXRhLmRpc2FibGVkKSwgX2RlZmluZVByb3BlcnR5KF9jbGFzc05hbWVzNSwgZ2xvYmFsQ2xhc3Nlcy5wbGFjZWhvbGRlciwgZGF0YS5wbGFjZWhvbGRlciksIF9jbGFzc05hbWVzNSkpOwoKICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3M9IicgKyBsb2NhbENsYXNzZXMgKyAnIlxuICAgICAgICBkYXRhLXNlbGVjdC10ZXh0PSInICsgaXRlbVNlbGVjdFRleHQgKyAnIlxuICAgICAgICBkYXRhLWNob2ljZVxuICAgICAgICBkYXRhLWlkPSInICsgZGF0YS5pZCArICciXG4gICAgICAgIGRhdGEtdmFsdWU9IicgKyBkYXRhLnZhbHVlICsgJyJcbiAgICAgICAgJyArIChkYXRhLmRpc2FibGVkID8gJ2RhdGEtY2hvaWNlLWRpc2FibGVkIGFyaWEtZGlzYWJsZWQ9InRydWUiJyA6ICdkYXRhLWNob2ljZS1zZWxlY3RhYmxlJykgKyAnXG4gICAgICAgIGlkPSInICsgZGF0YS5lbGVtZW50SWQgKyAnIlxuICAgICAgICAnICsgcm9sZSArICdcbiAgICAgICAgPlxuICAgICAgICAnICsgZGF0YS5sYWJlbCArICdcbiAgICAgIDwvZGl2PlxuICAgICcpOwogIH0sCiAgaW5wdXQ6IGZ1bmN0aW9uIGlucHV0KGdsb2JhbENsYXNzZXMpIHsKICAgIHZhciBsb2NhbENsYXNzZXMgPSAoMCwgX2NsYXNzbmFtZXMyLmRlZmF1bHQpKGdsb2JhbENsYXNzZXMuaW5wdXQsIGdsb2JhbENsYXNzZXMuaW5wdXRDbG9uZWQpOwoKICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxpbnB1dFxuICAgICAgICB0eXBlPSJ0ZXh0IlxuICAgICAgICBjbGFzcz0iJyArIGxvY2FsQ2xhc3NlcyArICciXG4gICAgICAgIGF1dG9jb21wbGV0ZT0ib2ZmIlxuICAgICAgICBhdXRvY2FwaXRhbGl6ZT0ib2ZmIlxuICAgICAgICBzcGVsbGNoZWNrPSJmYWxzZSJcbiAgICAgICAgcm9sZT0idGV4dGJveCJcbiAgICAgICAgYXJpYS1hdXRvY29tcGxldGU9Imxpc3QiXG4gICAgICAgID5cbiAgICAnKTsKICB9LAogIGRyb3Bkb3duOiBmdW5jdGlvbiBkcm9wZG93bihnbG9iYWxDbGFzc2VzKSB7CiAgICB2YXIgbG9jYWxDbGFzc2VzID0gKDAsIF9jbGFzc25hbWVzMi5kZWZhdWx0KShnbG9iYWxDbGFzc2VzLmxpc3QsIGdsb2JhbENsYXNzZXMubGlzdERyb3Bkb3duKTsKCiAgICByZXR1cm4gKDAsIF91dGlscy5zdHJUb0VsKSgnXG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzPSInICsgbG9jYWxDbGFzc2VzICsgJyJcbiAgICAgICAgYXJpYS1leHBhbmRlZD0iZmFsc2UiXG4gICAgICAgID5cbiAgICAgIDwvZGl2PlxuICAgICcpOwogIH0sCiAgbm90aWNlOiBmdW5jdGlvbiBub3RpY2UoZ2xvYmFsQ2xhc3NlcywgbGFiZWwpIHsKICAgIHZhciBfY2xhc3NOYW1lczY7CgogICAgdmFyIHR5cGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICcnOwoKICAgIHZhciBsb2NhbENsYXNzZXMgPSAoMCwgX2NsYXNzbmFtZXMyLmRlZmF1bHQpKGdsb2JhbENsYXNzZXMuaXRlbSwgZ2xvYmFsQ2xhc3Nlcy5pdGVtQ2hvaWNlLCAoX2NsYXNzTmFtZXM2ID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3NOYW1lczYsIGdsb2JhbENsYXNzZXMubm9SZXN1bHRzLCB0eXBlID09PSAnbm8tcmVzdWx0cycpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzTmFtZXM2LCBnbG9iYWxDbGFzc2VzLm5vQ2hvaWNlcywgdHlwZSA9PT0gJ25vLWNob2ljZXMnKSwgX2NsYXNzTmFtZXM2KSk7CgogICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyVG9FbCkoJ1xuICAgICAgPGRpdiBjbGFzcz0iJyArIGxvY2FsQ2xhc3NlcyArICciPlxuICAgICAgICAnICsgbGFiZWwgKyAnXG4gICAgICA8L2Rpdj5cbiAgICAnKTsKICB9LAogIG9wdGlvbjogZnVuY3Rpb24gb3B0aW9uKGRhdGEpIHsKICAgIHJldHVybiAoMCwgX3V0aWxzLnN0clRvRWwpKCdcbiAgICAgIDxvcHRpb24gdmFsdWU9IicgKyBkYXRhLnZhbHVlICsgJyIgJyArIChkYXRhLmFjdGl2ZSA/ICdzZWxlY3RlZCcgOiAnJykgKyAnICcgKyAoZGF0YS5kaXNhYmxlZCA/ICdkaXNhYmxlZCcgOiAnJykgKyAnPicgKyBkYXRhLmxhYmVsICsgJzwvb3B0aW9uPlxuICAgICcpOwogIH0KfTsKCmV4cG9ydHMuZGVmYXVsdCA9IFRFTVBMQVRFUzsKCi8qKiovIH0pLAovKiAzNyAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7Cgptb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oMzgpOwoKCi8qKiovIH0pLAovKiAzOCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CgoKdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7Cgp2YXIgX2Z1c2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM5KTsKCnZhciBfZnVzZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9mdXNlKTsKCnZhciBfZGVlcG1lcmdlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MCk7Cgp2YXIgX2RlZXBtZXJnZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9kZWVwbWVyZ2UpOwoKX193ZWJwYWNrX3JlcXVpcmVfXyg0MSk7Cgp2YXIgX3N0b3JlMiA9IF9fd2VicGFja19yZXF1aXJlX18oNzMpOwoKdmFyIF9zdG9yZTMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9zdG9yZTIpOwoKdmFyIF9jb21wb25lbnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4Mik7Cgp2YXIgX2NvbnN0YW50cyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7Cgp2YXIgX3RlbXBsYXRlcyA9IF9fd2VicGFja19yZXF1aXJlX18oMzYpOwoKdmFyIF9jaG9pY2VzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5MCk7Cgp2YXIgX2l0ZW1zID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5MSk7Cgp2YXIgX2dyb3VwcyA9IF9fd2VicGFja19yZXF1aXJlX18oOTIpOwoKdmFyIF9taXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5Myk7Cgp2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSBlbHNlIHsgcmV0dXJuIEFycmF5LmZyb20oYXJyKTsgfSB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCi8qKgogKiBDaG9pY2VzCiAqIEBhdXRob3IgSm9zaCBKb2huc29uPGpvc2hAam9zaHVham9obnNvbi5jby51az4KICovCnZhciBDaG9pY2VzID0gZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIENob2ljZXMoKSB7CiAgICB2YXIgZWxlbWVudCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJ1tkYXRhLWNob2ljZV0nOwogICAgdmFyIHVzZXJDb25maWcgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDaG9pY2VzKTsKCiAgICBpZiAoKDAsIF91dGlscy5pc1R5cGUpKCdTdHJpbmcnLCBlbGVtZW50KSkgewogICAgICB2YXIgZWxlbWVudHMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZWxlbWVudCkpOwoKICAgICAgLy8gSWYgdGhlcmUgYXJlIG11bHRpcGxlIGVsZW1lbnRzLCBjcmVhdGUgYSBuZXcgaW5zdGFuY2UKICAgICAgLy8gZm9yIGVhY2ggZWxlbWVudCBiZXNpZGVzIHRoZSBmaXJzdCBvbmUgKGFzIHRoYXQgYWxyZWFkeSBoYXMgYW4gaW5zdGFuY2UpCiAgICAgIGlmIChlbGVtZW50cy5sZW5ndGggPiAxKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dlbmVyYXRlSW5zdGFuY2VzKGVsZW1lbnRzLCB1c2VyQ29uZmlnKTsKICAgICAgfQogICAgfQoKICAgIHRoaXMuY29uZmlnID0gX2RlZXBtZXJnZTIuZGVmYXVsdC5hbGwoW19jb25zdGFudHMuREVGQVVMVF9DT05GSUcsIENob2ljZXMudXNlckRlZmF1bHRzLCB1c2VyQ29uZmlnXSk7CgogICAgaWYgKCEoMCwgX3V0aWxzLmRvS2V5c01hdGNoKSh0aGlzLmNvbmZpZywgX2NvbnN0YW50cy5ERUZBVUxUX0NPTkZJRykpIHsKICAgICAgY29uc29sZS53YXJuKCdVbmtub3duIGNvbmZpZyBvcHRpb24ocykgcGFzc2VkJyk7CiAgICB9CgogICAgaWYgKCFbJ2F1dG8nLCAnYWx3YXlzJ10uaW5jbHVkZXModGhpcy5jb25maWcucmVuZGVyU2VsZWN0ZWRDaG9pY2VzKSkgewogICAgICB0aGlzLmNvbmZpZy5yZW5kZXJTZWxlY3RlZENob2ljZXMgPSAnYXV0byc7CiAgICB9CgogICAgLy8gUmV0cmlldmUgdHJpZ2dlcmluZyBlbGVtZW50IChpLmUuIGVsZW1lbnQgd2l0aCAnZGF0YS1jaG9pY2UnIHRyaWdnZXIpCiAgICB2YXIgcGFzc2VkRWxlbWVudCA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnU3RyaW5nJywgZWxlbWVudCkgPyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsZW1lbnQpIDogZWxlbWVudDsKCiAgICBpZiAoIXBhc3NlZEVsZW1lbnQpIHsKICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoJ0NvdWxkIG5vdCBmaW5kIHBhc3NlZCBlbGVtZW50IG9yIHBhc3NlZCBlbGVtZW50IHdhcyBvZiBhbiBpbnZhbGlkIHR5cGUnKTsKICAgIH0KCiAgICB0aGlzLl9pc1RleHRFbGVtZW50ID0gcGFzc2VkRWxlbWVudC50eXBlID09PSAndGV4dCc7CiAgICB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQgPSBwYXNzZWRFbGVtZW50LnR5cGUgPT09ICdzZWxlY3Qtb25lJzsKICAgIHRoaXMuX2lzU2VsZWN0TXVsdGlwbGVFbGVtZW50ID0gcGFzc2VkRWxlbWVudC50eXBlID09PSAnc2VsZWN0LW11bHRpcGxlJzsKICAgIHRoaXMuX2lzU2VsZWN0RWxlbWVudCA9IHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCB8fCB0aGlzLl9pc1NlbGVjdE11bHRpcGxlRWxlbWVudDsKCiAgICBpZiAodGhpcy5faXNUZXh0RWxlbWVudCkgewogICAgICB0aGlzLnBhc3NlZEVsZW1lbnQgPSBuZXcgX2NvbXBvbmVudHMuV3JhcHBlZElucHV0KHsKICAgICAgICBlbGVtZW50OiBwYXNzZWRFbGVtZW50LAogICAgICAgIGNsYXNzTmFtZXM6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMsCiAgICAgICAgZGVsaW1pdGVyOiB0aGlzLmNvbmZpZy5kZWxpbWl0ZXIKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKHRoaXMuX2lzU2VsZWN0RWxlbWVudCkgewogICAgICB0aGlzLnBhc3NlZEVsZW1lbnQgPSBuZXcgX2NvbXBvbmVudHMuV3JhcHBlZFNlbGVjdCh7CiAgICAgICAgZWxlbWVudDogcGFzc2VkRWxlbWVudCwKICAgICAgICBjbGFzc05hbWVzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzCiAgICAgIH0pOwogICAgfQoKICAgIGlmICghcGFzc2VkRWxlbWVudCkgewogICAgICByZXR1cm4gY29uc29sZS5lcnJvcignUGFzc2VkIGVsZW1lbnQgd2FzIG9mIGFuIGludmFsaWQgdHlwZScpOwogICAgfQoKICAgIGlmICh0aGlzLmNvbmZpZy5zaG91bGRTb3J0SXRlbXMgPT09IHRydWUgJiYgdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50ICYmICF0aGlzLmNvbmZpZy5zaWxlbnQpIHsKICAgICAgY29uc29sZS53YXJuKCJzaG91bGRTb3J0RWxlbWVudHM6IFR5cGUgb2YgcGFzc2VkIGVsZW1lbnQgaXMgJ3NlbGVjdC1vbmUnLCBmYWxsaW5nIGJhY2sgdG8gZmFsc2UuIik7CiAgICB9CgogICAgdGhpcy5pbml0aWFsaXNlZCA9IGZhbHNlOwoKICAgIHRoaXMuX3N0b3JlID0gbmV3IF9zdG9yZTMuZGVmYXVsdCh0aGlzLnJlbmRlcik7CiAgICB0aGlzLl9pbml0aWFsU3RhdGUgPSB7fTsKICAgIHRoaXMuX2N1cnJlbnRTdGF0ZSA9IHt9OwogICAgdGhpcy5fcHJldlN0YXRlID0ge307CiAgICB0aGlzLl9jdXJyZW50VmFsdWUgPSAnJzsKICAgIHRoaXMuX2NhblNlYXJjaCA9IHRoaXMuY29uZmlnLnNlYXJjaEVuYWJsZWQ7CiAgICB0aGlzLl9pc1Njcm9sbGluZ09uSWUgPSBmYWxzZTsKICAgIHRoaXMuX2hpZ2hsaWdodFBvc2l0aW9uID0gMDsKICAgIHRoaXMuX3dhc1RhcCA9IHRydWU7CiAgICB0aGlzLl9wbGFjZWhvbGRlclZhbHVlID0gdGhpcy5fZ2VuZXJhdGVQbGFjZWhvbGRlclZhbHVlKCk7CiAgICB0aGlzLl9iYXNlSWQgPSAoMCwgX3V0aWxzLmdlbmVyYXRlSWQpKHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LCAnY2hvaWNlcy0nKTsKICAgIHRoaXMuX2RpcmVjdGlvbiA9IHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LmdldEF0dHJpYnV0ZSgnZGlyJykgfHwgJ2x0cic7CiAgICB0aGlzLl9pZE5hbWVzID0gewogICAgICBpdGVtQ2hvaWNlOiAnaXRlbS1jaG9pY2UnCiAgICB9OwogICAgLy8gQXNzaWduIHByZXNldCBjaG9pY2VzIGZyb20gcGFzc2VkIG9iamVjdAogICAgdGhpcy5fcHJlc2V0Q2hvaWNlcyA9IHRoaXMuY29uZmlnLmNob2ljZXM7CiAgICAvLyBBc3NpZ24gcHJlc2V0IGl0ZW1zIGZyb20gcGFzc2VkIG9iamVjdCBmaXJzdAogICAgdGhpcy5fcHJlc2V0SXRlbXMgPSB0aGlzLmNvbmZpZy5pdGVtczsKICAgIC8vIFRoZW4gYWRkIGFueSB2YWx1ZXMgcGFzc2VkIGZyb20gYXR0cmlidXRlCiAgICBpZiAodGhpcy5wYXNzZWRFbGVtZW50LnZhbHVlKSB7CiAgICAgIHRoaXMuX3ByZXNldEl0ZW1zID0gdGhpcy5fcHJlc2V0SXRlbXMuY29uY2F0KHRoaXMucGFzc2VkRWxlbWVudC52YWx1ZS5zcGxpdCh0aGlzLmNvbmZpZy5kZWxpbWl0ZXIpKTsKICAgIH0KCiAgICB0aGlzLl9yZW5kZXIgPSB0aGlzLl9yZW5kZXIuYmluZCh0aGlzKTsKICAgIHRoaXMuX29uRm9jdXMgPSB0aGlzLl9vbkZvY3VzLmJpbmQodGhpcyk7CiAgICB0aGlzLl9vbkJsdXIgPSB0aGlzLl9vbkJsdXIuYmluZCh0aGlzKTsKICAgIHRoaXMuX29uS2V5VXAgPSB0aGlzLl9vbktleVVwLmJpbmQodGhpcyk7CiAgICB0aGlzLl9vbktleURvd24gPSB0aGlzLl9vbktleURvd24uYmluZCh0aGlzKTsKICAgIHRoaXMuX29uQ2xpY2sgPSB0aGlzLl9vbkNsaWNrLmJpbmQodGhpcyk7CiAgICB0aGlzLl9vblRvdWNoTW92ZSA9IHRoaXMuX29uVG91Y2hNb3ZlLmJpbmQodGhpcyk7CiAgICB0aGlzLl9vblRvdWNoRW5kID0gdGhpcy5fb25Ub3VjaEVuZC5iaW5kKHRoaXMpOwogICAgdGhpcy5fb25Nb3VzZURvd24gPSB0aGlzLl9vbk1vdXNlRG93bi5iaW5kKHRoaXMpOwogICAgdGhpcy5fb25Nb3VzZU92ZXIgPSB0aGlzLl9vbk1vdXNlT3Zlci5iaW5kKHRoaXMpOwogICAgdGhpcy5fb25Gb3JtUmVzZXQgPSB0aGlzLl9vbkZvcm1SZXNldC5iaW5kKHRoaXMpOwogICAgdGhpcy5fb25BS2V5ID0gdGhpcy5fb25BS2V5LmJpbmQodGhpcyk7CiAgICB0aGlzLl9vbkVudGVyS2V5ID0gdGhpcy5fb25FbnRlcktleS5iaW5kKHRoaXMpOwogICAgdGhpcy5fb25Fc2NhcGVLZXkgPSB0aGlzLl9vbkVzY2FwZUtleS5iaW5kKHRoaXMpOwogICAgdGhpcy5fb25EaXJlY3Rpb25LZXkgPSB0aGlzLl9vbkRpcmVjdGlvbktleS5iaW5kKHRoaXMpOwogICAgdGhpcy5fb25EZWxldGVLZXkgPSB0aGlzLl9vbkRlbGV0ZUtleS5iaW5kKHRoaXMpOwoKICAgIC8vIElmIGVsZW1lbnQgaGFzIGFscmVhZHkgYmVlbiBpbml0aWFsaXNlZCB3aXRoIENob2ljZXMsIGZhaWwgc2lsZW50bHkKICAgIGlmICh0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY2hvaWNlJykgPT09ICdhY3RpdmUnKSB7CiAgICAgIGNvbnNvbGUud2FybignVHJ5aW5nIHRvIGluaXRpYWxpc2UgQ2hvaWNlcyBvbiBlbGVtZW50IGFscmVhZHkgaW5pdGlhbGlzZWQnKTsKICAgIH0KCiAgICAvLyBMZXQncyBnbwogICAgdGhpcy5pbml0KCk7CiAgfQoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgPSAgICAgICAgICAgIFB1YmxpYyBmdW5jdGlvbnMgICAgICAgICAgICA9CiAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKICBfY3JlYXRlQ2xhc3MoQ2hvaWNlcywgW3sKICAgIGtleTogJ2luaXQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgIGlmICh0aGlzLmluaXRpYWxpc2VkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLl9jcmVhdGVUZW1wbGF0ZXMoKTsKICAgICAgdGhpcy5fY3JlYXRlRWxlbWVudHMoKTsKICAgICAgdGhpcy5fY3JlYXRlU3RydWN0dXJlKCk7CgogICAgICAvLyBTZXQgaW5pdGlhbCBzdGF0ZSAoV2UgbmVlZCB0byBjbG9uZSB0aGUgc3RhdGUgYmVjYXVzZSBzb21lIHJlZHVjZXJzCiAgICAgIC8vIG1vZGlmeSB0aGUgaW5uZXIgb2JqZWN0cyBwcm9wZXJ0aWVzIGluIHRoZSBzdGF0ZSkg8J+kogogICAgICB0aGlzLl9pbml0aWFsU3RhdGUgPSAoMCwgX3V0aWxzLmNsb25lT2JqZWN0KSh0aGlzLl9zdG9yZS5zdGF0ZSk7CiAgICAgIHRoaXMuX3N0b3JlLnN1YnNjcmliZSh0aGlzLl9yZW5kZXIpOwogICAgICB0aGlzLl9yZW5kZXIoKTsKICAgICAgdGhpcy5fYWRkRXZlbnRMaXN0ZW5lcnMoKTsKCiAgICAgIHZhciBzaG91bGREaXNhYmxlID0gIXRoaXMuY29uZmlnLmFkZEl0ZW1zIHx8IHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKTsKCiAgICAgIGlmIChzaG91bGREaXNhYmxlKSB7CiAgICAgICAgdGhpcy5kaXNhYmxlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5pdGlhbGlzZWQgPSB0cnVlOwoKICAgICAgdmFyIGNhbGxiYWNrT25Jbml0ID0gdGhpcy5jb25maWcuY2FsbGJhY2tPbkluaXQ7CiAgICAgIC8vIFJ1biBjYWxsYmFjayBpZiBpdCBpcyBhIGZ1bmN0aW9uCgogICAgICBpZiAoY2FsbGJhY2tPbkluaXQgJiYgKDAsIF91dGlscy5pc1R5cGUpKCdGdW5jdGlvbicsIGNhbGxiYWNrT25Jbml0KSkgewogICAgICAgIGNhbGxiYWNrT25Jbml0LmNhbGwodGhpcyk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdkZXN0cm95JywKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICBpZiAoIXRoaXMuaW5pdGlhbGlzZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuX3JlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CiAgICAgIHRoaXMucGFzc2VkRWxlbWVudC5yZXZlYWwoKTsKICAgICAgdGhpcy5jb250YWluZXJPdXRlci51bndyYXAodGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQpOwoKICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0RWxlbWVudCkgewogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC5vcHRpb25zID0gdGhpcy5fcHJlc2V0Q2hvaWNlczsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhclN0b3JlKCk7CgogICAgICB0aGlzLmNvbmZpZy50ZW1wbGF0ZXMgPSBudWxsOwogICAgICB0aGlzLmluaXRpYWxpc2VkID0gZmFsc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAnZW5hYmxlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBlbmFibGUoKSB7CiAgICAgIGlmICh0aGlzLnBhc3NlZEVsZW1lbnQuaXNEaXNhYmxlZCkgewogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC5lbmFibGUoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuY29udGFpbmVyT3V0ZXIuaXNEaXNhYmxlZCkgewogICAgICAgIHRoaXMuX2FkZEV2ZW50TGlzdGVuZXJzKCk7CiAgICAgICAgdGhpcy5pbnB1dC5lbmFibGUoKTsKICAgICAgICB0aGlzLmNvbnRhaW5lck91dGVyLmVuYWJsZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdkaXNhYmxlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNhYmxlKCkgewogICAgICBpZiAoIXRoaXMucGFzc2VkRWxlbWVudC5pc0Rpc2FibGVkKSB7CiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LmRpc2FibGUoKTsKICAgICAgfQoKICAgICAgaWYgKCF0aGlzLmNvbnRhaW5lck91dGVyLmlzRGlzYWJsZWQpIHsKICAgICAgICB0aGlzLl9yZW1vdmVFdmVudExpc3RlbmVycygpOwogICAgICAgIHRoaXMuaW5wdXQuZGlzYWJsZSgpOwogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZGlzYWJsZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdoaWdobGlnaHRJdGVtJywKICAgIHZhbHVlOiBmdW5jdGlvbiBoaWdobGlnaHRJdGVtKGl0ZW0pIHsKICAgICAgdmFyIHJ1bkV2ZW50ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0cnVlOwoKICAgICAgaWYgKCFpdGVtKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHZhciBpZCA9IGl0ZW0uaWQsCiAgICAgICAgICBfaXRlbSRncm91cElkID0gaXRlbS5ncm91cElkLAogICAgICAgICAgZ3JvdXBJZCA9IF9pdGVtJGdyb3VwSWQgPT09IHVuZGVmaW5lZCA/IC0xIDogX2l0ZW0kZ3JvdXBJZCwKICAgICAgICAgIF9pdGVtJHZhbHVlID0gaXRlbS52YWx1ZSwKICAgICAgICAgIHZhbHVlID0gX2l0ZW0kdmFsdWUgPT09IHVuZGVmaW5lZCA/ICcnIDogX2l0ZW0kdmFsdWUsCiAgICAgICAgICBfaXRlbSRsYWJlbCA9IGl0ZW0ubGFiZWwsCiAgICAgICAgICBsYWJlbCA9IF9pdGVtJGxhYmVsID09PSB1bmRlZmluZWQgPyAnJyA6IF9pdGVtJGxhYmVsOwoKICAgICAgdmFyIGdyb3VwID0gZ3JvdXBJZCA+PSAwID8gdGhpcy5fc3RvcmUuZ2V0R3JvdXBCeUlkKGdyb3VwSWQpIDogbnVsbDsKCiAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfaXRlbXMuaGlnaGxpZ2h0SXRlbSkoaWQsIHRydWUpKTsKCiAgICAgIGlmIChydW5FdmVudCkgewogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMuaGlnaGxpZ2h0SXRlbSwgewogICAgICAgICAgaWQ6IGlkLAogICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgbGFiZWw6IGxhYmVsLAogICAgICAgICAgZ3JvdXBWYWx1ZTogZ3JvdXAgJiYgZ3JvdXAudmFsdWUgPyBncm91cC52YWx1ZSA6IG51bGwKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfSwgewogICAga2V5OiAndW5oaWdobGlnaHRJdGVtJywKICAgIHZhbHVlOiBmdW5jdGlvbiB1bmhpZ2hsaWdodEl0ZW0oaXRlbSkgewogICAgICBpZiAoIWl0ZW0pIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgdmFyIGlkID0gaXRlbS5pZCwKICAgICAgICAgIF9pdGVtJGdyb3VwSWQyID0gaXRlbS5ncm91cElkLAogICAgICAgICAgZ3JvdXBJZCA9IF9pdGVtJGdyb3VwSWQyID09PSB1bmRlZmluZWQgPyAtMSA6IF9pdGVtJGdyb3VwSWQyLAogICAgICAgICAgX2l0ZW0kdmFsdWUyID0gaXRlbS52YWx1ZSwKICAgICAgICAgIHZhbHVlID0gX2l0ZW0kdmFsdWUyID09PSB1bmRlZmluZWQgPyAnJyA6IF9pdGVtJHZhbHVlMiwKICAgICAgICAgIF9pdGVtJGxhYmVsMiA9IGl0ZW0ubGFiZWwsCiAgICAgICAgICBsYWJlbCA9IF9pdGVtJGxhYmVsMiA9PT0gdW5kZWZpbmVkID8gJycgOiBfaXRlbSRsYWJlbDI7CgogICAgICB2YXIgZ3JvdXAgPSBncm91cElkID49IDAgPyB0aGlzLl9zdG9yZS5nZXRHcm91cEJ5SWQoZ3JvdXBJZCkgOiBudWxsOwoKICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9pdGVtcy5oaWdobGlnaHRJdGVtKShpZCwgZmFsc2UpKTsKICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5oaWdobGlnaHRJdGVtLCB7CiAgICAgICAgaWQ6IGlkLAogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBsYWJlbDogbGFiZWwsCiAgICAgICAgZ3JvdXBWYWx1ZTogZ3JvdXAgJiYgZ3JvdXAudmFsdWUgPyBncm91cC52YWx1ZSA6IG51bGwKICAgICAgfSk7CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdoaWdobGlnaHRBbGwnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhpZ2hsaWdodEFsbCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHRoaXMuX3N0b3JlLml0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gX3RoaXMuaGlnaGxpZ2h0SXRlbShpdGVtKTsKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH0sIHsKICAgIGtleTogJ3VuaGlnaGxpZ2h0QWxsJywKICAgIHZhbHVlOiBmdW5jdGlvbiB1bmhpZ2hsaWdodEFsbCgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLl9zdG9yZS5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi51bmhpZ2hsaWdodEl0ZW0oaXRlbSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdyZW1vdmVBY3RpdmVJdGVtc0J5VmFsdWUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUFjdGl2ZUl0ZW1zQnlWYWx1ZSh2YWx1ZSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMuX3N0b3JlLmFjdGl2ZUl0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLnZhbHVlID09PSB2YWx1ZTsKICAgICAgfSkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBfdGhpczMuX3JlbW92ZUl0ZW0oaXRlbSk7CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfSwgewogICAga2V5OiAncmVtb3ZlQWN0aXZlSXRlbXMnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUFjdGl2ZUl0ZW1zKGV4Y2x1ZGVkSWQpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtcy5maWx0ZXIoZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICB2YXIgaWQgPSBfcmVmLmlkOwogICAgICAgIHJldHVybiBpZCAhPT0gZXhjbHVkZWRJZDsKICAgICAgfSkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBfdGhpczQuX3JlbW92ZUl0ZW0oaXRlbSk7CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfSwgewogICAga2V5OiAncmVtb3ZlSGlnaGxpZ2h0ZWRJdGVtcycsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlSGlnaGxpZ2h0ZWRJdGVtcygpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB2YXIgcnVuRXZlbnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IGZhbHNlOwoKICAgICAgdGhpcy5fc3RvcmUuaGlnaGxpZ2h0ZWRBY3RpdmVJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgX3RoaXM1Ll9yZW1vdmVJdGVtKGl0ZW0pOwogICAgICAgIC8vIElmIHRoaXMgYWN0aW9uIHdhcyBwZXJmb3JtZWQgYnkgdGhlIHVzZXIKICAgICAgICAvLyB0cmlnZ2VyIHRoZSBldmVudAogICAgICAgIGlmIChydW5FdmVudCkgewogICAgICAgICAgX3RoaXM1Ll90cmlnZ2VyQ2hhbmdlKGl0ZW0udmFsdWUpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdzaG93RHJvcGRvd24nLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNob3dEcm9wZG93bihwcmV2ZW50SW5wdXRGb2N1cykgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmRyb3Bkb3duLmlzQWN0aXZlKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM2LmRyb3Bkb3duLnNob3coKTsKICAgICAgICBfdGhpczYuY29udGFpbmVyT3V0ZXIub3BlbihfdGhpczYuZHJvcGRvd24uZGlzdGFuY2VGcm9tVG9wV2luZG93KCkpOwoKICAgICAgICBpZiAoIXByZXZlbnRJbnB1dEZvY3VzICYmIF90aGlzNi5fY2FuU2VhcmNoKSB7CiAgICAgICAgICBfdGhpczYuaW5wdXQuZm9jdXMoKTsKICAgICAgICB9CgogICAgICAgIF90aGlzNi5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5zaG93RHJvcGRvd24sIHt9KTsKICAgICAgfSk7CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdoaWRlRHJvcGRvd24nLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhpZGVEcm9wZG93bihwcmV2ZW50SW5wdXRCbHVyKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgaWYgKCF0aGlzLmRyb3Bkb3duLmlzQWN0aXZlKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM3LmRyb3Bkb3duLmhpZGUoKTsKICAgICAgICBfdGhpczcuY29udGFpbmVyT3V0ZXIuY2xvc2UoKTsKCiAgICAgICAgaWYgKCFwcmV2ZW50SW5wdXRCbHVyICYmIF90aGlzNy5fY2FuU2VhcmNoKSB7CiAgICAgICAgICBfdGhpczcuaW5wdXQucmVtb3ZlQWN0aXZlRGVzY2VuZGFudCgpOwogICAgICAgICAgX3RoaXM3LmlucHV0LmJsdXIoKTsKICAgICAgICB9CgogICAgICAgIF90aGlzNy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5oaWRlRHJvcGRvd24sIHt9KTsKICAgICAgfSk7CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICd0b2dnbGVEcm9wZG93bicsCiAgICB2YWx1ZTogZnVuY3Rpb24gdG9nZ2xlRHJvcGRvd24oKSB7CiAgICAgIHRoaXMuZHJvcGRvd24uaXNBY3RpdmUgPyB0aGlzLmhpZGVEcm9wZG93bigpIDogdGhpcy5zaG93RHJvcGRvd24oKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfSwgewogICAga2V5OiAnZ2V0VmFsdWUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKCkgewogICAgICB2YXIgdmFsdWVPbmx5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBmYWxzZTsKCiAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtcy5yZWR1Y2UoZnVuY3Rpb24gKHNlbGVjdGVkSXRlbXMsIGl0ZW0pIHsKICAgICAgICB2YXIgaXRlbVZhbHVlID0gdmFsdWVPbmx5ID8gaXRlbS52YWx1ZSA6IGl0ZW07CiAgICAgICAgc2VsZWN0ZWRJdGVtcy5wdXNoKGl0ZW1WYWx1ZSk7CiAgICAgICAgcmV0dXJuIHNlbGVjdGVkSXRlbXM7CiAgICAgIH0sIFtdKTsKCiAgICAgIHJldHVybiB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQgPyB2YWx1ZXNbMF0gOiB2YWx1ZXM7CiAgICB9CiAgfSwgewogICAga2V5OiAnc2V0VmFsdWUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFZhbHVlKGFyZ3MpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMuaW5pdGlhbGlzZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShhcmdzKSkuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICByZXR1cm4gX3RoaXM4Ll9zZXRDaG9pY2VPckl0ZW0odmFsdWUpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfSwgewogICAga2V5OiAnc2V0Q2hvaWNlQnlWYWx1ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q2hvaWNlQnlWYWx1ZSh2YWx1ZSkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5pbml0aWFsaXNlZCB8fCB0aGlzLl9pc1RleHRFbGVtZW50KSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIC8vIElmIG9ubHkgb25lIHZhbHVlIGhhcyBiZWVuIHBhc3NlZCwgY29udmVydCB0byBhcnJheQogICAgICB2YXIgY2hvaWNlVmFsdWUgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ0FycmF5JywgdmFsdWUpID8gdmFsdWUgOiBbdmFsdWVdOwoKICAgICAgLy8gTG9vcCB0aHJvdWdoIGVhY2ggdmFsdWUgYW5kCiAgICAgIGNob2ljZVZhbHVlLmZvckVhY2goZnVuY3Rpb24gKHZhbCkgewogICAgICAgIHJldHVybiBfdGhpczkuX2ZpbmRBbmRTZWxlY3RDaG9pY2VCeVZhbHVlKHZhbCk7CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfSwgewogICAga2V5OiAnc2V0Q2hvaWNlcycsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q2hvaWNlcygpIHsKICAgICAgdmFyIGNob2ljZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOwogICAgICB2YXIgdmFsdWUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICcnOwoKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgdmFyIGxhYmVsID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAnJzsKICAgICAgdmFyIHJlcGxhY2VDaG9pY2VzID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiBmYWxzZTsKCiAgICAgIGlmICghdGhpcy5faXNTZWxlY3RFbGVtZW50IHx8ICFjaG9pY2VzLmxlbmd0aCB8fCAhdmFsdWUpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgLy8gQ2xlYXIgY2hvaWNlcyBpZiBuZWVkZWQKICAgICAgaWYgKHJlcGxhY2VDaG9pY2VzKSB7CiAgICAgICAgdGhpcy5fY2xlYXJDaG9pY2VzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIucmVtb3ZlTG9hZGluZ1N0YXRlKCk7CiAgICAgIHZhciBhZGRHcm91cHNBbmRDaG9pY2VzID0gZnVuY3Rpb24gYWRkR3JvdXBzQW5kQ2hvaWNlcyhncm91cE9yQ2hvaWNlKSB7CiAgICAgICAgaWYgKGdyb3VwT3JDaG9pY2UuY2hvaWNlcykgewogICAgICAgICAgX3RoaXMxMC5fYWRkR3JvdXAoewogICAgICAgICAgICBncm91cDogZ3JvdXBPckNob2ljZSwKICAgICAgICAgICAgaWQ6IGdyb3VwT3JDaG9pY2UuaWQgfHwgbnVsbCwKICAgICAgICAgICAgdmFsdWVLZXk6IHZhbHVlLAogICAgICAgICAgICBsYWJlbEtleTogbGFiZWwKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpczEwLl9hZGRDaG9pY2UoewogICAgICAgICAgICB2YWx1ZTogZ3JvdXBPckNob2ljZVt2YWx1ZV0sCiAgICAgICAgICAgIGxhYmVsOiBncm91cE9yQ2hvaWNlW2xhYmVsXSwKICAgICAgICAgICAgaXNTZWxlY3RlZDogZ3JvdXBPckNob2ljZS5zZWxlY3RlZCwKICAgICAgICAgICAgaXNEaXNhYmxlZDogZ3JvdXBPckNob2ljZS5kaXNhYmxlZCwKICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllczogZ3JvdXBPckNob2ljZS5jdXN0b21Qcm9wZXJ0aWVzLAogICAgICAgICAgICBwbGFjZWhvbGRlcjogZ3JvdXBPckNob2ljZS5wbGFjZWhvbGRlcgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgY2hvaWNlcy5mb3JFYWNoKGFkZEdyb3Vwc0FuZENob2ljZXMpOwoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfSwgewogICAga2V5OiAnY2xlYXJTdG9yZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXJTdG9yZSgpIHsKICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9taXNjLmNsZWFyQWxsKSgpKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfSwgewogICAga2V5OiAnY2xlYXJJbnB1dCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXJJbnB1dCgpIHsKICAgICAgdmFyIHNob3VsZFNldElucHV0V2lkdGggPSAhdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50OwogICAgICB0aGlzLmlucHV0LmNsZWFyKHNob3VsZFNldElucHV0V2lkdGgpOwoKICAgICAgaWYgKCF0aGlzLl9pc1RleHRFbGVtZW50ICYmIHRoaXMuX2NhblNlYXJjaCkgewogICAgICAgIHRoaXMuX2lzU2VhcmNoaW5nID0gZmFsc2U7CiAgICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9jaG9pY2VzLmFjdGl2YXRlQ2hvaWNlcykodHJ1ZSkpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdhamF4JywKICAgIHZhbHVlOiBmdW5jdGlvbiBhamF4KGZuKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5pbml0aWFsaXNlZCB8fCAhdGhpcy5faXNTZWxlY3RFbGVtZW50IHx8ICFmbikgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczExLl9oYW5kbGVMb2FkaW5nU3RhdGUodHJ1ZSk7CiAgICAgIH0pOwogICAgICBmbih0aGlzLl9hamF4Q2FsbGJhY2soKSk7CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICAvKiA9PT09PSAgRW5kIG9mIFB1YmxpYyBmdW5jdGlvbnMgID09PT09PSAqLwoKICAgIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgPSAgICAgICAgICAgICAgICBQcml2YXRlIGZ1bmN0aW9ucyAgICAgICAgICAgID0KICAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKICB9LCB7CiAgICBrZXk6ICdfcmVuZGVyJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVuZGVyKCkgewogICAgICB0aGlzLl9jdXJyZW50U3RhdGUgPSB0aGlzLl9zdG9yZS5zdGF0ZTsKCiAgICAgIHZhciBzdGF0ZUNoYW5nZWQgPSB0aGlzLl9jdXJyZW50U3RhdGUuY2hvaWNlcyAhPT0gdGhpcy5fcHJldlN0YXRlLmNob2ljZXMgfHwgdGhpcy5fY3VycmVudFN0YXRlLmdyb3VwcyAhPT0gdGhpcy5fcHJldlN0YXRlLmdyb3VwcyB8fCB0aGlzLl9jdXJyZW50U3RhdGUuaXRlbXMgIT09IHRoaXMuX3ByZXZTdGF0ZS5pdGVtczsKICAgICAgdmFyIHNob3VsZFJlbmRlckNob2ljZXMgPSB0aGlzLl9pc1NlbGVjdEVsZW1lbnQ7CiAgICAgIHZhciBzaG91bGRSZW5kZXJJdGVtcyA9IHRoaXMuX2N1cnJlbnRTdGF0ZS5pdGVtcyAhPT0gdGhpcy5fcHJldlN0YXRlLml0ZW1zOwoKICAgICAgaWYgKCFzdGF0ZUNoYW5nZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChzaG91bGRSZW5kZXJDaG9pY2VzKSB7CiAgICAgICAgdGhpcy5fcmVuZGVyQ2hvaWNlcygpOwogICAgICB9CgogICAgICBpZiAoc2hvdWxkUmVuZGVySXRlbXMpIHsKICAgICAgICB0aGlzLl9yZW5kZXJJdGVtcygpOwogICAgICB9CgogICAgICB0aGlzLl9wcmV2U3RhdGUgPSB0aGlzLl9jdXJyZW50U3RhdGU7CiAgICB9CiAgfSwgewogICAga2V5OiAnX3JlbmRlckNob2ljZXMnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW5kZXJDaG9pY2VzKCkgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICB2YXIgX3N0b3JlID0gdGhpcy5fc3RvcmUsCiAgICAgICAgICBhY3RpdmVHcm91cHMgPSBfc3RvcmUuYWN0aXZlR3JvdXBzLAogICAgICAgICAgYWN0aXZlQ2hvaWNlcyA9IF9zdG9yZS5hY3RpdmVDaG9pY2VzOwoKICAgICAgdmFyIGNob2ljZUxpc3RGcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKCiAgICAgIHRoaXMuY2hvaWNlTGlzdC5jbGVhcigpOwoKICAgICAgaWYgKHRoaXMuY29uZmlnLnJlc2V0U2Nyb2xsUG9zaXRpb24pIHsKICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzMTIuY2hvaWNlTGlzdC5zY3JvbGxUb1RvcCgpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICAvLyBJZiB3ZSBoYXZlIGdyb3VwZWQgb3B0aW9ucwogICAgICBpZiAoYWN0aXZlR3JvdXBzLmxlbmd0aCA+PSAxICYmICF0aGlzLl9pc1NlYXJjaGluZykgewogICAgICAgIC8vIElmIHdlIGhhdmUgYSBwbGFjZWhvbGRlciBjaG9pY2UgYWxvbmcgd2l0aCBncm91cHMKICAgICAgICB2YXIgYWN0aXZlUGxhY2Vob2xkZXJzID0gYWN0aXZlQ2hvaWNlcy5maWx0ZXIoZnVuY3Rpb24gKGFjdGl2ZUNob2ljZSkgewogICAgICAgICAgcmV0dXJuIGFjdGl2ZUNob2ljZS5wbGFjZWhvbGRlciA9PT0gdHJ1ZSAmJiBhY3RpdmVDaG9pY2UuZ3JvdXBJZCA9PT0gLTE7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKGFjdGl2ZVBsYWNlaG9sZGVycy5sZW5ndGggPj0gMSkgewogICAgICAgICAgY2hvaWNlTGlzdEZyYWdtZW50ID0gdGhpcy5fY3JlYXRlQ2hvaWNlc0ZyYWdtZW50KGFjdGl2ZVBsYWNlaG9sZGVycywgY2hvaWNlTGlzdEZyYWdtZW50KTsKICAgICAgICB9CiAgICAgICAgY2hvaWNlTGlzdEZyYWdtZW50ID0gdGhpcy5fY3JlYXRlR3JvdXBzRnJhZ21lbnQoYWN0aXZlR3JvdXBzLCBhY3RpdmVDaG9pY2VzLCBjaG9pY2VMaXN0RnJhZ21lbnQpOwogICAgICB9IGVsc2UgaWYgKGFjdGl2ZUNob2ljZXMubGVuZ3RoID49IDEpIHsKICAgICAgICBjaG9pY2VMaXN0RnJhZ21lbnQgPSB0aGlzLl9jcmVhdGVDaG9pY2VzRnJhZ21lbnQoYWN0aXZlQ2hvaWNlcywgY2hvaWNlTGlzdEZyYWdtZW50KTsKICAgICAgfQoKICAgICAgLy8gSWYgd2UgaGF2ZSBjaG9pY2VzIHRvIHNob3cKICAgICAgaWYgKGNob2ljZUxpc3RGcmFnbWVudC5jaGlsZE5vZGVzICYmIGNob2ljZUxpc3RGcmFnbWVudC5jaGlsZE5vZGVzLmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgYWN0aXZlSXRlbXMgPSB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtczsKICAgICAgICB2YXIgY2FuQWRkSXRlbSA9IHRoaXMuX2NhbkFkZEl0ZW0oYWN0aXZlSXRlbXMsIHRoaXMuaW5wdXQudmFsdWUpOwoKICAgICAgICAvLyAuLi5hbmQgd2UgY2FuIHNlbGVjdCB0aGVtCiAgICAgICAgaWYgKGNhbkFkZEl0ZW0ucmVzcG9uc2UpIHsKICAgICAgICAgIC8vIC4uLmFwcGVuZCB0aGVtIGFuZCBoaWdobGlnaHQgdGhlIGZpcnN0IGNob2ljZQogICAgICAgICAgdGhpcy5jaG9pY2VMaXN0LmFwcGVuZChjaG9pY2VMaXN0RnJhZ21lbnQpOwogICAgICAgICAgdGhpcy5faGlnaGxpZ2h0Q2hvaWNlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIC4uLm90aGVyd2lzZSBzaG93IGEgbm90aWNlCiAgICAgICAgICB0aGlzLmNob2ljZUxpc3QuYXBwZW5kKHRoaXMuX2dldFRlbXBsYXRlKCdub3RpY2UnLCBjYW5BZGRJdGVtLm5vdGljZSkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBPdGhlcndpc2Ugc2hvdyBhIG5vdGljZQogICAgICAgIHZhciBkcm9wZG93bkl0ZW0gPSB2b2lkIDA7CiAgICAgICAgdmFyIG5vdGljZSA9IHZvaWQgMDsKCiAgICAgICAgaWYgKHRoaXMuX2lzU2VhcmNoaW5nKSB7CiAgICAgICAgICBub3RpY2UgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ0Z1bmN0aW9uJywgdGhpcy5jb25maWcubm9SZXN1bHRzVGV4dCkgPyB0aGlzLmNvbmZpZy5ub1Jlc3VsdHNUZXh0KCkgOiB0aGlzLmNvbmZpZy5ub1Jlc3VsdHNUZXh0OwoKICAgICAgICAgIGRyb3Bkb3duSXRlbSA9IHRoaXMuX2dldFRlbXBsYXRlKCdub3RpY2UnLCBub3RpY2UsICduby1yZXN1bHRzJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5vdGljZSA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnRnVuY3Rpb24nLCB0aGlzLmNvbmZpZy5ub0Nob2ljZXNUZXh0KSA/IHRoaXMuY29uZmlnLm5vQ2hvaWNlc1RleHQoKSA6IHRoaXMuY29uZmlnLm5vQ2hvaWNlc1RleHQ7CgogICAgICAgICAgZHJvcGRvd25JdGVtID0gdGhpcy5fZ2V0VGVtcGxhdGUoJ25vdGljZScsIG5vdGljZSwgJ25vLWNob2ljZXMnKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuY2hvaWNlTGlzdC5hcHBlbmQoZHJvcGRvd25JdGVtKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19yZW5kZXJJdGVtcycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlckl0ZW1zKCkgewogICAgICB2YXIgYWN0aXZlSXRlbXMgPSB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtcyB8fCBbXTsKICAgICAgdGhpcy5pdGVtTGlzdC5jbGVhcigpOwoKICAgICAgLy8gQ3JlYXRlIGEgZnJhZ21lbnQgdG8gc3RvcmUgb3VyIGxpc3QgaXRlbXMKICAgICAgLy8gKHNvIHdlIGRvbid0IGhhdmUgdG8gdXBkYXRlIHRoZSBET00gZm9yIGVhY2ggaXRlbSkKICAgICAgdmFyIGl0ZW1MaXN0RnJhZ21lbnQgPSB0aGlzLl9jcmVhdGVJdGVtc0ZyYWdtZW50KGFjdGl2ZUl0ZW1zKTsKCiAgICAgIC8vIElmIHdlIGhhdmUgaXRlbXMgdG8gYWRkLCBhcHBlbmQgdGhlbQogICAgICBpZiAoaXRlbUxpc3RGcmFnbWVudC5jaGlsZE5vZGVzKSB7CiAgICAgICAgdGhpcy5pdGVtTGlzdC5hcHBlbmQoaXRlbUxpc3RGcmFnbWVudCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfY3JlYXRlR3JvdXBzRnJhZ21lbnQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVHcm91cHNGcmFnbWVudChncm91cHMsIGNob2ljZXMsIGZyYWdtZW50KSB7CiAgICAgIHZhciBfdGhpczEzID0gdGhpczsKCiAgICAgIHZhciBncm91cEZyYWdtZW50ID0gZnJhZ21lbnQgfHwgZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgICB2YXIgZ2V0R3JvdXBDaG9pY2VzID0gZnVuY3Rpb24gZ2V0R3JvdXBDaG9pY2VzKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGNob2ljZXMuZmlsdGVyKGZ1bmN0aW9uIChjaG9pY2UpIHsKICAgICAgICAgIGlmIChfdGhpczEzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsKICAgICAgICAgICAgcmV0dXJuIGNob2ljZS5ncm91cElkID09PSBncm91cC5pZDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBjaG9pY2UuZ3JvdXBJZCA9PT0gZ3JvdXAuaWQgJiYgKF90aGlzMTMuY29uZmlnLnJlbmRlclNlbGVjdGVkQ2hvaWNlcyA9PT0gJ2Fsd2F5cycgfHwgIWNob2ljZS5zZWxlY3RlZCk7CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICAvLyBJZiBzb3J0aW5nIGlzIGVuYWJsZWQsIGZpbHRlciBncm91cHMKICAgICAgaWYgKHRoaXMuY29uZmlnLnNob3VsZFNvcnQpIHsKICAgICAgICBncm91cHMuc29ydCh0aGlzLmNvbmZpZy5zb3J0Rm4pOwogICAgICB9CgogICAgICBncm91cHMuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICB2YXIgZ3JvdXBDaG9pY2VzID0gZ2V0R3JvdXBDaG9pY2VzKGdyb3VwKTsKICAgICAgICBpZiAoZ3JvdXBDaG9pY2VzLmxlbmd0aCA+PSAxKSB7CiAgICAgICAgICB2YXIgZHJvcGRvd25Hcm91cCA9IF90aGlzMTMuX2dldFRlbXBsYXRlKCdjaG9pY2VHcm91cCcsIGdyb3VwKTsKICAgICAgICAgIGdyb3VwRnJhZ21lbnQuYXBwZW5kQ2hpbGQoZHJvcGRvd25Hcm91cCk7CiAgICAgICAgICBfdGhpczEzLl9jcmVhdGVDaG9pY2VzRnJhZ21lbnQoZ3JvdXBDaG9pY2VzLCBncm91cEZyYWdtZW50LCB0cnVlKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIGdyb3VwRnJhZ21lbnQ7CiAgICB9CiAgfSwgewogICAga2V5OiAnX2NyZWF0ZUNob2ljZXNGcmFnbWVudCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZUNob2ljZXNGcmFnbWVudChjaG9pY2VzLCBmcmFnbWVudCkgewogICAgICB2YXIgX3RoaXMxNCA9IHRoaXM7CgogICAgICB2YXIgd2l0aGluR3JvdXAgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOwoKICAgICAgLy8gQ3JlYXRlIGEgZnJhZ21lbnQgdG8gc3RvcmUgb3VyIGxpc3QgaXRlbXMgKHNvIHdlIGRvbid0IGhhdmUgdG8gdXBkYXRlIHRoZSBET00gZm9yIGVhY2ggaXRlbSkKICAgICAgdmFyIGNob2ljZXNGcmFnbWVudCA9IGZyYWdtZW50IHx8IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgICAgdmFyIF9jb25maWcgPSB0aGlzLmNvbmZpZywKICAgICAgICAgIHJlbmRlclNlbGVjdGVkQ2hvaWNlcyA9IF9jb25maWcucmVuZGVyU2VsZWN0ZWRDaG9pY2VzLAogICAgICAgICAgc2VhcmNoUmVzdWx0TGltaXQgPSBfY29uZmlnLnNlYXJjaFJlc3VsdExpbWl0LAogICAgICAgICAgcmVuZGVyQ2hvaWNlTGltaXQgPSBfY29uZmlnLnJlbmRlckNob2ljZUxpbWl0OwoKICAgICAgdmFyIGZpbHRlciA9IHRoaXMuX2lzU2VhcmNoaW5nID8gX3V0aWxzLnNvcnRCeVNjb3JlIDogdGhpcy5jb25maWcuc29ydEZuOwogICAgICB2YXIgYXBwZW5kQ2hvaWNlID0gZnVuY3Rpb24gYXBwZW5kQ2hvaWNlKGNob2ljZSkgewogICAgICAgIHZhciBzaG91bGRSZW5kZXIgPSByZW5kZXJTZWxlY3RlZENob2ljZXMgPT09ICdhdXRvJyA/IF90aGlzMTQuX2lzU2VsZWN0T25lRWxlbWVudCB8fCAhY2hvaWNlLnNlbGVjdGVkIDogdHJ1ZTsKICAgICAgICBpZiAoc2hvdWxkUmVuZGVyKSB7CiAgICAgICAgICB2YXIgZHJvcGRvd25JdGVtID0gX3RoaXMxNC5fZ2V0VGVtcGxhdGUoJ2Nob2ljZScsIGNob2ljZSwgX3RoaXMxNC5jb25maWcuaXRlbVNlbGVjdFRleHQpOwogICAgICAgICAgY2hvaWNlc0ZyYWdtZW50LmFwcGVuZENoaWxkKGRyb3Bkb3duSXRlbSk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgdmFyIHJlbmRlcmVyYWJsZUNob2ljZXMgPSBjaG9pY2VzOwoKICAgICAgaWYgKHJlbmRlclNlbGVjdGVkQ2hvaWNlcyA9PT0gJ2F1dG8nICYmICF0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsKICAgICAgICByZW5kZXJlcmFibGVDaG9pY2VzID0gY2hvaWNlcy5maWx0ZXIoZnVuY3Rpb24gKGNob2ljZSkgewogICAgICAgICAgcmV0dXJuICFjaG9pY2Uuc2VsZWN0ZWQ7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIC8vIFNwbGl0IGFycmF5IGludG8gcGxhY2Vob2xkZXJzIGFuZCAibm9ybWFsIiBjaG9pY2VzCgogICAgICB2YXIgX3JlbmRlcmVyYWJsZUNob2ljZXMkID0gcmVuZGVyZXJhYmxlQ2hvaWNlcy5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgY2hvaWNlKSB7CiAgICAgICAgaWYgKGNob2ljZS5wbGFjZWhvbGRlcikgewogICAgICAgICAgYWNjLnBsYWNlaG9sZGVyQ2hvaWNlcy5wdXNoKGNob2ljZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFjYy5ub3JtYWxDaG9pY2VzLnB1c2goY2hvaWNlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFjYzsKICAgICAgfSwgeyBwbGFjZWhvbGRlckNob2ljZXM6IFtdLCBub3JtYWxDaG9pY2VzOiBbXSB9KSwKICAgICAgICAgIHBsYWNlaG9sZGVyQ2hvaWNlcyA9IF9yZW5kZXJlcmFibGVDaG9pY2VzJC5wbGFjZWhvbGRlckNob2ljZXMsCiAgICAgICAgICBub3JtYWxDaG9pY2VzID0gX3JlbmRlcmVyYWJsZUNob2ljZXMkLm5vcm1hbENob2ljZXM7CgogICAgICAvLyBJZiBzb3J0aW5nIGlzIGVuYWJsZWQgb3IgdGhlIHVzZXIgaXMgc2VhcmNoaW5nLCBmaWx0ZXIgY2hvaWNlcwoKCiAgICAgIGlmICh0aGlzLmNvbmZpZy5zaG91bGRTb3J0IHx8IHRoaXMuX2lzU2VhcmNoaW5nKSB7CiAgICAgICAgbm9ybWFsQ2hvaWNlcy5zb3J0KGZpbHRlcik7CiAgICAgIH0KCiAgICAgIHZhciBjaG9pY2VMaW1pdCA9IHJlbmRlcmVyYWJsZUNob2ljZXMubGVuZ3RoOwoKICAgICAgLy8gUHJlcGVuZCBwbGFjZWhvbGVkZXIKICAgICAgdmFyIHNvcnRlZENob2ljZXMgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHBsYWNlaG9sZGVyQ2hvaWNlcyksIF90b0NvbnN1bWFibGVBcnJheShub3JtYWxDaG9pY2VzKSk7CgogICAgICBpZiAodGhpcy5faXNTZWFyY2hpbmcpIHsKICAgICAgICBjaG9pY2VMaW1pdCA9IHNlYXJjaFJlc3VsdExpbWl0OwogICAgICB9IGVsc2UgaWYgKHJlbmRlckNob2ljZUxpbWl0ID4gMCAmJiAhd2l0aGluR3JvdXApIHsKICAgICAgICBjaG9pY2VMaW1pdCA9IHJlbmRlckNob2ljZUxpbWl0OwogICAgICB9CgogICAgICAvLyBBZGQgZWFjaCBjaG9pY2UgdG8gZHJvcGRvd24gd2l0aGluIHJhbmdlCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hvaWNlTGltaXQ7IGkgKz0gMSkgewogICAgICAgIGlmIChzb3J0ZWRDaG9pY2VzW2ldKSB7CiAgICAgICAgICBhcHBlbmRDaG9pY2Uoc29ydGVkQ2hvaWNlc1tpXSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gY2hvaWNlc0ZyYWdtZW50OwogICAgfQogIH0sIHsKICAgIGtleTogJ19jcmVhdGVJdGVtc0ZyYWdtZW50JywKICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlSXRlbXNGcmFnbWVudChpdGVtcykgewogICAgICB2YXIgX3RoaXMxNSA9IHRoaXM7CgogICAgICB2YXIgZnJhZ21lbnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IG51bGw7CgogICAgICAvLyBDcmVhdGUgZnJhZ21lbnQgdG8gYWRkIGVsZW1lbnRzIHRvCiAgICAgIHZhciBfY29uZmlnMiA9IHRoaXMuY29uZmlnLAogICAgICAgICAgc2hvdWxkU29ydEl0ZW1zID0gX2NvbmZpZzIuc2hvdWxkU29ydEl0ZW1zLAogICAgICAgICAgc29ydEZuID0gX2NvbmZpZzIuc29ydEZuLAogICAgICAgICAgcmVtb3ZlSXRlbUJ1dHRvbiA9IF9jb25maWcyLnJlbW92ZUl0ZW1CdXR0b247CgogICAgICB2YXIgaXRlbUxpc3RGcmFnbWVudCA9IGZyYWdtZW50IHx8IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKCiAgICAgIC8vIElmIHNvcnRpbmcgaXMgZW5hYmxlZCwgZmlsdGVyIGl0ZW1zCiAgICAgIGlmIChzaG91bGRTb3J0SXRlbXMgJiYgIXRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgewogICAgICAgIGl0ZW1zLnNvcnQoc29ydEZuKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuX2lzVGV4dEVsZW1lbnQpIHsKICAgICAgICAvLyBVcGRhdGUgdGhlIHZhbHVlIG9mIHRoZSBoaWRkZW4gaW5wdXQKICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudmFsdWUgPSBpdGVtczsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBVcGRhdGUgdGhlIG9wdGlvbnMgb2YgdGhlIGhpZGRlbiBpbnB1dAogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC5vcHRpb25zID0gaXRlbXM7CiAgICAgIH0KCiAgICAgIHZhciBhZGRJdGVtVG9GcmFnbWVudCA9IGZ1bmN0aW9uIGFkZEl0ZW1Ub0ZyYWdtZW50KGl0ZW0pIHsKICAgICAgICAvLyBDcmVhdGUgbmV3IGxpc3QgZWxlbWVudAogICAgICAgIHZhciBsaXN0SXRlbSA9IF90aGlzMTUuX2dldFRlbXBsYXRlKCdpdGVtJywgaXRlbSwgcmVtb3ZlSXRlbUJ1dHRvbik7CiAgICAgICAgLy8gQXBwZW5kIGl0IHRvIGxpc3QKICAgICAgICBpdGVtTGlzdEZyYWdtZW50LmFwcGVuZENoaWxkKGxpc3RJdGVtKTsKICAgICAgfTsKCiAgICAgIC8vIEFkZCBlYWNoIGxpc3QgaXRlbSB0byBsaXN0CiAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gYWRkSXRlbVRvRnJhZ21lbnQoaXRlbSk7CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIGl0ZW1MaXN0RnJhZ21lbnQ7CiAgICB9CiAgfSwgewogICAga2V5OiAnX3RyaWdnZXJDaGFuZ2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF90cmlnZ2VyQ2hhbmdlKHZhbHVlKSB7CiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLmNoYW5nZSwgewogICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfc2VsZWN0UGxhY2Vob2xkZXJDaG9pY2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zZWxlY3RQbGFjZWhvbGRlckNob2ljZSgpIHsKICAgICAgdmFyIHBsYWNlaG9sZGVyQ2hvaWNlID0gdGhpcy5fc3RvcmUucGxhY2Vob2xkZXJDaG9pY2U7CgogICAgICBpZiAocGxhY2Vob2xkZXJDaG9pY2UpIHsKICAgICAgICB0aGlzLl9hZGRJdGVtKHsKICAgICAgICAgIHZhbHVlOiBwbGFjZWhvbGRlckNob2ljZS52YWx1ZSwKICAgICAgICAgIGxhYmVsOiBwbGFjZWhvbGRlckNob2ljZS5sYWJlbCwKICAgICAgICAgIGNob2ljZUlkOiBwbGFjZWhvbGRlckNob2ljZS5pZCwKICAgICAgICAgIGdyb3VwSWQ6IHBsYWNlaG9sZGVyQ2hvaWNlLmdyb3VwSWQsCiAgICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXJDaG9pY2UucGxhY2Vob2xkZXIKICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5fdHJpZ2dlckNoYW5nZShwbGFjZWhvbGRlckNob2ljZS52YWx1ZSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfaGFuZGxlQnV0dG9uQWN0aW9uJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlQnV0dG9uQWN0aW9uKGFjdGl2ZUl0ZW1zLCBlbGVtZW50KSB7CiAgICAgIGlmICghYWN0aXZlSXRlbXMgfHwgIWVsZW1lbnQgfHwgIXRoaXMuY29uZmlnLnJlbW92ZUl0ZW1zIHx8ICF0aGlzLmNvbmZpZy5yZW1vdmVJdGVtQnV0dG9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgaXRlbUlkID0gZWxlbWVudC5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpOwogICAgICB2YXIgaXRlbVRvUmVtb3ZlID0gYWN0aXZlSXRlbXMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLmlkID09PSBwYXJzZUludChpdGVtSWQsIDEwKTsKICAgICAgfSk7CgogICAgICAvLyBSZW1vdmUgaXRlbSBhc3NvY2lhdGVkIHdpdGggYnV0dG9uCiAgICAgIHRoaXMuX3JlbW92ZUl0ZW0oaXRlbVRvUmVtb3ZlKTsKICAgICAgdGhpcy5fdHJpZ2dlckNoYW5nZShpdGVtVG9SZW1vdmUudmFsdWUpOwoKICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgewogICAgICAgIHRoaXMuX3NlbGVjdFBsYWNlaG9sZGVyQ2hvaWNlKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfaGFuZGxlSXRlbUFjdGlvbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZUl0ZW1BY3Rpb24oYWN0aXZlSXRlbXMsIGVsZW1lbnQpIHsKICAgICAgdmFyIF90aGlzMTYgPSB0aGlzOwoKICAgICAgdmFyIGhhc1NoaWZ0S2V5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBmYWxzZTsKCiAgICAgIGlmICghYWN0aXZlSXRlbXMgfHwgIWVsZW1lbnQgfHwgIXRoaXMuY29uZmlnLnJlbW92ZUl0ZW1zIHx8IHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHBhc3NlZElkID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTsKCiAgICAgIC8vIFdlIG9ubHkgd2FudCB0byBzZWxlY3Qgb25lIGl0ZW0gd2l0aCBhIGNsaWNrCiAgICAgIC8vIHNvIHdlIGRlc2VsZWN0IGFueSBpdGVtcyB0aGF0IGFyZW4ndCB0aGUgdGFyZ2V0CiAgICAgIC8vIHVubGVzcyBzaGlmdCBpcyBiZWluZyBwcmVzc2VkCiAgICAgIGFjdGl2ZUl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBpZiAoaXRlbS5pZCA9PT0gcGFyc2VJbnQocGFzc2VkSWQsIDEwKSAmJiAhaXRlbS5oaWdobGlnaHRlZCkgewogICAgICAgICAgX3RoaXMxNi5oaWdobGlnaHRJdGVtKGl0ZW0pOwogICAgICAgIH0gZWxzZSBpZiAoIWhhc1NoaWZ0S2V5ICYmIGl0ZW0uaGlnaGxpZ2h0ZWQpIHsKICAgICAgICAgIF90aGlzMTYudW5oaWdobGlnaHRJdGVtKGl0ZW0pOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICAvLyBGb2N1cyBpbnB1dCBhcyB3aXRob3V0IGZvY3VzLCBhIHVzZXIgY2Fubm90IGRvIGFueXRoaW5nIHdpdGggYQogICAgICAvLyBoaWdobGlnaHRlZCBpdGVtCiAgICAgIHRoaXMuaW5wdXQuZm9jdXMoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfaGFuZGxlQ2hvaWNlQWN0aW9uJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlQ2hvaWNlQWN0aW9uKGFjdGl2ZUl0ZW1zLCBlbGVtZW50KSB7CiAgICAgIGlmICghYWN0aXZlSXRlbXMgfHwgIWVsZW1lbnQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIElmIHdlIGFyZSBjbGlja2luZyBvbiBhbiBvcHRpb24KICAgICAgdmFyIGlkID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTsKICAgICAgdmFyIGNob2ljZSA9IHRoaXMuX3N0b3JlLmdldENob2ljZUJ5SWQoaWQpOwogICAgICB2YXIgcGFzc2VkS2V5Q29kZSA9IGFjdGl2ZUl0ZW1zWzBdICYmIGFjdGl2ZUl0ZW1zWzBdLmtleUNvZGUgPyBhY3RpdmVJdGVtc1swXS5rZXlDb2RlIDogbnVsbDsKICAgICAgdmFyIGhhc0FjdGl2ZURyb3Bkb3duID0gdGhpcy5kcm9wZG93bi5pc0FjdGl2ZTsKCiAgICAgIC8vIFVwZGF0ZSBjaG9pY2Uga2V5Q29kZQogICAgICBjaG9pY2Uua2V5Q29kZSA9IHBhc3NlZEtleUNvZGU7CgogICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLmNob2ljZSwgewogICAgICAgIGNob2ljZTogY2hvaWNlCiAgICAgIH0pOwoKICAgICAgaWYgKGNob2ljZSAmJiAhY2hvaWNlLnNlbGVjdGVkICYmICFjaG9pY2UuZGlzYWJsZWQpIHsKICAgICAgICB2YXIgY2FuQWRkSXRlbSA9IHRoaXMuX2NhbkFkZEl0ZW0oYWN0aXZlSXRlbXMsIGNob2ljZS52YWx1ZSk7CgogICAgICAgIGlmIChjYW5BZGRJdGVtLnJlc3BvbnNlKSB7CiAgICAgICAgICB0aGlzLl9hZGRJdGVtKHsKICAgICAgICAgICAgdmFsdWU6IGNob2ljZS52YWx1ZSwKICAgICAgICAgICAgbGFiZWw6IGNob2ljZS5sYWJlbCwKICAgICAgICAgICAgY2hvaWNlSWQ6IGNob2ljZS5pZCwKICAgICAgICAgICAgZ3JvdXBJZDogY2hvaWNlLmdyb3VwSWQsCiAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGNob2ljZS5jdXN0b21Qcm9wZXJ0aWVzLAogICAgICAgICAgICBwbGFjZWhvbGRlcjogY2hvaWNlLnBsYWNlaG9sZGVyLAogICAgICAgICAgICBrZXlDb2RlOiBjaG9pY2Uua2V5Q29kZQogICAgICAgICAgfSk7CgogICAgICAgICAgdGhpcy5fdHJpZ2dlckNoYW5nZShjaG9pY2UudmFsdWUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5jbGVhcklucHV0KCk7CgogICAgICAvLyBXZSB3b250IHRvIGNsb3NlIHRoZSBkcm9wZG93biBpZiB3ZSBhcmUgZGVhbGluZyB3aXRoIGEgc2luZ2xlIHNlbGVjdCBib3gKICAgICAgaWYgKGhhc0FjdGl2ZURyb3Bkb3duICYmIHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgewogICAgICAgIHRoaXMuaGlkZURyb3Bkb3duKHRydWUpOwogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZm9jdXMoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19oYW5kbGVCYWNrc3BhY2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVCYWNrc3BhY2UoYWN0aXZlSXRlbXMpIHsKICAgICAgaWYgKCF0aGlzLmNvbmZpZy5yZW1vdmVJdGVtcyB8fCAhYWN0aXZlSXRlbXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBsYXN0SXRlbSA9IGFjdGl2ZUl0ZW1zW2FjdGl2ZUl0ZW1zLmxlbmd0aCAtIDFdOwogICAgICB2YXIgaGFzSGlnaGxpZ2h0ZWRJdGVtcyA9IGFjdGl2ZUl0ZW1zLnNvbWUoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5oaWdobGlnaHRlZDsKICAgICAgfSk7CgogICAgICAvLyBJZiBlZGl0aW5nIHRoZSBsYXN0IGl0ZW0gaXMgYWxsb3dlZCBhbmQgdGhlcmUgYXJlIG5vdCBvdGhlciBzZWxlY3RlZCBpdGVtcywKICAgICAgLy8gd2UgY2FuIGVkaXQgdGhlIGl0ZW0gdmFsdWUuIE90aGVyd2lzZSBpZiB3ZSBjYW4gcmVtb3ZlIGl0ZW1zLCByZW1vdmUgYWxsIHNlbGVjdGVkIGl0ZW1zCiAgICAgIGlmICh0aGlzLmNvbmZpZy5lZGl0SXRlbXMgJiYgIWhhc0hpZ2hsaWdodGVkSXRlbXMgJiYgbGFzdEl0ZW0pIHsKICAgICAgICB0aGlzLmlucHV0LnZhbHVlID0gbGFzdEl0ZW0udmFsdWU7CiAgICAgICAgdGhpcy5pbnB1dC5zZXRXaWR0aCgpOwogICAgICAgIHRoaXMuX3JlbW92ZUl0ZW0obGFzdEl0ZW0pOwogICAgICAgIHRoaXMuX3RyaWdnZXJDaGFuZ2UobGFzdEl0ZW0udmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICghaGFzSGlnaGxpZ2h0ZWRJdGVtcykgewogICAgICAgICAgLy8gSGlnaGxpZ2h0IGxhc3QgaXRlbSBpZiBub25lIGFscmVhZHkgaGlnaGxpZ2h0ZWQKICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0SXRlbShsYXN0SXRlbSwgZmFsc2UpOwogICAgICAgIH0KICAgICAgICB0aGlzLnJlbW92ZUhpZ2hsaWdodGVkSXRlbXModHJ1ZSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfaGFuZGxlTG9hZGluZ1N0YXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlTG9hZGluZ1N0YXRlKCkgewogICAgICB2YXIgaXNMb2FkaW5nID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB0cnVlOwoKICAgICAgdmFyIHBsYWNlaG9sZGVySXRlbSA9IHRoaXMuaXRlbUxpc3QuZ2V0Q2hpbGQoJy4nICsgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5wbGFjZWhvbGRlcik7CgogICAgICBpZiAoaXNMb2FkaW5nKSB7CiAgICAgICAgdGhpcy5kaXNhYmxlKCk7CiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5hZGRMb2FkaW5nU3RhdGUoKTsKCiAgICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgewogICAgICAgICAgaWYgKCFwbGFjZWhvbGRlckl0ZW0pIHsKICAgICAgICAgICAgcGxhY2Vob2xkZXJJdGVtID0gdGhpcy5fZ2V0VGVtcGxhdGUoJ3BsYWNlaG9sZGVyJywgdGhpcy5jb25maWcubG9hZGluZ1RleHQpOwogICAgICAgICAgICB0aGlzLml0ZW1MaXN0LmFwcGVuZChwbGFjZWhvbGRlckl0ZW0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcGxhY2Vob2xkZXJJdGVtLmlubmVySFRNTCA9IHRoaXMuY29uZmlnLmxvYWRpbmdUZXh0OwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmlucHV0LnBsYWNlaG9sZGVyID0gdGhpcy5jb25maWcubG9hZGluZ1RleHQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZW5hYmxlKCk7CiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5yZW1vdmVMb2FkaW5nU3RhdGUoKTsKCiAgICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgewogICAgICAgICAgcGxhY2Vob2xkZXJJdGVtLmlubmVySFRNTCA9IHRoaXMuX3BsYWNlaG9sZGVyVmFsdWUgfHwgJyc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuaW5wdXQucGxhY2Vob2xkZXIgPSB0aGlzLl9wbGFjZWhvbGRlclZhbHVlIHx8ICcnOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19oYW5kbGVTZWFyY2gnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVTZWFyY2godmFsdWUpIHsKICAgICAgaWYgKCF2YWx1ZSB8fCAhdGhpcy5pbnB1dC5pc0ZvY3Vzc2VkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgY2hvaWNlcyA9IHRoaXMuX3N0b3JlLmNob2ljZXM7CiAgICAgIHZhciBfY29uZmlnMyA9IHRoaXMuY29uZmlnLAogICAgICAgICAgc2VhcmNoRmxvb3IgPSBfY29uZmlnMy5zZWFyY2hGbG9vciwKICAgICAgICAgIHNlYXJjaENob2ljZXMgPSBfY29uZmlnMy5zZWFyY2hDaG9pY2VzOwoKICAgICAgdmFyIGhhc1VuYWN0aXZlQ2hvaWNlcyA9IGNob2ljZXMuc29tZShmdW5jdGlvbiAob3B0aW9uKSB7CiAgICAgICAgcmV0dXJuICFvcHRpb24uYWN0aXZlOwogICAgICB9KTsKCiAgICAgIC8vIENoZWNrIHRoYXQgd2UgaGF2ZSBhIHZhbHVlIHRvIHNlYXJjaCBhbmQgdGhlIGlucHV0IHdhcyBhbiBhbHBoYW51bWVyaWMgY2hhcmFjdGVyCiAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5sZW5ndGggPj0gc2VhcmNoRmxvb3IpIHsKICAgICAgICB2YXIgcmVzdWx0Q291bnQgPSBzZWFyY2hDaG9pY2VzID8gdGhpcy5fc2VhcmNoQ2hvaWNlcyh2YWx1ZSkgOiAwOwogICAgICAgIC8vIFRyaWdnZXIgc2VhcmNoIGV2ZW50CiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5zZWFyY2gsIHsKICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgIHJlc3VsdENvdW50OiByZXN1bHRDb3VudAogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKGhhc1VuYWN0aXZlQ2hvaWNlcykgewogICAgICAgIC8vIE90aGVyd2lzZSByZXNldCBjaG9pY2VzIHRvIGFjdGl2ZQogICAgICAgIHRoaXMuX2lzU2VhcmNoaW5nID0gZmFsc2U7CiAgICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9jaG9pY2VzLmFjdGl2YXRlQ2hvaWNlcykodHJ1ZSkpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX2NhbkFkZEl0ZW0nLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jYW5BZGRJdGVtKGFjdGl2ZUl0ZW1zLCB2YWx1ZSkgewogICAgICB2YXIgY2FuQWRkSXRlbSA9IHRydWU7CiAgICAgIHZhciBub3RpY2UgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ0Z1bmN0aW9uJywgdGhpcy5jb25maWcuYWRkSXRlbVRleHQpID8gdGhpcy5jb25maWcuYWRkSXRlbVRleHQodmFsdWUpIDogdGhpcy5jb25maWcuYWRkSXRlbVRleHQ7CgogICAgICBpZiAoIXRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgewogICAgICAgIHZhciBpc0R1cGxpY2F0ZVZhbHVlID0gKDAsIF91dGlscy5leGlzdHNJbkFycmF5KShhY3RpdmVJdGVtcywgdmFsdWUpOwoKICAgICAgICBpZiAodGhpcy5jb25maWcubWF4SXRlbUNvdW50ID4gMCAmJiB0aGlzLmNvbmZpZy5tYXhJdGVtQ291bnQgPD0gYWN0aXZlSXRlbXMubGVuZ3RoKSB7CiAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhIG1heCBlbnRyeSBsaW1pdCBhbmQgd2UgaGF2ZSByZWFjaGVkIHRoYXQgbGltaXQKICAgICAgICAgIC8vIGRvbid0IHVwZGF0ZQogICAgICAgICAgY2FuQWRkSXRlbSA9IGZhbHNlOwogICAgICAgICAgbm90aWNlID0gKDAsIF91dGlscy5pc1R5cGUpKCdGdW5jdGlvbicsIHRoaXMuY29uZmlnLm1heEl0ZW1UZXh0KSA/IHRoaXMuY29uZmlnLm1heEl0ZW1UZXh0KHRoaXMuY29uZmlnLm1heEl0ZW1Db3VudCkgOiB0aGlzLmNvbmZpZy5tYXhJdGVtVGV4dDsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmNvbmZpZy5yZWdleEZpbHRlciAmJiB0aGlzLl9pc1RleHRFbGVtZW50ICYmIHRoaXMuY29uZmlnLmFkZEl0ZW1zICYmIGNhbkFkZEl0ZW0pIHsKICAgICAgICAgIC8vIElmIGEgdXNlciBoYXMgc3VwcGxpZWQgYSByZWd1bGFyIGV4cHJlc3Npb24gZmlsdGVyCiAgICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB3ZSBjYW4gdXBkYXRlIGJhc2VkIG9uIHdoZXRoZXIKICAgICAgICAgIC8vIG91ciByZWd1bGFyIGV4cHJlc3Npb24gcGFzc2VzCiAgICAgICAgICBjYW5BZGRJdGVtID0gKDAsIF91dGlscy5yZWdleEZpbHRlcikodmFsdWUsIHRoaXMuY29uZmlnLnJlZ2V4RmlsdGVyKTsKICAgICAgICB9CgogICAgICAgIGlmICghdGhpcy5jb25maWcuZHVwbGljYXRlSXRlbXNBbGxvd2VkICYmIGlzRHVwbGljYXRlVmFsdWUgJiYgY2FuQWRkSXRlbSkgewogICAgICAgICAgY2FuQWRkSXRlbSA9IGZhbHNlOwogICAgICAgICAgbm90aWNlID0gKDAsIF91dGlscy5pc1R5cGUpKCdGdW5jdGlvbicsIHRoaXMuY29uZmlnLnVuaXF1ZUl0ZW1UZXh0KSA/IHRoaXMuY29uZmlnLnVuaXF1ZUl0ZW1UZXh0KHZhbHVlKSA6IHRoaXMuY29uZmlnLnVuaXF1ZUl0ZW1UZXh0OwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICByZXNwb25zZTogY2FuQWRkSXRlbSwKICAgICAgICBub3RpY2U6IG5vdGljZQogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogJ19hamF4Q2FsbGJhY2snLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hamF4Q2FsbGJhY2soKSB7CiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKCiAgICAgIHJldHVybiBmdW5jdGlvbiAocmVzdWx0cywgdmFsdWUsIGxhYmVsKSB7CiAgICAgICAgaWYgKCFyZXN1bHRzIHx8ICF2YWx1ZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIHBhcnNlZFJlc3VsdHMgPSAoMCwgX3V0aWxzLmlzVHlwZSkoJ09iamVjdCcsIHJlc3VsdHMpID8gW3Jlc3VsdHNdIDogcmVzdWx0czsKCiAgICAgICAgaWYgKHBhcnNlZFJlc3VsdHMgJiYgKDAsIF91dGlscy5pc1R5cGUpKCdBcnJheScsIHBhcnNlZFJlc3VsdHMpICYmIHBhcnNlZFJlc3VsdHMubGVuZ3RoKSB7CiAgICAgICAgICAvLyBSZW1vdmUgbG9hZGluZyBzdGF0ZXMvdGV4dAogICAgICAgICAgX3RoaXMxNy5faGFuZGxlTG9hZGluZ1N0YXRlKGZhbHNlKTsKICAgICAgICAgIC8vIEFkZCBlYWNoIHJlc3VsdCBhcyBhIGNob2ljZQogICAgICAgICAgcGFyc2VkUmVzdWx0cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgaWYgKHJlc3VsdC5jaG9pY2VzKSB7CiAgICAgICAgICAgICAgX3RoaXMxNy5fYWRkR3JvdXAoewogICAgICAgICAgICAgICAgZ3JvdXA6IHJlc3VsdCwKICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaWQgfHwgbnVsbCwKICAgICAgICAgICAgICAgIHZhbHVlS2V5OiB2YWx1ZSwKICAgICAgICAgICAgICAgIGxhYmVsS2V5OiBsYWJlbAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIF90aGlzMTcuX2FkZENob2ljZSh7CiAgICAgICAgICAgICAgICB2YWx1ZTogKDAsIF91dGlscy5mZXRjaEZyb21PYmplY3QpKHJlc3VsdCwgdmFsdWUpLAogICAgICAgICAgICAgICAgbGFiZWw6ICgwLCBfdXRpbHMuZmV0Y2hGcm9tT2JqZWN0KShyZXN1bHQsIGxhYmVsKSwKICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IHJlc3VsdC5zZWxlY3RlZCwKICAgICAgICAgICAgICAgIGlzRGlzYWJsZWQ6IHJlc3VsdC5kaXNhYmxlZCwKICAgICAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IHJlc3VsdC5jdXN0b21Qcm9wZXJ0aWVzLAogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IHJlc3VsdC5wbGFjZWhvbGRlcgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoX3RoaXMxNy5faXNTZWxlY3RPbmVFbGVtZW50KSB7CiAgICAgICAgICAgIF90aGlzMTcuX3NlbGVjdFBsYWNlaG9sZGVyQ2hvaWNlKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIE5vIHJlc3VsdHMsIHJlbW92ZSBsb2FkaW5nIHN0YXRlCiAgICAgICAgICBfdGhpczE3Ll9oYW5kbGVMb2FkaW5nU3RhdGUoZmFsc2UpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfc2VhcmNoQ2hvaWNlcycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NlYXJjaENob2ljZXModmFsdWUpIHsKICAgICAgdmFyIG5ld1ZhbHVlID0gKDAsIF91dGlscy5pc1R5cGUpKCdTdHJpbmcnLCB2YWx1ZSkgPyB2YWx1ZS50cmltKCkgOiB2YWx1ZTsKICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnU3RyaW5nJywgdGhpcy5fY3VycmVudFZhbHVlKSA/IHRoaXMuX2N1cnJlbnRWYWx1ZS50cmltKCkgOiB0aGlzLl9jdXJyZW50VmFsdWU7CgogICAgICBpZiAobmV3VmFsdWUubGVuZ3RoIDwgMSAmJiBuZXdWYWx1ZSA9PT0gY3VycmVudFZhbHVlICsgJyAnKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KCiAgICAgIC8vIElmIG5ldyB2YWx1ZSBtYXRjaGVzIHRoZSBkZXNpcmVkIGxlbmd0aCBhbmQgaXMgbm90IHRoZSBzYW1lIGFzIHRoZSBjdXJyZW50IHZhbHVlIHdpdGggYSBzcGFjZQogICAgICB2YXIgaGF5c3RhY2sgPSB0aGlzLl9zdG9yZS5zZWFyY2hhYmxlQ2hvaWNlczsKICAgICAgdmFyIG5lZWRsZSA9IG5ld1ZhbHVlOwogICAgICB2YXIga2V5cyA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5jb25maWcuc2VhcmNoRmllbGRzKSk7CiAgICAgIHZhciBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih0aGlzLmNvbmZpZy5mdXNlT3B0aW9ucywgeyBrZXlzOiBrZXlzIH0pOwogICAgICB2YXIgZnVzZSA9IG5ldyBfZnVzZTIuZGVmYXVsdChoYXlzdGFjaywgb3B0aW9ucyk7CiAgICAgIHZhciByZXN1bHRzID0gZnVzZS5zZWFyY2gobmVlZGxlKTsKCiAgICAgIHRoaXMuX2N1cnJlbnRWYWx1ZSA9IG5ld1ZhbHVlOwogICAgICB0aGlzLl9oaWdobGlnaHRQb3NpdGlvbiA9IDA7CiAgICAgIHRoaXMuX2lzU2VhcmNoaW5nID0gdHJ1ZTsKICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9jaG9pY2VzLmZpbHRlckNob2ljZXMpKHJlc3VsdHMpKTsKCiAgICAgIHJldHVybiByZXN1bHRzLmxlbmd0aDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfYWRkRXZlbnRMaXN0ZW5lcnMnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hZGRFdmVudExpc3RlbmVycygpIHsKICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLl9vbktleVVwKTsKICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX29uS2V5RG93bik7CiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fb25DbGljayk7CiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMuX29uVG91Y2hNb3ZlKTsKICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLl9vblRvdWNoRW5kKTsKICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5fb25Nb3VzZURvd24pOwogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCB0aGlzLl9vbk1vdXNlT3Zlcik7CgogICAgICBpZiAodGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7CiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fb25Gb2N1cyk7CiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOwogICAgICB9CgogICAgICB0aGlzLmlucHV0LmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9vbkZvY3VzKTsKICAgICAgdGhpcy5pbnB1dC5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOwoKICAgICAgaWYgKHRoaXMuaW5wdXQuZWxlbWVudC5mb3JtKSB7CiAgICAgICAgdGhpcy5pbnB1dC5lbGVtZW50LmZvcm0uYWRkRXZlbnRMaXN0ZW5lcigncmVzZXQnLCB0aGlzLl9vbkZvcm1SZXNldCk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcnMoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfcmVtb3ZlRXZlbnRMaXN0ZW5lcnMnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW1vdmVFdmVudExpc3RlbmVycygpIHsKICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB0aGlzLl9vbktleVVwKTsKICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX29uS2V5RG93bik7CiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fb25DbGljayk7CiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMuX29uVG91Y2hNb3ZlKTsKICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLl9vblRvdWNoRW5kKTsKICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5fb25Nb3VzZURvd24pOwogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCB0aGlzLl9vbk1vdXNlT3Zlcik7CgogICAgICBpZiAodGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7CiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fb25Gb2N1cyk7CiAgICAgICAgdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOwogICAgICB9CgogICAgICB0aGlzLmlucHV0LmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9vbkZvY3VzKTsKICAgICAgdGhpcy5pbnB1dC5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOwoKICAgICAgaWYgKHRoaXMuaW5wdXQuZWxlbWVudC5mb3JtKSB7CiAgICAgICAgdGhpcy5pbnB1dC5lbGVtZW50LmZvcm0ucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzZXQnLCB0aGlzLl9vbkZvcm1SZXNldCk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25LZXlEb3duJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25LZXlEb3duKGV2ZW50KSB7CiAgICAgIHZhciBfa2V5RG93bkFjdGlvbnM7CgogICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0LAogICAgICAgICAga2V5Q29kZSA9IGV2ZW50LmtleUNvZGUsCiAgICAgICAgICBjdHJsS2V5ID0gZXZlbnQuY3RybEtleSwKICAgICAgICAgIG1ldGFLZXkgPSBldmVudC5tZXRhS2V5OwoKCiAgICAgIGlmICh0YXJnZXQgIT09IHRoaXMuaW5wdXQuZWxlbWVudCAmJiAhdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmNvbnRhaW5zKHRhcmdldCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBhY3RpdmVJdGVtcyA9IHRoaXMuX3N0b3JlLmFjdGl2ZUl0ZW1zOwogICAgICB2YXIgaGFzRm9jdXNlZElucHV0ID0gdGhpcy5pbnB1dC5pc0ZvY3Vzc2VkOwogICAgICB2YXIgaGFzQWN0aXZlRHJvcGRvd24gPSB0aGlzLmRyb3Bkb3duLmlzQWN0aXZlOwogICAgICB2YXIgaGFzSXRlbXMgPSB0aGlzLml0ZW1MaXN0Lmhhc0NoaWxkcmVuOwogICAgICB2YXIga2V5U3RyaW5nID0gU3RyaW5nLmZyb21DaGFyQ29kZShrZXlDb2RlKTsKCiAgICAgIHZhciBCQUNLX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkJBQ0tfS0VZLAogICAgICAgICAgREVMRVRFX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkRFTEVURV9LRVksCiAgICAgICAgICBFTlRFUl9LRVkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5FTlRFUl9LRVksCiAgICAgICAgICBBX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkFfS0VZLAogICAgICAgICAgRVNDX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkVTQ19LRVksCiAgICAgICAgICBVUF9LRVkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5VUF9LRVksCiAgICAgICAgICBET1dOX0tFWSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkRPV05fS0VZLAogICAgICAgICAgUEFHRV9VUF9LRVkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5QQUdFX1VQX0tFWSwKICAgICAgICAgIFBBR0VfRE9XTl9LRVkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5QQUdFX0RPV05fS0VZOwoKICAgICAgdmFyIGhhc0N0cmxEb3duS2V5UHJlc3NlZCA9IGN0cmxLZXkgfHwgbWV0YUtleTsKCiAgICAgIC8vIElmIGEgdXNlciBpcyB0eXBpbmcgYW5kIHRoZSBkcm9wZG93biBpcyBub3QgYWN0aXZlCiAgICAgIGlmICghdGhpcy5faXNUZXh0RWxlbWVudCAmJiAvW2EtekEtWjAtOS1fIF0vLnRlc3Qoa2V5U3RyaW5nKSkgewogICAgICAgIHRoaXMuc2hvd0Ryb3Bkb3duKCk7CiAgICAgIH0KCiAgICAgIC8vIE1hcCBrZXlzIHRvIGtleSBhY3Rpb25zCiAgICAgIHZhciBrZXlEb3duQWN0aW9ucyA9IChfa2V5RG93bkFjdGlvbnMgPSB7fSwgX2RlZmluZVByb3BlcnR5KF9rZXlEb3duQWN0aW9ucywgQV9LRVksIHRoaXMuX29uQUtleSksIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIEVOVEVSX0tFWSwgdGhpcy5fb25FbnRlcktleSksIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIEVTQ19LRVksIHRoaXMuX29uRXNjYXBlS2V5KSwgX2RlZmluZVByb3BlcnR5KF9rZXlEb3duQWN0aW9ucywgVVBfS0VZLCB0aGlzLl9vbkRpcmVjdGlvbktleSksIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIFBBR0VfVVBfS0VZLCB0aGlzLl9vbkRpcmVjdGlvbktleSksIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIERPV05fS0VZLCB0aGlzLl9vbkRpcmVjdGlvbktleSksIF9kZWZpbmVQcm9wZXJ0eShfa2V5RG93bkFjdGlvbnMsIFBBR0VfRE9XTl9LRVksIHRoaXMuX29uRGlyZWN0aW9uS2V5KSwgX2RlZmluZVByb3BlcnR5KF9rZXlEb3duQWN0aW9ucywgREVMRVRFX0tFWSwgdGhpcy5fb25EZWxldGVLZXkpLCBfZGVmaW5lUHJvcGVydHkoX2tleURvd25BY3Rpb25zLCBCQUNLX0tFWSwgdGhpcy5fb25EZWxldGVLZXkpLCBfa2V5RG93bkFjdGlvbnMpOwoKICAgICAgLy8gSWYga2V5Y29kZSBoYXMgYSBmdW5jdGlvbiwgcnVuIGl0CiAgICAgIGlmIChrZXlEb3duQWN0aW9uc1trZXlDb2RlXSkgewogICAgICAgIGtleURvd25BY3Rpb25zW2tleUNvZGVdKHsKICAgICAgICAgIGV2ZW50OiBldmVudCwKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LAogICAgICAgICAga2V5Q29kZToga2V5Q29kZSwKICAgICAgICAgIG1ldGFLZXk6IG1ldGFLZXksCiAgICAgICAgICBhY3RpdmVJdGVtczogYWN0aXZlSXRlbXMsCiAgICAgICAgICBoYXNGb2N1c2VkSW5wdXQ6IGhhc0ZvY3VzZWRJbnB1dCwKICAgICAgICAgIGhhc0FjdGl2ZURyb3Bkb3duOiBoYXNBY3RpdmVEcm9wZG93biwKICAgICAgICAgIGhhc0l0ZW1zOiBoYXNJdGVtcywKICAgICAgICAgIGhhc0N0cmxEb3duS2V5UHJlc3NlZDogaGFzQ3RybERvd25LZXlQcmVzc2VkCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25LZXlVcCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uS2V5VXAoX3JlZjIpIHsKICAgICAgdmFyIHRhcmdldCA9IF9yZWYyLnRhcmdldCwKICAgICAgICAgIGtleUNvZGUgPSBfcmVmMi5rZXlDb2RlOwoKICAgICAgaWYgKHRhcmdldCAhPT0gdGhpcy5pbnB1dC5lbGVtZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdmFsdWUgPSB0aGlzLmlucHV0LnZhbHVlOwogICAgICB2YXIgYWN0aXZlSXRlbXMgPSB0aGlzLl9zdG9yZS5hY3RpdmVJdGVtczsKICAgICAgdmFyIGNhbkFkZEl0ZW0gPSB0aGlzLl9jYW5BZGRJdGVtKGFjdGl2ZUl0ZW1zLCB2YWx1ZSk7CgogICAgICAvLyBXZSBhcmUgdHlwaW5nIGludG8gYSB0ZXh0IGlucHV0IGFuZCBoYXZlIGEgdmFsdWUsIHdlIHdhbnQgdG8gc2hvdyBhIGRyb3Bkb3duCiAgICAgIC8vIG5vdGljZS4gT3RoZXJ3aXNlIGhpZGUgdGhlIGRyb3Bkb3duCiAgICAgIGlmICh0aGlzLl9pc1RleHRFbGVtZW50KSB7CiAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICBpZiAoY2FuQWRkSXRlbS5ub3RpY2UpIHsKICAgICAgICAgICAgdmFyIGRyb3Bkb3duSXRlbSA9IHRoaXMuX2dldFRlbXBsYXRlKCdub3RpY2UnLCBjYW5BZGRJdGVtLm5vdGljZSk7CiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uZWxlbWVudC5pbm5lckhUTUwgPSBkcm9wZG93bkl0ZW0ub3V0ZXJIVE1MOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChjYW5BZGRJdGVtLnJlc3BvbnNlID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRoaXMuc2hvd0Ryb3Bkb3duKHRydWUpOwogICAgICAgICAgfSBlbHNlIGlmICghY2FuQWRkSXRlbS5ub3RpY2UpIHsKICAgICAgICAgICAgdGhpcy5oaWRlRHJvcGRvd24odHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuaGlkZURyb3Bkb3duKHRydWUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgYmFja0tleSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkJBQ0tfS0VZOwogICAgICAgIHZhciBkZWxldGVLZXkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5ERUxFVEVfS0VZOwoKICAgICAgICAvLyBJZiB1c2VyIGhhcyByZW1vdmVkIHZhbHVlLi4uCiAgICAgICAgaWYgKChrZXlDb2RlID09PSBiYWNrS2V5IHx8IGtleUNvZGUgPT09IGRlbGV0ZUtleSkgJiYgIXRhcmdldC52YWx1ZSkgewogICAgICAgICAgaWYgKCF0aGlzLl9pc1RleHRFbGVtZW50ICYmIHRoaXMuX2lzU2VhcmNoaW5nKSB7CiAgICAgICAgICAgIHRoaXMuX2lzU2VhcmNoaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfY2hvaWNlcy5hY3RpdmF0ZUNob2ljZXMpKHRydWUpKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NhblNlYXJjaCAmJiBjYW5BZGRJdGVtLnJlc3BvbnNlKSB7CiAgICAgICAgICB0aGlzLl9oYW5kbGVTZWFyY2godGhpcy5pbnB1dC52YWx1ZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLl9jYW5TZWFyY2ggPSB0aGlzLmNvbmZpZy5zZWFyY2hFbmFibGVkOwogICAgfQogIH0sIHsKICAgIGtleTogJ19vbkFLZXknLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkFLZXkoX3JlZjMpIHsKICAgICAgdmFyIGhhc0l0ZW1zID0gX3JlZjMuaGFzSXRlbXMsCiAgICAgICAgICBoYXNDdHJsRG93bktleVByZXNzZWQgPSBfcmVmMy5oYXNDdHJsRG93bktleVByZXNzZWQ7CgogICAgICAvLyBJZiBDVFJMICsgQSBvciBDTUQgKyBBIGhhdmUgYmVlbiBwcmVzc2VkIGFuZCB0aGVyZSBhcmUgaXRlbXMgdG8gc2VsZWN0CiAgICAgIGlmIChoYXNDdHJsRG93bktleVByZXNzZWQgJiYgaGFzSXRlbXMpIHsKICAgICAgICB0aGlzLl9jYW5TZWFyY2ggPSBmYWxzZTsKICAgICAgICBpZiAodGhpcy5jb25maWcucmVtb3ZlSXRlbXMgJiYgIXRoaXMuaW5wdXQudmFsdWUgJiYgdGhpcy5pbnB1dC5lbGVtZW50ID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7CiAgICAgICAgICAvLyBIaWdobGlnaHQgaXRlbXMKICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0QWxsKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uRW50ZXJLZXknLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkVudGVyS2V5KF9yZWY0KSB7CiAgICAgIHZhciBldmVudCA9IF9yZWY0LmV2ZW50LAogICAgICAgICAgdGFyZ2V0ID0gX3JlZjQudGFyZ2V0LAogICAgICAgICAgYWN0aXZlSXRlbXMgPSBfcmVmNC5hY3RpdmVJdGVtcywKICAgICAgICAgIGhhc0FjdGl2ZURyb3Bkb3duID0gX3JlZjQuaGFzQWN0aXZlRHJvcGRvd247CiAgICAgIHZhciBlbnRlcktleSA9IF9jb25zdGFudHMuS0VZX0NPREVTLkVOVEVSX0tFWTsKICAgICAgLy8gSWYgZW50ZXIga2V5IGlzIHByZXNzZWQgYW5kIHRoZSBpbnB1dCBoYXMgYSB2YWx1ZQoKICAgICAgaWYgKHRoaXMuX2lzVGV4dEVsZW1lbnQgJiYgdGFyZ2V0LnZhbHVlKSB7CiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5pbnB1dC52YWx1ZTsKICAgICAgICB2YXIgY2FuQWRkSXRlbSA9IHRoaXMuX2NhbkFkZEl0ZW0oYWN0aXZlSXRlbXMsIHZhbHVlKTsKCiAgICAgICAgLy8gQWxsIGlzIGdvb2QsIGFkZAogICAgICAgIGlmIChjYW5BZGRJdGVtLnJlc3BvbnNlKSB7CiAgICAgICAgICB0aGlzLmhpZGVEcm9wZG93bih0cnVlKTsKICAgICAgICAgIHRoaXMuX2FkZEl0ZW0oeyB2YWx1ZTogdmFsdWUgfSk7CiAgICAgICAgICB0aGlzLl90cmlnZ2VyQ2hhbmdlKHZhbHVlKTsKICAgICAgICAgIHRoaXMuY2xlYXJJbnB1dCgpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRhcmdldC5oYXNBdHRyaWJ1dGUoJ2RhdGEtYnV0dG9uJykpIHsKICAgICAgICB0aGlzLl9oYW5kbGVCdXR0b25BY3Rpb24oYWN0aXZlSXRlbXMsIHRhcmdldCk7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgfQoKICAgICAgaWYgKGhhc0FjdGl2ZURyb3Bkb3duKSB7CiAgICAgICAgdmFyIGhpZ2hsaWdodGVkID0gdGhpcy5kcm9wZG93bi5nZXRDaGlsZCgnLicgKyB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLmhpZ2hsaWdodGVkU3RhdGUpOwoKICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgaGlnaGxpZ2h0ZWQgY2hvaWNlCiAgICAgICAgaWYgKGhpZ2hsaWdodGVkKSB7CiAgICAgICAgICAvLyBhZGQgZW50ZXIga2V5Q29kZSB2YWx1ZQogICAgICAgICAgaWYgKGFjdGl2ZUl0ZW1zWzBdKSB7CiAgICAgICAgICAgIGFjdGl2ZUl0ZW1zWzBdLmtleUNvZGUgPSBlbnRlcktleTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1wYXJhbS1yZWFzc2lnbgogICAgICAgICAgfQogICAgICAgICAgdGhpcy5faGFuZGxlQ2hvaWNlQWN0aW9uKGFjdGl2ZUl0ZW1zLCBoaWdobGlnaHRlZCk7CiAgICAgICAgfQoKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgewogICAgICAgIC8vIE9wZW4gc2luZ2xlIHNlbGVjdCBkcm9wZG93biBpZiBpdCdzIG5vdCBhY3RpdmUKICAgICAgICB0aGlzLnNob3dEcm9wZG93bigpOwogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25Fc2NhcGVLZXknLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkVzY2FwZUtleShfcmVmNSkgewogICAgICB2YXIgaGFzQWN0aXZlRHJvcGRvd24gPSBfcmVmNS5oYXNBY3RpdmVEcm9wZG93bjsKCiAgICAgIGlmIChoYXNBY3RpdmVEcm9wZG93bikgewogICAgICAgIHRoaXMuaGlkZURyb3Bkb3duKHRydWUpOwogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZm9jdXMoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19vbkRpcmVjdGlvbktleScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRGlyZWN0aW9uS2V5KF9yZWY2KSB7CiAgICAgIHZhciBldmVudCA9IF9yZWY2LmV2ZW50LAogICAgICAgICAgaGFzQWN0aXZlRHJvcGRvd24gPSBfcmVmNi5oYXNBY3RpdmVEcm9wZG93biwKICAgICAgICAgIGtleUNvZGUgPSBfcmVmNi5rZXlDb2RlLAogICAgICAgICAgbWV0YUtleSA9IF9yZWY2Lm1ldGFLZXk7CiAgICAgIHZhciBkb3duS2V5ID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuRE9XTl9LRVksCiAgICAgICAgICBwYWdlVXBLZXkgPSBfY29uc3RhbnRzLktFWV9DT0RFUy5QQUdFX1VQX0tFWSwKICAgICAgICAgIHBhZ2VEb3duS2V5ID0gX2NvbnN0YW50cy5LRVlfQ09ERVMuUEFHRV9ET1dOX0tFWTsKCiAgICAgIC8vIElmIHVwIG9yIGRvd24ga2V5IGlzIHByZXNzZWQsIHRyYXZlcnNlIHRocm91Z2ggb3B0aW9ucwoKICAgICAgaWYgKGhhc0FjdGl2ZURyb3Bkb3duIHx8IHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgewogICAgICAgIHRoaXMuc2hvd0Ryb3Bkb3duKCk7CiAgICAgICAgdGhpcy5fY2FuU2VhcmNoID0gZmFsc2U7CgogICAgICAgIHZhciBkaXJlY3Rpb25JbnQgPSBrZXlDb2RlID09PSBkb3duS2V5IHx8IGtleUNvZGUgPT09IHBhZ2VEb3duS2V5ID8gMSA6IC0xOwogICAgICAgIHZhciBza2lwS2V5ID0gbWV0YUtleSB8fCBrZXlDb2RlID09PSBwYWdlRG93bktleSB8fCBrZXlDb2RlID09PSBwYWdlVXBLZXk7CiAgICAgICAgdmFyIHNlbGVjdGFibGVDaG9pY2VJZGVudGlmaWVyID0gJ1tkYXRhLWNob2ljZS1zZWxlY3RhYmxlXSc7CgogICAgICAgIHZhciBuZXh0RWwgPSB2b2lkIDA7CiAgICAgICAgaWYgKHNraXBLZXkpIHsKICAgICAgICAgIGlmIChkaXJlY3Rpb25JbnQgPiAwKSB7CiAgICAgICAgICAgIG5leHRFbCA9IEFycmF5LmZyb20odGhpcy5kcm9wZG93bi5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0YWJsZUNob2ljZUlkZW50aWZpZXIpKS5wb3AoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5leHRFbCA9IHRoaXMuZHJvcGRvd24uZWxlbWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdGFibGVDaG9pY2VJZGVudGlmaWVyKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGN1cnJlbnRFbCA9IHRoaXMuZHJvcGRvd24uZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuJyArIHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuaGlnaGxpZ2h0ZWRTdGF0ZSk7CiAgICAgICAgICBpZiAoY3VycmVudEVsKSB7CiAgICAgICAgICAgIG5leHRFbCA9ICgwLCBfdXRpbHMuZ2V0QWRqYWNlbnRFbCkoY3VycmVudEVsLCBzZWxlY3RhYmxlQ2hvaWNlSWRlbnRpZmllciwgZGlyZWN0aW9uSW50KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5leHRFbCA9IHRoaXMuZHJvcGRvd24uZWxlbWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdGFibGVDaG9pY2VJZGVudGlmaWVyKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChuZXh0RWwpIHsKICAgICAgICAgIC8vIFdlIHByZXZlbnQgZGVmYXVsdCB0byBzdG9wIHRoZSBjdXJzb3IgbW92aW5nCiAgICAgICAgICAvLyB3aGVuIHByZXNzaW5nIHRoZSBhcnJvdwogICAgICAgICAgaWYgKCEoMCwgX3V0aWxzLmlzU2Nyb2xsZWRJbnRvVmlldykobmV4dEVsLCB0aGlzLmNob2ljZUxpc3QuZWxlbWVudCwgZGlyZWN0aW9uSW50KSkgewogICAgICAgICAgICB0aGlzLmNob2ljZUxpc3Quc2Nyb2xsVG9DaG9pY2UobmV4dEVsLCBkaXJlY3Rpb25JbnQpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5faGlnaGxpZ2h0Q2hvaWNlKG5leHRFbCk7CiAgICAgICAgfQoKICAgICAgICAvLyBQcmV2ZW50IGRlZmF1bHQgdG8gbWFpbnRhaW4gY3Vyc29yIHBvc2l0aW9uIHdoaWxzdAogICAgICAgIC8vIHRyYXZlcnNpbmcgZHJvcGRvd24gb3B0aW9ucwogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25EZWxldGVLZXknLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkRlbGV0ZUtleShfcmVmNykgewogICAgICB2YXIgZXZlbnQgPSBfcmVmNy5ldmVudCwKICAgICAgICAgIHRhcmdldCA9IF9yZWY3LnRhcmdldCwKICAgICAgICAgIGhhc0ZvY3VzZWRJbnB1dCA9IF9yZWY3Lmhhc0ZvY3VzZWRJbnB1dCwKICAgICAgICAgIGFjdGl2ZUl0ZW1zID0gX3JlZjcuYWN0aXZlSXRlbXM7CgogICAgICAvLyBJZiBiYWNrc3BhY2Ugb3IgZGVsZXRlIGtleSBpcyBwcmVzc2VkIGFuZCB0aGUgaW5wdXQgaGFzIG5vIHZhbHVlCiAgICAgIGlmIChoYXNGb2N1c2VkSW5wdXQgJiYgIXRhcmdldC52YWx1ZSAmJiAhdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7CiAgICAgICAgdGhpcy5faGFuZGxlQmFja3NwYWNlKGFjdGl2ZUl0ZW1zKTsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uVG91Y2hNb3ZlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Ub3VjaE1vdmUoKSB7CiAgICAgIGlmICh0aGlzLl93YXNUYXAgPT09IHRydWUpIHsKICAgICAgICB0aGlzLl93YXNUYXAgPSBmYWxzZTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19vblRvdWNoRW5kJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Ub3VjaEVuZChldmVudCkgewogICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IHx8IGV2ZW50LnRvdWNoZXNbMF0udGFyZ2V0OwoKICAgICAgLy8gSWYgYSB1c2VyIHRhcHBlZCB3aXRoaW4gb3VyIGNvbnRhaW5lci4uLgogICAgICBpZiAodGhpcy5fd2FzVGFwID09PSB0cnVlICYmIHRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5jb250YWlucyh0YXJnZXQpKSB7CiAgICAgICAgLy8gLi4uYW5kIHdlIGFyZW4ndCBkZWFsaW5nIHdpdGggYSBzaW5nbGUgc2VsZWN0IGJveCwgc2hvdyBkcm9wZG93bi9mb2N1cyBpbnB1dAoKICAgICAgICB2YXIgY29udGFpbmVyV2FzVGFyZ2V0ID0gdGFyZ2V0ID09PSB0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQgfHwgdGFyZ2V0ID09PSB0aGlzLmNvbnRhaW5lcklubmVyLmVsZW1lbnQ7CgogICAgICAgIGlmIChjb250YWluZXJXYXNUYXJnZXQgJiYgIXRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgewogICAgICAgICAgaWYgKHRoaXMuX2lzVGV4dEVsZW1lbnQpIHsKICAgICAgICAgICAgLy8gSWYgdGV4dCBlbGVtZW50LCB3ZSBvbmx5IHdhbnQgdG8gZm9jdXMgdGhlIGlucHV0CiAgICAgICAgICAgIHRoaXMuaW5wdXQuZm9jdXMoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIElmIGEgc2VsZWN0IGJveCwgd2Ugd2FudCB0byBzaG93IHRoZSBkcm9wZG93bgogICAgICAgICAgICB0aGlzLnNob3dEcm9wZG93bigpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBQcmV2ZW50cyBmb2N1cyBldmVudCBmaXJpbmcKICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgfQoKICAgICAgdGhpcy5fd2FzVGFwID0gdHJ1ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25Nb3VzZURvd24nLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbk1vdXNlRG93bihldmVudCkgewogICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0LAogICAgICAgICAgc2hpZnRLZXkgPSBldmVudC5zaGlmdEtleTsKICAgICAgLy8gSWYgd2UgaGF2ZSBvdXIgbW91c2UgZG93biBvbiB0aGUgc2Nyb2xsYmFyIGFuZCBhcmUgb24gSUUxMS4uLgoKICAgICAgaWYgKHRhcmdldCA9PT0gdGhpcy5jaG9pY2VMaXN0ICYmICgwLCBfdXRpbHMuaXNJRTExKSgpKSB7CiAgICAgICAgdGhpcy5faXNTY3JvbGxpbmdPbkllID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKCF0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQuY29udGFpbnModGFyZ2V0KSB8fCB0YXJnZXQgPT09IHRoaXMuaW5wdXQuZWxlbWVudCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGFjdGl2ZUl0ZW1zID0gdGhpcy5fc3RvcmUuYWN0aXZlSXRlbXM7CiAgICAgIHZhciBoYXNTaGlmdEtleSA9IHNoaWZ0S2V5OwoKICAgICAgdmFyIGJ1dHRvblRhcmdldCA9ICgwLCBfdXRpbHMuZmluZEFuY2VzdG9yQnlBdHRyTmFtZSkodGFyZ2V0LCAnZGF0YS1idXR0b24nKTsKICAgICAgdmFyIGl0ZW1UYXJnZXQgPSAoMCwgX3V0aWxzLmZpbmRBbmNlc3RvckJ5QXR0ck5hbWUpKHRhcmdldCwgJ2RhdGEtaXRlbScpOwogICAgICB2YXIgY2hvaWNlVGFyZ2V0ID0gKDAsIF91dGlscy5maW5kQW5jZXN0b3JCeUF0dHJOYW1lKSh0YXJnZXQsICdkYXRhLWNob2ljZScpOwoKICAgICAgaWYgKGJ1dHRvblRhcmdldCkgewogICAgICAgIHRoaXMuX2hhbmRsZUJ1dHRvbkFjdGlvbihhY3RpdmVJdGVtcywgYnV0dG9uVGFyZ2V0KTsKICAgICAgfSBlbHNlIGlmIChpdGVtVGFyZ2V0KSB7CiAgICAgICAgdGhpcy5faGFuZGxlSXRlbUFjdGlvbihhY3RpdmVJdGVtcywgaXRlbVRhcmdldCwgaGFzU2hpZnRLZXkpOwogICAgICB9IGVsc2UgaWYgKGNob2ljZVRhcmdldCkgewogICAgICAgIHRoaXMuX2hhbmRsZUNob2ljZUFjdGlvbihhY3RpdmVJdGVtcywgY2hvaWNlVGFyZ2V0KTsKICAgICAgfQoKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25Nb3VzZU92ZXInLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbk1vdXNlT3ZlcihfcmVmOCkgewogICAgICB2YXIgdGFyZ2V0ID0gX3JlZjgudGFyZ2V0OwoKICAgICAgdmFyIHRhcmdldFdpdGhpbkRyb3Bkb3duID0gdGFyZ2V0ID09PSB0aGlzLmRyb3Bkb3duIHx8IHRoaXMuZHJvcGRvd24uZWxlbWVudC5jb250YWlucyh0YXJnZXQpOwogICAgICB2YXIgc2hvdWxkSGlnaGxpZ2h0Q2hvaWNlID0gdGFyZ2V0V2l0aGluRHJvcGRvd24gJiYgdGFyZ2V0Lmhhc0F0dHJpYnV0ZSgnZGF0YS1jaG9pY2UnKTsKCiAgICAgIGlmIChzaG91bGRIaWdobGlnaHRDaG9pY2UpIHsKICAgICAgICB0aGlzLl9oaWdobGlnaHRDaG9pY2UodGFyZ2V0KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19vbkNsaWNrJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25DbGljayhfcmVmOSkgewogICAgICB2YXIgdGFyZ2V0ID0gX3JlZjkudGFyZ2V0OwoKICAgICAgaWYgKHRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5jb250YWlucyh0YXJnZXQpKSB7CiAgICAgICAgaWYgKCF0aGlzLmRyb3Bkb3duLmlzQWN0aXZlICYmICF0aGlzLmNvbnRhaW5lck91dGVyLmlzRGlzYWJsZWQpIHsKICAgICAgICAgIGlmICh0aGlzLl9pc1RleHRFbGVtZW50KSB7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ICE9PSB0aGlzLmlucHV0LmVsZW1lbnQpIHsKICAgICAgICAgICAgICB0aGlzLmlucHV0LmZvY3VzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc2hvd0Ryb3Bkb3duKCk7CiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZm9jdXMoKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCAmJiB0YXJnZXQgIT09IHRoaXMuaW5wdXQuZWxlbWVudCAmJiAhdGhpcy5kcm9wZG93bi5lbGVtZW50LmNvbnRhaW5zKHRhcmdldCkpIHsKICAgICAgICAgIHRoaXMuaGlkZURyb3Bkb3duKCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHZhciBoYXNIaWdobGlnaHRlZEl0ZW1zID0gdGhpcy5fc3RvcmUuaGlnaGxpZ2h0ZWRBY3RpdmVJdGVtczsKCiAgICAgICAgaWYgKGhhc0hpZ2hsaWdodGVkSXRlbXMpIHsKICAgICAgICAgIHRoaXMudW5oaWdobGlnaHRBbGwoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIucmVtb3ZlRm9jdXNTdGF0ZSgpOwogICAgICAgIHRoaXMuaGlkZURyb3Bkb3duKHRydWUpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uRm9jdXMnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkZvY3VzKF9yZWYxMCkgewogICAgICB2YXIgX3RoaXMxOCA9IHRoaXM7CgogICAgICB2YXIgdGFyZ2V0ID0gX3JlZjEwLnRhcmdldDsKCiAgICAgIGlmICghdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmNvbnRhaW5zKHRhcmdldCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBmb2N1c0FjdGlvbnMgPSB7CiAgICAgICAgdGV4dDogZnVuY3Rpb24gdGV4dCgpIHsKICAgICAgICAgIGlmICh0YXJnZXQgPT09IF90aGlzMTguaW5wdXQuZWxlbWVudCkgewogICAgICAgICAgICBfdGhpczE4LmNvbnRhaW5lck91dGVyLmFkZEZvY3VzU3RhdGUoKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgICdzZWxlY3Qtb25lJzogZnVuY3Rpb24gc2VsZWN0T25lKCkgewogICAgICAgICAgX3RoaXMxOC5jb250YWluZXJPdXRlci5hZGRGb2N1c1N0YXRlKCk7CiAgICAgICAgICBpZiAodGFyZ2V0ID09PSBfdGhpczE4LmlucHV0LmVsZW1lbnQpIHsKICAgICAgICAgICAgX3RoaXMxOC5zaG93RHJvcGRvd24odHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAnc2VsZWN0LW11bHRpcGxlJzogZnVuY3Rpb24gc2VsZWN0TXVsdGlwbGUoKSB7CiAgICAgICAgICBpZiAodGFyZ2V0ID09PSBfdGhpczE4LmlucHV0LmVsZW1lbnQpIHsKICAgICAgICAgICAgX3RoaXMxOC5zaG93RHJvcGRvd24odHJ1ZSk7CiAgICAgICAgICAgIC8vIElmIGVsZW1lbnQgaXMgYSBzZWxlY3QgYm94LCB0aGUgZm9jdXNlZCBlbGVtZW50IGlzIHRoZSBjb250YWluZXIgYW5kIHRoZSBkcm9wZG93bgogICAgICAgICAgICAvLyBpc24ndCBhbHJlYWR5IG9wZW4sIGZvY3VzIGFuZCBzaG93IGRyb3Bkb3duCiAgICAgICAgICAgIF90aGlzMTguY29udGFpbmVyT3V0ZXIuYWRkRm9jdXNTdGF0ZSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGZvY3VzQWN0aW9uc1t0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC50eXBlXSgpOwogICAgfQogIH0sIHsKICAgIGtleTogJ19vbkJsdXInLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkJsdXIoX3JlZjExKSB7CiAgICAgIHZhciBfdGhpczE5ID0gdGhpczsKCiAgICAgIHZhciB0YXJnZXQgPSBfcmVmMTEudGFyZ2V0OwoKICAgICAgLy8gSWYgdGFyZ2V0IGlzIHNvbWV0aGluZyB0aGF0IGNvbmNlcm5zIHVzCiAgICAgIGlmICh0aGlzLmNvbnRhaW5lck91dGVyLmVsZW1lbnQuY29udGFpbnModGFyZ2V0KSAmJiAhdGhpcy5faXNTY3JvbGxpbmdPbkllKSB7CiAgICAgICAgdmFyIGFjdGl2ZUl0ZW1zID0gdGhpcy5fc3RvcmUuYWN0aXZlSXRlbXM7CiAgICAgICAgdmFyIGhhc0hpZ2hsaWdodGVkSXRlbXMgPSBhY3RpdmVJdGVtcy5zb21lKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5oaWdobGlnaHRlZDsKICAgICAgICB9KTsKICAgICAgICB2YXIgYmx1ckFjdGlvbnMgPSB7CiAgICAgICAgICB0ZXh0OiBmdW5jdGlvbiB0ZXh0KCkgewogICAgICAgICAgICBpZiAodGFyZ2V0ID09PSBfdGhpczE5LmlucHV0LmVsZW1lbnQpIHsKICAgICAgICAgICAgICBfdGhpczE5LmNvbnRhaW5lck91dGVyLnJlbW92ZUZvY3VzU3RhdGUoKTsKICAgICAgICAgICAgICBpZiAoaGFzSGlnaGxpZ2h0ZWRJdGVtcykgewogICAgICAgICAgICAgICAgX3RoaXMxOS51bmhpZ2hsaWdodEFsbCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBfdGhpczE5LmhpZGVEcm9wZG93bih0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICdzZWxlY3Qtb25lJzogZnVuY3Rpb24gc2VsZWN0T25lKCkgewogICAgICAgICAgICBfdGhpczE5LmNvbnRhaW5lck91dGVyLnJlbW92ZUZvY3VzU3RhdGUoKTsKICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gX3RoaXMxOS5pbnB1dC5lbGVtZW50IHx8IHRhcmdldCA9PT0gX3RoaXMxOS5jb250YWluZXJPdXRlci5lbGVtZW50ICYmICFfdGhpczE5Ll9jYW5TZWFyY2gpIHsKICAgICAgICAgICAgICBfdGhpczE5LmhpZGVEcm9wZG93bih0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICdzZWxlY3QtbXVsdGlwbGUnOiBmdW5jdGlvbiBzZWxlY3RNdWx0aXBsZSgpIHsKICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gX3RoaXMxOS5pbnB1dC5lbGVtZW50KSB7CiAgICAgICAgICAgICAgX3RoaXMxOS5jb250YWluZXJPdXRlci5yZW1vdmVGb2N1c1N0YXRlKCk7CiAgICAgICAgICAgICAgX3RoaXMxOS5oaWRlRHJvcGRvd24odHJ1ZSk7CiAgICAgICAgICAgICAgaWYgKGhhc0hpZ2hsaWdodGVkSXRlbXMpIHsKICAgICAgICAgICAgICAgIF90aGlzMTkudW5oaWdobGlnaHRBbGwoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBibHVyQWN0aW9uc1t0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC50eXBlXSgpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIE9uIElFMTEsIGNsaWNraW5nIHRoZSBzY29sbGJhciBibHVycyBvdXIgaW5wdXQgYW5kIHRodXMKICAgICAgICAvLyBjbG9zZXMgdGhlIGRyb3Bkb3duLiBUbyBzdG9wIHRoaXMsIHdlIHJlZm9jdXMgb3VyIGlucHV0CiAgICAgICAgLy8gaWYgd2Uga25vdyB3ZSBhcmUgb24gSUUgKmFuZCogYXJlIHNjcm9sbGluZy4KICAgICAgICB0aGlzLl9pc1Njcm9sbGluZ09uSWUgPSBmYWxzZTsKICAgICAgICB0aGlzLmlucHV0LmVsZW1lbnQuZm9jdXMoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19vbkZvcm1SZXNldCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRm9ybVJlc2V0KCkgewogICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX21pc2MucmVzZXRUbykodGhpcy5faW5pdGlhbFN0YXRlKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX2hpZ2hsaWdodENob2ljZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hpZ2hsaWdodENob2ljZSgpIHsKICAgICAgdmFyIF90aGlzMjAgPSB0aGlzOwoKICAgICAgdmFyIGVsID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBudWxsOwoKICAgICAgdmFyIGNob2ljZXMgPSBBcnJheS5mcm9tKHRoaXMuZHJvcGRvd24uZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1jaG9pY2Utc2VsZWN0YWJsZV0nKSk7CgogICAgICBpZiAoIWNob2ljZXMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcGFzc2VkRWwgPSBlbDsKICAgICAgdmFyIGhpZ2hsaWdodGVkQ2hvaWNlcyA9IEFycmF5LmZyb20odGhpcy5kcm9wZG93bi5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgdGhpcy5jb25maWcuY2xhc3NOYW1lcy5oaWdobGlnaHRlZFN0YXRlKSk7CgogICAgICAvLyBSZW1vdmUgYW55IGhpZ2hsaWdodGVkIGNob2ljZXMKICAgICAgaGlnaGxpZ2h0ZWRDaG9pY2VzLmZvckVhY2goZnVuY3Rpb24gKGNob2ljZSkgewogICAgICAgIGNob2ljZS5jbGFzc0xpc3QucmVtb3ZlKF90aGlzMjAuY29uZmlnLmNsYXNzTmFtZXMuaGlnaGxpZ2h0ZWRTdGF0ZSk7CiAgICAgICAgY2hvaWNlLnNldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcsICdmYWxzZScpOwogICAgICB9KTsKCiAgICAgIGlmIChwYXNzZWRFbCkgewogICAgICAgIHRoaXMuX2hpZ2hsaWdodFBvc2l0aW9uID0gY2hvaWNlcy5pbmRleE9mKHBhc3NlZEVsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBIaWdobGlnaHQgY2hvaWNlIGJhc2VkIG9uIGxhc3Qga25vd24gaGlnaGxpZ2h0IGxvY2F0aW9uCiAgICAgICAgaWYgKGNob2ljZXMubGVuZ3RoID4gdGhpcy5faGlnaGxpZ2h0UG9zaXRpb24pIHsKICAgICAgICAgIC8vIElmIHdlIGhhdmUgYW4gb3B0aW9uIHRvIGhpZ2hsaWdodAogICAgICAgICAgcGFzc2VkRWwgPSBjaG9pY2VzW3RoaXMuX2hpZ2hsaWdodFBvc2l0aW9uXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gT3RoZXJ3aXNlIGhpZ2hsaWdodCB0aGUgb3B0aW9uIGJlZm9yZQogICAgICAgICAgcGFzc2VkRWwgPSBjaG9pY2VzW2Nob2ljZXMubGVuZ3RoIC0gMV07CiAgICAgICAgfQoKICAgICAgICBpZiAoIXBhc3NlZEVsKSB7CiAgICAgICAgICBwYXNzZWRFbCA9IGNob2ljZXNbMF07CiAgICAgICAgfQogICAgICB9CgogICAgICBwYXNzZWRFbC5jbGFzc0xpc3QuYWRkKHRoaXMuY29uZmlnLmNsYXNzTmFtZXMuaGlnaGxpZ2h0ZWRTdGF0ZSk7CiAgICAgIHBhc3NlZEVsLnNldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcsICd0cnVlJyk7CiAgICAgIHRoaXMucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMuaGlnaGxpZ2h0Q2hvaWNlLCB7IGVsOiBwYXNzZWRFbCB9KTsKCiAgICAgIGlmICh0aGlzLmRyb3Bkb3duLmlzQWN0aXZlKSB7CiAgICAgICAgLy8gSUUxMSBpZ25vcmVzIGFyaWEtbGFiZWwgYW5kIGJsb2NrcyB2aXJ0dWFsIGtleWJvYXJkCiAgICAgICAgLy8gaWYgYXJpYS1hY3RpdmVkZXNjZW5kYW50IGlzIHNldCB3aXRob3V0IGEgZHJvcGRvd24KICAgICAgICB0aGlzLmlucHV0LnNldEFjdGl2ZURlc2NlbmRhbnQocGFzc2VkRWwuaWQpOwogICAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuc2V0QWN0aXZlRGVzY2VuZGFudChwYXNzZWRFbC5pZCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfYWRkSXRlbScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZEl0ZW0oX3JlZjEyKSB7CiAgICAgIHZhciB2YWx1ZSA9IF9yZWYxMi52YWx1ZSwKICAgICAgICAgIF9yZWYxMiRsYWJlbCA9IF9yZWYxMi5sYWJlbCwKICAgICAgICAgIGxhYmVsID0gX3JlZjEyJGxhYmVsID09PSB1bmRlZmluZWQgPyBudWxsIDogX3JlZjEyJGxhYmVsLAogICAgICAgICAgX3JlZjEyJGNob2ljZUlkID0gX3JlZjEyLmNob2ljZUlkLAogICAgICAgICAgY2hvaWNlSWQgPSBfcmVmMTIkY2hvaWNlSWQgPT09IHVuZGVmaW5lZCA/IC0xIDogX3JlZjEyJGNob2ljZUlkLAogICAgICAgICAgX3JlZjEyJGdyb3VwSWQgPSBfcmVmMTIuZ3JvdXBJZCwKICAgICAgICAgIGdyb3VwSWQgPSBfcmVmMTIkZ3JvdXBJZCA9PT0gdW5kZWZpbmVkID8gLTEgOiBfcmVmMTIkZ3JvdXBJZCwKICAgICAgICAgIF9yZWYxMiRjdXN0b21Qcm9wZXJ0aSA9IF9yZWYxMi5jdXN0b21Qcm9wZXJ0aWVzLAogICAgICAgICAgY3VzdG9tUHJvcGVydGllcyA9IF9yZWYxMiRjdXN0b21Qcm9wZXJ0aSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IF9yZWYxMiRjdXN0b21Qcm9wZXJ0aSwKICAgICAgICAgIF9yZWYxMiRwbGFjZWhvbGRlciA9IF9yZWYxMi5wbGFjZWhvbGRlciwKICAgICAgICAgIHBsYWNlaG9sZGVyID0gX3JlZjEyJHBsYWNlaG9sZGVyID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYxMiRwbGFjZWhvbGRlciwKICAgICAgICAgIF9yZWYxMiRrZXlDb2RlID0gX3JlZjEyLmtleUNvZGUsCiAgICAgICAgICBrZXlDb2RlID0gX3JlZjEyJGtleUNvZGUgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBfcmVmMTIka2V5Q29kZTsKCiAgICAgIHZhciBwYXNzZWRWYWx1ZSA9ICgwLCBfdXRpbHMuaXNUeXBlKSgnU3RyaW5nJywgdmFsdWUpID8gdmFsdWUudHJpbSgpIDogdmFsdWU7CgogICAgICB2YXIgcGFzc2VkS2V5Q29kZSA9IGtleUNvZGU7CiAgICAgIHZhciBwYXNzZWRDdXN0b21Qcm9wZXJ0aWVzID0gY3VzdG9tUHJvcGVydGllczsKICAgICAgdmFyIGl0ZW1zID0gdGhpcy5fc3RvcmUuaXRlbXM7CiAgICAgIHZhciBwYXNzZWRMYWJlbCA9IGxhYmVsIHx8IHBhc3NlZFZhbHVlOwogICAgICB2YXIgcGFzc2VkT3B0aW9uSWQgPSBwYXJzZUludChjaG9pY2VJZCwgMTApIHx8IC0xOwogICAgICB2YXIgZ3JvdXAgPSBncm91cElkID49IDAgPyB0aGlzLl9zdG9yZS5nZXRHcm91cEJ5SWQoZ3JvdXBJZCkgOiBudWxsOwogICAgICB2YXIgaWQgPSBpdGVtcyA/IGl0ZW1zLmxlbmd0aCArIDEgOiAxOwoKICAgICAgLy8gSWYgYSBwcmVwZW5kZWQgdmFsdWUgaGFzIGJlZW4gcGFzc2VkLCBwcmVwZW5kIGl0CiAgICAgIGlmICh0aGlzLmNvbmZpZy5wcmVwZW5kVmFsdWUpIHsKICAgICAgICBwYXNzZWRWYWx1ZSA9IHRoaXMuY29uZmlnLnByZXBlbmRWYWx1ZSArIHBhc3NlZFZhbHVlLnRvU3RyaW5nKCk7CiAgICAgIH0KCiAgICAgIC8vIElmIGFuIGFwcGVuZGVkIHZhbHVlIGhhcyBiZWVuIHBhc3NlZCwgYXBwZW5kIGl0CiAgICAgIGlmICh0aGlzLmNvbmZpZy5hcHBlbmRWYWx1ZSkgewogICAgICAgIHBhc3NlZFZhbHVlICs9IHRoaXMuY29uZmlnLmFwcGVuZFZhbHVlLnRvU3RyaW5nKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfaXRlbXMuYWRkSXRlbSkoewogICAgICAgIHZhbHVlOiBwYXNzZWRWYWx1ZSwKICAgICAgICBsYWJlbDogcGFzc2VkTGFiZWwsCiAgICAgICAgaWQ6IGlkLAogICAgICAgIGNob2ljZUlkOiBwYXNzZWRPcHRpb25JZCwKICAgICAgICBncm91cElkOiBncm91cElkLAogICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGN1c3RvbVByb3BlcnRpZXMsCiAgICAgICAgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyLAogICAgICAgIGtleUNvZGU6IHBhc3NlZEtleUNvZGUKICAgICAgfSkpOwoKICAgICAgaWYgKHRoaXMuX2lzU2VsZWN0T25lRWxlbWVudCkgewogICAgICAgIHRoaXMucmVtb3ZlQWN0aXZlSXRlbXMoaWQpOwogICAgICB9CgogICAgICAvLyBUcmlnZ2VyIGNoYW5nZSBldmVudAogICAgICBpZiAoZ3JvdXAgJiYgZ3JvdXAudmFsdWUpIHsKICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLmFkZEl0ZW0sIHsKICAgICAgICAgIGlkOiBpZCwKICAgICAgICAgIHZhbHVlOiBwYXNzZWRWYWx1ZSwKICAgICAgICAgIGxhYmVsOiBwYXNzZWRMYWJlbCwKICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IHBhc3NlZEN1c3RvbVByb3BlcnRpZXMsCiAgICAgICAgICBncm91cFZhbHVlOiBncm91cC52YWx1ZSwKICAgICAgICAgIGtleUNvZGU6IHBhc3NlZEtleUNvZGUKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBhc3NlZEVsZW1lbnQudHJpZ2dlckV2ZW50KF9jb25zdGFudHMuRVZFTlRTLmFkZEl0ZW0sIHsKICAgICAgICAgIGlkOiBpZCwKICAgICAgICAgIHZhbHVlOiBwYXNzZWRWYWx1ZSwKICAgICAgICAgIGxhYmVsOiBwYXNzZWRMYWJlbCwKICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IHBhc3NlZEN1c3RvbVByb3BlcnRpZXMsCiAgICAgICAgICBrZXlDb2RlOiBwYXNzZWRLZXlDb2RlCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH0sIHsKICAgIGtleTogJ19yZW1vdmVJdGVtJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVtb3ZlSXRlbShpdGVtKSB7CiAgICAgIGlmICghaXRlbSB8fCAhKDAsIF91dGlscy5pc1R5cGUpKCdPYmplY3QnLCBpdGVtKSkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICB2YXIgaWQgPSBpdGVtLmlkLAogICAgICAgICAgdmFsdWUgPSBpdGVtLnZhbHVlLAogICAgICAgICAgbGFiZWwgPSBpdGVtLmxhYmVsLAogICAgICAgICAgY2hvaWNlSWQgPSBpdGVtLmNob2ljZUlkLAogICAgICAgICAgZ3JvdXBJZCA9IGl0ZW0uZ3JvdXBJZDsKCiAgICAgIHZhciBncm91cCA9IGdyb3VwSWQgPj0gMCA/IHRoaXMuX3N0b3JlLmdldEdyb3VwQnlJZChncm91cElkKSA6IG51bGw7CgogICAgICB0aGlzLl9zdG9yZS5kaXNwYXRjaCgoMCwgX2l0ZW1zLnJlbW92ZUl0ZW0pKGlkLCBjaG9pY2VJZCkpOwoKICAgICAgaWYgKGdyb3VwICYmIGdyb3VwLnZhbHVlKSB7CiAgICAgICAgdGhpcy5wYXNzZWRFbGVtZW50LnRyaWdnZXJFdmVudChfY29uc3RhbnRzLkVWRU5UUy5yZW1vdmVJdGVtLCB7CiAgICAgICAgICBpZDogaWQsCiAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICBsYWJlbDogbGFiZWwsCiAgICAgICAgICBncm91cFZhbHVlOiBncm91cC52YWx1ZQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucGFzc2VkRWxlbWVudC50cmlnZ2VyRXZlbnQoX2NvbnN0YW50cy5FVkVOVFMucmVtb3ZlSXRlbSwgewogICAgICAgICAgaWQ6IGlkLAogICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgbGFiZWw6IGxhYmVsCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH0sIHsKICAgIGtleTogJ19hZGRDaG9pY2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hZGRDaG9pY2UoX3JlZjEzKSB7CiAgICAgIHZhciB2YWx1ZSA9IF9yZWYxMy52YWx1ZSwKICAgICAgICAgIF9yZWYxMyRsYWJlbCA9IF9yZWYxMy5sYWJlbCwKICAgICAgICAgIGxhYmVsID0gX3JlZjEzJGxhYmVsID09PSB1bmRlZmluZWQgPyBudWxsIDogX3JlZjEzJGxhYmVsLAogICAgICAgICAgX3JlZjEzJGlzU2VsZWN0ZWQgPSBfcmVmMTMuaXNTZWxlY3RlZCwKICAgICAgICAgIGlzU2VsZWN0ZWQgPSBfcmVmMTMkaXNTZWxlY3RlZCA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmMTMkaXNTZWxlY3RlZCwKICAgICAgICAgIF9yZWYxMyRpc0Rpc2FibGVkID0gX3JlZjEzLmlzRGlzYWJsZWQsCiAgICAgICAgICBpc0Rpc2FibGVkID0gX3JlZjEzJGlzRGlzYWJsZWQgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZjEzJGlzRGlzYWJsZWQsCiAgICAgICAgICBfcmVmMTMkZ3JvdXBJZCA9IF9yZWYxMy5ncm91cElkLAogICAgICAgICAgZ3JvdXBJZCA9IF9yZWYxMyRncm91cElkID09PSB1bmRlZmluZWQgPyAtMSA6IF9yZWYxMyRncm91cElkLAogICAgICAgICAgX3JlZjEzJGN1c3RvbVByb3BlcnRpID0gX3JlZjEzLmN1c3RvbVByb3BlcnRpZXMsCiAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzID0gX3JlZjEzJGN1c3RvbVByb3BlcnRpID09PSB1bmRlZmluZWQgPyBudWxsIDogX3JlZjEzJGN1c3RvbVByb3BlcnRpLAogICAgICAgICAgX3JlZjEzJHBsYWNlaG9sZGVyID0gX3JlZjEzLnBsYWNlaG9sZGVyLAogICAgICAgICAgcGxhY2Vob2xkZXIgPSBfcmVmMTMkcGxhY2Vob2xkZXIgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZjEzJHBsYWNlaG9sZGVyLAogICAgICAgICAgX3JlZjEzJGtleUNvZGUgPSBfcmVmMTMua2V5Q29kZSwKICAgICAgICAgIGtleUNvZGUgPSBfcmVmMTMka2V5Q29kZSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IF9yZWYxMyRrZXlDb2RlOwoKICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgdmFsdWUgPT09IG51bGwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBpZAogICAgICB2YXIgY2hvaWNlcyA9IHRoaXMuX3N0b3JlLmNob2ljZXM7CiAgICAgIHZhciBjaG9pY2VMYWJlbCA9IGxhYmVsIHx8IHZhbHVlOwogICAgICB2YXIgY2hvaWNlSWQgPSBjaG9pY2VzID8gY2hvaWNlcy5sZW5ndGggKyAxIDogMTsKICAgICAgdmFyIGNob2ljZUVsZW1lbnRJZCA9IHRoaXMuX2Jhc2VJZCArICctJyArIHRoaXMuX2lkTmFtZXMuaXRlbUNob2ljZSArICctJyArIGNob2ljZUlkOwoKICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9jaG9pY2VzLmFkZENob2ljZSkoewogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBsYWJlbDogY2hvaWNlTGFiZWwsCiAgICAgICAgaWQ6IGNob2ljZUlkLAogICAgICAgIGdyb3VwSWQ6IGdyb3VwSWQsCiAgICAgICAgZGlzYWJsZWQ6IGlzRGlzYWJsZWQsCiAgICAgICAgZWxlbWVudElkOiBjaG9pY2VFbGVtZW50SWQsCiAgICAgICAgY3VzdG9tUHJvcGVydGllczogY3VzdG9tUHJvcGVydGllcywKICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXIsCiAgICAgICAga2V5Q29kZToga2V5Q29kZQogICAgICB9KSk7CgogICAgICBpZiAoaXNTZWxlY3RlZCkgewogICAgICAgIHRoaXMuX2FkZEl0ZW0oewogICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgbGFiZWw6IGNob2ljZUxhYmVsLAogICAgICAgICAgY2hvaWNlSWQ6IGNob2ljZUlkLAogICAgICAgICAgY3VzdG9tUHJvcGVydGllczogY3VzdG9tUHJvcGVydGllcywKICAgICAgICAgIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlciwKICAgICAgICAgIGtleUNvZGU6IGtleUNvZGUKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19jbGVhckNob2ljZXMnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jbGVhckNob2ljZXMoKSB7CiAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfY2hvaWNlcy5jbGVhckNob2ljZXMpKCkpOwogICAgfQogIH0sIHsKICAgIGtleTogJ19hZGRHcm91cCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZEdyb3VwKF9yZWYxNCkgewogICAgICB2YXIgX3RoaXMyMSA9IHRoaXM7CgogICAgICB2YXIgZ3JvdXAgPSBfcmVmMTQuZ3JvdXAsCiAgICAgICAgICBpZCA9IF9yZWYxNC5pZCwKICAgICAgICAgIF9yZWYxNCR2YWx1ZUtleSA9IF9yZWYxNC52YWx1ZUtleSwKICAgICAgICAgIHZhbHVlS2V5ID0gX3JlZjE0JHZhbHVlS2V5ID09PSB1bmRlZmluZWQgPyAndmFsdWUnIDogX3JlZjE0JHZhbHVlS2V5LAogICAgICAgICAgX3JlZjE0JGxhYmVsS2V5ID0gX3JlZjE0LmxhYmVsS2V5LAogICAgICAgICAgbGFiZWxLZXkgPSBfcmVmMTQkbGFiZWxLZXkgPT09IHVuZGVmaW5lZCA/ICdsYWJlbCcgOiBfcmVmMTQkbGFiZWxLZXk7CgogICAgICB2YXIgZ3JvdXBDaG9pY2VzID0gKDAsIF91dGlscy5pc1R5cGUpKCdPYmplY3QnLCBncm91cCkgPyBncm91cC5jaG9pY2VzIDogQXJyYXkuZnJvbShncm91cC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnT1BUSU9OJykpOwogICAgICB2YXIgZ3JvdXBJZCA9IGlkIHx8IE1hdGguZmxvb3IobmV3IERhdGUoKS52YWx1ZU9mKCkgKiBNYXRoLnJhbmRvbSgpKTsKICAgICAgdmFyIGlzRGlzYWJsZWQgPSBncm91cC5kaXNhYmxlZCA/IGdyb3VwLmRpc2FibGVkIDogZmFsc2U7CgogICAgICBpZiAoZ3JvdXBDaG9pY2VzKSB7CiAgICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goKDAsIF9ncm91cHMuYWRkR3JvdXApKGdyb3VwLmxhYmVsLCBncm91cElkLCB0cnVlLCBpc0Rpc2FibGVkKSk7CgogICAgICAgIHZhciBhZGRHcm91cENob2ljZXMgPSBmdW5jdGlvbiBhZGRHcm91cENob2ljZXMoY2hvaWNlKSB7CiAgICAgICAgICB2YXIgaXNPcHREaXNhYmxlZCA9IGNob2ljZS5kaXNhYmxlZCB8fCBjaG9pY2UucGFyZW50Tm9kZSAmJiBjaG9pY2UucGFyZW50Tm9kZS5kaXNhYmxlZDsKCiAgICAgICAgICBfdGhpczIxLl9hZGRDaG9pY2UoewogICAgICAgICAgICB2YWx1ZTogY2hvaWNlW3ZhbHVlS2V5XSwKICAgICAgICAgICAgbGFiZWw6ICgwLCBfdXRpbHMuaXNUeXBlKSgnT2JqZWN0JywgY2hvaWNlKSA/IGNob2ljZVtsYWJlbEtleV0gOiBjaG9pY2UuaW5uZXJIVE1MLAogICAgICAgICAgICBpc1NlbGVjdGVkOiBjaG9pY2Uuc2VsZWN0ZWQsCiAgICAgICAgICAgIGlzRGlzYWJsZWQ6IGlzT3B0RGlzYWJsZWQsCiAgICAgICAgICAgIGdyb3VwSWQ6IGdyb3VwSWQsCiAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGNob2ljZS5jdXN0b21Qcm9wZXJ0aWVzLAogICAgICAgICAgICBwbGFjZWhvbGRlcjogY2hvaWNlLnBsYWNlaG9sZGVyCiAgICAgICAgICB9KTsKICAgICAgICB9OwoKICAgICAgICBncm91cENob2ljZXMuZm9yRWFjaChhZGRHcm91cENob2ljZXMpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuX3N0b3JlLmRpc3BhdGNoKCgwLCBfZ3JvdXBzLmFkZEdyb3VwKShncm91cC5sYWJlbCwgZ3JvdXAuaWQsIGZhbHNlLCBncm91cC5kaXNhYmxlZCkpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX2dldFRlbXBsYXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0VGVtcGxhdGUodGVtcGxhdGUpIHsKICAgICAgdmFyIF90ZW1wbGF0ZXMkdGVtcGxhdGU7CgogICAgICBpZiAoIXRlbXBsYXRlKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBfY29uZmlnNCA9IHRoaXMuY29uZmlnLAogICAgICAgICAgdGVtcGxhdGVzID0gX2NvbmZpZzQudGVtcGxhdGVzLAogICAgICAgICAgY2xhc3NOYW1lcyA9IF9jb25maWc0LmNsYXNzTmFtZXM7CgogICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgICBhcmdzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgICAgfQoKICAgICAgcmV0dXJuIChfdGVtcGxhdGVzJHRlbXBsYXRlID0gdGVtcGxhdGVzW3RlbXBsYXRlXSkuY2FsbC5hcHBseShfdGVtcGxhdGVzJHRlbXBsYXRlLCBbdGhpcywgY2xhc3NOYW1lc10uY29uY2F0KGFyZ3MpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfY3JlYXRlVGVtcGxhdGVzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlVGVtcGxhdGVzKCkgewogICAgICB2YXIgY2FsbGJhY2tPbkNyZWF0ZVRlbXBsYXRlcyA9IHRoaXMuY29uZmlnLmNhbGxiYWNrT25DcmVhdGVUZW1wbGF0ZXM7CgogICAgICB2YXIgdXNlclRlbXBsYXRlcyA9IHt9OwoKICAgICAgaWYgKGNhbGxiYWNrT25DcmVhdGVUZW1wbGF0ZXMgJiYgKDAsIF91dGlscy5pc1R5cGUpKCdGdW5jdGlvbicsIGNhbGxiYWNrT25DcmVhdGVUZW1wbGF0ZXMpKSB7CiAgICAgICAgdXNlclRlbXBsYXRlcyA9IGNhbGxiYWNrT25DcmVhdGVUZW1wbGF0ZXMuY2FsbCh0aGlzLCBfdXRpbHMuc3RyVG9FbCk7CiAgICAgIH0KCiAgICAgIHRoaXMuY29uZmlnLnRlbXBsYXRlcyA9ICgwLCBfdXRpbHMuZXh0ZW5kKShfdGVtcGxhdGVzLlRFTVBMQVRFUywgdXNlclRlbXBsYXRlcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX2NyZWF0ZUVsZW1lbnRzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlRWxlbWVudHMoKSB7CiAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIgPSBuZXcgX2NvbXBvbmVudHMuQ29udGFpbmVyKHsKICAgICAgICBlbGVtZW50OiB0aGlzLl9nZXRUZW1wbGF0ZSgnY29udGFpbmVyT3V0ZXInLCB0aGlzLl9kaXJlY3Rpb24sIHRoaXMuX2lzU2VsZWN0RWxlbWVudCwgdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50LCB0aGlzLmNvbmZpZy5zZWFyY2hFbmFibGVkLCB0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC50eXBlKSwKICAgICAgICBjbGFzc05hbWVzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLAogICAgICAgIHR5cGU6IHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LnR5cGUsCiAgICAgICAgcG9zaXRpb246IHRoaXMuY29uZmlnLnBvc2l0aW9uCiAgICAgIH0pOwoKICAgICAgdGhpcy5jb250YWluZXJJbm5lciA9IG5ldyBfY29tcG9uZW50cy5Db250YWluZXIoewogICAgICAgIGVsZW1lbnQ6IHRoaXMuX2dldFRlbXBsYXRlKCdjb250YWluZXJJbm5lcicpLAogICAgICAgIGNsYXNzTmFtZXM6IHRoaXMuY29uZmlnLmNsYXNzTmFtZXMsCiAgICAgICAgdHlwZTogdGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQudHlwZSwKICAgICAgICBwb3NpdGlvbjogdGhpcy5jb25maWcucG9zaXRpb24KICAgICAgfSk7CgogICAgICB0aGlzLmlucHV0ID0gbmV3IF9jb21wb25lbnRzLklucHV0KHsKICAgICAgICBlbGVtZW50OiB0aGlzLl9nZXRUZW1wbGF0ZSgnaW5wdXQnKSwKICAgICAgICBjbGFzc05hbWVzOiB0aGlzLmNvbmZpZy5jbGFzc05hbWVzLAogICAgICAgIHR5cGU6IHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LnR5cGUKICAgICAgfSk7CgogICAgICB0aGlzLmNob2ljZUxpc3QgPSBuZXcgX2NvbXBvbmVudHMuTGlzdCh7CiAgICAgICAgZWxlbWVudDogdGhpcy5fZ2V0VGVtcGxhdGUoJ2Nob2ljZUxpc3QnLCB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpCiAgICAgIH0pOwoKICAgICAgdGhpcy5pdGVtTGlzdCA9IG5ldyBfY29tcG9uZW50cy5MaXN0KHsKICAgICAgICBlbGVtZW50OiB0aGlzLl9nZXRUZW1wbGF0ZSgnaXRlbUxpc3QnLCB0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpCiAgICAgIH0pOwoKICAgICAgdGhpcy5kcm9wZG93biA9IG5ldyBfY29tcG9uZW50cy5Ecm9wZG93bih7CiAgICAgICAgZWxlbWVudDogdGhpcy5fZ2V0VGVtcGxhdGUoJ2Ryb3Bkb3duJyksCiAgICAgICAgY2xhc3NOYW1lczogdGhpcy5jb25maWcuY2xhc3NOYW1lcywKICAgICAgICB0eXBlOiB0aGlzLnBhc3NlZEVsZW1lbnQuZWxlbWVudC50eXBlCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ19jcmVhdGVTdHJ1Y3R1cmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVTdHJ1Y3R1cmUoKSB7CiAgICAgIC8vIEhpZGUgb3JpZ2luYWwgZWxlbWVudAogICAgICB0aGlzLnBhc3NlZEVsZW1lbnQuY29uY2VhbCgpOwogICAgICAvLyBXcmFwIGlucHV0IGluIGNvbnRhaW5lciBwcmVzZXJ2aW5nIERPTSBvcmRlcmluZwogICAgICB0aGlzLmNvbnRhaW5lcklubmVyLndyYXAodGhpcy5wYXNzZWRFbGVtZW50LmVsZW1lbnQpOwogICAgICAvLyBXcmFwcGVyIGlubmVyIGNvbnRhaW5lciB3aXRoIG91dGVyIGNvbnRhaW5lcgogICAgICB0aGlzLmNvbnRhaW5lck91dGVyLndyYXAodGhpcy5jb250YWluZXJJbm5lci5lbGVtZW50KTsKCiAgICAgIGlmICh0aGlzLl9pc1NlbGVjdE9uZUVsZW1lbnQpIHsKICAgICAgICB0aGlzLmlucHV0LnBsYWNlaG9sZGVyID0gdGhpcy5jb25maWcuc2VhcmNoUGxhY2Vob2xkZXJWYWx1ZSB8fCAnJzsKICAgICAgfSBlbHNlIGlmICh0aGlzLl9wbGFjZWhvbGRlclZhbHVlKSB7CiAgICAgICAgdGhpcy5pbnB1dC5wbGFjZWhvbGRlciA9IHRoaXMuX3BsYWNlaG9sZGVyVmFsdWU7CiAgICAgICAgdGhpcy5pbnB1dC5zZXRXaWR0aCh0cnVlKTsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWluZXJPdXRlci5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuY29udGFpbmVySW5uZXIuZWxlbWVudCk7CiAgICAgIHRoaXMuY29udGFpbmVyT3V0ZXIuZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmRyb3Bkb3duLmVsZW1lbnQpOwogICAgICB0aGlzLmNvbnRhaW5lcklubmVyLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5pdGVtTGlzdC5lbGVtZW50KTsKCiAgICAgIGlmICghdGhpcy5faXNUZXh0RWxlbWVudCkgewogICAgICAgIHRoaXMuZHJvcGRvd24uZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmNob2ljZUxpc3QuZWxlbWVudCk7CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7CiAgICAgICAgdGhpcy5jb250YWluZXJJbm5lci5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuaW5wdXQuZWxlbWVudCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jb25maWcuc2VhcmNoRW5hYmxlZCkgewogICAgICAgIHRoaXMuZHJvcGRvd24uZWxlbWVudC5pbnNlcnRCZWZvcmUodGhpcy5pbnB1dC5lbGVtZW50LCB0aGlzLmRyb3Bkb3duLmVsZW1lbnQuZmlyc3RDaGlsZCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9pc1NlbGVjdEVsZW1lbnQpIHsKICAgICAgICB0aGlzLl9hZGRQcmVkZWZpbmVkQ2hvaWNlcygpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuX2lzVGV4dEVsZW1lbnQpIHsKICAgICAgICB0aGlzLl9hZGRQcmVkZWZpbmVkSXRlbXMoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19hZGRQcmVkZWZpbmVkQ2hvaWNlcycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZFByZWRlZmluZWRDaG9pY2VzKCkgewogICAgICB2YXIgX3RoaXMyMiA9IHRoaXM7CgogICAgICB2YXIgcGFzc2VkR3JvdXBzID0gdGhpcy5wYXNzZWRFbGVtZW50Lm9wdGlvbkdyb3VwczsKCiAgICAgIHRoaXMuX2hpZ2hsaWdodFBvc2l0aW9uID0gMDsKICAgICAgdGhpcy5faXNTZWFyY2hpbmcgPSBmYWxzZTsKCiAgICAgIGlmIChwYXNzZWRHcm91cHMgJiYgcGFzc2VkR3JvdXBzLmxlbmd0aCkgewogICAgICAgIC8vIElmIHdlIGhhdmUgYSBwbGFjZWhvbGRlciBvcHRpb24KICAgICAgICB2YXIgcGxhY2Vob2xkZXJDaG9pY2UgPSB0aGlzLnBhc3NlZEVsZW1lbnQucGxhY2Vob2xkZXJPcHRpb247CiAgICAgICAgaWYgKHBsYWNlaG9sZGVyQ2hvaWNlICYmIHBsYWNlaG9sZGVyQ2hvaWNlLnBhcmVudE5vZGUudGFnTmFtZSA9PT0gJ1NFTEVDVCcpIHsKICAgICAgICAgIHRoaXMuX2FkZENob2ljZSh7CiAgICAgICAgICAgIHZhbHVlOiBwbGFjZWhvbGRlckNob2ljZS52YWx1ZSwKICAgICAgICAgICAgbGFiZWw6IHBsYWNlaG9sZGVyQ2hvaWNlLmlubmVySFRNTCwKICAgICAgICAgICAgaXNTZWxlY3RlZDogcGxhY2Vob2xkZXJDaG9pY2Uuc2VsZWN0ZWQsCiAgICAgICAgICAgIGlzRGlzYWJsZWQ6IHBsYWNlaG9sZGVyQ2hvaWNlLmRpc2FibGVkLAogICAgICAgICAgICBwbGFjZWhvbGRlcjogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBwYXNzZWRHcm91cHMuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiBfdGhpczIyLl9hZGRHcm91cCh7CiAgICAgICAgICAgIGdyb3VwOiBncm91cCwKICAgICAgICAgICAgaWQ6IGdyb3VwLmlkIHx8IG51bGwKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBwYXNzZWRPcHRpb25zID0gdGhpcy5wYXNzZWRFbGVtZW50Lm9wdGlvbnM7CiAgICAgICAgdmFyIGZpbHRlciA9IHRoaXMuY29uZmlnLnNvcnRGbjsKICAgICAgICB2YXIgYWxsQ2hvaWNlcyA9IHRoaXMuX3ByZXNldENob2ljZXM7CgogICAgICAgIC8vIENyZWF0ZSBhcnJheSBvZiBvcHRpb25zIGZyb20gb3B0aW9uIGVsZW1lbnRzCiAgICAgICAgcGFzc2VkT3B0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChvKSB7CiAgICAgICAgICBhbGxDaG9pY2VzLnB1c2goewogICAgICAgICAgICB2YWx1ZTogby52YWx1ZSwKICAgICAgICAgICAgbGFiZWw6IG8uaW5uZXJIVE1MLAogICAgICAgICAgICBzZWxlY3RlZDogby5zZWxlY3RlZCwKICAgICAgICAgICAgZGlzYWJsZWQ6IG8uZGlzYWJsZWQgfHwgby5wYXJlbnROb2RlLmRpc2FibGVkLAogICAgICAgICAgICBwbGFjZWhvbGRlcjogby5oYXNBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJykKICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAvLyBJZiBzb3J0aW5nIGlzIGVuYWJsZWQgb3IgdGhlIHVzZXIgaXMgc2VhcmNoaW5nLCBmaWx0ZXIgY2hvaWNlcwogICAgICAgIGlmICh0aGlzLmNvbmZpZy5zaG91bGRTb3J0KSB7CiAgICAgICAgICBhbGxDaG9pY2VzLnNvcnQoZmlsdGVyKTsKICAgICAgICB9CgogICAgICAgIC8vIERldGVybWluZSB3aGV0aGVyIHRoZXJlIGlzIGEgc2VsZWN0ZWQgY2hvaWNlCiAgICAgICAgdmFyIGhhc1NlbGVjdGVkQ2hvaWNlID0gYWxsQ2hvaWNlcy5zb21lKGZ1bmN0aW9uIChjaG9pY2UpIHsKICAgICAgICAgIHJldHVybiBjaG9pY2Uuc2VsZWN0ZWQ7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGhhbmRsZUNob2ljZSA9IGZ1bmN0aW9uIGhhbmRsZUNob2ljZShjaG9pY2UsIGluZGV4KSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSBjaG9pY2UudmFsdWUsCiAgICAgICAgICAgICAgbGFiZWwgPSBjaG9pY2UubGFiZWwsCiAgICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllcyA9IGNob2ljZS5jdXN0b21Qcm9wZXJ0aWVzLAogICAgICAgICAgICAgIHBsYWNlaG9sZGVyID0gY2hvaWNlLnBsYWNlaG9sZGVyOwoKCiAgICAgICAgICBpZiAoX3RoaXMyMi5faXNTZWxlY3RFbGVtZW50KSB7CiAgICAgICAgICAgIC8vIElmIHRoZSBjaG9pY2UgaXMgYWN0dWFsbHkgYSBncm91cAogICAgICAgICAgICBpZiAoY2hvaWNlLmNob2ljZXMpIHsKICAgICAgICAgICAgICBfdGhpczIyLl9hZGRHcm91cCh7CiAgICAgICAgICAgICAgICBncm91cDogY2hvaWNlLAogICAgICAgICAgICAgICAgaWQ6IGNob2ljZS5pZCB8fCBudWxsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBzZWxlY3RlZCBjaG9pY2UgYWxyZWFkeSBvciB0aGUgY2hvaWNlIGlzIG5vdAogICAgICAgICAgICAgIC8vIHRoZSBmaXJzdCBpbiB0aGUgYXJyYXksIGFkZCBlYWNoIGNob2ljZSBub3JtYWxseQogICAgICAgICAgICAgIC8vIE90aGVyd2lzZSBwcmUtc2VsZWN0IHRoZSBmaXJzdCBjaG9pY2UgaW4gdGhlIGFycmF5IGlmIGl0J3MgYSBzaW5nbGUgc2VsZWN0CiAgICAgICAgICAgICAgdmFyIHNob3VsZFByZXNlbGVjdCA9IF90aGlzMjIuX2lzU2VsZWN0T25lRWxlbWVudCAmJiAhaGFzU2VsZWN0ZWRDaG9pY2UgJiYgaW5kZXggPT09IDA7CiAgICAgICAgICAgICAgdmFyIGlzU2VsZWN0ZWQgPSBzaG91bGRQcmVzZWxlY3QgPyB0cnVlIDogY2hvaWNlLnNlbGVjdGVkOwogICAgICAgICAgICAgIHZhciBpc0Rpc2FibGVkID0gc2hvdWxkUHJlc2VsZWN0ID8gZmFsc2UgOiBjaG9pY2UuZGlzYWJsZWQ7CgogICAgICAgICAgICAgIF90aGlzMjIuX2FkZENob2ljZSh7CiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICBsYWJlbDogbGFiZWwsCiAgICAgICAgICAgICAgICBpc1NlbGVjdGVkOiBpc1NlbGVjdGVkLAogICAgICAgICAgICAgICAgaXNEaXNhYmxlZDogaXNEaXNhYmxlZCwKICAgICAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGN1c3RvbVByb3BlcnRpZXMsCiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMyMi5fYWRkQ2hvaWNlKHsKICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgbGFiZWw6IGxhYmVsLAogICAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IGNob2ljZS5zZWxlY3RlZCwKICAgICAgICAgICAgICBpc0Rpc2FibGVkOiBjaG9pY2UuZGlzYWJsZWQsCiAgICAgICAgICAgICAgY3VzdG9tUHJvcGVydGllczogY3VzdG9tUHJvcGVydGllcywKICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLy8gQWRkIGVhY2ggY2hvaWNlCiAgICAgICAgYWxsQ2hvaWNlcy5mb3JFYWNoKGZ1bmN0aW9uIChjaG9pY2UsIGluZGV4KSB7CiAgICAgICAgICByZXR1cm4gaGFuZGxlQ2hvaWNlKGNob2ljZSwgaW5kZXgpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnX2FkZFByZWRlZmluZWRJdGVtcycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZFByZWRlZmluZWRJdGVtcygpIHsKICAgICAgdmFyIF90aGlzMjMgPSB0aGlzOwoKICAgICAgdmFyIGhhbmRsZVByZXNldEl0ZW0gPSBmdW5jdGlvbiBoYW5kbGVQcmVzZXRJdGVtKGl0ZW0pIHsKICAgICAgICB2YXIgaXRlbVR5cGUgPSAoMCwgX3V0aWxzLmdldFR5cGUpKGl0ZW0pOwogICAgICAgIGlmIChpdGVtVHlwZSA9PT0gJ09iamVjdCcgJiYgaXRlbS52YWx1ZSkgewogICAgICAgICAgX3RoaXMyMy5fYWRkSXRlbSh7CiAgICAgICAgICAgIHZhbHVlOiBpdGVtLnZhbHVlLAogICAgICAgICAgICBsYWJlbDogaXRlbS5sYWJlbCwKICAgICAgICAgICAgY2hvaWNlSWQ6IGl0ZW0uaWQsCiAgICAgICAgICAgIGN1c3RvbVByb3BlcnRpZXM6IGl0ZW0uY3VzdG9tUHJvcGVydGllcywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGl0ZW0ucGxhY2Vob2xkZXIKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoaXRlbVR5cGUgPT09ICdTdHJpbmcnKSB7CiAgICAgICAgICBfdGhpczIzLl9hZGRJdGVtKHsKICAgICAgICAgICAgdmFsdWU6IGl0ZW0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHRoaXMuX3ByZXNldEl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaGFuZGxlUHJlc2V0SXRlbShpdGVtKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX3NldENob2ljZU9ySXRlbScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NldENob2ljZU9ySXRlbShpdGVtKSB7CiAgICAgIHZhciBfdGhpczI0ID0gdGhpczsKCiAgICAgIHZhciBpdGVtVHlwZSA9ICgwLCBfdXRpbHMuZ2V0VHlwZSkoaXRlbSkudG9Mb3dlckNhc2UoKTsKICAgICAgdmFyIGhhbmRsZVR5cGUgPSB7CiAgICAgICAgb2JqZWN0OiBmdW5jdGlvbiBvYmplY3QoKSB7CiAgICAgICAgICBpZiAoIWl0ZW0udmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIElmIHdlIGFyZSBkZWFsaW5nIHdpdGggYSBzZWxlY3QgaW5wdXQsIHdlIG5lZWQgdG8gY3JlYXRlIGFuIG9wdGlvbiBmaXJzdAogICAgICAgICAgLy8gdGhhdCBpcyB0aGVuIHNlbGVjdGVkLiBGb3IgdGV4dCBpbnB1dHMgd2UgY2FuIGp1c3QgYWRkIGl0ZW1zIG5vcm1hbGx5LgogICAgICAgICAgaWYgKCFfdGhpczI0Ll9pc1RleHRFbGVtZW50KSB7CiAgICAgICAgICAgIF90aGlzMjQuX2FkZENob2ljZSh7CiAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0udmFsdWUsCiAgICAgICAgICAgICAgbGFiZWw6IGl0ZW0ubGFiZWwsCiAgICAgICAgICAgICAgaXNTZWxlY3RlZDogdHJ1ZSwKICAgICAgICAgICAgICBpc0Rpc2FibGVkOiBmYWxzZSwKICAgICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBpdGVtLmN1c3RvbVByb3BlcnRpZXMsCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGl0ZW0ucGxhY2Vob2xkZXIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczI0Ll9hZGRJdGVtKHsKICAgICAgICAgICAgICB2YWx1ZTogaXRlbS52YWx1ZSwKICAgICAgICAgICAgICBsYWJlbDogaXRlbS5sYWJlbCwKICAgICAgICAgICAgICBjaG9pY2VJZDogaXRlbS5pZCwKICAgICAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBpdGVtLmN1c3RvbVByb3BlcnRpZXMsCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGl0ZW0ucGxhY2Vob2xkZXIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzdHJpbmc6IGZ1bmN0aW9uIHN0cmluZygpIHsKICAgICAgICAgIGlmICghX3RoaXMyNC5faXNUZXh0RWxlbWVudCkgewogICAgICAgICAgICBfdGhpczI0Ll9hZGRDaG9pY2UoewogICAgICAgICAgICAgIHZhbHVlOiBpdGVtLAogICAgICAgICAgICAgIGxhYmVsOiBpdGVtLAogICAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IHRydWUsCiAgICAgICAgICAgICAgaXNEaXNhYmxlZDogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczI0Ll9hZGRJdGVtKHsKICAgICAgICAgICAgICB2YWx1ZTogaXRlbQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CgogICAgICBoYW5kbGVUeXBlW2l0ZW1UeXBlXSgpOwogICAgfQogIH0sIHsKICAgIGtleTogJ19maW5kQW5kU2VsZWN0Q2hvaWNlQnlWYWx1ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpbmRBbmRTZWxlY3RDaG9pY2VCeVZhbHVlKHZhbCkgewogICAgICB2YXIgX3RoaXMyNSA9IHRoaXM7CgogICAgICB2YXIgY2hvaWNlcyA9IHRoaXMuX3N0b3JlLmNob2ljZXM7CiAgICAgIC8vIENoZWNrICd2YWx1ZScgcHJvcGVydHkgZXhpc3RzIGFuZCB0aGUgY2hvaWNlIGlzbid0IGFscmVhZHkgc2VsZWN0ZWQKICAgICAgdmFyIGZvdW5kQ2hvaWNlID0gY2hvaWNlcy5maW5kKGZ1bmN0aW9uIChjaG9pY2UpIHsKICAgICAgICByZXR1cm4gX3RoaXMyNS5jb25maWcuaXRlbUNvbXBhcmVyKGNob2ljZS52YWx1ZSwgdmFsKTsKICAgICAgfSk7CgogICAgICBpZiAoZm91bmRDaG9pY2UgJiYgIWZvdW5kQ2hvaWNlLnNlbGVjdGVkKSB7CiAgICAgICAgdGhpcy5fYWRkSXRlbSh7CiAgICAgICAgICB2YWx1ZTogZm91bmRDaG9pY2UudmFsdWUsCiAgICAgICAgICBsYWJlbDogZm91bmRDaG9pY2UubGFiZWwsCiAgICAgICAgICBpZDogZm91bmRDaG9pY2UuaWQsCiAgICAgICAgICBncm91cElkOiBmb3VuZENob2ljZS5ncm91cElkLAogICAgICAgICAgY3VzdG9tUHJvcGVydGllczogZm91bmRDaG9pY2UuY3VzdG9tUHJvcGVydGllcywKICAgICAgICAgIHBsYWNlaG9sZGVyOiBmb3VuZENob2ljZS5wbGFjZWhvbGRlciwKICAgICAgICAgIGtleUNvZGU6IGZvdW5kQ2hvaWNlLmtleUNvZGUKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19nZW5lcmF0ZUluc3RhbmNlcycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dlbmVyYXRlSW5zdGFuY2VzKGVsZW1lbnRzLCBjb25maWcpIHsKICAgICAgcmV0dXJuIGVsZW1lbnRzLnJlZHVjZShmdW5jdGlvbiAoaW5zdGFuY2VzLCBlbGVtZW50KSB7CiAgICAgICAgaW5zdGFuY2VzLnB1c2gobmV3IENob2ljZXMoZWxlbWVudCwgY29uZmlnKSk7CiAgICAgICAgcmV0dXJuIGluc3RhbmNlczsKICAgICAgfSwgW3RoaXNdKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfZ2VuZXJhdGVQbGFjZWhvbGRlclZhbHVlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2VuZXJhdGVQbGFjZWhvbGRlclZhbHVlKCkgewogICAgICBpZiAodGhpcy5faXNTZWxlY3RPbmVFbGVtZW50KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5jb25maWcucGxhY2Vob2xkZXIgPyB0aGlzLmNvbmZpZy5wbGFjZWhvbGRlclZhbHVlIHx8IHRoaXMucGFzc2VkRWxlbWVudC5lbGVtZW50LmdldEF0dHJpYnV0ZSgncGxhY2Vob2xkZXInKSA6IGZhbHNlOwogICAgfQoKICAgIC8qID09PT09ICBFbmQgb2YgUHJpdmF0ZSBmdW5jdGlvbnMgID09PT09PSAqLwoKICB9XSk7CgogIHJldHVybiBDaG9pY2VzOwp9KCk7CgpDaG9pY2VzLnVzZXJEZWZhdWx0cyA9IHt9OwovLyBXZSBjYW5ub3QgZXhwb3J0IGRlZmF1bHQgaGVyZSBkdWUgdG8gV2VicGFjazogaHR0cHM6Ly9naXRodWIuY29tL3dlYnBhY2svd2VicGFjay9pc3N1ZXMvMzkyOQptb2R1bGUuZXhwb3J0cyA9IENob2ljZXM7CgovKioqLyB9KSwKLyogMzkgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKLyohCiAqIEZ1c2UuanMgdjMuMi4wIC0gTGlnaHR3ZWlnaHQgZnV6enktc2VhcmNoIChodHRwOi8vZnVzZWpzLmlvKQogKiAKICogQ29weXJpZ2h0IChjKSAyMDEyLTIwMTcgS2lyb2xsb3MgUmlzayAoaHR0cDovL2tpcm8ubWUpCiAqIEFsbCBSaWdodHMgUmVzZXJ2ZWQuIEFwYWNoZSBTb2Z0d2FyZSBMaWNlbnNlIDIuMAogKiAKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqLwooZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkgewoJaWYodHJ1ZSkKCQltb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTsKCWVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKQoJCWRlZmluZSgiRnVzZSIsIFtdLCBmYWN0b3J5KTsKCWVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKQoJCWV4cG9ydHNbIkZ1c2UiXSA9IGZhY3RvcnkoKTsKCWVsc2UKCQlyb290WyJGdXNlIl0gPSBmYWN0b3J5KCk7Cn0pKHRoaXMsIGZ1bmN0aW9uKCkgewpyZXR1cm4gLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcAovKioqKioqLyAJLy8gVGhlIG1vZHVsZSBjYWNoZQovKioqKioqLyAJdmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTsKLyoqKioqKi8KLyoqKioqKi8gCS8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uCi8qKioqKiovIAlmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7Ci8qKioqKiovCi8qKioqKiovIAkJLy8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlCi8qKioqKiovIAkJaWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHsKLyoqKioqKi8gCQkJcmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7Ci8qKioqKiovIAkJfQovKioqKioqLyAJCS8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpCi8qKioqKiovIAkJdmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0gewovKioqKioqLyAJCQlpOiBtb2R1bGVJZCwKLyoqKioqKi8gCQkJbDogZmFsc2UsCi8qKioqKiovIAkJCWV4cG9ydHM6IHt9Ci8qKioqKiovIAkJfTsKLyoqKioqKi8KLyoqKioqKi8gCQkvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb24KLyoqKioqKi8gCQltb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTsKLyoqKioqKi8KLyoqKioqKi8gCQkvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkCi8qKioqKiovIAkJbW9kdWxlLmwgPSB0cnVlOwovKioqKioqLwovKioqKioqLyAJCS8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlCi8qKioqKiovIAkJcmV0dXJuIG1vZHVsZS5leHBvcnRzOwovKioqKioqLyAJfQovKioqKioqLwovKioqKioqLwovKioqKioqLyAJLy8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXykKLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7Ci8qKioqKiovCi8qKioqKiovIAkvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZQovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlczsKLyoqKioqKi8KLyoqKioqKi8gCS8vIGlkZW50aXR5IGZ1bmN0aW9uIGZvciBjYWxsaW5nIGhhcm1vbnkgaW1wb3J0cyB3aXRoIHRoZSBjb3JyZWN0IGNvbnRleHQKLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18uaSA9IGZ1bmN0aW9uKHZhbHVlKSB7IHJldHVybiB2YWx1ZTsgfTsKLyoqKioqKi8KLyoqKioqKi8gCS8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0cwovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7Ci8qKioqKiovIAkJaWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkgewovKioqKioqLyAJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgewovKioqKioqLyAJCQkJY29uZmlndXJhYmxlOiBmYWxzZSwKLyoqKioqKi8gCQkJCWVudW1lcmFibGU6IHRydWUsCi8qKioqKiovIAkJCQlnZXQ6IGdldHRlcgovKioqKioqLyAJCQl9KTsKLyoqKioqKi8gCQl9Ci8qKioqKiovIAl9OwovKioqKioqLwovKioqKioqLyAJLy8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXMKLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkgewovKioqKioqLyAJCXZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgPwovKioqKioqLyAJCQlmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOgovKioqKioqLyAJCQlmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9OwovKioqKioqLyAJCV9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTsKLyoqKioqKi8gCQlyZXR1cm4gZ2V0dGVyOwovKioqKioqLyAJfTsKLyoqKioqKi8KLyoqKioqKi8gCS8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbAovKioqKioqLyAJX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9OwovKioqKioqLwovKioqKioqLyAJLy8gX193ZWJwYWNrX3B1YmxpY19wYXRoX18KLyoqKioqKi8gCV9fd2VicGFja19yZXF1aXJlX18ucCA9ICIiOwovKioqKioqLwovKioqKioqLyAJLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzCi8qKioqKiovIAlyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSA4KTsKLyoqKioqKi8gfSkKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyoqKioqKi8gKFsKLyogMCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CgoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqKSB7CiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBBcnJheV0nOwp9OwoKLyoqKi8gfSksCi8qIDEgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwoKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9Cgp2YXIgYml0YXBSZWdleFNlYXJjaCA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CnZhciBiaXRhcFNlYXJjaCA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7CnZhciBwYXR0ZXJuQWxwaGFiZXQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpOwoKdmFyIEJpdGFwID0gZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEJpdGFwKHBhdHRlcm4sIF9yZWYpIHsKICAgIHZhciBfcmVmJGxvY2F0aW9uID0gX3JlZi5sb2NhdGlvbiwKICAgICAgICBsb2NhdGlvbiA9IF9yZWYkbG9jYXRpb24gPT09IHVuZGVmaW5lZCA/IDAgOiBfcmVmJGxvY2F0aW9uLAogICAgICAgIF9yZWYkZGlzdGFuY2UgPSBfcmVmLmRpc3RhbmNlLAogICAgICAgIGRpc3RhbmNlID0gX3JlZiRkaXN0YW5jZSA9PT0gdW5kZWZpbmVkID8gMTAwIDogX3JlZiRkaXN0YW5jZSwKICAgICAgICBfcmVmJHRocmVzaG9sZCA9IF9yZWYudGhyZXNob2xkLAogICAgICAgIHRocmVzaG9sZCA9IF9yZWYkdGhyZXNob2xkID09PSB1bmRlZmluZWQgPyAwLjYgOiBfcmVmJHRocmVzaG9sZCwKICAgICAgICBfcmVmJG1heFBhdHRlcm5MZW5ndGggPSBfcmVmLm1heFBhdHRlcm5MZW5ndGgsCiAgICAgICAgbWF4UGF0dGVybkxlbmd0aCA9IF9yZWYkbWF4UGF0dGVybkxlbmd0aCA9PT0gdW5kZWZpbmVkID8gMzIgOiBfcmVmJG1heFBhdHRlcm5MZW5ndGgsCiAgICAgICAgX3JlZiRpc0Nhc2VTZW5zaXRpdmUgPSBfcmVmLmlzQ2FzZVNlbnNpdGl2ZSwKICAgICAgICBpc0Nhc2VTZW5zaXRpdmUgPSBfcmVmJGlzQ2FzZVNlbnNpdGl2ZSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBfcmVmJGlzQ2FzZVNlbnNpdGl2ZSwKICAgICAgICBfcmVmJHRva2VuU2VwYXJhdG9yID0gX3JlZi50b2tlblNlcGFyYXRvciwKICAgICAgICB0b2tlblNlcGFyYXRvciA9IF9yZWYkdG9rZW5TZXBhcmF0b3IgPT09IHVuZGVmaW5lZCA/IC8gKy9nIDogX3JlZiR0b2tlblNlcGFyYXRvciwKICAgICAgICBfcmVmJGZpbmRBbGxNYXRjaGVzID0gX3JlZi5maW5kQWxsTWF0Y2hlcywKICAgICAgICBmaW5kQWxsTWF0Y2hlcyA9IF9yZWYkZmluZEFsbE1hdGNoZXMgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiRmaW5kQWxsTWF0Y2hlcywKICAgICAgICBfcmVmJG1pbk1hdGNoQ2hhckxlbmcgPSBfcmVmLm1pbk1hdGNoQ2hhckxlbmd0aCwKICAgICAgICBtaW5NYXRjaENoYXJMZW5ndGggPSBfcmVmJG1pbk1hdGNoQ2hhckxlbmcgPT09IHVuZGVmaW5lZCA/IDEgOiBfcmVmJG1pbk1hdGNoQ2hhckxlbmc7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEJpdGFwKTsKCiAgICB0aGlzLm9wdGlvbnMgPSB7CiAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlLAogICAgICB0aHJlc2hvbGQ6IHRocmVzaG9sZCwKICAgICAgbWF4UGF0dGVybkxlbmd0aDogbWF4UGF0dGVybkxlbmd0aCwKICAgICAgaXNDYXNlU2Vuc2l0aXZlOiBpc0Nhc2VTZW5zaXRpdmUsCiAgICAgIHRva2VuU2VwYXJhdG9yOiB0b2tlblNlcGFyYXRvciwKICAgICAgZmluZEFsbE1hdGNoZXM6IGZpbmRBbGxNYXRjaGVzLAogICAgICBtaW5NYXRjaENoYXJMZW5ndGg6IG1pbk1hdGNoQ2hhckxlbmd0aAogICAgfTsKCiAgICB0aGlzLnBhdHRlcm4gPSB0aGlzLm9wdGlvbnMuaXNDYXNlU2Vuc2l0aXZlID8gcGF0dGVybiA6IHBhdHRlcm4udG9Mb3dlckNhc2UoKTsKCiAgICBpZiAodGhpcy5wYXR0ZXJuLmxlbmd0aCA8PSBtYXhQYXR0ZXJuTGVuZ3RoKSB7CiAgICAgIHRoaXMucGF0dGVybkFscGhhYmV0ID0gcGF0dGVybkFscGhhYmV0KHRoaXMucGF0dGVybik7CiAgICB9CiAgfQoKICBfY3JlYXRlQ2xhc3MoQml0YXAsIFt7CiAgICBrZXk6ICdzZWFyY2gnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNlYXJjaCh0ZXh0KSB7CiAgICAgIGlmICghdGhpcy5vcHRpb25zLmlzQ2FzZVNlbnNpdGl2ZSkgewogICAgICAgIHRleHQgPSB0ZXh0LnRvTG93ZXJDYXNlKCk7CiAgICAgIH0KCiAgICAgIC8vIEV4YWN0IG1hdGNoCiAgICAgIGlmICh0aGlzLnBhdHRlcm4gPT09IHRleHQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaXNNYXRjaDogdHJ1ZSwKICAgICAgICAgIHNjb3JlOiAwLAogICAgICAgICAgbWF0Y2hlZEluZGljZXM6IFtbMCwgdGV4dC5sZW5ndGggLSAxXV0KICAgICAgICB9OwogICAgICB9CgogICAgICAvLyBXaGVuIHBhdHRlcm4gbGVuZ3RoIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWFjaGluZSB3b3JkIGxlbmd0aCwganVzdCBkbyBhIGEgcmVnZXggY29tcGFyaXNvbgogICAgICB2YXIgX29wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICBtYXhQYXR0ZXJuTGVuZ3RoID0gX29wdGlvbnMubWF4UGF0dGVybkxlbmd0aCwKICAgICAgICAgIHRva2VuU2VwYXJhdG9yID0gX29wdGlvbnMudG9rZW5TZXBhcmF0b3I7CgogICAgICBpZiAodGhpcy5wYXR0ZXJuLmxlbmd0aCA+IG1heFBhdHRlcm5MZW5ndGgpIHsKICAgICAgICByZXR1cm4gYml0YXBSZWdleFNlYXJjaCh0ZXh0LCB0aGlzLnBhdHRlcm4sIHRva2VuU2VwYXJhdG9yKTsKICAgICAgfQoKICAgICAgLy8gT3RoZXJ3aXNlLCB1c2UgQml0YXAgYWxnb3JpdGhtCiAgICAgIHZhciBfb3B0aW9uczIgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICBsb2NhdGlvbiA9IF9vcHRpb25zMi5sb2NhdGlvbiwKICAgICAgICAgIGRpc3RhbmNlID0gX29wdGlvbnMyLmRpc3RhbmNlLAogICAgICAgICAgdGhyZXNob2xkID0gX29wdGlvbnMyLnRocmVzaG9sZCwKICAgICAgICAgIGZpbmRBbGxNYXRjaGVzID0gX29wdGlvbnMyLmZpbmRBbGxNYXRjaGVzLAogICAgICAgICAgbWluTWF0Y2hDaGFyTGVuZ3RoID0gX29wdGlvbnMyLm1pbk1hdGNoQ2hhckxlbmd0aDsKCiAgICAgIHJldHVybiBiaXRhcFNlYXJjaCh0ZXh0LCB0aGlzLnBhdHRlcm4sIHRoaXMucGF0dGVybkFscGhhYmV0LCB7CiAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uLAogICAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZSwKICAgICAgICB0aHJlc2hvbGQ6IHRocmVzaG9sZCwKICAgICAgICBmaW5kQWxsTWF0Y2hlczogZmluZEFsbE1hdGNoZXMsCiAgICAgICAgbWluTWF0Y2hDaGFyTGVuZ3RoOiBtaW5NYXRjaENoYXJMZW5ndGgKICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gQml0YXA7Cn0oKTsKCi8vIGxldCB4ID0gbmV3IEJpdGFwKCJvZCBtbiB3YXIiLCB7fSkKLy8gbGV0IHJlc3VsdCA9IHguc2VhcmNoKCJPbGQgTWFuJ3MgV2FyIikKLy8gY29uc29sZS5sb2cocmVzdWx0KQoKbW9kdWxlLmV4cG9ydHMgPSBCaXRhcDsKCi8qKiovIH0pLAovKiAyICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKCgp2YXIgaXNBcnJheSA9IF9fd2VicGFja19yZXF1aXJlX18oMCk7Cgp2YXIgZGVlcFZhbHVlID0gZnVuY3Rpb24gZGVlcFZhbHVlKG9iaiwgcGF0aCwgbGlzdCkgewogIGlmICghcGF0aCkgewogICAgLy8gSWYgdGhlcmUncyBubyBwYXRoIGxlZnQsIHdlJ3ZlIGdvdHRlbiB0byB0aGUgb2JqZWN0IHdlIGNhcmUgYWJvdXQuCiAgICBsaXN0LnB1c2gob2JqKTsKICB9IGVsc2UgewogICAgdmFyIGRvdEluZGV4ID0gcGF0aC5pbmRleE9mKCcuJyk7CiAgICB2YXIgZmlyc3RTZWdtZW50ID0gcGF0aDsKICAgIHZhciByZW1haW5pbmcgPSBudWxsOwoKICAgIGlmIChkb3RJbmRleCAhPT0gLTEpIHsKICAgICAgZmlyc3RTZWdtZW50ID0gcGF0aC5zbGljZSgwLCBkb3RJbmRleCk7CiAgICAgIHJlbWFpbmluZyA9IHBhdGguc2xpY2UoZG90SW5kZXggKyAxKTsKICAgIH0KCiAgICB2YXIgdmFsdWUgPSBvYmpbZmlyc3RTZWdtZW50XTsKCiAgICBpZiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICBpZiAoIXJlbWFpbmluZyAmJiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSkgewogICAgICAgIGxpc3QucHVzaCh2YWx1ZS50b1N0cmluZygpKTsKICAgICAgfSBlbHNlIGlmIChpc0FycmF5KHZhbHVlKSkgewogICAgICAgIC8vIFNlYXJjaCBlYWNoIGl0ZW0gaW4gdGhlIGFycmF5LgogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB2YWx1ZS5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkgewogICAgICAgICAgZGVlcFZhbHVlKHZhbHVlW2ldLCByZW1haW5pbmcsIGxpc3QpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChyZW1haW5pbmcpIHsKICAgICAgICAvLyBBbiBvYmplY3QuIFJlY3Vyc2UgZnVydGhlci4KICAgICAgICBkZWVwVmFsdWUodmFsdWUsIHJlbWFpbmluZywgbGlzdCk7CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiBsaXN0Owp9OwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqLCBwYXRoKSB7CiAgcmV0dXJuIGRlZXBWYWx1ZShvYmosIHBhdGgsIFtdKTsKfTsKCi8qKiovIH0pLAovKiAzICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKCgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHsKICB2YXIgbWF0Y2htYXNrID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTsKICB2YXIgbWluTWF0Y2hDaGFyTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAxOwoKICB2YXIgbWF0Y2hlZEluZGljZXMgPSBbXTsKICB2YXIgc3RhcnQgPSAtMTsKICB2YXIgZW5kID0gLTE7CiAgdmFyIGkgPSAwOwoKICBmb3IgKHZhciBsZW4gPSBtYXRjaG1hc2subGVuZ3RoOyBpIDwgbGVuOyBpICs9IDEpIHsKICAgIHZhciBtYXRjaCA9IG1hdGNobWFza1tpXTsKICAgIGlmIChtYXRjaCAmJiBzdGFydCA9PT0gLTEpIHsKICAgICAgc3RhcnQgPSBpOwogICAgfSBlbHNlIGlmICghbWF0Y2ggJiYgc3RhcnQgIT09IC0xKSB7CiAgICAgIGVuZCA9IGkgLSAxOwogICAgICBpZiAoZW5kIC0gc3RhcnQgKyAxID49IG1pbk1hdGNoQ2hhckxlbmd0aCkgewogICAgICAgIG1hdGNoZWRJbmRpY2VzLnB1c2goW3N0YXJ0LCBlbmRdKTsKICAgICAgfQogICAgICBzdGFydCA9IC0xOwogICAgfQogIH0KCiAgLy8gKGktMSAtIHN0YXJ0KSArIDEgPT4gaSAtIHN0YXJ0CiAgaWYgKG1hdGNobWFza1tpIC0gMV0gJiYgaSAtIHN0YXJ0ID49IG1pbk1hdGNoQ2hhckxlbmd0aCkgewogICAgbWF0Y2hlZEluZGljZXMucHVzaChbc3RhcnQsIGkgLSAxXSk7CiAgfQoKICByZXR1cm4gbWF0Y2hlZEluZGljZXM7Cn07CgovKioqLyB9KSwKLyogNCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CgoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAocGF0dGVybikgewogIHZhciBtYXNrID0ge307CiAgdmFyIGxlbiA9IHBhdHRlcm4ubGVuZ3RoOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSArPSAxKSB7CiAgICBtYXNrW3BhdHRlcm4uY2hhckF0KGkpXSA9IDA7CiAgfQoKICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgbGVuOyBfaSArPSAxKSB7CiAgICBtYXNrW3BhdHRlcm4uY2hhckF0KF9pKV0gfD0gMSA8PCBsZW4gLSBfaSAtIDE7CiAgfQoKICByZXR1cm4gbWFzazsKfTsKCi8qKiovIH0pLAovKiA1ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKCgp2YXIgU1BFQ0lBTF9DSEFSU19SRUdFWCA9IC9bXC1cW1xdXC9ce1x9XChcKVwqXCtcP1wuXFxcXlwkXHxdL2c7Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICh0ZXh0LCBwYXR0ZXJuKSB7CiAgdmFyIHRva2VuU2VwYXJhdG9yID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAvICsvZzsKCiAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cChwYXR0ZXJuLnJlcGxhY2UoU1BFQ0lBTF9DSEFSU19SRUdFWCwgJ1xcJCYnKS5yZXBsYWNlKHRva2VuU2VwYXJhdG9yLCAnfCcpKTsKICB2YXIgbWF0Y2hlcyA9IHRleHQubWF0Y2gocmVnZXgpOwogIHZhciBpc01hdGNoID0gISFtYXRjaGVzOwogIHZhciBtYXRjaGVkSW5kaWNlcyA9IFtdOwoKICBpZiAoaXNNYXRjaCkgewogICAgZm9yICh2YXIgaSA9IDAsIG1hdGNoZXNMZW4gPSBtYXRjaGVzLmxlbmd0aDsgaSA8IG1hdGNoZXNMZW47IGkgKz0gMSkgewogICAgICB2YXIgbWF0Y2ggPSBtYXRjaGVzW2ldOwogICAgICBtYXRjaGVkSW5kaWNlcy5wdXNoKFt0ZXh0LmluZGV4T2YobWF0Y2gpLCBtYXRjaC5sZW5ndGggLSAxXSk7CiAgICB9CiAgfQoKICByZXR1cm4gewogICAgLy8gVE9ETzogcmV2aXNpdCB0aGlzIHNjb3JlCiAgICBzY29yZTogaXNNYXRjaCA/IDAuNSA6IDEsCiAgICBpc01hdGNoOiBpc01hdGNoLAogICAgbWF0Y2hlZEluZGljZXM6IG1hdGNoZWRJbmRpY2VzCiAgfTsKfTsKCi8qKiovIH0pLAovKiA2ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKCgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChwYXR0ZXJuLCBfcmVmKSB7CiAgdmFyIF9yZWYkZXJyb3JzID0gX3JlZi5lcnJvcnMsCiAgICAgIGVycm9ycyA9IF9yZWYkZXJyb3JzID09PSB1bmRlZmluZWQgPyAwIDogX3JlZiRlcnJvcnMsCiAgICAgIF9yZWYkY3VycmVudExvY2F0aW9uID0gX3JlZi5jdXJyZW50TG9jYXRpb24sCiAgICAgIGN1cnJlbnRMb2NhdGlvbiA9IF9yZWYkY3VycmVudExvY2F0aW9uID09PSB1bmRlZmluZWQgPyAwIDogX3JlZiRjdXJyZW50TG9jYXRpb24sCiAgICAgIF9yZWYkZXhwZWN0ZWRMb2NhdGlvbiA9IF9yZWYuZXhwZWN0ZWRMb2NhdGlvbiwKICAgICAgZXhwZWN0ZWRMb2NhdGlvbiA9IF9yZWYkZXhwZWN0ZWRMb2NhdGlvbiA9PT0gdW5kZWZpbmVkID8gMCA6IF9yZWYkZXhwZWN0ZWRMb2NhdGlvbiwKICAgICAgX3JlZiRkaXN0YW5jZSA9IF9yZWYuZGlzdGFuY2UsCiAgICAgIGRpc3RhbmNlID0gX3JlZiRkaXN0YW5jZSA9PT0gdW5kZWZpbmVkID8gMTAwIDogX3JlZiRkaXN0YW5jZTsKCiAgdmFyIGFjY3VyYWN5ID0gZXJyb3JzIC8gcGF0dGVybi5sZW5ndGg7CiAgdmFyIHByb3hpbWl0eSA9IE1hdGguYWJzKGV4cGVjdGVkTG9jYXRpb24gLSBjdXJyZW50TG9jYXRpb24pOwoKICBpZiAoIWRpc3RhbmNlKSB7CiAgICAvLyBEb2RnZSBkaXZpZGUgYnkgemVybyBlcnJvci4KICAgIHJldHVybiBwcm94aW1pdHkgPyAxLjAgOiBhY2N1cmFjeTsKICB9CgogIHJldHVybiBhY2N1cmFjeSArIHByb3hpbWl0eSAvIGRpc3RhbmNlOwp9OwoKLyoqKi8gfSksCi8qIDcgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwoKCnZhciBiaXRhcFNjb3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKdmFyIG1hdGNoZWRJbmRpY2VzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHRleHQsIHBhdHRlcm4sIHBhdHRlcm5BbHBoYWJldCwgX3JlZikgewogIHZhciBfcmVmJGxvY2F0aW9uID0gX3JlZi5sb2NhdGlvbiwKICAgICAgbG9jYXRpb24gPSBfcmVmJGxvY2F0aW9uID09PSB1bmRlZmluZWQgPyAwIDogX3JlZiRsb2NhdGlvbiwKICAgICAgX3JlZiRkaXN0YW5jZSA9IF9yZWYuZGlzdGFuY2UsCiAgICAgIGRpc3RhbmNlID0gX3JlZiRkaXN0YW5jZSA9PT0gdW5kZWZpbmVkID8gMTAwIDogX3JlZiRkaXN0YW5jZSwKICAgICAgX3JlZiR0aHJlc2hvbGQgPSBfcmVmLnRocmVzaG9sZCwKICAgICAgdGhyZXNob2xkID0gX3JlZiR0aHJlc2hvbGQgPT09IHVuZGVmaW5lZCA/IDAuNiA6IF9yZWYkdGhyZXNob2xkLAogICAgICBfcmVmJGZpbmRBbGxNYXRjaGVzID0gX3JlZi5maW5kQWxsTWF0Y2hlcywKICAgICAgZmluZEFsbE1hdGNoZXMgPSBfcmVmJGZpbmRBbGxNYXRjaGVzID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkZmluZEFsbE1hdGNoZXMsCiAgICAgIF9yZWYkbWluTWF0Y2hDaGFyTGVuZyA9IF9yZWYubWluTWF0Y2hDaGFyTGVuZ3RoLAogICAgICBtaW5NYXRjaENoYXJMZW5ndGggPSBfcmVmJG1pbk1hdGNoQ2hhckxlbmcgPT09IHVuZGVmaW5lZCA/IDEgOiBfcmVmJG1pbk1hdGNoQ2hhckxlbmc7CgogIHZhciBleHBlY3RlZExvY2F0aW9uID0gbG9jYXRpb247CiAgLy8gU2V0IHN0YXJ0aW5nIGxvY2F0aW9uIGF0IGJlZ2lubmluZyB0ZXh0IGFuZCBpbml0aWFsaXplIHRoZSBhbHBoYWJldC4KICB2YXIgdGV4dExlbiA9IHRleHQubGVuZ3RoOwogIC8vIEhpZ2hlc3Qgc2NvcmUgYmV5b25kIHdoaWNoIHdlIGdpdmUgdXAuCiAgdmFyIGN1cnJlbnRUaHJlc2hvbGQgPSB0aHJlc2hvbGQ7CiAgLy8gSXMgdGhlcmUgYSBuZWFyYnkgZXhhY3QgbWF0Y2g/IChzcGVlZHVwKQogIHZhciBiZXN0TG9jYXRpb24gPSB0ZXh0LmluZGV4T2YocGF0dGVybiwgZXhwZWN0ZWRMb2NhdGlvbik7CgogIHZhciBwYXR0ZXJuTGVuID0gcGF0dGVybi5sZW5ndGg7CgogIC8vIGEgbWFzayBvZiB0aGUgbWF0Y2hlcwogIHZhciBtYXRjaE1hc2sgPSBbXTsKICBmb3IgKHZhciBpID0gMDsgaSA8IHRleHRMZW47IGkgKz0gMSkgewogICAgbWF0Y2hNYXNrW2ldID0gMDsKICB9CgogIGlmIChiZXN0TG9jYXRpb24gIT09IC0xKSB7CiAgICB2YXIgc2NvcmUgPSBiaXRhcFNjb3JlKHBhdHRlcm4sIHsKICAgICAgZXJyb3JzOiAwLAogICAgICBjdXJyZW50TG9jYXRpb246IGJlc3RMb2NhdGlvbiwKICAgICAgZXhwZWN0ZWRMb2NhdGlvbjogZXhwZWN0ZWRMb2NhdGlvbiwKICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlCiAgICB9KTsKICAgIGN1cnJlbnRUaHJlc2hvbGQgPSBNYXRoLm1pbihzY29yZSwgY3VycmVudFRocmVzaG9sZCk7CgogICAgLy8gV2hhdCBhYm91dCBpbiB0aGUgb3RoZXIgZGlyZWN0aW9uPyAoc3BlZWQgdXApCiAgICBiZXN0TG9jYXRpb24gPSB0ZXh0Lmxhc3RJbmRleE9mKHBhdHRlcm4sIGV4cGVjdGVkTG9jYXRpb24gKyBwYXR0ZXJuTGVuKTsKCiAgICBpZiAoYmVzdExvY2F0aW9uICE9PSAtMSkgewogICAgICB2YXIgX3Njb3JlID0gYml0YXBTY29yZShwYXR0ZXJuLCB7CiAgICAgICAgZXJyb3JzOiAwLAogICAgICAgIGN1cnJlbnRMb2NhdGlvbjogYmVzdExvY2F0aW9uLAogICAgICAgIGV4cGVjdGVkTG9jYXRpb246IGV4cGVjdGVkTG9jYXRpb24sCiAgICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlCiAgICAgIH0pOwogICAgICBjdXJyZW50VGhyZXNob2xkID0gTWF0aC5taW4oX3Njb3JlLCBjdXJyZW50VGhyZXNob2xkKTsKICAgIH0KICB9CgogIC8vIFJlc2V0IHRoZSBiZXN0IGxvY2F0aW9uCiAgYmVzdExvY2F0aW9uID0gLTE7CgogIHZhciBsYXN0Qml0QXJyID0gW107CiAgdmFyIGZpbmFsU2NvcmUgPSAxOwogIHZhciBiaW5NYXggPSBwYXR0ZXJuTGVuICsgdGV4dExlbjsKCiAgdmFyIG1hc2sgPSAxIDw8IHBhdHRlcm5MZW4gLSAxOwoKICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgcGF0dGVybkxlbjsgX2kgKz0gMSkgewogICAgLy8gU2NhbiBmb3IgdGhlIGJlc3QgbWF0Y2g7IGVhY2ggaXRlcmF0aW9uIGFsbG93cyBmb3Igb25lIG1vcmUgZXJyb3IuCiAgICAvLyBSdW4gYSBiaW5hcnkgc2VhcmNoIHRvIGRldGVybWluZSBob3cgZmFyIGZyb20gdGhlIG1hdGNoIGxvY2F0aW9uIHdlIGNhbiBzdHJheQogICAgLy8gYXQgdGhpcyBlcnJvciBsZXZlbC4KICAgIHZhciBiaW5NaW4gPSAwOwogICAgdmFyIGJpbk1pZCA9IGJpbk1heDsKCiAgICB3aGlsZSAoYmluTWluIDwgYmluTWlkKSB7CiAgICAgIHZhciBfc2NvcmUzID0gYml0YXBTY29yZShwYXR0ZXJuLCB7CiAgICAgICAgZXJyb3JzOiBfaSwKICAgICAgICBjdXJyZW50TG9jYXRpb246IGV4cGVjdGVkTG9jYXRpb24gKyBiaW5NaWQsCiAgICAgICAgZXhwZWN0ZWRMb2NhdGlvbjogZXhwZWN0ZWRMb2NhdGlvbiwKICAgICAgICBkaXN0YW5jZTogZGlzdGFuY2UKICAgICAgfSk7CgogICAgICBpZiAoX3Njb3JlMyA8PSBjdXJyZW50VGhyZXNob2xkKSB7CiAgICAgICAgYmluTWluID0gYmluTWlkOwogICAgICB9IGVsc2UgewogICAgICAgIGJpbk1heCA9IGJpbk1pZDsKICAgICAgfQoKICAgICAgYmluTWlkID0gTWF0aC5mbG9vcigoYmluTWF4IC0gYmluTWluKSAvIDIgKyBiaW5NaW4pOwogICAgfQoKICAgIC8vIFVzZSB0aGUgcmVzdWx0IGZyb20gdGhpcyBpdGVyYXRpb24gYXMgdGhlIG1heGltdW0gZm9yIHRoZSBuZXh0LgogICAgYmluTWF4ID0gYmluTWlkOwoKICAgIHZhciBzdGFydCA9IE1hdGgubWF4KDEsIGV4cGVjdGVkTG9jYXRpb24gLSBiaW5NaWQgKyAxKTsKICAgIHZhciBmaW5pc2ggPSBmaW5kQWxsTWF0Y2hlcyA/IHRleHRMZW4gOiBNYXRoLm1pbihleHBlY3RlZExvY2F0aW9uICsgYmluTWlkLCB0ZXh0TGVuKSArIHBhdHRlcm5MZW47CgogICAgLy8gSW5pdGlhbGl6ZSB0aGUgYml0IGFycmF5CiAgICB2YXIgYml0QXJyID0gQXJyYXkoZmluaXNoICsgMik7CgogICAgYml0QXJyW2ZpbmlzaCArIDFdID0gKDEgPDwgX2kpIC0gMTsKCiAgICBmb3IgKHZhciBqID0gZmluaXNoOyBqID49IHN0YXJ0OyBqIC09IDEpIHsKICAgICAgdmFyIGN1cnJlbnRMb2NhdGlvbiA9IGogLSAxOwogICAgICB2YXIgY2hhck1hdGNoID0gcGF0dGVybkFscGhhYmV0W3RleHQuY2hhckF0KGN1cnJlbnRMb2NhdGlvbildOwoKICAgICAgaWYgKGNoYXJNYXRjaCkgewogICAgICAgIG1hdGNoTWFza1tjdXJyZW50TG9jYXRpb25dID0gMTsKICAgICAgfQoKICAgICAgLy8gRmlyc3QgcGFzczogZXhhY3QgbWF0Y2gKICAgICAgYml0QXJyW2pdID0gKGJpdEFycltqICsgMV0gPDwgMSB8IDEpICYgY2hhck1hdGNoOwoKICAgICAgLy8gU3Vic2VxdWVudCBwYXNzZXM6IGZ1enp5IG1hdGNoCiAgICAgIGlmIChfaSAhPT0gMCkgewogICAgICAgIGJpdEFycltqXSB8PSAobGFzdEJpdEFycltqICsgMV0gfCBsYXN0Qml0QXJyW2pdKSA8PCAxIHwgMSB8IGxhc3RCaXRBcnJbaiArIDFdOwogICAgICB9CgogICAgICBpZiAoYml0QXJyW2pdICYgbWFzaykgewogICAgICAgIGZpbmFsU2NvcmUgPSBiaXRhcFNjb3JlKHBhdHRlcm4sIHsKICAgICAgICAgIGVycm9yczogX2ksCiAgICAgICAgICBjdXJyZW50TG9jYXRpb246IGN1cnJlbnRMb2NhdGlvbiwKICAgICAgICAgIGV4cGVjdGVkTG9jYXRpb246IGV4cGVjdGVkTG9jYXRpb24sCiAgICAgICAgICBkaXN0YW5jZTogZGlzdGFuY2UKICAgICAgICB9KTsKCiAgICAgICAgLy8gVGhpcyBtYXRjaCB3aWxsIGFsbW9zdCBjZXJ0YWlubHkgYmUgYmV0dGVyIHRoYW4gYW55IGV4aXN0aW5nIG1hdGNoLgogICAgICAgIC8vIEJ1dCBjaGVjayBhbnl3YXkuCiAgICAgICAgaWYgKGZpbmFsU2NvcmUgPD0gY3VycmVudFRocmVzaG9sZCkgewogICAgICAgICAgLy8gSW5kZWVkIGl0IGlzCiAgICAgICAgICBjdXJyZW50VGhyZXNob2xkID0gZmluYWxTY29yZTsKICAgICAgICAgIGJlc3RMb2NhdGlvbiA9IGN1cnJlbnRMb2NhdGlvbjsKCiAgICAgICAgICAvLyBBbHJlYWR5IHBhc3NlZCBgbG9jYCwgZG93bmhpbGwgZnJvbSBoZXJlIG9uIGluLgogICAgICAgICAgaWYgKGJlc3RMb2NhdGlvbiA8PSBleHBlY3RlZExvY2F0aW9uKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFdoZW4gcGFzc2luZyBgYmVzdExvY2F0aW9uYCwgZG9uJ3QgZXhjZWVkIG91ciBjdXJyZW50IGRpc3RhbmNlIGZyb20gYGV4cGVjdGVkTG9jYXRpb25gLgogICAgICAgICAgc3RhcnQgPSBNYXRoLm1heCgxLCAyICogZXhwZWN0ZWRMb2NhdGlvbiAtIGJlc3RMb2NhdGlvbik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLy8gTm8gaG9wZSBmb3IgYSAoYmV0dGVyKSBtYXRjaCBhdCBncmVhdGVyIGVycm9yIGxldmVscy4KICAgIHZhciBfc2NvcmUyID0gYml0YXBTY29yZShwYXR0ZXJuLCB7CiAgICAgIGVycm9yczogX2kgKyAxLAogICAgICBjdXJyZW50TG9jYXRpb246IGV4cGVjdGVkTG9jYXRpb24sCiAgICAgIGV4cGVjdGVkTG9jYXRpb246IGV4cGVjdGVkTG9jYXRpb24sCiAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZQogICAgfSk7CgogICAgaWYgKF9zY29yZTIgPiBjdXJyZW50VGhyZXNob2xkKSB7CiAgICAgIGJyZWFrOwogICAgfQoKICAgIGxhc3RCaXRBcnIgPSBiaXRBcnI7CiAgfQoKICAvLyBDb3VudCBleGFjdCBtYXRjaGVzICh0aG9zZSB3aXRoIGEgc2NvcmUgb2YgMCkgdG8gYmUgImFsbW9zdCIgZXhhY3QKICByZXR1cm4gewogICAgaXNNYXRjaDogYmVzdExvY2F0aW9uID49IDAsCiAgICBzY29yZTogZmluYWxTY29yZSA9PT0gMCA/IDAuMDAxIDogZmluYWxTY29yZSwKICAgIG1hdGNoZWRJbmRpY2VzOiBtYXRjaGVkSW5kaWNlcyhtYXRjaE1hc2ssIG1pbk1hdGNoQ2hhckxlbmd0aCkKICB9Owp9OwoKLyoqKi8gfSksCi8qIDggKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwoKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9Cgp2YXIgQml0YXAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwp2YXIgZGVlcFZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKTsKdmFyIGlzQXJyYXkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApOwoKdmFyIEZ1c2UgPSBmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gRnVzZShsaXN0LCBfcmVmKSB7CiAgICB2YXIgX3JlZiRsb2NhdGlvbiA9IF9yZWYubG9jYXRpb24sCiAgICAgICAgbG9jYXRpb24gPSBfcmVmJGxvY2F0aW9uID09PSB1bmRlZmluZWQgPyAwIDogX3JlZiRsb2NhdGlvbiwKICAgICAgICBfcmVmJGRpc3RhbmNlID0gX3JlZi5kaXN0YW5jZSwKICAgICAgICBkaXN0YW5jZSA9IF9yZWYkZGlzdGFuY2UgPT09IHVuZGVmaW5lZCA/IDEwMCA6IF9yZWYkZGlzdGFuY2UsCiAgICAgICAgX3JlZiR0aHJlc2hvbGQgPSBfcmVmLnRocmVzaG9sZCwKICAgICAgICB0aHJlc2hvbGQgPSBfcmVmJHRocmVzaG9sZCA9PT0gdW5kZWZpbmVkID8gMC42IDogX3JlZiR0aHJlc2hvbGQsCiAgICAgICAgX3JlZiRtYXhQYXR0ZXJuTGVuZ3RoID0gX3JlZi5tYXhQYXR0ZXJuTGVuZ3RoLAogICAgICAgIG1heFBhdHRlcm5MZW5ndGggPSBfcmVmJG1heFBhdHRlcm5MZW5ndGggPT09IHVuZGVmaW5lZCA/IDMyIDogX3JlZiRtYXhQYXR0ZXJuTGVuZ3RoLAogICAgICAgIF9yZWYkY2FzZVNlbnNpdGl2ZSA9IF9yZWYuY2FzZVNlbnNpdGl2ZSwKICAgICAgICBjYXNlU2Vuc2l0aXZlID0gX3JlZiRjYXNlU2Vuc2l0aXZlID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkY2FzZVNlbnNpdGl2ZSwKICAgICAgICBfcmVmJHRva2VuU2VwYXJhdG9yID0gX3JlZi50b2tlblNlcGFyYXRvciwKICAgICAgICB0b2tlblNlcGFyYXRvciA9IF9yZWYkdG9rZW5TZXBhcmF0b3IgPT09IHVuZGVmaW5lZCA/IC8gKy9nIDogX3JlZiR0b2tlblNlcGFyYXRvciwKICAgICAgICBfcmVmJGZpbmRBbGxNYXRjaGVzID0gX3JlZi5maW5kQWxsTWF0Y2hlcywKICAgICAgICBmaW5kQWxsTWF0Y2hlcyA9IF9yZWYkZmluZEFsbE1hdGNoZXMgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiRmaW5kQWxsTWF0Y2hlcywKICAgICAgICBfcmVmJG1pbk1hdGNoQ2hhckxlbmcgPSBfcmVmLm1pbk1hdGNoQ2hhckxlbmd0aCwKICAgICAgICBtaW5NYXRjaENoYXJMZW5ndGggPSBfcmVmJG1pbk1hdGNoQ2hhckxlbmcgPT09IHVuZGVmaW5lZCA/IDEgOiBfcmVmJG1pbk1hdGNoQ2hhckxlbmcsCiAgICAgICAgX3JlZiRpZCA9IF9yZWYuaWQsCiAgICAgICAgaWQgPSBfcmVmJGlkID09PSB1bmRlZmluZWQgPyBudWxsIDogX3JlZiRpZCwKICAgICAgICBfcmVmJGtleXMgPSBfcmVmLmtleXMsCiAgICAgICAga2V5cyA9IF9yZWYka2V5cyA9PT0gdW5kZWZpbmVkID8gW10gOiBfcmVmJGtleXMsCiAgICAgICAgX3JlZiRzaG91bGRTb3J0ID0gX3JlZi5zaG91bGRTb3J0LAogICAgICAgIHNob3VsZFNvcnQgPSBfcmVmJHNob3VsZFNvcnQgPT09IHVuZGVmaW5lZCA/IHRydWUgOiBfcmVmJHNob3VsZFNvcnQsCiAgICAgICAgX3JlZiRnZXRGbiA9IF9yZWYuZ2V0Rm4sCiAgICAgICAgZ2V0Rm4gPSBfcmVmJGdldEZuID09PSB1bmRlZmluZWQgPyBkZWVwVmFsdWUgOiBfcmVmJGdldEZuLAogICAgICAgIF9yZWYkc29ydEZuID0gX3JlZi5zb3J0Rm4sCiAgICAgICAgc29ydEZuID0gX3JlZiRzb3J0Rm4gPT09IHVuZGVmaW5lZCA/IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgIHJldHVybiBhLnNjb3JlIC0gYi5zY29yZTsKICAgIH0gOiBfcmVmJHNvcnRGbiwKICAgICAgICBfcmVmJHRva2VuaXplID0gX3JlZi50b2tlbml6ZSwKICAgICAgICB0b2tlbml6ZSA9IF9yZWYkdG9rZW5pemUgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiR0b2tlbml6ZSwKICAgICAgICBfcmVmJG1hdGNoQWxsVG9rZW5zID0gX3JlZi5tYXRjaEFsbFRva2VucywKICAgICAgICBtYXRjaEFsbFRva2VucyA9IF9yZWYkbWF0Y2hBbGxUb2tlbnMgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiRtYXRjaEFsbFRva2VucywKICAgICAgICBfcmVmJGluY2x1ZGVNYXRjaGVzID0gX3JlZi5pbmNsdWRlTWF0Y2hlcywKICAgICAgICBpbmNsdWRlTWF0Y2hlcyA9IF9yZWYkaW5jbHVkZU1hdGNoZXMgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogX3JlZiRpbmNsdWRlTWF0Y2hlcywKICAgICAgICBfcmVmJGluY2x1ZGVTY29yZSA9IF9yZWYuaW5jbHVkZVNjb3JlLAogICAgICAgIGluY2x1ZGVTY29yZSA9IF9yZWYkaW5jbHVkZVNjb3JlID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkaW5jbHVkZVNjb3JlLAogICAgICAgIF9yZWYkdmVyYm9zZSA9IF9yZWYudmVyYm9zZSwKICAgICAgICB2ZXJib3NlID0gX3JlZiR2ZXJib3NlID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IF9yZWYkdmVyYm9zZTsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRnVzZSk7CgogICAgdGhpcy5vcHRpb25zID0gewogICAgICBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZSwKICAgICAgdGhyZXNob2xkOiB0aHJlc2hvbGQsCiAgICAgIG1heFBhdHRlcm5MZW5ndGg6IG1heFBhdHRlcm5MZW5ndGgsCiAgICAgIGlzQ2FzZVNlbnNpdGl2ZTogY2FzZVNlbnNpdGl2ZSwKICAgICAgdG9rZW5TZXBhcmF0b3I6IHRva2VuU2VwYXJhdG9yLAogICAgICBmaW5kQWxsTWF0Y2hlczogZmluZEFsbE1hdGNoZXMsCiAgICAgIG1pbk1hdGNoQ2hhckxlbmd0aDogbWluTWF0Y2hDaGFyTGVuZ3RoLAogICAgICBpZDogaWQsCiAgICAgIGtleXM6IGtleXMsCiAgICAgIGluY2x1ZGVNYXRjaGVzOiBpbmNsdWRlTWF0Y2hlcywKICAgICAgaW5jbHVkZVNjb3JlOiBpbmNsdWRlU2NvcmUsCiAgICAgIHNob3VsZFNvcnQ6IHNob3VsZFNvcnQsCiAgICAgIGdldEZuOiBnZXRGbiwKICAgICAgc29ydEZuOiBzb3J0Rm4sCiAgICAgIHZlcmJvc2U6IHZlcmJvc2UsCiAgICAgIHRva2VuaXplOiB0b2tlbml6ZSwKICAgICAgbWF0Y2hBbGxUb2tlbnM6IG1hdGNoQWxsVG9rZW5zCiAgICB9OwoKICAgIHRoaXMuc2V0Q29sbGVjdGlvbihsaXN0KTsKICB9CgogIF9jcmVhdGVDbGFzcyhGdXNlLCBbewogICAga2V5OiAnc2V0Q29sbGVjdGlvbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q29sbGVjdGlvbihsaXN0KSB7CiAgICAgIHRoaXMubGlzdCA9IGxpc3Q7CiAgICAgIHJldHVybiBsaXN0OwogICAgfQogIH0sIHsKICAgIGtleTogJ3NlYXJjaCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VhcmNoKHBhdHRlcm4pIHsKICAgICAgdGhpcy5fbG9nKCctLS0tLS0tLS1cblNlYXJjaCBwYXR0ZXJuOiAiJyArIHBhdHRlcm4gKyAnIicpOwoKICAgICAgdmFyIF9wcmVwYXJlU2VhcmNoZXJzMiA9IHRoaXMuX3ByZXBhcmVTZWFyY2hlcnMocGF0dGVybiksCiAgICAgICAgICB0b2tlblNlYXJjaGVycyA9IF9wcmVwYXJlU2VhcmNoZXJzMi50b2tlblNlYXJjaGVycywKICAgICAgICAgIGZ1bGxTZWFyY2hlciA9IF9wcmVwYXJlU2VhcmNoZXJzMi5mdWxsU2VhcmNoZXI7CgogICAgICB2YXIgX3NlYXJjaDIgPSB0aGlzLl9zZWFyY2godG9rZW5TZWFyY2hlcnMsIGZ1bGxTZWFyY2hlciksCiAgICAgICAgICB3ZWlnaHRzID0gX3NlYXJjaDIud2VpZ2h0cywKICAgICAgICAgIHJlc3VsdHMgPSBfc2VhcmNoMi5yZXN1bHRzOwoKICAgICAgdGhpcy5fY29tcHV0ZVNjb3JlKHdlaWdodHMsIHJlc3VsdHMpOwoKICAgICAgaWYgKHRoaXMub3B0aW9ucy5zaG91bGRTb3J0KSB7CiAgICAgICAgdGhpcy5fc29ydChyZXN1bHRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuX2Zvcm1hdChyZXN1bHRzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfcHJlcGFyZVNlYXJjaGVycycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3ByZXBhcmVTZWFyY2hlcnMoKSB7CiAgICAgIHZhciBwYXR0ZXJuID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAnJzsKCiAgICAgIHZhciB0b2tlblNlYXJjaGVycyA9IFtdOwoKICAgICAgaWYgKHRoaXMub3B0aW9ucy50b2tlbml6ZSkgewogICAgICAgIC8vIFRva2VuaXplIG9uIHRoZSBzZXBhcmF0b3IKICAgICAgICB2YXIgdG9rZW5zID0gcGF0dGVybi5zcGxpdCh0aGlzLm9wdGlvbnMudG9rZW5TZXBhcmF0b3IpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0b2tlbnMubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDEpIHsKICAgICAgICAgIHRva2VuU2VhcmNoZXJzLnB1c2gobmV3IEJpdGFwKHRva2Vuc1tpXSwgdGhpcy5vcHRpb25zKSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgZnVsbFNlYXJjaGVyID0gbmV3IEJpdGFwKHBhdHRlcm4sIHRoaXMub3B0aW9ucyk7CgogICAgICByZXR1cm4geyB0b2tlblNlYXJjaGVyczogdG9rZW5TZWFyY2hlcnMsIGZ1bGxTZWFyY2hlcjogZnVsbFNlYXJjaGVyIH07CiAgICB9CiAgfSwgewogICAga2V5OiAnX3NlYXJjaCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NlYXJjaCgpIHsKICAgICAgdmFyIHRva2VuU2VhcmNoZXJzID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTsKICAgICAgdmFyIGZ1bGxTZWFyY2hlciA9IGFyZ3VtZW50c1sxXTsKCiAgICAgIHZhciBsaXN0ID0gdGhpcy5saXN0OwogICAgICB2YXIgcmVzdWx0TWFwID0ge307CiAgICAgIHZhciByZXN1bHRzID0gW107CgogICAgICAvLyBDaGVjayB0aGUgZmlyc3QgaXRlbSBpbiB0aGUgbGlzdCwgaWYgaXQncyBhIHN0cmluZywgdGhlbiB3ZSBhc3N1bWUKICAgICAgLy8gdGhhdCBldmVyeSBpdGVtIGluIHRoZSBsaXN0IGlzIGFsc28gYSBzdHJpbmcsIGFuZCB0aHVzIGl0J3MgYSBmbGF0dGVuZWQgYXJyYXkuCiAgICAgIGlmICh0eXBlb2YgbGlzdFswXSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAvLyBJdGVyYXRlIG92ZXIgZXZlcnkgaXRlbQogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBsaXN0Lmxlbmd0aDsgaSA8IGxlbjsgaSArPSAxKSB7CiAgICAgICAgICB0aGlzLl9hbmFseXplKHsKICAgICAgICAgICAga2V5OiAnJywKICAgICAgICAgICAgdmFsdWU6IGxpc3RbaV0sCiAgICAgICAgICAgIHJlY29yZDogaSwKICAgICAgICAgICAgaW5kZXg6IGkKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgcmVzdWx0TWFwOiByZXN1bHRNYXAsCiAgICAgICAgICAgIHJlc3VsdHM6IHJlc3VsdHMsCiAgICAgICAgICAgIHRva2VuU2VhcmNoZXJzOiB0b2tlblNlYXJjaGVycywKICAgICAgICAgICAgZnVsbFNlYXJjaGVyOiBmdWxsU2VhcmNoZXIKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgd2VpZ2h0czogbnVsbCwgcmVzdWx0czogcmVzdWx0cyB9OwogICAgICB9CgogICAgICAvLyBPdGhlcndpc2UsIHRoZSBmaXJzdCBpdGVtIGlzIGFuIE9iamVjdCAoaG9wZWZ1bGx5KSwgYW5kIHRodXMgdGhlIHNlYXJjaGluZwogICAgICAvLyBpcyBkb25lIG9uIHRoZSB2YWx1ZXMgb2YgdGhlIGtleXMgb2YgZWFjaCBpdGVtLgogICAgICB2YXIgd2VpZ2h0cyA9IHt9OwogICAgICBmb3IgKHZhciBfaSA9IDAsIF9sZW4gPSBsaXN0Lmxlbmd0aDsgX2kgPCBfbGVuOyBfaSArPSAxKSB7CiAgICAgICAgdmFyIGl0ZW0gPSBsaXN0W19pXTsKICAgICAgICAvLyBJdGVyYXRlIG92ZXIgZXZlcnkga2V5CiAgICAgICAgZm9yICh2YXIgaiA9IDAsIGtleXNMZW4gPSB0aGlzLm9wdGlvbnMua2V5cy5sZW5ndGg7IGogPCBrZXlzTGVuOyBqICs9IDEpIHsKICAgICAgICAgIHZhciBrZXkgPSB0aGlzLm9wdGlvbnMua2V5c1tqXTsKICAgICAgICAgIGlmICh0eXBlb2Yga2V5ICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICB3ZWlnaHRzW2tleS5uYW1lXSA9IHsKICAgICAgICAgICAgICB3ZWlnaHQ6IDEgLSBrZXkud2VpZ2h0IHx8IDEKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKGtleS53ZWlnaHQgPD0gMCB8fCBrZXkud2VpZ2h0ID4gMSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignS2V5IHdlaWdodCBoYXMgdG8gYmUgPiAwIGFuZCA8PSAxJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAga2V5ID0ga2V5Lm5hbWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3ZWlnaHRzW2tleV0gPSB7CiAgICAgICAgICAgICAgd2VpZ2h0OiAxCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5fYW5hbHl6ZSh7CiAgICAgICAgICAgIGtleToga2V5LAogICAgICAgICAgICB2YWx1ZTogdGhpcy5vcHRpb25zLmdldEZuKGl0ZW0sIGtleSksCiAgICAgICAgICAgIHJlY29yZDogaXRlbSwKICAgICAgICAgICAgaW5kZXg6IF9pCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIHJlc3VsdE1hcDogcmVzdWx0TWFwLAogICAgICAgICAgICByZXN1bHRzOiByZXN1bHRzLAogICAgICAgICAgICB0b2tlblNlYXJjaGVyczogdG9rZW5TZWFyY2hlcnMsCiAgICAgICAgICAgIGZ1bGxTZWFyY2hlcjogZnVsbFNlYXJjaGVyCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB7IHdlaWdodHM6IHdlaWdodHMsIHJlc3VsdHM6IHJlc3VsdHMgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfYW5hbHl6ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FuYWx5emUoX3JlZjIsIF9yZWYzKSB7CiAgICAgIHZhciBrZXkgPSBfcmVmMi5rZXksCiAgICAgICAgICBfcmVmMiRhcnJheUluZGV4ID0gX3JlZjIuYXJyYXlJbmRleCwKICAgICAgICAgIGFycmF5SW5kZXggPSBfcmVmMiRhcnJheUluZGV4ID09PSB1bmRlZmluZWQgPyAtMSA6IF9yZWYyJGFycmF5SW5kZXgsCiAgICAgICAgICB2YWx1ZSA9IF9yZWYyLnZhbHVlLAogICAgICAgICAgcmVjb3JkID0gX3JlZjIucmVjb3JkLAogICAgICAgICAgaW5kZXggPSBfcmVmMi5pbmRleDsKICAgICAgdmFyIF9yZWYzJHRva2VuU2VhcmNoZXJzID0gX3JlZjMudG9rZW5TZWFyY2hlcnMsCiAgICAgICAgICB0b2tlblNlYXJjaGVycyA9IF9yZWYzJHRva2VuU2VhcmNoZXJzID09PSB1bmRlZmluZWQgPyBbXSA6IF9yZWYzJHRva2VuU2VhcmNoZXJzLAogICAgICAgICAgX3JlZjMkZnVsbFNlYXJjaGVyID0gX3JlZjMuZnVsbFNlYXJjaGVyLAogICAgICAgICAgZnVsbFNlYXJjaGVyID0gX3JlZjMkZnVsbFNlYXJjaGVyID09PSB1bmRlZmluZWQgPyBbXSA6IF9yZWYzJGZ1bGxTZWFyY2hlciwKICAgICAgICAgIF9yZWYzJHJlc3VsdE1hcCA9IF9yZWYzLnJlc3VsdE1hcCwKICAgICAgICAgIHJlc3VsdE1hcCA9IF9yZWYzJHJlc3VsdE1hcCA9PT0gdW5kZWZpbmVkID8ge30gOiBfcmVmMyRyZXN1bHRNYXAsCiAgICAgICAgICBfcmVmMyRyZXN1bHRzID0gX3JlZjMucmVzdWx0cywKICAgICAgICAgIHJlc3VsdHMgPSBfcmVmMyRyZXN1bHRzID09PSB1bmRlZmluZWQgPyBbXSA6IF9yZWYzJHJlc3VsdHM7CgogICAgICAvLyBDaGVjayBpZiB0aGUgdGV4dmFsdWV0IGNhbiBiZSBzZWFyY2hlZAogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGV4aXN0cyA9IGZhbHNlOwogICAgICB2YXIgYXZlcmFnZVNjb3JlID0gLTE7CiAgICAgIHZhciBudW1UZXh0TWF0Y2hlcyA9IDA7CgogICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgewogICAgICAgIHRoaXMuX2xvZygnXG5LZXk6ICcgKyAoa2V5ID09PSAnJyA/ICctJyA6IGtleSkpOwoKICAgICAgICB2YXIgbWFpblNlYXJjaFJlc3VsdCA9IGZ1bGxTZWFyY2hlci5zZWFyY2godmFsdWUpOwogICAgICAgIHRoaXMuX2xvZygnRnVsbCB0ZXh0OiAiJyArIHZhbHVlICsgJyIsIHNjb3JlOiAnICsgbWFpblNlYXJjaFJlc3VsdC5zY29yZSk7CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG9rZW5pemUpIHsKICAgICAgICAgIHZhciB3b3JkcyA9IHZhbHVlLnNwbGl0KHRoaXMub3B0aW9ucy50b2tlblNlcGFyYXRvcik7CiAgICAgICAgICB2YXIgc2NvcmVzID0gW107CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b2tlblNlYXJjaGVycy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICB2YXIgdG9rZW5TZWFyY2hlciA9IHRva2VuU2VhcmNoZXJzW2ldOwoKICAgICAgICAgICAgdGhpcy5fbG9nKCdcblBhdHRlcm46ICInICsgdG9rZW5TZWFyY2hlci5wYXR0ZXJuICsgJyInKTsKCiAgICAgICAgICAgIC8vIGxldCB0b2tlblNjb3JlcyA9IFtdCiAgICAgICAgICAgIHZhciBoYXNNYXRjaEluVGV4dCA9IGZhbHNlOwoKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3b3Jkcy5sZW5ndGg7IGogKz0gMSkgewogICAgICAgICAgICAgIHZhciB3b3JkID0gd29yZHNbal07CiAgICAgICAgICAgICAgdmFyIHRva2VuU2VhcmNoUmVzdWx0ID0gdG9rZW5TZWFyY2hlci5zZWFyY2god29yZCk7CiAgICAgICAgICAgICAgdmFyIG9iaiA9IHt9OwogICAgICAgICAgICAgIGlmICh0b2tlblNlYXJjaFJlc3VsdC5pc01hdGNoKSB7CiAgICAgICAgICAgICAgICBvYmpbd29yZF0gPSB0b2tlblNlYXJjaFJlc3VsdC5zY29yZTsKICAgICAgICAgICAgICAgIGV4aXN0cyA9IHRydWU7CiAgICAgICAgICAgICAgICBoYXNNYXRjaEluVGV4dCA9IHRydWU7CiAgICAgICAgICAgICAgICBzY29yZXMucHVzaCh0b2tlblNlYXJjaFJlc3VsdC5zY29yZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG9ialt3b3JkXSA9IDE7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5tYXRjaEFsbFRva2VucykgewogICAgICAgICAgICAgICAgICBzY29yZXMucHVzaCgxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5fbG9nKCdUb2tlbjogIicgKyB3b3JkICsgJyIsIHNjb3JlOiAnICsgb2JqW3dvcmRdKTsKICAgICAgICAgICAgICAvLyB0b2tlblNjb3Jlcy5wdXNoKG9iaikKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGhhc01hdGNoSW5UZXh0KSB7CiAgICAgICAgICAgICAgbnVtVGV4dE1hdGNoZXMgKz0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGF2ZXJhZ2VTY29yZSA9IHNjb3Jlc1swXTsKICAgICAgICAgIHZhciBzY29yZXNMZW4gPSBzY29yZXMubGVuZ3RoOwogICAgICAgICAgZm9yICh2YXIgX2kyID0gMTsgX2kyIDwgc2NvcmVzTGVuOyBfaTIgKz0gMSkgewogICAgICAgICAgICBhdmVyYWdlU2NvcmUgKz0gc2NvcmVzW19pMl07CiAgICAgICAgICB9CiAgICAgICAgICBhdmVyYWdlU2NvcmUgPSBhdmVyYWdlU2NvcmUgLyBzY29yZXNMZW47CgogICAgICAgICAgdGhpcy5fbG9nKCdUb2tlbiBzY29yZSBhdmVyYWdlOicsIGF2ZXJhZ2VTY29yZSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgZmluYWxTY29yZSA9IG1haW5TZWFyY2hSZXN1bHQuc2NvcmU7CiAgICAgICAgaWYgKGF2ZXJhZ2VTY29yZSA+IC0xKSB7CiAgICAgICAgICBmaW5hbFNjb3JlID0gKGZpbmFsU2NvcmUgKyBhdmVyYWdlU2NvcmUpIC8gMjsKICAgICAgICB9CgogICAgICAgIHRoaXMuX2xvZygnU2NvcmUgYXZlcmFnZTonLCBmaW5hbFNjb3JlKTsKCiAgICAgICAgdmFyIGNoZWNrVGV4dE1hdGNoZXMgPSB0aGlzLm9wdGlvbnMudG9rZW5pemUgJiYgdGhpcy5vcHRpb25zLm1hdGNoQWxsVG9rZW5zID8gbnVtVGV4dE1hdGNoZXMgPj0gdG9rZW5TZWFyY2hlcnMubGVuZ3RoIDogdHJ1ZTsKCiAgICAgICAgdGhpcy5fbG9nKCdcbkNoZWNrIE1hdGNoZXM6ICcgKyBjaGVja1RleHRNYXRjaGVzKTsKCiAgICAgICAgLy8gSWYgYSBtYXRjaCBpcyBmb3VuZCwgYWRkIHRoZSBpdGVtIHRvIDxyYXdSZXN1bHRzPiwgaW5jbHVkaW5nIGl0cyBzY29yZQogICAgICAgIGlmICgoZXhpc3RzIHx8IG1haW5TZWFyY2hSZXN1bHQuaXNNYXRjaCkgJiYgY2hlY2tUZXh0TWF0Y2hlcykgewogICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGl0ZW0gYWxyZWFkeSBleGlzdHMgaW4gb3VyIHJlc3VsdHMKICAgICAgICAgIHZhciBleGlzdGluZ1Jlc3VsdCA9IHJlc3VsdE1hcFtpbmRleF07CiAgICAgICAgICBpZiAoZXhpc3RpbmdSZXN1bHQpIHsKICAgICAgICAgICAgLy8gVXNlIHRoZSBsb3dlc3Qgc2NvcmUKICAgICAgICAgICAgLy8gZXhpc3RpbmdSZXN1bHQuc2NvcmUsIGJpdGFwUmVzdWx0LnNjb3JlCiAgICAgICAgICAgIGV4aXN0aW5nUmVzdWx0Lm91dHB1dC5wdXNoKHsKICAgICAgICAgICAgICBrZXk6IGtleSwKICAgICAgICAgICAgICBhcnJheUluZGV4OiBhcnJheUluZGV4LAogICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgICBzY29yZTogZmluYWxTY29yZSwKICAgICAgICAgICAgICBtYXRjaGVkSW5kaWNlczogbWFpblNlYXJjaFJlc3VsdC5tYXRjaGVkSW5kaWNlcwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEFkZCBpdCB0byB0aGUgcmF3IHJlc3VsdCBsaXN0CiAgICAgICAgICAgIHJlc3VsdE1hcFtpbmRleF0gPSB7CiAgICAgICAgICAgICAgaXRlbTogcmVjb3JkLAogICAgICAgICAgICAgIG91dHB1dDogW3sKICAgICAgICAgICAgICAgIGtleToga2V5LAogICAgICAgICAgICAgICAgYXJyYXlJbmRleDogYXJyYXlJbmRleCwKICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgICAgIHNjb3JlOiBmaW5hbFNjb3JlLAogICAgICAgICAgICAgICAgbWF0Y2hlZEluZGljZXM6IG1haW5TZWFyY2hSZXN1bHQubWF0Y2hlZEluZGljZXMKICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdE1hcFtpbmRleF0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChpc0FycmF5KHZhbHVlKSkgewogICAgICAgIGZvciAodmFyIF9pMyA9IDAsIGxlbiA9IHZhbHVlLmxlbmd0aDsgX2kzIDwgbGVuOyBfaTMgKz0gMSkgewogICAgICAgICAgdGhpcy5fYW5hbHl6ZSh7CiAgICAgICAgICAgIGtleToga2V5LAogICAgICAgICAgICBhcnJheUluZGV4OiBfaTMsCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVtfaTNdLAogICAgICAgICAgICByZWNvcmQ6IHJlY29yZCwKICAgICAgICAgICAgaW5kZXg6IGluZGV4CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIHJlc3VsdE1hcDogcmVzdWx0TWFwLAogICAgICAgICAgICByZXN1bHRzOiByZXN1bHRzLAogICAgICAgICAgICB0b2tlblNlYXJjaGVyczogdG9rZW5TZWFyY2hlcnMsCiAgICAgICAgICAgIGZ1bGxTZWFyY2hlcjogZnVsbFNlYXJjaGVyCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfY29tcHV0ZVNjb3JlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfY29tcHV0ZVNjb3JlKHdlaWdodHMsIHJlc3VsdHMpIHsKICAgICAgdGhpcy5fbG9nKCdcblxuQ29tcHV0aW5nIHNjb3JlOlxuJyk7CgogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcmVzdWx0cy5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkgewogICAgICAgIHZhciBvdXRwdXQgPSByZXN1bHRzW2ldLm91dHB1dDsKICAgICAgICB2YXIgc2NvcmVMZW4gPSBvdXRwdXQubGVuZ3RoOwoKICAgICAgICB2YXIgdG90YWxTY29yZSA9IDA7CiAgICAgICAgdmFyIGJlc3RTY29yZSA9IDE7CgogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2NvcmVMZW47IGogKz0gMSkgewogICAgICAgICAgdmFyIHdlaWdodCA9IHdlaWdodHMgPyB3ZWlnaHRzW291dHB1dFtqXS5rZXldLndlaWdodCA6IDE7CiAgICAgICAgICB2YXIgc2NvcmUgPSB3ZWlnaHQgPT09IDEgPyBvdXRwdXRbal0uc2NvcmUgOiBvdXRwdXRbal0uc2NvcmUgfHwgMC4wMDE7CiAgICAgICAgICB2YXIgblNjb3JlID0gc2NvcmUgKiB3ZWlnaHQ7CgogICAgICAgICAgaWYgKHdlaWdodCAhPT0gMSkgewogICAgICAgICAgICBiZXN0U2NvcmUgPSBNYXRoLm1pbihiZXN0U2NvcmUsIG5TY29yZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvdXRwdXRbal0ublNjb3JlID0gblNjb3JlOwogICAgICAgICAgICB0b3RhbFNjb3JlICs9IG5TY29yZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJlc3VsdHNbaV0uc2NvcmUgPSBiZXN0U2NvcmUgPT09IDEgPyB0b3RhbFNjb3JlIC8gc2NvcmVMZW4gOiBiZXN0U2NvcmU7CgogICAgICAgIHRoaXMuX2xvZyhyZXN1bHRzW2ldKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19zb3J0JywKICAgIHZhbHVlOiBmdW5jdGlvbiBfc29ydChyZXN1bHRzKSB7CiAgICAgIHRoaXMuX2xvZygnXG5cblNvcnRpbmcuLi4uJyk7CiAgICAgIHJlc3VsdHMuc29ydCh0aGlzLm9wdGlvbnMuc29ydEZuKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfZm9ybWF0JywKICAgIHZhbHVlOiBmdW5jdGlvbiBfZm9ybWF0KHJlc3VsdHMpIHsKICAgICAgdmFyIGZpbmFsT3V0cHV0ID0gW107CgogICAgICB0aGlzLl9sb2coJ1xuXG5PdXRwdXQ6XG5cbicsIEpTT04uc3RyaW5naWZ5KHJlc3VsdHMpKTsKCiAgICAgIHZhciB0cmFuc2Zvcm1lcnMgPSBbXTsKCiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5jbHVkZU1hdGNoZXMpIHsKICAgICAgICB0cmFuc2Zvcm1lcnMucHVzaChmdW5jdGlvbiAocmVzdWx0LCBkYXRhKSB7CiAgICAgICAgICB2YXIgb3V0cHV0ID0gcmVzdWx0Lm91dHB1dDsKICAgICAgICAgIGRhdGEubWF0Y2hlcyA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBvdXRwdXQubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDEpIHsKICAgICAgICAgICAgdmFyIGl0ZW0gPSBvdXRwdXRbaV07CgogICAgICAgICAgICBpZiAoaXRlbS5tYXRjaGVkSW5kaWNlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG9iaiA9IHsKICAgICAgICAgICAgICBpbmRpY2VzOiBpdGVtLm1hdGNoZWRJbmRpY2VzLAogICAgICAgICAgICAgIHZhbHVlOiBpdGVtLnZhbHVlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChpdGVtLmtleSkgewogICAgICAgICAgICAgIG9iai5rZXkgPSBpdGVtLmtleTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXRlbS5oYXNPd25Qcm9wZXJ0eSgnYXJyYXlJbmRleCcpICYmIGl0ZW0uYXJyYXlJbmRleCA+IC0xKSB7CiAgICAgICAgICAgICAgb2JqLmFycmF5SW5kZXggPSBpdGVtLmFycmF5SW5kZXg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YS5tYXRjaGVzLnB1c2gob2JqKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMub3B0aW9ucy5pbmNsdWRlU2NvcmUpIHsKICAgICAgICB0cmFuc2Zvcm1lcnMucHVzaChmdW5jdGlvbiAocmVzdWx0LCBkYXRhKSB7CiAgICAgICAgICBkYXRhLnNjb3JlID0gcmVzdWx0LnNjb3JlOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcmVzdWx0cy5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkgewogICAgICAgIHZhciByZXN1bHQgPSByZXN1bHRzW2ldOwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmlkKSB7CiAgICAgICAgICByZXN1bHQuaXRlbSA9IHRoaXMub3B0aW9ucy5nZXRGbihyZXN1bHQuaXRlbSwgdGhpcy5vcHRpb25zLmlkKVswXTsKICAgICAgICB9CgogICAgICAgIGlmICghdHJhbnNmb3JtZXJzLmxlbmd0aCkgewogICAgICAgICAgZmluYWxPdXRwdXQucHVzaChyZXN1bHQuaXRlbSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgaXRlbTogcmVzdWx0Lml0ZW0KICAgICAgICB9OwoKICAgICAgICBmb3IgKHZhciBqID0gMCwgX2xlbjIgPSB0cmFuc2Zvcm1lcnMubGVuZ3RoOyBqIDwgX2xlbjI7IGogKz0gMSkgewogICAgICAgICAgdHJhbnNmb3JtZXJzW2pdKHJlc3VsdCwgZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBmaW5hbE91dHB1dC5wdXNoKGRhdGEpOwogICAgICB9CgogICAgICByZXR1cm4gZmluYWxPdXRwdXQ7CiAgICB9CiAgfSwgewogICAga2V5OiAnX2xvZycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2xvZygpIHsKICAgICAgaWYgKHRoaXMub3B0aW9ucy52ZXJib3NlKSB7CiAgICAgICAgdmFyIF9jb25zb2xlOwoKICAgICAgICAoX2NvbnNvbGUgPSBjb25zb2xlKS5sb2cuYXBwbHkoX2NvbnNvbGUsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBGdXNlOwp9KCk7Cgptb2R1bGUuZXhwb3J0cyA9IEZ1c2U7CgovKioqLyB9KQovKioqKioqLyBdKTsKfSk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPWZ1c2UuanMubWFwCgovKioqLyB9KSwKLyogNDAgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwpPYmplY3QuZGVmaW5lUHJvcGVydHkoX193ZWJwYWNrX2V4cG9ydHNfXywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwp2YXIgaXNNZXJnZWFibGVPYmplY3QgPSBmdW5jdGlvbiBpc01lcmdlYWJsZU9iamVjdCh2YWx1ZSkgewoJcmV0dXJuIGlzTm9uTnVsbE9iamVjdCh2YWx1ZSkKCQkmJiAhaXNTcGVjaWFsKHZhbHVlKQp9OwoKZnVuY3Rpb24gaXNOb25OdWxsT2JqZWN0KHZhbHVlKSB7CglyZXR1cm4gISF2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnCn0KCmZ1bmN0aW9uIGlzU3BlY2lhbCh2YWx1ZSkgewoJdmFyIHN0cmluZ1ZhbHVlID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKTsKCglyZXR1cm4gc3RyaW5nVmFsdWUgPT09ICdbb2JqZWN0IFJlZ0V4cF0nCgkJfHwgc3RyaW5nVmFsdWUgPT09ICdbb2JqZWN0IERhdGVdJwoJCXx8IGlzUmVhY3RFbGVtZW50KHZhbHVlKQp9CgovLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlYWN0L2Jsb2IvYjVhYzk2M2ZiNzkxZDEyOThlN2YzOTYyMzYzODNiYzk1NWY5MTZjMS9zcmMvaXNvbW9ycGhpYy9jbGFzc2ljL2VsZW1lbnQvUmVhY3RFbGVtZW50LmpzI0wyMS1MMjUKdmFyIGNhblVzZVN5bWJvbCA9IHR5cGVvZiBTeW1ib2wgPT09ICdmdW5jdGlvbicgJiYgU3ltYm9sLmZvcjsKdmFyIFJFQUNUX0VMRU1FTlRfVFlQRSA9IGNhblVzZVN5bWJvbCA/IFN5bWJvbC5mb3IoJ3JlYWN0LmVsZW1lbnQnKSA6IDB4ZWFjNzsKCmZ1bmN0aW9uIGlzUmVhY3RFbGVtZW50KHZhbHVlKSB7CglyZXR1cm4gdmFsdWUuJCR0eXBlb2YgPT09IFJFQUNUX0VMRU1FTlRfVFlQRQp9CgpmdW5jdGlvbiBlbXB0eVRhcmdldCh2YWwpIHsKCXJldHVybiBBcnJheS5pc0FycmF5KHZhbCkgPyBbXSA6IHt9Cn0KCmZ1bmN0aW9uIGNsb25lVW5sZXNzT3RoZXJ3aXNlU3BlY2lmaWVkKHZhbHVlLCBvcHRpb25zKSB7CglyZXR1cm4gKG9wdGlvbnMuY2xvbmUgIT09IGZhbHNlICYmIG9wdGlvbnMuaXNNZXJnZWFibGVPYmplY3QodmFsdWUpKQoJCT8gZGVlcG1lcmdlKGVtcHR5VGFyZ2V0KHZhbHVlKSwgdmFsdWUsIG9wdGlvbnMpCgkJOiB2YWx1ZQp9CgpmdW5jdGlvbiBkZWZhdWx0QXJyYXlNZXJnZSh0YXJnZXQsIHNvdXJjZSwgb3B0aW9ucykgewoJcmV0dXJuIHRhcmdldC5jb25jYXQoc291cmNlKS5tYXAoZnVuY3Rpb24oZWxlbWVudCkgewoJCXJldHVybiBjbG9uZVVubGVzc090aGVyd2lzZVNwZWNpZmllZChlbGVtZW50LCBvcHRpb25zKQoJfSkKfQoKZnVuY3Rpb24gbWVyZ2VPYmplY3QodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpIHsKCXZhciBkZXN0aW5hdGlvbiA9IHt9OwoJaWYgKG9wdGlvbnMuaXNNZXJnZWFibGVPYmplY3QodGFyZ2V0KSkgewoJCU9iamVjdC5rZXlzKHRhcmdldCkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKCQkJZGVzdGluYXRpb25ba2V5XSA9IGNsb25lVW5sZXNzT3RoZXJ3aXNlU3BlY2lmaWVkKHRhcmdldFtrZXldLCBvcHRpb25zKTsKCQl9KTsKCX0KCU9iamVjdC5rZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKCQlpZiAoIW9wdGlvbnMuaXNNZXJnZWFibGVPYmplY3Qoc291cmNlW2tleV0pIHx8ICF0YXJnZXRba2V5XSkgewoJCQlkZXN0aW5hdGlvbltrZXldID0gY2xvbmVVbmxlc3NPdGhlcndpc2VTcGVjaWZpZWQoc291cmNlW2tleV0sIG9wdGlvbnMpOwoJCX0gZWxzZSB7CgkJCWRlc3RpbmF0aW9uW2tleV0gPSBkZWVwbWVyZ2UodGFyZ2V0W2tleV0sIHNvdXJjZVtrZXldLCBvcHRpb25zKTsKCQl9Cgl9KTsKCXJldHVybiBkZXN0aW5hdGlvbgp9CgpmdW5jdGlvbiBkZWVwbWVyZ2UodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpIHsKCW9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoJb3B0aW9ucy5hcnJheU1lcmdlID0gb3B0aW9ucy5hcnJheU1lcmdlIHx8IGRlZmF1bHRBcnJheU1lcmdlOwoJb3B0aW9ucy5pc01lcmdlYWJsZU9iamVjdCA9IG9wdGlvbnMuaXNNZXJnZWFibGVPYmplY3QgfHwgaXNNZXJnZWFibGVPYmplY3Q7CgoJdmFyIHNvdXJjZUlzQXJyYXkgPSBBcnJheS5pc0FycmF5KHNvdXJjZSk7Cgl2YXIgdGFyZ2V0SXNBcnJheSA9IEFycmF5LmlzQXJyYXkodGFyZ2V0KTsKCXZhciBzb3VyY2VBbmRUYXJnZXRUeXBlc01hdGNoID0gc291cmNlSXNBcnJheSA9PT0gdGFyZ2V0SXNBcnJheTsKCglpZiAoIXNvdXJjZUFuZFRhcmdldFR5cGVzTWF0Y2gpIHsKCQlyZXR1cm4gY2xvbmVVbmxlc3NPdGhlcndpc2VTcGVjaWZpZWQoc291cmNlLCBvcHRpb25zKQoJfSBlbHNlIGlmIChzb3VyY2VJc0FycmF5KSB7CgkJcmV0dXJuIG9wdGlvbnMuYXJyYXlNZXJnZSh0YXJnZXQsIHNvdXJjZSwgb3B0aW9ucykKCX0gZWxzZSB7CgkJcmV0dXJuIG1lcmdlT2JqZWN0KHRhcmdldCwgc291cmNlLCBvcHRpb25zKQoJfQp9CgpkZWVwbWVyZ2UuYWxsID0gZnVuY3Rpb24gZGVlcG1lcmdlQWxsKGFycmF5LCBvcHRpb25zKSB7CglpZiAoIUFycmF5LmlzQXJyYXkoYXJyYXkpKSB7CgkJdGhyb3cgbmV3IEVycm9yKCdmaXJzdCBhcmd1bWVudCBzaG91bGQgYmUgYW4gYXJyYXknKQoJfQoKCXJldHVybiBhcnJheS5yZWR1Y2UoZnVuY3Rpb24ocHJldiwgbmV4dCkgewoJCXJldHVybiBkZWVwbWVyZ2UocHJldiwgbmV4dCwgb3B0aW9ucykKCX0sIHt9KQp9OwoKdmFyIGRlZXBtZXJnZV8xID0gZGVlcG1lcmdlOwoKLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyBfX3dlYnBhY2tfZXhwb3J0c19fWyJkZWZhdWx0Il0gPSAoZGVlcG1lcmdlXzEpOwoKCi8qKiovIH0pLAovKiA0MSAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CgoKX193ZWJwYWNrX3JlcXVpcmVfXyg0Mik7CgpfX3dlYnBhY2tfcmVxdWlyZV9fKDUxKTsKCl9fd2VicGFja19yZXF1aXJlX18oNzApOwoKX193ZWJwYWNrX3JlcXVpcmVfXyg3Mik7CgovKioqLyB9KSwKLyogNDIgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKX193ZWJwYWNrX3JlcXVpcmVfXyg0Myk7Cm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKS5BcnJheS5maW5kOwoKCi8qKiovIH0pLAovKiA0MyAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CgovLyAyMi4xLjMuOCBBcnJheS5wcm90b3R5cGUuZmluZChwcmVkaWNhdGUsIHRoaXNBcmcgPSB1bmRlZmluZWQpCnZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKdmFyICRmaW5kID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NykoNSk7CnZhciBLRVkgPSAnZmluZCc7CnZhciBmb3JjZWQgPSB0cnVlOwovLyBTaG91bGRuJ3Qgc2tpcCBob2xlcwppZiAoS0VZIGluIFtdKSBBcnJheSgxKVtLRVldKGZ1bmN0aW9uICgpIHsgZm9yY2VkID0gZmFsc2U7IH0pOwokZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIGZvcmNlZCwgJ0FycmF5JywgewogIGZpbmQ6IGZ1bmN0aW9uIGZpbmQoY2FsbGJhY2tmbiAvKiAsIHRoYXQgPSB1bmRlZmluZWQgKi8pIHsKICAgIHJldHVybiAkZmluZCh0aGlzLCBjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7CiAgfQp9KTsKX193ZWJwYWNrX3JlcXVpcmVfXygyOCkoS0VZKTsKCgovKioqLyB9KSwKLyogNDQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKbW9kdWxlLmV4cG9ydHMgPSAhX193ZWJwYWNrX3JlcXVpcmVfXygxMCkgJiYgIV9fd2VicGFja19yZXF1aXJlX18oMjIpKGZ1bmN0aW9uICgpIHsKICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KF9fd2VicGFja19yZXF1aXJlX18oMjMpKCdkaXYnKSwgJ2EnLCB7IGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gNzsgfSB9KS5hICE9IDc7Cn0pOwoKCi8qKiovIH0pLAovKiA0NSAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgovLyA3LjEuMSBUb1ByaW1pdGl2ZShpbnB1dCBbLCBQcmVmZXJyZWRUeXBlXSkKdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5KTsKLy8gaW5zdGVhZCBvZiB0aGUgRVM2IHNwZWMgdmVyc2lvbiwgd2UgZGlkbid0IGltcGxlbWVudCBAQHRvUHJpbWl0aXZlIGNhc2UKLy8gYW5kIHRoZSBzZWNvbmQgYXJndW1lbnQgLSBmbGFnIC0gcHJlZmVycmVkIHR5cGUgaXMgYSBzdHJpbmcKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQsIFMpIHsKICBpZiAoIWlzT2JqZWN0KGl0KSkgcmV0dXJuIGl0OwogIHZhciBmbiwgdmFsOwogIGlmIChTICYmIHR5cGVvZiAoZm4gPSBpdC50b1N0cmluZykgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpdCkpKSByZXR1cm4gdmFsOwogIGlmICh0eXBlb2YgKGZuID0gaXQudmFsdWVPZikgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpdCkpKSByZXR1cm4gdmFsOwogIGlmICghUyAmJiB0eXBlb2YgKGZuID0gaXQudG9TdHJpbmcpID09ICdmdW5jdGlvbicgJiYgIWlzT2JqZWN0KHZhbCA9IGZuLmNhbGwoaXQpKSkgcmV0dXJuIHZhbDsKICB0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpOwp9OwoKCi8qKiovIH0pLAovKiA0NiAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkgewogIGlmICh0eXBlb2YgaXQgIT0gJ2Z1bmN0aW9uJykgdGhyb3cgVHlwZUVycm9yKGl0ICsgJyBpcyBub3QgYSBmdW5jdGlvbiEnKTsKICByZXR1cm4gaXQ7Cn07CgoKLyoqKi8gfSksCi8qIDQ3ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCi8vIDAgLT4gQXJyYXkjZm9yRWFjaAovLyAxIC0+IEFycmF5I21hcAovLyAyIC0+IEFycmF5I2ZpbHRlcgovLyAzIC0+IEFycmF5I3NvbWUKLy8gNCAtPiBBcnJheSNldmVyeQovLyA1IC0+IEFycmF5I2ZpbmQKLy8gNiAtPiBBcnJheSNmaW5kSW5kZXgKdmFyIGN0eCA9IF9fd2VicGFja19yZXF1aXJlX18oMTQpOwp2YXIgSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjUpOwp2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE2KTsKdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOCk7CnZhciBhc2MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4KTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoVFlQRSwgJGNyZWF0ZSkgewogIHZhciBJU19NQVAgPSBUWVBFID09IDE7CiAgdmFyIElTX0ZJTFRFUiA9IFRZUEUgPT0gMjsKICB2YXIgSVNfU09NRSA9IFRZUEUgPT0gMzsKICB2YXIgSVNfRVZFUlkgPSBUWVBFID09IDQ7CiAgdmFyIElTX0ZJTkRfSU5ERVggPSBUWVBFID09IDY7CiAgdmFyIE5PX0hPTEVTID0gVFlQRSA9PSA1IHx8IElTX0ZJTkRfSU5ERVg7CiAgdmFyIGNyZWF0ZSA9ICRjcmVhdGUgfHwgYXNjOwogIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIGNhbGxiYWNrZm4sIHRoYXQpIHsKICAgIHZhciBPID0gdG9PYmplY3QoJHRoaXMpOwogICAgdmFyIHNlbGYgPSBJT2JqZWN0KE8pOwogICAgdmFyIGYgPSBjdHgoY2FsbGJhY2tmbiwgdGhhdCwgMyk7CiAgICB2YXIgbGVuZ3RoID0gdG9MZW5ndGgoc2VsZi5sZW5ndGgpOwogICAgdmFyIGluZGV4ID0gMDsKICAgIHZhciByZXN1bHQgPSBJU19NQVAgPyBjcmVhdGUoJHRoaXMsIGxlbmd0aCkgOiBJU19GSUxURVIgPyBjcmVhdGUoJHRoaXMsIDApIDogdW5kZWZpbmVkOwogICAgdmFyIHZhbCwgcmVzOwogICAgZm9yICg7bGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIGlmIChOT19IT0xFUyB8fCBpbmRleCBpbiBzZWxmKSB7CiAgICAgIHZhbCA9IHNlbGZbaW5kZXhdOwogICAgICByZXMgPSBmKHZhbCwgaW5kZXgsIE8pOwogICAgICBpZiAoVFlQRSkgewogICAgICAgIGlmIChJU19NQVApIHJlc3VsdFtpbmRleF0gPSByZXM7ICAgLy8gbWFwCiAgICAgICAgZWxzZSBpZiAocmVzKSBzd2l0Y2ggKFRZUEUpIHsKICAgICAgICAgIGNhc2UgMzogcmV0dXJuIHRydWU7ICAgICAgICAgICAgIC8vIHNvbWUKICAgICAgICAgIGNhc2UgNTogcmV0dXJuIHZhbDsgICAgICAgICAgICAgIC8vIGZpbmQKICAgICAgICAgIGNhc2UgNjogcmV0dXJuIGluZGV4OyAgICAgICAgICAgIC8vIGZpbmRJbmRleAogICAgICAgICAgY2FzZSAyOiByZXN1bHQucHVzaCh2YWwpOyAgICAgICAgLy8gZmlsdGVyCiAgICAgICAgfSBlbHNlIGlmIChJU19FVkVSWSkgcmV0dXJuIGZhbHNlOyAvLyBldmVyeQogICAgICB9CiAgICB9CiAgICByZXR1cm4gSVNfRklORF9JTkRFWCA/IC0xIDogSVNfU09NRSB8fCBJU19FVkVSWSA/IElTX0VWRVJZIDogcmVzdWx0OwogIH07Cn07CgoKLyoqKi8gfSksCi8qIDQ4ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCi8vIDkuNC4yLjMgQXJyYXlTcGVjaWVzQ3JlYXRlKG9yaWdpbmFsQXJyYXksIGxlbmd0aCkKdmFyIHNwZWNpZXNDb25zdHJ1Y3RvciA9IF9fd2VicGFja19yZXF1aXJlX18oNDkpOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob3JpZ2luYWwsIGxlbmd0aCkgewogIHJldHVybiBuZXcgKHNwZWNpZXNDb25zdHJ1Y3RvcihvcmlnaW5hbCkpKGxlbmd0aCk7Cn07CgoKLyoqKi8gfSksCi8qIDQ5ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCnZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOSk7CnZhciBpc0FycmF5ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MCk7CnZhciBTUEVDSUVTID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKSgnc3BlY2llcycpOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob3JpZ2luYWwpIHsKICB2YXIgQzsKICBpZiAoaXNBcnJheShvcmlnaW5hbCkpIHsKICAgIEMgPSBvcmlnaW5hbC5jb25zdHJ1Y3RvcjsKICAgIC8vIGNyb3NzLXJlYWxtIGZhbGxiYWNrCiAgICBpZiAodHlwZW9mIEMgPT0gJ2Z1bmN0aW9uJyAmJiAoQyA9PT0gQXJyYXkgfHwgaXNBcnJheShDLnByb3RvdHlwZSkpKSBDID0gdW5kZWZpbmVkOwogICAgaWYgKGlzT2JqZWN0KEMpKSB7CiAgICAgIEMgPSBDW1NQRUNJRVNdOwogICAgICBpZiAoQyA9PT0gbnVsbCkgQyA9IHVuZGVmaW5lZDsKICAgIH0KICB9IHJldHVybiBDID09PSB1bmRlZmluZWQgPyBBcnJheSA6IEM7Cn07CgoKLyoqKi8gfSksCi8qIDUwICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCi8vIDcuMi4yIElzQXJyYXkoYXJndW1lbnQpCnZhciBjb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1KTsKbW9kdWxlLmV4cG9ydHMgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uIGlzQXJyYXkoYXJnKSB7CiAgcmV0dXJuIGNvZihhcmcpID09ICdBcnJheSc7Cn07CgoKLyoqKi8gfSksCi8qIDUxICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCl9fd2VicGFja19yZXF1aXJlX18oNTIpOwpfX3dlYnBhY2tfcmVxdWlyZV9fKDYzKTsKbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpLkFycmF5LmZyb207CgoKLyoqKi8gfSksCi8qIDUyICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKCnZhciAkYXQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUzKSh0cnVlKTsKCi8vIDIxLjEuMy4yNyBTdHJpbmcucHJvdG90eXBlW0BAaXRlcmF0b3JdKCkKX193ZWJwYWNrX3JlcXVpcmVfXyg1NCkoU3RyaW5nLCAnU3RyaW5nJywgZnVuY3Rpb24gKGl0ZXJhdGVkKSB7CiAgdGhpcy5fdCA9IFN0cmluZyhpdGVyYXRlZCk7IC8vIHRhcmdldAogIHRoaXMuX2kgPSAwOyAgICAgICAgICAgICAgICAvLyBuZXh0IGluZGV4Ci8vIDIxLjEuNS4yLjEgJVN0cmluZ0l0ZXJhdG9yUHJvdG90eXBlJS5uZXh0KCkKfSwgZnVuY3Rpb24gKCkgewogIHZhciBPID0gdGhpcy5fdDsKICB2YXIgaW5kZXggPSB0aGlzLl9pOwogIHZhciBwb2ludDsKICBpZiAoaW5kZXggPj0gTy5sZW5ndGgpIHJldHVybiB7IHZhbHVlOiB1bmRlZmluZWQsIGRvbmU6IHRydWUgfTsKICBwb2ludCA9ICRhdChPLCBpbmRleCk7CiAgdGhpcy5faSArPSBwb2ludC5sZW5ndGg7CiAgcmV0dXJuIHsgdmFsdWU6IHBvaW50LCBkb25lOiBmYWxzZSB9Owp9KTsKCgovKioqLyB9KSwKLyogNTMgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKdmFyIHRvSW50ZWdlciA9IF9fd2VicGFja19yZXF1aXJlX18oMTkpOwp2YXIgZGVmaW5lZCA9IF9fd2VicGFja19yZXF1aXJlX18oMTcpOwovLyB0cnVlICAtPiBTdHJpbmcjYXQKLy8gZmFsc2UgLT4gU3RyaW5nI2NvZGVQb2ludEF0Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKFRPX1NUUklORykgewogIHJldHVybiBmdW5jdGlvbiAodGhhdCwgcG9zKSB7CiAgICB2YXIgcyA9IFN0cmluZyhkZWZpbmVkKHRoYXQpKTsKICAgIHZhciBpID0gdG9JbnRlZ2VyKHBvcyk7CiAgICB2YXIgbCA9IHMubGVuZ3RoOwogICAgdmFyIGEsIGI7CiAgICBpZiAoaSA8IDAgfHwgaSA+PSBsKSByZXR1cm4gVE9fU1RSSU5HID8gJycgOiB1bmRlZmluZWQ7CiAgICBhID0gcy5jaGFyQ29kZUF0KGkpOwogICAgcmV0dXJuIGEgPCAweGQ4MDAgfHwgYSA+IDB4ZGJmZiB8fCBpICsgMSA9PT0gbCB8fCAoYiA9IHMuY2hhckNvZGVBdChpICsgMSkpIDwgMHhkYzAwIHx8IGIgPiAweGRmZmYKICAgICAgPyBUT19TVFJJTkcgPyBzLmNoYXJBdChpKSA6IGEKICAgICAgOiBUT19TVFJJTkcgPyBzLnNsaWNlKGksIGkgKyAyKSA6IChhIC0gMHhkODAwIDw8IDEwKSArIChiIC0gMHhkYzAwKSArIDB4MTAwMDA7CiAgfTsKfTsKCgovKioqLyB9KSwKLyogNTQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwoKdmFyIExJQlJBUlkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI3KTsKdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOwp2YXIgcmVkZWZpbmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI0KTsKdmFyIGhpZGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQpOwp2YXIgSXRlcmF0b3JzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMCk7CnZhciAkaXRlckNyZWF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNTUpOwp2YXIgc2V0VG9TdHJpbmdUYWcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMyKTsKdmFyIGdldFByb3RvdHlwZU9mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Mik7CnZhciBJVEVSQVRPUiA9IF9fd2VicGFja19yZXF1aXJlX18oMCkoJ2l0ZXJhdG9yJyk7CnZhciBCVUdHWSA9ICEoW10ua2V5cyAmJiAnbmV4dCcgaW4gW10ua2V5cygpKTsgLy8gU2FmYXJpIGhhcyBidWdneSBpdGVyYXRvcnMgdy9vIGBuZXh0YAp2YXIgRkZfSVRFUkFUT1IgPSAnQEBpdGVyYXRvcic7CnZhciBLRVlTID0gJ2tleXMnOwp2YXIgVkFMVUVTID0gJ3ZhbHVlcyc7Cgp2YXIgcmV0dXJuVGhpcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH07Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChCYXNlLCBOQU1FLCBDb25zdHJ1Y3RvciwgbmV4dCwgREVGQVVMVCwgSVNfU0VULCBGT1JDRUQpIHsKICAkaXRlckNyZWF0ZShDb25zdHJ1Y3RvciwgTkFNRSwgbmV4dCk7CiAgdmFyIGdldE1ldGhvZCA9IGZ1bmN0aW9uIChraW5kKSB7CiAgICBpZiAoIUJVR0dZICYmIGtpbmQgaW4gcHJvdG8pIHJldHVybiBwcm90b1traW5kXTsKICAgIHN3aXRjaCAoa2luZCkgewogICAgICBjYXNlIEtFWVM6IHJldHVybiBmdW5jdGlvbiBrZXlzKCkgeyByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOyB9OwogICAgICBjYXNlIFZBTFVFUzogcmV0dXJuIGZ1bmN0aW9uIHZhbHVlcygpIHsgcmV0dXJuIG5ldyBDb25zdHJ1Y3Rvcih0aGlzLCBraW5kKTsgfTsKICAgIH0gcmV0dXJuIGZ1bmN0aW9uIGVudHJpZXMoKSB7IHJldHVybiBuZXcgQ29uc3RydWN0b3IodGhpcywga2luZCk7IH07CiAgfTsKICB2YXIgVEFHID0gTkFNRSArICcgSXRlcmF0b3InOwogIHZhciBERUZfVkFMVUVTID0gREVGQVVMVCA9PSBWQUxVRVM7CiAgdmFyIFZBTFVFU19CVUcgPSBmYWxzZTsKICB2YXIgcHJvdG8gPSBCYXNlLnByb3RvdHlwZTsKICB2YXIgJG5hdGl2ZSA9IHByb3RvW0lURVJBVE9SXSB8fCBwcm90b1tGRl9JVEVSQVRPUl0gfHwgREVGQVVMVCAmJiBwcm90b1tERUZBVUxUXTsKICB2YXIgJGRlZmF1bHQgPSAkbmF0aXZlIHx8IGdldE1ldGhvZChERUZBVUxUKTsKICB2YXIgJGVudHJpZXMgPSBERUZBVUxUID8gIURFRl9WQUxVRVMgPyAkZGVmYXVsdCA6IGdldE1ldGhvZCgnZW50cmllcycpIDogdW5kZWZpbmVkOwogIHZhciAkYW55TmF0aXZlID0gTkFNRSA9PSAnQXJyYXknID8gcHJvdG8uZW50cmllcyB8fCAkbmF0aXZlIDogJG5hdGl2ZTsKICB2YXIgbWV0aG9kcywga2V5LCBJdGVyYXRvclByb3RvdHlwZTsKICAvLyBGaXggbmF0aXZlCiAgaWYgKCRhbnlOYXRpdmUpIHsKICAgIEl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG90eXBlT2YoJGFueU5hdGl2ZS5jYWxsKG5ldyBCYXNlKCkpKTsKICAgIGlmIChJdGVyYXRvclByb3RvdHlwZSAhPT0gT2JqZWN0LnByb3RvdHlwZSAmJiBJdGVyYXRvclByb3RvdHlwZS5uZXh0KSB7CiAgICAgIC8vIFNldCBAQHRvU3RyaW5nVGFnIHRvIG5hdGl2ZSBpdGVyYXRvcnMKICAgICAgc2V0VG9TdHJpbmdUYWcoSXRlcmF0b3JQcm90b3R5cGUsIFRBRywgdHJ1ZSk7CiAgICAgIC8vIGZpeCBmb3Igc29tZSBvbGQgZW5naW5lcwogICAgICBpZiAoIUxJQlJBUlkgJiYgdHlwZW9mIEl0ZXJhdG9yUHJvdG90eXBlW0lURVJBVE9SXSAhPSAnZnVuY3Rpb24nKSBoaWRlKEl0ZXJhdG9yUHJvdG90eXBlLCBJVEVSQVRPUiwgcmV0dXJuVGhpcyk7CiAgICB9CiAgfQogIC8vIGZpeCBBcnJheSN7dmFsdWVzLCBAQGl0ZXJhdG9yfS5uYW1lIGluIFY4IC8gRkYKICBpZiAoREVGX1ZBTFVFUyAmJiAkbmF0aXZlICYmICRuYXRpdmUubmFtZSAhPT0gVkFMVUVTKSB7CiAgICBWQUxVRVNfQlVHID0gdHJ1ZTsKICAgICRkZWZhdWx0ID0gZnVuY3Rpb24gdmFsdWVzKCkgeyByZXR1cm4gJG5hdGl2ZS5jYWxsKHRoaXMpOyB9OwogIH0KICAvLyBEZWZpbmUgaXRlcmF0b3IKICBpZiAoKCFMSUJSQVJZIHx8IEZPUkNFRCkgJiYgKEJVR0dZIHx8IFZBTFVFU19CVUcgfHwgIXByb3RvW0lURVJBVE9SXSkpIHsKICAgIGhpZGUocHJvdG8sIElURVJBVE9SLCAkZGVmYXVsdCk7CiAgfQogIC8vIFBsdWcgZm9yIGxpYnJhcnkKICBJdGVyYXRvcnNbTkFNRV0gPSAkZGVmYXVsdDsKICBJdGVyYXRvcnNbVEFHXSA9IHJldHVyblRoaXM7CiAgaWYgKERFRkFVTFQpIHsKICAgIG1ldGhvZHMgPSB7CiAgICAgIHZhbHVlczogREVGX1ZBTFVFUyA/ICRkZWZhdWx0IDogZ2V0TWV0aG9kKFZBTFVFUyksCiAgICAgIGtleXM6IElTX1NFVCA/ICRkZWZhdWx0IDogZ2V0TWV0aG9kKEtFWVMpLAogICAgICBlbnRyaWVzOiAkZW50cmllcwogICAgfTsKICAgIGlmIChGT1JDRUQpIGZvciAoa2V5IGluIG1ldGhvZHMpIHsKICAgICAgaWYgKCEoa2V5IGluIHByb3RvKSkgcmVkZWZpbmUocHJvdG8sIGtleSwgbWV0aG9kc1trZXldKTsKICAgIH0gZWxzZSAkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIChCVUdHWSB8fCBWQUxVRVNfQlVHKSwgTkFNRSwgbWV0aG9kcyk7CiAgfQogIHJldHVybiBtZXRob2RzOwp9OwoKCi8qKiovIH0pLAovKiA1NSAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7Cgp2YXIgY3JlYXRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1Nik7CnZhciBkZXNjcmlwdG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMik7CnZhciBzZXRUb1N0cmluZ1RhZyA9IF9fd2VicGFja19yZXF1aXJlX18oMzIpOwp2YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTsKCi8vIDI1LjEuMi4xLjEgJUl0ZXJhdG9yUHJvdG90eXBlJVtAQGl0ZXJhdG9yXSgpCl9fd2VicGFja19yZXF1aXJlX18oNCkoSXRlcmF0b3JQcm90b3R5cGUsIF9fd2VicGFja19yZXF1aXJlX18oMCkoJ2l0ZXJhdG9yJyksIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0pOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIE5BTUUsIG5leHQpIHsKICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSBjcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUsIHsgbmV4dDogZGVzY3JpcHRvcigxLCBuZXh0KSB9KTsKICBzZXRUb1N0cmluZ1RhZyhDb25zdHJ1Y3RvciwgTkFNRSArICcgSXRlcmF0b3InKTsKfTsKCgovKioqLyB9KSwKLyogNTYgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKLy8gMTkuMS4yLjIgLyAxNS4yLjMuNSBPYmplY3QuY3JlYXRlKE8gWywgUHJvcGVydGllc10pCnZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7CnZhciBkUHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU3KTsKdmFyIGVudW1CdWdLZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMSk7CnZhciBJRV9QUk9UTyA9IF9fd2VicGFja19yZXF1aXJlX18oMjEpKCdJRV9QUk9UTycpOwp2YXIgRW1wdHkgPSBmdW5jdGlvbiAoKSB7IC8qIGVtcHR5ICovIH07CnZhciBQUk9UT1RZUEUgPSAncHJvdG90eXBlJzsKCi8vIENyZWF0ZSBvYmplY3Qgd2l0aCBmYWtlIGBudWxsYCBwcm90b3R5cGU6IHVzZSBpZnJhbWUgT2JqZWN0IHdpdGggY2xlYXJlZCBwcm90b3R5cGUKdmFyIGNyZWF0ZURpY3QgPSBmdW5jdGlvbiAoKSB7CiAgLy8gVGhyYXNoLCB3YXN0ZSBhbmQgc29kb215OiBJRSBHQyBidWcKICB2YXIgaWZyYW1lID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMykoJ2lmcmFtZScpOwogIHZhciBpID0gZW51bUJ1Z0tleXMubGVuZ3RoOwogIHZhciBsdCA9ICc8JzsKICB2YXIgZ3QgPSAnPic7CiAgdmFyIGlmcmFtZURvY3VtZW50OwogIGlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIF9fd2VicGFja19yZXF1aXJlX18oNjEpLmFwcGVuZENoaWxkKGlmcmFtZSk7CiAgaWZyYW1lLnNyYyA9ICdqYXZhc2NyaXB0Oic7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2NyaXB0LXVybAogIC8vIGNyZWF0ZURpY3QgPSBpZnJhbWUuY29udGVudFdpbmRvdy5PYmplY3Q7CiAgLy8gaHRtbC5yZW1vdmVDaGlsZChpZnJhbWUpOwogIGlmcmFtZURvY3VtZW50ID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7CiAgaWZyYW1lRG9jdW1lbnQub3BlbigpOwogIGlmcmFtZURvY3VtZW50LndyaXRlKGx0ICsgJ3NjcmlwdCcgKyBndCArICdkb2N1bWVudC5GPU9iamVjdCcgKyBsdCArICcvc2NyaXB0JyArIGd0KTsKICBpZnJhbWVEb2N1bWVudC5jbG9zZSgpOwogIGNyZWF0ZURpY3QgPSBpZnJhbWVEb2N1bWVudC5GOwogIHdoaWxlIChpLS0pIGRlbGV0ZSBjcmVhdGVEaWN0W1BST1RPVFlQRV1bZW51bUJ1Z0tleXNbaV1dOwogIHJldHVybiBjcmVhdGVEaWN0KCk7Cn07Cgptb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5jcmVhdGUgfHwgZnVuY3Rpb24gY3JlYXRlKE8sIFByb3BlcnRpZXMpIHsKICB2YXIgcmVzdWx0OwogIGlmIChPICE9PSBudWxsKSB7CiAgICBFbXB0eVtQUk9UT1RZUEVdID0gYW5PYmplY3QoTyk7CiAgICByZXN1bHQgPSBuZXcgRW1wdHkoKTsKICAgIEVtcHR5W1BST1RPVFlQRV0gPSBudWxsOwogICAgLy8gYWRkICJfX3Byb3RvX18iIGZvciBPYmplY3QuZ2V0UHJvdG90eXBlT2YgcG9seWZpbGwKICAgIHJlc3VsdFtJRV9QUk9UT10gPSBPOwogIH0gZWxzZSByZXN1bHQgPSBjcmVhdGVEaWN0KCk7CiAgcmV0dXJuIFByb3BlcnRpZXMgPT09IHVuZGVmaW5lZCA/IHJlc3VsdCA6IGRQcyhyZXN1bHQsIFByb3BlcnRpZXMpOwp9OwoKCi8qKiovIH0pLAovKiA1NyAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7Cgp2YXIgZFAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOwp2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpOwp2YXIgZ2V0S2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oNTgpOwoKbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKSA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzIDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKSB7CiAgYW5PYmplY3QoTyk7CiAgdmFyIGtleXMgPSBnZXRLZXlzKFByb3BlcnRpZXMpOwogIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICB2YXIgaSA9IDA7CiAgdmFyIFA7CiAgd2hpbGUgKGxlbmd0aCA+IGkpIGRQLmYoTywgUCA9IGtleXNbaSsrXSwgUHJvcGVydGllc1tQXSk7CiAgcmV0dXJuIE87Cn07CgoKLyoqKi8gfSksCi8qIDU4ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCi8vIDE5LjEuMi4xNCAvIDE1LjIuMy4xNCBPYmplY3Qua2V5cyhPKQp2YXIgJGtleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU5KTsKdmFyIGVudW1CdWdLZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMSk7Cgptb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uIGtleXMoTykgewogIHJldHVybiAka2V5cyhPLCBlbnVtQnVnS2V5cyk7Cn07CgoKLyoqKi8gfSksCi8qIDU5ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCnZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKTsKdmFyIHRvSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjkpOwp2YXIgYXJyYXlJbmRleE9mID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMCkoZmFsc2UpOwp2YXIgSUVfUFJPVE8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxKSgnSUVfUFJPVE8nKTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9iamVjdCwgbmFtZXMpIHsKICB2YXIgTyA9IHRvSU9iamVjdChvYmplY3QpOwogIHZhciBpID0gMDsKICB2YXIgcmVzdWx0ID0gW107CiAgdmFyIGtleTsKICBmb3IgKGtleSBpbiBPKSBpZiAoa2V5ICE9IElFX1BST1RPKSBoYXMoTywga2V5KSAmJiByZXN1bHQucHVzaChrZXkpOwogIC8vIERvbid0IGVudW0gYnVnICYgaGlkZGVuIGtleXMKICB3aGlsZSAobmFtZXMubGVuZ3RoID4gaSkgaWYgKGhhcyhPLCBrZXkgPSBuYW1lc1tpKytdKSkgewogICAgfmFycmF5SW5kZXhPZihyZXN1bHQsIGtleSkgfHwgcmVzdWx0LnB1c2goa2V5KTsKICB9CiAgcmV0dXJuIHJlc3VsdDsKfTsKCgovKioqLyB9KSwKLyogNjAgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKdmFyIHRvSW50ZWdlciA9IF9fd2VicGFja19yZXF1aXJlX18oMTkpOwp2YXIgbWF4ID0gTWF0aC5tYXg7CnZhciBtaW4gPSBNYXRoLm1pbjsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaW5kZXgsIGxlbmd0aCkgewogIGluZGV4ID0gdG9JbnRlZ2VyKGluZGV4KTsKICByZXR1cm4gaW5kZXggPCAwID8gbWF4KGluZGV4ICsgbGVuZ3RoLCAwKSA6IG1pbihpbmRleCwgbGVuZ3RoKTsKfTsKCgovKioqLyB9KSwKLyogNjEgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKdmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKS5kb2N1bWVudDsKbW9kdWxlLmV4cG9ydHMgPSBkb2N1bWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgoKLyoqKi8gfSksCi8qIDYyICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCi8vIDE5LjEuMi45IC8gMTUuMi4zLjIgT2JqZWN0LmdldFByb3RvdHlwZU9mKE8pCnZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKTsKdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNik7CnZhciBJRV9QUk9UTyA9IF9fd2VicGFja19yZXF1aXJlX18oMjEpKCdJRV9QUk9UTycpOwp2YXIgT2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOwoKbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gKE8pIHsKICBPID0gdG9PYmplY3QoTyk7CiAgaWYgKGhhcyhPLCBJRV9QUk9UTykpIHJldHVybiBPW0lFX1BST1RPXTsKICBpZiAodHlwZW9mIE8uY29uc3RydWN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBPIGluc3RhbmNlb2YgTy5jb25zdHJ1Y3RvcikgewogICAgcmV0dXJuIE8uY29uc3RydWN0b3IucHJvdG90eXBlOwogIH0gcmV0dXJuIE8gaW5zdGFuY2VvZiBPYmplY3QgPyBPYmplY3RQcm90byA6IG51bGw7Cn07CgoKLyoqKi8gfSksCi8qIDYzICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKCnZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE0KTsKdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOwp2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE2KTsKdmFyIGNhbGwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY0KTsKdmFyIGlzQXJyYXlJdGVyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2NSk7CnZhciB0b0xlbmd0aCA9IF9fd2VicGFja19yZXF1aXJlX18oMTgpOwp2YXIgY3JlYXRlUHJvcGVydHkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY2KTsKdmFyIGdldEl0ZXJGbiA9IF9fd2VicGFja19yZXF1aXJlX18oNjcpOwoKJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhX193ZWJwYWNrX3JlcXVpcmVfXyg2OSkoZnVuY3Rpb24gKGl0ZXIpIHsgQXJyYXkuZnJvbShpdGVyKTsgfSksICdBcnJheScsIHsKICAvLyAyMi4xLjIuMSBBcnJheS5mcm9tKGFycmF5TGlrZSwgbWFwZm4gPSB1bmRlZmluZWQsIHRoaXNBcmcgPSB1bmRlZmluZWQpCiAgZnJvbTogZnVuY3Rpb24gZnJvbShhcnJheUxpa2UgLyogLCBtYXBmbiA9IHVuZGVmaW5lZCwgdGhpc0FyZyA9IHVuZGVmaW5lZCAqLykgewogICAgdmFyIE8gPSB0b09iamVjdChhcnJheUxpa2UpOwogICAgdmFyIEMgPSB0eXBlb2YgdGhpcyA9PSAnZnVuY3Rpb24nID8gdGhpcyA6IEFycmF5OwogICAgdmFyIGFMZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgdmFyIG1hcGZuID0gYUxlbiA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICB2YXIgbWFwcGluZyA9IG1hcGZuICE9PSB1bmRlZmluZWQ7CiAgICB2YXIgaW5kZXggPSAwOwogICAgdmFyIGl0ZXJGbiA9IGdldEl0ZXJGbihPKTsKICAgIHZhciBsZW5ndGgsIHJlc3VsdCwgc3RlcCwgaXRlcmF0b3I7CiAgICBpZiAobWFwcGluZykgbWFwZm4gPSBjdHgobWFwZm4sIGFMZW4gPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkLCAyKTsKICAgIC8vIGlmIG9iamVjdCBpc24ndCBpdGVyYWJsZSBvciBpdCdzIGFycmF5IHdpdGggZGVmYXVsdCBpdGVyYXRvciAtIHVzZSBzaW1wbGUgY2FzZQogICAgaWYgKGl0ZXJGbiAhPSB1bmRlZmluZWQgJiYgIShDID09IEFycmF5ICYmIGlzQXJyYXlJdGVyKGl0ZXJGbikpKSB7CiAgICAgIGZvciAoaXRlcmF0b3IgPSBpdGVyRm4uY2FsbChPKSwgcmVzdWx0ID0gbmV3IEMoKTsgIShzdGVwID0gaXRlcmF0b3IubmV4dCgpKS5kb25lOyBpbmRleCsrKSB7CiAgICAgICAgY3JlYXRlUHJvcGVydHkocmVzdWx0LCBpbmRleCwgbWFwcGluZyA/IGNhbGwoaXRlcmF0b3IsIG1hcGZuLCBbc3RlcC52YWx1ZSwgaW5kZXhdLCB0cnVlKSA6IHN0ZXAudmFsdWUpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBsZW5ndGggPSB0b0xlbmd0aChPLmxlbmd0aCk7CiAgICAgIGZvciAocmVzdWx0ID0gbmV3IEMobGVuZ3RoKTsgbGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIHsKICAgICAgICBjcmVhdGVQcm9wZXJ0eShyZXN1bHQsIGluZGV4LCBtYXBwaW5nID8gbWFwZm4oT1tpbmRleF0sIGluZGV4KSA6IE9baW5kZXhdKTsKICAgICAgfQogICAgfQogICAgcmVzdWx0Lmxlbmd0aCA9IGluZGV4OwogICAgcmV0dXJuIHJlc3VsdDsKICB9Cn0pOwoKCi8qKiovIH0pLAovKiA2NCAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgovLyBjYWxsIHNvbWV0aGluZyBvbiBpdGVyYXRvciBzdGVwIHdpdGggc2FmZSBjbG9zaW5nIG9uIGVycm9yCnZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0ZXJhdG9yLCBmbiwgdmFsdWUsIGVudHJpZXMpIHsKICB0cnkgewogICAgcmV0dXJuIGVudHJpZXMgPyBmbihhbk9iamVjdCh2YWx1ZSlbMF0sIHZhbHVlWzFdKSA6IGZuKHZhbHVlKTsKICAvLyA3LjQuNiBJdGVyYXRvckNsb3NlKGl0ZXJhdG9yLCBjb21wbGV0aW9uKQogIH0gY2F0Y2ggKGUpIHsKICAgIHZhciByZXQgPSBpdGVyYXRvclsncmV0dXJuJ107CiAgICBpZiAocmV0ICE9PSB1bmRlZmluZWQpIGFuT2JqZWN0KHJldC5jYWxsKGl0ZXJhdG9yKSk7CiAgICB0aHJvdyBlOwogIH0KfTsKCgovKioqLyB9KSwKLyogNjUgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKLy8gY2hlY2sgb24gZGVmYXVsdCBBcnJheSBpdGVyYXRvcgp2YXIgSXRlcmF0b3JzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMCk7CnZhciBJVEVSQVRPUiA9IF9fd2VicGFja19yZXF1aXJlX18oMCkoJ2l0ZXJhdG9yJyk7CnZhciBBcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICByZXR1cm4gaXQgIT09IHVuZGVmaW5lZCAmJiAoSXRlcmF0b3JzLkFycmF5ID09PSBpdCB8fCBBcnJheVByb3RvW0lURVJBVE9SXSA9PT0gaXQpOwp9OwoKCi8qKiovIH0pLAovKiA2NiAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7Cgp2YXIgJGRlZmluZVByb3BlcnR5ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KTsKdmFyIGNyZWF0ZURlc2MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9iamVjdCwgaW5kZXgsIHZhbHVlKSB7CiAgaWYgKGluZGV4IGluIG9iamVjdCkgJGRlZmluZVByb3BlcnR5LmYob2JqZWN0LCBpbmRleCwgY3JlYXRlRGVzYygwLCB2YWx1ZSkpOwogIGVsc2Ugb2JqZWN0W2luZGV4XSA9IHZhbHVlOwp9OwoKCi8qKiovIH0pLAovKiA2NyAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7Cgp2YXIgY2xhc3NvZiA9IF9fd2VicGFja19yZXF1aXJlX18oNjgpOwp2YXIgSVRFUkFUT1IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDApKCdpdGVyYXRvcicpOwp2YXIgSXRlcmF0b3JzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMCk7Cm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKS5nZXRJdGVyYXRvck1ldGhvZCA9IGZ1bmN0aW9uIChpdCkgewogIGlmIChpdCAhPSB1bmRlZmluZWQpIHJldHVybiBpdFtJVEVSQVRPUl0KICAgIHx8IGl0WydAQGl0ZXJhdG9yJ10KICAgIHx8IEl0ZXJhdG9yc1tjbGFzc29mKGl0KV07Cn07CgoKLyoqKi8gfSksCi8qIDY4ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCi8vIGdldHRpbmcgdGFnIGZyb20gMTkuMS4zLjYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZygpCnZhciBjb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1KTsKdmFyIFRBRyA9IF9fd2VicGFja19yZXF1aXJlX18oMCkoJ3RvU3RyaW5nVGFnJyk7Ci8vIEVTMyB3cm9uZyBoZXJlCnZhciBBUkcgPSBjb2YoZnVuY3Rpb24gKCkgeyByZXR1cm4gYXJndW1lbnRzOyB9KCkpID09ICdBcmd1bWVudHMnOwoKLy8gZmFsbGJhY2sgZm9yIElFMTEgU2NyaXB0IEFjY2VzcyBEZW5pZWQgZXJyb3IKdmFyIHRyeUdldCA9IGZ1bmN0aW9uIChpdCwga2V5KSB7CiAgdHJ5IHsKICAgIHJldHVybiBpdFtrZXldOwogIH0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfQp9OwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHsKICB2YXIgTywgVCwgQjsKICByZXR1cm4gaXQgPT09IHVuZGVmaW5lZCA/ICdVbmRlZmluZWQnIDogaXQgPT09IG51bGwgPyAnTnVsbCcKICAgIC8vIEBAdG9TdHJpbmdUYWcgY2FzZQogICAgOiB0eXBlb2YgKFQgPSB0cnlHZXQoTyA9IE9iamVjdChpdCksIFRBRykpID09ICdzdHJpbmcnID8gVAogICAgLy8gYnVpbHRpblRhZyBjYXNlCiAgICA6IEFSRyA/IGNvZihPKQogICAgLy8gRVMzIGFyZ3VtZW50cyBmYWxsYmFjawogICAgOiAoQiA9IGNvZihPKSkgPT0gJ09iamVjdCcgJiYgdHlwZW9mIE8uY2FsbGVlID09ICdmdW5jdGlvbicgPyAnQXJndW1lbnRzJyA6IEI7Cn07CgoKLyoqKi8gfSksCi8qIDY5ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCnZhciBJVEVSQVRPUiA9IF9fd2VicGFja19yZXF1aXJlX18oMCkoJ2l0ZXJhdG9yJyk7CnZhciBTQUZFX0NMT1NJTkcgPSBmYWxzZTsKCnRyeSB7CiAgdmFyIHJpdGVyID0gWzddW0lURVJBVE9SXSgpOwogIHJpdGVyWydyZXR1cm4nXSA9IGZ1bmN0aW9uICgpIHsgU0FGRV9DTE9TSU5HID0gdHJ1ZTsgfTsKICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdGhyb3ctbGl0ZXJhbAogIEFycmF5LmZyb20ocml0ZXIsIGZ1bmN0aW9uICgpIHsgdGhyb3cgMjsgfSk7Cn0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfQoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZXhlYywgc2tpcENsb3NpbmcpIHsKICBpZiAoIXNraXBDbG9zaW5nICYmICFTQUZFX0NMT1NJTkcpIHJldHVybiBmYWxzZTsKICB2YXIgc2FmZSA9IGZhbHNlOwogIHRyeSB7CiAgICB2YXIgYXJyID0gWzddOwogICAgdmFyIGl0ZXIgPSBhcnJbSVRFUkFUT1JdKCk7CiAgICBpdGVyLm5leHQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB7IGRvbmU6IHNhZmUgPSB0cnVlIH07IH07CiAgICBhcnJbSVRFUkFUT1JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gaXRlcjsgfTsKICAgIGV4ZWMoYXJyKTsKICB9IGNhdGNoIChlKSB7IC8qIGVtcHR5ICovIH0KICByZXR1cm4gc2FmZTsKfTsKCgovKioqLyB9KSwKLyogNzAgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKX193ZWJwYWNrX3JlcXVpcmVfXyg3MSk7Cm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKS5BcnJheS5pbmNsdWRlczsKCgovKioqLyB9KSwKLyogNzEgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwoKLy8gaHR0cHM6Ly9naXRodWIuY29tL3RjMzkvQXJyYXkucHJvdG90eXBlLmluY2x1ZGVzCnZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2KTsKdmFyICRpbmNsdWRlcyA9IF9fd2VicGFja19yZXF1aXJlX18oMzApKHRydWUpOwoKJGV4cG9ydCgkZXhwb3J0LlAsICdBcnJheScsIHsKICBpbmNsdWRlczogZnVuY3Rpb24gaW5jbHVkZXMoZWwgLyogLCBmcm9tSW5kZXggPSAwICovKSB7CiAgICByZXR1cm4gJGluY2x1ZGVzKHRoaXMsIGVsLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7CiAgfQp9KTsKCl9fd2VicGFja19yZXF1aXJlX18oMjgpKCdpbmNsdWRlcycpOwoKCi8qKiovIH0pLAovKiA3MiAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7CgovLyBQb2x5ZmlsbCBmb3IgY3JlYXRpbmcgQ3VzdG9tRXZlbnRzIG9uIElFOS8xMC8xMQoKLy8gY29kZSBwdWxsZWQgZnJvbToKLy8gaHR0cHM6Ly9naXRodWIuY29tL2Q0dG9jY2hpbmkvY3VzdG9tZXZlbnQtcG9seWZpbGwKLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0N1c3RvbUV2ZW50I1BvbHlmaWxsCgp0cnkgewogICAgdmFyIGNlID0gbmV3IHdpbmRvdy5DdXN0b21FdmVudCgndGVzdCcpOwogICAgY2UucHJldmVudERlZmF1bHQoKTsKICAgIGlmIChjZS5kZWZhdWx0UHJldmVudGVkICE9PSB0cnVlKSB7CiAgICAgICAgLy8gSUUgaGFzIHByb2JsZW1zIHdpdGggLnByZXZlbnREZWZhdWx0KCkgb24gY3VzdG9tIGV2ZW50cwogICAgICAgIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjMzNDkxOTEKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBwcmV2ZW50IGRlZmF1bHQnKTsKICAgIH0KfSBjYXRjaChlKSB7CiAgdmFyIEN1c3RvbUV2ZW50ID0gZnVuY3Rpb24oZXZlbnQsIHBhcmFtcykgewogICAgdmFyIGV2dCwgb3JpZ1ByZXZlbnQ7CiAgICBwYXJhbXMgPSBwYXJhbXMgfHwgewogICAgICBidWJibGVzOiBmYWxzZSwKICAgICAgY2FuY2VsYWJsZTogZmFsc2UsCiAgICAgIGRldGFpbDogdW5kZWZpbmVkCiAgICB9OwoKICAgIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJDdXN0b21FdmVudCIpOwogICAgZXZ0LmluaXRDdXN0b21FdmVudChldmVudCwgcGFyYW1zLmJ1YmJsZXMsIHBhcmFtcy5jYW5jZWxhYmxlLCBwYXJhbXMuZGV0YWlsKTsKICAgIG9yaWdQcmV2ZW50ID0gZXZ0LnByZXZlbnREZWZhdWx0OwogICAgZXZ0LnByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24gKCkgewogICAgICBvcmlnUHJldmVudC5jYWxsKHRoaXMpOwogICAgICB0cnkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnZGVmYXVsdFByZXZlbnRlZCcsIHsKICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgdGhpcy5kZWZhdWx0UHJldmVudGVkID0gdHJ1ZTsKICAgICAgfQogICAgfTsKICAgIHJldHVybiBldnQ7CiAgfTsKCiAgQ3VzdG9tRXZlbnQucHJvdG90eXBlID0gd2luZG93LkV2ZW50LnByb3RvdHlwZTsKICB3aW5kb3cuQ3VzdG9tRXZlbnQgPSBDdXN0b21FdmVudDsgLy8gZXhwb3NlIGRlZmluaXRpb24gdG8gd2luZG93Cn0KCgovKioqLyB9KSwKLyogNzMgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKdmFyIF9yZWR1eCA9IF9fd2VicGFja19yZXF1aXJlX18oMzMpOwoKdmFyIF9pbmRleCA9IF9fd2VicGFja19yZXF1aXJlX18oNzgpOwoKdmFyIF9pbmRleDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pbmRleCk7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSBlbHNlIHsgcmV0dXJuIEFycmF5LmZyb20oYXJyKTsgfSB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCnZhciBTdG9yZSA9IGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBTdG9yZSgpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTdG9yZSk7CgogICAgdGhpcy5fc3RvcmUgPSAoMCwgX3JlZHV4LmNyZWF0ZVN0b3JlKShfaW5kZXgyLmRlZmF1bHQsIHdpbmRvdy5kZXZUb29sc0V4dGVuc2lvbiA/IHdpbmRvdy5kZXZUb29sc0V4dGVuc2lvbigpIDogdW5kZWZpbmVkKTsKICB9CgogIC8qKgogICAqIFN1YnNjcmliZSBzdG9yZSB0byBmdW5jdGlvbiBjYWxsICh3cmFwcGVkIFJlZHV4IG1ldGhvZCkKICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gb25DaGFuZ2UgRnVuY3Rpb24gdG8gdHJpZ2dlciB3aGVuIHN0YXRlIGNoYW5nZXMKICAgKiBAcmV0dXJuCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoU3RvcmUsIFt7CiAgICBrZXk6ICdzdWJzY3JpYmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHN1YnNjcmliZShvbkNoYW5nZSkgewogICAgICB0aGlzLl9zdG9yZS5zdWJzY3JpYmUob25DaGFuZ2UpOwogICAgfQoKICAgIC8qKgogICAgICogRGlzcGF0Y2ggZXZlbnQgdG8gc3RvcmUgKHdyYXBwZWQgUmVkdXggbWV0aG9kKQogICAgICogQHBhcmFtICB7RnVuY3Rpb259IGFjdGlvbiBBY3Rpb24gZnVuY3Rpb24gdG8gdHJpZ2dlcgogICAgICogQHJldHVybgogICAgICovCgogIH0sIHsKICAgIGtleTogJ2Rpc3BhdGNoJywKICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNwYXRjaChhY3Rpb24pIHsKICAgICAgdGhpcy5fc3RvcmUuZGlzcGF0Y2goYWN0aW9uKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBzdG9yZSBvYmplY3QgKHdyYXBwaW5nIFJlZHV4IG1ldGhvZCkKICAgICAqIEByZXR1cm4ge09iamVjdH0gU3RhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdnZXRDaG9pY2VCeUlkJywKCgogICAgLyoqCiAgICAgKiBHZXQgc2luZ2xlIGNob2ljZSBieSBpdCdzIElECiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IEZvdW5kIGNob2ljZQogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2hvaWNlQnlJZChpZCkgewogICAgICBpZiAoaWQpIHsKICAgICAgICB2YXIgY2hvaWNlcyA9IHRoaXMuYWN0aXZlQ2hvaWNlczsKICAgICAgICB2YXIgZm91bmRDaG9pY2UgPSBjaG9pY2VzLmZpbmQoZnVuY3Rpb24gKGNob2ljZSkgewogICAgICAgICAgcmV0dXJuIGNob2ljZS5pZCA9PT0gcGFyc2VJbnQoaWQsIDEwKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZm91bmRDaG9pY2U7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGdyb3VwIGJ5IGdyb3VwIGlkCiAgICAgKiBAcGFyYW0gIHtOdW1iZXJ9IGlkIEdyb3VwIElECiAgICAgKiBAcmV0dXJuIHtPYmplY3R9ICAgIEdyb3VwIGRhdGEKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdnZXRHcm91cEJ5SWQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEdyb3VwQnlJZChpZCkgewogICAgICByZXR1cm4gdGhpcy5ncm91cHMuZmluZChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT09IHBhcnNlSW50KGlkLCAxMCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ3N0YXRlJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fc3RvcmUuZ2V0U3RhdGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBpdGVtcyBmcm9tIHN0b3JlCiAgICAgKiBAcmV0dXJuIHtBcnJheX0gSXRlbSBvYmplY3RzCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnaXRlbXMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLnN0YXRlLml0ZW1zOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGFjdGl2ZSBpdGVtcyBmcm9tIHN0b3JlCiAgICAgKiBAcmV0dXJuIHtBcnJheX0gSXRlbSBvYmplY3RzCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnYWN0aXZlSXRlbXMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLml0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLmFjdGl2ZSA9PT0gdHJ1ZTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgaGlnaGxpZ2h0ZWQgaXRlbXMgZnJvbSBzdG9yZQogICAgICogQHJldHVybiB7QXJyYXl9IEl0ZW0gb2JqZWN0cwogICAgICovCgogIH0sIHsKICAgIGtleTogJ2hpZ2hsaWdodGVkQWN0aXZlSXRlbXMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLml0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLmFjdGl2ZSAmJiBpdGVtLmhpZ2hsaWdodGVkOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBjaG9pY2VzIGZyb20gc3RvcmUKICAgICAqIEByZXR1cm4ge0FycmF5fSBPcHRpb24gb2JqZWN0cwogICAgICovCgogIH0sIHsKICAgIGtleTogJ2Nob2ljZXMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLnN0YXRlLmNob2ljZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgYWN0aXZlIGNob2ljZXMgZnJvbSBzdG9yZQogICAgICogQHJldHVybiB7QXJyYXl9IE9wdGlvbiBvYmplY3RzCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnYWN0aXZlQ2hvaWNlcycsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgdmFyIGNob2ljZXMgPSB0aGlzLmNob2ljZXM7CiAgICAgIHZhciB2YWx1ZXMgPSBjaG9pY2VzLmZpbHRlcihmdW5jdGlvbiAoY2hvaWNlKSB7CiAgICAgICAgcmV0dXJuIGNob2ljZS5hY3RpdmUgPT09IHRydWU7CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHZhbHVlczsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBzZWxlY3RhYmxlIGNob2ljZXMgZnJvbSBzdG9yZQogICAgICogQHJldHVybiB7QXJyYXl9IE9wdGlvbiBvYmplY3RzCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnc2VsZWN0YWJsZUNob2ljZXMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLmNob2ljZXMuZmlsdGVyKGZ1bmN0aW9uIChjaG9pY2UpIHsKICAgICAgICByZXR1cm4gY2hvaWNlLmRpc2FibGVkICE9PSB0cnVlOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBjaG9pY2VzIHRoYXQgY2FuIGJlIHNlYXJjaGVkIChleGNsdWRpbmcgcGxhY2Vob2xkZXJzKQogICAgICogQHJldHVybiB7QXJyYXl9IE9wdGlvbiBvYmplY3RzCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnc2VhcmNoYWJsZUNob2ljZXMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGFibGVDaG9pY2VzLmZpbHRlcihmdW5jdGlvbiAoY2hvaWNlKSB7CiAgICAgICAgcmV0dXJuIGNob2ljZS5wbGFjZWhvbGRlciAhPT0gdHJ1ZTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgcGxhY2Vob2xkZXIgY2hvaWNlIGZyb20gc3RvcmUKICAgICAqIEByZXR1cm4ge09iamVjdH0gRm91bmQgcGxhY2Vob2xkZXIKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdwbGFjZWhvbGRlckNob2ljZScsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5jaG9pY2VzKSkucmV2ZXJzZSgpLmZpbmQoZnVuY3Rpb24gKGNob2ljZSkgewogICAgICAgIHJldHVybiBjaG9pY2UucGxhY2Vob2xkZXIgPT09IHRydWU7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGdyb3VwcyBmcm9tIHN0b3JlCiAgICAgKiBAcmV0dXJuIHtBcnJheX0gR3JvdXAgb2JqZWN0cwogICAgICovCgogIH0sIHsKICAgIGtleTogJ2dyb3VwcycsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuZ3JvdXBzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGFjdGl2ZSBncm91cHMgZnJvbSBzdG9yZQogICAgICogQHJldHVybiB7QXJyYXl9IEdyb3VwIG9iamVjdHMKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdhY3RpdmVHcm91cHMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHZhciBncm91cHMgPSB0aGlzLmdyb3VwczsKICAgICAgdmFyIGNob2ljZXMgPSB0aGlzLmNob2ljZXM7CgogICAgICByZXR1cm4gZ3JvdXBzLmZpbHRlcihmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICB2YXIgaXNBY3RpdmUgPSBncm91cC5hY3RpdmUgPT09IHRydWUgJiYgZ3JvdXAuZGlzYWJsZWQgPT09IGZhbHNlOwogICAgICAgIHZhciBoYXNBY3RpdmVPcHRpb25zID0gY2hvaWNlcy5zb21lKGZ1bmN0aW9uIChjaG9pY2UpIHsKICAgICAgICAgIHJldHVybiBjaG9pY2UuYWN0aXZlID09PSB0cnVlICYmIGNob2ljZS5kaXNhYmxlZCA9PT0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGlzQWN0aXZlICYmIGhhc0FjdGl2ZU9wdGlvbnM7CiAgICAgIH0sIFtdKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBTdG9yZTsKfSgpOwoKZXhwb3J0cy5kZWZhdWx0ID0gU3RvcmU7CgovKioqLyB9KSwKLyogNzQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwovKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24oZ2xvYmFsKSB7LyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBnbG9iYWxgIGZyb20gTm9kZS5qcy4gKi8KdmFyIGZyZWVHbG9iYWwgPSB0eXBlb2YgZ2xvYmFsID09ICdvYmplY3QnICYmIGdsb2JhbCAmJiBnbG9iYWwuT2JqZWN0ID09PSBPYmplY3QgJiYgZ2xvYmFsOwoKLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyBfX3dlYnBhY2tfZXhwb3J0c19fWyJhIl0gPSAoZnJlZUdsb2JhbCk7CgovKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwoX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXygzNCkpKQoKLyoqKi8gfSksCi8qIDc1ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKGdsb2JhbCwgbW9kdWxlKSB7LyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fcG9ueWZpbGxfanNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oNzcpOwovKiBnbG9iYWwgd2luZG93ICovCgoKdmFyIHJvb3Q7CgppZiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnKSB7CiAgcm9vdCA9IHNlbGY7Cn0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHsKICByb290ID0gd2luZG93Owp9IGVsc2UgaWYgKHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnKSB7CiAgcm9vdCA9IGdsb2JhbDsKfSBlbHNlIGlmICh0cnVlKSB7CiAgcm9vdCA9IG1vZHVsZTsKfSBlbHNlIHsKICByb290ID0gRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTsKfQoKdmFyIHJlc3VsdCA9IE9iamVjdChfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX3BvbnlmaWxsX2pzX19bImEiIC8qIGRlZmF1bHQgKi9dKShyb290KTsKLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyBfX3dlYnBhY2tfZXhwb3J0c19fWyJhIl0gPSAocmVzdWx0KTsKCi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbChfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKDM0KSwgX193ZWJwYWNrX3JlcXVpcmVfXyg3NikobW9kdWxlKSkpCgovKioqLyB9KSwKLyogNzYgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvcmlnaW5hbE1vZHVsZSkgewoJaWYoIW9yaWdpbmFsTW9kdWxlLndlYnBhY2tQb2x5ZmlsbCkgewoJCXZhciBtb2R1bGUgPSBPYmplY3QuY3JlYXRlKG9yaWdpbmFsTW9kdWxlKTsKCQkvLyBtb2R1bGUucGFyZW50ID0gdW5kZWZpbmVkIGJ5IGRlZmF1bHQKCQlpZighbW9kdWxlLmNoaWxkcmVuKSBtb2R1bGUuY2hpbGRyZW4gPSBbXTsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kdWxlLCAibG9hZGVkIiwgewoJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQlnZXQ6IGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuIG1vZHVsZS5sOwoJCQl9CgkJfSk7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgImlkIiwgewoJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQlnZXQ6IGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuIG1vZHVsZS5pOwoJCQl9CgkJfSk7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgImV4cG9ydHMiLCB7CgkJCWVudW1lcmFibGU6IHRydWUsCgkJfSk7CgkJbW9kdWxlLndlYnBhY2tQb2x5ZmlsbCA9IDE7Cgl9CglyZXR1cm4gbW9kdWxlOwp9OwoKCi8qKiovIH0pLAovKiA3NyAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7Ci8qIGhhcm1vbnkgZXhwb3J0IChpbW11dGFibGUpICovIF9fd2VicGFja19leHBvcnRzX19bImEiXSA9IHN5bWJvbE9ic2VydmFibGVQb255ZmlsbDsKZnVuY3Rpb24gc3ltYm9sT2JzZXJ2YWJsZVBvbnlmaWxsKHJvb3QpIHsKCXZhciByZXN1bHQ7Cgl2YXIgU3ltYm9sID0gcm9vdC5TeW1ib2w7CgoJaWYgKHR5cGVvZiBTeW1ib2wgPT09ICdmdW5jdGlvbicpIHsKCQlpZiAoU3ltYm9sLm9ic2VydmFibGUpIHsKCQkJcmVzdWx0ID0gU3ltYm9sLm9ic2VydmFibGU7CgkJfSBlbHNlIHsKCQkJcmVzdWx0ID0gU3ltYm9sKCdvYnNlcnZhYmxlJyk7CgkJCVN5bWJvbC5vYnNlcnZhYmxlID0gcmVzdWx0OwoJCX0KCX0gZWxzZSB7CgkJcmVzdWx0ID0gJ0BAb2JzZXJ2YWJsZSc7Cgl9CgoJcmV0dXJuIHJlc3VsdDsKfTsKCgovKioqLyB9KSwKLyogNzggKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfcmVkdXggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMzKTsKCnZhciBfaXRlbXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc5KTsKCnZhciBfaXRlbXMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaXRlbXMpOwoKdmFyIF9ncm91cHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgwKTsKCnZhciBfZ3JvdXBzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2dyb3Vwcyk7Cgp2YXIgX2Nob2ljZXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgxKTsKCnZhciBfY2hvaWNlczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jaG9pY2VzKTsKCnZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCnZhciBhcHBSZWR1Y2VyID0gKDAsIF9yZWR1eC5jb21iaW5lUmVkdWNlcnMpKHsKICBpdGVtczogX2l0ZW1zMi5kZWZhdWx0LAogIGdyb3VwczogX2dyb3VwczIuZGVmYXVsdCwKICBjaG9pY2VzOiBfY2hvaWNlczIuZGVmYXVsdAp9KTsKCnZhciByb290UmVkdWNlciA9IGZ1bmN0aW9uIHJvb3RSZWR1Y2VyKHBhc3NlZFN0YXRlLCBhY3Rpb24pIHsKICB2YXIgc3RhdGUgPSBwYXNzZWRTdGF0ZTsKICAvLyBJZiB3ZSBhcmUgY2xlYXJpbmcgYWxsIGl0ZW1zLCBncm91cHMgYW5kIG9wdGlvbnMgd2UgcmVhc3NpZ24KICAvLyBzdGF0ZSBhbmQgdGhlbiBwYXNzIHRoYXQgc3RhdGUgdG8gb3VyIHByb3BlciByZWR1Y2VyLiBUaGlzIGlzbid0CiAgLy8gbXV0YXRpbmcgb3VyIGFjdHVhbCBzdGF0ZQogIC8vIFNlZTogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMzU2NDE5OTIKICBpZiAoYWN0aW9uLnR5cGUgPT09ICdDTEVBUl9BTEwnKSB7CiAgICBzdGF0ZSA9IHVuZGVmaW5lZDsKICB9IGVsc2UgaWYgKGFjdGlvbi50eXBlID09PSAnUkVTRVRfVE8nKSB7CiAgICByZXR1cm4gKDAsIF91dGlscy5jbG9uZU9iamVjdCkoYWN0aW9uLnN0YXRlKTsKICB9CgogIHJldHVybiBhcHBSZWR1Y2VyKHN0YXRlLCBhY3Rpb24pOwp9OwoKZXhwb3J0cy5kZWZhdWx0ID0gcm9vdFJlZHVjZXI7CgovKioqLyB9KSwKLyogNzkgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5kZWZhdWx0ID0gaXRlbXM7CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IGVsc2UgeyByZXR1cm4gQXJyYXkuZnJvbShhcnIpOyB9IH0KCnZhciBkZWZhdWx0U3RhdGUgPSBleHBvcnRzLmRlZmF1bHRTdGF0ZSA9IFtdOwoKZnVuY3Rpb24gaXRlbXMoKSB7CiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBkZWZhdWx0U3RhdGU7CiAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50c1sxXTsKCiAgc3dpdGNoIChhY3Rpb24udHlwZSkgewogICAgY2FzZSAnQUREX0lURU0nOgogICAgICB7CiAgICAgICAgLy8gQWRkIG9iamVjdCB0byBpdGVtcyBhcnJheQogICAgICAgIHZhciBuZXdTdGF0ZSA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoc3RhdGUpLCBbewogICAgICAgICAgaWQ6IGFjdGlvbi5pZCwKICAgICAgICAgIGNob2ljZUlkOiBhY3Rpb24uY2hvaWNlSWQsCiAgICAgICAgICBncm91cElkOiBhY3Rpb24uZ3JvdXBJZCwKICAgICAgICAgIHZhbHVlOiBhY3Rpb24udmFsdWUsCiAgICAgICAgICBsYWJlbDogYWN0aW9uLmxhYmVsLAogICAgICAgICAgYWN0aXZlOiB0cnVlLAogICAgICAgICAgaGlnaGxpZ2h0ZWQ6IGZhbHNlLAogICAgICAgICAgY3VzdG9tUHJvcGVydGllczogYWN0aW9uLmN1c3RvbVByb3BlcnRpZXMsCiAgICAgICAgICBwbGFjZWhvbGRlcjogYWN0aW9uLnBsYWNlaG9sZGVyIHx8IGZhbHNlLAogICAgICAgICAga2V5Q29kZTogbnVsbAogICAgICAgIH1dKTsKCiAgICAgICAgcmV0dXJuIG5ld1N0YXRlLm1hcChmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICB2YXIgaXRlbSA9IG9iajsKICAgICAgICAgIGl0ZW0uaGlnaGxpZ2h0ZWQgPSBmYWxzZTsKICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgIH0pOwogICAgICB9CgogICAgY2FzZSAnUkVNT1ZFX0lURU0nOgogICAgICB7CiAgICAgICAgLy8gU2V0IGl0ZW0gdG8gaW5hY3RpdmUKICAgICAgICByZXR1cm4gc3RhdGUubWFwKGZ1bmN0aW9uIChvYmopIHsKICAgICAgICAgIHZhciBpdGVtID0gb2JqOwogICAgICAgICAgaWYgKGl0ZW0uaWQgPT09IGFjdGlvbi5pZCkgewogICAgICAgICAgICBpdGVtLmFjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICBjYXNlICdISUdITElHSFRfSVRFTSc6CiAgICAgIHsKICAgICAgICByZXR1cm4gc3RhdGUubWFwKGZ1bmN0aW9uIChvYmopIHsKICAgICAgICAgIHZhciBpdGVtID0gb2JqOwogICAgICAgICAgaWYgKGl0ZW0uaWQgPT09IGFjdGlvbi5pZCkgewogICAgICAgICAgICBpdGVtLmhpZ2hsaWdodGVkID0gYWN0aW9uLmhpZ2hsaWdodGVkOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICBkZWZhdWx0OgogICAgICB7CiAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICB9CiAgfQp9CgovKioqLyB9KSwKLyogODAgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5kZWZhdWx0ID0gZ3JvdXBzOwoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSBlbHNlIHsgcmV0dXJuIEFycmF5LmZyb20oYXJyKTsgfSB9Cgp2YXIgZGVmYXVsdFN0YXRlID0gZXhwb3J0cy5kZWZhdWx0U3RhdGUgPSBbXTsKCmZ1bmN0aW9uIGdyb3VwcygpIHsKICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IGRlZmF1bHRTdGF0ZTsKICB2YXIgYWN0aW9uID0gYXJndW1lbnRzWzFdOwoKICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7CiAgICBjYXNlICdBRERfR1JPVVAnOgogICAgICB7CiAgICAgICAgcmV0dXJuIFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoc3RhdGUpLCBbewogICAgICAgICAgaWQ6IGFjdGlvbi5pZCwKICAgICAgICAgIHZhbHVlOiBhY3Rpb24udmFsdWUsCiAgICAgICAgICBhY3RpdmU6IGFjdGlvbi5hY3RpdmUsCiAgICAgICAgICBkaXNhYmxlZDogYWN0aW9uLmRpc2FibGVkCiAgICAgICAgfV0pOwogICAgICB9CgogICAgY2FzZSAnQ0xFQVJfQ0hPSUNFUyc6CiAgICAgIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KCiAgICBkZWZhdWx0OgogICAgICB7CiAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICB9CiAgfQp9CgovKioqLyB9KSwKLyogODEgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5kZWZhdWx0ID0gY2hvaWNlczsKCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gZWxzZSB7IHJldHVybiBBcnJheS5mcm9tKGFycik7IH0gfQoKdmFyIGRlZmF1bHRTdGF0ZSA9IGV4cG9ydHMuZGVmYXVsdFN0YXRlID0gW107CgpmdW5jdGlvbiBjaG9pY2VzKCkgewogIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZGVmYXVsdFN0YXRlOwogIHZhciBhY3Rpb24gPSBhcmd1bWVudHNbMV07CgogIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHsKICAgIGNhc2UgJ0FERF9DSE9JQ0UnOgogICAgICB7CiAgICAgICAgLyoKICAgICAgICAgICAgQSBkaXNhYmxlZCBjaG9pY2UgYXBwZWFycyBpbiB0aGUgY2hvaWNlIGRyb3Bkb3duIGJ1dCBjYW5ub3QgYmUgc2VsZWN0ZWQKICAgICAgICAgICAgQSBzZWxlY3RlZCBjaG9pY2UgaGFzIGJlZW4gYWRkZWQgdG8gdGhlIHBhc3NlZCBpbnB1dCdzIHZhbHVlIChhZGRlZCBhcyBhbiBpdGVtKQogICAgICAgICAgICBBbiBhY3RpdmUgY2hvaWNlIGFwcGVhcnMgd2l0aGluIHRoZSBjaG9pY2UgZHJvcGRvd24KICAgICAgICAgKi8KICAgICAgICByZXR1cm4gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShzdGF0ZSksIFt7CiAgICAgICAgICBpZDogYWN0aW9uLmlkLAogICAgICAgICAgZWxlbWVudElkOiBhY3Rpb24uZWxlbWVudElkLAogICAgICAgICAgZ3JvdXBJZDogYWN0aW9uLmdyb3VwSWQsCiAgICAgICAgICB2YWx1ZTogYWN0aW9uLnZhbHVlLAogICAgICAgICAgbGFiZWw6IGFjdGlvbi5sYWJlbCB8fCBhY3Rpb24udmFsdWUsCiAgICAgICAgICBkaXNhYmxlZDogYWN0aW9uLmRpc2FibGVkIHx8IGZhbHNlLAogICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlLAogICAgICAgICAgYWN0aXZlOiB0cnVlLAogICAgICAgICAgc2NvcmU6IDk5OTksCiAgICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzOiBhY3Rpb24uY3VzdG9tUHJvcGVydGllcywKICAgICAgICAgIHBsYWNlaG9sZGVyOiBhY3Rpb24ucGxhY2Vob2xkZXIgfHwgZmFsc2UsCiAgICAgICAgICBrZXlDb2RlOiBudWxsCiAgICAgICAgfV0pOwogICAgICB9CgogICAgY2FzZSAnQUREX0lURU0nOgogICAgICB7CiAgICAgICAgLy8gSWYgYWxsIGNob2ljZXMgbmVlZCB0byBiZSBhY3RpdmF0ZWQKICAgICAgICBpZiAoYWN0aW9uLmFjdGl2YXRlT3B0aW9ucykgewogICAgICAgICAgcmV0dXJuIHN0YXRlLm1hcChmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICAgIHZhciBjaG9pY2UgPSBvYmo7CiAgICAgICAgICAgIGNob2ljZS5hY3RpdmUgPSBhY3Rpb24uYWN0aXZlOwogICAgICAgICAgICByZXR1cm4gY2hvaWNlOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBXaGVuIGFuIGl0ZW0gaXMgYWRkZWQgYW5kIGl0IGhhcyBhbiBhc3NvY2lhdGVkIGNob2ljZSwKICAgICAgICAvLyB3ZSB3YW50IHRvIGRpc2FibGUgaXQgc28gaXQgY2FuJ3QgYmUgY2hvc2VuIGFnYWluCiAgICAgICAgaWYgKGFjdGlvbi5jaG9pY2VJZCA+IC0xKSB7CiAgICAgICAgICByZXR1cm4gc3RhdGUubWFwKGZ1bmN0aW9uIChvYmopIHsKICAgICAgICAgICAgdmFyIGNob2ljZSA9IG9iajsKICAgICAgICAgICAgaWYgKGNob2ljZS5pZCA9PT0gcGFyc2VJbnQoYWN0aW9uLmNob2ljZUlkLCAxMCkpIHsKICAgICAgICAgICAgICBjaG9pY2Uuc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjaG9pY2U7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgfQoKICAgIGNhc2UgJ1JFTU9WRV9JVEVNJzoKICAgICAgewogICAgICAgIC8vIFdoZW4gYW4gaXRlbSBpcyByZW1vdmVkIGFuZCBpdCBoYXMgYW4gYXNzb2NpYXRlZCBjaG9pY2UsCiAgICAgICAgLy8gd2Ugd2FudCB0byByZS1lbmFibGUgaXQgc28gaXQgY2FuIGJlIGNob3NlbiBhZ2FpbgogICAgICAgIGlmIChhY3Rpb24uY2hvaWNlSWQgPiAtMSkgewogICAgICAgICAgcmV0dXJuIHN0YXRlLm1hcChmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICAgIHZhciBjaG9pY2UgPSBvYmo7CiAgICAgICAgICAgIGlmIChjaG9pY2UuaWQgPT09IHBhcnNlSW50KGFjdGlvbi5jaG9pY2VJZCwgMTApKSB7CiAgICAgICAgICAgICAgY2hvaWNlLnNlbGVjdGVkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNob2ljZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICB9CgogICAgY2FzZSAnRklMVEVSX0NIT0lDRVMnOgogICAgICB7CiAgICAgICAgcmV0dXJuIHN0YXRlLm1hcChmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICB2YXIgY2hvaWNlID0gb2JqOwogICAgICAgICAgLy8gU2V0IGFjdGl2ZSBzdGF0ZSBiYXNlZCBvbiB3aGV0aGVyIGNob2ljZSBpcwogICAgICAgICAgLy8gd2l0aGluIGZpbHRlcmVkIHJlc3VsdHMKICAgICAgICAgIGNob2ljZS5hY3RpdmUgPSBhY3Rpb24ucmVzdWx0cy5zb21lKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgICAgIHZhciBpdGVtID0gX3JlZi5pdGVtLAogICAgICAgICAgICAgICAgc2NvcmUgPSBfcmVmLnNjb3JlOwoKICAgICAgICAgICAgaWYgKGl0ZW0uaWQgPT09IGNob2ljZS5pZCkgewogICAgICAgICAgICAgIGNob2ljZS5zY29yZSA9IHNjb3JlOwogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybiBjaG9pY2U7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICBjYXNlICdBQ1RJVkFURV9DSE9JQ0VTJzoKICAgICAgewogICAgICAgIHJldHVybiBzdGF0ZS5tYXAoZnVuY3Rpb24gKG9iaikgewogICAgICAgICAgdmFyIGNob2ljZSA9IG9iajsKICAgICAgICAgIGNob2ljZS5hY3RpdmUgPSBhY3Rpb24uYWN0aXZlOwogICAgICAgICAgcmV0dXJuIGNob2ljZTsKICAgICAgICB9KTsKICAgICAgfQoKICAgIGNhc2UgJ0NMRUFSX0NIT0lDRVMnOgogICAgICB7CiAgICAgICAgcmV0dXJuIGRlZmF1bHRTdGF0ZTsKICAgICAgfQoKICAgIGRlZmF1bHQ6CiAgICAgIHsKICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgIH0KICB9Cn0KCi8qKiovIH0pLAovKiA4MiAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLldyYXBwZWRTZWxlY3QgPSBleHBvcnRzLldyYXBwZWRJbnB1dCA9IGV4cG9ydHMuTGlzdCA9IGV4cG9ydHMuSW5wdXQgPSBleHBvcnRzLkNvbnRhaW5lciA9IGV4cG9ydHMuRHJvcGRvd24gPSB1bmRlZmluZWQ7Cgp2YXIgX2Ryb3Bkb3duID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4Myk7Cgp2YXIgX2Ryb3Bkb3duMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2Ryb3Bkb3duKTsKCnZhciBfY29udGFpbmVyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NCk7Cgp2YXIgX2NvbnRhaW5lcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jb250YWluZXIpOwoKdmFyIF9pbnB1dCA9IF9fd2VicGFja19yZXF1aXJlX18oODUpOwoKdmFyIF9pbnB1dDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pbnB1dCk7Cgp2YXIgX2xpc3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg2KTsKCnZhciBfbGlzdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9saXN0KTsKCnZhciBfd3JhcHBlZElucHV0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4Nyk7Cgp2YXIgX3dyYXBwZWRJbnB1dDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF93cmFwcGVkSW5wdXQpOwoKdmFyIF93cmFwcGVkU2VsZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4OCk7Cgp2YXIgX3dyYXBwZWRTZWxlY3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfd3JhcHBlZFNlbGVjdCk7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZXhwb3J0cy5Ecm9wZG93biA9IF9kcm9wZG93bjIuZGVmYXVsdDsKZXhwb3J0cy5Db250YWluZXIgPSBfY29udGFpbmVyMi5kZWZhdWx0OwpleHBvcnRzLklucHV0ID0gX2lucHV0Mi5kZWZhdWx0OwpleHBvcnRzLkxpc3QgPSBfbGlzdDIuZGVmYXVsdDsKZXhwb3J0cy5XcmFwcGVkSW5wdXQgPSBfd3JhcHBlZElucHV0Mi5kZWZhdWx0OwpleHBvcnRzLldyYXBwZWRTZWxlY3QgPSBfd3JhcHBlZFNlbGVjdDIuZGVmYXVsdDsKCi8qKiovIH0pLAovKiA4MyAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCnZhciBEcm9wZG93biA9IGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBEcm9wZG93bihfcmVmKSB7CiAgICB2YXIgZWxlbWVudCA9IF9yZWYuZWxlbWVudCwKICAgICAgICB0eXBlID0gX3JlZi50eXBlLAogICAgICAgIGNsYXNzTmFtZXMgPSBfcmVmLmNsYXNzTmFtZXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERyb3Bkb3duKTsKCiAgICBPYmplY3QuYXNzaWduKHRoaXMsIHsgZWxlbWVudDogZWxlbWVudCwgdHlwZTogdHlwZSwgY2xhc3NOYW1lczogY2xhc3NOYW1lcyB9KTsKCiAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7CiAgfQoKICAvKioKICAgKiBEZXRlcm1pbmUgaG93IGZhciB0aGUgdG9wIG9mIG91ciBlbGVtZW50IGlzIGZyb20KICAgKiB0aGUgdG9wIG9mIHRoZSB3aW5kb3cKICAgKiBAcmV0dXJuIHtOdW1iZXJ9IFZlcnRpY2FsIHBvc2l0aW9uCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoRHJvcGRvd24sIFt7CiAgICBrZXk6ICdkaXN0YW5jZUZyb21Ub3BXaW5kb3cnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3RhbmNlRnJvbVRvcFdpbmRvdygpIHsKICAgICAgdGhpcy5kaW1lbnNpb25zID0gdGhpcy5lbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICB0aGlzLnBvc2l0aW9uID0gTWF0aC5jZWlsKHRoaXMuZGltZW5zaW9ucy50b3AgKyB3aW5kb3cucGFnZVlPZmZzZXQgKyB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0KTsKICAgICAgcmV0dXJuIHRoaXMucG9zaXRpb247CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5kIGVsZW1lbnQgdGhhdCBtYXRjaGVzIHBhc3NlZCBzZWxlY3RvcgogICAgICogQHJldHVybiB7SFRNTEVsZW1lbnR9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnZ2V0Q2hpbGQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENoaWxkKHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBTaG93IGRyb3Bkb3duIHRvIHVzZXIgYnkgYWRkaW5nIGFjdGl2ZSBzdGF0ZSBjbGFzcwogICAgICogQHJldHVybiB7T2JqZWN0fSBDbGFzcyBpbnN0YW5jZQogICAgICogQHB1YmxpYwogICAgICovCgogIH0sIHsKICAgIGtleTogJ3Nob3cnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNob3coKSB7CiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuY2xhc3NOYW1lcy5hY3RpdmVTdGF0ZSk7CiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpOwogICAgICB0aGlzLmlzQWN0aXZlID0gdHJ1ZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBIaWRlIGRyb3Bkb3duIGZyb20gdXNlcgogICAgICogQHJldHVybiB7T2JqZWN0fSBDbGFzcyBpbnN0YW5jZQogICAgICogQHB1YmxpYwogICAgICovCgogIH0sIHsKICAgIGtleTogJ2hpZGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhpZGUoKSB7CiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2xhc3NOYW1lcy5hY3RpdmVTdGF0ZSk7CiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnKTsKICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9XSk7CgogIHJldHVybiBEcm9wZG93bjsKfSgpOwoKZXhwb3J0cy5kZWZhdWx0ID0gRHJvcGRvd247CgovKioqLyB9KSwKLyogODQgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwoKdmFyIF91dGlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCnZhciBDb250YWluZXIgPSBmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gQ29udGFpbmVyKF9yZWYpIHsKICAgIHZhciBlbGVtZW50ID0gX3JlZi5lbGVtZW50LAogICAgICAgIHR5cGUgPSBfcmVmLnR5cGUsCiAgICAgICAgY2xhc3NOYW1lcyA9IF9yZWYuY2xhc3NOYW1lcywKICAgICAgICBwb3NpdGlvbiA9IF9yZWYucG9zaXRpb247CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENvbnRhaW5lcik7CgogICAgT2JqZWN0LmFzc2lnbih0aGlzLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIGNsYXNzTmFtZXM6IGNsYXNzTmFtZXMsIHR5cGU6IHR5cGUsIHBvc2l0aW9uOiBwb3NpdGlvbiB9KTsKCiAgICB0aGlzLmlzT3BlbiA9IGZhbHNlOwogICAgdGhpcy5pc0ZsaXBwZWQgPSBmYWxzZTsKICAgIHRoaXMuaXNGb2N1c3NlZCA9IGZhbHNlOwogICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7CiAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgIHRoaXMuX29uRm9jdXMgPSB0aGlzLl9vbkZvY3VzLmJpbmQodGhpcyk7CiAgICB0aGlzLl9vbkJsdXIgPSB0aGlzLl9vbkJsdXIuYmluZCh0aGlzKTsKICB9CgogIC8qKgogICAqIEFkZCBldmVudCBsaXN0ZW5lcnMKICAgKi8KCgogIF9jcmVhdGVDbGFzcyhDb250YWluZXIsIFt7CiAgICBrZXk6ICdhZGRFdmVudExpc3RlbmVycycsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcnMoKSB7CiAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX29uRm9jdXMpOwogICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIHRoaXMuX29uQmx1cik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgZXZlbnQgbGlzdGVuZXJzCiAgICAgKi8KCiAgICAvKiogKi8KCiAgfSwgewogICAga2V5OiAncmVtb3ZlRXZlbnRMaXN0ZW5lcnMnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkgewogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9vbkZvY3VzKTsKICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOwogICAgfQoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lIHdoZXRoZXIgY29udGFpbmVyIHNob3VsZCBiZSBmbGlwcGVkCiAgICAgKiBiYXNlZCBvbiBwYXNzZWQgZHJvcGRvd24gcG9zaXRpb24KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkcm9wZG93blBvcwogICAgICogQHJldHVybnMKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdzaG91bGRGbGlwJywKICAgIHZhbHVlOiBmdW5jdGlvbiBzaG91bGRGbGlwKGRyb3Bkb3duUG9zKSB7CiAgICAgIHZhciB3aW5kb3dIZWlnaHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICgwLCBfdXRpbHMuZ2V0V2luZG93SGVpZ2h0KSgpOwoKICAgICAgaWYgKGRyb3Bkb3duUG9zID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIC8vIElmIGZsaXAgaXMgZW5hYmxlZCBhbmQgdGhlIGRyb3Bkb3duIGJvdHRvbSBwb3NpdGlvbiBpcwogICAgICAvLyBncmVhdGVyIHRoYW4gdGhlIHdpbmRvdyBoZWlnaHQgZmxpcCB0aGUgZHJvcGRvd24uCiAgICAgIHZhciBzaG91bGRGbGlwID0gZmFsc2U7CiAgICAgIGlmICh0aGlzLnBvc2l0aW9uID09PSAnYXV0bycpIHsKICAgICAgICBzaG91bGRGbGlwID0gZHJvcGRvd25Qb3MgPj0gd2luZG93SGVpZ2h0OwogICAgICB9IGVsc2UgaWYgKHRoaXMucG9zaXRpb24gPT09ICd0b3AnKSB7CiAgICAgICAgc2hvdWxkRmxpcCA9IHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBzaG91bGRGbGlwOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGFjdGl2ZSBkZXNjZW5kYW50IGF0dHJpYnV0ZQogICAgICogQHBhcmFtIHtOdW1iZXJ9IGFjdGl2ZURlc2NlbmRhbnQgSUQgb2YgYWN0aXZlIGRlc2NlbmRhbnQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdzZXRBY3RpdmVEZXNjZW5kYW50JywKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRBY3RpdmVEZXNjZW5kYW50KGFjdGl2ZURlc2NlbmRhbnRJRCkgewogICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWFjdGl2ZWRlc2NlbmRhbnQnLCBhY3RpdmVEZXNjZW5kYW50SUQpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGFjdGl2ZSBkZXNjZW5kYW50IGF0dHJpYnV0ZQogICAgICovCgogIH0sIHsKICAgIGtleTogJ3JlbW92ZUFjdGl2ZURlc2NlbmRhbnQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUFjdGl2ZURlc2NlbmRhbnQoKSB7CiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcpOwogICAgfQogIH0sIHsKICAgIGtleTogJ29wZW4nLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9wZW4oZHJvcGRvd25Qb3MpIHsKICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5jbGFzc05hbWVzLm9wZW5TdGF0ZSk7CiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpOwogICAgICB0aGlzLmlzT3BlbiA9IHRydWU7CgogICAgICBpZiAodGhpcy5zaG91bGRGbGlwKGRyb3Bkb3duUG9zKSkgewogICAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuY2xhc3NOYW1lcy5mbGlwcGVkU3RhdGUpOwogICAgICAgIHRoaXMuaXNGbGlwcGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ2Nsb3NlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5jbGFzc05hbWVzLm9wZW5TdGF0ZSk7CiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnKTsKICAgICAgdGhpcy5yZW1vdmVBY3RpdmVEZXNjZW5kYW50KCk7CiAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7CgogICAgICAvLyBBIGRyb3Bkb3duIGZsaXBzIGlmIGl0IGRvZXMgbm90IGhhdmUgc3BhY2Ugd2l0aGluIHRoZSBwYWdlCiAgICAgIGlmICh0aGlzLmlzRmxpcHBlZCkgewogICAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2xhc3NOYW1lcy5mbGlwcGVkU3RhdGUpOwogICAgICAgIHRoaXMuaXNGbGlwcGVkID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdmb2N1cycsCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9jdXMoKSB7CiAgICAgIGlmICghdGhpcy5pc0ZvY3Vzc2VkKSB7CiAgICAgICAgdGhpcy5lbGVtZW50LmZvY3VzKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdhZGRGb2N1c1N0YXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRGb2N1c1N0YXRlKCkgewogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLmNsYXNzTmFtZXMuZm9jdXNTdGF0ZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAncmVtb3ZlRm9jdXNTdGF0ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlRm9jdXNTdGF0ZSgpIHsKICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5jbGFzc05hbWVzLmZvY3VzU3RhdGUpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGRpc2FibGVkIHN0YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAnZW5hYmxlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBlbmFibGUoKSB7CiAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2xhc3NOYW1lcy5kaXNhYmxlZFN0YXRlKTsKICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1kaXNhYmxlZCcpOwogICAgICBpZiAodGhpcy50eXBlID09PSAnc2VsZWN0LW9uZScpIHsKICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7CiAgICAgIH0KICAgICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgZGlzYWJsZWQgc3RhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdkaXNhYmxlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNhYmxlKCkgewogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLmNsYXNzTmFtZXMuZGlzYWJsZWRTdGF0ZSk7CiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZGlzYWJsZWQnLCAndHJ1ZScpOwogICAgICBpZiAodGhpcy50eXBlID09PSAnc2VsZWN0LW9uZScpIHsKICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICctMScpOwogICAgICB9CiAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IHRydWU7CiAgICB9CiAgfSwgewogICAga2V5OiAnd3JhcCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gd3JhcChlbGVtZW50KSB7CiAgICAgICgwLCBfdXRpbHMud3JhcCkoZWxlbWVudCwgdGhpcy5lbGVtZW50KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICd1bndyYXAnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVud3JhcChlbGVtZW50KSB7CiAgICAgIC8vIE1vdmUgcGFzc2VkIGVsZW1lbnQgb3V0c2lkZSB0aGlzIGVsZW1lbnQKICAgICAgdGhpcy5lbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsZW1lbnQsIHRoaXMuZWxlbWVudCk7CiAgICAgIC8vIFJlbW92ZSB0aGlzIGVsZW1lbnQKICAgICAgdGhpcy5lbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lbGVtZW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBsb2FkaW5nIHN0YXRlIHRvIGVsZW1lbnQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdhZGRMb2FkaW5nU3RhdGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZExvYWRpbmdTdGF0ZSgpIHsKICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5jbGFzc05hbWVzLmxvYWRpbmdTdGF0ZSk7CiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtYnVzeScsICd0cnVlJyk7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBsb2FkaW5nIHN0YXRlIGZyb20gZWxlbWVudAogICAgICovCgogIH0sIHsKICAgIGtleTogJ3JlbW92ZUxvYWRpbmdTdGF0ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlTG9hZGluZ1N0YXRlKCkgewogICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmNsYXNzTmFtZXMubG9hZGluZ1N0YXRlKTsKICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1idXN5Jyk7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgZm9jdXNzZWQgc3RhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdfb25Gb2N1cycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRm9jdXMoKSB7CiAgICAgIHRoaXMuaXNGb2N1c3NlZCA9IHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYmx1cnJlZCBzdGF0ZQogICAgICovCgogIH0sIHsKICAgIGtleTogJ19vbkJsdXInLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbkJsdXIoKSB7CiAgICAgIHRoaXMuaXNGb2N1c3NlZCA9IGZhbHNlOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIENvbnRhaW5lcjsKfSgpOwoKZXhwb3J0cy5kZWZhdWx0ID0gQ29udGFpbmVyOwoKLyoqKi8gfSksCi8qIDg1ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsKCnZhciBfdXRpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9Cgp2YXIgSW5wdXQgPSBmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gSW5wdXQoX3JlZikgewogICAgdmFyIGVsZW1lbnQgPSBfcmVmLmVsZW1lbnQsCiAgICAgICAgdHlwZSA9IF9yZWYudHlwZSwKICAgICAgICBjbGFzc05hbWVzID0gX3JlZi5jbGFzc05hbWVzLAogICAgICAgIHBsYWNlaG9sZGVyVmFsdWUgPSBfcmVmLnBsYWNlaG9sZGVyVmFsdWU7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIElucHV0KTsKCiAgICBPYmplY3QuYXNzaWduKHRoaXMsIHsgZWxlbWVudDogZWxlbWVudCwgdHlwZTogdHlwZSwgY2xhc3NOYW1lczogY2xhc3NOYW1lcywgcGxhY2Vob2xkZXJWYWx1ZTogcGxhY2Vob2xkZXJWYWx1ZSB9KTsKCiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwogICAgdGhpcy5jbGFzc05hbWVzID0gY2xhc3NOYW1lczsKICAgIHRoaXMuaXNGb2N1c3NlZCA9IHRoaXMuZWxlbWVudCA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlOwoKICAgIC8vIEJpbmQgZXZlbnQgbGlzdGVuZXJzCiAgICB0aGlzLl9vblBhc3RlID0gdGhpcy5fb25QYXN0ZS5iaW5kKHRoaXMpOwogICAgdGhpcy5fb25JbnB1dCA9IHRoaXMuX29uSW5wdXQuYmluZCh0aGlzKTsKICAgIHRoaXMuX29uRm9jdXMgPSB0aGlzLl9vbkZvY3VzLmJpbmQodGhpcyk7CiAgICB0aGlzLl9vbkJsdXIgPSB0aGlzLl9vbkJsdXIuYmluZCh0aGlzKTsKICB9CgogIF9jcmVhdGVDbGFzcyhJbnB1dCwgW3sKICAgIGtleTogJ2FkZEV2ZW50TGlzdGVuZXJzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVycygpIHsKICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdGhpcy5fb25JbnB1dCk7CiAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdwYXN0ZScsIHRoaXMuX29uUGFzdGUpOwogICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9vbkZvY3VzKTsKICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCB0aGlzLl9vbkJsdXIpOwoKICAgICAgaWYgKHRoaXMuZWxlbWVudC5mb3JtKSB7CiAgICAgICAgdGhpcy5lbGVtZW50LmZvcm0uYWRkRXZlbnRMaXN0ZW5lcigncmVzZXQnLCB0aGlzLl9vbkZvcm1SZXNldCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdyZW1vdmVFdmVudExpc3RlbmVycycsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKSB7CiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdpbnB1dCcsIHRoaXMuX29uSW5wdXQpOwogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncGFzdGUnLCB0aGlzLl9vblBhc3RlKTsKICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fb25Gb2N1cyk7CiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5fb25CbHVyKTsKCiAgICAgIGlmICh0aGlzLmVsZW1lbnQuZm9ybSkgewogICAgICAgIHRoaXMuZWxlbWVudC5mb3JtLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2V0JywgdGhpcy5fb25Gb3JtUmVzZXQpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnZW5hYmxlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBlbmFibGUoKSB7CiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7CiAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlOwogICAgfQogIH0sIHsKICAgIGtleTogJ2Rpc2FibGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2FibGUoKSB7CiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpOwogICAgICB0aGlzLmlzRGlzYWJsZWQgPSB0cnVlOwogICAgfQogIH0sIHsKICAgIGtleTogJ2ZvY3VzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBmb2N1cygpIHsKICAgICAgaWYgKCF0aGlzLmlzRm9jdXNzZWQpIHsKICAgICAgICB0aGlzLmVsZW1lbnQuZm9jdXMoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ2JsdXInLAogICAgdmFsdWU6IGZ1bmN0aW9uIGJsdXIoKSB7CiAgICAgIGlmICh0aGlzLmlzRm9jdXNzZWQpIHsKICAgICAgICB0aGlzLmVsZW1lbnQuYmx1cigpOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdmFsdWUgb2YgaW5wdXQgdG8gYmxhbmsKICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2xhc3MgaW5zdGFuY2UKICAgICAqIEBwdWJsaWMKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdjbGVhcicsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXIoKSB7CiAgICAgIHZhciBzZXRXaWR0aCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmVsZW1lbnQudmFsdWUpIHsKICAgICAgICB0aGlzLmVsZW1lbnQudmFsdWUgPSAnJzsKICAgICAgfQoKICAgICAgaWYgKHNldFdpZHRoKSB7CiAgICAgICAgdGhpcy5zZXRXaWR0aCgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgY29ycmVjdCBpbnB1dCB3aWR0aCBiYXNlZCBvbiBwbGFjZWhvbGRlcgogICAgICogdmFsdWUgb3IgaW5wdXQgdmFsdWUKICAgICAqIEByZXR1cm4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdzZXRXaWR0aCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0V2lkdGgoZW5mb3JjZVdpZHRoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgY2FsbGJhY2sgPSBmdW5jdGlvbiBjYWxsYmFjayh3aWR0aCkgewogICAgICAgIF90aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSB3aWR0aDsKICAgICAgfTsKCiAgICAgIGlmICh0aGlzLl9wbGFjZWhvbGRlclZhbHVlKSB7CiAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBwbGFjZWhvbGRlciwgd2Ugb25seSB3YW50IHRvIHNldCB0aGUgd2lkdGggb2YgdGhlIGlucHV0IHdoZW4gaXQgaXMgYSBncmVhdGVyCiAgICAgICAgLy8gbGVuZ3RoIHRoYW4gNzUlIG9mIHRoZSBwbGFjZWhvbGRlci4gVGhpcyBzdG9wcyB0aGUgaW5wdXQganVtcGluZyBhcm91bmQuCiAgICAgICAgdmFyIHZhbHVlSGFzRGVzaXJlZExlbmd0aCA9IHRoaXMuZWxlbWVudC52YWx1ZS5sZW5ndGggPj0gdGhpcy5fcGxhY2Vob2xkZXJWYWx1ZS5sZW5ndGggLyAxLjI1OwoKICAgICAgICBpZiAodGhpcy5lbGVtZW50LnZhbHVlICYmIHZhbHVlSGFzRGVzaXJlZExlbmd0aCB8fCBlbmZvcmNlV2lkdGgpIHsKICAgICAgICAgIHRoaXMuY2FsY1dpZHRoKGNhbGxiYWNrKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gcGxhY2Vob2xkZXIsIHJlc2l6ZSBpbnB1dCB0byBjb250ZW50cwogICAgICAgIHRoaXMuY2FsY1dpZHRoKGNhbGxiYWNrKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ2NhbGNXaWR0aCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2FsY1dpZHRoKGNhbGxiYWNrKSB7CiAgICAgIHJldHVybiAoMCwgX3V0aWxzLmNhbGNXaWR0aE9mSW5wdXQpKHRoaXMuZWxlbWVudCwgY2FsbGJhY2spOwogICAgfQogIH0sIHsKICAgIGtleTogJ3NldEFjdGl2ZURlc2NlbmRhbnQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldEFjdGl2ZURlc2NlbmRhbnQoYWN0aXZlRGVzY2VuZGFudElEKSB7CiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCcsIGFjdGl2ZURlc2NlbmRhbnRJRCk7CiAgICB9CiAgfSwgewogICAga2V5OiAncmVtb3ZlQWN0aXZlRGVzY2VuZGFudCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlQWN0aXZlRGVzY2VuZGFudCgpIHsKICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1hY3RpdmVkZXNjZW5kYW50Jyk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uSW5wdXQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbklucHV0KCkgewogICAgICBpZiAodGhpcy50eXBlICE9PSAnc2VsZWN0LW9uZScpIHsKICAgICAgICB0aGlzLnNldFdpZHRoKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25QYXN0ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uUGFzdGUoZXZlbnQpIHsKICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDsKICAgICAgLy8gRGlzYWJsZSBwYXN0aW5nIGludG8gdGhlIGlucHV0IGlmIG9wdGlvbiBoYXMgYmVlbiBzZXQKCiAgICAgIGlmICh0YXJnZXQgPT09IHRoaXMuZWxlbWVudCAmJiB0aGlzLnByZXZlbnRQYXN0ZSkgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25Gb2N1cycsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uRm9jdXMoKSB7CiAgICAgIHRoaXMuaXNGb2N1c3NlZCA9IHRydWU7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uQmx1cicsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uQmx1cigpIHsKICAgICAgdGhpcy5pc0ZvY3Vzc2VkID0gZmFsc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAncGxhY2Vob2xkZXInLAogICAgc2V0OiBmdW5jdGlvbiBzZXQocGxhY2Vob2xkZXIpIHsKICAgICAgdGhpcy5lbGVtZW50LnBsYWNlaG9sZGVyID0gcGxhY2Vob2xkZXI7CiAgICB9CiAgfSwgewogICAga2V5OiAndmFsdWUnLAogICAgc2V0OiBmdW5jdGlvbiBzZXQodmFsdWUpIHsKICAgICAgdGhpcy5lbGVtZW50LnZhbHVlID0gJycgKyB2YWx1ZTsKICAgIH0sCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuICgwLCBfdXRpbHMuc3RyaXBIVE1MKSh0aGlzLmVsZW1lbnQudmFsdWUpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIElucHV0Owp9KCk7CgpleHBvcnRzLmRlZmF1bHQgPSBJbnB1dDsKCi8qKiovIH0pLAovKiA4NiAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7Cgp2YXIgX2NvbnN0YW50cyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCnZhciBMaXN0ID0gZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIExpc3QoX3JlZikgewogICAgdmFyIGVsZW1lbnQgPSBfcmVmLmVsZW1lbnQ7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExpc3QpOwoKICAgIE9iamVjdC5hc3NpZ24odGhpcywgeyBlbGVtZW50OiBlbGVtZW50IH0pOwoKICAgIHRoaXMuc2Nyb2xsUG9zID0gdGhpcy5lbGVtZW50LnNjcm9sbFRvcDsKICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodDsKICAgIHRoaXMuaGFzQ2hpbGRyZW4gPSAhIXRoaXMuZWxlbWVudC5jaGlsZHJlbjsKICB9CgogIF9jcmVhdGVDbGFzcyhMaXN0LCBbewogICAga2V5OiAnY2xlYXInLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNsZWFyKCkgewogICAgICB0aGlzLmVsZW1lbnQuaW5uZXJIVE1MID0gJyc7CiAgICB9CiAgfSwgewogICAga2V5OiAnYXBwZW5kJywKICAgIHZhbHVlOiBmdW5jdGlvbiBhcHBlbmQobm9kZSkgewogICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQobm9kZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnZ2V0Q2hpbGQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENoaWxkKHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7CiAgICB9CiAgfSwgewogICAga2V5OiAnc2Nyb2xsVG9Ub3AnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNjcm9sbFRvVG9wKCkgewogICAgICB0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wID0gMDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdzY3JvbGxUb0Nob2ljZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2Nyb2xsVG9DaG9pY2UoY2hvaWNlLCBkaXJlY3Rpb24pIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmICghY2hvaWNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgZHJvcGRvd25IZWlnaHQgPSB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0OwogICAgICB2YXIgY2hvaWNlSGVpZ2h0ID0gY2hvaWNlLm9mZnNldEhlaWdodDsKICAgICAgLy8gRGlzdGFuY2UgZnJvbSBib3R0b20gb2YgZWxlbWVudCB0byB0b3Agb2YgcGFyZW50CiAgICAgIHZhciBjaG9pY2VQb3MgPSBjaG9pY2Uub2Zmc2V0VG9wICsgY2hvaWNlSGVpZ2h0OwogICAgICAvLyBTY3JvbGwgcG9zaXRpb24gb2YgZHJvcGRvd24KICAgICAgdmFyIGNvbnRhaW5lclNjcm9sbFBvcyA9IHRoaXMuZWxlbWVudC5zY3JvbGxUb3AgKyBkcm9wZG93bkhlaWdodDsKICAgICAgLy8gRGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBjaG9pY2UgYW5kIHNjcm9sbCBwb3NpdGlvbgogICAgICB2YXIgZW5kcG9pbnQgPSBkaXJlY3Rpb24gPiAwID8gdGhpcy5lbGVtZW50LnNjcm9sbFRvcCArIGNob2ljZVBvcyAtIGNvbnRhaW5lclNjcm9sbFBvcyA6IGNob2ljZS5vZmZzZXRUb3A7CgogICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKHRpbWUpIHsKICAgICAgICBfdGhpcy5fYW5pbWF0ZVNjcm9sbCh0aW1lLCBlbmRwb2ludCwgZGlyZWN0aW9uKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX3Njcm9sbERvd24nLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9zY3JvbGxEb3duKHNjcm9sbFBvcywgc3RyZW5ndGgsIGVuZHBvaW50KSB7CiAgICAgIHZhciBlYXNpbmcgPSAoZW5kcG9pbnQgLSBzY3JvbGxQb3MpIC8gc3RyZW5ndGg7CiAgICAgIHZhciBkaXN0YW5jZSA9IGVhc2luZyA+IDEgPyBlYXNpbmcgOiAxOwoKICAgICAgdGhpcy5lbGVtZW50LnNjcm9sbFRvcCA9IHNjcm9sbFBvcyArIGRpc3RhbmNlOwogICAgfQogIH0sIHsKICAgIGtleTogJ19zY3JvbGxVcCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3Njcm9sbFVwKHNjcm9sbFBvcywgc3RyZW5ndGgsIGVuZHBvaW50KSB7CiAgICAgIHZhciBlYXNpbmcgPSAoc2Nyb2xsUG9zIC0gZW5kcG9pbnQpIC8gc3RyZW5ndGg7CiAgICAgIHZhciBkaXN0YW5jZSA9IGVhc2luZyA+IDEgPyBlYXNpbmcgOiAxOwoKICAgICAgdGhpcy5lbGVtZW50LnNjcm9sbFRvcCA9IHNjcm9sbFBvcyAtIGRpc3RhbmNlOwogICAgfQogIH0sIHsKICAgIGtleTogJ19hbmltYXRlU2Nyb2xsJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfYW5pbWF0ZVNjcm9sbCh0aW1lLCBlbmRwb2ludCwgZGlyZWN0aW9uKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIHN0cmVuZ3RoID0gX2NvbnN0YW50cy5TQ1JPTExJTkdfU1BFRUQ7CiAgICAgIHZhciBjaG9pY2VMaXN0U2Nyb2xsVG9wID0gdGhpcy5lbGVtZW50LnNjcm9sbFRvcDsKICAgICAgdmFyIGNvbnRpbnVlQW5pbWF0aW9uID0gZmFsc2U7CgogICAgICBpZiAoZGlyZWN0aW9uID4gMCkgewogICAgICAgIHRoaXMuX3Njcm9sbERvd24oY2hvaWNlTGlzdFNjcm9sbFRvcCwgc3RyZW5ndGgsIGVuZHBvaW50KTsKCiAgICAgICAgaWYgKGNob2ljZUxpc3RTY3JvbGxUb3AgPCBlbmRwb2ludCkgewogICAgICAgICAgY29udGludWVBbmltYXRpb24gPSB0cnVlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9zY3JvbGxVcChjaG9pY2VMaXN0U2Nyb2xsVG9wLCBzdHJlbmd0aCwgZW5kcG9pbnQpOwoKICAgICAgICBpZiAoY2hvaWNlTGlzdFNjcm9sbFRvcCA+IGVuZHBvaW50KSB7CiAgICAgICAgICBjb250aW51ZUFuaW1hdGlvbiA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY29udGludWVBbmltYXRpb24pIHsKICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMyLl9hbmltYXRlU2Nyb2xsKHRpbWUsIGVuZHBvaW50LCBkaXJlY3Rpb24pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfV0pOwoKICByZXR1cm4gTGlzdDsKfSgpOwoKZXhwb3J0cy5kZWZhdWx0ID0gTGlzdDsKCi8qKiovIH0pLAovKiA4NyAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7Cgp2YXIgX2dldCA9IGZ1bmN0aW9uIGdldChvYmplY3QsIHByb3BlcnR5LCByZWNlaXZlcikgeyBpZiAob2JqZWN0ID09PSBudWxsKSBvYmplY3QgPSBGdW5jdGlvbi5wcm90b3R5cGU7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgcmV0dXJuIGdldChwYXJlbnQsIHByb3BlcnR5LCByZWNlaXZlcik7IH0gfSBlbHNlIGlmICgidmFsdWUiIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9OwoKdmFyIF93cmFwcGVkRWxlbWVudCA9IF9fd2VicGFja19yZXF1aXJlX18oMzUpOwoKdmFyIF93cmFwcGVkRWxlbWVudDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF93cmFwcGVkRWxlbWVudCk7Cgp2YXIgX3V0aWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikgPyBjYWxsIDogc2VsZjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCnZhciBXcmFwcGVkSW5wdXQgPSBmdW5jdGlvbiAoX1dyYXBwZWRFbGVtZW50KSB7CiAgX2luaGVyaXRzKFdyYXBwZWRJbnB1dCwgX1dyYXBwZWRFbGVtZW50KTsKCiAgZnVuY3Rpb24gV3JhcHBlZElucHV0KF9yZWYpIHsKICAgIHZhciBlbGVtZW50ID0gX3JlZi5lbGVtZW50LAogICAgICAgIGNsYXNzTmFtZXMgPSBfcmVmLmNsYXNzTmFtZXMsCiAgICAgICAgZGVsaW1pdGVyID0gX3JlZi5kZWxpbWl0ZXI7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFdyYXBwZWRJbnB1dCk7CgogICAgdmFyIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgKFdyYXBwZWRJbnB1dC5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKFdyYXBwZWRJbnB1dCkpLmNhbGwodGhpcywgeyBlbGVtZW50OiBlbGVtZW50LCBjbGFzc05hbWVzOiBjbGFzc05hbWVzIH0pKTsKCiAgICBfdGhpcy5kZWxpbWl0ZXIgPSBkZWxpbWl0ZXI7CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoV3JhcHBlZElucHV0LCBbewogICAga2V5OiAndmFsdWUnLAogICAgc2V0OiBmdW5jdGlvbiBzZXQoaXRlbXMpIHsKICAgICAgdmFyIGl0ZW1zRmlsdGVyZWQgPSAoMCwgX3V0aWxzLnJlZHVjZVRvVmFsdWVzKShpdGVtcyk7CiAgICAgIHZhciBpdGVtc0ZpbHRlcmVkU3RyaW5nID0gaXRlbXNGaWx0ZXJlZC5qb2luKHRoaXMuZGVsaW1pdGVyKTsKCiAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgaXRlbXNGaWx0ZXJlZFN0cmluZyk7CiAgICAgIHRoaXMuZWxlbWVudC52YWx1ZSA9IGl0ZW1zRmlsdGVyZWRTdHJpbmc7CiAgICB9CgogICAgLy8gQHRvZG8gZmlndXJlIG91dCB3aHkgd2UgbmVlZCB0aGlzPyBQZXJoYXBzIGEgYmFiZWwgaXNzdWUKICAgICwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gX2dldChXcmFwcGVkSW5wdXQucHJvdG90eXBlLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoV3JhcHBlZElucHV0LnByb3RvdHlwZSksICd2YWx1ZScsIHRoaXMpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFdyYXBwZWRJbnB1dDsKfShfd3JhcHBlZEVsZW1lbnQyLmRlZmF1bHQpOwoKZXhwb3J0cy5kZWZhdWx0ID0gV3JhcHBlZElucHV0OwoKLyoqKi8gfSksCi8qIDg4ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiJ1c2Ugc3RyaWN0IjsKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTsKCnZhciBfd3JhcHBlZEVsZW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM1KTsKCnZhciBfd3JhcHBlZEVsZW1lbnQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfd3JhcHBlZEVsZW1lbnQpOwoKdmFyIF90ZW1wbGF0ZXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM2KTsKCnZhciBfdGVtcGxhdGVzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3RlbXBsYXRlcyk7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmICghc2VsZikgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpID8gY2FsbCA6IHNlbGY7IH0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9Cgp2YXIgV3JhcHBlZFNlbGVjdCA9IGZ1bmN0aW9uIChfV3JhcHBlZEVsZW1lbnQpIHsKICBfaW5oZXJpdHMoV3JhcHBlZFNlbGVjdCwgX1dyYXBwZWRFbGVtZW50KTsKCiAgZnVuY3Rpb24gV3JhcHBlZFNlbGVjdChfcmVmKSB7CiAgICB2YXIgZWxlbWVudCA9IF9yZWYuZWxlbWVudCwKICAgICAgICBjbGFzc05hbWVzID0gX3JlZi5jbGFzc05hbWVzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBXcmFwcGVkU2VsZWN0KTsKCiAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgKFdyYXBwZWRTZWxlY3QuX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihXcmFwcGVkU2VsZWN0KSkuY2FsbCh0aGlzLCB7IGVsZW1lbnQ6IGVsZW1lbnQsIGNsYXNzTmFtZXM6IGNsYXNzTmFtZXMgfSkpOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFdyYXBwZWRTZWxlY3QsIFt7CiAgICBrZXk6ICdhcHBlbmREb2NGcmFnbWVudCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gYXBwZW5kRG9jRnJhZ21lbnQoZnJhZ21lbnQpIHsKICAgICAgdGhpcy5lbGVtZW50LmlubmVySFRNTCA9ICcnOwogICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpOwogICAgfQogIH0sIHsKICAgIGtleTogJ3BsYWNlaG9sZGVyT3B0aW9uJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ29wdGlvbltwbGFjZWhvbGRlcl0nKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdvcHRpb25Hcm91cHMnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuZWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnT1BUR1JPVVAnKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnb3B0aW9ucycsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5lbGVtZW50Lm9wdGlvbnMpOwogICAgfSwKICAgIHNldDogZnVuY3Rpb24gc2V0KG9wdGlvbnMpIHsKICAgICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgICB2YXIgYWRkT3B0aW9uVG9GcmFnbWVudCA9IGZ1bmN0aW9uIGFkZE9wdGlvblRvRnJhZ21lbnQoZGF0YSkgewogICAgICAgIC8vIENyZWF0ZSBhIHN0YW5kYXJkIHNlbGVjdCBvcHRpb24KICAgICAgICB2YXIgdGVtcGxhdGUgPSBfdGVtcGxhdGVzMi5kZWZhdWx0Lm9wdGlvbihkYXRhKTsKICAgICAgICAvLyBBcHBlbmQgaXQgdG8gZnJhZ21lbnQKICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZCh0ZW1wbGF0ZSk7CiAgICAgIH07CgogICAgICAvLyBBZGQgZWFjaCBsaXN0IGl0ZW0gdG8gbGlzdAogICAgICBvcHRpb25zLmZvckVhY2goZnVuY3Rpb24gKG9wdGlvbkRhdGEpIHsKICAgICAgICByZXR1cm4gYWRkT3B0aW9uVG9GcmFnbWVudChvcHRpb25EYXRhKTsKICAgICAgfSk7CgogICAgICB0aGlzLmFwcGVuZERvY0ZyYWdtZW50KGZyYWdtZW50KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBXcmFwcGVkU2VsZWN0Owp9KF93cmFwcGVkRWxlbWVudDIuZGVmYXVsdCk7CgpleHBvcnRzLmRlZmF1bHQgPSBXcmFwcGVkU2VsZWN0OwoKLyoqKi8gfSksCi8qIDg5ICovCi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCnZhciBfX1dFQlBBQ0tfQU1EX0RFRklORV9BUlJBWV9fLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXzsvKiEKICBDb3B5cmlnaHQgKGMpIDIwMTYgSmVkIFdhdHNvbi4KICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UgKE1JVCksIHNlZQogIGh0dHA6Ly9qZWR3YXRzb24uZ2l0aHViLmlvL2NsYXNzbmFtZXMKKi8KLyogZ2xvYmFsIGRlZmluZSAqLwoKKGZ1bmN0aW9uICgpIHsKCSd1c2Ugc3RyaWN0JzsKCgl2YXIgaGFzT3duID0ge30uaGFzT3duUHJvcGVydHk7CgoJZnVuY3Rpb24gY2xhc3NOYW1lcyAoKSB7CgkJdmFyIGNsYXNzZXMgPSBbXTsKCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKCQkJdmFyIGFyZyA9IGFyZ3VtZW50c1tpXTsKCQkJaWYgKCFhcmcpIGNvbnRpbnVlOwoKCQkJdmFyIGFyZ1R5cGUgPSB0eXBlb2YgYXJnOwoKCQkJaWYgKGFyZ1R5cGUgPT09ICdzdHJpbmcnIHx8IGFyZ1R5cGUgPT09ICdudW1iZXInKSB7CgkJCQljbGFzc2VzLnB1c2goYXJnKTsKCQkJfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGFyZykpIHsKCQkJCWNsYXNzZXMucHVzaChjbGFzc05hbWVzLmFwcGx5KG51bGwsIGFyZykpOwoJCQl9IGVsc2UgaWYgKGFyZ1R5cGUgPT09ICdvYmplY3QnKSB7CgkJCQlmb3IgKHZhciBrZXkgaW4gYXJnKSB7CgkJCQkJaWYgKGhhc093bi5jYWxsKGFyZywga2V5KSAmJiBhcmdba2V5XSkgewoJCQkJCQljbGFzc2VzLnB1c2goa2V5KTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBjbGFzc2VzLmpvaW4oJyAnKTsKCX0KCglpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHsKCQltb2R1bGUuZXhwb3J0cyA9IGNsYXNzTmFtZXM7Cgl9IGVsc2UgaWYgKHRydWUpIHsKCQkvLyByZWdpc3RlciBhcyAnY2xhc3NuYW1lcycsIGNvbnNpc3RlbnQgd2l0aCBucG0gcGFja2FnZSBuYW1lCgkJIShfX1dFQlBBQ0tfQU1EX0RFRklORV9BUlJBWV9fID0gW10sIF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fID0gKGZ1bmN0aW9uICgpIHsKCQkJcmV0dXJuIGNsYXNzTmFtZXM7CgkJfSkuYXBwbHkoZXhwb3J0cywgX19XRUJQQUNLX0FNRF9ERUZJTkVfQVJSQVlfXyksCgkJCQlfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXyAhPT0gdW5kZWZpbmVkICYmIChtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fKSk7Cgl9IGVsc2UgewoJCXdpbmRvdy5jbGFzc05hbWVzID0gY2xhc3NOYW1lczsKCX0KfSgpKTsKCgovKioqLyB9KSwKLyogOTAgKi8KLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKInVzZSBzdHJpY3QiOwoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5jbGVhckNob2ljZXMgPSBleHBvcnRzLmFjdGl2YXRlQ2hvaWNlcyA9IGV4cG9ydHMuZmlsdGVyQ2hvaWNlcyA9IGV4cG9ydHMuYWRkQ2hvaWNlID0gdW5kZWZpbmVkOwoKdmFyIF9jb25zdGFudHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOwoKdmFyIGFkZENob2ljZSA9IGV4cG9ydHMuYWRkQ2hvaWNlID0gZnVuY3Rpb24gYWRkQ2hvaWNlKF9yZWYpIHsKICB2YXIgdmFsdWUgPSBfcmVmLnZhbHVlLAogICAgICBsYWJlbCA9IF9yZWYubGFiZWwsCiAgICAgIGlkID0gX3JlZi5pZCwKICAgICAgZ3JvdXBJZCA9IF9yZWYuZ3JvdXBJZCwKICAgICAgZGlzYWJsZWQgPSBfcmVmLmRpc2FibGVkLAogICAgICBlbGVtZW50SWQgPSBfcmVmLmVsZW1lbnRJZCwKICAgICAgY3VzdG9tUHJvcGVydGllcyA9IF9yZWYuY3VzdG9tUHJvcGVydGllcywKICAgICAgcGxhY2Vob2xkZXIgPSBfcmVmLnBsYWNlaG9sZGVyLAogICAgICBrZXlDb2RlID0gX3JlZi5rZXlDb2RlOwogIHJldHVybiB7CiAgICB0eXBlOiBfY29uc3RhbnRzLkFDVElPTl9UWVBFUy5BRERfQ0hPSUNFLAogICAgdmFsdWU6IHZhbHVlLAogICAgbGFiZWw6IGxhYmVsLAogICAgaWQ6IGlkLAogICAgZ3JvdXBJZDogZ3JvdXBJZCwKICAgIGRpc2FibGVkOiBkaXNhYmxlZCwKICAgIGVsZW1lbnRJZDogZWxlbWVudElkLAogICAgY3VzdG9tUHJvcGVydGllczogY3VzdG9tUHJvcGVydGllcywKICAgIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlciwKICAgIGtleUNvZGU6IGtleUNvZGUKICB9Owp9OwoKdmFyIGZpbHRlckNob2ljZXMgPSBleHBvcnRzLmZpbHRlckNob2ljZXMgPSBmdW5jdGlvbiBmaWx0ZXJDaG9pY2VzKHJlc3VsdHMpIHsKICByZXR1cm4gewogICAgdHlwZTogX2NvbnN0YW50cy5BQ1RJT05fVFlQRVMuRklMVEVSX0NIT0lDRVMsCiAgICByZXN1bHRzOiByZXN1bHRzCiAgfTsKfTsKCnZhciBhY3RpdmF0ZUNob2ljZXMgPSBleHBvcnRzLmFjdGl2YXRlQ2hvaWNlcyA9IGZ1bmN0aW9uIGFjdGl2YXRlQ2hvaWNlcygpIHsKICB2YXIgYWN0aXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB0cnVlOwogIHJldHVybiB7CiAgICB0eXBlOiBfY29uc3RhbnRzLkFDVElPTl9UWVBFUy5BQ1RJVkFURV9DSE9JQ0VTLAogICAgYWN0aXZlOiBhY3RpdmUKICB9Owp9OwoKdmFyIGNsZWFyQ2hvaWNlcyA9IGV4cG9ydHMuY2xlYXJDaG9pY2VzID0gZnVuY3Rpb24gY2xlYXJDaG9pY2VzKCkgewogIHJldHVybiB7CiAgICB0eXBlOiBfY29uc3RhbnRzLkFDVElPTl9UWVBFUy5DTEVBUl9DSE9JQ0VTCiAgfTsKfTsKCi8qKiovIH0pLAovKiA5MSAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmhpZ2hsaWdodEl0ZW0gPSBleHBvcnRzLnJlbW92ZUl0ZW0gPSBleHBvcnRzLmFkZEl0ZW0gPSB1bmRlZmluZWQ7Cgp2YXIgX2NvbnN0YW50cyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7Cgp2YXIgYWRkSXRlbSA9IGV4cG9ydHMuYWRkSXRlbSA9IGZ1bmN0aW9uIGFkZEl0ZW0oX3JlZikgewogIHZhciB2YWx1ZSA9IF9yZWYudmFsdWUsCiAgICAgIGxhYmVsID0gX3JlZi5sYWJlbCwKICAgICAgaWQgPSBfcmVmLmlkLAogICAgICBjaG9pY2VJZCA9IF9yZWYuY2hvaWNlSWQsCiAgICAgIGdyb3VwSWQgPSBfcmVmLmdyb3VwSWQsCiAgICAgIGN1c3RvbVByb3BlcnRpZXMgPSBfcmVmLmN1c3RvbVByb3BlcnRpZXMsCiAgICAgIHBsYWNlaG9sZGVyID0gX3JlZi5wbGFjZWhvbGRlciwKICAgICAga2V5Q29kZSA9IF9yZWYua2V5Q29kZTsKICByZXR1cm4gewogICAgdHlwZTogX2NvbnN0YW50cy5BQ1RJT05fVFlQRVMuQUREX0lURU0sCiAgICB2YWx1ZTogdmFsdWUsCiAgICBsYWJlbDogbGFiZWwsCiAgICBpZDogaWQsCiAgICBjaG9pY2VJZDogY2hvaWNlSWQsCiAgICBncm91cElkOiBncm91cElkLAogICAgY3VzdG9tUHJvcGVydGllczogY3VzdG9tUHJvcGVydGllcywKICAgIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlciwKICAgIGtleUNvZGU6IGtleUNvZGUKICB9Owp9OwoKdmFyIHJlbW92ZUl0ZW0gPSBleHBvcnRzLnJlbW92ZUl0ZW0gPSBmdW5jdGlvbiByZW1vdmVJdGVtKGlkLCBjaG9pY2VJZCkgewogIHJldHVybiB7CiAgICB0eXBlOiBfY29uc3RhbnRzLkFDVElPTl9UWVBFUy5SRU1PVkVfSVRFTSwKICAgIGlkOiBpZCwKICAgIGNob2ljZUlkOiBjaG9pY2VJZAogIH07Cn07Cgp2YXIgaGlnaGxpZ2h0SXRlbSA9IGV4cG9ydHMuaGlnaGxpZ2h0SXRlbSA9IGZ1bmN0aW9uIGhpZ2hsaWdodEl0ZW0oaWQsIGhpZ2hsaWdodGVkKSB7CiAgcmV0dXJuIHsKICAgIHR5cGU6IF9jb25zdGFudHMuQUNUSU9OX1RZUEVTLkhJR0hMSUdIVF9JVEVNLAogICAgaWQ6IGlkLAogICAgaGlnaGxpZ2h0ZWQ6IGhpZ2hsaWdodGVkCiAgfTsKfTsKCi8qKiovIH0pLAovKiA5MiAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmFkZEdyb3VwID0gdW5kZWZpbmVkOwoKdmFyIF9jb25zdGFudHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUpOwoKLyogZXNsaW50LWRpc2FibGUgaW1wb3J0L3ByZWZlci1kZWZhdWx0LWV4cG9ydCAqLwp2YXIgYWRkR3JvdXAgPSBleHBvcnRzLmFkZEdyb3VwID0gZnVuY3Rpb24gYWRkR3JvdXAodmFsdWUsIGlkLCBhY3RpdmUsIGRpc2FibGVkKSB7CiAgcmV0dXJuIHsKICAgIHR5cGU6IF9jb25zdGFudHMuQUNUSU9OX1RZUEVTLkFERF9HUk9VUCwKICAgIHZhbHVlOiB2YWx1ZSwKICAgIGlkOiBpZCwKICAgIGFjdGl2ZTogYWN0aXZlLAogICAgZGlzYWJsZWQ6IGRpc2FibGVkCiAgfTsKfTsKCi8qKiovIH0pLAovKiA5MyAqLwovKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgoidXNlIHN0cmljdCI7CgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwp2YXIgY2xlYXJBbGwgPSBleHBvcnRzLmNsZWFyQWxsID0gZnVuY3Rpb24gY2xlYXJBbGwoKSB7CiAgcmV0dXJuIHsKICAgIHR5cGU6ICdDTEVBUl9BTEwnCiAgfTsKfTsKCnZhciByZXNldFRvID0gZXhwb3J0cy5yZXNldFRvID0gZnVuY3Rpb24gcmVzZXRUbyhzdGF0ZSkgewogIHJldHVybiB7CiAgICB0eXBlOiAnUkVTRVRfVE8nLAogICAgc3RhdGU6IHN0YXRlCiAgfTsKfTsKCi8qKiovIH0pCi8qKioqKiovIF0pOwp9KTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2hvaWNlcy5qcy5tYXAKICA8L3NjcmlwdD4KICAKICA8IS0tVHJhdmVsIExlYWRlcnMgQ29udGVudC0tPgogIDwhLS08c2NyaXB0IHNyYz0iamF2YXNjcmlwdHMvY29tcGxlYXQtdmVuZG9yLWRlYnVnLXBhcnNlci5qcyI+PC9zY3JpcHQ+LS0+CiAgPHNjcmlwdD4vKioqCiogQ29tcGxlYXQgVmVuZG9yIERlYnVnIHBhcnNlciBmb3IgSmF2YVNjcmlwdAoqCiogQ29weXJpZ2h0IChjKSAyMDE0IFRvZGQgSGFtYmxleSAoTUlUIExpY2Vuc2UpLgoqCiovCiAgICAvKmpzaGludAogICAgICBsYXhjb21tYTp0cnVlCiAgICAgIGxheGJyZWFrOnRydWUKICAgICAgZXFudWxsOnRydWUKICAgICAgbG9vcGZ1bmM6dHJ1ZQogICAgICBzdWI6dHJ1ZQogICAgKi8KICAgIDsgKGZ1bmN0aW9uICgpIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgLy8gb25seSBydW4gd2hlbiB0aGUgc3Vic3RyKCkgZnVuY3Rpb24gaXMgYnJva2VuCiAgICAgIGlmICgnYWInLnN1YnN0cigtMSkgIT0gJ2InKSB7CiAgICAgICAgLyoqCiAgICAgICAgICogIEdldCB0aGUgc3Vic3RyaW5nIG9mIGEgc3RyaW5nCiAgICAgICAgICogIEBwYXJhbSAge2ludGVnZXJ9ICBzdGFydCAgIHdoZXJlIHRvIHN0YXJ0IHRoZSBzdWJzdHJpbmcKICAgICAgICAgKiAgQHBhcmFtICB7aW50ZWdlcn0gIGxlbmd0aCAgaG93IG1hbnkgY2hhcmFjdGVycyB0byByZXR1cm4KICAgICAgICAgKiAgQHJldHVybiB7c3RyaW5nfQogICAgICAgICAqLwogICAgICAgIFN0cmluZy5wcm90b3R5cGUuc3Vic3RyID0gZnVuY3Rpb24gKHN1YnN0cikgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzdGFydCwgbGVuZ3RoKSB7CiAgICAgICAgICAgIC8vIGRpZCB3ZSBnZXQgYSBuZWdhdGl2ZSBzdGFydCwgY2FsY3VsYXRlIGhvdyBtdWNoIGl0IGlzCiAgICAgICAgICAgIC8vIGZyb20gdGhlIGJlZ2lubmluZyBvZiB0aGUgc3RyaW5nCiAgICAgICAgICAgIGlmIChzdGFydCA8IDApIHsKICAgICAgICAgICAgICBzdGFydCA9IHRoaXMubGVuZ3RoICsgc3RhcnQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNhbGwgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uCiAgICAgICAgICAgIHJldHVybiBzdWJzdHIuY2FsbCh0aGlzLCBzdGFydCwgbGVuZ3RoKTsKICAgICAgICAgIH0KICAgICAgICB9KFN0cmluZy5wcm90b3R5cGUuc3Vic3RyKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcmlnaHRBbGlnblplcm9QYWRkaW5nKGlucHV0U3RyaW5nKSB7CiAgICAgICAgcmV0dXJuICgnMDAnICsgaW5wdXRTdHJpbmcpLnN1YnN0cigtMik7CiAgICAgIH0KCiAgICAgIC8vIGxvZyBjYXRlZ29yeQogICAgICAvLyBsb2cgbGV2ZWwKICAgICAgLy8gbG9nIGRhdGVUaW1lCiAgICAgIC8vIGxvZyB0ZXh0CiAgICAgIGZ1bmN0aW9uIHBhcnNlRGVidWdMb2cobG9nVGV4dCkgewogICAgICAgIHZhciBsb2dMaW5lcyA9IGxvZ1RleHQuc3BsaXQoJ1xuJyk7CiAgICAgICAgdmFyIGxvZ0VudHJpZXMgPSBbXTsKICAgICAgICB2YXIgbG9nRW50cnlOdW1iZXIgPSAtMTsKICAgICAgICAvLyBleGFtcGxlIGxvZyBlbnRyaWVzOgogICAgICAgIC8vIFtXIzM3OTkgKDYwKSBXUksxXSAtLSB7UmVxdWVzdH0gLS0gPERlYnVnPiAtLSAxMS8yMS8xNCAxNTozNzo1Ny45MTQgLS0gUS83VkEvMjYqQzcKICAgICAgICAvLyB7bG9nIGluZm99IC0tIDxsb2cgbGV2ZWw+IC0tIGxvZyB0aW1lIC0tIGxvZyB0ZXh0CiAgICAgICAgLy8ge0luZm9ybWF0aW9uQ2xhc3NpZmljYXRpb259IC0tIDxJbmZvPiAtLSAxMi8yNi8xMyAyMzo1MTowNC44NzAgLS0gVGhpcyBMb2cgQ29udGFpbnMgUHJpdmlsZWdlZCBJbmZvcm1hdGlvbi4KICAgICAgICAvLyA8bG9nIGxldmVsPiAtLSBsb2cgdGltZSAtLSBsb2cgdGV4dAogICAgICAgIC8vIDxTdGF0dXM+IC0tIDEyLzI2LzEzIDIzOjUxOjA2LjMyMSAtLSBDb25uZWN0ZWQuCiAgICAgICAgdmFyIGN1cnJlbnRXb3JrZmxvdyA9ICcnOwogICAgICAgIHZhciBjdXJyZW50UHJvY2VzcyA9ICcnOwogICAgICAgIHZhciBjdXJyZW50Um91dGluZSA9ICcnOwogICAgICAgIHZhciBjdXJyZW50TG9jYXRvciA9ICcnOwoKICAgICAgICB2YXIgbG9nRW50cnlSZWdFeCA9IC9eKD86W1xbXVcjKFswLTldKykgW1woXShbMC05XSspW1wpXSBXUksoWzAtOV0rKVtcXV0gLS0gKT8oPzpbXHtdKFteXH1dKylbXH1dIC0tICk/KD86W1w8XShbQS1aYS16XSspW1w+XSAtLSApKD86KFswLTldezEsMn0pXC8oWzAtOV17MSwyfSlcLyhbMC05XXsyfSkgKFswLTldezEsMn0pOihbMC05XXsyfSk6KFswLTldezJ9KS4oWzAtOV17M30pIC0tICkoLispLzsKICAgICAgICB2YXIgbG9nU2VwYXJhdG9yUmVnRXggPSAvXltcLV17MjB9KFtcZF0rKVwvKFtcZF0rKVwvKFtcZF0rKSAoW1xkXSspOihbXGRdKyk6KFtcZF0rKSAoW0FQXU0pIFtcKF1VVENbXCldW1wtXXsyMH0vOwogICAgICAgIHZhciBuYW1lUmVnRXggPSAvIihbXiJdKykiLzsKICAgICAgICBmb3IgKHZhciBsaW5lTnVtYmVyID0gMDsgbGluZU51bWJlciA8IGxvZ0xpbmVzLmxlbmd0aDsgbGluZU51bWJlcisrKSB7CiAgICAgICAgICBpZiAobG9nRW50cnlSZWdFeC50ZXN0KGxvZ0xpbmVzW2xpbmVOdW1iZXJdKSkgewogICAgICAgICAgICBsb2dFbnRyeU51bWJlcisrOwogICAgICAgICAgICB2YXIgbG9nTWF0Y2ggPSBsb2dFbnRyeVJlZ0V4LmV4ZWMobG9nTGluZXNbbGluZU51bWJlcl0pOwogICAgICAgICAgICB2YXIgY3VycmVudExvZ0VudHJ5ID0gY3VycmVudExvZ0VudHJ5ID0gewogICAgICAgICAgICAgIGxpbmVOdW1iZXI6IGxpbmVOdW1iZXIgKyAxLAogICAgICAgICAgICAgIHdvcmtlcjogcGFyc2VJbnQobG9nTWF0Y2hbMV0gfHwgJy0xJyksCiAgICAgICAgICAgICAgYWdlbmN5OiBwYXJzZUludChsb2dNYXRjaFsyXSB8fCAnLTEnKSwKICAgICAgICAgICAgICB3b3Jrc3RhdGlvbjogcGFyc2VJbnQobG9nTWF0Y2hbM10gfHwgJy0xJyksCiAgICAgICAgICAgICAgY2F0ZWdvcnk6IGxvZ01hdGNoWzRdIHx8ICcnLAogICAgICAgICAgICAgIGxldmVsOiBsb2dNYXRjaFs1XSwKICAgICAgICAgICAgICBkYXRlVGltZTogbmV3IERhdGUoRGF0ZS5VVEMocGFyc2VJbnQoJzIwJyArIGxvZ01hdGNoWzhdLCAxMCksIHBhcnNlSW50KGxvZ01hdGNoWzZdLCAxMCkgLSAxLCBwYXJzZUludChsb2dNYXRjaFs3XSwgMTApLCBwYXJzZUludChsb2dNYXRjaFs5XSwgMTApLCBwYXJzZUludChsb2dNYXRjaFsxMF0sIDEwKSwgcGFyc2VJbnQobG9nTWF0Y2hbMTFdLCAxMCksIHBhcnNlSW50KGxvZ01hdGNoWzEyXSwgMTApKSksCiAgICAgICAgICAgICAgZGF0ZVRpbWVUZXh0OiAnMjAnICsgbG9nTWF0Y2hbOF0gKyAnLScgKyByaWdodEFsaWduWmVyb1BhZGRpbmcobG9nTWF0Y2hbNl0pICsgJy0nICsgcmlnaHRBbGlnblplcm9QYWRkaW5nKGxvZ01hdGNoWzddKSArICcgJyArIHJpZ2h0QWxpZ25aZXJvUGFkZGluZyhsb2dNYXRjaFs5XSkgKyAnOicgKyBsb2dNYXRjaFsxMF0gKyAnOicgKyBsb2dNYXRjaFsxMV0gKyAnLicgKyBsb2dNYXRjaFsxMl0sCiAgICAgICAgICAgICAgdGV4dDogbG9nTWF0Y2hbMTNdLnJlcGxhY2UoLyAgL2csICIgJm5ic3A7IiksCiAgICAgICAgICAgICAgd29ya2Zsb3c6IGN1cnJlbnRXb3JrZmxvdywKICAgICAgICAgICAgICBwcm9jZXNzOiBjdXJyZW50UHJvY2VzcywKICAgICAgICAgICAgICByb3V0aW5lOiBjdXJyZW50Um91dGluZSwKICAgICAgICAgICAgICBwbnJMb2NhdG9yOiBjdXJyZW50TG9jYXRvcgogICAgICAgICAgICB9CiAgICAgICAgICAgIGxvZ0VudHJpZXNbbG9nRW50cnlOdW1iZXJdID0gY3VycmVudExvZ0VudHJ5OwogICAgICAgICAgICBzd2l0Y2ggKGN1cnJlbnRMb2dFbnRyeS5jYXRlZ29yeSkgewogICAgICAgICAgICAgIGNhc2UgJ1F1ZXVlUHJvY2Vzcyc6CiAgICAgICAgICAgICAgICBpZiAobmFtZVJlZ0V4LnRlc3QoY3VycmVudExvZ0VudHJ5LnRleHQpKSB7CiAgICAgICAgICAgICAgICAgIHZhciBuYW1lTWF0Y2ggPSBuYW1lUmVnRXguZXhlYyhjdXJyZW50TG9nRW50cnkudGV4dCk7CiAgICAgICAgICAgICAgICAgIC8vIHNldCB3b3JrZmxvdwogICAgICAgICAgICAgICAgICBjdXJyZW50TG9nRW50cnkud29ya2Zsb3cgPSBjdXJyZW50V29ya2Zsb3cgPSBuYW1lTWF0Y2hbMV07CiAgICAgICAgICAgICAgICAgIC8vIGNsZWFyIHByb2Nlc3MgYW5kIHJvdXRpbmUKICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnByb2Nlc3MgPSBjdXJyZW50UHJvY2VzcyA9ICcnOwogICAgICAgICAgICAgICAgICBjdXJyZW50TG9nRW50cnkucm91dGluZSA9IGN1cnJlbnRSb3V0aW5lID0gJyc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBhbGVydCgnd29ya2Zsb3cgbmFtZSBub3QgZm91bmQ6JyArIGN1cnJlbnRMb2dFbnRyeS50ZXh0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgJ1Byb2Nlc3NFeGVjdXRlJzoKICAgICAgICAgICAgICAgIGlmIChuYW1lUmVnRXgudGVzdChjdXJyZW50TG9nRW50cnkudGV4dCkpIHsKICAgICAgICAgICAgICAgICAgdmFyIG5hbWVNYXRjaCA9IG5hbWVSZWdFeC5leGVjKGN1cnJlbnRMb2dFbnRyeS50ZXh0KTsKICAgICAgICAgICAgICAgICAgLy8gc2V0IHByb2Nlc3MKICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnByb2Nlc3MgPSBjdXJyZW50UHJvY2VzcyA9IG5hbWVNYXRjaFsxXTsKICAgICAgICAgICAgICAgICAgLy8gY2xlYXIgcm91dGluZQogICAgICAgICAgICAgICAgICBjdXJyZW50TG9nRW50cnkucm91dGluZSA9IGN1cnJlbnRSb3V0aW5lID0gJyc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBhbGVydCgncHJvY2VzcyBuYW1lIG5vdCBmb3VuZDonICsgY3VycmVudExvZ0VudHJ5LnRleHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAnUG5yVGVzdHNFeGVjdXRlJzoKICAgICAgICAgICAgICAgIC8vIHJvdXRpbmUKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TG9nRW50cnkudGV4dCA9PT0gJ0FsbCByb3V0aW5lcyBmaW5pc2hlZC4nKSB7CiAgICAgICAgICAgICAgICAgIC8vIGNsZWFyCiAgICAgICAgICAgICAgICAgIGN1cnJlbnRMb2dFbnRyeS5yb3V0aW5lID0gY3VycmVudFJvdXRpbmUgPSAnJzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGlmIChuYW1lUmVnRXgudGVzdChjdXJyZW50TG9nRW50cnkudGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZU1hdGNoID0gbmFtZVJlZ0V4LmV4ZWMoY3VycmVudExvZ0VudHJ5LnRleHQpOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMb2dFbnRyeS5yb3V0aW5lID0gY3VycmVudFJvdXRpbmUgPSBuYW1lTWF0Y2hbMV07CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ3JvdXRpbmUgbmFtZSBub3QgZm91bmQ6JyArIGN1cnJlbnRMb2dFbnRyeS50ZXh0KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAnJzoKICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciBsZXZlbCA9ICdkZWJ1ZycgYW5kIHByZXNlbmNlIG9mICJlbmNvdW50ZXJlZCIgaW4gdGV4dAogICAgICAgICAgICAgICAgaWYgKChjdXJyZW50TG9nRW50cnkubGV2ZWwgPT09ICdEZWJ1ZycpICYmIChjdXJyZW50TG9nRW50cnkudGV4dC5zdWJzdHIoMCwgMTEpID09PSAnRW5jb3VudGVyZWQnKSkgewogICAgICAgICAgICAgICAgICAvLyBzZXQgbG9jYXRvcgogICAgICAgICAgICAgICAgICBjdXJyZW50TG9nRW50cnkucG5yTG9jYXRvciA9IGN1cnJlbnRMb2NhdG9yID0gY3VycmVudExvZ0VudHJ5LnRleHQuc3Vic3RyKDEyKTsKICAgICAgICAgICAgICAgICAgLy8gY2xlYXIgd29ya2Zsb3csIHByb2Nlc3MgYW5kIHJvdXRpbmUKICAgICAgICAgICAgICAgICAgLy8gY3VycmVudExvZ0VudHJ5LndvcmtmbG93ID0gY3VycmVudFdvcmtmbG93ID0gJyc7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRMb2dFbnRyeS5wcm9jZXNzID0gY3VycmVudFByb2Nlc3MgPSAnJzsKICAgICAgICAgICAgICAgICAgY3VycmVudExvZ0VudHJ5LnJvdXRpbmUgPSBjdXJyZW50Um91dGluZSA9ICcnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICB9IGVsc2UgaWYgKGxvZ0VudHJ5TnVtYmVyID4gLTEpIHsKICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0xMS8yMS8yMDE0IDM6Mzc6NTcgUE0gKFVUQyktLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICBpZiAobG9nU2VwYXJhdG9yUmVnRXgudGVzdChsb2dMaW5lc1tsaW5lTnVtYmVyXSkpIHsKICAgICAgICAgICAgICBjdXJyZW50V29ya2Zsb3cgPSAnJzsKICAgICAgICAgICAgICBjdXJyZW50UHJvY2VzcyA9ICcnOwogICAgICAgICAgICAgIGN1cnJlbnRSb3V0aW5lID0gJyc7CiAgICAgICAgICAgICAgY3VycmVudExvY2F0b3IgPSAnJzsKCiAgICAgICAgICAgICAgdmFyIGxvZ01hdGNoID0gbG9nU2VwYXJhdG9yUmVnRXguZXhlYyhsb2dMaW5lc1tsaW5lTnVtYmVyXSk7CiAgICAgICAgICAgICAgLy9eW1wtXXsyMH0oW1xkXSspXC8oW1xkXSspXC8oW1xkXSspIChbXGRdKyk6KFtcZF0rKTooW1xkXSspIChbQVBdTSkgW1woXVVUQ1tcKV1bXC1dezIwfQogICAgICAgICAgICAgIGxvZ0VudHJ5TnVtYmVyKys7CiAgICAgICAgICAgICAgbG9nRW50cmllc1tsb2dFbnRyeU51bWJlcl0gPSB7CiAgICAgICAgICAgICAgICBsaW5lTnVtYmVyOiBsaW5lTnVtYmVyICsgMSwKICAgICAgICAgICAgICAgIHdvcmtlcjogLTEsCiAgICAgICAgICAgICAgICBhZ2VuY3k6IC0xLAogICAgICAgICAgICAgICAgd29ya3N0YXRpb246IC0xLAogICAgICAgICAgICAgICAgY2F0ZWdvcnk6ICdTZXBhcmF0b3InLAogICAgICAgICAgICAgICAgbGV2ZWw6ICcnLAogICAgICAgICAgICAgICAgZGF0ZVRpbWU6IG5ldyBEYXRlKERhdGUuVVRDKHBhcnNlSW50KGxvZ01hdGNoWzNdLCAxMCksIHBhcnNlSW50KGxvZ01hdGNoWzFdLCAxMCkgLSAxLCBwYXJzZUludChsb2dNYXRjaFsyXSwgMTApLCAocGFyc2VJbnQobG9nTWF0Y2hbNF0sIDEwKSArICgobG9nTWF0Y2hbN10gPT0gJ1BNJykgPyAxMiA6IDApKSwgcGFyc2VJbnQobG9nTWF0Y2hbNV0sIDEwKSwgcGFyc2VJbnQobG9nTWF0Y2hbNl0sIDEwKSwgMCkpLAogICAgICAgICAgICAgICAgZGF0ZVRpbWVUZXh0OiBsb2dNYXRjaFszXSArICctJyArIHJpZ2h0QWxpZ25aZXJvUGFkZGluZyhsb2dNYXRjaFsxXSkgKyAnLScgKyByaWdodEFsaWduWmVyb1BhZGRpbmcobG9nTWF0Y2hbMl0pICsgJyAnICsgcmlnaHRBbGlnblplcm9QYWRkaW5nKChwYXJzZUludChsb2dNYXRjaFs0XSwgMTApICsgKChsb2dNYXRjaFs3XSA9PSAnUE0nKSA/IDEyIDogMCkpLnRvU3RyaW5nKCkpICsgJzonICsgbG9nTWF0Y2hbNV0gKyAnOicgKyBsb2dNYXRjaFs2XSArICcuMDAwJywKICAgICAgICAgICAgICAgIHRleHQ6IGxvZ0xpbmVzW2xpbmVOdW1iZXJdLAogICAgICAgICAgICAgICAgd29ya2Zsb3c6IGN1cnJlbnRXb3JrZmxvdywKICAgICAgICAgICAgICAgIHByb2Nlc3M6IGN1cnJlbnRQcm9jZXNzLAogICAgICAgICAgICAgICAgcm91dGluZTogY3VycmVudFJvdXRpbmUsCiAgICAgICAgICAgICAgICBwbnJMb2NhdG9yOiBjdXJyZW50TG9jYXRvcgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBsb2dFbnRyaWVzW2xvZ0VudHJ5TnVtYmVyXS50ZXh0ICs9ICdcbicgKyBsb2dMaW5lc1tsaW5lTnVtYmVyXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbG9nRW50cmllczsKICAgICAgfQoKICAgICAgdmFyIGNvbXBsZWF0VmVuZG9yRGVidWcgPSB7CiAgICAgICAgcGFyc2VMb2c6IHBhcnNlRGVidWdMb2cKICAgICAgfTsKCiAgICAgIC8qIGV4cG9zZWQgKi8KICAgICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBjb21wbGVhdFZlbmRvckRlYnVnOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY29tcGxlYXRWZW5kb3JEZWJ1ZyA9IGNvbXBsZWF0VmVuZG9yRGVidWc7CiAgICAgIH0KCiAgICB9KS5jYWxsKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMgfHwgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogZ2xvYmFsKTsKICAgIH0oKSk7CiAgPC9zY3JpcHQ+CiAgPCEtLTxzY3JpcHQgc3JjPSJqYXZhc2NyaXB0cy93c3Bhbi1kaXItcGFyc2VyLmpzIj48L3NjcmlwdD4tLT4KICA8c2NyaXB0Pi8qKioKKiBESVIgcGFyc2VyIGZvciBKYXZhU2NyaXB0CioKKiBDb3B5cmlnaHQgKGMpIDIwMTQgVG9kZCBIYW1ibGV5IChNSVQgTGljZW5zZSkuCioKKi8KICAgIC8qanNoaW50CiAgICAgIGxheGNvbW1hOnRydWUKICAgICAgbGF4YnJlYWs6dHJ1ZQogICAgICBlcW51bGw6dHJ1ZQogICAgICBsb29wZnVuYzp0cnVlCiAgICAgIHN1Yjp0cnVlCiAgICAqLwogICAgOyAoZnVuY3Rpb24gKCkgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICBmdW5jdGlvbiByaWJib24oZmVlZCkgewogICAgICAgIHZhciBfc2xvdCA9IG51bGw7CiAgICAgICAgdmFyIG9yZyA9IGZlZWQgKyAnJzsKICAgICAgICB2YXIgcG9zID0gMDsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHNhdmU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3Nsb3QgPSBwb3M7CiAgICAgICAgICB9CiAgICAgICAgICAsIGxvYWQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcG9zID0gX3Nsb3Q7CiAgICAgICAgICAgIGZlZWQgPSBvcmcuc2xpY2UocG9zKTsKICAgICAgICAgIH0KICAgICAgICAgICwgYWR2YW5jZTogZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgcG9zICs9ICh0eXBlb2YgbiA9PT0gJ3N0cmluZycpID8gbi5sZW5ndGggOiBuOwogICAgICAgICAgICBpZiAocG9zID4gMCkgewogICAgICAgICAgICAgIHJldHVybiAoZmVlZCA9IG9yZy5zbGljZShwb3MpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gZmVlZCA9ICcnOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAsIHJlYWQ6IGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHZhciBpbmZvID0gZmVlZC5zdWJzdHJpbmcoMCwgbik7CiAgICAgICAgICAgIHRoaXMuYWR2YW5jZShuKTsKICAgICAgICAgICAgcmV0dXJuIGluZm87CiAgICAgICAgICB9CiAgICAgICAgICAsIGxvb2tiZWhpbmQ6IGZ1bmN0aW9uIChuY2hhcnMpIHsKICAgICAgICAgICAgbmNoYXJzID0gbmNoYXJzID09IG51bGwgPyAxIDogbmNoYXJzOwogICAgICAgICAgICByZXR1cm4gb3JnLnNsaWNlKHBvcyAtIG5jaGFycywgcG9zKTsKICAgICAgICAgIH0KICAgICAgICAgICwgc3RhcnRzV2l0aDogZnVuY3Rpb24gKHMpIHsKICAgICAgICAgICAgcmV0dXJuIGZlZWQuc3Vic3RyaW5nKDAsIHMubGVuZ3RoKSA9PT0gczsKICAgICAgICAgIH0KICAgICAgICAgICwgdmFsdWVPZjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZmVlZDsKICAgICAgICAgIH0KICAgICAgICAgICwgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZlZWQ7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgLyoqKioqKioqKiB0cmVlICoqKioqKioqKioqKioqKi8KICAgICAgLy9odHRwczovL2dpdGh1Yi5jb20vc3Bpa2VicmVobS9hcmJvcmVhbAoKICAgICAgZnVuY3Rpb24gaW5jbHVkZShhcnJheSwgaXRlbSkgewogICAgICAgIHJldHVybiBhcnJheS5pbmRleE9mKGl0ZW0pID4gLTE7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIF90cmF2ZXJzZURvd24oY29udGV4dCwgaXRlcmF0b3IpIHsKICAgICAgICB2YXIgZG9Db250aW51ZSA9IHRydWU7CgogICAgICAgIChmdW5jdGlvbiB3YWxrRG93bihub2RlKSB7CiAgICAgICAgICB2YXIgaSwgbmV3Q29udGV4dDsKCiAgICAgICAgICBpZiAoIWRvQ29udGludWUpIHJldHVybjsKCiAgICAgICAgICBpZiAoaXRlcmF0b3Iobm9kZSkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIC8vYnJlYWsgdGhlIHRyYXZlcnNhbCBsb29wIGlmIHRoZSBpdGVyYXRvciByZXR1cm5zIGEgZmFsc3kgdmFsdWUKICAgICAgICAgICAgZG9Db250aW51ZSA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBub2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgbmV3Q29udGV4dCA9IG5vZGUuY2hpbGRyZW5baV07CiAgICAgICAgICAgICAgd2Fsa0Rvd24obmV3Q29udGV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KShjb250ZXh0KTsKICAgICAgfQoKCiAgICAgIGZ1bmN0aW9uIF90cmF2ZXJzZVVwKGNvbnRleHQsIGl0ZXJhdG9yKSB7CiAgICAgICAgdmFyIGksIG5vZGUsIGRvQ29udGludWU7CgogICAgICAgIHdoaWxlIChjb250ZXh0KSB7CiAgICAgICAgICBpZiAoaXRlcmF0b3IoY29udGV4dCkgPT09IGZhbHNlKSByZXR1cm47CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvbnRleHQuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbm9kZSA9IGNvbnRleHQuY2hpbGRyZW5baV07CiAgICAgICAgICAgIGlmIChpdGVyYXRvcihub2RlKSA9PT0gZmFsc2UpIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRleHQgPSBjb250ZXh0LnBhcmVudDsKICAgICAgICB9CiAgICAgIH0KCgogICAgICBmdW5jdGlvbiBfdHJhdmVyc2UoY29udGV4dCwgaXRlcmF0b3IsIGNhbGxiYWNrKSB7CiAgICAgICAgdmFyIHZpc2l0ZWQgPSBbXSwKICAgICAgICAgIGNhbGxJdGVyYXRvciA9IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICAgIHZhciBpZCA9IG5vZGUuaWQsCiAgICAgICAgICAgICAgcmV0dXJuZWQ7CgogICAgICAgICAgICBpZiAoIWluY2x1ZGUodmlzaXRlZCwgaWQpKSB7CiAgICAgICAgICAgICAgcmV0dXJuZWQgPSBpdGVyYXRvci5jYWxsKG5vZGUsIG5vZGUpOwogICAgICAgICAgICAgIHZpc2l0ZWQucHVzaChpZCk7CgogICAgICAgICAgICAgIGlmIChyZXR1cm5lZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5lZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBpLCBub2RlOwoKICAgICAgICBjYWxsYmFjayhjb250ZXh0LCBjYWxsSXRlcmF0b3IpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBfcmVtb3ZlQ2hpbGQobm9kZSkgewogICAgICAgIHZhciBwYXJlbnQgPSBub2RlLnBhcmVudCwKICAgICAgICAgIGNoaWxkLAogICAgICAgICAgaTsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBhcmVudC5jaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgY2hpbGQgPSBwYXJlbnQuY2hpbGRyZW5baV07CgogICAgICAgICAgaWYgKGNoaWxkID09PSBub2RlKSB7CiAgICAgICAgICAgIHJldHVybiBwYXJlbnQuY2hpbGRyZW4uc3BsaWNlKGksIDEpLnNoaWZ0KCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBub2RlSWQocGFyZW50LCBzZXBhcmF0b3IpIHsKICAgICAgICBzZXBhcmF0b3IgPSBzZXBhcmF0b3IgfHwgJy8nOwogICAgICAgIGlmIChwYXJlbnQpIHsKICAgICAgICAgIHJldHVybiBbcGFyZW50LmlkLCBwYXJlbnQuY2hpbGRyZW4ubGVuZ3RoXS5qb2luKHNlcGFyYXRvcik7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgcmV0dXJuICcwJzsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIERJUlRyZWUocGFyZW50LCBkYXRhLCBpZCkgewogICAgICAgIHRoaXMuZGVwdGggPSBwYXJlbnQgPyBwYXJlbnQuZGVwdGggKyAxIDogMDsKICAgICAgICB0aGlzLmRhdGEgPSBkYXRhIHx8IHt9OwogICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50IHx8IG51bGw7CiAgICAgICAgdGhpcy5pZCA9IGlkIHx8IG5vZGVJZChwYXJlbnQpOwogICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsKICAgICAgfQoKICAgICAgRElSVHJlZS5wcm90b3R5cGUuYXBwZW5kQ2hpbGQgPSBmdW5jdGlvbiAoZGF0YSwgaWQpIHsKICAgICAgICB2YXIgY2hpbGQgPSBuZXcgRElSVHJlZSh0aGlzLCBkYXRhLCBpZCk7CiAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKGNoaWxkKTsKICAgICAgICByZXR1cm4gY2hpbGQ7CiAgICAgIH07CgogICAgICBESVJUcmVlLnByb3RvdHlwZS5yZW1vdmVDaGlsZCA9IGZ1bmN0aW9uIChhcmcpIHsKICAgICAgICBpZiAodHlwZW9mIGFyZyA9PT0gJ251bWJlcicgJiYgdGhpcy5jaGlsZHJlblthcmddKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbi5zcGxpY2UoYXJnLCAxKS5zaGlmdCgpOwogICAgICAgIH0KICAgICAgICBpZiAoYXJnIGluc3RhbmNlb2YgRElSVHJlZSkgewogICAgICAgICAgcmV0dXJuIF9yZW1vdmVDaGlsZChhcmcpOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgYXJndW1lbnQgIiArIGFyZyk7CiAgICAgIH07CgogICAgICBESVJUcmVlLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIF9yZW1vdmVDaGlsZCh0aGlzKTsKICAgICAgfTsKCgogICAgICBESVJUcmVlLnByb3RvdHlwZS5yb290ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBub2RlID0gdGhpczsKCiAgICAgICAgaWYgKCFub2RlLnBhcmVudCkgewogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICB3aGlsZSAobm9kZS5wYXJlbnQpIHsKICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5vZGU7CiAgICAgIH07CgogICAgICBESVJUcmVlLnByb3RvdHlwZS5pc1Jvb3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICF0aGlzLnBhcmVudDsKICAgICAgfTsKCiAgICAgIERJUlRyZWUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBsaW5lcyA9IFtdOwoKICAgICAgICB0aGlzLnRyYXZlcnNlRG93bihmdW5jdGlvbiAobm9kZSkgewogICAgICAgICAgdmFyIHNlcGFyYXRvciA9ICd8LSAnLCBpbmRlbnRhdGlvbiA9ICcnLCBpOwoKICAgICAgICAgIGlmIChub2RlLmRlcHRoID09PSAwKSB7CiAgICAgICAgICAgIGxpbmVzLnB1c2gobm9kZS5pZCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBub2RlLmRlcHRoOyBpKyspIHsKICAgICAgICAgICAgaW5kZW50YXRpb24gKz0gJ3wnOwogICAgICAgICAgfQogICAgICAgICAgbGluZXMucHVzaChpbmRlbnRhdGlvbiArIHNlcGFyYXRvciArIG5vZGUuZGF0YS5wYXRoICsgKChub2RlLmRhdGEudmFsdWUpID8gJyA9ICcgKyBub2RlLmRhdGEudmFsdWUgOiAnJykpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBsaW5lcy5qb2luKCJcbiIpOwogICAgICB9OwoKICAgICAgRElSVHJlZS5wcm90b3R5cGUudG9YTUwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGxpbmVzID0gW107CgogICAgICAgIChmdW5jdGlvbiB3YWxrRG93blhNTChub2RlKSB7CiAgICAgICAgICB2YXIgaW5kZW50YXRpb24gPSAnJwogICAgICAgICAgdmFyIGk7CiAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBub2RlLmRhdGEubmFtZS5yZXBsYWNlKC9cLy9nLCAnJyk7CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IG5vZGUuZGVwdGg7IGkrKykgewogICAgICAgICAgICBpbmRlbnRhdGlvbiArPSAnICAnOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChub2RlLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgbGluZXMucHVzaChpbmRlbnRhdGlvbiArICI8IiArIG5vZGVOYW1lICsgIj4iKTsKICAgICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBub2RlLmNoaWxkcmVuLmxlbmd0aDsgYysrKSB7CiAgICAgICAgICAgICAgd2Fsa0Rvd25YTUwobm9kZS5jaGlsZHJlbltjXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGluZXMucHVzaChpbmRlbnRhdGlvbiArICI8LyIgKyBub2RlTmFtZSArICI+Iik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaW5lcy5wdXNoKGluZGVudGF0aW9uICsgIjwiICsgbm9kZU5hbWUgKyAiPiIgKyBub2RlLmRhdGEudmFsdWUgKyAiPC8iICsgbm9kZU5hbWUgKyAiPiIpOwogICAgICAgICAgfQoKICAgICAgICB9KSh0aGlzKTsKICAgICAgICByZXR1cm4gbGluZXMuam9pbigiXG4iKTsKICAgICAgfTsKCiAgICAgIERJUlRyZWUucHJvdG90eXBlLnRyYXZlcnNlRG93biA9IGZ1bmN0aW9uIChpdGVyYXRvcikgewogICAgICAgIF90cmF2ZXJzZSh0aGlzLCBpdGVyYXRvciwgX3RyYXZlcnNlRG93bik7CiAgICAgIH07CgogICAgICAvKioqKioqKioqIHRyZWUgKioqKioqKioqKioqKioqLwoKICAgICAgZnVuY3Rpb24gZ2V0VmFyaWFibGVMZW5ndGhTdHJpbmcoZGlyUmVzcG9uc2UpIHsKICAgICAgICB2YXIgZmlyc3RDaGFyID0gZGlyUmVzcG9uc2UucmVhZCgxKTsKICAgICAgICB2YXIgcmVhZExlbmd0aCA9IHBhcnNlSW50KGZpcnN0Q2hhcik7CiAgICAgICAgaWYgKCFpc05hTihyZWFkTGVuZ3RoKSkgewogICAgICAgICAgcmV0dXJuIGRpclJlc3BvbnNlLnJlYWQocmVhZExlbmd0aCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBmaXJzdENoYXI7CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBnZXRTZWN0aW9uVHlwZUNvZGUgPSBnZXRWYXJpYWJsZUxlbmd0aFN0cmluZzsKCiAgICAgIGZ1bmN0aW9uIGdldFZhcmlhYmxlTGVuZ3RoTnVtYmVyKGRpclJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuIHBhcnNlSW50KGdldFZhcmlhYmxlTGVuZ3RoU3RyaW5nKGRpclJlc3BvbnNlKSk7CiAgICAgIH0KICAgICAgdmFyIGdldFNlY3Rpb25MZW5ndGggPSBnZXRWYXJpYWJsZUxlbmd0aE51bWJlcjsKICAgICAgdmFyIGdldEVsZW1lbnRDb3VudCA9IGdldFZhcmlhYmxlTGVuZ3RoTnVtYmVyOwoKICAgICAgZnVuY3Rpb24gcGFyc2VESVJTZWN0aW9uKG1zZ1RleHQsIHBhcmVudCkgewogICAgICAgIGlmIChtc2dUZXh0LnN0YXJ0c1dpdGgoJyonKSB8fCBtc2dUZXh0LnN0YXJ0c1dpdGgoJy4nKSkgewogICAgICAgICAgLy8gbXVsdGlwbGUgaXRlbSBzZWN0aW9uIChvciBzdWJzZWN0aW9uKQogICAgICAgICAgdmFyIGFycmF5VHlwZSA9IG1zZ1RleHQucmVhZCgxKTsKICAgICAgICAgIHZhciBlbGVtZW50Q291bnQgPSBnZXRFbGVtZW50Q291bnQobXNnVGV4dCk7CiAgICAgICAgICB2YXIgc2VjdGlvblR5cGUgPSBnZXRTZWN0aW9uVHlwZUNvZGUobXNnVGV4dCk7CiAgICAgICAgICB2YXIgc2VjdGlvblRleHQgPSByaWJib24obXNnVGV4dC5yZWFkKGdldFNlY3Rpb25MZW5ndGgobXNnVGV4dCkpKTsKCiAgICAgICAgICB2YXIgbm9kZSA9IHBhcmVudC5hcHBlbmRDaGlsZCh7IG5hbWU6IHNlY3Rpb25UeXBlLCBwYXRoOiBwYXJlbnQuZGF0YS5wYXRoICsgJy4nICsgc2VjdGlvblR5cGUgfSk7CgogICAgICAgICAgZm9yICh2YXIgZWxlbWVudENvdW50ZXIgPSAwOyBlbGVtZW50Q291bnRlciA8IGVsZW1lbnRDb3VudDsgZWxlbWVudENvdW50ZXIrKykgewogICAgICAgICAgICBwYXJzZURJUlNlY3Rpb24oc2VjdGlvblRleHQsIG5vZGUpOwogICAgICAgICAgfQoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHNlY3Rpb25UeXBlID0gbXNnVGV4dC5yZWFkKDEpCiAgICAgICAgICBpZiAoc2VjdGlvblR5cGUgIT0gJz4nICYmIHNlY3Rpb25UeXBlICE9ICcwJykgewogICAgICAgICAgICB2YXIgc2VjdGlvblN0YXJ0TnVtYmVyID0gcGFyc2VJbnQoc2VjdGlvblR5cGUpOyAvLyBpcyB0aGUgc2VjdGlvbiBzdGFydCBhIG51bWJlcj8gIGlmIGl0IGlzIC0gaXQgaXNuJ3QgcmVhbGx5IHRoZSBzZWN0aW9uIHR5cGUuICByZWFkIHRoZSBudW1iZXIgb2YgY2hhcmFjdGVycyBpbiB0aGUgc2VjdGlvbiBudW1iZXIgdG8gZ2V0IHRoZSBzZWN0aW9uIHR5cGUKICAgICAgICAgICAgaWYgKCFpc05hTihzZWN0aW9uU3RhcnROdW1iZXIpKSB7CiAgICAgICAgICAgICAgc2VjdGlvblR5cGUgPSBtc2dUZXh0LnJlYWQoc2VjdGlvblN0YXJ0TnVtYmVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgc2VjdGlvblRleHQgPSByaWJib24obXNnVGV4dC5yZWFkKGdldFNlY3Rpb25MZW5ndGgobXNnVGV4dCkpKTsKICAgICAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKHsgbmFtZTogc2VjdGlvblR5cGUsIHZhbHVlOiBzZWN0aW9uVGV4dCwgcGF0aDogcGFyZW50LmRhdGEucGF0aCArICcuJyArIHNlY3Rpb25UeXBlIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gcGFyc2VESVJNZXNzYWdlKGRpclRleHQpIHsKICAgICAgICBkaXJUZXh0ID0gKHR5cGVvZiBkaXJUZXh0ID09PSAnc3RyaW5nJykgPyByaWJib24oZGlyVGV4dCkgOiBkaXJUZXh0OwoKICAgICAgICB2YXIgbXNnVHJlZTsKCiAgICAgICAgaWYgKC8oLio/XCRcZCspKFxkKVtBLVpdKy8udGVzdChkaXJUZXh0LnRvU3RyaW5nKCkpKSB7CiAgICAgICAgICAvL2ZpbmQgdGhlIGJlZ2lubmluZyBvZiB0aGUgRElSIGRhdGEuCiAgICAgICAgICAvL2l0IHdpbGwgbG9vayBzb21ldGhpbmcgbGlrZSB0aGlzOgogICAgICAgICAgLy8kMDAwMDAwMDAwMDAyMTYzUE5SNTExMTc1SDIzOU0yM0FERwogICAgICAgICAgZGlyVGV4dC5hZHZhbmNlKC8oLio/XCRcZCspKFxkKVtBLVpdKy8uZXhlYyhkaXJUZXh0LnRvU3RyaW5nKCkpWzFdKTsKCiAgICAgICAgICB2YXIgdHlwZUxlbmd0aCA9IHBhcnNlSW50KGRpclRleHQucmVhZCgxKSk7CiAgICAgICAgICB2YXIgbXNnVHlwZSA9IGRpclRleHQucmVhZCh0eXBlTGVuZ3RoKTsKCiAgICAgICAgICAvL0RJUlRyZWUgKHBhcmVudCwgZGF0YSwgaWQpCiAgICAgICAgICBtc2dUcmVlID0gbmV3IERJUlRyZWUobnVsbCwgeyBuYW1lOiBtc2dUeXBlLCBwYXRoOiBtc2dUeXBlIH0sIG1zZ1R5cGUpOwoKICAgICAgICAgIHZhciBtc2dUZXh0ID0gcmliYm9uKGRpclRleHQucmVhZChnZXRTZWN0aW9uTGVuZ3RoKGRpclRleHQpKSk7CgogICAgICAgICAgdmFyIHN0YXJ0TGVuZ3RoID0gbXNnVGV4dC50b1N0cmluZygpLmxlbmd0aDsKICAgICAgICAgIHdoaWxlIChtc2dUZXh0LnRvU3RyaW5nKCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICBwYXJzZURJUlNlY3Rpb24obXNnVGV4dCwgbXNnVHJlZSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbXNnVHJlZTsKICAgICAgfQoKICAgICAgdmFyIHdzcGFuRElSID0gewogICAgICAgIHBhcnNlRElSTWVzc2FnZTogcGFyc2VESVJNZXNzYWdlCiAgICAgIH07CgogICAgICAvKiBleHBvc2VkICovCgogICAgICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHsKICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IHdzcGFuRElSOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHRoaXMud3NwYW5ESVIgPSB3c3BhbkRJUjsKICAgICAgfQoKICAgIH0pLmNhbGwoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcyB8fCAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiBnbG9iYWwpOwogICAgfSgpKTsKICA8L3NjcmlwdD4KICA8IS0tIHN5bnRheCBoaWdobGlnaGVyIC0tPgogIDxzdHlsZT4KICAvKgoKT3JpZ2luYWwgaGlnaGxpZ2h0LmpzIHN0eWxlIChjKSBJdmFuIFNhZ2FsYWV2IDxtYW5pYWNAc29mdHdhcmVtYW5pYWNzLm9yZz4KCiovCgouaGxqcyB7CiAgZGlzcGxheTogYmxvY2s7CiAgb3ZlcmZsb3cteDogYXV0bzsKICBwYWRkaW5nOiAwLjVlbTsKICBiYWNrZ3JvdW5kOiAjRjBGMEYwOwp9CgoKLyogQmFzZSBjb2xvcjogc2F0dXJhdGlvbiAwOyAqLwoKLmhsanMsCi5obGpzLXN1YnN0IHsKICBjb2xvcjogIzQ0NDsKfQoKLmhsanMtY29tbWVudCB7CiAgY29sb3I6ICM4ODg4ODg7Cn0KCi5obGpzLWtleXdvcmQsCi5obGpzLWF0dHJpYnV0ZSwKLmhsanMtc2VsZWN0b3ItdGFnLAouaGxqcy1tZXRhLWtleXdvcmQsCi5obGpzLWRvY3RhZywKLmhsanMtbmFtZSB7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7Cn0KCgovKiBVc2VyIGNvbG9yOiBodWU6IDAgKi8KCi5obGpzLXR5cGUsCi5obGpzLXN0cmluZywKLmhsanMtbnVtYmVyLAouaGxqcy1zZWxlY3Rvci1pZCwKLmhsanMtc2VsZWN0b3ItY2xhc3MsCi5obGpzLXF1b3RlLAouaGxqcy10ZW1wbGF0ZS10YWcsCi5obGpzLWRlbGV0aW9uIHsKICBjb2xvcjogIzg4MDAwMDsKfQoKLmhsanMtdGl0bGUsCi5obGpzLXNlY3Rpb24gewogIGNvbG9yOiAjODgwMDAwOwogIGZvbnQtd2VpZ2h0OiBib2xkOwp9CgouaGxqcy1yZWdleHAsCi5obGpzLXN5bWJvbCwKLmhsanMtdmFyaWFibGUsCi5obGpzLXRlbXBsYXRlLXZhcmlhYmxlLAouaGxqcy1saW5rLAouaGxqcy1zZWxlY3Rvci1hdHRyLAouaGxqcy1zZWxlY3Rvci1wc2V1ZG8gewogIGNvbG9yOiAjQkM2MDYwOwp9CgoKLyogTGFuZ3VhZ2UgY29sb3I6IGh1ZTogOTA7ICovCgouaGxqcy1saXRlcmFsIHsKICBjb2xvcjogIzc4QTk2MDsKfQoKLmhsanMtYnVpbHRfaW4sCi5obGpzLWJ1bGxldCwKLmhsanMtY29kZSwKLmhsanMtYWRkaXRpb24gewogIGNvbG9yOiAjMzk3MzAwOwp9CgoKLyogTWV0YSBjb2xvcjogaHVlOiAyMDAgKi8KCi5obGpzLW1ldGEgewogIGNvbG9yOiAjMWY3MTk5Owp9CgouaGxqcy1tZXRhLXN0cmluZyB7CiAgY29sb3I6ICM0ZDk5YmY7Cn0KCgovKiBNaXNjIGVmZmVjdHMgKi8KCi5obGpzLWVtcGhhc2lzIHsKICBmb250LXN0eWxlOiBpdGFsaWM7Cn0KCi5obGpzLXN0cm9uZyB7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7Cn0KCiAgPC9zdHlsZT4KICA8c2NyaXB0PgogIC8qISBoaWdobGlnaHQuanMgdjkuMTIuMCB8IEJTRDMgTGljZW5zZSB8IGdpdC5pby9obGpzbGljZW5zZSAqLwoJIWZ1bmN0aW9uKGUpe3ZhciBuPSJvYmplY3QiPT10eXBlb2Ygd2luZG93JiZ3aW5kb3d8fCJvYmplY3QiPT10eXBlb2Ygc2VsZiYmc2VsZjsidW5kZWZpbmVkIiE9dHlwZW9mIGV4cG9ydHM/ZShleHBvcnRzKTpuJiYobi5obGpzPWUoe30pLCJmdW5jdGlvbiI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQmJmRlZmluZShbXSxmdW5jdGlvbigpe3JldHVybiBuLmhsanN9KSl9KGZ1bmN0aW9uKGUpe2Z1bmN0aW9uIG4oZSl7cmV0dXJuIGUucmVwbGFjZSgvJi9nLCImYW1wOyIpLnJlcGxhY2UoLzwvZywiJmx0OyIpLnJlcGxhY2UoLz4vZywiJmd0OyIpfWZ1bmN0aW9uIHQoZSl7cmV0dXJuIGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKX1mdW5jdGlvbiByKGUsbil7dmFyIHQ9ZSYmZS5leGVjKG4pO3JldHVybiB0JiYwPT09dC5pbmRleH1mdW5jdGlvbiBhKGUpe3JldHVybiBrLnRlc3QoZSl9ZnVuY3Rpb24gaShlKXt2YXIgbix0LHIsaSxvPWUuY2xhc3NOYW1lKyIgIjtpZihvKz1lLnBhcmVudE5vZGU/ZS5wYXJlbnROb2RlLmNsYXNzTmFtZToiIix0PUIuZXhlYyhvKSlyZXR1cm4gdyh0WzFdKT90WzFdOiJuby1oaWdobGlnaHQiO2ZvcihvPW8uc3BsaXQoL1xzKy8pLG49MCxyPW8ubGVuZ3RoO3I+bjtuKyspaWYoaT1vW25dLGEoaSl8fHcoaSkpcmV0dXJuIGl9ZnVuY3Rpb24gbyhlKXt2YXIgbix0PXt9LHI9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO2ZvcihuIGluIGUpdFtuXT1lW25dO3JldHVybiByLmZvckVhY2goZnVuY3Rpb24oZSl7Zm9yKG4gaW4gZSl0W25dPWVbbl19KSx0fWZ1bmN0aW9uIHUoZSl7dmFyIG49W107cmV0dXJuIGZ1bmN0aW9uIHIoZSxhKXtmb3IodmFyIGk9ZS5maXJzdENoaWxkO2k7aT1pLm5leHRTaWJsaW5nKTM9PT1pLm5vZGVUeXBlP2ErPWkubm9kZVZhbHVlLmxlbmd0aDoxPT09aS5ub2RlVHlwZSYmKG4ucHVzaCh7ZXZlbnQ6InN0YXJ0IixvZmZzZXQ6YSxub2RlOml9KSxhPXIoaSxhKSx0KGkpLm1hdGNoKC9icnxocnxpbWd8aW5wdXQvKXx8bi5wdXNoKHtldmVudDoic3RvcCIsb2Zmc2V0OmEsbm9kZTppfSkpO3JldHVybiBhfShlLDApLG59ZnVuY3Rpb24gYyhlLHIsYSl7ZnVuY3Rpb24gaSgpe3JldHVybiBlLmxlbmd0aCYmci5sZW5ndGg/ZVswXS5vZmZzZXQhPT1yWzBdLm9mZnNldD9lWzBdLm9mZnNldDxyWzBdLm9mZnNldD9lOnI6InN0YXJ0Ij09PXJbMF0uZXZlbnQ/ZTpyOmUubGVuZ3RoP2U6cn1mdW5jdGlvbiBvKGUpe2Z1bmN0aW9uIHIoZSl7cmV0dXJuIiAiK2Uubm9kZU5hbWUrJz0iJytuKGUudmFsdWUpLnJlcGxhY2UoJyInLCImcXVvdDsiKSsnIid9cys9IjwiK3QoZSkrRS5tYXAuY2FsbChlLmF0dHJpYnV0ZXMscikuam9pbigiIikrIj4ifWZ1bmN0aW9uIHUoZSl7cys9IjwvIit0KGUpKyI+In1mdW5jdGlvbiBjKGUpeygic3RhcnQiPT09ZS5ldmVudD9vOnUpKGUubm9kZSl9Zm9yKHZhciBsPTAscz0iIixmPVtdO2UubGVuZ3RofHxyLmxlbmd0aDspe3ZhciBnPWkoKTtpZihzKz1uKGEuc3Vic3RyaW5nKGwsZ1swXS5vZmZzZXQpKSxsPWdbMF0ub2Zmc2V0LGc9PT1lKXtmLnJldmVyc2UoKS5mb3JFYWNoKHUpO2RvIGMoZy5zcGxpY2UoMCwxKVswXSksZz1pKCk7d2hpbGUoZz09PWUmJmcubGVuZ3RoJiZnWzBdLm9mZnNldD09PWwpO2YucmV2ZXJzZSgpLmZvckVhY2gobyl9ZWxzZSJzdGFydCI9PT1nWzBdLmV2ZW50P2YucHVzaChnWzBdLm5vZGUpOmYucG9wKCksYyhnLnNwbGljZSgwLDEpWzBdKX1yZXR1cm4gcytuKGEuc3Vic3RyKGwpKX1mdW5jdGlvbiBsKGUpe3JldHVybiBlLnYmJiFlLmNhY2hlZF92YXJpYW50cyYmKGUuY2FjaGVkX3ZhcmlhbnRzPWUudi5tYXAoZnVuY3Rpb24obil7cmV0dXJuIG8oZSx7djpudWxsfSxuKX0pKSxlLmNhY2hlZF92YXJpYW50c3x8ZS5lVyYmW28oZSldfHxbZV19ZnVuY3Rpb24gcyhlKXtmdW5jdGlvbiBuKGUpe3JldHVybiBlJiZlLnNvdXJjZXx8ZX1mdW5jdGlvbiB0KHQscil7cmV0dXJuIG5ldyBSZWdFeHAobih0KSwibSIrKGUuY0k/ImkiOiIiKSsocj8iZyI6IiIpKX1mdW5jdGlvbiByKGEsaSl7aWYoIWEuY29tcGlsZWQpe2lmKGEuY29tcGlsZWQ9ITAsYS5rPWEua3x8YS5iSyxhLmspe3ZhciBvPXt9LHU9ZnVuY3Rpb24obix0KXtlLmNJJiYodD10LnRvTG93ZXJDYXNlKCkpLHQuc3BsaXQoIiAiKS5mb3JFYWNoKGZ1bmN0aW9uKGUpe3ZhciB0PWUuc3BsaXQoInwiKTtvW3RbMF1dPVtuLHRbMV0/TnVtYmVyKHRbMV0pOjFdfSl9OyJzdHJpbmciPT10eXBlb2YgYS5rP3UoImtleXdvcmQiLGEuayk6eChhLmspLmZvckVhY2goZnVuY3Rpb24oZSl7dShlLGEua1tlXSl9KSxhLms9b31hLmxSPXQoYS5sfHwvXHcrLywhMCksaSYmKGEuYksmJihhLmI9IlxcYigiK2EuYksuc3BsaXQoIiAiKS5qb2luKCJ8IikrIilcXGIiKSxhLmJ8fChhLmI9L1xCfFxiLyksYS5iUj10KGEuYiksYS5lfHxhLmVXfHwoYS5lPS9cQnxcYi8pLGEuZSYmKGEuZVI9dChhLmUpKSxhLnRFPW4oYS5lKXx8IiIsYS5lVyYmaS50RSYmKGEudEUrPShhLmU/InwiOiIiKStpLnRFKSksYS5pJiYoYS5pUj10KGEuaSkpLG51bGw9PWEuciYmKGEucj0xKSxhLmN8fChhLmM9W10pLGEuYz1BcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLGEuYy5tYXAoZnVuY3Rpb24oZSl7cmV0dXJuIGwoInNlbGYiPT09ZT9hOmUpfSkpLGEuYy5mb3JFYWNoKGZ1bmN0aW9uKGUpe3IoZSxhKX0pLGEuc3RhcnRzJiZyKGEuc3RhcnRzLGkpO3ZhciBjPWEuYy5tYXAoZnVuY3Rpb24oZSl7cmV0dXJuIGUuYks/IlxcLj8oIitlLmIrIilcXC4/IjplLmJ9KS5jb25jYXQoW2EudEUsYS5pXSkubWFwKG4pLmZpbHRlcihCb29sZWFuKTthLnQ9Yy5sZW5ndGg/dChjLmpvaW4oInwiKSwhMCk6e2V4ZWM6ZnVuY3Rpb24oKXtyZXR1cm4gbnVsbH19fX1yKGUpfWZ1bmN0aW9uIGYoZSx0LGEsaSl7ZnVuY3Rpb24gbyhlLG4pe3ZhciB0LGE7Zm9yKHQ9MCxhPW4uYy5sZW5ndGg7YT50O3QrKylpZihyKG4uY1t0XS5iUixlKSlyZXR1cm4gbi5jW3RdfWZ1bmN0aW9uIHUoZSxuKXtpZihyKGUuZVIsbikpe2Zvcig7ZS5lbmRzUGFyZW50JiZlLnBhcmVudDspZT1lLnBhcmVudDtyZXR1cm4gZX1yZXR1cm4gZS5lVz91KGUucGFyZW50LG4pOnZvaWQgMH1mdW5jdGlvbiBjKGUsbil7cmV0dXJuIWEmJnIobi5pUixlKX1mdW5jdGlvbiBsKGUsbil7dmFyIHQ9Ti5jST9uWzBdLnRvTG93ZXJDYXNlKCk6blswXTtyZXR1cm4gZS5rLmhhc093blByb3BlcnR5KHQpJiZlLmtbdF19ZnVuY3Rpb24gcChlLG4sdCxyKXt2YXIgYT1yPyIiOkkuY2xhc3NQcmVmaXgsaT0nPHNwYW4gY2xhc3M9IicrYSxvPXQ/IiI6QztyZXR1cm4gaSs9ZSsnIj4nLGkrbitvfWZ1bmN0aW9uIGgoKXt2YXIgZSx0LHIsYTtpZighRS5rKXJldHVybiBuKGspO2ZvcihhPSIiLHQ9MCxFLmxSLmxhc3RJbmRleD0wLHI9RS5sUi5leGVjKGspO3I7KWErPW4oay5zdWJzdHJpbmcodCxyLmluZGV4KSksZT1sKEUsciksZT8oQis9ZVsxXSxhKz1wKGVbMF0sbihyWzBdKSkpOmErPW4oclswXSksdD1FLmxSLmxhc3RJbmRleCxyPUUubFIuZXhlYyhrKTtyZXR1cm4gYStuKGsuc3Vic3RyKHQpKX1mdW5jdGlvbiBkKCl7dmFyIGU9InN0cmluZyI9PXR5cGVvZiBFLnNMO2lmKGUmJiF5W0Uuc0xdKXJldHVybiBuKGspO3ZhciB0PWU/ZihFLnNMLGssITAseFtFLnNMXSk6ZyhrLEUuc0wubGVuZ3RoP0Uuc0w6dm9pZCAwKTtyZXR1cm4gRS5yPjAmJihCKz10LnIpLGUmJih4W0Uuc0xdPXQudG9wKSxwKHQubGFuZ3VhZ2UsdC52YWx1ZSwhMSwhMCl9ZnVuY3Rpb24gYigpe0wrPW51bGwhPUUuc0w/ZCgpOmgoKSxrPSIifWZ1bmN0aW9uIHYoZSl7TCs9ZS5jTj9wKGUuY04sIiIsITApOiIiLEU9T2JqZWN0LmNyZWF0ZShlLHtwYXJlbnQ6e3ZhbHVlOkV9fSl9ZnVuY3Rpb24gbShlLG4pe2lmKGsrPWUsbnVsbD09bilyZXR1cm4gYigpLDA7dmFyIHQ9byhuLEUpO2lmKHQpcmV0dXJuIHQuc2tpcD9rKz1uOih0LmVCJiYoays9biksYigpLHQuckJ8fHQuZUJ8fChrPW4pKSx2KHQsbiksdC5yQj8wOm4ubGVuZ3RoO3ZhciByPXUoRSxuKTtpZihyKXt2YXIgYT1FO2Euc2tpcD9rKz1uOihhLnJFfHxhLmVFfHwoays9biksYigpLGEuZUUmJihrPW4pKTtkbyBFLmNOJiYoTCs9QyksRS5za2lwfHwoQis9RS5yKSxFPUUucGFyZW50O3doaWxlKEUhPT1yLnBhcmVudCk7cmV0dXJuIHIuc3RhcnRzJiZ2KHIuc3RhcnRzLCIiKSxhLnJFPzA6bi5sZW5ndGh9aWYoYyhuLEUpKXRocm93IG5ldyBFcnJvcignSWxsZWdhbCBsZXhlbWUgIicrbisnIiBmb3IgbW9kZSAiJysoRS5jTnx8Ijx1bm5hbWVkPiIpKyciJyk7cmV0dXJuIGsrPW4sbi5sZW5ndGh8fDF9dmFyIE49dyhlKTtpZighTil0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gbGFuZ3VhZ2U6ICInK2UrJyInKTtzKE4pO3ZhciBSLEU9aXx8Tix4PXt9LEw9IiI7Zm9yKFI9RTtSIT09TjtSPVIucGFyZW50KVIuY04mJihMPXAoUi5jTiwiIiwhMCkrTCk7dmFyIGs9IiIsQj0wO3RyeXtmb3IodmFyIE0saixPPTA7Oyl7aWYoRS50Lmxhc3RJbmRleD1PLE09RS50LmV4ZWModCksIU0pYnJlYWs7aj1tKHQuc3Vic3RyaW5nKE8sTS5pbmRleCksTVswXSksTz1NLmluZGV4K2p9Zm9yKG0odC5zdWJzdHIoTykpLFI9RTtSLnBhcmVudDtSPVIucGFyZW50KVIuY04mJihMKz1DKTtyZXR1cm57cjpCLHZhbHVlOkwsbGFuZ3VhZ2U6ZSx0b3A6RX19Y2F0Y2goVCl7aWYoVC5tZXNzYWdlJiYtMSE9PVQubWVzc2FnZS5pbmRleE9mKCJJbGxlZ2FsIikpcmV0dXJue3I6MCx2YWx1ZTpuKHQpfTt0aHJvdyBUfX1mdW5jdGlvbiBnKGUsdCl7dD10fHxJLmxhbmd1YWdlc3x8eCh5KTt2YXIgcj17cjowLHZhbHVlOm4oZSl9LGE9cjtyZXR1cm4gdC5maWx0ZXIodykuZm9yRWFjaChmdW5jdGlvbihuKXt2YXIgdD1mKG4sZSwhMSk7dC5sYW5ndWFnZT1uLHQucj5hLnImJihhPXQpLHQucj5yLnImJihhPXIscj10KX0pLGEubGFuZ3VhZ2UmJihyLnNlY29uZF9iZXN0PWEpLHJ9ZnVuY3Rpb24gcChlKXtyZXR1cm4gSS50YWJSZXBsYWNlfHxJLnVzZUJSP2UucmVwbGFjZShNLGZ1bmN0aW9uKGUsbil7cmV0dXJuIEkudXNlQlImJiJcbiI9PT1lPyI8YnI+IjpJLnRhYlJlcGxhY2U/bi5yZXBsYWNlKC9cdC9nLEkudGFiUmVwbGFjZSk6IiJ9KTplfWZ1bmN0aW9uIGgoZSxuLHQpe3ZhciByPW4/TFtuXTp0LGE9W2UudHJpbSgpXTtyZXR1cm4gZS5tYXRjaCgvXGJobGpzXGIvKXx8YS5wdXNoKCJobGpzIiksLTE9PT1lLmluZGV4T2YocikmJmEucHVzaChyKSxhLmpvaW4oIiAiKS50cmltKCl9ZnVuY3Rpb24gZChlKXt2YXIgbix0LHIsbyxsLHM9aShlKTthKHMpfHwoSS51c2VCUj8obj1kb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiLCJkaXYiKSxuLmlubmVySFRNTD1lLmlubmVySFRNTC5yZXBsYWNlKC9cbi9nLCIiKS5yZXBsYWNlKC88YnJbIFwvXSo+L2csIlxuIikpOm49ZSxsPW4udGV4dENvbnRlbnQscj1zP2YocyxsLCEwKTpnKGwpLHQ9dShuKSx0Lmxlbmd0aCYmKG89ZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiwiZGl2Iiksby5pbm5lckhUTUw9ci52YWx1ZSxyLnZhbHVlPWModCx1KG8pLGwpKSxyLnZhbHVlPXAoci52YWx1ZSksZS5pbm5lckhUTUw9ci52YWx1ZSxlLmNsYXNzTmFtZT1oKGUuY2xhc3NOYW1lLHMsci5sYW5ndWFnZSksZS5yZXN1bHQ9e2xhbmd1YWdlOnIubGFuZ3VhZ2UscmU6ci5yfSxyLnNlY29uZF9iZXN0JiYoZS5zZWNvbmRfYmVzdD17bGFuZ3VhZ2U6ci5zZWNvbmRfYmVzdC5sYW5ndWFnZSxyZTpyLnNlY29uZF9iZXN0LnJ9KSl9ZnVuY3Rpb24gYihlKXtJPW8oSSxlKX1mdW5jdGlvbiB2KCl7aWYoIXYuY2FsbGVkKXt2LmNhbGxlZD0hMDt2YXIgZT1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJwcmUgY29kZSIpO0UuZm9yRWFjaC5jYWxsKGUsZCl9fWZ1bmN0aW9uIG0oKXthZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIix2LCExKSxhZGRFdmVudExpc3RlbmVyKCJsb2FkIix2LCExKX1mdW5jdGlvbiBOKG4sdCl7dmFyIHI9eVtuXT10KGUpO3IuYWxpYXNlcyYmci5hbGlhc2VzLmZvckVhY2goZnVuY3Rpb24oZSl7TFtlXT1ufSl9ZnVuY3Rpb24gUigpe3JldHVybiB4KHkpfWZ1bmN0aW9uIHcoZSl7cmV0dXJuIGU9KGV8fCIiKS50b0xvd2VyQ2FzZSgpLHlbZV18fHlbTFtlXV19dmFyIEU9W10seD1PYmplY3Qua2V5cyx5PXt9LEw9e30saz0vXihuby0/aGlnaGxpZ2h0fHBsYWlufHRleHQpJC9pLEI9L1xibGFuZyg/OnVhZ2UpPy0oW1x3LV0rKVxiL2ksTT0vKCheKDxbXj5dKz58XHR8KSt8KD86XG4pKSkvZ20sQz0iPC9zcGFuPiIsST17Y2xhc3NQcmVmaXg6ImhsanMtIix0YWJSZXBsYWNlOm51bGwsdXNlQlI6ITEsbGFuZ3VhZ2VzOnZvaWQgMH07cmV0dXJuIGUuaGlnaGxpZ2h0PWYsZS5oaWdobGlnaHRBdXRvPWcsZS5maXhNYXJrdXA9cCxlLmhpZ2hsaWdodEJsb2NrPWQsZS5jb25maWd1cmU9YixlLmluaXRIaWdobGlnaHRpbmc9dixlLmluaXRIaWdobGlnaHRpbmdPbkxvYWQ9bSxlLnJlZ2lzdGVyTGFuZ3VhZ2U9TixlLmxpc3RMYW5ndWFnZXM9UixlLmdldExhbmd1YWdlPXcsZS5pbmhlcml0PW8sZS5JUj0iW2EtekEtWl1cXHcqIixlLlVJUj0iW2EtekEtWl9dXFx3KiIsZS5OUj0iXFxiXFxkKyhcXC5cXGQrKT8iLGUuQ05SPSIoLT8pKFxcYjBbeFhdW2EtZkEtRjAtOV0rfChcXGJcXGQrKFxcLlxcZCopP3xcXC5cXGQrKShbZUVdWy0rXT9cXGQrKT8pIixlLkJOUj0iXFxiKDBiWzAxXSspIixlLlJTUj0iIXwhPXwhPT18JXwlPXwmfCYmfCY9fFxcKnxcXCo9fFxcK3xcXCs9fCx8LXwtPXwvPXwvfDp8O3w8PHw8PD18PD18PHw9PT18PT18PXw+Pj49fD4+PXw+PXw+Pj58Pj58PnxcXD98XFxbfFxce3xcXCh8XFxefFxcXj18XFx8fFxcfD18XFx8XFx8fH4iLGUuQkU9e2I6IlxcXFxbXFxzXFxTXSIscjowfSxlLkFTTT17Y046InN0cmluZyIsYjoiJyIsZToiJyIsaToiXFxuIixjOltlLkJFXX0sZS5RU009e2NOOiJzdHJpbmciLGI6JyInLGU6JyInLGk6IlxcbiIsYzpbZS5CRV19LGUuUFdNPXtiOi9cYihhfGFufHRoZXxhcmV8SSdtfGlzbid0fGRvbid0fGRvZXNuJ3R8d29uJ3R8YnV0fGp1c3R8c2hvdWxkfHByZXR0eXxzaW1wbHl8ZW5vdWdofGdvbm5hfGdvaW5nfHd0Znxzb3xzdWNofHdpbGx8eW91fHlvdXJ8dGhleXxsaWtlfG1vcmUpXGIvfSxlLkM9ZnVuY3Rpb24obix0LHIpe3ZhciBhPWUuaW5oZXJpdCh7Y046ImNvbW1lbnQiLGI6bixlOnQsYzpbXX0scnx8e30pO3JldHVybiBhLmMucHVzaChlLlBXTSksYS5jLnB1c2goe2NOOiJkb2N0YWciLGI6Iig/OlRPRE98RklYTUV8Tk9URXxCVUd8WFhYKToiLHI6MH0pLGF9LGUuQ0xDTT1lLkMoIi8vIiwiJCIpLGUuQ0JDTT1lLkMoIi9cXCoiLCJcXCovIiksZS5IQ009ZS5DKCIjIiwiJCIpLGUuTk09e2NOOiJudW1iZXIiLGI6ZS5OUixyOjB9LGUuQ05NPXtjTjoibnVtYmVyIixiOmUuQ05SLHI6MH0sZS5CTk09e2NOOiJudW1iZXIiLGI6ZS5CTlIscjowfSxlLkNTU05NPXtjTjoibnVtYmVyIixiOmUuTlIrIiglfGVtfGV4fGNofHJlbXx2d3x2aHx2bWlufHZtYXh8Y218bW18aW58cHR8cGN8cHh8ZGVnfGdyYWR8cmFkfHR1cm58c3xtc3xIenxrSHp8ZHBpfGRwY218ZHBweCk/IixyOjB9LGUuUk09e2NOOiJyZWdleHAiLGI6L1wvLyxlOi9cL1tnaW11eV0qLyxpOi9cbi8sYzpbZS5CRSx7YjovXFsvLGU6L1xdLyxyOjAsYzpbZS5CRV19XX0sZS5UTT17Y046InRpdGxlIixiOmUuSVIscjowfSxlLlVUTT17Y046InRpdGxlIixiOmUuVUlSLHI6MH0sZS5NRVRIT0RfR1VBUkQ9e2I6IlxcLlxccyoiK2UuVUlSLHI6MH0sZX0pO2hsanMucmVnaXN0ZXJMYW5ndWFnZSgianNvbiIsZnVuY3Rpb24oZSl7dmFyIGk9e2xpdGVyYWw6InRydWUgZmFsc2UgbnVsbCJ9LG49W2UuUVNNLGUuQ05NXSxyPXtlOiIsIixlVzohMCxlRTohMCxjOm4sazppfSx0PXtiOiJ7IixlOiJ9IixjOlt7Y046ImF0dHIiLGI6LyIvLGU6LyIvLGM6W2UuQkVdLGk6IlxcbiJ9LGUuaW5oZXJpdChyLHtiOi86L30pXSxpOiJcXFMifSxjPXtiOiJcXFsiLGU6IlxcXSIsYzpbZS5pbmhlcml0KHIpXSxpOiJcXFMifTtyZXR1cm4gbi5zcGxpY2Uobi5sZW5ndGgsMCx0LGMpLHtjOm4sazppLGk6IlxcUyJ9fSk7aGxqcy5yZWdpc3Rlckxhbmd1YWdlKCJ4bWwiLGZ1bmN0aW9uKHMpe3ZhciBlPSJbQS1aYS16MC05XFwuXzotXSsiLHQ9e2VXOiEwLGk6LzwvLHI6MCxjOlt7Y046ImF0dHIiLGI6ZSxyOjB9LHtiOi89XHMqLyxyOjAsYzpbe2NOOiJzdHJpbmciLGVuZHNQYXJlbnQ6ITAsdjpbe2I6LyIvLGU6LyIvfSx7YjovJy8sZTovJy99LHtiOi9bXlxzIic9PD5gXSsvfV19XX1dfTtyZXR1cm57YWxpYXNlczpbImh0bWwiLCJ4aHRtbCIsInJzcyIsImF0b20iLCJ4amIiLCJ4c2QiLCJ4c2wiLCJwbGlzdCJdLGNJOiEwLGM6W3tjTjoibWV0YSIsYjoiPCFET0NUWVBFIixlOiI+IixyOjEwLGM6W3tiOiJcXFsiLGU6IlxcXSJ9XX0scy5DKCI8IS0tIiwiLS0+Iix7cjoxMH0pLHtiOiI8XFwhXFxbQ0RBVEFcXFsiLGU6IlxcXVxcXT4iLHI6MTB9LHtiOi88XD8ocGhwKT8vLGU6L1w/Pi8sc0w6InBocCIsYzpbe2I6Ii9cXCoiLGU6IlxcKi8iLHNraXA6ITB9XX0se2NOOiJ0YWciLGI6IjxzdHlsZSg/PVxcc3w+fCQpIixlOiI+IixrOntuYW1lOiJzdHlsZSJ9LGM6W3RdLHN0YXJ0czp7ZToiPC9zdHlsZT4iLHJFOiEwLHNMOlsiY3NzIiwieG1sIl19fSx7Y046InRhZyIsYjoiPHNjcmlwdCg/PVxcc3w+fCQpIixlOiI+IixrOntuYW1lOiJzY3JpcHQifSxjOlt0XSxzdGFydHM6e2U6IjwiKyIvc2NyaXB0PiIsckU6ITAsc0w6WyJhY3Rpb25zY3JpcHQiLCJqYXZhc2NyaXB0IiwiaGFuZGxlYmFycyIsInhtbCJdfX0se2NOOiJtZXRhIix2Olt7YjovPFw/eG1sLyxlOi9cPz4vLHI6MTB9LHtiOi88XD9cdysvLGU6L1w/Pi99XX0se2NOOiJ0YWciLGI6IjwvPyIsZToiLz8+IixjOlt7Y046Im5hbWUiLGI6L1teXC8+PFxzXSsvLHI6MH0sdF19XX19KTsKICA8L3NjcmlwdD4KPC9oZWFkPgoKPGJvZHk+CiAgPGRpdiBpZD0iaW5wdXRkaXYiIHN0eWxlPSJ3aWR0aDoxMDAlOyBtYXJnaW46IDAgYXV0bzsgcGFkZGluZzogMCAwIDEwcHg7Ij4KICAgIDx1bCBjbGFzcz0idGFicyIgZGF0YS1wZXJzaXN0PSJ0cnVlIiBpZD0idGFic2xpc3QiPgogICAgICA8bGkgaWQ9InRhYjEiPgogICAgICAgIDxhIGlkPSJ0YWIxbGluayIgaHJlZj0iI3NlYXJjaHZpZXciPlNlYXJjaDwvYT4KICAgICAgPC9saT4KICAgICAgPGxpIGlkPSJ0YWIyIj4KICAgICAgICA8YSBpZD0idGFiMmxpbmsiIGhyZWY9IiNmaWx0ZXJ2aWV3Ij5GaWx0ZXI8L2E+CiAgICAgIDwvbGk+CiAgICAgIDxsaSBpZD0idGFiMyI+CiAgICAgICAgPGEgaWQ9InRhYjNsaW5rIiBocmVmPSIjc2V0dGluZ3N2aWV3Ij5TZXR0aW5nczwvYT4KICAgICAgPC9saT4KICAgICAgPGxpIGlkPSJ0YWI0Ij4KICAgICAgICA8YSBpZD0idGFiNGxpbmsiIGhyZWY9IiNpbmZvdmlldyI+SW5mbzwvYT4KICAgICAgPC9saT4KICAgIDwvdWw+CiAgICA8ZGl2IGNsYXNzPSJ0YWJjb250ZW50cyI+CiAgICAgIDxkaXYgaWQ9InNlYXJjaHZpZXciPgogICAgICAgIDxmb3JtIGlkPSJzZWFyY2giPgogICAgICAgICAgPGRpdiBjbGFzcz0ic3RyaW5nIGlucHV0IG9wdGlvbmFsIHN0cmluZ2lzaCBzZWFyY2hfZm9ybV9maWVsZCBzZWFyY2hfc3RyaW5nIiBpZD0icV9zZWFyY2hfaW5wdXQiPgogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX3NlYXJjaCIgY2xhc3M9ImxhYmVsIj5TZWFyY2g6PC9sYWJlbD4KICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJzZWFyY2giIHBsYWNlaG9sZGVyPSJTZWFyY2ggbG9nIiBuYW1lPSJxW3NlYXJjaF0iIGlkPSJxX3NlYXJjaCIgLz4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ic2VsZWN0IGlucHV0IG9wdGlvbmFsIHNlYXJjaF9mb3JtX2ZpZWxkIHNlYXJjaF9zZWxlY3QiIGlkPSJxX2NvbHVtbl9pbnB1dCI+CiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfY29sdW1uIiBjbGFzcz0ibGFiZWwiPkNvbHVtbihzKTo8L2xhYmVsPgogICAgICAgICAgICA8c2VsZWN0IG5hbWU9InFbY29sdW1uXSIgaWQ9InFfY29sdW1uIiBtdWx0aXBsZT0ibXVsdGlwbGUiIHNpemU9IjUiPgogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImxpbmVOdW1iZXIiPkxpbmU8L29wdGlvbj4KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJ3b3JrZXIiPldvcmtlcjwvb3B0aW9uPgogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IndvcmtzdGF0aW9uIj5Xb3Jrc3RhdGlvbjwvb3B0aW9uPgogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IndvcmtmbG93Ij5Xb3JrZmxvdzwvb3B0aW9uPgogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9InByb2Nlc3MiPlByb2Nlc3M8L29wdGlvbj4KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJyb3V0aW5lIj5Sb3V0aW5lPC9vcHRpb24+CiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0icG5yTG9jYXRvciI+TG9jYXRvcjwvb3B0aW9uPgogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImNhdGVnb3J5Ij5DYXRlZ29yeTwvb3B0aW9uPgogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImxldmVsIj5MZXZlbDwvb3B0aW9uPgogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImRhdGVUaW1lVGV4dCI+RGF0ZS9UaW1lPC9vcHRpb24+CiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0idGV4dCI+VGV4dDwvb3B0aW9uPgogICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0iYnV0dG9ucyI+CiAgICAgICAgICAgIDxpbnB1dCBuYW1lPSJhcHBseV9zZWFyY2hfYnRuIiBpZD0iYXBwbHlfc2VhcmNoX2J0biIgY2xhc3M9InN1Ym1pdF9idG4iIHR5cGU9InN1Ym1pdCIgdmFsdWU9IlNlYXJjaCIgLz4KICAgICAgICAgICAgPGlucHV0IG5hbWU9ImNsZWFyX3NlYXJjaF9idG4iIGlkPSJjbGVhcl9zZWFyY2hfYnRuIiBjbGFzcz0icmVzZXRfYnRuIiB0eXBlPSJidXR0b24iIHZhbHVlPSJDbGVhciIgLz4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZm9ybT4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgaWQ9ImZpbHRlcnZpZXciPgogICAgICAgIDxmb3JtIGlkPSJmaWx0ZXIiPgogICAgICAgICAgPGRpdiBjbGFzcz0ibnVtYmVyX3JhbmdlIGlucHV0IG9wdGlvbmFsIGZpbHRlcl9mb3JtX2ZpZWxkIGZpbHRlcl9udW1iZXJfcmFuZ2UiIGlkPSJxX2xpbmVfbnVtYmVyX2lucHV0Ij4KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJsYWJlbCI+TGluZTwvbGFiZWw+CiAgICAgICAgICAgIDxpbnB1dCBzaXplPSIxMiIgbWF4bGVuZ3RoPSIxMCIgcGxhY2Vob2xkZXI9IkZyb20iIHZhbHVlPSIiIHR5cGU9Im51bWJlciIgbmFtZT0icVtsaW5lX251bWJlcl9ndGVxXSIKICAgICAgICAgICAgICBpZD0icV9saW5lX251bWJlcl9ndGVxIj4KICAgICAgICAgICAgPGlucHV0IHNpemU9IjEyIiBtYXhsZW5ndGg9IjEwIiBwbGFjZWhvbGRlcj0iVG8iIHZhbHVlPSIiIHR5cGU9Im51bWJlciIgbmFtZT0icVtsaW5lX251bWJlcl9sdGVxXSIKICAgICAgICAgICAgICBpZD0icV9saW5lX251bWJlcl9sdGVxIj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ic2VsZWN0IGlucHV0IG9wdGlvbmFsIGZpbHRlcl9mb3JtX2ZpZWxkIGZpbHRlcl9zZWxlY3QiIGlkPSJxX3dvcmtlcl9pbnB1dCI+CiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfd29ya2VyIiBjbGFzcz0ibGFiZWwiPldvcmtlcjo8L2xhYmVsPgogICAgICAgICAgICA8c2VsZWN0IG5hbWU9InFbd29ya2VyX2VxXSIgaWQ9InFfd29ya2VyIj4KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJBbGwiPkFsbDwvb3B0aW9uPgogICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ic2VsZWN0IGlucHV0IG9wdGlvbmFsIGZpbHRlcl9mb3JtX2ZpZWxkIGZpbHRlcl9zZWxlY3QiIGlkPSJxX3dvcmtzdGF0aW9uX2lucHV0Ij4KICAgICAgICAgICAgPGxhYmVsIGZvcj0icV93b3Jrc3RhdGlvbiIgY2xhc3M9ImxhYmVsIj5Xb3Jrc3RhdGlvbjo8L2xhYmVsPgogICAgICAgICAgICA8c2VsZWN0IG5hbWU9InFbd29ya3N0YXRpb25fZXFdIiBpZD0icV93b3Jrc3RhdGlvbiI+CiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQWxsIj5BbGw8L29wdGlvbj4KICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9InNlbGVjdCBpbnB1dCBvcHRpb25hbCBmaWx0ZXJfZm9ybV9maWVsZCBmaWx0ZXJfc2VsZWN0IiBpZD0icV93b3JrZmxvd19pbnB1dCI+CiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfd29ya2Zsb3ciIGNsYXNzPSJsYWJlbCI+V29ya2Zsb3c6PC9sYWJlbD4KICAgICAgICAgICAgPHNlbGVjdCBuYW1lPSJxW3dvcmtmbG93X2VxXSIgaWQ9InFfd29ya2Zsb3ciPgogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkFsbCI+QWxsPC9vcHRpb24+CiAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWxlY3QgaW5wdXQgb3B0aW9uYWwgZmlsdGVyX2Zvcm1fZmllbGQgZmlsdGVyX3NlbGVjdCIgaWQ9InFfcHJvY2Vzc19pbnB1dCI+CiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfcHJvY2VzcyIgY2xhc3M9ImxhYmVsIj5Qcm9jZXNzOjwvbGFiZWw+CiAgICAgICAgICAgIDxzZWxlY3QgbmFtZT0icVtwcm9jZXNzX2VxXSIgaWQ9InFfcHJvY2VzcyI+CiAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQWxsIj5BbGw8L29wdGlvbj4KICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9InNlbGVjdCBpbnB1dCBvcHRpb25hbCBmaWx0ZXJfZm9ybV9maWVsZCBmaWx0ZXJfc2VsZWN0IiBpZD0icV9jYXRlZ29yeV9pbnB1dCI+CiAgICAgICAgICAgIDxsYWJlbCBmb3I9InFfY2F0ZWdvcnkiIGNsYXNzPSJsYWJlbCI+Q2F0ZWdvcnk6PC9sYWJlbD4KICAgICAgICAgICAgPHNlbGVjdCBuYW1lPSJxW2NhdGVnb3J5X2VxXSIgaWQ9InFfY2F0ZWdvcnkiPgogICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkFsbCI+QWxsPC9vcHRpb24+CiAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJzZWxlY3QgaW5wdXQgb3B0aW9uYWwgZmlsdGVyX2Zvcm1fZmllbGQgZmlsdGVyX3NlbGVjdCIgaWQ9InFfbGV2ZWxfaW5wdXQiPgogICAgICAgICAgICA8bGFiZWwgZm9yPSJxX2xldmVsIiBjbGFzcz0ibGFiZWwiPkxldmVsOjwvbGFiZWw+CiAgICAgICAgICAgIDxzZWxlY3QgbmFtZT0icVtsZXZlbF9lcV0iIGlkPSJxX2xldmVsIj4KICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJBbGwiPkFsbDwvb3B0aW9uPgogICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0iZGF0ZV9yYW5nZSBpbnB1dCBvcHRpb25hbCBmaWx0ZXJfZm9ybV9maWVsZCBmaWx0ZXJfZGF0ZV9yYW5nZSIgaWQ9InFfZGF0ZV90aW1lX2lucHV0Ij4KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJsYWJlbCI+RGF0ZS9UaW1lOjwvbGFiZWw+CiAgICAgICAgICAgIDxpbnB1dCBjbGFzcz0iZGF0ZXBpY2tlciIgc2l6ZT0iMTIiIG1heGxlbmd0aD0iMTAiIHBsYWNlaG9sZGVyPSJGcm9tIiB2YWx1ZT0iIiB0eXBlPSJ0ZXh0IgogICAgICAgICAgICAgIG5hbWU9InFbZGF0ZV90aW1lX2d0ZXFdIiBpZD0icV9kYXRlX3RpbWVfZ3RlcSI+CiAgICAgICAgICAgIDxpbnB1dCBjbGFzcz0iZGF0ZXBpY2tlciIgc2l6ZT0iMTIiIG1heGxlbmd0aD0iMTAiIHBsYWNlaG9sZGVyPSJUbyIgdmFsdWU9IiIgdHlwZT0idGV4dCIKICAgICAgICAgICAgICBuYW1lPSJxW2RhdGVfdGltZV9sdGVxXSIgaWQ9InFfZGF0ZV90aW1lX2x0ZXEiPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJidXR0b25zIj4KICAgICAgICAgICAgPGlucHV0IG5hbWU9ImFwcGx5X2ZpbHRlcnNfYnRuIiBpZD0iYXBwbHlfZmlsdGVyc19idG4iIGNsYXNzPSJzdWJtaXRfYnRuIiB0eXBlPSJzdWJtaXQiIHZhbHVlPSJGaWx0ZXIiIC8+CiAgICAgICAgICAgIDxpbnB1dCBuYW1lPSJjbGVhcl9maWx0ZXJzX2J0biIgaWQ9ImNsZWFyX2ZpbHRlcnNfYnRuIiBjbGFzcz0icmVzZXRfYnRuIiB0eXBlPSJidXR0b24iIHZhbHVlPSJDbGVhciIgLz4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZm9ybT4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgaWQ9InNldHRpbmdzdmlldyI+CiAgICAgICAgPGZvcm0gaWQ9InNldHRpbmdzIj4KICAgICAgICAgIDxmaWVsZHNldCBpZD0iY29sdW1uc3Rvc2hvdyI+CiAgICAgICAgICAgIDxsZWdlbmQ+Q29sdW1ucyB0byBzaG93PC9sZWdlbmQ+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZyBpdGVtIGNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJsaW5lb25vZmZzd2l0Y2giIGNsYXNzPSJpdGVtIj5MaW5lOiA8L2xhYmVsPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPgogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9ImxpbmVOdW1iZXJvbm9mZnN3aXRjaCIgY2xhc3M9Im9ub2Zmc3dpdGNoLWNoZWNrYm94IgogICAgICAgICAgICAgICAgICAgIGlkPSJsaW5lTnVtYmVyb25vZmZzd2l0Y2giIGNoZWNrZWQ+CiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0ibGluZU51bWJlcm9ub2Zmc3dpdGNoIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtc3dpdGNoIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9Indvcmtlcm9ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+V29ya2VyOiA8L2xhYmVsPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPgogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9Indvcmtlcm9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giIGlkPSJ3b3JrZXJvbm9mZnN3aXRjaCI+CiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0id29ya2Vyb25vZmZzd2l0Y2giPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1pbm5lciI+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0id29ya3N0YXRpb25vbm9mZnN3aXRjaCIgY2xhc3M9Iml0ZW0iPldvcmtzdGF0aW9uOiA8L2xhYmVsPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPgogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9IndvcmtzdGF0aW9ub25vZmZzd2l0Y2giIGNsYXNzPSJvbm9mZnN3aXRjaC1jaGVja2JveCIKICAgICAgICAgICAgICAgICAgICBpZD0id29ya3N0YXRpb25vbm9mZnN3aXRjaCI+CiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0id29ya3N0YXRpb25vbm9mZnN3aXRjaCI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZyBpdGVtIGNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+V29ya2Zsb3c6IDwvbGFiZWw+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+CiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0id29ya2Zsb3dvbm9mZnN3aXRjaCIgY2xhc3M9Im9ub2Zmc3dpdGNoLWNoZWNrYm94IgogICAgICAgICAgICAgICAgICAgIGlkPSJ3b3JrZmxvd29ub2Zmc3dpdGNoIiBjaGVja2VkPgogICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9Im9ub2Zmc3dpdGNoLWxhYmVsIiBmb3I9IndvcmtmbG93b25vZmZzd2l0Y2giPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1pbm5lciI+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0icHJvY2Vzc29ub2Zmc3dpdGNoIiBjbGFzcz0iaXRlbSI+UHJvY2VzczogPC9sYWJlbD4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9ub2Zmc3dpdGNoIj4KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJwcm9jZXNzb25vZmZzd2l0Y2giIGNsYXNzPSJvbm9mZnN3aXRjaC1jaGVja2JveCIgaWQ9InByb2Nlc3Nvbm9mZnN3aXRjaCIKICAgICAgICAgICAgICAgICAgICBjaGVja2VkPgogICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9Im9ub2Zmc3dpdGNoLWxhYmVsIiBmb3I9InByb2Nlc3Nvbm9mZnN3aXRjaCI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZyBpdGVtIGNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJyb3V0aW5lb25vZmZzd2l0Y2giIGNsYXNzPSJpdGVtIj5Sb3V0aW5lOiA8L2xhYmVsPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPgogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9InJvdXRpbmVvbm9mZnN3aXRjaCIgY2xhc3M9Im9ub2Zmc3dpdGNoLWNoZWNrYm94IiBpZD0icm91dGluZW9ub2Zmc3dpdGNoIgogICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ+CiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0icm91dGluZW9ub2Zmc3dpdGNoIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtc3dpdGNoIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InBuckxvY2F0b3Jvbm9mZnN3aXRjaCIgY2xhc3M9Iml0ZW0iPkxvY2F0b3I6IDwvbGFiZWw+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJvbm9mZnN3aXRjaCI+CiAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0icG5yTG9jYXRvcm9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giCiAgICAgICAgICAgICAgICAgICAgaWQ9InBuckxvY2F0b3Jvbm9mZnN3aXRjaCIgY2hlY2tlZD4KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJwbnJMb2NhdG9yb25vZmZzd2l0Y2giPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1pbm5lciI+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvbm9mZnN3aXRjaC1zd2l0Y2giPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNldHRpbmcgaXRlbSBjb250YWluZXIiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0iY2F0ZWdvcnlvbm9mZnN3aXRjaCIgY2xhc3M9Iml0ZW0iPkNhdGVnb3J5OiA8L2xhYmVsPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib25vZmZzd2l0Y2giPgogICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9ImNhdGVnb3J5b25vZmZzd2l0Y2giIGNsYXNzPSJvbm9mZnN3aXRjaC1jaGVja2JveCIKICAgICAgICAgICAgICAgICAgICBpZD0iY2F0ZWdvcnlvbm9mZnN3aXRjaCIgY2hlY2tlZD4KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJjYXRlZ29yeW9ub2Zmc3dpdGNoIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtaW5uZXIiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ib25vZmZzd2l0Y2gtc3dpdGNoIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXR0aW5nIGl0ZW0gY29udGFpbmVyIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImxldmVsb25vZmZzd2l0Y2giIGNsYXNzPSJpdGVtIj5MZXZlbDogPC9sYWJlbD4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9ub2Zmc3dpdGNoIj4KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJsZXZlbG9ub2Zmc3dpdGNoIiBjbGFzcz0ib25vZmZzd2l0Y2gtY2hlY2tib3giIGlkPSJsZXZlbG9ub2Zmc3dpdGNoIgogICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ+CiAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ib25vZmZzd2l0Y2gtbGFiZWwiIGZvcj0ibGV2ZWxvbm9mZnN3aXRjaCI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZyBpdGVtIGNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJkYXRlVGltZVRleHRvbm9mZnN3aXRjaCIgY2xhc3M9Iml0ZW0iPkRhdGUvVGltZTogPC9sYWJlbD4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9ub2Zmc3dpdGNoIj4KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJkYXRlVGltZVRleHRvbm9mZnN3aXRjaCIgY2xhc3M9Im9ub2Zmc3dpdGNoLWNoZWNrYm94IgogICAgICAgICAgICAgICAgICAgIGlkPSJkYXRlVGltZVRleHRvbm9mZnN3aXRjaCIgY2hlY2tlZD4KICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJvbm9mZnN3aXRjaC1sYWJlbCIgZm9yPSJkYXRlVGltZVRleHRvbm9mZnN3aXRjaCI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2V0dGluZyBpdGVtIGNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ0ZXh0b25vZmZzd2l0Y2giIGNsYXNzPSJpdGVtIj4gVGV4dDogPC9sYWJlbD4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im9ub2Zmc3dpdGNoIj4KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJ0ZXh0b25vZmZzd2l0Y2giIGNsYXNzPSJvbm9mZnN3aXRjaC1jaGVja2JveCIgaWQ9InRleHRvbm9mZnN3aXRjaCIKICAgICAgICAgICAgICAgICAgICBjaGVja2VkPgogICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9Im9ub2Zmc3dpdGNoLWxhYmVsIiBmb3I9InRleHRvbm9mZnN3aXRjaCI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLWlubmVyIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9ub2Zmc3dpdGNoLXN3aXRjaCI+PC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9maWVsZHNldD4KICAgICAgICA8L2Zvcm0+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGlkPSJpbmZvdmlldyI+CiAgICAgICAgPGRpdiBpZD0iaW5mbyI+CiAgICAgICAgICA8ZGl2IGlkPSJpbmZvRmlsZSIgY2xhc3M9ImluZm8iPjxzcGFuIGNsYXNzPSJpbmZvTGFiZWwiPkZpbGUgbmFtZTogPC9zcGFuPjxzcGFuIGlkPSJpbmZvRmlsZW5hbWUiPjwvc3Bhbj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBpZD0iaW5mb1NlYXJjaCIgY2xhc3M9ImluZm8gaGlkZGVuIj48c3BhbiBjbGFzcz0iaW5mb0xhYmVsIj5TZWFyY2ggZm9yIDwvc3Bhbj48c3BhbgogICAgICAgICAgICAgIGlkPSJpbmZvU2VhcmNoVGV4dCI+PC9zcGFuPjwvZGl2PgogICAgICAgICAgPGRpdiBpZD0iaW5mb1NlYXJjaENvbHVtbnMiIGNsYXNzPSJpbmZvIGhpZGRlbiI+PHNwYW4gY2xhc3M9ImluZm9MYWJlbCI+aW4gY29sdW1uczogPC9zcGFuPjxzcGFuCiAgICAgICAgICAgICAgaWQ9ImluZm9TZWFyY2hDb2x1bW5zVGV4dCI+PC9zcGFuPjwvZGl2PgogICAgICAgICAgPGRpdiBpZD0iaW5mb0ZpbHRlciIgY2xhc3M9ImluZm8gaGlkZGVuIj48c3BhbiBjbGFzcz0iaW5mb0xhYmVsIj5GaWx0ZXJzOiA8L3NwYW4+PHNwYW4KICAgICAgICAgICAgICBpZD0iaW5mb0ZpbHRlclRleHQiPjwvc3Bhbj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICA8L2Rpdj4KICA8ZGl2IGlkPSJsb2d0YWJsZSI+CiAgICA8ZGl2IGlkPSJwYWdlZGl2Ij4KICAgICAgPHVsIGNsYXNzPSJwYWdpbmF0aW9uIj48L3VsPgogICAgPC9kaXY+CiAgICA8ZGl2IGlkPSJkYXRhIj4KICAgICAgPHRhYmxlIGNsYXNzPSJsaXN0YWJsZSBzb3J0YWJsZSI+CiAgICAgICAgPGNvbGdyb3VwPgogICAgICAgICAgPGNvbCBjbGFzcz0ibGluZU51bWJlciIgLz4KICAgICAgICAgIDxjb2wgY2xhc3M9IndvcmtlciIgLz4KICAgICAgICAgIDxjb2wgY2xhc3M9IndvcmtzdGF0aW9uIiAvPgogICAgICAgICAgPGNvbCBjbGFzcz0id29ya2Zsb3ciIC8+CiAgICAgICAgICA8Y29sIGNsYXNzPSJwcm9jZXNzIiAvPgogICAgICAgICAgPGNvbCBjbGFzcz0icm91dGluZSIgLz4KICAgICAgICAgIDxjb2wgY2xhc3M9InBuckxvY2F0b3IiIC8+CiAgICAgICAgICA8Y29sIGNsYXNzPSJjYXRlZ29yeSIgLz4KICAgICAgICAgIDxjb2wgY2xhc3M9ImxldmVsIiAvPgogICAgICAgICAgPGNvbCBjbGFzcz0iZGF0ZVRpbWVUZXh0IiAvPgogICAgICAgICAgPGNvbCBjbGFzcz0idGV4dCIgLz4KICAgICAgICA8L2NvbGdyb3VwPgogICAgICAgIDx0aGVhZD4KICAgICAgICAgIDx0cj4KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IGxpbmVOdW1iZXIiIGRhdGEtc29ydD0ibGluZU51bWJlciI+TGluZTwvdGg+CiAgICAgICAgICAgIDx0aCBjbGFzcz0ic29ydCB3b3JrZXIiIGRhdGEtc29ydD0id29ya2VyIj5Xb3JrZXI8L3RoPgogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgd29ya3N0YXRpb24iIGRhdGEtc29ydD0id29ya3N0YXRpb24iPldvcmtzdGF0aW9uPC90aD4KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IHdvcmtmbG93IiBkYXRhLXNvcnQ9IndvcmtmbG93Ij5Xb3JrZmxvdzwvdGg+CiAgICAgICAgICAgIDx0aCBjbGFzcz0ic29ydCBwcm9jZXNzIiBkYXRhLXNvcnQ9InByb2Nlc3MiPlByb2Nlc3M8L3RoPgogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgcm91dGluZSIgZGF0YS1zb3J0PSJyb3V0aW5lIj5Sb3V0aW5lPC90aD4KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IHBuckxvY2F0b3IiIGRhdGEtc29ydD0icG5yTG9jYXRvciI+TG9jYXRvcjwvdGg+CiAgICAgICAgICAgIDx0aCBjbGFzcz0ic29ydCBjYXRlZ29yeSIgZGF0YS1zb3J0PSJjYXRlZ29yeSI+Q2F0ZWdvcnk8L3RoPgogICAgICAgICAgICA8dGggY2xhc3M9InNvcnQgbGV2ZWwiIGRhdGEtc29ydD0ibGV2ZWwiPkxldmVsPC90aD4KICAgICAgICAgICAgPHRoIGNsYXNzPSJzb3J0IGRhdGVUaW1lVGV4dCIgZGF0YS1zb3J0PSJkYXRlVGltZVRleHQiPkRhdGUvVGltZTwvdGg+CiAgICAgICAgICAgIDx0aCBjbGFzcz0ic29ydCB0ZXh0IiBkYXRhLXNvcnQ9InRleHQiPlRleHQ8L3RoPgogICAgICAgICAgPC90cj4KICAgICAgICA8L3RoZWFkPgogICAgICAgIDx0Ym9keSBjbGFzcz0ibGlzdCI+CiAgICAgICAgICA8dHI+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0ibGluZU51bWJlciI+PC90ZD4KICAgICAgICAgICAgPHRkIGNsYXNzPSJ3b3JrZXIiPjwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0id29ya3N0YXRpb24iPjwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0id29ya2Zsb3ciPjwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0icHJvY2VzcyI+PC90ZD4KICAgICAgICAgICAgPHRkIGNsYXNzPSJyb3V0aW5lIj48L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9InBuckxvY2F0b3IiPjwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0iY2F0ZWdvcnkiPjwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0ibGV2ZWwiPjwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0iZGF0ZVRpbWVUZXh0Ij48L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9InRleHQiPjwvdGQ+CiAgICAgICAgICA8L3RyPgogICAgICAgIDwvdGJvZHk+CiAgICAgIDwvdGFibGU+CiAgICA8L2Rpdj4KICA8L2Rpdj4KICA8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+CiAgICAvL2xpc3QKICAgIHZhciBvcHRpb25zID0gewogICAgICB2YWx1ZU5hbWVzOiBbJ2xpbmVOdW1iZXInLCAnd29ya2VyJywgJ3dvcmtzdGF0aW9uJywgJ2NhdGVnb3J5JywgJ2xldmVsJywgJ2RhdGVUaW1lVGV4dCcsICd0ZXh0JywgJ3dvcmtmbG93JywKICAgICAgICAncHJvY2VzcycsICdyb3V0aW5lJywgJ3BuckxvY2F0b3InCiAgICAgIF0sCiAgICAgIHBhZ2U6IDIwLAogICAgICBwbHVnaW5zOiBbTGlzdFBhZ2luYXRpb24oewogICAgICAgIG91dGVyV2luZG93OiAyCiAgICAgIH0pXQogICAgfTsKICAgIC8vIEluaXQgbGlzdAogICAgdmFyIGxvZ1RhYmxlID0gbmV3IExpc3QoJ2xvZ3RhYmxlJywgb3B0aW9ucyk7CiAgICBsb2dUYWJsZS5vbigndXBkYXRlZCcsIGhpZ2hsaWdodFhtbCk7CiAgICBsb2dUYWJsZS5vbigndXBkYXRlZCcsIGNvbnZlcnRESVIpOwogICAgbG9nVGFibGUub24oJ3VwZGF0ZWQnLCB1cGRhdGVDb2x1bW5zKTsKCiAgICAvLyBHRFNYIExvZyBoYW5kbGluZwogICAgLyoKICAgIGZ1bmN0aW9uIHByb2Nlc3NUZXh0Qm94KGUpIHsKICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBwcm9jZXNzTG9nVGV4dChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9ndGV4dCcpLnZhbHVlKTsKICAgICAgaW5mby5maWxlTmFtZSA9ICdDb3B5L1Bhc3RlJzsKICAgICAgc2hvd0luZm8oKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgKi8KCiAgICBmdW5jdGlvbiBwcmV0dHlYbWwoeG1sVGV4dCkgewogICAgICB2YXIgZm9ybWF0ID0gcmVxdWlyZSgneG1sLWZvcm1hdHRlcicpOwoKICAgICAgdmFyIG9wdGlvbnMgPSB7CiAgICAgICAgaW5kZW50YXRpb246ICcgICcsCiAgICAgICAgc3RyaXBDb21tZW50czogdHJ1ZQogICAgICB9OwogICAgICByZXR1cm4gZm9ybWF0KHhtbFRleHQsIG9wdGlvbnMpOwogICAgfQoKICAgIC8vIHV0aWxpdHkgZnVuY3Rpb24gdG8gcHJvY2VzcyBsb2cgdGV4dAogICAgZnVuY3Rpb24gcHJvY2Vzc0xvZ1RleHQobG9nVGV4dCkgewogICAgICBpZiAobG9nVGV4dC5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIGxvZ0FycmF5ID0gY29tcGxlYXRWZW5kb3JEZWJ1Zy5wYXJzZUxvZyhsb2dUZXh0KTsKICAgICAgfQogICAgICBsb2dUYWJsZS5jbGVhcigpOwogICAgICBsb2dUYWJsZS5hZGQobG9nQXJyYXkpOwogICAgICBidWlsZEZpbHRlcnMobG9nQXJyYXkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhpZ2hsaWdodFhtbCgpIHsKICAgICAgdmFyIHRleHROb2RlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3RleHQnKTsKICAgICAgdmFyIHhtbE5vZGVzID0gQXJyYXkucHJvdG90eXBlLmZpbHRlci5jYWxsKHRleHROb2RlcywgZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICByZXR1cm4gbm9kZS5jaGlsZE5vZGVzICYmIG5vZGUuY2hpbGROb2Rlc1swXSAmJiBub2RlLmNoaWxkTm9kZXNbMF0ubm9kZVR5cGUgIT09IE5vZGUuVEVYVF9OT0RFCiAgICAgIH0pOwogICAgICB4bWxOb2Rlcy5mb3JFYWNoKGVsZW1lbnQgPT4gewogICAgICAgIGlmIChlbGVtZW50LmNoaWxkTm9kZXNbMF0udGFnTmFtZSAmJiBlbGVtZW50LmNoaWxkTm9kZXNbMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAncHJlJykgewogICAgICAgICAgdmFyIHByZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ByZScpOwogICAgICAgICAgdmFyIGNvZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjb2RlJyk7CiAgICAgICAgICBjb2RlLmNsYXNzTmFtZSA9ICd4bWwnOwogICAgICAgICAgcHJlLmFwcGVuZENoaWxkKGNvZGUpOwogICAgICAgICAgdmFyIHhtbCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHByZXR0eVhtbChlbGVtZW50LmlubmVySFRNTCkpOwogICAgICAgICAgY29kZS5hcHBlbmRDaGlsZCh4bWwpOwogICAgICAgICAgZWxlbWVudC5yZW1vdmVDaGlsZChlbGVtZW50LmNoaWxkTm9kZXNbMF0pOwogICAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChwcmUpOwogICAgICAgICAgaGxqcy5oaWdobGlnaHRCbG9jayhjb2RlKTsKICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuY2hpbGROb2Rlc1swXS5ub2RlVHlwZSA9PT0gTm9kZS5DT01NRU5UX05PREUpIHsKCQkgIHZhciBwcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwcmUnKTsKICAgICAgICAgIHZhciBjb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY29kZScpOwoJCSAgY29kZS5jbGFzc05hbWUgPSAneG1sJzsKICAgICAgICAgIHByZS5hcHBlbmRDaGlsZChjb2RlKTsKCQkgIHZhciB4bWxUZXh0ID0gIiI7CgkJICB3aGlsZShlbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoID4gMCkKCQkgIHsKCQkJaWYgKGVsZW1lbnQuY2hpbGROb2Rlc1swXS5ub2RlVHlwZSA9PSBOb2RlLkVMRU1FTlRfTk9ERSkKCQkJewoJCQkgIHhtbFRleHQgPSBuZXcgWE1MU2VyaWFsaXplcigpLnNlcmlhbGl6ZVRvU3RyaW5nKGVsZW1lbnQuY2hpbGROb2Rlc1swXSkucmVwbGFjZSgvPFthLXpcZF0rOi9pZywgIjwiKS5yZXBsYWNlKC88XC9bYS16XGRdKzovaWcsICI8LyIpOwoJCQl9CgkJICAgIGVsZW1lbnQucmVtb3ZlQ2hpbGQoZWxlbWVudC5jaGlsZE5vZGVzWzBdKTsKCQkgIH0KCQkgIHZhciB4bWwgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShwcmV0dHlYbWwoeG1sVGV4dCkpOwoJCSAgY29kZS5hcHBlbmRDaGlsZCh4bWwpOwoJCSAgZWxlbWVudC5hcHBlbmRDaGlsZChwcmUpOwoJCSAgaGxqcy5oaWdobGlnaHRCbG9jayhjb2RlKTsKCQl9CiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGNvbnZlcnRESVIoKSB7CiAgICAgIHZhciB0ZXh0Tm9kZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd0ZXh0Jyk7CiAgICAgIHZhciBkaXJOb2RlcyA9IEFycmF5LmZyb20odGV4dE5vZGVzKS5maWx0ZXIobm9kZSA9PiAobm9kZS5pbm5lclRleHQgfHwgbm9kZS50ZXh0Q29udGVudCkuc3Vic3RyaW5nKDAsIDMpID09PSAnRElSJyk7CiAgICAgIGRpck5vZGVzLmZvckVhY2goZWxlbWVudCA9PiB7CiAgICAgICAgdmFyIERJUlRyZWUgPSB3c3BhbkRJUi5wYXJzZURJUk1lc3NhZ2UoZWxlbWVudC5pbm5lclRleHQgfHwgZWxlbWVudC50ZXh0Q29udGVudCk7CiAgICAgICAgaWYgKERJUlRyZWUpIHsKICAgICAgICAgIHZhciBwcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwcmUnKTsKICAgICAgICAgIHZhciBjb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY29kZScpOwogICAgICAgICAgY29kZS5jbGFzc05hbWUgPSAneG1sJzsKICAgICAgICAgIHByZS5hcHBlbmRDaGlsZChjb2RlKTsKICAgICAgICAgIHZhciBwbGFpblhNTCA9IERJUlRyZWUudG9YTUwoKTsKICAgICAgICAgIHZhciB4bWwgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShwbGFpblhNTCk7CiAgICAgICAgICBjb2RlLmFwcGVuZENoaWxkKHhtbCk7CiAgICAgICAgICBlbGVtZW50LnJlbW92ZUNoaWxkKGVsZW1lbnQuY2hpbGROb2Rlc1swXSk7CiAgICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKHByZSk7CiAgICAgICAgICBobGpzLmhpZ2hsaWdodEJsb2NrKGNvZGUpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgLy9odHRwOi8vanNmaWRkbGUubmV0LzBHaVMwL25EVllkLwogICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYjFsaW5rJyksICdjbGljaycsIHJlc2l6ZURhdGEpOwogICAgICBhZGRFdmVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiMmxpbmsnKSwgJ2NsaWNrJywgcmVzaXplRGF0YSk7CiAgICAgIGFkZEV2ZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWIzbGluaycpLCAnY2xpY2snLCByZXNpemVEYXRhKTsKICAgICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYjRsaW5rJyksICdjbGljaycsIHJlc2l6ZURhdGEpOwoKICAgICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlcicpLCAnc3VibWl0JywgYXBwbHlGaWx0ZXJzKTsKICAgICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyX2ZpbHRlcnNfYnRuJyksICdjbGljaycsIGNsZWFyRmlsdGVycyk7CiAgICAgIGFkZEV2ZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2gnKSwgJ3N1Ym1pdCcsIGFwcGx5U2VhcmNoKTsKICAgICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyX3NlYXJjaF9idG4nKSwgJ2NsaWNrJywgY2xlYXJTZWFyY2gpOwogICAgICBpbml0Q29sdW1ucygpOwogICAgICB1cGRhdGVJbmZvKCk7CiAgICAgIHJlc2l6ZURhdGEoKTsKICAgICAgcHJvY2Vzc0xvZ1RleHQoJyVMT0dURVhUJScpOwoJICBzaG93SW5mbygpOwogICAgfQoKICAgIHdpbmRvdy5vbnJlc2l6ZSA9IHJlc2l6ZURhdGE7CgogICAgZnVuY3Rpb24gcmVzaXplRGF0YSgpIHsKICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHJlc2l6ZUVsZW1lbnRIZWlnaHQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEnKSkKICAgICAgfSwgNTApOwogICAgfQoKICAgIC8qKiBpbmZvICoqLwogICAgdmFyIGluZm8gPSB7CiAgICAgIGZpbGVOYW1lOiAnJUZJTEVOQU1FJScsCiAgICAgIHNlYXJjaFRleHQ6ICcnLAogICAgICBzZWFyY2hDb2x1bW5zOiBbXSwKICAgICAgZmlsdGVyczogW10KICAgIH07CgogICAgZnVuY3Rpb24gc2hvd0luZm8oKSB7CiAgICAgIHVwZGF0ZUluZm8oKTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYjRsaW5rJykuY2xpY2soKTsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRhdGVJbmZvKCkgewogICAgICB2YXIgZmlsZU5hbWVEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5mb0ZpbGVuYW1lJyk7CiAgICAgIGZpbGVOYW1lRGl2LmlubmVyVGV4dCA9IGluZm8uZmlsZU5hbWU7CiAgICAgIHZhciBzZWFyY2hEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5mb1NlYXJjaCcpOwogICAgICB2YXIgc2VhcmNoQ29sdW1uc0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvU2VhcmNoQ29sdW1ucycpOwogICAgICBpZiAoaW5mby5zZWFyY2hUZXh0Lmxlbmd0aCA9PSAwKSB7CiAgICAgICAgc2VhcmNoRGl2LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIHNlYXJjaENvbHVtbnNEaXYuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VhcmNoRGl2LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIHZhciBzZWFyY2hUZXh0RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luZm9TZWFyY2hUZXh0Jyk7CiAgICAgICAgc2VhcmNoVGV4dERpdi5pbm5lclRleHQgPSBpbmZvLnNlYXJjaFRleHQ7CiAgICAgICAgc2VhcmNoQ29sdW1uc0Rpdi5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICB2YXIgc2VhcmNoQ29sdW1uc1RleHREaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5mb1NlYXJjaENvbHVtbnNUZXh0Jyk7CiAgICAgICAgaWYgKGluZm8uc2VhcmNoQ29sdW1ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBzZWFyY2hDb2x1bW5zVGV4dERpdi5pbm5lclRleHQgPSBpbmZvLnNlYXJjaENvbHVtbnMuam9pbignLCAnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VhcmNoQ29sdW1uc1RleHREaXYuaW5uZXJUZXh0ID0gJ0FsbCc7CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBmaWx0ZXJEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5mb0ZpbHRlcicpOwogICAgICBpZiAoaW5mby5maWx0ZXJzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgZmlsdGVyRGl2LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICB9IGVsc2UgewogICAgICAgIGZpbHRlckRpdi5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICB2YXIgZmlsdGVyVGV4dERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvRmlsdGVyVGV4dCcpOwogICAgICAgIGZpbHRlclRleHREaXYuaW5uZXJIVE1MID0gaW5mby5maWx0ZXJzLmpvaW4oJyBhbmQgJyk7CiAgICAgIH0KICAgIH0KCiAgICAvKiogU2V0dGluZ3MgKiovCiAgICBmdW5jdGlvbiBpbml0Q29sdW1ucygpIHsKICAgICAgdmFyIHRibCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkYXRhID4gdGFibGUnKTsKICAgICAgdmFyIGNvbHMgPSBBcnJheS5mcm9tKHRibC5xdWVyeVNlbGVjdG9yQWxsKCdjb2wnKSk7CiAgICAgIGNvbHMuZm9yRWFjaChjb2wgPT4gewogICAgICAgIHZhciBjb2xOYW1lID0gY29sLmNsYXNzTmFtZTsKICAgICAgICB2YXIgY2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb2xOYW1lICsgJ29ub2Zmc3dpdGNoJyk7CiAgICAgICAgaWYgKGNoZWNrYm94KSB7CiAgICAgICAgICB2YXIgZGlzcGxheU1vZGUgPSAoY2hlY2tib3guY2hlY2tlZCkgPyAndGFibGUtY2VsbCcgOiAnbm9uZSc7CiAgICAgICAgICBBcnJheS5mcm9tKHRibC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGNvbE5hbWUpKS5mb3JFYWNoKGNlbGwgPT4gY2VsbC5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheU1vZGUpOwogICAgICAgICAgYWRkRXZlbnQoY2hlY2tib3gsICdjaGFuZ2UnLCB0b2dnbGVDb2x1bW4pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlQ29sdW1ucygpIHsKICAgICAgdmFyIHRibCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkYXRhID4gdGFibGUnKTsKICAgICAgdmFyIGNvbHMgPSBBcnJheS5mcm9tKHRibC5xdWVyeVNlbGVjdG9yQWxsKCdjb2wnKSk7CiAgICAgIGNvbHMuZm9yRWFjaChjb2wgPT4gewogICAgICAgIHZhciBjb2xOYW1lID0gY29sLmNsYXNzTmFtZTsKICAgICAgICB2YXIgY2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb2xOYW1lICsgJ29ub2Zmc3dpdGNoJyk7CiAgICAgICAgaWYgKGNoZWNrYm94KSB7CiAgICAgICAgICB2YXIgZGlzcGxheU1vZGUgPSAoY2hlY2tib3guY2hlY2tlZCkgPyAndGFibGUtY2VsbCcgOiAnbm9uZSc7CiAgICAgICAgICBBcnJheS5mcm9tKHRibC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGNvbE5hbWUpKS5mb3JFYWNoKGNlbGwgPT4gY2VsbC5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheU1vZGUpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9nZ2xlQ29sdW1uKGV2dCkgewogICAgICB2YXIgY2hlY2tib3ggPSBldnQudGFyZ2V0OwogICAgICB2YXIgY29sTmFtZSA9IGNoZWNrYm94LmlkLnJlcGxhY2UoJ29ub2Zmc3dpdGNoJywgJycpOwogICAgICB2YXIgdGJsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2RhdGEgPiB0YWJsZScpOwogICAgICB2YXIgZGlzcGxheU1vZGUgPSAoY2hlY2tib3guY2hlY2tlZCkgPyAndGFibGUtY2VsbCcgOiAnbm9uZSc7CiAgICAgIEFycmF5LmZyb20odGJsLnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgY29sTmFtZSkpLmZvckVhY2goY2VsbCA9PiBjZWxsLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5TW9kZSk7CiAgICAgIHJlc2l6ZURhdGEoKTsKICAgIH0KCiAgICAvKiogU2VhcmNoICoqLwogICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTE4MjEyNjEvaG93LXRvLWdldC1hbGwtc2VsZWN0ZWQtdmFsdWVzLWZyb20tc2VsZWN0LW11bHRpcGxlLW11bHRpcGxlCiAgICBmdW5jdGlvbiBnZXRTZWxlY3RWYWx1ZXMoc2VsZWN0KSB7CiAgICAgIHZhciByZXN1bHQgPSBbXTsKICAgICAgdmFyIG9wdGlvbnMgPSBzZWxlY3QgJiYgc2VsZWN0Lm9wdGlvbnM7CiAgICAgIHZhciBvcHQ7CgogICAgICBmb3IgKHZhciBpID0gMCwgaUxlbiA9IG9wdGlvbnMubGVuZ3RoOyBpIDwgaUxlbjsgaSsrKSB7CiAgICAgICAgb3B0ID0gb3B0aW9uc1tpXTsKCiAgICAgICAgaWYgKG9wdC5zZWxlY3RlZCkgewogICAgICAgICAgcmVzdWx0LnB1c2gob3B0LnZhbHVlIHx8IG9wdC50ZXh0KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMjgwMjczOS9kZXNlbGVjdC1zZWxlY3RlZC1vcHRpb25zLWluLXNlbGVjdC1tZW51LXdpdGgtbXVsdGlwbGUtYW5kLW9wdGdyb3VwcwogICAgZnVuY3Rpb24gY2xlYXJTZWxlY3RlZChzZWxlY3QpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBzZWxlY3QgJiYgc2VsZWN0Lm9wdGlvbnM7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBvcHRpb25zW2ldLnNlbGVjdGVkID0gZmFsc2U7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBhcHBseVNlYXJjaChlKSB7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgdmFyIGNvbHVtbnMgPSBnZXRTZWxlY3RWYWx1ZXMoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FfY29sdW1uJykpOwogICAgICB2YXIgc2VhcmNoVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3NlYXJjaCcpLnZhbHVlOwogICAgICBpZiAoY29sdW1ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgbG9nVGFibGUuc2VhcmNoKHNlYXJjaFRleHQsIGNvbHVtbnMpOwogICAgICB9IGVsc2UgewogICAgICAgIGxvZ1RhYmxlLnNlYXJjaChzZWFyY2hUZXh0KTsKICAgICAgfQogICAgICBpbmZvLnNlYXJjaENvbHVtbnMgPSBjb2x1bW5zOwogICAgICBpbmZvLnNlYXJjaFRleHQgPSBzZWFyY2hUZXh0OwogICAgICBzaG93SW5mbygpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gY2xlYXJTZWFyY2goKSB7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3NlYXJjaCcpLnZhbHVlID0gJyc7CiAgICAgIGNvbHVtbkNob2ljZXMucmVtb3ZlQWN0aXZlSXRlbXMoKTsKICAgICAgaW5mby5zZWFyY2hDb2x1bW5zID0gW107CiAgICAgIGluZm8uc2VhcmNoVGV4dCA9ICcnOwogICAgICB1cGRhdGVJbmZvKCk7CiAgICAgIGxvZ1RhYmxlLnNlYXJjaCgpOyAvLyBTaG93IGFsbCBpdGVtcyBpbiBsaXN0CiAgICB9CgogICAgLyoqIEVuZCBzZWFyY2ggKiovCgogICAgLyoqIGZpbHRlcnMgKiovCiAgICAvLyBpbml0IGRhdGVwaWNrZXJzOgogICAgZmxhdHBpY2tyKCIuZGF0ZXBpY2tlciIsIHsKICAgICAgZW5hYmxlVGltZTogdHJ1ZSwKICAgICAgZGF0ZUZvcm1hdDogIlktbS1kIEg6aSIKICAgIH0pOwoKICAgIGNvbnN0IGNvbHVtbkNob2ljZXMgPSBuZXcgQ2hvaWNlcygnI3FfY29sdW1uJywgewogICAgICByZW1vdmVJdGVtQnV0dG9uOiB0cnVlLAogICAgICBkdXBsaWNhdGVJdGVtc0FsbG93ZWQ6IGZhbHNlCiAgICB9KQogICAgY29uc3Qgd29ya2VyQ2hvaWNlcyA9IG5ldyBDaG9pY2VzKCcjcV93b3JrZXInLCB7CiAgICAgIGR1cGxpY2F0ZUl0ZW1zQWxsb3dlZDogZmFsc2UKICAgIH0pOwogICAgY29uc3Qgd29ya3N0YXRpb25DaG9pY2VzID0gbmV3IENob2ljZXMoJyNxX3dvcmtzdGF0aW9uJywgewogICAgICBkdXBsaWNhdGVJdGVtc0FsbG93ZWQ6IGZhbHNlCiAgICB9KTsKICAgIGNvbnN0IHdvcmtmbG93Q2hvaWNlcyA9IG5ldyBDaG9pY2VzKCcjcV93b3JrZmxvdycsIHsKICAgICAgZHVwbGljYXRlSXRlbXNBbGxvd2VkOiBmYWxzZQogICAgfSk7CiAgICBjb25zdCBwcm9jZXNzQ2hvaWNlcyA9IG5ldyBDaG9pY2VzKCcjcV9wcm9jZXNzJywgewogICAgICBkdXBsaWNhdGVJdGVtc0FsbG93ZWQ6IGZhbHNlCiAgICB9KTsKICAgIGNvbnN0IGNhdGVnb3J5Q2hvaWNlcyA9IG5ldyBDaG9pY2VzKCcjcV9jYXRlZ29yeScsIHsKICAgICAgZHVwbGljYXRlSXRlbXNBbGxvd2VkOiBmYWxzZQogICAgfSk7CiAgICBjb25zdCBsZXZlbENob2ljZXMgPSBuZXcgQ2hvaWNlcygnI3FfbGV2ZWwnLCB7CiAgICAgIGR1cGxpY2F0ZUl0ZW1zQWxsb3dlZDogZmFsc2UKICAgIH0pOwoKICAgIGZ1bmN0aW9uIHBvcHVsYXRlQ2hvaWNlcyhjaG9pY2VCb3gsIHZhbHVlcykgewogICAgICBjaG9pY2VzID0gdmFsdWVzLm1hcCgodmFsKSA9PiB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHZhbHVlOiB2YWwudG9TdHJpbmcoKSwKICAgICAgICAgIGxhYmVsOiB2YWwudG9TdHJpbmcoKSwKICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZQogICAgICAgIH07CiAgICAgIH0pOwogICAgICBjaG9pY2VzLnVuc2hpZnQoewogICAgICAgIHZhbHVlOiAnQWxsJywKICAgICAgICBsYWJlbDogJ0FsbCcsCiAgICAgICAgc2VsZWN0ZWQ6IHRydWUKICAgICAgfSk7CiAgICAgIGNob2ljZUJveC5zZXRDaG9pY2VzKGNob2ljZXMsICd2YWx1ZScsICdsYWJlbCcsIHRydWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZU9wdGlvbnMoc2VsZWN0Ym94KSB7CiAgICAgIHZhciBpOwogICAgICBmb3IgKGkgPSBzZWxlY3Rib3gub3B0aW9ucy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHNlbGVjdGJveC5yZW1vdmUoaSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBhZGRPcHRpb24oc2VsZWN0LCB0ZXh0LCB2YWx1ZSwgc2VsZWN0ZWQpIHsKICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CiAgICAgIGVsLnRleHRDb250ZW50ID0gdGV4dDsKICAgICAgZWwudmFsdWUgPSB2YWx1ZTsKICAgICAgZWwuc2VsZWN0ZWQgPSBzZWxlY3RlZDsKICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKGVsKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwb3B1bGF0ZVNlbGVjdChlbGVtZW50SWQsIHZhbHVlcykgewogICAgICB2YXIgc2VsZWN0Qm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKTsKICAgICAgcmVtb3ZlT3B0aW9ucyhzZWxlY3RCb3gpOwogICAgICBhZGRPcHRpb24oc2VsZWN0Qm94LCAnQWxsJywgJ0FsbCcsIHRydWUpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgb3B0ID0gdmFsdWVzW2ldOwogICAgICAgIGFkZE9wdGlvbihzZWxlY3RCb3gsIG9wdCwgb3B0LCBmYWxzZSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBidWlsZEZpbHRlcnMobG9nVGFibGUpIHsKICAgICAgbGV0IHdvcmtlcnMgPSBbLi4ubmV3IFNldChsb2dUYWJsZS5tYXAoaXRlbSA9PiBpdGVtLndvcmtlcikpXS5zb3J0KCk7CiAgICAgIHBvcHVsYXRlU2VsZWN0KCdxX3dvcmtlcicsIHdvcmtlcnMpOwogICAgICBwb3B1bGF0ZUNob2ljZXMod29ya2VyQ2hvaWNlcywgd29ya2Vycyk7CiAgICAgIGxldCB3b3Jrc3RhdGlvbnMgPSBbLi4ubmV3IFNldChsb2dUYWJsZS5tYXAoaXRlbSA9PiBpdGVtLndvcmtzdGF0aW9uKSldLnNvcnQoKTsKICAgICAgcG9wdWxhdGVTZWxlY3QoJ3Ffd29ya3N0YXRpb24nLCB3b3Jrc3RhdGlvbnMpOwogICAgICBwb3B1bGF0ZUNob2ljZXMod29ya3N0YXRpb25DaG9pY2VzLCB3b3Jrc3RhdGlvbnMpOwogICAgICBsZXQgd29ya2Zsb3dzID0gWy4uLm5ldyBTZXQobG9nVGFibGUubWFwKGl0ZW0gPT4gaXRlbS53b3JrZmxvdykpXS5zb3J0KCk7CiAgICAgIHBvcHVsYXRlU2VsZWN0KCdxX3dvcmtmbG93Jywgd29ya2Zsb3dzKTsKICAgICAgcG9wdWxhdGVDaG9pY2VzKHdvcmtmbG93Q2hvaWNlcywgd29ya2Zsb3dzKTsKICAgICAgbGV0IHByb2Nlc3NlcyA9IFsuLi5uZXcgU2V0KGxvZ1RhYmxlLm1hcChpdGVtID0+IGl0ZW0ucHJvY2VzcykpXS5zb3J0KCk7CiAgICAgIHBvcHVsYXRlU2VsZWN0KCdxX3Byb2Nlc3MnLCBwcm9jZXNzZXMpOwogICAgICBwb3B1bGF0ZUNob2ljZXMocHJvY2Vzc0Nob2ljZXMsIHByb2Nlc3Nlcyk7CiAgICAgIGxldCBjYXRlZ29yaWVzID0gWy4uLm5ldyBTZXQobG9nVGFibGUubWFwKGl0ZW0gPT4gaXRlbS5jYXRlZ29yeSkpXS5zb3J0KCk7CiAgICAgIHBvcHVsYXRlU2VsZWN0KCdxX2NhdGVnb3J5JywgY2F0ZWdvcmllcyk7CiAgICAgIHBvcHVsYXRlQ2hvaWNlcyhjYXRlZ29yeUNob2ljZXMsIGNhdGVnb3JpZXMpOwogICAgICBsZXQgbGV2ZWxzID0gWy4uLm5ldyBTZXQobG9nVGFibGUubWFwKGl0ZW0gPT4gaXRlbS5sZXZlbCkpXS5zb3J0KCk7CiAgICAgIHBvcHVsYXRlU2VsZWN0KCdxX2xldmVsJywgbGV2ZWxzKTsKICAgICAgcG9wdWxhdGVDaG9pY2VzKGxldmVsQ2hvaWNlcywgbGV2ZWxzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRJbnRlZ2VyVmFsdWUoZWxlbWVudElkKSB7CiAgICAgIHZhciBmb3JtVmFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKS52YWx1ZTsKICAgICAgaWYgKE51bWJlci5pc05hTihmb3JtVmFsKSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgTnVtYmVyKGZvcm1WYWwpLnZhbHVlT2YoKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNlbGVjdFZhbHVlKGVsZW1lbnRJZCkgewogICAgICB2YXIgc2VsZWN0Qm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKTsKICAgICAgcmV0dXJuIHNlbGVjdEJveC5vcHRpb25zW3NlbGVjdEJveC5zZWxlY3RlZEluZGV4XS52YWx1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWxlY3RGaWx0ZXIoZWxlbWVudElkKSB7CiAgICAgIHZhciB2YWx1ZSA9IHNlbGVjdFZhbHVlKGVsZW1lbnRJZCk7CiAgICAgIGlmICh2YWx1ZSA9PSAnQWxsJykgewogICAgICAgIHJldHVybiB0cnVlRmlsdGVyOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICByZXR1cm4gKHZhbCA9PSB2YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdHJ1ZUZpbHRlcigpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gbGVzc1RoYW5GaWx0ZXIodXBwZXJMaW1pdCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbCkgewogICAgICAgIHJldHVybiAodmFsIDw9IHVwcGVyTGltaXQpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ3JlYXRlclRoYW5GaWx0ZXIobG93ZXJMaW1pdCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbCkgewogICAgICAgIHJldHVybiAodmFsID49IGxvd2VyTGltaXQpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYmV0d2VlbkZpbHRlcihsb3dlckxpbWl0LCB1cHBlckxpbWl0KSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgcmV0dXJuICh2YWwgPj0gbG93ZXJMaW1pdCAmJiB2YWwgPD0gdXBwZXJMaW1pdCk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzZWxlY3RGaWx0ZXJUZXh0KGZpbHRlcnMsIGVsZW1lbnROYW1lLCBlbGVtZW50SWQpIHsKICAgICAgdmFyIHZhbHVlID0gc2VsZWN0VmFsdWUoZWxlbWVudElkKTsKICAgICAgaWYgKHZhbHVlICE9ICdBbGwnKSB7CiAgICAgICAgZmlsdGVycy5wdXNoKGA8Yj4ke2VsZW1lbnROYW1lfTwvYj4gaXMgIiR7dmFsdWV9ImApOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYXBwbHlGaWx0ZXJzKGUpIHsKICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBpbmZvLmZpbHRlcnMgPSBbXTsKICAgICAgdmFyIGxpbmVGaWx0ZXI7CiAgICAgIHZhciBkYXRlRmlsdGVyOwogICAgICB2YXIgbGluZUdyZWF0ZXJUaGFuID0gZ2V0SW50ZWdlclZhbHVlKCdxX2xpbmVfbnVtYmVyX2d0ZXEnKTsKICAgICAgdmFyIGxpbmVMZXNzVGhhbiA9IGdldEludGVnZXJWYWx1ZSgncV9saW5lX251bWJlcl9sdGVxJyk7CiAgICAgIGlmIChsaW5lTGVzc1RoYW4gPT0gMCAmJiBsaW5lR3JlYXRlclRoYW4gPT0gMCkgewogICAgICAgIGxpbmVGaWx0ZXIgPSB0cnVlRmlsdGVyOwogICAgICB9IGVsc2UgaWYgKGxpbmVMZXNzVGhhbiA9PSAwKSB7CiAgICAgICAgbGluZUZpbHRlciA9IGdyZWF0ZXJUaGFuRmlsdGVyKGxpbmVHcmVhdGVyVGhhbik7CiAgICAgICAgaW5mby5maWx0ZXJzLnB1c2goYDxiPkxpbmUgbnVtYmVyPC9iPiBpcyBncmVhdGVyIHRoYW4gJHtsaW5lR3JlYXRlclRoYW59YCk7CiAgICAgIH0gZWxzZSBpZiAobGluZUdyZWF0ZXJUaGFuID09IDApIHsKICAgICAgICBsaW5lRmlsdGVyID0gbGVzc1RoYW5GaWx0ZXIobGluZUxlc3NUaGFuKTsKICAgICAgICBpbmZvLmZpbHRlcnMucHVzaChgPGI+TGluZSBudW1iZXI8L2I+IGlzIGxlc3MgdGhhbiAke2xpbmVMZXNzVGhhbn1gKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsaW5lRmlsdGVyID0gYmV0d2VlbkZpbHRlcihsaW5lR3JlYXRlclRoYW4sIGxpbmVMZXNzVGhhbik7CiAgICAgICAgaW5mby5maWx0ZXJzLnB1c2goYDxiPkxpbmUgbnVtYmVyPC9iPiBpcyBiZXR3ZWVuICR7bGluZUxlc3NUaGFufSBhbmQgJHtsaW5lR3JlYXRlclRoYW59YCk7CiAgICAgIH0KICAgICAgdmFyIHdvcmtlckZpbHRlciA9IHNlbGVjdEZpbHRlcigncV93b3JrZXInKTsKICAgICAgc2VsZWN0RmlsdGVyVGV4dChpbmZvLmZpbHRlcnMsICdXb3JrZXInLCAncV93b3JrZXInKTsKICAgICAgdmFyIHdvcmtzdGF0aW9uRmlsdGVyID0gc2VsZWN0RmlsdGVyKCdxX3dvcmtzdGF0aW9uJyk7CiAgICAgIHNlbGVjdEZpbHRlclRleHQoaW5mby5maWx0ZXJzLCAnV29ya3N0YXRpb24nLCAncV93b3Jrc3RhdGlvbicpOwogICAgICB2YXIgd29ya2Zsb3dGaWx0ZXIgPSBzZWxlY3RGaWx0ZXIoJ3Ffd29ya2Zsb3cnKTsKICAgICAgc2VsZWN0RmlsdGVyVGV4dChpbmZvLmZpbHRlcnMsICdXb3JrZmxvdycsICdxX3dvcmtmbG93Jyk7CiAgICAgIHZhciBwcm9jZXNzRmlsdGVyID0gc2VsZWN0RmlsdGVyKCdxX3Byb2Nlc3MnKTsKICAgICAgc2VsZWN0RmlsdGVyVGV4dChpbmZvLmZpbHRlcnMsICdQcm9jZXNzJywgJ3FfcHJvY2VzcycpOwogICAgICB2YXIgY2F0ZWdvcnlGaWx0ZXIgPSBzZWxlY3RGaWx0ZXIoJ3FfY2F0ZWdvcnknKTsKICAgICAgc2VsZWN0RmlsdGVyVGV4dChpbmZvLmZpbHRlcnMsICdDYXRlZ29yeScsICdxX2NhdGVnb3J5Jyk7CiAgICAgIHZhciBsZXZlbEZpbHRlciA9IHNlbGVjdEZpbHRlcigncV9sZXZlbCcpOwogICAgICBzZWxlY3RGaWx0ZXJUZXh0KGluZm8uZmlsdGVycywgJ0xldmVsJywgJ3FfbGV2ZWwnKTsKICAgICAgdmFyIGRhdGVHcmVhdGVyVGhhbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX2RhdGVfdGltZV9ndGVxJykudmFsdWU7CiAgICAgIHZhciBkYXRlTGVzc1RoYW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9kYXRlX3RpbWVfbHRlcScpLnZhbHVlOwogICAgICBpZiAoZGF0ZUdyZWF0ZXJUaGFuICE9ICcnICYmIGRhdGVMZXNzVGhhbiAhPSAnJykgewogICAgICAgIGRhdGVGaWx0ZXIgPSBiZXR3ZWVuRmlsdGVyKG5ldyBEYXRlKGRhdGVHcmVhdGVyVGhhbiksIG5ldyBEYXRlKGRhdGVMZXNzVGhhbikpOwogICAgICAgIGluZm8uZmlsdGVycy5wdXNoKGA8Yj5EYXRlL1RpbWU8L2I+IGlzIGJldHdlZW4gJHtkYXRlTGVzc1RoYW59IGFuZCAke2RhdGVHcmVhdGVyVGhhbn1gKTsKICAgICAgfSBlbHNlIGlmIChkYXRlR3JlYXRlclRoYW4gIT0gJycpIHsKICAgICAgICBkYXRlRmlsdGVyID0gZ3JlYXRlclRoYW5GaWx0ZXIobmV3IERhdGUoZGF0ZUdyZWF0ZXJUaGFuKSk7CiAgICAgICAgaW5mby5maWx0ZXJzLnB1c2goYDxiPkRhdGUvVGltZTwvYj4gaXMgZ3JlYXRlciB0aGFuICR7ZGF0ZUdyZWF0ZXJUaGFufWApOwogICAgICB9IGVsc2UgaWYgKGRhdGVMZXNzVGhhbiAhPSAnJykgewogICAgICAgIGRhdGVGaWx0ZXIgPSBsZXNzVGhhbkZpbHRlcihuZXcgRGF0ZShkYXRlTGVzc1RoYW4pKTsKICAgICAgICBpbmZvLmZpbHRlcnMucHVzaChgPGI+RGF0ZS9UaW1lPC9iPiBpcyBsZXNzIHRoYW4gJHtkYXRlTGVzc1RoYW59YCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0ZUZpbHRlciA9IHRydWVGaWx0ZXI7CiAgICAgIH0KICAgICAgbG9nVGFibGUuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgaXRlbVZhbHVlcyA9IGl0ZW0udmFsdWVzKCk7CiAgICAgICAgdmFyIGxpbmVJbkJvdW5kcyA9IGxpbmVGaWx0ZXIoaXRlbVZhbHVlcy5saW5lTnVtYmVyKTsKICAgICAgICB2YXIgd29ya2VyVmFsaWQgPSB3b3JrZXJGaWx0ZXIoaXRlbVZhbHVlcy53b3JrZXIpOwogICAgICAgIHZhciB3b3Jrc3RhdGlvblZhbGlkID0gd29ya3N0YXRpb25GaWx0ZXIoaXRlbVZhbHVlcy53b3Jrc3RhdGlvbik7CiAgICAgICAgdmFyIHdvcmtmbG93VmFsaWQgPSB3b3JrZmxvd0ZpbHRlcihpdGVtVmFsdWVzLndvcmtmbG93KTsKICAgICAgICB2YXIgcHJvY2Vzc1ZhbGlkID0gcHJvY2Vzc0ZpbHRlcihpdGVtVmFsdWVzLnByb2Nlc3MpOwogICAgICAgIHZhciBjYXRlZ29yeVZhbGlkID0gY2F0ZWdvcnlGaWx0ZXIoaXRlbVZhbHVlcy5jYXRlZ29yeSk7CiAgICAgICAgdmFyIGxldmVsVmFsaWQgPSBsZXZlbEZpbHRlcihpdGVtVmFsdWVzLmxldmVsKTsKICAgICAgICB2YXIgZGF0ZVZhbGlkID0gZGF0ZUZpbHRlcihpdGVtVmFsdWVzLmRhdGVUaW1lKTsKICAgICAgICByZXR1cm4gbGluZUluQm91bmRzICYmIHdvcmtlclZhbGlkICYmIHdvcmtzdGF0aW9uVmFsaWQgJiYgd29ya2Zsb3dWYWxpZCAmJiBwcm9jZXNzVmFsaWQgJiYgY2F0ZWdvcnlWYWxpZCAmJgogICAgICAgICAgbGV2ZWxWYWxpZCAmJiBkYXRlVmFsaWQ7CiAgICAgIH0pOwogICAgICBzaG93SW5mbygpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gY2xlYXJGaWx0ZXJzKCkgewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9saW5lX251bWJlcl9ndGVxJykudmFsdWUgPSAnJzsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FfbGluZV9udW1iZXJfbHRlcScpLnZhbHVlID0gJyc7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3dvcmtlcicpLnZhbHVlID0gJ0FsbCc7CiAgICAgIHdvcmtlckNob2ljZXMuc2V0Q2hvaWNlQnlWYWx1ZSgnQWxsJyk7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX3dvcmtzdGF0aW9uJykudmFsdWUgPSAnQWxsJzsKICAgICAgd29ya3N0YXRpb25DaG9pY2VzLnNldENob2ljZUJ5VmFsdWUoJ0FsbCcpOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV93b3JrZmxvdycpLnZhbHVlID0gJ0FsbCc7CiAgICAgIHdvcmtmbG93Q2hvaWNlcy5zZXRDaG9pY2VCeVZhbHVlKCdBbGwnKTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FfcHJvY2VzcycpLnZhbHVlID0gJ0FsbCc7CiAgICAgIHByb2Nlc3NDaG9pY2VzLnNldENob2ljZUJ5VmFsdWUoJ0FsbCcpOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncV9jYXRlZ29yeScpLnZhbHVlID0gJ0FsbCc7CiAgICAgIGNhdGVnb3J5Q2hvaWNlcy5zZXRDaG9pY2VCeVZhbHVlKCdBbGwnKTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FfbGV2ZWwnKS52YWx1ZSA9ICdBbGwnOwogICAgICBsZXZlbENob2ljZXMuc2V0Q2hvaWNlQnlWYWx1ZSgnQWxsJyk7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxX2RhdGVfdGltZV9ndGVxJykudmFsdWUgPSAnJzsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FfZGF0ZV90aW1lX2x0ZXEnKS52YWx1ZSA9ICcnOwogICAgICBpbmZvLmZpbHRlcnMgPSBbXTsKICAgICAgdXBkYXRlSW5mbygpOwogICAgICBsb2dUYWJsZS5maWx0ZXIoKTsKICAgIH0KICAgIC8qKiBlbmQgZmlsdGVycyAqKi8KCiAgICAvL2Rpc3BsYXkgaGFuZGxpbmcKICAgIC8vaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMzA4MC9zZXR0aW5nLXRoZS1oZWlnaHQtb2YtYS1kaXYtZHluYW1pY2FsbHkKICAgIGZ1bmN0aW9uIHJlc2l6ZUVsZW1lbnRIZWlnaHQoZWxlbWVudCkgewogICAgICB2YXIgaGVpZ2h0ID0gMDsKICAgICAgdmFyIGJvZHkgPSB3aW5kb3cuZG9jdW1lbnQuYm9keTsKICAgICAgaWYgKHdpbmRvdy5pbm5lckhlaWdodCkgewogICAgICAgIGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDsKICAgICAgfSBlbHNlIGlmIChib2R5LnBhcmVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KSB7CiAgICAgICAgaGVpZ2h0ID0gYm9keS5wYXJlbnRFbGVtZW50LmNsaWVudEhlaWdodDsKICAgICAgfSBlbHNlIGlmIChib2R5ICYmIGJvZHkuY2xpZW50SGVpZ2h0KSB7CiAgICAgICAgaGVpZ2h0ID0gYm9keS5jbGllbnRIZWlnaHQ7CiAgICAgIH0KICAgICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSAoKChoZWlnaHQgLSBlbGVtZW50Lm9mZnNldFRvcCkpICsgInB4Iik7CiAgICB9CgogICAgLy8gYWRkIGV2ZW50IGNyb3NzIGJyb3dzZXIKICAgIC8vaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMDE0OTk2My9hZGRpbmctZXZlbnQtbGlzdGVuZXItY3Jvc3MtYnJvd3NlcgogICAgZnVuY3Rpb24gYWRkRXZlbnQoZWxlbSwgZXZlbnQsIGZuKSB7CiAgICAgIGlmIChlbGVtLmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGZuLCBmYWxzZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWxlbS5hdHRhY2hFdmVudCgib24iICsgZXZlbnQsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIHNldCB0aGUgdGhpcyBwb2ludGVyIHNhbWUgYXMgYWRkRXZlbnRMaXN0ZW5lciB3aGVuIGZuIGlzIGNhbGxlZAogICAgICAgICAgcmV0dXJuIChmbi5jYWxsKGVsZW0sIHdpbmRvdy5ldmVudCkpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgPC9zY3JpcHQ+CjwvYm9keT4KCjwvaHRtbD4=';
  var rightColumn = document.querySelector(".col.text-right");
  var logInfoRow = logInfo.querySelector('.row');
  var logValues = Array.from(logInfoRow.querySelectorAll('.log-value')).map(x => x.innerText.replace(' ', '') || x.textContent.replace(' ', ''));
  var content = editor.getValue();

  var gds = content.includes('<PNRBFManagement') ? 'Apollo' : content.includes('DIR0DPN') ? 'Worldspan' : content.includes('SD000766') ? 'Sabre' : content.includes('http://xml.amadeus.com/') ? 'Amadeus' : 'Unknown';
  logValues.push(gds);
  // 4/25/19 13:09:43.199
  var logDateMatches = content.match(new RegExp('([\\d]+)/([\\d]+)/([\\d]+) ([\\d]+):([\\d]+):([\\d]+)\\.([\\d]+)'));
  var make2Characters = function (str) { return ('0' + str).substring(str.length - 1) };
  var logDateText = '20' + logDateMatches[3] + '_' + make2Characters(logDateMatches[1]) + '_' + make2Characters(logDateMatches[2]) + '_' + make2Characters(logDateMatches[4]) + '_' + make2Characters(logDateMatches[5]) + '_' + logDateMatches[6];
  logValues.push(logDateText);

  var processRegex = new RegExp('(Workflow:|Name:) "([^"]+)"', 'g');
  var processMatches = [...content.matchAll(processRegex)];
  var processMatch = processMatches.find((element) => { return (element[2] !== 'Determine PNR Type' && element[2] !== 'Determine PNR Type - IC Offline (ALTOUR)' && element[2] !== 'Determine PNR Type - IC Online (ALTOUR)') });

  var process = processMatch ? processMatch[2] : 'Unknown';
  logValues.push(process);

  var filename = logValues.join('-') + '.log'; //file name

  var span = document.createElement("span");
  span.classList.add("ml-auto");

  var button = document.createElement("button");
  button.classList.add("btn");
  button.classList.add("btn-sm");
  button.classList.add("btn-outline-primary");
  button.style.margin = '5px';
  button.innerText = "View as Table";

  button.onclick = function () {
    // https://stackoverflow.com/questions/11965087/open-a-new-tab-window-and-write-something-to-it#11967627
    var tab = window.open('about:blank', '_blank');
    tab.document.write(atob(htmlContent).replace('%FILENAME%', filename).replace('%LOGTEXT%', content.replace(/'/g, "\\'").replace(/\r?\n/g, "\\n"))); // where 'html' is a variable containing your HTML
    tab.document.close(); // to finish loading the page
  };

  span.appendChild(button);
  rightColumn.appendChild(span);
})();